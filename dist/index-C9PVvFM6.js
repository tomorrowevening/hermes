var Uze=Object.defineProperty;var zze=(s,e,t)=>e in s?Uze(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var qe=(s,e,t)=>zze(s,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();var D0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function A_e(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var jW={exports:{}},OM={},HW={exports:{}},Li={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I8e;function Vze(){if(I8e)return Li;I8e=1;var s=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),y=Symbol.iterator;function b(Ne){return Ne===null||typeof Ne!="object"?null:(Ne=y&&Ne[y]||Ne["@@iterator"],typeof Ne=="function"?Ne:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,I={};function D(Ne,st,Pt){this.props=Ne,this.context=st,this.refs=I,this.updater=Pt||w}D.prototype.isReactComponent={},D.prototype.setState=function(Ne,st){if(typeof Ne!="object"&&typeof Ne!="function"&&Ne!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ne,st,"setState")},D.prototype.forceUpdate=function(Ne){this.updater.enqueueForceUpdate(this,Ne,"forceUpdate")};function P(){}P.prototype=D.prototype;function U(Ne,st,Pt){this.props=Ne,this.context=st,this.refs=I,this.updater=Pt||w}var j=U.prototype=new P;j.constructor=U,A(j,D.prototype),j.isPureReactComponent=!0;var C=Array.isArray,Z=Object.prototype.hasOwnProperty,ie={current:null},se={key:!0,ref:!0,__self:!0,__source:!0};function z(Ne,st,Pt){var yn,bn={},St=null,Ut=null;if(st!=null)for(yn in st.ref!==void 0&&(Ut=st.ref),st.key!==void 0&&(St=""+st.key),st)Z.call(st,yn)&&!se.hasOwnProperty(yn)&&(bn[yn]=st[yn]);var Wt=arguments.length-2;if(Wt===1)bn.children=Pt;else if(1<Wt){for(var kn=Array(Wt),Dn=0;Dn<Wt;Dn++)kn[Dn]=arguments[Dn+2];bn.children=kn}if(Ne&&Ne.defaultProps)for(yn in Wt=Ne.defaultProps,Wt)bn[yn]===void 0&&(bn[yn]=Wt[yn]);return{$$typeof:s,type:Ne,key:St,ref:Ut,props:bn,_owner:ie.current}}function re(Ne,st){return{$$typeof:s,type:Ne.type,key:st,ref:Ne.ref,props:Ne.props,_owner:Ne._owner}}function ye(Ne){return typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===s}function H(Ne){var st={"=":"=0",":":"=2"};return"$"+Ne.replace(/[=:]/g,function(Pt){return st[Pt]})}var Me=/\/+/g;function Oe(Ne,st){return typeof Ne=="object"&&Ne!==null&&Ne.key!=null?H(""+Ne.key):st.toString(36)}function Ue(Ne,st,Pt,yn,bn){var St=typeof Ne;(St==="undefined"||St==="boolean")&&(Ne=null);var Ut=!1;if(Ne===null)Ut=!0;else switch(St){case"string":case"number":Ut=!0;break;case"object":switch(Ne.$$typeof){case s:case e:Ut=!0}}if(Ut)return Ut=Ne,bn=bn(Ut),Ne=yn===""?"."+Oe(Ut,0):yn,C(bn)?(Pt="",Ne!=null&&(Pt=Ne.replace(Me,"$&/")+"/"),Ue(bn,st,Pt,"",function(Dn){return Dn})):bn!=null&&(ye(bn)&&(bn=re(bn,Pt+(!bn.key||Ut&&Ut.key===bn.key?"":(""+bn.key).replace(Me,"$&/")+"/")+Ne)),st.push(bn)),1;if(Ut=0,yn=yn===""?".":yn+":",C(Ne))for(var Wt=0;Wt<Ne.length;Wt++){St=Ne[Wt];var kn=yn+Oe(St,Wt);Ut+=Ue(St,st,Pt,kn,bn)}else if(kn=b(Ne),typeof kn=="function")for(Ne=kn.call(Ne),Wt=0;!(St=Ne.next()).done;)St=St.value,kn=yn+Oe(St,Wt++),Ut+=Ue(St,st,Pt,kn,bn);else if(St==="object")throw st=String(Ne),Error("Objects are not valid as a React child (found: "+(st==="[object Object]"?"object with keys {"+Object.keys(Ne).join(", ")+"}":st)+"). If you meant to render a collection of children, use an array instead.");return Ut}function Ie(Ne,st,Pt){if(Ne==null)return Ne;var yn=[],bn=0;return Ue(Ne,yn,"","",function(St){return st.call(Pt,St,bn++)}),yn}function ce(Ne){if(Ne._status===-1){var st=Ne._result;st=st(),st.then(function(Pt){(Ne._status===0||Ne._status===-1)&&(Ne._status=1,Ne._result=Pt)},function(Pt){(Ne._status===0||Ne._status===-1)&&(Ne._status=2,Ne._result=Pt)}),Ne._status===-1&&(Ne._status=0,Ne._result=st)}if(Ne._status===1)return Ne._result.default;throw Ne._result}var Ve={current:null},Pe={transition:null},We={ReactCurrentDispatcher:Ve,ReactCurrentBatchConfig:Pe,ReactCurrentOwner:ie};function pt(){throw Error("act(...) is not supported in production builds of React.")}return Li.Children={map:Ie,forEach:function(Ne,st,Pt){Ie(Ne,function(){st.apply(this,arguments)},Pt)},count:function(Ne){var st=0;return Ie(Ne,function(){st++}),st},toArray:function(Ne){return Ie(Ne,function(st){return st})||[]},only:function(Ne){if(!ye(Ne))throw Error("React.Children.only expected to receive a single React element child.");return Ne}},Li.Component=D,Li.Fragment=t,Li.Profiler=r,Li.PureComponent=U,Li.StrictMode=n,Li.Suspense=c,Li.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=We,Li.act=pt,Li.cloneElement=function(Ne,st,Pt){if(Ne==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ne+".");var yn=A({},Ne.props),bn=Ne.key,St=Ne.ref,Ut=Ne._owner;if(st!=null){if(st.ref!==void 0&&(St=st.ref,Ut=ie.current),st.key!==void 0&&(bn=""+st.key),Ne.type&&Ne.type.defaultProps)var Wt=Ne.type.defaultProps;for(kn in st)Z.call(st,kn)&&!se.hasOwnProperty(kn)&&(yn[kn]=st[kn]===void 0&&Wt!==void 0?Wt[kn]:st[kn])}var kn=arguments.length-2;if(kn===1)yn.children=Pt;else if(1<kn){Wt=Array(kn);for(var Dn=0;Dn<kn;Dn++)Wt[Dn]=arguments[Dn+2];yn.children=Wt}return{$$typeof:s,type:Ne.type,key:bn,ref:St,props:yn,_owner:Ut}},Li.createContext=function(Ne){return Ne={$$typeof:o,_currentValue:Ne,_currentValue2:Ne,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ne.Provider={$$typeof:i,_context:Ne},Ne.Consumer=Ne},Li.createElement=z,Li.createFactory=function(Ne){var st=z.bind(null,Ne);return st.type=Ne,st},Li.createRef=function(){return{current:null}},Li.forwardRef=function(Ne){return{$$typeof:l,render:Ne}},Li.isValidElement=ye,Li.lazy=function(Ne){return{$$typeof:m,_payload:{_status:-1,_result:Ne},_init:ce}},Li.memo=function(Ne,st){return{$$typeof:h,type:Ne,compare:st===void 0?null:st}},Li.startTransition=function(Ne){var st=Pe.transition;Pe.transition={};try{Ne()}finally{Pe.transition=st}},Li.unstable_act=pt,Li.useCallback=function(Ne,st){return Ve.current.useCallback(Ne,st)},Li.useContext=function(Ne){return Ve.current.useContext(Ne)},Li.useDebugValue=function(){},Li.useDeferredValue=function(Ne){return Ve.current.useDeferredValue(Ne)},Li.useEffect=function(Ne,st){return Ve.current.useEffect(Ne,st)},Li.useId=function(){return Ve.current.useId()},Li.useImperativeHandle=function(Ne,st,Pt){return Ve.current.useImperativeHandle(Ne,st,Pt)},Li.useInsertionEffect=function(Ne,st){return Ve.current.useInsertionEffect(Ne,st)},Li.useLayoutEffect=function(Ne,st){return Ve.current.useLayoutEffect(Ne,st)},Li.useMemo=function(Ne,st){return Ve.current.useMemo(Ne,st)},Li.useReducer=function(Ne,st,Pt){return Ve.current.useReducer(Ne,st,Pt)},Li.useRef=function(Ne){return Ve.current.useRef(Ne)},Li.useState=function(Ne){return Ve.current.useState(Ne)},Li.useSyncExternalStore=function(Ne,st,Pt){return Ve.current.useSyncExternalStore(Ne,st,Pt)},Li.useTransition=function(){return Ve.current.useTransition()},Li.version="18.3.1",Li}var k8e;function NK(){return k8e||(k8e=1,HW.exports=Vze()),HW.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D8e;function Gze(){if(D8e)return OM;D8e=1;var s=NK(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,r=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(l,c,h){var m,y={},b=null,w=null;h!==void 0&&(b=""+h),c.key!==void 0&&(b=""+c.key),c.ref!==void 0&&(w=c.ref);for(m in c)n.call(c,m)&&!i.hasOwnProperty(m)&&(y[m]=c[m]);if(l&&l.defaultProps)for(m in c=l.defaultProps,c)y[m]===void 0&&(y[m]=c[m]);return{$$typeof:e,type:l,key:b,ref:w,props:y,_owner:r.current}}return OM.Fragment=t,OM.jsx=o,OM.jsxs=o,OM}var O8e;function jze(){return O8e||(O8e=1,jW.exports=Gze()),jW.exports}var ot=jze(),On=NK(),HD={},$W={exports:{}},od={},WW={exports:{}},qW={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L8e;function Hze(){return L8e||(L8e=1,function(s){function e(Pe,We){var pt=Pe.length;Pe.push(We);e:for(;0<pt;){var Ne=pt-1>>>1,st=Pe[Ne];if(0<r(st,We))Pe[Ne]=We,Pe[pt]=st,pt=Ne;else break e}}function t(Pe){return Pe.length===0?null:Pe[0]}function n(Pe){if(Pe.length===0)return null;var We=Pe[0],pt=Pe.pop();if(pt!==We){Pe[0]=pt;e:for(var Ne=0,st=Pe.length,Pt=st>>>1;Ne<Pt;){var yn=2*(Ne+1)-1,bn=Pe[yn],St=yn+1,Ut=Pe[St];if(0>r(bn,pt))St<st&&0>r(Ut,bn)?(Pe[Ne]=Ut,Pe[St]=pt,Ne=St):(Pe[Ne]=bn,Pe[yn]=pt,Ne=yn);else if(St<st&&0>r(Ut,pt))Pe[Ne]=Ut,Pe[St]=pt,Ne=St;else break e}}return We}function r(Pe,We){var pt=Pe.sortIndex-We.sortIndex;return pt!==0?pt:Pe.id-We.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;s.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();s.unstable_now=function(){return o.now()-l}}var c=[],h=[],m=1,y=null,b=3,w=!1,A=!1,I=!1,D=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,U=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function j(Pe){for(var We=t(h);We!==null;){if(We.callback===null)n(h);else if(We.startTime<=Pe)n(h),We.sortIndex=We.expirationTime,e(c,We);else break;We=t(h)}}function C(Pe){if(I=!1,j(Pe),!A)if(t(c)!==null)A=!0,ce(Z);else{var We=t(h);We!==null&&Ve(C,We.startTime-Pe)}}function Z(Pe,We){A=!1,I&&(I=!1,P(z),z=-1),w=!0;var pt=b;try{for(j(We),y=t(c);y!==null&&(!(y.expirationTime>We)||Pe&&!H());){var Ne=y.callback;if(typeof Ne=="function"){y.callback=null,b=y.priorityLevel;var st=Ne(y.expirationTime<=We);We=s.unstable_now(),typeof st=="function"?y.callback=st:y===t(c)&&n(c),j(We)}else n(c);y=t(c)}if(y!==null)var Pt=!0;else{var yn=t(h);yn!==null&&Ve(C,yn.startTime-We),Pt=!1}return Pt}finally{y=null,b=pt,w=!1}}var ie=!1,se=null,z=-1,re=5,ye=-1;function H(){return!(s.unstable_now()-ye<re)}function Me(){if(se!==null){var Pe=s.unstable_now();ye=Pe;var We=!0;try{We=se(!0,Pe)}finally{We?Oe():(ie=!1,se=null)}}else ie=!1}var Oe;if(typeof U=="function")Oe=function(){U(Me)};else if(typeof MessageChannel<"u"){var Ue=new MessageChannel,Ie=Ue.port2;Ue.port1.onmessage=Me,Oe=function(){Ie.postMessage(null)}}else Oe=function(){D(Me,0)};function ce(Pe){se=Pe,ie||(ie=!0,Oe())}function Ve(Pe,We){z=D(function(){Pe(s.unstable_now())},We)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(Pe){Pe.callback=null},s.unstable_continueExecution=function(){A||w||(A=!0,ce(Z))},s.unstable_forceFrameRate=function(Pe){0>Pe||125<Pe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):re=0<Pe?Math.floor(1e3/Pe):5},s.unstable_getCurrentPriorityLevel=function(){return b},s.unstable_getFirstCallbackNode=function(){return t(c)},s.unstable_next=function(Pe){switch(b){case 1:case 2:case 3:var We=3;break;default:We=b}var pt=b;b=We;try{return Pe()}finally{b=pt}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(Pe,We){switch(Pe){case 1:case 2:case 3:case 4:case 5:break;default:Pe=3}var pt=b;b=Pe;try{return We()}finally{b=pt}},s.unstable_scheduleCallback=function(Pe,We,pt){var Ne=s.unstable_now();switch(typeof pt=="object"&&pt!==null?(pt=pt.delay,pt=typeof pt=="number"&&0<pt?Ne+pt:Ne):pt=Ne,Pe){case 1:var st=-1;break;case 2:st=250;break;case 5:st=1073741823;break;case 4:st=1e4;break;default:st=5e3}return st=pt+st,Pe={id:m++,callback:We,priorityLevel:Pe,startTime:pt,expirationTime:st,sortIndex:-1},pt>Ne?(Pe.sortIndex=pt,e(h,Pe),t(c)===null&&Pe===t(h)&&(I?(P(z),z=-1):I=!0,Ve(C,pt-Ne))):(Pe.sortIndex=st,e(c,Pe),A||w||(A=!0,ce(Z))),Pe},s.unstable_shouldYield=H,s.unstable_wrapCallback=function(Pe){var We=b;return function(){var pt=b;b=We;try{return Pe.apply(this,arguments)}finally{b=pt}}}}(qW)),qW}var F8e;function $ze(){return F8e||(F8e=1,WW.exports=Hze()),WW.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B8e;function Wze(){if(B8e)return od;B8e=1;var s=NK(),e=$ze();function t(p){for(var v="https://reactjs.org/docs/error-decoder.html?invariant="+p,E=1;E<arguments.length;E++)v+="&args[]="+encodeURIComponent(arguments[E]);return"Minified React error #"+p+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,r={};function i(p,v){o(p,v),o(p+"Capture",v)}function o(p,v){for(r[p]=v,p=0;p<v.length;p++)n.add(v[p])}var l=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),c=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,m={},y={};function b(p){return c.call(y,p)?!0:c.call(m,p)?!1:h.test(p)?y[p]=!0:(m[p]=!0,!1)}function w(p,v,E,L){if(E!==null&&E.type===0)return!1;switch(typeof v){case"function":case"symbol":return!0;case"boolean":return L?!1:E!==null?!E.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function A(p,v,E,L){if(v===null||typeof v>"u"||w(p,v,E,L))return!0;if(L)return!1;if(E!==null)switch(E.type){case 3:return!v;case 4:return v===!1;case 5:return isNaN(v);case 6:return isNaN(v)||1>v}return!1}function I(p,v,E,L,q,ee,pe){this.acceptsBooleans=v===2||v===3||v===4,this.attributeName=L,this.attributeNamespace=q,this.mustUseProperty=E,this.propertyName=p,this.type=v,this.sanitizeURL=ee,this.removeEmptyString=pe}var D={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){D[p]=new I(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var v=p[0];D[v]=new I(v,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){D[p]=new I(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){D[p]=new I(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){D[p]=new I(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){D[p]=new I(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){D[p]=new I(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){D[p]=new I(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){D[p]=new I(p,5,!1,p.toLowerCase(),null,!1,!1)});var P=/[\-:]([a-z])/g;function U(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var v=p.replace(P,U);D[v]=new I(v,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var v=p.replace(P,U);D[v]=new I(v,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var v=p.replace(P,U);D[v]=new I(v,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){D[p]=new I(p,1,!1,p.toLowerCase(),null,!1,!1)}),D.xlinkHref=new I("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){D[p]=new I(p,1,!1,p.toLowerCase(),null,!0,!0)});function j(p,v,E,L){var q=D.hasOwnProperty(v)?D[v]:null;(q!==null?q.type!==0:L||!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(A(v,E,q,L)&&(E=null),L||q===null?b(v)&&(E===null?p.removeAttribute(v):p.setAttribute(v,""+E)):q.mustUseProperty?p[q.propertyName]=E===null?q.type===3?!1:"":E:(v=q.attributeName,L=q.attributeNamespace,E===null?p.removeAttribute(v):(q=q.type,E=q===3||q===4&&E===!0?"":""+E,L?p.setAttributeNS(L,v,E):p.setAttribute(v,E))))}var C=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Z=Symbol.for("react.element"),ie=Symbol.for("react.portal"),se=Symbol.for("react.fragment"),z=Symbol.for("react.strict_mode"),re=Symbol.for("react.profiler"),ye=Symbol.for("react.provider"),H=Symbol.for("react.context"),Me=Symbol.for("react.forward_ref"),Oe=Symbol.for("react.suspense"),Ue=Symbol.for("react.suspense_list"),Ie=Symbol.for("react.memo"),ce=Symbol.for("react.lazy"),Ve=Symbol.for("react.offscreen"),Pe=Symbol.iterator;function We(p){return p===null||typeof p!="object"?null:(p=Pe&&p[Pe]||p["@@iterator"],typeof p=="function"?p:null)}var pt=Object.assign,Ne;function st(p){if(Ne===void 0)try{throw Error()}catch(E){var v=E.stack.trim().match(/\n( *(at )?)/);Ne=v&&v[1]||""}return`
`+Ne+p}var Pt=!1;function yn(p,v){if(!p||Pt)return"";Pt=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(v)if(v=function(){throw Error()},Object.defineProperty(v.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(v,[])}catch(It){var L=It}Reflect.construct(p,[],v)}else{try{v.call()}catch(It){L=It}p.call(v.prototype)}else{try{throw Error()}catch(It){L=It}p()}}catch(It){if(It&&L&&typeof It.stack=="string"){for(var q=It.stack.split(`
`),ee=L.stack.split(`
`),pe=q.length-1,Fe=ee.length-1;1<=pe&&0<=Fe&&q[pe]!==ee[Fe];)Fe--;for(;1<=pe&&0<=Fe;pe--,Fe--)if(q[pe]!==ee[Fe]){if(pe!==1||Fe!==1)do if(pe--,Fe--,0>Fe||q[pe]!==ee[Fe]){var Ze=`
`+q[pe].replace(" at new "," at ");return p.displayName&&Ze.includes("<anonymous>")&&(Ze=Ze.replace("<anonymous>",p.displayName)),Ze}while(1<=pe&&0<=Fe);break}}}finally{Pt=!1,Error.prepareStackTrace=E}return(p=p?p.displayName||p.name:"")?st(p):""}function bn(p){switch(p.tag){case 5:return st(p.type);case 16:return st("Lazy");case 13:return st("Suspense");case 19:return st("SuspenseList");case 0:case 2:case 15:return p=yn(p.type,!1),p;case 11:return p=yn(p.type.render,!1),p;case 1:return p=yn(p.type,!0),p;default:return""}}function St(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case se:return"Fragment";case ie:return"Portal";case re:return"Profiler";case z:return"StrictMode";case Oe:return"Suspense";case Ue:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case H:return(p.displayName||"Context")+".Consumer";case ye:return(p._context.displayName||"Context")+".Provider";case Me:var v=p.render;return p=p.displayName,p||(p=v.displayName||v.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case Ie:return v=p.displayName||null,v!==null?v:St(p.type)||"Memo";case ce:v=p._payload,p=p._init;try{return St(p(v))}catch{}}return null}function Ut(p){var v=p.type;switch(p.tag){case 24:return"Cache";case 9:return(v.displayName||"Context")+".Consumer";case 10:return(v._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=v.render,p=p.displayName||p.name||"",v.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return v;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return St(v);case 8:return v===z?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v}return null}function Wt(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function kn(p){var v=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(v==="checkbox"||v==="radio")}function Dn(p){var v=kn(p)?"checked":"value",E=Object.getOwnPropertyDescriptor(p.constructor.prototype,v),L=""+p[v];if(!p.hasOwnProperty(v)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var q=E.get,ee=E.set;return Object.defineProperty(p,v,{configurable:!0,get:function(){return q.call(this)},set:function(pe){L=""+pe,ee.call(this,pe)}}),Object.defineProperty(p,v,{enumerable:E.enumerable}),{getValue:function(){return L},setValue:function(pe){L=""+pe},stopTracking:function(){p._valueTracker=null,delete p[v]}}}}function or(p){p._valueTracker||(p._valueTracker=Dn(p))}function ns(p){if(!p)return!1;var v=p._valueTracker;if(!v)return!0;var E=v.getValue(),L="";return p&&(L=kn(p)?p.checked?"true":"false":p.value),p=L,p!==E?(v.setValue(p),!0):!1}function Xr(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function Vr(p,v){var E=v.checked;return pt({},v,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:E??p._wrapperState.initialChecked})}function Kr(p,v){var E=v.defaultValue==null?"":v.defaultValue,L=v.checked!=null?v.checked:v.defaultChecked;E=Wt(v.value!=null?v.value:E),p._wrapperState={initialChecked:L,initialValue:E,controlled:v.type==="checkbox"||v.type==="radio"?v.checked!=null:v.value!=null}}function Yr(p,v){v=v.checked,v!=null&&j(p,"checked",v,!1)}function mi(p,v){Yr(p,v);var E=Wt(v.value),L=v.type;if(E!=null)L==="number"?(E===0&&p.value===""||p.value!=E)&&(p.value=""+E):p.value!==""+E&&(p.value=""+E);else if(L==="submit"||L==="reset"){p.removeAttribute("value");return}v.hasOwnProperty("value")?_s(p,v.type,E):v.hasOwnProperty("defaultValue")&&_s(p,v.type,Wt(v.defaultValue)),v.checked==null&&v.defaultChecked!=null&&(p.defaultChecked=!!v.defaultChecked)}function Ke(p,v,E){if(v.hasOwnProperty("value")||v.hasOwnProperty("defaultValue")){var L=v.type;if(!(L!=="submit"&&L!=="reset"||v.value!==void 0&&v.value!==null))return;v=""+p._wrapperState.initialValue,E||v===p.value||(p.value=v),p.defaultValue=v}E=p.name,E!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,E!==""&&(p.name=E)}function _s(p,v,E){(v!=="number"||Xr(p.ownerDocument)!==p)&&(E==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+E&&(p.defaultValue=""+E))}var ui=Array.isArray;function Ti(p,v,E,L){if(p=p.options,v){v={};for(var q=0;q<E.length;q++)v["$"+E[q]]=!0;for(E=0;E<p.length;E++)q=v.hasOwnProperty("$"+p[E].value),p[E].selected!==q&&(p[E].selected=q),q&&L&&(p[E].defaultSelected=!0)}else{for(E=""+Wt(E),v=null,q=0;q<p.length;q++){if(p[q].value===E){p[q].selected=!0,L&&(p[q].defaultSelected=!0);return}v!==null||p[q].disabled||(v=p[q])}v!==null&&(v.selected=!0)}}function Vn(p,v){if(v.dangerouslySetInnerHTML!=null)throw Error(t(91));return pt({},v,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function ke(p,v){var E=v.value;if(E==null){if(E=v.children,v=v.defaultValue,E!=null){if(v!=null)throw Error(t(92));if(ui(E)){if(1<E.length)throw Error(t(93));E=E[0]}v=E}v==null&&(v=""),E=v}p._wrapperState={initialValue:Wt(E)}}function de(p,v){var E=Wt(v.value),L=Wt(v.defaultValue);E!=null&&(E=""+E,E!==p.value&&(p.value=E),v.defaultValue==null&&p.defaultValue!==E&&(p.defaultValue=E)),L!=null&&(p.defaultValue=""+L)}function ht(p){var v=p.textContent;v===p._wrapperState.initialValue&&v!==""&&v!==null&&(p.value=v)}function Xt(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Kt(p,v){return p==null||p==="http://www.w3.org/1999/xhtml"?Xt(v):p==="http://www.w3.org/2000/svg"&&v==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var Vt,Qn=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(v,E,L,q){MSApp.execUnsafeLocalFunction(function(){return p(v,E,L,q)})}:p}(function(p,v){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=v;else{for(Vt=Vt||document.createElement("div"),Vt.innerHTML="<svg>"+v.valueOf().toString()+"</svg>",v=Vt.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;v.firstChild;)p.appendChild(v.firstChild)}});function wn(p,v){if(v){var E=p.firstChild;if(E&&E===p.lastChild&&E.nodeType===3){E.nodeValue=v;return}}p.textContent=v}var ar={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ir=["Webkit","ms","Moz","O"];Object.keys(ar).forEach(function(p){Ir.forEach(function(v){v=v+p.charAt(0).toUpperCase()+p.substring(1),ar[v]=ar[p]})});function en(p,v,E){return v==null||typeof v=="boolean"||v===""?"":E||typeof v!="number"||v===0||ar.hasOwnProperty(p)&&ar[p]?(""+v).trim():v+"px"}function vn(p,v){p=p.style;for(var E in v)if(v.hasOwnProperty(E)){var L=E.indexOf("--")===0,q=en(E,v[E],L);E==="float"&&(E="cssFloat"),L?p.setProperty(E,q):p[E]=q}}var Gn=pt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $n(p,v){if(v){if(Gn[p]&&(v.children!=null||v.dangerouslySetInnerHTML!=null))throw Error(t(137,p));if(v.dangerouslySetInnerHTML!=null){if(v.children!=null)throw Error(t(60));if(typeof v.dangerouslySetInnerHTML!="object"||!("__html"in v.dangerouslySetInnerHTML))throw Error(t(61))}if(v.style!=null&&typeof v.style!="object")throw Error(t(62))}}function Bn(p,v){if(p.indexOf("-")===-1)return typeof v.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Cr=null;function et(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var _n=null,pn=null,Nn=null;function cn(p){if(p=Fh(p)){if(typeof _n!="function")throw Error(t(280));var v=p.stateNode;v&&(v=Ru(v),_n(p.stateNode,p.type,v))}}function jt(p){pn?Nn?Nn.push(p):Nn=[p]:pn=p}function Wn(){if(pn){var p=pn,v=Nn;if(Nn=pn=null,cn(p),v)for(p=0;p<v.length;p++)cn(v[p])}}function Br(p,v){return p(v)}function Hi(){}var Pr=!1;function Ls(p,v,E){if(Pr)return p(v,E);Pr=!0;try{return Br(p,v,E)}finally{Pr=!1,(pn!==null||Nn!==null)&&(Hi(),Wn())}}function la(p,v){var E=p.stateNode;if(E===null)return null;var L=Ru(E);if(L===null)return null;E=L[v];e:switch(v){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(L=!L.disabled)||(p=p.type,L=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!L;break e;default:p=!1}if(p)return null;if(E&&typeof E!="function")throw Error(t(231,v,typeof E));return E}var Sd=!1;if(l)try{var u0={};Object.defineProperty(u0,"passive",{get:function(){Sd=!0}}),window.addEventListener("test",u0,u0),window.removeEventListener("test",u0,u0)}catch{Sd=!1}function Up(p,v,E,L,q,ee,pe,Fe,Ze){var It=Array.prototype.slice.call(arguments,3);try{v.apply(E,It)}catch(on){this.onError(on)}}var Pc=!1,wd=null,Pl=!1,cl=null,wh={onError:function(p){Pc=!0,wd=p}};function _m(p,v,E,L,q,ee,pe,Fe,Ze){Pc=!1,wd=null,Up.apply(wh,arguments)}function Th(p,v,E,L,q,ee,pe,Fe,Ze){if(_m.apply(this,arguments),Pc){if(Pc){var It=wd;Pc=!1,wd=null}else throw Error(t(198));Pl||(Pl=!0,cl=It)}}function $o(p){var v=p,E=p;if(p.alternate)for(;v.return;)v=v.return;else{p=v;do v=p,(v.flags&4098)!==0&&(E=v.return),p=v.return;while(p)}return v.tag===3?E:null}function Mu(p){if(p.tag===13){var v=p.memoizedState;if(v===null&&(p=p.alternate,p!==null&&(v=p.memoizedState)),v!==null)return v.dehydrated}return null}function Rc(p){if($o(p)!==p)throw Error(t(188))}function Td(p){var v=p.alternate;if(!v){if(v=$o(p),v===null)throw Error(t(188));return v!==p?null:p}for(var E=p,L=v;;){var q=E.return;if(q===null)break;var ee=q.alternate;if(ee===null){if(L=q.return,L!==null){E=L;continue}break}if(q.child===ee.child){for(ee=q.child;ee;){if(ee===E)return Rc(q),p;if(ee===L)return Rc(q),v;ee=ee.sibling}throw Error(t(188))}if(E.return!==L.return)E=q,L=ee;else{for(var pe=!1,Fe=q.child;Fe;){if(Fe===E){pe=!0,E=q,L=ee;break}if(Fe===L){pe=!0,L=q,E=ee;break}Fe=Fe.sibling}if(!pe){for(Fe=ee.child;Fe;){if(Fe===E){pe=!0,E=ee,L=q;break}if(Fe===L){pe=!0,L=ee,E=q;break}Fe=Fe.sibling}if(!pe)throw Error(t(189))}}if(E.alternate!==L)throw Error(t(190))}if(E.tag!==3)throw Error(t(188));return E.stateNode.current===E?p:v}function ca(p){return p=Td(p),p!==null?ul(p):null}function ul(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var v=ul(p);if(v!==null)return v;p=p.sibling}return null}var Sm=e.unstable_scheduleCallback,Eh=e.unstable_cancelCallback,wm=e.unstable_shouldYield,Tm=e.unstable_requestPaint,me=e.unstable_now,mt=e.unstable_getCurrentPriorityLevel,At=e.unstable_ImmediatePriority,wt=e.unstable_UserBlockingPriority,bt=e.unstable_NormalPriority,Rn=e.unstable_LowPriority,jn=e.unstable_IdlePriority,An=null,Un=null;function er(p){if(Un&&typeof Un.onCommitFiberRoot=="function")try{Un.onCommitFiberRoot(An,p,void 0,(p.current.flags&128)===128)}catch{}}var yr=Math.clz32?Math.clz32:gi,Zr=Math.log,xr=Math.LN2;function gi(p){return p>>>=0,p===0?32:31-(Zr(p)/xr|0)|0}var Ui=64,ss=4194304;function hi(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function $s(p,v){var E=p.pendingLanes;if(E===0)return 0;var L=0,q=p.suspendedLanes,ee=p.pingedLanes,pe=E&268435455;if(pe!==0){var Fe=pe&~q;Fe!==0?L=hi(Fe):(ee&=pe,ee!==0&&(L=hi(ee)))}else pe=E&~q,pe!==0?L=hi(pe):ee!==0&&(L=hi(ee));if(L===0)return 0;if(v!==0&&v!==L&&(v&q)===0&&(q=L&-L,ee=v&-v,q>=ee||q===16&&(ee&4194240)!==0))return v;if((L&4)!==0&&(L|=E&16),v=p.entangledLanes,v!==0)for(p=p.entanglements,v&=L;0<v;)E=31-yr(v),q=1<<E,L|=p[E],v&=~q;return L}function lr(p,v){switch(p){case 1:case 2:case 4:return v+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ua(p,v){for(var E=p.suspendedLanes,L=p.pingedLanes,q=p.expirationTimes,ee=p.pendingLanes;0<ee;){var pe=31-yr(ee),Fe=1<<pe,Ze=q[pe];Ze===-1?((Fe&E)===0||(Fe&L)!==0)&&(q[pe]=lr(Fe,v)):Ze<=v&&(p.expiredLanes|=Fe),ee&=~Fe}}function pi(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function Ca(){var p=Ui;return Ui<<=1,(Ui&4194240)===0&&(Ui=64),p}function oo(p){for(var v=[],E=0;31>E;E++)v.push(p);return v}function Wo(p,v,E){p.pendingLanes|=v,v!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,v=31-yr(v),p[v]=E}function Cu(p,v){var E=p.pendingLanes&~v;p.pendingLanes=v,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=v,p.mutableReadLanes&=v,p.entangledLanes&=v,v=p.entanglements;var L=p.eventTimes;for(p=p.expirationTimes;0<E;){var q=31-yr(E),ee=1<<q;v[q]=0,L[q]=-1,p[q]=-1,E&=~ee}}function Ai(p,v){var E=p.entangledLanes|=v;for(p=p.entanglements;E;){var L=31-yr(E),q=1<<L;q&v|p[L]&v&&(p[L]|=v),E&=~q}}var Ur=0;function qo(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var As,Rl,Wa,Mh,Ic,Em=!1,Mm=[],kc=null,dl=null,z0=null,Ed=new Map,Ch=new Map,Dc=[],l9="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function kg(p,v){switch(p){case"focusin":case"focusout":kc=null;break;case"dragenter":case"dragleave":dl=null;break;case"mouseover":case"mouseout":z0=null;break;case"pointerover":case"pointerout":Ed.delete(v.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ch.delete(v.pointerId)}}function zp(p,v,E,L,q,ee){return p===null||p.nativeEvent!==ee?(p={blockedOn:v,domEventName:E,eventSystemFlags:L,nativeEvent:ee,targetContainers:[q]},v!==null&&(v=Fh(v),v!==null&&Rl(v)),p):(p.eventSystemFlags|=L,v=p.targetContainers,q!==null&&v.indexOf(q)===-1&&v.push(q),p)}function P5(p,v,E,L,q){switch(v){case"focusin":return kc=zp(kc,p,v,E,L,q),!0;case"dragenter":return dl=zp(dl,p,v,E,L,q),!0;case"mouseover":return z0=zp(z0,p,v,E,L,q),!0;case"pointerover":var ee=q.pointerId;return Ed.set(ee,zp(Ed.get(ee)||null,p,v,E,L,q)),!0;case"gotpointercapture":return ee=q.pointerId,Ch.set(ee,zp(Ch.get(ee)||null,p,v,E,L,q)),!0}return!1}function Au(p){var v=W0(p.target);if(v!==null){var E=$o(v);if(E!==null){if(v=E.tag,v===13){if(v=Mu(E),v!==null){p.blockedOn=v,Ic(p.priority,function(){Wa(E)});return}}else if(v===3&&E.stateNode.current.memoizedState.isDehydrated){p.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}p.blockedOn=null}function Md(p){if(p.blockedOn!==null)return!1;for(var v=p.targetContainers;0<v.length;){var E=Pm(p.domEventName,p.eventSystemFlags,v[0],p.nativeEvent);if(E===null){E=p.nativeEvent;var L=new E.constructor(E.type,E);Cr=L,E.target.dispatchEvent(L),Cr=null}else return v=Fh(E),v!==null&&Rl(v),p.blockedOn=E,!1;v.shift()}return!0}function c9(p,v,E){Md(p)&&E.delete(v)}function V0(){Em=!1,kc!==null&&Md(kc)&&(kc=null),dl!==null&&Md(dl)&&(dl=null),z0!==null&&Md(z0)&&(z0=null),Ed.forEach(c9),Ch.forEach(c9)}function d0(p,v){p.blockedOn===v&&(p.blockedOn=null,Em||(Em=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,V0)))}function Ah(p){function v(q){return d0(q,p)}if(0<Mm.length){d0(Mm[0],p);for(var E=1;E<Mm.length;E++){var L=Mm[E];L.blockedOn===p&&(L.blockedOn=null)}}for(kc!==null&&d0(kc,p),dl!==null&&d0(dl,p),z0!==null&&d0(z0,p),Ed.forEach(v),Ch.forEach(v),E=0;E<Dc.length;E++)L=Dc[E],L.blockedOn===p&&(L.blockedOn=null);for(;0<Dc.length&&(E=Dc[0],E.blockedOn===null);)Au(E),E.blockedOn===null&&Dc.shift()}var Oc=C.ReactCurrentBatchConfig,Cm=!0;function Dg(p,v,E,L){var q=Ur,ee=Oc.transition;Oc.transition=null;try{Ur=1,Am(p,v,E,L)}finally{Ur=q,Oc.transition=ee}}function u9(p,v,E,L){var q=Ur,ee=Oc.transition;Oc.transition=null;try{Ur=4,Am(p,v,E,L)}finally{Ur=q,Oc.transition=ee}}function Am(p,v,E,L){if(Cm){var q=Pm(p,v,E,L);if(q===null)T9(p,v,L,Nm,E),kg(p,L);else if(P5(q,p,v,E,L))L.stopPropagation();else if(kg(p,L),v&4&&-1<l9.indexOf(p)){for(;q!==null;){var ee=Fh(q);if(ee!==null&&As(ee),ee=Pm(p,v,E,L),ee===null&&T9(p,v,L,Nm,E),ee===q)break;q=ee}q!==null&&L.stopPropagation()}else T9(p,v,L,null,E)}}var Nm=null;function Pm(p,v,E,L){if(Nm=null,p=et(L),p=W0(p),p!==null)if(v=$o(p),v===null)p=null;else if(E=v.tag,E===13){if(p=Mu(v),p!==null)return p;p=null}else if(E===3){if(v.stateNode.current.memoizedState.isDehydrated)return v.tag===3?v.stateNode.containerInfo:null;p=null}else v!==p&&(p=null);return Nm=p,null}function Og(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(mt()){case At:return 1;case wt:return 4;case bt:case Rn:return 16;case jn:return 536870912;default:return 16}default:return 16}}var Lc=null,Rm=null,Nh=null;function Lg(){if(Nh)return Nh;var p,v=Rm,E=v.length,L,q="value"in Lc?Lc.value:Lc.textContent,ee=q.length;for(p=0;p<E&&v[p]===q[p];p++);var pe=E-p;for(L=1;L<=pe&&v[E-L]===q[ee-L];L++);return Nh=q.slice(p,1<L?1-L:void 0)}function Im(p){var v=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&v===13&&(p=13)):p=v,p===10&&(p=13),32<=p||p===13?p:0}function Fc(){return!0}function km(){return!1}function Xo(p){function v(E,L,q,ee,pe){this._reactName=E,this._targetInst=q,this.type=L,this.nativeEvent=ee,this.target=pe,this.currentTarget=null;for(var Fe in p)p.hasOwnProperty(Fe)&&(E=p[Fe],this[Fe]=E?E(ee):ee[Fe]);return this.isDefaultPrevented=(ee.defaultPrevented!=null?ee.defaultPrevented:ee.returnValue===!1)?Fc:km,this.isPropagationStopped=km,this}return pt(v.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=Fc)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=Fc)},persist:function(){},isPersistent:Fc}),v}var Cd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Il=Xo(Cd),G0=pt({},Cd,{view:0,detail:0}),Vp=Xo(G0),Gp,Bc,Ad,Uc=pt({},G0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bm,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==Ad&&(Ad&&p.type==="mousemove"?(Gp=p.screenX-Ad.screenX,Bc=p.screenY-Ad.screenY):Bc=Gp=0,Ad=p),Gp)},movementY:function(p){return"movementY"in p?p.movementY:Bc}}),bo=Xo(Uc),Nu=pt({},Uc,{dataTransfer:0}),Dm=Xo(Nu),d9=pt({},G0,{relatedTarget:0}),j0=Xo(d9),jp=pt({},Cd,{animationName:0,elapsedTime:0,pseudoElement:0}),h9=Xo(jp),p9=pt({},Cd,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Fg=Xo(p9),R5=pt({},Cd,{data:0}),Om=Xo(R5),I5={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Lm={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Fm(p){var v=this.nativeEvent;return v.getModifierState?v.getModifierState(p):(p=Lm[p])?!!v[p]:!1}function Bm(){return Fm}var Hp=pt({},G0,{key:function(p){if(p.key){var v=I5[p.key]||p.key;if(v!=="Unidentified")return v}return p.type==="keypress"?(p=Im(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?Bg[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bm,charCode:function(p){return p.type==="keypress"?Im(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?Im(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),da=Xo(Hp),k5=pt({},Uc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$p=Xo(k5),f9=pt({},G0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bm}),m9=Xo(f9),Aa=pt({},Cd,{propertyName:0,elapsedTime:0,pseudoElement:0}),g9=Xo(Aa),D5=pt({},Uc,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),y9=Xo(D5),v9=[9,13,27,32],Ug=l&&"CompositionEvent"in window,Ws=null;l&&"documentMode"in document&&(Ws=document.documentMode);var Ph=l&&"TextEvent"in window&&!Ws,H0=l&&(!Ug||Ws&&8<Ws&&11>=Ws),zc=" ",zg=!1;function Di(p,v){switch(p){case"keyup":return v9.indexOf(v.keyCode)!==-1;case"keydown":return v.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Nd(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var Rh=!1;function Ih(p,v){switch(p){case"compositionend":return Nd(v);case"keypress":return v.which!==32?null:(zg=!0,zc);case"textInput":return p=v.data,p===zc&&zg?null:p;default:return null}}function Wp(p,v){if(Rh)return p==="compositionend"||!Ug&&Di(p,v)?(p=Lg(),Nh=Rm=Lc=null,Rh=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(v.ctrlKey||v.altKey||v.metaKey)||v.ctrlKey&&v.altKey){if(v.char&&1<v.char.length)return v.char;if(v.which)return String.fromCharCode(v.which)}return null;case"compositionend":return H0&&v.locale!=="ko"?null:v.data;default:return null}}var x9={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vg(p){var v=p&&p.nodeName&&p.nodeName.toLowerCase();return v==="input"?!!x9[p.type]:v==="textarea"}function kh(p,v,E,L){jt(L),v=Xg(v,"onChange"),0<v.length&&(E=new Il("onChange","change",null,E,L),p.push({event:E,listeners:v}))}var $0=null,Pd=null;function O5(p){qg(p,0)}function Vc(p){var v=Id(p);if(ns(v))return p}function Um(p,v){if(p==="change")return v}var b9=!1;if(l){var le;if(l){var Ee="oninput"in document;if(!Ee){var tt=document.createElement("div");tt.setAttribute("oninput","return;"),Ee=typeof tt.oninput=="function"}le=Ee}else le=!1;b9=le&&(!document.documentMode||9<document.documentMode)}function Ft(){$0&&($0.detachEvent("onpropertychange",kr),Pd=$0=null)}function kr(p){if(p.propertyName==="value"&&Vc(Pd)){var v=[];kh(v,Pd,p,et(p)),Ls(O5,v)}}function zi(p,v,E){p==="focusin"?(Ft(),$0=v,Pd=E,$0.attachEvent("onpropertychange",kr)):p==="focusout"&&Ft()}function Na(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return Vc(Pd)}function h0(p,v){if(p==="click")return Vc(v)}function qp(p,v){if(p==="input"||p==="change")return Vc(v)}function Pu(p,v){return p===v&&(p!==0||1/p===1/v)||p!==p&&v!==v}var Pa=typeof Object.is=="function"?Object.is:Pu;function Gc(p,v){if(Pa(p,v))return!0;if(typeof p!="object"||p===null||typeof v!="object"||v===null)return!1;var E=Object.keys(p),L=Object.keys(v);if(E.length!==L.length)return!1;for(L=0;L<E.length;L++){var q=E[L];if(!c.call(v,q)||!Pa(p[q],v[q]))return!1}return!0}function zm(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function Tx(p,v){var E=zm(p);p=0;for(var L;E;){if(E.nodeType===3){if(L=p+E.textContent.length,p<=v&&L>=v)return{node:E,offset:v-p};p=L}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=zm(E)}}function _9(p,v){return p&&v?p===v?!0:p&&p.nodeType===3?!1:v&&v.nodeType===3?_9(p,v.parentNode):"contains"in p?p.contains(v):p.compareDocumentPosition?!!(p.compareDocumentPosition(v)&16):!1:!1}function Ex(){for(var p=window,v=Xr();v instanceof p.HTMLIFrameElement;){try{var E=typeof v.contentWindow.location.href=="string"}catch{E=!1}if(E)p=v.contentWindow;else break;v=Xr(p.document)}return v}function L5(p){var v=p&&p.nodeName&&p.nodeName.toLowerCase();return v&&(v==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||v==="textarea"||p.contentEditable==="true")}function Mx(p){var v=Ex(),E=p.focusedElem,L=p.selectionRange;if(v!==E&&E&&E.ownerDocument&&_9(E.ownerDocument.documentElement,E)){if(L!==null&&L5(E)){if(v=L.start,p=L.end,p===void 0&&(p=v),"selectionStart"in E)E.selectionStart=v,E.selectionEnd=Math.min(p,E.value.length);else if(p=(v=E.ownerDocument||document)&&v.defaultView||window,p.getSelection){p=p.getSelection();var q=E.textContent.length,ee=Math.min(L.start,q);L=L.end===void 0?ee:Math.min(L.end,q),!p.extend&&ee>L&&(q=L,L=ee,ee=q),q=Tx(E,ee);var pe=Tx(E,L);q&&pe&&(p.rangeCount!==1||p.anchorNode!==q.node||p.anchorOffset!==q.offset||p.focusNode!==pe.node||p.focusOffset!==pe.offset)&&(v=v.createRange(),v.setStart(q.node,q.offset),p.removeAllRanges(),ee>L?(p.addRange(v),p.extend(pe.node,pe.offset)):(v.setEnd(pe.node,pe.offset),p.addRange(v)))}}for(v=[],p=E;p=p.parentNode;)p.nodeType===1&&v.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<v.length;E++)p=v[E],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var S9=l&&"documentMode"in document&&11>=document.documentMode,jc=null,F5=null,Vm=null,Gg=!1;function Cx(p,v,E){var L=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;Gg||jc==null||jc!==Xr(L)||(L=jc,"selectionStart"in L&&L5(L)?L={start:L.selectionStart,end:L.selectionEnd}:(L=(L.ownerDocument&&L.ownerDocument.defaultView||window).getSelection(),L={anchorNode:L.anchorNode,anchorOffset:L.anchorOffset,focusNode:L.focusNode,focusOffset:L.focusOffset}),Vm&&Gc(Vm,L)||(Vm=L,L=Xg(F5,"onSelect"),0<L.length&&(v=new Il("onSelect","select",null,v,E),p.push({event:v,listeners:L}),v.target=jc)))}function Gm(p,v){var E={};return E[p.toLowerCase()]=v.toLowerCase(),E["Webkit"+p]="webkit"+v,E["Moz"+p]="moz"+v,E}var Dh={animationend:Gm("Animation","AnimationEnd"),animationiteration:Gm("Animation","AnimationIteration"),animationstart:Gm("Animation","AnimationStart"),transitionend:Gm("Transition","TransitionEnd")},B5={},jm={};l&&(jm=document.createElement("div").style,"AnimationEvent"in window||(delete Dh.animationend.animation,delete Dh.animationiteration.animation,delete Dh.animationstart.animation),"TransitionEvent"in window||delete Dh.transitionend.transition);function jg(p){if(B5[p])return B5[p];if(!Dh[p])return p;var v=Dh[p],E;for(E in v)if(v.hasOwnProperty(E)&&E in jm)return B5[p]=v[E];return p}var U5=jg("animationend"),z5=jg("animationiteration"),Hg=jg("animationstart"),$g=jg("transitionend"),V5=new Map,G5="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Oh(p,v){V5.set(p,v),i(v,[p])}for(var Wg=0;Wg<G5.length;Wg++){var Hm=G5[Wg],Ax=Hm.toLowerCase(),j5=Hm[0].toUpperCase()+Hm.slice(1);Oh(Ax,"on"+j5)}Oh(U5,"onAnimationEnd"),Oh(z5,"onAnimationIteration"),Oh(Hg,"onAnimationStart"),Oh("dblclick","onDoubleClick"),Oh("focusin","onFocus"),Oh("focusout","onBlur"),Oh($g,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),H5=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xp));function $m(p,v,E){var L=p.type||"unknown-event";p.currentTarget=E,Th(L,v,void 0,p),p.currentTarget=null}function qg(p,v){v=(v&4)!==0;for(var E=0;E<p.length;E++){var L=p[E],q=L.event;L=L.listeners;e:{var ee=void 0;if(v)for(var pe=L.length-1;0<=pe;pe--){var Fe=L[pe],Ze=Fe.instance,It=Fe.currentTarget;if(Fe=Fe.listener,Ze!==ee&&q.isPropagationStopped())break e;$m(q,Fe,It),ee=Ze}else for(pe=0;pe<L.length;pe++){if(Fe=L[pe],Ze=Fe.instance,It=Fe.currentTarget,Fe=Fe.listener,Ze!==ee&&q.isPropagationStopped())break e;$m(q,Fe,It),ee=Ze}}}if(Pl)throw p=cl,Pl=!1,cl=null,p}function Fs(p,v){var E=v[Zp];E===void 0&&(E=v[Zp]=new Set);var L=p+"__bubble";E.has(L)||($5(v,p,2,!1),E.add(L))}function w9(p,v,E){var L=0;v&&(L|=4),$5(E,p,L,v)}var Lh="_reactListening"+Math.random().toString(36).slice(2);function Wm(p){if(!p[Lh]){p[Lh]=!0,n.forEach(function(E){E!=="selectionchange"&&(H5.has(E)||w9(E,!1,p),w9(E,!0,p))});var v=p.nodeType===9?p:p.ownerDocument;v===null||v[Lh]||(v[Lh]=!0,w9("selectionchange",!1,v))}}function $5(p,v,E,L){switch(Og(v)){case 1:var q=Dg;break;case 4:q=u9;break;default:q=Am}E=q.bind(null,v,E,p),q=void 0,!Sd||v!=="touchstart"&&v!=="touchmove"&&v!=="wheel"||(q=!0),L?q!==void 0?p.addEventListener(v,E,{capture:!0,passive:q}):p.addEventListener(v,E,!0):q!==void 0?p.addEventListener(v,E,{passive:q}):p.addEventListener(v,E,!1)}function T9(p,v,E,L,q){var ee=L;if((v&1)===0&&(v&2)===0&&L!==null)e:for(;;){if(L===null)return;var pe=L.tag;if(pe===3||pe===4){var Fe=L.stateNode.containerInfo;if(Fe===q||Fe.nodeType===8&&Fe.parentNode===q)break;if(pe===4)for(pe=L.return;pe!==null;){var Ze=pe.tag;if((Ze===3||Ze===4)&&(Ze=pe.stateNode.containerInfo,Ze===q||Ze.nodeType===8&&Ze.parentNode===q))return;pe=pe.return}for(;Fe!==null;){if(pe=W0(Fe),pe===null)return;if(Ze=pe.tag,Ze===5||Ze===6){L=ee=pe;continue e}Fe=Fe.parentNode}}L=L.return}Ls(function(){var It=ee,on=et(E),fn=[];e:{var sn=V5.get(p);if(sn!==void 0){var Xn=Il,nr=p;switch(p){case"keypress":if(Im(E)===0)break e;case"keydown":case"keyup":Xn=da;break;case"focusin":nr="focus",Xn=j0;break;case"focusout":nr="blur",Xn=j0;break;case"beforeblur":case"afterblur":Xn=j0;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Xn=bo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Xn=Dm;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Xn=m9;break;case U5:case z5:case Hg:Xn=h9;break;case $g:Xn=g9;break;case"scroll":Xn=Vp;break;case"wheel":Xn=y9;break;case"copy":case"cut":case"paste":Xn=Fg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Xn=$p}var ur=(v&4)!==0,ao=!ur&&p==="scroll",_t=ur?sn!==null?sn+"Capture":null:sn;ur=[];for(var lt=It,Ct;lt!==null;){Ct=lt;var Sn=Ct.stateNode;if(Ct.tag===5&&Sn!==null&&(Ct=Sn,_t!==null&&(Sn=la(lt,_t),Sn!=null&&ur.push(qm(lt,Sn,Ct)))),ao)break;lt=lt.return}0<ur.length&&(sn=new Xn(sn,nr,null,E,on),fn.push({event:sn,listeners:ur}))}}if((v&7)===0){e:{if(sn=p==="mouseover"||p==="pointerover",Xn=p==="mouseout"||p==="pointerout",sn&&E!==Cr&&(nr=E.relatedTarget||E.fromElement)&&(W0(nr)||nr[kl]))break e;if((Xn||sn)&&(sn=on.window===on?on:(sn=on.ownerDocument)?sn.defaultView||sn.parentWindow:window,Xn?(nr=E.relatedTarget||E.toElement,Xn=It,nr=nr?W0(nr):null,nr!==null&&(ao=$o(nr),nr!==ao||nr.tag!==5&&nr.tag!==6)&&(nr=null)):(Xn=null,nr=It),Xn!==nr)){if(ur=bo,Sn="onMouseLeave",_t="onMouseEnter",lt="mouse",(p==="pointerout"||p==="pointerover")&&(ur=$p,Sn="onPointerLeave",_t="onPointerEnter",lt="pointer"),ao=Xn==null?sn:Id(Xn),Ct=nr==null?sn:Id(nr),sn=new ur(Sn,lt+"leave",Xn,E,on),sn.target=ao,sn.relatedTarget=Ct,Sn=null,W0(on)===It&&(ur=new ur(_t,lt+"enter",nr,E,on),ur.target=Ct,ur.relatedTarget=ao,Sn=ur),ao=Sn,Xn&&nr)t:{for(ur=Xn,_t=nr,lt=0,Ct=ur;Ct;Ct=Yp(Ct))lt++;for(Ct=0,Sn=_t;Sn;Sn=Yp(Sn))Ct++;for(;0<lt-Ct;)ur=Yp(ur),lt--;for(;0<Ct-lt;)_t=Yp(_t),Ct--;for(;lt--;){if(ur===_t||_t!==null&&ur===_t.alternate)break t;ur=Yp(ur),_t=Yp(_t)}ur=null}else ur=null;Xn!==null&&W5(fn,sn,Xn,ur,!1),nr!==null&&ao!==null&&W5(fn,ao,nr,ur,!0)}}e:{if(sn=It?Id(It):window,Xn=sn.nodeName&&sn.nodeName.toLowerCase(),Xn==="select"||Xn==="input"&&sn.type==="file")var vr=Um;else if(Vg(sn))if(b9)vr=qp;else{vr=Na;var Rr=zi}else(Xn=sn.nodeName)&&Xn.toLowerCase()==="input"&&(sn.type==="checkbox"||sn.type==="radio")&&(vr=h0);if(vr&&(vr=vr(p,It))){kh(fn,vr,E,on);break e}Rr&&Rr(p,sn,It),p==="focusout"&&(Rr=sn._wrapperState)&&Rr.controlled&&sn.type==="number"&&_s(sn,"number",sn.value)}switch(Rr=It?Id(It):window,p){case"focusin":(Vg(Rr)||Rr.contentEditable==="true")&&(jc=Rr,F5=It,Vm=null);break;case"focusout":Vm=F5=jc=null;break;case"mousedown":Gg=!0;break;case"contextmenu":case"mouseup":case"dragend":Gg=!1,Cx(fn,E,on);break;case"selectionchange":if(S9)break;case"keydown":case"keyup":Cx(fn,E,on)}var Dr;if(Ug)e:{switch(p){case"compositionstart":var jr="onCompositionStart";break e;case"compositionend":jr="onCompositionEnd";break e;case"compositionupdate":jr="onCompositionUpdate";break e}jr=void 0}else Rh?Di(p,E)&&(jr="onCompositionEnd"):p==="keydown"&&E.keyCode===229&&(jr="onCompositionStart");jr&&(H0&&E.locale!=="ko"&&(Rh||jr!=="onCompositionStart"?jr==="onCompositionEnd"&&Rh&&(Dr=Lg()):(Lc=on,Rm="value"in Lc?Lc.value:Lc.textContent,Rh=!0)),Rr=Xg(It,jr),0<Rr.length&&(jr=new Om(jr,p,null,E,on),fn.push({event:jr,listeners:Rr}),Dr?jr.data=Dr:(Dr=Nd(E),Dr!==null&&(jr.data=Dr)))),(Dr=Ph?Ih(p,E):Wp(p,E))&&(It=Xg(It,"onBeforeInput"),0<It.length&&(on=new Om("onBeforeInput","beforeinput",null,E,on),fn.push({event:on,listeners:It}),on.data=Dr))}qg(fn,v)})}function qm(p,v,E){return{instance:p,listener:v,currentTarget:E}}function Xg(p,v){for(var E=v+"Capture",L=[];p!==null;){var q=p,ee=q.stateNode;q.tag===5&&ee!==null&&(q=ee,ee=la(p,E),ee!=null&&L.unshift(qm(p,ee,q)),ee=la(p,v),ee!=null&&L.push(qm(p,ee,q))),p=p.return}return L}function Yp(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function W5(p,v,E,L,q){for(var ee=v._reactName,pe=[];E!==null&&E!==L;){var Fe=E,Ze=Fe.alternate,It=Fe.stateNode;if(Ze!==null&&Ze===L)break;Fe.tag===5&&It!==null&&(Fe=It,q?(Ze=la(E,ee),Ze!=null&&pe.unshift(qm(E,Ze,Fe))):q||(Ze=la(E,ee),Ze!=null&&pe.push(qm(E,Ze,Fe)))),E=E.return}pe.length!==0&&p.push({event:v,listeners:pe})}var Nx=/\r\n?/g,Px=/\u0000|\uFFFD/g;function q5(p){return(typeof p=="string"?p:""+p).replace(Nx,`
`).replace(Px,"")}function Yg(p,v,E){if(v=q5(v),q5(p)!==v&&E)throw Error(t(425))}function Kg(){}var E9=null,M9=null;function C9(p,v){return p==="textarea"||p==="noscript"||typeof v.children=="string"||typeof v.children=="number"||typeof v.dangerouslySetInnerHTML=="object"&&v.dangerouslySetInnerHTML!==null&&v.dangerouslySetInnerHTML.__html!=null}var A9=typeof setTimeout=="function"?setTimeout:void 0,Rx=typeof clearTimeout=="function"?clearTimeout:void 0,X5=typeof Promise=="function"?Promise:void 0,Ix=typeof queueMicrotask=="function"?queueMicrotask:typeof X5<"u"?function(p){return X5.resolve(null).then(p).catch(kx)}:A9;function kx(p){setTimeout(function(){throw p})}function N9(p,v){var E=v,L=0;do{var q=E.nextSibling;if(p.removeChild(E),q&&q.nodeType===8)if(E=q.data,E==="/$"){if(L===0){p.removeChild(q),Ah(v);return}L--}else E!=="$"&&E!=="$?"&&E!=="$!"||L++;E=q}while(E);Ah(v)}function Rd(p){for(;p!=null;p=p.nextSibling){var v=p.nodeType;if(v===1||v===3)break;if(v===8){if(v=p.data,v==="$"||v==="$!"||v==="$?")break;if(v==="/$")return null}}return p}function Ss(p){p=p.previousSibling;for(var v=0;p;){if(p.nodeType===8){var E=p.data;if(E==="$"||E==="$!"||E==="$?"){if(v===0)return p;v--}else E==="/$"&&v++}p=p.previousSibling}return null}var Kp=Math.random().toString(36).slice(2),Oi="__reactFiber$"+Kp,Zg="__reactProps$"+Kp,kl="__reactContainer$"+Kp,Zp="__reactEvents$"+Kp,Qg="__reactListeners$"+Kp,Qp="__reactHandles$"+Kp;function W0(p){var v=p[Oi];if(v)return v;for(var E=p.parentNode;E;){if(v=E[kl]||E[Oi]){if(E=v.alternate,v.child!==null||E!==null&&E.child!==null)for(p=Ss(p);p!==null;){if(E=p[Oi])return E;p=Ss(p)}return v}p=E,E=p.parentNode}return null}function Fh(p){return p=p[Oi]||p[kl],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Id(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(t(33))}function Ru(p){return p[Zg]||null}var Iu=[],kd=-1;function Dd(p){return{current:p}}function ps(p){0>kd||(p.current=Iu[kd],Iu[kd]=null,kd--)}function ws(p,v){kd++,Iu[kd]=p.current,p.current=v}var Bh={},Ra=Dd(Bh),qa=Dd(!1),Od=Bh;function Uh(p,v){var E=p.type.contextTypes;if(!E)return Bh;var L=p.stateNode;if(L&&L.__reactInternalMemoizedUnmaskedChildContext===v)return L.__reactInternalMemoizedMaskedChildContext;var q={},ee;for(ee in E)q[ee]=v[ee];return L&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=v,p.__reactInternalMemoizedMaskedChildContext=q),q}function Dl(p){return p=p.childContextTypes,p!=null}function Xm(){ps(qa),ps(Ra)}function Y5(p,v,E){if(Ra.current!==Bh)throw Error(t(168));ws(Ra,v),ws(qa,E)}function K5(p,v,E){var L=p.stateNode;if(v=v.childContextTypes,typeof L.getChildContext!="function")return E;L=L.getChildContext();for(var q in L)if(!(q in v))throw Error(t(108,Ut(p)||"Unknown",q));return pt({},E,L)}function Jg(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Bh,Od=Ra.current,ws(Ra,p),ws(qa,qa.current),!0}function Dx(p,v,E){var L=p.stateNode;if(!L)throw Error(t(169));E?(p=K5(p,v,Od),L.__reactInternalMemoizedMergedChildContext=p,ps(qa),ps(Ra),ws(Ra,p)):ps(qa),ws(qa,E)}var Ld=null,Fd=!1,P9=!1;function Z5(p){Ld===null?Ld=[p]:Ld.push(p)}function Lw(p){Fd=!0,Z5(p)}function zh(){if(!P9&&Ld!==null){P9=!0;var p=0,v=Ur;try{var E=Ld;for(Ur=1;p<E.length;p++){var L=E[p];do L=L(!0);while(L!==null)}Ld=null,Fd=!1}catch(q){throw Ld!==null&&(Ld=Ld.slice(p+1)),Sm(At,zh),q}finally{Ur=v,P9=!1}}return null}var Hc=[],ku=0,R9=null,Jp=0,q0=[],p0=0,Vh=null,X0=1,Du="";function ef(p,v){Hc[ku++]=Jp,Hc[ku++]=R9,R9=p,Jp=v}function Ox(p,v,E){q0[p0++]=X0,q0[p0++]=Du,q0[p0++]=Vh,Vh=p;var L=X0;p=Du;var q=32-yr(L)-1;L&=~(1<<q),E+=1;var ee=32-yr(v)+q;if(30<ee){var pe=q-q%5;ee=(L&(1<<pe)-1).toString(32),L>>=pe,q-=pe,X0=1<<32-yr(v)+q|E<<q|L,Du=ee+p}else X0=1<<ee|E<<q|L,Du=p}function tf(p){p.return!==null&&(ef(p,1),Ox(p,1,0))}function e2(p){for(;p===R9;)R9=Hc[--ku],Hc[ku]=null,Jp=Hc[--ku],Hc[ku]=null;for(;p===Vh;)Vh=q0[--p0],q0[p0]=null,Du=q0[--p0],q0[p0]=null,X0=q0[--p0],q0[p0]=null}var f0=null,Ol=null,Bs=!1,Ll=null;function t2(p,v){var E=Q0(5,null,null,0);E.elementType="DELETED",E.stateNode=v,E.return=p,v=p.deletions,v===null?(p.deletions=[E],p.flags|=16):v.push(E)}function Q5(p,v){switch(p.tag){case 5:var E=p.type;return v=v.nodeType!==1||E.toLowerCase()!==v.nodeName.toLowerCase()?null:v,v!==null?(p.stateNode=v,f0=p,Ol=Rd(v.firstChild),!0):!1;case 6:return v=p.pendingProps===""||v.nodeType!==3?null:v,v!==null?(p.stateNode=v,f0=p,Ol=null,!0):!1;case 13:return v=v.nodeType!==8?null:v,v!==null?(E=Vh!==null?{id:X0,overflow:Du}:null,p.memoizedState={dehydrated:v,treeContext:E,retryLane:1073741824},E=Q0(18,null,null,0),E.stateNode=v,E.return=p,p.child=E,f0=p,Ol=null,!0):!1;default:return!1}}function Gh(p){return(p.mode&1)!==0&&(p.flags&128)===0}function Ym(p){if(Bs){var v=Ol;if(v){var E=v;if(!Q5(p,v)){if(Gh(p))throw Error(t(418));v=Rd(E.nextSibling);var L=f0;v&&Q5(p,v)?t2(L,E):(p.flags=p.flags&-4097|2,Bs=!1,f0=p)}}else{if(Gh(p))throw Error(t(418));p.flags=p.flags&-4097|2,Bs=!1,f0=p}}}function Lx(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;f0=p}function n2(p){if(p!==f0)return!1;if(!Bs)return Lx(p),Bs=!0,!1;var v;if((v=p.tag!==3)&&!(v=p.tag!==5)&&(v=p.type,v=v!=="head"&&v!=="body"&&!C9(p.type,p.memoizedProps)),v&&(v=Ol)){if(Gh(p))throw Fx(),Error(t(418));for(;v;)t2(p,v),v=Rd(v.nextSibling)}if(Lx(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(t(317));e:{for(p=p.nextSibling,v=0;p;){if(p.nodeType===8){var E=p.data;if(E==="/$"){if(v===0){Ol=Rd(p.nextSibling);break e}v--}else E!=="$"&&E!=="$!"&&E!=="$?"||v++}p=p.nextSibling}Ol=null}}else Ol=f0?Rd(p.stateNode.nextSibling):null;return!0}function Fx(){for(var p=Ol;p;)p=Rd(p.nextSibling)}function Km(){Ol=f0=null,Bs=!1}function I9(p){Ll===null?Ll=[p]:Ll.push(p)}var Fw=C.ReactCurrentBatchConfig;function r2(p,v,E){if(p=E.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(E._owner){if(E=E._owner,E){if(E.tag!==1)throw Error(t(309));var L=E.stateNode}if(!L)throw Error(t(147,p));var q=L,ee=""+p;return v!==null&&v.ref!==null&&typeof v.ref=="function"&&v.ref._stringRef===ee?v.ref:(v=function(pe){var Fe=q.refs;pe===null?delete Fe[ee]:Fe[ee]=pe},v._stringRef=ee,v)}if(typeof p!="string")throw Error(t(284));if(!E._owner)throw Error(t(290,p))}return p}function i2(p,v){throw p=Object.prototype.toString.call(v),Error(t(31,p==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":p))}function s2(p){var v=p._init;return v(p._payload)}function J5(p){function v(_t,lt){if(p){var Ct=_t.deletions;Ct===null?(_t.deletions=[lt],_t.flags|=16):Ct.push(lt)}}function E(_t,lt){if(!p)return null;for(;lt!==null;)v(_t,lt),lt=lt.sibling;return null}function L(_t,lt){for(_t=new Map;lt!==null;)lt.key!==null?_t.set(lt.key,lt):_t.set(lt.index,lt),lt=lt.sibling;return _t}function q(_t,lt){return _t=ju(_t,lt),_t.index=0,_t.sibling=null,_t}function ee(_t,lt,Ct){return _t.index=Ct,p?(Ct=_t.alternate,Ct!==null?(Ct=Ct.index,Ct<lt?(_t.flags|=2,lt):Ct):(_t.flags|=2,lt)):(_t.flags|=1048576,lt)}function pe(_t){return p&&_t.alternate===null&&(_t.flags|=2),_t}function Fe(_t,lt,Ct,Sn){return lt===null||lt.tag!==6?(lt=Wv(Ct,_t.mode,Sn),lt.return=_t,lt):(lt=q(lt,Ct),lt.return=_t,lt)}function Ze(_t,lt,Ct,Sn){var vr=Ct.type;return vr===se?on(_t,lt,Ct.props.children,Sn,Ct.key):lt!==null&&(lt.elementType===vr||typeof vr=="object"&&vr!==null&&vr.$$typeof===ce&&s2(vr)===lt.type)?(Sn=q(lt,Ct.props),Sn.ref=r2(_t,lt,Ct),Sn.return=_t,Sn):(Sn=x4(Ct.type,Ct.key,Ct.props,null,_t.mode,Sn),Sn.ref=r2(_t,lt,Ct),Sn.return=_t,Sn)}function It(_t,lt,Ct,Sn){return lt===null||lt.tag!==4||lt.stateNode.containerInfo!==Ct.containerInfo||lt.stateNode.implementation!==Ct.implementation?(lt=qv(Ct,_t.mode,Sn),lt.return=_t,lt):(lt=q(lt,Ct.children||[]),lt.return=_t,lt)}function on(_t,lt,Ct,Sn,vr){return lt===null||lt.tag!==7?(lt=df(Ct,_t.mode,Sn,vr),lt.return=_t,lt):(lt=q(lt,Ct),lt.return=_t,lt)}function fn(_t,lt,Ct){if(typeof lt=="string"&&lt!==""||typeof lt=="number")return lt=Wv(""+lt,_t.mode,Ct),lt.return=_t,lt;if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case Z:return Ct=x4(lt.type,lt.key,lt.props,null,_t.mode,Ct),Ct.ref=r2(_t,null,lt),Ct.return=_t,Ct;case ie:return lt=qv(lt,_t.mode,Ct),lt.return=_t,lt;case ce:var Sn=lt._init;return fn(_t,Sn(lt._payload),Ct)}if(ui(lt)||We(lt))return lt=df(lt,_t.mode,Ct,null),lt.return=_t,lt;i2(_t,lt)}return null}function sn(_t,lt,Ct,Sn){var vr=lt!==null?lt.key:null;if(typeof Ct=="string"&&Ct!==""||typeof Ct=="number")return vr!==null?null:Fe(_t,lt,""+Ct,Sn);if(typeof Ct=="object"&&Ct!==null){switch(Ct.$$typeof){case Z:return Ct.key===vr?Ze(_t,lt,Ct,Sn):null;case ie:return Ct.key===vr?It(_t,lt,Ct,Sn):null;case ce:return vr=Ct._init,sn(_t,lt,vr(Ct._payload),Sn)}if(ui(Ct)||We(Ct))return vr!==null?null:on(_t,lt,Ct,Sn,null);i2(_t,Ct)}return null}function Xn(_t,lt,Ct,Sn,vr){if(typeof Sn=="string"&&Sn!==""||typeof Sn=="number")return _t=_t.get(Ct)||null,Fe(lt,_t,""+Sn,vr);if(typeof Sn=="object"&&Sn!==null){switch(Sn.$$typeof){case Z:return _t=_t.get(Sn.key===null?Ct:Sn.key)||null,Ze(lt,_t,Sn,vr);case ie:return _t=_t.get(Sn.key===null?Ct:Sn.key)||null,It(lt,_t,Sn,vr);case ce:var Rr=Sn._init;return Xn(_t,lt,Ct,Rr(Sn._payload),vr)}if(ui(Sn)||We(Sn))return _t=_t.get(Ct)||null,on(lt,_t,Sn,vr,null);i2(lt,Sn)}return null}function nr(_t,lt,Ct,Sn){for(var vr=null,Rr=null,Dr=lt,jr=lt=0,Ko=null;Dr!==null&&jr<Ct.length;jr++){Dr.index>jr?(Ko=Dr,Dr=null):Ko=Dr.sibling;var Gi=sn(_t,Dr,Ct[jr],Sn);if(Gi===null){Dr===null&&(Dr=Ko);break}p&&Dr&&Gi.alternate===null&&v(_t,Dr),lt=ee(Gi,lt,jr),Rr===null?vr=Gi:Rr.sibling=Gi,Rr=Gi,Dr=Ko}if(jr===Ct.length)return E(_t,Dr),Bs&&ef(_t,jr),vr;if(Dr===null){for(;jr<Ct.length;jr++)Dr=fn(_t,Ct[jr],Sn),Dr!==null&&(lt=ee(Dr,lt,jr),Rr===null?vr=Dr:Rr.sibling=Dr,Rr=Dr);return Bs&&ef(_t,jr),vr}for(Dr=L(_t,Dr);jr<Ct.length;jr++)Ko=Xn(Dr,_t,jr,Ct[jr],Sn),Ko!==null&&(p&&Ko.alternate!==null&&Dr.delete(Ko.key===null?jr:Ko.key),lt=ee(Ko,lt,jr),Rr===null?vr=Ko:Rr.sibling=Ko,Rr=Ko);return p&&Dr.forEach(function(Hu){return v(_t,Hu)}),Bs&&ef(_t,jr),vr}function ur(_t,lt,Ct,Sn){var vr=We(Ct);if(typeof vr!="function")throw Error(t(150));if(Ct=vr.call(Ct),Ct==null)throw Error(t(151));for(var Rr=vr=null,Dr=lt,jr=lt=0,Ko=null,Gi=Ct.next();Dr!==null&&!Gi.done;jr++,Gi=Ct.next()){Dr.index>jr?(Ko=Dr,Dr=null):Ko=Dr.sibling;var Hu=sn(_t,Dr,Gi.value,Sn);if(Hu===null){Dr===null&&(Dr=Ko);break}p&&Dr&&Hu.alternate===null&&v(_t,Dr),lt=ee(Hu,lt,jr),Rr===null?vr=Hu:Rr.sibling=Hu,Rr=Hu,Dr=Ko}if(Gi.done)return E(_t,Dr),Bs&&ef(_t,jr),vr;if(Dr===null){for(;!Gi.done;jr++,Gi=Ct.next())Gi=fn(_t,Gi.value,Sn),Gi!==null&&(lt=ee(Gi,lt,jr),Rr===null?vr=Gi:Rr.sibling=Gi,Rr=Gi);return Bs&&ef(_t,jr),vr}for(Dr=L(_t,Dr);!Gi.done;jr++,Gi=Ct.next())Gi=Xn(Dr,_t,jr,Gi.value,Sn),Gi!==null&&(p&&Gi.alternate!==null&&Dr.delete(Gi.key===null?jr:Gi.key),lt=ee(Gi,lt,jr),Rr===null?vr=Gi:Rr.sibling=Gi,Rr=Gi);return p&&Dr.forEach(function(u7){return v(_t,u7)}),Bs&&ef(_t,jr),vr}function ao(_t,lt,Ct,Sn){if(typeof Ct=="object"&&Ct!==null&&Ct.type===se&&Ct.key===null&&(Ct=Ct.props.children),typeof Ct=="object"&&Ct!==null){switch(Ct.$$typeof){case Z:e:{for(var vr=Ct.key,Rr=lt;Rr!==null;){if(Rr.key===vr){if(vr=Ct.type,vr===se){if(Rr.tag===7){E(_t,Rr.sibling),lt=q(Rr,Ct.props.children),lt.return=_t,_t=lt;break e}}else if(Rr.elementType===vr||typeof vr=="object"&&vr!==null&&vr.$$typeof===ce&&s2(vr)===Rr.type){E(_t,Rr.sibling),lt=q(Rr,Ct.props),lt.ref=r2(_t,Rr,Ct),lt.return=_t,_t=lt;break e}E(_t,Rr);break}else v(_t,Rr);Rr=Rr.sibling}Ct.type===se?(lt=df(Ct.props.children,_t.mode,Sn,Ct.key),lt.return=_t,_t=lt):(Sn=x4(Ct.type,Ct.key,Ct.props,null,_t.mode,Sn),Sn.ref=r2(_t,lt,Ct),Sn.return=_t,_t=Sn)}return pe(_t);case ie:e:{for(Rr=Ct.key;lt!==null;){if(lt.key===Rr)if(lt.tag===4&&lt.stateNode.containerInfo===Ct.containerInfo&&lt.stateNode.implementation===Ct.implementation){E(_t,lt.sibling),lt=q(lt,Ct.children||[]),lt.return=_t,_t=lt;break e}else{E(_t,lt);break}else v(_t,lt);lt=lt.sibling}lt=qv(Ct,_t.mode,Sn),lt.return=_t,_t=lt}return pe(_t);case ce:return Rr=Ct._init,ao(_t,lt,Rr(Ct._payload),Sn)}if(ui(Ct))return nr(_t,lt,Ct,Sn);if(We(Ct))return ur(_t,lt,Ct,Sn);i2(_t,Ct)}return typeof Ct=="string"&&Ct!==""||typeof Ct=="number"?(Ct=""+Ct,lt!==null&&lt.tag===6?(E(_t,lt.sibling),lt=q(lt,Ct),lt.return=_t,_t=lt):(E(_t,lt),lt=Wv(Ct,_t.mode,Sn),lt.return=_t,_t=lt),pe(_t)):E(_t,lt)}return ao}var nf=J5(!0),ev=J5(!1),k9=Dd(null),o2=null,rf=null,D9=null;function tv(){D9=rf=o2=null}function nv(p){var v=k9.current;ps(k9),p._currentValue=v}function Zm(p,v,E){for(;p!==null;){var L=p.alternate;if((p.childLanes&v)!==v?(p.childLanes|=v,L!==null&&(L.childLanes|=v)):L!==null&&(L.childLanes&v)!==v&&(L.childLanes|=v),p===E)break;p=p.return}}function Bd(p,v){o2=p,D9=rf=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&v)!==0&&(Fl=!0),p.firstContext=null)}function Y0(p){var v=p._currentValue;if(D9!==p)if(p={context:p,memoizedValue:v,next:null},rf===null){if(o2===null)throw Error(t(308));rf=p,o2.dependencies={lanes:0,firstContext:p}}else rf=rf.next=p;return v}var m0=null;function Qm(p){m0===null?m0=[p]:m0.push(p)}function rv(p,v,E,L){var q=v.interleaved;return q===null?(E.next=E,Qm(v)):(E.next=q.next,q.next=E),v.interleaved=E,Ud(p,L)}function Ud(p,v){p.lanes|=v;var E=p.alternate;for(E!==null&&(E.lanes|=v),E=p,p=p.return;p!==null;)p.childLanes|=v,E=p.alternate,E!==null&&(E.childLanes|=v),E=p,p=p.return;return E.tag===3?E.stateNode:null}var Ou=!1;function O9(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Bx(p,v){p=p.updateQueue,v.updateQueue===p&&(v.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function g0(p,v){return{eventTime:p,lane:v,tag:0,payload:null,callback:null,next:null}}function $c(p,v,E){var L=p.updateQueue;if(L===null)return null;if(L=L.shared,(Vi&2)!==0){var q=L.pending;return q===null?v.next=v:(v.next=q.next,q.next=v),L.pending=v,Ud(p,E)}return q=L.interleaved,q===null?(v.next=v,Qm(L)):(v.next=q.next,q.next=v),L.interleaved=v,Ud(p,E)}function L9(p,v,E){if(v=v.updateQueue,v!==null&&(v=v.shared,(E&4194240)!==0)){var L=v.lanes;L&=p.pendingLanes,E|=L,v.lanes=E,Ai(p,E)}}function iv(p,v){var E=p.updateQueue,L=p.alternate;if(L!==null&&(L=L.updateQueue,E===L)){var q=null,ee=null;if(E=E.firstBaseUpdate,E!==null){do{var pe={eventTime:E.eventTime,lane:E.lane,tag:E.tag,payload:E.payload,callback:E.callback,next:null};ee===null?q=ee=pe:ee=ee.next=pe,E=E.next}while(E!==null);ee===null?q=ee=v:ee=ee.next=v}else q=ee=v;E={baseState:L.baseState,firstBaseUpdate:q,lastBaseUpdate:ee,shared:L.shared,effects:L.effects},p.updateQueue=E;return}p=E.lastBaseUpdate,p===null?E.firstBaseUpdate=v:p.next=v,E.lastBaseUpdate=v}function a2(p,v,E,L){var q=p.updateQueue;Ou=!1;var ee=q.firstBaseUpdate,pe=q.lastBaseUpdate,Fe=q.shared.pending;if(Fe!==null){q.shared.pending=null;var Ze=Fe,It=Ze.next;Ze.next=null,pe===null?ee=It:pe.next=It,pe=Ze;var on=p.alternate;on!==null&&(on=on.updateQueue,Fe=on.lastBaseUpdate,Fe!==pe&&(Fe===null?on.firstBaseUpdate=It:Fe.next=It,on.lastBaseUpdate=Ze))}if(ee!==null){var fn=q.baseState;pe=0,on=It=Ze=null,Fe=ee;do{var sn=Fe.lane,Xn=Fe.eventTime;if((L&sn)===sn){on!==null&&(on=on.next={eventTime:Xn,lane:0,tag:Fe.tag,payload:Fe.payload,callback:Fe.callback,next:null});e:{var nr=p,ur=Fe;switch(sn=v,Xn=E,ur.tag){case 1:if(nr=ur.payload,typeof nr=="function"){fn=nr.call(Xn,fn,sn);break e}fn=nr;break e;case 3:nr.flags=nr.flags&-65537|128;case 0:if(nr=ur.payload,sn=typeof nr=="function"?nr.call(Xn,fn,sn):nr,sn==null)break e;fn=pt({},fn,sn);break e;case 2:Ou=!0}}Fe.callback!==null&&Fe.lane!==0&&(p.flags|=64,sn=q.effects,sn===null?q.effects=[Fe]:sn.push(Fe))}else Xn={eventTime:Xn,lane:sn,tag:Fe.tag,payload:Fe.payload,callback:Fe.callback,next:null},on===null?(It=on=Xn,Ze=fn):on=on.next=Xn,pe|=sn;if(Fe=Fe.next,Fe===null){if(Fe=q.shared.pending,Fe===null)break;sn=Fe,Fe=sn.next,sn.next=null,q.lastBaseUpdate=sn,q.shared.pending=null}}while(!0);if(on===null&&(Ze=fn),q.baseState=Ze,q.firstBaseUpdate=It,q.lastBaseUpdate=on,v=q.shared.interleaved,v!==null){q=v;do pe|=q.lane,q=q.next;while(q!==v)}else ee===null&&(q.shared.lanes=0);Xh|=pe,p.lanes=pe,p.memoizedState=fn}}function sv(p,v,E){if(p=v.effects,v.effects=null,p!==null)for(v=0;v<p.length;v++){var L=p[v],q=L.callback;if(q!==null){if(L.callback=null,L=E,typeof q!="function")throw Error(t(191,q));q.call(L)}}}var l2={},Lu=Dd(l2),Jm=Dd(l2),c2=Dd(l2);function jh(p){if(p===l2)throw Error(t(174));return p}function F9(p,v){switch(ws(c2,v),ws(Jm,p),ws(Lu,l2),p=v.nodeType,p){case 9:case 11:v=(v=v.documentElement)?v.namespaceURI:Kt(null,"");break;default:p=p===8?v.parentNode:v,v=p.namespaceURI||null,p=p.tagName,v=Kt(v,p)}ps(Lu),ws(Lu,v)}function e1(){ps(Lu),ps(Jm),ps(c2)}function Ux(p){jh(c2.current);var v=jh(Lu.current),E=Kt(v,p.type);v!==E&&(ws(Jm,p),ws(Lu,E))}function B9(p){Jm.current===p&&(ps(Lu),ps(Jm))}var eo=Dd(0);function zd(p){for(var v=p;v!==null;){if(v.tag===13){var E=v.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||E.data==="$!"))return v}else if(v.tag===19&&v.memoizedProps.revealOrder!==void 0){if((v.flags&128)!==0)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===p)break;for(;v.sibling===null;){if(v.return===null||v.return===p)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}var sf=[];function t1(){for(var p=0;p<sf.length;p++)sf[p]._workInProgressVersionPrimary=null;sf.length=0}var u2=C.ReactCurrentDispatcher,Hh=C.ReactCurrentBatchConfig,Vd=0,fs=null,qs=null,ha=null,U9=!1,n1=!1,d2=0,zx=0;function _o(){throw Error(t(321))}function r1(p,v){if(v===null)return!1;for(var E=0;E<v.length&&E<p.length;E++)if(!Pa(p[E],v[E]))return!1;return!0}function z9(p,v,E,L,q,ee){if(Vd=ee,fs=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,u2.current=p===null||p.memoizedState===null?a1:Bw,p=E(L,q),n1){ee=0;do{if(n1=!1,d2=0,25<=ee)throw Error(t(301));ee+=1,ha=qs=null,v.updateQueue=null,u2.current=K9,p=E(L,q)}while(n1)}if(u2.current=Bu,v=qs!==null&&qs.next!==null,Vd=0,ha=qs=fs=null,U9=!1,v)throw Error(t(300));return p}function h2(){var p=d2!==0;return d2=0,p}function Fu(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ha===null?fs.memoizedState=ha=p:ha=ha.next=p,ha}function K0(){if(qs===null){var p=fs.alternate;p=p!==null?p.memoizedState:null}else p=qs.next;var v=ha===null?fs.memoizedState:ha.next;if(v!==null)ha=v,qs=p;else{if(p===null)throw Error(t(310));qs=p,p={memoizedState:qs.memoizedState,baseState:qs.baseState,baseQueue:qs.baseQueue,queue:qs.queue,next:null},ha===null?fs.memoizedState=ha=p:ha=ha.next=p}return ha}function i1(p,v){return typeof v=="function"?v(p):v}function ov(p){var v=K0(),E=v.queue;if(E===null)throw Error(t(311));E.lastRenderedReducer=p;var L=qs,q=L.baseQueue,ee=E.pending;if(ee!==null){if(q!==null){var pe=q.next;q.next=ee.next,ee.next=pe}L.baseQueue=q=ee,E.pending=null}if(q!==null){ee=q.next,L=L.baseState;var Fe=pe=null,Ze=null,It=ee;do{var on=It.lane;if((Vd&on)===on)Ze!==null&&(Ze=Ze.next={lane:0,action:It.action,hasEagerState:It.hasEagerState,eagerState:It.eagerState,next:null}),L=It.hasEagerState?It.eagerState:p(L,It.action);else{var fn={lane:on,action:It.action,hasEagerState:It.hasEagerState,eagerState:It.eagerState,next:null};Ze===null?(Fe=Ze=fn,pe=L):Ze=Ze.next=fn,fs.lanes|=on,Xh|=on}It=It.next}while(It!==null&&It!==ee);Ze===null?pe=L:Ze.next=Fe,Pa(L,v.memoizedState)||(Fl=!0),v.memoizedState=L,v.baseState=pe,v.baseQueue=Ze,E.lastRenderedState=L}if(p=E.interleaved,p!==null){q=p;do ee=q.lane,fs.lanes|=ee,Xh|=ee,q=q.next;while(q!==p)}else q===null&&(E.lanes=0);return[v.memoizedState,E.dispatch]}function av(p){var v=K0(),E=v.queue;if(E===null)throw Error(t(311));E.lastRenderedReducer=p;var L=E.dispatch,q=E.pending,ee=v.memoizedState;if(q!==null){E.pending=null;var pe=q=q.next;do ee=p(ee,pe.action),pe=pe.next;while(pe!==q);Pa(ee,v.memoizedState)||(Fl=!0),v.memoizedState=ee,v.baseQueue===null&&(v.baseState=ee),E.lastRenderedState=ee}return[ee,L]}function V9(){}function Vx(p,v){var E=fs,L=K0(),q=v(),ee=!Pa(L.memoizedState,q);if(ee&&(L.memoizedState=q,Fl=!0),L=L.queue,H9(jx.bind(null,E,L,p),[p]),L.getSnapshot!==v||ee||ha!==null&&ha.memoizedState.tag&1){if(E.flags|=2048,of(9,G9.bind(null,E,L,q,v),void 0,null),Yo===null)throw Error(t(349));(Vd&30)!==0||Gx(E,v,q)}return q}function Gx(p,v,E){p.flags|=16384,p={getSnapshot:v,value:E},v=fs.updateQueue,v===null?(v={lastEffect:null,stores:null},fs.updateQueue=v,v.stores=[p]):(E=v.stores,E===null?v.stores=[p]:E.push(p))}function G9(p,v,E,L){v.value=E,v.getSnapshot=L,Gd(v)&&s1(p)}function jx(p,v,E){return E(function(){Gd(v)&&s1(p)})}function Gd(p){var v=p.getSnapshot;p=p.value;try{var E=v();return!Pa(p,E)}catch{return!0}}function s1(p){var v=Ud(p,1);v!==null&&x0(v,p,1,-1)}function j9(p){var v=Fu();return typeof p=="function"&&(p=p()),v.memoizedState=v.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i1,lastRenderedState:p},v.queue=p,p=p.dispatch=m2.bind(null,fs,p),[v.memoizedState,p]}function of(p,v,E,L){return p={tag:p,create:v,destroy:E,deps:L,next:null},v=fs.updateQueue,v===null?(v={lastEffect:null,stores:null},fs.updateQueue=v,v.lastEffect=p.next=p):(E=v.lastEffect,E===null?v.lastEffect=p.next=p:(L=E.next,E.next=p,p.next=L,v.lastEffect=p)),p}function lv(){return K0().memoizedState}function af(p,v,E,L){var q=Fu();fs.flags|=p,q.memoizedState=of(1|v,E,void 0,L===void 0?null:L)}function p2(p,v,E,L){var q=K0();L=L===void 0?null:L;var ee=void 0;if(qs!==null){var pe=qs.memoizedState;if(ee=pe.destroy,L!==null&&r1(L,pe.deps)){q.memoizedState=of(v,E,ee,L);return}}fs.flags|=p,q.memoizedState=of(1|v,E,ee,L)}function Hx(p,v){return af(8390656,8,p,v)}function H9(p,v){return p2(2048,8,p,v)}function $9(p,v){return p2(4,2,p,v)}function $x(p,v){return p2(4,4,p,v)}function f2(p,v){if(typeof v=="function")return p=p(),v(p),function(){v(null)};if(v!=null)return p=p(),v.current=p,function(){v.current=null}}function cv(p,v,E){return E=E!=null?E.concat([p]):null,p2(4,4,f2.bind(null,v,p),E)}function W9(){}function uv(p,v){var E=K0();v=v===void 0?null:v;var L=E.memoizedState;return L!==null&&v!==null&&r1(v,L[1])?L[0]:(E.memoizedState=[p,v],p)}function q9(p,v){var E=K0();v=v===void 0?null:v;var L=E.memoizedState;return L!==null&&v!==null&&r1(v,L[1])?L[0]:(p=p(),E.memoizedState=[p,v],p)}function Wx(p,v,E){return(Vd&21)===0?(p.baseState&&(p.baseState=!1,Fl=!0),p.memoizedState=E):(Pa(E,v)||(E=Ca(),fs.lanes|=E,Xh|=E,p.baseState=!0),v)}function o1(p,v){var E=Ur;Ur=E!==0&&4>E?E:4,p(!0);var L=Hh.transition;Hh.transition={};try{p(!1),v()}finally{Ur=E,Hh.transition=L}}function dv(){return K0().memoizedState}function hv(p,v,E){var L=Gu(p);if(E={lane:L,action:E,hasEagerState:!1,eagerState:null,next:null},X9(p))pv(v,E);else if(E=rv(p,v,E,L),E!==null){var q=So();x0(E,p,L,q),Y9(E,v,L)}}function m2(p,v,E){var L=Gu(p),q={lane:L,action:E,hasEagerState:!1,eagerState:null,next:null};if(X9(p))pv(v,q);else{var ee=p.alternate;if(p.lanes===0&&(ee===null||ee.lanes===0)&&(ee=v.lastRenderedReducer,ee!==null))try{var pe=v.lastRenderedState,Fe=ee(pe,E);if(q.hasEagerState=!0,q.eagerState=Fe,Pa(Fe,pe)){var Ze=v.interleaved;Ze===null?(q.next=q,Qm(v)):(q.next=Ze.next,Ze.next=q),v.interleaved=q;return}}catch{}finally{}E=rv(p,v,q,L),E!==null&&(q=So(),x0(E,p,L,q),Y9(E,v,L))}}function X9(p){var v=p.alternate;return p===fs||v!==null&&v===fs}function pv(p,v){n1=U9=!0;var E=p.pending;E===null?v.next=v:(v.next=E.next,E.next=v),p.pending=v}function Y9(p,v,E){if((E&4194240)!==0){var L=v.lanes;L&=p.pendingLanes,E|=L,v.lanes=E,Ai(p,E)}}var Bu={readContext:Y0,useCallback:_o,useContext:_o,useEffect:_o,useImperativeHandle:_o,useInsertionEffect:_o,useLayoutEffect:_o,useMemo:_o,useReducer:_o,useRef:_o,useState:_o,useDebugValue:_o,useDeferredValue:_o,useTransition:_o,useMutableSource:_o,useSyncExternalStore:_o,useId:_o,unstable_isNewReconciler:!1},a1={readContext:Y0,useCallback:function(p,v){return Fu().memoizedState=[p,v===void 0?null:v],p},useContext:Y0,useEffect:Hx,useImperativeHandle:function(p,v,E){return E=E!=null?E.concat([p]):null,af(4194308,4,f2.bind(null,v,p),E)},useLayoutEffect:function(p,v){return af(4194308,4,p,v)},useInsertionEffect:function(p,v){return af(4,2,p,v)},useMemo:function(p,v){var E=Fu();return v=v===void 0?null:v,p=p(),E.memoizedState=[p,v],p},useReducer:function(p,v,E){var L=Fu();return v=E!==void 0?E(v):v,L.memoizedState=L.baseState=v,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:v},L.queue=p,p=p.dispatch=hv.bind(null,fs,p),[L.memoizedState,p]},useRef:function(p){var v=Fu();return p={current:p},v.memoizedState=p},useState:j9,useDebugValue:W9,useDeferredValue:function(p){return Fu().memoizedState=p},useTransition:function(){var p=j9(!1),v=p[0];return p=o1.bind(null,p[1]),Fu().memoizedState=p,[v,p]},useMutableSource:function(){},useSyncExternalStore:function(p,v,E){var L=fs,q=Fu();if(Bs){if(E===void 0)throw Error(t(407));E=E()}else{if(E=v(),Yo===null)throw Error(t(349));(Vd&30)!==0||Gx(L,v,E)}q.memoizedState=E;var ee={value:E,getSnapshot:v};return q.queue=ee,Hx(jx.bind(null,L,ee,p),[p]),L.flags|=2048,of(9,G9.bind(null,L,ee,E,v),void 0,null),E},useId:function(){var p=Fu(),v=Yo.identifierPrefix;if(Bs){var E=Du,L=X0;E=(L&~(1<<32-yr(L)-1)).toString(32)+E,v=":"+v+"R"+E,E=d2++,0<E&&(v+="H"+E.toString(32)),v+=":"}else E=zx++,v=":"+v+"r"+E.toString(32)+":";return p.memoizedState=v},unstable_isNewReconciler:!1},Bw={readContext:Y0,useCallback:uv,useContext:Y0,useEffect:H9,useImperativeHandle:cv,useInsertionEffect:$9,useLayoutEffect:$x,useMemo:q9,useReducer:ov,useRef:lv,useState:function(){return ov(i1)},useDebugValue:W9,useDeferredValue:function(p){var v=K0();return Wx(v,qs.memoizedState,p)},useTransition:function(){var p=ov(i1)[0],v=K0().memoizedState;return[p,v]},useMutableSource:V9,useSyncExternalStore:Vx,useId:dv,unstable_isNewReconciler:!1},K9={readContext:Y0,useCallback:uv,useContext:Y0,useEffect:H9,useImperativeHandle:cv,useInsertionEffect:$9,useLayoutEffect:$x,useMemo:q9,useReducer:av,useRef:lv,useState:function(){return av(i1)},useDebugValue:W9,useDeferredValue:function(p){var v=K0();return qs===null?v.memoizedState=p:Wx(v,qs.memoizedState,p)},useTransition:function(){var p=av(i1)[0],v=K0().memoizedState;return[p,v]},useMutableSource:V9,useSyncExternalStore:Vx,useId:dv,unstable_isNewReconciler:!1};function y0(p,v){if(p&&p.defaultProps){v=pt({},v),p=p.defaultProps;for(var E in p)v[E]===void 0&&(v[E]=p[E]);return v}return v}function fv(p,v,E,L){v=p.memoizedState,E=E(L,v),E=E==null?v:pt({},v,E),p.memoizedState=E,p.lanes===0&&(p.updateQueue.baseState=E)}var Uu={isMounted:function(p){return(p=p._reactInternals)?$o(p)===p:!1},enqueueSetState:function(p,v,E){p=p._reactInternals;var L=So(),q=Gu(p),ee=g0(L,q);ee.payload=v,E!=null&&(ee.callback=E),v=$c(p,ee,q),v!==null&&(x0(v,p,q,L),L9(v,p,q))},enqueueReplaceState:function(p,v,E){p=p._reactInternals;var L=So(),q=Gu(p),ee=g0(L,q);ee.tag=1,ee.payload=v,E!=null&&(ee.callback=E),v=$c(p,ee,q),v!==null&&(x0(v,p,q,L),L9(v,p,q))},enqueueForceUpdate:function(p,v){p=p._reactInternals;var E=So(),L=Gu(p),q=g0(E,L);q.tag=2,v!=null&&(q.callback=v),v=$c(p,q,L),v!==null&&(x0(v,p,L,E),L9(v,p,L))}};function Z0(p,v,E,L,q,ee,pe){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(L,ee,pe):v.prototype&&v.prototype.isPureReactComponent?!Gc(E,L)||!Gc(q,ee):!0}function l1(p,v,E){var L=!1,q=Bh,ee=v.contextType;return typeof ee=="object"&&ee!==null?ee=Y0(ee):(q=Dl(v)?Od:Ra.current,L=v.contextTypes,ee=(L=L!=null)?Uh(p,q):Bh),v=new v(E,ee),p.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=Uu,p.stateNode=v,v._reactInternals=p,L&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=q,p.__reactInternalMemoizedMaskedChildContext=ee),v}function g2(p,v,E,L){p=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(E,L),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(E,L),v.state!==p&&Uu.enqueueReplaceState(v,v.state,null)}function y2(p,v,E,L){var q=p.stateNode;q.props=E,q.state=p.memoizedState,q.refs={},O9(p);var ee=v.contextType;typeof ee=="object"&&ee!==null?q.context=Y0(ee):(ee=Dl(v)?Od:Ra.current,q.context=Uh(p,ee)),q.state=p.memoizedState,ee=v.getDerivedStateFromProps,typeof ee=="function"&&(fv(p,v,ee,E),q.state=p.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof q.getSnapshotBeforeUpdate=="function"||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(v=q.state,typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount(),v!==q.state&&Uu.enqueueReplaceState(q,q.state,null),a2(p,E,q,L),q.state=p.memoizedState),typeof q.componentDidMount=="function"&&(p.flags|=4194308)}function c1(p,v){try{var E="",L=v;do E+=bn(L),L=L.return;while(L);var q=E}catch(ee){q=`
Error generating stack: `+ee.message+`
`+ee.stack}return{value:p,source:v,stack:q,digest:null}}function v2(p,v,E){return{value:p,source:null,stack:E??null,digest:v??null}}function Z9(p,v){try{console.error(v.value)}catch(E){setTimeout(function(){throw E})}}var Q9=typeof WeakMap=="function"?WeakMap:Map;function mv(p,v,E){E=g0(-1,E),E.tag=3,E.payload={element:null};var L=v.value;return E.callback=function(){u4||(u4=!0,d4=L),Z9(p,v)},E}function x2(p,v,E){E=g0(-1,E),E.tag=3;var L=p.type.getDerivedStateFromError;if(typeof L=="function"){var q=v.value;E.payload=function(){return L(q)},E.callback=function(){Z9(p,v)}}var ee=p.stateNode;return ee!==null&&typeof ee.componentDidCatch=="function"&&(E.callback=function(){Z9(p,v),typeof L!="function"&&(Yc===null?Yc=new Set([this]):Yc.add(this));var pe=v.stack;this.componentDidCatch(v.value,{componentStack:pe!==null?pe:""})}),E}function qx(p,v,E){var L=p.pingCache;if(L===null){L=p.pingCache=new Q9;var q=new Set;L.set(v,q)}else q=L.get(v),q===void 0&&(q=new Set,L.set(v,q));q.has(E)||(q.add(E),p=jw.bind(null,p,v,E),v.then(p,p))}function gv(p){do{var v;if((v=p.tag===13)&&(v=p.memoizedState,v=v!==null?v.dehydrated!==null:!0),v)return p;p=p.return}while(p!==null);return null}function b2(p,v,E,L,q){return(p.mode&1)===0?(p===v?p.flags|=65536:(p.flags|=128,E.flags|=131072,E.flags&=-52805,E.tag===1&&(E.alternate===null?E.tag=17:(v=g0(-1,1),v.tag=2,$c(E,v,1))),E.lanes|=1),p):(p.flags|=65536,p.lanes=q,p)}var yv=C.ReactCurrentOwner,Fl=!1;function Ia(p,v,E,L){v.child=p===null?ev(v,null,E,L):nf(v,p.child,E,L)}function J9(p,v,E,L,q){E=E.render;var ee=v.ref;return Bd(v,q),L=z9(p,v,E,L,ee,q),E=h2(),p!==null&&!Fl?(v.updateQueue=p.updateQueue,v.flags&=-2053,p.lanes&=~q,jd(p,v,q)):(Bs&&E&&tf(v),v.flags|=1,Ia(p,v,L,q),v.child)}function vv(p,v,E,L,q){if(p===null){var ee=E.type;return typeof ee=="function"&&!k2(ee)&&ee.defaultProps===void 0&&E.compare===null&&E.defaultProps===void 0?(v.tag=15,v.type=ee,e4(p,v,ee,L,q)):(p=x4(E.type,null,L,v,v.mode,q),p.ref=v.ref,p.return=v,v.child=p)}if(ee=p.child,(p.lanes&q)===0){var pe=ee.memoizedProps;if(E=E.compare,E=E!==null?E:Gc,E(pe,L)&&p.ref===v.ref)return jd(p,v,q)}return v.flags|=1,p=ju(ee,L),p.ref=v.ref,p.return=v,v.child=p}function e4(p,v,E,L,q){if(p!==null){var ee=p.memoizedProps;if(Gc(ee,L)&&p.ref===v.ref)if(Fl=!1,v.pendingProps=L=ee,(p.lanes&q)!==0)(p.flags&131072)!==0&&(Fl=!0);else return v.lanes=p.lanes,jd(p,v,q)}return u1(p,v,E,L,q)}function xv(p,v,E){var L=v.pendingProps,q=L.children,ee=p!==null?p.memoizedState:null;if(L.mode==="hidden")if((v.mode&1)===0)v.memoizedState={baseLanes:0,cachePool:null,transitions:null},ws(Wh,Ul),Ul|=E;else{if((E&1073741824)===0)return p=ee!==null?ee.baseLanes|E:E,v.lanes=v.childLanes=1073741824,v.memoizedState={baseLanes:p,cachePool:null,transitions:null},v.updateQueue=null,ws(Wh,Ul),Ul|=p,null;v.memoizedState={baseLanes:0,cachePool:null,transitions:null},L=ee!==null?ee.baseLanes:E,ws(Wh,Ul),Ul|=L}else ee!==null?(L=ee.baseLanes|E,v.memoizedState=null):L=E,ws(Wh,Ul),Ul|=L;return Ia(p,v,q,E),v.child}function bv(p,v){var E=v.ref;(p===null&&E!==null||p!==null&&p.ref!==E)&&(v.flags|=512,v.flags|=2097152)}function u1(p,v,E,L,q){var ee=Dl(E)?Od:Ra.current;return ee=Uh(v,ee),Bd(v,q),E=z9(p,v,E,L,ee,q),L=h2(),p!==null&&!Fl?(v.updateQueue=p.updateQueue,v.flags&=-2053,p.lanes&=~q,jd(p,v,q)):(Bs&&L&&tf(v),v.flags|=1,Ia(p,v,E,q),v.child)}function _v(p,v,E,L,q){if(Dl(E)){var ee=!0;Jg(v)}else ee=!1;if(Bd(v,q),v.stateNode===null)_2(p,v),l1(v,E,L),y2(v,E,L,q),L=!0;else if(p===null){var pe=v.stateNode,Fe=v.memoizedProps;pe.props=Fe;var Ze=pe.context,It=E.contextType;typeof It=="object"&&It!==null?It=Y0(It):(It=Dl(E)?Od:Ra.current,It=Uh(v,It));var on=E.getDerivedStateFromProps,fn=typeof on=="function"||typeof pe.getSnapshotBeforeUpdate=="function";fn||typeof pe.UNSAFE_componentWillReceiveProps!="function"&&typeof pe.componentWillReceiveProps!="function"||(Fe!==L||Ze!==It)&&g2(v,pe,L,It),Ou=!1;var sn=v.memoizedState;pe.state=sn,a2(v,L,pe,q),Ze=v.memoizedState,Fe!==L||sn!==Ze||qa.current||Ou?(typeof on=="function"&&(fv(v,E,on,L),Ze=v.memoizedState),(Fe=Ou||Z0(v,E,Fe,L,sn,Ze,It))?(fn||typeof pe.UNSAFE_componentWillMount!="function"&&typeof pe.componentWillMount!="function"||(typeof pe.componentWillMount=="function"&&pe.componentWillMount(),typeof pe.UNSAFE_componentWillMount=="function"&&pe.UNSAFE_componentWillMount()),typeof pe.componentDidMount=="function"&&(v.flags|=4194308)):(typeof pe.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=L,v.memoizedState=Ze),pe.props=L,pe.state=Ze,pe.context=It,L=Fe):(typeof pe.componentDidMount=="function"&&(v.flags|=4194308),L=!1)}else{pe=v.stateNode,Bx(p,v),Fe=v.memoizedProps,It=v.type===v.elementType?Fe:y0(v.type,Fe),pe.props=It,fn=v.pendingProps,sn=pe.context,Ze=E.contextType,typeof Ze=="object"&&Ze!==null?Ze=Y0(Ze):(Ze=Dl(E)?Od:Ra.current,Ze=Uh(v,Ze));var Xn=E.getDerivedStateFromProps;(on=typeof Xn=="function"||typeof pe.getSnapshotBeforeUpdate=="function")||typeof pe.UNSAFE_componentWillReceiveProps!="function"&&typeof pe.componentWillReceiveProps!="function"||(Fe!==fn||sn!==Ze)&&g2(v,pe,L,Ze),Ou=!1,sn=v.memoizedState,pe.state=sn,a2(v,L,pe,q);var nr=v.memoizedState;Fe!==fn||sn!==nr||qa.current||Ou?(typeof Xn=="function"&&(fv(v,E,Xn,L),nr=v.memoizedState),(It=Ou||Z0(v,E,It,L,sn,nr,Ze)||!1)?(on||typeof pe.UNSAFE_componentWillUpdate!="function"&&typeof pe.componentWillUpdate!="function"||(typeof pe.componentWillUpdate=="function"&&pe.componentWillUpdate(L,nr,Ze),typeof pe.UNSAFE_componentWillUpdate=="function"&&pe.UNSAFE_componentWillUpdate(L,nr,Ze)),typeof pe.componentDidUpdate=="function"&&(v.flags|=4),typeof pe.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof pe.componentDidUpdate!="function"||Fe===p.memoizedProps&&sn===p.memoizedState||(v.flags|=4),typeof pe.getSnapshotBeforeUpdate!="function"||Fe===p.memoizedProps&&sn===p.memoizedState||(v.flags|=1024),v.memoizedProps=L,v.memoizedState=nr),pe.props=L,pe.state=nr,pe.context=Ze,L=It):(typeof pe.componentDidUpdate!="function"||Fe===p.memoizedProps&&sn===p.memoizedState||(v.flags|=4),typeof pe.getSnapshotBeforeUpdate!="function"||Fe===p.memoizedProps&&sn===p.memoizedState||(v.flags|=1024),L=!1)}return Sv(p,v,E,L,ee,q)}function Sv(p,v,E,L,q,ee){bv(p,v);var pe=(v.flags&128)!==0;if(!L&&!pe)return q&&Dx(v,E,!1),jd(p,v,ee);L=v.stateNode,yv.current=v;var Fe=pe&&typeof E.getDerivedStateFromError!="function"?null:L.render();return v.flags|=1,p!==null&&pe?(v.child=nf(v,p.child,null,ee),v.child=nf(v,null,Fe,ee)):Ia(p,v,Fe,ee),v.memoizedState=L.state,q&&Dx(v,E,!0),v.child}function wv(p){var v=p.stateNode;v.pendingContext?Y5(p,v.pendingContext,v.pendingContext!==v.context):v.context&&Y5(p,v.context,!1),F9(p,v.containerInfo)}function Tv(p,v,E,L,q){return Km(),I9(q),v.flags|=256,Ia(p,v,E,L),v.child}var t4={dehydrated:null,treeContext:null,retryLane:0};function Ev(p){return{baseLanes:p,cachePool:null,transitions:null}}function Xx(p,v,E){var L=v.pendingProps,q=eo.current,ee=!1,pe=(v.flags&128)!==0,Fe;if((Fe=pe)||(Fe=p!==null&&p.memoizedState===null?!1:(q&2)!==0),Fe?(ee=!0,v.flags&=-129):(p===null||p.memoizedState!==null)&&(q|=1),ws(eo,q&1),p===null)return Ym(v),p=v.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((v.mode&1)===0?v.lanes=1:p.data==="$!"?v.lanes=8:v.lanes=1073741824,null):(pe=L.children,p=L.fallback,ee?(L=v.mode,ee=v.child,pe={mode:"hidden",children:pe},(L&1)===0&&ee!==null?(ee.childLanes=0,ee.pendingProps=pe):ee=D2(pe,L,0,null),p=df(p,L,E,null),ee.return=v,p.return=v,ee.sibling=p,v.child=ee,v.child.memoizedState=Ev(E),v.memoizedState=t4,p):n4(v,pe));if(q=p.memoizedState,q!==null&&(Fe=q.dehydrated,Fe!==null))return Uw(p,v,pe,L,Fe,q,E);if(ee){ee=L.fallback,pe=v.mode,q=p.child,Fe=q.sibling;var Ze={mode:"hidden",children:L.children};return(pe&1)===0&&v.child!==q?(L=v.child,L.childLanes=0,L.pendingProps=Ze,v.deletions=null):(L=ju(q,Ze),L.subtreeFlags=q.subtreeFlags&14680064),Fe!==null?ee=ju(Fe,ee):(ee=df(ee,pe,E,null),ee.flags|=2),ee.return=v,L.return=v,L.sibling=ee,v.child=L,L=ee,ee=v.child,pe=p.child.memoizedState,pe=pe===null?Ev(E):{baseLanes:pe.baseLanes|E,cachePool:null,transitions:pe.transitions},ee.memoizedState=pe,ee.childLanes=p.childLanes&~E,v.memoizedState=t4,L}return ee=p.child,p=ee.sibling,L=ju(ee,{mode:"visible",children:L.children}),(v.mode&1)===0&&(L.lanes=E),L.return=v,L.sibling=null,p!==null&&(E=v.deletions,E===null?(v.deletions=[p],v.flags|=16):E.push(p)),v.child=L,v.memoizedState=null,L}function n4(p,v){return v=D2({mode:"visible",children:v},p.mode,0,null),v.return=p,p.child=v}function r4(p,v,E,L){return L!==null&&I9(L),nf(v,p.child,null,E),p=n4(v,v.pendingProps.children),p.flags|=2,v.memoizedState=null,p}function Uw(p,v,E,L,q,ee,pe){if(E)return v.flags&256?(v.flags&=-257,L=v2(Error(t(422))),r4(p,v,pe,L)):v.memoizedState!==null?(v.child=p.child,v.flags|=128,null):(ee=L.fallback,q=v.mode,L=D2({mode:"visible",children:L.children},q,0,null),ee=df(ee,q,pe,null),ee.flags|=2,L.return=v,ee.return=v,L.sibling=ee,v.child=L,(v.mode&1)!==0&&nf(v,p.child,null,pe),v.child.memoizedState=Ev(pe),v.memoizedState=t4,ee);if((v.mode&1)===0)return r4(p,v,pe,null);if(q.data==="$!"){if(L=q.nextSibling&&q.nextSibling.dataset,L)var Fe=L.dgst;return L=Fe,ee=Error(t(419)),L=v2(ee,L,void 0),r4(p,v,pe,L)}if(Fe=(pe&p.childLanes)!==0,Fl||Fe){if(L=Yo,L!==null){switch(pe&-pe){case 4:q=2;break;case 16:q=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:q=32;break;case 536870912:q=268435456;break;default:q=0}q=(q&(L.suspendedLanes|pe))!==0?0:q,q!==0&&q!==ee.retryLane&&(ee.retryLane=q,Ud(p,q),x0(L,p,q,-1))}return Vv(),L=v2(Error(t(421))),r4(p,v,pe,L)}return q.data==="$?"?(v.flags|=128,v.child=p.child,v=i7.bind(null,p),q._reactRetry=v,null):(p=ee.treeContext,Ol=Rd(q.nextSibling),f0=v,Bs=!0,Ll=null,p!==null&&(q0[p0++]=X0,q0[p0++]=Du,q0[p0++]=Vh,X0=p.id,Du=p.overflow,Vh=v),v=n4(v,L.children),v.flags|=4096,v)}function os(p,v,E){p.lanes|=v;var L=p.alternate;L!==null&&(L.lanes|=v),Zm(p.return,v,E)}function lf(p,v,E,L,q){var ee=p.memoizedState;ee===null?p.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:L,tail:E,tailMode:q}:(ee.isBackwards=v,ee.rendering=null,ee.renderingStartTime=0,ee.last=L,ee.tail=E,ee.tailMode=q)}function Yx(p,v,E){var L=v.pendingProps,q=L.revealOrder,ee=L.tail;if(Ia(p,v,L.children,E),L=eo.current,(L&2)!==0)L=L&1|2,v.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=v.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&os(p,E,v);else if(p.tag===19)os(p,E,v);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===v)break e;for(;p.sibling===null;){if(p.return===null||p.return===v)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}L&=1}if(ws(eo,L),(v.mode&1)===0)v.memoizedState=null;else switch(q){case"forwards":for(E=v.child,q=null;E!==null;)p=E.alternate,p!==null&&zd(p)===null&&(q=E),E=E.sibling;E=q,E===null?(q=v.child,v.child=null):(q=E.sibling,E.sibling=null),lf(v,!1,q,E,ee);break;case"backwards":for(E=null,q=v.child,v.child=null;q!==null;){if(p=q.alternate,p!==null&&zd(p)===null){v.child=q;break}p=q.sibling,q.sibling=E,E=q,q=p}lf(v,!0,E,null,ee);break;case"together":lf(v,!1,null,null,void 0);break;default:v.memoizedState=null}return v.child}function _2(p,v){(v.mode&1)===0&&p!==null&&(p.alternate=null,v.alternate=null,v.flags|=2)}function jd(p,v,E){if(p!==null&&(v.dependencies=p.dependencies),Xh|=v.lanes,(E&v.childLanes)===0)return null;if(p!==null&&v.child!==p.child)throw Error(t(153));if(v.child!==null){for(p=v.child,E=ju(p,p.pendingProps),v.child=E,E.return=v;p.sibling!==null;)p=p.sibling,E=E.sibling=ju(p,p.pendingProps),E.return=v;E.sibling=null}return v.child}function zw(p,v,E){switch(v.tag){case 3:wv(v),Km();break;case 5:Ux(v);break;case 1:Dl(v.type)&&Jg(v);break;case 4:F9(v,v.stateNode.containerInfo);break;case 10:var L=v.type._context,q=v.memoizedProps.value;ws(k9,L._currentValue),L._currentValue=q;break;case 13:if(L=v.memoizedState,L!==null)return L.dehydrated!==null?(ws(eo,eo.current&1),v.flags|=128,null):(E&v.child.childLanes)!==0?Xx(p,v,E):(ws(eo,eo.current&1),p=jd(p,v,E),p!==null?p.sibling:null);ws(eo,eo.current&1);break;case 19:if(L=(E&v.childLanes)!==0,(p.flags&128)!==0){if(L)return Yx(p,v,E);v.flags|=128}if(q=v.memoizedState,q!==null&&(q.rendering=null,q.tail=null,q.lastEffect=null),ws(eo,eo.current),L)break;return null;case 22:case 23:return v.lanes=0,xv(p,v,E)}return jd(p,v,E)}var Mv,Cv,Kx,Av;Mv=function(p,v){for(var E=v.child;E!==null;){if(E.tag===5||E.tag===6)p.appendChild(E.stateNode);else if(E.tag!==4&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===v)break;for(;E.sibling===null;){if(E.return===null||E.return===v)return;E=E.return}E.sibling.return=E.return,E=E.sibling}},Cv=function(){},Kx=function(p,v,E,L){var q=p.memoizedProps;if(q!==L){p=v.stateNode,jh(Lu.current);var ee=null;switch(E){case"input":q=Vr(p,q),L=Vr(p,L),ee=[];break;case"select":q=pt({},q,{value:void 0}),L=pt({},L,{value:void 0}),ee=[];break;case"textarea":q=Vn(p,q),L=Vn(p,L),ee=[];break;default:typeof q.onClick!="function"&&typeof L.onClick=="function"&&(p.onclick=Kg)}$n(E,L);var pe;E=null;for(It in q)if(!L.hasOwnProperty(It)&&q.hasOwnProperty(It)&&q[It]!=null)if(It==="style"){var Fe=q[It];for(pe in Fe)Fe.hasOwnProperty(pe)&&(E||(E={}),E[pe]="")}else It!=="dangerouslySetInnerHTML"&&It!=="children"&&It!=="suppressContentEditableWarning"&&It!=="suppressHydrationWarning"&&It!=="autoFocus"&&(r.hasOwnProperty(It)?ee||(ee=[]):(ee=ee||[]).push(It,null));for(It in L){var Ze=L[It];if(Fe=q!=null?q[It]:void 0,L.hasOwnProperty(It)&&Ze!==Fe&&(Ze!=null||Fe!=null))if(It==="style")if(Fe){for(pe in Fe)!Fe.hasOwnProperty(pe)||Ze&&Ze.hasOwnProperty(pe)||(E||(E={}),E[pe]="");for(pe in Ze)Ze.hasOwnProperty(pe)&&Fe[pe]!==Ze[pe]&&(E||(E={}),E[pe]=Ze[pe])}else E||(ee||(ee=[]),ee.push(It,E)),E=Ze;else It==="dangerouslySetInnerHTML"?(Ze=Ze?Ze.__html:void 0,Fe=Fe?Fe.__html:void 0,Ze!=null&&Fe!==Ze&&(ee=ee||[]).push(It,Ze)):It==="children"?typeof Ze!="string"&&typeof Ze!="number"||(ee=ee||[]).push(It,""+Ze):It!=="suppressContentEditableWarning"&&It!=="suppressHydrationWarning"&&(r.hasOwnProperty(It)?(Ze!=null&&It==="onScroll"&&Fs("scroll",p),ee||Fe===Ze||(ee=[])):(ee=ee||[]).push(It,Ze))}E&&(ee=ee||[]).push("style",E);var It=ee;(v.updateQueue=It)&&(v.flags|=4)}},Av=function(p,v,E,L){E!==L&&(v.flags|=4)};function S2(p,v){if(!Bs)switch(p.tailMode){case"hidden":v=p.tail;for(var E=null;v!==null;)v.alternate!==null&&(E=v),v=v.sibling;E===null?p.tail=null:E.sibling=null;break;case"collapsed":E=p.tail;for(var L=null;E!==null;)E.alternate!==null&&(L=E),E=E.sibling;L===null?v||p.tail===null?p.tail=null:p.tail.sibling=null:L.sibling=null}}function Xa(p){var v=p.alternate!==null&&p.alternate.child===p.child,E=0,L=0;if(v)for(var q=p.child;q!==null;)E|=q.lanes|q.childLanes,L|=q.subtreeFlags&14680064,L|=q.flags&14680064,q.return=p,q=q.sibling;else for(q=p.child;q!==null;)E|=q.lanes|q.childLanes,L|=q.subtreeFlags,L|=q.flags,q.return=p,q=q.sibling;return p.subtreeFlags|=L,p.childLanes=E,v}function Zx(p,v,E){var L=v.pendingProps;switch(e2(v),v.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xa(v),null;case 1:return Dl(v.type)&&Xm(),Xa(v),null;case 3:return L=v.stateNode,e1(),ps(qa),ps(Ra),t1(),L.pendingContext&&(L.context=L.pendingContext,L.pendingContext=null),(p===null||p.child===null)&&(n2(v)?v.flags|=4:p===null||p.memoizedState.isDehydrated&&(v.flags&256)===0||(v.flags|=1024,Ll!==null&&(N2(Ll),Ll=null))),Cv(p,v),Xa(v),null;case 5:B9(v);var q=jh(c2.current);if(E=v.type,p!==null&&v.stateNode!=null)Kx(p,v,E,L,q),p.ref!==v.ref&&(v.flags|=512,v.flags|=2097152);else{if(!L){if(v.stateNode===null)throw Error(t(166));return Xa(v),null}if(p=jh(Lu.current),n2(v)){L=v.stateNode,E=v.type;var ee=v.memoizedProps;switch(L[Oi]=v,L[Zg]=ee,p=(v.mode&1)!==0,E){case"dialog":Fs("cancel",L),Fs("close",L);break;case"iframe":case"object":case"embed":Fs("load",L);break;case"video":case"audio":for(q=0;q<Xp.length;q++)Fs(Xp[q],L);break;case"source":Fs("error",L);break;case"img":case"image":case"link":Fs("error",L),Fs("load",L);break;case"details":Fs("toggle",L);break;case"input":Kr(L,ee),Fs("invalid",L);break;case"select":L._wrapperState={wasMultiple:!!ee.multiple},Fs("invalid",L);break;case"textarea":ke(L,ee),Fs("invalid",L)}$n(E,ee),q=null;for(var pe in ee)if(ee.hasOwnProperty(pe)){var Fe=ee[pe];pe==="children"?typeof Fe=="string"?L.textContent!==Fe&&(ee.suppressHydrationWarning!==!0&&Yg(L.textContent,Fe,p),q=["children",Fe]):typeof Fe=="number"&&L.textContent!==""+Fe&&(ee.suppressHydrationWarning!==!0&&Yg(L.textContent,Fe,p),q=["children",""+Fe]):r.hasOwnProperty(pe)&&Fe!=null&&pe==="onScroll"&&Fs("scroll",L)}switch(E){case"input":or(L),Ke(L,ee,!0);break;case"textarea":or(L),ht(L);break;case"select":case"option":break;default:typeof ee.onClick=="function"&&(L.onclick=Kg)}L=q,v.updateQueue=L,L!==null&&(v.flags|=4)}else{pe=q.nodeType===9?q:q.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=Xt(E)),p==="http://www.w3.org/1999/xhtml"?E==="script"?(p=pe.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof L.is=="string"?p=pe.createElement(E,{is:L.is}):(p=pe.createElement(E),E==="select"&&(pe=p,L.multiple?pe.multiple=!0:L.size&&(pe.size=L.size))):p=pe.createElementNS(p,E),p[Oi]=v,p[Zg]=L,Mv(p,v,!1,!1),v.stateNode=p;e:{switch(pe=Bn(E,L),E){case"dialog":Fs("cancel",p),Fs("close",p),q=L;break;case"iframe":case"object":case"embed":Fs("load",p),q=L;break;case"video":case"audio":for(q=0;q<Xp.length;q++)Fs(Xp[q],p);q=L;break;case"source":Fs("error",p),q=L;break;case"img":case"image":case"link":Fs("error",p),Fs("load",p),q=L;break;case"details":Fs("toggle",p),q=L;break;case"input":Kr(p,L),q=Vr(p,L),Fs("invalid",p);break;case"option":q=L;break;case"select":p._wrapperState={wasMultiple:!!L.multiple},q=pt({},L,{value:void 0}),Fs("invalid",p);break;case"textarea":ke(p,L),q=Vn(p,L),Fs("invalid",p);break;default:q=L}$n(E,q),Fe=q;for(ee in Fe)if(Fe.hasOwnProperty(ee)){var Ze=Fe[ee];ee==="style"?vn(p,Ze):ee==="dangerouslySetInnerHTML"?(Ze=Ze?Ze.__html:void 0,Ze!=null&&Qn(p,Ze)):ee==="children"?typeof Ze=="string"?(E!=="textarea"||Ze!=="")&&wn(p,Ze):typeof Ze=="number"&&wn(p,""+Ze):ee!=="suppressContentEditableWarning"&&ee!=="suppressHydrationWarning"&&ee!=="autoFocus"&&(r.hasOwnProperty(ee)?Ze!=null&&ee==="onScroll"&&Fs("scroll",p):Ze!=null&&j(p,ee,Ze,pe))}switch(E){case"input":or(p),Ke(p,L,!1);break;case"textarea":or(p),ht(p);break;case"option":L.value!=null&&p.setAttribute("value",""+Wt(L.value));break;case"select":p.multiple=!!L.multiple,ee=L.value,ee!=null?Ti(p,!!L.multiple,ee,!1):L.defaultValue!=null&&Ti(p,!!L.multiple,L.defaultValue,!0);break;default:typeof q.onClick=="function"&&(p.onclick=Kg)}switch(E){case"button":case"input":case"select":case"textarea":L=!!L.autoFocus;break e;case"img":L=!0;break e;default:L=!1}}L&&(v.flags|=4)}v.ref!==null&&(v.flags|=512,v.flags|=2097152)}return Xa(v),null;case 6:if(p&&v.stateNode!=null)Av(p,v,p.memoizedProps,L);else{if(typeof L!="string"&&v.stateNode===null)throw Error(t(166));if(E=jh(c2.current),jh(Lu.current),n2(v)){if(L=v.stateNode,E=v.memoizedProps,L[Oi]=v,(ee=L.nodeValue!==E)&&(p=f0,p!==null))switch(p.tag){case 3:Yg(L.nodeValue,E,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&Yg(L.nodeValue,E,(p.mode&1)!==0)}ee&&(v.flags|=4)}else L=(E.nodeType===9?E:E.ownerDocument).createTextNode(L),L[Oi]=v,v.stateNode=L}return Xa(v),null;case 13:if(ps(eo),L=v.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(Bs&&Ol!==null&&(v.mode&1)!==0&&(v.flags&128)===0)Fx(),Km(),v.flags|=98560,ee=!1;else if(ee=n2(v),L!==null&&L.dehydrated!==null){if(p===null){if(!ee)throw Error(t(318));if(ee=v.memoizedState,ee=ee!==null?ee.dehydrated:null,!ee)throw Error(t(317));ee[Oi]=v}else Km(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;Xa(v),ee=!1}else Ll!==null&&(N2(Ll),Ll=null),ee=!0;if(!ee)return v.flags&65536?v:null}return(v.flags&128)!==0?(v.lanes=E,v):(L=L!==null,L!==(p!==null&&p.memoizedState!==null)&&L&&(v.child.flags|=8192,(v.mode&1)!==0&&(p===null||(eo.current&1)!==0?Qr===0&&(Qr=3):Vv())),v.updateQueue!==null&&(v.flags|=4),Xa(v),null);case 4:return e1(),Cv(p,v),p===null&&Wm(v.stateNode.containerInfo),Xa(v),null;case 10:return nv(v.type._context),Xa(v),null;case 17:return Dl(v.type)&&Xm(),Xa(v),null;case 19:if(ps(eo),ee=v.memoizedState,ee===null)return Xa(v),null;if(L=(v.flags&128)!==0,pe=ee.rendering,pe===null)if(L)S2(ee,!1);else{if(Qr!==0||p!==null&&(p.flags&128)!==0)for(p=v.child;p!==null;){if(pe=zd(p),pe!==null){for(v.flags|=128,S2(ee,!1),L=pe.updateQueue,L!==null&&(v.updateQueue=L,v.flags|=4),v.subtreeFlags=0,L=E,E=v.child;E!==null;)ee=E,p=L,ee.flags&=14680066,pe=ee.alternate,pe===null?(ee.childLanes=0,ee.lanes=p,ee.child=null,ee.subtreeFlags=0,ee.memoizedProps=null,ee.memoizedState=null,ee.updateQueue=null,ee.dependencies=null,ee.stateNode=null):(ee.childLanes=pe.childLanes,ee.lanes=pe.lanes,ee.child=pe.child,ee.subtreeFlags=0,ee.deletions=null,ee.memoizedProps=pe.memoizedProps,ee.memoizedState=pe.memoizedState,ee.updateQueue=pe.updateQueue,ee.type=pe.type,p=pe.dependencies,ee.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),E=E.sibling;return ws(eo,eo.current&1|2),v.child}p=p.sibling}ee.tail!==null&&me()>Hd&&(v.flags|=128,L=!0,S2(ee,!1),v.lanes=4194304)}else{if(!L)if(p=zd(pe),p!==null){if(v.flags|=128,L=!0,E=p.updateQueue,E!==null&&(v.updateQueue=E,v.flags|=4),S2(ee,!0),ee.tail===null&&ee.tailMode==="hidden"&&!pe.alternate&&!Bs)return Xa(v),null}else 2*me()-ee.renderingStartTime>Hd&&E!==1073741824&&(v.flags|=128,L=!0,S2(ee,!1),v.lanes=4194304);ee.isBackwards?(pe.sibling=v.child,v.child=pe):(E=ee.last,E!==null?E.sibling=pe:v.child=pe,ee.last=pe)}return ee.tail!==null?(v=ee.tail,ee.rendering=v,ee.tail=v.sibling,ee.renderingStartTime=me(),v.sibling=null,E=eo.current,ws(eo,L?E&1|2:E&1),v):(Xa(v),null);case 22:case 23:return g4(),L=v.memoizedState!==null,p!==null&&p.memoizedState!==null!==L&&(v.flags|=8192),L&&(v.mode&1)!==0?(Ul&1073741824)!==0&&(Xa(v),v.subtreeFlags&6&&(v.flags|=8192)):Xa(v),null;case 24:return null;case 25:return null}throw Error(t(156,v.tag))}function Vw(p,v){switch(e2(v),v.tag){case 1:return Dl(v.type)&&Xm(),p=v.flags,p&65536?(v.flags=p&-65537|128,v):null;case 3:return e1(),ps(qa),ps(Ra),t1(),p=v.flags,(p&65536)!==0&&(p&128)===0?(v.flags=p&-65537|128,v):null;case 5:return B9(v),null;case 13:if(ps(eo),p=v.memoizedState,p!==null&&p.dehydrated!==null){if(v.alternate===null)throw Error(t(340));Km()}return p=v.flags,p&65536?(v.flags=p&-65537|128,v):null;case 19:return ps(eo),null;case 4:return e1(),null;case 10:return nv(v.type._context),null;case 22:case 23:return g4(),null;case 24:return null;default:return null}}var i4=!1,pa=!1,Qx=typeof WeakSet=="function"?WeakSet:Set,tr=null;function Wc(p,v){var E=p.ref;if(E!==null)if(typeof E=="function")try{E(null)}catch(L){Xs(p,v,L)}else E.current=null}function $h(p,v,E){try{E()}catch(L){Xs(p,v,L)}}var s4=!1;function Jx(p,v){if(E9=Cm,p=Ex(),L5(p)){if("selectionStart"in p)var E={start:p.selectionStart,end:p.selectionEnd};else e:{E=(E=p.ownerDocument)&&E.defaultView||window;var L=E.getSelection&&E.getSelection();if(L&&L.rangeCount!==0){E=L.anchorNode;var q=L.anchorOffset,ee=L.focusNode;L=L.focusOffset;try{E.nodeType,ee.nodeType}catch{E=null;break e}var pe=0,Fe=-1,Ze=-1,It=0,on=0,fn=p,sn=null;t:for(;;){for(var Xn;fn!==E||q!==0&&fn.nodeType!==3||(Fe=pe+q),fn!==ee||L!==0&&fn.nodeType!==3||(Ze=pe+L),fn.nodeType===3&&(pe+=fn.nodeValue.length),(Xn=fn.firstChild)!==null;)sn=fn,fn=Xn;for(;;){if(fn===p)break t;if(sn===E&&++It===q&&(Fe=pe),sn===ee&&++on===L&&(Ze=pe),(Xn=fn.nextSibling)!==null)break;fn=sn,sn=fn.parentNode}fn=Xn}E=Fe===-1||Ze===-1?null:{start:Fe,end:Ze}}else E=null}E=E||{start:0,end:0}}else E=null;for(M9={focusedElem:p,selectionRange:E},Cm=!1,tr=v;tr!==null;)if(v=tr,p=v.child,(v.subtreeFlags&1028)!==0&&p!==null)p.return=v,tr=p;else for(;tr!==null;){v=tr;try{var nr=v.alternate;if((v.flags&1024)!==0)switch(v.tag){case 0:case 11:case 15:break;case 1:if(nr!==null){var ur=nr.memoizedProps,ao=nr.memoizedState,_t=v.stateNode,lt=_t.getSnapshotBeforeUpdate(v.elementType===v.type?ur:y0(v.type,ur),ao);_t.__reactInternalSnapshotBeforeUpdate=lt}break;case 3:var Ct=v.stateNode.containerInfo;Ct.nodeType===1?Ct.textContent="":Ct.nodeType===9&&Ct.documentElement&&Ct.removeChild(Ct.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Sn){Xs(v,v.return,Sn)}if(p=v.sibling,p!==null){p.return=v.return,tr=p;break}tr=v.return}return nr=s4,s4=!1,nr}function d1(p,v,E){var L=v.updateQueue;if(L=L!==null?L.lastEffect:null,L!==null){var q=L=L.next;do{if((q.tag&p)===p){var ee=q.destroy;q.destroy=void 0,ee!==void 0&&$h(v,E,ee)}q=q.next}while(q!==L)}}function o4(p,v){if(v=v.updateQueue,v=v!==null?v.lastEffect:null,v!==null){var E=v=v.next;do{if((E.tag&p)===p){var L=E.create;E.destroy=L()}E=E.next}while(E!==v)}}function Nv(p){var v=p.ref;if(v!==null){var E=p.stateNode;switch(p.tag){case 5:p=E;break;default:p=E}typeof v=="function"?v(p):v.current=p}}function Pv(p){var v=p.alternate;v!==null&&(p.alternate=null,Pv(v)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(v=p.stateNode,v!==null&&(delete v[Oi],delete v[Zg],delete v[Zp],delete v[Qg],delete v[Qp])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function e7(p){return p.tag===5||p.tag===3||p.tag===4}function Rv(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||e7(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function w2(p,v,E){var L=p.tag;if(L===5||L===6)p=p.stateNode,v?E.nodeType===8?E.parentNode.insertBefore(p,v):E.insertBefore(p,v):(E.nodeType===8?(v=E.parentNode,v.insertBefore(p,E)):(v=E,v.appendChild(p)),E=E._reactRootContainer,E!=null||v.onclick!==null||(v.onclick=Kg));else if(L!==4&&(p=p.child,p!==null))for(w2(p,v,E),p=p.sibling;p!==null;)w2(p,v,E),p=p.sibling}function T2(p,v,E){var L=p.tag;if(L===5||L===6)p=p.stateNode,v?E.insertBefore(p,v):E.appendChild(p);else if(L!==4&&(p=p.child,p!==null))for(T2(p,v,E),p=p.sibling;p!==null;)T2(p,v,E),p=p.sibling}var fa=null,v0=!1;function qc(p,v,E){for(E=E.child;E!==null;)Iv(p,v,E),E=E.sibling}function Iv(p,v,E){if(Un&&typeof Un.onCommitFiberUnmount=="function")try{Un.onCommitFiberUnmount(An,E)}catch{}switch(E.tag){case 5:pa||Wc(E,v);case 6:var L=fa,q=v0;fa=null,qc(p,v,E),fa=L,v0=q,fa!==null&&(v0?(p=fa,E=E.stateNode,p.nodeType===8?p.parentNode.removeChild(E):p.removeChild(E)):fa.removeChild(E.stateNode));break;case 18:fa!==null&&(v0?(p=fa,E=E.stateNode,p.nodeType===8?N9(p.parentNode,E):p.nodeType===1&&N9(p,E),Ah(p)):N9(fa,E.stateNode));break;case 4:L=fa,q=v0,fa=E.stateNode.containerInfo,v0=!0,qc(p,v,E),fa=L,v0=q;break;case 0:case 11:case 14:case 15:if(!pa&&(L=E.updateQueue,L!==null&&(L=L.lastEffect,L!==null))){q=L=L.next;do{var ee=q,pe=ee.destroy;ee=ee.tag,pe!==void 0&&((ee&2)!==0||(ee&4)!==0)&&$h(E,v,pe),q=q.next}while(q!==L)}qc(p,v,E);break;case 1:if(!pa&&(Wc(E,v),L=E.stateNode,typeof L.componentWillUnmount=="function"))try{L.props=E.memoizedProps,L.state=E.memoizedState,L.componentWillUnmount()}catch(Fe){Xs(E,v,Fe)}qc(p,v,E);break;case 21:qc(p,v,E);break;case 22:E.mode&1?(pa=(L=pa)||E.memoizedState!==null,qc(p,v,E),pa=L):qc(p,v,E);break;default:qc(p,v,E)}}function t7(p){var v=p.updateQueue;if(v!==null){p.updateQueue=null;var E=p.stateNode;E===null&&(E=p.stateNode=new Qx),v.forEach(function(L){var q=s7.bind(null,p,L);E.has(L)||(E.add(L),L.then(q,q))})}}function Xc(p,v){var E=v.deletions;if(E!==null)for(var L=0;L<E.length;L++){var q=E[L];try{var ee=p,pe=v,Fe=pe;e:for(;Fe!==null;){switch(Fe.tag){case 5:fa=Fe.stateNode,v0=!1;break e;case 3:fa=Fe.stateNode.containerInfo,v0=!0;break e;case 4:fa=Fe.stateNode.containerInfo,v0=!0;break e}Fe=Fe.return}if(fa===null)throw Error(t(160));Iv(ee,pe,q),fa=null,v0=!1;var Ze=q.alternate;Ze!==null&&(Ze.return=null),q.return=null}catch(It){Xs(q,v,It)}}if(v.subtreeFlags&12854)for(v=v.child;v!==null;)a4(v,p),v=v.sibling}function a4(p,v){var E=p.alternate,L=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Xc(v,p),zu(p),L&4){try{d1(3,p,p.return),o4(3,p)}catch(ur){Xs(p,p.return,ur)}try{d1(5,p,p.return)}catch(ur){Xs(p,p.return,ur)}}break;case 1:Xc(v,p),zu(p),L&512&&E!==null&&Wc(E,E.return);break;case 5:if(Xc(v,p),zu(p),L&512&&E!==null&&Wc(E,E.return),p.flags&32){var q=p.stateNode;try{wn(q,"")}catch(ur){Xs(p,p.return,ur)}}if(L&4&&(q=p.stateNode,q!=null)){var ee=p.memoizedProps,pe=E!==null?E.memoizedProps:ee,Fe=p.type,Ze=p.updateQueue;if(p.updateQueue=null,Ze!==null)try{Fe==="input"&&ee.type==="radio"&&ee.name!=null&&Yr(q,ee),Bn(Fe,pe);var It=Bn(Fe,ee);for(pe=0;pe<Ze.length;pe+=2){var on=Ze[pe],fn=Ze[pe+1];on==="style"?vn(q,fn):on==="dangerouslySetInnerHTML"?Qn(q,fn):on==="children"?wn(q,fn):j(q,on,fn,It)}switch(Fe){case"input":mi(q,ee);break;case"textarea":de(q,ee);break;case"select":var sn=q._wrapperState.wasMultiple;q._wrapperState.wasMultiple=!!ee.multiple;var Xn=ee.value;Xn!=null?Ti(q,!!ee.multiple,Xn,!1):sn!==!!ee.multiple&&(ee.defaultValue!=null?Ti(q,!!ee.multiple,ee.defaultValue,!0):Ti(q,!!ee.multiple,ee.multiple?[]:"",!1))}q[Zg]=ee}catch(ur){Xs(p,p.return,ur)}}break;case 6:if(Xc(v,p),zu(p),L&4){if(p.stateNode===null)throw Error(t(162));q=p.stateNode,ee=p.memoizedProps;try{q.nodeValue=ee}catch(ur){Xs(p,p.return,ur)}}break;case 3:if(Xc(v,p),zu(p),L&4&&E!==null&&E.memoizedState.isDehydrated)try{Ah(v.containerInfo)}catch(ur){Xs(p,p.return,ur)}break;case 4:Xc(v,p),zu(p);break;case 13:Xc(v,p),zu(p),q=p.child,q.flags&8192&&(ee=q.memoizedState!==null,q.stateNode.isHidden=ee,!ee||q.alternate!==null&&q.alternate.memoizedState!==null||(Bv=me())),L&4&&t7(p);break;case 22:if(on=E!==null&&E.memoizedState!==null,p.mode&1?(pa=(It=pa)||on,Xc(v,p),pa=It):Xc(v,p),zu(p),L&8192){if(It=p.memoizedState!==null,(p.stateNode.isHidden=It)&&!on&&(p.mode&1)!==0)for(tr=p,on=p.child;on!==null;){for(fn=tr=on;tr!==null;){switch(sn=tr,Xn=sn.child,sn.tag){case 0:case 11:case 14:case 15:d1(4,sn,sn.return);break;case 1:Wc(sn,sn.return);var nr=sn.stateNode;if(typeof nr.componentWillUnmount=="function"){L=sn,E=sn.return;try{v=L,nr.props=v.memoizedProps,nr.state=v.memoizedState,nr.componentWillUnmount()}catch(ur){Xs(L,E,ur)}}break;case 5:Wc(sn,sn.return);break;case 22:if(sn.memoizedState!==null){Dv(fn);continue}}Xn!==null?(Xn.return=sn,tr=Xn):Dv(fn)}on=on.sibling}e:for(on=null,fn=p;;){if(fn.tag===5){if(on===null){on=fn;try{q=fn.stateNode,It?(ee=q.style,typeof ee.setProperty=="function"?ee.setProperty("display","none","important"):ee.display="none"):(Fe=fn.stateNode,Ze=fn.memoizedProps.style,pe=Ze!=null&&Ze.hasOwnProperty("display")?Ze.display:null,Fe.style.display=en("display",pe))}catch(ur){Xs(p,p.return,ur)}}}else if(fn.tag===6){if(on===null)try{fn.stateNode.nodeValue=It?"":fn.memoizedProps}catch(ur){Xs(p,p.return,ur)}}else if((fn.tag!==22&&fn.tag!==23||fn.memoizedState===null||fn===p)&&fn.child!==null){fn.child.return=fn,fn=fn.child;continue}if(fn===p)break e;for(;fn.sibling===null;){if(fn.return===null||fn.return===p)break e;on===fn&&(on=null),fn=fn.return}on===fn&&(on=null),fn.sibling.return=fn.return,fn=fn.sibling}}break;case 19:Xc(v,p),zu(p),L&4&&t7(p);break;case 21:break;default:Xc(v,p),zu(p)}}function zu(p){var v=p.flags;if(v&2){try{e:{for(var E=p.return;E!==null;){if(e7(E)){var L=E;break e}E=E.return}throw Error(t(160))}switch(L.tag){case 5:var q=L.stateNode;L.flags&32&&(wn(q,""),L.flags&=-33);var ee=Rv(p);T2(p,ee,q);break;case 3:case 4:var pe=L.stateNode.containerInfo,Fe=Rv(p);w2(p,Fe,pe);break;default:throw Error(t(161))}}catch(Ze){Xs(p,p.return,Ze)}p.flags&=-3}v&4096&&(p.flags&=-4097)}function Gw(p,v,E){tr=p,l4(p)}function l4(p,v,E){for(var L=(p.mode&1)!==0;tr!==null;){var q=tr,ee=q.child;if(q.tag===22&&L){var pe=q.memoizedState!==null||i4;if(!pe){var Fe=q.alternate,Ze=Fe!==null&&Fe.memoizedState!==null||pa;Fe=i4;var It=pa;if(i4=pe,(pa=Ze)&&!It)for(tr=q;tr!==null;)pe=tr,Ze=pe.child,pe.tag===22&&pe.memoizedState!==null?Ov(q):Ze!==null?(Ze.return=pe,tr=Ze):Ov(q);for(;ee!==null;)tr=ee,l4(ee),ee=ee.sibling;tr=q,i4=Fe,pa=It}kv(p)}else(q.subtreeFlags&8772)!==0&&ee!==null?(ee.return=q,tr=ee):kv(p)}}function kv(p){for(;tr!==null;){var v=tr;if((v.flags&8772)!==0){var E=v.alternate;try{if((v.flags&8772)!==0)switch(v.tag){case 0:case 11:case 15:pa||o4(5,v);break;case 1:var L=v.stateNode;if(v.flags&4&&!pa)if(E===null)L.componentDidMount();else{var q=v.elementType===v.type?E.memoizedProps:y0(v.type,E.memoizedProps);L.componentDidUpdate(q,E.memoizedState,L.__reactInternalSnapshotBeforeUpdate)}var ee=v.updateQueue;ee!==null&&sv(v,ee,L);break;case 3:var pe=v.updateQueue;if(pe!==null){if(E=null,v.child!==null)switch(v.child.tag){case 5:E=v.child.stateNode;break;case 1:E=v.child.stateNode}sv(v,pe,E)}break;case 5:var Fe=v.stateNode;if(E===null&&v.flags&4){E=Fe;var Ze=v.memoizedProps;switch(v.type){case"button":case"input":case"select":case"textarea":Ze.autoFocus&&E.focus();break;case"img":Ze.src&&(E.src=Ze.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(v.memoizedState===null){var It=v.alternate;if(It!==null){var on=It.memoizedState;if(on!==null){var fn=on.dehydrated;fn!==null&&Ah(fn)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}pa||v.flags&512&&Nv(v)}catch(sn){Xs(v,v.return,sn)}}if(v===p){tr=null;break}if(E=v.sibling,E!==null){E.return=v.return,tr=E;break}tr=v.return}}function Dv(p){for(;tr!==null;){var v=tr;if(v===p){tr=null;break}var E=v.sibling;if(E!==null){E.return=v.return,tr=E;break}tr=v.return}}function Ov(p){for(;tr!==null;){var v=tr;try{switch(v.tag){case 0:case 11:case 15:var E=v.return;try{o4(4,v)}catch(Ze){Xs(v,E,Ze)}break;case 1:var L=v.stateNode;if(typeof L.componentDidMount=="function"){var q=v.return;try{L.componentDidMount()}catch(Ze){Xs(v,q,Ze)}}var ee=v.return;try{Nv(v)}catch(Ze){Xs(v,ee,Ze)}break;case 5:var pe=v.return;try{Nv(v)}catch(Ze){Xs(v,pe,Ze)}}}catch(Ze){Xs(v,v.return,Ze)}if(v===p){tr=null;break}var Fe=v.sibling;if(Fe!==null){Fe.return=v.return,tr=Fe;break}tr=v.return}}var Lv=Math.ceil,E2=C.ReactCurrentDispatcher,h1=C.ReactCurrentOwner,Bl=C.ReactCurrentBatchConfig,Vi=0,Yo=null,Io=null,ma=0,Ul=0,Wh=Dd(0),Qr=0,qh=null,Xh=0,c4=0,Fv=0,cf=null,hl=null,Bv=0,Hd=1/0,Vu=null,u4=!1,d4=null,Yc=null,M2=!1,Kc=null,h4=0,p1=0,f1=null,p4=-1,C2=0;function So(){return(Vi&6)!==0?me():p4!==-1?p4:p4=me()}function Gu(p){return(p.mode&1)===0?1:(Vi&2)!==0&&ma!==0?ma&-ma:Fw.transition!==null?(C2===0&&(C2=Ca()),C2):(p=Ur,p!==0||(p=window.event,p=p===void 0?16:Og(p.type)),p)}function x0(p,v,E,L){if(50<p1)throw p1=0,f1=null,Error(t(185));Wo(p,E,L),((Vi&2)===0||p!==Yo)&&(p===Yo&&((Vi&2)===0&&(c4|=E),Qr===4&&$d(p,ma)),pl(p,L),E===1&&Vi===0&&(v.mode&1)===0&&(Hd=me()+500,Fd&&zh()))}function pl(p,v){var E=p.callbackNode;ua(p,v);var L=$s(p,p===Yo?ma:0);if(L===0)E!==null&&Eh(E),p.callbackNode=null,p.callbackPriority=0;else if(v=L&-L,p.callbackPriority!==v){if(E!=null&&Eh(E),v===1)p.tag===0?Lw(zv.bind(null,p)):Z5(zv.bind(null,p)),Ix(function(){(Vi&6)===0&&zh()}),E=null;else{switch(qo(L)){case 1:E=At;break;case 4:E=wt;break;case 16:E=bt;break;case 536870912:E=jn;break;default:E=bt}E=$v(E,f4.bind(null,p))}p.callbackPriority=v,p.callbackNode=E}}function f4(p,v){if(p4=-1,C2=0,(Vi&6)!==0)throw Error(t(327));var E=p.callbackNode;if(m1()&&p.callbackNode!==E)return null;var L=$s(p,p===Yo?ma:0);if(L===0)return null;if((L&30)!==0||(L&p.expiredLanes)!==0||v)v=R2(p,L);else{v=L;var q=Vi;Vi|=2;var ee=P2();(Yo!==p||ma!==v)&&(Vu=null,Hd=me()+500,zl(p,v));do try{Gv();break}catch(Fe){uf(p,Fe)}while(!0);tv(),E2.current=ee,Vi=q,Io!==null?v=0:(Yo=null,ma=0,v=Qr)}if(v!==0){if(v===2&&(q=pi(p),q!==0&&(L=q,v=A2(p,q))),v===1)throw E=qh,zl(p,0),$d(p,L),pl(p,me()),E;if(v===6)$d(p,L);else{if(q=p.current.alternate,(L&30)===0&&!Uv(q)&&(v=R2(p,L),v===2&&(ee=pi(p),ee!==0&&(L=ee,v=A2(p,ee))),v===1))throw E=qh,zl(p,0),$d(p,L),pl(p,me()),E;switch(p.finishedWork=q,p.finishedLanes=L,v){case 0:case 1:throw Error(t(345));case 2:Zc(p,hl,Vu);break;case 3:if($d(p,L),(L&130023424)===L&&(v=Bv+500-me(),10<v)){if($s(p,0)!==0)break;if(q=p.suspendedLanes,(q&L)!==L){So(),p.pingedLanes|=p.suspendedLanes&q;break}p.timeoutHandle=A9(Zc.bind(null,p,hl,Vu),v);break}Zc(p,hl,Vu);break;case 4:if($d(p,L),(L&4194240)===L)break;for(v=p.eventTimes,q=-1;0<L;){var pe=31-yr(L);ee=1<<pe,pe=v[pe],pe>q&&(q=pe),L&=~ee}if(L=q,L=me()-L,L=(120>L?120:480>L?480:1080>L?1080:1920>L?1920:3e3>L?3e3:4320>L?4320:1960*Lv(L/1960))-L,10<L){p.timeoutHandle=A9(Zc.bind(null,p,hl,Vu),L);break}Zc(p,hl,Vu);break;case 5:Zc(p,hl,Vu);break;default:throw Error(t(329))}}}return pl(p,me()),p.callbackNode===E?f4.bind(null,p):null}function A2(p,v){var E=cf;return p.current.memoizedState.isDehydrated&&(zl(p,v).flags|=256),p=R2(p,v),p!==2&&(v=hl,hl=E,v!==null&&N2(v)),p}function N2(p){hl===null?hl=p:hl.push.apply(hl,p)}function Uv(p){for(var v=p;;){if(v.flags&16384){var E=v.updateQueue;if(E!==null&&(E=E.stores,E!==null))for(var L=0;L<E.length;L++){var q=E[L],ee=q.getSnapshot;q=q.value;try{if(!Pa(ee(),q))return!1}catch{return!1}}}if(E=v.child,v.subtreeFlags&16384&&E!==null)E.return=v,v=E;else{if(v===p)break;for(;v.sibling===null;){if(v.return===null||v.return===p)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function $d(p,v){for(v&=~Fv,v&=~c4,p.suspendedLanes|=v,p.pingedLanes&=~v,p=p.expirationTimes;0<v;){var E=31-yr(v),L=1<<E;p[E]=-1,v&=~L}}function zv(p){if((Vi&6)!==0)throw Error(t(327));m1();var v=$s(p,0);if((v&1)===0)return pl(p,me()),null;var E=R2(p,v);if(p.tag!==0&&E===2){var L=pi(p);L!==0&&(v=L,E=A2(p,L))}if(E===1)throw E=qh,zl(p,0),$d(p,v),pl(p,me()),E;if(E===6)throw Error(t(345));return p.finishedWork=p.current.alternate,p.finishedLanes=v,Zc(p,hl,Vu),pl(p,me()),null}function m4(p,v){var E=Vi;Vi|=1;try{return p(v)}finally{Vi=E,Vi===0&&(Hd=me()+500,Fd&&zh())}}function Yh(p){Kc!==null&&Kc.tag===0&&(Vi&6)===0&&m1();var v=Vi;Vi|=1;var E=Bl.transition,L=Ur;try{if(Bl.transition=null,Ur=1,p)return p()}finally{Ur=L,Bl.transition=E,Vi=v,(Vi&6)===0&&zh()}}function g4(){Ul=Wh.current,ps(Wh)}function zl(p,v){p.finishedWork=null,p.finishedLanes=0;var E=p.timeoutHandle;if(E!==-1&&(p.timeoutHandle=-1,Rx(E)),Io!==null)for(E=Io.return;E!==null;){var L=E;switch(e2(L),L.tag){case 1:L=L.type.childContextTypes,L!=null&&Xm();break;case 3:e1(),ps(qa),ps(Ra),t1();break;case 5:B9(L);break;case 4:e1();break;case 13:ps(eo);break;case 19:ps(eo);break;case 10:nv(L.type._context);break;case 22:case 23:g4()}E=E.return}if(Yo=p,Io=p=ju(p.current,null),ma=Ul=v,Qr=0,qh=null,Fv=c4=Xh=0,hl=cf=null,m0!==null){for(v=0;v<m0.length;v++)if(E=m0[v],L=E.interleaved,L!==null){E.interleaved=null;var q=L.next,ee=E.pending;if(ee!==null){var pe=ee.next;ee.next=q,L.next=pe}E.pending=L}m0=null}return p}function uf(p,v){do{var E=Io;try{if(tv(),u2.current=Bu,U9){for(var L=fs.memoizedState;L!==null;){var q=L.queue;q!==null&&(q.pending=null),L=L.next}U9=!1}if(Vd=0,ha=qs=fs=null,n1=!1,d2=0,h1.current=null,E===null||E.return===null){Qr=1,qh=v,Io=null;break}e:{var ee=p,pe=E.return,Fe=E,Ze=v;if(v=ma,Fe.flags|=32768,Ze!==null&&typeof Ze=="object"&&typeof Ze.then=="function"){var It=Ze,on=Fe,fn=on.tag;if((on.mode&1)===0&&(fn===0||fn===11||fn===15)){var sn=on.alternate;sn?(on.updateQueue=sn.updateQueue,on.memoizedState=sn.memoizedState,on.lanes=sn.lanes):(on.updateQueue=null,on.memoizedState=null)}var Xn=gv(pe);if(Xn!==null){Xn.flags&=-257,b2(Xn,pe,Fe,ee,v),Xn.mode&1&&qx(ee,It,v),v=Xn,Ze=It;var nr=v.updateQueue;if(nr===null){var ur=new Set;ur.add(Ze),v.updateQueue=ur}else nr.add(Ze);break e}else{if((v&1)===0){qx(ee,It,v),Vv();break e}Ze=Error(t(426))}}else if(Bs&&Fe.mode&1){var ao=gv(pe);if(ao!==null){(ao.flags&65536)===0&&(ao.flags|=256),b2(ao,pe,Fe,ee,v),I9(c1(Ze,Fe));break e}}ee=Ze=c1(Ze,Fe),Qr!==4&&(Qr=2),cf===null?cf=[ee]:cf.push(ee),ee=pe;do{switch(ee.tag){case 3:ee.flags|=65536,v&=-v,ee.lanes|=v;var _t=mv(ee,Ze,v);iv(ee,_t);break e;case 1:Fe=Ze;var lt=ee.type,Ct=ee.stateNode;if((ee.flags&128)===0&&(typeof lt.getDerivedStateFromError=="function"||Ct!==null&&typeof Ct.componentDidCatch=="function"&&(Yc===null||!Yc.has(Ct)))){ee.flags|=65536,v&=-v,ee.lanes|=v;var Sn=x2(ee,Fe,v);iv(ee,Sn);break e}}ee=ee.return}while(ee!==null)}jv(E)}catch(vr){v=vr,Io===E&&E!==null&&(Io=E=E.return);continue}break}while(!0)}function P2(){var p=E2.current;return E2.current=Bu,p===null?Bu:p}function Vv(){(Qr===0||Qr===3||Qr===2)&&(Qr=4),Yo===null||(Xh&268435455)===0&&(c4&268435455)===0||$d(Yo,ma)}function R2(p,v){var E=Vi;Vi|=2;var L=P2();(Yo!==p||ma!==v)&&(Vu=null,zl(p,v));do try{n7();break}catch(q){uf(p,q)}while(!0);if(tv(),Vi=E,E2.current=L,Io!==null)throw Error(t(261));return Yo=null,ma=0,Qr}function n7(){for(;Io!==null;)y4(Io)}function Gv(){for(;Io!==null&&!wm();)y4(Io)}function y4(p){var v=g1(p.alternate,p,Ul);p.memoizedProps=p.pendingProps,v===null?jv(p):Io=v,h1.current=null}function jv(p){var v=p;do{var E=v.alternate;if(p=v.return,(v.flags&32768)===0){if(E=Zx(E,v,Ul),E!==null){Io=E;return}}else{if(E=Vw(E,v),E!==null){E.flags&=32767,Io=E;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{Qr=6,Io=null;return}}if(v=v.sibling,v!==null){Io=v;return}Io=v=p}while(v!==null);Qr===0&&(Qr=5)}function Zc(p,v,E){var L=Ur,q=Bl.transition;try{Bl.transition=null,Ur=1,r7(p,v,E,L)}finally{Bl.transition=q,Ur=L}return null}function r7(p,v,E,L){do m1();while(Kc!==null);if((Vi&6)!==0)throw Error(t(327));E=p.finishedWork;var q=p.finishedLanes;if(E===null)return null;if(p.finishedWork=null,p.finishedLanes=0,E===p.current)throw Error(t(177));p.callbackNode=null,p.callbackPriority=0;var ee=E.lanes|E.childLanes;if(Cu(p,ee),p===Yo&&(Io=Yo=null,ma=0),(E.subtreeFlags&2064)===0&&(E.flags&2064)===0||M2||(M2=!0,$v(bt,function(){return m1(),null})),ee=(E.flags&15990)!==0,(E.subtreeFlags&15990)!==0||ee){ee=Bl.transition,Bl.transition=null;var pe=Ur;Ur=1;var Fe=Vi;Vi|=4,h1.current=null,Jx(p,E),a4(E,p),Mx(M9),Cm=!!E9,M9=E9=null,p.current=E,Gw(E),Tm(),Vi=Fe,Ur=pe,Bl.transition=ee}else p.current=E;if(M2&&(M2=!1,Kc=p,h4=q),ee=p.pendingLanes,ee===0&&(Yc=null),er(E.stateNode),pl(p,me()),v!==null)for(L=p.onRecoverableError,E=0;E<v.length;E++)q=v[E],L(q.value,{componentStack:q.stack,digest:q.digest});if(u4)throw u4=!1,p=d4,d4=null,p;return(h4&1)!==0&&p.tag!==0&&m1(),ee=p.pendingLanes,(ee&1)!==0?p===f1?p1++:(p1=0,f1=p):p1=0,zh(),null}function m1(){if(Kc!==null){var p=qo(h4),v=Bl.transition,E=Ur;try{if(Bl.transition=null,Ur=16>p?16:p,Kc===null)var L=!1;else{if(p=Kc,Kc=null,h4=0,(Vi&6)!==0)throw Error(t(331));var q=Vi;for(Vi|=4,tr=p.current;tr!==null;){var ee=tr,pe=ee.child;if((tr.flags&16)!==0){var Fe=ee.deletions;if(Fe!==null){for(var Ze=0;Ze<Fe.length;Ze++){var It=Fe[Ze];for(tr=It;tr!==null;){var on=tr;switch(on.tag){case 0:case 11:case 15:d1(8,on,ee)}var fn=on.child;if(fn!==null)fn.return=on,tr=fn;else for(;tr!==null;){on=tr;var sn=on.sibling,Xn=on.return;if(Pv(on),on===It){tr=null;break}if(sn!==null){sn.return=Xn,tr=sn;break}tr=Xn}}}var nr=ee.alternate;if(nr!==null){var ur=nr.child;if(ur!==null){nr.child=null;do{var ao=ur.sibling;ur.sibling=null,ur=ao}while(ur!==null)}}tr=ee}}if((ee.subtreeFlags&2064)!==0&&pe!==null)pe.return=ee,tr=pe;else e:for(;tr!==null;){if(ee=tr,(ee.flags&2048)!==0)switch(ee.tag){case 0:case 11:case 15:d1(9,ee,ee.return)}var _t=ee.sibling;if(_t!==null){_t.return=ee.return,tr=_t;break e}tr=ee.return}}var lt=p.current;for(tr=lt;tr!==null;){pe=tr;var Ct=pe.child;if((pe.subtreeFlags&2064)!==0&&Ct!==null)Ct.return=pe,tr=Ct;else e:for(pe=lt;tr!==null;){if(Fe=tr,(Fe.flags&2048)!==0)try{switch(Fe.tag){case 0:case 11:case 15:o4(9,Fe)}}catch(vr){Xs(Fe,Fe.return,vr)}if(Fe===pe){tr=null;break e}var Sn=Fe.sibling;if(Sn!==null){Sn.return=Fe.return,tr=Sn;break e}tr=Fe.return}}if(Vi=q,zh(),Un&&typeof Un.onPostCommitFiberRoot=="function")try{Un.onPostCommitFiberRoot(An,p)}catch{}L=!0}return L}finally{Ur=E,Bl.transition=v}}return!1}function I2(p,v,E){v=c1(E,v),v=mv(p,v,1),p=$c(p,v,1),v=So(),p!==null&&(Wo(p,1,v),pl(p,v))}function Xs(p,v,E){if(p.tag===3)I2(p,p,E);else for(;v!==null;){if(v.tag===3){I2(v,p,E);break}else if(v.tag===1){var L=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof L.componentDidCatch=="function"&&(Yc===null||!Yc.has(L))){p=c1(E,p),p=x2(v,p,1),v=$c(v,p,1),p=So(),v!==null&&(Wo(v,1,p),pl(v,p));break}}v=v.return}}function jw(p,v,E){var L=p.pingCache;L!==null&&L.delete(v),v=So(),p.pingedLanes|=p.suspendedLanes&E,Yo===p&&(ma&E)===E&&(Qr===4||Qr===3&&(ma&130023424)===ma&&500>me()-Bv?zl(p,0):Fv|=E),pl(p,v)}function Hv(p,v){v===0&&((p.mode&1)===0?v=1:(v=ss,ss<<=1,(ss&130023424)===0&&(ss=4194304)));var E=So();p=Ud(p,v),p!==null&&(Wo(p,v,E),pl(p,E))}function i7(p){var v=p.memoizedState,E=0;v!==null&&(E=v.retryLane),Hv(p,E)}function s7(p,v){var E=0;switch(p.tag){case 13:var L=p.stateNode,q=p.memoizedState;q!==null&&(E=q.retryLane);break;case 19:L=p.stateNode;break;default:throw Error(t(314))}L!==null&&L.delete(v),Hv(p,E)}var g1;g1=function(p,v,E){if(p!==null)if(p.memoizedProps!==v.pendingProps||qa.current)Fl=!0;else{if((p.lanes&E)===0&&(v.flags&128)===0)return Fl=!1,zw(p,v,E);Fl=(p.flags&131072)!==0}else Fl=!1,Bs&&(v.flags&1048576)!==0&&Ox(v,Jp,v.index);switch(v.lanes=0,v.tag){case 2:var L=v.type;_2(p,v),p=v.pendingProps;var q=Uh(v,Ra.current);Bd(v,E),q=z9(null,v,L,p,q,E);var ee=h2();return v.flags|=1,typeof q=="object"&&q!==null&&typeof q.render=="function"&&q.$$typeof===void 0?(v.tag=1,v.memoizedState=null,v.updateQueue=null,Dl(L)?(ee=!0,Jg(v)):ee=!1,v.memoizedState=q.state!==null&&q.state!==void 0?q.state:null,O9(v),q.updater=Uu,v.stateNode=q,q._reactInternals=v,y2(v,L,p,E),v=Sv(null,v,L,!0,ee,E)):(v.tag=0,Bs&&ee&&tf(v),Ia(null,v,q,E),v=v.child),v;case 16:L=v.elementType;e:{switch(_2(p,v),p=v.pendingProps,q=L._init,L=q(L._payload),v.type=L,q=v.tag=v4(L),p=y0(L,p),q){case 0:v=u1(null,v,L,p,E);break e;case 1:v=_v(null,v,L,p,E);break e;case 11:v=J9(null,v,L,p,E);break e;case 14:v=vv(null,v,L,y0(L.type,p),E);break e}throw Error(t(306,L,""))}return v;case 0:return L=v.type,q=v.pendingProps,q=v.elementType===L?q:y0(L,q),u1(p,v,L,q,E);case 1:return L=v.type,q=v.pendingProps,q=v.elementType===L?q:y0(L,q),_v(p,v,L,q,E);case 3:e:{if(wv(v),p===null)throw Error(t(387));L=v.pendingProps,ee=v.memoizedState,q=ee.element,Bx(p,v),a2(v,L,null,E);var pe=v.memoizedState;if(L=pe.element,ee.isDehydrated)if(ee={element:L,isDehydrated:!1,cache:pe.cache,pendingSuspenseBoundaries:pe.pendingSuspenseBoundaries,transitions:pe.transitions},v.updateQueue.baseState=ee,v.memoizedState=ee,v.flags&256){q=c1(Error(t(423)),v),v=Tv(p,v,L,E,q);break e}else if(L!==q){q=c1(Error(t(424)),v),v=Tv(p,v,L,E,q);break e}else for(Ol=Rd(v.stateNode.containerInfo.firstChild),f0=v,Bs=!0,Ll=null,E=ev(v,null,L,E),v.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling;else{if(Km(),L===q){v=jd(p,v,E);break e}Ia(p,v,L,E)}v=v.child}return v;case 5:return Ux(v),p===null&&Ym(v),L=v.type,q=v.pendingProps,ee=p!==null?p.memoizedProps:null,pe=q.children,C9(L,q)?pe=null:ee!==null&&C9(L,ee)&&(v.flags|=32),bv(p,v),Ia(p,v,pe,E),v.child;case 6:return p===null&&Ym(v),null;case 13:return Xx(p,v,E);case 4:return F9(v,v.stateNode.containerInfo),L=v.pendingProps,p===null?v.child=nf(v,null,L,E):Ia(p,v,L,E),v.child;case 11:return L=v.type,q=v.pendingProps,q=v.elementType===L?q:y0(L,q),J9(p,v,L,q,E);case 7:return Ia(p,v,v.pendingProps,E),v.child;case 8:return Ia(p,v,v.pendingProps.children,E),v.child;case 12:return Ia(p,v,v.pendingProps.children,E),v.child;case 10:e:{if(L=v.type._context,q=v.pendingProps,ee=v.memoizedProps,pe=q.value,ws(k9,L._currentValue),L._currentValue=pe,ee!==null)if(Pa(ee.value,pe)){if(ee.children===q.children&&!qa.current){v=jd(p,v,E);break e}}else for(ee=v.child,ee!==null&&(ee.return=v);ee!==null;){var Fe=ee.dependencies;if(Fe!==null){pe=ee.child;for(var Ze=Fe.firstContext;Ze!==null;){if(Ze.context===L){if(ee.tag===1){Ze=g0(-1,E&-E),Ze.tag=2;var It=ee.updateQueue;if(It!==null){It=It.shared;var on=It.pending;on===null?Ze.next=Ze:(Ze.next=on.next,on.next=Ze),It.pending=Ze}}ee.lanes|=E,Ze=ee.alternate,Ze!==null&&(Ze.lanes|=E),Zm(ee.return,E,v),Fe.lanes|=E;break}Ze=Ze.next}}else if(ee.tag===10)pe=ee.type===v.type?null:ee.child;else if(ee.tag===18){if(pe=ee.return,pe===null)throw Error(t(341));pe.lanes|=E,Fe=pe.alternate,Fe!==null&&(Fe.lanes|=E),Zm(pe,E,v),pe=ee.sibling}else pe=ee.child;if(pe!==null)pe.return=ee;else for(pe=ee;pe!==null;){if(pe===v){pe=null;break}if(ee=pe.sibling,ee!==null){ee.return=pe.return,pe=ee;break}pe=pe.return}ee=pe}Ia(p,v,q.children,E),v=v.child}return v;case 9:return q=v.type,L=v.pendingProps.children,Bd(v,E),q=Y0(q),L=L(q),v.flags|=1,Ia(p,v,L,E),v.child;case 14:return L=v.type,q=y0(L,v.pendingProps),q=y0(L.type,q),vv(p,v,L,q,E);case 15:return e4(p,v,v.type,v.pendingProps,E);case 17:return L=v.type,q=v.pendingProps,q=v.elementType===L?q:y0(L,q),_2(p,v),v.tag=1,Dl(L)?(p=!0,Jg(v)):p=!1,Bd(v,E),l1(v,L,q),y2(v,L,q,E),Sv(null,v,L,!0,p,E);case 19:return Yx(p,v,E);case 22:return xv(p,v,E)}throw Error(t(156,v.tag))};function $v(p,v){return Sm(p,v)}function o7(p,v,E,L){this.tag=p,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=L,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Q0(p,v,E,L){return new o7(p,v,E,L)}function k2(p){return p=p.prototype,!(!p||!p.isReactComponent)}function v4(p){if(typeof p=="function")return k2(p)?1:0;if(p!=null){if(p=p.$$typeof,p===Me)return 11;if(p===Ie)return 14}return 2}function ju(p,v){var E=p.alternate;return E===null?(E=Q0(p.tag,v,p.key,p.mode),E.elementType=p.elementType,E.type=p.type,E.stateNode=p.stateNode,E.alternate=p,p.alternate=E):(E.pendingProps=v,E.type=p.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=p.flags&14680064,E.childLanes=p.childLanes,E.lanes=p.lanes,E.child=p.child,E.memoizedProps=p.memoizedProps,E.memoizedState=p.memoizedState,E.updateQueue=p.updateQueue,v=p.dependencies,E.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},E.sibling=p.sibling,E.index=p.index,E.ref=p.ref,E}function x4(p,v,E,L,q,ee){var pe=2;if(L=p,typeof p=="function")k2(p)&&(pe=1);else if(typeof p=="string")pe=5;else e:switch(p){case se:return df(E.children,q,ee,v);case z:pe=8,q|=8;break;case re:return p=Q0(12,E,v,q|2),p.elementType=re,p.lanes=ee,p;case Oe:return p=Q0(13,E,v,q),p.elementType=Oe,p.lanes=ee,p;case Ue:return p=Q0(19,E,v,q),p.elementType=Ue,p.lanes=ee,p;case Ve:return D2(E,q,ee,v);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case ye:pe=10;break e;case H:pe=9;break e;case Me:pe=11;break e;case Ie:pe=14;break e;case ce:pe=16,L=null;break e}throw Error(t(130,p==null?p:typeof p,""))}return v=Q0(pe,E,v,q),v.elementType=p,v.type=L,v.lanes=ee,v}function df(p,v,E,L){return p=Q0(7,p,L,v),p.lanes=E,p}function D2(p,v,E,L){return p=Q0(22,p,L,v),p.elementType=Ve,p.lanes=E,p.stateNode={isHidden:!1},p}function Wv(p,v,E){return p=Q0(6,p,null,v),p.lanes=E,p}function qv(p,v,E){return v=Q0(4,p.children!==null?p.children:[],p.key,v),v.lanes=E,v.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},v}function Xv(p,v,E,L,q){this.tag=v,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=oo(0),this.expirationTimes=oo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=oo(0),this.identifierPrefix=L,this.onRecoverableError=q,this.mutableSourceEagerHydrationData=null}function b4(p,v,E,L,q,ee,pe,Fe,Ze){return p=new Xv(p,v,E,Fe,Ze),v===1?(v=1,ee===!0&&(v|=8)):v=0,ee=Q0(3,null,null,v),p.current=ee,ee.stateNode=p,ee.memoizedState={element:L,isDehydrated:E,cache:null,transitions:null,pendingSuspenseBoundaries:null},O9(ee),p}function a7(p,v,E){var L=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ie,key:L==null?null:""+L,children:p,containerInfo:v,implementation:E}}function Yv(p){if(!p)return Bh;p=p._reactInternals;e:{if($o(p)!==p||p.tag!==1)throw Error(t(170));var v=p;do{switch(v.tag){case 3:v=v.stateNode.context;break e;case 1:if(Dl(v.type)){v=v.stateNode.__reactInternalMemoizedMergedChildContext;break e}}v=v.return}while(v!==null);throw Error(t(171))}if(p.tag===1){var E=p.type;if(Dl(E))return K5(p,E,v)}return v}function _4(p,v,E,L,q,ee,pe,Fe,Ze){return p=b4(E,L,!0,p,q,ee,pe,Fe,Ze),p.context=Yv(null),E=p.current,L=So(),q=Gu(E),ee=g0(L,q),ee.callback=v??null,$c(E,ee,q),p.current.lanes=q,Wo(p,q,L),pl(p,L),p}function O2(p,v,E,L){var q=v.current,ee=So(),pe=Gu(q);return E=Yv(E),v.context===null?v.context=E:v.pendingContext=E,v=g0(ee,pe),v.payload={element:p},L=L===void 0?null:L,L!==null&&(v.callback=L),p=$c(q,v,pe),p!==null&&(x0(p,q,pe,ee),L9(p,q,pe)),pe}function L2(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function Kv(p,v){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var E=p.retryLane;p.retryLane=E!==0&&E<v?E:v}}function S4(p,v){Kv(p,v),(p=p.alternate)&&Kv(p,v)}function l7(){return null}var Zv=typeof reportError=="function"?reportError:function(p){console.error(p)};function w4(p){this._internalRoot=p}F2.prototype.render=w4.prototype.render=function(p){var v=this._internalRoot;if(v===null)throw Error(t(409));O2(p,v,null,null)},F2.prototype.unmount=w4.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var v=p.containerInfo;Yh(function(){O2(null,p,null,null)}),v[kl]=null}};function F2(p){this._internalRoot=p}F2.prototype.unstable_scheduleHydration=function(p){if(p){var v=Mh();p={blockedOn:null,target:p,priority:v};for(var E=0;E<Dc.length&&v!==0&&v<Dc[E].priority;E++);Dc.splice(E,0,p),E===0&&Au(p)}};function T4(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function B2(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function Qv(){}function c7(p,v,E,L,q){if(q){if(typeof L=="function"){var ee=L;L=function(){var It=L2(pe);ee.call(It)}}var pe=_4(v,L,p,0,null,!1,!1,"",Qv);return p._reactRootContainer=pe,p[kl]=pe.current,Wm(p.nodeType===8?p.parentNode:p),Yh(),pe}for(;q=p.lastChild;)p.removeChild(q);if(typeof L=="function"){var Fe=L;L=function(){var It=L2(Ze);Fe.call(It)}}var Ze=b4(p,0,!1,null,null,!1,!1,"",Qv);return p._reactRootContainer=Ze,p[kl]=Ze.current,Wm(p.nodeType===8?p.parentNode:p),Yh(function(){O2(v,Ze,E,L)}),Ze}function U2(p,v,E,L,q){var ee=E._reactRootContainer;if(ee){var pe=ee;if(typeof q=="function"){var Fe=q;q=function(){var Ze=L2(pe);Fe.call(Ze)}}O2(v,pe,p,q)}else pe=c7(E,v,p,q,L);return L2(pe)}As=function(p){switch(p.tag){case 3:var v=p.stateNode;if(v.current.memoizedState.isDehydrated){var E=hi(v.pendingLanes);E!==0&&(Ai(v,E|1),pl(v,me()),(Vi&6)===0&&(Hd=me()+500,zh()))}break;case 13:Yh(function(){var L=Ud(p,1);if(L!==null){var q=So();x0(L,p,1,q)}}),S4(p,1)}},Rl=function(p){if(p.tag===13){var v=Ud(p,134217728);if(v!==null){var E=So();x0(v,p,134217728,E)}S4(p,134217728)}},Wa=function(p){if(p.tag===13){var v=Gu(p),E=Ud(p,v);if(E!==null){var L=So();x0(E,p,v,L)}S4(p,v)}},Mh=function(){return Ur},Ic=function(p,v){var E=Ur;try{return Ur=p,v()}finally{Ur=E}},_n=function(p,v,E){switch(v){case"input":if(mi(p,E),v=E.name,E.type==="radio"&&v!=null){for(E=p;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll("input[name="+JSON.stringify(""+v)+'][type="radio"]'),v=0;v<E.length;v++){var L=E[v];if(L!==p&&L.form===p.form){var q=Ru(L);if(!q)throw Error(t(90));ns(L),mi(L,q)}}}break;case"textarea":de(p,E);break;case"select":v=E.value,v!=null&&Ti(p,!!E.multiple,v,!1)}},Br=m4,Hi=Yh;var Jv={usingClientEntryPoint:!1,Events:[Fh,Id,Ru,jt,Wn,m4]},y1={findFiberByHostInstance:W0,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Hw={bundleType:y1.bundleType,version:y1.version,rendererPackageName:y1.rendererPackageName,rendererConfig:y1.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:C.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=ca(p),p===null?null:p.stateNode},findFiberByHostInstance:y1.findFiberByHostInstance||l7,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var E4=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!E4.isDisabled&&E4.supportsFiber)try{An=E4.inject(Hw),Un=E4}catch{}}return od.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jv,od.createPortal=function(p,v){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!T4(v))throw Error(t(200));return a7(p,v,null,E)},od.createRoot=function(p,v){if(!T4(p))throw Error(t(299));var E=!1,L="",q=Zv;return v!=null&&(v.unstable_strictMode===!0&&(E=!0),v.identifierPrefix!==void 0&&(L=v.identifierPrefix),v.onRecoverableError!==void 0&&(q=v.onRecoverableError)),v=b4(p,1,!1,null,null,E,!1,L,q),p[kl]=v.current,Wm(p.nodeType===8?p.parentNode:p),new w4(v)},od.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var v=p._reactInternals;if(v===void 0)throw typeof p.render=="function"?Error(t(188)):(p=Object.keys(p).join(","),Error(t(268,p)));return p=ca(v),p=p===null?null:p.stateNode,p},od.flushSync=function(p){return Yh(p)},od.hydrate=function(p,v,E){if(!B2(v))throw Error(t(200));return U2(null,p,v,!0,E)},od.hydrateRoot=function(p,v,E){if(!T4(p))throw Error(t(405));var L=E!=null&&E.hydratedSources||null,q=!1,ee="",pe=Zv;if(E!=null&&(E.unstable_strictMode===!0&&(q=!0),E.identifierPrefix!==void 0&&(ee=E.identifierPrefix),E.onRecoverableError!==void 0&&(pe=E.onRecoverableError)),v=_4(v,null,p,1,E??null,q,!1,ee,pe),p[kl]=v.current,Wm(p),L)for(p=0;p<L.length;p++)E=L[p],q=E._getVersion,q=q(E._source),v.mutableSourceEagerHydrationData==null?v.mutableSourceEagerHydrationData=[E,q]:v.mutableSourceEagerHydrationData.push(E,q);return new F2(v)},od.render=function(p,v,E){if(!B2(v))throw Error(t(200));return U2(null,p,v,!1,E)},od.unmountComponentAtNode=function(p){if(!B2(p))throw Error(t(40));return p._reactRootContainer?(Yh(function(){U2(null,null,p,!1,function(){p._reactRootContainer=null,p[kl]=null})}),!0):!1},od.unstable_batchedUpdates=m4,od.unstable_renderSubtreeIntoContainer=function(p,v,E,L){if(!B2(E))throw Error(t(200));if(p==null||p._reactInternals===void 0)throw Error(t(38));return U2(p,v,E,!1,L)},od.version="18.3.1-next-f1338f8080-20240426",od}var U8e;function qze(){if(U8e)return $W.exports;U8e=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),$W.exports=Wze(),$W.exports}var z8e;function Xze(){if(z8e)return HD;z8e=1;var s=qze();return HD.createRoot=s.createRoot,HD.hydrateRoot=s.hydrateRoot,HD}var Yze=Xze();const Kze=A_e(Yze);var SC={exports:{}},XW={},V8e;function un(){return V8e||(V8e=1,function(s){var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(le,Ee,tt)=>Ee in le?e(le,Ee,{enumerable:!0,configurable:!0,writable:!0,value:tt}):le[Ee]=tt,c=(le,Ee)=>{for(var tt in Ee||(Ee={}))i.call(Ee,tt)&&l(le,tt,Ee[tt]);if(r)for(var tt of r(Ee))o.call(Ee,tt)&&l(le,tt,Ee[tt]);return le},h=(le,Ee)=>t(le,n(Ee)),m=le=>e(le,"__esModule",{value:!0}),y=(le,Ee)=>{m(le);for(var tt in Ee)e(le,tt,{get:Ee[tt],enumerable:!0})};y(s,{Atom:()=>Wp,PointerProxy:()=>b9,Ticker:()=>Vc,getPointerParts:()=>G0,isPointer:()=>Bc,isPrism:()=>Nu,iterateAndCountTicks:()=>Pd,iterateOver:()=>Um,pointer:()=>Gp,pointerToPrism:()=>kh,prism:()=>zc,val:()=>$0});var b=Array.isArray,w=b,A=typeof D0=="object"&&D0&&D0.Object===Object&&D0,I=A,D=typeof self=="object"&&self&&self.Object===Object&&self,P=I||D||Function("return this")(),U=P,j=U.Symbol,C=j,Z=Object.prototype,ie=Z.hasOwnProperty,se=Z.toString,z=C?C.toStringTag:void 0;function re(le){var Ee=ie.call(le,z),tt=le[z];try{le[z]=void 0;var Ft=!0}catch{}var kr=se.call(le);return Ft&&(Ee?le[z]=tt:delete le[z]),kr}var ye=re,H=Object.prototype,Me=H.toString;function Oe(le){return Me.call(le)}var Ue=Oe,Ie="[object Null]",ce="[object Undefined]",Ve=C?C.toStringTag:void 0;function Pe(le){return le==null?le===void 0?ce:Ie:Ve&&Ve in Object(le)?ye(le):Ue(le)}var We=Pe;function pt(le){return le!=null&&typeof le=="object"}var Ne=pt,st="[object Symbol]";function Pt(le){return typeof le=="symbol"||Ne(le)&&We(le)==st}var yn=Pt,bn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,St=/^\w*$/;function Ut(le,Ee){if(w(le))return!1;var tt=typeof le;return tt=="number"||tt=="symbol"||tt=="boolean"||le==null||yn(le)?!0:St.test(le)||!bn.test(le)||Ee!=null&&le in Object(Ee)}var Wt=Ut;function kn(le){var Ee=typeof le;return le!=null&&(Ee=="object"||Ee=="function")}var Dn=kn,or="[object AsyncFunction]",ns="[object Function]",Xr="[object GeneratorFunction]",Vr="[object Proxy]";function Kr(le){if(!Dn(le))return!1;var Ee=We(le);return Ee==ns||Ee==Xr||Ee==or||Ee==Vr}var Yr=Kr,mi=U["__core-js_shared__"],Ke=mi,_s=function(){var le=/[^.]+$/.exec(Ke&&Ke.keys&&Ke.keys.IE_PROTO||"");return le?"Symbol(src)_1."+le:""}();function ui(le){return!!_s&&_s in le}var Ti=ui,Vn=Function.prototype,ke=Vn.toString;function de(le){if(le!=null){try{return ke.call(le)}catch{}try{return le+""}catch{}}return""}var ht=de,Xt=/[\\^$.*+?()[\]{}|]/g,Kt=/^\[object .+?Constructor\]$/,Vt=Function.prototype,Qn=Object.prototype,wn=Vt.toString,ar=Qn.hasOwnProperty,Ir=RegExp("^"+wn.call(ar).replace(Xt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function en(le){if(!Dn(le)||Ti(le))return!1;var Ee=Yr(le)?Ir:Kt;return Ee.test(ht(le))}var vn=en;function Gn(le,Ee){return le==null?void 0:le[Ee]}var $n=Gn;function Bn(le,Ee){var tt=$n(le,Ee);return vn(tt)?tt:void 0}var Cr=Bn,et=Cr(Object,"create"),_n=et;function pn(){this.__data__=_n?_n(null):{},this.size=0}var Nn=pn;function cn(le){var Ee=this.has(le)&&delete this.__data__[le];return this.size-=Ee?1:0,Ee}var jt=cn,Wn="__lodash_hash_undefined__",Br=Object.prototype,Hi=Br.hasOwnProperty;function Pr(le){var Ee=this.__data__;if(_n){var tt=Ee[le];return tt===Wn?void 0:tt}return Hi.call(Ee,le)?Ee[le]:void 0}var Ls=Pr,la=Object.prototype,Sd=la.hasOwnProperty;function u0(le){var Ee=this.__data__;return _n?Ee[le]!==void 0:Sd.call(Ee,le)}var Up=u0,Pc="__lodash_hash_undefined__";function wd(le,Ee){var tt=this.__data__;return this.size+=this.has(le)?0:1,tt[le]=_n&&Ee===void 0?Pc:Ee,this}var Pl=wd;function cl(le){var Ee=-1,tt=le==null?0:le.length;for(this.clear();++Ee<tt;){var Ft=le[Ee];this.set(Ft[0],Ft[1])}}cl.prototype.clear=Nn,cl.prototype.delete=jt,cl.prototype.get=Ls,cl.prototype.has=Up,cl.prototype.set=Pl;var wh=cl;function _m(){this.__data__=[],this.size=0}var Th=_m;function $o(le,Ee){return le===Ee||le!==le&&Ee!==Ee}var Mu=$o;function Rc(le,Ee){for(var tt=le.length;tt--;)if(Mu(le[tt][0],Ee))return tt;return-1}var Td=Rc,ca=Array.prototype,ul=ca.splice;function Sm(le){var Ee=this.__data__,tt=Td(Ee,le);if(tt<0)return!1;var Ft=Ee.length-1;return tt==Ft?Ee.pop():ul.call(Ee,tt,1),--this.size,!0}var Eh=Sm;function wm(le){var Ee=this.__data__,tt=Td(Ee,le);return tt<0?void 0:Ee[tt][1]}var Tm=wm;function me(le){return Td(this.__data__,le)>-1}var mt=me;function At(le,Ee){var tt=this.__data__,Ft=Td(tt,le);return Ft<0?(++this.size,tt.push([le,Ee])):tt[Ft][1]=Ee,this}var wt=At;function bt(le){var Ee=-1,tt=le==null?0:le.length;for(this.clear();++Ee<tt;){var Ft=le[Ee];this.set(Ft[0],Ft[1])}}bt.prototype.clear=Th,bt.prototype.delete=Eh,bt.prototype.get=Tm,bt.prototype.has=mt,bt.prototype.set=wt;var Rn=bt,jn=Cr(U,"Map"),An=jn;function Un(){this.size=0,this.__data__={hash:new wh,map:new(An||Rn),string:new wh}}var er=Un;function yr(le){var Ee=typeof le;return Ee=="string"||Ee=="number"||Ee=="symbol"||Ee=="boolean"?le!=="__proto__":le===null}var Zr=yr;function xr(le,Ee){var tt=le.__data__;return Zr(Ee)?tt[typeof Ee=="string"?"string":"hash"]:tt.map}var gi=xr;function Ui(le){var Ee=gi(this,le).delete(le);return this.size-=Ee?1:0,Ee}var ss=Ui;function hi(le){return gi(this,le).get(le)}var $s=hi;function lr(le){return gi(this,le).has(le)}var ua=lr;function pi(le,Ee){var tt=gi(this,le),Ft=tt.size;return tt.set(le,Ee),this.size+=tt.size==Ft?0:1,this}var Ca=pi;function oo(le){var Ee=-1,tt=le==null?0:le.length;for(this.clear();++Ee<tt;){var Ft=le[Ee];this.set(Ft[0],Ft[1])}}oo.prototype.clear=er,oo.prototype.delete=ss,oo.prototype.get=$s,oo.prototype.has=ua,oo.prototype.set=Ca;var Wo=oo,Cu="Expected a function";function Ai(le,Ee){if(typeof le!="function"||Ee!=null&&typeof Ee!="function")throw new TypeError(Cu);var tt=function(){var Ft=arguments,kr=Ee?Ee.apply(this,Ft):Ft[0],zi=tt.cache;if(zi.has(kr))return zi.get(kr);var Na=le.apply(this,Ft);return tt.cache=zi.set(kr,Na)||zi,Na};return tt.cache=new(Ai.Cache||Wo),tt}Ai.Cache=Wo;var Ur=Ai,qo=500;function As(le){var Ee=Ur(le,function(Ft){return tt.size===qo&&tt.clear(),Ft}),tt=Ee.cache;return Ee}var Rl=As,Wa=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Mh=/\\(\\)?/g,Ic=Rl(function(le){var Ee=[];return le.charCodeAt(0)===46&&Ee.push(""),le.replace(Wa,function(tt,Ft,kr,zi){Ee.push(kr?zi.replace(Mh,"$1"):Ft||tt)}),Ee}),Em=Ic;function Mm(le,Ee){for(var tt=-1,Ft=le==null?0:le.length,kr=Array(Ft);++tt<Ft;)kr[tt]=Ee(le[tt],tt,le);return kr}var kc=Mm,dl=C?C.prototype:void 0,z0=dl?dl.toString:void 0;function Ed(le){if(typeof le=="string")return le;if(w(le))return kc(le,Ed)+"";if(yn(le))return z0?z0.call(le):"";var Ee=le+"";return Ee=="0"&&1/le==-1/0?"-0":Ee}var Ch=Ed;function Dc(le){return le==null?"":Ch(le)}var l9=Dc;function kg(le,Ee){return w(le)?le:Wt(le,Ee)?[le]:Em(l9(le))}var zp=kg;function P5(le){if(typeof le=="string"||yn(le))return le;var Ee=le+"";return Ee=="0"&&1/le==-1/0?"-0":Ee}var Au=P5;function Md(le,Ee){Ee=zp(Ee,le);for(var tt=0,Ft=Ee.length;le!=null&&tt<Ft;)le=le[Au(Ee[tt++])];return tt&&tt==Ft?le:void 0}var c9=Md;function V0(le,Ee,tt){var Ft=le==null?void 0:c9(le,Ee);return Ft===void 0?tt:Ft}var d0=V0;function Ah(le,Ee){return function(tt){return le(Ee(tt))}}var Oc=Ah,Cm=Oc(Object.getPrototypeOf,Object),Dg=Cm,u9="[object Object]",Am=Function.prototype,Nm=Object.prototype,Pm=Am.toString,Og=Nm.hasOwnProperty,Lc=Pm.call(Object);function Rm(le){if(!Ne(le)||We(le)!=u9)return!1;var Ee=Dg(le);if(Ee===null)return!0;var tt=Og.call(Ee,"constructor")&&Ee.constructor;return typeof tt=="function"&&tt instanceof tt&&Pm.call(tt)==Lc}var Nh=Rm;function Lg(le){var Ee=le==null?0:le.length;return Ee?le[Ee-1]:void 0}var Im=Lg,Fc=new WeakMap,km=new WeakMap,Xo=Symbol("pointerMeta"),Cd={get(le,Ee){if(Ee===Xo)return Fc.get(le);let tt=km.get(le);tt||(tt=new Map,km.set(le,tt));const Ft=tt.get(Ee);if(Ft!==void 0)return Ft;const kr=Fc.get(le),zi=Vp({root:kr.root,path:[...kr.path,Ee]});return tt.set(Ee,zi),zi}},Il=le=>le[Xo],G0=le=>{const{root:Ee,path:tt}=Il(le);return{root:Ee,path:tt}};function Vp(le){var Ee;const tt={root:le.root,path:(Ee=le.path)!=null?Ee:[]},Ft={};return Fc.set(Ft,tt),new Proxy(Ft,Cd)}var Gp=Vp,Bc=le=>le&&!!Il(le);function Ad(le,Ee,tt){return Ee.length===0?tt(le):Uc(le,Ee,tt)}var Uc=(le,Ee,tt)=>{if(Ee.length===0)return tt(le);if(Array.isArray(le)){let[Ft,...kr]=Ee;Ft=parseInt(String(Ft),10),isNaN(Ft)&&(Ft=0);const zi=le[Ft],Na=Uc(zi,kr,tt);if(zi===Na)return le;const h0=[...le];return h0.splice(Ft,1,Na),h0}else if(typeof le=="object"&&le!==null){const[Ft,...kr]=Ee,zi=le[Ft],Na=Uc(zi,kr,tt);return zi===Na?le:h(c({},le),{[Ft]:Na})}else{const[Ft,...kr]=Ee;return{[Ft]:Uc(void 0,kr,tt)}}},bo=class{constructor(){this._head=void 0}peek(){return this._head&&this._head.data}pop(){const le=this._head;if(le)return this._head=le.next,le.data}push(le){const Ee={next:this._head,data:le};this._head=Ee}};function Nu(le){return!!(le&&le.isPrism&&le.isPrism===!0)}function Dm(){const le=()=>{},Ee=new bo,tt=le;return{type:"Dataverse_discoveryMechanism",startIgnoringDependencies:()=>{Ee.push(tt)},stopIgnoringDependencies:()=>{Ee.peek()!==tt||Ee.pop()},reportResolutionStart:Pu=>{const Pa=Ee.peek();Pa&&Pa(Pu),Ee.push(tt)},reportResolutionEnd:Pu=>{Ee.pop()},pushCollector:Pu=>{Ee.push(Pu)},popCollector:Pu=>{if(Ee.peek()!==Pu)throw new Error("Popped collector is not on top of the stack");Ee.pop()}}}function d9(){const le="__dataverse_discoveryMechanism_sharedStack",Ee=typeof window<"u"?window:typeof D0<"u"?D0:{};if(Ee){const tt=Ee[le];if(tt&&typeof tt=="object"&&tt.type==="Dataverse_discoveryMechanism")return tt;{const Ft=Dm();return Ee[le]=Ft,Ft}}else return Dm()}var{startIgnoringDependencies:j0,stopIgnoringDependencies:jp,reportResolutionEnd:h9,reportResolutionStart:p9,pushCollector:Fg,popCollector:R5}=d9(),Om=()=>{},I5=class{constructor(le,Ee){this._fn=le,this._prismInstance=Ee,this._didMarkDependentsAsStale=!1,this._isFresh=!1,this._cacheOfDendencyValues=new Map,this._dependents=new Set,this._dependencies=new Set,this._possiblyStaleDeps=new Set,this._scope=new Fm(this),this._lastValue=void 0,this._forciblySetToStale=!1,this._reactToDependencyGoingStale=tt=>{this._possiblyStaleDeps.add(tt),this._markAsStale()};for(const tt of this._dependencies)tt._addDependent(this._reactToDependencyGoingStale);j0(),this.getValue(),jp()}get hasDependents(){return this._dependents.size>0}removeDependent(le){this._dependents.delete(le)}addDependent(le){this._dependents.add(le)}destroy(){for(const le of this._dependencies)le._removeDependent(this._reactToDependencyGoingStale);Bm(this._scope)}getValue(){if(!this._isFresh){const le=this._recalculate();this._lastValue=le,this._isFresh=!0,this._didMarkDependentsAsStale=!1,this._forciblySetToStale=!1}return this._lastValue}_recalculate(){let le;if(!this._forciblySetToStale&&this._possiblyStaleDeps.size>0){let Ft=!1;j0();for(const kr of this._possiblyStaleDeps)if(this._cacheOfDendencyValues.get(kr)!==kr.getValue()){Ft=!0;break}if(jp(),this._possiblyStaleDeps.clear(),!Ft)return this._lastValue}const Ee=new Set;this._cacheOfDendencyValues.clear();const tt=Ft=>{Ee.add(Ft),this._addDependency(Ft)};Fg(tt),da.push(this._scope);try{le=this._fn()}catch(Ft){console.error(Ft)}finally{da.pop()!==this._scope&&console.warn("The Prism hook stack has slipped. This is a bug.")}R5(tt);for(const Ft of this._dependencies)Ee.has(Ft)||this._removeDependency(Ft);this._dependencies=Ee,j0();for(const Ft of Ee)this._cacheOfDendencyValues.set(Ft,Ft.getValue());return jp(),le}forceStale(){this._forciblySetToStale=!0,this._markAsStale()}_markAsStale(){if(!this._didMarkDependentsAsStale){this._didMarkDependentsAsStale=!0,this._isFresh=!1;for(const le of this._dependents)le(this._prismInstance)}}_addDependency(le){this._dependencies.has(le)||(this._dependencies.add(le),le._addDependent(this._reactToDependencyGoingStale))}_removeDependency(le){this._dependencies.has(le)&&(this._dependencies.delete(le),le._removeDependent(this._reactToDependencyGoingStale))}},Bg={},Lm=class{constructor(le){this._fn=le,this.isPrism=!0,this._state={hot:!1,handle:void 0}}get isHot(){return this._state.hot}onChange(le,Ee,tt=!1){const Ft=()=>{le.onThisOrNextTick(zi)};let kr=Bg;const zi=()=>{const h0=this.getValue();h0!==kr&&(kr=h0,Ee(h0))};return this._addDependent(Ft),tt&&(kr=this.getValue(),Ee(kr)),()=>{this._removeDependent(Ft),le.offThisOrNextTick(zi),le.offNextTick(zi)}}onStale(le){const Ee=()=>{this._removeDependent(tt)},tt=()=>le();return this._addDependent(tt),Ee}keepHot(){return this.onStale(()=>{})}_addDependent(le){this._state.hot||this._goHot(),this._state.handle.addDependent(le)}_goHot(){const le=new I5(this._fn,this);this._state={hot:!0,handle:le}}_removeDependent(le){const Ee=this._state;if(!Ee.hot)return;const tt=Ee.handle;tt.removeDependent(le),tt.hasDependents||(this._state={hot:!1,handle:void 0},tt.destroy())}getValue(){p9(this);const le=this._state;let Ee;return le.hot?Ee=le.handle.getValue():Ee=H0(this._fn),h9(this),Ee}},Fm=class{constructor(le){this._hotHandle=le,this._refs=new Map,this.isPrismScope=!0,this.subs={},this.effects=new Map,this.memos=new Map}ref(le,Ee){let tt=this._refs.get(le);if(tt!==void 0)return tt;{const Ft={current:Ee};return this._refs.set(le,Ft),Ft}}effect(le,Ee,tt){let Ft=this.effects.get(le);Ft===void 0&&(Ft={cleanup:Om,deps:void 0},this.effects.set(le,Ft)),f9(Ft.deps,tt)&&(Ft.cleanup(),j0(),Ft.cleanup=Hp(Ee,Om).value,jp(),Ft.deps=tt)}memo(le,Ee,tt){let Ft=this.memos.get(le);return Ft===void 0&&(Ft={cachedValue:null,deps:void 0},this.memos.set(le,Ft)),f9(Ft.deps,tt)&&(j0(),Ft.cachedValue=Hp(Ee,void 0).value,jp(),Ft.deps=tt),Ft.cachedValue}state(le,Ee){const{value:tt,setValue:Ft}=this.memo("state/"+le,()=>{const kr={current:Ee};return{value:kr,setValue:Na=>{kr.current=Na,this._hotHandle.forceStale()}}},[]);return[tt.current,Ft]}sub(le){return this.subs[le]||(this.subs[le]=new Fm(this._hotHandle)),this.subs[le]}cleanupEffects(){for(const le of this.effects.values())Hp(le.cleanup,void 0);this.effects.clear()}source(le,Ee){return this.effect("$$source/blah",()=>le(()=>{this._hotHandle.forceStale()}),[le]),Ee()}};function Bm(le){for(const Ee of Object.values(le.subs))Bm(Ee);le.cleanupEffects()}function Hp(le,Ee){try{return{value:le(),ok:!0}}catch(tt){return setTimeout(function(){throw tt}),{value:Ee,ok:!1}}}var da=new bo;function k5(le,Ee){const tt=da.peek();if(!tt)throw new Error("prism.ref() is called outside of a prism() call.");return tt.ref(le,Ee)}function $p(le,Ee,tt){const Ft=da.peek();if(!Ft)throw new Error("prism.effect() is called outside of a prism() call.");return Ft.effect(le,Ee,tt)}function f9(le,Ee){if(le===void 0||Ee===void 0)return!0;const tt=le.length;if(tt!==Ee.length)return!0;for(let Ft=0;Ft<tt;Ft++)if(le[Ft]!==Ee[Ft])return!0;return!1}function m9(le,Ee,tt){const Ft=da.peek();if(!Ft)throw new Error("prism.memo() is called outside of a prism() call.");return Ft.memo(le,Ee,tt)}function Aa(le,Ee){const tt=da.peek();if(!tt)throw new Error("prism.state() is called outside of a prism() call.");return tt.state(le,Ee)}function g9(){if(!da.peek())throw new Error("The parent function is called outside of a prism() call.")}function D5(le,Ee){const tt=da.peek();if(!tt)throw new Error("prism.scope() is called outside of a prism() call.");const Ft=tt.sub(le);da.push(Ft);const kr=Hp(Ee,void 0).value;return da.pop(),kr}function y9(le,Ee,tt){return m9(le,()=>Ws(Ee),tt).getValue()}function v9(){return!!da.peek()}function Ug(le,Ee){const tt=da.peek();if(!tt)throw new Error("prism.source() is called outside of a prism() call.");return tt.source(le,Ee)}var Ws=le=>new Lm(le),Ph=class{effect(le,Ee,tt){console.warn("prism.effect() does not run in cold prisms")}memo(le,Ee,tt){return Ee()}state(le,Ee){return[Ee,()=>{}]}ref(le,Ee){return{current:Ee}}sub(le){return new Ph}source(le,Ee){return Ee()}};function H0(le){const Ee=new Ph;da.push(Ee);let tt;try{tt=le()}catch(Ft){console.error(Ft)}finally{da.pop()!==Ee&&console.warn("The Prism hook stack has slipped. This is a bug.")}return tt}Ws.ref=k5,Ws.effect=$p,Ws.memo=m9,Ws.ensurePrism=g9,Ws.state=Aa,Ws.scope=D5,Ws.sub=y9,Ws.inPrism=v9,Ws.source=Ug;var zc=Ws,zg;(function(le){le[le.Dict=0]="Dict",le[le.Array=1]="Array",le[le.Other=2]="Other"})(zg||(zg={}));var Di=le=>Array.isArray(le)?1:Nh(le)?0:2,Nd=(le,Ee,tt=Di(le))=>tt===0&&typeof Ee=="string"||tt===1&&Rh(Ee)?le[Ee]:void 0,Rh=le=>{const Ee=typeof le=="number"?le:parseInt(le,10);return!isNaN(Ee)&&Ee>=0&&Ee<1/0&&(Ee|0)===Ee},Ih=class{constructor(le,Ee){this._parent=le,this._path=Ee,this.children=new Map,this.identityChangeListeners=new Set}addIdentityChangeListener(le){this.identityChangeListeners.add(le)}removeIdentityChangeListener(le){this.identityChangeListeners.delete(le),this._checkForGC()}removeChild(le){this.children.delete(le),this._checkForGC()}getChild(le){return this.children.get(le)}getOrCreateChild(le){let Ee=this.children.get(le);return Ee||(Ee=Ee=new Ih(this,this._path.concat([le])),this.children.set(le,Ee)),Ee}_checkForGC(){this.identityChangeListeners.size>0||this.children.size>0||this._parent&&this._parent.removeChild(Im(this._path))}},Wp=class{constructor(le){this.$$isPointerToPrismProvider=!0,this.pointer=Gp({root:this,path:[]}),this.prism=this.pointerToPrism(this.pointer),this._onPointerValueChange=(Ee,tt)=>{const{path:Ft}=G0(Ee),kr=this._getOrCreateScopeForPath(Ft);return kr.identityChangeListeners.add(tt),()=>{kr.identityChangeListeners.delete(tt)}},this._currentState=le,this._rootScope=new Ih(void 0,[])}set(le){const Ee=this._currentState;this._currentState=le,this._checkUpdates(this._rootScope,Ee,le)}get(){return this._currentState}getByPointer(le){const Ee=Bc(le)?le:le(this.pointer),tt=G0(Ee).path;return this._getIn(tt)}_getIn(le){return le.length===0?this.get():d0(this.get(),le)}reduce(le){this.set(le(this.get()))}reduceByPointer(le,Ee){const tt=Bc(le)?le:le(this.pointer),Ft=G0(tt).path,kr=Ad(this.get(),Ft,Ee);this.set(kr)}setByPointer(le,Ee){this.reduceByPointer(le,()=>Ee)}_checkUpdates(le,Ee,tt){if(Ee===tt)return;for(const zi of le.identityChangeListeners)zi(tt);if(le.children.size===0)return;const Ft=Di(Ee),kr=Di(tt);if(!(Ft===2&&Ft===kr))for(const[zi,Na]of le.children){const h0=Nd(Ee,zi,Ft),qp=Nd(tt,zi,kr);this._checkUpdates(Na,h0,qp)}}_getOrCreateScopeForPath(le){let Ee=this._rootScope;for(const tt of le)Ee=Ee.getOrCreateChild(tt);return Ee}pointerToPrism(le){const{path:Ee}=G0(le),tt=kr=>this._onPointerValueChange(le,kr),Ft=()=>this._getIn(Ee);return zc(()=>zc.source(tt,Ft))}},x9=new WeakMap;function Vg(le){return typeof le=="object"&&le!==null&&le.$$isPointerToPrismProvider===!0}var kh=le=>{const Ee=Il(le);let tt=x9.get(Ee);if(!tt){const Ft=Ee.root;if(!Vg(Ft))throw new Error("Cannot run pointerToPrism() on a pointer whose root is not an PointerToPrismProvider");tt=Ft.pointerToPrism(le),x9.set(Ee,tt)}return tt},$0=le=>Bc(le)?kh(le).getValue():Nu(le)?le.getValue():le;function*Pd(le){let Ee;if(Bc(le))Ee=kh(le);else if(Nu(le))Ee=le;else throw new Error("Only pointers and prisms are supported");let tt=0;const Ft=Ee.onStale(()=>{tt++});try{for(;;){const kr=tt;tt=0,yield{value:Ee.getValue(),ticks:kr}}}finally{Ft()}}var O5=60*3,Vc=class{constructor(le){this._conf=le,this._ticking=!1,this._dormant=!0,this._numberOfDormantTicks=0,this.__ticks=0,this._scheduledForThisOrNextTick=new Set,this._scheduledForNextTick=new Set,this._timeAtCurrentTick=0}get dormant(){return this._dormant}onThisOrNextTick(le){this._scheduledForThisOrNextTick.add(le),this._dormant&&this._goActive()}onNextTick(le){this._scheduledForNextTick.add(le),this._dormant&&this._goActive()}offThisOrNextTick(le){this._scheduledForThisOrNextTick.delete(le)}offNextTick(le){this._scheduledForNextTick.delete(le)}get time(){return this._ticking?this._timeAtCurrentTick:performance.now()}_goActive(){var le,Ee;this._dormant&&(this._dormant=!1,(Ee=(le=this._conf)==null?void 0:le.onActive)==null||Ee.call(le))}_goDormant(){var le,Ee;this._dormant||(this._dormant=!0,this._numberOfDormantTicks=0,(Ee=(le=this._conf)==null?void 0:le.onDormant)==null||Ee.call(le))}tick(le=performance.now()){if(this.__ticks++,!this._dormant&&this._scheduledForNextTick.size===0&&this._scheduledForThisOrNextTick.size===0&&(this._numberOfDormantTicks++,this._numberOfDormantTicks>=O5)){this._goDormant();return}this._ticking=!0,this._timeAtCurrentTick=le;for(const Ee of this._scheduledForNextTick)this._scheduledForThisOrNextTick.add(Ee);this._scheduledForNextTick.clear(),this._tick(0),this._ticking=!1}_tick(le){const Ee=this.time;if(le>10&&console.warn("_tick() recursing for 10 times"),le>100)throw new Error("Maximum recursion limit for _tick()");const tt=this._scheduledForThisOrNextTick;this._scheduledForThisOrNextTick=new Set;for(const Ft of tt)Ft(Ee);if(this._scheduledForThisOrNextTick.size>0)return this._tick(le+1)}};function*Um(le){let Ee;if(Bc(le))Ee=kh(le);else if(Nu(le))Ee=le;else throw new Error("Only pointers and prisms are supported");const tt=new Vc,Ft=Ee.onChange(tt,kr=>{});try{for(;;)tt.tick(),yield Ee.getValue()}finally{Ft()}}var b9=class{constructor(le){this.$$isPointerToPrismProvider=!0,this._currentPointerBox=new Wp(le),this.pointer=Gp({root:this,path:[]})}setPointer(le){this._currentPointerBox.set(le)}pointerToPrism(le){const{path:Ee}=Il(le);return zc(()=>{const tt=this._currentPointerBox.prism.getValue(),Ft=Ee.reduce((kr,zi)=>kr[zi],tt);return $0(Ft)})}}}(XW)),XW}var wC={exports:{}};wC.exports;var G8e;function N_e(){return G8e||(G8e=1,function(s,e){var t=Object.create,n=Object.defineProperty,r=Object.defineProperties,i=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertyNames,c=Object.getOwnPropertySymbols,h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,b=(S,k,G)=>k in S?n(S,k,{enumerable:!0,configurable:!0,writable:!0,value:G}):S[k]=G,w=(S,k)=>{for(var G in k||(k={}))m.call(k,G)&&b(S,G,k[G]);if(c)for(var G of c(k))y.call(k,G)&&b(S,G,k[G]);return S},A=(S,k)=>r(S,o(k)),I=(S,k)=>function(){return k||(0,S[l(S)[0]])((k={exports:{}}).exports,k),k.exports},D=(S,k)=>{for(var G in k)n(S,G,{get:k[G],enumerable:!0})},P=(S,k,G,ne)=>{if(k&&typeof k=="object"||typeof k=="function")for(let he of l(k))!m.call(S,he)&&he!==G&&n(S,he,{get:()=>k[he],enumerable:!(ne=i(k,he))||ne.enumerable});return S},U=(S,k,G)=>(G=S!=null?t(h(S)):{},P(!S||!S.__esModule?n(G,"default",{value:S,enumerable:!0}):G,S)),j=S=>P(n({},"__esModule",{value:!0}),S),C=(S,k,G)=>(b(S,typeof k!="symbol"?k+"":k,G),G),Z=I({"../node_modules/timing-function/lib/UnitBezier.js"(S,k){k.exports=function(){function G(ne,he,ve,je){this.set(ne,he,ve,je)}return G.prototype.set=function(ne,he,ve,je){this._cx=3*ne,this._bx=3*(ve-ne)-this._cx,this._ax=1-this._cx-this._bx,this._cy=3*he,this._by=3*(je-he)-this._cy,this._ay=1-this._cy-this._by},G.epsilon=1e-6,G.prototype._sampleCurveX=function(ne){return((this._ax*ne+this._bx)*ne+this._cx)*ne},G.prototype._sampleCurveY=function(ne){return((this._ay*ne+this._by)*ne+this._cy)*ne},G.prototype._sampleCurveDerivativeX=function(ne){return(3*this._ax*ne+2*this._bx)*ne+this._cx},G.prototype._solveCurveX=function(ne,he){var ve,je,ct,xt,Lt,an;for(ct=void 0,xt=void 0,Lt=void 0,an=void 0,ve=void 0,je=void 0,Lt=ne,je=0;je<8;){if(an=this._sampleCurveX(Lt)-ne,Math.abs(an)<he)return Lt;if(ve=this._sampleCurveDerivativeX(Lt),Math.abs(ve)<he)break;Lt=Lt-an/ve,je++}if(ct=0,xt=1,Lt=ne,Lt<ct)return ct;if(Lt>xt)return xt;for(;ct<xt;){if(an=this._sampleCurveX(Lt),Math.abs(an-ne)<he)return Lt;ne>an?ct=Lt:xt=Lt,Lt=(xt-ct)*.5+ct}return Lt},G.prototype.solve=function(ne,he){return this._sampleCurveY(this._solveCurveX(ne,he))},G.prototype.solveSimple=function(ne){return this._sampleCurveY(this._solveCurveX(ne,1e-6))},G}()}}),ie=I({"../node_modules/levenshtein-edit-distance/index.js"(S,k){var G,ne;G=[],ne=[];function he(ve,je,ct){var xt,Lt,an,dn,In,dr,sr,ii;if(ve===je)return 0;if(xt=ve.length,Lt=je.length,xt===0)return Lt;if(Lt===0)return xt;for(ct&&(ve=ve.toLowerCase(),je=je.toLowerCase()),sr=0;sr<xt;)ne[sr]=ve.charCodeAt(sr),G[sr]=++sr;for(ii=0;ii<Lt;)for(an=je.charCodeAt(ii),dn=In=ii++,sr=-1;++sr<xt;)dr=an===ne[sr]?In:In+1,In=G[sr],G[sr]=dn=In>dn?dr>dn?dn+1:dr:dr>In?In+1:dr;return dn}k.exports=he}}),se=I({"../node_modules/propose/propose.js"(S,k){var G=ie();function ne(){var he,ve,je,ct,xt,Lt=0,an=arguments[0],dn=arguments[1],In=dn.length,dr=arguments[2];dr&&(ct=dr.threshold,xt=dr.ignoreCase),ct===void 0&&(ct=0);for(var sr=0;sr<In;++sr)xt?ve=G(an,dn[sr],!0):ve=G(an,dn[sr]),ve>an.length?he=1-ve/dn[sr].length:he=1-ve/an.length,he>Lt&&(Lt=he,je=dn[sr]);return Lt>=ct?je:null}k.exports=ne}}),z=I({"../node_modules/fast-deep-equal/index.js"(S,k){k.exports=function G(ne,he){if(ne===he)return!0;if(ne&&he&&typeof ne=="object"&&typeof he=="object"){if(ne.constructor!==he.constructor)return!1;var ve,je,ct;if(Array.isArray(ne)){if(ve=ne.length,ve!=he.length)return!1;for(je=ve;je--!==0;)if(!G(ne[je],he[je]))return!1;return!0}if(ne.constructor===RegExp)return ne.source===he.source&&ne.flags===he.flags;if(ne.valueOf!==Object.prototype.valueOf)return ne.valueOf()===he.valueOf();if(ne.toString!==Object.prototype.toString)return ne.toString()===he.toString();if(ct=Object.keys(ne),ve=ct.length,ve!==Object.keys(he).length)return!1;for(je=ve;je--!==0;)if(!Object.prototype.hasOwnProperty.call(he,ct[je]))return!1;for(je=ve;je--!==0;){var xt=ct[je];if(!G(ne[xt],he[xt]))return!1}return!0}return ne!==ne&&he!==he}}}),re={};D(re,{createRafDriver:()=>b7,getProject:()=>RP,notify:()=>x1,onChange:()=>PT,types:()=>uT,val:()=>RT}),s.exports=j(re);var ye={};D(ye,{createRafDriver:()=>b7,getProject:()=>RP,notify:()=>x1,onChange:()=>PT,types:()=>uT,val:()=>RT});var H=un(),Me=class{constructor(){C(this,"atom",new H.Atom({projects:{}}))}add(S,k){this.atom.setByPointer(G=>G.projects[S],k)}get(S){return this.atom.get().projects[S]}has(S){return!!this.get(S)}},Oe=new Me,Ue=Oe,Ie=new WeakMap;function ce(S){return Ie.get(S)}function Ve(S,k){Ie.set(S,k)}var Pe=[],We=Array.isArray,pt=We,Ne=typeof D0=="object"&&D0&&D0.Object===Object&&D0,st=Ne,Pt=typeof self=="object"&&self&&self.Object===Object&&self,yn=st||Pt||Function("return this")(),bn=yn,St=bn.Symbol,Ut=St,Wt=Object.prototype,kn=Wt.hasOwnProperty,Dn=Wt.toString,or=Ut?Ut.toStringTag:void 0;function ns(S){var k=kn.call(S,or),G=S[or];try{S[or]=void 0;var ne=!0}catch{}var he=Dn.call(S);return ne&&(k?S[or]=G:delete S[or]),he}var Xr=ns,Vr=Object.prototype,Kr=Vr.toString;function Yr(S){return Kr.call(S)}var mi=Yr,Ke="[object Null]",_s="[object Undefined]",ui=Ut?Ut.toStringTag:void 0;function Ti(S){return S==null?S===void 0?_s:Ke:ui&&ui in Object(S)?Xr(S):mi(S)}var Vn=Ti;function ke(S){return S!=null&&typeof S=="object"}var de=ke,ht="[object Symbol]";function Xt(S){return typeof S=="symbol"||de(S)&&Vn(S)==ht}var Kt=Xt,Vt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Qn=/^\w*$/;function wn(S,k){if(pt(S))return!1;var G=typeof S;return G=="number"||G=="symbol"||G=="boolean"||S==null||Kt(S)?!0:Qn.test(S)||!Vt.test(S)||k!=null&&S in Object(k)}var ar=wn;function Ir(S){var k=typeof S;return S!=null&&(k=="object"||k=="function")}var en=Ir,vn="[object AsyncFunction]",Gn="[object Function]",$n="[object GeneratorFunction]",Bn="[object Proxy]";function Cr(S){if(!en(S))return!1;var k=Vn(S);return k==Gn||k==$n||k==vn||k==Bn}var et=Cr,_n=bn["__core-js_shared__"],pn=_n,Nn=function(){var S=/[^.]+$/.exec(pn&&pn.keys&&pn.keys.IE_PROTO||"");return S?"Symbol(src)_1."+S:""}();function cn(S){return!!Nn&&Nn in S}var jt=cn,Wn=Function.prototype,Br=Wn.toString;function Hi(S){if(S!=null){try{return Br.call(S)}catch{}try{return S+""}catch{}}return""}var Pr=Hi,Ls=/[\\^$.*+?()[\]{}|]/g,la=/^\[object .+?Constructor\]$/,Sd=Function.prototype,u0=Object.prototype,Up=Sd.toString,Pc=u0.hasOwnProperty,wd=RegExp("^"+Up.call(Pc).replace(Ls,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Pl(S){if(!en(S)||jt(S))return!1;var k=et(S)?wd:la;return k.test(Pr(S))}var cl=Pl;function wh(S,k){return S==null?void 0:S[k]}var _m=wh;function Th(S,k){var G=_m(S,k);return cl(G)?G:void 0}var $o=Th,Mu=$o(Object,"create"),Rc=Mu;function Td(){this.__data__=Rc?Rc(null):{},this.size=0}var ca=Td;function ul(S){var k=this.has(S)&&delete this.__data__[S];return this.size-=k?1:0,k}var Sm=ul,Eh="__lodash_hash_undefined__",wm=Object.prototype,Tm=wm.hasOwnProperty;function me(S){var k=this.__data__;if(Rc){var G=k[S];return G===Eh?void 0:G}return Tm.call(k,S)?k[S]:void 0}var mt=me,At=Object.prototype,wt=At.hasOwnProperty;function bt(S){var k=this.__data__;return Rc?k[S]!==void 0:wt.call(k,S)}var Rn=bt,jn="__lodash_hash_undefined__";function An(S,k){var G=this.__data__;return this.size+=this.has(S)?0:1,G[S]=Rc&&k===void 0?jn:k,this}var Un=An;function er(S){var k=-1,G=S==null?0:S.length;for(this.clear();++k<G;){var ne=S[k];this.set(ne[0],ne[1])}}er.prototype.clear=ca,er.prototype.delete=Sm,er.prototype.get=mt,er.prototype.has=Rn,er.prototype.set=Un;var yr=er;function Zr(){this.__data__=[],this.size=0}var xr=Zr;function gi(S,k){return S===k||S!==S&&k!==k}var Ui=gi;function ss(S,k){for(var G=S.length;G--;)if(Ui(S[G][0],k))return G;return-1}var hi=ss,$s=Array.prototype,lr=$s.splice;function ua(S){var k=this.__data__,G=hi(k,S);if(G<0)return!1;var ne=k.length-1;return G==ne?k.pop():lr.call(k,G,1),--this.size,!0}var pi=ua;function Ca(S){var k=this.__data__,G=hi(k,S);return G<0?void 0:k[G][1]}var oo=Ca;function Wo(S){return hi(this.__data__,S)>-1}var Cu=Wo;function Ai(S,k){var G=this.__data__,ne=hi(G,S);return ne<0?(++this.size,G.push([S,k])):G[ne][1]=k,this}var Ur=Ai;function qo(S){var k=-1,G=S==null?0:S.length;for(this.clear();++k<G;){var ne=S[k];this.set(ne[0],ne[1])}}qo.prototype.clear=xr,qo.prototype.delete=pi,qo.prototype.get=oo,qo.prototype.has=Cu,qo.prototype.set=Ur;var As=qo,Rl=$o(bn,"Map"),Wa=Rl;function Mh(){this.size=0,this.__data__={hash:new yr,map:new(Wa||As),string:new yr}}var Ic=Mh;function Em(S){var k=typeof S;return k=="string"||k=="number"||k=="symbol"||k=="boolean"?S!=="__proto__":S===null}var Mm=Em;function kc(S,k){var G=S.__data__;return Mm(k)?G[typeof k=="string"?"string":"hash"]:G.map}var dl=kc;function z0(S){var k=dl(this,S).delete(S);return this.size-=k?1:0,k}var Ed=z0;function Ch(S){return dl(this,S).get(S)}var Dc=Ch;function l9(S){return dl(this,S).has(S)}var kg=l9;function zp(S,k){var G=dl(this,S),ne=G.size;return G.set(S,k),this.size+=G.size==ne?0:1,this}var P5=zp;function Au(S){var k=-1,G=S==null?0:S.length;for(this.clear();++k<G;){var ne=S[k];this.set(ne[0],ne[1])}}Au.prototype.clear=Ic,Au.prototype.delete=Ed,Au.prototype.get=Dc,Au.prototype.has=kg,Au.prototype.set=P5;var Md=Au,c9="Expected a function";function V0(S,k){if(typeof S!="function"||k!=null&&typeof k!="function")throw new TypeError(c9);var G=function(){var ne=arguments,he=k?k.apply(this,ne):ne[0],ve=G.cache;if(ve.has(he))return ve.get(he);var je=S.apply(this,ne);return G.cache=ve.set(he,je)||ve,je};return G.cache=new(V0.Cache||Md),G}V0.Cache=Md;var d0=V0,Ah=500;function Oc(S){var k=d0(S,function(ne){return G.size===Ah&&G.clear(),ne}),G=k.cache;return k}var Cm=Oc,Dg=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,u9=/\\(\\)?/g,Am=Cm(function(S){var k=[];return S.charCodeAt(0)===46&&k.push(""),S.replace(Dg,function(G,ne,he,ve){k.push(he?ve.replace(u9,"$1"):ne||G)}),k}),Nm=Am;function Pm(S,k){for(var G=-1,ne=S==null?0:S.length,he=Array(ne);++G<ne;)he[G]=k(S[G],G,S);return he}var Og=Pm,Lc=Ut?Ut.prototype:void 0,Rm=Lc?Lc.toString:void 0;function Nh(S){if(typeof S=="string")return S;if(pt(S))return Og(S,Nh)+"";if(Kt(S))return Rm?Rm.call(S):"";var k=S+"";return k=="0"&&1/S==-1/0?"-0":k}var Lg=Nh;function Im(S){return S==null?"":Lg(S)}var Fc=Im;function km(S,k){return pt(S)?S:ar(S,k)?[S]:Nm(Fc(S))}var Xo=km;function Cd(S){if(typeof S=="string"||Kt(S))return S;var k=S+"";return k=="0"&&1/S==-1/0?"-0":k}var Il=Cd;function G0(S,k){k=Xo(k,S);for(var G=0,ne=k.length;S!=null&&G<ne;)S=S[Il(k[G++])];return G&&G==ne?S:void 0}var Vp=G0;function Gp(S,k,G){var ne=S==null?void 0:Vp(S,k);return ne===void 0?G:ne}var Bc=Gp;function Ad(S,k){return k.length===0?S:Bc(S,k)}var Uc=class{constructor(){C(this,"_values",{})}get(S,k){if(this.has(S))return this._values[S];{const G=k();return this._values[S]=G,G}}has(S){return this._values.hasOwnProperty(S)}},bo=un(),Nu=function(){try{var S=$o(Object,"defineProperty");return S({},"",{}),S}catch{}}(),Dm=Nu;function d9(S,k,G){k=="__proto__"&&Dm?Dm(S,k,{configurable:!0,enumerable:!0,value:G,writable:!0}):S[k]=G}var j0=d9,jp=Object.prototype,h9=jp.hasOwnProperty;function p9(S,k,G){var ne=S[k];(!(h9.call(S,k)&&Ui(ne,G))||G===void 0&&!(k in S))&&j0(S,k,G)}var Fg=p9,R5=9007199254740991,Om=/^(?:0|[1-9]\d*)$/;function I5(S,k){var G=typeof S;return k=k??R5,!!k&&(G=="number"||G!="symbol"&&Om.test(S))&&S>-1&&S%1==0&&S<k}var Bg=I5;function Lm(S,k,G,ne){if(!en(S))return S;k=Xo(k,S);for(var he=-1,ve=k.length,je=ve-1,ct=S;ct!=null&&++he<ve;){var xt=Il(k[he]),Lt=G;if(xt==="__proto__"||xt==="constructor"||xt==="prototype")return S;if(he!=je){var an=ct[xt];Lt=ne?ne(an,xt,ct):void 0,Lt===void 0&&(Lt=en(an)?an:Bg(k[he+1])?[]:{})}Fg(ct,xt,Lt),ct=ct[xt]}return S}var Fm=Lm;function Bm(S,k,G){return S==null?S:Fm(S,k,G)}var Hp=Bm,da=new WeakMap;function k5(S){return $p(S)}function $p(S){if(da.has(S))return da.get(S);const k=S.type==="compound"?m9(S):S.type==="enum"?f9(S):S.default;return da.set(S,k),k}function f9(S){const k={$case:S.defaultCase};for(const[G,ne]of Object.entries(S.cases))k[G]=$p(ne);return k}function m9(S){const k={};for(const[G,ne]of Object.entries(S.props))k[G]=$p(ne);return k}var Aa=un(),g9=U(Z());function D5(S,k,G){return(0,Aa.prism)(()=>{const ne=(0,Aa.val)(k);return Aa.prism.memo("driver",()=>ne?ne.type==="BasicKeyframedTrack"?y9(S,ne,G):(S.logger.error("Track type not yet supported."),(0,Aa.prism)(()=>{})):(0,Aa.prism)(()=>{}),[ne]).getValue()})}function y9(S,k,G){return(0,Aa.prism)(()=>{let ne=Aa.prism.ref("state",{started:!1}),he=ne.current;const ve=G.getValue();return(!he.started||ve<he.validFrom||he.validTo<=ve)&&(ne.current=he=Ug(S,G,k)),he.der.getValue()})}var v9=(0,Aa.prism)(()=>{});function Ug(S,k,G){const ne=k.getValue();if(G.keyframes.length===0)return{started:!0,validFrom:-1/0,validTo:1/0,der:v9};let he=0;for(;;){const ve=G.keyframes[he];if(!ve)return Ws.error;const je=he===G.keyframes.length-1;if(ne<ve.position)return he===0?Ws.beforeFirstKeyframe(ve):Ws.error;if(ve.position===ne)return je?Ws.lastKeyframe(ve):Ws.between(ve,G.keyframes[he+1],k);if(he===G.keyframes.length-1)return Ws.lastKeyframe(ve);{const ct=he+1;if(G.keyframes[ct].position<=ne){he=ct;continue}else return Ws.between(ve,G.keyframes[he+1],k)}}}var Ws={beforeFirstKeyframe(S){return{started:!0,validFrom:-1/0,validTo:S.position,der:(0,Aa.prism)(()=>({left:S.value,progression:0}))}},lastKeyframe(S){return{started:!0,validFrom:S.position,validTo:1/0,der:(0,Aa.prism)(()=>({left:S.value,progression:0}))}},between(S,k,G){if(!S.connectedRight)return{started:!0,validFrom:S.position,validTo:k.position,der:(0,Aa.prism)(()=>({left:S.value,progression:0}))};const ne=ve=>(ve-S.position)/(k.position-S.position);if(!S.type||S.type==="bezier"){const ve=new g9.default(S.handles[2],S.handles[3],k.handles[0],k.handles[1]),je=(0,Aa.prism)(()=>{const ct=ne(G.getValue()),xt=ve.solveSimple(ct);return{left:S.value,right:k.value,progression:xt}});return{started:!0,validFrom:S.position,validTo:k.position,der:je}}const he=(0,Aa.prism)(()=>{const ve=ne(G.getValue()),je=Math.floor(ve);return{left:S.value,right:k.value,progression:je}});return{started:!0,validFrom:S.position,validTo:k.position,der:he}},error:{started:!0,validFrom:-1/0,validTo:1/0,der:v9}};function Ph(S,k,G){const he=G.get(S);if(he&&he.override===k)return he.merged;const ve=w({},S);for(const je of Object.keys(k)){const ct=k[je],xt=S[je];ve[je]=typeof ct=="object"&&typeof xt=="object"?Ph(xt,ct,G):ct===void 0?xt:ct}return G.set(S,{override:k,merged:ve}),ve}function H0(S,k){let G=S;for(const ne of k)G=G[ne];return G}var zc=un(),zg=(S,k)=>{const G=zc.prism.memo(S,()=>new zc.Atom(k),[]);return G.set(k),G},Di=un(),Nd=un(),Rh=/\s/;function Ih(S){for(var k=S.length;k--&&Rh.test(S.charAt(k)););return k}var Wp=Ih,x9=/^\s+/;function Vg(S){return S&&S.slice(0,Wp(S)+1).replace(x9,"")}var kh=Vg,$0=NaN,Pd=/^[-+]0x[0-9a-f]+$/i,O5=/^0b[01]+$/i,Vc=/^0o[0-7]+$/i,Um=parseInt;function b9(S){if(typeof S=="number")return S;if(Kt(S))return $0;if(en(S)){var k=typeof S.valueOf=="function"?S.valueOf():S;S=en(k)?k+"":k}if(typeof S!="string")return S===0?S:+S;S=kh(S);var G=O5.test(S);return G||Vc.test(S)?Um(S.slice(2),G?2:8):Pd.test(S)?$0:+S}var le=b9,Ee=1/0,tt=17976931348623157e292;function Ft(S){if(!S)return S===0?S:0;if(S=le(S),S===Ee||S===-Ee){var k=S<0?-1:1;return k*tt}return S===S?S:0}var kr=Ft;function zi(S){var k=kr(S),G=k%1;return k===k?G?k-G:k:0}var Na=zi;function h0(S){return S}var qp=h0,Pu=$o(bn,"WeakMap"),Pa=Pu,Gc=Object.create,zm=function(){function S(){}return function(k){if(!en(k))return{};if(Gc)return Gc(k);S.prototype=k;var G=new S;return S.prototype=void 0,G}}(),Tx=zm;function _9(S,k){var G=-1,ne=S.length;for(k||(k=Array(ne));++G<ne;)k[G]=S[G];return k}var Ex=_9;function L5(S,k){for(var G=-1,ne=S==null?0:S.length;++G<ne&&k(S[G],G,S)!==!1;);return S}var Mx=L5;function S9(S,k,G,ne){var he=!G;G||(G={});for(var ve=-1,je=k.length;++ve<je;){var ct=k[ve],xt=ne?ne(G[ct],S[ct],ct,G,S):void 0;xt===void 0&&(xt=S[ct]),he?j0(G,ct,xt):Fg(G,ct,xt)}return G}var jc=S9,F5=9007199254740991;function Vm(S){return typeof S=="number"&&S>-1&&S%1==0&&S<=F5}var Gg=Vm;function Cx(S){return S!=null&&Gg(S.length)&&!et(S)}var Gm=Cx,Dh=Object.prototype;function B5(S){var k=S&&S.constructor,G=typeof k=="function"&&k.prototype||Dh;return S===G}var jm=B5;function jg(S,k){for(var G=-1,ne=Array(S);++G<S;)ne[G]=k(G);return ne}var U5=jg,z5="[object Arguments]";function Hg(S){return de(S)&&Vn(S)==z5}var $g=Hg,V5=Object.prototype,G5=V5.hasOwnProperty,Oh=V5.propertyIsEnumerable,Wg=$g(function(){return arguments}())?$g:function(S){return de(S)&&G5.call(S,"callee")&&!Oh.call(S,"callee")},Hm=Wg;function Ax(){return!1}var j5=Ax,Xp=e&&!e.nodeType&&e,H5=Xp&&!0&&s&&!s.nodeType&&s,$m=H5&&H5.exports===Xp,qg=$m?bn.Buffer:void 0,Fs=qg?qg.isBuffer:void 0,w9=Fs||j5,Lh=w9,Wm="[object Arguments]",$5="[object Array]",T9="[object Boolean]",qm="[object Date]",Xg="[object Error]",Yp="[object Function]",W5="[object Map]",Nx="[object Number]",Px="[object Object]",q5="[object RegExp]",Yg="[object Set]",Kg="[object String]",E9="[object WeakMap]",M9="[object ArrayBuffer]",C9="[object DataView]",A9="[object Float32Array]",Rx="[object Float64Array]",X5="[object Int8Array]",Ix="[object Int16Array]",kx="[object Int32Array]",N9="[object Uint8Array]",Rd="[object Uint8ClampedArray]",Ss="[object Uint16Array]",Kp="[object Uint32Array]",Oi={};Oi[A9]=Oi[Rx]=Oi[X5]=Oi[Ix]=Oi[kx]=Oi[N9]=Oi[Rd]=Oi[Ss]=Oi[Kp]=!0,Oi[Wm]=Oi[$5]=Oi[M9]=Oi[T9]=Oi[C9]=Oi[qm]=Oi[Xg]=Oi[Yp]=Oi[W5]=Oi[Nx]=Oi[Px]=Oi[q5]=Oi[Yg]=Oi[Kg]=Oi[E9]=!1;function Zg(S){return de(S)&&Gg(S.length)&&!!Oi[Vn(S)]}var kl=Zg;function Zp(S){return function(k){return S(k)}}var Qg=Zp,Qp=e&&!e.nodeType&&e,W0=Qp&&!0&&s&&!s.nodeType&&s,Fh=W0&&W0.exports===Qp,Id=Fh&&st.process,Ru=function(){try{var S=W0&&W0.require&&W0.require("util").types;return S||Id&&Id.binding&&Id.binding("util")}catch{}}(),Iu=Ru,kd=Iu&&Iu.isTypedArray,Dd=kd?Qg(kd):kl,ps=Dd,ws=Object.prototype,Bh=ws.hasOwnProperty;function Ra(S,k){var G=pt(S),ne=!G&&Hm(S),he=!G&&!ne&&Lh(S),ve=!G&&!ne&&!he&&ps(S),je=G||ne||he||ve,ct=je?U5(S.length,String):[],xt=ct.length;for(var Lt in S)(k||Bh.call(S,Lt))&&!(je&&(Lt=="length"||he&&(Lt=="offset"||Lt=="parent")||ve&&(Lt=="buffer"||Lt=="byteLength"||Lt=="byteOffset")||Bg(Lt,xt)))&&ct.push(Lt);return ct}var qa=Ra;function Od(S,k){return function(G){return S(k(G))}}var Uh=Od,Dl=Uh(Object.keys,Object),Xm=Dl,Y5=Object.prototype,K5=Y5.hasOwnProperty;function Jg(S){if(!jm(S))return Xm(S);var k=[];for(var G in Object(S))K5.call(S,G)&&G!="constructor"&&k.push(G);return k}var Dx=Jg;function Ld(S){return Gm(S)?qa(S):Dx(S)}var Fd=Ld;function P9(S){var k=[];if(S!=null)for(var G in Object(S))k.push(G);return k}var Z5=P9,Lw=Object.prototype,zh=Lw.hasOwnProperty;function Hc(S){if(!en(S))return Z5(S);var k=jm(S),G=[];for(var ne in S)ne=="constructor"&&(k||!zh.call(S,ne))||G.push(ne);return G}var ku=Hc;function R9(S){return Gm(S)?qa(S,!0):ku(S)}var Jp=R9;function q0(S,k){for(var G=-1,ne=k.length,he=S.length;++G<ne;)S[he+G]=k[G];return S}var p0=q0,Vh=Uh(Object.getPrototypeOf,Object),X0=Vh,Du="[object Object]",ef=Function.prototype,Ox=Object.prototype,tf=ef.toString,e2=Ox.hasOwnProperty,f0=tf.call(Object);function Ol(S){if(!de(S)||Vn(S)!=Du)return!1;var k=X0(S);if(k===null)return!0;var G=e2.call(k,"constructor")&&k.constructor;return typeof G=="function"&&G instanceof G&&tf.call(G)==f0}var Bs=Ol;function Ll(S,k,G){var ne=-1,he=S.length;k<0&&(k=-k>he?0:he+k),G=G>he?he:G,G<0&&(G+=he),he=k>G?0:G-k>>>0,k>>>=0;for(var ve=Array(he);++ne<he;)ve[ne]=S[ne+k];return ve}var t2=Ll;function Q5(S,k,G){var ne=S.length;return G=G===void 0?ne:G,!k&&G>=ne?S:t2(S,k,G)}var Gh=Q5,Ym="\\ud800-\\udfff",Lx="\\u0300-\\u036f",n2="\\ufe20-\\ufe2f",Fx="\\u20d0-\\u20ff",Km=Lx+n2+Fx,I9="\\ufe0e\\ufe0f",Fw="\\u200d",r2=RegExp("["+Fw+Ym+Km+I9+"]");function i2(S){return r2.test(S)}var s2=i2;function J5(S){return S.split("")}var nf=J5,ev="\\ud800-\\udfff",k9="\\u0300-\\u036f",o2="\\ufe20-\\ufe2f",rf="\\u20d0-\\u20ff",D9=k9+o2+rf,tv="\\ufe0e\\ufe0f",nv="["+ev+"]",Zm="["+D9+"]",Bd="\\ud83c[\\udffb-\\udfff]",Y0="(?:"+Zm+"|"+Bd+")",m0="[^"+ev+"]",Qm="(?:\\ud83c[\\udde6-\\uddff]){2}",rv="[\\ud800-\\udbff][\\udc00-\\udfff]",Ud="\\u200d",Ou=Y0+"?",O9="["+tv+"]?",Bx="(?:"+Ud+"(?:"+[m0,Qm,rv].join("|")+")"+O9+Ou+")*",g0=O9+Ou+Bx,$c="(?:"+[m0+Zm+"?",Zm,Qm,rv,nv].join("|")+")",L9=RegExp(Bd+"(?="+Bd+")|"+$c+g0,"g");function iv(S){return S.match(L9)||[]}var a2=iv;function sv(S){return s2(S)?a2(S):nf(S)}var l2=sv;function Lu(S,k,G){return S===S&&(G!==void 0&&(S=S<=G?S:G),k!==void 0&&(S=S>=k?S:k)),S}var Jm=Lu;function c2(S,k,G){return G===void 0&&(G=k,k=void 0),G!==void 0&&(G=le(G),G=G===G?G:0),k!==void 0&&(k=le(k),k=k===k?k:0),Jm(le(S),k,G)}var jh=c2;function F9(){this.__data__=new As,this.size=0}var e1=F9;function Ux(S){var k=this.__data__,G=k.delete(S);return this.size=k.size,G}var B9=Ux;function eo(S){return this.__data__.get(S)}var zd=eo;function sf(S){return this.__data__.has(S)}var t1=sf,u2=200;function Hh(S,k){var G=this.__data__;if(G instanceof As){var ne=G.__data__;if(!Wa||ne.length<u2-1)return ne.push([S,k]),this.size=++G.size,this;G=this.__data__=new Md(ne)}return G.set(S,k),this.size=G.size,this}var Vd=Hh;function fs(S){var k=this.__data__=new As(S);this.size=k.size}fs.prototype.clear=e1,fs.prototype.delete=B9,fs.prototype.get=zd,fs.prototype.has=t1,fs.prototype.set=Vd;var qs=fs;function ha(S,k){return S&&jc(k,Fd(k),S)}var U9=ha;function n1(S,k){return S&&jc(k,Jp(k),S)}var d2=n1,zx=e&&!e.nodeType&&e,_o=zx&&!0&&s&&!s.nodeType&&s,r1=_o&&_o.exports===zx,z9=r1?bn.Buffer:void 0,h2=z9?z9.allocUnsafe:void 0;function Fu(S,k){if(k)return S.slice();var G=S.length,ne=h2?h2(G):new S.constructor(G);return S.copy(ne),ne}var K0=Fu;function i1(S,k){for(var G=-1,ne=S==null?0:S.length,he=0,ve=[];++G<ne;){var je=S[G];k(je,G,S)&&(ve[he++]=je)}return ve}var ov=i1;function av(){return[]}var V9=av,Vx=Object.prototype,Gx=Vx.propertyIsEnumerable,G9=Object.getOwnPropertySymbols,jx=G9?function(S){return S==null?[]:(S=Object(S),ov(G9(S),function(k){return Gx.call(S,k)}))}:V9,Gd=jx;function s1(S,k){return jc(S,Gd(S),k)}var j9=s1,of=Object.getOwnPropertySymbols,lv=of?function(S){for(var k=[];S;)p0(k,Gd(S)),S=X0(S);return k}:V9,af=lv;function p2(S,k){return jc(S,af(S),k)}var Hx=p2;function H9(S,k,G){var ne=k(S);return pt(S)?ne:p0(ne,G(S))}var $9=H9;function $x(S){return $9(S,Fd,Gd)}var f2=$x;function cv(S){return $9(S,Jp,af)}var W9=cv,uv=$o(bn,"DataView"),q9=uv,Wx=$o(bn,"Promise"),o1=Wx,dv=$o(bn,"Set"),hv=dv,m2="[object Map]",X9="[object Object]",pv="[object Promise]",Y9="[object Set]",Bu="[object WeakMap]",a1="[object DataView]",Bw=Pr(q9),K9=Pr(Wa),y0=Pr(o1),fv=Pr(hv),Uu=Pr(Pa),Z0=Vn;(q9&&Z0(new q9(new ArrayBuffer(1)))!=a1||Wa&&Z0(new Wa)!=m2||o1&&Z0(o1.resolve())!=pv||hv&&Z0(new hv)!=Y9||Pa&&Z0(new Pa)!=Bu)&&(Z0=function(S){var k=Vn(S),G=k==X9?S.constructor:void 0,ne=G?Pr(G):"";if(ne)switch(ne){case Bw:return a1;case K9:return m2;case y0:return pv;case fv:return Y9;case Uu:return Bu}return k});var l1=Z0,g2=Object.prototype,y2=g2.hasOwnProperty;function c1(S){var k=S.length,G=new S.constructor(k);return k&&typeof S[0]=="string"&&y2.call(S,"index")&&(G.index=S.index,G.input=S.input),G}var v2=c1,Z9=bn.Uint8Array,Q9=Z9;function mv(S){var k=new S.constructor(S.byteLength);return new Q9(k).set(new Q9(S)),k}var x2=mv;function qx(S,k){var G=k?x2(S.buffer):S.buffer;return new S.constructor(G,S.byteOffset,S.byteLength)}var gv=qx,b2=/\w*$/;function yv(S){var k=new S.constructor(S.source,b2.exec(S));return k.lastIndex=S.lastIndex,k}var Fl=yv,Ia=Ut?Ut.prototype:void 0,J9=Ia?Ia.valueOf:void 0;function vv(S){return J9?Object(J9.call(S)):{}}var e4=vv;function xv(S,k){var G=k?x2(S.buffer):S.buffer;return new S.constructor(G,S.byteOffset,S.length)}var bv=xv,u1="[object Boolean]",_v="[object Date]",Sv="[object Map]",wv="[object Number]",Tv="[object RegExp]",t4="[object Set]",Ev="[object String]",Xx="[object Symbol]",n4="[object ArrayBuffer]",r4="[object DataView]",Uw="[object Float32Array]",os="[object Float64Array]",lf="[object Int8Array]",Yx="[object Int16Array]",_2="[object Int32Array]",jd="[object Uint8Array]",zw="[object Uint8ClampedArray]",Mv="[object Uint16Array]",Cv="[object Uint32Array]";function Kx(S,k,G){var ne=S.constructor;switch(k){case n4:return x2(S);case u1:case _v:return new ne(+S);case r4:return gv(S,G);case Uw:case os:case lf:case Yx:case _2:case jd:case zw:case Mv:case Cv:return bv(S,G);case Sv:return new ne;case wv:case Ev:return new ne(S);case Tv:return Fl(S);case t4:return new ne;case Xx:return e4(S)}}var Av=Kx;function S2(S){return typeof S.constructor=="function"&&!jm(S)?Tx(X0(S)):{}}var Xa=S2,Zx="[object Map]";function Vw(S){return de(S)&&l1(S)==Zx}var i4=Vw,pa=Iu&&Iu.isMap,Qx=pa?Qg(pa):i4,tr=Qx,Wc="[object Set]";function $h(S){return de(S)&&l1(S)==Wc}var s4=$h,Jx=Iu&&Iu.isSet,d1=Jx?Qg(Jx):s4,o4=d1,Nv=1,Pv=2,e7=4,Rv="[object Arguments]",w2="[object Array]",T2="[object Boolean]",fa="[object Date]",v0="[object Error]",qc="[object Function]",Iv="[object GeneratorFunction]",t7="[object Map]",Xc="[object Number]",a4="[object Object]",zu="[object RegExp]",Gw="[object Set]",l4="[object String]",kv="[object Symbol]",Dv="[object WeakMap]",Ov="[object ArrayBuffer]",Lv="[object DataView]",E2="[object Float32Array]",h1="[object Float64Array]",Bl="[object Int8Array]",Vi="[object Int16Array]",Yo="[object Int32Array]",Io="[object Uint8Array]",ma="[object Uint8ClampedArray]",Ul="[object Uint16Array]",Wh="[object Uint32Array]",Qr={};Qr[Rv]=Qr[w2]=Qr[Ov]=Qr[Lv]=Qr[T2]=Qr[fa]=Qr[E2]=Qr[h1]=Qr[Bl]=Qr[Vi]=Qr[Yo]=Qr[t7]=Qr[Xc]=Qr[a4]=Qr[zu]=Qr[Gw]=Qr[l4]=Qr[kv]=Qr[Io]=Qr[ma]=Qr[Ul]=Qr[Wh]=!0,Qr[v0]=Qr[qc]=Qr[Dv]=!1;function qh(S,k,G,ne,he,ve){var je,ct=k&Nv,xt=k&Pv,Lt=k&e7;if(G&&(je=he?G(S,ne,he,ve):G(S)),je!==void 0)return je;if(!en(S))return S;var an=pt(S);if(an){if(je=v2(S),!ct)return Ex(S,je)}else{var dn=l1(S),In=dn==qc||dn==Iv;if(Lh(S))return K0(S,ct);if(dn==a4||dn==Rv||In&&!he){if(je=xt||In?{}:Xa(S),!ct)return xt?Hx(S,d2(je,S)):j9(S,U9(je,S))}else{if(!Qr[dn])return he?S:{};je=Av(S,dn,ct)}}ve||(ve=new qs);var dr=ve.get(S);if(dr)return dr;ve.set(S,je),o4(S)?S.forEach(function(fi){je.add(qh(fi,k,G,fi,S,ve))}):tr(S)&&S.forEach(function(fi,Jr){je.set(Jr,qh(fi,k,G,Jr,S,ve))});var sr=Lt?xt?W9:f2:xt?Jp:Fd,ii=an?void 0:sr(S);return Mx(ii||S,function(fi,Jr){ii&&(Jr=fi,fi=S[Jr]),Fg(je,Jr,qh(fi,k,G,Jr,S,ve))}),je}var Xh=qh,c4=1,Fv=4;function cf(S){return Xh(S,c4|Fv)}var hl=cf,Bv="__lodash_hash_undefined__";function Hd(S){return this.__data__.set(S,Bv),this}var Vu=Hd;function u4(S){return this.__data__.has(S)}var d4=u4;function Yc(S){var k=-1,G=S==null?0:S.length;for(this.__data__=new Md;++k<G;)this.add(S[k])}Yc.prototype.add=Yc.prototype.push=Vu,Yc.prototype.has=d4;var M2=Yc;function Kc(S,k){for(var G=-1,ne=S==null?0:S.length;++G<ne;)if(k(S[G],G,S))return!0;return!1}var h4=Kc;function p1(S,k){return S.has(k)}var f1=p1,p4=1,C2=2;function So(S,k,G,ne,he,ve){var je=G&p4,ct=S.length,xt=k.length;if(ct!=xt&&!(je&&xt>ct))return!1;var Lt=ve.get(S),an=ve.get(k);if(Lt&&an)return Lt==k&&an==S;var dn=-1,In=!0,dr=G&C2?new M2:void 0;for(ve.set(S,k),ve.set(k,S);++dn<ct;){var sr=S[dn],ii=k[dn];if(ne)var fi=je?ne(ii,sr,dn,k,S,ve):ne(sr,ii,dn,S,k,ve);if(fi!==void 0){if(fi)continue;In=!1;break}if(dr){if(!h4(k,function(Jr,$i){if(!f1(dr,$i)&&(sr===Jr||he(sr,Jr,G,ne,ve)))return dr.push($i)})){In=!1;break}}else if(!(sr===ii||he(sr,ii,G,ne,ve))){In=!1;break}}return ve.delete(S),ve.delete(k),In}var Gu=So;function x0(S){var k=-1,G=Array(S.size);return S.forEach(function(ne,he){G[++k]=[he,ne]}),G}var pl=x0;function f4(S){var k=-1,G=Array(S.size);return S.forEach(function(ne){G[++k]=ne}),G}var A2=f4,N2=1,Uv=2,$d="[object Boolean]",zv="[object Date]",m4="[object Error]",Yh="[object Map]",g4="[object Number]",zl="[object RegExp]",uf="[object Set]",P2="[object String]",Vv="[object Symbol]",R2="[object ArrayBuffer]",n7="[object DataView]",Gv=Ut?Ut.prototype:void 0,y4=Gv?Gv.valueOf:void 0;function jv(S,k,G,ne,he,ve,je){switch(G){case n7:if(S.byteLength!=k.byteLength||S.byteOffset!=k.byteOffset)return!1;S=S.buffer,k=k.buffer;case R2:return!(S.byteLength!=k.byteLength||!ve(new Q9(S),new Q9(k)));case $d:case zv:case g4:return Ui(+S,+k);case m4:return S.name==k.name&&S.message==k.message;case zl:case P2:return S==k+"";case Yh:var ct=pl;case uf:var xt=ne&N2;if(ct||(ct=A2),S.size!=k.size&&!xt)return!1;var Lt=je.get(S);if(Lt)return Lt==k;ne|=Uv,je.set(S,k);var an=Gu(ct(S),ct(k),ne,he,ve,je);return je.delete(S),an;case Vv:if(y4)return y4.call(S)==y4.call(k)}return!1}var Zc=jv,r7=1,m1=Object.prototype,I2=m1.hasOwnProperty;function Xs(S,k,G,ne,he,ve){var je=G&r7,ct=f2(S),xt=ct.length,Lt=f2(k),an=Lt.length;if(xt!=an&&!je)return!1;for(var dn=xt;dn--;){var In=ct[dn];if(!(je?In in k:I2.call(k,In)))return!1}var dr=ve.get(S),sr=ve.get(k);if(dr&&sr)return dr==k&&sr==S;var ii=!0;ve.set(S,k),ve.set(k,S);for(var fi=je;++dn<xt;){In=ct[dn];var Jr=S[In],$i=k[In];if(ne)var ka=je?ne($i,Jr,In,k,S,ve):ne(Jr,$i,In,S,k,ve);if(!(ka===void 0?Jr===$i||he(Jr,$i,G,ne,ve):ka)){ii=!1;break}fi||(fi=In=="constructor")}if(ii&&!fi){var Do=S.constructor,Zo=k.constructor;Do!=Zo&&"constructor"in S&&"constructor"in k&&!(typeof Do=="function"&&Do instanceof Do&&typeof Zo=="function"&&Zo instanceof Zo)&&(ii=!1)}return ve.delete(S),ve.delete(k),ii}var jw=Xs,Hv=1,i7="[object Arguments]",s7="[object Array]",g1="[object Object]",$v=Object.prototype,o7=$v.hasOwnProperty;function Q0(S,k,G,ne,he,ve){var je=pt(S),ct=pt(k),xt=je?s7:l1(S),Lt=ct?s7:l1(k);xt=xt==i7?g1:xt,Lt=Lt==i7?g1:Lt;var an=xt==g1,dn=Lt==g1,In=xt==Lt;if(In&&Lh(S)){if(!Lh(k))return!1;je=!0,an=!1}if(In&&!an)return ve||(ve=new qs),je||ps(S)?Gu(S,k,G,ne,he,ve):Zc(S,k,xt,G,ne,he,ve);if(!(G&Hv)){var dr=an&&o7.call(S,"__wrapped__"),sr=dn&&o7.call(k,"__wrapped__");if(dr||sr){var ii=dr?S.value():S,fi=sr?k.value():k;return ve||(ve=new qs),he(ii,fi,G,ne,ve)}}return In?(ve||(ve=new qs),jw(S,k,G,ne,he,ve)):!1}var k2=Q0;function v4(S,k,G,ne,he){return S===k?!0:S==null||k==null||!de(S)&&!de(k)?S!==S&&k!==k:k2(S,k,G,ne,v4,he)}var ju=v4,x4=1,df=2;function D2(S,k,G,ne){var he=G.length,ve=he,je=!ne;if(S==null)return!ve;for(S=Object(S);he--;){var ct=G[he];if(je&&ct[2]?ct[1]!==S[ct[0]]:!(ct[0]in S))return!1}for(;++he<ve;){ct=G[he];var xt=ct[0],Lt=S[xt],an=ct[1];if(je&&ct[2]){if(Lt===void 0&&!(xt in S))return!1}else{var dn=new qs;if(ne)var In=ne(Lt,an,xt,S,k,dn);if(!(In===void 0?ju(an,Lt,x4|df,ne,dn):In))return!1}}return!0}var Wv=D2;function qv(S){return S===S&&!en(S)}var Xv=qv;function b4(S){for(var k=Fd(S),G=k.length;G--;){var ne=k[G],he=S[ne];k[G]=[ne,he,Xv(he)]}return k}var a7=b4;function Yv(S,k){return function(G){return G==null?!1:G[S]===k&&(k!==void 0||S in Object(G))}}var _4=Yv;function O2(S){var k=a7(S);return k.length==1&&k[0][2]?_4(k[0][0],k[0][1]):function(G){return G===S||Wv(G,S,k)}}var L2=O2;function Kv(S,k){return S!=null&&k in Object(S)}var S4=Kv;function l7(S,k,G){k=Xo(k,S);for(var ne=-1,he=k.length,ve=!1;++ne<he;){var je=Il(k[ne]);if(!(ve=S!=null&&G(S,je)))break;S=S[je]}return ve||++ne!=he?ve:(he=S==null?0:S.length,!!he&&Gg(he)&&Bg(je,he)&&(pt(S)||Hm(S)))}var Zv=l7;function w4(S,k){return S!=null&&Zv(S,k,S4)}var F2=w4,T4=1,B2=2;function Qv(S,k){return ar(S)&&Xv(k)?_4(Il(S),k):function(G){var ne=Bc(G,S);return ne===void 0&&ne===k?F2(G,S):ju(k,ne,T4|B2)}}var c7=Qv;function U2(S){return function(k){return k==null?void 0:k[S]}}var Jv=U2;function y1(S){return function(k){return Vp(k,S)}}var Hw=y1;function E4(S){return ar(S)?Jv(Il(S)):Hw(S)}var p=E4;function v(S){return typeof S=="function"?S:S==null?qp:typeof S=="object"?pt(S)?c7(S[0],S[1]):L2(S):p(S)}var E=v;function L(S){return function(k,G,ne){for(var he=-1,ve=Object(k),je=ne(k),ct=je.length;ct--;){var xt=je[S?ct:++he];if(G(ve[xt],xt,ve)===!1)break}return k}}var q=L,ee=q(),pe=ee;function Fe(S,k){return S&&pe(S,k,Fd)}var Ze=Fe,It=function(){return bn.Date.now()},on=It,fn="Expected a function",sn=Math.max,Xn=Math.min;function nr(S,k,G){var ne,he,ve,je,ct,xt,Lt=0,an=!1,dn=!1,In=!0;if(typeof S!="function")throw new TypeError(fn);k=le(k)||0,en(G)&&(an=!!G.leading,dn="maxWait"in G,ve=dn?sn(le(G.maxWait)||0,k):ve,In="trailing"in G?!!G.trailing:In);function dr(as){var ga=ne,Vl=he;return ne=he=void 0,Lt=as,je=S.apply(Vl,ga),je}function sr(as){return Lt=as,ct=setTimeout(Jr,k),an?dr(as):je}function ii(as){var ga=as-xt,Vl=as-Lt,tc=k-ga;return dn?Xn(tc,ve-Vl):tc}function fi(as){var ga=as-xt,Vl=as-Lt;return xt===void 0||ga>=k||ga<0||dn&&Vl>=ve}function Jr(){var as=on();if(fi(as))return $i(as);ct=setTimeout(Jr,ii(as))}function $i(as){return ct=void 0,In&&ne?dr(as):(ne=he=void 0,je)}function ka(){ct!==void 0&&clearTimeout(ct),Lt=0,ne=xt=he=ct=void 0}function Do(){return ct===void 0?je:$i(on())}function Zo(){var as=on(),ga=fi(as);if(ne=arguments,he=this,xt=as,ga){if(ct===void 0)return sr(xt);if(dn)return clearTimeout(ct),ct=setTimeout(Jr,k),dr(xt)}return ct===void 0&&(ct=setTimeout(Jr,k)),je}return Zo.cancel=ka,Zo.flush=Do,Zo}var ur=nr;function ao(S){var k=S==null?0:S.length;return k?S[k-1]:void 0}var _t=ao;function lt(S,k){return k.length<2?S:Vp(S,t2(k,0,-1))}var Ct=lt;function Sn(S){return typeof S=="number"&&S==Na(S)}var vr=Sn;function Rr(S,k){var G={};return k=E(k),Ze(S,function(ne,he,ve){j0(G,he,k(ne,he,ve))}),G}var Dr=Rr;function jr(S,k){return k=Xo(k,S),S=Ct(S,k),S==null||delete S[Il(_t(k))]}var Ko=jr,Gi=9007199254740991,Hu=Math.floor;function u7(S,k){var G="";if(!S||k<1||k>Gi)return G;do k%2&&(G+=S),k=Hu(k/2),k&&(S+=S);while(k);return G}var $w=u7,bN=Jv("length"),Ww=bN,qw="\\ud800-\\udfff",_N="\\u0300-\\u036f",SN="\\ufe20-\\ufe2f",wN="\\u20d0-\\u20ff",TN=_N+SN+wN,EN="\\ufe0e\\ufe0f",MN="["+qw+"]",d7="["+TN+"]",h7="\\ud83c[\\udffb-\\udfff]",CN="(?:"+d7+"|"+h7+")",Xw="[^"+qw+"]",Yw="(?:\\ud83c[\\udde6-\\uddff]){2}",Kw="[\\ud800-\\udbff][\\udc00-\\udfff]",AN="\\u200d",Zw=CN+"?",Qw="["+EN+"]?",Us="(?:"+AN+"(?:"+[Xw,Yw,Kw].join("|")+")"+Qw+Zw+")*",NN=Qw+Zw+Us,JB="(?:"+[Xw+d7+"?",d7,Yw,Kw,MN].join("|")+")",PN=RegExp(h7+"(?="+h7+")|"+JB+NN,"g");function RN(S){for(var k=PN.lastIndex=0;PN.test(S);)++k;return k}var IN=RN;function kN(S){return s2(S)?IN(S):Ww(S)}var DN=kN,eU=Math.ceil;function ON(S,k){k=k===void 0?" ":Lg(k);var G=k.length;if(G<2)return G?$w(k,S):k;var ne=$w(k,eU(S/DN(k)));return s2(k)?Gh(l2(ne),0,S).join(""):ne.slice(0,S)}var LN=ON;function tU(S,k,G){S=Fc(S),k=Na(k);var ne=k?DN(S):0;return k&&ne<k?LN(k-ne,G)+S:S}var e8=tU;function FN(S,k){return S==null?!0:Ko(S,k)}var BN=FN,p7=5*1e3,Jw=class{constructor(S){C(this,"_cache",new Uc),C(this,"_keepHotUntapDebounce"),Ve(this,S)}get type(){return"Theatre_SheetObject_PublicAPI"}get props(){return ce(this).propsP}get sheet(){return ce(this).sheet.publicApi}get project(){return ce(this).sheet.project.publicApi}get address(){return w({},ce(this).address)}_valuesPrism(){return this._cache.get("_valuesPrism",()=>{const S=ce(this);return(0,Nd.prism)(()=>(0,Nd.val)(S.getValues().getValue()))})}onValuesChange(S,k){return PT(this._valuesPrism(),S,k)}get value(){const S=this._valuesPrism();{if(!S.isHot){this._keepHotUntapDebounce!=null&&this._keepHotUntapDebounce.flush();const k=S.keepHot();this._keepHotUntapDebounce=ur(()=>{k(),this._keepHotUntapDebounce=void 0},p7)}this._keepHotUntapDebounce&&this._keepHotUntapDebounce()}return S.getValue()}set initialValue(S){ce(this).setInitialValue(S)}};function UN(S){const k=new WeakMap;return G=>(k.has(G)||k.set(G,S(G)),k.get(G))}function f7(S){return S.type==="compound"||S.type==="enum"}function m7(S,k){if(!S)return;const[G,...ne]=k;if(G===void 0)return S;if(!f7(S))return;const he=S.type==="enum"?S.cases[G]:S.props[G];return m7(he,ne)}function nU(S){return!f7(S)}var rU=class{constructor(S,k,G){this.sheet=S,this.template=k,this.nativeObject=G,C(this,"$$isPointerToPrismProvider",!0),C(this,"address"),C(this,"publicApi"),C(this,"_initialValue",new Di.Atom({})),C(this,"_cache",new Uc),C(this,"_logger"),C(this,"_internalUtilCtx"),this._logger=S._logger.named("SheetObject",k.address.objectKey),this._logger._trace("creating object"),this._internalUtilCtx={logger:this._logger.utilFor.internal()},this.address=A(w({},k.address),{sheetInstanceId:S.address.sheetInstanceId}),this.publicApi=new Jw(this)}get type(){return"Theatre_SheetObject"}getValues(){return this._cache.get("getValues()",()=>(0,Di.prism)(()=>{const S=(0,Di.val)(this.template.getDefaultValues()),k=(0,Di.val)(this._initialValue.pointer),G=Di.prism.memo("withInitialCache",()=>new WeakMap,[]),ne=Ph(S,k,G),he=(0,Di.val)(this.template.getStaticValues()),ve=Di.prism.memo("withStatics",()=>new WeakMap,[]);let ct=Ph(ne,he,ve),xt;{const an=Di.prism.memo("seq",()=>this.getSequencedValues(),[]),dn=Di.prism.memo("withSeqsCache",()=>new WeakMap,[]);xt=(0,Di.val)((0,Di.val)(an)),ct=Ph(ct,xt,dn)}return zg("finalAtom",ct).pointer}))}getValueByPointer(S){const k=(0,Di.val)(this.getValues()),{path:G}=(0,Di.getPointerParts)(S);return(0,Di.val)(H0(k,G))}pointerToPrism(S){const{path:k}=(0,Di.getPointerParts)(S);return(0,Di.prism)(()=>{const G=(0,Di.val)(this.getValues());return(0,Di.val)(H0(G,k))})}getSequencedValues(){return(0,Di.prism)(()=>{const S=Di.prism.memo("tracksToProcess",()=>this.template.getArrayOfValidSequenceTracks(),[]),k=(0,Di.val)(S),G=new Di.Atom({}),ne=(0,Di.val)(this.template.configPointer);return Di.prism.effect("processTracks",()=>{const he=[];for(const{trackId:ve,pathToProp:je}of k){const ct=this._trackIdToPrism(ve),xt=m7(ne,je),Lt=xt.deserializeAndSanitize,an=xt.interpolate,dn=()=>{const dr=ct.getValue();if(!dr)return G.setByPointer($i=>H0($i,je),void 0);const sr=Lt(dr.left),ii=sr===void 0?xt.default:sr;if(dr.right===void 0)return G.setByPointer($i=>H0($i,je),ii);const fi=Lt(dr.right),Jr=fi===void 0?xt.default:fi;return G.setByPointer($i=>H0($i,je),an(ii,Jr,dr.progression))},In=ct.onStale(dn);dn(),he.push(In)}return()=>{for(const ve of he)ve()}},[ne,...k]),G.pointer})}_trackIdToPrism(S){const k=this.template.project.pointers.historic.sheetsById[this.address.sheetId].sequence.tracksByObject[this.address.objectKey].trackData[S],G=this.sheet.getSequence().positionPrism;return D5(this._internalUtilCtx,k,G)}get propsP(){return this._cache.get("propsP",()=>(0,Di.pointer)({root:this,path:[]}))}validateValue(S,k){}setInitialValue(S){this.validateValue(this.propsP,S),this._initialValue.set(S)}};function Ns(S){return function(G,ne){return S(G,ne())}}var J0={_hmm:Qc(524),_todo:Qc(522),_error:Qc(521),errorDev:Qc(529),errorPublic:Qc(545),_kapow:Qc(268),_warn:Qc(265),warnDev:Qc(273),warnPublic:Qc(289),_debug:Qc(137),debugDev:Qc(145),_trace:Qc(73),traceDev:Qc(81)};function Qc(S){return Object.freeze({audience:v1(S,8)?"internal":v1(S,16)?"dev":"public",category:v1(S,4)?"troubleshooting":v1(S,2)?"todo":"general",level:v1(S,512)?512:v1(S,256)?256:v1(S,128)?128:64})}function v1(S,k){return(S&k)===k}function zs(S,k){return((k&32)===32?!0:(k&16)===16?S.dev:(k&8)===8?S.internal:!1)&&S.min<=k}var Wd={loggingConsoleStyle:!0,loggerConsoleStyle:!0,includes:Object.freeze({internal:!1,dev:!1,min:256}),filtered:function(){},include:function(){return{}},create:null,creatExt:null,named(S,k,G){return this.create({names:[...S.names,{name:k,key:G}]})},style:{bold:void 0,italic:void 0,cssMemo:new Map([["",""]]),collapseOnRE:/[a-z- ]+/g,color:void 0,collapsed(S){if(S.length<5)return S;const k=S.replace(this.collapseOnRE,"");return this.cssMemo.has(k)||this.cssMemo.set(k,this.css(S)),k},css(S){var k,G,ne,he;const ve=this.cssMemo.get(S);if(ve)return ve;let je="color:".concat((G=(k=this.color)==null?void 0:k.call(this,S))!=null?G:"hsl(".concat((S.charCodeAt(0)+S.charCodeAt(S.length-1))%360,", 100%, 60%)"));return(ne=this.bold)!=null&&ne.test(S)&&(je+=";font-weight:600"),(he=this.italic)!=null&&he.test(S)&&(je+=";font-style:italic"),this.cssMemo.set(S,je),je}}};function eT(S=console,k={}){const G=A(w({},Wd),{includes:w({},Wd.includes)}),ne={styled:sU.bind(G,S),noStyle:g7.bind(G,S)},he=zN.bind(G);function ve(){return G.loggingConsoleStyle&&G.loggerConsoleStyle?ne.styled:ne.noStyle}return G.create=ve(),{configureLogger(je){var ct;je==="console"?(G.loggerConsoleStyle=Wd.loggerConsoleStyle,G.create=ve()):je.type==="console"?(G.loggerConsoleStyle=(ct=je.style)!=null?ct:Wd.loggerConsoleStyle,G.create=ve()):je.type==="keyed"?(G.creatExt=xt=>je.keyed(xt.names),G.create=he):je.type==="named"&&(G.creatExt=iU.bind(null,je.named),G.create=he)},configureLogging(je){var ct,xt,Lt,an,dn;G.includes.dev=(ct=je.dev)!=null?ct:Wd.includes.dev,G.includes.internal=(xt=je.internal)!=null?xt:Wd.includes.internal,G.includes.min=(Lt=je.min)!=null?Lt:Wd.includes.min,G.include=(an=je.include)!=null?an:Wd.include,G.loggingConsoleStyle=(dn=je.consoleStyle)!=null?dn:Wd.loggingConsoleStyle,G.create=ve()},getLogger(){return G.create({names:[]})}}}function iU(S,k){const G=[];for(let{name:ne,key:he}of k.names)G.push(he==null?ne:"".concat(ne," (").concat(he,")"));return S(G)}function zN(S){const k=w(w({},this.includes),this.include(S)),G=this.filtered,ne=this.named.bind(this,S),he=this.creatExt(S),ve=zs(k,524),je=zs(k,522),ct=zs(k,521),xt=zs(k,529),Lt=zs(k,545),an=zs(k,265),dn=zs(k,268),In=zs(k,273),dr=zs(k,289),sr=zs(k,137),ii=zs(k,145),fi=zs(k,73),Jr=zs(k,81),$i=ve?he.error.bind(he,J0._hmm):G.bind(S,524),ka=je?he.error.bind(he,J0._todo):G.bind(S,522),Do=ct?he.error.bind(he,J0._error):G.bind(S,521),Zo=xt?he.error.bind(he,J0.errorDev):G.bind(S,529),as=Lt?he.error.bind(he,J0.errorPublic):G.bind(S,545),ga=dn?he.warn.bind(he,J0._kapow):G.bind(S,268),Vl=an?he.warn.bind(he,J0._warn):G.bind(S,265),tc=In?he.warn.bind(he,J0.warnDev):G.bind(S,273),qd=dr?he.warn.bind(he,J0.warnPublic):G.bind(S,273),Xd=sr?he.debug.bind(he,J0._debug):G.bind(S,137),Jh=ii?he.debug.bind(he,J0.debugDev):G.bind(S,145),$u=fi?he.trace.bind(he,J0._trace):G.bind(S,73),Ya=Jr?he.trace.bind(he,J0.traceDev):G.bind(S,81),Ps={_hmm:$i,_todo:ka,_error:Do,errorDev:Zo,errorPublic:as,_kapow:ga,_warn:Vl,warnDev:tc,warnPublic:qd,_debug:Xd,debugDev:Jh,_trace:$u,traceDev:Ya,lazy:{_hmm:ve?Ns($i):$i,_todo:je?Ns(ka):ka,_error:ct?Ns(Do):Do,errorDev:xt?Ns(Zo):Zo,errorPublic:Lt?Ns(as):as,_kapow:dn?Ns(ga):ga,_warn:an?Ns(Vl):Vl,warnDev:In?Ns(tc):tc,warnPublic:dr?Ns(qd):qd,_debug:sr?Ns(Xd):Xd,debugDev:ii?Ns(Jh):Jh,_trace:fi?Ns($u):$u,traceDev:Jr?Ns(Ya):Ya},named:ne,utilFor:{internal(){return{debug:Ps._debug,error:Ps._error,warn:Ps._warn,trace:Ps._trace,named(ya,Ts){return Ps.named(ya,Ts).utilFor.internal()}}},dev(){return{debug:Ps.debugDev,error:Ps.errorDev,warn:Ps.warnDev,trace:Ps.traceDev,named(ya,Ts){return Ps.named(ya,Ts).utilFor.dev()}}},public(){return{error:Ps.errorPublic,warn:Ps.warnPublic,debug(ya,Ts){Ps._warn('(public "debug" filtered out) '.concat(ya),Ts)},trace(ya,Ts){Ps._warn('(public "trace" filtered out) '.concat(ya),Ts)},named(ya,Ts){return Ps.named(ya,Ts).utilFor.public()}}}}};return Ps}function sU(S,k){const G=w(w({},this.includes),this.include(k)),ne=[];let he="";for(let xt=0;xt<k.names.length;xt++){const{name:Lt,key:an}=k.names[xt];if(he+=" %c".concat(Lt),ne.push(this.style.css(Lt)),an!=null){const dn="%c#".concat(an);he+=dn,ne.push(this.style.css(dn))}}const ve=this.filtered,je=this.named.bind(this,k),ct=[he,...ne];return y7(ve,k,G,S,ct,oU(ct),je)}function oU(S){const k=S.slice(0);for(let G=1;G<k.length;G++)k[G]+=";background-color:#e0005a;padding:2px;color:white";return k}function g7(S,k){const G=w(w({},this.includes),this.include(k));let ne="";for(let ct=0;ct<k.names.length;ct++){const{name:xt,key:Lt}=k.names[ct];ne+=" ".concat(xt),Lt!=null&&(ne+="#".concat(Lt))}const he=this.filtered,ve=this.named.bind(this,k),je=[ne];return y7(he,k,G,S,je,je,ve)}function y7(S,k,G,ne,he,ve,je){const ct=zs(G,524),xt=zs(G,522),Lt=zs(G,521),an=zs(G,529),dn=zs(G,545),In=zs(G,265),dr=zs(G,268),sr=zs(G,273),ii=zs(G,289),fi=zs(G,137),Jr=zs(G,145),$i=zs(G,73),ka=zs(G,81),Do=ct?ne.error.bind(ne,...he):S.bind(k,524),Zo=xt?ne.error.bind(ne,...he):S.bind(k,522),as=Lt?ne.error.bind(ne,...he):S.bind(k,521),ga=an?ne.error.bind(ne,...he):S.bind(k,529),Vl=dn?ne.error.bind(ne,...he):S.bind(k,545),tc=dr?ne.warn.bind(ne,...ve):S.bind(k,268),qd=In?ne.warn.bind(ne,...he):S.bind(k,265),Xd=sr?ne.warn.bind(ne,...he):S.bind(k,273),Jh=ii?ne.warn.bind(ne,...he):S.bind(k,273),$u=fi?ne.info.bind(ne,...he):S.bind(k,137),Ya=Jr?ne.info.bind(ne,...he):S.bind(k,145),Ps=$i?ne.debug.bind(ne,...he):S.bind(k,73),ya=ka?ne.debug.bind(ne,...he):S.bind(k,81),Ts={_hmm:Do,_todo:Zo,_error:as,errorDev:ga,errorPublic:Vl,_kapow:tc,_warn:qd,warnDev:Xd,warnPublic:Jh,_debug:$u,debugDev:Ya,_trace:Ps,traceDev:ya,lazy:{_hmm:ct?Ns(Do):Do,_todo:xt?Ns(Zo):Zo,_error:Lt?Ns(as):as,errorDev:an?Ns(ga):ga,errorPublic:dn?Ns(Vl):Vl,_kapow:dr?Ns(tc):tc,_warn:In?Ns(qd):qd,warnDev:sr?Ns(Xd):Xd,warnPublic:ii?Ns(Jh):Jh,_debug:fi?Ns($u):$u,debugDev:Jr?Ns(Ya):Ya,_trace:$i?Ns(Ps):Ps,traceDev:ka?Ns(ya):ya},named:je,utilFor:{internal(){return{debug:Ts._debug,error:Ts._error,warn:Ts._warn,trace:Ts._trace,named(lo,ff){return Ts.named(lo,ff).utilFor.internal()}}},dev(){return{debug:Ts.debugDev,error:Ts.errorDev,warn:Ts.warnDev,trace:Ts.traceDev,named(lo,ff){return Ts.named(lo,ff).utilFor.dev()}}},public(){return{error:Ts.errorPublic,warn:Ts.warnPublic,debug(lo,ff){Ts._warn('(public "debug" filtered out) '.concat(lo),ff)},trace(lo,ff){Ts._warn('(public "trace" filtered out) '.concat(lo),ff)},named(lo,ff){return Ts.named(lo,ff).utilFor.public()}}}}};return Ts}var VN=eT(console,{});VN.configureLogging({dev:!0,min:64});var t8=VN.getLogger().named("Theatre.js (default logger)").utilFor.dev(),tT=new WeakMap;function GN(S){const k=tT.get(S);if(k)return k;const G=new Map;return tT.set(S,G),nT([],S,G),G}function nT(S,k,G){for(const[ne,he]of Object.entries(k.props))if(!f7(he)){const ve=[...S,ne];G.set(JSON.stringify(ve),G.size),rT(ve,he,G)}for(const[ne,he]of Object.entries(k.props))if(f7(he)){const ve=[...S,ne];G.set(JSON.stringify(ve),G.size),rT(ve,he,G)}}function rT(S,k,G){if(k.type==="compound")nT(S,k,G);else{if(k.type==="enum")throw new Error("Enums aren't supported yet");G.set(JSON.stringify(S),G.size)}}function iT(S){return typeof S=="object"&&S!==null&&Object.keys(S).length===0}var jN=class{constructor(S,k,G,ne,he){this.sheetTemplate=S,C(this,"address"),C(this,"type","Theatre_SheetObjectTemplate"),C(this,"_config"),C(this,"_temp_actions_atom"),C(this,"_cache",new Uc),C(this,"project"),C(this,"pointerToSheetState"),C(this,"pointerToStaticOverrides"),this.address=A(w({},S.address),{objectKey:k}),this._config=new bo.Atom(ne),this._temp_actions_atom=new bo.Atom(he),this.project=S.project,this.pointerToSheetState=this.sheetTemplate.project.pointers.historic.sheetsById[this.address.sheetId],this.pointerToStaticOverrides=this.pointerToSheetState.staticOverrides.byObject[this.address.objectKey]}get staticConfig(){return this._config.get()}get configPointer(){return this._config.pointer}get _temp_actions(){return this._temp_actions_atom.get()}get _temp_actionsPointer(){return this._temp_actions_atom.pointer}createInstance(S,k,G){return this._config.set(G),new rU(S,this,k)}reconfigure(S){this._config.set(S)}_temp_setActions(S){this._temp_actions_atom.set(S)}getDefaultValues(){return this._cache.get("getDefaultValues()",()=>(0,bo.prism)(()=>{const S=(0,bo.val)(this.configPointer);return k5(S)}))}getStaticValues(){return this._cache.get("getStaticValues",()=>(0,bo.prism)(()=>{var S;const k=(S=(0,bo.val)(this.pointerToStaticOverrides))!=null?S:{};return(0,bo.val)(this.configPointer).deserializeAndSanitize(k)||{}}))}getArrayOfValidSequenceTracks(){return this._cache.get("getArrayOfValidSequenceTracks",()=>(0,bo.prism)(()=>{const S=this.project.pointers.historic.sheetsById[this.address.sheetId],k=(0,bo.val)(S.sequence.tracksByObject[this.address.objectKey].trackIdByPropPath);if(!k)return Pe;const G=[];if(!k)return Pe;const ne=(0,bo.val)(this.configPointer),he=Object.entries(k);for(const[je,ct]of he){const xt=HN(je);if(!xt)continue;const Lt=m7(ne,xt);Lt&&nU(Lt)&&G.push({pathToProp:xt,trackId:ct})}const ve=GN(ne);return G.sort((je,ct)=>{const xt=je.pathToProp,Lt=ct.pathToProp,an=ve.get(JSON.stringify(xt)),dn=ve.get(JSON.stringify(Lt));return an>dn?1:-1}),G.length===0?Pe:G}))}getMapOfValidSequenceTracks_forStudio(){return this._cache.get("getMapOfValidSequenceTracks_forStudio",()=>(0,bo.prism)(()=>{const S=(0,bo.val)(this.getArrayOfValidSequenceTracks());let k={};for(const{pathToProp:G,trackId:ne}of S)Hp(k,G,ne);return k}))}getStaticButNotSequencedOverrides(){return this._cache.get("getStaticButNotSequencedOverrides",()=>(0,bo.prism)(()=>{const S=(0,bo.val)(this.getStaticValues()),k=(0,bo.val)(this.getArrayOfValidSequenceTracks()),G=hl(S);for(const{pathToProp:ne}of k){BN(G,ne);let he=ne.slice(0,-1);for(;he.length>0;){const ve=Ad(G,he);if(!iT(ve))break;BN(G,he),he=he.slice(0,-1)}}if(!iT(G))return G}))}getDefaultsAtPointer(S){const{path:k}=(0,bo.getPointerParts)(S),G=this.getDefaultValues().getValue();return Ad(G,k)}};function HN(S){try{return JSON.parse(S)}catch{t8.warn("property ".concat(JSON.stringify(S)," cannot be parsed. Skipping."));return}}var sT=un(),$N=UN(S=>JSON.stringify(S));U(se());var WN=class extends Error{},M4=class extends WN{},oT=un(),aT=un(),v7=un(),ko=un();function hf(){let S,k;const G=new Promise((he,ve)=>{S=je=>{he(je),ne.status="resolved"},k=je=>{ve(je),ne.status="rejected"}}),ne={resolve:S,reject:k,promise:G,status:"pending"};return ne}var aU=()=>{},n8=aU,qN=un(),XN=class{constructor(){C(this,"_stopPlayCallback",n8),C(this,"_state",new qN.Atom({position:0,playing:!1})),C(this,"statePointer"),this.statePointer=this._state.pointer}destroy(){}pause(){this._stopPlayCallback(),this.playing=!1,this._stopPlayCallback=n8}gotoPosition(S){this._updatePositionInState(S)}_updatePositionInState(S){this._state.setByPointer(k=>k.position,S)}getCurrentPosition(){return this._state.get().position}get playing(){return this._state.get().playing}set playing(S){this._state.setByPointer(k=>k.playing,S)}play(S,k,G,ne,he){this.playing&&this.pause(),this.playing=!0;const ve=k[1]-k[0];{const In=this.getCurrentPosition();In<k[0]||In>k[1]?ne==="normal"||ne==="alternate"?this._updatePositionInState(k[0]):(ne==="reverse"||ne==="alternateReverse")&&this._updatePositionInState(k[1]):ne==="normal"||ne==="alternate"?In===k[1]&&this._updatePositionInState(k[0]):In===k[0]&&this._updatePositionInState(k[1])}const je=hf(),ct=he.time,xt=ve*S;let Lt=this.getCurrentPosition()-k[0];(ne==="reverse"||ne==="alternateReverse")&&(Lt=k[1]-this.getCurrentPosition());const an=In=>{const sr=Math.max(In-ct,0)/1e3,ii=Math.min(sr*G+Lt,xt);if(ii!==xt){const fi=Math.floor(ii/ve);let Jr=ii/ve%1*ve;if(ne!=="normal")if(ne==="reverse")Jr=ve-Jr;else{const $i=fi%2===0;ne==="alternate"?$i||(Jr=ve-Jr):$i&&(Jr=ve-Jr)}this._updatePositionInState(Jr+k[0]),dn()}else{if(ne==="normal")this._updatePositionInState(k[1]);else if(ne==="reverse")this._updatePositionInState(k[0]);else{const fi=(S-1)%2===0;ne==="alternate"?fi?this._updatePositionInState(k[1]):this._updatePositionInState(k[0]):fi?this._updatePositionInState(k[0]):this._updatePositionInState(k[1])}this.playing=!1,je.resolve(!0)}};this._stopPlayCallback=()=>{he.offThisOrNextTick(an),he.offNextTick(an),this.playing&&je.resolve(!1)};const dn=()=>he.onNextTick(an);return he.onThisOrNextTick(an),je.promise}playDynamicRange(S,k){this.playing&&this.pause(),this.playing=!0;const G=hf(),ne=S.keepHot();G.promise.then(ne,ne);let he=k.time;const ve=ct=>{const xt=Math.max(ct-he,0);he=ct;const Lt=xt/1e3,an=this.getCurrentPosition(),dn=S.getValue();if(an<dn[0]||an>dn[1])this.gotoPosition(dn[0]);else{let In=an+Lt;In>dn[1]&&(In=dn[0]+(In-dn[1])),this.gotoPosition(In)}je()};this._stopPlayCallback=()=>{k.offThisOrNextTick(ve),k.offNextTick(ve),G.resolve(!1)};const je=()=>k.onNextTick(ve);return k.onThisOrNextTick(ve),G.promise}},YN=un(),lU="__TheatreJS_StudioBundle",lT="__TheatreJS_CoreBundle",KN="__TheatreJS_Notifications",C4=S=>(...k)=>{var G;switch(S){case"success":{t8.debug(k.slice(0,2).join(`
`));break}case"info":{t8.debug(k.slice(0,2).join(`
`));break}case"warning":{t8.warn(k.slice(0,2).join(`
`));break}}return typeof window<"u"?(G=window[KN])==null?void 0:G.notify[S](...k):void 0},x1={warning:C4("warning"),success:C4("success"),info:C4("info"),error:C4("error")};typeof window<"u"&&(window.addEventListener("error",S=>{x1.error("An error occurred","<pre>".concat(S.message,`</pre>

See **console** for details.`))}),window.addEventListener("unhandledrejection",S=>{x1.error("An error occurred","<pre>".concat(S.reason,`</pre>

See **console** for details.`))}));var r8=class{constructor(S,k,G){this._decodedBuffer=S,this._audioContext=k,this._nodeDestination=G,C(this,"_mainGain"),C(this,"_state",new YN.Atom({position:0,playing:!1})),C(this,"statePointer"),C(this,"_stopPlayCallback",n8),this.statePointer=this._state.pointer,this._mainGain=this._audioContext.createGain(),this._mainGain.connect(this._nodeDestination)}playDynamicRange(S,k){const G=hf();this._playing&&this.pause(),this._playing=!0;let ne;const he=()=>{ne==null||ne(),ne=this._loopInRange(S.getValue(),k).stop},ve=S.onStale(he);return he(),this._stopPlayCallback=()=>{ne==null||ne(),ve(),G.resolve(!1)},G.promise}_loopInRange(S,k){let ne=this.getCurrentPosition();const he=S[1]-S[0];ne<S[0]||ne>S[1]?this._updatePositionInState(S[0]):ne===S[1]&&this._updatePositionInState(S[0]),ne=this.getCurrentPosition();const ve=this._audioContext.createBufferSource();ve.buffer=this._decodedBuffer,ve.connect(this._mainGain),ve.playbackRate.value=1,ve.loop=!0,ve.loopStart=S[0],ve.loopEnd=S[1];const je=k.time;let ct=ne-S[0];ve.start(0,ne);const xt=dn=>{let ii=(Math.max(dn-je,0)/1e3*1+ct)/he%1*he;this._updatePositionInState(ii+S[0]),Lt()},Lt=()=>k.onNextTick(xt);return k.onThisOrNextTick(xt),{stop:()=>{ve.stop(),ve.disconnect(),k.offThisOrNextTick(xt),k.offNextTick(xt)}}}get _playing(){return this._state.get().playing}set _playing(S){this._state.setByPointer(k=>k.playing,S)}destroy(){}pause(){this._stopPlayCallback(),this._playing=!1,this._stopPlayCallback=n8}gotoPosition(S){this._updatePositionInState(S)}_updatePositionInState(S){this._state.reduce(k=>A(w({},k),{position:S}))}getCurrentPosition(){return this._state.get().position}play(S,k,G,ne,he){this._playing&&this.pause(),this._playing=!0;let ve=this.getCurrentPosition();const je=k[1]-k[0];if(ne!=="normal")throw new M4('Audio-controlled sequences can only be played in the "normal" direction. '+"'".concat(ne,"' given."));ve<k[0]||ve>k[1]?this._updatePositionInState(k[0]):ve===k[1]&&this._updatePositionInState(k[0]),ve=this.getCurrentPosition();const ct=hf(),xt=this._audioContext.createBufferSource();xt.buffer=this._decodedBuffer,xt.connect(this._mainGain),xt.playbackRate.value=G,S>1e3&&(x1.warning("Can't play sequences with audio more than 1000 times","The sequence will still play, but only 1000 times. The `iterationCount: ".concat(S,"` provided to `sequence.play()`\nis too high for a sequence with audio.\n\nTo fix this, either set `iterationCount` to a lower value, or remove the audio from the sequence."),[{url:"https://www.theatrejs.com/docs/latest/manual/audio",title:"Using Audio"},{url:"https://www.theatrejs.com/docs/latest/api/core#sequence.attachaudio",title:"Audio API"}]),S=1e3),S>1&&(xt.loop=!0,xt.loopStart=k[0],xt.loopEnd=k[1]);const Lt=he.time;let an=ve-k[0];const dn=je*S;xt.start(0,ve,dn-an);const In=ii=>{const Jr=Math.max(ii-Lt,0)/1e3,$i=Math.min(Jr*G+an,dn);if($i!==dn){let ka=$i/je%1*je;this._updatePositionInState(ka+k[0]),sr()}else this._updatePositionInState(k[1]),this._playing=!1,dr(),ct.resolve(!0)},dr=()=>{xt.stop(),xt.disconnect()};this._stopPlayCallback=()=>{dr(),he.offThisOrNextTick(In),he.offNextTick(In),this._playing&&ct.resolve(!1)};const sr=()=>he.onNextTick(In);return he.onThisOrNextTick(In),ct.promise}},ZN=un(),x7=0;function b7(S){var k;const G=je=>{ne.tick(je)},ne=new ZN.Ticker({onActive(){var je;(je=S==null?void 0:S.start)==null||je.call(S)},onDormant(){var je;(je=S==null?void 0:S.stop)==null||je.call(S)}}),he={tick:G,id:x7++,name:(k=S==null?void 0:S.name)!=null?k:"CustomRafDriver-".concat(x7),type:"Theatre_RafDriver_PublicAPI"},ve={type:"Theatre_RafDriver_PrivateAPI",publicApi:he,ticker:ne,start:S==null?void 0:S.start,stop:S==null?void 0:S.stop};return Ve(he,ve),he}function cU(){let S=null;const ne=b7({name:"DefaultCoreRafDriver",start:()=>{if(typeof window<"u"){const he=ve=>{ne.tick(ve),S=window.requestAnimationFrame(he)};S=window.requestAnimationFrame(he)}else ne.tick(0),setTimeout(()=>ne.tick(1),0)},stop:()=>{typeof window<"u"&&S!==null&&window.cancelAnimationFrame(S)}});return ne}var i8;function _7(){return i8||uU(cU()),i8}function S7(){return _7().ticker}function uU(S){if(i8)throw new Error("`setCoreRafDriver()` is already called.");i8=ce(S)}var QN=class{get type(){return"Theatre_Sequence_PublicAPI"}constructor(S){Ve(this,S)}play(S){const k=ce(this);if(k._project.isReady()){const G=S!=null&&S.rafDriver?ce(S.rafDriver).ticker:S7();return k.play(S??{},G)}else{const G=hf();return G.resolve(!0),G.promise}}pause(){ce(this).pause()}get position(){return ce(this).position}set position(S){ce(this).position=S}__experimental_getKeyframes(S){return ce(this).getKeyframesOfSimpleProp(S)}async attachAudio(S){const{audioContext:k,destinationNode:G,decodedBuffer:ne,gainNode:he}=await JN(S),ve=new r8(ne,k,he);return ce(this).replacePlaybackController(ve),{audioContext:k,destinationNode:G,decodedBuffer:ne,gainNode:he}}get pointer(){return ce(this).pointer}getMarkerPosition(S){return ce(this).getMarkerPosition(S)}goToAndPlay(S,k){const G=ce(this);if(G._project.isReady()){const ne=k!=null&&k.rafDriver?ce(k.rafDriver).ticker:S7();return G.goToAndPlay(S,k??{},ne)}else{const ne=hf();return ne.resolve(!0),ne.promise}}goToAndStop(S){return ce(this).goToAndStop(S)}listen(S,k){return ce(this).listen(S,k)}unlisten(S,k){return ce(this).unlisten(S,k)}addSubSequence(S,k,G){return ce(this).addSubSequence(S,k,G)}removeSubSequence(S){return ce(this).removeSubSequence(S)}updateSubSequence(S,k){return ce(this).updateSubSequence(S,k)}};async function JN(S){function k(){if(S.audioContext)return Promise.resolve(S.audioContext);const Lt=new AudioContext;return Lt.state==="running"||typeof window>"u"?Promise.resolve(Lt):new Promise(an=>{const dn=()=>{Lt.resume().catch(sr=>{console.error(sr)})},In=["mousedown","keydown","touchstart"],dr={capture:!0,passive:!1};In.forEach(sr=>{window.addEventListener(sr,dn,dr)}),Lt.addEventListener("statechange",()=>{Lt.state==="running"&&(In.forEach(sr=>{window.removeEventListener(sr,dn,dr)}),an(Lt))})})}async function G(){if(S.source instanceof AudioBuffer)return S.source;const Lt=hf();if(typeof S.source!="string")throw new Error("Error validating arguments to sequence.attachAudio(). args.source must either be a string or an instance of AudioBuffer.");let an;try{an=await fetch(S.source)}catch(sr){throw console.error(sr),new Error("Could not fetch '".concat(S.source,"'. Network error logged above."))}let dn;try{dn=await an.arrayBuffer()}catch(sr){throw console.error(sr),new Error("Could not read '".concat(S.source,"' as an arrayBuffer."))}(await ne).decodeAudioData(dn,Lt.resolve,Lt.reject);let dr;try{dr=await Lt.promise}catch(sr){throw console.error(sr),new Error("Could not decode ".concat(S.source," as an audio file."))}return dr}const ne=k(),he=G(),[ve,je]=await Promise.all([ne,he]),ct=S.destinationNode||ve.destination,xt=ve.createGain();return xt.connect(ct),{audioContext:ve,decodedBuffer:je,gainNode:xt,destinationNode:ct}}var eP=dU("Theatre_SheetObject");function dU(S){return k=>typeof k=="object"&&!!k&&k.type===S}var hU=class{constructor(S,k,G,ne,he){this._project=S,this._sheet=k,this._lengthD=G,this._subUnitsPerUnitD=ne,C(this,"address"),C(this,"publicApi"),C(this,"_playbackControllerBox"),C(this,"_prismOfStatePointer"),C(this,"_positionD"),C(this,"_positionFormatterD"),C(this,"_playableRangeD"),C(this,"_eventListeners",new Map),C(this,"_lastProcessedPosition",-1),C(this,"_processedEvents",new Set),C(this,"pointer",(0,v7.pointer)({root:this,path:[]})),C(this,"$$isPointerToPrismProvider",!0),C(this,"_logger"),C(this,"closestGridPosition",ve=>{const ct=1/this.subUnitsPerUnit;return parseFloat((Math.round(ve/ct)*ct).toFixed(3))}),this._logger=S._logger.named("Sheet",k.address.sheetId).named("Instance",k.address.sheetInstanceId),this.address=A(w({},this._sheet.address),{sequenceName:"default"}),this.publicApi=new QN(this),this._playbackControllerBox=new aT.Atom(he??new XN),this._prismOfStatePointer=(0,ko.prism)(()=>this._playbackControllerBox.prism.getValue().statePointer),this._positionD=(0,ko.prism)(()=>{const ve=this._prismOfStatePointer.getValue();return(0,ko.val)(ve.position)}),this._positionFormatterD=(0,ko.prism)(()=>{const ve=(0,ko.val)(this._subUnitsPerUnitD);return new cT(ve)}),this._positionD.onStale(()=>{const ve=this._positionD.getValue();this._processEventsForPositionChange(this._lastProcessedPosition,ve),this._processSubSequencesForPositionChange(this._lastProcessedPosition,ve),this._lastProcessedPosition=ve})}get type(){return"Theatre_Sequence"}listen(S,k){this._eventListeners.has(S)||this._eventListeners.set(S,new Set),this._eventListeners.get(S).add(k)}unlisten(S,k){const G=this._eventListeners.get(S);G&&(G.delete(k),G.size===0&&this._eventListeners.delete(S))}_processEventsForPositionChange(S,k){const G=this._getEvents();if(!G||G.length===0)return;const ne=this.length;if(S>k&&S>ne*.8&&k<ne*.2){this._processedEvents.clear();return}const ve=Math.min(S,k),je=Math.max(S,k);Math.abs(k-S)>.1&&this._processedEvents.clear();for(const ct of G)if(ct.position>ve&&ct.position<=je){const xt="".concat(ct.id,"-").concat(ct.position);if(this._processedEvents.has(xt))continue;if(ct.name==="goTo"||this._processedEvents.add(xt),this._triggerEvent(ct),ct.name==="stop"){requestAnimationFrame(()=>{this.pause(),this._playbackControllerBox.get().gotoPosition(ct.position)});return}else if(ct.name==="goTo"&&ct.value!==void 0){requestAnimationFrame(()=>{if(this._processedEvents.clear(),typeof ct.value=="string"){const an=this.getMarkerPosition(ct.value);an!==void 0&&this._gotoPositionWithoutPausing(an)}else typeof ct.value=="number"&&this._gotoPositionWithoutPausing(ct.value)});return}}}_triggerEvent(S){const k=this._eventListeners.get(S.name);k&&k.forEach(G=>{try{G(S)}catch(ne){console.error("Error in sequence event listener:",ne)}})}_processSubSequencesForPositionChange(S,k){var G,ne;const he=this._getSubSequences();if(!(!he||he.length===0))for(const ve of he){const je=ve.position,ct=(G=ve.duration)!=null?G:this._getSubSequenceDuration(ve.sheetId),xt=(ne=ve.timeScale)!=null?ne:1,Lt=je+ct/xt;if(k>=je&&k<=Lt){const dn=(k-je)*xt;try{const dr=this._project.getOrCreateSheet(ve.sheetId,"default").getSequence();dr&&"_gotoPositionWithoutPausing"in dr&&dr._gotoPositionWithoutPausing(dn)}catch{this._logger._error("Sub-sequence references non-existent sheet: ".concat(ve.sheetId))}}}}_getSubSequenceDuration(S){var k;try{const ne=this._project.getOrCreateSheet(S,"default").getSequence();return(k=ne==null?void 0:ne.length)!=null?k:0}catch{return 0}}_getEvents(){const S=this._project.pointers.historic.sheetsById[this._sheet.address.sheetId],k=(0,ko.val)(S.sequence);return(k==null?void 0:k.events)||[]}_getSubSequences(){const S=this._project.pointers.historic.sheetsById[this._sheet.address.sheetId],k=(0,ko.val)(S.sequence);return(k==null?void 0:k.subSequences)||[]}pointerToPrism(S){const{path:k}=(0,oT.getPointerParts)(S);if(k.length===0)return(0,ko.prism)(()=>({length:(0,ko.val)(this.pointer.length),playing:(0,ko.val)(this.pointer.playing),position:(0,ko.val)(this.pointer.position),subUnitsPerUnit:(0,ko.val)(this.pointer.subUnitsPerUnit)}));if(k.length>1)return(0,ko.prism)(()=>{});const[G]=k;return G==="length"?this._lengthD:G==="subUnitsPerUnit"?this._subUnitsPerUnitD:G==="position"?this._positionD:G==="playing"?(0,ko.prism)(()=>(0,ko.val)(this._prismOfStatePointer.getValue().playing)):(0,ko.prism)(()=>{})}getKeyframesOfSimpleProp(S){const{path:k,root:G}=(0,oT.getPointerParts)(S);if(!eP(G))throw new M4("Argument prop must be a pointer to a SheetObject property");const ne=(0,ko.val)(this._project.pointers.historic.sheetsById[this._sheet.address.sheetId].sequence.tracksByObject[G.address.objectKey]);if(!ne)return[];const{trackData:he,trackIdByPropPath:ve}=ne,je=$N(k),ct=ve[je];if(!ct)return[];const xt=he[ct];return xt?xt.keyframes:[]}get positionFormatter(){return this._positionFormatterD.getValue()}get prismOfStatePointer(){return this._prismOfStatePointer}get length(){return this._lengthD.getValue()}get positionPrism(){return this._positionD}get position(){return this._playbackControllerBox.get().getCurrentPosition()}get subUnitsPerUnit(){return this._subUnitsPerUnitD.getValue()}get positionSnappedToGrid(){return this.closestGridPosition(this.position)}set position(S){let k=S;this.pause(),k>this.length&&(k=this.length);const G=this.length;this._playbackControllerBox.get().gotoPosition(k>G?G:k)}_gotoPositionWithoutPausing(S){let k=S;k>this.length&&(k=this.length);const G=this.length;this._playbackControllerBox.get().gotoPosition(k>G?G:k)}getDurationCold(){return this._lengthD.getValue()}get playing(){return(0,ko.val)(this._playbackControllerBox.get().statePointer.playing)}_makeRangeFromSequenceTemplate(){return(0,ko.prism)(()=>[0,(0,ko.val)(this._lengthD)])}playDynamicRange(S,k){return this._playbackControllerBox.get().playDynamicRange(S,k)}async play(S,k){const G=this.length,ne=S&&S.range?S.range:[0,G],he=S&&typeof S.iterationCount=="number"?S.iterationCount:1,ve=S&&typeof S.rate<"u"?S.rate:1,je=S&&S.direction?S.direction:"normal";return await this._play(he,[ne[0],ne[1]],ve,je,k)}_play(S,k,G,ne,he){return this._playbackControllerBox.get().play(S,k,G,ne,he)}pause(){this._playbackControllerBox.get().pause()}replacePlaybackController(S){this.pause();const k=this._playbackControllerBox.get();this._playbackControllerBox.set(S);const G=k.getCurrentPosition();k.destroy(),S.gotoPosition(G)}getMarkerPosition(S){const k=this._project.pointers.historic.sheetsById[this._sheet.address.sheetId],G=(0,ko.val)(k.sequence.markers);if(!G)return;let ne=G.find(he=>he.label===S);return ne||(ne=G.find(he=>{var ve;return((ve=he.label)==null?void 0:ve.toLowerCase())===S.toLowerCase()})),ne||(ne=G.find(he=>{var ve;return(ve=he.label)==null?void 0:ve.includes(S)})),ne==null?void 0:ne.position}async goToAndPlay(S,k,G){const ne=this.getMarkerPosition(S);if(ne===void 0)throw new Error('Marker "'.concat(S,'" not found in sequence "').concat(this._sheet.address.sheetId,'"'));return this.position=ne,this.play(k,G)}goToAndStop(S){const k=this.getMarkerPosition(S);if(k===void 0)throw new Error('Marker "'.concat(S,'" not found in sequence "').concat(this._sheet.address.sheetId,'"'));this.position=k}addSubSequence(S,k,G){throw new Error("addSubSequence() can only be called when Theatre.js Studio is loaded.")}removeSubSequence(S){throw new Error("removeSubSequence() can only be called when Theatre.js Studio is loaded.")}updateSubSequence(S,k){throw new Error("updateSubSequence() can only be called when Theatre.js Studio is loaded.")}},cT=class{constructor(S){this._fps=S}formatSubUnitForGrid(S){const k=S%1,G=1/this._fps;return Math.round(k/G)+"f"}formatFullUnitForGrid(S){let k=S,G="";if(k>=V2){const he=Math.floor(k/V2);G+=he+"h",k=k%V2}if(k>=z2){const he=Math.floor(k/z2);G+=he+"m",k=k%z2}if(k>=b1){const he=Math.floor(k/b1);G+=he+"s",k=k%b1}const ne=1/this._fps;if(k>=ne){const he=Math.floor(k/ne);G+=he+"f",k=k%ne}return G.length===0?"0s":G}formatForPlayhead(S){let k=S,G="";if(k>=V2){const he=Math.floor(k/V2);G+=e8(he.toString(),2,"0")+"h",k=k%V2}if(k>=z2){const he=Math.floor(k/z2);G+=e8(he.toString(),2,"0")+"m",k=k%z2}else G.length>0&&(G+="00m");if(k>=b1){const he=Math.floor(k/b1);G+=e8(he.toString(),2,"0")+"s",k=k%b1}else G+="00s";const ne=1/this._fps;if(k>=ne){const he=Math.round(k/ne);G+=e8(he.toString(),2,"0")+"f",k=k%ne}else k/ne>.98?(G+=e8("1",2,"0")+"f",k=k%ne):G+="00f";return G.length===0?"00s00f":G}formatBasic(S){return S.toFixed(2)+"s"}},b1=1,z2=b1*60,V2=z2*60,uT={};D(uT,{boolean:()=>dP,compound:()=>fT,file:()=>vU,image:()=>oP,number:()=>lP,rgba:()=>_U,string:()=>pP,stringLiteral:()=>o8});function tP(S,k){return S.length<=k?S:S.substr(0,k-3)+"..."}var dT=S=>typeof S=="string"?'string("'.concat(tP(S,10),'")'):typeof S=="number"?"number(".concat(tP(String(S),10),")"):S===null?"null":S===void 0?"undefined":typeof S=="boolean"?String(S):Array.isArray(S)?"array":typeof S=="object"?"object":"unknown",hT=dT;function pU(S,{removeAlphaIfOpaque:k=!1}={}){const G=(S.a*255|256).toString(16).slice(1),ne=(S.r*255|256).toString(16).slice(1)+(S.g*255|256).toString(16).slice(1)+(S.b*255|256).toString(16).slice(1)+(k&&G==="ff"?"":G);return"#".concat(ne)}function w7(S){return A(w({},S),{toString(){return pU(this,{removeAlphaIfOpaque:!0})}})}function fU(S){return Object.fromEntries(Object.entries(S).map(([k,G])=>[k,jh(G,0,1)]))}function mU(S){function k(G){return G>=.0031308?1.055*G**(1/2.4)-.055:12.92*G}return fU({r:k(S.r),g:k(S.g),b:k(S.b),a:S.a})}function pT(S){function k(G){return G>=.04045?((G+.055)/(1+.055))**2.4:G/12.92}return{r:k(S.r),g:k(S.g),b:k(S.b),a:S.a}}function nP(S){let k=.4122214708*S.r+.5363325363*S.g+.0514459929*S.b,G=.2119034982*S.r+.6806995451*S.g+.1073969566*S.b,ne=.0883024619*S.r+.2817188376*S.g+.6299787005*S.b,he=Math.cbrt(k),ve=Math.cbrt(G),je=Math.cbrt(ne);return{L:.2104542553*he+.793617785*ve-.0040720468*je,a:1.9779984951*he-2.428592205*ve+.4505937099*je,b:.0259040371*he+.7827717662*ve-.808675766*je,alpha:S.a}}function gU(S){let k=S.L+.3963377774*S.a+.2158037573*S.b,G=S.L-.1055613458*S.a-.0638541728*S.b,ne=S.L-.0894841775*S.a-1.291485548*S.b,he=k*k*k,ve=G*G*G,je=ne*ne*ne;return{r:4.0767416621*he-3.3077115913*ve+.2309699292*je,g:-1.2684380046*he+2.6097574011*ve-.3413193965*je,b:-.0041960863*he-.7034186147*ve+1.707614701*je,a:S.alpha}}var Kh=Symbol("TheatrePropType_Basic");function rP(S){return typeof S=="object"&&!!S&&S[Kh]==="TheatrePropType"}function yU(S){if(typeof S=="number")return lP(S);if(typeof S=="boolean")return dP(S);if(typeof S=="string")return pP(S);if(typeof S=="object"&&S){if(rP(S))return S;if(Bs(S))return fT(S);throw new M4("This value is not a valid prop type: ".concat(hT(S)))}else throw new M4("This value is not a valid prop type: ".concat(hT(S)))}function iP(S){const k={};for(const G of Object.keys(S)){const ne=S[G];rP(ne)?k[G]=ne:k[G]=yU(ne)}return k}var fT=(S,k={})=>{const G=iP(S),ne=new WeakMap;return{type:"compound",props:G,valueType:null,[Kh]:"TheatrePropType",label:k.label,default:Dr(G,ve=>ve.default),deserializeAndSanitize:ve=>{if(typeof ve!="object"||!ve)return;if(ne.has(ve))return ne.get(ve);const je={};let ct=!1;for(const[xt,Lt]of Object.entries(G))if(Object.prototype.hasOwnProperty.call(ve,xt)){const an=Lt.deserializeAndSanitize(ve[xt]);an!=null&&(ct=!0,je[xt]=an)}if(ne.set(ve,je),ct)return je}}},vU=(S,k={})=>{const G=(ne,he,ve)=>{var je;return{type:"file",id:((je=k.interpolate)!=null?je:s8)(ne.id,he.id,ve)}};return{type:"file",default:{type:"file",id:S},valueType:null,[Kh]:"TheatrePropType",label:k.label,interpolate:G,deserializeAndSanitize:sP}},sP=S=>{if(!S)return;let k=!0;if(typeof S.id!="string"&&![null,void 0].includes(S.id)&&(k=!1),S.type!=="file"&&(k=!1),!!k)return S},oP=(S,k={})=>{const G=(ne,he,ve)=>{var je;return{type:"image",id:((je=k.interpolate)!=null?je:s8)(ne.id,he.id,ve)}};return{type:"image",default:{type:"image",id:S},valueType:null,[Kh]:"TheatrePropType",label:k.label,interpolate:G,deserializeAndSanitize:aP}},aP=S=>{if(!S)return;let k=!0;if(typeof S.id!="string"&&![null,void 0].includes(S.id)&&(k=!1),S.type!=="image"&&(k=!1),!!k)return S},lP=(S,k={})=>{var G;return A(w({type:"number",valueType:0,default:S,[Kh]:"TheatrePropType"},k||{}),{label:k.label,nudgeFn:(G=k.nudgeFn)!=null?G:wU,nudgeMultiplier:typeof k.nudgeMultiplier=="number"?k.nudgeMultiplier:void 0,interpolate:bU,deserializeAndSanitize:xU(k.range)})},xU=S=>S?k=>{if(typeof k=="number"&&isFinite(k))return jh(k,S[0],S[1])}:cP,cP=S=>typeof S=="number"&&isFinite(S)?S:void 0,bU=(S,k,G)=>S+G*(k-S),_U=(S={r:0,g:0,b:0,a:1},k={})=>{const G={};for(const ne of["r","g","b","a"])G[ne]=Math.min(Math.max(S[ne],0),1);return{type:"rgba",valueType:null,default:w7(G),[Kh]:"TheatrePropType",label:k.label,interpolate:SU,deserializeAndSanitize:uP}},uP=S=>{if(!S)return;let k=!0;for(const ne of["r","g","b","a"])(!Object.prototype.hasOwnProperty.call(S,ne)||typeof S[ne]!="number")&&(k=!1);if(!k)return;const G={};for(const ne of["r","g","b","a"])G[ne]=Math.min(Math.max(S[ne],0),1);return w7(G)},SU=(S,k,G)=>{const ne=nP(pT(S)),he=nP(pT(k)),ve={L:(1-G)*ne.L+G*he.L,a:(1-G)*ne.a+G*he.a,b:(1-G)*ne.b+G*he.b,alpha:(1-G)*ne.alpha+G*he.alpha},je=mU(gU(ve));return w7(je)},dP=(S,k={})=>{var G;return{type:"boolean",default:S,valueType:null,[Kh]:"TheatrePropType",label:k.label,interpolate:(G=k.interpolate)!=null?G:s8,deserializeAndSanitize:hP}},hP=S=>typeof S=="boolean"?S:void 0;function s8(S){return S}var pP=(S,k={})=>{var G;return{type:"string",default:S,valueType:null,[Kh]:"TheatrePropType",label:k.label,interpolate:(G=k.interpolate)!=null?G:s8,deserializeAndSanitize:A4}};function A4(S){return typeof S=="string"?S:void 0}function o8(S,k,G={}){var ne,he;return{type:"stringLiteral",default:S,valuesAndLabels:w({},k),[Kh]:"TheatrePropType",valueType:null,as:(ne=G.as)!=null?ne:"menu",label:G.label,interpolate:(he=G.interpolate)!=null?he:s8,deserializeAndSanitize(ve){if(typeof ve=="string"&&Object.prototype.hasOwnProperty.call(k,ve))return ve}}}var wU=({config:S,deltaX:k,deltaFraction:G,magnitude:ne})=>{var he;const{range:ve}=S;return!S.nudgeMultiplier&&ve&&!ve.includes(1/0)&&!ve.includes(-1/0)?G*(ve[1]-ve[0])*ne:k*ne*((he=S.nudgeMultiplier)!=null?he:1)},fP=S=>S.replace(/^[\s\/]*/,"").replace(/[\s\/]*$/,"").replace(/\s*\/\s*/g," / ");function T7(S,k){return fP(S)}U(z());var TU=class{get type(){return"Theatre_Sheet_PublicAPI"}constructor(S){Ve(this,S)}object(S,k,G){const ne=ce(this),he=T7(S),ve=ne.getObject(he),je=null,ct=G==null?void 0:G.__actions__THIS_API_IS_UNSTABLE_AND_WILL_CHANGE_IN_THE_NEXT_VERSION;if(ve)return ct&&ve.template._temp_setActions(ct),ve.publicApi;{const xt=fT(k);return ne.createObject(he,je,xt,ct).publicApi}}__experimental_getExistingObject(S){const k=ce(this),G=T7(S),ne=k.getObject(G);return ne==null?void 0:ne.publicApi}get sequence(){return ce(this).getSequence().publicApi}get project(){return ce(this).project.publicApi}get address(){return w({},ce(this).address)}detachObject(S){const k=ce(this),G=T7(S);if(!k.getObject(G)){x1.warning(`Couldn't delete object "`.concat(G,'"'),'There is no object with key "'.concat(G,`".

To fix this, make sure you are calling \`sheet.deleteObject("`).concat(G,'")` with the correct key.')),console.warn('Object key "'.concat(G,'" does not exist.'));return}k.deleteObject(G)}},N4=un(),EU=class{constructor(S,k){this.template=S,this.instanceId=k,C(this,"_objects",new N4.Atom({})),C(this,"_sequence"),C(this,"address"),C(this,"publicApi"),C(this,"project"),C(this,"objectsP",this._objects.pointer),C(this,"type","Theatre_Sheet"),C(this,"_logger"),this._logger=S.project._logger.named("Sheet",k),this._logger._trace("creating sheet"),this.project=S.project,this.address=A(w({},S.address),{sheetInstanceId:this.instanceId}),this.publicApi=new TU(this)}createObject(S,k,G,ne={}){const ve=this.template.getObjectTemplate(S,k,G,ne).createInstance(this,k,G);return this._objects.setByPointer(je=>je[S],ve),ve}getObject(S){return this._objects.get()[S]}deleteObject(S){this._objects.reduce(k=>{const G=w({},k);return delete G[S],G})}getSequence(){if(!this._sequence){const S=(0,N4.prism)(()=>{const G=(0,N4.val)(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.length);return mP(G)}),k=(0,N4.prism)(()=>{const G=(0,N4.val)(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.subUnitsPerUnit);return gP(G)});this._sequence=new hU(this.template.project,this,S,k)}return this._sequence}},mP=S=>typeof S=="number"&&isFinite(S)&&S>0?S:10,gP=S=>typeof S=="number"&&vr(S)&&S>=1&&S<=1e3?S:30,MU=class{constructor(S,k){this.project=S,C(this,"type","Theatre_SheetTemplate"),C(this,"address"),C(this,"_instances",new sT.Atom({})),C(this,"instancesP",this._instances.pointer),C(this,"_objectTemplates",new sT.Atom({})),C(this,"objectTemplatesP",this._objectTemplates.pointer),this.address=A(w({},S.address),{sheetId:k})}getInstance(S){let k=this._instances.get()[S];return k||(k=new EU(this,S),this._instances.setByPointer(G=>G[S],k)),k}getObjectTemplate(S,k,G,ne){let he=this._objectTemplates.get()[S];return he||(he=new jN(this,S,k,G,ne),this._objectTemplates.setByPointer(ve=>ve[S],he)),he}},mT=un(),E7=un(),yP=S=>new Promise(k=>setTimeout(k,S)),CU=yP;function Jc(S){for(var k=arguments.length,G=Array(k>1?k-1:0),ne=1;ne<k;ne++)G[ne-1]=arguments[ne];throw Error("[Immer] minified error nr: "+S+(G.length?" "+G.map(function(he){return"'"+he+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function G2(S){return!!S&&!!S[ec]}function _1(S){return!!S&&(function(k){if(!k||typeof k!="object")return!1;var G=Object.getPrototypeOf(k);if(G===null)return!0;var ne=Object.hasOwnProperty.call(G,"constructor")&&G.constructor;return ne===Object||typeof ne=="function"&&Function.toString.call(ne)===TT}(S)||Array.isArray(S)||!!S[AP]||!!S.constructor[AP]||yT(S)||C7(S))}function gT(S){return G2(S)||Jc(23,S),S[ec].t}function P4(S,k,G){G===void 0&&(G=!1),R4(S)===0?(G?Object.keys:ET)(S).forEach(function(ne){G&&typeof ne=="symbol"||k(ne,S[ne],S)}):S.forEach(function(ne,he){return k(he,ne,S)})}function R4(S){var k=S[ec];return k?k.i>3?k.i-4:k.i:Array.isArray(S)?1:yT(S)?2:C7(S)?3:0}function M7(S,k){return R4(S)===2?S.has(k):Object.prototype.hasOwnProperty.call(S,k)}function AU(S,k){return R4(S)===2?S.get(k):S[k]}function vP(S,k,G){var ne=R4(S);ne===2?S.set(k,G):ne===3?(S.delete(k),S.add(G)):S[k]=G}function xP(S,k){return S===k?S!==0||1/S==1/k:S!=S&&k!=k}function yT(S){return PU&&S instanceof Map}function C7(S){return CP&&S instanceof Set}function Zh(S){return S.o||S.t}function vT(S){if(Array.isArray(S))return Array.prototype.slice.call(S);var k=RU(S);delete k[ec];for(var G=ET(k),ne=0;ne<G.length;ne++){var he=G[ne],ve=k[he];ve.writable===!1&&(ve.writable=!0,ve.configurable=!0),(ve.get||ve.set)&&(k[he]={configurable:!0,writable:!0,enumerable:ve.enumerable,value:S[he]})}return Object.create(Object.getPrototypeOf(S),k)}function xT(S,k){return k===void 0&&(k=!1),A7(S)||G2(S)||!_1(S)||(R4(S)>1&&(S.set=S.add=S.clear=S.delete=bP),Object.freeze(S),k&&P4(S,function(G,ne){return xT(ne,!0)},!0)),S}function bP(){Jc(2)}function A7(S){return S==null||typeof S!="object"||Object.isFrozen(S)}function Qh(S){var k=MT[S];return k||Jc(18,S),k}function N7(){return k4}function P7(S,k){k&&(Qh("Patches"),S.u=[],S.s=[],S.v=k)}function R7(S){I7(S),S.p.forEach(NU),S.p=null}function I7(S){S===k4&&(k4=S.l)}function _P(S){return k4={p:[],l:k4,h:S,m:!0,_:0}}function NU(S){var k=S[ec];k.i===0||k.i===1?k.j():k.O=!0}function j2(S,k){k._=k.p.length;var G=k.p[0],ne=S!==void 0&&S!==G;return k.h.g||Qh("ES5").S(k,S,ne),ne?(G[ec].P&&(R7(k),Jc(4)),_1(S)&&(S=I4(k,S),k.l||a8(k,S)),k.u&&Qh("Patches").M(G[ec],S,k.u,k.s)):S=I4(k,G,[]),R7(k),k.u&&k.v(k.u,k.s),S!==wT?S:void 0}function I4(S,k,G){if(A7(k))return k;var ne=k[ec];if(!ne)return P4(k,function(ve,je){return SP(S,ne,k,ve,je,G)},!0),k;if(ne.A!==S)return k;if(!ne.P)return a8(S,ne.t,!0),ne.t;if(!ne.I){ne.I=!0,ne.A._--;var he=ne.i===4||ne.i===5?ne.o=vT(ne.k):ne.o;P4(ne.i===3?new Set(he):he,function(ve,je){return SP(S,ne,he,ve,je,G)}),a8(S,he,!1),G&&S.u&&Qh("Patches").R(ne,G,S.u,S.s)}return ne.o}function SP(S,k,G,ne,he,ve){if(G2(he)){var je=I4(S,he,ve&&k&&k.i!==3&&!M7(k.D,ne)?ve.concat(ne):void 0);if(vP(G,ne,je),!G2(je))return;S.m=!1}if(_1(he)&&!A7(he)){if(!S.h.F&&S._<1)return;I4(S,he),k&&k.A.l||a8(S,he)}}function a8(S,k,G){G===void 0&&(G=!1),S.h.F&&S.m&&xT(k,G)}function l8(S,k){var G=S[ec];return(G?Zh(G):S)[k]}function wP(S,k){if(k in S)for(var G=Object.getPrototypeOf(S);G;){var ne=Object.getOwnPropertyDescriptor(G,k);if(ne)return ne;G=Object.getPrototypeOf(G)}}function bT(S){S.P||(S.P=!0,S.l&&bT(S.l))}function k7(S){S.o||(S.o=vT(S.t))}function D7(S,k,G){var ne=yT(k)?Qh("MapSet").N(k,G):C7(k)?Qh("MapSet").T(k,G):S.g?function(he,ve){var je=Array.isArray(he),ct={i:je?1:0,A:ve?ve.A:N7(),P:!1,I:!1,D:{},l:ve,t:he,k:null,o:null,j:null,C:!1},xt=ct,Lt=c8;je&&(xt=[ct],Lt=u8);var an=Proxy.revocable(xt,Lt),dn=an.revoke,In=an.proxy;return ct.k=In,ct.j=dn,In}(k,G):Qh("ES5").J(k,G);return(G?G.A:N7()).p.push(ne),ne}function TP(S){return G2(S)||Jc(22,S),function k(G){if(!_1(G))return G;var ne,he=G[ec],ve=R4(G);if(he){if(!he.P&&(he.i<4||!Qh("ES5").K(he)))return he.t;he.I=!0,ne=EP(G,ve),he.I=!1}else ne=EP(G,ve);return P4(ne,function(je,ct){he&&AU(he.t,je)===ct||vP(ne,je,k(ct))}),ve===3?new Set(ne):ne}(S)}function EP(S,k){switch(k){case 2:return new Map(S);case 3:return Array.from(S)}return vT(S)}var MP,k4,_T=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",PU=typeof Map<"u",CP=typeof Set<"u",ST=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",wT=_T?Symbol.for("immer-nothing"):((MP={})["immer-nothing"]=!0,MP),AP=_T?Symbol.for("immer-draftable"):"__$immer_draftable",ec=_T?Symbol.for("immer-state"):"__$immer_state",TT=""+Object.prototype.constructor,ET=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(S){return Object.getOwnPropertyNames(S).concat(Object.getOwnPropertySymbols(S))}:Object.getOwnPropertyNames,RU=Object.getOwnPropertyDescriptors||function(S){var k={};return ET(S).forEach(function(G){k[G]=Object.getOwnPropertyDescriptor(S,G)}),k},MT={},c8={get:function(S,k){if(k===ec)return S;var G=Zh(S);if(!M7(G,k))return function(he,ve,je){var ct,xt=wP(ve,je);return xt?"value"in xt?xt.value:(ct=xt.get)===null||ct===void 0?void 0:ct.call(he.k):void 0}(S,G,k);var ne=G[k];return S.I||!_1(ne)?ne:ne===l8(S.t,k)?(k7(S),S.o[k]=D7(S.A.h,ne,S)):ne},has:function(S,k){return k in Zh(S)},ownKeys:function(S){return Reflect.ownKeys(Zh(S))},set:function(S,k,G){var ne=wP(Zh(S),k);if(ne!=null&&ne.set)return ne.set.call(S.k,G),!0;if(!S.P){var he=l8(Zh(S),k),ve=he==null?void 0:he[ec];if(ve&&ve.t===G)return S.o[k]=G,S.D[k]=!1,!0;if(xP(G,he)&&(G!==void 0||M7(S.t,k)))return!0;k7(S),bT(S)}return S.o[k]===G&&typeof G!="number"&&(G!==void 0||k in S.o)||(S.o[k]=G,S.D[k]=!0,!0)},deleteProperty:function(S,k){return l8(S.t,k)!==void 0||k in S.t?(S.D[k]=!1,k7(S),bT(S)):delete S.D[k],S.o&&delete S.o[k],!0},getOwnPropertyDescriptor:function(S,k){var G=Zh(S),ne=Reflect.getOwnPropertyDescriptor(G,k);return ne&&{writable:!0,configurable:S.i!==1||k!=="length",enumerable:ne.enumerable,value:G[k]}},defineProperty:function(){Jc(11)},getPrototypeOf:function(S){return Object.getPrototypeOf(S.t)},setPrototypeOf:function(){Jc(12)}},u8={};P4(c8,function(S,k){u8[S]=function(){return arguments[0]=arguments[0][0],k.apply(this,arguments)}}),u8.deleteProperty=function(S,k){return c8.deleteProperty.call(this,S[0],k)},u8.set=function(S,k,G){return c8.set.call(this,S[0],k,G,S[0])};var S1=function(){function S(G){var ne=this;this.g=ST,this.F=!0,this.produce=function(he,ve,je){if(typeof he=="function"&&typeof ve!="function"){var ct=ve;ve=he;var xt=ne;return function(dr){var sr=this;dr===void 0&&(dr=ct);for(var ii=arguments.length,fi=Array(ii>1?ii-1:0),Jr=1;Jr<ii;Jr++)fi[Jr-1]=arguments[Jr];return xt.produce(dr,function($i){var ka;return(ka=ve).call.apply(ka,[sr,$i].concat(fi))})}}var Lt;if(typeof ve!="function"&&Jc(6),je!==void 0&&typeof je!="function"&&Jc(7),_1(he)){var an=_P(ne),dn=D7(ne,he,void 0),In=!0;try{Lt=ve(dn),In=!1}finally{In?R7(an):I7(an)}return typeof Promise<"u"&&Lt instanceof Promise?Lt.then(function(dr){return P7(an,je),j2(dr,an)},function(dr){throw R7(an),dr}):(P7(an,je),j2(Lt,an))}if(!he||typeof he!="object")return(Lt=ve(he))===wT?void 0:(Lt===void 0&&(Lt=he),ne.F&&xT(Lt,!0),Lt);Jc(21,he)},this.produceWithPatches=function(he,ve){return typeof he=="function"?function(xt){for(var Lt=arguments.length,an=Array(Lt>1?Lt-1:0),dn=1;dn<Lt;dn++)an[dn-1]=arguments[dn];return ne.produceWithPatches(xt,function(In){return he.apply(void 0,[In].concat(an))})}:[ne.produce(he,ve,function(xt,Lt){je=xt,ct=Lt}),je,ct];var je,ct},typeof(G==null?void 0:G.useProxies)=="boolean"&&this.setUseProxies(G.useProxies),typeof(G==null?void 0:G.autoFreeze)=="boolean"&&this.setAutoFreeze(G.autoFreeze)}var k=S.prototype;return k.createDraft=function(G){_1(G)||Jc(8),G2(G)&&(G=TP(G));var ne=_P(this),he=D7(this,G,void 0);return he[ec].C=!0,I7(ne),he},k.finishDraft=function(G,ne){var he=G&&G[ec],ve=he.A;return P7(ve,ne),j2(void 0,ve)},k.setAutoFreeze=function(G){this.F=G},k.setUseProxies=function(G){G&&!ST&&Jc(20),this.g=G},k.applyPatches=function(G,ne){var he;for(he=ne.length-1;he>=0;he--){var ve=ne[he];if(ve.path.length===0&&ve.op==="replace"){G=ve.value;break}}var je=Qh("Patches").$;return G2(G)?je(G,ne):this.produce(G,function(ct){return je(ct,ne.slice(he+1))})},S}(),eu=new S1;eu.produce,eu.produceWithPatches.bind(eu),eu.setAutoFreeze.bind(eu),eu.setUseProxies.bind(eu),eu.applyPatches.bind(eu),eu.createDraft.bind(eu),eu.finishDraft.bind(eu);var IU={currentProjectStateDefinitionVersion:"0.4.0"},pf=IU;async function NP(S,k,G){if(await CU(0),S.transaction(({drafts:ne})=>{var he;const ve=k.address.projectId;ne.ephemeral.coreByProject[ve]={lastExportedObject:null,loadingState:{type:"loading"}},ne.ahistoric.coreByProject[ve]={ahistoricStuff:""};function je(){ne.ephemeral.coreByProject[ve].loadingState={type:"loaded"},ne.historic.coreByProject[ve]={sheetsById:{},definitionVersion:pf.currentProjectStateDefinitionVersion,revisionHistory:[]}}function ct(dn){ne.ephemeral.coreByProject[ve].loadingState={type:"loaded"},ne.historic.coreByProject[ve]=dn}function xt(){ne.ephemeral.coreByProject[ve].loadingState={type:"loaded"}}function Lt(dn){ne.ephemeral.coreByProject[ve].loadingState={type:"browserStateIsNotBasedOnDiskState",onDiskState:dn}}const an=(he=gT(ne.historic))==null?void 0:he.coreByProject[k.address.projectId];an?G&&an.revisionHistory.indexOf(G.revisionHistory[0])==-1?Lt(G):xt():G?ct(G):je()}),G!=null&&G.sheetsById){const ne=k.address.projectId;S.transaction(({stateEditors:he})=>{var ve,je,ct,xt,Lt,an,dn,In,dr,sr,ii,fi,Jr,$i,ka,Do,Zo,as,ga,Vl,tc,qd,Xd,Jh;for(const[$u,Ya]of Object.entries(G.sheetsById)){if((ve=Ya==null?void 0:Ya.sequence)!=null&&ve.markers){const Ps=Ya.sequence.markers;(dn=(an=(Lt=(xt=(ct=(je=he==null?void 0:he.studio)==null?void 0:je.historic)==null?void 0:ct.projects)==null?void 0:xt.stateByProjectId)==null?void 0:Lt.stateBySheetId)==null?void 0:an.sequenceEditor)!=null&&dn.replaceMarkers&&he.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.replaceMarkers({sheetAddress:{projectId:ne,sheetId:$u},markers:Ps,snappingFunction:ya=>ya})}if((In=Ya==null?void 0:Ya.sequence)!=null&&In.events){const Ps=Ya.sequence.events;($i=(Jr=(fi=(ii=(sr=(dr=he==null?void 0:he.studio)==null?void 0:dr.historic)==null?void 0:sr.projects)==null?void 0:ii.stateByProjectId)==null?void 0:fi.stateBySheetId)==null?void 0:Jr.sequenceEditor)!=null&&$i.replaceEvents&&he.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.replaceEvents({sheetAddress:{projectId:ne,sheetId:$u},events:Ps,snappingFunction:ya=>ya})}if((ka=Ya==null?void 0:Ya.sequence)!=null&&ka.subSequences){const Ps=Ya.sequence.subSequences;if((tc=(Vl=(ga=(as=(Zo=(Do=he==null?void 0:he.studio)==null?void 0:Do.historic)==null?void 0:Zo.projects)==null?void 0:as.stateByProjectId)==null?void 0:ga.stateBySheetId)==null?void 0:Vl.sequenceEditor)!=null&&tc.replaceSubSequences){const ya=(Jh=(Xd=(qd=he.studio.historic.projects.stateByProjectId[ne])==null?void 0:qd.stateBySheetId[$u])==null?void 0:Xd.sequenceEditor)==null?void 0:Jh.subSequenceSet,Ts=ya?Ps.filter(lo=>!ya.byId[lo.id]):Ps;Ts.length>0&&he.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.replaceSubSequences({sheetAddress:{projectId:ne,sheetId:$u},subSequences:Ts,snappingFunction:lo=>lo})}}}})}}function PP(){}function CT(S){var k,G;const ne=(k=S==null?void 0:S.logging)!=null&&k.internal?(G=S.logging.min)!=null?G:256:1/0,he=ne<=128,ve=ne<=512,je=eT(void 0,{_debug:he?console.debug.bind(console,"_coreLogger(TheatreInternalLogger) debug"):PP,_error:ve?console.error.bind(console,"_coreLogger(TheatreInternalLogger) error"):PP});if(S){const{logger:ct,logging:xt}=S;ct&&je.configureLogger(ct),xt?je.configureLogging(xt):je.configureLogging({dev:!1})}return je.getLogger().named("Theatre")}var kU=class{constructor(S,k={},G){this.config=k,this.publicApi=G,C(this,"pointers"),C(this,"_pointerProxies"),C(this,"address"),C(this,"_studioReadyDeferred"),C(this,"_assetStorageReadyDeferred"),C(this,"_readyPromise"),C(this,"_sheetTemplates",new E7.Atom({})),C(this,"sheetTemplatesP",this._sheetTemplates.pointer),C(this,"_studio"),C(this,"assetStorage"),C(this,"type","Theatre_Project"),C(this,"_logger");var ne;this._logger=CT({logging:{dev:!0}}).named("Project",S),this._logger.traceDev("creating project"),this.address={projectId:S};const he=new E7.Atom({ahistoric:{ahistoricStuff:""},historic:(ne=k.state)!=null?ne:{sheetsById:{},definitionVersion:pf.currentProjectStateDefinitionVersion,revisionHistory:[]},ephemeral:{loadingState:{type:"loaded"},lastExportedObject:null}});this._assetStorageReadyDeferred=hf(),this.assetStorage={getAssetUrl:ve=>{var je;return"".concat((je=k.assets)==null?void 0:je.baseUrl,"/").concat(ve)},createAsset:()=>{throw new Error("Please wait for Project.ready to use assets.")}},this._pointerProxies={historic:new mT.PointerProxy(he.pointer.historic),ahistoric:new mT.PointerProxy(he.pointer.ahistoric),ephemeral:new mT.PointerProxy(he.pointer.ephemeral)},this.pointers={historic:this._pointerProxies.historic.pointer,ahistoric:this._pointerProxies.ahistoric.pointer,ephemeral:this._pointerProxies.ephemeral.pointer},Ue.add(S,this),this._studioReadyDeferred=hf(),this._readyPromise=Promise.all([this._studioReadyDeferred.promise,this._assetStorageReadyDeferred.promise]).then(()=>{}),k.state?setTimeout(()=>{this._studio||(this._studioReadyDeferred.resolve(void 0),this._assetStorageReadyDeferred.resolve(void 0),this._logger._trace("ready deferred resolved with no state"))},0):typeof window>"u"?console.error('Argument config.state in Theatre.getProject("'.concat(S,'", config) is empty. ')+"You can safely ignore this message if you're developing a Next.js/Remix project in development mode. But if you are shipping to your end-users, then you need to set config.state, otherwise your project's state will be empty and nothing will animate. Learn more at https://www.theatrejs.com/docs/latest/manual/projects#state"):setTimeout(()=>{if(!this._studio)throw new Error('Argument config.state in Theatre.getProject("'.concat(S,'", config) is empty. This is fine ')+"while you are using @tomorrowevening/theatre-core along with @tomorrowevening/theatre-studio. But since @tomorrowevening/theatre-studio "+'is not loaded, the state of project "'.concat(S,`" will be empty.

`)+`To fix this, you need to add @tomorrowevening/theatre-studio into the bundle and export the project's state. Learn how to do that at https://www.theatrejs.com/docs/latest/manual/projects#state
`)},1e3)}attachToStudio(S){if(this._studio){if(this._studio!==S)throw new Error("Project ".concat(this.address.projectId," is already attached to studio ").concat(this._studio.address.studioId));console.warn("Project ".concat(this.address.projectId," is already attached to studio ").concat(this._studio.address.studioId));return}this._studio=S,S.initialized.then(async()=>{var k;await NP(S,this,this.config.state),this._pointerProxies.historic.setPointer(S.atomP.historic.coreByProject[this.address.projectId]),this._pointerProxies.ahistoric.setPointer(S.atomP.ahistoric.coreByProject[this.address.projectId]),this._pointerProxies.ephemeral.setPointer(S.atomP.ephemeral.coreByProject[this.address.projectId]),await S.createAssetStorage(this,(k=this.config.assets)==null?void 0:k.baseUrl).then(G=>{this.assetStorage=G,this._assetStorageReadyDeferred.resolve(void 0)}),this._studioReadyDeferred.resolve(void 0)}).catch(k=>{throw console.error(k),k})}get isAttachedToStudio(){return!!this._studio}get ready(){return this._readyPromise}isReady(){return this._studioReadyDeferred.status==="resolved"&&this._assetStorageReadyDeferred.status==="resolved"}getOrCreateSheet(S,k="default"){let G=this._sheetTemplates.get()[S];return G||(G=new MU(this,S),this._sheetTemplates.reduce(ne=>A(w({},ne),{[S]:G}))),G.getInstance(k)}},DU=class{get type(){return"Theatre_Project_PublicAPI"}constructor(S,k={}){Ve(this,new kU(S,k,this))}get ready(){return ce(this).ready}get isReady(){return ce(this).isReady()}get address(){return w({},ce(this).address)}getAssetUrl(S){if(!this.isReady){console.error("Calling `project.getAssetUrl()` before `project.ready` is resolved, will always return `undefined`. Either use `project.ready.then(() => project.getAssetUrl())` or `await project.ready` before calling `project.getAssetUrl()`.");return}return S.id?ce(this).assetStorage.getAssetUrl(S.id):void 0}sheet(S,k="default"){const G=T7(S);return ce(this).getOrCreateSheet(G,k).publicApi}};U(z());var AT=un(),NT=un();function RP(S,k={}){const G=Ue.get(S);if(G)return G.publicApi;const he=CT().named("Project",S);return k.state?(OU(S,k.state),he._debug("deep validated config.state on disk")):he._debug("no config.state"),new DU(S,k)}var IP=(S,k)=>{if(Array.isArray(k)||k==null||k.definitionVersion!==pf.currentProjectStateDefinitionVersion)throw new M4("Error validating conf.state in Theatre.getProject(".concat(JSON.stringify(S),", conf). The state seems to be formatted in a way that is unreadable to Theatre.js. Read more at https://www.theatrejs.com/docs/latest/manual/projects#state"))},OU=(S,k)=>{IP(S,k)};function PT(S,k,G){const ne=G?ce(G).ticker:S7();if((0,AT.isPointer)(S))return(0,NT.pointerToPrism)(S).onChange(ne,k,!0);if((0,NT.isPrism)(S))return S.onChange(ne,k,!0);throw new Error("Called onChange(p) where p is neither a pointer nor a prism.")}function RT(S){if((0,AT.isPointer)(S))return(0,NT.pointerToPrism)(S).getValue();throw new Error("Called val(p) where p is not a pointer.")}var LU=class{constructor(){C(this,"_studio")}get type(){return"Theatre_CoreBundle"}get version(){return"1.0.19"}getBitsForStudio(S,k){if(this._studio)throw new Error("@tomorrowevening/theatre-core is already attached to @tomorrowevening/theatre-studio");this._studio=S;const G={projectsP:Ue.atom.pointer.projects,privateAPI:ce,coreExports:ye,getCoreRafDriver:_7};k(G)}};FU();function FU(){if(typeof window>"u")return;const S=window[lT];if(typeof S<"u")throw typeof S=="object"&&S&&typeof S.version=="string"?new Error(`It seems that the module '@tomorrowevening/theatre-core' is loaded more than once. This could have two possible causes:
1. You might have two separate versions of Theatre.js in node_modules.
2. Or this might be a bundling misconfiguration, in case you're using a bundler like Webpack/ESBuild/Rollup.

Note that it **is okay** to import '@tomorrowevening/theatre-core' multiple times. But those imports should point to the same module.`):new Error("The variable window.".concat(lT," seems to be already set by a module other than @tomorrowevening/theatre-core."));const k=new LU;window[lT]=k;const G=window[lU];G&&G!==null&&G.type==="Theatre_StudioBundle"&&G.registerCoreBundle(k)}/*! Bundled license information:

		lodash-es/lodash.js:
		  (**
		   * @license
		   * Lodash (Custom Build) <https://lodash.com/>
		   * Build: `lodash modularize exports="es" -o ./`
		   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
		   * Released under MIT license <https://lodash.com/license>
		   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
		   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
		   *)
		*/}(wC,wC.exports)),wC.exports}SC.exports;var j8e;function Zze(){return j8e||(j8e=1,function(s,e){var t={},n=Object.create,r=Object.freeze,i=Object.defineProperty,o=Object.defineProperties,l=Object.getOwnPropertyDescriptor,c=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertyNames,m=Object.getOwnPropertySymbols,y=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable,A=(a,u)=>{if(u=Symbol[a])return u;throw Error("Symbol."+a+" is not defined")},I=Math.pow,D=(a,u,d)=>u in a?i(a,u,{enumerable:!0,configurable:!0,writable:!0,value:d}):a[u]=d,P=(a,u)=>{for(var d in u||(u={}))b.call(u,d)&&D(a,d,u[d]);if(m)for(var d of m(u))w.call(u,d)&&D(a,d,u[d]);return a},U=(a,u)=>o(a,c(u)),j=(a,u)=>{var d={};for(var g in a)b.call(a,g)&&u.indexOf(g)<0&&(d[g]=a[g]);if(a!=null&&m)for(var g of m(a))u.indexOf(g)<0&&w.call(a,g)&&(d[g]=a[g]);return d},C=(a,u)=>()=>(a&&(u=a(a=0)),u),Z=(a,u)=>()=>(u||a((u={exports:{}}).exports,u),u.exports),ie=(a,u)=>{for(var d in u)i(a,d,{get:u[d],enumerable:!0})},se=(a,u,d,g)=>{if(u&&typeof u=="object"||typeof u=="function")for(let _ of h(u))!b.call(a,_)&&_!==d&&i(a,_,{get:()=>u[_],enumerable:!(g=l(u,_))||g.enumerable});return a},z=(a,u,d)=>(d=a!=null?n(y(a)):{},se(u||!a||!a.__esModule?i(d,"default",{value:a,enumerable:!0}):d,a)),re=a=>se(i({},"__esModule",{value:!0}),a),ye=(a,u,d)=>(D(a,typeof u!="symbol"?u+"":u,d),d),H=(a,u)=>r(i(a,"raw",{value:r(a.slice())})),Me=(a,u,d)=>new Promise((g,_)=>{var T=O=>{try{R(d.next(O))}catch(B){_(B)}},N=O=>{try{R(d.throw(O))}catch(B){_(B)}},R=O=>O.done?g(O.value):Promise.resolve(O.value).then(T,N);R((d=d.apply(a,u)).next())}),Oe=function(a,u){this[0]=a,this[1]=u},Ue=a=>{var u=a[A("asyncIterator")],d=!1,g,_={};return u==null?(u=a[A("iterator")](),g=T=>_[T]=N=>u[T](N)):(u=u.call(a),g=T=>_[T]=N=>{if(d){if(d=!1,T==="throw")throw N;return N}return d=!0,{done:!1,value:new Oe(new Promise(R=>{var O=u[T](N);if(!(O instanceof Object))throw TypeError("Object expected");R(O)}),1)}}),_[A("iterator")]=()=>_,g("next"),"throw"in u?g("throw"):_.throw=T=>{throw T},"return"in u&&g("return"),_};function Ie(a){Ve=a}function ce(){return Ve}var Ve,Pe=C(()=>{});function We(a){return u=>typeof u=="object"&&!!u&&u.type===a}var pt,Ne,st,Pt,yn,bn,St,Ut,Wt=C(()=>{pt=We("Theatre_Project"),Ne=We("Theatre_Sheet"),st=We("Theatre_SheetTemplate"),Pt=We("Theatre_SheetObject"),yn=We("Theatre_Sequence"),bn=We("Theatre_SheetObjectTemplate"),St=We("Theatre_Sheet_PublicAPI"),Ut=We("Theatre_SheetObject_PublicAPI")}),kn,Dn,or=C(()=>{kn=typeof D0=="object"&&D0&&D0.Object===Object&&D0,Dn=kn}),ns,Xr,Vr,Kr=C(()=>{or(),ns=typeof self=="object"&&self&&self.Object===Object&&self,Xr=Dn||ns||Function("return this")(),Vr=Xr}),Yr,mi,Ke=C(()=>{Kr(),Yr=Vr.Symbol,mi=Yr});function _s(a){var u=Ti.call(a,ke),d=a[ke];try{a[ke]=void 0;var g=!0}catch{}var _=Vn.call(a);return g&&(u?a[ke]=d:delete a[ke]),_}var ui,Ti,Vn,ke,de,ht=C(()=>{Ke(),ui=Object.prototype,Ti=ui.hasOwnProperty,Vn=ui.toString,ke=mi?mi.toStringTag:void 0,de=_s});function Xt(a){return Vt.call(a)}var Kt,Vt,Qn,wn=C(()=>{Kt=Object.prototype,Vt=Kt.toString,Qn=Xt});function ar(a){return a==null?a===void 0?en:Ir:vn&&vn in Object(a)?de(a):Qn(a)}var Ir,en,vn,Gn,$n=C(()=>{Ke(),ht(),wn(),Ir="[object Null]",en="[object Undefined]",vn=mi?mi.toStringTag:void 0,Gn=ar});function Bn(a){return a!=null&&typeof a=="object"}var Cr,et=C(()=>{Cr=Bn});function _n(a){return typeof a=="symbol"||Cr(a)&&Gn(a)==pn}var pn,Nn,cn=C(()=>{$n(),et(),pn="[object Symbol]",Nn=_n});function jt(a,u){for(var d=-1,g=a==null?0:a.length,_=Array(g);++d<g;)_[d]=u(a[d],d,a);return _}var Wn,Br=C(()=>{Wn=jt}),Hi,Pr,Ls=C(()=>{Hi=Array.isArray,Pr=Hi});function la(a){if(typeof a=="string")return a;if(Pr(a))return Wn(a,la)+"";if(Nn(a))return Up?Up.call(a):"";var u=a+"";return u=="0"&&1/a==-Sd?"-0":u}var Sd,u0,Up,Pc,wd=C(()=>{Ke(),Br(),Ls(),cn(),Sd=1/0,u0=mi?mi.prototype:void 0,Up=u0?u0.toString:void 0,Pc=la});function Pl(a){for(var u=a.length;u--&&cl.test(a.charAt(u)););return u}var cl,wh,_m=C(()=>{cl=/\s/,wh=Pl});function Th(a){return a&&a.slice(0,wh(a)+1).replace($o,"")}var $o,Mu,Rc=C(()=>{_m(),$o=/^\s+/,Mu=Th});function Td(a){var u=typeof a;return a!=null&&(u=="object"||u=="function")}var ca,ul=C(()=>{ca=Td});function Sm(a){if(typeof a=="number")return a;if(Nn(a))return Eh;if(ca(a)){var u=typeof a.valueOf=="function"?a.valueOf():a;a=ca(u)?u+"":u}if(typeof a!="string")return a===0?a:+a;a=Mu(a);var d=Tm.test(a);return d||me.test(a)?mt(a.slice(2),d?2:8):wm.test(a)?Eh:+a}var Eh,wm,Tm,me,mt,At,wt=C(()=>{Rc(),ul(),cn(),Eh=NaN,wm=/^[-+]0x[0-9a-f]+$/i,Tm=/^0b[01]+$/i,me=/^0o[0-7]+$/i,mt=parseInt,At=Sm});function bt(a){if(!a)return a===0?a:0;if(a=At(a),a===Rn||a===-Rn){var u=a<0?-1:1;return u*jn}return a===a?a:0}var Rn,jn,An,Un=C(()=>{wt(),Rn=1/0,jn=17976931348623157e292,An=bt});function er(a){var u=An(a),d=u%1;return u===u?d?u-d:u:0}var yr,Zr=C(()=>{Un(),yr=er});function xr(a){return a}var gi,Ui=C(()=>{gi=xr});function ss(a){if(!ca(a))return!1;var u=Gn(a);return u==$s||u==lr||u==hi||u==ua}var hi,$s,lr,ua,pi,Ca=C(()=>{$n(),ul(),hi="[object AsyncFunction]",$s="[object Function]",lr="[object GeneratorFunction]",ua="[object Proxy]",pi=ss}),oo,Wo,Cu=C(()=>{Kr(),oo=Vr["__core-js_shared__"],Wo=oo});function Ai(a){return!!Ur&&Ur in a}var Ur,qo,As=C(()=>{Cu(),Ur=function(){var a=/[^.]+$/.exec(Wo&&Wo.keys&&Wo.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}(),qo=Ai});function Rl(a){if(a!=null){try{return Mh.call(a)}catch{}try{return a+""}catch{}}return""}var Wa,Mh,Ic,Em=C(()=>{Wa=Function.prototype,Mh=Wa.toString,Ic=Rl});function Mm(a){if(!ca(a)||qo(a))return!1;var u=pi(a)?l9:dl;return u.test(Ic(a))}var kc,dl,z0,Ed,Ch,Dc,l9,kg,zp=C(()=>{Ca(),As(),ul(),Em(),kc=/[\\^$.*+?()[\]{}|]/g,dl=/^\[object .+?Constructor\]$/,z0=Function.prototype,Ed=Object.prototype,Ch=z0.toString,Dc=Ed.hasOwnProperty,l9=RegExp("^"+Ch.call(Dc).replace(kc,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kg=Mm});function P5(a,u){return a==null?void 0:a[u]}var Au,Md=C(()=>{Au=P5});function c9(a,u){var d=Au(a,u);return kg(d)?d:void 0}var V0,d0=C(()=>{zp(),Md(),V0=c9}),Ah,Oc,Cm=C(()=>{d0(),Kr(),Ah=V0(Vr,"WeakMap"),Oc=Ah}),Dg,u9,Am,Nm=C(()=>{ul(),Dg=Object.create,u9=function(){function a(){}return function(u){if(!ca(u))return{};if(Dg)return Dg(u);a.prototype=u;var d=new a;return a.prototype=void 0,d}}(),Am=u9});function Pm(a,u,d){switch(d.length){case 0:return a.call(u);case 1:return a.call(u,d[0]);case 2:return a.call(u,d[0],d[1]);case 3:return a.call(u,d[0],d[1],d[2])}return a.apply(u,d)}var Og,Lc=C(()=>{Og=Pm});function Rm(){}var Nh,Lg=C(()=>{Nh=Rm});function Im(a,u){var d=-1,g=a.length;for(u||(u=Array(g));++d<g;)u[d]=a[d];return u}var Fc,km=C(()=>{Fc=Im});function Xo(a){var u=0,d=0;return function(){var g=G0(),_=Il-(g-d);if(d=g,_>0){if(++u>=Cd)return arguments[0]}else u=0;return a.apply(void 0,arguments)}}var Cd,Il,G0,Vp,Gp=C(()=>{Cd=800,Il=16,G0=Date.now,Vp=Xo});function Bc(a){return function(){return a}}var Ad,Uc=C(()=>{Ad=Bc}),bo,Nu,Dm=C(()=>{d0(),bo=function(){try{var a=V0(Object,"defineProperty");return a({},"",{}),a}catch{}}(),Nu=bo}),d9,j0,jp=C(()=>{Uc(),Dm(),Ui(),d9=Nu?function(a,u){return Nu(a,"toString",{configurable:!0,enumerable:!1,value:Ad(u),writable:!0})}:gi,j0=d9}),h9,p9,Fg=C(()=>{jp(),Gp(),h9=Vp(j0),p9=h9});function R5(a,u){for(var d=-1,g=a==null?0:a.length;++d<g&&u(a[d],d,a)!==!1;);return a}var Om,I5=C(()=>{Om=R5});function Bg(a,u,d,g){for(var _=a.length,T=d+(g?1:-1);g?T--:++T<_;)if(u(a[T],T,a))return T;return-1}var Lm,Fm=C(()=>{Lm=Bg});function Bm(a){return a!==a}var Hp,da=C(()=>{Hp=Bm});function k5(a,u,d){for(var g=d-1,_=a.length;++g<_;)if(a[g]===u)return g;return-1}var $p,f9=C(()=>{$p=k5});function m9(a,u,d){return u===u?$p(a,u,d):Lm(a,Hp,d)}var Aa,g9=C(()=>{Fm(),da(),f9(),Aa=m9});function D5(a,u){var d=a==null?0:a.length;return!!d&&Aa(a,u,0)>-1}var y9,v9=C(()=>{g9(),y9=D5});function Ug(a,u){var d=typeof a;return u=u??Ws,!!u&&(d=="number"||d!="symbol"&&Ph.test(a))&&a>-1&&a%1==0&&a<u}var Ws,Ph,H0,zc=C(()=>{Ws=9007199254740991,Ph=/^(?:0|[1-9]\d*)$/,H0=Ug});function zg(a,u,d){u=="__proto__"&&Nu?Nu(a,u,{configurable:!0,enumerable:!0,value:d,writable:!0}):a[u]=d}var Di,Nd=C(()=>{Dm(),Di=zg});function Rh(a,u){return a===u||a!==a&&u!==u}var Ih,Wp=C(()=>{Ih=Rh});function x9(a,u,d){var g=a[u];(!(kh.call(a,u)&&Ih(g,d))||d===void 0&&!(u in a))&&Di(a,u,d)}var Vg,kh,$0,Pd=C(()=>{Nd(),Wp(),Vg=Object.prototype,kh=Vg.hasOwnProperty,$0=x9});function O5(a,u,d,g){var _=!d;d||(d={});for(var T=-1,N=u.length;++T<N;){var R=u[T],O=g?g(d[R],a[R],R,d,a):void 0;O===void 0&&(O=a[R]),_?Di(d,R,O):$0(d,R,O)}return d}var Vc,Um=C(()=>{Pd(),Nd(),Vc=O5});function b9(a,u,d){return u=le(u===void 0?a.length-1:u,0),function(){for(var g=arguments,_=-1,T=le(g.length-u,0),N=Array(T);++_<T;)N[_]=g[u+_];_=-1;for(var R=Array(u+1);++_<u;)R[_]=g[_];return R[u]=d(N),Og(a,this,R)}}var le,Ee,tt=C(()=>{Lc(),le=Math.max,Ee=b9});function Ft(a,u){return p9(Ee(a,u,gi),a+"")}var kr,zi=C(()=>{Ui(),tt(),Fg(),kr=Ft});function Na(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=h0}var h0,qp,Pu=C(()=>{h0=9007199254740991,qp=Na});function Pa(a){return a!=null&&qp(a.length)&&!pi(a)}var Gc,zm=C(()=>{Ca(),Pu(),Gc=Pa});function Tx(a,u,d){if(!ca(d))return!1;var g=typeof u;return(g=="number"?Gc(d)&&H0(u,d.length):g=="string"&&u in d)?Ih(d[u],a):!1}var _9,Ex=C(()=>{Wp(),zm(),zc(),ul(),_9=Tx});function L5(a){var u=a&&a.constructor,d=typeof u=="function"&&u.prototype||Mx;return a===d}var Mx,S9,jc=C(()=>{Mx=Object.prototype,S9=L5});function F5(a,u){for(var d=-1,g=Array(a);++d<a;)g[d]=u(d);return g}var Vm,Gg=C(()=>{Vm=F5});function Cx(a){return Cr(a)&&Gn(a)==Gm}var Gm,Dh,B5=C(()=>{$n(),et(),Gm="[object Arguments]",Dh=Cx}),jm,jg,U5,z5,Hg,$g=C(()=>{B5(),et(),jm=Object.prototype,jg=jm.hasOwnProperty,U5=jm.propertyIsEnumerable,z5=Dh(function(){return arguments}())?Dh:function(a){return Cr(a)&&jg.call(a,"callee")&&!U5.call(a,"callee")},Hg=z5});function V5(){return!1}var G5,Oh=C(()=>{G5=V5}),Wg,Hm,Ax,j5,Xp,H5,$m,qg=C(()=>{Kr(),Oh(),Wg=e&&!e.nodeType&&e,Hm=Wg&&!0&&s&&!s.nodeType&&s,Ax=Hm&&Hm.exports===Wg,j5=Ax?Vr.Buffer:void 0,Xp=j5?j5.isBuffer:void 0,H5=Xp||G5,$m=H5});function Fs(a){return Cr(a)&&qp(a.length)&&!!Ss[Gn(a)]}var w9,Lh,Wm,$5,T9,qm,Xg,Yp,W5,Nx,Px,q5,Yg,Kg,E9,M9,C9,A9,Rx,X5,Ix,kx,N9,Rd,Ss,Kp,Oi=C(()=>{$n(),Pu(),et(),w9="[object Arguments]",Lh="[object Array]",Wm="[object Boolean]",$5="[object Date]",T9="[object Error]",qm="[object Function]",Xg="[object Map]",Yp="[object Number]",W5="[object Object]",Nx="[object RegExp]",Px="[object Set]",q5="[object String]",Yg="[object WeakMap]",Kg="[object ArrayBuffer]",E9="[object DataView]",M9="[object Float32Array]",C9="[object Float64Array]",A9="[object Int8Array]",Rx="[object Int16Array]",X5="[object Int32Array]",Ix="[object Uint8Array]",kx="[object Uint8ClampedArray]",N9="[object Uint16Array]",Rd="[object Uint32Array]",Ss={},Ss[M9]=Ss[C9]=Ss[A9]=Ss[Rx]=Ss[X5]=Ss[Ix]=Ss[kx]=Ss[N9]=Ss[Rd]=!0,Ss[w9]=Ss[Lh]=Ss[Kg]=Ss[Wm]=Ss[E9]=Ss[$5]=Ss[T9]=Ss[qm]=Ss[Xg]=Ss[Yp]=Ss[W5]=Ss[Nx]=Ss[Px]=Ss[q5]=Ss[Yg]=!1,Kp=Fs});function Zg(a){return function(u){return a(u)}}var kl,Zp=C(()=>{kl=Zg}),Qg,Qp,W0,Fh,Id,Ru,Iu=C(()=>{or(),Qg=e&&!e.nodeType&&e,Qp=Qg&&!0&&s&&!s.nodeType&&s,W0=Qp&&Qp.exports===Qg,Fh=W0&&Dn.process,Id=function(){try{var a=Qp&&Qp.require&&Qp.require("util").types;return a||Fh&&Fh.binding&&Fh.binding("util")}catch{}}(),Ru=Id}),kd,Dd,ps,ws=C(()=>{Oi(),Zp(),Iu(),kd=Ru&&Ru.isTypedArray,Dd=kd?kl(kd):Kp,ps=Dd});function Bh(a,u){var d=Pr(a),g=!d&&Hg(a),_=!d&&!g&&$m(a),T=!d&&!g&&!_&&ps(a),N=d||g||_||T,R=N?Vm(a.length,String):[],O=R.length;for(var B in a)(u||qa.call(a,B))&&!(N&&(B=="length"||_&&(B=="offset"||B=="parent")||T&&(B=="buffer"||B=="byteLength"||B=="byteOffset")||H0(B,O)))&&R.push(B);return R}var Ra,qa,Od,Uh=C(()=>{Gg(),$g(),Ls(),qg(),zc(),ws(),Ra=Object.prototype,qa=Ra.hasOwnProperty,Od=Bh});function Dl(a,u){return function(d){return a(u(d))}}var Xm,Y5=C(()=>{Xm=Dl}),K5,Jg,Dx=C(()=>{Y5(),K5=Xm(Object.keys,Object),Jg=K5});function Ld(a){if(!S9(a))return Jg(a);var u=[];for(var d in Object(a))P9.call(a,d)&&d!="constructor"&&u.push(d);return u}var Fd,P9,Z5,Lw=C(()=>{jc(),Dx(),Fd=Object.prototype,P9=Fd.hasOwnProperty,Z5=Ld});function zh(a){return Gc(a)?Od(a):Z5(a)}var Hc,ku=C(()=>{Uh(),Lw(),zm(),Hc=zh});function R9(a){var u=[];if(a!=null)for(var d in Object(a))u.push(d);return u}var Jp,q0=C(()=>{Jp=R9});function p0(a){if(!ca(a))return Jp(a);var u=S9(a),d=[];for(var g in a)g=="constructor"&&(u||!X0.call(a,g))||d.push(g);return d}var Vh,X0,Du,ef=C(()=>{ul(),jc(),q0(),Vh=Object.prototype,X0=Vh.hasOwnProperty,Du=p0});function Ox(a){return Gc(a)?Od(a,!0):Du(a)}var tf,e2=C(()=>{Uh(),ef(),zm(),tf=Ox});function f0(a,u){if(Pr(a))return!1;var d=typeof a;return d=="number"||d=="symbol"||d=="boolean"||a==null||Nn(a)?!0:Bs.test(a)||!Ol.test(a)||u!=null&&a in Object(u)}var Ol,Bs,Ll,t2=C(()=>{Ls(),cn(),Ol=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Bs=/^\w*$/,Ll=f0}),Q5,Gh,Ym=C(()=>{d0(),Q5=V0(Object,"create"),Gh=Q5});function Lx(){this.__data__=Gh?Gh(null):{},this.size=0}var n2,Fx=C(()=>{Ym(),n2=Lx});function Km(a){var u=this.has(a)&&delete this.__data__[a];return this.size-=u?1:0,u}var I9,Fw=C(()=>{I9=Km});function r2(a){var u=this.__data__;if(Gh){var d=u[a];return d===i2?void 0:d}return J5.call(u,a)?u[a]:void 0}var i2,s2,J5,nf,ev=C(()=>{Ym(),i2="__lodash_hash_undefined__",s2=Object.prototype,J5=s2.hasOwnProperty,nf=r2});function k9(a){var u=this.__data__;return Gh?u[a]!==void 0:rf.call(u,a)}var o2,rf,D9,tv=C(()=>{Ym(),o2=Object.prototype,rf=o2.hasOwnProperty,D9=k9});function nv(a,u){var d=this.__data__;return this.size+=this.has(a)?0:1,d[a]=Gh&&u===void 0?Zm:u,this}var Zm,Bd,Y0=C(()=>{Ym(),Zm="__lodash_hash_undefined__",Bd=nv});function m0(a){var u=-1,d=a==null?0:a.length;for(this.clear();++u<d;){var g=a[u];this.set(g[0],g[1])}}var Qm,rv=C(()=>{Fx(),Fw(),ev(),tv(),Y0(),m0.prototype.clear=n2,m0.prototype.delete=I9,m0.prototype.get=nf,m0.prototype.has=D9,m0.prototype.set=Bd,Qm=m0});function Ud(){this.__data__=[],this.size=0}var Ou,O9=C(()=>{Ou=Ud});function Bx(a,u){for(var d=a.length;d--;)if(Ih(a[d][0],u))return d;return-1}var g0,$c=C(()=>{Wp(),g0=Bx});function L9(a){var u=this.__data__,d=g0(u,a);if(d<0)return!1;var g=u.length-1;return d==g?u.pop():a2.call(u,d,1),--this.size,!0}var iv,a2,sv,l2=C(()=>{$c(),iv=Array.prototype,a2=iv.splice,sv=L9});function Lu(a){var u=this.__data__,d=g0(u,a);return d<0?void 0:u[d][1]}var Jm,c2=C(()=>{$c(),Jm=Lu});function jh(a){return g0(this.__data__,a)>-1}var F9,e1=C(()=>{$c(),F9=jh});function Ux(a,u){var d=this.__data__,g=g0(d,a);return g<0?(++this.size,d.push([a,u])):d[g][1]=u,this}var B9,eo=C(()=>{$c(),B9=Ux});function zd(a){var u=-1,d=a==null?0:a.length;for(this.clear();++u<d;){var g=a[u];this.set(g[0],g[1])}}var sf,t1=C(()=>{O9(),l2(),c2(),e1(),eo(),zd.prototype.clear=Ou,zd.prototype.delete=sv,zd.prototype.get=Jm,zd.prototype.has=F9,zd.prototype.set=B9,sf=zd}),u2,Hh,Vd=C(()=>{d0(),Kr(),u2=V0(Vr,"Map"),Hh=u2});function fs(){this.size=0,this.__data__={hash:new Qm,map:new(Hh||sf),string:new Qm}}var qs,ha=C(()=>{rv(),t1(),Vd(),qs=fs});function U9(a){var u=typeof a;return u=="string"||u=="number"||u=="symbol"||u=="boolean"?a!=="__proto__":a===null}var n1,d2=C(()=>{n1=U9});function zx(a,u){var d=a.__data__;return n1(u)?d[typeof u=="string"?"string":"hash"]:d.map}var _o,r1=C(()=>{d2(),_o=zx});function z9(a){var u=_o(this,a).delete(a);return this.size-=u?1:0,u}var h2,Fu=C(()=>{r1(),h2=z9});function K0(a){return _o(this,a).get(a)}var i1,ov=C(()=>{r1(),i1=K0});function av(a){return _o(this,a).has(a)}var V9,Vx=C(()=>{r1(),V9=av});function Gx(a,u){var d=_o(this,a),g=d.size;return d.set(a,u),this.size+=d.size==g?0:1,this}var G9,jx=C(()=>{r1(),G9=Gx});function Gd(a){var u=-1,d=a==null?0:a.length;for(this.clear();++u<d;){var g=a[u];this.set(g[0],g[1])}}var s1,j9=C(()=>{ha(),Fu(),ov(),Vx(),jx(),Gd.prototype.clear=qs,Gd.prototype.delete=h2,Gd.prototype.get=i1,Gd.prototype.has=V9,Gd.prototype.set=G9,s1=Gd});function of(a,u){if(typeof a!="function"||u!=null&&typeof u!="function")throw new TypeError(lv);var d=function(){var g=arguments,_=u?u.apply(this,g):g[0],T=d.cache;if(T.has(_))return T.get(_);var N=a.apply(this,g);return d.cache=T.set(_,N)||T,N};return d.cache=new(of.Cache||s1),d}var lv,af,p2=C(()=>{j9(),lv="Expected a function",of.Cache=s1,af=of});function Hx(a){var u=af(a,function(g){return d.size===H9&&d.clear(),g}),d=u.cache;return u}var H9,$9,$x=C(()=>{p2(),H9=500,$9=Hx}),f2,cv,W9,uv,q9=C(()=>{$x(),f2=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,cv=/\\(\\)?/g,W9=$9(function(a){var u=[];return a.charCodeAt(0)===46&&u.push(""),a.replace(f2,function(d,g,_,T){u.push(_?T.replace(cv,"$1"):g||d)}),u}),uv=W9});function Wx(a){return a==null?"":Pc(a)}var o1,dv=C(()=>{wd(),o1=Wx});function hv(a,u){return Pr(a)?a:Ll(a,u)?[a]:uv(o1(a))}var m2,X9=C(()=>{Ls(),t2(),q9(),dv(),m2=hv});function pv(a){if(typeof a=="string"||Nn(a))return a;var u=a+"";return u=="0"&&1/a==-Y9?"-0":u}var Y9,Bu,a1=C(()=>{cn(),Y9=1/0,Bu=pv});function Bw(a,u){u=m2(u,a);for(var d=0,g=u.length;a!=null&&d<g;)a=a[Bu(u[d++])];return d&&d==g?a:void 0}var K9,y0=C(()=>{X9(),a1(),K9=Bw});function fv(a,u,d){var g=a==null?void 0:K9(a,u);return g===void 0?d:g}var Uu,Z0=C(()=>{y0(),Uu=fv});function l1(a,u){for(var d=-1,g=u.length,_=a.length;++d<g;)a[_+d]=u[d];return a}var g2,y2=C(()=>{g2=l1});function c1(a){return Pr(a)||Hg(a)||!!(v2&&a&&a[v2])}var v2,Z9,Q9=C(()=>{Ke(),$g(),Ls(),v2=mi?mi.isConcatSpreadable:void 0,Z9=c1});function mv(a,u,d,g,_){var T=-1,N=a.length;for(d||(d=Z9),_||(_=[]);++T<N;){var R=a[T];u>0&&d(R)?u>1?mv(R,u-1,d,g,_):g2(_,R):g||(_[_.length]=R)}return _}var x2,qx=C(()=>{y2(),Q9(),x2=mv}),gv,b2,yv=C(()=>{Y5(),gv=Xm(Object.getPrototypeOf,Object),b2=gv});function Fl(a){if(!Cr(a)||Gn(a)!=Ia)return!1;var u=b2(a);if(u===null)return!0;var d=xv.call(u,"constructor")&&u.constructor;return typeof d=="function"&&d instanceof d&&e4.call(d)==bv}var Ia,J9,vv,e4,xv,bv,u1,_v=C(()=>{$n(),yv(),et(),Ia="[object Object]",J9=Function.prototype,vv=Object.prototype,e4=J9.toString,xv=vv.hasOwnProperty,bv=e4.call(Object),u1=Fl});function Sv(a){var u=Math[a];return function(d,g){if(d=At(d),g=g==null?0:Tv(yr(g),292),g&&wv(d)){var _=(o1(d)+"e").split("e"),T=u(_[0]+"e"+(+_[1]+g));return _=(o1(T)+"e").split("e"),+(_[0]+"e"+(+_[1]-g))}return u(d)}}var wv,Tv,t4,Ev=C(()=>{Kr(),Zr(),wt(),dv(),wv=Vr.isFinite,Tv=Math.min,t4=Sv});function Xx(a,u,d){return a===a&&(d!==void 0&&(a=a<=d?a:d),u!==void 0&&(a=a>=u?a:u)),a}var n4,r4=C(()=>{n4=Xx});function Uw(a,u,d){return d===void 0&&(d=u,u=void 0),d!==void 0&&(d=At(d),d=d===d?d:0),u!==void 0&&(u=At(u),u=u===u?u:0),n4(At(a),u,d)}var os,lf=C(()=>{r4(),wt(),os=Uw});function Yx(){this.__data__=new sf,this.size=0}var _2,jd=C(()=>{t1(),_2=Yx});function zw(a){var u=this.__data__,d=u.delete(a);return this.size=u.size,d}var Mv,Cv=C(()=>{Mv=zw});function Kx(a){return this.__data__.get(a)}var Av,S2=C(()=>{Av=Kx});function Xa(a){return this.__data__.has(a)}var Zx,Vw=C(()=>{Zx=Xa});function i4(a,u){var d=this.__data__;if(d instanceof sf){var g=d.__data__;if(!Hh||g.length<pa-1)return g.push([a,u]),this.size=++d.size,this;d=this.__data__=new s1(g)}return d.set(a,u),this.size=d.size,this}var pa,Qx,tr=C(()=>{t1(),Vd(),j9(),pa=200,Qx=i4});function Wc(a){var u=this.__data__=new sf(a);this.size=u.size}var $h,s4=C(()=>{t1(),jd(),Cv(),S2(),Vw(),tr(),Wc.prototype.clear=_2,Wc.prototype.delete=Mv,Wc.prototype.get=Av,Wc.prototype.has=Zx,Wc.prototype.set=Qx,$h=Wc});function Jx(a,u){return a&&Vc(u,Hc(u),a)}var d1,o4=C(()=>{Um(),ku(),d1=Jx});function Nv(a,u){return a&&Vc(u,tf(u),a)}var Pv,e7=C(()=>{Um(),e2(),Pv=Nv});function Rv(a,u){if(u)return a.slice();var d=a.length,g=qc?qc(d):new a.constructor(d);return a.copy(g),g}var w2,T2,fa,v0,qc,Iv,t7=C(()=>{Kr(),w2=e&&!e.nodeType&&e,T2=w2&&!0&&s&&!s.nodeType&&s,fa=T2&&T2.exports===w2,v0=fa?Vr.Buffer:void 0,qc=v0?v0.allocUnsafe:void 0,Iv=Rv});function Xc(a,u){for(var d=-1,g=a==null?0:a.length,_=0,T=[];++d<g;){var N=a[d];u(N,d,a)&&(T[_++]=N)}return T}var a4,zu=C(()=>{a4=Xc});function Gw(){return[]}var l4,kv=C(()=>{l4=Gw}),Dv,Ov,Lv,E2,h1,Bl=C(()=>{zu(),kv(),Dv=Object.prototype,Ov=Dv.propertyIsEnumerable,Lv=Object.getOwnPropertySymbols,E2=Lv?function(a){return a==null?[]:(a=Object(a),a4(Lv(a),function(u){return Ov.call(a,u)}))}:l4,h1=E2});function Vi(a,u){return Vc(a,h1(a),u)}var Yo,Io=C(()=>{Um(),Bl(),Yo=Vi}),ma,Ul,Wh,Qr=C(()=>{y2(),yv(),Bl(),kv(),ma=Object.getOwnPropertySymbols,Ul=ma?function(a){for(var u=[];a;)g2(u,h1(a)),a=b2(a);return u}:l4,Wh=Ul});function qh(a,u){return Vc(a,Wh(a),u)}var Xh,c4=C(()=>{Um(),Qr(),Xh=qh});function Fv(a,u,d){var g=u(a);return Pr(a)?g:g2(g,d(a))}var cf,hl=C(()=>{y2(),Ls(),cf=Fv});function Bv(a){return cf(a,Hc,h1)}var Hd,Vu=C(()=>{hl(),Bl(),ku(),Hd=Bv});function u4(a){return cf(a,tf,Wh)}var d4,Yc=C(()=>{hl(),Qr(),e2(),d4=u4}),M2,Kc,h4=C(()=>{d0(),Kr(),M2=V0(Vr,"DataView"),Kc=M2}),p1,f1,p4=C(()=>{d0(),Kr(),p1=V0(Vr,"Promise"),f1=p1}),C2,So,Gu=C(()=>{d0(),Kr(),C2=V0(Vr,"Set"),So=C2}),x0,pl,f4,A2,N2,Uv,$d,zv,m4,Yh,g4,zl,uf,P2=C(()=>{h4(),Vd(),p4(),Gu(),Cm(),$n(),Em(),x0="[object Map]",pl="[object Object]",f4="[object Promise]",A2="[object Set]",N2="[object WeakMap]",Uv="[object DataView]",$d=Ic(Kc),zv=Ic(Hh),m4=Ic(f1),Yh=Ic(So),g4=Ic(Oc),zl=Gn,(Kc&&zl(new Kc(new ArrayBuffer(1)))!=Uv||Hh&&zl(new Hh)!=x0||f1&&zl(f1.resolve())!=f4||So&&zl(new So)!=A2||Oc&&zl(new Oc)!=N2)&&(zl=function(a){var u=Gn(a),d=u==pl?a.constructor:void 0,g=d?Ic(d):"";if(g)switch(g){case $d:return Uv;case zv:return x0;case m4:return f4;case Yh:return A2;case g4:return N2}return u}),uf=zl});function Vv(a){var u=a.length,d=new a.constructor(u);return u&&typeof a[0]=="string"&&n7.call(a,"index")&&(d.index=a.index,d.input=a.input),d}var R2,n7,Gv,y4=C(()=>{R2=Object.prototype,n7=R2.hasOwnProperty,Gv=Vv}),jv,Zc,r7=C(()=>{Kr(),jv=Vr.Uint8Array,Zc=jv});function m1(a){var u=new a.constructor(a.byteLength);return new Zc(u).set(new Zc(a)),u}var I2,Xs=C(()=>{r7(),I2=m1});function jw(a,u){var d=u?I2(a.buffer):a.buffer;return new a.constructor(d,a.byteOffset,a.byteLength)}var Hv,i7=C(()=>{Xs(),Hv=jw});function s7(a){var u=new a.constructor(a.source,g1.exec(a));return u.lastIndex=a.lastIndex,u}var g1,$v,o7=C(()=>{g1=/\w*$/,$v=s7});function Q0(a){return v4?Object(v4.call(a)):{}}var k2,v4,ju,x4=C(()=>{Ke(),k2=mi?mi.prototype:void 0,v4=k2?k2.valueOf:void 0,ju=Q0});function df(a,u){var d=u?I2(a.buffer):a.buffer;return new a.constructor(d,a.byteOffset,a.length)}var D2,Wv=C(()=>{Xs(),D2=df});function qv(a,u,d){var g=a.constructor;switch(u){case S4:return I2(a);case Xv:case b4:return new g(+a);case l7:return Hv(a,d);case Zv:case w4:case F2:case T4:case B2:case Qv:case c7:case U2:case Jv:return D2(a,d);case a7:return new g;case Yv:case L2:return new g(a);case _4:return $v(a);case O2:return new g;case Kv:return ju(a)}}var Xv,b4,a7,Yv,_4,O2,L2,Kv,S4,l7,Zv,w4,F2,T4,B2,Qv,c7,U2,Jv,y1,Hw=C(()=>{Xs(),i7(),o7(),x4(),Wv(),Xv="[object Boolean]",b4="[object Date]",a7="[object Map]",Yv="[object Number]",_4="[object RegExp]",O2="[object Set]",L2="[object String]",Kv="[object Symbol]",S4="[object ArrayBuffer]",l7="[object DataView]",Zv="[object Float32Array]",w4="[object Float64Array]",F2="[object Int8Array]",T4="[object Int16Array]",B2="[object Int32Array]",Qv="[object Uint8Array]",c7="[object Uint8ClampedArray]",U2="[object Uint16Array]",Jv="[object Uint32Array]",y1=qv});function E4(a){return typeof a.constructor=="function"&&!S9(a)?Am(b2(a)):{}}var p,v=C(()=>{Nm(),yv(),jc(),p=E4});function E(a){return Cr(a)&&uf(a)==L}var L,q,ee=C(()=>{P2(),et(),L="[object Map]",q=E}),pe,Fe,Ze,It=C(()=>{ee(),Zp(),Iu(),pe=Ru&&Ru.isMap,Fe=pe?kl(pe):q,Ze=Fe});function on(a){return Cr(a)&&uf(a)==fn}var fn,sn,Xn=C(()=>{P2(),et(),fn="[object Set]",sn=on}),nr,ur,ao,_t=C(()=>{Xn(),Zp(),Iu(),nr=Ru&&Ru.isSet,ur=nr?kl(nr):sn,ao=ur});function lt(a,u,d,g,_,T){var N,R=u&Ct,O=u&Sn,B=u&vr;if(d&&(N=_?d(a,g,_,T):d(a)),N!==void 0)return N;if(!ca(a))return a;var V=Pr(a);if(V){if(N=Gv(a),!R)return Fc(a,N)}else{var Y=uf(a),W=Y==Hu||Y==u7;if($m(a))return Iv(a,R);if(Y==Ww||Y==Rr||W&&!_){if(N=O||W?{}:p(a),!R)return O?Xh(a,Pv(N,a)):Yo(a,d1(N,a))}else{if(!Us[Y])return _?a:{};N=y1(a,Y,R)}}T||(T=new $h);var $=T.get(a);if($)return $;T.set(a,N),ao(a)?a.forEach(function(oe){N.add(lt(oe,u,d,oe,a,T))}):Ze(a)&&a.forEach(function(oe,ae){N.set(ae,lt(oe,u,d,ae,a,T))});var K=B?O?d4:Hd:O?tf:Hc,J=V?void 0:K(a);return Om(J||a,function(oe,ae){J&&(ae=oe,oe=a[ae]),$0(N,ae,lt(oe,u,d,ae,a,T))}),N}var Ct,Sn,vr,Rr,Dr,jr,Ko,Gi,Hu,u7,$w,bN,Ww,qw,_N,SN,wN,TN,EN,MN,d7,h7,CN,Xw,Yw,Kw,AN,Zw,Qw,Us,NN,JB=C(()=>{s4(),I5(),Pd(),o4(),e7(),t7(),km(),Io(),c4(),Vu(),Yc(),P2(),y4(),Hw(),v(),Ls(),qg(),It(),ul(),_t(),ku(),e2(),Ct=1,Sn=2,vr=4,Rr="[object Arguments]",Dr="[object Array]",jr="[object Boolean]",Ko="[object Date]",Gi="[object Error]",Hu="[object Function]",u7="[object GeneratorFunction]",$w="[object Map]",bN="[object Number]",Ww="[object Object]",qw="[object RegExp]",_N="[object Set]",SN="[object String]",wN="[object Symbol]",TN="[object WeakMap]",EN="[object ArrayBuffer]",MN="[object DataView]",d7="[object Float32Array]",h7="[object Float64Array]",CN="[object Int8Array]",Xw="[object Int16Array]",Yw="[object Int32Array]",Kw="[object Uint8Array]",AN="[object Uint8ClampedArray]",Zw="[object Uint16Array]",Qw="[object Uint32Array]",Us={},Us[Rr]=Us[Dr]=Us[EN]=Us[MN]=Us[jr]=Us[Ko]=Us[d7]=Us[h7]=Us[CN]=Us[Xw]=Us[Yw]=Us[$w]=Us[bN]=Us[Ww]=Us[qw]=Us[_N]=Us[SN]=Us[wN]=Us[Kw]=Us[AN]=Us[Zw]=Us[Qw]=!0,Us[Gi]=Us[Hu]=Us[TN]=!1,NN=lt});function PN(a){return NN(a,RN|IN)}var RN,IN,kN,DN=C(()=>{JB(),RN=1,IN=4,kN=PN});function eU(a){return this.__data__.set(a,ON),this}var ON,LN,tU=C(()=>{ON="__lodash_hash_undefined__",LN=eU});function e8(a){return this.__data__.has(a)}var FN,BN=C(()=>{FN=e8});function p7(a){var u=-1,d=a==null?0:a.length;for(this.__data__=new s1;++u<d;)this.add(a[u])}var Jw,UN=C(()=>{j9(),tU(),BN(),p7.prototype.add=p7.prototype.push=LN,p7.prototype.has=FN,Jw=p7});function f7(a,u){for(var d=-1,g=a==null?0:a.length;++d<g;)if(u(a[d],d,a))return!0;return!1}var m7,nU=C(()=>{m7=f7});function rU(a,u){return a.has(u)}var Ns,J0=C(()=>{Ns=rU});function Qc(a,u,d,g,_,T){var N=d&v1,R=a.length,O=u.length;if(R!=O&&!(N&&O>R))return!1;var B=T.get(a),V=T.get(u);if(B&&V)return B==u&&V==a;var Y=-1,W=!0,$=d&zs?new Jw:void 0;for(T.set(a,u),T.set(u,a);++Y<R;){var K=a[Y],J=u[Y];if(g)var oe=N?g(J,K,Y,u,a,T):g(K,J,Y,a,u,T);if(oe!==void 0){if(oe)continue;W=!1;break}if($){if(!m7(u,function(ae,ue){if(!Ns($,ue)&&(K===ae||_(K,ae,d,g,T)))return $.push(ue)})){W=!1;break}}else if(!(K===J||_(K,J,d,g,T))){W=!1;break}}return T.delete(a),T.delete(u),W}var v1,zs,Wd,eT=C(()=>{UN(),nU(),J0(),v1=1,zs=2,Wd=Qc});function iU(a){var u=-1,d=Array(a.size);return a.forEach(function(g,_){d[++u]=[_,g]}),d}var zN,sU=C(()=>{zN=iU});function oU(a){var u=-1,d=Array(a.size);return a.forEach(function(g){d[++u]=g}),d}var g7,y7=C(()=>{g7=oU});function VN(a,u,d,g,_,T,N){switch(d){case oT:if(a.byteLength!=u.byteLength||a.byteOffset!=u.byteOffset)return!1;a=a.buffer,u=u.buffer;case M4:return!(a.byteLength!=u.byteLength||!T(new Zc(a),new Zc(u)));case GN:case nT:case jN:return Ih(+a,+u);case rT:return a.name==u.name&&a.message==u.message;case HN:case $N:return a==u+"";case iT:var R=zN;case sT:var O=g&t8;if(R||(R=g7),a.size!=u.size&&!O)return!1;var B=N.get(a);if(B)return B==u;g|=tT,N.set(a,u);var V=Wd(R(a),R(u),g,_,T,N);return N.delete(a),V;case WN:if(v7)return v7.call(a)==v7.call(u)}return!1}var t8,tT,GN,nT,rT,iT,jN,HN,sT,$N,WN,M4,oT,aT,v7,ko,hf=C(()=>{Ke(),r7(),Wp(),eT(),sU(),y7(),t8=1,tT=2,GN="[object Boolean]",nT="[object Date]",rT="[object Error]",iT="[object Map]",jN="[object Number]",HN="[object RegExp]",sT="[object Set]",$N="[object String]",WN="[object Symbol]",M4="[object ArrayBuffer]",oT="[object DataView]",aT=mi?mi.prototype:void 0,v7=aT?aT.valueOf:void 0,ko=VN});function aU(a,u,d,g,_,T){var N=d&n8,R=Hd(a),O=R.length,B=Hd(u),V=B.length;if(O!=V&&!N)return!1;for(var Y=O;Y--;){var W=R[Y];if(!(N?W in u:XN.call(u,W)))return!1}var $=T.get(a),K=T.get(u);if($&&K)return $==u&&K==a;var J=!0;T.set(a,u),T.set(u,a);for(var oe=N;++Y<O;){W=R[Y];var ae=a[W],ue=u[W];if(g)var xe=N?g(ue,ae,W,u,a,T):g(ae,ue,W,a,u,T);if(!(xe===void 0?ae===ue||_(ae,ue,d,g,T):xe)){J=!1;break}oe||(oe=W=="constructor")}if(J&&!oe){var Re=a.constructor,Ae=u.constructor;Re!=Ae&&"constructor"in a&&"constructor"in u&&!(typeof Re=="function"&&Re instanceof Re&&typeof Ae=="function"&&Ae instanceof Ae)&&(J=!1)}return T.delete(a),T.delete(u),J}var n8,qN,XN,YN,lU=C(()=>{Vu(),n8=1,qN=Object.prototype,XN=qN.hasOwnProperty,YN=aU});function lT(a,u,d,g,_,T){var N=Pr(a),R=Pr(u),O=N?x1:uf(a),B=R?x1:uf(u);O=O==C4?r8:O,B=B==C4?r8:B;var V=O==r8,Y=B==r8,W=O==B;if(W&&$m(a)){if(!$m(u))return!1;N=!0,V=!1}if(W&&!V)return T||(T=new $h),N||ps(a)?Wd(a,u,d,g,_,T):ko(a,u,O,d,g,_,T);if(!(d&KN)){var $=V&&x7.call(a,"__wrapped__"),K=Y&&x7.call(u,"__wrapped__");if($||K){var J=$?a.value():a,oe=K?u.value():u;return T||(T=new $h),_(J,oe,d,g,T)}}return W?(T||(T=new $h),YN(a,u,d,g,_,T)):!1}var KN,C4,x1,r8,ZN,x7,b7,cU=C(()=>{s4(),eT(),hf(),lU(),P2(),Ls(),qg(),ws(),KN=1,C4="[object Arguments]",x1="[object Array]",r8="[object Object]",ZN=Object.prototype,x7=ZN.hasOwnProperty,b7=lT});function i8(a,u,d,g,_){return a===u?!0:a==null||u==null||!Cr(a)&&!Cr(u)?a!==a&&u!==u:b7(a,u,d,g,i8,_)}var _7,S7=C(()=>{cU(),et(),_7=i8});function uU(a,u,d,g){var _=d.length,T=_,N=!g;if(a==null)return!T;for(a=Object(a);_--;){var R=d[_];if(N&&R[2]?R[1]!==a[R[0]]:!(R[0]in a))return!1}for(;++_<T;){R=d[_];var O=R[0],B=a[O],V=R[1];if(N&&R[2]){if(B===void 0&&!(O in a))return!1}else{var Y=new $h;if(g)var W=g(B,V,O,a,u,Y);if(!(W===void 0?_7(V,B,QN|JN,g,Y):W))return!1}}return!0}var QN,JN,eP,dU=C(()=>{s4(),S7(),QN=1,JN=2,eP=uU});function hU(a){return a===a&&!ca(a)}var cT,b1=C(()=>{ul(),cT=hU});function z2(a){for(var u=Hc(a),d=u.length;d--;){var g=u[d],_=a[g];u[d]=[g,_,cT(_)]}return u}var V2,uT=C(()=>{b1(),ku(),V2=z2});function tP(a,u){return function(d){return d==null?!1:d[a]===u&&(u!==void 0||a in Object(d))}}var dT,hT=C(()=>{dT=tP});function pU(a){var u=V2(a);return u.length==1&&u[0][2]?dT(u[0][0],u[0][1]):function(d){return d===a||eP(d,a,u)}}var w7,fU=C(()=>{dU(),uT(),hT(),w7=pU});function mU(a,u){return a!=null&&u in Object(a)}var pT,nP=C(()=>{pT=mU});function gU(a,u,d){u=m2(u,a);for(var g=-1,_=u.length,T=!1;++g<_;){var N=Bu(u[g]);if(!(T=a!=null&&d(a,N)))break;a=a[N]}return T||++g!=_?T:(_=a==null?0:a.length,!!_&&qp(_)&&H0(N,_)&&(Pr(a)||Hg(a)))}var Kh,rP=C(()=>{X9(),$g(),Ls(),zc(),Pu(),a1(),Kh=gU});function yU(a,u){return a!=null&&Kh(a,u,pT)}var iP,fT=C(()=>{nP(),rP(),iP=yU});function vU(a,u){return Ll(a)&&cT(u)?dT(Bu(a),u):function(d){var g=Uu(d,a);return g===void 0&&g===u?iP(d,a):_7(u,g,sP|oP)}}var sP,oP,aP,lP=C(()=>{S7(),Z0(),fT(),t2(),b1(),hT(),a1(),sP=1,oP=2,aP=vU});function xU(a){return function(u){return u==null?void 0:u[a]}}var cP,bU=C(()=>{cP=xU});function _U(a){return function(u){return K9(u,a)}}var uP,SU=C(()=>{y0(),uP=_U});function dP(a){return Ll(a)?cP(Bu(a)):uP(a)}var hP,s8=C(()=>{bU(),SU(),t2(),a1(),hP=dP});function pP(a){return typeof a=="function"?a:a==null?gi:typeof a=="object"?Pr(a)?aP(a[0],a[1]):w7(a):hP(a)}var A4,o8=C(()=>{fU(),lP(),Ui(),Ls(),s8(),A4=pP});function wU(a,u,d,g){for(var _=-1,T=a==null?0:a.length;++_<T;){var N=a[_];u(g,N,d(N),a)}return g}var fP,T7=C(()=>{fP=wU});function TU(a){return function(u,d,g){for(var _=-1,T=Object(u),N=g(u),R=N.length;R--;){var O=N[a?R:++_];if(d(T[O],O,T)===!1)break}return u}}var N4,EU=C(()=>{N4=TU}),mP,gP,MU=C(()=>{EU(),mP=N4(),gP=mP});function mT(a,u){return a&&gP(a,u,Hc)}var E7,yP=C(()=>{MU(),ku(),E7=mT});function CU(a,u){return function(d,g){if(d==null)return d;if(!Gc(d))return a(d,g);for(var _=d.length,T=u?_:-1,N=Object(d);(u?T--:++T<_)&&g(N[T],T,N)!==!1;);return d}}var Jc,G2=C(()=>{zm(),Jc=CU}),_1,gT,P4=C(()=>{yP(),G2(),_1=Jc(E7),gT=_1});function R4(a,u,d,g){return gT(a,function(_,T,N){u(g,_,d(_),N)}),g}var M7,AU=C(()=>{P4(),M7=R4});function vP(a,u){return function(d,g){var _=Pr(d)?fP:M7,T=u?u():{};return _(d,a,A4(g,2),T)}}var xP,yT=C(()=>{T7(),AU(),o8(),Ls(),xP=vP}),C7,Zh,vT=C(()=>{Kr(),C7=function(){return Vr.Date.now()},Zh=C7});function xT(a,u,d){var g,_,T,N,R,O,B=0,V=!1,Y=!1,W=!0;if(typeof a!="function")throw new TypeError(bP);u=At(u)||0,ca(d)&&(V=!!d.leading,Y="maxWait"in d,T=Y?A7(At(d.maxWait)||0,u):T,W="trailing"in d?!!d.trailing:W);function $(we){var ft=g,Le=_;return g=_=void 0,B=we,N=a.apply(Le,ft),N}function K(we){return B=we,R=setTimeout(ae,u),V?$(we):N}function J(we){var ft=we-O,Le=we-B,Se=u-ft;return Y?Qh(Se,T-Le):Se}function oe(we){var ft=we-O,Le=we-B;return O===void 0||ft>=u||ft<0||Y&&Le>=T}function ae(){var we=Zh();if(oe(we))return ue(we);R=setTimeout(ae,J(we))}function ue(we){return R=void 0,W&&g?$(we):(g=_=void 0,N)}function xe(){R!==void 0&&clearTimeout(R),B=0,g=O=_=R=void 0}function Re(){return R===void 0?N:ue(Zh())}function Ae(){var we=Zh(),ft=oe(we);if(g=arguments,_=this,O=we,ft){if(R===void 0)return K(O);if(Y)return clearTimeout(R),R=setTimeout(ae,u),$(O)}return R===void 0&&(R=setTimeout(ae,u)),N}return Ae.cancel=xe,Ae.flush=Re,Ae}var bP,A7,Qh,N7,P7=C(()=>{ul(),vT(),wt(),bP="Expected a function",A7=Math.max,Qh=Math.min,N7=xT});function R7(a,u,d){for(var g=-1,_=a==null?0:a.length;++g<_;)if(d(u,a[g]))return!0;return!1}var I7,_P=C(()=>{I7=R7});function NU(a){var u=a==null?0:a.length;return u?a[u-1]:void 0}var j2,I4=C(()=>{j2=NU});function SP(a,u,d){var g=a==null?0:a.length;if(!g)return-1;var _=d==null?0:yr(d);return _<0&&(_=a8(g+_,0)),Lm(a,A4(u,3),_)}var a8,l8,wP=C(()=>{Fm(),o8(),Zr(),a8=Math.max,l8=SP});function bT(a,u,d){var g=a==null?0:a.length;if(!g)return-1;var _=g-1;return d!==void 0&&(_=yr(d),_=d<0?k7(g+_,0):D7(_,g-1)),Lm(a,A4(u,3),_,!0)}var k7,D7,TP,EP=C(()=>{Fm(),o8(),Zr(),k7=Math.max,D7=Math.min,TP=bT});function MP(a,u){var d=-1,g=Gc(a)?Array(a.length):[];return gT(a,function(_,T,N){g[++d]=u(_,T,N)}),g}var k4,_T=C(()=>{P4(),zm(),k4=MP});function PU(a,u,d){return a>=ST(u,d)&&a<CP(u,d)}var CP,ST,wT,AP=C(()=>{CP=Math.max,ST=Math.min,wT=PU});function ec(a,u,d){return u=An(u),d===void 0?(d=u,u=0):d=An(d),a=At(a),wT(a,u,d)}var TT,ET=C(()=>{AP(),Un(),wt(),TT=ec});function RU(a){return typeof a=="number"&&a==yr(a)}var MT,c8=C(()=>{Zr(),MT=RU}),u8,S1,eu=C(()=>{Nd(),yT(),u8=xP(function(a,u,d){Di(a,d,u)}),S1=u8});function IU(a,u){var d={};return u=A4(u,3),E7(a,function(g,_,T){Di(d,_,u(g,_,T))}),d}var pf,NP=C(()=>{Nd(),yP(),o8(),pf=IU});function PP(a,u,d,g){if(!ca(a))return a;u=m2(u,a);for(var _=-1,T=u.length,N=T-1,R=a;R!=null&&++_<T;){var O=Bu(u[_]),B=d;if(O==="__proto__"||O==="constructor"||O==="prototype")return a;if(_!=N){var V=R[O];B=g?g(V,O,R):void 0,B===void 0&&(B=ca(V)?V:H0(u[_+1])?[]:{})}$0(R,O,B),R=R[O]}return a}var CT,kU=C(()=>{Pd(),X9(),zc(),ul(),a1(),CT=PP});function DU(a,u){var d=a.length;for(a.sort(u);d--;)a[d]=a[d].value;return a}var AT,NT=C(()=>{AT=DU});function RP(a,u){if(a!==u){var d=a!==void 0,g=a===null,_=a===a,T=Nn(a),N=u!==void 0,R=u===null,O=u===u,B=Nn(u);if(!R&&!B&&!T&&a>u||T&&N&&O&&!R&&!B||g&&N&&O||!d&&O||!_)return 1;if(!g&&!T&&!B&&a<u||B&&d&&_&&!g&&!T||R&&d&&_||!N&&_||!O)return-1}return 0}var IP,OU=C(()=>{cn(),IP=RP});function PT(a,u,d){for(var g=-1,_=a.criteria,T=u.criteria,N=_.length,R=d.length;++g<N;){var O=IP(_[g],T[g]);if(O){if(g>=R)return O;var B=d[g];return O*(B=="desc"?-1:1)}}return a.index-u.index}var RT,LU=C(()=>{OU(),RT=PT});function FU(a,u,d){u.length?u=Wn(u,function(T){return Pr(T)?function(N){return K9(N,T.length===1?T[0]:T)}:T}):u=[gi];var g=-1;u=Wn(u,kl(A4));var _=k4(a,function(T,N,R){var O=Wn(u,function(B){return B(T)});return{criteria:O,index:++g,value:T}});return AT(_,function(T,N){return RT(T,N,d)})}var S,k=C(()=>{Br(),y0(),o8(),_T(),NT(),Zp(),LU(),Ui(),Ls(),S=FU});function G(a,u,d,g){for(var _=d-1,T=a.length;++_<T;)if(g(a[_],u))return _;return-1}var ne,he=C(()=>{ne=G});function ve(a,u,d,g){var _=g?ne:Aa,T=-1,N=u.length,R=a;for(a===u&&(u=Fc(u)),d&&(R=Wn(a,kl(d)));++T<N;)for(var O=0,B=u[T],V=d?d(B):B;(O=_(R,V,O,g))>-1;)R!==a&&ct.call(R,O,1),ct.call(a,O,1);return a}var je,ct,xt,Lt=C(()=>{Br(),g9(),he(),Zp(),km(),je=Array.prototype,ct=je.splice,xt=ve});function an(a,u){return a&&a.length&&u&&u.length?xt(a,u):a}var dn,In=C(()=>{Lt(),dn=an}),dr,sr,ii=C(()=>{zi(),In(),dr=kr(dn),sr=dr}),fi,Jr,$i=C(()=>{Ev(),fi=t4("round"),Jr=fi});function ka(a,u,d){return a==null?a:CT(a,u,d)}var Do,Zo=C(()=>{kU(),Do=ka}),as,ga,Vl=C(()=>{qx(),k(),zi(),Ex(),as=kr(function(a,u){if(a==null)return[];var d=u.length;return d>1&&_9(a,u[0],u[1])?u=[]:d>2&&_9(u[0],u[1],u[2])&&(u=[u[0]]),S(a,x2(u,1),[])}),ga=as}),tc,qd,Xd,Jh=C(()=>{Gu(),Lg(),y7(),tc=1/0,qd=So&&1/g7(new So([,-0]))[1]==tc?function(a){return new So(a)}:Nh,Xd=qd});function $u(a,u,d){var g=-1,_=y9,T=a.length,N=!0,R=[],O=R;if(d)N=!1,_=I7;else if(T>=Ya){var B=u?null:Xd(a);if(B)return g7(B);N=!1,_=Ns,O=new Jw}else O=u?[]:R;e:for(;++g<T;){var V=a[g],Y=u?u(V):V;if(V=d||V!==0?V:0,N&&Y===Y){for(var W=O.length;W--;)if(O[W]===Y)continue e;u&&O.push(Y),R.push(V)}else _(O,Y,d)||(O!==R&&O.push(Y),R.push(V))}return R}var Ya,Ps,ya=C(()=>{UN(),v9(),_P(),J0(),Jh(),y7(),Ya=200,Ps=$u});function Ts(a){return a&&a.length?Ps(a):[]}var lo,ff=C(()=>{ya(),lo=Ts}),b0=C(()=>{lf(),P7(),wP(),ET(),c8(),_v(),I4(),NP(),p2(),$i(),ff()}),RNe=Z((a,u)=>{var d;u.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:D0):g=>(d||(d=Promise.resolve())).then(g).catch(_=>setTimeout(()=>{throw _},0))}),INe=Z(a=>{var u=Symbol.for("react.element"),d=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),R=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),V=Symbol.for("react.memo"),Y=Symbol.for("react.lazy"),W=Symbol.iterator;function $(De){return De===null||typeof De!="object"?null:(De=W&&De[W]||De["@@iterator"],typeof De=="function"?De:null)}var K={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},J=Object.assign,oe={};function ae(De,at,$t){this.props=De,this.context=at,this.refs=oe,this.updater=$t||K}ae.prototype.isReactComponent={},ae.prototype.setState=function(De,at){if(typeof De!="object"&&typeof De!="function"&&De!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,De,at,"setState")},ae.prototype.forceUpdate=function(De){this.updater.enqueueForceUpdate(this,De,"forceUpdate")};function ue(){}ue.prototype=ae.prototype;function xe(De,at,$t){this.props=De,this.context=at,this.refs=oe,this.updater=$t||K}var Re=xe.prototype=new ue;Re.constructor=xe,J(Re,ae.prototype),Re.isPureReactComponent=!0;var Ae=Array.isArray,we=Object.prototype.hasOwnProperty,ft={current:null},Le={key:!0,ref:!0,__self:!0,__source:!0};function Se(De,at,$t){var Qt,Et={},Te=null,vt=null;if(at!=null)for(Qt in at.ref!==void 0&&(vt=at.ref),at.key!==void 0&&(Te=""+at.key),at)we.call(at,Qt)&&!Le.hasOwnProperty(Qt)&&(Et[Qt]=at[Qt]);var Mt=arguments.length-2;if(Mt===1)Et.children=$t;else if(1<Mt){for(var En=Array(Mt),pr=0;pr<Mt;pr++)En[pr]=arguments[pr+2];Et.children=En}if(De&&De.defaultProps)for(Qt in Mt=De.defaultProps,Mt)Et[Qt]===void 0&&(Et[Qt]=Mt[Qt]);return{$$typeof:u,type:De,key:Te,ref:vt,props:Et,_owner:ft.current}}function Ge(De,at){return{$$typeof:u,type:De.type,key:at,ref:De.ref,props:De.props,_owner:De._owner}}function Je(De){return typeof De=="object"&&De!==null&&De.$$typeof===u}function He(De){var at={"=":"=0",":":"=2"};return"$"+De.replace(/[=:]/g,function($t){return at[$t]})}var Bt=/\/+/g;function Qe(De,at){return typeof De=="object"&&De!==null&&De.key!=null?He(""+De.key):at.toString(36)}function Zt(De,at,$t,Qt,Et){var Te=typeof De;(Te==="undefined"||Te==="boolean")&&(De=null);var vt=!1;if(De===null)vt=!0;else switch(Te){case"string":case"number":vt=!0;break;case"object":switch(De.$$typeof){case u:case d:vt=!0}}if(vt)return vt=De,Et=Et(vt),De=Qt===""?"."+Qe(vt,0):Qt,Ae(Et)?($t="",De!=null&&($t=De.replace(Bt,"$&/")+"/"),Zt(Et,at,$t,"",function(pr){return pr})):Et!=null&&(Je(Et)&&(Et=Ge(Et,$t+(!Et.key||vt&&vt.key===Et.key?"":(""+Et.key).replace(Bt,"$&/")+"/")+De)),at.push(Et)),1;if(vt=0,Qt=Qt===""?".":Qt+":",Ae(De))for(var Mt=0;Mt<De.length;Mt++){Te=De[Mt];var En=Qt+Qe(Te,Mt);vt+=Zt(Te,at,$t,En,Et)}else if(En=$(De),typeof En=="function")for(De=En.call(De),Mt=0;!(Te=De.next()).done;)Te=Te.value,En=Qt+Qe(Te,Mt++),vt+=Zt(Te,at,$t,En,Et);else if(Te==="object")throw at=String(De),Error("Objects are not valid as a React child (found: "+(at==="[object Object]"?"object with keys {"+Object.keys(De).join(", ")+"}":at)+"). If you meant to render a collection of children, use an array instead.");return vt}function gt(De,at,$t){if(De==null)return De;var Qt=[],Et=0;return Zt(De,Qt,"","",function(Te){return at.call($t,Te,Et++)}),Qt}function it(De){if(De._status===-1){var at=De._result;at=at(),at.then(function($t){(De._status===0||De._status===-1)&&(De._status=1,De._result=$t)},function($t){(De._status===0||De._status===-1)&&(De._status=2,De._result=$t)}),De._status===-1&&(De._status=0,De._result=at)}if(De._status===1)return De._result.default;throw De._result}var Ce={current:null},ut={transition:null},kt={ReactCurrentDispatcher:Ce,ReactCurrentBatchConfig:ut,ReactCurrentOwner:ft};a.Children={map:gt,forEach:function(De,at,$t){gt(De,function(){at.apply(this,arguments)},$t)},count:function(De){var at=0;return gt(De,function(){at++}),at},toArray:function(De){return gt(De,function(at){return at})||[]},only:function(De){if(!Je(De))throw Error("React.Children.only expected to receive a single React element child.");return De}},a.Component=ae,a.Fragment=g,a.Profiler=T,a.PureComponent=xe,a.StrictMode=_,a.Suspense=B,a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kt,a.cloneElement=function(De,at,$t){if(De==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+De+".");var Qt=J({},De.props),Et=De.key,Te=De.ref,vt=De._owner;if(at!=null){if(at.ref!==void 0&&(Te=at.ref,vt=ft.current),at.key!==void 0&&(Et=""+at.key),De.type&&De.type.defaultProps)var Mt=De.type.defaultProps;for(En in at)we.call(at,En)&&!Le.hasOwnProperty(En)&&(Qt[En]=at[En]===void 0&&Mt!==void 0?Mt[En]:at[En])}var En=arguments.length-2;if(En===1)Qt.children=$t;else if(1<En){Mt=Array(En);for(var pr=0;pr<En;pr++)Mt[pr]=arguments[pr+2];Qt.children=Mt}return{$$typeof:u,type:De.type,key:Et,ref:Te,props:Qt,_owner:vt}},a.createContext=function(De){return De={$$typeof:R,_currentValue:De,_currentValue2:De,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},De.Provider={$$typeof:N,_context:De},De.Consumer=De},a.createElement=Se,a.createFactory=function(De){var at=Se.bind(null,De);return at.type=De,at},a.createRef=function(){return{current:null}},a.forwardRef=function(De){return{$$typeof:O,render:De}},a.isValidElement=Je,a.lazy=function(De){return{$$typeof:Y,_payload:{_status:-1,_result:De},_init:it}},a.memo=function(De,at){return{$$typeof:V,type:De,compare:at===void 0?null:at}},a.startTransition=function(De){var at=ut.transition;ut.transition={};try{De()}finally{ut.transition=at}},a.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},a.useCallback=function(De,at){return Ce.current.useCallback(De,at)},a.useContext=function(De){return Ce.current.useContext(De)},a.useDebugValue=function(){},a.useDeferredValue=function(De){return Ce.current.useDeferredValue(De)},a.useEffect=function(De,at){return Ce.current.useEffect(De,at)},a.useId=function(){return Ce.current.useId()},a.useImperativeHandle=function(De,at,$t){return Ce.current.useImperativeHandle(De,at,$t)},a.useInsertionEffect=function(De,at){return Ce.current.useInsertionEffect(De,at)},a.useLayoutEffect=function(De,at){return Ce.current.useLayoutEffect(De,at)},a.useMemo=function(De,at){return Ce.current.useMemo(De,at)},a.useReducer=function(De,at,$t){return Ce.current.useReducer(De,at,$t)},a.useRef=function(De){return Ce.current.useRef(De)},a.useState=function(De){return Ce.current.useState(De)},a.useSyncExternalStore=function(De,at,$t){return Ce.current.useSyncExternalStore(De,at,$t)},a.useTransition=function(){return Ce.current.useTransition()},a.version="18.2.0"}),nt=Z((a,u)=>{u.exports=INe()}),kNe=Z(a=>{function u(Ce,ut){var kt=Ce.length;Ce.push(ut);e:for(;0<kt;){var De=kt-1>>>1,at=Ce[De];if(0<_(at,ut))Ce[De]=ut,Ce[kt]=at,kt=De;else break e}}function d(Ce){return Ce.length===0?null:Ce[0]}function g(Ce){if(Ce.length===0)return null;var ut=Ce[0],kt=Ce.pop();if(kt!==ut){Ce[0]=kt;e:for(var De=0,at=Ce.length,$t=at>>>1;De<$t;){var Qt=2*(De+1)-1,Et=Ce[Qt],Te=Qt+1,vt=Ce[Te];if(0>_(Et,kt))Te<at&&0>_(vt,Et)?(Ce[De]=vt,Ce[Te]=kt,De=Te):(Ce[De]=Et,Ce[Qt]=kt,De=Qt);else if(Te<at&&0>_(vt,kt))Ce[De]=vt,Ce[Te]=kt,De=Te;else break e}}return ut}function _(Ce,ut){var kt=Ce.sortIndex-ut.sortIndex;return kt!==0?kt:Ce.id-ut.id}typeof performance=="object"&&typeof performance.now=="function"?(T=performance,a.unstable_now=function(){return T.now()}):(N=Date,R=N.now(),a.unstable_now=function(){return N.now()-R});var T,N,R,O=[],B=[],V=1,Y=null,W=3,$=!1,K=!1,J=!1,oe=typeof setTimeout=="function"?setTimeout:null,ae=typeof clearTimeout=="function"?clearTimeout:null,ue=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function xe(Ce){for(var ut=d(B);ut!==null;){if(ut.callback===null)g(B);else if(ut.startTime<=Ce)g(B),ut.sortIndex=ut.expirationTime,u(O,ut);else break;ut=d(B)}}function Re(Ce){if(J=!1,xe(Ce),!K)if(d(O)!==null)K=!0,gt(Ae);else{var ut=d(B);ut!==null&&it(Re,ut.startTime-Ce)}}function Ae(Ce,ut){K=!1,J&&(J=!1,ae(Le),Le=-1),$=!0;var kt=W;try{for(xe(ut),Y=d(O);Y!==null&&(!(Y.expirationTime>ut)||Ce&&!Je());){var De=Y.callback;if(typeof De=="function"){Y.callback=null,W=Y.priorityLevel;var at=De(Y.expirationTime<=ut);ut=a.unstable_now(),typeof at=="function"?Y.callback=at:Y===d(O)&&g(O),xe(ut)}else g(O);Y=d(O)}if(Y!==null)var $t=!0;else{var Qt=d(B);Qt!==null&&it(Re,Qt.startTime-ut),$t=!1}return $t}finally{Y=null,W=kt,$=!1}}var we=!1,ft=null,Le=-1,Se=5,Ge=-1;function Je(){return!(a.unstable_now()-Ge<Se)}function He(){if(ft!==null){var Ce=a.unstable_now();Ge=Ce;var ut=!0;try{ut=ft(!0,Ce)}finally{ut?Bt():(we=!1,ft=null)}}else we=!1}var Bt;typeof ue=="function"?Bt=function(){ue(He)}:typeof MessageChannel<"u"?(Qe=new MessageChannel,Zt=Qe.port2,Qe.port1.onmessage=He,Bt=function(){Zt.postMessage(null)}):Bt=function(){oe(He,0)};var Qe,Zt;function gt(Ce){ft=Ce,we||(we=!0,Bt())}function it(Ce,ut){Le=oe(function(){Ce(a.unstable_now())},ut)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(Ce){Ce.callback=null},a.unstable_continueExecution=function(){K||$||(K=!0,gt(Ae))},a.unstable_forceFrameRate=function(Ce){0>Ce||125<Ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Se=0<Ce?Math.floor(1e3/Ce):5},a.unstable_getCurrentPriorityLevel=function(){return W},a.unstable_getFirstCallbackNode=function(){return d(O)},a.unstable_next=function(Ce){switch(W){case 1:case 2:case 3:var ut=3;break;default:ut=W}var kt=W;W=ut;try{return Ce()}finally{W=kt}},a.unstable_pauseExecution=function(){},a.unstable_requestPaint=function(){},a.unstable_runWithPriority=function(Ce,ut){switch(Ce){case 1:case 2:case 3:case 4:case 5:break;default:Ce=3}var kt=W;W=Ce;try{return ut()}finally{W=kt}},a.unstable_scheduleCallback=function(Ce,ut,kt){var De=a.unstable_now();switch(typeof kt=="object"&&kt!==null?(kt=kt.delay,kt=typeof kt=="number"&&0<kt?De+kt:De):kt=De,Ce){case 1:var at=-1;break;case 2:at=250;break;case 5:at=1073741823;break;case 4:at=1e4;break;default:at=5e3}return at=kt+at,Ce={id:V++,callback:ut,priorityLevel:Ce,startTime:kt,expirationTime:at,sortIndex:-1},kt>De?(Ce.sortIndex=kt,u(B,Ce),d(O)===null&&Ce===d(B)&&(J?(ae(Le),Le=-1):J=!0,it(Re,kt-De))):(Ce.sortIndex=at,u(O,Ce),K||$||(K=!0,gt(Ae))),Ce},a.unstable_shouldYield=Je,a.unstable_wrapCallback=function(Ce){var ut=W;return function(){var kt=W;W=ut;try{return Ce.apply(this,arguments)}finally{W=kt}}}}),DNe=Z((a,u)=>{u.exports=kNe()}),ONe=Z(a=>{var u=nt(),d=DNe();function g(f){for(var x="https://reactjs.org/docs/error-decoder.html?invariant="+f,M=1;M<arguments.length;M++)x+="&args[]="+encodeURIComponent(arguments[M]);return"Minified React error #"+f+"; visit "+x+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var _=new Set,T={};function N(f,x){R(f,x),R(f+"Capture",x)}function R(f,x){for(T[f]=x,f=0;f<x.length;f++)_.add(x[f])}var O=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),B=Object.prototype.hasOwnProperty,V=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Y={},W={};function $(f){return B.call(W,f)?!0:B.call(Y,f)?!1:V.test(f)?W[f]=!0:(Y[f]=!0,!1)}function K(f,x,M,F){if(M!==null&&M.type===0)return!1;switch(typeof x){case"function":case"symbol":return!0;case"boolean":return F?!1:M!==null?!M.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function J(f,x,M,F){if(x===null||typeof x>"u"||K(f,x,M,F))return!0;if(F)return!1;if(M!==null)switch(M.type){case 3:return!x;case 4:return x===!1;case 5:return isNaN(x);case 6:return isNaN(x)||1>x}return!1}function oe(f,x,M,F,X,te,fe){this.acceptsBooleans=x===2||x===3||x===4,this.attributeName=F,this.attributeNamespace=X,this.mustUseProperty=M,this.propertyName=f,this.type=x,this.sanitizeURL=te,this.removeEmptyString=fe}var ae={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){ae[f]=new oe(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var x=f[0];ae[x]=new oe(x,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){ae[f]=new oe(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){ae[f]=new oe(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){ae[f]=new oe(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){ae[f]=new oe(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){ae[f]=new oe(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){ae[f]=new oe(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){ae[f]=new oe(f,5,!1,f.toLowerCase(),null,!1,!1)});var ue=/[\-:]([a-z])/g;function xe(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var x=f.replace(ue,xe);ae[x]=new oe(x,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var x=f.replace(ue,xe);ae[x]=new oe(x,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var x=f.replace(ue,xe);ae[x]=new oe(x,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){ae[f]=new oe(f,1,!1,f.toLowerCase(),null,!1,!1)}),ae.xlinkHref=new oe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){ae[f]=new oe(f,1,!1,f.toLowerCase(),null,!0,!0)});function Re(f,x,M,F){var X=ae.hasOwnProperty(x)?ae[x]:null;(X!==null?X.type!==0:F||!(2<x.length)||x[0]!=="o"&&x[0]!=="O"||x[1]!=="n"&&x[1]!=="N")&&(J(x,M,X,F)&&(M=null),F||X===null?$(x)&&(M===null?f.removeAttribute(x):f.setAttribute(x,""+M)):X.mustUseProperty?f[X.propertyName]=M===null?X.type===3?!1:"":M:(x=X.attributeName,F=X.attributeNamespace,M===null?f.removeAttribute(x):(X=X.type,M=X===3||X===4&&M===!0?"":""+M,F?f.setAttributeNS(F,x,M):f.setAttribute(x,M))))}var Ae=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,we=Symbol.for("react.element"),ft=Symbol.for("react.portal"),Le=Symbol.for("react.fragment"),Se=Symbol.for("react.strict_mode"),Ge=Symbol.for("react.profiler"),Je=Symbol.for("react.provider"),He=Symbol.for("react.context"),Bt=Symbol.for("react.forward_ref"),Qe=Symbol.for("react.suspense"),Zt=Symbol.for("react.suspense_list"),gt=Symbol.for("react.memo"),it=Symbol.for("react.lazy"),Ce=Symbol.for("react.offscreen"),ut=Symbol.iterator;function kt(f){return f===null||typeof f!="object"?null:(f=ut&&f[ut]||f["@@iterator"],typeof f=="function"?f:null)}var De=Object.assign,at;function $t(f){if(at===void 0)try{throw Error()}catch(M){var x=M.stack.trim().match(/\n( *(at )?)/);at=x&&x[1]||""}return`
`+at+f}var Qt=!1;function Et(f,x){if(!f||Qt)return"";Qt=!0;var M=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(x)if(x=function(){throw Error()},Object.defineProperty(x.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(x,[])}catch(Ot){var F=Ot}Reflect.construct(f,[],x)}else{try{x.call()}catch(Ot){F=Ot}f.call(x.prototype)}else{try{throw Error()}catch(Ot){F=Ot}f()}}catch(Ot){if(Ot&&F&&typeof Ot.stack=="string"){for(var X=Ot.stack.split(`
`),te=F.stack.split(`
`),fe=X.length-1,Be=te.length-1;1<=fe&&0<=Be&&X[fe]!==te[Be];)Be--;for(;1<=fe&&0<=Be;fe--,Be--)if(X[fe]!==te[Be]){if(fe!==1||Be!==1)do if(fe--,Be--,0>Be||X[fe]!==te[Be]){var rt=`
`+X[fe].replace(" at new "," at ");return f.displayName&&rt.includes("<anonymous>")&&(rt=rt.replace("<anonymous>",f.displayName)),rt}while(1<=fe&&0<=Be);break}}}finally{Qt=!1,Error.prepareStackTrace=M}return(f=f?f.displayName||f.name:"")?$t(f):""}function Te(f){switch(f.tag){case 5:return $t(f.type);case 16:return $t("Lazy");case 13:return $t("Suspense");case 19:return $t("SuspenseList");case 0:case 2:case 15:return f=Et(f.type,!1),f;case 11:return f=Et(f.type.render,!1),f;case 1:return f=Et(f.type,!0),f;default:return""}}function vt(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case Le:return"Fragment";case ft:return"Portal";case Ge:return"Profiler";case Se:return"StrictMode";case Qe:return"Suspense";case Zt:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case He:return(f.displayName||"Context")+".Consumer";case Je:return(f._context.displayName||"Context")+".Provider";case Bt:var x=f.render;return f=f.displayName,f||(f=x.displayName||x.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case gt:return x=f.displayName||null,x!==null?x:vt(f.type)||"Memo";case it:x=f._payload,f=f._init;try{return vt(f(x))}catch{}}return null}function Mt(f){var x=f.type;switch(f.tag){case 24:return"Cache";case 9:return(x.displayName||"Context")+".Consumer";case 10:return(x._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=x.render,f=f.displayName||f.name||"",x.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return x;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return vt(x);case 8:return x===Se?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x}return null}function En(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function pr(f){var x=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(x==="checkbox"||x==="radio")}function wr(f){var x=pr(f)?"checked":"value",M=Object.getOwnPropertyDescriptor(f.constructor.prototype,x),F=""+f[x];if(!f.hasOwnProperty(x)&&typeof M<"u"&&typeof M.get=="function"&&typeof M.set=="function"){var X=M.get,te=M.set;return Object.defineProperty(f,x,{configurable:!0,get:function(){return X.call(this)},set:function(fe){F=""+fe,te.call(this,fe)}}),Object.defineProperty(f,x,{enumerable:M.enumerable}),{getValue:function(){return F},setValue:function(fe){F=""+fe},stopTracking:function(){f._valueTracker=null,delete f[x]}}}}function Or(f){f._valueTracker||(f._valueTracker=wr(f))}function Ei(f){if(!f)return!1;var x=f._valueTracker;if(!x)return!0;var M=x.getValue(),F="";return f&&(F=pr(f)?f.checked?"true":"false":f.value),f=F,f!==M?(x.setValue(f),!0):!1}function Vs(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function li(f,x){var M=x.checked;return De({},x,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:M??f._wrapperState.initialChecked})}function Mo(f,x){var M=x.defaultValue==null?"":x.defaultValue,F=x.checked!=null?x.checked:x.defaultChecked;M=En(x.value!=null?x.value:M),f._wrapperState={initialChecked:F,initialValue:M,controlled:x.type==="checkbox"||x.type==="radio"?x.checked!=null:x.value!=null}}function Si(f,x){x=x.checked,x!=null&&Re(f,"checked",x,!1)}function Ri(f,x){Si(f,x);var M=En(x.value),F=x.type;if(M!=null)F==="number"?(M===0&&f.value===""||f.value!=M)&&(f.value=""+M):f.value!==""+M&&(f.value=""+M);else if(F==="submit"||F==="reset"){f.removeAttribute("value");return}x.hasOwnProperty("value")?ea(f,x.type,M):x.hasOwnProperty("defaultValue")&&ea(f,x.type,En(x.defaultValue)),x.checked==null&&x.defaultChecked!=null&&(f.defaultChecked=!!x.defaultChecked)}function Wl(f,x,M){if(x.hasOwnProperty("value")||x.hasOwnProperty("defaultValue")){var F=x.type;if(!(F!=="submit"&&F!=="reset"||x.value!==void 0&&x.value!==null))return;x=""+f._wrapperState.initialValue,M||x===f.value||(f.value=x),f.defaultValue=x}M=f.name,M!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,M!==""&&(f.name=M)}function ea(f,x,M){(x!=="number"||Vs(f.ownerDocument)!==f)&&(M==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+M&&(f.defaultValue=""+M))}var op=Array.isArray;function ed(f,x,M,F){if(f=f.options,x){x={};for(var X=0;X<M.length;X++)x["$"+M[X]]=!0;for(M=0;M<f.length;M++)X=x.hasOwnProperty("$"+f[M].value),f[M].selected!==X&&(f[M].selected=X),X&&F&&(f[M].defaultSelected=!0)}else{for(M=""+En(M),x=null,X=0;X<f.length;X++){if(f[X].value===M){f[X].selected=!0,F&&(f[X].defaultSelected=!0);return}x!==null||f[X].disabled||(x=f[X])}x!==null&&(x.selected=!0)}}function ql(f,x){if(x.dangerouslySetInnerHTML!=null)throw Error(g(91));return De({},x,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function ei(f,x){var M=x.value;if(M==null){if(M=x.children,x=x.defaultValue,M!=null){if(x!=null)throw Error(g(92));if(op(M)){if(1<M.length)throw Error(g(93));M=M[0]}x=M}x==null&&(x=""),M=x}f._wrapperState={initialValue:En(M)}}function yi(f,x){var M=En(x.value),F=En(x.defaultValue);M!=null&&(M=""+M,M!==f.value&&(f.value=M),x.defaultValue==null&&f.defaultValue!==M&&(f.defaultValue=M)),F!=null&&(f.defaultValue=""+F)}function d3(f){var x=f.textContent;x===f._wrapperState.initialValue&&x!==""&&x!==null&&(f.value=x)}function Bb(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ap(f,x){return f==null||f==="http://www.w3.org/1999/xhtml"?Bb(x):f==="http://www.w3.org/2000/svg"&&x==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var Dk,jye=function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(x,M,F,X){MSApp.execUnsafeLocalFunction(function(){return f(x,M,F,X)})}:f}(function(f,x){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=x;else{for(Dk=Dk||document.createElement("div"),Dk.innerHTML="<svg>"+x.valueOf().toString()+"</svg>",x=Dk.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;x.firstChild;)f.appendChild(x.firstChild)}});function ZE(f,x){if(x){var M=f.firstChild;if(M&&M===f.lastChild&&M.nodeType===3){M.nodeValue=x;return}}f.textContent=x}var QE={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$Be=["Webkit","ms","Moz","O"];Object.keys(QE).forEach(function(f){$Be.forEach(function(x){x=x+f.charAt(0).toUpperCase()+f.substring(1),QE[x]=QE[f]})});function Hye(f,x,M){return x==null||typeof x=="boolean"||x===""?"":M||typeof x!="number"||x===0||QE.hasOwnProperty(f)&&QE[f]?(""+x).trim():x+"px"}function $ye(f,x){f=f.style;for(var M in x)if(x.hasOwnProperty(M)){var F=M.indexOf("--")===0,X=Hye(M,x[M],F);M==="float"&&(M="cssFloat"),F?f.setProperty(M,X):f[M]=X}}var WBe=De({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function i$(f,x){if(x){if(WBe[f]&&(x.children!=null||x.dangerouslySetInnerHTML!=null))throw Error(g(137,f));if(x.dangerouslySetInnerHTML!=null){if(x.children!=null)throw Error(g(60));if(typeof x.dangerouslySetInnerHTML!="object"||!("__html"in x.dangerouslySetInnerHTML))throw Error(g(61))}if(x.style!=null&&typeof x.style!="object")throw Error(g(62))}}function s$(f,x){if(f.indexOf("-")===-1)return typeof x.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var o$=null;function a$(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var l$=null,Ub=null,zb=null;function Wye(f){if(f=xM(f)){if(typeof l$!="function")throw Error(g(280));var x=f.stateNode;x&&(x=oD(x),l$(f.stateNode,f.type,x))}}function qye(f){Ub?zb?zb.push(f):zb=[f]:Ub=f}function Xye(){if(Ub){var f=Ub,x=zb;if(zb=Ub=null,Wye(f),x)for(f=0;f<x.length;f++)Wye(x[f])}}function Yye(f,x){return f(x)}function Kye(){}var c$=!1;function Zye(f,x,M){if(c$)return f(x,M);c$=!0;try{return Yye(f,x,M)}finally{c$=!1,(Ub!==null||zb!==null)&&(Kye(),Xye())}}function JE(f,x){var M=f.stateNode;if(M===null)return null;var F=oD(M);if(F===null)return null;M=F[x];e:switch(x){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(F=!F.disabled)||(f=f.type,F=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!F;break e;default:f=!1}if(f)return null;if(M&&typeof M!="function")throw Error(g(231,x,typeof M));return M}var u$=!1;if(O)try{Vb={},Object.defineProperty(Vb,"passive",{get:function(){u$=!0}}),window.addEventListener("test",Vb,Vb),window.removeEventListener("test",Vb,Vb)}catch{u$=!1}var Vb;function qBe(f,x,M,F,X,te,fe,Be,rt){var Ot=Array.prototype.slice.call(arguments,3);try{x.apply(M,Ot)}catch(mn){this.onError(mn)}}var eM=!1,Ok=null,Lk=!1,d$=null,XBe={onError:function(f){eM=!0,Ok=f}};function YBe(f,x,M,F,X,te,fe,Be,rt){eM=!1,Ok=null,qBe.apply(XBe,arguments)}function KBe(f,x,M,F,X,te,fe,Be,rt){if(YBe.apply(this,arguments),eM){if(eM){var Ot=Ok;eM=!1,Ok=null}else throw Error(g(198));Lk||(Lk=!0,d$=Ot)}}function J8(f){var x=f,M=f;if(f.alternate)for(;x.return;)x=x.return;else{f=x;do x=f,x.flags&4098&&(M=x.return),f=x.return;while(f)}return x.tag===3?M:null}function Qye(f){if(f.tag===13){var x=f.memoizedState;if(x===null&&(f=f.alternate,f!==null&&(x=f.memoizedState)),x!==null)return x.dehydrated}return null}function Jye(f){if(J8(f)!==f)throw Error(g(188))}function ZBe(f){var x=f.alternate;if(!x){if(x=J8(f),x===null)throw Error(g(188));return x!==f?null:f}for(var M=f,F=x;;){var X=M.return;if(X===null)break;var te=X.alternate;if(te===null){if(F=X.return,F!==null){M=F;continue}break}if(X.child===te.child){for(te=X.child;te;){if(te===M)return Jye(X),f;if(te===F)return Jye(X),x;te=te.sibling}throw Error(g(188))}if(M.return!==F.return)M=X,F=te;else{for(var fe=!1,Be=X.child;Be;){if(Be===M){fe=!0,M=X,F=te;break}if(Be===F){fe=!0,F=X,M=te;break}Be=Be.sibling}if(!fe){for(Be=te.child;Be;){if(Be===M){fe=!0,M=te,F=X;break}if(Be===F){fe=!0,F=te,M=X;break}Be=Be.sibling}if(!fe)throw Error(g(189))}}if(M.alternate!==F)throw Error(g(190))}if(M.tag!==3)throw Error(g(188));return M.stateNode.current===M?f:x}function e5e(f){return f=ZBe(f),f!==null?t5e(f):null}function t5e(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var x=t5e(f);if(x!==null)return x;f=f.sibling}return null}var n5e=d.unstable_scheduleCallback,r5e=d.unstable_cancelCallback,QBe=d.unstable_shouldYield,JBe=d.unstable_requestPaint,La=d.unstable_now,eUe=d.unstable_getCurrentPriorityLevel,h$=d.unstable_ImmediatePriority,i5e=d.unstable_UserBlockingPriority,Fk=d.unstable_NormalPriority,tUe=d.unstable_LowPriority,s5e=d.unstable_IdlePriority,Bk=null,z1=null;function nUe(f){if(z1&&typeof z1.onCommitFiberRoot=="function")try{z1.onCommitFiberRoot(Bk,f,void 0,(f.current.flags&128)===128)}catch{}}var Bf=Math.clz32?Math.clz32:sUe,rUe=Math.log,iUe=Math.LN2;function sUe(f){return f>>>=0,f===0?32:31-(rUe(f)/iUe|0)|0}var Uk=64,zk=4194304;function tM(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function Vk(f,x){var M=f.pendingLanes;if(M===0)return 0;var F=0,X=f.suspendedLanes,te=f.pingedLanes,fe=M&268435455;if(fe!==0){var Be=fe&~X;Be!==0?F=tM(Be):(te&=fe,te!==0&&(F=tM(te)))}else fe=M&~X,fe!==0?F=tM(fe):te!==0&&(F=tM(te));if(F===0)return 0;if(x!==0&&x!==F&&!(x&X)&&(X=F&-F,te=x&-x,X>=te||X===16&&(te&4194240)!==0))return x;if(F&4&&(F|=M&16),x=f.entangledLanes,x!==0)for(f=f.entanglements,x&=F;0<x;)M=31-Bf(x),X=1<<M,F|=f[M],x&=~X;return F}function oUe(f,x){switch(f){case 1:case 2:case 4:return x+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function aUe(f,x){for(var M=f.suspendedLanes,F=f.pingedLanes,X=f.expirationTimes,te=f.pendingLanes;0<te;){var fe=31-Bf(te),Be=1<<fe,rt=X[fe];rt===-1?(!(Be&M)||Be&F)&&(X[fe]=oUe(Be,x)):rt<=x&&(f.expiredLanes|=Be),te&=~Be}}function p$(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function o5e(){var f=Uk;return Uk<<=1,!(Uk&4194240)&&(Uk=64),f}function f$(f){for(var x=[],M=0;31>M;M++)x.push(f);return x}function nM(f,x,M){f.pendingLanes|=x,x!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,x=31-Bf(x),f[x]=M}function lUe(f,x){var M=f.pendingLanes&~x;f.pendingLanes=x,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=x,f.mutableReadLanes&=x,f.entangledLanes&=x,x=f.entanglements;var F=f.eventTimes;for(f=f.expirationTimes;0<M;){var X=31-Bf(M),te=1<<X;x[X]=0,F[X]=-1,f[X]=-1,M&=~te}}function m$(f,x){var M=f.entangledLanes|=x;for(f=f.entanglements;M;){var F=31-Bf(M),X=1<<F;X&x|f[F]&x&&(f[F]|=x),M&=~X}}var Gs=0;function a5e(f){return f&=-f,1<f?4<f?f&268435455?16:536870912:4:1}var l5e,g$,c5e,u5e,d5e,y$=!1,Gk=[],ry=null,iy=null,sy=null,rM=new Map,iM=new Map,oy=[],cUe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function h5e(f,x){switch(f){case"focusin":case"focusout":ry=null;break;case"dragenter":case"dragleave":iy=null;break;case"mouseover":case"mouseout":sy=null;break;case"pointerover":case"pointerout":rM.delete(x.pointerId);break;case"gotpointercapture":case"lostpointercapture":iM.delete(x.pointerId)}}function sM(f,x,M,F,X,te){return f===null||f.nativeEvent!==te?(f={blockedOn:x,domEventName:M,eventSystemFlags:F,nativeEvent:te,targetContainers:[X]},x!==null&&(x=xM(x),x!==null&&g$(x)),f):(f.eventSystemFlags|=F,x=f.targetContainers,X!==null&&x.indexOf(X)===-1&&x.push(X),f)}function uUe(f,x,M,F,X){switch(x){case"focusin":return ry=sM(ry,f,x,M,F,X),!0;case"dragenter":return iy=sM(iy,f,x,M,F,X),!0;case"mouseover":return sy=sM(sy,f,x,M,F,X),!0;case"pointerover":var te=X.pointerId;return rM.set(te,sM(rM.get(te)||null,f,x,M,F,X)),!0;case"gotpointercapture":return te=X.pointerId,iM.set(te,sM(iM.get(te)||null,f,x,M,F,X)),!0}return!1}function p5e(f){var x=e6(f.target);if(x!==null){var M=J8(x);if(M!==null){if(x=M.tag,x===13){if(x=Qye(M),x!==null){f.blockedOn=x,d5e(f.priority,function(){c5e(M)});return}}else if(x===3&&M.stateNode.current.memoizedState.isDehydrated){f.blockedOn=M.tag===3?M.stateNode.containerInfo:null;return}}}f.blockedOn=null}function jk(f){if(f.blockedOn!==null)return!1;for(var x=f.targetContainers;0<x.length;){var M=x$(f.domEventName,f.eventSystemFlags,x[0],f.nativeEvent);if(M===null){M=f.nativeEvent;var F=new M.constructor(M.type,M);o$=F,M.target.dispatchEvent(F),o$=null}else return x=xM(M),x!==null&&g$(x),f.blockedOn=M,!1;x.shift()}return!0}function f5e(f,x,M){jk(f)&&M.delete(x)}function dUe(){y$=!1,ry!==null&&jk(ry)&&(ry=null),iy!==null&&jk(iy)&&(iy=null),sy!==null&&jk(sy)&&(sy=null),rM.forEach(f5e),iM.forEach(f5e)}function oM(f,x){f.blockedOn===x&&(f.blockedOn=null,y$||(y$=!0,d.unstable_scheduleCallback(d.unstable_NormalPriority,dUe)))}function aM(f){function x(X){return oM(X,f)}if(0<Gk.length){oM(Gk[0],f);for(var M=1;M<Gk.length;M++){var F=Gk[M];F.blockedOn===f&&(F.blockedOn=null)}}for(ry!==null&&oM(ry,f),iy!==null&&oM(iy,f),sy!==null&&oM(sy,f),rM.forEach(x),iM.forEach(x),M=0;M<oy.length;M++)F=oy[M],F.blockedOn===f&&(F.blockedOn=null);for(;0<oy.length&&(M=oy[0],M.blockedOn===null);)p5e(M),M.blockedOn===null&&oy.shift()}var Gb=Ae.ReactCurrentBatchConfig,Hk=!0;function hUe(f,x,M,F){var X=Gs,te=Gb.transition;Gb.transition=null;try{Gs=1,v$(f,x,M,F)}finally{Gs=X,Gb.transition=te}}function pUe(f,x,M,F){var X=Gs,te=Gb.transition;Gb.transition=null;try{Gs=4,v$(f,x,M,F)}finally{Gs=X,Gb.transition=te}}function v$(f,x,M,F){if(Hk){var X=x$(f,x,M,F);if(X===null)D$(f,x,F,$k,M),h5e(f,F);else if(uUe(X,f,x,M,F))F.stopPropagation();else if(h5e(f,F),x&4&&-1<cUe.indexOf(f)){for(;X!==null;){var te=xM(X);if(te!==null&&l5e(te),te=x$(f,x,M,F),te===null&&D$(f,x,F,$k,M),te===X)break;X=te}X!==null&&F.stopPropagation()}else D$(f,x,F,null,M)}}var $k=null;function x$(f,x,M,F){if($k=null,f=a$(F),f=e6(f),f!==null)if(x=J8(f),x===null)f=null;else if(M=x.tag,M===13){if(f=Qye(x),f!==null)return f;f=null}else if(M===3){if(x.stateNode.current.memoizedState.isDehydrated)return x.tag===3?x.stateNode.containerInfo:null;f=null}else x!==f&&(f=null);return $k=f,null}function m5e(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(eUe()){case h$:return 1;case i5e:return 4;case Fk:case tUe:return 16;case s5e:return 536870912;default:return 16}default:return 16}}var ay=null,b$=null,Wk=null;function g5e(){if(Wk)return Wk;var f,x=b$,M=x.length,F,X="value"in ay?ay.value:ay.textContent,te=X.length;for(f=0;f<M&&x[f]===X[f];f++);var fe=M-f;for(F=1;F<=fe&&x[M-F]===X[te-F];F++);return Wk=X.slice(f,1<F?1-F:void 0)}function qk(f){var x=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&x===13&&(f=13)):f=x,f===10&&(f=13),32<=f||f===13?f:0}function Xk(){return!0}function y5e(){return!1}function th(f){function x(M,F,X,te,fe){this._reactName=M,this._targetInst=X,this.type=F,this.nativeEvent=te,this.target=fe,this.currentTarget=null;for(var Be in f)f.hasOwnProperty(Be)&&(M=f[Be],this[Be]=M?M(te):te[Be]);return this.isDefaultPrevented=(te.defaultPrevented!=null?te.defaultPrevented:te.returnValue===!1)?Xk:y5e,this.isPropagationStopped=y5e,this}return De(x.prototype,{preventDefault:function(){this.defaultPrevented=!0;var M=this.nativeEvent;M&&(M.preventDefault?M.preventDefault():typeof M.returnValue!="unknown"&&(M.returnValue=!1),this.isDefaultPrevented=Xk)},stopPropagation:function(){var M=this.nativeEvent;M&&(M.stopPropagation?M.stopPropagation():typeof M.cancelBubble!="unknown"&&(M.cancelBubble=!0),this.isPropagationStopped=Xk)},persist:function(){},isPersistent:Xk}),x}var jb={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_$=th(jb),lM=De({},jb,{view:0,detail:0}),fUe=th(lM),S$,w$,cM,Yk=De({},lM,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:E$,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==cM&&(cM&&f.type==="mousemove"?(S$=f.screenX-cM.screenX,w$=f.screenY-cM.screenY):w$=S$=0,cM=f),S$)},movementY:function(f){return"movementY"in f?f.movementY:w$}}),v5e=th(Yk),mUe=De({},Yk,{dataTransfer:0}),gUe=th(mUe),yUe=De({},lM,{relatedTarget:0}),T$=th(yUe),vUe=De({},jb,{animationName:0,elapsedTime:0,pseudoElement:0}),xUe=th(vUe),bUe=De({},jb,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),_Ue=th(bUe),SUe=De({},jb,{data:0}),x5e=th(SUe),wUe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},TUe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},EUe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function MUe(f){var x=this.nativeEvent;return x.getModifierState?x.getModifierState(f):(f=EUe[f])?!!x[f]:!1}function E$(){return MUe}var CUe=De({},lM,{key:function(f){if(f.key){var x=wUe[f.key]||f.key;if(x!=="Unidentified")return x}return f.type==="keypress"?(f=qk(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?TUe[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:E$,charCode:function(f){return f.type==="keypress"?qk(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?qk(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),AUe=th(CUe),NUe=De({},Yk,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),b5e=th(NUe),PUe=De({},lM,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:E$}),RUe=th(PUe),IUe=De({},jb,{propertyName:0,elapsedTime:0,pseudoElement:0}),kUe=th(IUe),DUe=De({},Yk,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),OUe=th(DUe),LUe=[9,13,27,32],M$=O&&"CompositionEvent"in window,uM=null;O&&"documentMode"in document&&(uM=document.documentMode);var FUe=O&&"TextEvent"in window&&!uM,_5e=O&&(!M$||uM&&8<uM&&11>=uM),S5e=" ",w5e=!1;function T5e(f,x){switch(f){case"keyup":return LUe.indexOf(x.keyCode)!==-1;case"keydown":return x.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function E5e(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var Hb=!1;function BUe(f,x){switch(f){case"compositionend":return E5e(x);case"keypress":return x.which!==32?null:(w5e=!0,S5e);case"textInput":return f=x.data,f===S5e&&w5e?null:f;default:return null}}function UUe(f,x){if(Hb)return f==="compositionend"||!M$&&T5e(f,x)?(f=g5e(),Wk=b$=ay=null,Hb=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(x.ctrlKey||x.altKey||x.metaKey)||x.ctrlKey&&x.altKey){if(x.char&&1<x.char.length)return x.char;if(x.which)return String.fromCharCode(x.which)}return null;case"compositionend":return _5e&&x.locale!=="ko"?null:x.data;default:return null}}var zUe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function M5e(f){var x=f&&f.nodeName&&f.nodeName.toLowerCase();return x==="input"?!!zUe[f.type]:x==="textarea"}function C5e(f,x,M,F){qye(F),x=rD(x,"onChange"),0<x.length&&(M=new _$("onChange","change",null,M,F),f.push({event:M,listeners:x}))}var dM=null,hM=null;function VUe(f){W5e(f,0)}function Kk(f){var x=Yb(f);if(Ei(x))return f}function GUe(f,x){if(f==="change")return x}var A5e=!1;O&&(O?(Zk="oninput"in document,Zk||(A$=document.createElement("div"),A$.setAttribute("oninput","return;"),Zk=typeof A$.oninput=="function"),C$=Zk):C$=!1,A5e=C$&&(!document.documentMode||9<document.documentMode));var C$,Zk,A$;function N5e(){dM&&(dM.detachEvent("onpropertychange",P5e),hM=dM=null)}function P5e(f){if(f.propertyName==="value"&&Kk(hM)){var x=[];C5e(x,hM,f,a$(f)),Zye(VUe,x)}}function jUe(f,x,M){f==="focusin"?(N5e(),dM=x,hM=M,dM.attachEvent("onpropertychange",P5e)):f==="focusout"&&N5e()}function HUe(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return Kk(hM)}function $Ue(f,x){if(f==="click")return Kk(x)}function WUe(f,x){if(f==="input"||f==="change")return Kk(x)}function qUe(f,x){return f===x&&(f!==0||1/f===1/x)||f!==f&&x!==x}var Uf=typeof Object.is=="function"?Object.is:qUe;function pM(f,x){if(Uf(f,x))return!0;if(typeof f!="object"||f===null||typeof x!="object"||x===null)return!1;var M=Object.keys(f),F=Object.keys(x);if(M.length!==F.length)return!1;for(F=0;F<M.length;F++){var X=M[F];if(!B.call(x,X)||!Uf(f[X],x[X]))return!1}return!0}function R5e(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function I5e(f,x){var M=R5e(f);f=0;for(var F;M;){if(M.nodeType===3){if(F=f+M.textContent.length,f<=x&&F>=x)return{node:M,offset:x-f};f=F}e:{for(;M;){if(M.nextSibling){M=M.nextSibling;break e}M=M.parentNode}M=void 0}M=R5e(M)}}function k5e(f,x){return f&&x?f===x?!0:f&&f.nodeType===3?!1:x&&x.nodeType===3?k5e(f,x.parentNode):"contains"in f?f.contains(x):f.compareDocumentPosition?!!(f.compareDocumentPosition(x)&16):!1:!1}function D5e(){for(var f=window,x=Vs();x instanceof f.HTMLIFrameElement;){try{var M=typeof x.contentWindow.location.href=="string"}catch{M=!1}if(M)f=x.contentWindow;else break;x=Vs(f.document)}return x}function N$(f){var x=f&&f.nodeName&&f.nodeName.toLowerCase();return x&&(x==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||x==="textarea"||f.contentEditable==="true")}function XUe(f){var x=D5e(),M=f.focusedElem,F=f.selectionRange;if(x!==M&&M&&M.ownerDocument&&k5e(M.ownerDocument.documentElement,M)){if(F!==null&&N$(M)){if(x=F.start,f=F.end,f===void 0&&(f=x),"selectionStart"in M)M.selectionStart=x,M.selectionEnd=Math.min(f,M.value.length);else if(f=(x=M.ownerDocument||document)&&x.defaultView||window,f.getSelection){f=f.getSelection();var X=M.textContent.length,te=Math.min(F.start,X);F=F.end===void 0?te:Math.min(F.end,X),!f.extend&&te>F&&(X=F,F=te,te=X),X=I5e(M,te);var fe=I5e(M,F);X&&fe&&(f.rangeCount!==1||f.anchorNode!==X.node||f.anchorOffset!==X.offset||f.focusNode!==fe.node||f.focusOffset!==fe.offset)&&(x=x.createRange(),x.setStart(X.node,X.offset),f.removeAllRanges(),te>F?(f.addRange(x),f.extend(fe.node,fe.offset)):(x.setEnd(fe.node,fe.offset),f.addRange(x)))}}for(x=[],f=M;f=f.parentNode;)f.nodeType===1&&x.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof M.focus=="function"&&M.focus(),M=0;M<x.length;M++)f=x[M],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var YUe=O&&"documentMode"in document&&11>=document.documentMode,$b=null,P$=null,fM=null,R$=!1;function O5e(f,x,M){var F=M.window===M?M.document:M.nodeType===9?M:M.ownerDocument;R$||$b==null||$b!==Vs(F)||(F=$b,"selectionStart"in F&&N$(F)?F={start:F.selectionStart,end:F.selectionEnd}:(F=(F.ownerDocument&&F.ownerDocument.defaultView||window).getSelection(),F={anchorNode:F.anchorNode,anchorOffset:F.anchorOffset,focusNode:F.focusNode,focusOffset:F.focusOffset}),fM&&pM(fM,F)||(fM=F,F=rD(P$,"onSelect"),0<F.length&&(x=new _$("onSelect","select",null,x,M),f.push({event:x,listeners:F}),x.target=$b)))}function Qk(f,x){var M={};return M[f.toLowerCase()]=x.toLowerCase(),M["Webkit"+f]="webkit"+x,M["Moz"+f]="moz"+x,M}var Wb={animationend:Qk("Animation","AnimationEnd"),animationiteration:Qk("Animation","AnimationIteration"),animationstart:Qk("Animation","AnimationStart"),transitionend:Qk("Transition","TransitionEnd")},I$={},L5e={};O&&(L5e=document.createElement("div").style,"AnimationEvent"in window||(delete Wb.animationend.animation,delete Wb.animationiteration.animation,delete Wb.animationstart.animation),"TransitionEvent"in window||delete Wb.transitionend.transition);function Jk(f){if(I$[f])return I$[f];if(!Wb[f])return f;var x=Wb[f],M;for(M in x)if(x.hasOwnProperty(M)&&M in L5e)return I$[f]=x[M];return f}var F5e=Jk("animationend"),B5e=Jk("animationiteration"),U5e=Jk("animationstart"),z5e=Jk("transitionend"),V5e=new Map,G5e="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ly(f,x){V5e.set(f,x),N(x,[f])}for(tD=0;tD<G5e.length;tD++)eD=G5e[tD],j5e=eD.toLowerCase(),H5e=eD[0].toUpperCase()+eD.slice(1),ly(j5e,"on"+H5e);var eD,j5e,H5e,tD;ly(F5e,"onAnimationEnd"),ly(B5e,"onAnimationIteration"),ly(U5e,"onAnimationStart"),ly("dblclick","onDoubleClick"),ly("focusin","onFocus"),ly("focusout","onBlur"),ly(z5e,"onTransitionEnd"),R("onMouseEnter",["mouseout","mouseover"]),R("onMouseLeave",["mouseout","mouseover"]),R("onPointerEnter",["pointerout","pointerover"]),R("onPointerLeave",["pointerout","pointerover"]),N("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),N("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),N("onBeforeInput",["compositionend","keypress","textInput","paste"]),N("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),N("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),N("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mM="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),KUe=new Set("cancel close invalid load scroll toggle".split(" ").concat(mM));function $5e(f,x,M){var F=f.type||"unknown-event";f.currentTarget=M,KBe(F,x,void 0,f),f.currentTarget=null}function W5e(f,x){x=(x&4)!==0;for(var M=0;M<f.length;M++){var F=f[M],X=F.event;F=F.listeners;e:{var te=void 0;if(x)for(var fe=F.length-1;0<=fe;fe--){var Be=F[fe],rt=Be.instance,Ot=Be.currentTarget;if(Be=Be.listener,rt!==te&&X.isPropagationStopped())break e;$5e(X,Be,Ot),te=rt}else for(fe=0;fe<F.length;fe++){if(Be=F[fe],rt=Be.instance,Ot=Be.currentTarget,Be=Be.listener,rt!==te&&X.isPropagationStopped())break e;$5e(X,Be,Ot),te=rt}}}if(Lk)throw f=d$,Lk=!1,d$=null,f}function Co(f,x){var M=x[z$];M===void 0&&(M=x[z$]=new Set);var F=f+"__bubble";M.has(F)||(q5e(x,f,2,!1),M.add(F))}function k$(f,x,M){var F=0;x&&(F|=4),q5e(M,f,F,x)}var nD="_reactListening"+Math.random().toString(36).slice(2);function gM(f){if(!f[nD]){f[nD]=!0,_.forEach(function(M){M!=="selectionchange"&&(KUe.has(M)||k$(M,!1,f),k$(M,!0,f))});var x=f.nodeType===9?f:f.ownerDocument;x===null||x[nD]||(x[nD]=!0,k$("selectionchange",!1,x))}}function q5e(f,x,M,F){switch(m5e(x)){case 1:var X=hUe;break;case 4:X=pUe;break;default:X=v$}M=X.bind(null,x,M,f),X=void 0,!u$||x!=="touchstart"&&x!=="touchmove"&&x!=="wheel"||(X=!0),F?X!==void 0?f.addEventListener(x,M,{capture:!0,passive:X}):f.addEventListener(x,M,!0):X!==void 0?f.addEventListener(x,M,{passive:X}):f.addEventListener(x,M,!1)}function D$(f,x,M,F,X){var te=F;if(!(x&1)&&!(x&2)&&F!==null)e:for(;;){if(F===null)return;var fe=F.tag;if(fe===3||fe===4){var Be=F.stateNode.containerInfo;if(Be===X||Be.nodeType===8&&Be.parentNode===X)break;if(fe===4)for(fe=F.return;fe!==null;){var rt=fe.tag;if((rt===3||rt===4)&&(rt=fe.stateNode.containerInfo,rt===X||rt.nodeType===8&&rt.parentNode===X))return;fe=fe.return}for(;Be!==null;){if(fe=e6(Be),fe===null)return;if(rt=fe.tag,rt===5||rt===6){F=te=fe;continue e}Be=Be.parentNode}}F=F.return}Zye(function(){var Ot=te,mn=a$(M),xn=[];e:{var hn=V5e.get(f);if(hn!==void 0){var rr=_$,br=f;switch(f){case"keypress":if(qk(M)===0)break e;case"keydown":case"keyup":rr=AUe;break;case"focusin":br="focus",rr=T$;break;case"focusout":br="blur",rr=T$;break;case"beforeblur":case"afterblur":rr=T$;break;case"click":if(M.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":rr=v5e;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":rr=gUe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":rr=RUe;break;case F5e:case B5e:case U5e:rr=xUe;break;case z5e:rr=kUe;break;case"scroll":rr=fUe;break;case"wheel":rr=OUe;break;case"copy":case"cut":case"paste":rr=_Ue;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":rr=b5e}var Sr=(x&4)!==0,Fa=!Sr&&f==="scroll",Tt=Sr?hn!==null?hn+"Capture":null:hn;Sr=[];for(var dt=Ot,Nt;dt!==null;){Nt=dt;var Mn=Nt.stateNode;if(Nt.tag===5&&Mn!==null&&(Nt=Mn,Tt!==null&&(Mn=JE(dt,Tt),Mn!=null&&Sr.push(yM(dt,Mn,Nt)))),Fa)break;dt=dt.return}0<Sr.length&&(hn=new rr(hn,br,null,M,mn),xn.push({event:hn,listeners:Sr}))}}if(!(x&7)){e:{if(hn=f==="mouseover"||f==="pointerover",rr=f==="mouseout"||f==="pointerout",hn&&M!==o$&&(br=M.relatedTarget||M.fromElement)&&(e6(br)||br[h3]))break e;if((rr||hn)&&(hn=mn.window===mn?mn:(hn=mn.ownerDocument)?hn.defaultView||hn.parentWindow:window,rr?(br=M.relatedTarget||M.toElement,rr=Ot,br=br?e6(br):null,br!==null&&(Fa=J8(br),br!==Fa||br.tag!==5&&br.tag!==6)&&(br=null)):(rr=null,br=Ot),rr!==br)){if(Sr=v5e,Mn="onMouseLeave",Tt="onMouseEnter",dt="mouse",(f==="pointerout"||f==="pointerover")&&(Sr=b5e,Mn="onPointerLeave",Tt="onPointerEnter",dt="pointer"),Fa=rr==null?hn:Yb(rr),Nt=br==null?hn:Yb(br),hn=new Sr(Mn,dt+"leave",rr,M,mn),hn.target=Fa,hn.relatedTarget=Nt,Mn=null,e6(mn)===Ot&&(Sr=new Sr(Tt,dt+"enter",br,M,mn),Sr.target=Nt,Sr.relatedTarget=Fa,Mn=Sr),Fa=Mn,rr&&br)t:{for(Sr=rr,Tt=br,dt=0,Nt=Sr;Nt;Nt=qb(Nt))dt++;for(Nt=0,Mn=Tt;Mn;Mn=qb(Mn))Nt++;for(;0<dt-Nt;)Sr=qb(Sr),dt--;for(;0<Nt-dt;)Tt=qb(Tt),Nt--;for(;dt--;){if(Sr===Tt||Tt!==null&&Sr===Tt.alternate)break t;Sr=qb(Sr),Tt=qb(Tt)}Sr=null}else Sr=null;rr!==null&&X5e(xn,hn,rr,Sr,!1),br!==null&&Fa!==null&&X5e(xn,Fa,br,Sr,!0)}}e:{if(hn=Ot?Yb(Ot):window,rr=hn.nodeName&&hn.nodeName.toLowerCase(),rr==="select"||rr==="input"&&hn.type==="file")var Mr=GUe;else if(M5e(hn))if(A5e)Mr=WUe;else{Mr=HUe;var Hr=jUe}else(rr=hn.nodeName)&&rr.toLowerCase()==="input"&&(hn.type==="checkbox"||hn.type==="radio")&&(Mr=$Ue);if(Mr&&(Mr=Mr(f,Ot))){C5e(xn,Mr,M,mn);break e}Hr&&Hr(f,hn,Ot),f==="focusout"&&(Hr=hn._wrapperState)&&Hr.controlled&&hn.type==="number"&&ea(hn,"number",hn.value)}switch(Hr=Ot?Yb(Ot):window,f){case"focusin":(M5e(Hr)||Hr.contentEditable==="true")&&($b=Hr,P$=Ot,fM=null);break;case"focusout":fM=P$=$b=null;break;case"mousedown":R$=!0;break;case"contextmenu":case"mouseup":case"dragend":R$=!1,O5e(xn,M,mn);break;case"selectionchange":if(YUe)break;case"keydown":case"keyup":O5e(xn,M,mn)}var $r;if(M$)e:{switch(f){case"compositionstart":var si="onCompositionStart";break e;case"compositionend":si="onCompositionEnd";break e;case"compositionupdate":si="onCompositionUpdate";break e}si=void 0}else Hb?T5e(f,M)&&(si="onCompositionEnd"):f==="keydown"&&M.keyCode===229&&(si="onCompositionStart");si&&(_5e&&M.locale!=="ko"&&(Hb||si!=="onCompositionStart"?si==="onCompositionEnd"&&Hb&&($r=g5e()):(ay=mn,b$="value"in ay?ay.value:ay.textContent,Hb=!0)),Hr=rD(Ot,si),0<Hr.length&&(si=new x5e(si,f,null,M,mn),xn.push({event:si,listeners:Hr}),$r?si.data=$r:($r=E5e(M),$r!==null&&(si.data=$r)))),($r=FUe?BUe(f,M):UUe(f,M))&&(Ot=rD(Ot,"onBeforeInput"),0<Ot.length&&(mn=new x5e("onBeforeInput","beforeinput",null,M,mn),xn.push({event:mn,listeners:Ot}),mn.data=$r))}W5e(xn,x)})}function yM(f,x,M){return{instance:f,listener:x,currentTarget:M}}function rD(f,x){for(var M=x+"Capture",F=[];f!==null;){var X=f,te=X.stateNode;X.tag===5&&te!==null&&(X=te,te=JE(f,M),te!=null&&F.unshift(yM(f,te,X)),te=JE(f,x),te!=null&&F.push(yM(f,te,X))),f=f.return}return F}function qb(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function X5e(f,x,M,F,X){for(var te=x._reactName,fe=[];M!==null&&M!==F;){var Be=M,rt=Be.alternate,Ot=Be.stateNode;if(rt!==null&&rt===F)break;Be.tag===5&&Ot!==null&&(Be=Ot,X?(rt=JE(M,te),rt!=null&&fe.unshift(yM(M,rt,Be))):X||(rt=JE(M,te),rt!=null&&fe.push(yM(M,rt,Be)))),M=M.return}fe.length!==0&&f.push({event:x,listeners:fe})}var ZUe=/\r\n?/g,QUe=/\u0000|\uFFFD/g;function Y5e(f){return(typeof f=="string"?f:""+f).replace(ZUe,`
`).replace(QUe,"")}function iD(f,x,M){if(x=Y5e(x),Y5e(f)!==x&&M)throw Error(g(425))}function sD(){}var O$=null,L$=null;function F$(f,x){return f==="textarea"||f==="noscript"||typeof x.children=="string"||typeof x.children=="number"||typeof x.dangerouslySetInnerHTML=="object"&&x.dangerouslySetInnerHTML!==null&&x.dangerouslySetInnerHTML.__html!=null}var B$=typeof setTimeout=="function"?setTimeout:void 0,JUe=typeof clearTimeout=="function"?clearTimeout:void 0,K5e=typeof Promise=="function"?Promise:void 0,eze=typeof queueMicrotask=="function"?queueMicrotask:typeof K5e<"u"?function(f){return K5e.resolve(null).then(f).catch(tze)}:B$;function tze(f){setTimeout(function(){throw f})}function U$(f,x){var M=x,F=0;do{var X=M.nextSibling;if(f.removeChild(M),X&&X.nodeType===8)if(M=X.data,M==="/$"){if(F===0){f.removeChild(X),aM(x);return}F--}else M!=="$"&&M!=="$?"&&M!=="$!"||F++;M=X}while(M);aM(x)}function cy(f){for(;f!=null;f=f.nextSibling){var x=f.nodeType;if(x===1||x===3)break;if(x===8){if(x=f.data,x==="$"||x==="$!"||x==="$?")break;if(x==="/$")return null}}return f}function Z5e(f){f=f.previousSibling;for(var x=0;f;){if(f.nodeType===8){var M=f.data;if(M==="$"||M==="$!"||M==="$?"){if(x===0)return f;x--}else M==="/$"&&x++}f=f.previousSibling}return null}var Xb=Math.random().toString(36).slice(2),V1="__reactFiber$"+Xb,vM="__reactProps$"+Xb,h3="__reactContainer$"+Xb,z$="__reactEvents$"+Xb,nze="__reactListeners$"+Xb,rze="__reactHandles$"+Xb;function e6(f){var x=f[V1];if(x)return x;for(var M=f.parentNode;M;){if(x=M[h3]||M[V1]){if(M=x.alternate,x.child!==null||M!==null&&M.child!==null)for(f=Z5e(f);f!==null;){if(M=f[V1])return M;f=Z5e(f)}return x}f=M,M=f.parentNode}return null}function xM(f){return f=f[V1]||f[h3],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function Yb(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(g(33))}function oD(f){return f[vM]||null}var V$=[],Kb=-1;function uy(f){return{current:f}}function Ao(f){0>Kb||(f.current=V$[Kb],V$[Kb]=null,Kb--)}function ho(f,x){Kb++,V$[Kb]=f.current,f.current=x}var dy={},hc=uy(dy),td=uy(!1),t6=dy;function Zb(f,x){var M=f.type.contextTypes;if(!M)return dy;var F=f.stateNode;if(F&&F.__reactInternalMemoizedUnmaskedChildContext===x)return F.__reactInternalMemoizedMaskedChildContext;var X={},te;for(te in M)X[te]=x[te];return F&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=x,f.__reactInternalMemoizedMaskedChildContext=X),X}function nd(f){return f=f.childContextTypes,f!=null}function aD(){Ao(td),Ao(hc)}function Q5e(f,x,M){if(hc.current!==dy)throw Error(g(168));ho(hc,x),ho(td,M)}function J5e(f,x,M){var F=f.stateNode;if(x=x.childContextTypes,typeof F.getChildContext!="function")return M;F=F.getChildContext();for(var X in F)if(!(X in x))throw Error(g(108,Mt(f)||"Unknown",X));return De({},M,F)}function lD(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||dy,t6=hc.current,ho(hc,f),ho(td,td.current),!0}function eve(f,x,M){var F=f.stateNode;if(!F)throw Error(g(169));M?(f=J5e(f,x,t6),F.__reactInternalMemoizedMergedChildContext=f,Ao(td),Ao(hc),ho(hc,f)):Ao(td),ho(td,M)}var p3=null,cD=!1,G$=!1;function tve(f){p3===null?p3=[f]:p3.push(f)}function ize(f){cD=!0,tve(f)}function hy(){if(!G$&&p3!==null){G$=!0;var f=0,x=Gs;try{var M=p3;for(Gs=1;f<M.length;f++){var F=M[f];do F=F(!0);while(F!==null)}p3=null,cD=!1}catch(X){throw p3!==null&&(p3=p3.slice(f+1)),n5e(h$,hy),X}finally{Gs=x,G$=!1}}return null}var Qb=[],Jb=0,uD=null,dD=0,lp=[],cp=0,n6=null,f3=1,m3="";function r6(f,x){Qb[Jb++]=dD,Qb[Jb++]=uD,uD=f,dD=x}function nve(f,x,M){lp[cp++]=f3,lp[cp++]=m3,lp[cp++]=n6,n6=f;var F=f3;f=m3;var X=32-Bf(F)-1;F&=~(1<<X),M+=1;var te=32-Bf(x)+X;if(30<te){var fe=X-X%5;te=(F&(1<<fe)-1).toString(32),F>>=fe,X-=fe,f3=1<<32-Bf(x)+X|M<<X|F,m3=te+f}else f3=1<<te|M<<X|F,m3=f}function j$(f){f.return!==null&&(r6(f,1),nve(f,1,0))}function H$(f){for(;f===uD;)uD=Qb[--Jb],Qb[Jb]=null,dD=Qb[--Jb],Qb[Jb]=null;for(;f===n6;)n6=lp[--cp],lp[cp]=null,m3=lp[--cp],lp[cp]=null,f3=lp[--cp],lp[cp]=null}var nh=null,rh=null,Fo=!1,zf=null;function rve(f,x){var M=pp(5,null,null,0);M.elementType="DELETED",M.stateNode=x,M.return=f,x=f.deletions,x===null?(f.deletions=[M],f.flags|=16):x.push(M)}function ive(f,x){switch(f.tag){case 5:var M=f.type;return x=x.nodeType!==1||M.toLowerCase()!==x.nodeName.toLowerCase()?null:x,x!==null?(f.stateNode=x,nh=f,rh=cy(x.firstChild),!0):!1;case 6:return x=f.pendingProps===""||x.nodeType!==3?null:x,x!==null?(f.stateNode=x,nh=f,rh=null,!0):!1;case 13:return x=x.nodeType!==8?null:x,x!==null?(M=n6!==null?{id:f3,overflow:m3}:null,f.memoizedState={dehydrated:x,treeContext:M,retryLane:1073741824},M=pp(18,null,null,0),M.stateNode=x,M.return=f,f.child=M,nh=f,rh=null,!0):!1;default:return!1}}function $$(f){return(f.mode&1)!==0&&(f.flags&128)===0}function W$(f){if(Fo){var x=rh;if(x){var M=x;if(!ive(f,x)){if($$(f))throw Error(g(418));x=cy(M.nextSibling);var F=nh;x&&ive(f,x)?rve(F,M):(f.flags=f.flags&-4097|2,Fo=!1,nh=f)}}else{if($$(f))throw Error(g(418));f.flags=f.flags&-4097|2,Fo=!1,nh=f}}}function sve(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;nh=f}function hD(f){if(f!==nh)return!1;if(!Fo)return sve(f),Fo=!0,!1;var x;if((x=f.tag!==3)&&!(x=f.tag!==5)&&(x=f.type,x=x!=="head"&&x!=="body"&&!F$(f.type,f.memoizedProps)),x&&(x=rh)){if($$(f))throw ove(),Error(g(418));for(;x;)rve(f,x),x=cy(x.nextSibling)}if(sve(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(g(317));e:{for(f=f.nextSibling,x=0;f;){if(f.nodeType===8){var M=f.data;if(M==="/$"){if(x===0){rh=cy(f.nextSibling);break e}x--}else M!=="$"&&M!=="$!"&&M!=="$?"||x++}f=f.nextSibling}rh=null}}else rh=nh?cy(f.stateNode.nextSibling):null;return!0}function ove(){for(var f=rh;f;)f=cy(f.nextSibling)}function e_(){rh=nh=null,Fo=!1}function q$(f){zf===null?zf=[f]:zf.push(f)}var sze=Ae.ReactCurrentBatchConfig;function Vf(f,x){if(f&&f.defaultProps){x=De({},x),f=f.defaultProps;for(var M in f)x[M]===void 0&&(x[M]=f[M]);return x}return x}var pD=uy(null),fD=null,t_=null,X$=null;function Y$(){X$=t_=fD=null}function K$(f){var x=pD.current;Ao(pD),f._currentValue=x}function Z$(f,x,M){for(;f!==null;){var F=f.alternate;if((f.childLanes&x)!==x?(f.childLanes|=x,F!==null&&(F.childLanes|=x)):F!==null&&(F.childLanes&x)!==x&&(F.childLanes|=x),f===M)break;f=f.return}}function n_(f,x){fD=f,X$=t_=null,f=f.dependencies,f!==null&&f.firstContext!==null&&(f.lanes&x&&(rd=!0),f.firstContext=null)}function up(f){var x=f._currentValue;if(X$!==f)if(f={context:f,memoizedValue:x,next:null},t_===null){if(fD===null)throw Error(g(308));t_=f,fD.dependencies={lanes:0,firstContext:f}}else t_=t_.next=f;return x}var i6=null;function Q$(f){i6===null?i6=[f]:i6.push(f)}function ave(f,x,M,F){var X=x.interleaved;return X===null?(M.next=M,Q$(x)):(M.next=X.next,X.next=M),x.interleaved=M,g3(f,F)}function g3(f,x){f.lanes|=x;var M=f.alternate;for(M!==null&&(M.lanes|=x),M=f,f=f.return;f!==null;)f.childLanes|=x,M=f.alternate,M!==null&&(M.childLanes|=x),M=f,f=f.return;return M.tag===3?M.stateNode:null}var py=!1;function J$(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lve(f,x){f=f.updateQueue,x.updateQueue===f&&(x.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function y3(f,x){return{eventTime:f,lane:x,tag:0,payload:null,callback:null,next:null}}function fy(f,x,M){var F=f.updateQueue;if(F===null)return null;if(F=F.shared,cs&2){var X=F.pending;return X===null?x.next=x:(x.next=X.next,X.next=x),F.pending=x,g3(f,M)}return X=F.interleaved,X===null?(x.next=x,Q$(F)):(x.next=X.next,X.next=x),F.interleaved=x,g3(f,M)}function mD(f,x,M){if(x=x.updateQueue,x!==null&&(x=x.shared,(M&4194240)!==0)){var F=x.lanes;F&=f.pendingLanes,M|=F,x.lanes=M,m$(f,M)}}function cve(f,x){var M=f.updateQueue,F=f.alternate;if(F!==null&&(F=F.updateQueue,M===F)){var X=null,te=null;if(M=M.firstBaseUpdate,M!==null){do{var fe={eventTime:M.eventTime,lane:M.lane,tag:M.tag,payload:M.payload,callback:M.callback,next:null};te===null?X=te=fe:te=te.next=fe,M=M.next}while(M!==null);te===null?X=te=x:te=te.next=x}else X=te=x;M={baseState:F.baseState,firstBaseUpdate:X,lastBaseUpdate:te,shared:F.shared,effects:F.effects},f.updateQueue=M;return}f=M.lastBaseUpdate,f===null?M.firstBaseUpdate=x:f.next=x,M.lastBaseUpdate=x}function gD(f,x,M,F){var X=f.updateQueue;py=!1;var te=X.firstBaseUpdate,fe=X.lastBaseUpdate,Be=X.shared.pending;if(Be!==null){X.shared.pending=null;var rt=Be,Ot=rt.next;rt.next=null,fe===null?te=Ot:fe.next=Ot,fe=rt;var mn=f.alternate;mn!==null&&(mn=mn.updateQueue,Be=mn.lastBaseUpdate,Be!==fe&&(Be===null?mn.firstBaseUpdate=Ot:Be.next=Ot,mn.lastBaseUpdate=rt))}if(te!==null){var xn=X.baseState;fe=0,mn=Ot=rt=null,Be=te;do{var hn=Be.lane,rr=Be.eventTime;if((F&hn)===hn){mn!==null&&(mn=mn.next={eventTime:rr,lane:0,tag:Be.tag,payload:Be.payload,callback:Be.callback,next:null});e:{var br=f,Sr=Be;switch(hn=x,rr=M,Sr.tag){case 1:if(br=Sr.payload,typeof br=="function"){xn=br.call(rr,xn,hn);break e}xn=br;break e;case 3:br.flags=br.flags&-65537|128;case 0:if(br=Sr.payload,hn=typeof br=="function"?br.call(rr,xn,hn):br,hn==null)break e;xn=De({},xn,hn);break e;case 2:py=!0}}Be.callback!==null&&Be.lane!==0&&(f.flags|=64,hn=X.effects,hn===null?X.effects=[Be]:hn.push(Be))}else rr={eventTime:rr,lane:hn,tag:Be.tag,payload:Be.payload,callback:Be.callback,next:null},mn===null?(Ot=mn=rr,rt=xn):mn=mn.next=rr,fe|=hn;if(Be=Be.next,Be===null){if(Be=X.shared.pending,Be===null)break;hn=Be,Be=hn.next,hn.next=null,X.lastBaseUpdate=hn,X.shared.pending=null}}while(!0);if(mn===null&&(rt=xn),X.baseState=rt,X.firstBaseUpdate=Ot,X.lastBaseUpdate=mn,x=X.shared.interleaved,x!==null){X=x;do fe|=X.lane,X=X.next;while(X!==x)}else te===null&&(X.shared.lanes=0);a6|=fe,f.lanes=fe,f.memoizedState=xn}}function uve(f,x,M){if(f=x.effects,x.effects=null,f!==null)for(x=0;x<f.length;x++){var F=f[x],X=F.callback;if(X!==null){if(F.callback=null,F=M,typeof X!="function")throw Error(g(191,X));X.call(F)}}}var dve=new u.Component().refs;function eW(f,x,M,F){x=f.memoizedState,M=M(F,x),M=M==null?x:De({},x,M),f.memoizedState=M,f.lanes===0&&(f.updateQueue.baseState=M)}var yD={isMounted:function(f){return(f=f._reactInternals)?J8(f)===f:!1},enqueueSetState:function(f,x,M){f=f._reactInternals;var F=au(),X=vy(f),te=y3(F,X);te.payload=x,M!=null&&(te.callback=M),x=fy(f,te,X),x!==null&&(Hf(x,f,X,F),mD(x,f,X))},enqueueReplaceState:function(f,x,M){f=f._reactInternals;var F=au(),X=vy(f),te=y3(F,X);te.tag=1,te.payload=x,M!=null&&(te.callback=M),x=fy(f,te,X),x!==null&&(Hf(x,f,X,F),mD(x,f,X))},enqueueForceUpdate:function(f,x){f=f._reactInternals;var M=au(),F=vy(f),X=y3(M,F);X.tag=2,x!=null&&(X.callback=x),x=fy(f,X,F),x!==null&&(Hf(x,f,F,M),mD(x,f,F))}};function hve(f,x,M,F,X,te,fe){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(F,te,fe):x.prototype&&x.prototype.isPureReactComponent?!pM(M,F)||!pM(X,te):!0}function pve(f,x,M){var F=!1,X=dy,te=x.contextType;return typeof te=="object"&&te!==null?te=up(te):(X=nd(x)?t6:hc.current,F=x.contextTypes,te=(F=F!=null)?Zb(f,X):dy),x=new x(M,te),f.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=yD,f.stateNode=x,x._reactInternals=f,F&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=X,f.__reactInternalMemoizedMaskedChildContext=te),x}function fve(f,x,M,F){f=x.state,typeof x.componentWillReceiveProps=="function"&&x.componentWillReceiveProps(M,F),typeof x.UNSAFE_componentWillReceiveProps=="function"&&x.UNSAFE_componentWillReceiveProps(M,F),x.state!==f&&yD.enqueueReplaceState(x,x.state,null)}function tW(f,x,M,F){var X=f.stateNode;X.props=M,X.state=f.memoizedState,X.refs=dve,J$(f);var te=x.contextType;typeof te=="object"&&te!==null?X.context=up(te):(te=nd(x)?t6:hc.current,X.context=Zb(f,te)),X.state=f.memoizedState,te=x.getDerivedStateFromProps,typeof te=="function"&&(eW(f,x,te,M),X.state=f.memoizedState),typeof x.getDerivedStateFromProps=="function"||typeof X.getSnapshotBeforeUpdate=="function"||typeof X.UNSAFE_componentWillMount!="function"&&typeof X.componentWillMount!="function"||(x=X.state,typeof X.componentWillMount=="function"&&X.componentWillMount(),typeof X.UNSAFE_componentWillMount=="function"&&X.UNSAFE_componentWillMount(),x!==X.state&&yD.enqueueReplaceState(X,X.state,null),gD(f,M,X,F),X.state=f.memoizedState),typeof X.componentDidMount=="function"&&(f.flags|=4194308)}function bM(f,x,M){if(f=M.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(M._owner){if(M=M._owner,M){if(M.tag!==1)throw Error(g(309));var F=M.stateNode}if(!F)throw Error(g(147,f));var X=F,te=""+f;return x!==null&&x.ref!==null&&typeof x.ref=="function"&&x.ref._stringRef===te?x.ref:(x=function(fe){var Be=X.refs;Be===dve&&(Be=X.refs={}),fe===null?delete Be[te]:Be[te]=fe},x._stringRef=te,x)}if(typeof f!="string")throw Error(g(284));if(!M._owner)throw Error(g(290,f))}return f}function vD(f,x){throw f=Object.prototype.toString.call(x),Error(g(31,f==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":f))}function mve(f){var x=f._init;return x(f._payload)}function gve(f){function x(Tt,dt){if(f){var Nt=Tt.deletions;Nt===null?(Tt.deletions=[dt],Tt.flags|=16):Nt.push(dt)}}function M(Tt,dt){if(!f)return null;for(;dt!==null;)x(Tt,dt),dt=dt.sibling;return null}function F(Tt,dt){for(Tt=new Map;dt!==null;)dt.key!==null?Tt.set(dt.key,dt):Tt.set(dt.index,dt),dt=dt.sibling;return Tt}function X(Tt,dt){return Tt=by(Tt,dt),Tt.index=0,Tt.sibling=null,Tt}function te(Tt,dt,Nt){return Tt.index=Nt,f?(Nt=Tt.alternate,Nt!==null?(Nt=Nt.index,Nt<dt?(Tt.flags|=2,dt):Nt):(Tt.flags|=2,dt)):(Tt.flags|=1048576,dt)}function fe(Tt){return f&&Tt.alternate===null&&(Tt.flags|=2),Tt}function Be(Tt,dt,Nt,Mn){return dt===null||dt.tag!==6?(dt=FW(Nt,Tt.mode,Mn),dt.return=Tt,dt):(dt=X(dt,Nt),dt.return=Tt,dt)}function rt(Tt,dt,Nt,Mn){var Mr=Nt.type;return Mr===Le?mn(Tt,dt,Nt.props.children,Mn,Nt.key):dt!==null&&(dt.elementType===Mr||typeof Mr=="object"&&Mr!==null&&Mr.$$typeof===it&&mve(Mr)===dt.type)?(Mn=X(dt,Nt.props),Mn.ref=bM(Tt,dt,Nt),Mn.return=Tt,Mn):(Mn=FD(Nt.type,Nt.key,Nt.props,null,Tt.mode,Mn),Mn.ref=bM(Tt,dt,Nt),Mn.return=Tt,Mn)}function Ot(Tt,dt,Nt,Mn){return dt===null||dt.tag!==4||dt.stateNode.containerInfo!==Nt.containerInfo||dt.stateNode.implementation!==Nt.implementation?(dt=BW(Nt,Tt.mode,Mn),dt.return=Tt,dt):(dt=X(dt,Nt.children||[]),dt.return=Tt,dt)}function mn(Tt,dt,Nt,Mn,Mr){return dt===null||dt.tag!==7?(dt=d6(Nt,Tt.mode,Mn,Mr),dt.return=Tt,dt):(dt=X(dt,Nt),dt.return=Tt,dt)}function xn(Tt,dt,Nt){if(typeof dt=="string"&&dt!==""||typeof dt=="number")return dt=FW(""+dt,Tt.mode,Nt),dt.return=Tt,dt;if(typeof dt=="object"&&dt!==null){switch(dt.$$typeof){case we:return Nt=FD(dt.type,dt.key,dt.props,null,Tt.mode,Nt),Nt.ref=bM(Tt,null,dt),Nt.return=Tt,Nt;case ft:return dt=BW(dt,Tt.mode,Nt),dt.return=Tt,dt;case it:var Mn=dt._init;return xn(Tt,Mn(dt._payload),Nt)}if(op(dt)||kt(dt))return dt=d6(dt,Tt.mode,Nt,null),dt.return=Tt,dt;vD(Tt,dt)}return null}function hn(Tt,dt,Nt,Mn){var Mr=dt!==null?dt.key:null;if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return Mr!==null?null:Be(Tt,dt,""+Nt,Mn);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case we:return Nt.key===Mr?rt(Tt,dt,Nt,Mn):null;case ft:return Nt.key===Mr?Ot(Tt,dt,Nt,Mn):null;case it:return Mr=Nt._init,hn(Tt,dt,Mr(Nt._payload),Mn)}if(op(Nt)||kt(Nt))return Mr!==null?null:mn(Tt,dt,Nt,Mn,null);vD(Tt,Nt)}return null}function rr(Tt,dt,Nt,Mn,Mr){if(typeof Mn=="string"&&Mn!==""||typeof Mn=="number")return Tt=Tt.get(Nt)||null,Be(dt,Tt,""+Mn,Mr);if(typeof Mn=="object"&&Mn!==null){switch(Mn.$$typeof){case we:return Tt=Tt.get(Mn.key===null?Nt:Mn.key)||null,rt(dt,Tt,Mn,Mr);case ft:return Tt=Tt.get(Mn.key===null?Nt:Mn.key)||null,Ot(dt,Tt,Mn,Mr);case it:var Hr=Mn._init;return rr(Tt,dt,Nt,Hr(Mn._payload),Mr)}if(op(Mn)||kt(Mn))return Tt=Tt.get(Nt)||null,mn(dt,Tt,Mn,Mr,null);vD(dt,Mn)}return null}function br(Tt,dt,Nt,Mn){for(var Mr=null,Hr=null,$r=dt,si=dt=0,Kl=null;$r!==null&&si<Nt.length;si++){$r.index>si?(Kl=$r,$r=null):Kl=$r.sibling;var gs=hn(Tt,$r,Nt[si],Mn);if(gs===null){$r===null&&($r=Kl);break}f&&$r&&gs.alternate===null&&x(Tt,$r),dt=te(gs,dt,si),Hr===null?Mr=gs:Hr.sibling=gs,Hr=gs,$r=Kl}if(si===Nt.length)return M(Tt,$r),Fo&&r6(Tt,si),Mr;if($r===null){for(;si<Nt.length;si++)$r=xn(Tt,Nt[si],Mn),$r!==null&&(dt=te($r,dt,si),Hr===null?Mr=$r:Hr.sibling=$r,Hr=$r);return Fo&&r6(Tt,si),Mr}for($r=F(Tt,$r);si<Nt.length;si++)Kl=rr($r,Tt,si,Nt[si],Mn),Kl!==null&&(f&&Kl.alternate!==null&&$r.delete(Kl.key===null?si:Kl.key),dt=te(Kl,dt,si),Hr===null?Mr=Kl:Hr.sibling=Kl,Hr=Kl);return f&&$r.forEach(function(_y){return x(Tt,_y)}),Fo&&r6(Tt,si),Mr}function Sr(Tt,dt,Nt,Mn){var Mr=kt(Nt);if(typeof Mr!="function")throw Error(g(150));if(Nt=Mr.call(Nt),Nt==null)throw Error(g(151));for(var Hr=Mr=null,$r=dt,si=dt=0,Kl=null,gs=Nt.next();$r!==null&&!gs.done;si++,gs=Nt.next()){$r.index>si?(Kl=$r,$r=null):Kl=$r.sibling;var _y=hn(Tt,$r,gs.value,Mn);if(_y===null){$r===null&&($r=Kl);break}f&&$r&&_y.alternate===null&&x(Tt,$r),dt=te(_y,dt,si),Hr===null?Mr=_y:Hr.sibling=_y,Hr=_y,$r=Kl}if(gs.done)return M(Tt,$r),Fo&&r6(Tt,si),Mr;if($r===null){for(;!gs.done;si++,gs=Nt.next())gs=xn(Tt,gs.value,Mn),gs!==null&&(dt=te(gs,dt,si),Hr===null?Mr=gs:Hr.sibling=gs,Hr=gs);return Fo&&r6(Tt,si),Mr}for($r=F(Tt,$r);!gs.done;si++,gs=Nt.next())gs=rr($r,Tt,si,gs.value,Mn),gs!==null&&(f&&gs.alternate!==null&&$r.delete(gs.key===null?si:gs.key),dt=te(gs,dt,si),Hr===null?Mr=gs:Hr.sibling=gs,Hr=gs);return f&&$r.forEach(function(Bze){return x(Tt,Bze)}),Fo&&r6(Tt,si),Mr}function Fa(Tt,dt,Nt,Mn){if(typeof Nt=="object"&&Nt!==null&&Nt.type===Le&&Nt.key===null&&(Nt=Nt.props.children),typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case we:e:{for(var Mr=Nt.key,Hr=dt;Hr!==null;){if(Hr.key===Mr){if(Mr=Nt.type,Mr===Le){if(Hr.tag===7){M(Tt,Hr.sibling),dt=X(Hr,Nt.props.children),dt.return=Tt,Tt=dt;break e}}else if(Hr.elementType===Mr||typeof Mr=="object"&&Mr!==null&&Mr.$$typeof===it&&mve(Mr)===Hr.type){M(Tt,Hr.sibling),dt=X(Hr,Nt.props),dt.ref=bM(Tt,Hr,Nt),dt.return=Tt,Tt=dt;break e}M(Tt,Hr);break}else x(Tt,Hr);Hr=Hr.sibling}Nt.type===Le?(dt=d6(Nt.props.children,Tt.mode,Mn,Nt.key),dt.return=Tt,Tt=dt):(Mn=FD(Nt.type,Nt.key,Nt.props,null,Tt.mode,Mn),Mn.ref=bM(Tt,dt,Nt),Mn.return=Tt,Tt=Mn)}return fe(Tt);case ft:e:{for(Hr=Nt.key;dt!==null;){if(dt.key===Hr)if(dt.tag===4&&dt.stateNode.containerInfo===Nt.containerInfo&&dt.stateNode.implementation===Nt.implementation){M(Tt,dt.sibling),dt=X(dt,Nt.children||[]),dt.return=Tt,Tt=dt;break e}else{M(Tt,dt);break}else x(Tt,dt);dt=dt.sibling}dt=BW(Nt,Tt.mode,Mn),dt.return=Tt,Tt=dt}return fe(Tt);case it:return Hr=Nt._init,Fa(Tt,dt,Hr(Nt._payload),Mn)}if(op(Nt))return br(Tt,dt,Nt,Mn);if(kt(Nt))return Sr(Tt,dt,Nt,Mn);vD(Tt,Nt)}return typeof Nt=="string"&&Nt!==""||typeof Nt=="number"?(Nt=""+Nt,dt!==null&&dt.tag===6?(M(Tt,dt.sibling),dt=X(dt,Nt),dt.return=Tt,Tt=dt):(M(Tt,dt),dt=FW(Nt,Tt.mode,Mn),dt.return=Tt,Tt=dt),fe(Tt)):M(Tt,dt)}return Fa}var r_=gve(!0),yve=gve(!1),_M={},G1=uy(_M),SM=uy(_M),wM=uy(_M);function s6(f){if(f===_M)throw Error(g(174));return f}function nW(f,x){switch(ho(wM,x),ho(SM,f),ho(G1,_M),f=x.nodeType,f){case 9:case 11:x=(x=x.documentElement)?x.namespaceURI:ap(null,"");break;default:f=f===8?x.parentNode:x,x=f.namespaceURI||null,f=f.tagName,x=ap(x,f)}Ao(G1),ho(G1,x)}function i_(){Ao(G1),Ao(SM),Ao(wM)}function vve(f){s6(wM.current);var x=s6(G1.current),M=ap(x,f.type);x!==M&&(ho(SM,f),ho(G1,M))}function rW(f){SM.current===f&&(Ao(G1),Ao(SM))}var ta=uy(0);function xD(f){for(var x=f;x!==null;){if(x.tag===13){var M=x.memoizedState;if(M!==null&&(M=M.dehydrated,M===null||M.data==="$?"||M.data==="$!"))return x}else if(x.tag===19&&x.memoizedProps.revealOrder!==void 0){if(x.flags&128)return x}else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===f)break;for(;x.sibling===null;){if(x.return===null||x.return===f)return null;x=x.return}x.sibling.return=x.return,x=x.sibling}return null}var iW=[];function sW(){for(var f=0;f<iW.length;f++)iW[f]._workInProgressVersionPrimary=null;iW.length=0}var bD=Ae.ReactCurrentDispatcher,oW=Ae.ReactCurrentBatchConfig,o6=0,na=null,ml=null,Xl=null,_D=!1,TM=!1,EM=0,oze=0;function pc(){throw Error(g(321))}function aW(f,x){if(x===null)return!1;for(var M=0;M<x.length&&M<f.length;M++)if(!Uf(f[M],x[M]))return!1;return!0}function lW(f,x,M,F,X,te){if(o6=te,na=x,x.memoizedState=null,x.updateQueue=null,x.lanes=0,bD.current=f===null||f.memoizedState===null?uze:dze,f=M(F,X),TM){te=0;do{if(TM=!1,EM=0,25<=te)throw Error(g(301));te+=1,Xl=ml=null,x.updateQueue=null,bD.current=hze,f=M(F,X)}while(TM)}if(bD.current=TD,x=ml!==null&&ml.next!==null,o6=0,Xl=ml=na=null,_D=!1,x)throw Error(g(300));return f}function cW(){var f=EM!==0;return EM=0,f}function j1(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xl===null?na.memoizedState=Xl=f:Xl=Xl.next=f,Xl}function dp(){if(ml===null){var f=na.alternate;f=f!==null?f.memoizedState:null}else f=ml.next;var x=Xl===null?na.memoizedState:Xl.next;if(x!==null)Xl=x,ml=f;else{if(f===null)throw Error(g(310));ml=f,f={memoizedState:ml.memoizedState,baseState:ml.baseState,baseQueue:ml.baseQueue,queue:ml.queue,next:null},Xl===null?na.memoizedState=Xl=f:Xl=Xl.next=f}return Xl}function MM(f,x){return typeof x=="function"?x(f):x}function uW(f){var x=dp(),M=x.queue;if(M===null)throw Error(g(311));M.lastRenderedReducer=f;var F=ml,X=F.baseQueue,te=M.pending;if(te!==null){if(X!==null){var fe=X.next;X.next=te.next,te.next=fe}F.baseQueue=X=te,M.pending=null}if(X!==null){te=X.next,F=F.baseState;var Be=fe=null,rt=null,Ot=te;do{var mn=Ot.lane;if((o6&mn)===mn)rt!==null&&(rt=rt.next={lane:0,action:Ot.action,hasEagerState:Ot.hasEagerState,eagerState:Ot.eagerState,next:null}),F=Ot.hasEagerState?Ot.eagerState:f(F,Ot.action);else{var xn={lane:mn,action:Ot.action,hasEagerState:Ot.hasEagerState,eagerState:Ot.eagerState,next:null};rt===null?(Be=rt=xn,fe=F):rt=rt.next=xn,na.lanes|=mn,a6|=mn}Ot=Ot.next}while(Ot!==null&&Ot!==te);rt===null?fe=F:rt.next=Be,Uf(F,x.memoizedState)||(rd=!0),x.memoizedState=F,x.baseState=fe,x.baseQueue=rt,M.lastRenderedState=F}if(f=M.interleaved,f!==null){X=f;do te=X.lane,na.lanes|=te,a6|=te,X=X.next;while(X!==f)}else X===null&&(M.lanes=0);return[x.memoizedState,M.dispatch]}function dW(f){var x=dp(),M=x.queue;if(M===null)throw Error(g(311));M.lastRenderedReducer=f;var F=M.dispatch,X=M.pending,te=x.memoizedState;if(X!==null){M.pending=null;var fe=X=X.next;do te=f(te,fe.action),fe=fe.next;while(fe!==X);Uf(te,x.memoizedState)||(rd=!0),x.memoizedState=te,x.baseQueue===null&&(x.baseState=te),M.lastRenderedState=te}return[te,F]}function xve(){}function bve(f,x){var M=na,F=dp(),X=x(),te=!Uf(F.memoizedState,X);if(te&&(F.memoizedState=X,rd=!0),F=F.queue,hW(wve.bind(null,M,F,f),[f]),F.getSnapshot!==x||te||Xl!==null&&Xl.memoizedState.tag&1){if(M.flags|=2048,CM(9,Sve.bind(null,M,F,X,x),void 0,null),Yl===null)throw Error(g(349));o6&30||_ve(M,x,X)}return X}function _ve(f,x,M){f.flags|=16384,f={getSnapshot:x,value:M},x=na.updateQueue,x===null?(x={lastEffect:null,stores:null},na.updateQueue=x,x.stores=[f]):(M=x.stores,M===null?x.stores=[f]:M.push(f))}function Sve(f,x,M,F){x.value=M,x.getSnapshot=F,Tve(x)&&Eve(f)}function wve(f,x,M){return M(function(){Tve(x)&&Eve(f)})}function Tve(f){var x=f.getSnapshot;f=f.value;try{var M=x();return!Uf(f,M)}catch{return!0}}function Eve(f){var x=g3(f,1);x!==null&&Hf(x,f,1,-1)}function Mve(f){var x=j1();return typeof f=="function"&&(f=f()),x.memoizedState=x.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:MM,lastRenderedState:f},x.queue=f,f=f.dispatch=cze.bind(null,na,f),[x.memoizedState,f]}function CM(f,x,M,F){return f={tag:f,create:x,destroy:M,deps:F,next:null},x=na.updateQueue,x===null?(x={lastEffect:null,stores:null},na.updateQueue=x,x.lastEffect=f.next=f):(M=x.lastEffect,M===null?x.lastEffect=f.next=f:(F=M.next,M.next=f,f.next=F,x.lastEffect=f)),f}function Cve(){return dp().memoizedState}function SD(f,x,M,F){var X=j1();na.flags|=f,X.memoizedState=CM(1|x,M,void 0,F===void 0?null:F)}function wD(f,x,M,F){var X=dp();F=F===void 0?null:F;var te=void 0;if(ml!==null){var fe=ml.memoizedState;if(te=fe.destroy,F!==null&&aW(F,fe.deps)){X.memoizedState=CM(x,M,te,F);return}}na.flags|=f,X.memoizedState=CM(1|x,M,te,F)}function Ave(f,x){return SD(8390656,8,f,x)}function hW(f,x){return wD(2048,8,f,x)}function Nve(f,x){return wD(4,2,f,x)}function Pve(f,x){return wD(4,4,f,x)}function Rve(f,x){if(typeof x=="function")return f=f(),x(f),function(){x(null)};if(x!=null)return f=f(),x.current=f,function(){x.current=null}}function Ive(f,x,M){return M=M!=null?M.concat([f]):null,wD(4,4,Rve.bind(null,x,f),M)}function pW(){}function kve(f,x){var M=dp();x=x===void 0?null:x;var F=M.memoizedState;return F!==null&&x!==null&&aW(x,F[1])?F[0]:(M.memoizedState=[f,x],f)}function Dve(f,x){var M=dp();x=x===void 0?null:x;var F=M.memoizedState;return F!==null&&x!==null&&aW(x,F[1])?F[0]:(f=f(),M.memoizedState=[f,x],f)}function Ove(f,x,M){return o6&21?(Uf(M,x)||(M=o5e(),na.lanes|=M,a6|=M,f.baseState=!0),x):(f.baseState&&(f.baseState=!1,rd=!0),f.memoizedState=M)}function aze(f,x){var M=Gs;Gs=M!==0&&4>M?M:4,f(!0);var F=oW.transition;oW.transition={};try{f(!1),x()}finally{Gs=M,oW.transition=F}}function Lve(){return dp().memoizedState}function lze(f,x,M){var F=vy(f);if(M={lane:F,action:M,hasEagerState:!1,eagerState:null,next:null},Fve(f))Bve(x,M);else if(M=ave(f,x,M,F),M!==null){var X=au();Hf(M,f,F,X),Uve(M,x,F)}}function cze(f,x,M){var F=vy(f),X={lane:F,action:M,hasEagerState:!1,eagerState:null,next:null};if(Fve(f))Bve(x,X);else{var te=f.alternate;if(f.lanes===0&&(te===null||te.lanes===0)&&(te=x.lastRenderedReducer,te!==null))try{var fe=x.lastRenderedState,Be=te(fe,M);if(X.hasEagerState=!0,X.eagerState=Be,Uf(Be,fe)){var rt=x.interleaved;rt===null?(X.next=X,Q$(x)):(X.next=rt.next,rt.next=X),x.interleaved=X;return}}catch{}finally{}M=ave(f,x,X,F),M!==null&&(X=au(),Hf(M,f,F,X),Uve(M,x,F))}}function Fve(f){var x=f.alternate;return f===na||x!==null&&x===na}function Bve(f,x){TM=_D=!0;var M=f.pending;M===null?x.next=x:(x.next=M.next,M.next=x),f.pending=x}function Uve(f,x,M){if(M&4194240){var F=x.lanes;F&=f.pendingLanes,M|=F,x.lanes=M,m$(f,M)}}var TD={readContext:up,useCallback:pc,useContext:pc,useEffect:pc,useImperativeHandle:pc,useInsertionEffect:pc,useLayoutEffect:pc,useMemo:pc,useReducer:pc,useRef:pc,useState:pc,useDebugValue:pc,useDeferredValue:pc,useTransition:pc,useMutableSource:pc,useSyncExternalStore:pc,useId:pc,unstable_isNewReconciler:!1},uze={readContext:up,useCallback:function(f,x){return j1().memoizedState=[f,x===void 0?null:x],f},useContext:up,useEffect:Ave,useImperativeHandle:function(f,x,M){return M=M!=null?M.concat([f]):null,SD(4194308,4,Rve.bind(null,x,f),M)},useLayoutEffect:function(f,x){return SD(4194308,4,f,x)},useInsertionEffect:function(f,x){return SD(4,2,f,x)},useMemo:function(f,x){var M=j1();return x=x===void 0?null:x,f=f(),M.memoizedState=[f,x],f},useReducer:function(f,x,M){var F=j1();return x=M!==void 0?M(x):x,F.memoizedState=F.baseState=x,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:x},F.queue=f,f=f.dispatch=lze.bind(null,na,f),[F.memoizedState,f]},useRef:function(f){var x=j1();return f={current:f},x.memoizedState=f},useState:Mve,useDebugValue:pW,useDeferredValue:function(f){return j1().memoizedState=f},useTransition:function(){var f=Mve(!1),x=f[0];return f=aze.bind(null,f[1]),j1().memoizedState=f,[x,f]},useMutableSource:function(){},useSyncExternalStore:function(f,x,M){var F=na,X=j1();if(Fo){if(M===void 0)throw Error(g(407));M=M()}else{if(M=x(),Yl===null)throw Error(g(349));o6&30||_ve(F,x,M)}X.memoizedState=M;var te={value:M,getSnapshot:x};return X.queue=te,Ave(wve.bind(null,F,te,f),[f]),F.flags|=2048,CM(9,Sve.bind(null,F,te,M,x),void 0,null),M},useId:function(){var f=j1(),x=Yl.identifierPrefix;if(Fo){var M=m3,F=f3;M=(F&~(1<<32-Bf(F)-1)).toString(32)+M,x=":"+x+"R"+M,M=EM++,0<M&&(x+="H"+M.toString(32)),x+=":"}else M=oze++,x=":"+x+"r"+M.toString(32)+":";return f.memoizedState=x},unstable_isNewReconciler:!1},dze={readContext:up,useCallback:kve,useContext:up,useEffect:hW,useImperativeHandle:Ive,useInsertionEffect:Nve,useLayoutEffect:Pve,useMemo:Dve,useReducer:uW,useRef:Cve,useState:function(){return uW(MM)},useDebugValue:pW,useDeferredValue:function(f){var x=dp();return Ove(x,ml.memoizedState,f)},useTransition:function(){var f=uW(MM)[0],x=dp().memoizedState;return[f,x]},useMutableSource:xve,useSyncExternalStore:bve,useId:Lve,unstable_isNewReconciler:!1},hze={readContext:up,useCallback:kve,useContext:up,useEffect:hW,useImperativeHandle:Ive,useInsertionEffect:Nve,useLayoutEffect:Pve,useMemo:Dve,useReducer:dW,useRef:Cve,useState:function(){return dW(MM)},useDebugValue:pW,useDeferredValue:function(f){var x=dp();return ml===null?x.memoizedState=f:Ove(x,ml.memoizedState,f)},useTransition:function(){var f=dW(MM)[0],x=dp().memoizedState;return[f,x]},useMutableSource:xve,useSyncExternalStore:bve,useId:Lve,unstable_isNewReconciler:!1};function s_(f,x){try{var M="",F=x;do M+=Te(F),F=F.return;while(F);var X=M}catch(te){X=`
Error generating stack: `+te.message+`
`+te.stack}return{value:f,source:x,stack:X,digest:null}}function fW(f,x,M){return{value:f,source:null,stack:M??null,digest:x??null}}function mW(f,x){try{console.error(x.value)}catch(M){setTimeout(function(){throw M})}}var pze=typeof WeakMap=="function"?WeakMap:Map;function zve(f,x,M){M=y3(-1,M),M.tag=3,M.payload={element:null};var F=x.value;return M.callback=function(){RD||(RD=!0,NW=F),mW(f,x)},M}function Vve(f,x,M){M=y3(-1,M),M.tag=3;var F=f.type.getDerivedStateFromError;if(typeof F=="function"){var X=x.value;M.payload=function(){return F(X)},M.callback=function(){mW(f,x)}}var te=f.stateNode;return te!==null&&typeof te.componentDidCatch=="function"&&(M.callback=function(){mW(f,x),typeof F!="function"&&(gy===null?gy=new Set([this]):gy.add(this));var fe=x.stack;this.componentDidCatch(x.value,{componentStack:fe!==null?fe:""})}),M}function Gve(f,x,M){var F=f.pingCache;if(F===null){F=f.pingCache=new pze;var X=new Set;F.set(x,X)}else X=F.get(x),X===void 0&&(X=new Set,F.set(x,X));X.has(M)||(X.add(M),f=Cze.bind(null,f,x,M),x.then(f,f))}function jve(f){do{var x;if((x=f.tag===13)&&(x=f.memoizedState,x=x!==null?x.dehydrated!==null:!0),x)return f;f=f.return}while(f!==null);return null}function Hve(f,x,M,F,X){return f.mode&1?(f.flags|=65536,f.lanes=X,f):(f===x?f.flags|=65536:(f.flags|=128,M.flags|=131072,M.flags&=-52805,M.tag===1&&(M.alternate===null?M.tag=17:(x=y3(-1,1),x.tag=2,fy(M,x,1))),M.lanes|=1),f)}var fze=Ae.ReactCurrentOwner,rd=!1;function ou(f,x,M,F){x.child=f===null?yve(x,null,M,F):r_(x,f.child,M,F)}function $ve(f,x,M,F,X){M=M.render;var te=x.ref;return n_(x,X),F=lW(f,x,M,F,te,X),M=cW(),f!==null&&!rd?(x.updateQueue=f.updateQueue,x.flags&=-2053,f.lanes&=~X,v3(f,x,X)):(Fo&&M&&j$(x),x.flags|=1,ou(f,x,F,X),x.child)}function Wve(f,x,M,F,X){if(f===null){var te=M.type;return typeof te=="function"&&!LW(te)&&te.defaultProps===void 0&&M.compare===null&&M.defaultProps===void 0?(x.tag=15,x.type=te,qve(f,x,te,F,X)):(f=FD(M.type,null,F,x,x.mode,X),f.ref=x.ref,f.return=x,x.child=f)}if(te=f.child,!(f.lanes&X)){var fe=te.memoizedProps;if(M=M.compare,M=M!==null?M:pM,M(fe,F)&&f.ref===x.ref)return v3(f,x,X)}return x.flags|=1,f=by(te,F),f.ref=x.ref,f.return=x,x.child=f}function qve(f,x,M,F,X){if(f!==null){var te=f.memoizedProps;if(pM(te,F)&&f.ref===x.ref)if(rd=!1,x.pendingProps=F=te,(f.lanes&X)!==0)f.flags&131072&&(rd=!0);else return x.lanes=f.lanes,v3(f,x,X)}return gW(f,x,M,F,X)}function Xve(f,x,M){var F=x.pendingProps,X=F.children,te=f!==null?f.memoizedState:null;if(F.mode==="hidden")if(!(x.mode&1))x.memoizedState={baseLanes:0,cachePool:null,transitions:null},ho(a_,ih),ih|=M;else{if(!(M&1073741824))return f=te!==null?te.baseLanes|M:M,x.lanes=x.childLanes=1073741824,x.memoizedState={baseLanes:f,cachePool:null,transitions:null},x.updateQueue=null,ho(a_,ih),ih|=f,null;x.memoizedState={baseLanes:0,cachePool:null,transitions:null},F=te!==null?te.baseLanes:M,ho(a_,ih),ih|=F}else te!==null?(F=te.baseLanes|M,x.memoizedState=null):F=M,ho(a_,ih),ih|=F;return ou(f,x,X,M),x.child}function Yve(f,x){var M=x.ref;(f===null&&M!==null||f!==null&&f.ref!==M)&&(x.flags|=512,x.flags|=2097152)}function gW(f,x,M,F,X){var te=nd(M)?t6:hc.current;return te=Zb(x,te),n_(x,X),M=lW(f,x,M,F,te,X),F=cW(),f!==null&&!rd?(x.updateQueue=f.updateQueue,x.flags&=-2053,f.lanes&=~X,v3(f,x,X)):(Fo&&F&&j$(x),x.flags|=1,ou(f,x,M,X),x.child)}function Kve(f,x,M,F,X){if(nd(M)){var te=!0;lD(x)}else te=!1;if(n_(x,X),x.stateNode===null)MD(f,x),pve(x,M,F),tW(x,M,F,X),F=!0;else if(f===null){var fe=x.stateNode,Be=x.memoizedProps;fe.props=Be;var rt=fe.context,Ot=M.contextType;typeof Ot=="object"&&Ot!==null?Ot=up(Ot):(Ot=nd(M)?t6:hc.current,Ot=Zb(x,Ot));var mn=M.getDerivedStateFromProps,xn=typeof mn=="function"||typeof fe.getSnapshotBeforeUpdate=="function";xn||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(Be!==F||rt!==Ot)&&fve(x,fe,F,Ot),py=!1;var hn=x.memoizedState;fe.state=hn,gD(x,F,fe,X),rt=x.memoizedState,Be!==F||hn!==rt||td.current||py?(typeof mn=="function"&&(eW(x,M,mn,F),rt=x.memoizedState),(Be=py||hve(x,M,Be,F,hn,rt,Ot))?(xn||typeof fe.UNSAFE_componentWillMount!="function"&&typeof fe.componentWillMount!="function"||(typeof fe.componentWillMount=="function"&&fe.componentWillMount(),typeof fe.UNSAFE_componentWillMount=="function"&&fe.UNSAFE_componentWillMount()),typeof fe.componentDidMount=="function"&&(x.flags|=4194308)):(typeof fe.componentDidMount=="function"&&(x.flags|=4194308),x.memoizedProps=F,x.memoizedState=rt),fe.props=F,fe.state=rt,fe.context=Ot,F=Be):(typeof fe.componentDidMount=="function"&&(x.flags|=4194308),F=!1)}else{fe=x.stateNode,lve(f,x),Be=x.memoizedProps,Ot=x.type===x.elementType?Be:Vf(x.type,Be),fe.props=Ot,xn=x.pendingProps,hn=fe.context,rt=M.contextType,typeof rt=="object"&&rt!==null?rt=up(rt):(rt=nd(M)?t6:hc.current,rt=Zb(x,rt));var rr=M.getDerivedStateFromProps;(mn=typeof rr=="function"||typeof fe.getSnapshotBeforeUpdate=="function")||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(Be!==xn||hn!==rt)&&fve(x,fe,F,rt),py=!1,hn=x.memoizedState,fe.state=hn,gD(x,F,fe,X);var br=x.memoizedState;Be!==xn||hn!==br||td.current||py?(typeof rr=="function"&&(eW(x,M,rr,F),br=x.memoizedState),(Ot=py||hve(x,M,Ot,F,hn,br,rt)||!1)?(mn||typeof fe.UNSAFE_componentWillUpdate!="function"&&typeof fe.componentWillUpdate!="function"||(typeof fe.componentWillUpdate=="function"&&fe.componentWillUpdate(F,br,rt),typeof fe.UNSAFE_componentWillUpdate=="function"&&fe.UNSAFE_componentWillUpdate(F,br,rt)),typeof fe.componentDidUpdate=="function"&&(x.flags|=4),typeof fe.getSnapshotBeforeUpdate=="function"&&(x.flags|=1024)):(typeof fe.componentDidUpdate!="function"||Be===f.memoizedProps&&hn===f.memoizedState||(x.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||Be===f.memoizedProps&&hn===f.memoizedState||(x.flags|=1024),x.memoizedProps=F,x.memoizedState=br),fe.props=F,fe.state=br,fe.context=rt,F=Ot):(typeof fe.componentDidUpdate!="function"||Be===f.memoizedProps&&hn===f.memoizedState||(x.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||Be===f.memoizedProps&&hn===f.memoizedState||(x.flags|=1024),F=!1)}return yW(f,x,M,F,te,X)}function yW(f,x,M,F,X,te){Yve(f,x);var fe=(x.flags&128)!==0;if(!F&&!fe)return X&&eve(x,M,!1),v3(f,x,te);F=x.stateNode,fze.current=x;var Be=fe&&typeof M.getDerivedStateFromError!="function"?null:F.render();return x.flags|=1,f!==null&&fe?(x.child=r_(x,f.child,null,te),x.child=r_(x,null,Be,te)):ou(f,x,Be,te),x.memoizedState=F.state,X&&eve(x,M,!0),x.child}function Zve(f){var x=f.stateNode;x.pendingContext?Q5e(f,x.pendingContext,x.pendingContext!==x.context):x.context&&Q5e(f,x.context,!1),nW(f,x.containerInfo)}function Qve(f,x,M,F,X){return e_(),q$(X),x.flags|=256,ou(f,x,M,F),x.child}var vW={dehydrated:null,treeContext:null,retryLane:0};function xW(f){return{baseLanes:f,cachePool:null,transitions:null}}function Jve(f,x,M){var F=x.pendingProps,X=ta.current,te=!1,fe=(x.flags&128)!==0,Be;if((Be=fe)||(Be=f!==null&&f.memoizedState===null?!1:(X&2)!==0),Be?(te=!0,x.flags&=-129):(f===null||f.memoizedState!==null)&&(X|=1),ho(ta,X&1),f===null)return W$(x),f=x.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?(x.mode&1?f.data==="$!"?x.lanes=8:x.lanes=1073741824:x.lanes=1,null):(fe=F.children,f=F.fallback,te?(F=x.mode,te=x.child,fe={mode:"hidden",children:fe},!(F&1)&&te!==null?(te.childLanes=0,te.pendingProps=fe):te=BD(fe,F,0,null),f=d6(f,F,M,null),te.return=x,f.return=x,te.sibling=f,x.child=te,x.child.memoizedState=xW(M),x.memoizedState=vW,f):bW(x,fe));if(X=f.memoizedState,X!==null&&(Be=X.dehydrated,Be!==null))return mze(f,x,fe,F,Be,X,M);if(te){te=F.fallback,fe=x.mode,X=f.child,Be=X.sibling;var rt={mode:"hidden",children:F.children};return!(fe&1)&&x.child!==X?(F=x.child,F.childLanes=0,F.pendingProps=rt,x.deletions=null):(F=by(X,rt),F.subtreeFlags=X.subtreeFlags&14680064),Be!==null?te=by(Be,te):(te=d6(te,fe,M,null),te.flags|=2),te.return=x,F.return=x,F.sibling=te,x.child=F,F=te,te=x.child,fe=f.child.memoizedState,fe=fe===null?xW(M):{baseLanes:fe.baseLanes|M,cachePool:null,transitions:fe.transitions},te.memoizedState=fe,te.childLanes=f.childLanes&~M,x.memoizedState=vW,F}return te=f.child,f=te.sibling,F=by(te,{mode:"visible",children:F.children}),!(x.mode&1)&&(F.lanes=M),F.return=x,F.sibling=null,f!==null&&(M=x.deletions,M===null?(x.deletions=[f],x.flags|=16):M.push(f)),x.child=F,x.memoizedState=null,F}function bW(f,x){return x=BD({mode:"visible",children:x},f.mode,0,null),x.return=f,f.child=x}function ED(f,x,M,F){return F!==null&&q$(F),r_(x,f.child,null,M),f=bW(x,x.pendingProps.children),f.flags|=2,x.memoizedState=null,f}function mze(f,x,M,F,X,te,fe){if(M)return x.flags&256?(x.flags&=-257,F=fW(Error(g(422))),ED(f,x,fe,F)):x.memoizedState!==null?(x.child=f.child,x.flags|=128,null):(te=F.fallback,X=x.mode,F=BD({mode:"visible",children:F.children},X,0,null),te=d6(te,X,fe,null),te.flags|=2,F.return=x,te.return=x,F.sibling=te,x.child=F,x.mode&1&&r_(x,f.child,null,fe),x.child.memoizedState=xW(fe),x.memoizedState=vW,te);if(!(x.mode&1))return ED(f,x,fe,null);if(X.data==="$!"){if(F=X.nextSibling&&X.nextSibling.dataset,F)var Be=F.dgst;return F=Be,te=Error(g(419)),F=fW(te,F,void 0),ED(f,x,fe,F)}if(Be=(fe&f.childLanes)!==0,rd||Be){if(F=Yl,F!==null){switch(fe&-fe){case 4:X=2;break;case 16:X=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:X=32;break;case 536870912:X=268435456;break;default:X=0}X=X&(F.suspendedLanes|fe)?0:X,X!==0&&X!==te.retryLane&&(te.retryLane=X,g3(f,X),Hf(F,f,X,-1))}return OW(),F=fW(Error(g(421))),ED(f,x,fe,F)}return X.data==="$?"?(x.flags|=128,x.child=f.child,x=Aze.bind(null,f),X._reactRetry=x,null):(f=te.treeContext,rh=cy(X.nextSibling),nh=x,Fo=!0,zf=null,f!==null&&(lp[cp++]=f3,lp[cp++]=m3,lp[cp++]=n6,f3=f.id,m3=f.overflow,n6=x),x=bW(x,F.children),x.flags|=4096,x)}function e8e(f,x,M){f.lanes|=x;var F=f.alternate;F!==null&&(F.lanes|=x),Z$(f.return,x,M)}function _W(f,x,M,F,X){var te=f.memoizedState;te===null?f.memoizedState={isBackwards:x,rendering:null,renderingStartTime:0,last:F,tail:M,tailMode:X}:(te.isBackwards=x,te.rendering=null,te.renderingStartTime=0,te.last=F,te.tail=M,te.tailMode=X)}function t8e(f,x,M){var F=x.pendingProps,X=F.revealOrder,te=F.tail;if(ou(f,x,F.children,M),F=ta.current,F&2)F=F&1|2,x.flags|=128;else{if(f!==null&&f.flags&128)e:for(f=x.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&e8e(f,M,x);else if(f.tag===19)e8e(f,M,x);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===x)break e;for(;f.sibling===null;){if(f.return===null||f.return===x)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}F&=1}if(ho(ta,F),!(x.mode&1))x.memoizedState=null;else switch(X){case"forwards":for(M=x.child,X=null;M!==null;)f=M.alternate,f!==null&&xD(f)===null&&(X=M),M=M.sibling;M=X,M===null?(X=x.child,x.child=null):(X=M.sibling,M.sibling=null),_W(x,!1,X,M,te);break;case"backwards":for(M=null,X=x.child,x.child=null;X!==null;){if(f=X.alternate,f!==null&&xD(f)===null){x.child=X;break}f=X.sibling,X.sibling=M,M=X,X=f}_W(x,!0,M,null,te);break;case"together":_W(x,!1,null,null,void 0);break;default:x.memoizedState=null}return x.child}function MD(f,x){!(x.mode&1)&&f!==null&&(f.alternate=null,x.alternate=null,x.flags|=2)}function v3(f,x,M){if(f!==null&&(x.dependencies=f.dependencies),a6|=x.lanes,!(M&x.childLanes))return null;if(f!==null&&x.child!==f.child)throw Error(g(153));if(x.child!==null){for(f=x.child,M=by(f,f.pendingProps),x.child=M,M.return=x;f.sibling!==null;)f=f.sibling,M=M.sibling=by(f,f.pendingProps),M.return=x;M.sibling=null}return x.child}function gze(f,x,M){switch(x.tag){case 3:Zve(x),e_();break;case 5:vve(x);break;case 1:nd(x.type)&&lD(x);break;case 4:nW(x,x.stateNode.containerInfo);break;case 10:var F=x.type._context,X=x.memoizedProps.value;ho(pD,F._currentValue),F._currentValue=X;break;case 13:if(F=x.memoizedState,F!==null)return F.dehydrated!==null?(ho(ta,ta.current&1),x.flags|=128,null):M&x.child.childLanes?Jve(f,x,M):(ho(ta,ta.current&1),f=v3(f,x,M),f!==null?f.sibling:null);ho(ta,ta.current&1);break;case 19:if(F=(M&x.childLanes)!==0,f.flags&128){if(F)return t8e(f,x,M);x.flags|=128}if(X=x.memoizedState,X!==null&&(X.rendering=null,X.tail=null,X.lastEffect=null),ho(ta,ta.current),F)break;return null;case 22:case 23:return x.lanes=0,Xve(f,x,M)}return v3(f,x,M)}var n8e,SW,r8e,i8e;n8e=function(f,x){for(var M=x.child;M!==null;){if(M.tag===5||M.tag===6)f.appendChild(M.stateNode);else if(M.tag!==4&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===x)break;for(;M.sibling===null;){if(M.return===null||M.return===x)return;M=M.return}M.sibling.return=M.return,M=M.sibling}},SW=function(){},r8e=function(f,x,M,F){var X=f.memoizedProps;if(X!==F){f=x.stateNode,s6(G1.current);var te=null;switch(M){case"input":X=li(f,X),F=li(f,F),te=[];break;case"select":X=De({},X,{value:void 0}),F=De({},F,{value:void 0}),te=[];break;case"textarea":X=ql(f,X),F=ql(f,F),te=[];break;default:typeof X.onClick!="function"&&typeof F.onClick=="function"&&(f.onclick=sD)}i$(M,F);var fe;M=null;for(Ot in X)if(!F.hasOwnProperty(Ot)&&X.hasOwnProperty(Ot)&&X[Ot]!=null)if(Ot==="style"){var Be=X[Ot];for(fe in Be)Be.hasOwnProperty(fe)&&(M||(M={}),M[fe]="")}else Ot!=="dangerouslySetInnerHTML"&&Ot!=="children"&&Ot!=="suppressContentEditableWarning"&&Ot!=="suppressHydrationWarning"&&Ot!=="autoFocus"&&(T.hasOwnProperty(Ot)?te||(te=[]):(te=te||[]).push(Ot,null));for(Ot in F){var rt=F[Ot];if(Be=X!=null?X[Ot]:void 0,F.hasOwnProperty(Ot)&&rt!==Be&&(rt!=null||Be!=null))if(Ot==="style")if(Be){for(fe in Be)!Be.hasOwnProperty(fe)||rt&&rt.hasOwnProperty(fe)||(M||(M={}),M[fe]="");for(fe in rt)rt.hasOwnProperty(fe)&&Be[fe]!==rt[fe]&&(M||(M={}),M[fe]=rt[fe])}else M||(te||(te=[]),te.push(Ot,M)),M=rt;else Ot==="dangerouslySetInnerHTML"?(rt=rt?rt.__html:void 0,Be=Be?Be.__html:void 0,rt!=null&&Be!==rt&&(te=te||[]).push(Ot,rt)):Ot==="children"?typeof rt!="string"&&typeof rt!="number"||(te=te||[]).push(Ot,""+rt):Ot!=="suppressContentEditableWarning"&&Ot!=="suppressHydrationWarning"&&(T.hasOwnProperty(Ot)?(rt!=null&&Ot==="onScroll"&&Co("scroll",f),te||Be===rt||(te=[])):(te=te||[]).push(Ot,rt))}M&&(te=te||[]).push("style",M);var Ot=te;(x.updateQueue=Ot)&&(x.flags|=4)}},i8e=function(f,x,M,F){M!==F&&(x.flags|=4)};function AM(f,x){if(!Fo)switch(f.tailMode){case"hidden":x=f.tail;for(var M=null;x!==null;)x.alternate!==null&&(M=x),x=x.sibling;M===null?f.tail=null:M.sibling=null;break;case"collapsed":M=f.tail;for(var F=null;M!==null;)M.alternate!==null&&(F=M),M=M.sibling;F===null?x||f.tail===null?f.tail=null:f.tail.sibling=null:F.sibling=null}}function fc(f){var x=f.alternate!==null&&f.alternate.child===f.child,M=0,F=0;if(x)for(var X=f.child;X!==null;)M|=X.lanes|X.childLanes,F|=X.subtreeFlags&14680064,F|=X.flags&14680064,X.return=f,X=X.sibling;else for(X=f.child;X!==null;)M|=X.lanes|X.childLanes,F|=X.subtreeFlags,F|=X.flags,X.return=f,X=X.sibling;return f.subtreeFlags|=F,f.childLanes=M,x}function yze(f,x,M){var F=x.pendingProps;switch(H$(x),x.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fc(x),null;case 1:return nd(x.type)&&aD(),fc(x),null;case 3:return F=x.stateNode,i_(),Ao(td),Ao(hc),sW(),F.pendingContext&&(F.context=F.pendingContext,F.pendingContext=null),(f===null||f.child===null)&&(hD(x)?x.flags|=4:f===null||f.memoizedState.isDehydrated&&!(x.flags&256)||(x.flags|=1024,zf!==null&&(IW(zf),zf=null))),SW(f,x),fc(x),null;case 5:rW(x);var X=s6(wM.current);if(M=x.type,f!==null&&x.stateNode!=null)r8e(f,x,M,F,X),f.ref!==x.ref&&(x.flags|=512,x.flags|=2097152);else{if(!F){if(x.stateNode===null)throw Error(g(166));return fc(x),null}if(f=s6(G1.current),hD(x)){F=x.stateNode,M=x.type;var te=x.memoizedProps;switch(F[V1]=x,F[vM]=te,f=(x.mode&1)!==0,M){case"dialog":Co("cancel",F),Co("close",F);break;case"iframe":case"object":case"embed":Co("load",F);break;case"video":case"audio":for(X=0;X<mM.length;X++)Co(mM[X],F);break;case"source":Co("error",F);break;case"img":case"image":case"link":Co("error",F),Co("load",F);break;case"details":Co("toggle",F);break;case"input":Mo(F,te),Co("invalid",F);break;case"select":F._wrapperState={wasMultiple:!!te.multiple},Co("invalid",F);break;case"textarea":ei(F,te),Co("invalid",F)}i$(M,te),X=null;for(var fe in te)if(te.hasOwnProperty(fe)){var Be=te[fe];fe==="children"?typeof Be=="string"?F.textContent!==Be&&(te.suppressHydrationWarning!==!0&&iD(F.textContent,Be,f),X=["children",Be]):typeof Be=="number"&&F.textContent!==""+Be&&(te.suppressHydrationWarning!==!0&&iD(F.textContent,Be,f),X=["children",""+Be]):T.hasOwnProperty(fe)&&Be!=null&&fe==="onScroll"&&Co("scroll",F)}switch(M){case"input":Or(F),Wl(F,te,!0);break;case"textarea":Or(F),d3(F);break;case"select":case"option":break;default:typeof te.onClick=="function"&&(F.onclick=sD)}F=X,x.updateQueue=F,F!==null&&(x.flags|=4)}else{fe=X.nodeType===9?X:X.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=Bb(M)),f==="http://www.w3.org/1999/xhtml"?M==="script"?(f=fe.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof F.is=="string"?f=fe.createElement(M,{is:F.is}):(f=fe.createElement(M),M==="select"&&(fe=f,F.multiple?fe.multiple=!0:F.size&&(fe.size=F.size))):f=fe.createElementNS(f,M),f[V1]=x,f[vM]=F,n8e(f,x,!1,!1),x.stateNode=f;e:{switch(fe=s$(M,F),M){case"dialog":Co("cancel",f),Co("close",f),X=F;break;case"iframe":case"object":case"embed":Co("load",f),X=F;break;case"video":case"audio":for(X=0;X<mM.length;X++)Co(mM[X],f);X=F;break;case"source":Co("error",f),X=F;break;case"img":case"image":case"link":Co("error",f),Co("load",f),X=F;break;case"details":Co("toggle",f),X=F;break;case"input":Mo(f,F),X=li(f,F),Co("invalid",f);break;case"option":X=F;break;case"select":f._wrapperState={wasMultiple:!!F.multiple},X=De({},F,{value:void 0}),Co("invalid",f);break;case"textarea":ei(f,F),X=ql(f,F),Co("invalid",f);break;default:X=F}i$(M,X),Be=X;for(te in Be)if(Be.hasOwnProperty(te)){var rt=Be[te];te==="style"?$ye(f,rt):te==="dangerouslySetInnerHTML"?(rt=rt?rt.__html:void 0,rt!=null&&jye(f,rt)):te==="children"?typeof rt=="string"?(M!=="textarea"||rt!=="")&&ZE(f,rt):typeof rt=="number"&&ZE(f,""+rt):te!=="suppressContentEditableWarning"&&te!=="suppressHydrationWarning"&&te!=="autoFocus"&&(T.hasOwnProperty(te)?rt!=null&&te==="onScroll"&&Co("scroll",f):rt!=null&&Re(f,te,rt,fe))}switch(M){case"input":Or(f),Wl(f,F,!1);break;case"textarea":Or(f),d3(f);break;case"option":F.value!=null&&f.setAttribute("value",""+En(F.value));break;case"select":f.multiple=!!F.multiple,te=F.value,te!=null?ed(f,!!F.multiple,te,!1):F.defaultValue!=null&&ed(f,!!F.multiple,F.defaultValue,!0);break;default:typeof X.onClick=="function"&&(f.onclick=sD)}switch(M){case"button":case"input":case"select":case"textarea":F=!!F.autoFocus;break e;case"img":F=!0;break e;default:F=!1}}F&&(x.flags|=4)}x.ref!==null&&(x.flags|=512,x.flags|=2097152)}return fc(x),null;case 6:if(f&&x.stateNode!=null)i8e(f,x,f.memoizedProps,F);else{if(typeof F!="string"&&x.stateNode===null)throw Error(g(166));if(M=s6(wM.current),s6(G1.current),hD(x)){if(F=x.stateNode,M=x.memoizedProps,F[V1]=x,(te=F.nodeValue!==M)&&(f=nh,f!==null))switch(f.tag){case 3:iD(F.nodeValue,M,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&iD(F.nodeValue,M,(f.mode&1)!==0)}te&&(x.flags|=4)}else F=(M.nodeType===9?M:M.ownerDocument).createTextNode(F),F[V1]=x,x.stateNode=F}return fc(x),null;case 13:if(Ao(ta),F=x.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(Fo&&rh!==null&&x.mode&1&&!(x.flags&128))ove(),e_(),x.flags|=98560,te=!1;else if(te=hD(x),F!==null&&F.dehydrated!==null){if(f===null){if(!te)throw Error(g(318));if(te=x.memoizedState,te=te!==null?te.dehydrated:null,!te)throw Error(g(317));te[V1]=x}else e_(),!(x.flags&128)&&(x.memoizedState=null),x.flags|=4;fc(x),te=!1}else zf!==null&&(IW(zf),zf=null),te=!0;if(!te)return x.flags&65536?x:null}return x.flags&128?(x.lanes=M,x):(F=F!==null,F!==(f!==null&&f.memoizedState!==null)&&F&&(x.child.flags|=8192,x.mode&1&&(f===null||ta.current&1?gl===0&&(gl=3):OW())),x.updateQueue!==null&&(x.flags|=4),fc(x),null);case 4:return i_(),SW(f,x),f===null&&gM(x.stateNode.containerInfo),fc(x),null;case 10:return K$(x.type._context),fc(x),null;case 17:return nd(x.type)&&aD(),fc(x),null;case 19:if(Ao(ta),te=x.memoizedState,te===null)return fc(x),null;if(F=(x.flags&128)!==0,fe=te.rendering,fe===null)if(F)AM(te,!1);else{if(gl!==0||f!==null&&f.flags&128)for(f=x.child;f!==null;){if(fe=xD(f),fe!==null){for(x.flags|=128,AM(te,!1),F=fe.updateQueue,F!==null&&(x.updateQueue=F,x.flags|=4),x.subtreeFlags=0,F=M,M=x.child;M!==null;)te=M,f=F,te.flags&=14680066,fe=te.alternate,fe===null?(te.childLanes=0,te.lanes=f,te.child=null,te.subtreeFlags=0,te.memoizedProps=null,te.memoizedState=null,te.updateQueue=null,te.dependencies=null,te.stateNode=null):(te.childLanes=fe.childLanes,te.lanes=fe.lanes,te.child=fe.child,te.subtreeFlags=0,te.deletions=null,te.memoizedProps=fe.memoizedProps,te.memoizedState=fe.memoizedState,te.updateQueue=fe.updateQueue,te.type=fe.type,f=fe.dependencies,te.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),M=M.sibling;return ho(ta,ta.current&1|2),x.child}f=f.sibling}te.tail!==null&&La()>l_&&(x.flags|=128,F=!0,AM(te,!1),x.lanes=4194304)}else{if(!F)if(f=xD(fe),f!==null){if(x.flags|=128,F=!0,M=f.updateQueue,M!==null&&(x.updateQueue=M,x.flags|=4),AM(te,!0),te.tail===null&&te.tailMode==="hidden"&&!fe.alternate&&!Fo)return fc(x),null}else 2*La()-te.renderingStartTime>l_&&M!==1073741824&&(x.flags|=128,F=!0,AM(te,!1),x.lanes=4194304);te.isBackwards?(fe.sibling=x.child,x.child=fe):(M=te.last,M!==null?M.sibling=fe:x.child=fe,te.last=fe)}return te.tail!==null?(x=te.tail,te.rendering=x,te.tail=x.sibling,te.renderingStartTime=La(),x.sibling=null,M=ta.current,ho(ta,F?M&1|2:M&1),x):(fc(x),null);case 22:case 23:return DW(),F=x.memoizedState!==null,f!==null&&f.memoizedState!==null!==F&&(x.flags|=8192),F&&x.mode&1?ih&1073741824&&(fc(x),x.subtreeFlags&6&&(x.flags|=8192)):fc(x),null;case 24:return null;case 25:return null}throw Error(g(156,x.tag))}function vze(f,x){switch(H$(x),x.tag){case 1:return nd(x.type)&&aD(),f=x.flags,f&65536?(x.flags=f&-65537|128,x):null;case 3:return i_(),Ao(td),Ao(hc),sW(),f=x.flags,f&65536&&!(f&128)?(x.flags=f&-65537|128,x):null;case 5:return rW(x),null;case 13:if(Ao(ta),f=x.memoizedState,f!==null&&f.dehydrated!==null){if(x.alternate===null)throw Error(g(340));e_()}return f=x.flags,f&65536?(x.flags=f&-65537|128,x):null;case 19:return Ao(ta),null;case 4:return i_(),null;case 10:return K$(x.type._context),null;case 22:case 23:return DW(),null;case 24:return null;default:return null}}var CD=!1,mc=!1,xze=typeof WeakSet=="function"?WeakSet:Set,fr=null;function o_(f,x){var M=f.ref;if(M!==null)if(typeof M=="function")try{M(null)}catch(F){xa(f,x,F)}else M.current=null}function s8e(f,x,M){try{M()}catch(F){xa(f,x,F)}}var o8e=!1;function bze(f,x){if(O$=Hk,f=D5e(),N$(f)){if("selectionStart"in f)var M={start:f.selectionStart,end:f.selectionEnd};else e:{M=(M=f.ownerDocument)&&M.defaultView||window;var F=M.getSelection&&M.getSelection();if(F&&F.rangeCount!==0){M=F.anchorNode;var X=F.anchorOffset,te=F.focusNode;F=F.focusOffset;try{M.nodeType,te.nodeType}catch{M=null;break e}var fe=0,Be=-1,rt=-1,Ot=0,mn=0,xn=f,hn=null;t:for(;;){for(var rr;xn!==M||X!==0&&xn.nodeType!==3||(Be=fe+X),xn!==te||F!==0&&xn.nodeType!==3||(rt=fe+F),xn.nodeType===3&&(fe+=xn.nodeValue.length),(rr=xn.firstChild)!==null;)hn=xn,xn=rr;for(;;){if(xn===f)break t;if(hn===M&&++Ot===X&&(Be=fe),hn===te&&++mn===F&&(rt=fe),(rr=xn.nextSibling)!==null)break;xn=hn,hn=xn.parentNode}xn=rr}M=Be===-1||rt===-1?null:{start:Be,end:rt}}else M=null}M=M||{start:0,end:0}}else M=null;for(L$={focusedElem:f,selectionRange:M},Hk=!1,fr=x;fr!==null;)if(x=fr,f=x.child,(x.subtreeFlags&1028)!==0&&f!==null)f.return=x,fr=f;else for(;fr!==null;){x=fr;try{var br=x.alternate;if(x.flags&1024)switch(x.tag){case 0:case 11:case 15:break;case 1:if(br!==null){var Sr=br.memoizedProps,Fa=br.memoizedState,Tt=x.stateNode,dt=Tt.getSnapshotBeforeUpdate(x.elementType===x.type?Sr:Vf(x.type,Sr),Fa);Tt.__reactInternalSnapshotBeforeUpdate=dt}break;case 3:var Nt=x.stateNode.containerInfo;Nt.nodeType===1?Nt.textContent="":Nt.nodeType===9&&Nt.documentElement&&Nt.removeChild(Nt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(g(163))}}catch(Mn){xa(x,x.return,Mn)}if(f=x.sibling,f!==null){f.return=x.return,fr=f;break}fr=x.return}return br=o8e,o8e=!1,br}function NM(f,x,M){var F=x.updateQueue;if(F=F!==null?F.lastEffect:null,F!==null){var X=F=F.next;do{if((X.tag&f)===f){var te=X.destroy;X.destroy=void 0,te!==void 0&&s8e(x,M,te)}X=X.next}while(X!==F)}}function AD(f,x){if(x=x.updateQueue,x=x!==null?x.lastEffect:null,x!==null){var M=x=x.next;do{if((M.tag&f)===f){var F=M.create;M.destroy=F()}M=M.next}while(M!==x)}}function wW(f){var x=f.ref;if(x!==null){var M=f.stateNode;switch(f.tag){case 5:f=M;break;default:f=M}typeof x=="function"?x(f):x.current=f}}function a8e(f){var x=f.alternate;x!==null&&(f.alternate=null,a8e(x)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(x=f.stateNode,x!==null&&(delete x[V1],delete x[vM],delete x[z$],delete x[nze],delete x[rze])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function l8e(f){return f.tag===5||f.tag===3||f.tag===4}function c8e(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||l8e(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function TW(f,x,M){var F=f.tag;if(F===5||F===6)f=f.stateNode,x?M.nodeType===8?M.parentNode.insertBefore(f,x):M.insertBefore(f,x):(M.nodeType===8?(x=M.parentNode,x.insertBefore(f,M)):(x=M,x.appendChild(f)),M=M._reactRootContainer,M!=null||x.onclick!==null||(x.onclick=sD));else if(F!==4&&(f=f.child,f!==null))for(TW(f,x,M),f=f.sibling;f!==null;)TW(f,x,M),f=f.sibling}function EW(f,x,M){var F=f.tag;if(F===5||F===6)f=f.stateNode,x?M.insertBefore(f,x):M.appendChild(f);else if(F!==4&&(f=f.child,f!==null))for(EW(f,x,M),f=f.sibling;f!==null;)EW(f,x,M),f=f.sibling}var N0=null,Gf=!1;function my(f,x,M){for(M=M.child;M!==null;)u8e(f,x,M),M=M.sibling}function u8e(f,x,M){if(z1&&typeof z1.onCommitFiberUnmount=="function")try{z1.onCommitFiberUnmount(Bk,M)}catch{}switch(M.tag){case 5:mc||o_(M,x);case 6:var F=N0,X=Gf;N0=null,my(f,x,M),N0=F,Gf=X,N0!==null&&(Gf?(f=N0,M=M.stateNode,f.nodeType===8?f.parentNode.removeChild(M):f.removeChild(M)):N0.removeChild(M.stateNode));break;case 18:N0!==null&&(Gf?(f=N0,M=M.stateNode,f.nodeType===8?U$(f.parentNode,M):f.nodeType===1&&U$(f,M),aM(f)):U$(N0,M.stateNode));break;case 4:F=N0,X=Gf,N0=M.stateNode.containerInfo,Gf=!0,my(f,x,M),N0=F,Gf=X;break;case 0:case 11:case 14:case 15:if(!mc&&(F=M.updateQueue,F!==null&&(F=F.lastEffect,F!==null))){X=F=F.next;do{var te=X,fe=te.destroy;te=te.tag,fe!==void 0&&(te&2||te&4)&&s8e(M,x,fe),X=X.next}while(X!==F)}my(f,x,M);break;case 1:if(!mc&&(o_(M,x),F=M.stateNode,typeof F.componentWillUnmount=="function"))try{F.props=M.memoizedProps,F.state=M.memoizedState,F.componentWillUnmount()}catch(Be){xa(M,x,Be)}my(f,x,M);break;case 21:my(f,x,M);break;case 22:M.mode&1?(mc=(F=mc)||M.memoizedState!==null,my(f,x,M),mc=F):my(f,x,M);break;default:my(f,x,M)}}function d8e(f){var x=f.updateQueue;if(x!==null){f.updateQueue=null;var M=f.stateNode;M===null&&(M=f.stateNode=new xze),x.forEach(function(F){var X=Nze.bind(null,f,F);M.has(F)||(M.add(F),F.then(X,X))})}}function jf(f,x){var M=x.deletions;if(M!==null)for(var F=0;F<M.length;F++){var X=M[F];try{var te=f,fe=x,Be=fe;e:for(;Be!==null;){switch(Be.tag){case 5:N0=Be.stateNode,Gf=!1;break e;case 3:N0=Be.stateNode.containerInfo,Gf=!0;break e;case 4:N0=Be.stateNode.containerInfo,Gf=!0;break e}Be=Be.return}if(N0===null)throw Error(g(160));u8e(te,fe,X),N0=null,Gf=!1;var rt=X.alternate;rt!==null&&(rt.return=null),X.return=null}catch(Ot){xa(X,x,Ot)}}if(x.subtreeFlags&12854)for(x=x.child;x!==null;)h8e(x,f),x=x.sibling}function h8e(f,x){var M=f.alternate,F=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(jf(x,f),H1(f),F&4){try{NM(3,f,f.return),AD(3,f)}catch(Sr){xa(f,f.return,Sr)}try{NM(5,f,f.return)}catch(Sr){xa(f,f.return,Sr)}}break;case 1:jf(x,f),H1(f),F&512&&M!==null&&o_(M,M.return);break;case 5:if(jf(x,f),H1(f),F&512&&M!==null&&o_(M,M.return),f.flags&32){var X=f.stateNode;try{ZE(X,"")}catch(Sr){xa(f,f.return,Sr)}}if(F&4&&(X=f.stateNode,X!=null)){var te=f.memoizedProps,fe=M!==null?M.memoizedProps:te,Be=f.type,rt=f.updateQueue;if(f.updateQueue=null,rt!==null)try{Be==="input"&&te.type==="radio"&&te.name!=null&&Si(X,te),s$(Be,fe);var Ot=s$(Be,te);for(fe=0;fe<rt.length;fe+=2){var mn=rt[fe],xn=rt[fe+1];mn==="style"?$ye(X,xn):mn==="dangerouslySetInnerHTML"?jye(X,xn):mn==="children"?ZE(X,xn):Re(X,mn,xn,Ot)}switch(Be){case"input":Ri(X,te);break;case"textarea":yi(X,te);break;case"select":var hn=X._wrapperState.wasMultiple;X._wrapperState.wasMultiple=!!te.multiple;var rr=te.value;rr!=null?ed(X,!!te.multiple,rr,!1):hn!==!!te.multiple&&(te.defaultValue!=null?ed(X,!!te.multiple,te.defaultValue,!0):ed(X,!!te.multiple,te.multiple?[]:"",!1))}X[vM]=te}catch(Sr){xa(f,f.return,Sr)}}break;case 6:if(jf(x,f),H1(f),F&4){if(f.stateNode===null)throw Error(g(162));X=f.stateNode,te=f.memoizedProps;try{X.nodeValue=te}catch(Sr){xa(f,f.return,Sr)}}break;case 3:if(jf(x,f),H1(f),F&4&&M!==null&&M.memoizedState.isDehydrated)try{aM(x.containerInfo)}catch(Sr){xa(f,f.return,Sr)}break;case 4:jf(x,f),H1(f);break;case 13:jf(x,f),H1(f),X=f.child,X.flags&8192&&(te=X.memoizedState!==null,X.stateNode.isHidden=te,!te||X.alternate!==null&&X.alternate.memoizedState!==null||(AW=La())),F&4&&d8e(f);break;case 22:if(mn=M!==null&&M.memoizedState!==null,f.mode&1?(mc=(Ot=mc)||mn,jf(x,f),mc=Ot):jf(x,f),H1(f),F&8192){if(Ot=f.memoizedState!==null,(f.stateNode.isHidden=Ot)&&!mn&&f.mode&1)for(fr=f,mn=f.child;mn!==null;){for(xn=fr=mn;fr!==null;){switch(hn=fr,rr=hn.child,hn.tag){case 0:case 11:case 14:case 15:NM(4,hn,hn.return);break;case 1:o_(hn,hn.return);var br=hn.stateNode;if(typeof br.componentWillUnmount=="function"){F=hn,M=hn.return;try{x=F,br.props=x.memoizedProps,br.state=x.memoizedState,br.componentWillUnmount()}catch(Sr){xa(F,M,Sr)}}break;case 5:o_(hn,hn.return);break;case 22:if(hn.memoizedState!==null){m8e(xn);continue}}rr!==null?(rr.return=hn,fr=rr):m8e(xn)}mn=mn.sibling}e:for(mn=null,xn=f;;){if(xn.tag===5){if(mn===null){mn=xn;try{X=xn.stateNode,Ot?(te=X.style,typeof te.setProperty=="function"?te.setProperty("display","none","important"):te.display="none"):(Be=xn.stateNode,rt=xn.memoizedProps.style,fe=rt!=null&&rt.hasOwnProperty("display")?rt.display:null,Be.style.display=Hye("display",fe))}catch(Sr){xa(f,f.return,Sr)}}}else if(xn.tag===6){if(mn===null)try{xn.stateNode.nodeValue=Ot?"":xn.memoizedProps}catch(Sr){xa(f,f.return,Sr)}}else if((xn.tag!==22&&xn.tag!==23||xn.memoizedState===null||xn===f)&&xn.child!==null){xn.child.return=xn,xn=xn.child;continue}if(xn===f)break e;for(;xn.sibling===null;){if(xn.return===null||xn.return===f)break e;mn===xn&&(mn=null),xn=xn.return}mn===xn&&(mn=null),xn.sibling.return=xn.return,xn=xn.sibling}}break;case 19:jf(x,f),H1(f),F&4&&d8e(f);break;case 21:break;default:jf(x,f),H1(f)}}function H1(f){var x=f.flags;if(x&2){try{e:{for(var M=f.return;M!==null;){if(l8e(M)){var F=M;break e}M=M.return}throw Error(g(160))}switch(F.tag){case 5:var X=F.stateNode;F.flags&32&&(ZE(X,""),F.flags&=-33);var te=c8e(f);EW(f,te,X);break;case 3:case 4:var fe=F.stateNode.containerInfo,Be=c8e(f);TW(f,Be,fe);break;default:throw Error(g(161))}}catch(rt){xa(f,f.return,rt)}f.flags&=-3}x&4096&&(f.flags&=-4097)}function _ze(f,x,M){fr=f,p8e(f)}function p8e(f,x,M){for(var F=(f.mode&1)!==0;fr!==null;){var X=fr,te=X.child;if(X.tag===22&&F){var fe=X.memoizedState!==null||CD;if(!fe){var Be=X.alternate,rt=Be!==null&&Be.memoizedState!==null||mc;Be=CD;var Ot=mc;if(CD=fe,(mc=rt)&&!Ot)for(fr=X;fr!==null;)fe=fr,rt=fe.child,fe.tag===22&&fe.memoizedState!==null?g8e(X):rt!==null?(rt.return=fe,fr=rt):g8e(X);for(;te!==null;)fr=te,p8e(te),te=te.sibling;fr=X,CD=Be,mc=Ot}f8e(f)}else X.subtreeFlags&8772&&te!==null?(te.return=X,fr=te):f8e(f)}}function f8e(f){for(;fr!==null;){var x=fr;if(x.flags&8772){var M=x.alternate;try{if(x.flags&8772)switch(x.tag){case 0:case 11:case 15:mc||AD(5,x);break;case 1:var F=x.stateNode;if(x.flags&4&&!mc)if(M===null)F.componentDidMount();else{var X=x.elementType===x.type?M.memoizedProps:Vf(x.type,M.memoizedProps);F.componentDidUpdate(X,M.memoizedState,F.__reactInternalSnapshotBeforeUpdate)}var te=x.updateQueue;te!==null&&uve(x,te,F);break;case 3:var fe=x.updateQueue;if(fe!==null){if(M=null,x.child!==null)switch(x.child.tag){case 5:M=x.child.stateNode;break;case 1:M=x.child.stateNode}uve(x,fe,M)}break;case 5:var Be=x.stateNode;if(M===null&&x.flags&4){M=Be;var rt=x.memoizedProps;switch(x.type){case"button":case"input":case"select":case"textarea":rt.autoFocus&&M.focus();break;case"img":rt.src&&(M.src=rt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(x.memoizedState===null){var Ot=x.alternate;if(Ot!==null){var mn=Ot.memoizedState;if(mn!==null){var xn=mn.dehydrated;xn!==null&&aM(xn)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(g(163))}mc||x.flags&512&&wW(x)}catch(hn){xa(x,x.return,hn)}}if(x===f){fr=null;break}if(M=x.sibling,M!==null){M.return=x.return,fr=M;break}fr=x.return}}function m8e(f){for(;fr!==null;){var x=fr;if(x===f){fr=null;break}var M=x.sibling;if(M!==null){M.return=x.return,fr=M;break}fr=x.return}}function g8e(f){for(;fr!==null;){var x=fr;try{switch(x.tag){case 0:case 11:case 15:var M=x.return;try{AD(4,x)}catch(rt){xa(x,M,rt)}break;case 1:var F=x.stateNode;if(typeof F.componentDidMount=="function"){var X=x.return;try{F.componentDidMount()}catch(rt){xa(x,X,rt)}}var te=x.return;try{wW(x)}catch(rt){xa(x,te,rt)}break;case 5:var fe=x.return;try{wW(x)}catch(rt){xa(x,fe,rt)}}}catch(rt){xa(x,x.return,rt)}if(x===f){fr=null;break}var Be=x.sibling;if(Be!==null){Be.return=x.return,fr=Be;break}fr=x.return}}var Sze=Math.ceil,ND=Ae.ReactCurrentDispatcher,MW=Ae.ReactCurrentOwner,hp=Ae.ReactCurrentBatchConfig,cs=0,Yl=null,Qa=null,P0=0,ih=0,a_=uy(0),gl=0,PM=null,a6=0,PD=0,CW=0,RM=null,id=null,AW=0,l_=1/0,x3=null,RD=!1,NW=null,gy=null,ID=!1,yy=null,kD=0,IM=0,PW=null,DD=-1,OD=0;function au(){return cs&6?La():DD!==-1?DD:DD=La()}function vy(f){return f.mode&1?cs&2&&P0!==0?P0&-P0:sze.transition!==null?(OD===0&&(OD=o5e()),OD):(f=Gs,f!==0||(f=window.event,f=f===void 0?16:m5e(f.type)),f):1}function Hf(f,x,M,F){if(50<IM)throw IM=0,PW=null,Error(g(185));nM(f,M,F),(!(cs&2)||f!==Yl)&&(f===Yl&&(!(cs&2)&&(PD|=M),gl===4&&xy(f,P0)),sd(f,F),M===1&&cs===0&&!(x.mode&1)&&(l_=La()+500,cD&&hy()))}function sd(f,x){var M=f.callbackNode;aUe(f,x);var F=Vk(f,f===Yl?P0:0);if(F===0)M!==null&&r5e(M),f.callbackNode=null,f.callbackPriority=0;else if(x=F&-F,f.callbackPriority!==x){if(M!=null&&r5e(M),x===1)f.tag===0?ize(v8e.bind(null,f)):tve(v8e.bind(null,f)),eze(function(){!(cs&6)&&hy()}),M=null;else{switch(a5e(F)){case 1:M=h$;break;case 4:M=i5e;break;case 16:M=Fk;break;case 536870912:M=s5e;break;default:M=Fk}M=M8e(M,y8e.bind(null,f))}f.callbackPriority=x,f.callbackNode=M}}function y8e(f,x){if(DD=-1,OD=0,cs&6)throw Error(g(327));var M=f.callbackNode;if(c_()&&f.callbackNode!==M)return null;var F=Vk(f,f===Yl?P0:0);if(F===0)return null;if(F&30||F&f.expiredLanes||x)x=LD(f,F);else{x=F;var X=cs;cs|=2;var te=b8e();(Yl!==f||P0!==x)&&(x3=null,l_=La()+500,c6(f,x));do try{Eze();break}catch(Be){x8e(f,Be)}while(!0);Y$(),ND.current=te,cs=X,Qa!==null?x=0:(Yl=null,P0=0,x=gl)}if(x!==0){if(x===2&&(X=p$(f),X!==0&&(F=X,x=RW(f,X))),x===1)throw M=PM,c6(f,0),xy(f,F),sd(f,La()),M;if(x===6)xy(f,F);else{if(X=f.current.alternate,!(F&30)&&!wze(X)&&(x=LD(f,F),x===2&&(te=p$(f),te!==0&&(F=te,x=RW(f,te))),x===1))throw M=PM,c6(f,0),xy(f,F),sd(f,La()),M;switch(f.finishedWork=X,f.finishedLanes=F,x){case 0:case 1:throw Error(g(345));case 2:u6(f,id,x3);break;case 3:if(xy(f,F),(F&130023424)===F&&(x=AW+500-La(),10<x)){if(Vk(f,0)!==0)break;if(X=f.suspendedLanes,(X&F)!==F){au(),f.pingedLanes|=f.suspendedLanes&X;break}f.timeoutHandle=B$(u6.bind(null,f,id,x3),x);break}u6(f,id,x3);break;case 4:if(xy(f,F),(F&4194240)===F)break;for(x=f.eventTimes,X=-1;0<F;){var fe=31-Bf(F);te=1<<fe,fe=x[fe],fe>X&&(X=fe),F&=~te}if(F=X,F=La()-F,F=(120>F?120:480>F?480:1080>F?1080:1920>F?1920:3e3>F?3e3:4320>F?4320:1960*Sze(F/1960))-F,10<F){f.timeoutHandle=B$(u6.bind(null,f,id,x3),F);break}u6(f,id,x3);break;case 5:u6(f,id,x3);break;default:throw Error(g(329))}}}return sd(f,La()),f.callbackNode===M?y8e.bind(null,f):null}function RW(f,x){var M=RM;return f.current.memoizedState.isDehydrated&&(c6(f,x).flags|=256),f=LD(f,x),f!==2&&(x=id,id=M,x!==null&&IW(x)),f}function IW(f){id===null?id=f:id.push.apply(id,f)}function wze(f){for(var x=f;;){if(x.flags&16384){var M=x.updateQueue;if(M!==null&&(M=M.stores,M!==null))for(var F=0;F<M.length;F++){var X=M[F],te=X.getSnapshot;X=X.value;try{if(!Uf(te(),X))return!1}catch{return!1}}}if(M=x.child,x.subtreeFlags&16384&&M!==null)M.return=x,x=M;else{if(x===f)break;for(;x.sibling===null;){if(x.return===null||x.return===f)return!0;x=x.return}x.sibling.return=x.return,x=x.sibling}}return!0}function xy(f,x){for(x&=~CW,x&=~PD,f.suspendedLanes|=x,f.pingedLanes&=~x,f=f.expirationTimes;0<x;){var M=31-Bf(x),F=1<<M;f[M]=-1,x&=~F}}function v8e(f){if(cs&6)throw Error(g(327));c_();var x=Vk(f,0);if(!(x&1))return sd(f,La()),null;var M=LD(f,x);if(f.tag!==0&&M===2){var F=p$(f);F!==0&&(x=F,M=RW(f,F))}if(M===1)throw M=PM,c6(f,0),xy(f,x),sd(f,La()),M;if(M===6)throw Error(g(345));return f.finishedWork=f.current.alternate,f.finishedLanes=x,u6(f,id,x3),sd(f,La()),null}function kW(f,x){var M=cs;cs|=1;try{return f(x)}finally{cs=M,cs===0&&(l_=La()+500,cD&&hy())}}function l6(f){yy!==null&&yy.tag===0&&!(cs&6)&&c_();var x=cs;cs|=1;var M=hp.transition,F=Gs;try{if(hp.transition=null,Gs=1,f)return f()}finally{Gs=F,hp.transition=M,cs=x,!(cs&6)&&hy()}}function DW(){ih=a_.current,Ao(a_)}function c6(f,x){f.finishedWork=null,f.finishedLanes=0;var M=f.timeoutHandle;if(M!==-1&&(f.timeoutHandle=-1,JUe(M)),Qa!==null)for(M=Qa.return;M!==null;){var F=M;switch(H$(F),F.tag){case 1:F=F.type.childContextTypes,F!=null&&aD();break;case 3:i_(),Ao(td),Ao(hc),sW();break;case 5:rW(F);break;case 4:i_();break;case 13:Ao(ta);break;case 19:Ao(ta);break;case 10:K$(F.type._context);break;case 22:case 23:DW()}M=M.return}if(Yl=f,Qa=f=by(f.current,null),P0=ih=x,gl=0,PM=null,CW=PD=a6=0,id=RM=null,i6!==null){for(x=0;x<i6.length;x++)if(M=i6[x],F=M.interleaved,F!==null){M.interleaved=null;var X=F.next,te=M.pending;if(te!==null){var fe=te.next;te.next=X,F.next=fe}M.pending=F}i6=null}return f}function x8e(f,x){do{var M=Qa;try{if(Y$(),bD.current=TD,_D){for(var F=na.memoizedState;F!==null;){var X=F.queue;X!==null&&(X.pending=null),F=F.next}_D=!1}if(o6=0,Xl=ml=na=null,TM=!1,EM=0,MW.current=null,M===null||M.return===null){gl=1,PM=x,Qa=null;break}e:{var te=f,fe=M.return,Be=M,rt=x;if(x=P0,Be.flags|=32768,rt!==null&&typeof rt=="object"&&typeof rt.then=="function"){var Ot=rt,mn=Be,xn=mn.tag;if(!(mn.mode&1)&&(xn===0||xn===11||xn===15)){var hn=mn.alternate;hn?(mn.updateQueue=hn.updateQueue,mn.memoizedState=hn.memoizedState,mn.lanes=hn.lanes):(mn.updateQueue=null,mn.memoizedState=null)}var rr=jve(fe);if(rr!==null){rr.flags&=-257,Hve(rr,fe,Be,te,x),rr.mode&1&&Gve(te,Ot,x),x=rr,rt=Ot;var br=x.updateQueue;if(br===null){var Sr=new Set;Sr.add(rt),x.updateQueue=Sr}else br.add(rt);break e}else{if(!(x&1)){Gve(te,Ot,x),OW();break e}rt=Error(g(426))}}else if(Fo&&Be.mode&1){var Fa=jve(fe);if(Fa!==null){!(Fa.flags&65536)&&(Fa.flags|=256),Hve(Fa,fe,Be,te,x),q$(s_(rt,Be));break e}}te=rt=s_(rt,Be),gl!==4&&(gl=2),RM===null?RM=[te]:RM.push(te),te=fe;do{switch(te.tag){case 3:te.flags|=65536,x&=-x,te.lanes|=x;var Tt=zve(te,rt,x);cve(te,Tt);break e;case 1:Be=rt;var dt=te.type,Nt=te.stateNode;if(!(te.flags&128)&&(typeof dt.getDerivedStateFromError=="function"||Nt!==null&&typeof Nt.componentDidCatch=="function"&&(gy===null||!gy.has(Nt)))){te.flags|=65536,x&=-x,te.lanes|=x;var Mn=Vve(te,Be,x);cve(te,Mn);break e}}te=te.return}while(te!==null)}S8e(M)}catch(Mr){x=Mr,Qa===M&&M!==null&&(Qa=M=M.return);continue}break}while(!0)}function b8e(){var f=ND.current;return ND.current=TD,f===null?TD:f}function OW(){(gl===0||gl===3||gl===2)&&(gl=4),Yl===null||!(a6&268435455)&&!(PD&268435455)||xy(Yl,P0)}function LD(f,x){var M=cs;cs|=2;var F=b8e();(Yl!==f||P0!==x)&&(x3=null,c6(f,x));do try{Tze();break}catch(X){x8e(f,X)}while(!0);if(Y$(),cs=M,ND.current=F,Qa!==null)throw Error(g(261));return Yl=null,P0=0,gl}function Tze(){for(;Qa!==null;)_8e(Qa)}function Eze(){for(;Qa!==null&&!QBe();)_8e(Qa)}function _8e(f){var x=E8e(f.alternate,f,ih);f.memoizedProps=f.pendingProps,x===null?S8e(f):Qa=x,MW.current=null}function S8e(f){var x=f;do{var M=x.alternate;if(f=x.return,x.flags&32768){if(M=vze(M,x),M!==null){M.flags&=32767,Qa=M;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{gl=6,Qa=null;return}}else if(M=yze(M,x,ih),M!==null){Qa=M;return}if(x=x.sibling,x!==null){Qa=x;return}Qa=x=f}while(x!==null);gl===0&&(gl=5)}function u6(f,x,M){var F=Gs,X=hp.transition;try{hp.transition=null,Gs=1,Mze(f,x,M,F)}finally{hp.transition=X,Gs=F}return null}function Mze(f,x,M,F){do c_();while(yy!==null);if(cs&6)throw Error(g(327));M=f.finishedWork;var X=f.finishedLanes;if(M===null)return null;if(f.finishedWork=null,f.finishedLanes=0,M===f.current)throw Error(g(177));f.callbackNode=null,f.callbackPriority=0;var te=M.lanes|M.childLanes;if(lUe(f,te),f===Yl&&(Qa=Yl=null,P0=0),!(M.subtreeFlags&2064)&&!(M.flags&2064)||ID||(ID=!0,M8e(Fk,function(){return c_(),null})),te=(M.flags&15990)!==0,M.subtreeFlags&15990||te){te=hp.transition,hp.transition=null;var fe=Gs;Gs=1;var Be=cs;cs|=4,MW.current=null,bze(f,M),h8e(M,f),XUe(L$),Hk=!!O$,L$=O$=null,f.current=M,_ze(M),JBe(),cs=Be,Gs=fe,hp.transition=te}else f.current=M;if(ID&&(ID=!1,yy=f,kD=X),te=f.pendingLanes,te===0&&(gy=null),nUe(M.stateNode),sd(f,La()),x!==null)for(F=f.onRecoverableError,M=0;M<x.length;M++)X=x[M],F(X.value,{componentStack:X.stack,digest:X.digest});if(RD)throw RD=!1,f=NW,NW=null,f;return kD&1&&f.tag!==0&&c_(),te=f.pendingLanes,te&1?f===PW?IM++:(IM=0,PW=f):IM=0,hy(),null}function c_(){if(yy!==null){var f=a5e(kD),x=hp.transition,M=Gs;try{if(hp.transition=null,Gs=16>f?16:f,yy===null)var F=!1;else{if(f=yy,yy=null,kD=0,cs&6)throw Error(g(331));var X=cs;for(cs|=4,fr=f.current;fr!==null;){var te=fr,fe=te.child;if(fr.flags&16){var Be=te.deletions;if(Be!==null){for(var rt=0;rt<Be.length;rt++){var Ot=Be[rt];for(fr=Ot;fr!==null;){var mn=fr;switch(mn.tag){case 0:case 11:case 15:NM(8,mn,te)}var xn=mn.child;if(xn!==null)xn.return=mn,fr=xn;else for(;fr!==null;){mn=fr;var hn=mn.sibling,rr=mn.return;if(a8e(mn),mn===Ot){fr=null;break}if(hn!==null){hn.return=rr,fr=hn;break}fr=rr}}}var br=te.alternate;if(br!==null){var Sr=br.child;if(Sr!==null){br.child=null;do{var Fa=Sr.sibling;Sr.sibling=null,Sr=Fa}while(Sr!==null)}}fr=te}}if(te.subtreeFlags&2064&&fe!==null)fe.return=te,fr=fe;else e:for(;fr!==null;){if(te=fr,te.flags&2048)switch(te.tag){case 0:case 11:case 15:NM(9,te,te.return)}var Tt=te.sibling;if(Tt!==null){Tt.return=te.return,fr=Tt;break e}fr=te.return}}var dt=f.current;for(fr=dt;fr!==null;){fe=fr;var Nt=fe.child;if(fe.subtreeFlags&2064&&Nt!==null)Nt.return=fe,fr=Nt;else e:for(fe=dt;fr!==null;){if(Be=fr,Be.flags&2048)try{switch(Be.tag){case 0:case 11:case 15:AD(9,Be)}}catch(Mr){xa(Be,Be.return,Mr)}if(Be===fe){fr=null;break e}var Mn=Be.sibling;if(Mn!==null){Mn.return=Be.return,fr=Mn;break e}fr=Be.return}}if(cs=X,hy(),z1&&typeof z1.onPostCommitFiberRoot=="function")try{z1.onPostCommitFiberRoot(Bk,f)}catch{}F=!0}return F}finally{Gs=M,hp.transition=x}}return!1}function w8e(f,x,M){x=s_(M,x),x=zve(f,x,1),f=fy(f,x,1),x=au(),f!==null&&(nM(f,1,x),sd(f,x))}function xa(f,x,M){if(f.tag===3)w8e(f,f,M);else for(;x!==null;){if(x.tag===3){w8e(x,f,M);break}else if(x.tag===1){var F=x.stateNode;if(typeof x.type.getDerivedStateFromError=="function"||typeof F.componentDidCatch=="function"&&(gy===null||!gy.has(F))){f=s_(M,f),f=Vve(x,f,1),x=fy(x,f,1),f=au(),x!==null&&(nM(x,1,f),sd(x,f));break}}x=x.return}}function Cze(f,x,M){var F=f.pingCache;F!==null&&F.delete(x),x=au(),f.pingedLanes|=f.suspendedLanes&M,Yl===f&&(P0&M)===M&&(gl===4||gl===3&&(P0&130023424)===P0&&500>La()-AW?c6(f,0):CW|=M),sd(f,x)}function T8e(f,x){x===0&&(f.mode&1?(x=zk,zk<<=1,!(zk&130023424)&&(zk=4194304)):x=1);var M=au();f=g3(f,x),f!==null&&(nM(f,x,M),sd(f,M))}function Aze(f){var x=f.memoizedState,M=0;x!==null&&(M=x.retryLane),T8e(f,M)}function Nze(f,x){var M=0;switch(f.tag){case 13:var F=f.stateNode,X=f.memoizedState;X!==null&&(M=X.retryLane);break;case 19:F=f.stateNode;break;default:throw Error(g(314))}F!==null&&F.delete(x),T8e(f,M)}var E8e;E8e=function(f,x,M){if(f!==null)if(f.memoizedProps!==x.pendingProps||td.current)rd=!0;else{if(!(f.lanes&M)&&!(x.flags&128))return rd=!1,gze(f,x,M);rd=!!(f.flags&131072)}else rd=!1,Fo&&x.flags&1048576&&nve(x,dD,x.index);switch(x.lanes=0,x.tag){case 2:var F=x.type;MD(f,x),f=x.pendingProps;var X=Zb(x,hc.current);n_(x,M),X=lW(null,x,F,f,X,M);var te=cW();return x.flags|=1,typeof X=="object"&&X!==null&&typeof X.render=="function"&&X.$$typeof===void 0?(x.tag=1,x.memoizedState=null,x.updateQueue=null,nd(F)?(te=!0,lD(x)):te=!1,x.memoizedState=X.state!==null&&X.state!==void 0?X.state:null,J$(x),X.updater=yD,x.stateNode=X,X._reactInternals=x,tW(x,F,f,M),x=yW(null,x,F,!0,te,M)):(x.tag=0,Fo&&te&&j$(x),ou(null,x,X,M),x=x.child),x;case 16:F=x.elementType;e:{switch(MD(f,x),f=x.pendingProps,X=F._init,F=X(F._payload),x.type=F,X=x.tag=Rze(F),f=Vf(F,f),X){case 0:x=gW(null,x,F,f,M);break e;case 1:x=Kve(null,x,F,f,M);break e;case 11:x=$ve(null,x,F,f,M);break e;case 14:x=Wve(null,x,F,Vf(F.type,f),M);break e}throw Error(g(306,F,""))}return x;case 0:return F=x.type,X=x.pendingProps,X=x.elementType===F?X:Vf(F,X),gW(f,x,F,X,M);case 1:return F=x.type,X=x.pendingProps,X=x.elementType===F?X:Vf(F,X),Kve(f,x,F,X,M);case 3:e:{if(Zve(x),f===null)throw Error(g(387));F=x.pendingProps,te=x.memoizedState,X=te.element,lve(f,x),gD(x,F,null,M);var fe=x.memoizedState;if(F=fe.element,te.isDehydrated)if(te={element:F,isDehydrated:!1,cache:fe.cache,pendingSuspenseBoundaries:fe.pendingSuspenseBoundaries,transitions:fe.transitions},x.updateQueue.baseState=te,x.memoizedState=te,x.flags&256){X=s_(Error(g(423)),x),x=Qve(f,x,F,M,X);break e}else if(F!==X){X=s_(Error(g(424)),x),x=Qve(f,x,F,M,X);break e}else for(rh=cy(x.stateNode.containerInfo.firstChild),nh=x,Fo=!0,zf=null,M=yve(x,null,F,M),x.child=M;M;)M.flags=M.flags&-3|4096,M=M.sibling;else{if(e_(),F===X){x=v3(f,x,M);break e}ou(f,x,F,M)}x=x.child}return x;case 5:return vve(x),f===null&&W$(x),F=x.type,X=x.pendingProps,te=f!==null?f.memoizedProps:null,fe=X.children,F$(F,X)?fe=null:te!==null&&F$(F,te)&&(x.flags|=32),Yve(f,x),ou(f,x,fe,M),x.child;case 6:return f===null&&W$(x),null;case 13:return Jve(f,x,M);case 4:return nW(x,x.stateNode.containerInfo),F=x.pendingProps,f===null?x.child=r_(x,null,F,M):ou(f,x,F,M),x.child;case 11:return F=x.type,X=x.pendingProps,X=x.elementType===F?X:Vf(F,X),$ve(f,x,F,X,M);case 7:return ou(f,x,x.pendingProps,M),x.child;case 8:return ou(f,x,x.pendingProps.children,M),x.child;case 12:return ou(f,x,x.pendingProps.children,M),x.child;case 10:e:{if(F=x.type._context,X=x.pendingProps,te=x.memoizedProps,fe=X.value,ho(pD,F._currentValue),F._currentValue=fe,te!==null)if(Uf(te.value,fe)){if(te.children===X.children&&!td.current){x=v3(f,x,M);break e}}else for(te=x.child,te!==null&&(te.return=x);te!==null;){var Be=te.dependencies;if(Be!==null){fe=te.child;for(var rt=Be.firstContext;rt!==null;){if(rt.context===F){if(te.tag===1){rt=y3(-1,M&-M),rt.tag=2;var Ot=te.updateQueue;if(Ot!==null){Ot=Ot.shared;var mn=Ot.pending;mn===null?rt.next=rt:(rt.next=mn.next,mn.next=rt),Ot.pending=rt}}te.lanes|=M,rt=te.alternate,rt!==null&&(rt.lanes|=M),Z$(te.return,M,x),Be.lanes|=M;break}rt=rt.next}}else if(te.tag===10)fe=te.type===x.type?null:te.child;else if(te.tag===18){if(fe=te.return,fe===null)throw Error(g(341));fe.lanes|=M,Be=fe.alternate,Be!==null&&(Be.lanes|=M),Z$(fe,M,x),fe=te.sibling}else fe=te.child;if(fe!==null)fe.return=te;else for(fe=te;fe!==null;){if(fe===x){fe=null;break}if(te=fe.sibling,te!==null){te.return=fe.return,fe=te;break}fe=fe.return}te=fe}ou(f,x,X.children,M),x=x.child}return x;case 9:return X=x.type,F=x.pendingProps.children,n_(x,M),X=up(X),F=F(X),x.flags|=1,ou(f,x,F,M),x.child;case 14:return F=x.type,X=Vf(F,x.pendingProps),X=Vf(F.type,X),Wve(f,x,F,X,M);case 15:return qve(f,x,x.type,x.pendingProps,M);case 17:return F=x.type,X=x.pendingProps,X=x.elementType===F?X:Vf(F,X),MD(f,x),x.tag=1,nd(F)?(f=!0,lD(x)):f=!1,n_(x,M),pve(x,F,X),tW(x,F,X,M),yW(null,x,F,!0,f,M);case 19:return t8e(f,x,M);case 22:return Xve(f,x,M)}throw Error(g(156,x.tag))};function M8e(f,x){return n5e(f,x)}function Pze(f,x,M,F){this.tag=f,this.key=M,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=x,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=F,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pp(f,x,M,F){return new Pze(f,x,M,F)}function LW(f){return f=f.prototype,!(!f||!f.isReactComponent)}function Rze(f){if(typeof f=="function")return LW(f)?1:0;if(f!=null){if(f=f.$$typeof,f===Bt)return 11;if(f===gt)return 14}return 2}function by(f,x){var M=f.alternate;return M===null?(M=pp(f.tag,x,f.key,f.mode),M.elementType=f.elementType,M.type=f.type,M.stateNode=f.stateNode,M.alternate=f,f.alternate=M):(M.pendingProps=x,M.type=f.type,M.flags=0,M.subtreeFlags=0,M.deletions=null),M.flags=f.flags&14680064,M.childLanes=f.childLanes,M.lanes=f.lanes,M.child=f.child,M.memoizedProps=f.memoizedProps,M.memoizedState=f.memoizedState,M.updateQueue=f.updateQueue,x=f.dependencies,M.dependencies=x===null?null:{lanes:x.lanes,firstContext:x.firstContext},M.sibling=f.sibling,M.index=f.index,M.ref=f.ref,M}function FD(f,x,M,F,X,te){var fe=2;if(F=f,typeof f=="function")LW(f)&&(fe=1);else if(typeof f=="string")fe=5;else e:switch(f){case Le:return d6(M.children,X,te,x);case Se:fe=8,X|=8;break;case Ge:return f=pp(12,M,x,X|2),f.elementType=Ge,f.lanes=te,f;case Qe:return f=pp(13,M,x,X),f.elementType=Qe,f.lanes=te,f;case Zt:return f=pp(19,M,x,X),f.elementType=Zt,f.lanes=te,f;case Ce:return BD(M,X,te,x);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case Je:fe=10;break e;case He:fe=9;break e;case Bt:fe=11;break e;case gt:fe=14;break e;case it:fe=16,F=null;break e}throw Error(g(130,f==null?f:typeof f,""))}return x=pp(fe,M,x,X),x.elementType=f,x.type=F,x.lanes=te,x}function d6(f,x,M,F){return f=pp(7,f,F,x),f.lanes=M,f}function BD(f,x,M,F){return f=pp(22,f,F,x),f.elementType=Ce,f.lanes=M,f.stateNode={isHidden:!1},f}function FW(f,x,M){return f=pp(6,f,null,x),f.lanes=M,f}function BW(f,x,M){return x=pp(4,f.children!==null?f.children:[],f.key,x),x.lanes=M,x.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},x}function Ize(f,x,M,F,X){this.tag=x,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=f$(0),this.expirationTimes=f$(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=f$(0),this.identifierPrefix=F,this.onRecoverableError=X,this.mutableSourceEagerHydrationData=null}function UW(f,x,M,F,X,te,fe,Be,rt){return f=new Ize(f,x,M,Be,rt),x===1?(x=1,te===!0&&(x|=8)):x=0,te=pp(3,null,null,x),f.current=te,te.stateNode=f,te.memoizedState={element:F,isDehydrated:M,cache:null,transitions:null,pendingSuspenseBoundaries:null},J$(te),f}function kze(f,x,M){var F=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ft,key:F==null?null:""+F,children:f,containerInfo:x,implementation:M}}function C8e(f){if(!f)return dy;f=f._reactInternals;e:{if(J8(f)!==f||f.tag!==1)throw Error(g(170));var x=f;do{switch(x.tag){case 3:x=x.stateNode.context;break e;case 1:if(nd(x.type)){x=x.stateNode.__reactInternalMemoizedMergedChildContext;break e}}x=x.return}while(x!==null);throw Error(g(171))}if(f.tag===1){var M=f.type;if(nd(M))return J5e(f,M,x)}return x}function A8e(f,x,M,F,X,te,fe,Be,rt){return f=UW(M,F,!0,f,X,te,fe,Be,rt),f.context=C8e(null),M=f.current,F=au(),X=vy(M),te=y3(F,X),te.callback=x??null,fy(M,te,X),f.current.lanes=X,nM(f,X,F),sd(f,F),f}function UD(f,x,M,F){var X=x.current,te=au(),fe=vy(X);return M=C8e(M),x.context===null?x.context=M:x.pendingContext=M,x=y3(te,fe),x.payload={element:f},F=F===void 0?null:F,F!==null&&(x.callback=F),f=fy(X,x,fe),f!==null&&(Hf(f,X,fe,te),mD(f,X,fe)),fe}function zD(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function N8e(f,x){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var M=f.retryLane;f.retryLane=M!==0&&M<x?M:x}}function zW(f,x){N8e(f,x),(f=f.alternate)&&N8e(f,x)}function Dze(){return null}var P8e=typeof reportError=="function"?reportError:function(f){console.error(f)};function VW(f){this._internalRoot=f}VD.prototype.render=VW.prototype.render=function(f){var x=this._internalRoot;if(x===null)throw Error(g(409));UD(f,x,null,null)},VD.prototype.unmount=VW.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var x=f.containerInfo;l6(function(){UD(null,f,null,null)}),x[h3]=null}};function VD(f){this._internalRoot=f}VD.prototype.unstable_scheduleHydration=function(f){if(f){var x=u5e();f={blockedOn:null,target:f,priority:x};for(var M=0;M<oy.length&&x!==0&&x<oy[M].priority;M++);oy.splice(M,0,f),M===0&&p5e(f)}};function GW(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function GD(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function R8e(){}function Oze(f,x,M,F,X){if(X){if(typeof F=="function"){var te=F;F=function(){var Ot=zD(fe);te.call(Ot)}}var fe=A8e(x,F,f,0,null,!1,!1,"",R8e);return f._reactRootContainer=fe,f[h3]=fe.current,gM(f.nodeType===8?f.parentNode:f),l6(),fe}for(;X=f.lastChild;)f.removeChild(X);if(typeof F=="function"){var Be=F;F=function(){var Ot=zD(rt);Be.call(Ot)}}var rt=UW(f,0,!1,null,null,!1,!1,"",R8e);return f._reactRootContainer=rt,f[h3]=rt.current,gM(f.nodeType===8?f.parentNode:f),l6(function(){UD(x,rt,M,F)}),rt}function jD(f,x,M,F,X){var te=M._reactRootContainer;if(te){var fe=te;if(typeof X=="function"){var Be=X;X=function(){var rt=zD(fe);Be.call(rt)}}UD(x,fe,f,X)}else fe=Oze(M,x,f,X,F);return zD(fe)}l5e=function(f){switch(f.tag){case 3:var x=f.stateNode;if(x.current.memoizedState.isDehydrated){var M=tM(x.pendingLanes);M!==0&&(m$(x,M|1),sd(x,La()),!(cs&6)&&(l_=La()+500,hy()))}break;case 13:l6(function(){var F=g3(f,1);if(F!==null){var X=au();Hf(F,f,1,X)}}),zW(f,1)}},g$=function(f){if(f.tag===13){var x=g3(f,134217728);if(x!==null){var M=au();Hf(x,f,134217728,M)}zW(f,134217728)}},c5e=function(f){if(f.tag===13){var x=vy(f),M=g3(f,x);if(M!==null){var F=au();Hf(M,f,x,F)}zW(f,x)}},u5e=function(){return Gs},d5e=function(f,x){var M=Gs;try{return Gs=f,x()}finally{Gs=M}},l$=function(f,x,M){switch(x){case"input":if(Ri(f,M),x=M.name,M.type==="radio"&&x!=null){for(M=f;M.parentNode;)M=M.parentNode;for(M=M.querySelectorAll("input[name="+JSON.stringify(""+x)+'][type="radio"]'),x=0;x<M.length;x++){var F=M[x];if(F!==f&&F.form===f.form){var X=oD(F);if(!X)throw Error(g(90));Ei(F),Ri(F,X)}}}break;case"textarea":yi(f,M);break;case"select":x=M.value,x!=null&&ed(f,!!M.multiple,x,!1)}},Yye=kW,Kye=l6;var Lze={usingClientEntryPoint:!1,Events:[xM,Yb,oD,qye,Xye,kW]},kM={findFiberByHostInstance:e6,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Fze={bundleType:kM.bundleType,version:kM.version,rendererPackageName:kM.rendererPackageName,rendererConfig:kM.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ae.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=e5e(f),f===null?null:f.stateNode},findFiberByHostInstance:kM.findFiberByHostInstance||Dze,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&(DM=__REACT_DEVTOOLS_GLOBAL_HOOK__,!DM.isDisabled&&DM.supportsFiber))try{Bk=DM.inject(Fze),z1=DM}catch{}var DM;a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Lze,a.createPortal=function(f,x){var M=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!GW(x))throw Error(g(200));return kze(f,x,null,M)},a.createRoot=function(f,x){if(!GW(f))throw Error(g(299));var M=!1,F="",X=P8e;return x!=null&&(x.unstable_strictMode===!0&&(M=!0),x.identifierPrefix!==void 0&&(F=x.identifierPrefix),x.onRecoverableError!==void 0&&(X=x.onRecoverableError)),x=UW(f,1,!1,null,null,M,!1,F,X),f[h3]=x.current,gM(f.nodeType===8?f.parentNode:f),new VW(x)},a.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var x=f._reactInternals;if(x===void 0)throw typeof f.render=="function"?Error(g(188)):(f=Object.keys(f).join(","),Error(g(268,f)));return f=e5e(x),f=f===null?null:f.stateNode,f},a.flushSync=function(f){return l6(f)},a.hydrate=function(f,x,M){if(!GD(x))throw Error(g(200));return jD(null,f,x,!0,M)},a.hydrateRoot=function(f,x,M){if(!GW(f))throw Error(g(405));var F=M!=null&&M.hydratedSources||null,X=!1,te="",fe=P8e;if(M!=null&&(M.unstable_strictMode===!0&&(X=!0),M.identifierPrefix!==void 0&&(te=M.identifierPrefix),M.onRecoverableError!==void 0&&(fe=M.onRecoverableError)),x=A8e(x,null,f,1,M??null,X,!1,te,fe),f[h3]=x.current,gM(f),F)for(f=0;f<F.length;f++)M=F[f],X=M._getVersion,X=X(M._source),x.mutableSourceEagerHydrationData==null?x.mutableSourceEagerHydrationData=[M,X]:x.mutableSourceEagerHydrationData.push(M,X);return new VD(x)},a.render=function(f,x,M){if(!GD(x))throw Error(g(200));return jD(null,f,x,!1,M)},a.unmountComponentAtNode=function(f){if(!GD(f))throw Error(g(40));return f._reactRootContainer?(l6(function(){jD(null,null,f,!1,function(){f._reactRootContainer=null,f[h3]=null})}),!0):!1},a.unstable_batchedUpdates=kW,a.unstable_renderSubtreeIntoContainer=function(f,x,M,F){if(!GD(M))throw Error(g(200));if(f==null||f._reactInternals===void 0)throw Error(g(38));return jD(f,x,M,!1,F)},a.version="18.2.0-next-9e3b772b8-20220608"}),H2=Z((a,u)=>{function d(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(d)}catch(g){console.error(g)}}d(),u.exports=ONe()});function LNe(a){let[,u]=(0,D4.useState)(0);return(0,D4.useCallback)(()=>{u(d=>d+1)},[])}function di(a,u,d){let g=(0,D4.useCallback)(a,u),_=(0,D4.useRef)(null);_.current?_.current.set(g):_.current=new kP.Atom(g);let T=(0,D4.useRef)(null);return T.current||(T.current=(0,kP.prism)(()=>_.current.prism.getValue()())),OJ(T.current,d)}function FNe(){DP||(DP=!0,(0,LJ.default)(()=>{(0,FJ.unstable_batchedUpdates)(function(){for(var a,u;mf.length>0;){let d=mf.shift();O7.delete(d);let g;d8&&((a=d.debug)==null||a.history.push("queue reached"));try{g=d.der.getValue()}catch(_){d8&&((u=d.debug)==null||u.history.push("queue: der.getValue() errored")),console.error("A `der.getValue()` in `usePrismInstance(der)` threw an error. This may be a zombie child issue, so we're gonna try to get its value again in a normal react render phase.If you see the same error again, then you either have an error in your prism code, or the deps array in `usePrism(fn, deps)` is missing a dependency and causing the prism to read stale values."),console.error(_),d.runUpdate();continue}g!==d.lastValue&&(d.lastValue=g,d.runUpdate())}DP=!1},1)}))}function OJ(a,u){var d;let g=LNe(),_=(0,D4.useRef)(void 0);_.current||(BU++,_.current={order:BU,runUpdate:()=>{_.current.unmounted||g()},der:a,lastValue:void 0,unmounted:!1,queueUpdate:()=>{var N;d8&&((N=_.current.debug)==null||N.history.push("queueUpdate()")),BJ(_.current)},untap:a.onStale(()=>{d8&&_.current.debug.history.push("onStale(cb)"),_.current.queueUpdate()})},d8&&(_.current.debug={label:u,traceOfFirstTimeRender:new Error,history:[]})),(0,D4.useLayoutEffect)(()=>function(){_.current.unmounted=!0,_.current.untap(),UU(_.current)},[]),UU(_.current);let T=_.current.der.getValue();return _.current.lastValue=T,d8&&((d=_.current.debug)==null||d.history.push("rendered")),T}var kP,LJ,D4,FJ,d8,ti,BU,mf,O7,DP,BJ,UJ,UU,Ar=C(()=>{kP=un(),b0(),LJ=z(RNe()),D4=z(nt()),FJ=z(H2()),d8=!1,ti=(a,u)=>di(()=>(0,kP.val)(a),[a],u),BU=0,mf=[],O7=new Set,DP=!1,BJ=a=>{UJ(a),FNe()},UJ=a=>{if(!O7.has(a))if(O7.add(a),mf.length===0)mf.push(a);else{let u=l8(mf,d=>d.order>=a.order);u===-1?mf.push(a):mf[u].order>a.order&&mf.splice(u,0,a)}},UU=a=>{if(!O7.has(a))return;O7.delete(a);let u=l8(mf,d=>d===a);mf.splice(u,1)}}),BNe=Z(a=>{var u=60103,d=60106,g=60107,_=60108,T=60114,N=60109,R=60110,O=60112,B=60113,V=60120,Y=60115,W=60116,$=60121,K=60122,J=60117,oe=60129,ae=60131;typeof Symbol=="function"&&Symbol.for&&(ue=Symbol.for,u=ue("react.element"),d=ue("react.portal"),g=ue("react.fragment"),_=ue("react.strict_mode"),T=ue("react.profiler"),N=ue("react.provider"),R=ue("react.context"),O=ue("react.forward_ref"),B=ue("react.suspense"),V=ue("react.suspense_list"),Y=ue("react.memo"),W=ue("react.lazy"),$=ue("react.block"),K=ue("react.server.block"),J=ue("react.fundamental"),oe=ue("react.debug_trace_mode"),ae=ue("react.legacy_hidden"));var ue;function xe(Qe){if(typeof Qe=="object"&&Qe!==null){var Zt=Qe.$$typeof;switch(Zt){case u:switch(Qe=Qe.type,Qe){case g:case T:case _:case B:case V:return Qe;default:switch(Qe=Qe&&Qe.$$typeof,Qe){case R:case O:case W:case Y:case N:return Qe;default:return Zt}}case d:return Zt}}}var Re=N,Ae=u,we=O,ft=g,Le=W,Se=Y,Ge=d,Je=T,He=_,Bt=B;a.ContextConsumer=R,a.ContextProvider=Re,a.Element=Ae,a.ForwardRef=we,a.Fragment=ft,a.Lazy=Le,a.Memo=Se,a.Portal=Ge,a.Profiler=Je,a.StrictMode=He,a.Suspense=Bt,a.isAsyncMode=function(){return!1},a.isConcurrentMode=function(){return!1},a.isContextConsumer=function(Qe){return xe(Qe)===R},a.isContextProvider=function(Qe){return xe(Qe)===N},a.isElement=function(Qe){return typeof Qe=="object"&&Qe!==null&&Qe.$$typeof===u},a.isForwardRef=function(Qe){return xe(Qe)===O},a.isFragment=function(Qe){return xe(Qe)===g},a.isLazy=function(Qe){return xe(Qe)===W},a.isMemo=function(Qe){return xe(Qe)===Y},a.isPortal=function(Qe){return xe(Qe)===d},a.isProfiler=function(Qe){return xe(Qe)===T},a.isStrictMode=function(Qe){return xe(Qe)===_},a.isSuspense=function(Qe){return xe(Qe)===B},a.isValidElementType=function(Qe){return typeof Qe=="string"||typeof Qe=="function"||Qe===g||Qe===T||Qe===oe||Qe===_||Qe===B||Qe===V||Qe===ae||typeof Qe=="object"&&Qe!==null&&(Qe.$$typeof===W||Qe.$$typeof===Y||Qe.$$typeof===N||Qe.$$typeof===R||Qe.$$typeof===O||Qe.$$typeof===J||Qe.$$typeof===$||Qe[0]===K)},a.typeOf=xe}),UNe=Z((a,u)=>{u.exports=BNe()}),zJ=Z((a,u)=>{u.exports=function(d,g,_,T){var N=_?_.call(T,d,g):void 0;if(N!==void 0)return!!N;if(d===g)return!0;if(typeof d!="object"||!d||typeof g!="object"||!g)return!1;var R=Object.keys(d),O=Object.keys(g);if(R.length!==O.length)return!1;for(var B=Object.prototype.hasOwnProperty.bind(g),V=0;V<R.length;V++){var Y=R[V];if(!B(Y))return!1;var W=d[Y],$=g[Y];if(N=_?_.call(T,W,$,Y):void 0,N===!1||N===void 0&&W!==$)return!1}return!0}});function zNe(a){function u(at,$t,Qt,Et,Te){for(var vt=0,Mt=0,En=0,pr=0,wr,Or,Ei=0,Vs=0,li,Mo=li=wr=0,Si=0,Ri=0,Wl=0,ea=0,op=Qt.length,ed=op-1,ql,ei="",yi="",d3="",Bb="",ap;Si<op;){if(Or=Qt.charCodeAt(Si),Si===ed&&Mt+pr+En+vt!==0&&(Mt!==0&&(Or=Mt===47?10:47),pr=En=vt=0,op++,ed++),Mt+pr+En+vt===0){if(Si===ed&&(0<Ri&&(ei=ei.replace(W,"")),0<ei.trim().length)){switch(Or){case 32:case 9:case 59:case 13:case 10:break;default:ei+=Qt.charAt(Si)}Or=59}switch(Or){case 123:for(ei=ei.trim(),wr=ei.charCodeAt(0),li=1,ea=++Si;Si<op;){switch(Or=Qt.charCodeAt(Si)){case 123:li++;break;case 125:li--;break;case 47:switch(Or=Qt.charCodeAt(Si+1)){case 42:case 47:e:{for(Mo=Si+1;Mo<ed;++Mo)switch(Qt.charCodeAt(Mo)){case 47:if(Or===42&&Qt.charCodeAt(Mo-1)===42&&Si+2!==Mo){Si=Mo+1;break e}break;case 10:if(Or===47){Si=Mo+1;break e}}Si=Mo}}break;case 91:Or++;case 40:Or++;case 34:case 39:for(;Si++<ed&&Qt.charCodeAt(Si)!==Or;);}if(li===0)break;Si++}switch(li=Qt.substring(ea,Si),wr===0&&(wr=(ei=ei.replace(Y,"").trim()).charCodeAt(0)),wr){case 64:switch(0<Ri&&(ei=ei.replace(W,"")),Or=ei.charCodeAt(1),Or){case 100:case 109:case 115:case 45:Ri=$t;break;default:Ri=gt}if(li=u($t,Ri,li,Or,Te+1),ea=li.length,0<Ce&&(Ri=d(gt,ei,Wl),ap=R(3,li,Ri,$t,Bt,He,ea,Or,Te,Et),ei=Ri.join(""),ap!==void 0&&(ea=(li=ap.trim()).length)===0&&(Or=0,li="")),0<ea)switch(Or){case 115:ei=ei.replace(we,N);case 100:case 109:case 45:li=ei+"{"+li+"}";break;case 107:ei=ei.replace(ue,"$1 $2"),li=ei+"{"+li+"}",li=Zt===1||Zt===2&&T("@"+li,3)?"@-webkit-"+li+"@"+li:"@"+li;break;default:li=ei+li,Et===112&&(li=(yi+=li,""))}else li="";break;default:li=u($t,d($t,ei,Wl),li,Et,Te+1)}d3+=li,li=Wl=Ri=Mo=wr=0,ei="",Or=Qt.charCodeAt(++Si);break;case 125:case 59:if(ei=(0<Ri?ei.replace(W,""):ei).trim(),1<(ea=ei.length))switch(Mo===0&&(wr=ei.charCodeAt(0),wr===45||96<wr&&123>wr)&&(ea=(ei=ei.replace(" ",":")).length),0<Ce&&(ap=R(1,ei,$t,at,Bt,He,yi.length,Et,Te,Et))!==void 0&&(ea=(ei=ap.trim()).length)===0&&(ei="\0\0"),wr=ei.charCodeAt(0),Or=ei.charCodeAt(1),wr){case 0:break;case 64:if(Or===105||Or===99){Bb+=ei+Qt.charAt(Si);break}default:ei.charCodeAt(ea-1)!==58&&(yi+=_(ei,wr,Or,ei.charCodeAt(2)))}Wl=Ri=Mo=wr=0,ei="",Or=Qt.charCodeAt(++Si)}}switch(Or){case 13:case 10:Mt===47?Mt=0:1+wr===0&&Et!==107&&0<ei.length&&(Ri=1,ei+="\0"),0<Ce*kt&&R(0,ei,$t,at,Bt,He,yi.length,Et,Te,Et),He=1,Bt++;break;case 59:case 125:if(Mt+pr+En+vt===0){He++;break}default:switch(He++,ql=Qt.charAt(Si),Or){case 9:case 32:if(pr+vt+Mt===0)switch(Ei){case 44:case 58:case 9:case 32:ql="";break;default:Or!==32&&(ql=" ")}break;case 0:ql="\\0";break;case 12:ql="\\f";break;case 11:ql="\\v";break;case 38:pr+Mt+vt===0&&(Ri=Wl=1,ql="\f"+ql);break;case 108:if(pr+Mt+vt+Qe===0&&0<Mo)switch(Si-Mo){case 2:Ei===112&&Qt.charCodeAt(Si-3)===58&&(Qe=Ei);case 8:Vs===111&&(Qe=Vs)}break;case 58:pr+Mt+vt===0&&(Mo=Si);break;case 44:Mt+En+pr+vt===0&&(Ri=1,ql+="\r");break;case 34:case 39:Mt===0&&(pr=pr===Or?0:pr===0?Or:pr);break;case 91:pr+Mt+En===0&&vt++;break;case 93:pr+Mt+En===0&&vt--;break;case 41:pr+Mt+vt===0&&En--;break;case 40:if(pr+Mt+vt===0){if(wr===0)switch(2*Ei+3*Vs){case 533:break;default:wr=1}En++}break;case 64:Mt+En+pr+vt+Mo+li===0&&(li=1);break;case 42:case 47:if(!(0<pr+vt+En))switch(Mt){case 0:switch(2*Or+3*Qt.charCodeAt(Si+1)){case 235:Mt=47;break;case 220:ea=Si,Mt=42}break;case 42:Or===47&&Ei===42&&ea+2!==Si&&(Qt.charCodeAt(ea+2)===33&&(yi+=Qt.substring(ea,Si+1)),ql="",Mt=0)}}Mt===0&&(ei+=ql)}Vs=Ei,Ei=Or,Si++}if(ea=yi.length,0<ea){if(Ri=$t,0<Ce&&(ap=R(2,yi,Ri,at,Bt,He,ea,Et,Te,Et),ap!==void 0&&(yi=ap).length===0))return Bb+yi+d3;if(yi=Ri.join(",")+"{"+yi+"}",Zt*Qe!==0){switch(Zt!==2||T(yi,2)||(Qe=0),Qe){case 111:yi=yi.replace(Re,":-moz-$1")+yi;break;case 112:yi=yi.replace(xe,"::-webkit-input-$1")+yi.replace(xe,"::-moz-$1")+yi.replace(xe,":-ms-input-$1")+yi}Qe=0}}return Bb+yi+d3}function d(at,$t,Qt){var Et=$t.trim().split(oe);$t=Et;var Te=Et.length,vt=at.length;switch(vt){case 0:case 1:var Mt=0;for(at=vt===0?"":at[0]+" ";Mt<Te;++Mt)$t[Mt]=g(at,$t[Mt],Qt).trim();break;default:var En=Mt=0;for($t=[];Mt<Te;++Mt)for(var pr=0;pr<vt;++pr)$t[En++]=g(at[pr]+" ",Et[Mt],Qt).trim()}return $t}function g(at,$t,Qt){var Et=$t.charCodeAt(0);switch(33>Et&&(Et=($t=$t.trim()).charCodeAt(0)),Et){case 38:return $t.replace(ae,"$1"+at.trim());case 58:return at.trim()+$t.replace(ae,"$1"+at.trim());default:if(0<1*Qt&&0<$t.indexOf("\f"))return $t.replace(ae,(at.charCodeAt(0)===58?"":"$1")+at.trim())}return at+$t}function _(at,$t,Qt,Et){var Te=at+";",vt=2*$t+3*Qt+4*Et;if(vt===944){at=Te.indexOf(":",9)+1;var Mt=Te.substring(at,Te.length-1).trim();return Mt=Te.substring(0,at).trim()+Mt+";",Zt===1||Zt===2&&T(Mt,1)?"-webkit-"+Mt+Mt:Mt}if(Zt===0||Zt===2&&!T(Te,1))return Te;switch(vt){case 1015:return Te.charCodeAt(10)===97?"-webkit-"+Te+Te:Te;case 951:return Te.charCodeAt(3)===116?"-webkit-"+Te+Te:Te;case 963:return Te.charCodeAt(5)===110?"-webkit-"+Te+Te:Te;case 1009:if(Te.charCodeAt(4)!==100)break;case 969:case 942:return"-webkit-"+Te+Te;case 978:return"-webkit-"+Te+"-moz-"+Te+Te;case 1019:case 983:return"-webkit-"+Te+"-moz-"+Te+"-ms-"+Te+Te;case 883:if(Te.charCodeAt(8)===45)return"-webkit-"+Te+Te;if(0<Te.indexOf("image-set(",11))return Te.replace(Je,"$1-webkit-$2")+Te;break;case 932:if(Te.charCodeAt(4)===45)switch(Te.charCodeAt(5)){case 103:return"-webkit-box-"+Te.replace("-grow","")+"-webkit-"+Te+"-ms-"+Te.replace("grow","positive")+Te;case 115:return"-webkit-"+Te+"-ms-"+Te.replace("shrink","negative")+Te;case 98:return"-webkit-"+Te+"-ms-"+Te.replace("basis","preferred-size")+Te}return"-webkit-"+Te+"-ms-"+Te+Te;case 964:return"-webkit-"+Te+"-ms-flex-"+Te+Te;case 1023:if(Te.charCodeAt(8)!==99)break;return Mt=Te.substring(Te.indexOf(":",15)).replace("flex-","").replace("space-between","justify"),"-webkit-box-pack"+Mt+"-webkit-"+Te+"-ms-flex-pack"+Mt+Te;case 1005:return K.test(Te)?Te.replace($,":-webkit-")+Te.replace($,":-moz-")+Te:Te;case 1e3:switch(Mt=Te.substring(13).trim(),$t=Mt.indexOf("-")+1,Mt.charCodeAt(0)+Mt.charCodeAt($t)){case 226:Mt=Te.replace(Ae,"tb");break;case 232:Mt=Te.replace(Ae,"tb-rl");break;case 220:Mt=Te.replace(Ae,"lr");break;default:return Te}return"-webkit-"+Te+"-ms-"+Mt+Te;case 1017:if(Te.indexOf("sticky",9)===-1)break;case 975:switch($t=(Te=at).length-10,Mt=(Te.charCodeAt($t)===33?Te.substring(0,$t):Te).substring(at.indexOf(":",7)+1).trim(),vt=Mt.charCodeAt(0)+(Mt.charCodeAt(7)|0)){case 203:if(111>Mt.charCodeAt(8))break;case 115:Te=Te.replace(Mt,"-webkit-"+Mt)+";"+Te;break;case 207:case 102:Te=Te.replace(Mt,"-webkit-"+(102<vt?"inline-":"")+"box")+";"+Te.replace(Mt,"-webkit-"+Mt)+";"+Te.replace(Mt,"-ms-"+Mt+"box")+";"+Te}return Te+";";case 938:if(Te.charCodeAt(5)===45)switch(Te.charCodeAt(6)){case 105:return Mt=Te.replace("-items",""),"-webkit-"+Te+"-webkit-box-"+Mt+"-ms-flex-"+Mt+Te;case 115:return"-webkit-"+Te+"-ms-flex-item-"+Te.replace(Le,"")+Te;default:return"-webkit-"+Te+"-ms-flex-line-pack"+Te.replace("align-content","").replace(Le,"")+Te}break;case 973:case 989:if(Te.charCodeAt(3)!==45||Te.charCodeAt(4)===122)break;case 931:case 953:if(Ge.test(at)===!0)return(Mt=at.substring(at.indexOf(":")+1)).charCodeAt(0)===115?_(at.replace("stretch","fill-available"),$t,Qt,Et).replace(":fill-available",":stretch"):Te.replace(Mt,"-webkit-"+Mt)+Te.replace(Mt,"-moz-"+Mt.replace("fill-",""))+Te;break;case 962:if(Te="-webkit-"+Te+(Te.charCodeAt(5)===102?"-ms-"+Te:"")+Te,Qt+Et===211&&Te.charCodeAt(13)===105&&0<Te.indexOf("transform",10))return Te.substring(0,Te.indexOf(";",27)+1).replace(J,"$1-webkit-$2")+Te}return Te}function T(at,$t){var Qt=at.indexOf($t===1?":":"{"),Et=at.substring(0,$t!==3?Qt:10);return Qt=at.substring(Qt+1,at.length-1),ut($t!==2?Et:Et.replace(Se,"$1"),Qt,$t)}function N(at,$t){var Qt=_($t,$t.charCodeAt(0),$t.charCodeAt(1),$t.charCodeAt(2));return Qt!==$t+";"?Qt.replace(ft," or ($1)").substring(4):"("+$t+")"}function R(at,$t,Qt,Et,Te,vt,Mt,En,pr,wr){for(var Or=0,Ei=$t,Vs;Or<Ce;++Or)switch(Vs=it[Or].call(V,at,Ei,Qt,Et,Te,vt,Mt,En,pr,wr)){case void 0:case!1:case!0:case null:break;default:Ei=Vs}if(Ei!==$t)return Ei}function O(at){switch(at){case void 0:case null:Ce=it.length=0;break;default:if(typeof at=="function")it[Ce++]=at;else if(typeof at=="object")for(var $t=0,Qt=at.length;$t<Qt;++$t)O(at[$t]);else kt=!!at|0}return O}function B(at){return at=at.prefix,at!==void 0&&(ut=null,at?typeof at!="function"?Zt=1:(Zt=2,ut=at):Zt=0),B}function V(at,$t){var Qt=at;if(33>Qt.charCodeAt(0)&&(Qt=Qt.trim()),De=Qt,Qt=[De],0<Ce){var Et=R(-1,$t,Qt,Qt,Bt,He,0,0,0,0);Et!==void 0&&typeof Et=="string"&&($t=Et)}var Te=u(gt,Qt,$t,0,0);return 0<Ce&&(Et=R(-2,Te,Qt,Qt,Bt,He,Te.length,0,0,0),Et!==void 0&&(Te=Et)),De="",Qe=0,He=Bt=1,Te}var Y=/^\0+/g,W=/[\0\r\f]/g,$=/: */g,K=/zoo|gra/,J=/([,: ])(transform)/g,oe=/,\r+?/g,ae=/([\t\r\n ])*\f?&/g,ue=/@(k\w+)\s*(\S*)\s*/,xe=/::(place)/g,Re=/:(read-only)/g,Ae=/[svh]\w+-[tblr]{2}/,we=/\(\s*(.*)\s*\)/g,ft=/([\s\S]*?);/g,Le=/-self|flex-/g,Se=/[^]*?(:[rp][el]a[\w-]+)[^]*/,Ge=/stretch|:\s*\w+\-(?:conte|avail)/,Je=/([^-])(image-set\()/,He=1,Bt=1,Qe=0,Zt=1,gt=[],it=[],Ce=0,ut=null,kt=0,De="";return V.use=O,V.set=B,a!==void 0&&B(a),V}var VJ,VNe=C(()=>{VJ=zNe}),GJ,jJ,GNe=C(()=>{GJ={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},jJ=GJ});function jNe(a){var u=Object.create(null);return function(d){return u[d]===void 0&&(u[d]=a(d)),u[d]}}var HJ,HNe=C(()=>{HJ=jNe}),$J,WJ,zU,$Ne=C(()=>{HNe(),$J=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,WJ=HJ(function(a){return $J.test(a)||a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&a.charCodeAt(2)<91}),zU=WJ}),WNe=Z(a=>{var u=typeof Symbol=="function"&&Symbol.for,d=u?Symbol.for("react.element"):60103,g=u?Symbol.for("react.portal"):60106,_=u?Symbol.for("react.fragment"):60107,T=u?Symbol.for("react.strict_mode"):60108,N=u?Symbol.for("react.profiler"):60114,R=u?Symbol.for("react.provider"):60109,O=u?Symbol.for("react.context"):60110,B=u?Symbol.for("react.async_mode"):60111,V=u?Symbol.for("react.concurrent_mode"):60111,Y=u?Symbol.for("react.forward_ref"):60112,W=u?Symbol.for("react.suspense"):60113,$=u?Symbol.for("react.suspense_list"):60120,K=u?Symbol.for("react.memo"):60115,J=u?Symbol.for("react.lazy"):60116,oe=u?Symbol.for("react.block"):60121,ae=u?Symbol.for("react.fundamental"):60117,ue=u?Symbol.for("react.responder"):60118,xe=u?Symbol.for("react.scope"):60119;function Re(we){if(typeof we=="object"&&we!==null){var ft=we.$$typeof;switch(ft){case d:switch(we=we.type,we){case B:case V:case _:case N:case T:case W:return we;default:switch(we=we&&we.$$typeof,we){case O:case Y:case J:case K:case R:return we;default:return ft}}case g:return ft}}}function Ae(we){return Re(we)===V}a.AsyncMode=B,a.ConcurrentMode=V,a.ContextConsumer=O,a.ContextProvider=R,a.Element=d,a.ForwardRef=Y,a.Fragment=_,a.Lazy=J,a.Memo=K,a.Portal=g,a.Profiler=N,a.StrictMode=T,a.Suspense=W,a.isAsyncMode=function(we){return Ae(we)||Re(we)===B},a.isConcurrentMode=Ae,a.isContextConsumer=function(we){return Re(we)===O},a.isContextProvider=function(we){return Re(we)===R},a.isElement=function(we){return typeof we=="object"&&we!==null&&we.$$typeof===d},a.isForwardRef=function(we){return Re(we)===Y},a.isFragment=function(we){return Re(we)===_},a.isLazy=function(we){return Re(we)===J},a.isMemo=function(we){return Re(we)===K},a.isPortal=function(we){return Re(we)===g},a.isProfiler=function(we){return Re(we)===N},a.isStrictMode=function(we){return Re(we)===T},a.isSuspense=function(we){return Re(we)===W},a.isValidElementType=function(we){return typeof we=="string"||typeof we=="function"||we===_||we===V||we===N||we===T||we===W||we===$||typeof we=="object"&&we!==null&&(we.$$typeof===J||we.$$typeof===K||we.$$typeof===R||we.$$typeof===O||we.$$typeof===Y||we.$$typeof===ae||we.$$typeof===ue||we.$$typeof===xe||we.$$typeof===oe)},a.typeOf=Re}),qNe=Z((a,u)=>{u.exports=WNe()}),XNe=Z((a,u)=>{var d=qNe(),g={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},_={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},T={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},N={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},R={};R[d.ForwardRef]=T,R[d.Memo]=N;function O(oe){return d.isMemo(oe)?N:R[oe.$$typeof]||g}var B=Object.defineProperty,V=Object.getOwnPropertyNames,Y=Object.getOwnPropertySymbols,W=Object.getOwnPropertyDescriptor,$=Object.getPrototypeOf,K=Object.prototype;function J(oe,ae,ue){if(typeof ae!="string"){if(K){var xe=$(ae);xe&&xe!==K&&J(oe,xe,ue)}var Re=V(ae);Y&&(Re=Re.concat(Y(ae)));for(var Ae=O(oe),we=O(ae),ft=0;ft<Re.length;++ft){var Le=Re[ft];if(!_[Le]&&!(ue&&ue[Le])&&!(we&&we[Le])&&!(Ae&&Ae[Le])){var Se=W(ae,Le);try{B(oe,Le,Se)}catch{}}}}return oe}u.exports=J});function gf(){return(gf=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var d=arguments[u];for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&(a[g]=d[g])}return a}).apply(this,arguments)}function IT(a){return typeof a=="function"}function qJ(a){return a.displayName||a.name||"Component"}function VU(a){return a&&typeof a.styledComponentId=="string"}function $2(a){for(var u=arguments.length,d=new Array(u>1?u-1:0),g=1;g<u;g++)d[g-1]=arguments[g];throw new Error("An error occurred. See https://git.io/JUIaE#"+a+" for more information."+(d.length>0?" Args: "+d.join(", "):""))}function GU(a){var u,d="";for(u=Math.abs(a);u>52;u=u/52|0)d=YU(u%52)+d;return(YU(u%52)+d).replace(yee,"$1-$2")}function XJ(a){for(var u=0;u<a.length;u+=1){var d=a[u];if(IT(d)&&!VU(d))return!1}return!0}function YJ(a){var u,d,g,_,T=a===void 0?W2:a,N=T.options,R=N===void 0?W2:N,O=T.plugins,B=O===void 0?kT:O,V=new VJ(R),Y=[],W=function(J){function oe(ae){if(ae)try{J(ae+"}")}catch{}}return function(ae,ue,xe,Re,Ae,we,ft,Le,Se,Ge){switch(ae){case 1:if(Se===0&&ue.charCodeAt(0)===64)return J(ue+";"),"";break;case 2:if(Le===0)return ue+"/*|*/";break;case 3:switch(Le){case 102:case 112:return J(xe[0]+ue),"";default:return ue+(Ge===0?"/*|*/":"")}case-2:ue.split("/*|*/}").forEach(oe)}}}(function(J){Y.push(J)}),$=function(J,oe,ae){return oe===0&&_ee.indexOf(ae[d.length])!==-1||ae.match(_)?J:"."+u};function K(J,oe,ae,ue){ue===void 0&&(ue="&");var xe=J.replace(bee,""),Re=oe&&ae?ae+" "+oe+" { "+xe+" }":xe;return u=ue,d=oe,g=new RegExp("\\"+d+"\\b","g"),_=new RegExp("(\\"+d+"\\b){2,}"),V(ae||!oe?"":oe,Re)}return V.use([].concat(B,[function(J,oe,ae){J===2&&ae.length&&ae[0].lastIndexOf(d)>0&&(ae[0]=ae[0].replace(g,$))},W,function(J){if(J===-2){var oe=Y;return Y=[],oe}}])),K.hash=B.length?B.reduce(function(J,oe){return oe.name||$2(15),p8(J,oe.name)},5381).toString():"",K}function jU(){return(0,Da.useContext)(UP)||See}function KJ(){return(0,Da.useContext)(zP)||VP}function ZJ(a){var u=(0,Da.useState)(a.stylisPlugins),d=u[0],g=u[1],_=jU(),T=(0,Da.useMemo)(function(){var R=_;return a.sheet?R=a.sheet:a.target&&(R=R.reconstructWithOptions({target:a.target},!1)),a.disableCSSOMInjection&&(R=R.reconstructWithOptions({useCSSOMInjection:!1})),R},[a.disableCSSOMInjection,a.sheet,a.target]),N=(0,Da.useMemo)(function(){return YJ({options:{prefix:!a.disableVendorPrefixes},plugins:d})},[a.disableVendorPrefixes,d]);return(0,Da.useEffect)(function(){(0,nee.default)(d,a.stylisPlugins)||g(a.stylisPlugins)},[a.stylisPlugins]),Da.default.createElement(UP.Provider,{value:T},Da.default.createElement(zP.Provider,{value:N},a.children))}function QJ(a){return Tee.test(a)?a.replace(Eee,Cee).replace(Mee,"-ms-"):a}function h8(a,u,d,g){if(Array.isArray(a)){for(var _,T=[],N=0,R=a.length;N<R;N+=1)(_=h8(a[N],u,d,g))!==""&&(Array.isArray(_)?T.push.apply(T,_):T.push(_));return T}if(ZU(a))return"";if(VU(a))return"."+a.styledComponentId;if(IT(a)){if(typeof(B=a)!="function"||B.prototype&&B.prototype.isReactComponent||!u)return a;var O=a(u);return h8(O,u,d,g)}var B;return a instanceof wee?d?(a.inject(d,g),a.getName(g)):a:LP(a)?function V(Y,W){var $,K,J=[];for(var oe in Y)Y.hasOwnProperty(oe)&&!ZU(Y[oe])&&(Array.isArray(Y[oe])&&Y[oe].isCss||IT(Y[oe])?J.push(QJ(oe)+":",Y[oe],";"):LP(Y[oe])?J.push.apply(J,V(Y[oe],oe)):J.push(QJ(oe)+": "+($=oe,(K=Y[oe])==null||typeof K=="boolean"||K===""?"":typeof K!="number"||K===0||$ in jJ||$.startsWith("--")?String(K).trim():K+"px")+";"));return W?[W+" {"].concat(J,["}"]):J}(a):a.toString()}function Yd(a){for(var u=arguments.length,d=new Array(u>1?u-1:0),g=1;g<u;g++)d[g-1]=arguments[g];return IT(a)||LP(a)?QU(h8(WU(kT,[a].concat(d)))):d.length===0&&a.length===1&&typeof a[0]=="string"?a:QU(h8(WU(a,d)))}function HU(a){return a.replace(Aee,"-").replace(Nee,"")}function OP(a){return typeof a=="string"&&!0}function YNe(a,u,d){var g=a[d];GP(u)&&GP(g)?JJ(g,u):a[d]=u}function JJ(a){for(var u=arguments.length,d=new Array(u>1?u-1:0),g=1;g<u;g++)d[g-1]=arguments[g];for(var _=0,T=d;_<T.length;_++){var N=T[_];if(GP(N))for(var R in N)Pee(R)&&YNe(a,N[R],R)}return a}function eee(a,u,d){var g=VU(a),_=!OP(a),T=u.attrs,N=T===void 0?kT:T,R=u.componentId,O=R===void 0?function(ue,xe){var Re=typeof ue!="string"?"sc":HU(ue);HP[Re]=(HP[Re]||0)+1;var Ae=Re+"-"+ez("5.3.11"+Re+HP[Re]);return xe?xe+"-"+Ae:Ae}(u.displayName,u.parentComponentId):R,B=u.displayName,V=B===void 0?function(ue){return OP(ue)?"styled."+ue:"Styled("+qJ(ue)+")"}(a):B,Y=u.displayName&&u.componentId?HU(u.displayName)+"-"+u.componentId:u.componentId||O,W=g&&a.attrs?Array.prototype.concat(a.attrs,N).filter(Boolean):N,$=u.shouldForwardProp;g&&a.shouldForwardProp&&($=u.shouldForwardProp?function(ue,xe,Re){return a.shouldForwardProp(ue,xe,Re)&&u.shouldForwardProp(ue,xe,Re)}:a.shouldForwardProp);var K,J=new xee(d,Y,g?a.componentStyle:void 0),oe=J.isStatic&&N.length===0,ae=function(ue,xe){return function(Re,Ae,we,ft){var Le=Re.attrs,Se=Re.componentStyle,Ge=Re.defaultProps,Je=Re.foldedComponentIds,He=Re.shouldForwardProp,Bt=Re.styledComponentId,Qe=Re.target,Zt=function(Et,Te,vt){Et===void 0&&(Et=W2);var Mt=gf({},Te,{theme:Et}),En={};return vt.forEach(function(pr){var wr,Or,Ei,Vs=pr;for(wr in IT(Vs)&&(Vs=Vs(Mt)),Vs)Mt[wr]=En[wr]=wr==="className"?(Or=En[wr],Ei=Vs[wr],Or&&Ei?Or+" "+Ei:Or||Ei):Vs[wr]}),[Mt,En]}(JU(Ae,(0,Da.useContext)(jP),Ge)||W2,Ae,Le),gt=Zt[0],it=Zt[1],Ce=function(Et,Te,vt,Mt){var En=jU(),pr=KJ(),wr=Te?Et.generateAndInjectStyles(W2,En,pr):Et.generateAndInjectStyles(vt,En,pr);return wr}(Se,ft,gt),ut=we,kt=it.$as||Ae.$as||it.as||Ae.as||Qe,De=OP(kt),at=it!==Ae?gf({},Ae,{},it):Ae,$t={};for(var Qt in at)Qt[0]!=="$"&&Qt!=="as"&&(Qt==="forwardedAs"?$t.as=at[Qt]:(He?He(Qt,zU,kt):!De||zU(Qt))&&($t[Qt]=at[Qt]));return Ae.style&&it.style!==Ae.style&&($t.style=gf({},Ae.style,{},it.style)),$t.className=Array.prototype.concat(Je,Bt,Ce!==Bt?Ce:null,Ae.className,it.className).filter(Boolean).join(" "),$t.ref=ut,(0,Da.createElement)(kt,$t)}(K,ue,xe,oe)};return ae.displayName=V,(K=Da.default.forwardRef(ae)).attrs=W,K.componentStyle=J,K.displayName=V,K.shouldForwardProp=$,K.foldedComponentIds=g?Array.prototype.concat(a.foldedComponentIds,a.styledComponentId):kT,K.styledComponentId=Y,K.target=g?a.target:a,K.withComponent=function(ue){var xe=u.componentId,Re=function(we,ft){if(we==null)return{};var Le,Se,Ge={},Je=Object.keys(we);for(Se=0;Se<Je.length;Se++)Le=Je[Se],ft.indexOf(Le)>=0||(Ge[Le]=we[Le]);return Ge}(u,["componentId"]),Ae=xe&&xe+"-"+(OP(ue)?ue:HU(qJ(ue)));return eee(ue,gf({},Re,{attrs:W,componentId:Ae}),d)},Object.defineProperty(K,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(ue){this._foldedDefaultProps=g?JJ({},a.defaultProps,ue):ue}}),Object.defineProperty(K,"toString",{value:function(){return"."+K.styledComponentId}}),_&&(0,ree.default)(K,a,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0,withComponent:!0}),K}function tee(a){for(var u=arguments.length,d=new Array(u>1?u-1:0),g=1;g<u;g++)d[g-1]=arguments[g];var _=Yd.apply(void 0,[a].concat(d)),T="sc-global-"+ez(JSON.stringify(_)),N=new Ree(_,T);function R(B){var V=jU(),Y=KJ(),W=(0,Da.useContext)(jP),$=(0,Da.useRef)(V.allocateGSInstance(T)).current;return V.server&&O($,B,V,W,Y),(0,Da.useLayoutEffect)(function(){if(!V.server)return O($,B,V,W,Y),function(){return N.removeStyles($,V)}},[$,B,V,W,Y]),null}function O(B,V,Y,W,$){if(N.isStatic)N.renderStyles(B,see,Y,$);else{var K=gf({},V,{theme:JU(V,W,R.defaultProps)});N.renderStyles(B,K,Y,$)}}return Da.default.memo(R)}var $U,Da,nee,ree,WU,LP,kT,W2,q2,FP,iee,see,oee,DT,OT,L7,LT,aee,lee,cee,uee,dee,hee,BP,qU,pee,fee,mee,XU,gee,F7,yee,YU,p8,KU,vee,xee,bee,_ee,UP,zP,See,VP,wee,Tee,Eee,Mee,Cee,ZU,QU,JU,Aee,Nee,ez,GP,Pee,jP,HP,$P,Ree,ge,tn=C(()=>{$U=z(UNe()),Da=z(nt()),nee=z(zJ()),VNe(),GNe(),$Ne(),ree=z(XNe()),WU=function(a,u){for(var d=[a[0]],g=0,_=u.length;g<_;g+=1)d.push(u[g],a[g+1]);return d},LP=function(a){return a!==null&&typeof a=="object"&&(a.toString?a.toString():Object.prototype.toString.call(a))==="[object Object]"&&!(0,$U.typeOf)(a)},kT=Object.freeze([]),W2=Object.freeze({}),q2=typeof process<"u"&&t!==void 0&&(t.REACT_APP_SC_ATTR||t.SC_ATTR)||"data-styled",FP=typeof window<"u"&&"HTMLElement"in window,iee=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&t!==void 0&&(t.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&t.REACT_APP_SC_DISABLE_SPEEDY!==""?t.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&t.REACT_APP_SC_DISABLE_SPEEDY:t.SC_DISABLE_SPEEDY!==void 0&&t.SC_DISABLE_SPEEDY!==""&&t.SC_DISABLE_SPEEDY!=="false"&&t.SC_DISABLE_SPEEDY)),see={},oee=function(){function a(d){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=d}var u=a.prototype;return u.indexOfGroup=function(d){for(var g=0,_=0;_<d;_++)g+=this.groupSizes[_];return g},u.insertRules=function(d,g){if(d>=this.groupSizes.length){for(var _=this.groupSizes,T=_.length,N=T;d>=N;)(N<<=1)<0&&$2(16,""+d);this.groupSizes=new Uint32Array(N),this.groupSizes.set(_),this.length=N;for(var R=T;R<N;R++)this.groupSizes[R]=0}for(var O=this.indexOfGroup(d+1),B=0,V=g.length;B<V;B++)this.tag.insertRule(O,g[B])&&(this.groupSizes[d]++,O++)},u.clearGroup=function(d){if(d<this.length){var g=this.groupSizes[d],_=this.indexOfGroup(d),T=_+g;this.groupSizes[d]=0;for(var N=_;N<T;N++)this.tag.deleteRule(_)}},u.getGroup=function(d){var g="";if(d>=this.length||this.groupSizes[d]===0)return g;for(var _=this.groupSizes[d],T=this.indexOfGroup(d),N=T+_,R=T;R<N;R++)g+=this.tag.getRule(R)+`/*!sc*/
`;return g},a}(),DT=new Map,OT=new Map,L7=1,LT=function(a){if(DT.has(a))return DT.get(a);for(;OT.has(L7);)L7++;var u=L7++;return DT.set(a,u),OT.set(u,a),u},aee=function(a){return OT.get(a)},lee=function(a,u){u>=L7&&(L7=u+1),DT.set(a,u),OT.set(u,a)},cee="style["+q2+'][data-styled-version="5.3.11"]',uee=new RegExp("^"+q2+'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)'),dee=function(a,u,d){for(var g,_=d.split(","),T=0,N=_.length;T<N;T++)(g=_[T])&&a.registerName(u,g)},hee=function(a,u){for(var d=(u.textContent||"").split(`/*!sc*/
`),g=[],_=0,T=d.length;_<T;_++){var N=d[_].trim();if(N){var R=N.match(uee);if(R){var O=0|parseInt(R[1],10),B=R[2];O!==0&&(lee(B,O),dee(a,B,R[3]),a.getTag().insertRules(O,g)),g.length=0}else g.push(N)}}},BP=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null},qU=function(a){var u=document.head,d=a||u,g=document.createElement("style"),_=function(R){for(var O=R.childNodes,B=O.length;B>=0;B--){var V=O[B];if(V&&V.nodeType===1&&V.hasAttribute(q2))return V}}(d),T=_!==void 0?_.nextSibling:null;g.setAttribute(q2,"active"),g.setAttribute("data-styled-version","5.3.11");var N=BP();return N&&g.setAttribute("nonce",N),d.insertBefore(g,T),g},pee=function(){function a(d){var g=this.element=qU(d);g.appendChild(document.createTextNode("")),this.sheet=function(_){if(_.sheet)return _.sheet;for(var T=document.styleSheets,N=0,R=T.length;N<R;N++){var O=T[N];if(O.ownerNode===_)return O}$2(17)}(g),this.length=0}var u=a.prototype;return u.insertRule=function(d,g){try{return this.sheet.insertRule(g,d),this.length++,!0}catch{return!1}},u.deleteRule=function(d){this.sheet.deleteRule(d),this.length--},u.getRule=function(d){var g=this.sheet.cssRules[d];return g!==void 0&&typeof g.cssText=="string"?g.cssText:""},a}(),fee=function(){function a(d){var g=this.element=qU(d);this.nodes=g.childNodes,this.length=0}var u=a.prototype;return u.insertRule=function(d,g){if(d<=this.length&&d>=0){var _=document.createTextNode(g),T=this.nodes[d];return this.element.insertBefore(_,T||null),this.length++,!0}return!1},u.deleteRule=function(d){this.element.removeChild(this.nodes[d]),this.length--},u.getRule=function(d){return d<this.length?this.nodes[d].textContent:""},a}(),mee=function(){function a(d){this.rules=[],this.length=0}var u=a.prototype;return u.insertRule=function(d,g){return d<=this.length&&(this.rules.splice(d,0,g),this.length++,!0)},u.deleteRule=function(d){this.rules.splice(d,1),this.length--},u.getRule=function(d){return d<this.length?this.rules[d]:""},a}(),XU=FP,gee={isServer:!FP,useCSSOMInjection:!iee},F7=function(){function a(d,g,_){d===void 0&&(d=W2),g===void 0&&(g={}),this.options=gf({},gee,{},d),this.gs=g,this.names=new Map(_),this.server=!!d.isServer,!this.server&&FP&&XU&&(XU=!1,function(T){for(var N=document.querySelectorAll(cee),R=0,O=N.length;R<O;R++){var B=N[R];B&&B.getAttribute(q2)!=="active"&&(hee(T,B),B.parentNode&&B.parentNode.removeChild(B))}}(this))}a.registerId=function(d){return LT(d)};var u=a.prototype;return u.reconstructWithOptions=function(d,g){return g===void 0&&(g=!0),new a(gf({},this.options,{},d),this.gs,g&&this.names||void 0)},u.allocateGSInstance=function(d){return this.gs[d]=(this.gs[d]||0)+1},u.getTag=function(){return this.tag||(this.tag=(_=(g=this.options).isServer,T=g.useCSSOMInjection,N=g.target,d=_?new mee(N):T?new pee(N):new fee(N),new oee(d)));var d,g,_,T,N},u.hasNameForId=function(d,g){return this.names.has(d)&&this.names.get(d).has(g)},u.registerName=function(d,g){if(LT(d),this.names.has(d))this.names.get(d).add(g);else{var _=new Set;_.add(g),this.names.set(d,_)}},u.insertRules=function(d,g,_){this.registerName(d,g),this.getTag().insertRules(LT(d),_)},u.clearNames=function(d){this.names.has(d)&&this.names.get(d).clear()},u.clearRules=function(d){this.getTag().clearGroup(LT(d)),this.clearNames(d)},u.clearTag=function(){this.tag=void 0},u.toString=function(){return function(d){for(var g=d.getTag(),_=g.length,T="",N=0;N<_;N++){var R=aee(N);if(R!==void 0){var O=d.names.get(R),B=g.getGroup(N);if(O&&B&&O.size){var V=q2+".g"+N+'[id="'+R+'"]',Y="";O!==void 0&&O.forEach(function(W){W.length>0&&(Y+=W+",")}),T+=""+B+V+'{content:"'+Y+`"}/*!sc*/
`}}}return T}(this)},a}(),yee=/(a)(d)/gi,YU=function(a){return String.fromCharCode(a+(a>25?39:97))},p8=function(a,u){for(var d=u.length;d;)a=33*a^u.charCodeAt(--d);return a},KU=function(a){return p8(5381,a)},vee=KU("5.3.11"),xee=function(){function a(u,d,g){this.rules=u,this.staticRulesId="",this.isStatic=(g===void 0||g.isStatic)&&XJ(u),this.componentId=d,this.baseHash=p8(vee,d),this.baseStyle=g,F7.registerId(d)}return a.prototype.generateAndInjectStyles=function(u,d,g){var _=this.componentId,T=[];if(this.baseStyle&&T.push(this.baseStyle.generateAndInjectStyles(u,d,g)),this.isStatic&&!g.hash)if(this.staticRulesId&&d.hasNameForId(_,this.staticRulesId))T.push(this.staticRulesId);else{var N=h8(this.rules,u,d,g).join(""),R=GU(p8(this.baseHash,N)>>>0);if(!d.hasNameForId(_,R)){var O=g(N,"."+R,void 0,_);d.insertRules(_,R,O)}T.push(R),this.staticRulesId=R}else{for(var B=this.rules.length,V=p8(this.baseHash,g.hash),Y="",W=0;W<B;W++){var $=this.rules[W];if(typeof $=="string")Y+=$;else if($){var K=h8($,u,d,g),J=Array.isArray(K)?K.join(""):K;V=p8(V,J+W),Y+=J}}if(Y){var oe=GU(V>>>0);if(!d.hasNameForId(_,oe)){var ae=g(Y,"."+oe,void 0,_);d.insertRules(_,oe,ae)}T.push(oe)}}return T.join(" ")},a}(),bee=/^\s*\/\/.*$/gm,_ee=[":","[",".","#"],UP=Da.default.createContext(),UP.Consumer,zP=Da.default.createContext(),See=(zP.Consumer,new F7),VP=YJ(),wee=function(){function a(u,d){var g=this;this.inject=function(_,T){T===void 0&&(T=VP);var N=g.name+T.hash;_.hasNameForId(g.id,N)||_.insertRules(g.id,N,T(g.rules,N,"@keyframes"))},this.toString=function(){return $2(12,String(g.name))},this.name=u,this.id="sc-keyframes-"+u,this.rules=d}return a.prototype.getName=function(u){return u===void 0&&(u=VP),this.name+u.hash},a}(),Tee=/([A-Z])/,Eee=/([A-Z])/g,Mee=/^ms-/,Cee=function(a){return"-"+a.toLowerCase()},ZU=function(a){return a==null||a===!1||a===""},QU=function(a){return Array.isArray(a)&&(a.isCss=!0),a},JU=function(a,u,d){return d===void 0&&(d=W2),a.theme!==d.theme&&a.theme||u||d.theme},Aee=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,Nee=/(^-|-$)/g,ez=function(a){return GU(KU(a)>>>0)},GP=function(a){return typeof a=="function"||typeof a=="object"&&a!==null&&!Array.isArray(a)},Pee=function(a){return a!=="__proto__"&&a!=="constructor"&&a!=="prototype"},jP=Da.default.createContext(),jP.Consumer,HP={},$P=function(a){return function u(d,g,_){if(_===void 0&&(_=W2),!(0,$U.isValidElementType)(g))return $2(1,String(g));var T=function(){return d(g,_,Yd.apply(void 0,arguments))};return T.withConfig=function(N){return u(d,g,gf({},_,{},N))},T.attrs=function(N){return u(d,g,gf({},_,{attrs:Array.prototype.concat(_.attrs,N).filter(Boolean)}))},T}(eee,a)},["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","textPath","tspan"].forEach(function(a){$P[a]=$P(a)}),Ree=function(){function a(d,g){this.rules=d,this.componentId=g,this.isStatic=XJ(d),F7.registerId(this.componentId+1)}var u=a.prototype;return u.createStyles=function(d,g,_,T){var N=T(h8(this.rules,g,_,T).join(""),""),R=this.componentId+d;_.insertRules(R,R,N)},u.removeStyles=function(d,g){g.clearRules(this.componentId+d)},u.renderStyles=function(d,g,_,T){d>2&&F7.registerId(this.componentId+d),this.removeStyles(d,_),this.createStyles(d,g,_,T)},a}(),function(){function a(){var d=this;this._emitSheetCSS=function(){var g=d.instance.toString();if(!g)return"";var _=BP();return"<style "+[_&&'nonce="'+_+'"',q2+'="true"','data-styled-version="5.3.11"'].filter(Boolean).join(" ")+">"+g+"</style>"},this.getStyleTags=function(){return d.sealed?$2(2):d._emitSheetCSS()},this.getStyleElement=function(){var g;if(d.sealed)return $2(2);var _=((g={})[q2]="",g["data-styled-version"]="5.3.11",g.dangerouslySetInnerHTML={__html:d.instance.toString()},g),T=BP();return T&&(_.nonce=T),[Da.default.createElement("style",gf({},_,{key:"sc-0-0"}))]},this.seal=function(){d.sealed=!0},this.instance=new F7({isServer:!0}),this.sealed=!1}var u=a.prototype;return u.collectStyles=function(d){return this.sealed?$2(2):Da.default.createElement(ZJ,{sheet:this.instance},d)},u.interleaveWithNodeStream=function(d){return $2(3)},a}(),ge=$P});function f8(){return f8=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var d=arguments[u];for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&(a[g]=d[g])}return a},f8.apply(this,arguments)}var KNe=C(()=>{});function ZNe(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}var QNe=C(()=>{});function FT(a,u){return FT=Object.setPrototypeOf||function(d,g){return d.__proto__=g,d},FT(a,u)}var tz=C(()=>{});function JNe(a,u){a.prototype=Object.create(u.prototype),a.prototype.constructor=a,FT(a,u)}var ePe=C(()=>{tz()});function nz(a){return nz=Object.setPrototypeOf?Object.getPrototypeOf:function(u){return u.__proto__||Object.getPrototypeOf(u)},nz(a)}var tPe=C(()=>{});function nPe(a){return Function.toString.call(a).indexOf("[native code]")!==-1}var rPe=C(()=>{});function iPe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sPe=C(()=>{});function WP(a,u,d){return iPe()?WP=Reflect.construct:WP=function(g,_,T){var N=[null];N.push.apply(N,_);var R=Function.bind.apply(g,N),O=new R;return T&&FT(O,T.prototype),O},WP.apply(null,arguments)}var oPe=C(()=>{tz(),sPe()});function rz(a){var u=typeof Map=="function"?new Map:void 0;return rz=function(d){if(d===null||!nPe(d))return d;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(typeof u<"u"){if(u.has(d))return u.get(d);u.set(d,g)}function g(){return WP(d,arguments,nz(this).constructor)}return g.prototype=Object.create(d.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),FT(g,d)},rz(a)}var aPe=C(()=>{tPe(),tz(),rPe(),oPe()}),lPe=C(()=>{});function cPe(a){return a.charAt(0).toUpperCase()+a.slice(1)}function uPe(a,u){if(!a)return u.toLowerCase();var d=a.split("-");if(d.length>1)return d.splice(1,0,u),d.reduce(function(_,T){return""+_+cPe(T)});var g=a.replace(/([a-z])([A-Z])/g,"$1"+u+"$2");return a===g?""+a+u:g}function dPe(a,u){for(var d={},g=0;g<u.length;g+=1)(u[g]||u[g]===0)&&(d[uPe(a,Bee[g])]=u[g]);return d}function Iee(a){for(var u=arguments.length,d=new Array(u>1?u-1:0),g=1;g<u;g++)d[g-1]=arguments[g];var _=d[0],T=d[1],N=T===void 0?_:T,R=d[2],O=R===void 0?_:R,B=d[3],V=B===void 0?N:B,Y=[_,N,O,V];return dPe(a,Y)}function iz(a){return Math.round(a*255)}function hPe(a,u,d){return iz(a)+","+iz(u)+","+iz(d)}function qP(a,u,d,g){if(g===void 0&&(g=hPe),u===0)return g(d,d,d);var _=(a%360+360)%360/60,T=(1-Math.abs(2*d-1))*u,N=T*(1-Math.abs(_%2-1)),R=0,O=0,B=0;_>=0&&_<1?(R=T,O=N):_>=1&&_<2?(R=N,O=T):_>=2&&_<3?(O=T,B=N):_>=3&&_<4?(O=N,B=T):_>=4&&_<5?(R=N,B=T):_>=5&&_<6&&(R=T,B=N);var V=d-T/2,Y=R+V,W=O+V,$=B+V;return g(Y,W,$)}function pPe(a){if(typeof a!="string")return a;var u=a.toLowerCase();return cz[u]?"#"+cz[u]:a}function kee(a){if(typeof a!="string")throw new yf(3);var u=pPe(a);if(u.match(Uee))return{red:parseInt(""+u[1]+u[2],16),green:parseInt(""+u[3]+u[4],16),blue:parseInt(""+u[5]+u[6],16)};if(u.match(zee)){var d=parseFloat((parseInt(""+u[7]+u[8],16)/255).toFixed(2));return{red:parseInt(""+u[1]+u[2],16),green:parseInt(""+u[3]+u[4],16),blue:parseInt(""+u[5]+u[6],16),alpha:d}}if(u.match(Vee))return{red:parseInt(""+u[1]+u[1],16),green:parseInt(""+u[2]+u[2],16),blue:parseInt(""+u[3]+u[3],16)};if(u.match(Gee)){var g=parseFloat((parseInt(""+u[4]+u[4],16)/255).toFixed(2));return{red:parseInt(""+u[1]+u[1],16),green:parseInt(""+u[2]+u[2],16),blue:parseInt(""+u[3]+u[3],16),alpha:g}}var _=KP.exec(u);if(_)return{red:parseInt(""+_[1],10),green:parseInt(""+_[2],10),blue:parseInt(""+_[3],10)};var T=jee.exec(u.substring(0,50));if(T)return{red:parseInt(""+T[1],10),green:parseInt(""+T[2],10),blue:parseInt(""+T[3],10),alpha:parseFloat(""+T[4])};var N=Hee.exec(u);if(N){var R=parseInt(""+N[1],10),O=parseInt(""+N[2],10)/100,B=parseInt(""+N[3],10)/100,V="rgb("+qP(R,O,B)+")",Y=KP.exec(V);if(!Y)throw new yf(4,u,V);return{red:parseInt(""+Y[1],10),green:parseInt(""+Y[2],10),blue:parseInt(""+Y[3],10)}}var W=$ee.exec(u.substring(0,50));if(W){var $=parseInt(""+W[1],10),K=parseInt(""+W[2],10)/100,J=parseInt(""+W[3],10)/100,oe="rgb("+qP($,K,J)+")",ae=KP.exec(oe);if(!ae)throw new yf(4,u,oe);return{red:parseInt(""+ae[1],10),green:parseInt(""+ae[2],10),blue:parseInt(""+ae[3],10),alpha:parseFloat(""+W[4])}}throw new yf(5)}function fPe(a){var u=a.red/255,d=a.green/255,g=a.blue/255,_=Math.max(u,d,g),T=Math.min(u,d,g),N=(_+T)/2;if(_===T)return a.alpha!==void 0?{hue:0,saturation:0,lightness:N,alpha:a.alpha}:{hue:0,saturation:0,lightness:N};var R,O=_-T,B=N>.5?O/(2-_-T):O/(_+T);switch(_){case u:R=(d-g)/O+(d<g?6:0);break;case d:R=(g-u)/O+2;break;default:R=(u-d)/O+4;break}return R*=60,a.alpha!==void 0?{hue:R,saturation:B,lightness:N,alpha:a.alpha}:{hue:R,saturation:B,lightness:N}}function sz(a){return fPe(kee(a))}function m8(a){var u=a.toString(16);return u.length===1?"0"+u:u}function oz(a){return m8(Math.round(a*255))}function mPe(a,u,d){return ZP("#"+oz(a)+oz(u)+oz(d))}function Dee(a,u,d){return qP(a,u,d,mPe)}function gPe(a,u,d){if(typeof a=="object"&&u===void 0&&d===void 0)return Dee(a.hue,a.saturation,a.lightness);throw new yf(1)}function yPe(a,u,d,g){if(typeof a=="object"&&u===void 0&&d===void 0&&g===void 0)return a.alpha>=1?Dee(a.hue,a.saturation,a.lightness):"rgba("+qP(a.hue,a.saturation,a.lightness)+","+a.alpha+")";throw new yf(2)}function Oee(a,u,d){if(typeof a=="number"&&typeof u=="number"&&typeof d=="number")return ZP("#"+m8(a)+m8(u)+m8(d));if(typeof a=="object"&&u===void 0&&d===void 0)return ZP("#"+m8(a.red)+m8(a.green)+m8(a.blue));throw new yf(6)}function Lee(a,u,d,g){if(typeof a=="object"&&u===void 0&&d===void 0&&g===void 0)return a.alpha>=1?Oee(a.red,a.green,a.blue):"rgba("+a.red+","+a.green+","+a.blue+","+a.alpha+")";throw new yf(7)}function az(a){if(typeof a!="object")throw new yf(8);if(qee(a))return Lee(a);if(Wee(a))return Oee(a);if(Yee(a))return yPe(a);if(Xee(a))return gPe(a);throw new yf(8)}function Fee(a,u,d){return function(){var g=d.concat(Array.prototype.slice.call(arguments));return g.length>=u?a.apply(this,g):Fee(a,u,g)}}function XP(a){return Fee(a,a.length,[])}function YP(a,u,d){return Math.max(a,Math.min(u,d))}function vPe(a,u){if(u==="transparent")return u;var d=sz(u);return az(f8({},d,{lightness:YP(0,1,d.lightness-parseFloat(a))}))}function xPe(a,u){if(u==="transparent")return u;var d=sz(u);return az(f8({},d,{lightness:YP(0,1,d.lightness+parseFloat(a))}))}function bPe(a,u){if(u==="transparent")return u;var d=sz(u);return az(f8({},d,{saturation:YP(0,1,d.saturation+parseFloat(a))}))}function _Pe(a,u){if(u==="transparent")return u;var d=kee(u),g=typeof d.alpha=="number"?d.alpha:1,_=f8({},d,{alpha:YP(0,1,+(g*100-parseFloat(a)*100).toFixed(2)/100)});return Lee(_)}function lz(a){for(var u=arguments.length,d=new Array(u>1?u-1:0),g=1;g<u;g++)d[g-1]=arguments[g];return Kee.indexOf(a)>=0&&a?f8({},Iee.apply(void 0,[""].concat(d)),{position:a}):Iee.apply(void 0,["",a].concat(d))}var yf,Bee,cz,Uee,zee,Vee,Gee,KP,jee,Hee,$ee,ZP,Wee,qee,Xee,Yee,uz,B7,QP,w1,Kee,vf=C(()=>{KNe(),QNe(),ePe(),aPe(),lPe(),yf=function(a){JNe(u,a);function u(d){var g;return g=a.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+d+" for more information.")||this,ZNe(g)}return u}(rz(Error)),Bee=["Top","Right","Bottom","Left"],cz={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},Uee=/^#[a-fA-F0-9]{6}$/,zee=/^#[a-fA-F0-9]{8}$/,Vee=/^#[a-fA-F0-9]{3}$/,Gee=/^#[a-fA-F0-9]{4}$/,KP=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i,jee=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([-+]?[0-9]*[.]?[0-9]+)\s*\)$/i,Hee=/^hsl\(\s*(\d{0,3}[.]?[0-9]+)\s*,\s*(\d{1,3}[.]?[0-9]?)%\s*,\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,$ee=/^hsla\(\s*(\d{0,3}[.]?[0-9]+)\s*,\s*(\d{1,3}[.]?[0-9]?)%\s*,\s*(\d{1,3}[.]?[0-9]?)%\s*,\s*([-+]?[0-9]*[.]?[0-9]+)\s*\)$/i,ZP=function(a){return a.length===7&&a[1]===a[2]&&a[3]===a[4]&&a[5]===a[6]?"#"+a[1]+a[3]+a[5]:a},Wee=function(a){return typeof a.red=="number"&&typeof a.green=="number"&&typeof a.blue=="number"&&(typeof a.alpha!="number"||typeof a.alpha>"u")},qee=function(a){return typeof a.red=="number"&&typeof a.green=="number"&&typeof a.blue=="number"&&typeof a.alpha=="number"},Xee=function(a){return typeof a.hue=="number"&&typeof a.saturation=="number"&&typeof a.lightness=="number"&&(typeof a.alpha!="number"||typeof a.alpha>"u")},Yee=function(a){return typeof a.hue=="number"&&typeof a.saturation=="number"&&typeof a.lightness=="number"&&typeof a.alpha=="number"},uz=XP(vPe),B7=XP(xPe),QP=XP(bPe),w1=XP(_Pe),Kee=["absolute","fixed","relative","static","sticky"]});function SPe(a,u,d){return u in a?Object.defineProperty(a,u,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[u]=d,a}function Zee(a,u){var d=Object.keys(a);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(a);u&&(g=g.filter(function(_){return Object.getOwnPropertyDescriptor(a,_).enumerable})),d.push.apply(d,g)}return d}function g8(a){for(var u=1;u<arguments.length;u++){var d=arguments[u]!=null?arguments[u]:{};u%2?Zee(Object(d),!0).forEach(function(g){SPe(a,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(d)):Zee(Object(d)).forEach(function(g){Object.defineProperty(a,g,Object.getOwnPropertyDescriptor(d,g))})}return a}function U7(a,u){if(a==null)return{};var d={},g=Object.keys(a),_,T;for(T=0;T<g.length;T++)_=g[T],!(u.indexOf(_)>=0)&&(d[_]=a[_]);return d}var BT=C(()=>{}),Qee,dz,Jee=C(()=>{Qee=z(nt()),dz=(0,Qee.createContext)({})});function wPe(a,u,d){return u in a?Object.defineProperty(a,u,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[u]=d,a}function ete(a,u){var d=Object.keys(a);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(a);u&&(g=g.filter(function(_){return Object.getOwnPropertyDescriptor(a,_).enumerable})),d.push.apply(d,g)}return d}function z7(a){for(var u=1;u<arguments.length;u++){var d=arguments[u]!=null?arguments[u]:{};u%2?ete(Object(d),!0).forEach(function(g){wPe(a,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(d)):ete(Object(d)).forEach(function(g){Object.defineProperty(a,g,Object.getOwnPropertyDescriptor(d,g))})}return a}function hz(a,u){if(a==null)return{};var d={},g=Object.keys(a),_,T;for(T=0;T<g.length;T++)_=g[T],!(u.indexOf(_)>=0)&&(d[_]=a[_]);return d}function TPe(a,u){if(a){if(typeof a=="string")return tte(a,u);var d=Object.prototype.toString.call(a).slice(8,-1);if(d==="Object"&&a.constructor&&(d=a.constructor.name),d==="Map"||d==="Set")return Array.from(a);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return tte(a,u)}}function tte(a,u){(u==null||u>a.length)&&(u=a.length);for(var d=0,g=new Array(u);d<u;d++)g[d]=a[d];return g}function nte(a,u){var d;if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(d=TPe(a))||u){d&&(a=d);var g=0;return function(){return g>=a.length?{done:!0}:{done:!1,value:a[g++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return d=a[Symbol.iterator](),d.next.bind(d)}var JP=C(()=>{});function EPe(a){return typeof a=="function"}var pz,rte,MPe=C(()=>{pz=z(nt()),Jee(),JP(),rte=function(a,u,d){d===void 0&&(d=u.children);var g=(0,pz.useContext)(dz);if(g.useCreateElement)return g.useCreateElement(a,u,d);if(typeof a=="string"&&EPe(d)){u.children;var _=hz(u,["children"]);return d(_)}return(0,pz.createElement)(a,u,d)}});function CPe(a,u,d){return u in a?Object.defineProperty(a,u,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[u]=d,a}function ite(a,u){var d=Object.keys(a);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(a);u&&(g=g.filter(function(_){return Object.getOwnPropertyDescriptor(a,_).enumerable})),d.push.apply(d,g)}return d}function V7(a){for(var u=1;u<arguments.length;u++){var d=arguments[u]!=null?arguments[u]:{};u%2?ite(Object(d),!0).forEach(function(g){CPe(a,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(d)):ite(Object(d)).forEach(function(g){Object.defineProperty(a,g,Object.getOwnPropertyDescriptor(d,g))})}return a}function APe(a,u){if(a==null)return{};var d={},g=Object.keys(a),_,T;for(T=0;T<g.length;T++)_=g[T],!(u.indexOf(_)>=0)&&(d[_]=a[_]);return d}var ste=C(()=>{});function NPe(a){return typeof a=="object"&&a!=null}var PPe=C(()=>{});function fz(a){var u;if(!NPe(a))return!1;var d=Object.getPrototypeOf(a);return d==null?!0:((u=d.constructor)===null||u===void 0?void 0:u.toString())===Object.toString()}var ote=C(()=>{PPe()});function ate(a,u){for(var d=Object.keys(a),g={},_={},T=0,N=d;T<N.length;T++){var R=N[T];u.indexOf(R)>=0?g[R]=a[R]:_[R]=a[R]}return[g,_]}function lte(a,u){if(u===void 0&&(u=[]),!fz(a.state))return ate(a,u);var d=ate(a,[].concat(u,["state"])),g=d[0],_=d[1],T=g.state,N=APe(g,["state"]);return[V7(V7({},T),N),_]}var RPe=C(()=>{ste(),ote()});function eR(a,u){if(a===u)return!0;if(!a||!u||typeof a!="object"||typeof u!="object")return!1;var d=Object.keys(a),g=Object.keys(u),_=d.length;if(g.length!==_)return!1;for(var T=0,N=d;T<N.length;T++){var R=N[T];if(a[R]!==u[R])return!1}return!0}var mz=C(()=>{});function cte(a){return a.name==="normalizePropsAreEqualInner"?a:function(u,d){return!fz(u.state)||!fz(d.state)?a(u,d):a(V7(V7({},u.state),u),V7(V7({},d.state),d))}}var IPe=C(()=>{ste(),ote()});function kPe(a){return(0,gz.forwardRef)(a)}function DPe(a,u){return(0,gz.memo)(a,u)}function UT(a){var u=a.as,d=a.useHook,g=a.memo,_=a.propsAreEqual,T=_===void 0?d==null?void 0:d.unstable_propsAreEqual:_,N=a.keys,R=N===void 0?(d==null?void 0:d.__keys)||[]:N,O=a.useCreateElement,B=O===void 0?rte:O,V=function(Y,W){var $=Y.as,K=$===void 0?u:$,J=hz(Y,["as"]);if(d){var oe,ae=lte(J,R),ue=ae[0],xe=ae[1],Re=d(ue,z7({ref:W},xe)),Ae=Re.wrapElement,we=hz(Re,["wrapElement"]),ft=((oe=K.render)===null||oe===void 0?void 0:oe.__keys)||K.__keys,Le=ft&&lte(J,ft)[0],Se=Le?z7(z7({},we),Le):we,Ge=B(K,Se);return Ae?Ae(Ge):Ge}return B(K,z7({ref:W},J))};return V=kPe(V),g&&(V=DPe(V,T&&cte(T))),V.__keys=R,V.unstable_propsAreEqual=cte(T||eR),V}var gz,zT=C(()=>{gz=z(nt()),JP(),MPe(),RPe(),mz(),IPe()});function ute(a,u){(0,yz.useDebugValue)(a);var d=(0,yz.useContext)(dz);return d[a]!=null?d[a]:u}var yz,dte=C(()=>{yz=z(nt()),Jee()});function OPe(a,u,d){u===void 0&&(u={}),d===void 0&&(d={});var g="use"+a+"Props";(0,hte.useDebugValue)(g);var _=ute(g);return _?_(u,d):d}var hte,LPe=C(()=>{hte=z(nt()),dte()});function FPe(a,u,d){u===void 0&&(u={}),d===void 0&&(d={});var g="use"+a+"Options";(0,pte.useDebugValue)(g);var _=ute(g);return _?z7(z7({},u),_(u,d)):u}var pte,BPe=C(()=>{pte=z(nt()),dte(),JP()});function UPe(a){return Array.isArray(a)?a:typeof a<"u"?[a]:[]}var zPe=C(()=>{});function VT(a){var u,d,g=UPe(a.compose),_=function(R,O){if(a.useOptions&&(R=a.useOptions(R,O)),a.name&&(R=FPe(a.name,R,O)),a.compose)for(var B=nte(g),V;!(V=B()).done;){var Y=V.value;R=Y.__useOptions(R,O)}return R},T=function(R,O,B){if(R===void 0&&(R={}),O===void 0&&(O={}),B===void 0&&(B=!1),B||(R=_(R,O)),a.useProps&&(O=a.useProps(R,O)),a.name&&(O=OPe(a.name,R,O)),a.compose)if(a.useComposeOptions&&(R=a.useComposeOptions(R,O)),a.useComposeProps)O=a.useComposeProps(R,O);else for(var V=nte(g),Y;!(Y=V()).done;){var W=Y.value;O=W(R,O,!0)}var $={},K=O||{};for(var J in K)K[J]!==void 0&&($[J]=K[J]);return $};T.__useOptions=_;var N=g.reduce(function(R,O){return R.push.apply(R,O.__keys||[]),R},[]);return T.__keys=[].concat(N,((u=a.useState)===null||u===void 0?void 0:u.__keys)||[],a.keys||[]),T.unstable_propsAreEqual=a.propsAreEqual||((d=g[0])===null||d===void 0?void 0:d.unstable_propsAreEqual)||eR,T}var GT=C(()=>{z(nt()),LPe(),JP(),BPe(),mz(),zPe()});function fte(a,u){u===void 0&&(u=null),a&&(typeof a=="function"?a(u):a.current=u)}function mte(a,u){return(0,gte.useMemo)(function(){return a==null&&u==null?null:function(d){fte(a,d),fte(u,d)}},[a,u])}var gte,yte=C(()=>{gte=z(nt())});function vz(a){if(a.tagName==="BUTTON")return!0;if(a.tagName==="INPUT"){var u=a;return vte.indexOf(u.type)!==-1}return!1}var vte,xz=C(()=>{vte=["button","color","file","image","reset","submit"]}),bz=C(()=>{}),VPe=C(()=>{bz(),z(nt())}),tR=C(()=>{bz(),z(nt()),VPe()});function GPe(a){return a?a.ownerDocument||a:document}var xte=C(()=>{});function jPe(a){return bte}var bte,HPe=C(()=>{xte();try{bte=window}catch{}});function $Pe(){var a=jPe();return!!(typeof a<"u"&&a.document&&a.document.createElement)}var nR,_z=C(()=>{HPe(),nR=$Pe()}),Sz,wz,Tz=C(()=>{Sz=z(nt()),_z(),wz=nR?Sz.useLayoutEffect:Sz.useEffect});function G7(a){var u=(0,_te.useRef)(a);return wz(function(){u.current=a}),u}var _te,Ste=C(()=>{_te=z(nt()),Tz()});function WPe(a){return a.target===a.currentTarget}var qPe=C(()=>{});function XPe(a){var u=GPe(a),d=u.activeElement;return d!=null&&d.nodeName?d:null}var YPe=C(()=>{xte()});function wte(a,u){return a===u||a.contains(u)}var Tte=C(()=>{});function KPe(a){var u=XPe(a);if(!u)return!1;if(wte(a,u))return!0;var d=u.getAttribute("aria-activedescendant");return d?d===a.id?!0:!!a.querySelector("#"+d):!1}var ZPe=C(()=>{YPe(),Tte()});function QPe(a){return!wte(a.currentTarget,a.target)}var JPe=C(()=>{Tte()});function rR(a){return nR?window.navigator.userAgent.indexOf(a)!==-1:!1}var eRe=C(()=>{_z()});function tRe(a,u){return"matches"in a?a.matches(u):"msMatchesSelector"in a?a.msMatchesSelector(u):a.webkitMatchesSelector(u)}var nRe=C(()=>{});function rRe(a){var u=a;return u.offsetWidth>0||u.offsetHeight>0||a.getClientRects().length>0}function iRe(a){return tRe(a,Ete)&&rRe(a)}var Ete,sRe=C(()=>{nRe(),Ete="input:not([type='hidden']):not([disabled]), select:not([disabled]), textarea:not([disabled]), a[href], button:not([disabled]), [tabindex], iframe, object, embed, area[href], audio[controls], video[controls], [contenteditable]:not([contenteditable='false'])"}),Mte,iR,Cte=C(()=>{BT(),zT(),GT(),mz(),Mte=["unstable_system"],iR=VT({name:"Role",keys:Mte,propsAreEqual:function(a,u){var d=a.unstable_system,g=U7(a,["unstable_system"]),_=u.unstable_system,T=U7(u,["unstable_system"]);return d!==_&&!eR(d,_)?!1:eR(g,T)}}),UT({as:"div",useHook:iR})});function Ate(a){!KPe(a)&&iRe(a)&&a.focus()}function oRe(a){return a.tagName==="BUTTON"||a.tagName==="INPUT"||a.tagName==="SELECT"||a.tagName==="TEXTAREA"||a.tagName==="A"}function aRe(a){return a.tagName==="BUTTON"||a.tagName==="INPUT"||a.tagName==="SELECT"||a.tagName==="TEXTAREA"}function lRe(a,u,d,g){return a?u&&!d?-1:void 0:u?g:g||0}function Ez(a,u){return(0,j7.useCallback)(function(d){var g;(g=a.current)===null||g===void 0||g.call(a,d),!d.defaultPrevented&&u&&(d.stopPropagation(),d.preventDefault())},[a,u])}var j7,Nte,Pte,Mz,cRe=C(()=>{BT(),zT(),GT(),j7=z(nt()),yte(),xz(),tR(),Ste(),Tz(),ZPe(),JPe(),eRe(),sRe(),Cte(),Nte=["disabled","focusable"],Pte=rR("Mac")&&!rR("Chrome")&&(rR("Safari")||rR("Firefox")),Mz=VT({name:"Tabbable",compose:iR,keys:Nte,useOptions:function(a,u){var d=u.disabled;return g8({disabled:d},a)},useProps:function(a,u){var d=u.ref,g=u.tabIndex,_=u.onClickCapture,T=u.onMouseDownCapture,N=u.onMouseDown,R=u.onKeyPressCapture,O=u.style,B=U7(u,["ref","tabIndex","onClickCapture","onMouseDownCapture","onMouseDown","onKeyPressCapture","style"]),V=(0,j7.useRef)(null),Y=G7(_),W=G7(T),$=G7(N),K=G7(R),J=!!a.disabled&&!a.focusable,oe=(0,j7.useState)(!0),ae=oe[0],ue=oe[1],xe=(0,j7.useState)(!0),Re=xe[0],Ae=xe[1],we=a.disabled?g8({pointerEvents:"none"},O):O;wz(function(){var Je=V.current;Je&&(oRe(Je)||ue(!1),aRe(Je)||Ae(!1))},[]);var ft=Ez(Y,a.disabled),Le=Ez(W,a.disabled),Se=Ez(K,a.disabled),Ge=(0,j7.useCallback)(function(Je){var He;(He=$.current)===null||He===void 0||He.call($,Je);var Bt=Je.currentTarget;if(!Je.defaultPrevented&&Pte&&!QPe(Je)&&vz(Bt)){var Qe=requestAnimationFrame(function(){Bt.removeEventListener("mouseup",Zt,!0),Ate(Bt)}),Zt=function(){cancelAnimationFrame(Qe),Ate(Bt)};Bt.addEventListener("mouseup",Zt,{once:!0,capture:!0})}},[]);return g8({ref:mte(V,d),style:we,tabIndex:lRe(J,ae,Re,g),disabled:J&&Re?!0:void 0,"aria-disabled":a.disabled?!0:void 0,onClickCapture:ft,onMouseDownCapture:Le,onMouseDown:Ge,onKeyPressCapture:Se},B)}}),UT({as:"div",useHook:Mz})});function uRe(a){var u=a.currentTarget;return a.isTrusted?vz(u)||u.tagName==="INPUT"||u.tagName==="TEXTAREA"||u.tagName==="A"||u.tagName==="SELECT":!1}var sR,Rte,Cz,dRe=C(()=>{BT(),zT(),GT(),sR=z(nt()),xz(),tR(),Ste(),qPe(),cRe(),Rte=["unstable_clickOnEnter","unstable_clickOnSpace"],Cz=VT({name:"Clickable",compose:Mz,keys:Rte,useOptions:function(a){var u=a.unstable_clickOnEnter,d=u===void 0?!0:u,g=a.unstable_clickOnSpace,_=g===void 0?!0:g,T=U7(a,["unstable_clickOnEnter","unstable_clickOnSpace"]);return g8({unstable_clickOnEnter:d,unstable_clickOnSpace:_},T)},useProps:function(a,u){var d=u.onKeyDown,g=u.onKeyUp,_=U7(u,["onKeyDown","onKeyUp"]),T=(0,sR.useState)(!1),N=T[0],R=T[1],O=G7(d),B=G7(g),V=(0,sR.useCallback)(function(W){var $;if(($=O.current)===null||$===void 0||$.call(O,W),!W.defaultPrevented&&!a.disabled&&!W.metaKey&&WPe(W)){var K=a.unstable_clickOnEnter&&W.key==="Enter",J=a.unstable_clickOnSpace&&W.key===" ";if(K||J){if(uRe(W))return;W.preventDefault(),K?W.currentTarget.click():J&&R(!0)}}},[a.disabled,a.unstable_clickOnEnter,a.unstable_clickOnSpace]),Y=(0,sR.useCallback)(function(W){var $;if(($=B.current)===null||$===void 0||$.call(B,W),!W.defaultPrevented&&!a.disabled&&!W.metaKey){var K=a.unstable_clickOnSpace&&W.key===" ";N&&K&&(R(!1),W.currentTarget.click())}},[a.disabled,a.unstable_clickOnSpace,N]);return g8({"data-active":N||void 0,onKeyDown:V,onKeyUp:Y},_)}}),UT({as:"button",memo:!0,useHook:Cz})}),jT,Ite,kte,Dte,hRe=C(()=>{BT(),zT(),GT(),jT=z(nt()),yte(),xz(),tR(),dRe(),Ite=[],kte=VT({name:"Button",compose:Cz,keys:Ite,useProps:function(a,u){var d=u.ref,g=U7(u,["ref"]),_=(0,jT.useRef)(null),T=(0,jT.useState)(void 0),N=T[0],R=T[1],O=(0,jT.useState)("button"),B=O[0],V=O[1];return(0,jT.useEffect)(function(){var Y=_.current;Y&&(vz(Y)||(Y.tagName!=="A"&&R("button"),V(void 0)))},[]),g8({ref:mte(_,d),role:N,type:B},g)}}),Dte=UT({as:"button",memo:!0,useHook:kte})}),Ote,Lte,Fte,pRe=C(()=>{BT(),zT(),GT(),Cte(),Ote=[],Lte=VT({name:"Group",compose:iR,keys:Ote,useProps:function(a,u){return g8({role:"group"},u)}}),Fte=UT({as:"div",useHook:Lte})});function fRe(){return nR?document.body:null}var Bte,H7,mRe=C(()=>{Bte=z(nt()),Tz(),_z(),z(H2()),H7=(0,Bte.createContext)(fRe())}),Az,gRe=C(()=>{typeof window<"u"&&(Az={get passive(){}},window.addEventListener("testPassive",null,Az),window.removeEventListener("testPassive",null,Az))}),y8=C(()=>{z(nt()),tR(),hRe(),pRe(),z(H2()),mRe(),gRe(),bz()});function Ni(a){let u=(0,Nz.useMemo)(()=>{let _=a;return{get current(){return _},set current(T){_=T,g(T)}}},[]),[d,g]=(0,Nz.useState)(()=>a);return[u,d]}var Nz,ls=C(()=>{Nz=z(nt())});function yRe(a){return u=>nc.default.createElement(Hte,null,nc.default.createElement(a,P({},u)))}var nc,Ute,zte,Zi,$7,Vte,Gte,jte,Pz,Rz,Hte,ms=C(()=>{vf(),tn(),tn(),nc=z(nt()),Ute=z(H2()),y8(),ls(),Zi=Yd(zte||(zte=H([`
  #pointer-root & {
    pointer-events: none;
  }
  #pointer-root.normal & {
    pointer-events: auto;
  }
`]))),$7={panel:{bg:"#282b2f",head:{title:{color:"#bbb"},punctuation:{color:"#808080"}},body:{compoudThing:{label:{get color(){return B7(.6,$7.panel.bg)}}}}}},Gte=typeof window<"u"?tee(Vte||(Vte=H([`
  :host {
    all: initial;
    color: white;
    font: 11px -apple-system, BlinkMacSystemFont, Segoe WPC, Segoe Editor,
      HelveticaNeue-Light, Ubuntu, Droid Sans, sans-serif;
  }

  * {
    padding: 0;
    margin: 0;
    font-size: 100%;
    font: inherit;
    vertical-align: baseline;
    list-style: none;
  }
`]))):{},Pz=ge.div(jte||(jte=H([`
  z-index: 51;
  position: fixed;
  top: 0px;
  right: 0px;
  bottom: 0px;
  left: 0px;
  pointer-events: none;
`]))),Rz=a=>nc.default.createElement(ZJ,{disableVendorPrefixes:!0,target:a.target},nc.default.createElement(nc.default.Fragment,null,nc.default.createElement(Gte,null),a.children)),Hte=a=>{let[u,d]=(0,nc.useState)(null),[g,_]=(0,nc.useState)(null);(0,nc.useLayoutEffect)(()=>{if(!u)return;let{parentNode:R}=u;if(!R)return;let O=R.shadowRoot?parent.shadowRoot:R.attachShadow({mode:"open"});_(O)},[u]);let[T,N]=Ni(void 0);return g?Ute.default.createPortal(nc.default.createElement(Rz,{target:g},nc.default.createElement(nc.default.Fragment,null,nc.default.createElement(Pz,{ref:T}),nc.default.createElement(H7.Provider,{value:N},a.children))),g):nc.default.createElement("template",{ref:d,"shadow-root":"open"},a.children)}}),v8,$te,Wte,Iz,qte,oR,Xte,Yte,Kte,Zte,aR,T1,O4=C(()=>{ms(),tn(),v8={get outlinePanel(){return 1},get propsPanel(){return v8.outlinePanel},get sequenceEditorPanel(){return this.outlinePanel-1},get toolbar(){return this.outlinePanel+1},get pluginPanes(){return this.sequenceEditorPanel-1}},$te=$7.panel.bg,Iz=ge.span(Wte||(Wte=H([`
  white-space: nowrap;
`]))),oR=ge.span(qte||(qte=H([`
  white-space: nowrap;
  color: `,`;
`])),$7.panel.head.punctuation.color),Yte=ge.div(Xte||(Xte=H([`
  background: `,`;
  flex-grow: 1;
  overflow-y: scroll;
  padding: 0;
`])),$te),Kte=18,aR=ge.div(Zte||(Zte=H([`
  height: `,`px;
  box-sizing: border-box;
  display: flex;
  align-items: center;
  padding: 0 10px;
  position: relative;
  color: #adadadb3;
  border-bottom: 1px solid rgb(0 0 0 / 13%);
  background-color: #25272b;
  font-size: 10px;
  font-weight: 500;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
`])),Kte),T1=100}),Qte,xf,W7=C(()=>{Qte=()=>{},xf=Qte});function vRe(a){return kz.createElement("svg",P({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a),kz.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.775 2.781a.5.5 0 01.5.5v1.7H4.67c.108-.957.92-1.7 1.905-1.7h6.608a1.917 1.917 0 110 3.834H6.574c-.78 0-1.452-.466-1.751-1.135H2.275v5.03h2.39a2.032 2.032 0 012.023-1.854h6.38a2.031 2.031 0 110 4.063h-6.38c-.83 0-1.543-.497-1.858-1.21H1.775a.5.5 0 01-.5-.5V3.281a.5.5 0 01.5-.5zm4.799 1.5h6.608a.917.917 0 110 1.834H6.574a.917.917 0 110-1.834zm.114 5.875h6.38a1.031 1.031 0 110 2.063h-6.38a1.032 1.032 0 110-2.063z",fill:"currentColor"}))}var kz,Jte,xRe=C(()=>{kz=z(nt()),Jte=vRe});function bRe(a){return Dz.createElement("svg",P({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a),Dz.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 10.5L4 6.654 5.2 5.5 8 8.385 10.8 5.5 12 6.654 8 10.5z",fill:"currentColor"}))}var Dz,ene,_Re=C(()=>{Dz=z(nt()),ene=bRe});function SRe(a){return Oz.createElement("svg",P({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a),Oz.createElement("path",{d:"M8.339 4.5l-2.055.644 4.451 1.393v2.748l-2.966.928-2.504-.783V6.738l2.42.758 2.055-.644-4.458-1.395L4 5.858v4.463L7.768 11.5 12 10.175V5.646L8.339 4.5z",fill:"currentColor"}))}var Oz,Lz,wRe=C(()=>{Oz=z(nt()),Lz=SRe});function TRe(a){return Fz.createElement("svg",P({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a),Fz.createElement("path",{d:"M6.8 11.6a.6.6 0 00.6-.6V7.4a.6.6 0 00-1.2 0V11a.6.6 0 00.6.6zm6-7.2h-2.4v-.6A1.8 1.8 0 008.6 2H7.4a1.8 1.8 0 00-1.8 1.8v.6H3.2a.6.6 0 100 1.2h.6v6.6A1.8 1.8 0 005.6 14h4.8a1.8 1.8 0 001.8-1.8V5.6h.6a.6.6 0 100-1.2zm-6-.6a.6.6 0 01.6-.6h1.2a.6.6 0 01.6.6v.6H6.8v-.6zm4.2 8.4a.6.6 0 01-.6.6H5.6a.6.6 0 01-.6-.6V5.6h6v6.6zm-1.8-.6a.6.6 0 00.6-.6V7.4a.6.6 0 00-1.2 0V11a.6.6 0 00.6.6z",fill:"currentColor"}))}var Fz,Bz,ERe=C(()=>{Fz=z(nt()),Bz=TRe}),lR=C(()=>{xRe(),_Re(),wRe(),ERe()}),E1,tne,cR,nne,rne,ine,sne,one,ane,lne,cne,une,dne,hne,pne,fne,mne,gne,Uz,yne=C(()=>{E1=z(nt()),tn(),W7(),ms(),lR(),cR=ge.li(tne||(tne=H([`
  margin: 0;
  padding: 0;
  list-style: none;
  display: flex;
  justify-content: flex-start;
  flex-direction: column;
  align-items: flex-start;
`]))),rne=ge.div(nne||(nne=H([""]))),sne=ge(rne)(ine||(ine=H([`
  position: relative;
  margin-top: 2px;
  margin-bottom: 2px;
  margin-left: calc(4px + var(--depth) * 16px);
  padding-left: 4px;
  padding-right: 8px;
  gap: 4px;
  height: 21px;
  line-height: 0;
  box-sizing: border-box;
  display: flex;
  flex-wrap: nowrap;
  align-items: center;
  pointer-events: none;
  white-space: nowrap;

  border-radius: 2px;
  box-shadow: 0 3px 4px -1px rgba(0, 0, 0, 0.48);

  color: rgba(255, 255, 255, 0.9);
  background: rgba(40, 43, 47, 0.65);
  backdrop-filter: blur(14px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);

  &.descendant-is-selected {
    background: rgba(29, 53, 59, 0.7);
  }

  `,`;
  &:not(.not-selectable):not(.selected):hover {
    background: rgba(59, 63, 69, 0.9);

    border-bottom: 1px solid rgba(255, 255, 255, 0.24);
  }

  &:not(.not-selectable):not(.selected):active {
    background: rgba(82, 88, 96, 0.9);
    border-bottom: 1px solid rgba(255, 255, 255, 0.24);
  }

  &.selected {
    background: rgba(30, 88, 102, 0.7);
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  }

  @supports not (backdrop-filter: blur()) {
    background: rgba(40, 43, 47, 0.95);
  }
`])),Zi),ane=Yd(one||(one=H([`
  font-weight: 500;
  font-size: 11px;
  & {
  }
`]))),cne=ge.span(lne||(lne=H([`
  `,`;

  `,`;
  position: relative;
  // Compensate for border bottom
  top: 0.5px;
  display: flex;
  height: 20px;
  align-items: center;
  box-sizing: border-box;
`])),ane,Zi),dne=ge.div(une||(une=H([`
  font-weight: 500;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  opacity: 0.99;
`]))),pne=ge.span(hne||(hne=H([`
  font-size: 9px;
  position: relative;
  display: block;
  transition: transform 0.1s ease-out;

  &:hover {
    transform: rotate(-20deg);
  }

  `,`.collapsed & {
    transform: rotate(-90deg);

    &:hover {
      transform: rotate(-70deg);
    }
  }
`])),cR),mne=ge.ul(fne||(fne=H([`
  margin: 0;
  padding: 0;
  list-style: none;

  `,`.collapsed & {
    display: none;
  }
`])),cR),gne=({label:a,children:u,depth:d,select:g,selectionStatus:_,labelDecoration:T,collapsed:N=!1,setIsCollapsed:R,draggable:O,onDragStart:B,onDragEnd:V})=>{let Y=u!==void 0;return E1.default.createElement(cR,{style:{"--depth":d},className:N?"collapsed":""},E1.default.createElement(sne,{className:_,onClick:g??xf,"data-header":!0,draggable:O,onDragStart:B,onDragEnd:V},E1.default.createElement(dne,null,Y?E1.default.createElement(pne,{onClick:W=>{W.stopPropagation(),W.preventDefault(),R==null||R(!N)}},E1.default.createElement(ene,null)):E1.default.createElement(Lz,null)),E1.default.createElement(cne,null,E1.default.createElement("span",null,a)),T),Y&&E1.default.createElement(mne,null,u))},Uz=gne});function MRe(a){return Object.keys(a)}function CRe(a){return Object.keys((0,M1.val)(a.sheetTemplatesP))}function ARe(){let a=lo(ep().filter(u=>Ne(u)||Pt(u)).map(u=>Pt(u)?u.sheet:u))[0];if(a)return a.getSequence()}var M1,ep,vne,q7=C(()=>{M1=un(),Wt(),b0(),Pe(),ep=()=>{var a;let u=(0,M1.val)(ce().projectsP),d=((a=(0,M1.val)(ce().atomP.historic.panels.outlinePanel.selection))!=null?a:[]).map(g=>{let _=u[g.projectId];if(!_)return;if(g.type==="Project")return _;if(!(0,M1.val)(_.sheetTemplatesP[g.sheetId]))return;let T=vne(_,g.sheetId);if(!T)return;if(g.type==="Sheet")return T;let N=(0,M1.val)(T.objectsP[g.objectKey]);if(N)return N});return lo(d.filter(g=>typeof g<"u"))},vne=(a,u)=>{let d=ce().atomP.historic.projects.stateByProjectId[a.address.projectId],g=(0,M1.val)(d.stateBySheetId[u].selectedInstanceId),_=(0,M1.val)(a.sheetTemplatesP[u]);if(_){if(g)return(0,M1.val)(_.instancesP[g]);{let T=(0,M1.val)(_.instancesP);return T[MRe(T)[0]]}}}}),HT,xne,NRe=C(()=>{Pe(),q7(),Ar(),HT=z(nt()),yne(),xne=({sheet:a,depth:u})=>{let d=(0,HT.useCallback)(()=>{ce().transaction(({stateEditors:T})=>{T.studio.historic.panels.outline.selection.set([a])})},[a]),g=(0,HT.useCallback)(T=>{let N={type:"theatre-sheet",projectId:a.address.projectId,sheetId:a.address.sheetId,sheetInstanceId:a.address.sheetInstanceId};T.dataTransfer.setData("application/json",JSON.stringify(N)),T.dataTransfer.effectAllowed="copy",document.body.classList.add("dragging-sheet")},[a]),_=(0,HT.useCallback)(()=>{document.body.classList.remove("dragging-sheet")},[]);return di(()=>{let T=ep();return HT.default.createElement(Uz,{depth:u,select:d,selectionStatus:T.some(N=>N===a)?"selected":T.some(N=>N.type==="Theatre_SheetObject"&&N.sheet===a)?"descendant-is-selected":"not-selected",label:"".concat(a.address.sheetId,": ").concat(a.address.sheetInstanceId),draggable:!0,onDragStart:g,onDragEnd:_})},[u,g,_])}}),zz,X7,bne,_ne,Sne,wne,PRe=C(()=>{Ar(),zz=un(),X7=z(nt()),tn(),NRe(),ge.div(bne||(bne=H([`
  display: flex;
`]))),ge.li(_ne||(_ne=H([`
  color: `,`;
`])),a=>a.isSelected?"white":"hsl(1, 1%, 80%)"),ge.div(Sne||(Sne=H([""]))),wne=({sheetId:a,depth:u,project:d})=>di(()=>{let g=(0,zz.val)(d.sheetTemplatesP[a]);if(!g)return X7.default.createElement(X7.default.Fragment,null);let _=(0,zz.val)(g.instancesP);return X7.default.createElement(X7.default.Fragment,null,Object.entries(_).map(([T,N])=>X7.default.createElement(xne,{key:N.address.sheetInstanceId,sheet:N,depth:u})))},[u,a,d])}),uR,Tne,Ene,RRe=C(()=>{q7(),Ar(),uR=z(nt()),PRe(),Tne=({project:a,depth:u})=>di(()=>{if(!a)return null;let d=CRe(a);return uR.default.createElement(uR.default.Fragment,null,d.map(g=>uR.default.createElement(wne,{depth:u,sheetId:g,key:"sheet-".concat(g),project:a})))},[a,u]),Ene=Tne});function IRe(a){var u;let d=a.type==="namespace"?"namespace:".concat(a.sheet.address.sheetId,":").concat(a.path.join("/")):a.type==="Theatre_Project"?"project":a.type==="Theatre_Sheet"?"sheetInstance:".concat(a.address.sheetId,":").concat(a.address.sheetInstanceId):"unknown",g=a.type==="namespace"?a.sheet.address.projectId:a.address.projectId,_=(u=ti(ce().atomP.ahistoric.projects.stateByProjectId[g].collapsedItemsInOutline[d]))!=null?u:!1,T=(0,Mne.useCallback)(N=>{ce().transaction(({stateEditors:R})=>{R.studio.ahistoric.projects.stateByProjectId.collapsedItemsInOutline.set({projectId:g,isCollapsed:N,itemKey:d})})},[d]);return{collapsed:_,setCollapsed:T}}var Mne,kRe=C(()=>{Mne=z(nt()),Pe(),Ar()}),$T,Cne,Ane,Nne,Pne,Rne,DRe=C(()=>{$T=z(nt()),yne(),RRe(),Pe(),Ar(),q7(),Cne=un(),tn(),kRe(),Nne=ge.div(Ane||(Ane=H([`
  color: #ff6363;
  margin-left: 11px;
  background: #4c282d;
  padding: 2px 8px;
  border-radius: 2px;
  font-size: 10px;
  box-shadow: 0 2px 8px -4px black;
`]))),Pne=({depth:a,project:u})=>{let d=di(()=>ep(),[]),g=di(()=>{let R=u.address.projectId,O=(0,Cne.val)(ce().atomP.ephemeral.coreByProject[R].loadingState);return(O==null?void 0:O.type)==="browserStateIsNotBasedOnDiskState"},[u]),_=(0,$T.useCallback)(()=>{ce().transaction(({stateEditors:R})=>{R.studio.historic.panels.outline.selection.set([u])})},[u]),{collapsed:T,setCollapsed:N}=IRe(u);return $T.default.createElement(Uz,{depth:a,label:u.address.projectId,setIsCollapsed:N,collapsed:T,labelDecoration:g?$T.default.createElement(Nne,null,"Has Conflicts"):null,children:$T.default.createElement(Ene,{project:u,depth:a+1}),selectionStatus:d.includes(u)?"selected":d.some(R=>R.address.projectId===u.address.projectId)?"descendant-is-selected":"not-selected",select:_})},Rne=Pne}),Ine,Vz,kne,Dne,One,Lne,ORe=C(()=>{Ine=un(),Ar(),Pe(),Vz=z(nt()),tn(),DRe(),Dne=ge.ul(kne||(kne=H([`
  list-style: none;
  margin: 0;
  padding: 0;
  padding-right: 4px;
`]))),One=a=>di(()=>{let u=(0,Ine.val)(ce().projectsP);return Vz.default.createElement(Dne,null,Object.keys(u).map(d=>{let g=u[d];return Vz.default.createElement(Rne,{depth:0,project:g,key:"projectListItem-".concat(d)})}))},[]),Lne=One});function LRe(a){let[u,d]=(0,Gz.useState)(!1);return(0,Gz.useEffect)(()=>{let g=T=>{let N=u?200:50,R=56,O=T.x<N;O&&(O=T.y>R),d(!!O)};document.addEventListener("mousemove",g);let _=()=>{d(!1)};return document.addEventListener("mouseleave",_),()=>{document.removeEventListener("mousemove",g),document.removeEventListener("mouseleave",_)}},[u]),u}var Gz,FRe=C(()=>{Gz=z(nt())}),WT,Y7,jz,Fne,Bne,Une,zne,dR,qT,Vne,BRe=C(()=>{WT=z(nt()),tn(),O4(),ORe(),Ar(),Pe(),FRe(),Y7=un(),ms(),jz="44px",Bne=ge.div(Fne||(Fne=H([`
  `,`;
  background-color: transparent;
  position: absolute;
  left: 8px;
  z-index: `,`;

  top: calc(`,` + 8px);
  height: fit-content;
  max-height: calc(100% - `,`);
  overflow-y: scroll;
  overflow-x: hidden;
  padding: 0;
  user-select: none;

  &::-webkit-scrollbar {
    display: none;
  }

  scrollbar-width: none;

  display: `,`;

  &:hover {
    display: block;
  }

  // Create a small buffer on the bottom to aid selecting the bottom item in a long, scrolling list
  &::after {
    content: '';
    display: block;
    height: 20px;
  }
`])),Zi,v8.outlinePanel,jz,jz,({pin:a})=>a?"block":"none"),Une=()=>{var a;let u=(a=ti(ce().atomP.ahistoric.pinOutline))!=null?a:!0,d=ti(Vne),g=LRe();return(0,WT.useLayoutEffect)(()=>{dR.set(g)},[g]),(0,WT.useEffect)(()=>()=>{qT.set(!1),dR.set(!1)},[]),WT.default.createElement(Bne,{pin:u||d,onMouseEnter:()=>{qT.set(!0)},onMouseLeave:()=>{qT.set(!1)}},WT.default.createElement(Lne,null))},zne=Une,dR=new Y7.Atom(!1),qT=new Y7.Atom(!1),Vne=(0,Y7.prism)(()=>{let a=(0,Y7.val)(qT.prism),u=(0,Y7.val)(dR.prism);return a||u})});function URe(){let[a,u]=(0,Hz.useState)(!1),d=(0,Hz.useMemo)(()=>{let g=new Set;return()=>{let _=()=>{g.delete(_),u(g.size>0)};return g.add(_),u(!0),_}},[]);return[a,d]}var Hz,zRe=C(()=>{Hz=z(nt())}),Gne,jne,Hne,VRe=C(()=>{Gne=z(nt()),jne=function(a){(0,Gne.useEffect)(a,[])},Hne=jne}),$ne,Wne,qne,GRe=C(()=>{$ne=z(nt()),VRe(),Wne=function(a){var u=(0,$ne.useRef)(a);u.current=a,Hne(function(){return function(){return u.current()}})},qne=Wne}),hR,Xne,Yne,jRe=C(()=>{hR=z(nt()),GRe(),Xne=function(a){var u=(0,hR.useRef)(0),d=(0,hR.useState)(a),g=d[0],_=d[1],T=(0,hR.useCallback)(function(N){cancelAnimationFrame(u.current),u.current=requestAnimationFrame(function(){_(N)})},[]);return qne(function(){cancelAnimationFrame(u.current)}),[g,T]},Yne=Xne});function HRe(a){for(var u=[],d=1;d<arguments.length;d++)u[d-1]=arguments[d];a&&a.addEventListener&&a.addEventListener.apply(a,u)}function $Re(a){for(var u=[],d=1;d<arguments.length;d++)u[d-1]=arguments[d];a&&a.removeEventListener&&a.removeEventListener.apply(a,u)}var pR,WRe=C(()=>{pR=typeof window<"u"}),Kne,Zne,fR,$z=C(()=>{Kne=z(nt()),jRe(),WRe(),Zne=function(a,u){a===void 0&&(a=1/0),u===void 0&&(u=1/0);var d=Yne({width:pR?window.innerWidth:a,height:pR?window.innerHeight:u}),g=d[0],_=d[1];return(0,Kne.useEffect)(function(){if(pR){var T=function(){_({width:window.innerWidth,height:window.innerHeight})};return HRe(window,"resize",T),function(){$Re(window,"resize",T)}}},[]),g},fR=Zne}),Wz,mR,gR,qz,K7,Qne,Xz,Z7=C(()=>{Wz=un(),Ar(),Pe(),zRe(),mR=z(nt()),$z(),gR=(a,u)=>{let d=a.left/u.width,g=(a.left+a.width)/u.width,_=a.top/u.height,T=(a.height+a.top)/u.height;return{edges:{left:d<=.5?{from:"screenLeft",distance:d}:{from:"screenRight",distance:1-d},right:g<=.5?{from:"screenLeft",distance:g}:{from:"screenRight",distance:1-g},top:_<=.5?{from:"screenTop",distance:_}:{from:"screenBottom",distance:1-_},bottom:T<=.5?{from:"screenTop",distance:T}:{from:"screenBottom",distance:1-T}}}},qz=mR.default.createContext(null),K7=()=>(0,mR.useContext)(qz),Qne=({panelId:a,children:u,defaultPosition:d,minDims:g})=>{let _=fR(800,200),[T,N]=URe(),{stuff:R}=di(()=>{var O;let{edges:B}=(O=(0,Wz.val)(ce().atomP.historic.panelPositions[a]))!=null?O:d,V=Math.floor(_.width*(B.left.from==="screenLeft"?B.left.distance:1-B.left.distance)),Y=Math.floor(_.width*(B.right.from==="screenLeft"?B.right.distance:1-B.right.distance)),W=Math.floor(_.height*(B.top.from==="screenTop"?B.top.distance:1-B.top.distance)),$=Math.floor(_.height*(B.bottom.from==="screenTop"?B.bottom.distance:1-B.bottom.distance)),K=Math.max(Y-V,g.width),J=Math.max($-W,g.height);return{stuff:{dims:Wz.prism.memo("dims",()=>({width:K,left:V,top:W,height:J}),[K,V,W,J]),panelId:a,minDims:g,boundsHighlighted:T,addBoundsHighlightLock:N}}},[a,_,T,N]);return mR.default.createElement(qz.Provider,{value:R},u)},Xz=Qne}),X2,Jne,bf,ere,tre,nre,rre,Yz,ire,Wu,sre,rc=C(()=>{X2=z(nt()),tn(),Jne="pointer-root",bf="--lockedCursor",tre=ge.div(ere||(ere=H([`
  pointer-events: auto;
  &.normal {
    pointer-events: none;
  }
`]))),rre=ge.div(nre||(nre=H([`
  position: absolute;
  inset: 0;
  pointer-events: none;

  #pointer-root:not(.normal) > & {
    pointer-events: auto;
  }
`]))),Yz=(0,X2.createContext)({}),ire=a=>{var u,d,g,_;let[T,N]=(0,X2.useState)([]),R=(0,X2.useMemo)(()=>({getLock:(B,V)=>{let Y={className:B,cursor:V};return N(W=>[...W,Y]),()=>{N(W=>W.filter($=>$!==Y))}}}),[]),O=(d=(u=T[0])==null?void 0:u.cursor)!=null?d:"";return X2.default.createElement(Yz.Provider,{value:R},X2.default.createElement(tre,{id:Jne,className:((_=(g=T[0])==null?void 0:g.className)!=null?_:"normal")+" "+a.className},X2.default.createElement(rre,{style:{cursor:O,[bf]:O}},a.children)))},Wu=(a,u,d)=>{let g=(0,X2.useContext)(Yz);(0,X2.useLayoutEffect)(()=>{if(a)return g.getLock(u,d)},[a,u,d])},sre=ire});function ore(a){return XT.default.createElement(Kz.Provider,{value:a.logger},a.children)}function Q7(a,u){let d=(0,XT.useContext)(Kz);return(0,XT.useMemo)(()=>a?d.named(a,u):d,[d,a,u])}var XT,Kz,x8=C(()=>{XT=z(nt()),Kz=XT.default.createContext(null)});function qRe(){let a=Q7("PointerCapturing"),u=_f.default.useRef(null),d=()=>u.current!=null;return g=>{let _,T=N=>(_=N,u.current=N,N);return{capturing:{capturePointer(N){if(a._debug("Capturing pointer",{forDebugName:g,reason:N}),u.current!=null)throw new Error('"'.concat(g,'" attempted capturing pointer for "').concat(N,'" while already captured by "').concat(u.current.debugOwnerName,'" for "').concat(u.current.debugReason,'"'));let R=T({debugOwnerName:g,debugReason:N});return{isCapturing(){return R===u.current},release(){return R===u.current?(a._debug("Releasing pointer",{forDebugName:g,reason:N}),T(null),!0):!1}}},isPointerBeingCaptured:d},forceRelease(){_&&u.current===_&&(a._debug("Force releasing pointer",{localCapture:_}),T(null))}}}}function XRe(a){let u=qRe();return _f.default.createElement(Zz.Provider,{value:u},_f.default.createElement(lre,{children:a.children}))}function are(a){let u=(0,_f.useContext)(Zz),d=(0,_f.useMemo)(()=>u(a),[a,u]);return(0,_f.useEffect)(()=>()=>{d.forceRelease()},[d]),d.capturing}var _f,Zz,lre,Qz=C(()=>{_f=z(nt()),x8(),Zz=_f.default.createContext(null),lre=_f.default.memo(({children:a})=>_f.default.createElement(_f.default.Fragment,null,a))}),Jz,YRe=C(()=>{Jz=typeof window<"u"&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)});function wo(a,u){let d=(0,J7.useRef)(u);d.current=u;let g=u.shouldPointerLock&&!Jz,_=(0,J7.useRef)({domDragStarted:!1}),{capturePointer:T}=are("useDrag for ".concat(u.debugName)),N=(0,J7.useRef)({onDrag:xf,onDragEnd:xf,onClick:xf}),R=(0,J7.useRef)(),[O,B]=Ni(!1);return(0,J7.useLayoutEffect)(()=>{if(!a)return;let V=()=>{let ue=_.current.domDragStarted&&_.current.detection.detected;O.current!==ue&&(O.current=ue)},Y=ue=>{if(!_.current.domDragStarted)return;let xe=_.current;if(!KRe(ue,xe)&&(xe.detection.detected||(xe.detection.totalDistanceMoved+=Math.abs(ue.movementY)+Math.abs(ue.movementX),xe.detection.totalDistanceMoved>cre&&(g&&a.requestPointerLock(),xe.detection={detected:!0,dragMovement:{x:0,y:0},dragEventCount:0},V())),xe.detection.detected)){xe.detection.dragEventCount+=1;let{dragMovement:Re}=xe.detection;if(g)Re.x+=ue.movementX,Re.y+=ue.movementY;else{let{startPos:Ae}=xe;Re.x=ue.screenX-Ae.x,Re.y=ue.screenY-Ae.y}N.current.onDrag(Re.x,Re.y,ue,ue.movementX,ue.movementY)}},W=ue=>{if(K(),!_.current.domDragStarted)return;let xe=_.current.detection.detected;_.current={domDragStarted:!1},u.shouldPointerLock&&!Jz&&document.exitPointerLock(),N.current.onDragEnd(xe),window.focus(),xe||N.current.onClick(ue),V()},$=()=>{document.addEventListener("mousemove",Y),document.addEventListener("mouseup",W)},K=()=>{var ue;(ue=R.current)==null||ue.release(),document.removeEventListener("mousemove",Y),document.removeEventListener("mouseup",W)},J=ue=>{d.current.disabled||_.current.domDragStarted&&_.current.detection.detected&&(d.current.dontBlockMouseDown||(ue.stopPropagation(),ue.preventDefault()),_.current.detection={detected:!1,totalDistanceMoved:0},V())},oe=ue=>{var xe,Re,Ae,we;(xe=R.current)==null||xe.release();let ft=d.current;if(ft.disabled===!0||!((Re=ft.buttons)!=null?Re:[0]).includes(ue.button))return;let Le=ft.onDragStart(ue);Le!==!1&&(N.current.onDrag=Le.onDrag,N.current.onDragEnd=(Ae=Le.onDragEnd)!=null?Ae:xf,N.current.onClick=(we=Le.onClick)!=null?we:xf,R.current=T("Drag start"),ft.dontBlockMouseDown||(ue.stopPropagation(),ue.preventDefault()),_.current={domDragStarted:!0,startPos:{x:ue.screenX,y:ue.screenY},detection:{detected:!1,totalDistanceMoved:0}},V(),$())},ae=ue=>{oe(ue)};return a.addEventListener("mousedown",ae),a.addEventListener("click",J),()=>{var ue,xe;K(),a.removeEventListener("mousedown",ae),a.removeEventListener("click",J),_.current.domDragStarted&&((xe=(ue=N.current).onDragEnd)==null||xe.call(ue,_.current.detection.detected)),_.current={domDragStarted:!1},V()}},[a]),Wu(B&&!!u.lockCSSCursorTo,"dragging",u.lockCSSCursorTo),[B]}function KRe(a,u){return(!u.detection.detected||u.detection.detected&&u.detection.dragEventCount<3)&&(Math.abs(a.movementX)>eV||Math.abs(a.movementY)>eV)}var J7,cre,eV,va=C(()=>{J7=z(nt()),rc(),Qz(),W7(),YRe(),ls(),cre=3,eV=100}),YT,ure,dre,hre,tV,pre=C(()=>{ls(),Pe(),va(),YT=z(nt()),tn(),Z7(),rc(),b0(),O4(),dre=ge.div(ure||(ure=H([`
  cursor: move;
`]))),hre=a=>{let u=K7(),d=(0,YT.useRef)(u);d.current=u;let[g,_]=Ni(null),T=(0,YT.useMemo)(()=>({debugName:"PanelDragZone",lockCursorTo:"move",onDragStart(){let B=d.current,V,Y=u.addBoundsHighlightLock(),W=B.panelId;if(W.startsWith("pane-")){let $=W.slice(5);ce().paneManager.bringPaneToFront($)}return{onDrag($,K){let J=U(P({},B.dims),{top:os(B.dims.top+K,0,window.innerHeight-T1),left:os(B.dims.left+$,-B.dims.width+T1,window.innerWidth-T1)}),oe=gR(J,{width:window.innerWidth,height:window.innerHeight});V==null||V.discard(),V=ce().tempTransaction(({stateEditors:ae})=>{ae.studio.historic.panelPositions.setPanelPosition({position:oe,panelId:B.panelId})})},onDragEnd($){Y(),$?V==null||V.commit():V==null||V.discard()}}}}),[]),[N]=wo(_,T);Wu(N,"dragging","move");let[R,O]=(0,YT.useMemo)(()=>{let B;return[function(){if(B){let V=B;B=void 0,V()}B=u.addBoundsHighlightLock()},function(){if(B){let V=B;B=void 0,V()}}]},[]);return YT.default.createElement(dre,U(P({},a),{ref:g,onMouseEnter:R,onMouseLeave:O}))},tV=hre}),KT,nV,fre,rV,mre,iV,gre,sV,yre,vre,xre,bre,_re,oV,Sre,wre,Tre,Ere,Mre,ZT,Cre,Are,Nre,Pre,Rre,Ire,kre,Dre,Ore,aV,Lre,Y2,ZRe=C(()=>{ls(),Pe(),va(),vf(),KT=z(nt()),tn(),Z7(),ms(),b0(),O4(),nV=un(),rV=ge.div(fre||(fre=H([`
  position: absolute;
  `,`;
  &:after {
    position: absolute;
    inset: -5px;
    display: block;
    content: ' ';
  }

  opacity: 0;
  background-color: #478698;

  &.isHighlighted {
    opacity: 0.7;
  }

  &.isDragging {
    opacity: 1;
    /* background-color: `,`; */
  }

  &:hover {
    opacity: 1;
  }
`])),Zi,B7(.2,"#478698")),iV=ge(rV)(mre||(mre=H([`
  /**
  The horizintal/vertical resize handles have z-index:-1 and are offset 1px outside of the panel
  to make sure they don't occlude any element that pops out of the panel (like the Playhead in SequenceEditorPanel).

  This means that panels will always need an extra 1px margin for their resize handles to be visible, but that's not a problem
  that we have to deal with right now (if it is at all a problem).
  
   */
  z-index: -1;
`]))),sV=ge(iV)(gre||(gre=H([`
  left: 0px;
  right: 0px;
  height: 1px;
`]))),vre=ge(sV)(yre||(yre=H([`
  top: -1px;
`]))),bre=ge(sV)(xre||(xre=H([`
  bottom: -1px;
`]))),oV=ge(iV)(_re||(_re=H([`
  z-index: -1;
  top: -1px;
  bottom: -1px;
  width: 1px;
`]))),wre=ge(oV)(Sre||(Sre=H([`
  left: -1px;
`]))),Ere=ge(oV)(Tre||(Tre=H([`
  right: -1px;
`]))),ZT=ge(rV)(Mre||(Mre=H([`
  // The angles have z-index: 10 to make sure they _do_ occlude other elements in the panel.
  z-index: 10;
  width: 8px;
  height: 8px;
`]))),Are=ge(ZT)(Cre||(Cre=H([`
  top: 0;
  left: 0;
`]))),Pre=ge(ZT)(Nre||(Nre=H([`
  top: 0;
  right: 0;
`]))),Ire=ge(ZT)(Rre||(Rre=H([`
  bottom: 0;
  left: 0;
`]))),Dre=ge(ZT)(kre||(kre=H([`
  bottom: 0;
  right: 0;
`]))),Ore={Top:vre,TopLeft:Are,TopRight:Pre,Bottom:bre,BottomLeft:Ire,BottomRight:Dre,Left:wre,Right:Ere},aV={Top:"ns-resize",Bottom:"ns-resize",Left:"ew-resize",Right:"ew-resize",TopLeft:"nw-resize",TopRight:"ne-resize",BottomLeft:"sw-resize",BottomRight:"se-resize"},Lre=({which:a})=>{let u=K7(),d=(0,KT.useRef)(u);d.current=u;let g=(0,KT.useRef)(0),[_,T]=Ni(null),N=(0,KT.useMemo)(()=>({debugName:"PanelResizeHandle",lockCursorTo:aV[a],onDragStart(){var V;let Y,W=d.current,$=u.addBoundsHighlightLock();return g.current=(V=(0,nV.val)(ce().atomP.historic.panels.sequenceEditor.dopesheetLeftWidth))!=null?V:225,{onDrag(K,J){var oe;let ae=(oe=(0,nV.val)(ce().atomP.historic.panels.sequenceEditor.rightPanelOpen))!=null?oe:!0,ue=P({},W.dims);if(a.startsWith("Bottom"))ue.height=Math.max(ue.height+J,W.minDims.height);else if(a.startsWith("Top")){let Re=ue.top+ue.height,Ae=os(ue.top+J,0,Math.min(Re-W.minDims.height,window.innerHeight-T1)),we=Re-Ae;ue.height=we,ue.top=Ae}if(a.endsWith("Left")){let Re=ue.left+ue.width,Ae=Math.min(ue.left+K,Math.min(Re-W.minDims.width,window.innerWidth-T1)),we=Re-Ae;ue.width=we,ue.left=Ae}else a.endsWith("Right")&&(ue.width=Math.max(ue.width+K,Math.max(W.minDims.width,T1-W.dims.left)));let xe=gR(ue,{width:window.innerWidth,height:window.innerHeight});Y==null||Y.discard(),Y=ce().tempTransaction(({stateEditors:Re})=>{if(!ae&&(a==="BottomRight"||a==="TopRight")&&W.panelId==="sequenceEditor"){let Ae=Math.max(225,g.current+K);Re.studio.historic.panels.sequenceEditor.setDopesheetLeftWidth(Ae)}Re.studio.historic.panelPositions.setPanelPosition({position:xe,panelId:W.panelId})})},onDragEnd(K){$(),K?Y==null||Y.commit():Y==null||Y.discard()}}}}),[a]),[R]=wo(T,N),O=Ore[a],B=a.length<=6;return KT.default.createElement(O,{ref:_,className:[R?"isDragging":"",u.boundsHighlighted&&B?"isHighlighted":""].join(" "),style:{cursor:aV[a]}})},Y2=Lre}),Sf,Fre,Bre,QRe=C(()=>{Sf=z(nt()),ZRe(),Fre=a=>Sf.default.createElement(Sf.default.Fragment,null,Sf.default.createElement(Y2,{which:"Bottom"}),Sf.default.createElement(Y2,{which:"Top"}),Sf.default.createElement(Y2,{which:"Left"}),Sf.default.createElement(Y2,{which:"Right"}),Sf.default.createElement(Y2,{which:"TopLeft"}),Sf.default.createElement(Y2,{which:"TopRight"}),Sf.default.createElement(Y2,{which:"BottomLeft"}),Sf.default.createElement(Y2,{which:"BottomRight"})),Bre=Fre}),yR,Ure,zre,Vre,lV,Gre=C(()=>{ms(),yR=z(nt()),tn(),Z7(),QRe(),zre=ge.div(Ure||(Ure=H([`
  position: absolute;
  user-select: none;
  box-sizing: border-box;
  `,`;
  /* box-shadow: 1px 2px 10px -5px black; */

  z-index: 1000;
`])),Zi),Vre=yR.default.forwardRef((a,u)=>{let d=K7(),g=a,{style:_,children:T}=g,N=j(g,["style","children"]);return yR.default.createElement(zre,U(P({ref:u},N),{style:P({width:d.dims.width+"px",height:d.dims.height+"px",top:d.dims.top+"px",left:d.dims.left+"px"},_??{})}),yR.default.createElement(Bre,null),T)}),lV=Vre}),JRe=Z((a,u)=>{(function(d,g){typeof a=="object"&&typeof u<"u"?g(a,nt()):(d=typeof globalThis<"u"?globalThis:d||self,g(d.ReactErrorBoundary={},d.React))})(a,function(d,g){function _($){if($&&$.__esModule)return $;var K=Object.create(null);return $&&Object.keys($).forEach(function(J){if(J!=="default"){var oe=Object.getOwnPropertyDescriptor($,J);Object.defineProperty(K,J,oe.get?oe:{enumerable:!0,get:function(){return $[J]}})}}),K.default=$,Object.freeze(K)}var T=_(g);function N($,K){return N=Object.setPrototypeOf||function(J,oe){return J.__proto__=oe,J},N($,K)}function R($,K){$.prototype=Object.create(K.prototype),$.prototype.constructor=$,N($,K)}var O=function($,K){return $===void 0&&($=[]),K===void 0&&(K=[]),$.length!==K.length||$.some(function(J,oe){return!Object.is(J,K[oe])})},B={error:null},V=function($){R(K,$);function K(){for(var oe,ae=arguments.length,ue=new Array(ae),xe=0;xe<ae;xe++)ue[xe]=arguments[xe];return oe=$.call.apply($,[this].concat(ue))||this,oe.state=B,oe.updatedWithError=!1,oe.resetErrorBoundary=function(){for(var Re,Ae=arguments.length,we=new Array(Ae),ft=0;ft<Ae;ft++)we[ft]=arguments[ft];oe.props.onReset==null||(Re=oe.props).onReset.apply(Re,we),oe.reset()},oe}K.getDerivedStateFromError=function(oe){return{error:oe}};var J=K.prototype;return J.reset=function(){this.updatedWithError=!1,this.setState(B)},J.componentDidCatch=function(oe,ae){var ue,xe;(ue=(xe=this.props).onError)==null||ue.call(xe,oe,ae)},J.componentDidMount=function(){var oe=this.state.error;oe!==null&&(this.updatedWithError=!0)},J.componentDidUpdate=function(oe){var ae=this.state.error,ue=this.props.resetKeys;if(ae!==null&&!this.updatedWithError){this.updatedWithError=!0;return}if(ae!==null&&O(oe.resetKeys,ue)){var xe,Re;(xe=(Re=this.props).onResetKeysChange)==null||xe.call(Re,oe.resetKeys,ue),this.reset()}},J.render=function(){var oe=this.state.error,ae=this.props,ue=ae.fallbackRender,xe=ae.FallbackComponent,Re=ae.fallback;if(oe!==null){var Ae={error:oe,resetErrorBoundary:this.resetErrorBoundary};if(T.isValidElement(Re))return Re;if(typeof ue=="function")return ue(Ae);if(xe)return T.createElement(xe,Ae);throw new Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}return this.props.children},K}(T.Component);function Y($,K){var J=function(ae){return T.createElement(V,K,T.createElement($,ae))},oe=$.displayName||$.name||"Unknown";return J.displayName="withErrorBoundary("+oe+")",J}function W($){var K=T.useState(null),J=K[0],oe=K[1];if($!=null)throw $;if(J!=null)throw J;return oe}d.ErrorBoundary=V,d.useErrorHandler=W,d.withErrorBoundary=Y,Object.defineProperty(d,"__esModule",{value:!0})})}),eIe=C(()=>{}),cV,uV,dV,jre=C(()=>{cV=z(nt()),uV={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},dV=cV.default.createContext&&cV.default.createContext(uV)});function Hre(a){return a&&a.map(function(u,d){return tb.default.createElement(u.tag,K2({key:d},u.attr),Hre(u.child))})}function eb(a){return function(u){return tb.default.createElement(tIe,K2({attr:K2({},a.attr)},u),Hre(a.child))}}function tIe(a){var u=function(d){var g=a.attr,_=a.size,T=a.title,N=$re(a,["attr","size","title"]),R=_||d.size||"1em",O;return d.className&&(O=d.className),a.className&&(O=(O?O+" ":"")+a.className),tb.default.createElement("svg",K2({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},d.attr,g,N,{className:O,style:K2(K2({color:a.color||d.color},d.style),a.style),height:R,width:R,xmlns:"http://www.w3.org/2000/svg"}),T&&tb.default.createElement("title",null,T),a.children)};return dV!==void 0?tb.default.createElement(dV.Consumer,null,function(d){return u(d)}):u(uV)}var tb,K2,$re,nIe=C(()=>{tb=z(nt()),jre(),K2=function(){return K2=Object.assign||function(a){for(var u,d=1,g=arguments.length;d<g;d++){u=arguments[d];for(var _ in u)Object.prototype.hasOwnProperty.call(u,_)&&(a[_]=u[_])}return a},K2.apply(this,arguments)},$re=function(a,u){var d={};for(var g in a)Object.prototype.hasOwnProperty.call(a,g)&&u.indexOf(g)<0&&(d[g]=a[g]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _=0,g=Object.getOwnPropertySymbols(a);_<g.length;_++)u.indexOf(g[_])<0&&Object.prototype.propertyIsEnumerable.call(a,g[_])&&(d[g[_]]=a[g[_]]);return d}}),Oa=C(()=>{eIe(),nIe(),jre()}),rIe=C(()=>{Oa()}),iIe=C(()=>{Oa()});function sIe(a){return eb({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}}]})(a)}var oIe=C(()=>{Oa()}),aIe=C(()=>{Oa()}),lIe=C(()=>{Oa()});function cIe(a){return eb({attr:{viewBox:"0 0 8 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M5.5 3L7 4.5 3.25 8 7 11.5 5.5 13l-5-5 5-5z"}}]})(a)}function uIe(a){return eb({attr:{viewBox:"0 0 8 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"}}]})(a)}var dIe=C(()=>{Oa()}),hIe=C(()=>{Oa()}),pIe=C(()=>{Oa()}),fIe=C(()=>{Oa()}),mIe=C(()=>{Oa()}),gIe=C(()=>{Oa()}),yIe=C(()=>{Oa()}),vIe=C(()=>{Oa()}),xIe=C(()=>{Oa()}),bIe=C(()=>{Oa()});function _Ie(a){return eb({attr:{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"}}]})(a)}var SIe=C(()=>{Oa()}),wIe=C(()=>{Oa()}),TIe=C(()=>{Oa()}),EIe=C(()=>{Oa()});function MIe(a){return eb({attr:{viewBox:"0 0 24 24",fill:"none"},child:[{tag:"path",attr:{d:"M6 9.65685L7.41421 11.0711L11.6569 6.82843L15.8995 11.0711L17.3137 9.65685L11.6569 4L6 9.65685Z",fill:"currentColor"}},{tag:"path",attr:{d:"M6 14.4433L7.41421 13.0291L11.6569 17.2717L15.8995 13.0291L17.3137 14.4433L11.6569 20.1001L6 14.4433Z",fill:"currentColor"}}]})(a)}var CIe=C(()=>{Oa()});function AIe(a){return eb({attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M14 10.44l-.413.56H2.393L2 10.46 7.627 5h.827L14 10.44z"}}]})(a)}var NIe=C(()=>{Oa()}),QT=C(()=>{rIe(),iIe(),oIe(),aIe(),lIe(),dIe(),hIe(),pIe(),fIe(),mIe(),gIe(),yIe(),vIe(),xIe(),bIe(),SIe(),wIe(),TIe(),EIe(),CIe(),NIe()}),Gl,Wre,qre,Xre,Yre,Kre,Zre,Qre,Jre,eie,tie,nie,rie,iie,sie,oie,aie,lie,cie,uie,PIe=C(()=>{Gl=z(nt()),tn(),O4(),Z7(),pre(),Gre(),Wre=z(JRe()),QT(),Pe(),O4(),Ar(),qre={edges:{left:{from:"screenLeft",distance:.3},right:{from:"screenRight",distance:.3},top:{from:"screenTop",distance:.3},bottom:{from:"screenBottom",distance:.3}}},Xre={width:300,height:300},Yre=({paneInstance:a})=>Gl.default.createElement(Xz,{panelId:"pane-".concat(a.instanceId),defaultPosition:qre,minDims:Xre},Gl.default.createElement(cie,{paneInstance:a})),Zre=ge(lV)(Kre||(Kre=H([`
  display: flex;
  flex-direction: column;

  box-shadow: 0px 5px 12px -4px rgb(0 0 0 / 22%);
  z-index: `,`;
`])),a=>a.$zIndex),Jre=ge.div(Qre||(Qre=H([`
  width: 100%;
`]))),tie=ge.div(eie||(eie=H([`
  display: flex;
  align-items: center;
  opacity: 1;
  position: absolute;
  right: 4px;
  top: 0;
  bottom: 0;
`]))),rie=ge.button(nie||(nie=H([`
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 2px;
  font-size: 11px;
  height: 10px;
  width: 18px;
  color: #adadadb3;
  background: transparent;
  border: none;
  cursor: pointer;
  &:hover {
    color: white;
  }
`]))),sie=ge(Yte)(iie||(iie=H([`
  position: relative;
  overflow: hidden;

  &:after {
    z-index: 10;
    position: absolute;
    inset: 0;
    display: block;
    content: ' ';
    pointer-events: none;

    #pointer-root:not(.normal) & {
      pointer-events: auto;
    }
  }
`]))),aie=ge.div(oie||(oie=H([`
  padding: 12px;

  & > pre {
    border: 1px solid #ff62624f;
    background-color: rgb(255 0 0 / 5%);
    margin: 8px 0;
    padding: 8px;
    font-family: monospace;
    overflow: scroll;
    color: #ff9896;
  }
`]))),lie=a=>Gl.default.createElement(aie,null,"An Error occurred rendering this pane. Open the console for more info.",Gl.default.createElement("pre",null,JSON.stringify({message:a.error.message,stack:a.error.stack},null,2))),cie=({paneInstance:a})=>{var u;let[d,g]=(0,Gl.useState)(null),_=a.definition.mount;(0,Gl.useLayoutEffect)(()=>{if(!d)return;let B=_({paneId:a.instanceId,node:d});if(typeof B=="function")return B},[d,_,a.instanceId]);let T=(0,Gl.useCallback)(()=>{ce().paneManager.destroyPane(a.instanceId)},[a]),N=(0,Gl.useCallback)(()=>{ce().paneManager.bringPaneToFront(a.instanceId)},[a]),R=((u=ti(ce().atomP.historic.paneFocusOrder))!=null?u:[]).indexOf(a.instanceId),O=R>=0?v8.pluginPanes+R:v8.pluginPanes;return Gl.default.createElement(Zre,{"data-testid":"theatre-pane-wrapper-".concat(a.instanceId),$zIndex:O,onMouseDown:N},Gl.default.createElement(tV,null,Gl.default.createElement(aR,null,Gl.default.createElement(tie,null,Gl.default.createElement(rie,{onClick:T,title:"Close Pane"},Gl.default.createElement(sIe,null))),Gl.default.createElement(Jre,null,a.instanceId))),Gl.default.createElement(Wre.ErrorBoundary,{FallbackComponent:lie},Gl.default.createElement(sie,{"data-testid":"theatre-pane-content-".concat(a.instanceId),ref:g})))},uie=Yre});function nb(a){return JSON.stringify(hV(a))}function hV(a){return u1(a)?Object.keys(a).sort().reduce((u,d)=>(u[d]=hV(a[d]),u),{}):Array.isArray(a)?a.map(hV):a}var RIe=C(()=>{b0()}),die,rb,hie=C(()=>{die="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",rb=(a=21)=>{let u="",d=a;for(;d--;)u+=die[Math.random()*64|0];return u}});function pie(){return rb(10)}function IIe(){return rb(10)}function fie(){return rb(10)}function mie(){return rb(10)}var jl,wf=C(()=>{RIe(),hie(),jl={forSheet(){return"sheet"},forSheetObject(a){return nb({o:a.address.objectKey})},forSubSequence(a){return nb({ss:a})},forSheetObjectProp(a,u){return nb({o:a.address.objectKey,p:u})},forTrackKeyframe(a,u,d){return nb({o:a.address.objectKey,t:u,k:d})},forSheetObjectAggregateKeyframe(a,u){return jl.forCompoundPropAggregateKeyframe(a,[],u)},forSheetAggregateKeyframe(a,u){return nb({o:a.address.sheetId,pos:u})},forCompoundPropAggregateKeyframe(a,u,d){return nb({o:a.address.objectKey,p:u,pos:d})}}}),pV,fV,gie=C(()=>{pV=un(),fV=(a,u)=>{let d=pV.prism.memo(a,()=>new pV.Atom(u),[]);return d.set(u),d}}),yie,Tf,Z2=C(()=>{tn(),Tf=Yd(yie||(yie=H([`
  font-weight: 300;
  font-size: 11px;
  color: `,`;
  text-shadow: 0.5px 0.5px 2px rgba(0, 0, 0, 0.3);
`])),a=>a.isHighlighted==="self"?"#CCC":"#919191")});function ib(a,u){let d=a;for(let g of u)d=d[g];return d}var JT=C(()=>{});function kIe(){let a=0,u=new bie.Atom({hasLock:!1});return{replaceLock(d,g){let _=a++,T=u.get();return T.hasLock&&T.cleanup(),u.set({hasLock:!0,lockId:_,cleanup:g,deepPath:DIe(vie(d))}),function(){let N=u.get();N.hasLock&&N.lockId===_&&(N.cleanup(),u.set({hasLock:!1}))}},getIsPropHighlightedD(d){let g=ib(u.pointer.deepPath,vie(d));return(0,_ie.prism)(()=>{let _=(0,xie.val)(g);return _===!0?"self":_?"descendent":null})}}}function vie(a){return[a.projectId,a.sheetId,a.objectKey,...a.pathToProp]}function DIe(a){let u={};return Do(u,a,!0),u}var xie,bie,_ie,Sie,OIe=C(()=>{xie=un(),bie=un(),_ie=un(),JT(),Zo(),Sie=kIe()});function mV(a,u){(0,wie.useLayoutEffect)(()=>{if(!a||u.type!=="propWithChildren"&&u.type!=="primitiveProp"&&u.type!=="sheetObject")return;let d=null,g=U(P({},u.sheetObject.address),{pathToProp:u.type==="sheetObject"?[]:u.pathToProp});function _(){d=Sie.replaceLock(g,()=>{})}function T(){d==null||d()}return a.addEventListener("mouseenter",_),a.addEventListener("mouseleave",T),()=>{d==null||d(),a.removeEventListener("mouseenter",_),a.removeEventListener("mouseleave",T)}},[a])}var wie,gV=C(()=>{wie=z(nt()),OIe()});function yV(a){let[u,d]=(0,vV.useState)(null);return(0,vV.useLayoutEffect)(()=>(a&&d(a.getBoundingClientRect()),()=>{d(null)}),[a]),u}var vV,Tie=C(()=>{vV=z(nt())}),eE,vR,Eie,Mie,Cie,Aie,Nie,Pie,Rie=C(()=>{W7(),eE=z(nt()),tn(),vR=26,Mie=ge.li(Eie||(Eie=H([`
  height: `,`px;
  padding: 0 12px;
  margin: 0;
  display: flex;
  align-items: center;
  font-size: 11px;
  font-weight: 400;
  position: relative;
  color: `,`;
  cursor: `,`;

  &:after {
    position: absolute;
    inset: 2px 1px;
    display: block;
    content: ' ';
    pointer-events: none;
    z-index: -1;
    border-radius: 3px;
  }

  &:hover:after {
    background-color: `,`;
  }
`])),vR,a=>a.enabled?"white":"#8f8f8f",a=>a.enabled?"normal":"not-allowed",a=>a.enabled?"rgba(63, 174, 191, 0.75)":"initial"),Aie=ge.span(Cie||(Cie=H([""]))),Nie=a=>eE.default.createElement(Mie,{onClick:a.enabled?a.onClick:xf,enabled:a.enabled,title:a.enabled?void 0:"Disabled"},eE.default.createElement(Aie,null,eE.default.createElement(eE.default.Fragment,null,a.label))),Pie=Nie});function LIe(a){let u=(0,xV.useRef)(a);u.current=a,(0,xV.useEffect)(()=>{let d=g=>u.current(g);return window.addEventListener("keydown",d),()=>{window.removeEventListener("keydown",d)}},[])}var xV,FIe=C(()=>{xV=z(nt())}),tE,Iie,kie,Die,Oie,Lie,Fie,Bie,bV,Uie=C(()=>{tE=z(nt()),Rie(),tn(),vf(),ms(),Iie=190,kie=!0,Oie=ge.ul(Die||(Die=H([`
  position: absolute;
  min-width: `,`px;
  z-index: 10000;
  background: `,`;
  backdrop-filter: blur(2px);
  color: white;
  list-style-type: none;
  padding: 2px 0;
  margin: 0;
  border-radius: 1px;
  cursor: default;
  `,`;
  border-radius: 3px;
`])),Iie,w1(.2,"#111"),Zi),Fie=ge.div(Lie||(Lie=H([`
  padding: 4px 10px;
  border-bottom: 1px solid #6262626d;
  color: #adadadb3;
  font-size: 11px;
  font-weight: 500;
`]))),Bie=tE.default.forwardRef((a,u)=>tE.default.createElement(Oie,{ref:u},kie&&a.displayName?tE.default.createElement(Fie,null,a.displayName):null,a.items.map((d,g)=>tE.default.createElement(Pie,{key:"item-".concat(g),label:d.label,enabled:d.enabled!==!1,onClick:_=>{d.callback&&d.callback(_),a.onRequestClose()}})))),bV=Bie}),zie,Vie,xR,Gie,nE,jie,Hie,BIe=C(()=>{Tie(),zie=z(nt()),Vie=z(nt()),xR=z(nt()),Gie=z(H2()),$z(),Rie(),y8(),FIe(),Uie(),nE=20,jie=a=>{let[u,d]=(0,xR.useState)(null),g=yV(u),_=fR();(0,xR.useLayoutEffect)(()=>{if(!g||!u)return;let R={left:g.width/2,top:vR/2+(a.displayName?vR:0)},O={left:a.clickPoint.clientX-R.left,top:a.clickPoint.clientY-R.top};O.left<0?O.left=0:O.left+g.width>_.width&&(O.left=_.width-g.width),O.top<0?O.top=0:O.top+g.height>_.height&&(O.top=_.height-g.height),u.style.left=O.left+"px",u.style.top=O.top+"px";let B=V=>{(V.clientX<O.left-nE||V.clientX>O.left+g.width+nE||V.clientY<O.top-nE||V.clientY>O.top+g.height+nE)&&a.onRequestClose()};return window.addEventListener("mousemove",B),()=>{window.removeEventListener("mousemove",B)}},[g,u,a.clickPoint,_,a.onRequestClose]);let T=(0,Vie.useContext)(H7);LIe(R=>{R.key==="Escape"&&a.onRequestClose()});let N=(0,zie.useMemo)(()=>{let R=Array.isArray(a.items)?a.items:a.items();return R.length>0?R:[{label:a.displayName?"No actions for ".concat(a.displayName):"No actions found",enabled:!1}]},[a.items]);return(0,Gie.createPortal)(xR.default.createElement(bV,{items:N,onRequestClose:a.onRequestClose,displayName:a.displayName,ref:d}),T)},Hie=jie}),bR,$ie,Wie,UIe=C(()=>{bR=z(nt()),$ie=(a,u)=>{let[d,g]=(0,bR.useState)({isOpen:!1}),_=(0,bR.useCallback)(()=>g({isOpen:!1}),[]);return(0,bR.useEffect)(()=>{if(!a||u.disabled===!0){g({isOpen:!1});return}let T=N=>{g({isOpen:!0,event:N}),N.preventDefault(),N.stopPropagation()};return a.addEventListener("contextmenu",T),()=>{a.removeEventListener("contextmenu",T)}},[a,u.disabled]),[d,_]},Wie=$ie}),qie,Xie,Yie,zIe=C(()=>{tn(),Xie=ge.input.attrs({type:"checkbox"})(qie||(qie=H([`
  outline: none;
`]))),Yie=Xie});function VIe({propConfig:a,editingTools:u,value:d,autoFocus:g}){let _=(0,_V.useCallback)(T=>{u.permanentlySetValue(!!T.target.checked)},[a,u]);return _V.default.createElement(Zie,{checked:d,onChange:_,autoFocus:g})}var _V,Kie,Zie,Qie,GIe=C(()=>{_V=z(nt()),tn(),zIe(),Zie=ge(Yie)(Kie||(Kie=H([`
  margin-left: 6px;

  :focus {
    outline: 1px solid #555;
  }
`]))),Qie=VIe});function _R(a){return u=>{a.forEach(d=>{typeof d=="function"?d(u):d!=null&&(d.current=u)})}}var SR=C(()=>{});function SV(a,u,d){(0,Jie.useEffect)(()=>{if(!a||d===!1)return;let g=Array.isArray(a)?a.filter(T=>T):[a],_=T=>{g.every(N=>!T.composedPath().includes(N))&&u(T)};return window.addEventListener("mousedown",_,{capture:!0,passive:!1}),()=>{window.removeEventListener("mousedown",_,{capture:!0,passive:!1})}},[a,d])}var Jie,wV=C(()=>{Jie=z(nt())});function jIe(a){return isNaN(a)?"NaN":MT(a)?a.toFixed(0):Jr(a,3).toString()}var ese,tse,Q2,nse,wR,rse,ise,sse,ose,ase,lse,cse,use,sb,rE=C(()=>{b0(),ese=z(nt()),tse=z(nt()),Q2=z(nt()),tn(),SR(),ls(),wV(),va(),wR=ge.div(nse||(nse=H([`
  height: 100%;
  width: 100%;
  position: relative;
  z-index: 0;
  box-sizing: border-box;
  display: flex;
  align-items: center;

  &:after {
    position: absolute;
    inset: 1px 0 2px;
    display: block;
    content: ' ';
    background-color: transparent;
    border: 1px solid transparent;
    z-index: -2;
    box-sizing: border-box;
    border-radius: 1px;
  }

  &:hover,
  &.dragging,
  &.editingViaKeyboard {
    &:after {
      background-color: #10101042;
      border-color: #00000059;
    }
  }
`]))),ise=ge.input(rse||(rse=H([`
  background: transparent;
  border: 1px solid transparent;
  color: rgba(255, 255, 255, 0.9);
  padding: 1px 6px;
  font: inherit;
  outline: none;
  cursor: ew-resize;
  text-align: left;
  width: 100%;
  height: calc(100% - 4px);
  border-radius: 2px;

  &:focus {
    cursor: text;
  }
`]))),ose=ge.div(sse||(sse=H([`
  position: absolute;
  inset: 3px 2px 4px;
  transform: scale(var(--percentage), 1);
  transform-origin: top left;
  background-color: #2d5561;
  z-index: -1;
  border-radius: 2px;
  pointer-events: none;

  `,".dragging &, ",`.noFocus:hover & {
    background-color: #338198;
  }
`])),wR,wR),lse=ge.div(ase||(ase=H([`
  display: contents;
`]))),cse=a=>!0,use=a=>{var u;let[d]=Ni({mode:"noFocus"}),g=(u=a.isValid)!=null?u:cse,_=(0,Q2.useRef)(a);_.current=a;let T=(0,Q2.useRef)(null);SV(T.current,()=>{T.current.blur()},d.current.mode==="editingViaKeyboard");let N=(0,Q2.useRef)(null),R=(0,Q2.useMemo)(()=>{let oe=Le=>{let Se=Le.target,{value:Ge}=Se,Je=d.current;d.current=U(P({},Je),{currentEditedValueInString:Ge});let He=parseFloat(Ge);!isFinite(He)||!g(He)||_.current.temporarilySetValue(He)},ae=()=>{d.current.mode==="editingViaKeyboard"&&(ue(),d.current={mode:"noFocus"}),a.onBlur&&a.onBlur()},ue=()=>{let Le=d.current,Se=parseFloat(Le.currentEditedValueInString);!isFinite(Se)||!g(Se)||Le.valueBeforeEditing===Se?_.current.discardTemporaryValue():_.current.permanentlySetValue(Se)},xe=Le=>{Le.key==="Escape"?(_.current.discardTemporaryValue(),d.current={mode:"noFocus"},T.current.blur()):(Le.key==="Enter"||Le.key==="Tab")&&(ue(),T.current.blur())},Re=Le=>{d.current.mode==="noFocus"&&(T.current.focus(),Le.preventDefault()),Le.stopPropagation()},Ae=()=>{d.current.mode==="noFocus"?we():d.current.mode},we=()=>{let Le=_.current.value;d.current={mode:"editingViaKeyboard",currentEditedValueInString:String(Le),valueBeforeEditing:Le},setTimeout(()=>{T.current.focus(),T.current.setSelectionRange(0,100)})},ft;return{inputChange:oe,onBlur:ae,transitionToDraggingMode:()=>{var Le;let Se=_.current.value;ft=(Le=T.current)==null?void 0:Le.getBoundingClientRect().width,d.current={mode:"dragging"};let Ge=Se,Je=Se;return N.current=document.body.style.cursor,{onDrag(He,Bt,Qe,Zt){let gt=Qe.altKey?Zt/10:Zt,it=Je+a.nudge({deltaX:gt,deltaFraction:gt/ft,magnitude:1});Je=a.range?os(it,a.range[0],a.range[1]):it,_.current.temporarilySetValue(Je)},onDragEnd(He){He?(Ge===Je?_.current.discardTemporaryValue():_.current.permanentlySetValue(Je),d.current={mode:"noFocus"}):(_.current.discardTemporaryValue(),d.current={mode:"noFocus"})},onClick(){T.current.focus(),T.current.setSelectionRange(0,100)}}},onInputKeyDown:xe,onClick:Re,onFocus:Ae}},[]);(0,ese.useEffect)(()=>()=>{R.onBlur()},[]);let O=d.current.mode!=="editingViaKeyboard"?jIe(a.value):d.current.currentEditedValueInString;typeof O=="number"&&isNaN(O)&&(O="NaN");let B=[T];a.inputRef&&B.push(a.inputRef);let V=Q2.default.createElement(ise,{key:"input",type:"text",onChange:R.inputChange,value:O,onBlur:R.onBlur,onKeyDown:R.onInputKeyDown,onClick:R.onClick,onFocus:R.onFocus,ref:_R(B),onMouseDown:oe=>{oe.stopPropagation()},onDoubleClick:oe=>{oe.preventDefault(),oe.stopPropagation()},autoFocus:a.autoFocus}),{range:Y}=a,W=parseFloat(O),$=Y?Q2.default.createElement(ose,{style:{"--percentage":os((W-Y[0])/(Y[1]-Y[0]),0,1)}}):null,[K,J]=(0,tse.useState)(null);return wo(K,{debugName:"form/BasicNumberInput",onDragStart:R.transitionToDraggingMode,lockCSSCursorTo:"ew-resize",shouldPointerLock:!0,disabled:d.current.mode==="editingViaKeyboard"}),Q2.default.createElement(wR,{className:a.className+" "+d.current.mode},Q2.default.createElement(lse,{ref:J},V),$)},sb=use});function HIe({propConfig:a,editingTools:u,value:d,autoFocus:g}){let _=(0,TV.useCallback)(T=>a.nudgeFn(U(P({},T),{config:a})),[a]);return TV.default.createElement(sb,{value:d,temporarilySetValue:u.temporarilySetValue,discardTemporaryValue:u.discardTemporaryValue,permanentlySetValue:u.permanentlySetValue,range:a.range,nudge:_,autoFocus:g})}var TV,dse,$Ie=C(()=>{rE(),TV=z(nt()),dse=HIe});function WIe({value:a,onChange:u,options:d,autoFocus:g}){let _=(0,iE.useCallback)(T=>{u(String(T.target.value))},[u]);return iE.default.createElement(EV,{role:"radiogroup"},Object.keys(d).map((T,N)=>iE.default.createElement(fse,{key:"label-"+N,"data-checked":a===T},d[T],iE.default.createElement(gse,{type:"radio",checked:a===T,value:T,onChange:_,name:"switchbox",autoFocus:g}))))}var iE,hse,EV,pse,fse,mse,gse,yse,qIe=C(()=>{vf(),iE=z(nt()),tn(),EV=ge.form(hse||(hse=H([`
  display: flex;
  flex-direction: row;
  align-items: stretch;
  vertical-align: middle;
  justify-content: stretch;
  height: 24px;
  width: 100%;
`]))),fse=ge.label(pse||(pse=H([`
  padding: 0 0.5em;
  background: transparent;
  /* background: #373748; */
  display: flex;
  align-items: center;
  justify-content: center;
  flex-grow: 1;
  color: #a7a7a7;
  border: 1px solid transparent;
  box-sizing: border-box;
  border-right-width: 0px;

  & + &:last-child {
    border-right-width: 1px;
  }

  `,`:hover > & {
    border-color: #1c2123;
    /* background-color: #373748; */
    /* color: `,`; */
  }

  &&:hover {
    background-color: #464654;
  }

  &&[data-checked='true'] {
    color: white;
    background: #3f3f4c;
  }
`])),EV,uz(.1,"white")),gse=ge.input(mse||(mse=H([`
  position: absolute;
  opacity: 0;
  pointer-events: none;
  width: 0;
  height: 0;
`]))),yse=WIe});function XIe({value:a,onChange:u,options:d,className:g,autoFocus:_}){let T=(0,b8.useCallback)(N=>{u(String(N.target.value))},[u]);return b8.default.createElement(xse,null,b8.default.createElement(wse,{className:g,value:a,onChange:T,autoFocus:_},Object.keys(d).map((N,R)=>b8.default.createElement("option",{key:"option-"+R,value:N},d[N]))),b8.default.createElement(_se,null,b8.default.createElement(MIe,null)))}var b8,vse,xse,bse,_se,Sse,wse,Tse,YIe=C(()=>{b8=z(nt()),tn(),QT(),xse=ge.div(vse||(vse=H([`
  width: 100%;
  position: relative;
`]))),_se=ge.div(bse||(bse=H([`
  position: absolute;
  right: 0px;
  top: 0;
  bottom: 0;
  width: 1.5em;
  font-size: 14px;
  display: flex;
  align-items: center;
  color: #6b7280;
  pointer-events: none;
`]))),wse=ge.select(Sse||(Sse=H([`
  appearance: none;
  background-color: transparent;
  box-sizing: border-box;
  border: 1px solid transparent;
  color: rgba(255, 255, 255, 0.85);
  padding: 1px 6px;
  font: inherit;
  outline: none;
  text-align: left;
  width: 100%;
  border-radius: 2px;
  /*
  looks like putting percentages in the height of a select box doesn't work in Firefox. Not sure why.
  So we're hard-coding the height to 26px, unlike all other inputs that use a relative height.
  */
  height: 26px /* calc(100% - 4px); */;

  @supports (-moz-appearance: none) {
    /* Ugly hack to remove the extra left padding that shows up only in Firefox */
    text-indent: -2px;
  }

  &:hover,
  &:focus {
    background-color: #10101042;
    border-color: #00000059;
  }
`]))),Tse=XIe});function KIe({propConfig:a,editingTools:u,value:d,autoFocus:g}){let _=(0,TR.useCallback)(T=>{u.permanentlySetValue(T)},[a,u]);return a.as==="menu"?TR.default.createElement(Tse,{value:d,onChange:_,options:a.valuesAndLabels,autoFocus:g}):TR.default.createElement(yse,{value:d,onChange:_,options:a.valuesAndLabels,autoFocus:g})}var TR,Ese,ZIe=C(()=>{TR=z(nt()),qIe(),YIe(),Ese=KIe}),Mse,sE,Cse,Ase,Nse,Pse,L4,ob=C(()=>{tn(),Mse=z(nt()),sE=z(nt()),SR(),ls(),wV(),Ase=ge.input.attrs({type:"text"})(Cse||(Cse=H([`
  background: transparent;
  border: 1px solid transparent;
  color: rgba(255, 255, 255, 0.9);
  padding: 1px 6px;
  font: inherit;
  outline: none;
  cursor: text;
  text-align: left;
  width: 100%;
  height: calc(100% - 4px);
  border-radius: 2px;
  border: 1px solid transparent;
  box-sizing: border-box;

  &:hover {
    background-color: #10101042;
    border-color: #00000059;
  }

  &:hover,
  &:focus {
    cursor: text;
    background-color: #10101042;
    border-color: #00000059;
  }

  &.invalid {
    border-color: red;
  }
`]))),Nse=a=>!0,Pse=a=>{var u,d;let[g]=Ni({mode:"noFocus"}),_=(u=a.isValid)!=null?u:Nse,T=(0,sE.useRef)(a);T.current=a;let N=(0,sE.useRef)(null);SV(N.current,()=>{N.current.blur()},g.current.mode==="editingViaKeyboard");let R=(0,sE.useMemo)(()=>{let V=ae=>{let ue=ae.target,{value:xe}=ue,Re=g.current;g.current=U(P({},Re),{currentEditedValueInString:xe}),_(xe)&&T.current.temporarilySetValue(xe)},Y=()=>{var ae,ue;g.current.mode==="editingViaKeyboard"&&(W(),g.current={mode:"noFocus"}),(ue=(ae=T.current).onBlur)==null||ue.call(ae)},W=()=>{let ae=g.current,ue=ae.currentEditedValueInString;_(ue)?ae.valueBeforeEditing===ue?T.current.discardTemporaryValue():T.current.permanentlySetValue(ue):T.current.discardTemporaryValue()},$=ae=>{ae.key==="Escape"?(T.current.discardTemporaryValue(),g.current={mode:"noFocus"},N.current.blur()):(ae.key==="Enter"||ae.key==="Tab")&&(W(),N.current.blur())},K=ae=>{g.current.mode==="noFocus"&&(N.current.focus(),ae.preventDefault()),ae.stopPropagation()},J=()=>{g.current.mode==="noFocus"?oe():g.current.mode},oe=()=>{let ae=T.current.value;g.current={mode:"editingViaKeyboard",currentEditedValueInString:String(ae),valueBeforeEditing:ae},setTimeout(()=>{N.current.focus()})};return{inputChange:V,onBlur:Y,onInputKeyDown:$,onClick:K,onFocus:J}},[]);(0,Mse.useEffect)(()=>()=>{R.onBlur()},[]);let O=g.current.mode!=="editingViaKeyboard"?a.value:g.current.currentEditedValueInString,B=[N];return a.inputRef&&B.push(a.inputRef),sE.default.createElement(Ase,{key:"input",type:"text",className:"".concat((d=a.className)!=null?d:""," ").concat(_(O)?"":"invalid"),onChange:R.inputChange,value:O,onBlur:R.onBlur,onKeyDown:R.onInputKeyDown,onClick:R.onClick,onFocus:R.onFocus,ref:_R(B),onMouseDown:V=>{V.stopPropagation()},onDoubleClick:V=>{V.preventDefault(),V.stopPropagation()},autoFocus:a.autoFocus})},L4=Pse});function QIe({editingTools:a,value:u,autoFocus:d}){return Rse.default.createElement(L4,{value:u,temporarilySetValue:a.temporarilySetValue,discardTemporaryValue:a.discardTemporaryValue,permanentlySetValue:a.permanentlySetValue,autoFocus:d})}var Rse,Ise,JIe=C(()=>{Rse=z(nt()),ob(),Ise=QIe});function eke(a){a=a.trim().toLowerCase();let u=a.match(AV);if(!u)return{r:0,g:0,b:0,a:1};let d=tke(u[1]);return{r:parseInt(d.substr(0,2),16)/255,g:parseInt(d.substr(2,2),16)/255,b:parseInt(d.substr(4,2),16)/255,a:parseInt(d.substr(6,2),16)/255}}function MV(a,{removeAlphaIfOpaque:u=!1}={}){let d=(a.a*255|256).toString(16).slice(1),g=(a.r*255|256).toString(16).slice(1)+(a.g*255|256).toString(16).slice(1)+(a.b*255|256).toString(16).slice(1)+(u&&d==="ff"?"":d);return"#".concat(g)}function CV(a){return U(P({},a),{toString(){return MV(this,{removeAlphaIfOpaque:!0})}})}function tke(a){switch(a.length){case 3:return"".concat(a.repeat(2),"ff");case 4:let u=a.substr(0,3),d=a[3];return"".concat(u.repeat(2)).concat(d.repeat(2));case 6:return"".concat(a,"ff")}return a}var AV,kse=C(()=>{AV=/^#*([0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/i});function ER(a){let u=(0,NV.useRef)(a),d=(0,NV.useRef)(g=>{u.current&&u.current(g)});return u.current=a,d.current}var NV,Dse=C(()=>{NV=z(nt())}),_8,MR=C(()=>{_8=(a,u=0,d=1)=>a>d?d:a<u?u:a}),oE,PV,Ose,RV,IV=C(()=>{oE=z(nt()),PV=(0,oE.createContext)(void 0),Ose=({children:a})=>{let[u,d]=(0,oE.useState)(!1);return oE.default.createElement(PV.Provider,{value:{editing:u,setEditing:d}},a)},RV=()=>(0,oE.useContext)(PV)}),F4,ab,Lse,CR,kV,DV,Fse,Bse,Use,zse,aE,AR=C(()=>{F4=z(nt()),Dse(),MR(),tn(),IV(),ab=a=>"touches"in a,Lse=(a,u)=>{for(let d=0;d<a.length;d++)if(a[d].identifier===u)return a[d];return a[0]},CR=a=>a&&a.ownerDocument.defaultView||self,kV=(a,u,d)=>{let g=a.getBoundingClientRect(),_=ab(u)?Lse(u.touches,d):u;return{left:_8((_.pageX-(g.left+CR(a).pageXOffset))/g.width),top:_8((_.pageY-(g.top+CR(a).pageYOffset))/g.height)}},DV=a=>{!ab(a)&&a.preventDefault()},Fse=(a,u)=>u&&!ab(a),Use=ge.div(Bse||(Bse=H([`
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  border-radius: inherit;
  outline: none;
  /* Don't trigger the default scrolling behavior when the event is originating from this element */
  touch-action: none;
`]))),zse=a=>{var u=a,{onMove:d,onKey:g}=u,_=j(u,["onMove","onKey"]);let T=(0,F4.useRef)(null),N=ER(d),R=ER(g),O=(0,F4.useRef)(null),B=(0,F4.useRef)(!1),{setEditing:V}=RV(),[Y,W,$]=(0,F4.useMemo)(()=>{let K=({nativeEvent:xe})=>{let Re=T.current;if(Re&&(DV(xe),!(Fse(xe,B.current)||!Re))){if(ab(xe)){B.current=!0;let Ae=xe.changedTouches||[];Ae.length&&(O.current=Ae[0].identifier)}Re.focus(),V(!0),N(kV(Re,xe,O.current)),ue(!0)}},J=xe=>{DV(xe),(ab(xe)?xe.touches.length>0:xe.buttons>0)&&T.current?N(kV(T.current,xe,O.current)):(V(!1),ue(!1))},oe=xe=>{V(!1),ue(!1)},ae=xe=>{let Re=xe.which||xe.keyCode;Re<37||Re>40||(xe.preventDefault(),R({left:Re===39?.05:Re===37?-.05:0,top:Re===40?.05:Re===38?-.05:0}))};function ue(xe){let Re=B.current,Ae=T.current,we=CR(Ae),ft=xe?we.addEventListener:we.removeEventListener;ft(Re?"touchmove":"mousemove",J),ft(Re?"touchend":"mouseup",oe)}return[K,ae,ue]},[R,N]);return(0,F4.useEffect)(()=>$,[$]),F4.default.createElement(Use,U(P({},_),{onTouchStart:Y,onMouseDown:Y,ref:T,onKeyDown:W,tabIndex:0,role:"slider"}))},aE=F4.default.memo(zse)}),OV,Vse,Gse,jse,Hse,$se,Wse,NR,LV=C(()=>{OV=z(nt()),tn(),AR(),Gse=ge(aE)(Vse||(Vse=H([""]))),Hse=ge.div(jse||(jse=H([`
  position: absolute;
  z-index: 1;
  box-sizing: border-box;
  width: 16px;
  height: 16px;
  transform: translate(-50%, -50%);
  background-color: #fff;
  border: 1px solid #ffffff00;
  border-radius: 2px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);

  `,`:focus & {
    transform: translate(-50%, -50%) scale(1.1);
  }
`])),Gse),Wse=ge.div($se||($se=H([`
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  border-radius: inherit;
`]))),NR=({className:a,color:u,left:d,top:g=.5})=>{let _={top:"".concat(g*100,"%"),left:"".concat(d*100,"%")};return OV.default.createElement(Hse,{style:_,className:a},OV.default.createElement(Wse,{style:{backgroundColor:u}}))}}),ic,PR=C(()=>{ic=(a,u=0,d=Math.pow(10,u))=>Math.round(d*a)/d}),FV,RR,IR,qse,Xse,kR=C(()=>{PR(),FV=({h:a,s:u,v:d,a:g})=>{let _=(200-u)*d/100;return{h:ic(a),s:ic(_>0&&_<200?u*d/100/(_<=100?_:200-_)*100:0),l:ic(_/2),a:ic(g,2)}},RR=a=>{let{h:u,s:d,l:g}=FV(a);return"hsl(".concat(u,", ").concat(d,"%, ").concat(g,"%)")},IR=a=>{let{h:u,s:d,l:g,a:_}=FV(a);return"hsla(".concat(u,", ").concat(d,"%, ").concat(g,"%, ").concat(_,")")},qse=({h:a,s:u,v:d,a:g})=>{a=a/360*6,u=u/100,d=d/100;let _=Math.floor(a),T=d*(1-u),N=d*(1-(a-_)*u),R=d*(1-(1-a+_)*u),O=_%6;return{r:ic([d,N,T,T,R,d][O]*255),g:ic([R,d,d,N,T,T][O]*255),b:ic([T,T,R,d,d,N][O]*255),a:ic(g,2)}},Xse=({r:a,g:u,b:d,a:g})=>{let _=Math.max(a,u,d),T=_-Math.min(a,u,d),N=T?_===a?(u-d)/T:_===u?2+(d-a)/T:4+(a-u)/T:0;return{h:ic(60*(N<0?N+6:N)),s:ic(_?T/_*100:0),v:ic(_/255*100),a:g}}}),lE,Yse,Kse,Zse,Qse,Jse,eoe,nke=C(()=>{lE=z(nt()),AR(),LV(),kR(),MR(),PR(),tn(),Kse=ge.div(Yse||(Yse=H([`
  position: relative;
  height: 16px;
  border-radius: 2px;

  background: linear-gradient(
    to right,
    #f00 0%,
    #ff0 17%,
    #0f0 33%,
    #0ff 50%,
    #00f 67%,
    #f0f 83%,
    #f00 100%
  );
`]))),Qse=ge(NR)(Zse||(Zse=H([`
  z-index: 2;
`]))),Jse=({className:a,hue:u,onChange:d})=>lE.default.createElement(Kse,{className:a},lE.default.createElement(aE,{onMove:g=>{d({h:360*g.left})},onKey:g=>{d({h:_8(u+g.left*360,0,360)})},"aria-label":"Hue","aria-valuetext":ic(u)},lE.default.createElement(Qse,{left:u/360,color:RR({h:u,s:100,v:100,a:1})}))),eoe=lE.default.memo(Jse)}),cE,toe,noe,roe,ioe,soe,ooe,rke=C(()=>{cE=z(nt()),AR(),LV(),kR(),MR(),PR(),tn(),noe=ge.div(toe||(toe=H([`
  position: relative;
  flex-grow: 1;
  border-color: transparent; /* Fixes https://github.com/omgovich/react-colorful/issues/139 */
  border-bottom: 12px solid #000;
  border-radius: 2px;
  background-image: linear-gradient(to top, #000, rgba(0, 0, 0, 0)),
    linear-gradient(to right, #fff, rgba(255, 255, 255, 0));

  // Improve elements rendering on light backgrounds
  box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.05);
`]))),ioe=ge(NR)(roe||(roe=H([`
  z-index: 3;
`]))),soe=({hsva:a,onChange:u})=>{let d=T=>{u({s:T.left*100,v:100-T.top*100})},g=T=>{u({s:_8(a.s+T.left*100,0,100),v:_8(a.v-T.top*100,0,100)})},_={backgroundColor:RR({h:a.h,s:100,v:100,a:1})};return cE.default.createElement(noe,{style:_},cE.default.createElement(aE,{onMove:d,onKey:g,"aria-label":"Color","aria-valuetext":"Saturation ".concat(ic(a.s),"%, Brightness ").concat(ic(a.v),"%")},cE.default.createElement(ioe,{top:1-a.v/100,left:a.s/100,color:RR(a)})))},ooe=cE.default.memo(soe)}),uE,aoe,loe,coe,uoe,doe,hoe,poe,ike=C(()=>{uE=z(nt()),AR(),LV(),kR(),MR(),PR(),tn(),loe=ge.div(aoe||(aoe=H([`
  position: relative;
  height: 16px;
  border-radius: 2px;
  // Checkerboard
  background-color: #fff;
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><rect x="8" width="8" height="8"/><rect y="8" width="8" height="8"/></svg>');
`]))),uoe=ge.div.attrs(({colorFrom:a,colorTo:u})=>({style:{backgroundImage:"linear-gradient(90deg, ".concat(a,", ").concat(u,")")}}))(coe||(coe=H([`
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  border-radius: inherit;

  // Improve rendering on light backgrounds
  box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.05);
`]))),hoe=ge(NR)(doe||(doe=H([`
  // Checkerboard
  background-color: #fff;
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><rect x="8" width="8" height="8"/><rect y="8" width="8" height="8"/></svg>');
`]))),poe=({className:a,hsva:u,onChange:d})=>{let g=R=>{d({a:R.left})},_=R=>{d({a:_8(u.a+R.left)})},T=IR(Object.assign({},u,{a:0})),N=IR(Object.assign({},u,{a:1}));return uE.default.createElement(loe,{className:a},uE.default.createElement(uoe,{colorFrom:T,colorTo:N}),uE.default.createElement(aE,{onMove:g,onKey:_,"aria-label":"Alpha","aria-valuetext":"".concat(ic(u.a*100),"%")},uE.default.createElement(hoe,{left:u.a,color:IR(u)})))}}),DR,foe=C(()=>{DR=(a,u)=>{if(a===u)return!0;for(let d in a)if(a[d]!==u[d])return!1;return!0}});function ske(a,u,d,g){let{editing:_}=RV(),[T,N]=(0,J2.useState)(u),R=ER(d),O=ER(g),B=_?T:u,[V,Y]=(0,J2.useState)(()=>a.toHsva(B)),W=(0,J2.useRef)({color:B,hsva:V}),$=(0,J2.useRef)({color:B,hsva:V});(0,J2.useEffect)(()=>{_&&N(W.current.color)},[_]),(0,J2.useEffect)(()=>{let J=a.fromHsva(V);_?!DR(V,W.current.hsva)&&!a.equal(J,W.current.color)&&(W.current={hsva:V,color:J},N(J),R(J)):!DR(V,$.current.hsva)&&!a.equal(J,$.current.color)&&($.current={hsva:V,color:J},W.current={hsva:V,color:J},O(J))},[_,V,a,R,O]),(0,J2.useEffect)(()=>{if(!_&&!a.equal(B,$.current.color)){let J=a.toHsva(B);$.current={hsva:J,color:B},Y(J)}},[_,B,a]);let K=(0,J2.useCallback)(J=>{Y(oe=>Object.assign({},oe,J))},[]);return[V,K]}var J2,oke=C(()=>{J2=z(nt()),foe(),Dse(),IV()}),lb,moe,goe,yoe,ake=C(()=>{lb=z(nt()),nke(),rke(),ike(),oke(),tn(),goe=ge.div(moe||(moe=H([`
  position: relative;
  display: flex;
  gap: 4px;
  flex-direction: column;
  width: 200px;
  height: 200px;
  user-select: none;
  cursor: default;
`]))),yoe=a=>{var u=a,{className:d,colorModel:g,color:_=g.defaultColor,temporarilySetValue:T,permanentlySetValue:N,discardTemporaryValue:R}=u,O=j(u,["className","colorModel","color","temporarilySetValue","permanentlySetValue","discardTemporaryValue"]);let[B,V]=ske(g,_,T,N);return(0,lb.useEffect)(()=>()=>{R()},[]),lb.default.createElement(goe,P({},O),lb.default.createElement(ooe,{hsva:B,onChange:V}),lb.default.createElement(eoe,{hue:B.h,onChange:V}),lb.default.createElement(poe,{hsva:B,onChange:V}))}}),BV,voe,xoe,boe,_oe,lke=C(()=>{BV=z(nt()),ake(),foe(),kR(),IV(),voe=a=>({r:a.r/255,g:a.g/255,b:a.b/255,a:a.a}),xoe=a=>({r:a.r*255,g:a.g*255,b:a.b*255,a:a.a}),boe={defaultColor:{r:0,g:0,b:0,a:1},toHsva:a=>Xse(xoe(a)),fromHsva:a=>voe(qse(a)),equal:DR},_oe=a=>BV.default.createElement(Ose,null,BV.default.createElement(yoe,U(P({},a),{permanentlySetValue:u=>{a.permanentlySetValue(u)},colorModel:boe})))}),cke=C(()=>{lke()}),Soe,woe,UV,Toe=C(()=>{Soe=z(nt()),woe=(0,Soe.createContext)({}),UV=woe});function uke(a,u,d){let g=_=>{let T=a.getBoundingClientRect();(_.clientX<T.left-u||_.clientX>T.left+T.width+u||_.clientY<T.top-u||_.clientY>T.top+T.height+u)&&d(_)};return window.addEventListener("mousemove",g),()=>{window.removeEventListener("mousemove",g)}}var dke=C(()=>{}),Eoe,OR,zV,Moe,VV,Coe=C(()=>{Eoe=z(nt()),OR=z(nt()),$z(),Tie(),Toe(),ls(),wV(),dke(),W7(),b0(),zV=8,Moe=a=>{var u,d;let g=a.children(),[_,T]=Ni(null),N=g.props.style?P({},g.props.style):{};N.position="absolute";let R=yV(T),O=yV(a.target),B=fR(),[V,Y]=(0,OR.useState)({});return(0,OR.useLayoutEffect)(()=>{var W,$,K;if(!R||!T||!O)return;let J=(W=a.verticalGap)!=null?W:8,oe={},ae=($=a.verticalPlacement)!=null?$:"bottom",ue=0,xe=0;ae==="bottom"?O.bottom+R.height+J<B.height?(ae="bottom",ue=O.bottom+J,oe.top="0px"):O.top>R.height+J?(ae="top",ue=O.top-(R.height+J),oe.bottom="0px",oe.transform="rotateZ(180deg)"):ae="overlay":ae==="top"&&(O.top>R.height+J?(ae="top",ue=O.top-(R.height+J),oe.bottom="0px",oe.transform="rotateZ(180deg)"):O.bottom+R.height+J<B.height?(ae="bottom",ue=O.bottom+J,oe.top="0px"):ae="overlay");let Re=0;if(ae!=="overlay"){let Ge=O.left+O.width/2;Ge<R.width/2?(xe=J,Re=Math.max(Ge-J,zV)):Ge+R.width/2>B.width?(xe=B.width-(J+R.width),Re=Math.min(Ge-xe,R.width-zV)):(xe=Ge-R.width/2,Re=R.width/2),oe.left=Re+"px"}let{minX:Ae=-1/0,maxX:we=1/0,minY:ft=-1/0,maxY:Le=1/0}=(K=a.constraints)!=null?K:{},Se={left:os(xe,Ae,we-R.width),top:os(ue,ft,Le+R.height)};if(T.style.left=Se.left+"px",T.style.top=Se.top+"px",Y(oe),a.onPointerOutside)return uke(T,a.onPointerOutside.threshold,a.onPointerOutside.callback)},[R,T,a.target,O,B,a.onPointerOutside]),SV([T,(u=a.target)!=null?u:null],(d=a.onClickOutside)!=null?d:xf),Eoe.default.createElement(UV.Provider,{value:V},(0,OR.cloneElement)(g,{ref:_,style:N}))},VV=Moe});function qu(a,u){let{isPointerBeingCaptured:d}=are("usePopover"),[g,_]=Ni({isOpen:!1}),T=(0,sc.useRef)(a),N=(0,sc.useCallback)(W=>{g.current={isOpen:!1}},[]),R=(0,sc.useCallback)((W,$)=>{var K;let J=typeof T.current=="function"?T.current():T.current;function oe(){B.childHasFocusRef.current||J.closeOnClickOutside!==!1&&N("clicked outside popover")}g.current={isOpen:!0,clickPoint:{clientX:W.clientX,clientY:W.clientY},target:$,opts:J,onClickOutside:oe,onPointerOutside:J.closeWhenPointerIsDistant===!1?void 0:{threshold:(K=J.pointerDistanceThreshold)!=null?K:100,callback:()=>{B.childHasFocusRef.current||d()||N("pointer outside")}}}},[]),O=(0,sc.useCallback)((...W)=>{g.current.isOpen?N("toggled"):R(...W)},[]),B=hke({state:_}),[,V]=(0,sc.useContext)(nG);(0,sc.useEffect)(()=>{let W;return _.isOpen&&(W=V()),()=>W==null?void 0:W()},[_.isOpen]);let Y=(0,sc.useContext)(H7);return{node:_.isOpen?(0,Aoe.createPortal)(sc.default.createElement(GV.Provider,{value:B.childPopoverLock},sc.default.createElement(VV,{children:u,target:_.target,onClickOutside:_.onClickOutside,onPointerOutside:_.onPointerOutside,constraints:_.opts.constraints,verticalGap:_.opts.verticalGap})),Y):sc.default.createElement(sc.default.Fragment,null),open:R,close:N,toggle:O,isOpen:_.isOpen}}function hke(a){let u=(0,sc.useContext)(GV);(0,sc.useEffect)(()=>{if(a.state.isOpen){let g=u.takeFocus();return()=>{g.releaseFocus()}}},[a.state.isOpen]);let d=(0,sc.useRef)(!1);return{childHasFocusRef:d,childPopoverLock:{takeFocus(){return d.current=!0,{releaseFocus(){d.current=!1}}}}}}var sc,Aoe,GV,Ef=C(()=>{Qz(),ls(),sc=z(nt()),Aoe=z(H2()),y8(),Coe(),dle(),GV=sc.default.createContext({takeFocus(){return{releaseFocus(){}}}})}),e3,Noe,Poe,Roe,Ioe,koe,Doe,Ooe,Loe,Foe,Boe,Uoe,zoe,pke=C(()=>{e3=z(nt()),tn(),Toe(),Poe=ge.div(Noe||(Noe=H([`
  position: absolute;
  width: 0;
  height: 0;
  color: var(--popover-arrow-color);
  pointer-events: none;
`]))),Ioe=ge.div(Roe||(Roe=H([`
  width: 12px;
  height: 8px;
  position: absolute;
  left: -7px;
  top: -8px;
  text-align: center;
  line-height: 0;
`]))),Doe=ge.path(koe||(koe=H([`
  fill: var(--popover-bg);
`]))),Loe=ge.path(Ooe||(Ooe=H([`
  fill: var(--popover-inner-stroke);
`]))),Boe=ge.path(Foe||(Foe=H([`
  fill: var(--popover-outer-stroke);
`]))),Uoe=(0,e3.forwardRef)(({className:a},u)=>{let d=(0,e3.useContext)(UV);return e3.default.createElement(Poe,{className:a,ref:u,style:P({},d)},e3.default.createElement(Ioe,null,e3.default.createElement("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e3.default.createElement(Boe,{d:"M6 0L0 6H12L6 0Z"}),e3.default.createElement(Loe,{d:"M6 1.5L0 7.5H12L6 1.5Z"}),e3.default.createElement(Doe,{d:"M6 3L0 9H12L6 3Z"}))))}),zoe=Uoe}),LR,jV,Voe,Goe,joe,Xu,Mf=C(()=>{ms(),vf(),LR=z(nt()),tn(),pke(),jV=w1(.05,"#2a2a31"),Goe=ge.div(Voe||(Voe=H([`
  position: absolute;
  --popover-bg: `,`;
  --popover-inner-stroke: #505159;
  --popover-outer-stroke: #111;

  background: var(--popover-bg);

  color: white;
  padding: 0;
  margin: 0;
  cursor: default;
  `,`;
  border-radius: 3px;
  z-index: 10000;
  border: 1px solid var(--popover-inner-stroke);
  box-shadow: 0 0 0 1px var(--popover-outer-stroke), 0 6px 8px -4px black;
  backdrop-filter: blur(8px);

  & a {
    color: inherit;
  }
`])),jV,Zi),joe=LR.default.forwardRef(({children:a,className:u,showPopoverEdgeTriangle:d=!0},g)=>LR.default.createElement(Goe,{className:u,ref:g},d?LR.default.createElement(zoe,null):void 0,a)),Xu=joe});function fke({editingTools:a,value:u,autoFocus:d}){let g=(0,C1.useRef)(null),_=(0,C1.useCallback)(N=>{let R=CV(eke(N));a.permanentlySetValue(R)},[a]),T=qu({debugName:"RgbaPropEditor"},()=>C1.default.createElement(Zoe,null,C1.default.createElement(_oe,{color:{r:u.r,g:u.g,b:u.b,a:u.a},temporarilySetValue:N=>{let R=CV(N);a.temporarilySetValue(R)},permanentlySetValue:N=>{let R=CV(N);a.permanentlySetValue(R)},discardTemporaryValue:a.discardTemporaryValue})));return C1.default.createElement(C1.default.Fragment,null,C1.default.createElement($oe,null,C1.default.createElement(qoe,{rgbaColor:u,ref:g,onClick:N=>{T.toggle(N,g.current)}}),C1.default.createElement(Yoe,{value:MV(u,{removeAlphaIfOpaque:!0}),temporarilySetValue:HV,discardTemporaryValue:HV,permanentlySetValue:_,isValid:N=>!!N.match(AV),autoFocus:d})),T.node)}var C1,Hoe,$oe,Woe,qoe,Xoe,Yoe,HV,Koe,Zoe,Qoe,mke=C(()=>{kse(),kse(),C1=z(nt()),cke(),tn(),Ef(),ob(),Mf(),$oe=ge.div(Hoe||(Hoe=H([`
  display: flex;
  align-items: center;
  height: 100%;
  gap: 4px;
`]))),qoe=ge.div.attrs(a=>({style:{background:MV(a.rgbaColor)}}))(Woe||(Woe=H([`
  height: 18px;
  aspect-ratio: 1;
  border-radius: 99999px;
`]))),Yoe=ge(L4)(Xoe||(Xoe=H([`
  flex: 1;
`]))),HV=()=>{},Zoe=ge.div(Koe||(Koe=H([`
  position: absolute;
  background-color: `,`;
  color: white;
  margin: 0;
  cursor: default;
  border-radius: 3px;
  z-index: 10000;
  backdrop-filter: blur(8px);

  padding: 4px;
  pointer-events: all;

  border: none;
  box-shadow: none;
`])),jV),Qoe=fke});function gke({propConfig:a,editingTools:u,value:d,autoFocus:g}){let[_,T]=Cf.default.useState();(0,Cf.useEffect)(()=>{T(d?u.getAssetUrl(d):void 0)},[d]);let N=(0,Cf.useCallback)(O=>Me(this,null,function*(){let B=O.target.files[0];u.permanentlySetValue({type:"image",id:void 0});let V=yield u.createAsset(B);V?u.permanentlySetValue({type:"image",id:V}):u.permanentlySetValue(d),O.target.value=null}),[u,d]),R=!(d!=null&&d.id);return Cf.default.createElement($V,{empty:R},Cf.default.createElement(sae,{empty:R,title:R?"Upload image":'"'.concat(d.id,'" (Click to upload new image)')},Cf.default.createElement(aae,{type:"file",onChange:N,accept:"image/*,.hdr",autoFocus:g}),_?Cf.default.createElement(cae,{src:_}):Cf.default.createElement(tae,null)),!R&&Cf.default.createElement(dae,{title:"Delete image",onClick:()=>{u.permanentlySetValue({type:"image",id:void 0})}},Cf.default.createElement(Bz,null)))}var Cf,Joe,$V,eae,tae,nae,rae,iae,sae,oae,aae,lae,cae,uae,dae,hae,yke=C(()=>{lR(),Cf=z(nt()),tn(),$V=ge.div(Joe||(Joe=H([`
  display: flex;
  align-items: center;
  height: 100%;
  gap: 4px;
`]))),tae=ge.div(eae||(eae=H([`
  position: absolute;
  inset: -5px;
  // rotate 45deg
  transform: rotate(45deg);
  --checker-color: #ededed36;
  &:hover {
    --checker-color: #ededed77;
  }
  // checkerboard background with 4px squares
  background-image: linear-gradient(
      45deg,
      var(--checker-color) 25%,
      transparent 25%
    ),
    linear-gradient(-45deg, var(--checker-color) 25%, transparent 25%),
    linear-gradient(45deg, transparent 75%, var(--checker-color) 75%),
    linear-gradient(-45deg, transparent 75%, var(--checker-color) 75%);
  background-size: 5px 5px;
`]))),sae=ge.label(iae||(iae=H([`
  position: relative;
  cursor: default;
  box-sizing: border-box;

  height: 18px;
  aspect-ratio: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 16px;

  overflow: hidden;
  color: #ccc;
  &:hover {
    color: white;
  }

  border-radius: 99999px;
  border: 1px solid hwb(220deg 40% 52%);
  &:hover {
    border-color: hwb(220deg 45% 52%);
  }

  `,`
`])),a=>a.empty?Yd(nae||(nae=H([""]))):Yd(rae||(rae=H([""])))),aae=ge.input.attrs({type:"file"})(oae||(oae=H([`
  display: none;
`]))),cae=ge.img(lae||(lae=H([`
  position: absolute;
  inset: 0;
  height: 100%;
  aspect-ratio: 1;

  object-fit: cover;
`]))),dae=ge.button(uae||(uae=H([`
  display: flex;
  align-items: center;
  justify-content: center;
  outline: none;
  background: transparent;
  color: #a8a8a9;

  border: none;
  height: 100%;
  aspect-ratio: 1/1;

  opacity: 0;

  `,`:hover & {
    opacity: 0.8;
  }

  &:hover {
    opacity: 1;
    color: white;
  }
`])),$V),hae=gke});function vke({propConfig:a,editingTools:u,value:d,autoFocus:g}){let[_,T]=Af.default.useState();(0,Af.useEffect)(()=>{T(d?u.getAssetUrl(d):void 0)},[d]);let N=(0,Af.useCallback)(O=>Me(this,null,function*(){let B=O.target.files[0];u.permanentlySetValue({type:"file",id:void 0});let V=yield u.createAsset(B);V?u.permanentlySetValue({type:"file",id:V}):u.permanentlySetValue(d),O.target.value=null}),[u,d]),R=!(d!=null&&d.id);return Af.default.createElement(WV,{empty:R},Af.default.createElement(xae,{empty:R,title:R?"Upload file":'"'.concat(d.id,'" (Click to upload new file)')},Af.default.createElement(_ae,{type:"file",onChange:N,autoFocus:g}),_?Af.default.createElement(Lz,null):Af.default.createElement(mae,null)),!R&&Af.default.createElement(wae,{title:"Delete file",onClick:()=>{u.permanentlySetValue({type:"file",id:void 0})}},Af.default.createElement(Bz,null)))}var Af,pae,WV,fae,mae,gae,yae,vae,xae,bae,_ae,Sae,wae,Tae,xke=C(()=>{lR(),Af=z(nt()),tn(),WV=ge.div(pae||(pae=H([`
  display: flex;
  align-items: center;
  height: 100%;
  gap: 4px;
`]))),mae=ge.div(fae||(fae=H([`
  position: absolute;
  inset: -5px;
  // rotate 45deg
  transform: rotate(45deg);
  --checker-color: #ededed36;
  &:hover {
    --checker-color: #ededed77;
  }
  // checkerboard background with 4px squares
  background-image: linear-gradient(
      45deg,
      var(--checker-color) 25%,
      transparent 25%
    ),
    linear-gradient(-45deg, var(--checker-color) 25%, transparent 25%),
    linear-gradient(45deg, transparent 75%, var(--checker-color) 75%),
    linear-gradient(-45deg, transparent 75%, var(--checker-color) 75%);
  background-size: 5px 5px;
`]))),xae=ge.label(vae||(vae=H([`
  position: relative;
  cursor: default;
  box-sizing: border-box;

  height: 18px;
  aspect-ratio: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 16px;

  overflow: hidden;
  color: #ccc;
  &:hover {
    color: white;
  }

  border-radius: 99999px;
  border: 1px solid hwb(220deg 40% 52%);
  &:hover {
    border-color: hwb(220deg 45% 52%);
  }

  `,`
`])),a=>a.empty?Yd(gae||(gae=H([""]))):Yd(yae||(yae=H([""])))),_ae=ge.input.attrs({type:"file"})(bae||(bae=H([`
  display: none;
`]))),wae=ge.button(Sae||(Sae=H([`
  display: flex;
  align-items: center;
  justify-content: center;
  outline: none;
  background: transparent;
  color: #a8a8a9;

  border: none;
  height: 100%;
  aspect-ratio: 1/1;

  opacity: 0;

  `,`:hover & {
    opacity: 0.8;
  }

  &:hover {
    opacity: 1;
    color: white;
  }
`])),WV),Tae=vke}),qV,Eae=C(()=>{GIe(),$Ie(),ZIe(),JIe(),mke(),yke(),xke(),qV={number:dse,string:Ise,boolean:Qie,stringLiteral:Ese,rgba:Qoe,image:hae,file:Tae}});function FR(a){let u=new WeakMap;return d=>(u.has(d)||u.set(d,a(d)),u.get(d))}var XV=C(()=>{});function A1(a){return a.type==="compound"||a.type==="enum"}function cb(a,u){if(!a)return;let[d,...g]=u;if(d===void 0)return a;if(!A1(a))return;let _=a.type==="enum"?a.cases[d]:a.props[d];return cb(_,g)}function BR(a,u){let d=u.deserializeAndSanitize(a);return d===void 0?u.default:d}function bke(a){return!A1(a)}function*ub(a,u){if(a.type==="compound")for(let d in a.props)yield*Ue(ub(a.props[d],[...u,d]));else{if(a.type==="enum")throw new Error("Not implemented yet");return yield{path:u,conf:a}}}var YV,B4=C(()=>{XV(),YV=FR(a=>{if(a.type==="enum")throw new Error("Not implemented yet for enums");for(let u in a.props){let d=a.props[u];if(A1(d)){if(YV(d))return!0}else return!0}return!1})});function U4(a,u){return u.length===0?a:Uu(a,u)}var UR=C(()=>{Z0()});function Mae(a,u){return a==null?null:a instanceof Element&&a.matches(u)?a:Mae(a.parentElement,u)}var _ke=C(()=>{});function Ske(a){let u=new VR.Atom(void 0),d=new VR.Atom({}),g=new VR.Atom({}),_=0;return{addRelatedFlags(T,N){let R=String(++_),O=N.map(B=>{let V={flag:B.flag},Y=[B.affects,T,R];return g.setByPointer(W=>ib(W,Y),V),Y});return()=>{for(let B of O)g.setByPointer(V=>ib(V,B),void 0)}},usePresenceFlag(T){},setUserHover(T){let N=u.get();N!==T&&(N&&d.setByPointer(R=>R[N],!1),u.set(T),T&&d.setByPointer(R=>R[T],!0))}}}function db(a){let u=zR.default.useContext(ZV),d=u.usePresenceFlag(a);return{attrs:{[GR]:a},flag:d,useRelations(g,_){(0,KV.useEffect)(()=>a&&u.addRelatedFlags(a,g()),[a,..._])}}}function wke(a){let u=zR.default.useContext(ZV),d=Q7("PresenceListeners");(0,KV.useEffect)(()=>{let g;if(!a)return;let _=T=>{if(T.target instanceof Node){let N=Mae(T.target,"[".concat(GR,"]"));if(N){let R=N.getAttribute(GR);g!==R&&(g=R,u.setUserHover(R||void 0),d._debug("Updated current hover",{itemKey:R}));return}g!=null&&(g=null,u.setUserHover(void 0),d._debug("Cleared current hover"))}};return a.addEventListener("mouseover",_),()=>{a.removeEventListener("mouseover",_),g!=null&&(g=null,d._debug("Cleared current hover as part of cleanup"))}},[a,u])}var zR,KV,Cae,VR,Aae,ZV,GR,dE=C(()=>{zR=z(nt()),KV=z(nt()),x8(),Cae=un(),VR=un(),Ar(),_ke(),JT(),Aae=(0,Cae.prism)(()=>{}),Aae.keepHot(),ZV=zR.default.createContext(Ske()),GR="data-pi-key"}),_0,Nae,hE,Pae,QV,z4,Rae,JV,Iae,kae,Dae,jR,Oae,Lae,Fae,Bae,Uae,zae,pE,Vae,eG,HR=C(()=>{ms(),vf(),_0=z(nt()),tn(),dE(),hE=ge.div(Nae||(Nae=H([`
  display: flex;
  justify-content: center;
  align-items: center;
  width: 16px;
  margin: 0 0px 0 2px;
  position: relative;
  z-index: 0;
  opacity: 0.7;

  &:after {
    position: absolute;
    left: -14px;
    right: -14px;
    top: -2px;
    bottom: -2px;
    content: ' ';
    display: none;
    z-index: -1;
    background: `,`;
  }

  &:hover {
    opacity: 1;
    &:after {
      display: block;
    }
  }
`])),w1(.2,"black")),QV=ge.div(Pae||(Pae=H([`
  background: none;
  position: relative;
  border: 0;
  transition: transform 0.1s ease-out;
  z-index: 0;
  outline: none;
  cursor: pointer;

  &:after {
    display: none;
    `,`:hover & {
      display: block;
    }
    position: absolute;
    left: -4px;
    right: -4px;
    top: -4px;
    bottom: -4px;
    content: ' ';
    z-index: -1;
  }
`])),hE),z4={offColor:"#555",onColor:"#e0c917"},JV=ge(QV)(Rae||(Rae=H([`
  &:hover {
    color: #e0c917;
  }

  color: `,`;
`])),a=>a.presence===2?"white":a.isOn?z4.onColor:z4.offColor),kae=Yd(Iae||(Iae=H([`
  pointer-events: none !important;
`]))),jR=ge(QV)(Dae||(Dae=H([`
  color: `,`;

  `,`;
`])),a=>a.flag===2?"white":a.available?z4.onColor:z4.offColor,a=>a.available?Zi:kae),Lae=ge(jR)(Oae||(Oae=H([`
  transform: translateX(2px);
  `,`:hover & {
    transform: translateX(-7px);
  }
`])),hE),Bae=ge(jR)(Fae||(Fae=H([`
  transform: translateX(-2px);
  `,`:hover & {
    transform: translateX(7px);
  }
`])),hE),(a=>{let u=ge.g(Uae||(Uae=H([`
    stroke-width: 1;
    `,`:hover & path {
      stroke-width: 3;
    }
  `])),jR);a.Prev=()=>_0.default.createElement("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},_0.default.createElement(u,{transform:"translate(6 3)"},_0.default.createElement("path",{d:"M4 1L1 4L4 7",stroke:"currentColor"}))),a.Next=()=>_0.default.createElement("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},_0.default.createElement(u,{transform:"translate(1 3)"},_0.default.createElement("path",{d:"M1 1L4 4L1 7",stroke:"currentColor"})));let d=ge.g(zae||(zae=H([`
    stroke-width: 0;
    `,`:hover & path {
      stroke: currentColor;
      stroke-width: 2;
    }
  `])),JV);a.Cur=()=>_0.default.createElement("svg",{width:"8",height:"12",viewBox:"0 0 8 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},_0.default.createElement(d,{transform:"translate(1 4)"},_0.default.createElement("path",{d:"M3 0L6 3L3 6L0 3L3 0Z",fill:"currentColor"})))})(pE||(pE={})),Vae=a=>{var u,d,g,_,T;let N=db((u=a.prev)==null?void 0:u.itemKey),R=db(((d=a.cur)==null?void 0:d.type)==="on"?a.cur.itemKey:void 0),O=db((g=a.next)==null?void 0:g.itemKey);return _0.default.createElement(hE,null,_0.default.createElement(Lae,P({available:!!a.prev,onClick:(_=a.prev)==null?void 0:_.jump,flag:N.flag},N.attrs),_0.default.createElement(pE.Prev,null)),_0.default.createElement(JV,P({isOn:a.cur.type==="on",onClick:a.cur.toggle,presence:R.flag},R.attrs),_0.default.createElement(pE.Cur,null)),_0.default.createElement(Bae,P({available:!!a.next,onClick:(T=a.next)==null?void 0:T.jump,flag:O.flag},O.attrs),_0.default.createElement(pE.Next,null)))},eG=Vae}),$R,fE,Gae,jae,Hae,$ae,Wae,qae,Xae,mE,Yae=C(()=>{vf(),$R=z(nt()),tn(),Pe(),HR(),B4(),fE={defaultState:{color:w1(.95,"#C4C4C4"),hoverColor:w1(.15,z4.onColor)},withStaticOverride:{color:w1(.85,"#C4C4C4"),hoverColor:w1(.15,z4.onColor)}},jae=ge.div(Gae||(Gae=H([`
  width: 16px;
  margin: 0 0px 0 2px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;

  color: `,`;

  &:hover {
    color: `,`;
  }
`])),a=>a.hasStaticOverride?fE.withStaticOverride.color:fE.defaultState.color,a=>a.hasStaticOverride?fE.withStaticOverride.hoverColor:fE.defaultState.hoverColor),$ae=ge.div(Hae||(Hae=H([`
  width: 5px;
  height: 5px;
  border-radius: 1px;
  transform: rotate(45deg);
  /* border: 1px solid currentColor; */
  background-color: currentColor;
`]))),qae=ge.div(Wae||(Wae=H([`
  width: 5px;
  height: 5px;
  background-color: currentColor;
  border-radius: 1px;
  transform: rotate(45deg);
`]))),Xae=a=>{let{hasStaticOverride:u,obj:d,propConfig:g,pathToProp:_}=a;return $R.default.createElement(jae,{hasStaticOverride:u,onClick:()=>{ce().transaction(({stateEditors:T})=>{for(let{path:N,conf:R}of ub(g,_)){if(A1(R))continue;let O=U(P({},d.address),{pathToProp:N});T.coreByProject.historic.sheetsById.sequence.setPrimitivePropAsSequenced(O,g)}})},title:"Sequence this prop"},u?$R.default.createElement(qae,{title:"The default value is overridden"}):$R.default.createElement($ae,{title:"This is the default value for this prop"}))},mE=Xae});function Kae(a,u,d){if(!u||u.data.keyframes.length===0)return Zae;let g=tG.get(u.data);if(g&&g[0]===d)return g[1];function _(N){if(!u)return;let R=u.data.keyframes[N];return R&&{kf:R,track:u,itemKey:jl.forTrackKeyframe(a,u.id,R.id)}}let T=(()=>{let N=u.data.keyframes.findIndex(O=>O.position>=d);if(N===-1)return{prev:_(u.data.keyframes.length-1)};let R=_(N);return R.kf.position===d?{prev:_(N-1),cur:R,next:_(N+1)}:{next:R,prev:_(N-1)}})();return tG.set(u.data,[d,T]),T}var tG,Zae,Qae=C(()=>{wf(),tG=new WeakMap,Zae={}}),Jae,Tke=C(()=>{Jae={}});function ele(a,u,d){let g=(0,tp.getPointerParts)(a).path;return di(()=>{if(!YV(d))return{type:"AllStatic",beingScrubbed:!1,contextMenuItems:[],controlIndicators:S8.default.createElement(mE,{hasStaticOverride:!1,obj:u,pathToProp:g,propConfig:d})};let _=!!(0,tp.val)(Uu(ce().atomP.ephemeral.projects.stateByProjectId[u.address.projectId].stateBySheetId[u.address.sheetId].stateByObjectKey[u.address.objectKey].valuesBeingScrubbed,(0,tp.getPointerParts)(a).path)),T=[],N={beingScrubbed:_,contextMenuItems:T,controlIndicators:S8.default.createElement(S8.default.Fragment,null)},R=(0,tp.val)(u.template.getMapOfValidSequenceTracks_forStudio()),O=U4(R,g),B=O!==void 0&&Object.keys(O).length!==0,V=[],Y=(0,tp.val)(u.template.getStaticButNotSequencedOverrides()),W=U4(Y??Jae,g)!==void 0;if(B)for(let $ of ub(d,[])){if(A1($.conf))continue;let K=U4(O,$.path);typeof K!="string"?W=!0:V.push(K)}if((W||B)&&T.push({label:"Reset all to default",callback:()=>{ce().transaction(({unset:$})=>{$(a)})}}),B&&T.push({label:"Make all static",callback:()=>{ce().transaction(({stateEditors:$})=>{for(let{path:K,conf:J}of ub(d,[])){if(A1(J))continue;let oe=U(P({},u.address),{pathToProp:[...g,...K]}),ae=ib(a,K);$.coreByProject.historic.sheetsById.sequence.setPrimitivePropAsStatic(U(P({},oe),{value:u.getValueByPointer(ae)}))}})}}),(!B||B&&W)&&T.push({label:"Sequence all",callback:()=>{ce().transaction(({stateEditors:$})=>{for(let{path:K,conf:J}of ub(d,g)){if(A1(J))continue;let oe=U(P({},u.address),{pathToProp:K});$.coreByProject.historic.sheetsById.sequence.setPrimitivePropAsSequenced(oe,d)}})}}),B){let $=tp.prism.memo("controlIndicators",()=>S8.default.createElement(Eke,{pointerToProp:a,obj:u,possibleSequenceTrackIds:O,listOfDescendantTrackIds:V}),[O,V]);return U(P({},N),{type:"HasSequences",controlIndicators:$})}else return U(P({},N),{type:"AllStatic",controlIndicators:S8.default.createElement(mE,{hasStaticOverride:W,obj:u,pathToProp:g,propConfig:d})})},[])}function Eke({pointerToProp:a,obj:u,possibleSequenceTrackIds:d,listOfDescendantTrackIds:g}){return di(()=>{let _=(0,tp.getPointerParts)(a).path,T=(0,tp.val)(u.sheet.getSequence().positionPrism),N=g.map($=>({trackId:$,track:(0,tp.val)(u.template.project.pointers.historic.sheetsById[u.address.sheetId].sequence.tracksByObject[u.address.objectKey].trackData[$])})).filter(({track:$})=>!!$).map($=>U(P({},$),{nearbies:Kae(u,{id:$.trackId,data:$.track,sheetObject:u},T)})),R=N.find(({nearbies:$})=>!!$.cur),O=N.every(({nearbies:$})=>!!$.cur),B=N.reduce(($,K)=>K.nearbies.prev&&($===void 0||K.nearbies.prev.kf.position>$.kf.position)?K.nearbies.prev:$,void 0),V=N.reduce(($,K)=>K.nearbies.next&&($===void 0||K.nearbies.next.kf.position<$.kf.position)?K.nearbies.next:$,void 0),Y=()=>{O?ce().transaction($=>{$.unset(a)}):R?ce().transaction($=>{$.set(a,(0,tp.val)(a))}):ce().transaction($=>{$.set(a,(0,tp.val)(a))})},W={cur:R?{type:"on",itemKey:jl.forCompoundPropAggregateKeyframe(u,_,T),toggle:Y}:{toggle:Y,type:"off"},prev:B!==void 0?{position:B.kf.position,itemKey:jl.forCompoundPropAggregateKeyframe(u,_,B.kf.position),jump:()=>{u.sheet.getSequence().position=B.kf.position}}:void 0,next:V!==void 0?{position:V.kf.position,itemKey:jl.forCompoundPropAggregateKeyframe(u,_,V.kf.position),jump:()=>{u.sheet.getSequence().position=V.kf.position}}:void 0};return S8.default.createElement(eG,P({},W))},[a,u,d,g])}var tp,S8,tle=C(()=>{Pe(),UR(),Ar(),tp=un(),Z0(),S8=z(nt()),Yae(),B4(),wf(),JT(),HR(),Qae(),Tke()});function Mke(a,u,d){return(0,Nf.prism)(()=>{var g;let _=(0,Nf.getPointerParts)(a).path,T=u.getValueByPointer(a),N=Nf.prism.memo("editPropValue",()=>{let K=null;return{temporarilySetValue(J){K||(K=ce().scrub()),K.capture(oe=>{oe.set(a,J)})},discardTemporaryValue(){K&&(K.discard(),K=null)},permanentlySetValue(J){K?(K.capture(oe=>{oe.set(a,J)}),K.commit(),K=null):ce().transaction(oe=>{oe.set(a,J)})}}},[]),R={createAsset:K=>u.sheet.project.assetStorage.createAsset(K),getAssetUrl:K=>K.id?u.sheet.project.assetStorage.getAssetUrl(K.id):void 0},O=(0,Nf.val)(Uu(ce().atomP.ephemeral.projects.stateByProjectId[u.address.projectId].stateBySheetId[u.address.sheetId].stateByObjectKey[u.address.objectKey].valuesBeingScrubbed,(0,Nf.getPointerParts)(a).path))===!0,B=[],V=U(P(P({},N),R),{value:T,beingScrubbed:O,contextMenuItems:B,controlIndicators:hb.default.createElement(hb.default.Fragment,null)}),Y=bke(d);if(Y){let K=(0,Nf.val)(u.template.getMapOfValidSequenceTracks_forStudio()),J=U4(K,_);if(typeof J=="string"){B.push({label:"Make static",callback:()=>{ce().transaction(({stateEditors:we})=>{let ft=U(P({},u.address),{pathToProp:_});we.coreByProject.historic.sheetsById.sequence.setPrimitivePropAsStatic(U(P({},ft),{value:u.getValueByPointer(a)}))})}});let oe=J,ae=Nf.prism.sub("lcr",()=>{let we=(0,Nf.val)(u.template.project.pointers.historic.sheetsById[u.address.sheetId].sequence.tracksByObject[u.address.objectKey].trackData[oe]),ft=(0,Nf.val)(u.sheet.getSequence().positionPrism);return Kae(u,we&&{data:we,id:oe,sheetObject:u},ft)},[oe]),ue;V.beingScrubbed?ue="Sequenced_OnKeyframe_BeingScrubbed":ae.cur?ue="Sequenced_OnKeyframe":((g=ae.prev)==null?void 0:g.kf.connectedRight)===!0?ue="Sequenced_BeingInterpolated":ue="Sequened_NotBeingInterpolated";let xe=()=>{ae.cur?ce().transaction(we=>{we.unset(a)}):ce().transaction(we=>{we.set(a,V.value)})},Re={cur:ae.cur?{type:"on",itemKey:ae.cur.itemKey,toggle:xe}:{type:"off",toggle:xe},prev:ae.prev!==void 0?{itemKey:ae.prev.itemKey,position:ae.prev.kf.position,jump:()=>{u.sheet.getSequence().position=ae.prev.kf.position}}:void 0,next:ae.next!==void 0?{itemKey:ae.next.itemKey,position:ae.next.kf.position,jump:()=>{u.sheet.getSequence().position=ae.next.kf.position}}:void 0},Ae=hb.default.createElement(eG,P({},Re));return U(P({},V),{type:"Sequenced",shade:ue,nearbyKeyframes:ae,controlIndicators:Ae})}}let W=(0,Nf.val)(u.template.getStaticValues()),$=U4(W,_);return typeof $<"u"&&B.push({label:"Reset to default",callback:()=>{ce().transaction(({unset:K})=>{K(a)})}}),Y&&B.push({label:"Sequence",callback:()=>{ce().transaction(({stateEditors:K})=>{let J=U(P({},u.address),{pathToProp:_});K.coreByProject.historic.sheetsById.sequence.setPrimitivePropAsSequenced(J,d)})}}),typeof $<"u"?U(P({},V),{type:"Static",shade:V.beingScrubbed?"Static_BeingScrubbed":"Static",controlIndicators:hb.default.createElement(mE,{hasStaticOverride:!0,obj:u,pathToProp:_,propConfig:d})}):U(P({},V),{type:"Default",shade:"Default",controlIndicators:hb.default.createElement(mE,{hasStaticOverride:!0,obj:u,pathToProp:_,propConfig:d})})})}function Cke(a,u,d){if(WR.has(a))return WR.get(a);{let g=Mke(a,u,d);return WR.set(a,g),g}}function Ake(a,u,d){let g=Cke(a,u,d);return OJ(g)}var hb,Nf,WR,Nke=C(()=>{Z0(),hb=z(nt()),Nf=un(),Pe(),UR(),Ar(),B4(),Yae(),Qae(),HR(),WR=new WeakMap});function Pke(a){return qR.has(a)||qR.set(a,(nle++).toString()),qR.get(a)}var qR,nle,Rke=C(()=>{qR=new WeakMap,nle=0}),rle,pb,ile,sle,ole,ale,lle,nG,cle,ule,dle=C(()=>{Ar(),rle=z(nt()),tn(),Wt(),O4(),ms(),pb=un(),ile="32px",ge.div(sle||(sle=H([`
  `,`;
  background-color: rgba(40, 43, 47, 0.8);
  position: fixed;
  right: 8px;
  top: 50px;
  // Temporary, see comment about CSS grid in SingleRowPropEditor.
  width: 280px;
  height: fit-content;
  z-index: `,`;

  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.25), 0 2px 6px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(14px);
  border-radius: 2px;

  display: `,`;

  &:hover {
    display: block;
  }

  @supports not (backdrop-filter: blur()) {
    background: rgba(40, 43, 47, 0.95);
  }
`])),Zi,v8.propsPanel,({pin:a})=>a?"block":"none"),ge.div(ole||(ole=H([`
  margin: 0 10px;
  color: #919191;
  font-weight: 500;
  font-size: 10px;
  user-select: none;
  `,`;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
`])),Zi),ge.div(ale||(ale=H([`
  height: `,`;
  display: flex;
  align-items: center;
`])),ile),ge.div(lle||(lle=H([`
  `,`;
  max-height: calc(100vh - 100px);
  overflow-y: scroll;
  &::-webkit-scrollbar {
    display: none;
  }

  scrollbar-width: none;
  padding: 0;
  user-select: none;

  /* Set the font-size for input values in the detail panel */
  font-size: 12px;
`])),Zi),nG=(0,rle.createContext)([!1,()=>()=>{}]),cle=new pb.Atom(!1),ule=new pb.Atom(!1),(0,pb.prism)(()=>{let a=(0,pb.val)(ule.prism),u=(0,pb.val)(cle.prism);return a||u})});function oc(a,u){let[d,g]=Wie(a,u),[,_]=(0,fb.useContext)(nG);return(0,fb.useEffect)(()=>{var T;let N;return d.isOpen&&((T=u.onOpen)==null||T.call(u),N=_()),()=>N==null?void 0:N()},[d.isOpen,u.onOpen]),[d.isOpen?fb.default.createElement(Hie,{items:u.menuItems,displayName:u.displayName,clickPoint:d.event,onRequestClose:g}):hle,g,d.isOpen]}var fb,hle,ac=C(()=>{fb=z(nt()),BIe(),UIe(),dle(),hle=fb.default.createElement(fb.default.Fragment,null)}),t3,ple,rG,fle,XR,mle,iG,gle,yle,vle,xle,ble,_le,Sle,wle,Tle,sG,YR=C(()=>{ms(),t3=z(nt()),QT(),tn(),Z2(),gV(),ac(),rG=ge.li(ple||(ple=H([`
  --depth: `,`;
  margin: 0;
  padding: 0;
  list-style: none;
`])),a=>a.depth-1),XR=ge.div(fle||(fle=H([`
  border-bottom: 1px solid #7695b705;
`]))),iG=ge(XR)(mle||(mle=H([`
  padding-left: calc(var(--depth) * 10px);

  display: flex;
  align-items: stretch;
  color: `,`;

  box-sizing: border-box;

  `,`;
`])),$7.panel.body.compoudThing.label.color,a=>a.isSelected&&"background: blue"),yle=ge.span(gle||(gle=H([`
  `,`;
  overflow-x: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  padding-right: 4px;
  line-height: 26px;
  flex-wrap: nowrap;
  width: 100%;

  `,`:hover & {
    color: #ccc;
  }
`])),Tf,iG),xle=ge.span(vle||(vle=H([`
  color: #6a9955;
  font-size: 12px;
  margin-right: auto;
  margin-left: 8px;
  opacity: 0.8;
  font-weight: normal;
  max-width: 150px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`]))),_le=ge.span(ble||(ble=H([`
  width: 12px;
  padding: 8px;
  font-size: 9px;
  display: flex;
  align-items: center;

  transition: transform 0.05s ease-out, color 0.1s ease-out;
  transform: rotateZ(`,`deg);
  color: #66686a;

  &:hover {
    transform: rotateZ(`,`deg);
    color: #c0c4c9;
  }
`])),a=>a.isCollapsed?0:90,a=>a.isCollapsed?15:75),wle=ge.ul(Sle||(Sle=H([`
  margin: 0;
  padding: 0;
  list-style: none;
`]))),Tle=({leaf:a,label:u,children:d,isSelectable:g,isSelected:_,toggleSelect:T,toggleCollapsed:N,isCollapsed:R,valueDisplay:O,contextMenuItems:B})=>{let V=Array.isArray(d)&&d.length>0,Y=(0,t3.useRef)(null);mV(Y.current,a);let[W]=oc(Y.current,{menuItems:B??[]});return a.shouldRender?t3.default.createElement(rG,{depth:a.depth},W,t3.default.createElement(iG,{ref:Y,style:{height:a.nodeHeight+"px"},isSelectable:g===!0,isSelected:_===!0,onClick:T,isEven:a.n%2===0},t3.default.createElement(_le,{isCollapsed:R,onClick:N},t3.default.createElement(_Ie,null)),t3.default.createElement(yle,{onClick:N},u),O&&t3.default.createElement(xle,null,O)),V&&t3.default.createElement(wle,null,d)):null},sG=Tle});function Ike(a,u){if(a.length!==u.length)return!1;for(let d=0;d<a.length;d++)if(a[d]!==u[d])return!1;return!0}function oG(a){var u;let d=[];for(;;){let g=d.length,_=(u=a[0])==null?void 0:u[g];if(_===void 0)return d;for(let T of a)if(_!==T[g])return d;d.push(_)}}var Pf,aG,V4=C(()=>{XV(),Pf=FR(a=>JSON.stringify(a)),aG=a=>JSON.parse(a)});function kke(a,u){let d=(0,lG.useRef)({combo:a,listener:u});d.current={combo:a,listener:u},(0,lG.useEffect)(()=>{function g(N){N.key===d.current.combo&&d.current.listener({down:!0,event:N})}function _(N){N.key===d.current.combo&&d.current.listener({down:!1,event:N})}function T(N){d.current.listener({down:!1,event:void 0})}return document.addEventListener("keydown",g),document.addEventListener("keyup",_),window.addEventListener("blur",T),()=>{document.removeEventListener("keydown",g),document.removeEventListener("keyup",_),window.removeEventListener("blur",T)}},[])}var lG,Dke=C(()=>{lG=z(nt())});function Ele(a){let[u,d]=(0,Mle.useState)(!1);return kke(a,({down:g})=>{d(g)}),u}var Mle,Cle=C(()=>{Mle=z(nt()),Dke()});function Oke(a){let u=(0,cG.useMemo)(()=>new Ale.Atom(a),[]);return(0,cG.useLayoutEffect)(()=>{u.set(a)},[a]),u}var Ale,cG,Lke=C(()=>{Ale=un(),cG=z(nt())});function Nle(a,u,d){let g=(0,uG.pointer)({root:{},path:[]}),_=u(g);Do(a,(0,uG.getPointerParts)(_).path,d)}var uG,Fke=C(()=>{uG=un(),Zo()}),KR,Ple,lc,Rf=C(()=>{KR="data-pos",Ple={checkIfMouseEventSnapToPos(a,u){let d=a.composedPath().find(g=>g instanceof Element&&g!==(u==null?void 0:u.ignore)&&g.hasAttribute(KR));if(d){let g=parseFloat(d.getAttribute(KR));if(isFinite(g))return g}return null},includePositionSnapAttrs(a){return{[KR]:a}}},lc=Ple});function ZR(a){let u=a.type==="sheet"?Uke(a):dG(a);return{byPosition:Bke(u),tracks:u}}function Bke(a){let u=new Map;for(let d of a)for(let g of d.data.keyframes){let _=u.get(g.position);_||(_=[],u.set(g.position,_)),_.push({kf:g,track:d,itemKey:jl.forTrackKeyframe(d.sheetObject,d.id,g.id)})}return u}function Uke(a){return a.children.filter(u=>u.type==="sheetObject").flatMap(dG)}function dG(a){return a.children.flatMap(u=>u.type==="propWithChildren"?dG(u):zke(u))}function zke(a){let u=a.sheetObject,d=u.address.projectId,g=ce().atomP.historic.coreByProject[d].sheetsById[u.address.sheetId].sequence.tracksByObject[u.address.objectKey],_=(0,hG.val)(g.trackIdByPropPath[Pf(a.pathToProp)]);if(!_)return[];let T=(0,hG.val)(g.trackData[_]);return T?[{id:_,data:T,sheetObject:u}]:[]}var hG,QR=C(()=>{Pe(),hG=un(),wf(),V4()});function Vke(a,u){let[d,g]=Ni(null),_=Q7("useCaptureSelection");return wo(u,(0,mb.useMemo)(()=>({debugName:"DopeSheetSelectionView/useCaptureSelection",dontBlockMouseDown:!0,lockCSSCursorTo:"cell",onDragStart(T){if(!T.shiftKey||T.target instanceof HTMLInputElement)return!1;let N=u.getBoundingClientRect(),R=T.clientX-N.left-(0,np.val)(a.scaledSpace.leftPadding),O=(0,np.val)(a.scaledSpace.toUnitSpace)(R);return d.current={h:[O,O],v:[T.clientY-N.top,T.clientY-N.top]},(0,np.val)(a.selectionAtom).set({current:void 0}),{onDrag(B,V,Y){let W=u.getBoundingClientRect(),$=Y.clientX-W.left-(0,np.val)(a.scaledSpace.leftPadding),K=(0,np.val)(a.scaledSpace.toUnitSpace)($);d.current={h:[d.current.h[0],K],v:[d.current.v[0],Y.clientY-W.top]};let J=pG.boundsToSelection(_,(0,np.val)(a),d.current);(0,np.val)(a.selectionAtom).set({current:J})},onDragEnd(B){d.current=null}}}}),[a,u,d])),g}var np,mb,w8,Rle,Ile,kle,pG,Dle,Ole,fG,Lle,Fle,Gke=C(()=>{Pe(),va(),Cle(),Lke(),Fke(),ls(),Ar(),np=un(),mb=z(nt()),tn(),Rf(),QR(),x8(),w8=5,Ile=ge.div(Rle||(Rle=H([`
  cursor: `,`;
`])),a=>a.isShiftDown?"cell":"default"),kle=({layoutP:a,children:u,height:d})=>{let[g,_]=Ni(null),T=Ele("Shift"),N=Vke(a,_),R=(0,mb.useRef)(N);return R.current=N,mb.default.createElement(Ile,{style:{height:d+"px"},ref:g,isShiftDown:T,className:"selectionview"},N&&mb.default.createElement(Lle,{state:N,layoutP:a}),u)},(a=>{let u=(N,R,O,B,V)=>{let Y=ZR(O);if(O.top+O.nodeHeight/2+w8>B.v[0]&&O.top+O.nodeHeight/2-w8<B.v[1])for(let[W,$]of Y.byPosition){let K=R.scaledSpace.toUnitSpace(w8);if(!(W+K<=B.h[0]||W-K>=B.h[1]))for(let J of $)Nle(V,oe=>oe[J.track.sheetObject.address.objectKey].byTrackId[J.track.id].byKeyframeId[J.kf.id],!0)}g(N,R,O,B,V)},d={sheet(N,R,O,B,V){u(N,R,O,B,V)},propWithChildren(N,R,O,B,V){u(N,R,O,B,V)},sheetObject(N,R,O,B,V){u(N,R,O,B,V)},primitiveProp(N,R,O,B,V){let{sheetObject:Y,trackId:W}=O;if(!W)return;let $=(0,np.val)(ce().atomP.historic.coreByProject[Y.address.projectId].sheetsById[Y.address.sheetId].sequence.tracksByObject[Y.address.objectKey].trackData[W]);if(!(B.v[0]>O.top+O.nodeHeight/2+w8||O.top+O.nodeHeight/2-w8>B.v[1]))for(let K of $.keyframes){let J=R.scaledSpace.toUnitSpace(w8);if(!(K.position+J<=B.h[0])){if(K.position-J>=B.h[1])break;Nle(V,oe=>oe[Y.address.objectKey].byTrackId[W].byKeyframeId[K.id],!0)}}}},g=(N,R,O,B,V)=>{if("children"in O)for(let Y of O.children)_(N,R,Y,B,V)};function _(N,R,O,B,V){if(!O.shouldRender){g(N,R,O,B,V);return}if(B.v[0]>O.top+O.heightIncludingChildren||O.top>B.v[1])return;let Y=d[O.type];Y?Y(N,R,O,B,V):g(N,R,O,B,V)}function T(N,R,O){let B={};O=fG(O);let V=R.tree;_(N.utilFor.internal(),R,V,O,B);let Y=R.tree.sheet;return{type:"DopeSheetSelection",byObjectKey:B,getDragHandlers(W){return{debugName:"DopeSheetSelectionView/boundsToSelection",onDragStart(){let $,K=R.scaledSpace.toUnitSpace;return{onDrag(J,oe,ae){$&&($.discard(),$=void 0);let ue=lc.checkIfMouseEventSnapToPos(ae,{ignore:W.domNode}),xe=ue!=null?ue-W.positionAtStartOfDrag:K(J);$=ce().tempTransaction(({stateEditors:Re})=>{let Ae=Re.coreByProject.historic.sheetsById.sequence.transformKeyframes;for(let we of Object.keys(B)){let{byTrackId:ft}=B[we];for(let Le of Object.keys(ft)){let{byKeyframeId:Se}=ft[Le];Ae({trackId:Le,keyframeIds:Object.keys(Se),translate:xe,scale:1,origin:0,snappingFunction:Y.getSequence().closestGridPosition,objectKey:we,projectId:W.projectId,sheetId:W.sheetId})}}})},onDragEnd(J){J?$==null||$.commit():$==null||$.discard()}}}}},delete(){ce().transaction(({stateEditors:W})=>{let $=W.coreByProject.historic.sheetsById.sequence.deleteKeyframes;for(let K of Object.keys(B)){let{byTrackId:J}=B[K];for(let oe of Object.keys(J)){let{byKeyframeId:ae}=J[oe];$(U(P({},Y.address),{objectKey:K,trackId:oe,keyframeIds:Object.keys(ae)}))}}})}}}a.boundsToSelection=T})(pG||(pG={})),Ole=ge.div(Dle||(Dle=H([`
  position: absolute;
  background: rgba(255, 255, 255, 0.1);
  border: 1px dashed rgba(255, 255, 255, 0.4);
  box-sizing: border-box;
`]))),fG=a=>({h:[...a.h].sort((u,d)=>u-d),v:[...a.v].sort((u,d)=>u-d)}),Lle=({state:a,layoutP:u})=>{let d=Oke(a);return di(()=>{let g=(0,np.val)(d.pointer),_=fG(g),T=(0,np.val)(u.scaledSpace.fromUnitSpace),N=(0,np.val)(u.scaledSpace.leftPadding),R=_.h.map(T).map(W=>W+N),O=_.v[0],B=_.v[1]-_.v[0],V=R[0],Y=R[1]-R[0];return mb.default.createElement(Ole,{style:{top:O+"px",height:B+"px",left:V+"px",width:Y+"px"}})},[u,d])},Fle=kle}),Kd,Ble,Ule,zle,mG,gG,yG,Vle,Gle,jle,JR=C(()=>{W7(),Kd=z(nt()),tn(),F1(),Ble=un(),zle=ge.div(Ule||(Ule=H([`
  position: absolute;
  top: 30px;
  right: 0;
  left: 0;
  bottom: 0;
  overflow-x: hidden;
  overflow-y: scroll;
  z-index: `,`;

  &::-webkit-scrollbar {
    display: none;
  }

  scrollbar-width: none;
`])),()=>Of.scrollableArea),mG=(0,Kd.createContext)(xf),gG=(0,Kd.createContext)(null),yG=()=>(0,Kd.useContext)(gG),Vle=()=>(0,Kd.useContext)(mG),Gle=a=>{let u=(0,Kd.useRef)(null),d=(0,Kd.useCallback)(T=>{u.current.scrollBy(0,T.deltaY)},[]),g=(0,Kd.useMemo)(()=>new Ble.Atom({scrollTop:0,clientHeight:0}),[]),_=(0,Kd.useCallback)(()=>{u.current&&g.set({scrollTop:u.current.scrollTop,clientHeight:u.current.clientHeight})},[g]);return(0,Kd.useLayoutEffect)(()=>{u.current&&g.set({scrollTop:u.current.scrollTop,clientHeight:u.current.clientHeight});let T=u.current;if(!T)return;let N=new ResizeObserver(()=>{g.set({scrollTop:T.scrollTop,clientHeight:T.clientHeight})});return N.observe(T),()=>N.disconnect()},[g]),Kd.default.createElement(gG.Provider,{value:g.pointer},Kd.default.createElement(mG.Provider,{value:d},Kd.default.createElement(zle,{ref:u,onScroll:_,id:"VerticalScrollContainer"},a.children)))},jle=Gle}),vG,Hle=C(()=>{vG='data:image/svg+xml,<svg width="34" height="34" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">%0D%0A  <path d="M1 7V1H7" stroke="%2374FFDE" stroke-width="0.25" />%0D%0A  <path d="M7 33H1L1 27" stroke="%2374FFDE" stroke-width="0.25" />%0D%0A  <path d="M33 27V33H27" stroke="%2374FFDE" stroke-width="0.25" />%0D%0A  <path d="M27 1L33 1V7" stroke="%2374FFDE" stroke-width="0.25" />%0D%0A</svg>'}),If,eI=C(()=>{If=(a,u=a)=>`
  left: `.concat(a*-.5,`px;
  top: `).concat(u*-.5,`px;
  width: `).concat(a,`px;
  height: `).concat(u,`px;
`)}),tI,$le,Wle,jke=C(()=>{tI=un(),$le=(0,tI.prism)(()=>{let[a,u]=tI.prism.state("pos",null);return tI.prism.effect("setupListeners",()=>{let d=g=>{u(g)};return document.addEventListener("mousemove",d),()=>{document.removeEventListener("mousemove",d)}},[]),a}),Wle=$le}),n3,tu,gE,qle,Xle,Yle,xG,N1,P1,nI,Kle,Zle,fl=C(()=>{n3=un(),jke(),b0(),tu=z(nt()),gE=(0,tu.createContext)(null),qle=0,Xle=({children:a,layoutP:u})=>{let d=(0,tu.useMemo)(()=>new n3.Atom([]),[]),g=(0,tu.useMemo)(()=>(0,n3.prism)(()=>{let N=n3.prism.memo("p",()=>Kle(u),[u]).getValue(),R=(0,n3.val)(d.pointer);return R.length>0?j2(R).position:N}),[u]),_=(0,tu.useCallback)(()=>{let N=qle++;return d.reduce(R=>[...R,{id:N,position:[-1,0]}]),{set:R=>{d.reduce(O=>{let B=O.findIndex(Y=>Y.id===N);if(B===-1)return console.warn("Lock is already freed. This is a bug."),O;let V=[...O];return V.splice(B,1,{id:N,position:[R,R===-1?0:1]}),V})},unlock:()=>{d.reduce(R=>R.filter(O=>O.id!==N))}}},[]),T={currentD:g,getLock:_};return tu.default.createElement(gE.Provider,{value:T},a)},Yle=()=>(0,tu.useContext)(gE).currentD,xG=()=>{let{getLock:a}=(0,tu.useContext)(gE),u=(0,tu.useRef)();return(0,tu.useLayoutEffect)(()=>()=>{var d;(d=u.current)==null||d.unlock()},[]),(0,tu.useMemo)(()=>{let d;return(g,_)=>{var T,N;(d==null?void 0:d.shouldLock)!==g&&(g?u.current=a():(T=u.current)==null||T.unlock()),(d==null?void 0:d.pos)!==_&&g&&((N=u.current)==null||N.set(_)),d={shouldLock:g,pos:_}}},[a])},N1=(a,u)=>{let{getLock:d}=(0,tu.useContext)(gE),g=(0,tu.useRef)();(0,tu.useLayoutEffect)(()=>{if(a)return g.current=d(),()=>{g.current.unlock()}},[a,d]),(0,tu.useLayoutEffect)(()=>{a&&g.current.set(u)},[u,a])},P1=a=>({[nI]:a==="hide"?a:a.toFixed(3)}),nI="data-theatre-lock-framestamp-to",Kle=a=>(0,n3.prism)(()=>{let u=(0,n3.val)(a.rightDims),d=(0,n3.val)(a.clippedSpace.toUnitSpace),g=(0,n3.val)(Wle);if(!g)return[-1,0];for(let V of g.composedPath()){if(!(V instanceof HTMLElement||V instanceof SVGElement))break;if(V.hasAttribute(nI)){let Y=V.getAttribute(nI);if(typeof Y!="string")continue;if(Y==="hide")return[-1,0];let W=parseFloat(Y);if(isFinite(W)&&W>=0)return[W,2]}}let{clientX:_,clientY:T}=g,{screenX:N,screenY:R,width:O,height:B}=u;if(TT(_,N,N+O)&&TT(T,R+16,R+B)){let V=_-N;return[d(V),3]}else return[-1,0]}),Zle=Xle}),Qle,yE,bG,Jle,e0e,nu,_G=C(()=>{ms(),rc(),tn(),Hle(),eI(),Rf(),fl(),Qle=12,yE=34,bG="beingDragged",nu={BEING_DRAGGED_CLASS:bG,CSS:Yd(Jle||(Jle=H([`
    position: absolute;
    `,`;
    `,`;

    &.`,` {
      pointer-events: none !important;
    }
  `])),If(Qle),Zi,bG),CSS_WHEN_SOMETHING_DRAGGING:Yd(e0e||(e0e=H([`
    pointer-events: auto;
    cursor: var(`,`);

    //  thing
    // This box extends the hitzone so the user does not
    // accidentally leave the hitzone
    &:hover:after {
      position: absolute;
      top: calc(50% - `,`px);
      left: calc(50% - `,`px);
      width: `,`px;
      height: `,`px;
      display: block;
      content: ' ';
      background: url(`,`) no-repeat 100% 100%;
      // This icon might also fit: GiConvergenceTarget
    }
  `])),bf,yE/2,yE/2,yE,yE,vG),reactProps(a){return U(P(P({},P1(a.position)),lc.includePositionSnapAttrs(a.position)),{className:a.isDragging?nu.BEING_DRAGGED_CLASS:""})}}});function rI(){vE.set({mode:"snapToAll"})}function gb(){vE.set({mode:"snapToNone"})}function Hke(a){vE.set({mode:"snapToSome",positions:a})}function $ke(a,u){return Object.fromEntries(Object.entries(a).map(([d,g])=>[d,Object.fromEntries(Object.entries(g.trackData).map(([_,T])=>[_,T.keyframes.filter(N=>u(N,{trackId:_,trackData:T,objectKey:d})).map(N=>N.position)]))]))}var t0e,n0e,SG,r0e,i0e,s0e,o0e,a0e,wG,vE,l0e,yb=C(()=>{t0e=un(),n0e=un(),SG=z(nt()),tn(),_G(),i0e=ge.div(r0e||(r0e=H([`
  z-index: 1;
  cursor: ew-resize;

  `,`

  #pointer-root.draggingPositionInSequenceEditor & {
    `,`
  }
`])),nu.CSS,nu.CSS_WHEN_SOMETHING_DRAGGING),o0e=ge.div(s0e||(s0e=H([`
  position: absolute;
`]))),a0e=a=>SG.default.createElement(o0e,{style:{top:"".concat(a.leaf.nodeHeight/2,"px"),left:"calc(".concat((0,n0e.val)(a.layoutP.scaledSpace.leftPadding),"px + calc(var(--unitSpaceToScaledSpaceMultiplier) * ").concat(a.position,"px))")}},SG.default.createElement(i0e,P({},nu.reactProps({isDragging:!1,position:a.position})))),wG=a0e,vE=new t0e.Atom({mode:"snapToNone"}),l0e=vE.prism});function Wke(a,u){let d=(0,T8.useMemo)(()=>({debugName:"HorizontallyScrollableArea",onDragStart(_){if(_.target instanceof HTMLInputElement||_.shiftKey||_.altKey||_.ctrlKey||_.metaKey||_.composedPath().some(Y=>Y instanceof HTMLElement&&Y.draggable===!0))return!1;let T=_.clientX-u.getBoundingClientRect().left,N=os((0,Qo.val)(a.clippedSpace.toUnitSpace)(T),0,1/0),R=(0,Qo.val)(a.seeker.setIsSeeking),O=(0,Qo.val)(a.sheet).getSequence();O.position=N;let B=N,V=(0,Qo.val)(a.scaledSpace.toUnitSpace);return R(!0),rI(),{onDrag(Y,W,$){let K=V(Y),J=os(B+K,0,O.length),oe=lc.checkIfMouseEventSnapToPos($,{});oe!=null&&(J=oe),O.position=J},onDragEnd(){R(!1),gb()}}}}),[a,u]),[g]=wo(u,d);Wu(g,"draggingPositionInSequenceEditor","ew-resize")}function qke(a,u){let d=Vle();(0,T8.useLayoutEffect)(()=>{if(!u)return;let g=T=>{if(T.ctrlKey){T.preventDefault(),T.stopPropagation();let N=T.clientX-u.getBoundingClientRect().left,R=(0,Qo.val)(a.clippedSpace.toUnitSpace)(N),O=(0,Qo.val)(a.clippedSpace.range),B=1+TG(T.deltaY,[-50,50])*.03,V=pf(O,$=>($-R)*B+R),Y=(0,Qo.val)(a.sheet).getSequence().length,W=Y+Y*.25;(0,Qo.val)(a.clippedSpace.setRange)(Xke(V,[0,W]));return}else if(T.shiftKey){T.preventDefault(),T.stopPropagation();let N=(0,Qo.val)(a.sheet).getSequence().length,R=(0,Qo.val)(a.clippedSpace.range),O=(R.end-R.start)/N,B=TG(T.deltaY||T.deltaX,[-50,50])*.05*O,V=pf(R,Y=>Y+B);(0,Qo.val)(a.clippedSpace.setRange)(V);return}else{d(T),T.preventDefault(),T.stopPropagation();let N=(0,Qo.val)(a.scaledSpace.toUnitSpace)(T.deltaX*1),R=(0,Qo.val)(a.clippedSpace.range),O=pf(R,B=>B+N);(0,Qo.val)(a.clippedSpace.setRange)(O);return}},_={capture:!0,passive:!1};return u.addEventListener("wheel",g,_),()=>{u.removeEventListener("wheel",g,_)}},[u,a]),wo(u,(0,T8.useMemo)(()=>({onDragStart(g){let _=(0,Qo.val)(a.clippedSpace.range),T=(0,Qo.val)(a.clippedSpace.setRange),N=(0,Qo.val)(a.scaledSpace.toUnitSpace);return g.preventDefault(),g.stopPropagation(),{onDrag(R,O,B,V,Y){d({deltaY:-Y});let W=-N(R),$=pf(_,K=>K+W);T($)}}},debugName:"HorizontallyScrollableArea Middle Button Drag",buttons:[1],lockCSSCursorTo:"grabbing"}),[a]))}function TG(a,[u,d]){return Math.max(Math.min(a,d),u)}function Xke(a,u){return pf(a,d=>TG(d,u))}function Yke(a,u){(0,T8.useLayoutEffect)(()=>{if(!u)return;let d=(0,Qo.prism)(()=>{let N=(0,Qo.val)(a.clippedSpace.range);return(0,Qo.val)(a.scaledSpace.fromUnitSpace)(N.start)}),g=()=>{let N=d.getValue();u.scrollLeft=N},_=d.onStale(g);g();let T=setTimeout(g,100);return()=>{clearTimeout(T),_()}},[a,u])}var Qo,T8,c0e,u0e,d0e,iI,EG=C(()=>{va(),ls(),Ar(),Qo=un(),b0(),T8=z(nt()),tn(),JR(),ms(),rc(),Rf(),yb(),u0e=ge.div(c0e||(c0e=H([`
  position: absolute;
  right: 0;
  overflow-x: scroll;
  overflow-y: hidden;
  `,`;

  // hide the scrollbar on Gecko
  scrollbar-width: none;

  // hide the scrollbar on Webkit/Blink
  &::-webkit-scrollbar {
    display: none;
  }
`])),Zi),d0e=T8.default.memo(({layoutP:a,children:u,height:d})=>{let{width:g,unitSpaceToScaledSpaceMultiplier:_}=di(()=>({width:(0,Qo.val)(a.rightDims.width),unitSpaceToScaledSpaceMultiplier:(0,Qo.val)(a.scaledSpace.fromUnitSpace)(1)}),[a]),[T,N]=Ni(null);return qke(a,N),Wke(a,N),Yke(a,N),T8.default.createElement(u0e,{ref:T,style:{width:g+"px",height:d+"px","--unitSpaceToScaledSpaceMultiplier":_}},u)}),iI=d0e}),sI,h0e,p0e,f0e,m0e,g0e,y0e,v0e,E8,oI=C(()=>{sI=z(nt()),tn(),p0e=ge.li(h0e||(h0e=H([`
  margin: 0;
  padding: 0;
  list-style: none;
  box-sizing: border-box;
  position: relative;
`]))),m0e=ge.div(f0e||(f0e=H([`
  box-sizing: border-box;
  width: 100%;
  position: relative;

  &:before {
    position: absolute;
    display: block;
    content: ' ';
    left: -40px;
    top: 0;
    bottom: 0;
    right: 0;
    box-sizing: border-box;
    border-bottom: 1px solid #252b3869;
    background: `,`;
  }
`])),a=>a.isEven?"transparent":"#6b8fb505"),y0e=ge.ul(g0e||(g0e=H([`
  margin: 0;
  padding: 0;
  list-style: none;
`]))),v0e=({leaf:a,children:u,node:d,isCollapsed:g})=>{let _=Array.isArray(u)&&u.length>0;return a.shouldRender?sI.default.createElement(p0e,null,sI.default.createElement(m0e,{style:{height:a.nodeHeight+"px"},isEven:a.n%2===0},d),_&&sI.default.createElement(y0e,null,u)):null},E8=v0e}),Kke=Z((a,u)=>{(function(){var d=this,g={};typeof a<"u"?u.exports=g:d.fuzzy=g,g.simpleFilter=function(_,T){return T.filter(function(N){return g.test(_,N)})},g.test=function(_,T){return g.match(_,T)!==null},g.match=function(_,T,N){N=N||{};var R=0,O=[],B=T.length,V=0,Y=0,W=N.pre||"",$=N.post||"",K=N.caseSensitive&&T||T.toLowerCase(),J;_=N.caseSensitive&&_||_.toLowerCase();for(var oe=0;oe<B;oe++)J=T[oe],K[oe]===_[R]?(J=W+J+$,R+=1,Y+=1+Y):Y=0,V+=Y,O[O.length]=J;return R===_.length?(V=K===_?1/0:V,{rendered:O.join(""),score:V}):null},g.filter=function(_,T,N){return!T||T.length===0?[]:typeof _!="string"?T:(N=N||{},T.reduce(function(R,O,B,V){var Y=O;N.extract&&(Y=N.extract(O));var W=g.match(_,Y,N);return W!=null&&(R[R.length]={string:W.rendered,score:W.score,index:B,original:O}),R},[]).sort(function(R,O){var B=O.score-R.score;return B||R.index-O.index}))}})()});function Zke(a,u){let[d,g]=(0,aI.useState)(!1),_=(0,aI.useRef)(u);return d||(_.current=u),(0,aI.useMemo)(()=>a(g),_.current)}var aI,Qke=C(()=>{aI=z(nt())}),MG,G4,lI=C(()=>{MG="rgba(26, 28, 30, 0.97);",G4="#272B2F"});function x0e(a,u,d,g){let _=Zke(T=>({debugName:"CurveSegmentEditor/useKeyframeDrag",lockCSSCursorTo:"move",onDragStart(){return T(!0),{onDrag(N,R){a&&d.onCurveChange(g(N,R))},onDragEnd(N){T(!1),d.onCancelCurveChange()}}}}),[a,d.onCurveChange,d.onCancelCurveChange]);wo(u,_)}var Qi,cI,xE,vb,b0e,bE,_0e,uI,S0e,w0e,T0e,xb,E0e,M8,M0e,C0e,CG,A0e,dI,N0e,AG,P0e,R0e,Jke=C(()=>{Qi=z(nt()),va(),ls(),lf(),tn(),ms(),Qke(),lI(),cI=.12,xE=1+cI*2,vb=.01,b0e=8,bE=(1-vb)/(b0e-1),_0e="#3EAAA4",uI="#3EAAA4",S0e="#3EAAA4",w0e="#3EAAA4",T0e="#3EAAA4",xb="#3EAAA4",E0e="#3EAAA4",M8="#B3B3B3",M0e="#3eaaa4",C0e="#67dfd8",CG=["goldenrod","cornflowerblue","dodgerblue","lawngreen"],dI=ge.circle(A0e||(A0e=H([`
  stroke-width: 0.1px;
  vector-effect: non-scaling-stroke;
  r: 0.04px;
  pointer-events: none;
  transition: r 0.15s;
  fill: `,`;
`])),M0e),AG=ge.circle(N0e||(N0e=H([`
  stroke-width: 0.1px;
  vector-effect: non-scaling-stroke;
  r: 0.09px;
  cursor: move;
  `,`;
  &:hover {
    opacity: 0.4;
  }
  &:hover + `,` {
    fill: `,`;
  }
`])),Zi,dI,C0e),P0e=a=>{let{curveConnection:{left:u,right:d},backgroundConnections:g}=a,_=Math.min(0,1-d.handles[1],1-u.handles[3]),T=Math.max(1,1-d.handles[1],1-u.handles[3]),N=Math.max(1,T-_),R=ae=>(ae-_)/N,[O,B]=Ni(null),V=xE/((B==null?void 0:B.clientWidth)||1),Y=xE/((B==null?void 0:B.clientHeight)||1),[W,$]=Ni(null);x0e(B,$,a,(ae,ue)=>{let xe=os(u.handles[2]+ae*V,0,1),Re=u.handles[3]-ue*Y;return[xe,Re,d.handles[0],d.handles[1]]});let[K,J]=Ni(null);x0e(B,J,a,(ae,ue)=>{let xe=os(d.handles[0]+ae*V,0,1),Re=d.handles[1]-ue*Y;return[u.handles[2],u.handles[3],xe,Re]});let oe=ae=>"M0 ".concat(R(1)," C").concat(ae.left.handles[2]," ").concat(R(1-ae.left.handles[3])," ").concat(ae.right.handles[0]," ").concat(R(1-ae.right.handles[1])," 1 ").concat(R(0));return Qi.default.createElement("svg",{height:"100%",width:"100%",ref:O,viewBox:"".concat(-cI," ").concat(-cI," ").concat(xE," ").concat(xE),xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none",fill:"none"},Qi.default.createElement("linearGradient",{id:"myGradient",gradientTransform:"rotate(90)"},Qi.default.createElement("stop",{offset:R(-1),stopColor:E0e}),Qi.default.createElement("stop",{offset:R(0),stopColor:xb}),Qi.default.createElement("stop",{offset:R(.3),stopColor:T0e}),Qi.default.createElement("stop",{offset:R(.5),stopColor:w0e}),Qi.default.createElement("stop",{offset:R(.7),stopColor:S0e}),Qi.default.createElement("stop",{offset:R(1),stopColor:uI}),Qi.default.createElement("stop",{offset:R(2),stopColor:_0e})),Qi.default.createElement("pattern",{id:"dot-background-pattern-1",width:bE,height:bE/N,y:-_/N},Qi.default.createElement("rect",{width:vb,height:vb,fill:M8,opacity:.3})),Qi.default.createElement("rect",{x:0,y:0,width:"1",height:1,fill:"url(#dot-background-pattern-1)"}),Qi.default.createElement("pattern",{id:"dot-background-pattern-2",width:bE,height:bE},Qi.default.createElement("rect",{width:vb,height:vb,fill:M8})),Qi.default.createElement("rect",{x:0,y:R(0),width:"1",height:R(1)-R(0),fill:"url(#dot-background-pattern-2)"}),!u.type||u.type==="bezier"?Qi.default.createElement(Qi.default.Fragment,null,Qi.default.createElement("line",{x1:0,y1:R(1),x2:u.handles[2],y2:R(1-u.handles[3]),stroke:M8,strokeWidth:"0.01"}),Qi.default.createElement("line",{x1:1,y1:R(0),x2:d.handles[0],y2:R(1-d.handles[1]),stroke:M8,strokeWidth:"0.01"}),Qi.default.createElement("path",{d:oe(a.curveConnection),stroke:"none",fill:"url('#myGradient')",opacity:"0.1"}),g.map((ae,ue)=>Qi.default.createElement("path",{key:ae.objectKey+"/"+ae.left.id,d:oe(ae),stroke:CG[ue%CG.length],opacity:.6,strokeWidth:"0.01"})),Qi.default.createElement("path",{d:oe(a.curveConnection),stroke:"url('#myGradient')",strokeWidth:"0.02"}),Qi.default.createElement("circle",{cx:0,cy:R(1),r:"0.025",stroke:uI,strokeWidth:"0.02",fill:G4}),Qi.default.createElement("circle",{cx:1,cy:R(0),r:"0.025",stroke:xb,strokeWidth:"0.02",fill:G4}),Qi.default.createElement(AG,{ref:W,cx:u.handles[2],cy:R(1-u.handles[3]),fill:uI,opacity:.2}),Qi.default.createElement(dI,{cx:u.handles[2],cy:R(1-u.handles[3])}),Qi.default.createElement(AG,{ref:K,cx:d.handles[0],cy:R(1-d.handles[1]),fill:xb,opacity:.2}),Qi.default.createElement(dI,{cx:d.handles[0],cy:R(1-d.handles[1])})):Qi.default.createElement(Qi.default.Fragment,null,Qi.default.createElement("line",{x1:0,y1:R(1),x2:1,y2:R(1),stroke:M8,strokeWidth:"0.01"}),Qi.default.createElement("line",{x1:1,y1:R(1),x2:1,y2:0,stroke:M8,strokeWidth:"0.01"}),Qi.default.createElement("circle",{cx:0,cy:1,r:"0.025",stroke:xb,strokeWidth:"0.02",fill:G4}),Qi.default.createElement("circle",{cx:1,cy:0,r:"0.025",stroke:xb,strokeWidth:"0.02",fill:G4})))},R0e=P0e}),I0e,r3,NG,k0e,D0e,O0e,L0e,F0e=C(()=>{I0e=un(),ls(),r3=z(nt()),NG=(0,r3.createContext)(null),k0e=0,D0e=()=>{let a=(0,r3.useMemo)(()=>k0e++,[]),{cur:u,set:d}=(0,r3.useContext)(NG),[g,_]=Ni(!1),T=(0,r3.useCallback)((N,R)=>{d(N?a:-1,R)},[]);return(0,r3.useEffect)(()=>u.onStale(()=>{let N=u.getValue()===a;g.current!==N&&(g.current=N)}),[u,a]),[_,T]},O0e=({children:a})=>{let u=(0,r3.useMemo)(()=>new I0e.Atom(-1),[]),d=u.prism,g=(0,r3.useMemo)(()=>{let _;return(T,N)=>{let R=_!==void 0;_!==void 0&&(clearTimeout(_),_=void 0),N===0||R?u.set(T):_=setTimeout(()=>{u.set(T),_=void 0},N)}},[]);return r3.default.createElement(NG.Provider,{value:{cur:d,set:g}},a)},L0e=O0e});function hI(a,u){let d=a.enabled!==!1,[g,_]=D0e(),[T,N]=Ni(null);(0,U0e.useEffect)(()=>{if(!d)return;let O=T.current;if(!O)return;let B=()=>{var Y;return _(!0,(Y=a.enterDelay)!=null?Y:400)},V=()=>{var Y;return _(!1,(Y=a.exitDelay)!=null?Y:200)};return O.addEventListener("mouseenter",B),O.addEventListener("mouseleave",V),()=>{O.removeEventListener("mouseenter",B),O.removeEventListener("mouseleave",V)}},[T,d,a.enterDelay,a.exitDelay]);let R=(0,B0e.useContext)(H7);return[d&&g&&N?(0,z0e.createPortal)(pI.default.createElement(VV,{children:u,target:N,onClickOutside:xf,verticalPlacement:a.verticalPlacement,verticalGap:a.verticalGap}),R):pI.default.createElement(pI.default.Fragment,null),T,g]}var B0e,U0e,pI,z0e,fI=C(()=>{ls(),B0e=z(nt()),U0e=z(nt()),pI=z(nt()),Coe(),z0e=z(H2()),F0e(),y8(),W7()});function mI(a){return a.map(u=>u.toFixed(3)).join(", ")}function gI(a){if(!a||(a==null?void 0:a.length)>V0e)return null;let u=a.split(",");if(u.length!==4)return null;let d=u.map(g=>Number(g.trim()));return!d.every(g=>isFinite(g))||d[0]<0||d[0]>1||d[2]<0||d[2]>1?null:d}function eDe(a,u,d={threshold:.02}){if(!a||!u)return!1;let g=0;for(let _=0;_<4;_++)g+=Math.abs(a[_]-u[_]);return g<d.threshold}var V0e,yI,G0e=C(()=>{V0e=128,yI=[{label:"Quad Out",value:"0.250, 0.460, 0.450, 0.940"},{label:"Quad In Out",value:"0.455, 0.030, 0.515, 0.955"},{label:"Quad In",value:"0.550, 0.085, 0.680, 0.530"},{label:"Cubic Out",value:"0.215, 0.610, 0.355, 1.000"},{label:"Cubic In Out",value:"0.645, 0.045, 0.355, 1.000"},{label:"Cubic In",value:"0.550, 0.055, 0.675, 0.190"},{label:"Quart Out",value:"0.165, 0.840, 0.440, 1.000"},{label:"Quart In Out",value:"0.770, 0.000, 0.175, 1.000"},{label:"Quart In",value:"0.895, 0.030, 0.685, 0.220"},{label:"Quint Out",value:"0.230, 1.000, 0.320, 1.000"},{label:"Quint In Out",value:"0.860, 0.000, 0.070, 1.000"},{label:"Quint In",value:"0.755, 0.050, 0.855, 0.060"},{label:"Sine Out",value:"0.390, 0.575, 0.565, 1.000"},{label:"Sine In Out",value:"0.445, 0.050, 0.550, 0.950"},{label:"Sine In",value:"0.470, 0.000, 0.745, 0.715"},{label:"Expo Out",value:"0.190, 1.000, 0.220, 1.000"},{label:"Expo In Out",value:"1.000, 0.000, 0.000, 1.000"},{label:"Expo In",value:"0.780, 0.000, 0.810, 0.00"},{label:"Circ Out",value:"0.075, 0.820, 0.165, 1.000"},{label:"Circ In Out",value:"0.785, 0.135, 0.150, 0.860"},{label:"Circ In",value:"0.600, 0.040, 0.980, 0.335"},{label:"Back Out",value:"0.175, 0.885, 0.320, 1.275"},{label:"Back In Out",value:"0.680, -0.550, 0.265, 1.550"},{label:"Back In",value:"0.600, -0.280, 0.735, 0.045"},{label:"linear",value:"0.5, 0.5, 0.5, 0.5"},{label:"In Out",value:"0.42,0,0.58,1"},{label:"Hold",value:"0, 0, Infinity, Infinity"}]}),cc,vI,C8,PG,j0e,H0e,_E,RG,IG,$0e,W0e,tDe=C(()=>{cc=z(nt()),vI=.75,C8=.1,PG=1+vI*2,j0e="#F5F5F5",H0e="#888888",_E="#4f4f4f",RG="rgba(255, 255, 255, 0.1)",IG=a=>1-a,$0e=a=>{let{easing:u,isSelected:d}=a,g=d?j0e:H0e,_="".concat(-vI," ").concat(-vI," ").concat(PG," ").concat(PG);if(u){let T=[u[0],IG(u[1])],N=[u[2],IG(u[3])];return cc.default.createElement("svg",{height:"100%",width:"100%",viewBox:_,fill:"none",xmlns:"http://www.w3.org/2000/svg"},cc.default.createElement("line",{x1:"0",y1:"1",x2:T[0],y2:T[1],stroke:_E,strokeWidth:"0.1"}),cc.default.createElement("line",{x1:"1",y1:"0",x2:N[0],y2:N[1],stroke:_E,strokeWidth:"0.1"}),cc.default.createElement("circle",{cx:T[0],cy:T[1],r:.1,fill:RG}),cc.default.createElement("circle",{cx:N[0],cy:N[1],r:.1,fill:RG}),cc.default.createElement("circle",{cx:T[0],cy:T[1],r:C8,fill:_E}),cc.default.createElement("circle",{cx:N[0],cy:N[1],r:C8,fill:_E}),cc.default.createElement("path",{d:"M0 1 C".concat(T[0]," ").concat(T[1]," ").concat(N[0],` 
        `).concat(N[1]," 1 0"),stroke:g,strokeWidth:"0.08"}),cc.default.createElement("circle",{cx:0,cy:1,r:C8,fill:g}),cc.default.createElement("circle",{cx:1,cy:0,r:C8,fill:g}))}return cc.default.createElement("svg",{height:"100%",width:"100%",viewBox:_,fill:"none",xmlns:"http://www.w3.org/2000/svg"},cc.default.createElement("line",{x1:"0",y1:"1",x2:1,y2:1,stroke:g,strokeWidth:"0.08"}),cc.default.createElement("line",{x1:"1",y1:"0",x2:1,y2:1,stroke:g,strokeWidth:"0.08"}),cc.default.createElement("circle",{cx:0,cy:1,r:C8,fill:g}),cc.default.createElement("circle",{cx:1,cy:0,r:C8,fill:g}))},W0e=$0e}),SE,q0e,X0e,Y0e,K0e,Z0e,Q0e,J0e,nDe=C(()=>{fI(),SE=z(nt()),tn(),G0e(),tDe(),SR(),lI(),Mf(),Y0e=ge.div(X0e||(X0e=H([`
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  aspect-ratio: 1;

  transition: background-color 0.15s;
  background-color: `,`;
  border-radius: 2px;
  cursor: pointer;
  outline: none;

  `,`

  &:hover {
    background-color: #31353a;
  }

  &:focus {
    background-color: #383d42;
  }
`])),G4,({isSelected:a})=>a&&Yd(q0e||(q0e=H([`
      background-color: #383d42;
    `])))),Z0e=ge(Xu)(K0e||(K0e=H([`
  padding: 0.5em;
  color: white;
  max-width: 240px;
  pointer-events: none !important;
  --popover-bg: black;
  --popover-outer-stroke: transparent;
  --popover-inner-stroke: transparent;
  box-shadow: none;
`]))),Q0e=SE.default.forwardRef((a,u)=>{let[d,g]=hI({enabled:!0,verticalPlacement:a.tooltipPlacement,verticalGap:0},()=>SE.default.createElement(Z0e,{showPopoverEdgeTriangle:!1},a.easing.label));return SE.default.createElement(Y0e,P({ref:_R([g,u])},a),d,SE.default.createElement(W0e,{easing:gI(a.easing.value),isSelected:a.isSelected}))}),J0e=Q0e});function rDe(a){var u;let[d,g]=(0,ece.useState)(null),_=N=>{if(d===null){a.items.length>0&&g(0);return}let R=d+N*a.uiColumns,O=R<0,B=R>a.items.length-1;if(O||B){if(a.canVerticleExit&&a.canVerticleExit(O?"top":"bottom")){g(null);return}return}g(R)},T=N=>{d===null?g(aDe(N,a.items.length)):d+N<0?g(null):g(Math.min(d+N,a.items.length-1))};return{focusFirstItem(){g(0)},onParentEltKeyDown:N=>{if(N.key==="ArrowRight")T(1);else if(N.key==="ArrowLeft")T(-1);else if(N.key==="ArrowUp")_(-1);else if(N.key==="ArrowDown")_(1);else return 0;return 1},gridItems:a.items.map((N,R)=>a.renderItem({isSelected:R===d,item:N,select(O){g(R),a.onSelectItem(N)===1&&(O==null||O.preventDefault(),O==null||O.stopPropagation())}})),currentSelection:(u=a.items[d??-1])!=null?u:null}}var ece,iDe=C(()=>{ece=z(nt()),xce()});function tce(a,u,d){var g;(g=a.current)==null||g.discard(),a.current=null;let _=gI(d);_===null?a.current=oDe(u):a.current=sDe(u,_)}function nce(a){var u;(u=a.current)==null||u.discard(),a.current=null}function sDe(a,u){return ce().tempTransaction(({stateEditors:d})=>{let{setHandlesForKeyframe:g,setKeyframeType:_}=d.coreByProject.historic.sheetsById.sequence;for(let{projectId:T,sheetId:N,objectKey:R,trackId:O,left:B,right:V}of a)g({projectId:T,sheetId:N,objectKey:R,trackId:O,keyframeId:B.id,start:[u[0],u[1]]}),g({projectId:T,sheetId:N,objectKey:R,trackId:O,keyframeId:V.id,end:[u[2],u[3]]}),_({projectId:T,sheetId:N,objectKey:R,trackId:O,keyframeId:B.id,keyframeType:"bezier"})})}function oDe(a){return ce().tempTransaction(({stateEditors:u})=>{let{setKeyframeType:d}=u.coreByProject.historic.sheetsById.sequence;for(let{projectId:g,sheetId:_,objectKey:T,trackId:N,left:R}of a)d({projectId:g,sheetId:_,objectKey:T,trackId:N,keyframeId:R.id,keyframeType:"hold"})})}function aDe(a,u){return(a%u+u)%u}function lDe(a,u){return()=>setTimeout(a,u)}function cDe({left:a,right:u}){return({left:d,right:g})=>a.handles[2]!==d.handles[2]||a.handles[3]!==d.handles[3]||u.handles[0]!==g.handles[0]||u.handles[1]!==g.handles[1]}var xI,To,rce,kG,DG,ice,sce,oce,ace,lce,cce,uce,dce,hce,pce,fce,mce,gce,uDe,yce,vce,xce=C(()=>{xI=un(),To=z(nt()),tn(),rce=z(Kke()),Pe(),Jke(),nDe(),G0e(),lI(),ls(),iDe(),kG=3,DG=53,ice=25,oce=ge.div(sce||(sce=H([`
  background: `,`;
  display: grid;
  grid-template-areas:
    'search  tween'
    'presets tween';
  grid-template-rows: 32px 1fr;
  grid-template-columns: `,`px 120px;
  gap: 1px;
  height: 120px;
`])),MG,kG*DG),lce=ge.div(ace||(ace=H([`
  overflow: auto;
  grid-area: presets;

  display: grid;
  grid-template-columns: repeat(`,`, 1fr);
  grid-auto-rows: min-content;
  gap: 1px;

  overflow-y: scroll;
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* Internet Explorer 10+ */
  &::-webkit-scrollbar {
    /* WebKit */
    width: 0;
    height: 0;
  }
`])),kG),uce=ge.input.attrs({type:"text"})(cce||(cce=H([`
  background-color: `,`;
  border: none;
  border-radius: 2px;
  color: rgba(255, 255, 255, 0.8);
  padding: 6px;
  font-size: 12px;
  outline: none;
  cursor: text;
  text-align: left;
  width: 100%;
  height: 100%;
  box-sizing: border-box;

  grid-area: search;

  &:hover {
    background-color: #212121;
  }

  &:focus {
    background-color: rgba(16, 16, 16, 0.26);
    outline: 1px solid rgba(0, 0, 0, 0.35);
  }
`])),G4),hce=ge.div(dce||(dce=H([`
  grid-area: tween;
  background: `,`;
`])),G4),fce=ge.div(pce||(pce=H([`
  grid-column: 1 / 4;
  padding: 6px;
  color: #888888;
`]))),mce=a=>{let u=(0,To.useMemo)(()=>[a.curveConnection,...a.additionalConnections],[a.curveConnection,...a.additionalConnections]),d=(0,To.useRef)(null);(0,To.useEffect)(()=>{let He=vce(u);return()=>{var Bt;He(),(Bt=d.current)==null||Bt.commit()}},[d]);let g=[a.curveConnection.left.handles[2],a.curveConnection.left.handles[3],a.curveConnection.right.handles[0],a.curveConnection.right.handles[1]],_=(0,To.useRef)(null);(0,To.useLayoutEffect)(()=>{var He,Bt;(He=_.current)==null||He.select(),(Bt=_.current)==null||Bt.focus()},[_.current]);let[T,N]=(0,To.useState)(mI(g)),R=He=>{He!==void 0&&(V(1),N(He.target.value),gI(He.target.value)&&W(He.target.value))},O=He=>{var Bt,Qe;V(1),(He.key==="ArrowDown"||He.key==="ArrowUp")&&He.preventDefault(),He.key==="ArrowDown"?(Je.focusFirstItem(),(Qe=(Bt=we.current[ae[0].label])==null?void 0:Bt.current)==null||Qe.focus()):He.key==="Escape"?(nce(d),a.onRequestClose("key Escape")):He.key==="Enter"&&a.onRequestClose("key Enter")},[B,V]=(0,To.useState)(0);(0,To.useEffect)(()=>{B===2?N(mI(g)):B===3&&T!==""&&N("")},u);let[Y,W]=(0,To.useState)(mI(g)),[$,K]=(0,To.useState)(null);(0,To.useEffect)(()=>{var He;B!==0&&B!==3&&tce(d,u,(He=$??Y)!=null?He:"")},[$,Y,B]),u.some(cDe(a.curveConnection))&&B===0&&V(3);let J=He=>{var Bt,Qe;V(2);let Zt=mI(He);N(Zt),W(Zt),(Bt=_.current)==null||Bt.select(),(Qe=_.current)==null||Qe.focus()},oe=()=>{},ae=(0,To.useMemo)(()=>/^[A-Za-z]/.test(T)?rce.default.filter(T,yI,{extract:He=>He.label}).map(He=>He.original):yI,[T]);(0,To.useEffect)(()=>{B===1&&ae[0]&&W(ae[0].value)},[ae]);let ue=He=>{He.key==="Escape"?(nce(d),a.onRequestClose("key Escape"),He.stopPropagation()):He.key==="Enter"&&(a.onRequestClose("key Enter"),He.stopPropagation())},xe=He=>{B===0&&V(2),K(He.value)},Re=()=>K(null),Ae=He=>(tce(d,u,He.value),a.onRequestClose("selected easing option"),1),we=(0,To.useRef)(yI.reduce((He,Bt)=>(He[Bt.label]={current:null},He),{})),[ft,Le]=Ni(null),[Se,Ge]=(0,To.useState)(0);(0,To.useEffect)(()=>{let He=()=>{var Bt;Ge((Bt=Le==null?void 0:Le.scrollTop)!=null?Bt:0)};return Le==null||Le.addEventListener("scroll",He),()=>Le==null?void 0:Le.removeEventListener("scroll",He)},[Le]);let Je=rDe({items:ae,uiColumns:3,onSelectItem:Ae,canVerticleExit(He){var Bt,Qe;return He==="top"?((Bt=_.current)==null||Bt.select(),(Qe=_.current)==null||Qe.focus(),1):0},renderItem:({item:He,select:Bt})=>{var Qe,Zt;return To.default.createElement(J0e,{key:He.label,easing:He,tabIndex:0,onKeyDown:ue,ref:we.current[He.label],onMouseOver:()=>xe(He),onMouseOut:Re,onClick:Bt,tooltipPlacement:((Zt=(Qe=we.current[He.label].current)==null?void 0:Qe.offsetTop)!=null?Zt:0)-(Se??0)<DG+ice?"bottom":"top",isSelected:eDe(g,gI(He.value))})}});return(0,To.useLayoutEffect)(()=>{var He,Bt;if(Je.currentSelection!==null&&document.activeElement!==_.current){let Qe=(Bt=(He=we.current)==null?void 0:He[Je.currentSelection.label])==null?void 0:Bt.current;Qe==null||Qe.focus(),W(Je.currentSelection.value),/^[A-Za-z]/.test(T)||N(Je.currentSelection.value)}},[Je.currentSelection]),To.default.createElement(oce,null,To.default.createElement(uce,{value:T,placeholder:B===3?"Multiple easings selected":"Search presets...",onPaste:lDe(R),onChange:R,ref:_,onKeyDown:O}),To.default.createElement(lce,{ref:ft,onKeyDown:He=>Je.onParentEltKeyDown(He)},Je.gridItems,Je.gridItems.length===0?To.default.createElement(fce,null,"No results found"):void 0),To.default.createElement(hce,{onClick:()=>{var He;return(He=_.current)==null?void 0:He.focus()}},To.default.createElement(R0e,{curveConnection:a.curveConnection,backgroundConnections:a.additionalConnections,onCurveChange:J,onCancelCurveChange:oe})))},gce=mce,{isCurveEditorOpenD:uDe,isConnectionEditingInCurvePopover:yce,getLock:vce}=(()=>{let a=new xI.Atom([]);return{getLock(u){return a.set(u),function(){a.set([])}},isCurveEditorOpenD:(0,xI.prism)(()=>a.prism.getValue().length>0),isConnectionEditingInCurvePopover(u){return xI.prism.ensurePrism(),a.prism.getValue().some(({left:d,right:g})=>u.left.id===d.id&&u.right.id===g.id)}}})()});function dDe(a,u){for(let{keyframeId:d}of mDe(u))if(a.left.id===d)return!0;return!1}function hDe(a,u,d){return(0,bI.prism)(()=>{if(d===void 0)return[];let g=[];for(let{objectKey:_,trackId:T}of Sce(d)){let N=(0,bI.val)(ce().atomP.historic.coreByProject[a].sheetsById[u].sequence.tracksByObject[_].trackData[T]);N&&(g=g.concat(fDe(N.keyframes).filter(R=>dDe(R,d)).map(({left:R,right:O})=>({left:R,right:O,trackId:T,objectKey:_,sheetId:u,projectId:a}))))}return g})}function bce(a,u,d){var g;if(d===void 0)return[];let _=[];for(let{objectKey:N,trackId:R,keyframeIds:O}of Sce(d))_=_.concat((g=_ce({projectId:a,sheetId:u,objectKey:N,trackId:R,keyframeIds:O}))!=null?g:[]);let T=oG(_.map(N=>N.pathToProp));return _.map(({keyframe:N,pathToProp:R})=>({keyframe:N,pathToProp:R.slice(T.length)}))}function _ce({projectId:a,sheetId:u,objectKey:d,trackId:g,keyframeIds:_}){let T=(0,bI.val)(ce().atomP.historic.coreByProject[a].sheetsById[u].sequence.tracksByObject[d]),N=T==null?void 0:T.trackData[g];if(!N)return null;let R=pDe((T==null?void 0:T.trackIdByPropPath)||{})[g];if(!R)return null;let O=[d,...aG(R)];return _.map(B=>({keyframe:N.keyframes.find(V=>V.id===B),pathToProp:O})).filter(({keyframe:B})=>B!==void 0)}function pDe(a){let u={};for(let[d,g]of Object.entries(a))u[g]=d;return u}function fDe(a){return a.map((u,d)=>({left:u,right:a[d+1]})).slice(0,-1)}function mDe(a){var u,d,g;let _=[];for(let[T,N]of Object.entries((u=a==null?void 0:a.byObjectKey)!=null?u:{}))for(let[R,O]of Object.entries((d=N==null?void 0:N.byTrackId)!=null?d:{}))for(let B of Object.keys((g=O==null?void 0:O.byKeyframeId)!=null?g:{}))_.push({objectKey:T,trackId:R,keyframeId:B});return _}function Sce(a){var u,d,g;let _=[];for(let[T,N]of Object.entries((u=a==null?void 0:a.byObjectKey)!=null?u:{}))for(let[R,O]of Object.entries((d=N==null?void 0:N.byTrackId)!=null?d:{}))_.push({objectKey:T,trackId:R,keyframeIds:Object.keys((g=O==null?void 0:O.byKeyframeId)!=null?g:{})});return _}var bI,_I=C(()=>{bI=un(),Pe(),V4()});function gDe(a,u){return(0,wce.useMemo)(()=>yDe(a,u),[])}function yDe(a,u){let d=null,g=N=>ce().tempTransaction(R=>a(R,N));function _(){d==null||d.discard(),d=null}let T={createAsset:u.sheet.project.assetStorage.createAsset,getAssetUrl:N=>N.id?u.sheet.project.assetStorage.getAssetUrl(N.id):void 0};return P({temporarilySetValue(N){_(),d=g(N)},discardTemporaryValue:_,permanentlySetValue(N){_(),g(N).commit()}},T)}var wce,vDe=C(()=>{Pe(),wce=z(nt())});function OG(a){var u;if(a.type==="sheetObject")return S0.default.createElement(S0.default.Fragment,null,S0.default.createElement(SI,{style:{paddingLeft:"".concat(a.indent*wI,"px")}},a.sheetObject.address.objectKey),a.children.map((d,g)=>S0.default.createElement(OG,U(P({key:g},d),{autoFocusInput:a.autoFocusInput&&g===0,indent:a.indent+1}))));if(a.type==="propWithChildren"){let d=(u=a.propConfig.label)!=null?u:j2(a.pathToProp);return S0.default.createElement(S0.default.Fragment,null,S0.default.createElement(SI,{style:{paddingLeft:"".concat(a.indent*wI,"px")}},d),a.children.map((g,_)=>S0.default.createElement(OG,U(P({key:_},g),{autoFocusInput:a.autoFocusInput&&_===0,indent:a.indent+1}))))}else return S0.default.createElement(xDe,U(P({},a),{autoFocusInput:a.autoFocusInput,indent:a.indent}))}function xDe(a){var u;let d=(u=a.propConfig.label)!=null?u:j2(a.pathToProp),g=bDe(a);if(a.propConfig.type==="enum")return S0.default.createElement(S0.default.Fragment,null);{let _=qV[a.propConfig.type];return S0.default.createElement(Ece,null,S0.default.createElement(SI,null,S0.default.createElement("span",{style:{paddingLeft:"".concat(a.indent*wI,"px")}},d)),S0.default.createElement(Ace,null,S0.default.createElement(_,{editingTools:g,propConfig:a.propConfig,value:BR(a.keyframe.value,a.propConfig),autoFocus:a.autoFocusInput})))}}function bDe(a){let u=a.sheetObject;return gDe(({stateEditors:d},g)=>{let _=U(P({},a.keyframe),{value:g});d.coreByProject.historic.sheetsById.sequence.replaceKeyframes(U(P({},u.address),{trackId:a.trackId,keyframes:[_],snappingFunction:u.sheet.getSequence().closestGridPosition}))},u)}var S0,Tce,Ece,Mce,SI,wI,Cce,Ace,_De=C(()=>{S0=z(nt()),tn(),Eae(),I4(),vDe(),B4(),Ece=ge.div(Tce||(Tce=H([`
  display: flex;
  align-items: stretch;
  min-width: 200px;

  select {
    min-width: 100px;
  }
`]))),SI=ge.div(Mce||(Mce=H([`
  font-style: normal;
  font-weight: 400;
  font-size: 11px;
  line-height: 13px;
  letter-spacing: 0.01em;
  padding: 6px 6px 6px 0;

  width: 40%;

  color: #919191;

  overflow: hidden;
`]))),wI=10,Ace=ge.div(Cce||(Cce=H([`
  display: flex;
  align-items: center;
  width: 60%;
`])))});function LG(a){return qu({debugName:"useKeyframeInlineEditorPopover"},()=>TI.default.createElement(Xu,{showPopoverEdgeTriangle:!0},TI.default.createElement("div",{style:{margin:"1px 2px 1px 10px"}},Array.isArray(a)?a.map((u,d)=>TI.default.createElement(OG,U(P({key:d},u),{autoFocusInput:d===0,indent:0}))):void 0)))}var TI,FG=C(()=>{TI=z(nt()),Ef(),Mf(),_De()});function SDe(a,u,d){return oc(a,{displayName:"Keyframe",menuItems:()=>{let g=bce(d.leaf.sheetObject.address.projectId,d.leaf.sheetObject.address.sheetId,d.selection);return[{label:g.length>0?"Copy (selection)":"Copy",callback:()=>{g.length>0?ce().transaction(_=>{_.stateEditors.studio.ahistoric.setClipboardKeyframes(g)}):ce().transaction(_=>{_.stateEditors.studio.ahistoric.setClipboardKeyframes([{keyframe:d.keyframe,pathToProp:d.leaf.pathToProp}])})}},{label:d.selection!==void 0?"Delete (selection)":"Delete",callback:()=>{d.selection?d.selection.delete():ce().transaction(({stateEditors:_})=>{_.coreByProject.historic.sheetsById.sequence.deleteKeyframes(U(P({},d.leaf.sheetObject.address),{keyframeIds:[d.keyframe.id],trackId:d.leaf.trackId}))})}}]},onOpen(){u._debug("Show keyframe",d)}})}function wDe(a,u,d){let g=(0,j4.useRef)(u);g.current=u;let{onClickFromDrag:_}=d,T=(0,j4.useMemo)(()=>({debugName:"KeyframeDot/useDragKeyframe",onDragStart(R){let O=g.current,B=(0,EI.val)(ce().atomP.historic.coreByProject[O.leaf.sheetObject.address.projectId].sheetsById[O.leaf.sheetObject.address.sheetId].sequence.tracksByObject),V=$ke(B,function(K,{trackId:J,objectKey:oe}){var ae,ue;return K.id!==O.keyframe.id&&!(O.selection&&(ue=(ae=O.selection.byObjectKey[oe])==null?void 0:ae.byTrackId[J])!=null&&ue.byKeyframeId[K.id])});if(Hke(V),O.selection){let{selection:K,leaf:J}=O,{sheetObject:oe}=J,ae=K.getDragHandlers(U(P({},oe.address),{domNode:a,positionAtStartOfDrag:O.track.data.keyframes[O.index].position})).onDragStart(R);return ae&&U(P({},ae),{onClick:_,onDragEnd:(...ue)=>{var xe;(xe=ae.onDragEnd)==null||xe.call(ae,...ue),gb()}})}let Y=O,W=(0,EI.val)(Y.layoutP.scaledSpace.toUnitSpace),$;return{onDrag(K,J,oe){var ae;let ue=Y.track.data.keyframes[Y.index],xe=Math.max((ae=lc.checkIfMouseEventSnapToPos(oe,{ignore:a}))!=null?ae:ue.position+W(K),0);$==null||$.discard(),$=void 0,$=ce().tempTransaction(({stateEditors:Re})=>{Re.coreByProject.historic.sheetsById.sequence.replaceKeyframes(U(P({},Y.leaf.sheetObject.address),{trackId:Y.leaf.trackId,keyframes:[U(P({},ue),{position:xe})],snappingFunction:(0,EI.val)(Y.layoutP.sheet).getSequence().closestGridPosition}))})},onDragEnd(K){K?$==null||$.commit():$==null||$.discard(),gb()},onClick(K){_(K)}}}}),[_]),[N]=wo(a,T);return N1(N,u.keyframe.position),Wu(N,"draggingPositionInSequenceEditor","ew-resize"),[N]}var j4,EI,wE,BG,TE,UG,Nce,MI,Pce,Rce,Ice,kce,Dce,Oce,Lce=C(()=>{j4=z(nt()),tn(),Pe(),ac(),va(),ls(),EI=un(),fl(),rc(),Rf(),eI(),x8(),_I(),ms(),yb(),FG(),dE(),wE=6,BG=wE+2,TE={normalColor:"#40AAA4",selectedColor:"#F2C95C",inlineEditorOpenColor:"#FCF3DC",selectedAndInlineEditorOpenColor:"#CBEBEA"},UG=({isSelected:a,isInlineEditorPopoverOpen:u})=>a&&u?TE.inlineEditorOpenColor:a?TE.selectedColor:u?TE.selectedAndInlineEditorOpenColor:TE.normalColor,MI=ge.div(Nce||(Nce=H([`
  position: absolute;
  `,`

  background: `,`;
  transform: rotateZ(45deg);

  `,`;

  z-index: 1;
  pointer-events: none;
`])),If(wE),a=>UG(a),a=>a.flag===2?"outline: 2px solid white;":""),Rce=ge.div(Pce||(Pce=H([`
  position: absolute;
  `,`

  background: `,`;

  `,`;

  z-index: 1;
  pointer-events: none;
`])),If(wE*1.5),a=>UG(a),a=>a.flag===2?"outline: 2px solid white;":""),kce=ge.div(Ice||(Ice=H([`
  z-index: 1;
  cursor: ew-resize;

  position: absolute;
  `,`;
  `,`;

  & + `,` {
    `,`
  }

  &:hover + `,` {
    `,`
  }
`])),If(12),Zi,MI,a=>a.isInlineEditorPopoverOpen?If(BG):"",MI,If(BG)),Dce=a=>{let u=Q7("SingleKeyframeDot",a.keyframe.id),d=db(a.itemKey),[g,_]=Ni(null),[T]=SDe(_,u,a),{node:N,toggle:R,isOpen:O}=LG([{type:"primitiveProp",keyframe:a.keyframe,pathToProp:a.leaf.pathToProp,propConfig:a.leaf.propConf,sheetObject:a.leaf.sheetObject,trackId:a.leaf.trackId}]);wDe(_,a,{onClickFromDrag(V){R(V,g.current)}});let B=!a.keyframe.type||a.keyframe.type==="bezier";return j4.default.createElement(j4.default.Fragment,null,j4.default.createElement(kce,P({ref:g,isInlineEditorPopoverOpen:O},d.attrs)),B?j4.default.createElement(MI,{isSelected:!!a.selection,isInlineEditorPopoverOpen:O,flag:d.flag}):j4.default.createElement(Rce,{isSelected:!!a.selection,isInlineEditorPopoverOpen:O,flag:d.flag}),N,T)},Oce=Dce}),zG,VG,GG,A8,Fce,Bce,Uce,TDe=C(()=>{vf(),zG=z(nt()),tn(),Lce(),VG=wE/2+1,GG=1e3,A8={normalColor:"#365b59",selectedColor:"#8A7842",barColor:a=>{let u=a.isSelected?A8.selectedColor:A8.normalColor;return a.isPopoverOpen?QP(.2,B7(.2,u)):u},hoverColor:a=>{let u=a.isSelected?A8.selectedColor:A8.normalColor;return a.isPopoverOpen?QP(.2,B7(.2,u)):QP(.1,B7(.1,u))}},Bce=ge.div(Fce||(Fce=H([`
  position: absolute;
  background: `,`;
  height: `,`px;
  width: `,`px;

  left: 0;
  top: -`,`px;
  transform-origin: top left;
  z-index: 0;
  cursor: ew-resize;

  &:after {
    display: block;
    position: absolute;
    content: ' ';
    top: -4px;
    bottom: -4px;
    left: 0;
    right: 0;
  }

  &:hover {
    background: `,`;
  }
`])),A8.barColor,VG,GG,VG/2,A8.hoverColor),Uce=zG.default.forwardRef((a,u)=>{let d={isPopoverOpen:a.isPopoverOpen,isSelected:a.isSelected};return zG.default.createElement(Bce,U(P({},d),{ref:u,style:{transform:"scaleX(calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(a.connectorLengthInUnitSpace/GG,"))")},onClick:g=>{var _;(_=a.openPopover)==null||_.call(a,g)}}),a.children)})});function EDe(a,u){let d=(0,jG.useRef)(u);d.current=u;let g=(0,jG.useMemo)(()=>({debugName:"useDragKeyframe",lockCSSCursorTo:"ew-resize",onDragStart(_){let T=d.current,N;if(T.selection){let{selection:V,leaf:Y}=T,{sheetObject:W}=Y;return V.getDragHandlers(U(P({},W.address),{domNode:a,positionAtStartOfDrag:T.track.data.keyframes[T.index].position})).onDragStart(_)}let R=T,O=(0,CI.val)(R.layoutP.sheet).getSequence(),B=(0,CI.val)(R.layoutP.scaledSpace.toUnitSpace);return{onDrag(V,Y,W){let $=B(V);N&&(N.discard(),N=void 0),N=ce().tempTransaction(({stateEditors:K})=>{K.coreByProject.historic.sheetsById.sequence.transformKeyframes(U(P({},R.leaf.sheetObject.address),{trackId:R.leaf.trackId,keyframeIds:[R.keyframe.id,R.track.data.keyframes[R.index+1].id],translate:$,scale:1,origin:0,snappingFunction:O.closestGridPosition}))})},onDragEnd(V){V?N&&N.commit():N&&N.discard()}}}}),[]);wo(a,g)}function MDe(a,u,d,g){return oc(u,{displayName:"Tween",menuItems:()=>{let _=bce(a.leaf.sheetObject.address.projectId,a.leaf.sheetObject.address.sheetId,a.selection);return[{label:_.length>0?"Copy (selection)":"Copy",callback:()=>{_.length>0?ce().transaction(T=>{T.stateEditors.studio.ahistoric.setClipboardKeyframes(_)}):ce().transaction(T=>{T.stateEditors.studio.ahistoric.setClipboardKeyframes([{keyframe:d,pathToProp:a.leaf.pathToProp},{keyframe:g,pathToProp:a.leaf.pathToProp}])})}},{label:a.selection?"Delete (selection)":"Delete",callback:()=>{a.selection?a.selection.delete():ce().transaction(({stateEditors:T})=>{T.coreByProject.historic.sheetsById.sequence.deleteKeyframes(U(P({},a.leaf.sheetObject.address),{keyframeIds:[d.id,g.id],trackId:a.leaf.trackId}))})}}]}})}var CI,H4,jG,HG,zce,Vce,Gce,jce,Hce,CDe=C(()=>{Pe(),ac(),va(),ls(),CI=un(),H4=z(nt()),jG=z(nt()),Ef(),Mf(),xce(),TDe(),lI(),Ar(),_I(),_I(),tn(),HG=5,Vce=ge(Xu)(zce||(zce=H([`
  --popover-outer-stroke: transparent;
  --popover-inner-stroke: `,`;
`])),MG),Gce=a=>{let{index:u,track:d}=a,g=d.data.keyframes[u],_=d.data.keyframes[u+1],[T,N]=Ni(null),{node:R,toggle:O,close:B}=qu(()=>{let $=(0,CI.val)(a.layoutP.rightDims);return{debugName:"Connector",constraints:{minX:$.screenX+HG,maxX:$.screenX+$.width-HG}}},()=>H4.default.createElement(Hce,U(P({},a),{closePopover:B}))),[V]=MDe(a,N,g,_);EDe(N,a);let Y=_.position-g.position,W={isPopoverOpen:di(()=>yce(U(P({},a.leaf.sheetObject.address),{trackId:a.leaf.trackId,left:g,right:_})),[a.leaf.sheetObject.address,a.leaf.trackId,g,_]),isSelected:a.selection!==void 0};return H4.default.createElement(H4.default.Fragment,null,H4.default.createElement(Uce,U(P({ref:T,connectorLengthInUnitSpace:Y},W),{openPopover:$=>{N&&O($,N)}}),R),V)},jce=Gce,Hce=H4.default.forwardRef((a,u)=>{let{index:d,track:{data:g},selection:_}=a,T=g.keyframes[d],N=g.keyframes[d+1],R=a.leaf.trackId,O=a.leaf.sheetObject.address;if(!R)return null;let B=di(()=>hDe(O.projectId,O.sheetId,_).getValue(),[O,_]),V=P({left:T,right:N,trackId:R},O);return H4.default.createElement(Vce,{showPopoverEdgeTriangle:!1,ref:u},H4.default.createElement(gce,{curveConnection:V,additionalConnections:B,onRequestClose:a.closePopover}))})}),$ce,N8,Wce,qce,Xce,Yce,Kce,ADe=C(()=>{$ce=un(),N8=z(nt()),tn(),CDe(),Lce(),qce=ge.div(Wce||(Wce=H([`
  position: absolute;
`]))),Xce=N8.default.createElement(N8.default.Fragment,null),Yce=N8.default.memo(a=>{let{index:u,track:{data:d}}=a,g=d.keyframes[u],_=d.keyframes[u+1],T=g.connectedRight&&!!_;return N8.default.createElement(qce,{style:{top:"".concat(a.leaf.nodeHeight/2,"px"),left:"calc(".concat((0,$ce.val)(a.layoutP.scaledSpace.leftPadding),"px + calc(var(--unitSpaceToScaledSpaceMultiplier) * ").concat(g.position,"px))")}},N8.default.createElement(Oce,U(P({},a),{itemKey:a.itemKey})),T?N8.default.createElement(jce,P({},a)):Xce)}),Kce=Yce});function NDe(a,u){return oc(a,{displayName:"Keyframe Track",menuItems:()=>{var d;let g=(d=(0,bb.val)(ce().atomP.ahistoric.clipboard.keyframesWithRelativePaths))!=null?d:[];return[PDe(u,g)]}})}function PDe(a,u){return{label:"Paste Keyframes",enabled:u.length>0,callback:()=>{var d;let g=(0,bb.val)(a.layoutP.sheet).getSequence(),_=(d=u[0])==null?void 0:d.pathToProp,T=u.filter(({keyframe:N,pathToProp:R})=>Ike(_,R)).map(({keyframe:N,pathToProp:R})=>N);ce().transaction(({stateEditors:N})=>{var R;g.position=g.closestGridPosition(g.position);let O=(R=RDe(T))==null?void 0:R.position;for(let B of T)a.leaf.trackId&&N.coreByProject.historic.sheetsById.sequence.setKeyframeAtPosition(U(P({},a.leaf.sheetObject.address),{trackId:a.leaf.trackId,position:g.position+B.position-O,handles:B.handles,value:B.value,snappingFunction:g.closestGridPosition,type:B.type}))})}}}function RDe(a){let u=null;for(let d of a)(u===null||d.position<u.position)&&(u=d);return u}var bb,i3,Zce,Qce,$G,Jce,IDe=C(()=>{Ar(),bb=un(),i3=z(nt()),tn(),ADe(),ac(),ls(),Pe(),V4(),yb(),wf(),Qce=ge.div(Zce||(Zce=H([`
  position: relative;
  height: 100%;
  width: 100%;
`]))),$G=i3.default.memo(a=>{var u;let{layoutP:d,trackData:g,leaf:_}=a,[T,N]=Ni(null),{selectedKeyframeIds:R,selection:O}=di(()=>{if(!_.trackId)return{selectedKeyframeIds:void 0,selection:void 0};let xe=(0,bb.val)(d.selectionAtom),Re=(0,bb.val)(xe.pointer.current);if(!Re)return{selectedKeyframeIds:void 0,selection:void 0};let Ae=(0,bb.val)(xe.pointer.current.byObjectKey[_.sheetObject.address.objectKey].byTrackId[_.trackId].byKeyframeId);return Ae?{selectedKeyframeIds:Ae,selection:Re}:{selectedKeyframeIds:void 0,selection:void 0}},[d,_.trackId]),[B,V,Y]=NDe(N,a),W=ti(l0e),$=W.mode==="snapToSome"&&_.trackId?(u=W.positions[_.sheetObject.address.objectKey])==null?void 0:u[_.trackId]:[],K=W.mode==="snapToAll";if(!_.trackId)return null;let J=(0,i3.useMemo)(()=>({data:g,id:_.trackId,sheetObject:a.leaf.sheetObject}),[g,_.trackId]),oe=g.keyframes.map((xe,Re)=>i3.default.createElement(Kce,{key:"keyframe-"+xe.id,itemKey:jl.forTrackKeyframe(_.sheetObject,_.trackId,xe.id),keyframe:xe,index:Re,track:J,layoutP:d,leaf:_,selection:(R==null?void 0:R[xe.id])===!0?O:void 0})),ae=$.map(xe=>i3.default.createElement(wG,{key:"snap-target-"+xe,layoutP:d,leaf:_,position:xe})),ue=K?g.keyframes.map(xe=>i3.default.createElement(wG,{key:"additionalSnapTarget-".concat(xe.id),layoutP:d,leaf:_,position:xe.position})):null;return i3.default.createElement(Qce,{ref:T,style:{background:Y?"#444850 ":"unset"}},oe,ae,i3.default.createElement(i3.default.Fragment,null,ue),B)}),$G.displayName="BasicKeyframedTrack",Jce=$G}),eue,P8,tue,nue,kDe=C(()=>{Pe(),Ar(),eue=un(),P8=z(nt()),oI(),IDe(),x8(),tue=({leaf:a,layoutP:u})=>{let d=Q7("PrimitivePropRow",a.pathToProp.join());return di(()=>{let{sheetObject:g}=a,{trackId:_}=a;if(!_)return P8.default.createElement(E8,{leaf:a,isCollapsed:!1,node:P8.default.createElement("div",null)});let T=(0,eue.val)(ce().atomP.historic.coreByProject[g.address.projectId].sheetsById[g.address.sheetId].sequence.tracksByObject[g.address.objectKey].trackData[_]);return(T==null?void 0:T.type)!=="BasicKeyframedTrack"?(d.errorDev("trackData type ".concat(T==null?void 0:T.type," is not yet supported on the sequence editor")),P8.default.createElement(E8,{leaf:a,isCollapsed:!1,node:P8.default.createElement("div",null)})):P8.default.createElement(E8,{leaf:a,isCollapsed:!1,node:P8.default.createElement(Jce,{layoutP:u,trackData:T,leaf:a})})},[a,u])},nue=tue});function rue(){let a=Math.random()*360,u=.7+Math.random()*.3,d=.55+Math.random()*.2,g=u*Math.min(d,1-d),_=T=>{let N=(T+a/30)%12,R=d-g*Math.max(Math.min(N-3,9-N,1),-1);return Math.round(255*R).toString(16).padStart(2,"0")};return"#".concat(_(0)).concat(_(8)).concat(_(4))}var iue=C(()=>{});function sue(a,u,d){let g=(0,EE.val)(u.sheet).getSequence();a.type==="sheet"?DDe(a,d,g):ODe(a,d,g)}function DDe(a,u,d){var g,_;let{projectId:T,sheetId:N}=a.sheet.address,R=u.every(({pathToProp:V})=>V.length===0),O=[],B=new Map;for(let V of a.children)V.type==="sheetObject"&&B.set(V.sheetObject.address.objectKey,V.sheetObject);if(R)for(let V of a.children.filter(Y=>Y.type==="sheetObject").map(Y=>Y.sheetObject)){let Y=(0,EE.pointerToPrism)(ce().atomP.historic.coreByProject[T].sheetsById[N].sequence.tracksByObject[V.address.objectKey]).getValue(),W=Object.keys((g=Y==null?void 0:Y.trackData)!=null?g:{});for(let $ of W)for(let{keyframe:K}of u)O.push({keyframe:K,trackId:$,address:U(P({},V.address),{pathToProp:[]}),sheetObject:V})}else{let V=(0,EE.pointerToPrism)(ce().atomP.historic.coreByProject[T].sheetsById[N].sequence.tracksByObject).getValue();for(let{keyframe:Y,pathToProp:W}of u){if(W.length===0)continue;let $=W[0],K=W.slice(1),J=B.get($);if(!J)continue;let oe=V==null?void 0:V[$],ae=Pf(K),ue=(_=oe==null?void 0:oe.trackIdByPropPath)==null?void 0:_[ae];O.push({keyframe:Y,trackId:ue,address:U(P({},J.address),{pathToProp:K}),sheetObject:J})}}oue(O,d)}function ODe(a,u,d){var g,_;let{projectId:T,sheetId:N,objectKey:R}=a.sheetObject.address,O=a.sheetObject,B=(0,EE.pointerToPrism)(ce().atomP.historic.coreByProject[T].sheetsById[N].sequence.tracksByObject[R]).getValue(),V=u.every(({pathToProp:W})=>W.length===0),Y=[];if(V)if(a.type==="sheetObject"){let W=Object.keys((g=B==null?void 0:B.trackData)!=null?g:{});for(let $ of W)for(let{keyframe:K}of u)Y.push({keyframe:K,trackId:$,address:U(P({},O.address),{pathToProp:[]}),sheetObject:O})}else{let W=a.pathToProp,$=cb(O.template.staticConfig,W);if($)for(let{path:K,conf:J}of ub($,W)){if(A1(J))continue;let oe=K,ae=Pf(oe),ue=(_=B==null?void 0:B.trackIdByPropPath)==null?void 0:_[ae];for(let{keyframe:xe}of u)Y.push({keyframe:xe,trackId:ue,address:U(P({},O.address),{pathToProp:oe}),sheetObject:O})}}else{let W=(B==null?void 0:B.trackIdByPropPath)||{},$=a.type==="propWithChildren"?a.pathToProp:[];for(let{keyframe:K,pathToProp:J}of u){let oe=[...$,...J],ae=Pf(oe),ue=W[ae];Y.push({keyframe:K,trackId:ue,address:U(P({},O.address),{pathToProp:oe}),sheetObject:O})}}oue(Y,d)}function oue(a,u){var d;if(a.length===0)return;u.position=u.closestGridPosition(u.position);let g=(d=LDe(a.map(({keyframe:_})=>_)))==null?void 0:d.position;ce().transaction(({stateEditors:_,drafts:T})=>{var N,R,O;for(let B of a){let{keyframe:V,address:Y,sheetObject:W}=B,$=B.trackId;if(!$){let K=cb(W.template.staticConfig,Y.pathToProp);if(K&&!A1(K)){_.coreByProject.historic.sheetsById.sequence.setPrimitivePropAsSequenced(Y,K);let J=(O=(R=(N=T.historic.coreByProject[Y.projectId])==null?void 0:N.sheetsById[Y.sheetId])==null?void 0:R.sequence)==null?void 0:O.tracksByObject[Y.objectKey];if(J){let oe=Pf(Y.pathToProp);$=J.trackIdByPropPath[oe]}}}$&&_.coreByProject.historic.sheetsById.sequence.setKeyframeAtPosition(U(P({},Y),{trackId:$,position:u.position+V.position-g,handles:V.handles,value:V.value,snappingFunction:u.closestGridPosition,type:V.type}))}})}function LDe(a){let u=null;for(let d of a)(u===null||d.position<u.position)&&(u=d);return u}function aue(a,u){let d=Array.from(u.byPosition.keys());if(d.length===0)return;let g={first:Math.min(...d),last:Math.max(...d)},_=u.tracks.flatMap(O=>{var B;return(B=_ce(U(P({},O.sheetObject.address),{trackId:O.id,keyframeIds:O.data.keyframes.filter(V=>V.position>=g.first&&V.position<=g.last).map(V=>V.id)})))!=null?B:[]}),T=a.type==="sheet"?[]:a.type==="sheetObject"?[a.sheetObject.address.objectKey]:a.type==="propWithChildren"?[a.sheetObject.address.objectKey,...a.pathToProp]:[],N=oG([T,..._.map(O=>O.pathToProp)]),R=_.map(({keyframe:O,pathToProp:B})=>({keyframe:O,pathToProp:B.slice(N.length)}));ce().transaction(O=>{O.stateEditors.studio.ahistoric.setClipboardKeyframes(R)})}var EE,lue=C(()=>{EE=un(),Pe(),_I(),V4(),B4()});function FDe(a){if(!a)return null;let u=a.closest("[data-handle]");return u&&u.getAttribute("data-handle")||null}function cue(a){if(a.type==="sheet")return"theatre-agg-keyframe-color-sheet-".concat(a.sheet.address.sheetId);if(a.type==="sheetObject")return"theatre-agg-keyframe-color-object-".concat(a.sheetObject.address.objectKey);{let u=a.pathToProp.join(".");return"theatre-agg-keyframe-color-prop-".concat(a.sheetObject.address.objectKey,"-").concat(u)}}function BDe(a){let u=cue(a),d=localStorage.getItem(u);if(d)return d;let g=rue();return localStorage.setItem(u,g),g}function uue(a,u){let d=cue(a);localStorage.setItem(d,u)}function UDe(a){let{layoutP:u,aggregatedKeyframes:d,viewModel:g}=a,[_,T]=Ni(null),N=w0.default.useRef(null),[R,O]=w0.default.useState(()=>BDe(g)),[B,V]=w0.default.useState(!1),[Y,W]=w0.default.useState({top:0,left:0}),$=(0,w0.useMemo)(()=>{let Ae=Array.from(d.byPosition.keys());return Ae.length===0?null:{first:Math.min(...Ae),last:Math.max(...Ae)}},[d]),[K]=oc(T,{displayName:"Aggregate Keyframe",menuItems:()=>{var Ae;let we=(Ae=(0,_b.pointerToPrism)(ce().atomP.ahistoric.clipboard.keyframesWithRelativePaths).getValue())!=null?Ae:[];return[{label:"Copy Keyframes",callback:()=>{aue(g,d)}},{label:"Paste Keyframes",enabled:we.length>0,callback:()=>{sue(g,u,we)}},{label:"Custom Color",callback:()=>{if(V(!0),T){let ft=T.getBoundingClientRect();W({top:Math.max(10,ft.top),left:Math.max(10,ft.left)})}}},{label:"Delete",callback:()=>{ce().transaction(({stateEditors:ft})=>{for(let Le of d.tracks){let Se=Le.data.keyframes.filter(Ge=>Ge.position>=$.first&&Ge.position<=$.last).map(Ge=>Ge.id);Se.length>0&&ft.coreByProject.historic.sheetsById.sequence.deleteKeyframes(U(P({},Le.sheetObject.address),{keyframeIds:Se,trackId:Le.id}))}})}}]}}),J=xG(),oe=(0,w0.useMemo)(()=>({debugName:"AggregateKeyframeBar/useDrag",onDragStart:Ae=>{if(!$)return!1;let we=Ae.target,ft=FDe(we),Le=ft!==null;J(!0,$.first),g.type==="sheet"?g.sheet.address:g.sheetObject.address;let Se=(0,_b.val)(u.scaledSpace.toUnitSpace),Ge;return{onDrag(Je,He,Bt){let Qe=Se(Je),Zt=Math.max(0,$.first+Qe);if(Le){let gt=ft==="left",it=$.first,Ce=$.last,ut=gt?$.first:$.last,kt=Math.max(0,ut+Qe);if(gt&&kt>=Ce||!gt&&kt<=it)return;let De=Ce-it,at=Math.abs(kt-(gt?Ce:it));if(De===0||at===0)return;Ge==null||Ge.discard(),Ge=ce().tempTransaction(({stateEditors:$t})=>{for(let Qt of d.tracks){let Et=[];for(let Te of Qt.data.keyframes)if(Te.position>=Math.min(it,Ce)&&Te.position<=Math.max(it,Ce)){let vt=(Te.position-it)/De,Mt=gt?kt+vt*at:it+vt*at;Et.push(U(P({},Te),{position:Mt}))}Et.length>0&&$t.coreByProject.historic.sheetsById.sequence.replaceKeyframes(U(P({},Qt.sheetObject.address),{trackId:Qt.id,keyframes:Et,snappingFunction:(0,_b.val)(u.sheet).getSequence().closestGridPosition}))}})}else Ge==null||Ge.discard(),Ge=ce().tempTransaction(({stateEditors:gt})=>{for(let it of d.tracks){let Ce=[];for(let ut of it.data.keyframes)ut.position>=$.first&&ut.position<=$.last&&Ce.push(U(P({},ut),{position:Math.max(0,ut.position+Qe)}));Ce.length>0&&gt.coreByProject.historic.sheetsById.sequence.replaceKeyframes(U(P({},it.sheetObject.address),{trackId:it.id,keyframes:Ce,snappingFunction:(0,_b.val)(u.sheet).getSequence().closestGridPosition}))}});J(!0,Zt)},onDragEnd(Je){J(!1,-1),Je?Ge==null||Ge.commit():Ge==null||Ge.discard()}}}}),[$,d,u,g,J]),[ae]=wo(T,oe);if(Wu(ae,"draggingPositionInSequenceEditor","ew-resize"),!$)return w0.default.createElement(WG,{ref:_});let ue=(0,_b.val)(u.scaledSpace.leftPadding),xe="calc(".concat(ue,"px + calc(var(--unitSpaceToScaledSpaceMultiplier) * ").concat($.first,"px))"),Re="calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat($.last-$.first,"px)");return w0.default.createElement(WG,{ref:_},w0.default.createElement(pue,{$color:R,style:{left:xe,width:Re}},w0.default.createElement(gue,{$position:"left","data-handle":"left"}),w0.default.createElement(vue,{$position:"right",style:{left:"calc(100% - 7px)"},"data-handle":"right"})),B&&w0.default.createElement(bue,{style:{position:"fixed",top:"".concat(Y.top,"px"),left:"".concat(Y.left,"px")}},w0.default.createElement(Sue,{ref:N,type:"color",value:R,onChange:Ae=>{let we=Ae.currentTarget.value;O(we),uue(g,we)},autoFocus:!0}),w0.default.createElement(Tue,{type:"text",placeholder:"#000000",value:R,onChange:Ae=>{let we=Ae.currentTarget.value;we.startsWith("#")||(we="#"+we),/^#[0-9A-F]{6}$/i.test(we)&&(O(we),uue(g,we))}}),w0.default.createElement("button",{onClick:()=>V(!1),style:{padding:"4px 8px",fontSize:"12px",cursor:"pointer",border:"1px solid #666",borderRadius:"2px",background:"#222",color:"#FFF",height:"28px"}},"Done")),K)}var _b,w0,due,WG,hue,pue,fue,qG,mue,gue,yue,vue,xue,bue,_ue,Sue,wue,Tue,Eue,Mue,zDe=C(()=>{_b=un(),w0=z(nt()),tn(),ls(),va(),rc(),Pe(),fl(),ac(),ms(),iue(),lue(),WG=ge.div(due||(due=H([`
  position: absolute;
  height: 100%;
  width: 100%;
`]))),pue=ge.div(hue||(hue=H([`
  position: absolute;
  height: 20px;
  background: `,`;
  cursor: ew-resize;
  top: 50%;
  transform: translateY(-50%);
  border-radius: 2px;
  z-index: 2;
  `,`

  &:hover {
    opacity: 0.8;
  }
`])),a=>a.$color,Zi),qG=ge.div(fue||(fue=H([`
  position: absolute;
  height: 20px;
  width: 7px;
  top: 50%;
  transform: translateY(-50%);
  display: block;
  z-index: 3;
  `,`

  &:before {
    position: absolute;
    display: block;
    content: ' ';
    background: inherit;
    border-radius: `,`;
    width: 7px;
    height: 20px;
  }

  &:after {
    position: absolute;
    display: block;
    content: ' ';
    width: 15px;
    height: 28px;
    top: 50%;
    transform: translateY(-50%);
    `,`
  }

  &:hover:before {
    opacity: 0.8;
  }
`])),Zi,a=>a.$position==="left"?"2px 0 0 2px":"0 2px 2px 0",a=>a.$position==="left"?"left: -8px; cursor: w-resize;":"right: -8px; cursor: e-resize;"),gue=ge(qG)(mue||(mue=H([`
  left: calc(-1 * 7px);
`]))),vue=ge(qG)(yue||(yue=H([`
  right: 0px;
`]))),bue=ge.div(xue||(xue=H([`
  position: absolute;
  background: #333;
  border-radius: 4px;
  padding: 4px;
  z-index: 1000;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
`]))),Sue=ge.input(_ue||(_ue=H([`
  background: #222;
  width: 50px;
  height: 30px;
  border: 1px solid #666;
  border-radius: 2px;
  cursor: pointer;

  &::-webkit-color-swatch-wrapper {
    padding: 2px;
  }

  &::-webkit-color-swatch {
    border: 1px solid #999;
    border-radius: 2px;
  }
`]))),Tue=ge.input(wue||(wue=H([`
  background: #222;
  border: 1px solid #666;
  color: #fff;
  width: 70px;
  height: 28px;
  padding: 4px;
  border-radius: 2px;
  font-family: monospace;
  font-size: 12px;

  &:focus {
    outline: none;
    border-color: #40aaa4;
  }
`]))),Eue=w0.default.memo(UDe),Mue=Eue});function VDe(a){let{layoutP:u,aggregatedKeyframes:d,viewModel:g}=a,[_,T]=Ni(null);return AI.default.createElement(Aue,{ref:_},AI.default.createElement(Mue,{viewModel:g,aggregatedKeyframes:d,layoutP:u}))}var AI,Cue,Aue,Nue,XG,Pue=C(()=>{AI=z(nt()),tn(),ls(),zDe(),Aue=ge.div(Cue||(Cue=H([`
  position: relative;
  height: 100%;
  width: 100%;
`]))),Nue=AI.default.memo(VDe),XG=Nue}),Sb,NI,Rue,Iue=C(()=>{Ar(),Sb=z(nt()),kDe(),oI(),Pue(),QR(),x8(),NI=(a,u,d=!0)=>a.type==="propWithChildren"?Sb.default.createElement(Rue,{layoutP:u,viewModel:a,key:"prop"+a.pathToProp[a.pathToProp.length-1],renderChildren:d}):Sb.default.createElement(nue,{layoutP:u,leaf:a,key:"prop"+a.pathToProp[a.pathToProp.length-1]}),Rue=({viewModel:a,layoutP:u,renderChildren:d=!0})=>{let g=Q7("RightPropWithChildrenRow",a.pathToProp.join());return di(()=>{let _=ZR(a);return Sb.default.createElement(ore,{logger:g},Sb.default.createElement(E8,{leaf:a,node:Sb.default.createElement(XG,{layoutP:u,aggregatedKeyframes:_,viewModel:a}),isCollapsed:a.isCollapsed},d&&a.children.map(T=>NI(T,u))))},[a,u])}}),YG,kue,Due,GDe=C(()=>{Ar(),YG=z(nt()),Iue(),oI(),QR(),Pue(),kue=({leaf:a,layoutP:u,renderChildren:d=!0})=>di(()=>{let g=ZR(a);return YG.default.createElement(E8,{leaf:a,node:YG.default.createElement(XG,{layoutP:u,aggregatedKeyframes:g,viewModel:a}),isCollapsed:a.isCollapsed},d&&a.children.map(_=>NI(_,u)))},[a,u]),Due=kue});function Oue(a){return"theatre-subsequence-color-".concat(a.sheet.address.projectId,"-").concat(a.sheet.address.sheetId,"-").concat(a.subSequence.id)}function jDe(a){let u=Oue(a),d=localStorage.getItem(u);if(d)return d;let g=rue();return localStorage.setItem(u,g),g}function Lue(a,u){let d=Oue(a);localStorage.setItem(d,u)}var Zd,Pi,Fue,Bue,Uue,zue,Vue,KG,Gue,jue,Hue,$ue,Wue,que,Xue,Yue,Kue,Zue,Que,Jue,ede,HDe=C(()=>{Zd=un(),Pi=z(nt()),tn(),fl(),rc(),Pe(),ac(),Ef(),Mf(),va(),ls(),ms(),Rf(),rc(),Hle(),iue(),Bue=ge.div(Fue||(Fue=H([`
  position: absolute;
  height: 100%;
  width: 100%;
  min-width: 20px;
`]))),zue=ge.div.attrs(a=>({style:{background:a.$color}}))(Uue||(Uue=H([`
  position: absolute;
  height: 20px;
  line-height: 20px;
  cursor: ew-resize;
  top: 50%;
  transform: translateY(-50%);
  border-radius: 2px;
  text-align: center;
  width: 100%;
  z-index: 2;
  `,`

  &:hover {
    opacity: 0.8;
  }

  span {
    color: white;
    font-weight: bold;
    text-shadow: 0 1px rgba(0, 0, 0, 0.67);
  }
`])),Zi),KG=ge.div(Vue||(Vue=H([`
  background: #555;
  position: absolute;
  height: 20px;
  width: 7px;
  top: 50%;
  transform: translateY(-50%);
  display: block;
  z-index: 3;
  `,`

  &:before {
    position: absolute;
    display: block;
    content: ' ';
    background: inherit;
    border-radius: `,`;
    width: 7px;
    height: 20px;
  }

  &:after {
    position: absolute;
    display: block;
    content: ' ';
    width: 15px;
    height: 28px;
    top: 50%;
    transform: translateY(-50%);
    `,`
  }

  &:hover:before {
    background: rgba(170, 64, 64, 0.6);
  }

  // Snap cursor when dragging playhead
  #pointer-root.draggingPositionInSequenceEditor & {
    pointer-events: auto;
    cursor: var(`,`);

    // Show snap cursor () on hover
    &:hover:after {
      background: url(`,`) no-repeat center center;
      background-size: 34px 34px;
    }
  }
`])),Zi,a=>a.$position==="left"?"2px 0 0 2px":"0 2px 2px 0",a=>a.$position==="left"?"left: -8px; cursor: w-resize;":"right: -8px; cursor: e-resize;",bf,vG),jue=ge(KG).attrs(a=>({style:{background:a.$color}}))(Gue||(Gue=H([`
  border-right: 1px solid rgba(0, 0, 0, 0.25);
  left: -7px;
`]))),$ue=ge(KG).attrs(a=>({style:{background:a.$color}}))(Hue||(Hue=H([`
  border-left: 1px solid rgba(0, 0, 0, 0.25);
  right: -7px;
`]))),ge.div(Wue||(Wue=H([`
  position: absolute;
  left: 8px;
  top: 50%;
  transform: translateY(-50%);
  color: rgba(255, 255, 255, 0.9);
  font-size: 11px;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  pointer-events: none;
  user-select: none;
`]))),Xue=ge.div(que||(que=H([`
  position: absolute;
  background: #333;
  border-radius: 4px;
  padding: 4px;
  z-index: 1000;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
`]))),Kue=ge.input(Yue||(Yue=H([`
  background: #222;
  width: 50px;
  height: 30px;
  border: 1px solid #666;
  border-radius: 2px;
  cursor: pointer;

  &::-webkit-color-swatch-wrapper {
    padding: 2px;
  }

  &::-webkit-color-swatch {
    border: 1px solid #999;
    border-radius: 2px;
  }
`]))),Que=ge.input(Zue||(Zue=H([`
  background: #222;
  border: 1px solid #666;
  color: #fff;
  width: 70px;
  height: 28px;
  padding: 4px;
  border-radius: 2px;
  font-family: monospace;
  font-size: 12px;

  &:focus {
    outline: none;
    border-color: #40aaa4;
  }
`]))),Jue=({leaf:a,layoutP:u})=>{var d;let[g,_]=Ni(null),[T,N]=Ni(null),[R,O]=Ni(null),[B,V]=Ni(null),Y=Pi.default.useRef(null),[W,$]=(0,Pi.useState)(()=>jDe(a)),[K,J]=(0,Pi.useState)(!1),[oe,ae]=(0,Pi.useState)({top:0,left:0}),ue=qu({debugName:"SubSequenceBar/editLabel"},()=>{let ut=a.subSequence.label,kt=ut;return Pi.default.createElement(Xu,null,Pi.default.createElement("div",{style:{padding:"8px"}},Pi.default.createElement("div",{style:{marginBottom:"8px",fontWeight:"bold"}},"Edit Sub-sequence Label"),Pi.default.createElement("input",{type:"text",defaultValue:ut,onChange:De=>{kt=De.target.value},style:{width:"200px",padding:"4px",marginBottom:"8px"},autoFocus:!0}),Pi.default.createElement("div",{style:{display:"flex",justifyContent:"flex-end",gap:"4px"}},Pi.default.createElement("button",{onClick:()=>{ce().transaction(({stateEditors:De})=>{De.studio.historic.projects.stateByProjectId.stateBySheetId._ensure({projectId:a.sheet.address.projectId,sheetId:a.sheet.address.sheetId}),De.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateSubSequence({sheetAddress:a.sheet.address,subSequenceId:a.subSequence.id,updates:{label:kt}})}),ue.close("user action")},style:{padding:"4px 12px",background:"#40AAA4",color:"white",border:"none",borderRadius:"2px",cursor:"pointer"}},"Done"))))}),xe=qu({debugName:"SubSequenceBar/editDuration"},()=>{let ut=a.subSequence.duration,kt=ut;return Pi.default.createElement(Xu,null,Pi.default.createElement("div",{style:{padding:"8px"}},Pi.default.createElement("div",{style:{marginBottom:"8px",fontWeight:"bold"}},"Edit Sub-sequence Duration"),Pi.default.createElement("input",{type:"number",defaultValue:ut,step:.1,min:.1,onChange:De=>{kt=parseFloat(De.target.value)},style:{width:"200px",padding:"4px",marginBottom:"8px"},autoFocus:!0}),Pi.default.createElement("div",{style:{display:"flex",justifyContent:"flex-end",gap:"4px"}},Pi.default.createElement("button",{onClick:()=>{kt>0&&ce().transaction(({stateEditors:De})=>{De.studio.historic.projects.stateByProjectId.stateBySheetId._ensure({projectId:a.sheet.address.projectId,sheetId:a.sheet.address.sheetId}),De.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateSubSequence({sheetAddress:a.sheet.address,subSequenceId:a.subSequence.id,updates:{duration:kt}})}),xe.close("user action")},style:{padding:"4px 12px",background:"#40AAA4",color:"white",border:"none",borderRadius:"2px",cursor:"pointer"}},"Done"))))}),Re=qu({debugName:"SubSequenceBar/editTimeScale"},()=>{let ut=a.subSequence.timeScale,kt=ut;return Pi.default.createElement(Xu,null,Pi.default.createElement("div",{style:{padding:"8px"}},Pi.default.createElement("div",{style:{marginBottom:"8px",fontWeight:"bold"}},"Edit Sub-sequence Time Scale"),Pi.default.createElement("input",{type:"number",defaultValue:ut,step:.1,min:.1,onChange:De=>{kt=parseFloat(De.target.value)},style:{width:"200px",padding:"4px",marginBottom:"8px"},autoFocus:!0}),Pi.default.createElement("div",{style:{display:"flex",justifyContent:"flex-end",gap:"4px"}},Pi.default.createElement("button",{onClick:()=>{kt>0&&ce().transaction(({stateEditors:De})=>{De.studio.historic.projects.stateByProjectId.stateBySheetId._ensure({projectId:a.sheet.address.projectId,sheetId:a.sheet.address.sheetId}),De.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateSubSequence({sheetAddress:a.sheet.address,subSequenceId:a.subSequence.id,updates:{timeScale:kt}})}),Re.close("user action")},style:{padding:"4px 12px",background:"#40AAA4",color:"white",border:"none",borderRadius:"2px",cursor:"pointer"}},"Done"))))}),Ae=qu({debugName:"SubSequenceBar/editStart"},()=>{let ut=a.subSequence.position,kt=ut;return Pi.default.createElement(Xu,null,Pi.default.createElement("div",{style:{padding:"8px"}},Pi.default.createElement("div",{style:{marginBottom:"8px",fontWeight:"bold"}},"Edit Sub-sequence Start Position"),Pi.default.createElement("input",{type:"number",defaultValue:ut,step:.1,min:0,onChange:De=>{kt=parseFloat(De.target.value)},style:{width:"200px",padding:"4px",marginBottom:"8px"},autoFocus:!0}),Pi.default.createElement("div",{style:{display:"flex",justifyContent:"flex-end",gap:"4px"}},Pi.default.createElement("button",{onClick:()=>{kt>=0&&ce().transaction(({stateEditors:De})=>{De.studio.historic.projects.stateByProjectId.stateBySheetId._ensure({projectId:a.sheet.address.projectId,sheetId:a.sheet.address.sheetId}),De.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateSubSequence({sheetAddress:a.sheet.address,subSequenceId:a.subSequence.id,updates:{position:kt}})}),Ae.close("user action")},style:{padding:"4px 12px",background:"#40AAA4",color:"white",border:"none",borderRadius:"2px",cursor:"pointer"}},"Ok"))))}),[we]=oc(_,{menuItems:()=>[{label:"Edit Label",callback:()=>{if(_){let ut=_.getBoundingClientRect();ue.open({clientX:ut.left,clientY:ut.top},_)}}},{label:"Edit Start",callback:()=>{if(_){let ut=_.getBoundingClientRect();Ae.open({clientX:ut.left,clientY:ut.top},_)}}},{label:"Edit Duration",callback:()=>{if(_){let ut=_.getBoundingClientRect();xe.open({clientX:ut.left,clientY:ut.top},_)}}},{label:"Edit Time Scale",callback:()=>{if(_){let ut=_.getBoundingClientRect();Re.open({clientX:ut.left,clientY:ut.top},_)}}},{label:"Delete Sub-sequence",callback:()=>{ce().transaction(({stateEditors:ut})=>{ut.studio.historic.projects.stateByProjectId.stateBySheetId._ensure({projectId:a.sheet.address.projectId,sheetId:a.sheet.address.sheetId}),ut.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.removeSubSequence({sheetAddress:a.sheet.address,subSequenceId:a.subSequence.id})})}},{label:"Custom Color",callback:()=>{if(J(!0),_){let ut=_.getBoundingClientRect();ae({top:Math.max(10,ut.top),left:Math.max(10,ut.left)})}}}]}),ft=xG(),Le=ut=>{let kt=ut.composedPath();for(let De of kt){if(De===O)return"left";if(De===V)return"right";if(De===N)return"bar";if(De===_)break}return null},Se=(0,Pi.useMemo)(()=>{let ut=null,kt=null,De=0,at=0,$t=1,Qt=()=>{var Et;let Te=a.subSequence.duration;if(!Te||Te===0)try{let vt=ce(),Mt=(0,Zd.val)(vt.projectsP)[a.sheet.address.projectId];Te=(Et=(0,Zd.val)(Mt.pointers.historic.sheetsById[a.subSequence.sheetId].sequence.length))!=null?Et:(0,Zd.val)(u.sheet).getSequence().length}catch{Te=(0,Zd.val)(u.sheet).getSequence().length}return Te??1};return{debugName:"SubSequenceBar/drag",lockCSSCursorTo:"ew-resize",onDragStart(Et){return kt=Le(Et),kt?(De=a.subSequence.position,at=Qt(),$t=a.subSequence.timeScale,ft(!0,a.subSequence.position),{onDrag(Te){ut&&ut.discard(),ut=ce().tempTransaction(({stateEditors:vt})=>{let Mt=(0,Zd.val)(u.clippedSpace.range),En=(0,Zd.val)(u.clippedSpace.width),pr=(Mt.end-Mt.start)/En,wr=Te*pr,Or=(0,Zd.val)(u.sheet).getSequence().closestGridPosition;if(kt==="bar"){let Ei=De+wr,Vs=Math.max(0,Or(Ei));vt.studio.historic.projects.stateByProjectId.stateBySheetId._ensure({projectId:a.sheet.address.projectId,sheetId:a.sheet.address.sheetId}),vt.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateSubSequence({sheetAddress:a.sheet.address,subSequenceId:a.subSequence.id,updates:{position:Vs}})}else if(kt==="left"){let Ei=De+at/$t,Vs=De+wr,li=Math.max(0,Or(Vs)),Mo=Ei-li,Si=Math.max(.01,at/Mo);vt.studio.historic.projects.stateByProjectId.stateBySheetId._ensure({projectId:a.sheet.address.projectId,sheetId:a.sheet.address.sheetId}),vt.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateSubSequence({sheetAddress:a.sheet.address,subSequenceId:a.subSequence.id,updates:{position:li,timeScale:Si}})}else if(kt==="right"){let Ei=De+at/$t+wr,Vs=Math.max(De+.01,Or(Ei))-De,li=Math.max(.01,at/Vs);vt.studio.historic.projects.stateByProjectId.stateBySheetId._ensure({projectId:a.sheet.address.projectId,sheetId:a.sheet.address.sheetId}),vt.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateSubSequence({sheetAddress:a.sheet.address,subSequenceId:a.subSequence.id,updates:{timeScale:li}})}})},onDragEnd(Te){ft(!1,0),Te&&ut?ut.commit():ut&&ut.discard(),ut=null}}):!1}}},[a,u,ft,O,V,N,_]),[Ge]=wo(_,Se);Wu(Ge,"draggingPositionInSequenceEditor","ew-resize");let Je=(0,Zd.val)(u.scaledSpace.leftPadding),He=a.subSequence.position,Bt=a.subSequence.timeScale,Qe=a.subSequence.duration;if(!Qe||Qe===0)try{let ut=ce(),kt=(0,Zd.val)(ut.projectsP)[a.sheet.address.projectId];Qe=(d=(0,Zd.val)(kt.pointers.historic.sheetsById[a.subSequence.sheetId].sequence.length))!=null?d:(0,Zd.val)(u.sheet).getSequence().length}catch{Qe=(0,Zd.val)(u.sheet).getSequence().length}Qe||(Qe=1);let Zt="calc(".concat(Je,"px + calc(var(--unitSpaceToScaledSpaceMultiplier) * ").concat(He,"px))"),gt="calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(Qe/Bt,"px)"),it=He,Ce=He+Qe/Bt;return Pi.default.createElement(Bue,{ref:g,style:{left:Zt,width:gt}},ue.node,Ae.node,xe.node,Re.node,K&&Pi.default.createElement(Xue,{style:{position:"fixed",top:"".concat(oe.top,"px"),left:"".concat(oe.left,"px")}},Pi.default.createElement(Kue,{ref:Y,type:"color",value:W,onChange:ut=>{let kt=ut.currentTarget.value;$(kt),Lue(a,kt)},autoFocus:!0}),Pi.default.createElement(Que,{type:"text",placeholder:"#000000",value:W,onChange:ut=>{let kt=ut.currentTarget.value;kt.startsWith("#")||(kt="#"+kt),/^#[0-9A-F]{6}$/i.test(kt)&&($(kt),Lue(a,kt))}}),Pi.default.createElement("button",{onClick:()=>J(!1),style:{padding:"4px 8px",fontSize:"12px",cursor:"pointer",border:"1px solid #666",borderRadius:"2px",background:"#222",color:"#FFF",height:"28px"}},"Done")),we,Pi.default.createElement(zue,{ref:T,$color:W},Pi.default.createElement("span",null,a.subSequence.timeScale.toFixed(2),"x")),Pi.default.createElement(jue,U(P({ref:R,$position:"left","data-handle":"left",title:isFinite(it)?"Sub-sequence start: ".concat(it.toFixed(2)):"Sub-sequence start"},isFinite(it)?lc.includePositionSnapAttrs(it):{}),{$color:W})),Pi.default.createElement($ue,U(P({ref:B,$position:"right","data-handle":"right",title:isFinite(Ce)?"Sub-sequence end: ".concat(Ce.toFixed(2)):"Sub-sequence end"},isFinite(Ce)?lc.includePositionSnapAttrs(Ce):{}),{$color:W})))},ede=Jue}),ZG,tde,nde,rde,ide,$De=C(()=>{ZG=z(nt()),tn(),HDe(),nde=ge.div(tde||(tde=H([`
  position: relative;
  height: 100%;
  width: 100%;
`]))),rde=({layoutP:a,leaf:u})=>ZG.default.createElement(nde,null,ZG.default.createElement(ede,{layoutP:a,leaf:u})),ide=rde}),QG,sde,ode,WDe=C(()=>{QG=z(nt()),oI(),$De(),sde=({leaf:a,layoutP:u})=>QG.default.createElement(E8,{leaf:a,node:QG.default.createElement(ide,{layoutP:u,leaf:a})},null),ode=sde}),PI,JG,ade,ej,tj=C(()=>{PI=z(nt()),JG=(0,PI.createContext)({searchTerm:"",searchTrigger:0}),ade=({searchTerm:a,searchTrigger:u,children:d})=>PI.default.createElement(JG.Provider,{value:{searchTerm:a,searchTrigger:u}},d),ej=()=>(0,PI.useContext)(JG)});function wb(a,u){ce().transaction(({stateEditors:d})=>{d.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.sequenceEditorCollapsableItems.set(U(P({},u.sheetAddress),{studioSheetItemKey:u.sheetItemKey,isCollapsed:a}))})}var nj=C(()=>{Pe()});function qDe(a,u){if(!u.trim())return;let d=u.toLowerCase().trim();a.children.filter(g=>g.type==="sheetObject").forEach(g=>{KDe(g,d)&&(wb(!1,{sheetAddress:g.sheetObject.address,sheetItemKey:g.sheetItemKey}),ude(g.children,d,g.sheetObject.address))})}function XDe(a){a.children.filter(u=>u.type==="sheetObject").forEach(u=>{let d="".concat(u.sheetObject.address.projectId,":").concat(u.sheetObject.address.sheetId,":").concat(u.sheetItemKey);R8.set(d,u.isCollapsed),lde(u.children,u.sheetObject.address)})}function lde(a,u){a.forEach(d=>{if(d.type==="propWithChildren"){let g="".concat(u.projectId,":").concat(u.sheetId,":").concat(d.sheetItemKey);R8.set(g,d.isCollapsed),lde(d.children,u)}})}function YDe(a){a.children.filter(u=>u.type==="sheetObject").forEach(u=>{let d="".concat(u.sheetObject.address.projectId,":").concat(u.sheetObject.address.sheetId,":").concat(u.sheetItemKey),g=R8.get(d);g!==void 0&&g!==u.isCollapsed&&wb(g,{sheetAddress:u.sheetObject.address,sheetItemKey:u.sheetItemKey}),cde(u.children,u.sheetObject.address)}),R8.clear()}function cde(a,u){a.forEach(d=>{if(d.type==="propWithChildren"){let g="".concat(u.projectId,":").concat(u.sheetId,":").concat(d.sheetItemKey),_=R8.get(g);_!==void 0&&_!==d.isCollapsed&&wb(_,{sheetAddress:u,sheetItemKey:d.sheetItemKey}),cde(d.children,u)}})}function KDe(a,u){return a.sheetObject.address.objectKey.toLowerCase().includes(u)?!0:a.children.some(d=>rj(d,u))}function ude(a,u,d){a.forEach(g=>{var _;if(g.type==="propWithChildren"){let T=(((_=g.pathToProp[g.pathToProp.length-1])==null?void 0:_.toString().toLowerCase())||"").includes(u),N=g.children.some(R=>rj(R,u));(T||N)&&(wb(!1,{sheetAddress:d,sheetItemKey:g.sheetItemKey}),ude(g.children,u,d))}})}function rj(a,u){var d;return(((d=a.pathToProp[a.pathToProp.length-1])==null?void 0:d.toString().toLowerCase())||"").includes(u)?!0:a.type==="propWithChildren"?a.children.some(g=>rj(g,u)):!1}function dde(a,u){if(!u.trim())return YDe(a),a;R8.size===0&&XDe(a),qDe(a,u);let d=u.toLowerCase().trim(),g=a.children.map(R=>R.type==="sheetObject"?ZDe(R,d):null).filter(R=>R!==null),_=a.top,T=a.n,N=g.map(R=>{let O=QDe(R,_,T);return _=O.top+O.heightIncludingChildren,T=O.n+1,O});return U(P({},a),{children:N,heightIncludingChildren:_-a.top,isCollapsed:!1})}function ZDe(a,u){if(a.sheetObject.address.objectKey.toLowerCase().includes(u))return U(P({},a),{children:a.children,isCollapsed:!1});{let d=a.children.map(g=>hde(g,u)).filter(g=>g!==null);if(d.length>0)return U(P({},a),{children:d,isCollapsed:!1})}return null}function hde(a,u){var d;let g=(((d=a.pathToProp[a.pathToProp.length-1])==null?void 0:d.toString().toLowerCase())||"").includes(u);if(a.type==="primitiveProp")return g?a:null;if(g)return U(P({},a),{children:a.children,isCollapsed:!1});{let _=a.children.map(T=>hde(T,u)).filter(T=>T!==null);if(_.length>0)return U(P({},a),{children:_,isCollapsed:!1})}return null}function QDe(a,u,d){let g=u,_=d,T=U(P({},a),{top:g,n:_});g+=a.nodeHeight,_+=1;let N=a.children.map(R=>{let O=pde(R,g,_);return g=O.top+O.nodeHeight,O.type==="propWithChildren"&&(g+=O.heightIncludingChildren-O.nodeHeight),_=O.n+1,O});return U(P({},T),{children:N,heightIncludingChildren:g-T.top})}function pde(a,u,d){let g=U(P({},a),{top:u,n:d});if(a.type==="propWithChildren"){let _=u+a.nodeHeight,T=d+1,N=a.children.map(R=>{let O=pde(R,_,T);return _=O.top+O.nodeHeight,O.type==="propWithChildren"&&(_+=O.heightIncludingChildren-O.nodeHeight),T=O.n+1,O});return U(P({},g),{children:N,heightIncludingChildren:_-g.top})}return g}var R8,fde=C(()=>{nj(),R8=new Map});function ij(a,u=[]){a.shouldRender&&u.push(a);let d="isCollapsed"in a?a.isCollapsed:!1;if((a.type==="sheet"||!d)&&"children"in a)for(let g of a.children)ij(g,u);return u}var mde=C(()=>{}),RI,$4,Tb,gde,yde,vde,xde,bde,_de,sj=C(()=>{Ar(),RI=un(),$4=z(nt()),tn(),Gke(),EG(),GDe(),WDe(),tj(),fde(),wf(),mde(),JR(),Iue(),Tb=1e6,yde=ge.div(gde||(gde=H([`
  position: relative;
`]))),xde=ge.div(vde||(vde=H([`
  margin: 0;
  padding: 0;
  position: absolute;
  left: 0;
  width: `,`px;
  z-index: 10;
`])),Tb),bde=({layoutP:a})=>{let{searchTerm:u,searchTrigger:d}=ej(),g=yG(),{scrollTop:_,clientHeight:T}=ti(g);return di(()=>{let N=(0,RI.val)(a.tree),R=u.trim()?dde(N,u):N,O=(0,RI.val)(a.tree.top)+Math.max(R.heightIncludingChildren,(0,RI.val)(a.dopeSheetDims.height)),B=ij(R),V=[],Y=500,W=_-Y,$=_+T+Y,K=-1;for(let J=0;J<B.length;J++){let oe=B[J];if(oe.top+oe.nodeHeight>=W){K=J;break}}if(K!==-1)for(let J=K;J<B.length;J++){let oe=B[J];if(oe.top>$)break;V.push(oe)}return $4.default.createElement(yde,null,$4.default.createElement(iI,{layoutP:a,height:O},$4.default.createElement(Fle,{layoutP:a,height:O},$4.default.createElement(xde,{style:{top:"0px"}},V.map(J=>{let oe=null;return J.type==="subSequence"?oe=$4.default.createElement(ode,{layoutP:a,key:jl.forSubSequence(J.subSequence.id),leaf:J}):J.type==="sheetObject"?oe=$4.default.createElement(Due,{layoutP:a,key:"sheetObject-"+J.sheetObject.address.objectKey,leaf:J,renderChildren:!1}):(J.type==="propWithChildren"||J.type==="primitiveProp")&&(oe=NI(J,a,!1)),oe?$4.default.createElement("div",{key:J.type+"-"+(J.sheetItemKey||J.top),style:{position:"absolute",top:J.top+"px",width:"100%",height:J.nodeHeight+"px"}},oe):null})))))},[a,u,d,_,T])},_de=bde});function oj(a,u,d,g){let _="calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(a,"px)"),T="calc((var(--graphEditorVerticalSpace) - var(--graphEditorVerticalSpace) * ".concat(u,") * 1px)");d===0&&(d=1e-4);let N="calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(d,")");g===0&&(g=.001);let R="calc(var(--graphEditorVerticalSpace) * ".concat(g*-1,")");return"translate(".concat(_,", ").concat(T,") scale(").concat(N,", ").concat(R,")")}function JDe(a,u){let{index:d,trackData:g}=u,_=g.keyframes[d],T=g.keyframes[d+1];return oc(a,{menuItems:()=>[{label:"Delete",callback:()=>{ce().transaction(({stateEditors:N})=>{let{deleteKeyframes:R}=N.coreByProject.historic.sheetsById.sequence;R(U(P({},u.sheetObject.address),{trackId:u.trackId,keyframeIds:[_.id,T.id]}))})}}]})}var II,Sde,wde,Tde,Ede,Mde,aj=C(()=>{B4(),Pe(),ac(),ls(),II=z(nt()),tn(),wde=ge.path(Sde||(Sde=H([`
  stroke-width: 2;
  stroke: var(--main-color);
  fill: none;
  vector-effect: non-scaling-stroke;
`]))),Tde="M 0 0 L 1 0 L 1 1",Ede=a=>{let{index:u,trackData:d}=a,g=d.keyframes[u],_=d.keyframes[u+1],T=_.position-g.position,[N,R]=Ni(null),[O]=JDe(R,a),B=a.isScalar?BR(g.value,a.propConfig):0,V=a.isScalar?BR(_.value,a.propConfig):1,Y=a.extremumSpace.fromValueSpace(B),W=a.extremumSpace.fromValueSpace(V)-Y,$=oj(g.position,Y,T,W),K=g.handles[2],J=g.handles[3],oe=_.handles[0],ae=_.handles[1],ue="M 0 0 C ".concat(K," ").concat(J," ").concat(oe," ").concat(ae," 1 1");return II.default.createElement(II.default.Fragment,null,II.default.createElement(wde,{ref:N,d:!g.type||g.type==="bezier"?ue:Tde,style:{transform:$}}),O)},Mde=Ede});function eOe(a,u){let d=(0,I8.useRef)(u);d.current=u;let g=(0,I8.useMemo)(()=>({debugName:"CurveHandler/useOurDrags",lockCSSCursorTo:"move",onDragStart(){let _,T=d.current,N=(0,ME.val)(T.layoutP.scaledSpace.toUnitSpace),R=(0,ME.val)(T.layoutP.graphEditorVerticalSpace.toExtremumSpace),O=T.extremumSpace.lock();return{onDrag(B,V){_&&(_.discard(),_=void 0);let{index:Y,trackData:W}=T,$=W.keyframes[Y],K=W.keyframes[Y+1],J=N(B)/(K.position-$.position),oe=-V,ae=R(oe),ue=T.extremumSpace.deltaToValueSpace(ae),xe=u.isScalar?$.value:0,Re=u.isScalar?K.value:1,Ae=ue/(Re-xe);if(T.which==="left"){let we=os($.handles[2]+J,0,1),ft=$.handles[3]+Ae;_=ce().tempTransaction(({stateEditors:Le})=>{Le.coreByProject.historic.sheetsById.sequence.replaceKeyframes(U(P({},T.sheetObject.address),{snappingFunction:(0,ME.val)(T.layoutP.sheet).getSequence().closestGridPosition,trackId:T.trackId,keyframes:[U(P({},$),{handles:[$.handles[0],$.handles[1],we,ft]})]}))})}else{let we=os(K.handles[0]+J,0,1),ft=K.handles[1]+Ae;_=ce().tempTransaction(({stateEditors:Le})=>{Le.coreByProject.historic.sheetsById.sequence.replaceKeyframes(U(P({},T.sheetObject.address),{trackId:T.trackId,snappingFunction:(0,ME.val)(T.layoutP.sheet).getSequence().closestGridPosition,keyframes:[U(P({},K),{handles:[we,ft,K.handles[2],K.handles[3]]})]}))})}},onDragEnd(B){O(),B?_&&_.commit():_&&_.discard()}}}}),[]);wo(a,g)}function tOe(a,u){return oc(a,{menuItems:()=>[{label:"Delete",callback:()=>{ce().transaction(({stateEditors:d})=>{d.coreByProject.historic.sheetsById.sequence.deleteKeyframes(U(P({},u.sheetObject.address),{keyframeIds:[u.keyframe.id],trackId:u.trackId}))})}}]})}var ME,I8,Cde,lj,Ade,Nde,Pde,Rde,Ide,cj,nOe=C(()=>{Pe(),ac(),va(),ls(),ME=un(),b0(),I8=z(nt()),tn(),aj(),ms(),lj=ge.circle(Cde||(Cde=H([`
  stroke-width: 1px;
  vector-effect: non-scaling-stroke;
  fill: var(--main-color);
  r: 2px;
  pointer-events: none;
`]))),Nde=ge.circle(Ade||(Ade=H([`
  stroke-width: 6px;
  vector-effect: non-scaling-stroke;
  r: 6px;
  fill: transparent;
  cursor: move;
  `,`;
  &:hover {
  }
  &:hover + `,` {
    r: 6px;
  }
`])),Zi,lj),Rde=ge.path(Pde||(Pde=H([`
  stroke-width: 1;
  stroke: var(--main-color);
  /* stroke: gray; */
  fill: none;
  vector-effect: non-scaling-stroke;
`]))),Ide=a=>{let[u,d]=Ni(null),{index:g,trackData:_}=a,T=_.keyframes[g],N=_.keyframes[g+1],[R]=tOe(d,a);eOe(d,a);let O=a.which==="left"?T.handles[2]:N.handles[0],B=T.position+(N.position-T.position)*O,V=a.which==="left"?T.handles[3]:N.handles[1],Y=a.isScalar?T.value:0,W=a.isScalar?N.value:1,$=Y+(W-Y)*V,K=a.extremumSpace.fromValueSpace($),J=K-a.extremumSpace.fromValueSpace(a.which==="left"?Y:W),oe=oj(a.which==="left"?T.position:N.position,a.extremumSpace.fromValueSpace(a.which==="left"?Y:W),B-(a.which==="left"?T.position:N.position),J);return I8.default.createElement("g",null,I8.default.createElement(Nde,{ref:u,style:{cx:"calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(B," * 1px)"),cy:"calc((var(--graphEditorVerticalSpace) - var(--graphEditorVerticalSpace) * ".concat(K,") * 1px)")}}),I8.default.createElement(lj,{style:{cx:"calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(B," * 1px)"),cy:"calc((var(--graphEditorVerticalSpace) - var(--graphEditorVerticalSpace) * ".concat(K,") * 1px)")}}),I8.default.createElement(Rde,{d:"M 0 0 L 1 1",style:{transform:oe}}),R)},cj=Ide});function rOe(a){let[u,d]=(0,W4.useState)(!1);N1(u,a.props.keyframe.position);let g=(0,W4.useRef)(a.props);g.current=a.props;let _=(0,W4.useMemo)(()=>({debugName:"GraphEditorDotScalar/useDragKeyframe",lockCSSCursorTo:"move",onDragStart(T){d(!0);let N=!!T.altKey,R=g.current,O=(0,kI.val)(R.layoutP.scaledSpace.toUnitSpace),B=(0,kI.val)(R.layoutP.graphEditorVerticalSpace.toExtremumSpace),V=R.extremumSpace.lock(),Y;return{onDrag(W,$){let K=R.trackData.keyframes[R.index],J=O(W),oe=-$,ae=B(oe),ue=R.extremumSpace.deltaToValueSpace(ae),xe=[],Re=U(P({},K),{position:K.position+J,value:K.value+ue,handles:[...K.handles]});if(xe.push(Re),N){let Ae=R.trackData.keyframes[R.index-1];if(Ae&&Math.abs(K.value-Ae.value)>0){let ft=U(P({},Ae),{handles:[...Ae.handles]});xe.push(ft),ft.handles[3]=sOe(Ae.handles[3],Ae.value,Ae.value,K.value,Re.value)}let we=R.trackData.keyframes[R.index+1];if(we&&Math.abs(K.value-we.value)>0){let ft=U(P({},we),{handles:[...we.handles]});xe.push(ft),ft.handles[1]=oOe(ft.handles[1],ft.value,ft.value,K.value,Re.value)}}Y==null||Y.discard(),Y=ce().tempTransaction(({stateEditors:Ae})=>{Ae.coreByProject.historic.sheetsById.sequence.replaceKeyframes(U(P({},R.sheetObject.address),{trackId:R.trackId,keyframes:xe,snappingFunction:(0,kI.val)(R.layoutP.sheet).getSequence().closestGridPosition}))})},onDragEnd(W){d(!1),V(),W?Y==null||Y.commit():(Y==null||Y.discard(),a.onDetectedClick(T))}}}}),[]);return wo(a.node,_),Wu(u,"draggingPositionInSequenceEditor","move"),u}function iOe(a,u){return oc(a,{menuItems:()=>[{label:"Delete",callback:()=>{ce().transaction(({stateEditors:d})=>{d.coreByProject.historic.sheetsById.sequence.deleteKeyframes(U(P({},u.sheetObject.address),{keyframeIds:[u.keyframe.id],trackId:u.trackId}))})}}]})}function sOe(a,u,d,g,_){return(g-u)*a/(_-d)}function oOe(a,u,d,g,_){return((u-g)*a+g-u+d-_)/(d-_)}var kI,W4,kde,uj,Dde,Ode,Lde,Fde,aOe=C(()=>{Pe(),ac(),va(),ls(),kI=un(),W4=z(nt()),tn(),fl(),fl(),ms(),rc(),Rf(),FG(),dE(),uj=ge.circle(kde||(kde=H([`
  fill: var(--main-color);
  stroke-width: 1px;
  vector-effect: non-scaling-stroke;

  r: 2px;
`]))),Ode=ge.circle(Dde||(Dde=H([`
  stroke-width: 6px;
  vector-effect: non-scaling-stroke;
  r: 6px;
  fill: transparent;
  `,`;

  &:hover + `,` {
    r: 6px;
  }

  #pointer-root.normal & {
    cursor: move;
  }

  #pointer-root.draggingPositionInSequenceEditor & {
    pointer-events: auto;
    cursor: var(`,`);
  }

  &.beingDragged {
    pointer-events: none !important;
  }
`])),Zi,uj,bf),Lde=a=>{let[u,d]=Ni(null),{index:g,trackData:_}=a,T=_.keyframes[g],[N]=iOe(d,a),R=db(a.itemKey),O=T.value,B=a.extremumSpace.fromValueSpace(O),V=LG([{type:"primitiveProp",keyframe:a.keyframe,pathToProp:a.pathToProp,propConfig:a.propConfig,sheetObject:a.sheetObject,trackId:a.trackId}]),Y=rOe({node:d,props:a,onDetectedClick:W=>V.toggle(W,W.target instanceof Element?W.target:d)});return W4.default.createElement(W4.default.Fragment,null,W4.default.createElement(Ode,U(P(P(P({ref:u,style:{cx:"calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(T.position," * 1px)"),cy:"calc((var(--graphEditorVerticalSpace) - var(--graphEditorVerticalSpace) * ".concat(B,") * 1px)")}},P1(T.position)),lc.includePositionSnapAttrs(T.position)),R.attrs),{className:Y?"beingDragged":""})),W4.default.createElement(uj,{style:{cx:"calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(T.position," * 1px)"),cy:"calc((var(--graphEditorVerticalSpace) - var(--graphEditorVerticalSpace) * ".concat(B,") * 1px)"),fill:R.flag===2?"white":void 0}}),V.node,N)},Fde=Lde});function lOe(a){let[u,d]=(0,q4.useState)(!1);N1(u,a.props.keyframe.position);let g=(0,q4.useRef)(a.props);g.current=a.props;let _=(0,q4.useMemo)(()=>({debugName:"GraphEditorDotNonScalar/useDragKeyframe",lockCSSCursorTo:"ew-resize",onDragStart(T){d(!0);let N=g.current,R=(0,dj.val)(N.layoutP.scaledSpace.toUnitSpace),O=N.extremumSpace.lock(),B;return{onDrag(V,Y){let W=N.trackData.keyframes[N.index],$=R(V),K=[],J=U(P({},W),{position:W.position+$,value:W.value,handles:[...W.handles]});K.push(J),B==null||B.discard(),B=ce().tempTransaction(({stateEditors:oe})=>{oe.coreByProject.historic.sheetsById.sequence.replaceKeyframes(U(P({},N.sheetObject.address),{trackId:N.trackId,keyframes:K,snappingFunction:(0,dj.val)(N.layoutP.sheet).getSequence().closestGridPosition}))})},onDragEnd(V){d(!1),O(),V?B==null||B.commit():(B==null||B.discard(),a.onDetectedClick(T))}}}}),[]);return wo(a.node,_),Wu(u,"draggingPositionInSequenceEditor","ew-resize"),u}function cOe(a,u){return oc(a,{menuItems:()=>[{label:"Delete",callback:()=>{ce().transaction(({stateEditors:d})=>{d.coreByProject.historic.sheetsById.sequence.deleteKeyframes(U(P({},u.sheetObject.address),{keyframeIds:[u.keyframe.id],trackId:u.trackId}))})}}]})}var dj,q4,Bde,hj,Ude,zde,Vde,pj,uOe=C(()=>{Pe(),ac(),va(),ls(),dj=un(),q4=z(nt()),tn(),fl(),fl(),ms(),rc(),Rf(),FG(),dE(),hj=ge.circle(Bde||(Bde=H([`
  fill: var(--main-color);
  stroke-width: 1px;
  vector-effect: non-scaling-stroke;

  r: 2px;
`]))),zde=ge.circle(Ude||(Ude=H([`
  stroke-width: 6px;
  vector-effect: non-scaling-stroke;
  r: 6px;
  fill: transparent;
  `,`;

  &:hover + `,` {
    r: 6px;
  }

  #pointer-root.normal & {
    cursor: ew-resize;
  }

  #pointer-root.draggingPositionInSequenceEditor & {
    pointer-events: auto;
    cursor: var(`,`);
  }

  &.beingDragged {
    pointer-events: none !important;
  }
`])),Zi,hj,bf),Vde=a=>{let[u,d]=Ni(null),{index:g,trackData:_,itemKey:T}=a,N=_.keyframes[g],[R]=cOe(d,a),O=db(T),B=a.which==="left"?0:1,V=LG([{type:"primitiveProp",keyframe:a.keyframe,pathToProp:a.pathToProp,propConfig:a.propConfig,sheetObject:a.sheetObject,trackId:a.trackId}]),Y=lOe({node:d,props:a,onDetectedClick:$=>V.toggle($,$.target instanceof Element?$.target:d)}),W=a.extremumSpace.fromValueSpace(B);return q4.default.createElement(q4.default.Fragment,null,q4.default.createElement(zde,U(P(P(P({ref:u,style:{cx:"calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(N.position," * 1px)"),cy:"calc((var(--graphEditorVerticalSpace) - var(--graphEditorVerticalSpace) * ".concat(W,") * 1px)")}},O.attrs),P1(N.position)),lc.includePositionSnapAttrs(N.position)),{className:Y?"beingDragged":""})),q4.default.createElement(hj,{style:{cx:"calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(N.position," * 1px)"),cy:"calc((var(--graphEditorVerticalSpace) - var(--graphEditorVerticalSpace) * ".concat(W,") * 1px)"),fill:O.flag===2?"white":void 0}}),V.node,R)},pj=Vde}),DI,Gde,jde,Hde,$de,dOe=C(()=>{DI=z(nt()),tn(),aj(),jde=ge.path(Gde||(Gde=H([`
  stroke-width: 2;
  stroke: var(--main-color);
  stroke-dasharray: 3 2;
  fill: none;
  vector-effect: non-scaling-stroke;
  opacity: 0.3;
`]))),Hde=a=>{let{index:u,trackData:d}=a,g="M 0 0 L 1 1",_=oj(d.keyframes[u].position,a.extremumSpace.fromValueSpace(0),0,a.extremumSpace.fromValueSpace(1)-a.extremumSpace.fromValueSpace(0));return DI.default.createElement(DI.default.Fragment,null,DI.default.createElement(jde,{d:g,style:{transform:_}}))},$de=Hde}),T0,Wde,qde,Xde,Yde,Kde,hOe=C(()=>{T0=z(nt()),tn(),aj(),nOe(),aOe(),uOe(),dOe(),qde=ge.g(Wde||(Wde=H([`
  /* position: absolute; */
`]))),Xde=T0.default.createElement(T0.default.Fragment,null),Yde=a=>{let{index:u,trackData:d,isScalar:g}=a,_=d.keyframes[u],T=d.keyframes[u+1],N=_.connectedRight&&!!T&&T.value!==_.value;return T0.default.createElement(qde,null,N?T0.default.createElement(T0.default.Fragment,null,T0.default.createElement(Mde,P({},a)),!_.type||_.type==="bezier"&&T0.default.createElement(T0.default.Fragment,null,T0.default.createElement(cj,U(P({},a),{which:"left"})),T0.default.createElement(cj,U(P({},a),{which:"right"})))):Xde,g?T0.default.createElement(Fde,P({},a)):T0.default.createElement(T0.default.Fragment,null,T0.default.createElement(pj,U(P({},a),{which:"left"})),T0.default.createElement(pj,U(P({},a),{which:"right"})),T0.default.createElement($de,P({},a))))},Kde=Yde});function pOe(a,u){let d=1/0,g=-1/0;function _(T){d=Math.min(T,d),g=Math.max(T,g)}return a.forEach((T,N)=>{let R=BR(T.value,u);if(_(R),!T.connectedRight)return;let O=a[N+1];if(!O)return;let B=(typeof O.value=="number"?O.value:1)-R;_(R+T.handles[3]*B),_(R+O.handles[1]*B)}),[d,g]}function fOe(a){let u=0,d=1;function g(_){u=Math.min(_,u),d=Math.max(_,d)}return a.forEach((_,T)=>{if(!_.connectedRight)return;let N=a[T+1];N&&(g(_.handles[3]),g(N.handles[1]))}),[u,d]}var R1,Zde,Qde,mOe=C(()=>{wf(),R1=z(nt()),LI(),hOe(),B4(),Ar(),Zde=R1.default.memo(({layoutP:a,trackData:u,sheetObject:d,trackId:g,color:_,pathToProp:T})=>{let N=cb(ti(d.template.configPointer),T);if(A1(N))return console.error("Composite prop types cannot be keyframed"),R1.default.createElement(R1.default.Fragment,null);let[R,O]=(0,R1.useState)(!1),B=(0,R1.useMemo)(()=>{let $=new Set;return function(){let K=$.size===0;$.add(J),K&&O(!0);function J(){let oe=$.size>0;$.delete(J),oe&&$.size===0&&O(!1)}return J}},[]),V=(0,R1.useMemo)(()=>{let $=N.type==="number"?pOe(u.keyframes,N):fOe(u.keyframes),K=ae=>(ae-$[0])/($[1]-$[0]),J=ae=>$[0]+oe(ae),oe=ae=>ae*($[1]-$[0]);return{fromValueSpace:K,toValueSpace:J,deltaToValueSpace:oe,lock:B}},[u.keyframes]),Y=(0,R1.useRef)(void 0);R||(Y.current=V);let W=u.keyframes.map(($,K)=>R1.default.createElement(Kde,{pathToProp:T,propConfig:N,itemKey:jl.forTrackKeyframe(d,g,$.id),keyframe:$,index:K,trackData:u,layoutP:a,sheetObject:d,trackId:g,isScalar:N.type==="number",key:$.id,extremumSpace:Y.current,color:_}));return R1.default.createElement("g",{style:{"--main-color":CE[_].iconColor}},W)}),Qde=Zde}),Jde,OI,ehe,the,gOe=C(()=>{Pe(),Ar(),Jde=un(),OI=z(nt()),mOe(),ehe=a=>di(()=>{let{sheetObject:u,trackId:d}=a,g=(0,Jde.val)(ce().atomP.historic.coreByProject[u.address.projectId].sheetsById[u.address.sheetId].sequence.tracksByObject[u.address.objectKey].trackData[d]);return(g==null?void 0:g.type)!=="BasicKeyframedTrack"?(console.error("trackData type ".concat(g==null?void 0:g.type," is not yet supported on the graph editor")),OI.default.createElement(OI.default.Fragment,null)):OI.default.createElement(Qde,U(P({},a),{trackData:g}))},[a.trackId,a.layoutP]),the=ehe});function nhe({clippedSpaceRange:a,clippedSpaceWidth:u,fps:d,gapWidth:g=120},_){let T=1/d,N=a.end-a.start,R=u/(d*N),O=Math.floor(g/R),B=(O<d?rhe(d).find(W=>W>=O):d*Math.floor(O/d))*T,V=Math.floor(a.start/B),Y=Math.ceil(a.end/B);for(let W=V;W<=Y;W++){let $=W*B,K=$%1===0;_($,K)}}var rhe,ihe=C(()=>{b0(),rhe=af(a=>{let u=[];for(let d=1;d<=a;d++)a%d===0&&u.push(d);return u})});function yOe(a){let{clippedSpaceWidth:u,height:d,ctx:g,unitSpaceToClippedSpace:_,snapToGrid:T}=a;g.clearRect(0,0,u,d),nhe(a,(N,R)=>{let O=T(N),B=Math.floor(_(O));g.strokeStyle=R?"rgba(225, 225, 225, 0.04)":"rgba(255, 255, 255, 0.01)",g.beginPath(),g.moveTo(B,0),g.lineTo(B,d),g.stroke(),g.closePath()})}var k8,D8,she,ohe,ahe,lhe,che,uhe,dhe,hhe,fj,phe=C(()=>{k8=un(),D8=z(nt()),tn(),ihe(),Pe(),ohe=ge.div(she||(she=H([`
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  pointer-events: none;
`]))),lhe=ge.canvas(ahe||(ahe=H([`
  position: relative;
  left: 0;
`]))),che=a=>{let u=a;return u.webkitBackingStorePixelRatio||u.mozBackingStorePixelRatio||u.msBackingStorePixelRatio||u.oBackingStorePixelRatio||u.backingStorePixelRatio||1},uhe=()=>window.devicePixelRatio||1,dhe=a=>uhe()/che(a),hhe=({layoutP:a,width:u,height:d})=>{let g=(0,D8.useRef)(null),[_,T]=(0,D8.useState)(null),{ctx:N,ratio:R}=(0,D8.useMemo)(()=>{if(!_)return{};let O=_.getContext("2d"),B=dhe(O);return{ctx:O,ratio:B}},[_]);return(0,D8.useLayoutEffect)(()=>{if(!N)return;_.width=u*R,_.height=d*R;let O=(0,k8.prism)(()=>{let B=(0,k8.val)(a.sheet).getSequence();return{ctx:N,clippedSpaceRange:(0,k8.val)(a.clippedSpace.range),clippedSpaceWidth:(0,k8.val)(a.clippedSpace.width),unitSpaceToClippedSpace:(0,k8.val)(a.clippedSpace.fromUnitSpace),height:d,leftPadding:(0,k8.val)(a.scaledSpace.leftPadding),fps:B.subUnitsPerUnit,snapToGrid:V=>B.closestGridPosition(V)}}).onChange(ce().ticker,B=>{N.save(),N.scale(R,R),yOe(B),N.restore()},!0);return()=>{O()}},[N,u,d,a]),D8.default.createElement(ohe,{ref:g,style:{width:u+"px"}},D8.default.createElement(lhe,{ref:T,style:{width:u+"px",height:d+"px"}}))},fj=hhe}),I1,O8,CE,fhe,mhe,ghe,yhe,vhe,xhe,LI=C(()=>{Pe(),V4(),UR(),Ar(),I1=un(),O8=z(nt()),tn(),sj(),EG(),gOe(),phe(),vf(),CE={1:{iconColor:"#b98b08"},2:{iconColor:"#70a904"},3:{iconColor:"#2e928a"},4:{iconColor:"#a943bb"},5:{iconColor:"#b90808"},6:{iconColor:"#b4bf0e"}},mhe=ge.div(fhe||(fhe=H([`
  position: absolute;
  right: 0;
  bottom: 0;
  padding-bottom: 25px;
  background: `,`;
`])),w1(.03,"#1a1c1e")),yhe=ge.svg(ghe||(ghe=H([`
  position: absolute;
  top: 0;
  left: 0;
  margin: 0;
  pointer-events: none;
`]))),vhe=({layoutP:a})=>di(()=>{let u=(0,I1.val)(a.sheet),d=(0,I1.val)(ce().atomP.historic.projects.stateByProjectId[u.address.projectId].stateBySheetId[u.address.sheetId].sequenceEditor.selectedPropsByObject),g=(0,I1.val)(a.graphEditorDims.height),_=(0,I1.val)(a.scaledSpace.fromUnitSpace)(1),T=[];if(d)for(let[R,O]of Object.entries(d)){let B=u.getObject(R);if(!B)continue;let V=(0,I1.val)(B.template.getMapOfValidSequenceTracks_forStudio());for(let[Y,W]of Object.entries(O)){let $=aG(Y),K=U4(V,$);K&&T.push(O8.default.createElement(the,{key:"graph-".concat(R,"-").concat(Y),sheetObject:B,pathToProp:$,layoutP:a,trackId:K,color:W}))}}let N=(0,I1.val)(a.rightDims.width);return O8.default.createElement(mhe,{style:{width:N+"px",height:g+"px","--unitSpaceToScaledSpaceMultiplier":_,"--graphEditorVerticalSpace":"".concat((0,I1.val)(a.graphEditorVerticalSpace.space))}},O8.default.createElement(fj,{layoutP:a,width:N,height:g}),O8.default.createElement(iI,{layoutP:a,height:g},O8.default.createElement(yhe,{width:Tb,height:g,viewBox:"0 0 ".concat(Tb," ").concat(g)},O8.default.createElement("g",{style:{transform:"translate(".concat((0,I1.val)(a.scaledSpace.leftPadding),"px, ").concat((0,I1.val)(a.graphEditorDims.padding.top),"px)")}},T))))},[a]),xhe=vhe}),bhe,Yu,_he,She,whe,The,mj,Ehe,Mhe,Che,Ahe,Nhe,Phe,Rhe,Ihe,khe,vOe=C(()=>{Pe(),V4(),JT(),Ar(),bhe=un(),Yu=z(nt()),tn(),Nke(),HR(),LI(),YR(),Z2(),gV(),ac(),Eae(),_he={label:{color:"#9a9a9a"}},whe=ge(rG)(She||(She=H([""]))),mj=ge(XR)(The||(The=H([`
  display: flex;
  color: `,`;
  padding-left: calc(10px + var(--depth) * 10px);
  padding-right: 12px;
  align-items: center;
  justify-content: flex-end;
  box-sizing: border-box;
`])),_he.label.color),Mhe=ge.button(Ehe||(Ehe=H([`
  background: none;
  border: none;
  outline: none;
  display: flex;
  box-sizing: border-box;
  font-size: 14px;
  align-items: center;
  height: 100%;
  margin-left: 12px;
  color: `,`;

  &:not([disabled]):hover {
    color: white;
  }
`])),a=>a.isSelected?CE[a.graphEditorColor].iconColor:z4.offColor),Che=()=>Yu.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"12",viewBox:"0 0 640 512"},Yu.default.createElement("g",{transform:"translate(0 100)"},Yu.default.createElement("path",{fill:"currentColor",d:"M368 32h-96c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32V64c0-17.67-14.33-32-32-32zM208 88h-84.75C113.75 64.56 90.84 48 64 48 28.66 48 0 76.65 0 112s28.66 64 64 64c26.84 0 49.75-16.56 59.25-40h79.73c-55.37 32.52-95.86 87.32-109.54 152h49.4c11.3-41.61 36.77-77.21 71.04-101.56-3.7-8.08-5.88-16.99-5.88-26.44V88zm-48 232H64c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32zM576 48c-26.84 0-49.75 16.56-59.25 40H432v72c0 9.45-2.19 18.36-5.88 26.44 34.27 24.35 59.74 59.95 71.04 101.56h49.4c-13.68-64.68-54.17-119.48-109.54-152h79.73c9.5 23.44 32.41 40 59.25 40 35.34 0 64-28.65 64-64s-28.66-64-64-64zm0 272h-96c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32z"}))),Nhe=ge.span(Ahe||(Ahe=H([`
  margin-right: 4px;
  `,`;

  `,`:hover & {
    color: #ccc;
  }
`])),Tf,mj),Rhe=ge.div(Phe||(Phe=H([`
  margin-right: auto;
  margin-left: 8px;
  display: flex;
  align-items: center;
  min-width: 0;
  flex: 1;

  /* Override some default input styles to fit in the row */
  input {
    font-size: 11px;
    height: 24px;
    padding: 2px 4px;
  }
`]))),Ihe=({leaf:a})=>{var u;let d=ib(a.sheetObject.propsP,a.pathToProp),g=a.sheetObject,_=Ake(d,g,a.propConf),T=di(()=>{let K=a.sheetObject.address,J=Pf(a.pathToProp);return(0,bhe.val)(ce().atomP.historic.projects.stateByProjectId[K.projectId].stateBySheetId[K.sheetId].sequenceEditor.selectedPropsByObject[K.objectKey][J])},[a]),N=(0,Yu.useRef)(!1),R=typeof T=="string";N.current=R;let O=(0,Yu.useCallback)(()=>{let K=a.sheetObject.address;ce().transaction(({stateEditors:J})=>{N.current?J.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.removePropFromGraphEditor(U(P({},K),{pathToProp:a.pathToProp})):a.trackId&&(J.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.addPropToGraphEditor(U(P({},K),{pathToProp:a.pathToProp})),J.studio.historic.panels.sequenceEditor.graphEditor.setIsOpen({isOpen:!0}))})},[a]),B=(u=a.propConf.label)!=null?u:a.pathToProp[a.pathToProp.length-1],V=!!a.trackId,Y=(0,Yu.useRef)(null);mV(Y.current,a);let[W]=oc(Y.current,{menuItems:_.contextMenuItems}),$=qV[a.propConf.type];return Yu.default.createElement(whe,{depth:a.depth},W,Yu.default.createElement(mj,{ref:Y,isEven:a.n%2===0,style:{height:a.nodeHeight+"px"},isSelected:R===!0},Yu.default.createElement(Nhe,null,B),Yu.default.createElement(Rhe,null,Yu.default.createElement($,{editingTools:_,propConfig:a.propConf,value:_.value})),_.controlIndicators,Yu.default.createElement(Mhe,{onClick:O,isSelected:R===!0,graphEditorColor:T??"1",style:{opacity:V?1:.25},disabled:!V},Yu.default.createElement(Che,null))))},khe=Ihe}),Eb,FI,Dhe,Ohe=C(()=>{Eb=z(nt()),YR(),vOe(),nj(),tle(),JT(),FI=(a,u=!0)=>{let d="prop"+a.pathToProp[a.pathToProp.length-1];return a.shouldRender?a.type==="propWithChildren"?Eb.default.createElement(Dhe,{leaf:a,key:d,renderChildren:u}):Eb.default.createElement(khe,{leaf:a,key:d}):Eb.default.createElement(Eb.default.Fragment,{key:d})},Dhe=({leaf:a,renderChildren:u=!0})=>{var d;let g=ib(a.sheetObject.propsP,a.pathToProp),_=ele(g,a.sheetObject,a.propConf);return Eb.default.createElement(sG,{leaf:a,label:(d=a.propConf.label)!=null?d:a.pathToProp[a.pathToProp.length-1],isCollapsed:a.isCollapsed,contextMenuItems:_.contextMenuItems,toggleCollapsed:()=>wb(!a.isCollapsed,{sheetAddress:a.sheetObject.address,sheetItemKey:a.sheetItemKey})},u&&a.children.map(T=>FI(T)))}}),Lhe,Fhe,Bhe,Uhe,xOe=C(()=>{Lhe=z(nt()),YR(),Ohe(),nj(),Pe(),tle(),Ar(),Fhe=un(),QR(),lue(),Bhe=({leaf:a,renderChildren:u=!0,layoutP:d})=>{let g=a.sheetObject,_=ele(g.propsP,g,g.template.staticConfig),T=di(()=>{var N;let R=ZR(a),O=R.byPosition.size>0,B=(N=(0,Fhe.pointerToPrism)(ce().atomP.ahistoric.clipboard.keyframesWithRelativePaths).getValue())!=null?N:[];return[{label:"Copy Keyframes",enabled:O,callback:()=>aue(a,R)},{label:"Paste Keyframes",enabled:B.length>0,callback:()=>sue(a,d,B)}]},[a,d]);return Lhe.default.createElement(sG,{leaf:a,label:a.sheetObject.address.objectKey,isCollapsed:a.isCollapsed,contextMenuItems:[..._.contextMenuItems,...T],toggleSelect:()=>{ce().transaction(({stateEditors:N})=>{N.studio.historic.panels.outline.selection.set([a.sheetObject])})},toggleCollapsed:()=>wb(!a.isCollapsed,{sheetAddress:a.sheetObject.address,sheetItemKey:a.sheetItemKey})},u&&a.children.map(N=>FI(N)))},Uhe=Bhe}),AE,gj,zhe,Vhe,Ghe,yj,jhe,Hhe,$he,Whe,bOe=C(()=>{AE=z(nt()),tn(),YR(),Z2(),gV(),Pe(),ac(),gj=un(),Vhe=ge.li(zhe||(zhe=H([`
  --depth: `,`;
  margin: 0;
  padding: 0;
  list-style: none;
`])),a=>a.depth-1),yj=ge(XR)(Ghe||(Ghe=H([`
  padding-left: calc(var(--depth) * 10px);
  display: flex;
  align-items: stretch;
  color: #999;
  box-sizing: border-box;

  &:hover {
    background: rgba(255, 255, 255, 0.05);
  }
`]))),Hhe=ge.span(jhe||(jhe=H([`
  `,`;
  overflow-x: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  padding-right: 4px;
  padding-left: 20px;
  line-height: 26px;
  flex-wrap: nowrap;
  color: #ccc;

  `,`:hover & {
    color: #fff;
  }
`])),Tf,yj),$he=({leaf:a})=>{let u=(0,AE.useRef)(null);mV(u.current,a);let d=a.subSequence.label===void 0?"":a.subSequence.label,g="".concat(d," (").concat(a.subSequence.sheetId,")"),[_]=oc(u.current,{menuItems:()=>[{label:"Edit Label",callback:()=>{let T=prompt("Enter new label:",a.subSequence.label);T!==null&&T.trim()!==""&&ce().transaction(({stateEditors:N})=>{N.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateSubSequence({sheetAddress:a.sheet.address,subSequenceId:a.subSequence.id,updates:{label:T.trim()}})})}},{label:"Edit Duration",callback:()=>{var T,N;let R=(T=a.subSequence.duration)!=null?T:0;if(R===0){let B=ce(),V=(0,gj.val)(B.projectsP)[a.sheet.address.projectId];R=(N=(0,gj.val)(V.pointers.historic.sheetsById[a.subSequence.sheetId].sequence.length))!=null?N:0}let O=prompt("Enter new duration (seconds):",String(R));if(O!==null){let B=parseFloat(O);!isNaN(B)&&B>0&&ce().transaction(({stateEditors:V})=>{V.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateSubSequence({sheetAddress:a.sheet.address,subSequenceId:a.subSequence.id,updates:{duration:B}})})}}},{label:"Edit Time Scale",callback:()=>{var T;let N=(T=a.subSequence.timeScale)!=null?T:1,R=prompt("Enter new time scale:",String(N));if(R!==null){let O=parseFloat(R);!isNaN(O)&&O>0&&ce().transaction(({stateEditors:B})=>{B.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateSubSequence({sheetAddress:a.sheet.address,subSequenceId:a.subSequence.id,updates:{timeScale:O}})})}}},{label:"Delete Sub-sequence",callback:()=>{confirm('Are you sure you want to delete sub-sequence "'.concat(a.subSequence.label,'"?'))&&ce().transaction(({stateEditors:T})=>{T.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.removeSubSequence({sheetAddress:a.sheet.address,subSequenceId:a.subSequence.id})})}}]});return a.shouldRender?AE.default.createElement(Vhe,{depth:a.depth},_,AE.default.createElement(yj,{ref:u,style:{height:a.nodeHeight+"px"},isEven:a.n%2===0},AE.default.createElement(Hhe,null,g))):null},Whe=$he}),NE,Oo,qhe,Xhe,Yhe,Khe,Zhe,Qhe,_Oe=C(()=>{Ar(),NE=un(),Oo=z(nt()),tn(),xOe(),bOe(),Rke(),wf(),tj(),fde(),Ef(),Mf(),mde(),JR(),Ohe(),Xhe=ge.div(qhe||(qhe=H([`
  position: absolute;
  left: 0;
  overflow-x: visible;

  &.drop-target {
    background: rgba(64, 170, 164, 0.1);
    outline: 2px dashed rgba(64, 170, 164, 0.5);
    outline-offset: -2px;
  }
`]))),Khe=ge.div(Yhe||(Yhe=H([`
  margin: 0 0 50px 0;
  padding: 0;
  position: relative;
`]))),Zhe=({layoutP:a})=>{let{searchTerm:u,searchTrigger:d}=ej(),[g,_]=(0,Oo.useState)(!1),[T,N]=(0,Oo.useState)(null),R=(0,Oo.useRef)(null),O=yG();(0,Oo.useLayoutEffect)(()=>{let K=R.current;if(!K)return;let J=oe=>{oe.stopPropagation()};return K.addEventListener("wheel",J,{passive:!0}),()=>K.removeEventListener("wheel",J)},[]);let B=qu({debugName:"Left/addSubSequence"},()=>{if(!T)return Oo.default.createElement(Oo.default.Fragment,null);let K=T.sheetId;return Oo.default.createElement(Xu,null,Oo.default.createElement("div",{style:{padding:"8px",minWidth:"300px"}},Oo.default.createElement("div",{style:{marginBottom:"8px",fontWeight:"bold",color:"#CCC"}},"Add Sub-sequence"),Oo.default.createElement("div",{style:{marginBottom:"4px",fontSize:"11px",color:"#999"}},"Label:"),Oo.default.createElement("input",{type:"text",defaultValue:T.sheetId,onChange:J=>{K=J.target.value},style:{width:"100%",padding:"6px 8px",marginBottom:"12px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"2px",color:"#FFF",fontSize:"11px"},autoFocus:!0,onKeyDown:J=>{J.key==="Enter"?((0,NE.val)(a.sheet).getSequence().addSubSequence(T.sheetId,0,{label:K.trim()||T.sheetId}),B.close("user action"),N(null)):J.key==="Escape"&&(B.close("user action"),N(null))}}),Oo.default.createElement("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"}},Oo.default.createElement("button",{onClick:()=>{B.close("user action"),N(null)},style:{padding:"6px 12px",background:"rgba(255, 255, 255, 0.1)",color:"#CCC",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"2px",cursor:"pointer",fontSize:"11px"}},"Cancel"),Oo.default.createElement("button",{onClick:()=>{(0,NE.val)(a.sheet).getSequence().addSubSequence(T.sheetId,0,{label:K.trim()||T.sheetId}),B.close("user action"),N(null)},style:{padding:"6px 12px",background:"#40AAA4",color:"white",border:"none",borderRadius:"2px",cursor:"pointer",fontSize:"11px"}},"Ok"))))}),V=(0,Oo.useCallback)(K=>{K.preventDefault(),K.stopPropagation(),_(!0)},[]),Y=(0,Oo.useCallback)(K=>{K.preventDefault(),K.stopPropagation(),_(!1);try{let J=K.dataTransfer.getData("application/json");if(!J)return;let oe=JSON.parse(J);if(oe.type!=="theatre-sheet")return;N({sheetId:oe.sheetId,projectId:oe.projectId,sheetInstanceId:oe.sheetInstanceId}),R.current&&B.open({clientX:K.clientX,clientY:K.clientY},R.current)}catch(J){console.error("Error handling drop:",J)}},[B]),{scrollTop:W,clientHeight:$}=ti(O);return di(()=>{let K=(0,NE.val)(a.tree),J=(0,NE.val)(a.leftDims.width),oe=u.trim()?dde(K,u):K,ae=ij(oe),ue=[],xe=500,Re=W-xe,Ae=W+$+xe,we=-1;for(let Se=0;Se<ae.length;Se++){let Ge=ae[Se];if(Ge.top+Ge.nodeHeight>=Re){we=Se;break}}if(we!==-1)for(let Se=we;Se<ae.length;Se++){let Ge=ae[Se];if(Ge.top>Ae)break;ue.push(Ge)}let ft=ae[ae.length-1],Le=ft?ft.top+ft.nodeHeight:0;return Oo.default.createElement(Oo.default.Fragment,null,B.node,Oo.default.createElement(Xhe,{id:"leftContainer",ref:R,style:{width:J+"px",top:0,pointerEvents:T!==null?"none":"auto"},className:g?"drop-target":"",onDragOver:V,onDrop:Y},Oo.default.createElement(Khe,{style:{height:Le+"px"}},ue.map(Se=>{let Ge=null;return Se.type==="subSequence"?Ge=Oo.default.createElement(Whe,{key:jl.forSubSequence(Se.subSequence.id),leaf:Se}):Se.type==="sheetObject"?Ge=Oo.default.createElement(Uhe,{key:"sheetObject-"+Pke(Se.sheetObject),leaf:Se,renderChildren:!1,layoutP:a}):(Se.type==="propWithChildren"||Se.type==="primitiveProp")&&(Ge=FI(Se,!1)),Ge?Oo.default.createElement("div",{key:Se.type+"-"+(Se.sheetItemKey||Se.top),style:{position:"absolute",top:Se.top+"px",width:"100%"}},Ge):null}))))},[a,u,d,g,T,V,Y,B.node,W,$])},Qhe=Zhe}),BI,UI,Jhe,epe,tpe,npe,SOe=C(()=>{ls(),Pe(),va(),BI=un(),UI=z(nt()),tn(),Ar(),epe=ge.div(Jhe||(Jhe=H([`
  position: absolute;
  top: 0;
  bottom: 0;
  width: 11px;
  margin-left: -5px;
  cursor: ew-resize;
  z-index: 1;
  pointer-events: auto;

  &:hover,
  &.isDragging {
    background: linear-gradient(
      to right,
      transparent 5px,
      #478698 5px,
      #478698 6px,
      transparent 6px
    );
  }
`]))),tpe=({layoutP:a})=>{let u=ti(a.leftDims.width),[d,g]=Ni(null),_=(0,UI.useRef)(0),T=(0,UI.useMemo)(()=>({debugName:"DopesheetSplitter",lockCursorTo:"ew-resize",onDragStart(){var R;let O;return _.current=(R=(0,BI.val)(ce().atomP.historic.panels.sequenceEditor.dopesheetLeftWidth))!=null?R:(0,BI.val)(a.leftDims.width),{onDrag(B){let V=(0,BI.val)(a.dopeSheetDims.width)-100,Y=Math.min(V,Math.max(225,_.current+B));O==null||O.discard(),O=ce().tempTransaction(({stateEditors:W})=>{W.studio.historic.panels.sequenceEditor.setDopesheetLeftWidth(Y)})},onDragEnd(B){B?O==null||O.commit():O==null||O.discard()}}}}),[]),[N]=wo(g,T);return UI.default.createElement(epe,{ref:d,className:N?"isDragging":"",style:{left:"".concat(u,"px")}})},npe=tpe}),vj,rpe,ipe,spe,ope,wOe=C(()=>{ms(),F1(),Ar(),vf(),vj=z(nt()),tn(),phe(),ipe=ge.div(rpe||(rpe=H([`
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  z-index: `,`;
  overflow: hidden;
  background: `,`;
  pointer-events: none;
`])),()=>Of.rightBackground,w1(.01,uz(1*.03,$7.panel.bg))),spe=({layoutP:a})=>{let u=ti(a.rightDims.width),d=ti(a.panelDims.height);return vj.default.createElement(ipe,{style:{width:u+"px"}},vj.default.createElement(fj,{width:u,height:d,layoutP:a}))},ope=spe}),L8,ape,lpe,cpe,upe,TOe=C(()=>{Ar(),L8=z(nt()),tn(),_Oe(),SOe(),wOe(),sj(),JR(),lpe=ge.div(ape||(ape=H([`
  position: absolute;
  left: 0;
  right: 0;
`]))),cpe=({layoutP:a})=>{let u=ti(a.dopeSheetDims.height);return L8.default.createElement(lpe,{style:{height:u+"px"}},L8.default.createElement(ope,{layoutP:a}),L8.default.createElement(jle,null,L8.default.createElement(Qhe,{layoutP:a}),L8.default.createElement(_de,{layoutP:a})),L8.default.createElement(npe,{layoutP:a}))},upe=cpe});function EOe(a,u,d){return xj.prism.memo(a,()=>(0,xj.prism)(u),d).getValue()}var xj,MOe=C(()=>{xj=un()});function co(a){return function(u,d){return a(u,d())}}function Qd(a){return Object.freeze({audience:F8(a,8)?"internal":F8(a,16)?"dev":"public",category:F8(a,4)?"troubleshooting":F8(a,2)?"todo":"general",level:F8(a,512)?512:F8(a,256)?256:F8(a,128)?128:64})}function F8(a,u){return(a&u)===u}function uo(a,u){return((u&32)===32?!0:(u&16)===16?a.dev:(u&8)===8?a.internal:!1)&&a.min<=u}function dpe(a=console,u={}){let d=U(P({},k1),{includes:P({},k1.includes)}),g={styled:NOe.bind(d,a),noStyle:ROe.bind(d,a)},_=AOe.bind(d);function T(){return d.loggingConsoleStyle&&d.loggerConsoleStyle?g.styled:g.noStyle}return d.create=T(),{configureLogger(N){var R;N==="console"?(d.loggerConsoleStyle=k1.loggerConsoleStyle,d.create=T()):N.type==="console"?(d.loggerConsoleStyle=(R=N.style)!=null?R:k1.loggerConsoleStyle,d.create=T()):N.type==="keyed"?(d.creatExt=O=>N.keyed(O.names),d.create=_):N.type==="named"&&(d.creatExt=COe.bind(null,N.named),d.create=_)},configureLogging(N){var R,O,B,V,Y;d.includes.dev=(R=N.dev)!=null?R:k1.includes.dev,d.includes.internal=(O=N.internal)!=null?O:k1.includes.internal,d.includes.min=(B=N.min)!=null?B:k1.includes.min,d.include=(V=N.include)!=null?V:k1.include,d.loggingConsoleStyle=(Y=N.consoleStyle)!=null?Y:k1.loggingConsoleStyle,d.create=T()},getLogger(){return d.create({names:[]})}}}function COe(a,u){let d=[];for(let{name:g,key:_}of u.names)d.push(_==null?g:"".concat(g," (").concat(_,")"));return a(d)}function AOe(a){let u=P(P({},this.includes),this.include(a)),d=this.filtered,g=this.named.bind(this,a),_=this.creatExt(a),T=uo(u,524),N=uo(u,522),R=uo(u,521),O=uo(u,529),B=uo(u,545),V=uo(u,265),Y=uo(u,268),W=uo(u,273),$=uo(u,289),K=uo(u,137),J=uo(u,145),oe=uo(u,73),ae=uo(u,81),ue=T?_.error.bind(_,Ku._hmm):d.bind(a,524),xe=N?_.error.bind(_,Ku._todo):d.bind(a,522),Re=R?_.error.bind(_,Ku._error):d.bind(a,521),Ae=O?_.error.bind(_,Ku.errorDev):d.bind(a,529),we=B?_.error.bind(_,Ku.errorPublic):d.bind(a,545),ft=Y?_.warn.bind(_,Ku._kapow):d.bind(a,268),Le=V?_.warn.bind(_,Ku._warn):d.bind(a,265),Se=W?_.warn.bind(_,Ku.warnDev):d.bind(a,273),Ge=$?_.warn.bind(_,Ku.warnPublic):d.bind(a,273),Je=K?_.debug.bind(_,Ku._debug):d.bind(a,137),He=J?_.debug.bind(_,Ku.debugDev):d.bind(a,145),Bt=oe?_.trace.bind(_,Ku._trace):d.bind(a,73),Qe=ae?_.trace.bind(_,Ku.traceDev):d.bind(a,81),Zt={_hmm:ue,_todo:xe,_error:Re,errorDev:Ae,errorPublic:we,_kapow:ft,_warn:Le,warnDev:Se,warnPublic:Ge,_debug:Je,debugDev:He,_trace:Bt,traceDev:Qe,lazy:{_hmm:T?co(ue):ue,_todo:N?co(xe):xe,_error:R?co(Re):Re,errorDev:O?co(Ae):Ae,errorPublic:B?co(we):we,_kapow:Y?co(ft):ft,_warn:V?co(Le):Le,warnDev:W?co(Se):Se,warnPublic:$?co(Ge):Ge,_debug:K?co(Je):Je,debugDev:J?co(He):He,_trace:oe?co(Bt):Bt,traceDev:ae?co(Qe):Qe},named:g,utilFor:{internal(){return{debug:Zt._debug,error:Zt._error,warn:Zt._warn,trace:Zt._trace,named(gt,it){return Zt.named(gt,it).utilFor.internal()}}},dev(){return{debug:Zt.debugDev,error:Zt.errorDev,warn:Zt.warnDev,trace:Zt.traceDev,named(gt,it){return Zt.named(gt,it).utilFor.dev()}}},public(){return{error:Zt.errorPublic,warn:Zt.warnPublic,debug(gt,it){Zt._warn('(public "debug" filtered out) '.concat(gt),it)},trace(gt,it){Zt._warn('(public "trace" filtered out) '.concat(gt),it)},named(gt,it){return Zt.named(gt,it).utilFor.public()}}}}};return Zt}function NOe(a,u){let d=P(P({},this.includes),this.include(u)),g=[],_="";for(let O=0;O<u.names.length;O++){let{name:B,key:V}=u.names[O];if(_+=" %c".concat(B),g.push(this.style.css(B)),V!=null){let Y="%c#".concat(V);_+=Y,g.push(this.style.css(Y))}}let T=this.filtered,N=this.named.bind(this,u),R=[_,...g];return hpe(T,u,d,a,R,POe(R),N)}function POe(a){let u=a.slice(0);for(let d=1;d<u.length;d++)u[d]+=";background-color:#e0005a;padding:2px;color:white";return u}function ROe(a,u){let d=P(P({},this.includes),this.include(u)),g="";for(let R=0;R<u.names.length;R++){let{name:O,key:B}=u.names[R];g+=" ".concat(O),B!=null&&(g+="#".concat(B))}let _=this.filtered,T=this.named.bind(this,u),N=[g];return hpe(_,u,d,a,N,N,T)}function hpe(a,u,d,g,_,T,N){let R=uo(d,524),O=uo(d,522),B=uo(d,521),V=uo(d,529),Y=uo(d,545),W=uo(d,265),$=uo(d,268),K=uo(d,273),J=uo(d,289),oe=uo(d,137),ae=uo(d,145),ue=uo(d,73),xe=uo(d,81),Re=R?g.error.bind(g,..._):a.bind(u,524),Ae=O?g.error.bind(g,..._):a.bind(u,522),we=B?g.error.bind(g,..._):a.bind(u,521),ft=V?g.error.bind(g,..._):a.bind(u,529),Le=Y?g.error.bind(g,..._):a.bind(u,545),Se=$?g.warn.bind(g,...T):a.bind(u,268),Ge=W?g.warn.bind(g,..._):a.bind(u,265),Je=K?g.warn.bind(g,..._):a.bind(u,273),He=J?g.warn.bind(g,..._):a.bind(u,273),Bt=oe?g.info.bind(g,..._):a.bind(u,137),Qe=ae?g.info.bind(g,..._):a.bind(u,145),Zt=ue?g.debug.bind(g,..._):a.bind(u,73),gt=xe?g.debug.bind(g,..._):a.bind(u,81),it={_hmm:Re,_todo:Ae,_error:we,errorDev:ft,errorPublic:Le,_kapow:Se,_warn:Ge,warnDev:Je,warnPublic:He,_debug:Bt,debugDev:Qe,_trace:Zt,traceDev:gt,lazy:{_hmm:R?co(Re):Re,_todo:O?co(Ae):Ae,_error:B?co(we):we,errorDev:V?co(ft):ft,errorPublic:Y?co(Le):Le,_kapow:$?co(Se):Se,_warn:W?co(Ge):Ge,warnDev:K?co(Je):Je,warnPublic:J?co(He):He,_debug:oe?co(Bt):Bt,debugDev:ae?co(Qe):Qe,_trace:ue?co(Zt):Zt,traceDev:xe?co(gt):gt},named:N,utilFor:{internal(){return{debug:it._debug,error:it._error,warn:it._warn,trace:it._trace,named(Ce,ut){return it.named(Ce,ut).utilFor.internal()}}},dev(){return{debug:it.debugDev,error:it.errorDev,warn:it.warnDev,trace:it.traceDev,named(Ce,ut){return it.named(Ce,ut).utilFor.dev()}}},public(){return{error:it.errorPublic,warn:it.warnPublic,debug(Ce,ut){it._warn('(public "debug" filtered out) '.concat(Ce),ut)},trace(Ce,ut){it._warn('(public "trace" filtered out) '.concat(Ce),ut)},named(Ce,ut){return it.named(Ce,ut).utilFor.public()}}}}};return it}var Ku,k1,ppe=C(()=>{Ku={_hmm:Qd(524),_todo:Qd(522),_error:Qd(521),errorDev:Qd(529),errorPublic:Qd(545),_kapow:Qd(268),_warn:Qd(265),warnDev:Qd(273),warnPublic:Qd(289),_debug:Qd(137),debugDev:Qd(145),_trace:Qd(73),traceDev:Qd(81)},k1={loggingConsoleStyle:!0,loggerConsoleStyle:!0,includes:Object.freeze({internal:!1,dev:!1,min:256}),filtered:function(){},include:function(){return{}},create:null,creatExt:null,named(a,u,d){return this.create({names:[...a.names,{name:u,key:d}]})},style:{bold:void 0,italic:void 0,cssMemo:new Map([["",""]]),collapseOnRE:/[a-z- ]+/g,color:void 0,collapsed(a){if(a.length<5)return a;let u=a.replace(this.collapseOnRE,"");return this.cssMemo.has(u)||this.cssMemo.set(u,this.css(a)),u},css(a){var u,d,g,_;let T=this.cssMemo.get(a);if(T)return T;let N="color:".concat((d=(u=this.color)==null?void 0:u.call(this,a))!=null?d:"hsl(".concat((a.charCodeAt(0)+a.charCodeAt(a.length-1))%360,", 100%, 60%)"));return(g=this.bold)!=null&&g.test(a)&&(N+=";font-weight:600"),(_=this.italic)!=null&&_.test(a)&&(N+=";font-style:italic"),this.cssMemo.set(a,N),N}}}}),bj,zI,VI=C(()=>{ppe(),ppe(),bj=dpe(console,{}),bj.configureLogging({dev:!0,min:64}),zI=bj.getLogger().named("Theatre.js (default logger)").utilFor.dev()}),s3,X4,fpe,IOe=C(()=>{wf(),s3=un(),VI(),X4=28,fpe=(a,u)=>{s3.prism.ensurePrism();let d=!1,g=30,_=0,T=u.atomP.ahistoric.projects.stateByProjectId[a.address.projectId].stateBySheetId[a.address.sheetId].sequence.collapsableItems,N={type:"sheet",isCollapsed:!1,sheet:a,children:[],sheetItemKey:jl.forSheet(),shouldRender:d,top:60,depth:0,n:_,nodeHeight:0,heightIncludingChildren:-1};for(let K of Object.values((0,s3.val)(a.objectsP)))K&&B(K,N.children,N.depth+1,!0);let R=(0,s3.val)(u.atomP.historic.projects.stateByProjectId[a.address.projectId].stateBySheetId[a.address.sheetId]),O=(0,s3.val)(R.sequenceEditor);if(O){let K=O.subSequenceSet;if(K){let J=Object.values(K.byId||{}).filter(oe=>oe!==void 0).map(oe=>oe).sort((oe,ae)=>oe.position-ae.position);for(let oe of J){let ae={type:"subSequence",subSequence:oe,sheet:a,sheetItemKey:jl.forSubSequence(oe.id),shouldRender:!0,top:g,depth:N.depth+1,n:_,nodeHeight:X4,heightIncludingChildren:X4};N.children.push(ae),g+=X4,_+=1}}}N.heightIncludingChildren=g-N.top;function B(K,J,oe,ae){var ue;let xe=(0,s3.val)(K.template.getMapOfValidSequenceTracks_forStudio()),Re=(0,s3.val)(K.template.configPointer);if(Object.keys(Re.props).length===0)return;let Ae=(ue=(0,s3.val)(T.byId[jl.forSheetObject(K)].isCollapsed))!=null?ue:!0,we={type:"sheetObject",isCollapsed:Ae,sheetItemKey:jl.forSheetObject(K),shouldRender:ae,top:g,children:[],depth:oe,n:_,sheetObject:K,nodeHeight:X4,heightIncludingChildren:-1};J.push(we),_+=1,g+=we.nodeHeight,V(K,Re.props,xe,[],Re,we.children,oe+1,!Ae),we.heightIncludingChildren=g-we.top}function V(K,J,oe,ae,ue,xe,Re,Ae){for(let[we,ft]of Object.entries(J)){let Le=oe[we];Y(K,Le,[...ae,we],ft,xe,Re,Ae)}}function Y(K,J,oe,ae,ue,xe,Re){ae.type==="compound"?W(K,J||{},ae,oe,ae,ue,xe,Re):ae.type==="enum"?zI.warn("Prop type enum is not yet supported in the sequence editor"):$(K,J,oe,ae,ue,xe,Re)}function W(K,J,oe,ae,ue,xe,Re,Ae){var we;let ft=(we=(0,s3.val)(T.byId[jl.forSheetObjectProp(K,ae)].isCollapsed))!=null?we:!1,Le={type:"propWithChildren",isCollapsed:ft,propConf:oe,pathToProp:ae,sheetItemKey:jl.forSheetObjectProp(K,ae),sheetObject:K,shouldRender:Ae,top:g,children:[],nodeHeight:Ae?X4:0,heightIncludingChildren:-1,depth:Re,trackMapping:J,n:_};xe.push(Le),Ae&&(g+=Le.nodeHeight,_+=1),V(K,ue.props,J,ae,ue,Le.children,Re+1,Ae&&!ft),Le.heightIncludingChildren=g-Le.top}function $(K,J,oe,ae,ue,xe,Re){let Ae={type:"primitiveProp",propConf:ae,depth:xe,sheetItemKey:jl.forSheetObjectProp(K,oe),sheetObject:K,pathToProp:oe,shouldRender:Re,top:g,nodeHeight:Re?X4:0,heightIncludingChildren:Re?X4:0,trackId:J,n:_};ue.push(Ae),_+=1,g+=Ae.nodeHeight}return N}});function kOe(a,u){let d=ce(),g=d.atomP.ahistoric.projects.stateByProjectId[a.address.projectId].stateBySheetId[a.address.sheetId],_=d.atomP.historic.projects.stateByProjectId[a.address.projectId].stateBySheetId[a.address.sheetId];return(0,Hl.prism)(()=>{var T,N,R;let O=EOe("tree",()=>fpe(a,d),[]),B=(0,Hl.val)(u),V=(0,Hl.val)(d.atomP.historic.panels.sequenceEditor.graphEditor),Y=d.atomP.historic.panels.sequenceEditor.rightPanelOpen,W=(T=(0,Hl.val)(Y))!=null?T:!0,$=(0,Hl.val)(_.sequenceEditor.selectedPropsByObject),K=!!$&&Object.keys($).length>0,J=(N=(0,Hl.val)(d.atomP.historic.panels.sequenceEditor.dopesheetLeftWidth))!=null?N:Math.floor(B.width*mpe),{leftDims:oe,rightDims:ae,graphEditorDims:ue,dopeSheetDims:xe,horizontalScrollbarDims:Re}=Hl.prism.memo("leftDims",()=>{var gt,it;let Ce=(gt=(0,Hl.val)(Y))!=null?gt:!0,ut={width:J,height:B.height,screenX:B.screenX,screenY:B.screenY},kt={width:Ce?B.width-ut.width:0,height:B.height,screenX:B.screenX+ut.width,screenY:B.screenY},De=K&&(V==null?void 0:V.isOpen)===!0,at=Math.floor((De?os((it=V==null?void 0:V.height)!=null?it:.5,.1,.7):0)*B.heightWithoutBorder),$t=B.height,Qt={width:B.width,height:$t,screenX:B.screenX,screenY:B.screenY},Et={isAvailable:K,isOpen:De,width:kt.width,height:at,screenX:B.screenX,screenY:B.screenY+$t,padding:{top:20,bottom:20}};return{leftDims:ut,rightDims:kt,graphEditorDims:Et,dopeSheetDims:Qt,horizontalScrollbarDims:{bottom:0}}},[B,V,K,Y,J]),Ae=Hl.prism.memo("graphEditorVerticalSpace",()=>{let gt=ue.height-ue.padding.top-ue.padding.bottom;return{space:gt,fromExtremumSpace(it){return it*gt},toExtremumSpace(it){return it/gt}}},[ue]),[we,ft]=Hl.prism.state("isSeeking",!1),Le={isSeeking:we,setIsSeeking:ft},Se={},Ge=(R=(0,Hl.val)(g.sequence.clippedSpaceRange))!=null?R:gpe,Je=Hl.prism.memo("scaledSpace",()=>{let gt=Ge.end-Ge.start,it=ae.width,Ce=gt/it,ut=it/gt;return{fromUnitSpace(kt){return kt*ut},toUnitSpace(kt){return kt*Ce},leftPadding:10}},[Ge,ae.width]),He=Hl.prism.memo("setClippedSpaceRange",()=>function(gt){d.transaction(({stateEditors:it})=>{let Ce=P({},gt);if(Ce.end<=Ce.start&&(Ce.end=Ce.start+1),Ce.start<0){let ut=Ce.end-Ce.start;Ce.start=0,Ce.end=ut}it.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.clippedSpaceRange.set(U(P({},a.address),{range:Ce}))})},[]),Bt=Hl.prism.memo("clippedSpace",()=>({range:Ge,width:ae.width,fromUnitSpace(gt){return Je.fromUnitSpace(gt-Ge.start)+Je.leftPadding},toUnitSpace(gt){return Je.toUnitSpace(gt-Je.leftPadding)+Ge.start},setRange:He}),[Ge,ae.width,Je,He]),Qe=Hl.prism.memo("selection.current",()=>new Hl.Atom({current:void 0}),[]),Zt=Hl.prism.memo("setRightPanelOpen",()=>function(gt){d.transaction(({stateEditors:it})=>{it.studio.historic.panels.sequenceEditor.setRightPanelOpen(gt)})},[]);return fV("finalAtom",{sheet:a,tree:O,panelDims:B,leftDims:oe,rightDims:ae,dopeSheetDims:xe,horizontalScrollbarDims:Re,seeker:Le,unitSpace:Se,scaledSpace:Je,clippedSpace:Bt,graphEditorDims:ue,graphEditorVerticalSpace:Ae,selectionAtom:Qe,rightPanelOpen:W,setRightPanelOpen:Zt}).pointer})}var Hl,mpe,gpe,_j,DOe=C(()=>{Pe(),MOe(),gie(),Hl=un(),IOe(),b0(),mpe=.3,gpe={start:0,end:10},_j=250});function OOe(a){let{fullSecondStampsContainer:u,sequencePositionFormatter:d,snapToGrid:g,unitSpaceToClippedSpace:_}=a,T="";nhe(a,(N,R)=>{let O=g(N),B=_(O);R?T+=ype(d.formatFullUnitForGrid(O),B,"full-unit"):T+=ype(d.formatSubUnitForGrid(O),B,"sub-unit")}),u.innerHTML=T}function ype(a,u,d){return'<span class="'.concat(d,'" style="transform: translate3d(').concat(u.toFixed(1),'px, -50%, 0);">').concat(a,"</span>")}var B8,U8,vpe,xpe,z8,bpe,_pe,Spe,wpe,Tpe,Epe,Mpe=C(()=>{B8=un(),U8=z(nt()),tn(),ihe(),Pe(),xpe=ge.div(vpe||(vpe=H([`
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  pointer-events: none;
`]))),z8={fullUnitStampColor:"#999999",stampFontSize:"10px",subUnitStampColor:"#666666"},_pe=ge.div(bpe||(bpe=H([`
  position: absolute;
  top: 0;
  height: 100%;
  left: 0;
  overflow: hidden;
  z-index: 2;
  will-change: transform;
  pointer-events: none;
`]))),wpe=ge.div(Spe||(Spe=H([`
  position: absolute;
  top: 0;
  left: 0;

  & > span {
    position: absolute;
    display: block;
    top: 9px;
    left: -10px;
    color: `,`;
    text-align: center;
    font-size: `,`;
    width: 20px;

    &.full-unit {
      color: `,`;
    }

    &.sub-unit {
      color: `,`;
    }
  }

  pointer-events: none;
`])),z8.fullUnitStampColor,z8.stampFontSize,z8.fullUnitStampColor,z8.subUnitStampColor),Tpe=({layoutP:a,width:u})=>{let d=(0,U8.useRef)(null),[g,_]=(0,U8.useState)(null);return(0,U8.useLayoutEffect)(()=>{if(g)return(0,B8.prism)(()=>{let T=(0,B8.val)(a.sheet).getSequence();return{fullSecondStampsContainer:g,clippedSpaceRange:(0,B8.val)(a.clippedSpace.range),clippedSpaceWidth:(0,B8.val)(a.clippedSpace.width),unitSpaceToClippedSpace:(0,B8.val)(a.clippedSpace.fromUnitSpace),leftPadding:(0,B8.val)(a.scaledSpace.leftPadding),fps:T.subUnitsPerUnit,sequencePositionFormatter:T.positionFormatter,snapToGrid:N=>T.closestGridPosition(N)}}).onChange(ce().ticker,OOe,!0)},[g,u,a]),U8.default.createElement(xpe,{ref:d,style:{width:u+"px"}},U8.default.createElement(_pe,{style:{width:u+"px"}},U8.default.createElement(wpe,{ref:_})))},Epe=Tpe});function LOe(a){let[u,d]=(0,Sj.useState)(!1);return(0,Sj.useEffect)(()=>{if(d(!1),!a)return;let g=T=>{T.target===a?d(!0):d(!1)},_=()=>{d(!1)};return a.addEventListener("mouseenter",g),a.addEventListener("mousemove",g),a.addEventListener("mouseleave",_),()=>{d(!1),a.removeEventListener("mouseenter",g),a.removeEventListener("mousemove",g),a.removeEventListener("mouseleave",_)}},[a]),u}var Sj,FOe=C(()=>{Sj=z(nt())});function BOe(a,u){let d=0,[g,_]=a,[T,N]=u;return _-g>N-T?[T,N]:(g<T&&(d=0-g),_>N&&(d=N-_),[g+d,_+d])}var D1,Y4,Ka,wj,Cpe,GI,Ape,Npe,Ppe=C(()=>{D1=un(),Ar(),ms(),Pe(),G8(),ac(),va(),ls(),Y4=z(nt()),tn(),fl(),Ka={enabled:{backgroundColor:"#2C2F34",stroke:"#646568"},disabled:{backgroundColor:"#282a2cc5",stroke:"#595a5d"},hover:{backgroundColor:"#34373D",stroke:"#C8CAC0"},dragging:{backgroundColor:"#3F444A",stroke:"#C8CAC0"},thumbWidth:9,hitZoneWidth:26,rangeStripMinWidth:30},wj=1e3,GI=ge.div(Cpe||(Cpe=H([`
  position: absolute;
  height: `,`px;
  background-color: `,`;
  cursor: grab;
  top: 0;
  left: 0;
  width: `,`px;
  transform-origin: left top;
  &:hover {
    background-color: `,`;
  }
  &.dragging {
    background-color: `,`;
    cursor: grabbing !important;
  }
  `,`;

  /* covers the one pixel space between the focus range strip and the top strip
  of the sequence editor panel, which would have caused that one pixel to act
  like a panel drag zone */
  &:after {
    display: block;
    content: ' ';
    position: absolute;
    bottom: -1px;
    height: 1px;
    left: 0;
    right: 0;
    background: transparent;
    pointer-events: normal;
    z-index: -1;
  }
`])),()=>L1-1,a=>a.enabled?Ka.enabled.backgroundColor:Ka.disabled.backgroundColor,wj,Ka.hover.backgroundColor,Ka.dragging.backgroundColor,Zi),Ape=({layoutP:a})=>{let u=(0,Y4.useMemo)(()=>(0,D1.prism)(()=>{let{projectId:B,sheetId:V}=(0,D1.val)(a.sheet).address;return(0,D1.val)(ce().atomP.ahistoric.projects.stateByProjectId[B].stateBySheetId[V].sequence.focusRange)}),[a]),[d,g]=Ni(null),[_]=oc(g,{menuItems:()=>{let B=(0,D1.val)(a.sheet),V=u.getValue();return[{label:"Delete focus range",callback:()=>{ce().tempTransaction(({stateEditors:Y})=>{Y.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.focusRange.unset(P({},B.address))}).commit()}},{label:V!=null&&V.enabled?"Disable focus range":"Enable focus range",callback:()=>{V!==void 0&&ce().tempTransaction(({stateEditors:Y})=>{Y.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.focusRange.set(U(P({},B.address),{range:V.range,enabled:!V.enabled}))}).commit()}}]}}),T=ti(a.scaledSpace.toUnitSpace),N=ti(a.sheet),R=(0,Y4.useMemo)(()=>{let B,V;return{debugName:"FocusRangeStrip",onDragStart(Y){let W,$=u.getValue();if(!$)return!1;let K=$.range.start,J=$.range.end,oe=!1,ae=(0,D1.val)(a.sheet).getSequence();return{onDrag(ue){if($=u.getValue(),$){oe=!0;let xe=T(ue),Re=K+xe,Ae=J+xe;Ae<Re&&(Ae=Re),[B,V]=BOe([Re,Ae],[0,ae.length]).map(we=>ae.closestGridPosition(we)),W&&W.discard(),W=ce().tempTransaction(({stateEditors:we})=>{var ft;we.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.focusRange.set(U(P({},N.address),{range:{start:B,end:V},enabled:(ft=$==null?void 0:$.enabled)!=null?ft:!0}))})}},onDragEnd(){$&&(oe&&W!==void 0?W.commit():W&&W.discard())}}},lockCSSCursorTo:"grabbing"}},[N,T]),[O]=wo(g,R);return N1(O,-1),di(()=>{let B=u.getValue(),V=(B==null?void 0:B.range)||{start:0,end:0},Y=(0,D1.val)(a.clippedSpace.fromUnitSpace)(V.start),W=(0,D1.val)(a.clippedSpace.fromUnitSpace)(V.end),$,K;return Y<0&&(Y=0),W>(0,D1.val)(a.clippedSpace.width)&&(W=(0,D1.val)(a.clippedSpace.width)),Y>W?(K=0,$=0):(K=Y,$=(W-Y)/wj),B?Y4.default.createElement(Y4.default.Fragment,null,_,Y4.default.createElement(GI,{id:"range-strip",enabled:B.enabled,className:"".concat(O?"dragging":""," ").concat(B.enabled?"enabled":""),ref:d,style:{transform:"translateX(".concat(K,"px) scale(").concat($,", 1)")}})):Y4.default.createElement(Y4.default.Fragment,null)},[a,d,u,_,O])},Npe=Ape}),K4,o3,Rpe,Ipe,kpe,Dpe,Ope,Lpe,Fpe,Tj,UOe=C(()=>{K4=un(),Ar(),Pe(),G8(),rc(),va(),ls(),o3=z(nt()),tn(),fl(),Ppe(),Rf(),Ipe=ge.div(Rpe||(Rpe=H([`
  position: absolute;
  top: 0;
  // the right handle has to be pulled back by its width since its right side indicates its position, not its left side
  left: `,`px;
  transform-origin: left top;
  width: `,`px;
  height: `,`px;
  z-index: 3;

  --bg: `,`;

  stroke: `,`;
  user-select: none;

  cursor: `,`;

  // no pointer events unless pointer-root is in normal mode _and_ the
  // focus range is enabled
  #pointer-root & {
    pointer-events: none;
  }

  #pointer-root.normal & {
    pointer-events: auto;
  }

  #pointer-root.draggingPositionInSequenceEditor & {
    pointer-events: auto;
    cursor: var(`,`);
  }

  &.dragging {
    pointer-events: none !important;
  }

  // highlight the handle if it's hovered, or the whole strip is hovverd
  `,`:hover ~ &, &:hover {
    --bg: `,`;
    stroke: `,`;
  }

  // highlight the handle when it's being dragged or the whole strip is being dragged.
  // using dragging.dragging to give this selector priority, as it seems to be overridden
  // by the hover selector above
  &.dragging,
  `,`.dragging.dragging ~ & {
    --bg: `,`;
    stroke: `,`;
  }

  #pointer-root.draggingPositionInSequenceEditor &:hover {
    --bg: `,`;
    stroke: #40aaa4;
  }

  background-color: var(--bg);

  // a larger hit zone
  &:before {
    display: block;
    content: ' ';
    position: absolute;
    inset: -8px;
  }
`])),a=>a.type==="start"?0:-Ka.thumbWidth,Ka.thumbWidth,()=>L1-1,({enabled:a})=>a?Ka.enabled.backgroundColor:Ka.disabled.backgroundColor,Ka.enabled.stroke,a=>a.type==="start"?"w-resize":"e-resize",bf,()=>GI,Ka.hover.backgroundColor,Ka.hover.stroke,()=>GI,Ka.dragging.backgroundColor,Ka.dragging.stroke,Ka.dragging.backgroundColor),Dpe=ge.div(kpe||(kpe=H([`
  position: absolute;
  top: 0;
  bottom: 0;
  pointer-events: none;

  background: linear-gradient(
    `,`deg,
    var(--bg) 0%,
    #ffffff00 100%
  );

  width: 12px;
  left: `,`px;
`])),a=>a.type==="start"?90:-90,a=>a.type==="start"?Ka.thumbWidth:-Ka.thumbWidth+1),Lpe=ge.div(Ope||(Ope=H([`
  position: absolute;
  top: 0;
  bottom: 0;
  pointer-events: none;

  background: linear-gradient(
    `,`deg,
    `,` 0%,
    #ffffff00 100%
  );

  width: 12px;
  left: `,`px;
`])),a=>a.type==="start"?-90:90,()=>PE.backgroundColor,a=>a.type==="start"?-12:Ka.thumbWidth),Fpe=({layoutP:a,thumbType:u})=>{var d;let[g,_]=Ni(null),T=(0,o3.useMemo)(()=>(0,K4.prism)(()=>{let{projectId:B,sheetId:V}=(0,K4.val)(a.sheet).address;return(0,K4.val)(ce().atomP.ahistoric.projects.stateByProjectId[B].stateBySheetId[V].sequence.focusRange)}),[a]),N=(0,o3.useMemo)(()=>({debugName:"FocusRangeThumb",onDragStart(){let B,V,Y=(0,K4.val)(a.sheet),W={start:0,end:Y.getSequence().length},$=T.getValue()||{range:W,enabled:!1},K=$.enabled,J=$.range[u],oe=(0,K4.val)(a.scaledSpace.toUnitSpace),ae=oe(Ka.rangeStripMinWidth);return{onDrag(ue,xe,Re){var Ae;let we,ft=lc.checkIfMouseEventSnapToPos(Re,{ignore:_});if(ft==null){let Se=oe(ue);we=J+Se}else we=ft;V=((Ae=T.getValue())==null?void 0:Ae.range)||W,u==="start"?we=Math.max(Math.min(we,V.end-ae),0):we=Math.min(Math.max(we,V.start+ae),Y.getSequence().length);let Le=Y.getSequence().closestGridPosition(we);B!==void 0&&B.discard(),B=ce().tempTransaction(({stateEditors:Se})=>{Se.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.focusRange.set(U(P({},Y.address),{range:U(P({},V),{[u]:Le}),enabled:K}))})},onDragEnd(ue){ue?B==null||B.commit():B==null||B.discard()}}}}),[a]),[R]=wo(_,N);Wu(R,"draggingPositionInSequenceEditor",u==="start"?"w-resize":"e-resize");let O=ti(T);return N1(R,(d=O==null?void 0:O.range[u])!=null?d:0),di(()=>{let B=T.getValue();if(!B)return null;let{enabled:V}=B,Y=B.range[u],W=(0,K4.val)(a.clippedSpace.fromUnitSpace)(Y);return(W<0||(0,K4.val)(a.clippedSpace.width)<W)&&(W=-1e4),o3.default.createElement(Ipe,U(P(P({ref:g},lc.includePositionSnapAttrs(Y)),P1(Y)),{className:"".concat(R&&"dragging"," ").concat(V&&"enabled"),enabled:V,type:u,style:{transform:"translate3d(".concat(W,"px, 0, 0)")}}),o3.default.createElement(Dpe,{type:u,enabled:V}),o3.default.createElement(Lpe,{type:u}),o3.default.createElement("svg",{viewBox:"0 0 9 18",xmlns:"http://www.w3.org/2000/svg"},o3.default.createElement("line",{x1:"4",y1:"6",x2:"4",y2:"12"}),o3.default.createElement("line",{x1:"6",y1:"6",x2:"6",y2:"12"})))},[a,g,T,R])},Tj=Fpe});function zOe(a,u){let[d,g]=(0,O1.useState)("none");return Wu(d!=="none","dragging",d==="creating"?"ew-resize":"move"),(0,O1.useMemo)(()=>{let _=()=>({debugName:"FocusRangeZone/focusRangeCreationGestureHandlers",onDragStart(N){let R,O=(0,V8.val)(a.clippedSpace.toUnitSpace),B=(0,V8.val)(a.scaledSpace.toUnitSpace),V=(0,V8.val)(a.sheet),Y=V.getSequence(),W=N.target.getBoundingClientRect(),$=O(N.clientX-W.left),K=B(Ka.rangeStripMinWidth);return{onDrag(J){let oe=B(J),ae=$,ue=$+oe;[ae,ue]=[os(ae,0,Y.length),os(ue,0,Y.length)].map(xe=>Y.closestGridPosition(xe)),ue<ae?[ae,ue]=[Math.max(Math.min(ue,ae-K),0),ae]:J>0&&(ue=Math.min(Math.max(ue,ae+K),Y.length)),R&&R.discard(),R=ce().tempTransaction(({stateEditors:xe})=>{xe.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.focusRange.set(U(P({},V.address),{range:{start:ae,end:ue},enabled:!0}))})},onDragEnd(J){J&&R!==void 0?R.commit():R&&R.discard()}}},lockCSSCursorTo:"ew-resize"}),T=()=>({debugName:"FocusRangeZone/panelMoveGestureHandlers",onDragStart(){let N,R=u.current,O=u.current.addBoundsHighlightLock();return{onDrag(B,V){let Y=U(P({},R.dims),{top:os(R.dims.top+V,0,window.innerHeight-T1),left:os(R.dims.left+B,-R.dims.width+T1,window.innerWidth-T1)}),W=gR(Y,{width:window.innerWidth,height:window.innerHeight});N==null||N.discard(),N=ce().tempTransaction(({stateEditors:$})=>{$.studio.historic.panelPositions.setPanelPosition({position:W,panelId:R.panelId})})},onDragEnd(B){O(),B?N==null||N.commit():N==null||N.discard()}}},lockCSSCursorTo:"move"});return{debugName:"FocusRangeZone",onDragStart(N){let[R,O]=N.shiftKey?["creating",_().onDragStart(N)]:["moving-panel",T().onDragStart(N)];return g(R),O===!1?!1:{onDrag(B,V,Y,W,$){O.onDrag(B,V,Y,W,$)},onDragEnd(B){var V;g("none"),(V=O.onDragEnd)==null||V.call(O,B)}}}}},[a,u])}var V8,O1,Bpe,Upe,zpe,Vpe,VOe=C(()=>{V8=un(),Ar(),Pe(),Z7(),G8(),rc(),va(),FOe(),Cle(),ls(),b0(),O1=z(nt()),tn(),Ppe(),UOe(),O4(),Upe=ge.div(Bpe||(Bpe=H([`
  position: absolute;
  height: `,`px;
  left: 0;
  right: 0;
  box-sizing: border-box;
  /* Use the "grab" cursor if the shift key is up, which is the one used on the top strip of the sequence editor */
  cursor: `,`;
`])),()=>L1,a=>a.isShiftDown?"ew-resize":"move"),zpe=({layoutP:a})=>{let[u,d]=Ni(null),g=K7(),_=(0,O1.useRef)(g);_.current=g;let T=(0,O1.useMemo)(()=>(0,V8.prism)(()=>{let{projectId:O,sheetId:B}=(0,V8.val)(a.sheet).address;return(0,V8.val)(ce().atomP.ahistoric.projects.stateByProjectId[O].stateBySheetId[B].sequence.focusRange)}),[a]);wo(d,zOe(a,_));let N=Ele("Shift"),R=LOe(d);return(0,O1.useEffect)(()=>{if(!N&&R)return _.current.addBoundsHighlightLock()},[!N&&R]),di(()=>O1.default.createElement(Upe,{ref:u,isShiftDown:N},O1.default.createElement(Npe,{layoutP:a}),O1.default.createElement(Tj,{thumbType:"start",layoutP:a}),O1.default.createElement(Tj,{thumbType:"end",layoutP:a})),[a,T,N])},Vpe=zpe}),Mb,L1,PE,Gpe,jpe,Hpe,$pe,G8=C(()=>{Ar(),Mb=z(nt()),tn(),Mpe(),fl(),ms(),VOe(),L1=30,PE={backgroundColor:"#1f2120eb",borderColor:"#1c1e21"},jpe=ge.div(Gpe||(Gpe=H([`
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: `,`px;
  box-sizing: border-box;
  background: `,`;
  border-bottom: 1px solid `,`;
  z-index: -10;
  `,`;
`])),L1,PE.backgroundColor,PE.borderColor,Zi),Hpe=({layoutP:a})=>{let u=ti(a.rightDims.width);return Mb.default.createElement(Mb.default.Fragment,null,Mb.default.createElement(jpe,P({},P1("hide")),Mb.default.createElement(Epe,{layoutP:a,width:u,height:L1}),Mb.default.createElement(Vpe,{layoutP:a})))},$pe=Hpe}),j8,Wpe,qpe,Xpe,Ype,Kpe,Zpe,Qpe,Jpe,GOe=C(()=>{j8=z(nt()),tn(),Ar(),Pe(),rE(),Z2(),Wpe=a=>isFinite(a)&&a>0,Xpe=ge.div(qpe||(qpe=H([`
  display: flex;
  gap: 8px;
  padding: 4px 8px;
  height: 28px;
  align-items: center;
`]))),Kpe=ge.div(Ype||(Ype=H([`
  `,`;
  white-space: nowrap;
`])),Tf),Zpe=({deltaX:a})=>a*.25,Qpe=({layoutP:a})=>{let u=ti(a.sheet),d=(0,j8.useMemo)(()=>{let _;return{temporarilySetValue(T){_&&(_.discard(),_=void 0),_=ce().tempTransaction(({stateEditors:N})=>{N.coreByProject.historic.sheetsById.sequence.setLength(U(P({},u.address),{length:T}))})},discardTemporaryValue(){_&&(_.discard(),_=void 0)},permanentlySetValue(T){_&&(_.discard(),_=void 0),ce().transaction(({stateEditors:N})=>{N.coreByProject.historic.sheetsById.sequence.setLength(U(P({},u.address),{length:T}))})}}},[a,u]),g=(0,j8.useRef)(null);return(0,j8.useLayoutEffect)(()=>{g.current.focus()},[]),di(()=>{let _=u.getSequence().length;return j8.default.createElement(Xpe,null,j8.default.createElement(Kpe,null,"Sequence length"),j8.default.createElement(sb,U(P({value:_},d),{isValid:Wpe,inputRef:g,nudge:Zpe})))},[u,d,g])},Jpe=Qpe});function jOe(a,u){let d=(0,Zu.useRef)(u);d.current=u;let g=(0,Zu.useMemo)(()=>({debugName:"LengthIndicator/useDragBulge",lockCSSCursorTo:"ew-resize",onDragStart(T){let N,R=d.current,O=(0,H8.val)(d.current.layoutP.sheet),B=O.getSequence().length,V=(0,H8.val)(R.layoutP.scaledSpace.toUnitSpace);return{onDrag(Y,W,$){let K=V(Y);N&&(N.discard(),N=void 0),N=ce().tempTransaction(({stateEditors:J})=>{J.coreByProject.historic.sheetsById.sequence.setLength(U(P({},O.address),{length:B+K}))})},onDragEnd(Y){Y?N&&N.commit():N&&N.discard()}}}}),[]),[_]=wo(a,g);return N1(_,-1),[_]}var H8,Zu,Ej,RE,efe,Z4,tfe,nfe,rfe,ife,sfe,ofe,afe,lfe,cfe,ufe,dfe,HOe=C(()=>{Ar(),H8=un(),Zu=z(nt()),tn(),F1(),G8(),ls(),va(),Pe(),Ef(),fl(),QT(),GOe(),ms(),Mf(),Ej=1e3,RE={stripNormal:"#0000006c",stripActive:"#000000"},Z4=ge.div(efe||(efe=H([`
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  z-index: `,`;
  pointer-events: none;

  &:after {
    display: block;
    content: ' ';
    position: absolute;
    /* top: `,`px; */
    top: 0;
    bottom: 0;
    left: -1px;
    width: 1px;
    background-color: `,`;
  }

  &:hover:after,
  &.dragging:after {
    background-color: `,`;
  }
`])),()=>Of.lengthIndicatorStrip,L1,RE.stripNormal,RE.stripActive),nfe=ge.div(tfe||(tfe=H([`
  position: absolute;
  top: `,`px;
  width: 100px;
  left: -50px;
  pointer-events: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 1;
`])),L1-15),ife=ge.div(rfe||(rfe=H([`
  margin-top: 8px;
  font-size: 10px;
  white-space: nowrap;
  padding: 2px 8px;
  border-radius: 2px;
  `,`;
  cursor: ew-resize;
  color: #464646;
  background-color: #0000004d;
  display: none;

  `,":hover &, ",`.dragging & {
    display: block;
    color: white;
    background-color: `,`;
  }
`])),Zi,Z4,Z4,RE.stripActive),ofe=ge.div(sfe||(sfe=H([`
  font-size: 10px;
  white-space: nowrap;
  padding: 1px 2px;
  border-radius: 2px;
  `,`;
  justify-content: center;
  align-items: center;
  cursor: ew-resize;
  color: #5d5d5d;
  background-color: #191919;

  `,":hover &, ",`.dragging & {
    color: white;
    background-color: `,`;

    & > svg:first-child {
      margin-right: -1px;
    }
  }

  & > svg:first-child {
    margin-right: -4px;
  }
`])),Zi,Z4,Z4,RE.stripActive),lfe=ge.div(afe||(afe=H([`
  position: absolute;
  top: 0;
  left: 0;
  background-color: rgb(23 23 23 / 43%);
  width: `,`px;
  z-index: `,`;
  transform-origin: left top;

  `,".dragging ~ &, ",`:hover ~ & {
    background-color: rgb(23 23 23 / 60%);
  }
`])),Ej,()=>Of.lengthIndicatorCover,Z4,Z4),cfe=-1e4,ufe=({layoutP:a})=>{let[u,d]=Ni(null),[g]=jOe(d,{layoutP:a}),{node:_,toggle:T,close:N}=qu({debugName:"LengthIndicator"},()=>Zu.default.createElement(Xu,null,Zu.default.createElement(Jpe,{layoutP:a,onRequestClose:N})));return di(()=>{let R=(0,H8.val)(a.sheet),O=(0,H8.val)(a.rightDims.height),B=R.getSequence(),V=B.length,Y=V,W=(0,H8.val)(a.clippedSpace.fromUnitSpace)(Y),$=(0,H8.val)(a.clippedSpace.width),K,J;return W>$?(J=0,K=0):(W<0&&(W=0),J=W,K=($-W)/Ej),Zu.default.createElement(Zu.default.Fragment,null,_,Zu.default.createElement(Z4,{style:{height:O+"px",transform:"translateX(".concat(J===0?cfe:J,"px)")},className:g?"dragging":""},Zu.default.createElement(nfe,null,Zu.default.createElement(ofe,P({ref:u,onClick:oe=>{T(oe,d)}},P1("hide")),Zu.default.createElement(cIe,null),Zu.default.createElement(uIe,null)),Zu.default.createElement(ife,null,"Sequence length:"," ",B.positionFormatter.formatBasic(V)))),Zu.default.createElement(lfe,{title:"Length",style:{height:O+"px",transform:"translateX(".concat(J,"px) scale(").concat(K,", 1)")}}))},[a,u,g,_])},dfe=ufe}),Mj,a3,hfe,pfe,ffe,mfe,gfe,yfe,vfe,xfe,$Oe=C(()=>{Ar(),Mj=un(),a3=z(nt()),tn(),Mpe(),F1(),G8(),fl(),pfe=ge.div(hfe||(hfe=H([`
  position: absolute;
  top: 0;
  left: 0;
  margin-top: 0px;
`]))),mfe=ge.div(ffe||(ffe=H([`
  position: absolute;
  top: 16px;
  font-size: `,`;
  color: `,`;
  text-align: center;
  transform: translateX(-50%);
  background: `,`;
  padding: 1px 8px;
  font-variant-numeric: tabular-nums;
  pointer-events: none;
  z-index: `,`;
`])),z8.stampFontSize,z8.fullUnitStampColor,PE.backgroundColor,()=>Of.currentFrameStamp),yfe=ge.div(gfe||(gfe=H([`
  position: absolute;
  top: 5px;
  left: -0px;
  bottom: 0;
  width: 0.5px;
  background: rgba(100, 100, 100, 0.2);
  pointer-events: none;
`]))),vfe=a3.default.memo(({layoutP:a})=>{let[u,d]=ti(Yle()),g=ti(a.clippedSpace.fromUnitSpace),{sequence:_,formatter:T,clippedSpaceWidth:N}=di(()=>{let V=(0,Mj.val)(a.sheet).getSequence(),Y=(0,Mj.val)(a.clippedSpace.width);return{sequence:V,formatter:V.positionFormatter,clippedSpaceWidth:Y}},[a]);if(u==-1)return a3.default.createElement(a3.default.Fragment,null);let R=d===3?_.closestGridPosition(u):u,O=g(R),B=O>=0&&O<=N;return a3.default.createElement(a3.default.Fragment,null,a3.default.createElement(pfe,null,a3.default.createElement(mfe,{style:{opacity:B?1:0,transform:"translate3d(calc(".concat(O,"px - 50%), 0, 0)")}},T.formatForPlayhead(R)),a3.default.createElement(yfe,{posType:d,style:{opacity:B?1:0,transform:"translate3d(".concat(O,"px, 0, 0)")}}))," ")}),xfe=vfe}),rp,Lo,bfe,_fe,Sfe,wfe,Tfe,jI,Efe,Cj,Mfe,HI,Cfe,$I,Afe,Aj,Nfe,Nj,Pfe,Rfe,WOe=C(()=>{Ar(),rp=un(),NP(),vf(),Lo=z(nt()),tn(),F1(),fl(),ms(),va(),_fe=ge.div(bfe||(bfe=H([`
  --threadHeight: 20px;
  --bg-inactive: #32353b;
  --bg-active: #5b5c5d;
  position: absolute;
  height: 0;
  width: 100%;
  left: 12px;
  /* bottom: 8px; */
  z-index: `,`;
  `,`
`])),()=>Of.horizontalScrollbar,Zi),wfe=ge.div(Sfe||(Sfe=H([`
  position: relative;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--threadHeight);
`]))),jI=ge.div(Tfe||(Tfe=H([`
  position: absolute;
  height: 20px;
  background: var(--bg-inactive);
  cursor: ew-resize;
  z-index: 2;

  &:hover,
  &:active {
    background: var(--bg-active);
  }

  &:after {
    `,`;
    display: block;
    content: ' ';
  }
`])),lz("absolute","-4px")),Cj=ge.div(Efe||(Efe=H([`
  position: absolute;
  height: 20px;
  width: 7px;
  left: 0;
  z-index: 2;
  top: 0;
  bottom: 0;
  display: block;

  &:hover:before {
    background: var(--bg-active);
  }

  &:before {
    `,`;
    display: block;
    content: ' ';
    background: var(--bg-inactive);
    border-radius: 0 2px 2px 0;
  }

  &:after {
    `,`;
    display: block;
    content: ' ';
  }
`])),lz("absolute","0"),lz("absolute","-4px")),HI=ge(Cj)(Mfe||(Mfe=H([`
  left: calc(-1 * 7px);
  cursor: w-resize;
  &:before {
    transform: scaleX(-1);
  }
`]))),$I=ge(Cj)(Cfe||(Cfe=H([`
  cursor: e-resize;
  left: 0px;
`]))),Aj=ge.div(Afe||(Afe=H([`
  display: `,`;
  position: absolute;
  top: -20px;
  left: 4px;
  padding: 0 4px;
  transform: translateX(-50%);
  background: #131d1f;
  border-radius: 4px;
  color: #fff;
  font-size: 10px;
  line-height: 18px;
  text-align: center;

  `,`:hover &,
  `,`:hover &,
  `,":hover ~ ",` &,
  `,":hover ~ ",` & {
    display: block;
  }
`])),a=>a.active?"block":"none",HI,$I,jI,HI,jI,$I),Nj=ge.input(Nfe||(Nfe=H([`
  background: transparent;
  border: none;
  color: #fff;
  font-size: 10px;
  line-height: 18px;
  text-align: center;
  width: 40px;
  outline: none;

  &:focus {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
  }
`]))),Pfe=({layoutP:a})=>{let u=(0,Lo.useCallback)(Se=>Se.toFixed(2),[]),d=(0,Lo.useMemo)(()=>(0,rp.prism)(()=>{let Se=(0,rp.val)(a.rightDims.width)-25,Ge=(0,rp.val)(a.clippedSpace.range),Je=(0,rp.val)(a.sheet).getSequence().length,He=Math.max(Ge.end,Je),Bt=Ge.start/He*Se,Qe=Ge.end/He*Se;return{rightWidth:Se,clippedSpaceRange:Ge,sequenceLength:Je,assumedLengthOfSequence:He,rangeStartX:Bt,rangeEndX:Qe,bottom:(0,rp.val)(a.horizontalScrollbarDims.bottom)}}),[a]),{rangeStartX:g,rangeEndX:_,clippedSpaceRange:T,bottom:N}=ti(d),[R,O]=(0,Lo.useState)("nothing"),[B,V]=(0,Lo.useState)(!1),[Y,W]=(0,Lo.useState)(!1),[$,K]=(0,Lo.useState)(""),[J,oe]=(0,Lo.useState)(""),ae=(0,Lo.useMemo)(()=>{let Se=(Ge,Je)=>{let He=Math.max(0,Math.min(Ge,Je-.01)),Bt=Math.max(Ge+.01,Je);(0,rp.val)(a.clippedSpace.setRange)({start:He,end:Bt})};return{onStartInputClick:Ge=>{Ge.stopPropagation(),V(!0),K(u(T.start))},onEndInputClick:Ge=>{Ge.stopPropagation(),W(!0),oe(u(T.end))},onStartInputChange:Ge=>{K(Ge.target.value)},onEndInputChange:Ge=>{oe(Ge.target.value)},onStartInputKeyDown:Ge=>{if(Ge.key==="Enter"){let Je=parseFloat($);isNaN(Je)||Se(Je,T.end),V(!1)}else Ge.key==="Escape"&&V(!1)},onEndInputKeyDown:Ge=>{if(Ge.key==="Enter"){let Je=parseFloat(J);isNaN(Je)||Se(T.start,Je),W(!1)}else Ge.key==="Escape"&&W(!1)},onStartInputBlur:()=>{let Ge=parseFloat($);isNaN(Ge)||Se(Ge,T.end),V(!1)},onEndInputBlur:()=>{let Ge=parseFloat(J);isNaN(Ge)||Se(T.start,Ge),W(!1)}}},[a,d,T,$,J,u]),ue=(0,Lo.useMemo)(()=>{let Se=(0,rp.val)(d),Ge=()=>{Se=(0,rp.val)(d)},Je=He=>He/Se.rightWidth*Se.assumedLengthOfSequence;return{onRangeDragStart(){return Ge(),{onDrag(He){O("both");let Bt=Je(He),Qe=pf(Se.clippedSpaceRange,Zt=>Zt+Bt);(0,rp.val)(a.clippedSpace.setRange)(Qe)},onDragEnd(){O("nothing")}}},onRangeStartDragStart(){return Ge(),{onDrag(He){O("start");let Bt=Je(He),Qe={start:Se.clippedSpaceRange.start+Bt,end:Se.clippedSpaceRange.end};Qe.start>Qe.end-1&&(Qe.start=Qe.end-1),Qe.start<=0&&(Qe.start=0),(0,rp.val)(a.clippedSpace.setRange)(Qe)},onDragEnd(){O("nothing")}}},onRangeEndDragStart(){return Ge(),{onDrag(He){O("end");let Bt=Je(He),Qe={start:Se.clippedSpaceRange.start,end:Se.clippedSpaceRange.end+Bt};Qe.end<Qe.start+1&&(Qe.end=Qe.start+1),Qe.end>=Se.assumedLengthOfSequence&&(Qe.end=Se.assumedLengthOfSequence),(0,rp.val)(a.clippedSpace.setRange)(Qe)},onDragEnd(){O("nothing")}}}}},[a,d]),[xe,Re]=(0,Lo.useState)(null);wo(xe,{debugName:"HorizontalScrollbar/onRangeDrag",onDragStart:ue.onRangeDragStart,lockCSSCursorTo:"ew-resize"});let[Ae,we]=(0,Lo.useState)(null);wo(Ae,{debugName:"HorizontalScrollbar/onRangeStartDrag",onDragStart:ue.onRangeStartDragStart,lockCSSCursorTo:"w-resize"});let[ft,Le]=(0,Lo.useState)(null);return wo(ft,{debugName:"HorizontalScrollbar/onRangeEndDrag",onDragStart:ue.onRangeEndDragStart,lockCSSCursorTo:"e-resize"}),Lo.default.createElement(_fe,P({style:{bottom:N+23+"px"}},P1("hide")),Lo.default.createElement(wfe,null,Lo.default.createElement(jI,{ref:Re,style:{width:"".concat(_-g,"px"),transform:"translate3d(".concat(g,"px, 0, 0)")}}),Lo.default.createElement(HI,{ref:we,style:{transform:"translate3d(".concat(g,"px, 0, 0)")}},Lo.default.createElement(Aj,{active:R==="both"||R==="start"||B},B?Lo.default.createElement(Nj,{value:$,onChange:ae.onStartInputChange,onKeyDown:ae.onStartInputKeyDown,onBlur:ae.onStartInputBlur,autoFocus:!0}):Lo.default.createElement("span",{onClick:ae.onStartInputClick},u(T.start)))),Lo.default.createElement($I,{ref:Le,style:{transform:"translate3d(".concat(_,"px, 0, 0)")}},Lo.default.createElement(Aj,{active:R==="both"||R==="end"||Y},Y?Lo.default.createElement(Nj,{value:J,onChange:ae.onEndInputChange,onKeyDown:ae.onEndInputKeyDown,onBlur:ae.onEndInputBlur,autoFocus:!0}):Lo.default.createElement("span",{onClick:ae.onEndInputClick},u(T.end))))))},Rfe=Pfe}),Ife,kfe,Dfe,Ofe,Lfe,qOe=C(()=>{Ife=z(nt()),tn(),Dfe=ge.div(kfe||(kfe=H([`
  position: absolute;
  inset: `,`px;
`])),a=>a.room*-1),Ofe=a=>Ife.default.createElement(Dfe,{room:a.room}),Lfe=Ofe}),WI,qI,Pj,Ffe,Bfe,Ufe,zfe,Vfe,Gfe,jfe,Hfe,XOe=C(()=>{tn(),Ar(),rE(),Z2(),WI=z(nt()),qI=z(nt()),Pj=un(),lf(),Ffe=a=>isFinite(a)&&a>=0,Ufe=ge.div(Bfe||(Bfe=H([`
  display: flex;
  gap: 8px;
  padding: 4px 8px;
  height: 28px;
  align-items: center;
`]))),Vfe=ge.div(zfe||(zfe=H([`
  `,`;
  white-space: nowrap;
`])),Tf),Gfe=({deltaX:a})=>a*.25,jfe=({layoutP:a,onRequestClose:u})=>{let d=(0,Pj.val)(a.sheet),g=d.getSequence(),_=(0,WI.useMemo)(()=>{let N,R=g.position;return{temporarilySetValue(O){N&&(N=void 0),N=os(O,0,g.length),g.position=N},discardTemporaryValue(){N&&(N=void 0,g.position=R,u("discardTemporaryValue"))},permanentlySetValue(O){N&&(N=void 0),g.position=os(O,0,g.length),u("permanentlySetValue")}}},[a,g]),T=(0,WI.useRef)(null);return(0,WI.useLayoutEffect)(()=>{T.current.focus()},[]),di(()=>{let N=d.getSequence(),R=Number((0,Pj.val)(N.pointer.position).toFixed(3));return qI.default.createElement(Ufe,null,qI.default.createElement(Vfe,null,"Sequence position"),qI.default.createElement(sb,U(P({value:R},_),{isValid:Ffe,inputRef:T,nudge:Gfe})))},[d,_,T])},Hfe=jfe}),$fe,YOe=C(()=>{$fe=typeof navigator<"u"&&navigator.platform.toUpperCase().indexOf("MAC")>=0}),Wfe,KOe=C(()=>{YOe(),Wfe=a=>$fe?a.metaKey===!0:a.ctrlKey===!0});function ZOe(){XI=!1}function QOe(){XI=!0}function JOe(){let a=ce();(0,qfe.useEffect)(()=>{let u=d=>{let g=d.composedPath()[0];if(!(g&&(g.tagName==="INPUT"||g.tagName==="TEXTAREA"))){if(d.key==="z"||d.key==="Z"||d.code==="KeyZ")if(Wfe(d))d.shiftKey===!0?a.redo():a.undo();else return;else if(d.code==="Space"&&!d.shiftKey&&!d.metaKey&&!d.altKey&&!d.ctrlKey){if(!XI)return;let _=ARe();if(_)if(_.playing)_.pause();else{let{projectId:T,sheetId:N}=_.address,R=(0,kf.prism)(()=>{let V=(0,kf.val)(ce().atomP.ahistoric.projects.stateByProjectId[T].stateBySheetId[N].sequence.focusRange);return kf.prism.memo("shouldFollowFocusRange",()=>{let Y=_.position;if(V){let W=Y>=V.range.start&&Y<=V.range.end;return V.enabled?!!W:!0}else return!0},[])&&V&&V.enabled?{range:[V.range.start,V.range.end],isFollowingARange:!0}:{range:[0,(0,kf.val)(_.pointer.length)],isFollowingARange:!1}}),O=_.playDynamicRange((0,kf.prism)(()=>(0,kf.val)(R).range),ce().ticker),B=Rj(_);O.finally(()=>{B.set(void 0)}),B.set(R)}else return}else if(d.altKey&&(d.key==="\\"||d.code==="Backslash"||d.code==="IntlBackslash"))a.transaction(({stateEditors:_,drafts:T})=>{_.studio.ahistoric.setVisibilityState(T.ahistoric.visibilityState==="everythingIsHidden"?"everythingIsVisible":"everythingIsHidden")});else return;d.preventDefault(),d.stopPropagation()}};return window.addEventListener("keydown",u),()=>{window.removeEventListener("keydown",u)}},[])}var qfe,kf,XI,Rj,Xfe,Ij=C(()=>{qfe=z(nt()),Pe(),KOe(),q7(),kf=un(),XV(),XI=!0,Rj=FR(a=>new kf.Atom(void 0)),Xfe=FR(a=>(0,kf.prism)(()=>{let u=Rj(a).prism.getValue();if(u)return u.getValue().isFollowingARange;{let{projectId:d,sheetId:g}=a.address,_=(0,kf.val)(ce().atomP.ahistoric.projects.stateByProjectId[d].stateBySheetId[g].sequence.focusRange);if(!_||!_.enabled)return!1;let T=(0,kf.val)(a.pointer.position);return T>=_.range.start&&T<=_.range.end}}))});function eLe(a,u){return oc(a,{menuItems(){return[{label:"Place marker",callback:()=>{ce().transaction(({stateEditors:d})=>{let g=(0,ip.val)(u.layoutP.sheet),_=g.getSequence();d.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.replaceMarkers({sheetAddress:g.address,markers:[{id:fie(),position:_.position}],snappingFunction:_.closestGridPosition})})}},{label:"Place event",callback:()=>{ce().transaction(({stateEditors:d})=>{let g=(0,ip.val)(u.layoutP.sheet),_=g.getSequence();d.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.replaceEvents({sheetAddress:g.address,events:[{id:mie(),name:"event",position:_.position}]})})}},{label:"Attach audio",callback:()=>{let d=new CustomEvent("theatre:attachAudio",{detail:{sheet:(0,ip.val)(u.layoutP.sheet)}});document.dispatchEvent(d)}}]}})}var ip,sp,Yfe,$8,Kfe,Zfe,Qfe,kj,Jfe,eme,tme,nme,rme,ime,tLe=C(()=>{qOe(),va(),ls(),Ar(),ip=un(),lf(),sp=z(nt()),tn(),F1(),fl(),ms(),Ef(),Mf(),XOe(),Ij(),rc(),ac(),Pe(),wf(),Rf(),yb(),$8=ge.div(Yfe||(Yfe=H([`
  --thumbColor: #00e0ff;
  position: absolute;
  top: 0;
  left: 0;
  width: 5px;
  height: 100%;
  z-index: `,`;
  pointer-events: none;

  display: `,`;
`])),()=>Of.playhead,a=>a.isVisible?"block":"none"),Zfe=ge.div(Kfe||(Kfe=H([`
  position: absolute;
  top: 30px;
  width: 0;
  height: calc(100% - 30px);
  border-left: 1px solid #27e0fd;
  z-index: 10;
  pointer-events: none;

  #pointer-root.draggingPositionInSequenceEditor &:not(.seeking) {
    /* pointer-events: auto; */
    /* cursor: var(`,`); */

    &:after {
      position: absolute;
      inset: -8px;
      display: block;
      content: ' ';
    }
  }
`])),bf),kj=ge.div(Qfe||(Qfe=H([`
  background-color: var(--thumbColor);
  position: absolute;
  width: 5px;
  height: 34px;
  top: -4px;
  left: -2px;
  z-index: 11;
  cursor: ew-resize;
  --sunblock-color: #1f2b2b;

  `,`;

  `,`.seeking > & {
    pointer-events: none !important;
  }

  #pointer-root.draggingPositionInSequenceEditor
    `,`:not(.seeking)
    > & {
    pointer-events: auto;
    cursor: var(`,`);
  }

  `,`.playheadattachedtofocusrange > & {
    top: -8px;
    --sunblock-color: #005662;
    &:before,
    &:after {
      border-bottom-width: 8px;
    }
  }

  &:before {
    position: absolute;
    display: block;
    content: ' ';
    left: -2px;
    width: 0;
    height: 0;
    border-bottom: 4px solid var(--sunblock-color);
    border-left: 2px solid transparent;
  }

  &:after {
    position: absolute;
    display: block;
    content: ' ';
    right: -2px;
    width: 0;
    height: 0;
    border-bottom: 4px solid var(--sunblock-color);
    border-right: 2px solid transparent;
  }
`])),Zi,$8,$8,bf,$8),eme=ge.div(Jfe||(Jfe=H([`
  position: absolute;
  left: 1px;
  right: 1px;
  top: 35px;
  border-top: 3px solid var(--thumbColor);
  border-right: 1px solid transparent;
  border-left: 1px solid transparent;
  pointer-events: none;

  /* `,`.playheadattachedtofocusrange & {
    top: 10px;
    &:before,
    &:after {
      height: 15px;
    }
  } */

  &:before {
    position: absolute;
    display: block;
    content: ' ';
    top: -4px;
    left: -2px;
    height: 8px;
    width: 2px;
    background: none;
    border-radius: 0 100% 0 0;
    border-top: 1px solid var(--thumbColor);
    border-right: 1px solid var(--thumbColor);
  }

  &:after {
    position: absolute;
    display: block;
    content: ' ';
    top: -4px;
    right: -2px;
    height: 8px;
    width: 2px;
    background: none;
    border-radius: 100% 0 0 0;
    border-top: 1px solid var(--thumbColor);
    border-left: 1px solid var(--thumbColor);
  }
`])),$8),nme=ge.div(tme||(tme=H([`
  display: none;
  position: absolute;
  top: -20px;
  left: 4px;
  padding: 0 2px;
  transform: translateX(-50%);
  background: #1a1a1a;
  border-radius: 4px;
  color: #fff;
  font-size: 10px;
  line-height: 18px;
  text-align: center;
  `,":hover &, ",`.seeking & {
    display: block;
  }
`])),kj,$8),rme=({layoutP:a})=>{let[u,d]=Ni(null),{node:g,toggle:_,close:T}=qu({debugName:"Playhead"},()=>sp.default.createElement(Xu,null,sp.default.createElement(Hfe,{layoutP:a,onRequestClose:T}))),N=(0,sp.useMemo)(()=>({debugName:"RightOverlay/Playhead",onDragStart(){let B=(0,ip.val)(a.sheet).getSequence(),V=B.position,Y=(0,ip.val)(a.scaledSpace.toUnitSpace),W=(0,ip.val)(a.seeker.setIsSeeking);return W(!0),rI(),{onDrag($,K,J){var oe;let ae=Y($);B.position=(oe=lc.checkIfMouseEventSnapToPos(J,{ignore:d}))!=null?oe:os(V+ae,0,B.length)},onDragEnd($){W(!1),gb()},onClick($){_($,u.current)}}}}),[a,d]),[R]=wo(d,N);Wu(R,"draggingPositionInSequenceEditor","ew-resize"),N1(ti(a.seeker.isSeeking)||R,-1);let[O]=eLe(d,{layoutP:a});return di(()=>{let B=(0,ip.val)(a.seeker.isSeeking),V=(0,ip.val)(a.sheet).getSequence(),Y=(0,ip.val)(Xfe(V)),W=V.positionPrism.getValue(),$=(0,ip.val)(a.clippedSpace.fromUnitSpace)(W),K=$>=0&&$<=(0,ip.val)(a.clippedSpace.width);return sp.default.createElement(sp.default.Fragment,null,O,g,sp.default.createElement($8,P({isVisible:K,style:{transform:"translate3d(".concat($,"px, 0, 0)")},className:"".concat(B&&"seeking"," ").concat(Y&&"playheadattachedtofocusrange")},P1("hide")),sp.default.createElement(kj,P({ref:u},lc.includePositionSnapAttrs(W)),sp.default.createElement(Lfe,{room:8}),sp.default.createElement(eme,null),sp.default.createElement(nme,null,V.positionFormatter.formatForPlayhead(V.closestGridPosition(W)))),sp.default.createElement(Zfe,U(P({},lc.includePositionSnapAttrs(W)),{className:B?"seeking":""}))))},[a,u,g])},ime=rme}),W8,IE,YI,sme,ome,ame,lme,nLe=C(()=>{W8=un(),Ar(),Pe(),G8(),IE=z(nt()),tn(),YI=1e3,ome=ge.div(sme||(sme=H([`
  position: absolute;
  top: `,`px;
  left: 0;
  opacity: 0.15;
  width: `,`px;
  transform-origin: top left;
  pointer-events: none;
  background-color: `,`;
`])),L1,YI,a=>a.enabled?"#000000":"transparent"),ame=({layoutP:a})=>{let u=(0,IE.useMemo)(()=>(0,W8.prism)(()=>{let{projectId:d,sheetId:g}=(0,W8.val)(a.sheet).address;return(0,W8.val)(ce().atomP.ahistoric.projects.stateByProjectId[d].stateBySheetId[g].sequence.focusRange)}),[a]);return di(()=>{let d=u.getValue();if(!d||!d.enabled)return null;let{range:g}=d,_=(0,W8.val)(a.rightDims.height)-L1,T=(0,W8.val)(a.clippedSpace.fromUnitSpace),N=(0,W8.val)(a.clippedSpace.width),R=[];{let O=0,B=T(d.range.start),V,Y;O>B?(Y=0,V=0):(B>N&&(B=N),Y=O,V=(B-O)/YI),R.push({translateX:Y,scaleX:V})}{let O=T(d.range.end),B=N,V,Y;O>B?(Y=0,V=0):(O<0&&(O=0),Y=O,V=(B-O)/YI),R.push({translateX:Y,scaleX:V})}return IE.default.createElement(IE.default.Fragment,null,R.map(({translateX:O,scaleX:B},V)=>IE.default.createElement(ome,{key:"curtain-".concat(V),enabled:!0,style:{height:"".concat(_,"px"),transform:"translateX(".concat(O,"px) scaleX(").concat(B,")")}})))},[a,u])},lme=ame}),Cb,cme,ume,dme,hme,pme,rLe=C(()=>{Cb=z(nt()),tn(),Ar(),Pe(),Z2(),ob(),ume=ge.div(cme||(cme=H([`
  display: flex;
  gap: 8px;
  /* padding: 4px 8px; */
  height: 28px;
  align-items: center;
`]))),ge.div(dme||(dme=H([`
  `,`;
  white-space: nowrap;
`])),Tf),hme=({layoutP:a,marker:u})=>{var d;let g=ti(a.sheet),_=(0,Cb.useMemo)(()=>{let N;return{temporarilySetValue(R){N&&(N.discard(),N=void 0),N=ce().tempTransaction(({stateEditors:O})=>{O.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateMarker({sheetAddress:g.address,markerId:u.id,label:R})})},discardTemporaryValue(){N&&(N.discard(),N=void 0)},permanentlySetValue(R){N&&(N.discard(),N=void 0),ce().transaction(({stateEditors:O})=>{O.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateMarker({sheetAddress:g.address,markerId:u.id,label:R})})}}},[a,g]),T=(0,Cb.useRef)(null);return(0,Cb.useLayoutEffect)(()=>{T.current.focus()},[]),Cb.default.createElement(ume,null,Cb.default.createElement(L4,U(P({value:(d=u.label)!=null?d:""},_),{isValid:()=>!0,inputRef:T})))},pme=hme});function iLe(a,u){return oc(a,{menuItems(){return[{label:"Remove marker",callback:()=>{ce().transaction(({stateEditors:d})=>{d.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.removeMarker({sheetAddress:u.sheetAddress,markerId:u.markerId})})}}]}})}function sLe(a,u){let d=(0,ru.useRef)(u);d.current=u;let g=(0,ru.useMemo)(()=>({debugName:"MarkerDot/useDragMarker (".concat(u.marker.id,")"),onDragStart(T){let N=d.current.marker,R=(0,KI.val)(u.layoutP.scaledSpace.toUnitSpace),O;return rI(),{onDrag(B,V,Y){var W;let $=N,K=Math.max((W=lc.checkIfMouseEventSnapToPos(Y,{ignore:a}))!=null?W:$.position+R(B),0);O==null||O.discard(),O=ce().tempTransaction(({stateEditors:J})=>{J.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.replaceMarkers({sheetAddress:(0,KI.val)(u.layoutP.sheet.address),markers:[U(P({},$),{position:K})],snappingFunction:(0,KI.val)(u.layoutP.sheet).getSequence().closestGridPosition})})},onDragEnd(B){B?O==null||O.commit():O==null||O.discard(),gb()}}}}),[]),[_]=wo(a,g);return N1(_,u.marker.position),Wu(_,"draggingPositionInSequenceEditor draggingMarker","ew-resize"),[_]}var KI,ru,Dj,Oj,fme,mme,gme,yme,vme,ZI,xme,bme,_me,Sme,wme,Tme,oLe=C(()=>{KI=un(),Ar(),Pe(),rc(),ac(),ls(),ru=z(nt()),tn(),fl(),va(),F1(),Rf(),eI(),_G(),yb(),Ef(),Mf(),rLe(),Dj=12,Oj=12,fme=Dj*2,mme=Oj*2,yme=ge.div(gme||(gme=H([`
  position: absolute;
  // below the sequence ruler "top bar"
  top: 30px;
  z-index: `,`;
`])),()=>Of.marker),ZI=ge.div(vme||(vme=H([`
  position: absolute;
  `,`
  pointer-events: none;
`])),If(Dj,Oj)),xme=ru.default.memo(()=>ru.default.createElement(ZI,{children:ru.default.createElement("svg",{width:"100%",height:"100%",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ru.default.createElement("path",{d:"M12 5H0V7H2.71973L5.96237 10.2426L9.20501 7H12V5Z",fill:"#40AAA4"}))})),_me=ge.div(bme||(bme=H([`
  z-index: 1;
  cursor: ew-resize;

  `,`

  // :not dragging marker to ensure that markers don't snap to other markers
  // this works because only one marker track (so this technique is not used by keyframes...)
  #pointer-root.draggingPositionInSequenceEditor:not(.draggingMarker) & {
    `,`
  }

  // "All instances of this component <Mark/> inside #pointer-root when it has the .draggingPositionInSequenceEditor class"
  // ref: https://styled-components.com/docs/basics#pseudoelements-pseudoselectors-and-nesting
  #pointer-root.draggingPositionInSequenceEditor:not(.draggingMarker) &,
  #pointer-root.draggingPositionInSequenceEditor
    &.`,` {
    pointer-events: auto;
    cursor: var(`,`);
  }

  &:hover
    + `,`,
    // notice , "or" in CSS
    &.`,`
    + `,` {
    `,`
  }
`])),nu.CSS,nu.CSS_WHEN_SOMETHING_DRAGGING,nu.BEING_DRAGGED_CLASS,bf,ZI,nu.BEING_DRAGGED_CLASS,ZI,If(fme,mme)),Sme=({layoutP:a,markerId:u})=>{let d=ti(a.sheet.address),g=ti(ce().atomP.historic.projects.stateByProjectId[d.projectId].stateBySheetId[d.sheetId].sequenceEditor.markerSet.byId[u]);if(!g)return null;let _=ti(a.clippedSpace.width),T=ti(a.clippedSpace.fromUnitSpace)(g.position),N=T<=0||T>_,R=N?-1e4:T,O=N?0:1;return ru.default.createElement(yme,{style:{transform:"translateX(".concat(R,"px) scale(").concat(O,")")}},ru.default.createElement(Tme,{marker:g,layoutP:a}))},wme=Sme,Tme=({layoutP:a,marker:u})=>{let d=ti(a.sheet.address),[g,_]=Ni(null),[T]=iLe(_,{sheetAddress:d,markerId:u.id}),[N]=sLe(_,{layoutP:a,marker:u}),{node:R,toggle:O,close:B}=qu({debugName:"MarkerPopover"},()=>ru.default.createElement(Xu,null,ru.default.createElement(pme,{marker:u,layoutP:a,onRequestClose:B})));return ru.default.createElement(ru.default.Fragment,null,T,R,ru.default.createElement(_me,P({title:u.label?"Marker: ".concat(u.label):"Marker",ref:g,onClick:V=>{O(V,g.current)}},nu.reactProps({isDragging:N,position:u.position}))),ru.default.createElement(xme,null))}}),QI,Eme,Mme,aLe=C(()=>{Ar(),Pe(),QI=z(nt()),oLe(),Eme=({layoutP:a})=>{let u=ti(a.sheet.address),d=ce().atomP.historic.projects.stateByProjectId[u.projectId].stateBySheetId[u.sheetId].sequenceEditor.markerSet,g=ti(d.allIds);return QI.default.createElement(QI.default.Fragment,null,g&&Object.keys(g).map(_=>QI.default.createElement(wme,{key:_,layoutP:a,markerId:_})))},Mme=Eme}),E0,Cme,Ame,Nme,JI,Pme,ek,Rme,Ime,lLe=C(()=>{E0=z(nt()),tn(),Ar(),Pe(),Z2(),ob(),rE(),Ame=ge.div(Cme||(Cme=H([`
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 8px;
  min-width: 200px;
`]))),JI=ge.div(Nme||(Nme=H([`
  display: flex;
  gap: 8px;
  height: 28px;
  align-items: center;
`]))),ek=ge.div(Pme||(Pme=H([`
  `,`;
  white-space: nowrap;
  min-width: 60px;
`])),Tf),Rme=({layoutP:a,event:u})=>{var d;let g=ti(a.sheet),_=(0,E0.useMemo)(()=>{let B;return{temporarilySetValue(V){B&&(B.discard(),B=void 0),B=ce().tempTransaction(({stateEditors:Y})=>{Y.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateEvent({sheetAddress:g.address,eventId:u.id,name:V,value:u.value})})},discardTemporaryValue(){B&&(B.discard(),B=void 0)},permanentlySetValue(V){B&&(B.discard(),B=void 0),ce().transaction(({stateEditors:Y})=>{Y.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateEvent({sheetAddress:g.address,eventId:u.id,name:V,value:u.value})})}}},[a,g,u]),T=(0,E0.useMemo)(()=>{let B;return{temporarilySetValue(V){B&&(B.discard(),B=void 0),B=ce().tempTransaction(({stateEditors:Y})=>{Y.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.replaceEvents({sheetAddress:g.address,events:[U(P({},u),{position:V})]})})},discardTemporaryValue(){B&&(B.discard(),B=void 0)},permanentlySetValue(V){B&&(B.discard(),B=void 0),ce().transaction(({stateEditors:Y})=>{Y.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.replaceEvents({sheetAddress:g.address,events:[U(P({},u),{position:V})]})})}}},[a,g,u]),N=(0,E0.useMemo)(()=>{let B;return{temporarilySetValue(V){B&&(B.discard(),B=void 0);let Y=V;try{V.trim()!==""&&(Y=JSON.parse(V))}catch{}B=ce().tempTransaction(({stateEditors:W})=>{W.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateEvent({sheetAddress:g.address,eventId:u.id,name:u.name,value:Y})})},discardTemporaryValue(){B&&(B.discard(),B=void 0)},permanentlySetValue(V){B&&(B.discard(),B=void 0);let Y=V;try{V.trim()!==""&&(Y=JSON.parse(V))}catch{}ce().transaction(({stateEditors:W})=>{W.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateEvent({sheetAddress:g.address,eventId:u.id,name:u.name,value:Y})})}}},[a,g,u]),R=(0,E0.useRef)(null);(0,E0.useLayoutEffect)(()=>{R.current.focus()},[]);let O=(0,E0.useMemo)(()=>u.value===void 0||u.value===null?"":typeof u.value=="string"?u.value:JSON.stringify(u.value),[u.value]);return E0.default.createElement(Ame,null,E0.default.createElement(JI,null,E0.default.createElement(ek,null,"Name"),E0.default.createElement(L4,U(P({value:(d=u.name)!=null?d:""},_),{isValid:()=>!0,inputRef:R}))),E0.default.createElement(JI,null,E0.default.createElement(ek,null,"Time"),E0.default.createElement(sb,U(P({value:u.position},T),{isValid:()=>!0,nudge:({deltaX:B})=>B*.25}))),E0.default.createElement(JI,null,E0.default.createElement(ek,null,"Value"),E0.default.createElement(L4,U(P({value:O},N),{isValid:()=>!0}))))},Ime=Rme});function cLe(a,u){return oc(a,{menuItems(){return[{label:"Remove event",callback:()=>{ce().transaction(({stateEditors:d})=>{d.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.removeEvent({sheetAddress:u.sheetAddress,eventId:u.eventId})})}}]}})}function uLe(a,u){let d=(0,iu.useRef)(u);d.current=u;let g=(0,iu.useMemo)(()=>({debugName:"EventDot/useDragEvent (".concat(u.event.id,")"),onDragStart(T){let N=d.current.event,R=(0,Lj.val)(u.layoutP.scaledSpace.toUnitSpace),O;return rI(),{onDrag(B,V,Y){var W;let $=N,K=Math.max((W=lc.checkIfMouseEventSnapToPos(Y,{ignore:a}))!=null?W:$.position+R(B),0);O==null||O.discard(),O=ce().tempTransaction(({stateEditors:J})=>{J.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.replaceEvents({sheetAddress:(0,Lj.val)(u.layoutP.sheet.address),events:[U(P({},$),{position:K})]})})},onDragEnd(B){B?O==null||O.commit():O==null||O.discard(),gb()}}}}),[]),[_]=wo(a,g);return N1(_,u.event.position),Wu(_,"draggingPositionInSequenceEditor draggingEvent","ew-resize"),[_]}var Lj,iu,Fj,Bj,kme,Dme,Ome,Lme,Fme,tk,Bme,Ume,zme,Vme,Gme,jme,dLe=C(()=>{Lj=un(),Ar(),Pe(),rc(),ac(),ls(),iu=z(nt()),tn(),fl(),va(),F1(),Rf(),eI(),_G(),yb(),Ef(),Mf(),lLe(),Fj=12,Bj=12,kme=Fj*2,Dme=Bj*2,Lme=ge.div(Ome||(Ome=H([`
  position: absolute;
  // below the sequence ruler "top bar"
  top: 15px;
  z-index: `,`;
`])),()=>Of.marker),tk=ge.div(Fme||(Fme=H([`
  position: absolute;
  `,`
  pointer-events: none;
`])),If(Fj,Bj)),Bme=iu.default.memo(()=>iu.default.createElement(tk,{children:iu.default.createElement("svg",{width:"100%",height:"100%",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},iu.default.createElement("circle",{cx:"6",cy:"6",r:"5",fill:"#2b86ee",stroke:"#FFFFFF",strokeWidth:"1"}))})),zme=ge.div(Ume||(Ume=H([`
  z-index: 1;
  cursor: ew-resize;

  `,`

  // :not dragging event to ensure that events don't snap to other events
  // this works because only one event track (so this technique is not used by keyframes...)
  #pointer-root.draggingPositionInSequenceEditor:not(.draggingEvent) & {
    `,`
  }

  // "All instances of this component <Event/> inside #pointer-root when it has the .draggingPositionInSequenceEditor class"
  // ref: https://styled-components.com/docs/basics#pseudoelements-pseudoselectors-and-nesting
  #pointer-root.draggingPositionInSequenceEditor:not(.draggingEvent) &,
  #pointer-root.draggingPositionInSequenceEditor
    &.`,` {
    pointer-events: auto;
    cursor: var(`,`);
  }

  &:hover
    + `,`,
    // notice , "or" in CSS
    &.`,`
    + `,` {
    `,`
  }
`])),nu.CSS,nu.CSS_WHEN_SOMETHING_DRAGGING,nu.BEING_DRAGGED_CLASS,bf,tk,nu.BEING_DRAGGED_CLASS,tk,If(kme,Dme)),Vme=({layoutP:a,eventId:u})=>{let d=ti(a.sheet.address),g=ti(ce().atomP.historic.projects.stateByProjectId[d.projectId].stateBySheetId[d.sheetId].sequenceEditor.eventSet.byId[u]);if(!g)return null;let _=ti(a.clippedSpace.width),T=ti(a.clippedSpace.fromUnitSpace)(g.position),N=T<=0||T>_,R=N?-1e4:T,O=N?0:1;return iu.default.createElement(Lme,{style:{transform:"translateX(".concat(R,"px) scale(").concat(O,")")}},iu.default.createElement(jme,{event:g,layoutP:a}))},Gme=Vme,jme=({layoutP:a,event:u})=>{let d=ti(a.sheet.address),[g,_]=Ni(null),[T]=cLe(_,{sheetAddress:d,eventId:u.id}),[N]=uLe(_,{layoutP:a,event:u}),{node:R,toggle:O,close:B}=qu({debugName:"EventPopover"},()=>iu.default.createElement(Xu,null,iu.default.createElement(Ime,{event:u,layoutP:a,onRequestClose:B})));return iu.default.createElement(iu.default.Fragment,null,T,R,iu.default.createElement(zme,P({title:u.name?"Event: ".concat(u.name):"Event",ref:g,onClick:V=>{O(V,g.current)}},nu.reactProps({isDragging:N,position:u.position}))),iu.default.createElement(Bme,null))}}),nk,Hme,$me,hLe=C(()=>{Ar(),Pe(),nk=z(nt()),dLe(),Hme=({layoutP:a})=>{let u=ti(a.sheet.address),d=ce().atomP.historic.projects.stateByProjectId[u.projectId].stateBySheetId[u.sheetId].sequenceEditor.eventSet,g=ti(d.allIds);return nk.default.createElement(nk.default.Fragment,null,g&&Object.keys(g).map(_=>nk.default.createElement(Gme,{key:_,layoutP:a,eventId:_})))},$me=Hme}),Wme,Df,qme,Xme,Yme,Kme,Zme,Qme,pLe=C(()=>{F1(),Ar(),Wme=un(),Df=z(nt()),tn(),HOe(),$Oe(),WOe(),tLe(),G8(),nLe(),aLe(),hLe(),Xme=ge.div(qme||(qme=H([`
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  z-index: `,`;
  overflow: visible;
  pointer-events: none;
`])),()=>Of.rightOverlay),Kme=ge.div(Yme||(Yme=H([`
  background: #222;
  position: absolute;
  top: 30px;
  width: 100%;
  height: 30px;
`]))),Zme=({layoutP:a})=>di(()=>{let u=(0,Wme.val)(a.rightDims.width);return Df.default.createElement(Xme,{style:{width:u+"px"}},Df.default.createElement(ime,{layoutP:a}),Df.default.createElement(Rfe,{layoutP:a}),Df.default.createElement(xfe,{layoutP:a}),Df.default.createElement($pe,{layoutP:a}),Df.default.createElement(Kme,null,Df.default.createElement(Mme,{layoutP:a}),Df.default.createElement($me,{layoutP:a})),Df.default.createElement(dfe,{layoutP:a}),Df.default.createElement(lme,{layoutP:a}))},[a]),Qme=Zme}),Jme,rk,e1e,t1e,n1e,r1e,fLe=C(()=>{Jme=un(),Ar(),Pe(),rk=z(nt()),tn(),QT(),fl(),t1e=ge.button(e1e||(e1e=H([`
  outline: none;
  background-color: #1c1d21;
  border: 1px solid #191919;
  border-radius: 2px;
  display: flex;
  bottom: 25px;
  right: 15px;
  z-index: 1;
  position: absolute;

  padding: 4px 8px;
  display: flex;
  color: #656d77;
  line-height: 20px;
  font-size: 10px;

  &:hover {
    color: white;
  }

  & > svg {
    transition: transform 0.3s;
    transform: rotateZ(0deg);
  }

  &:hover > svg {
    transform: rotateZ(-20deg);
  }

  &.open > svg {
    transform: rotateZ(-180deg);
  }

  &.open:hover > svg {
    transform: rotateZ(-160deg);
  }
`]))),n1e=({layoutP:a})=>{let u=ti(a.graphEditorDims.isOpen),d=(0,rk.useCallback)(()=>{let g=(0,Jme.val)(a.graphEditorDims.isOpen);ce().transaction(({stateEditors:_})=>{_.studio.historic.panels.sequenceEditor.graphEditor.setIsOpen({isOpen:!g})})},[a]);return rk.default.createElement(t1e,P({onClick:d,title:"Toggle graph editor",className:u?"open":""},P1("hide")),rk.default.createElement(AIe,null))},r1e=n1e}),Qu,kE,i1e,s1e,o1e,a1e,Uj,l1e,mLe=C(()=>{Qu=z(nt()),tn(),Ar(),kE=un(),sj(),EG(),s1e=ge.div(i1e||(i1e=H([`
  position: absolute;
  right: 0;
  bottom: 0;
  padding-bottom: 10px;
  pointer-events: none;
  z-index: 1;
  display: `,`;
`])),a=>a.isVisible?"block":"none"),a1e=ge.svg(o1e||(o1e=H([`
  position: absolute;
  top: 0;
  left: 0;
  margin: 0;
  pointer-events: none;
`]))),Uj=(0,Qu.forwardRef)(({layoutP:a,sheetAddress:u,renderMode:d="both",color:g="#4a9eff",strokeWidth:_=2,circleRadius:T=3,height:N},R)=>{let O=oe=>oe?"svgViewer_".concat(oe.projectId,"_").concat(oe.sheetId):"svgViewer_default",B=oe=>{try{let ae=O(oe),ue=localStorage.getItem(ae);if(ue){let xe=JSON.parse(ue);if(Array.isArray(xe))return xe.length>0&&typeof xe[0]=="object"&&"time"in xe[0]?[{id:"legacy",data:xe,color:"#4a9eff",name:"Legacy Data"}]:xe.filter(Re=>Re&&typeof Re=="object"&&Array.isArray(Re.data)&&typeof Re.color=="string")}}catch(ae){console.warn(" SVGViewer: Failed to load data from localStorage:",ae)}return[]},V=(oe,ae)=>{try{let ue=O(ae);localStorage.setItem(ue,JSON.stringify(oe))}catch(ue){console.warn(" SVGViewer: Failed to save data to localStorage:",ue)}},[Y,W]=(0,Qu.useState)(()=>B(u)),[$,K]=(0,Qu.useState)(!0);(0,Qu.useEffect)(()=>{let oe=B(u);W(oe)},[u==null?void 0:u.projectId,u==null?void 0:u.sheetId]);let J=oe=>{try{let ae=JSON.parse(oe);if(Array.isArray(ae))return ae.filter(ue=>typeof ue=="object"&&typeof ue.time=="number"&&typeof ue.value=="number")}catch{let ue=oe.trim().split(`
`),xe=[];for(let Re of ue){if(!Re.trim()||Re.toLowerCase().includes("time")||Re.toLowerCase().includes("value"))continue;let Ae=Re.split(",").map(we=>we.trim());if(Ae.length>=2){let we=parseFloat(Ae[0]),ft=parseFloat(Ae[1]);!isNaN(we)&&!isNaN(ft)&&xe.push({time:we,value:ft})}else{let we=Re.split(/\s+/).filter(ft=>ft.length>0);if(we.length>=2){let ft=parseFloat(we[0]),Le=parseFloat(we[1]);!isNaN(ft)&&!isNaN(Le)&&xe.push({time:ft,value:Le})}}}return xe}return[]};return(0,Qu.useImperativeHandle)(R,()=>({clearData:()=>{let oe=[];W(oe),V(oe,u)},addData:(oe,ae)=>{console.log(" SVGViewer: Adding dataset with",oe.length,"points",ae?"and color ".concat(ae):"");let ue={id:"dataset-".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,11)),data:oe,color:ae||g,name:"Dataset ".concat(Y.length+1)},xe=[...Y,ue];W(xe),V(xe,u)},loadData:(oe,ae)=>{console.log(" SVGViewer: loadData called, redirecting to addData");let ue={id:"dataset-".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,11)),data:oe,color:ae||g,name:"Dataset ".concat(Y.length+1)},xe=[...Y,ue];W(xe),V(xe,u)},loadFromClipboard:()=>Me(void 0,null,function*(){try{let oe=yield navigator.clipboard.readText(),ae=J(oe);if(ae.length>0){console.log(" SVGViewer: Successfully parsed",ae.length,"data points from clipboard");let ue={id:"clipboard-".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,11)),data:ae,color:g,name:"Clipboard Data ".concat(Y.length+1)},xe=[...Y,ue];W(xe),V(xe,u)}else console.warn(" SVGViewer: No valid data found in clipboard")}catch(oe){throw console.error(" SVGViewer: Failed to read from clipboard:",oe),oe}}),show:()=>{console.log(" SVGViewer: Showing component"),K(!0)},hide:()=>{console.log(" SVGViewer: Hiding component"),K(!1)}}),[u,Y,g]),di(()=>{let oe=(0,kE.val)(a.rightDims.width),ae=N||(0,kE.val)(a.dopeSheetDims.height)-30,ue=(0,kE.val)(a.scaledSpace.fromUnitSpace)(1),xe=(0,kE.val)(a.scaledSpace.leftPadding),Re=0,Ae=1;return Qu.default.createElement(s1e,{isVisible:$,style:{width:oe+"px",height:ae+"px","--unitSpaceToScaledSpaceMultiplier":ue}},Qu.default.createElement(iI,{layoutP:a,height:ae},Qu.default.createElement(a1e,{width:Tb,height:ae,viewBox:"0 0 ".concat(Tb," ").concat(ae)},Qu.default.createElement("g",{style:{transform:"translate(".concat(xe,"px, 0px)")}},Y.map(we=>{let ft=we.data.map((Se,Ge)=>{let Je=Se.time*ue,He=(Se.value-Re)/Ae,Bt=ae-He*(ae-40)-20;return{x:Je,y:Bt,originalValue:Se.value,time:Se.time,index:Ge}}),Le=ft.length>0?"M ".concat(ft[0].x," ").concat(ft[0].y," ")+ft.slice(1).map(Se=>"L ".concat(Se.x," ").concat(Se.y)).join(" "):"";return Qu.default.createElement("g",{key:we.id},(d==="lines"||d==="both")&&ft.length>1&&Qu.default.createElement("path",{d:Le,fill:"none",stroke:we.color,strokeWidth:_,opacity:.8}),(d==="circles"||d==="both")&&ft.map(Se=>Qu.default.createElement("circle",{key:"".concat(we.id,"-point-").concat(Se.index,"-").concat(Se.time,"-").concat(Se.originalValue),cx:Se.x,cy:Se.y,r:T,fill:we.color,opacity:.9},Qu.default.createElement("title",null,"".concat(we.name||"Dataset"," - Time: ").concat(Se.time.toFixed(2),", Value: ").concat(Se.originalValue.toFixed(3))))))})))))},[a,Y,d,_,T,N,$])}),Uj.displayName="SVGViewer",l1e=Uj});function gLe(a){return Me(this,arguments,function*(u,d={}){let{sampleRate:g=100,normalize:_=!0}=d;try{let T=new(window.AudioContext||window.webkitAudioContext),N=yield u.arrayBuffer(),R=yield T.decodeAudioData(N),O=R.getChannelData(0),B=R.duration,V=R.sampleRate,Y=Math.floor(V/g),W=Math.floor(O.length/Y),$=[],K=0;for(let J=0;J<W;J++){let oe=J*Y,ae=Math.min(oe+Y,O.length),ue=0;for(let Ae=oe;Ae<ae;Ae++)ue+=O[Ae]*O[Ae];let xe=Math.sqrt(ue/(ae-oe)),Re=J*Y/V;$.push({time:Re,amplitude:xe}),xe>K&&(K=xe)}if(_&&K>0)for(let J of $)J.amplitude=J.amplitude/K;return yield T.close(),console.log(" Audio analysis complete: ".concat($.length," data points over ").concat(B.toFixed(2),"s")),$}catch(T){throw console.error(" Audio analysis failed:",T),new Error("Failed to analyze audio file: ".concat(T instanceof Error?T.message:"Unknown error"))}})}function c1e(a){return["audio/mpeg","audio/wav","audio/ogg","audio/mp4","audio/aac"].includes(a.type)||a.name.toLowerCase().match(/\.(mp3|wav|ogg|m4a|aac)$/)!==null}function u1e(a){if(a===0)return"0 Bytes";let u=1024,d=["Bytes","KB","MB","GB"],g=Math.floor(Math.log(a)/Math.log(u));return parseFloat((a/Math.pow(u,g)).toFixed(2))+" "+d[g]}var d1e=C(()=>{}),_i,h1e,p1e,f1e,m1e,g1e,y1e,v1e,zj,x1e,ik,b1e,_1e,S1e,w1e,T1e,E1e,M1e,C1e,A1e,N1e,P1e,R1e,I1e,Vj,k1e,D1e,O1e,L1e,F1e,B1e,U1e,Gj,z1e,V1e,G1e,j1e,H1e,$1e,W1e,q1e,X1e,Y1e,K1e,Z1e,Q1e,J1e,ege,yLe=C(()=>{_i=z(nt()),tn(),ob(),Z2(),d1e(),p1e=ge.div(h1e||(h1e=H([`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
`]))),m1e=ge.div(f1e||(f1e=H([`
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 16px;
  min-width: 400px;
  max-width: 500px;
  background: #2a2a2a;
  border: 1px solid #3a3a3a;
  border-radius: 6px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
`]))),y1e=ge.h3(g1e||(g1e=H([`
  margin: 0;
  font-size: 14px;
  font-weight: 500;
  color: #ccc;
`]))),zj=ge.div(v1e||(v1e=H([`
  display: flex;
  flex-direction: column;
  gap: 8px;
`]))),ik=ge.div(x1e||(x1e=H([`
  `,`;
  font-size: 12px;
  color: #999;
`])),Tf),_1e=ge.div(b1e||(b1e=H([`
  font-size: 11px;
  color: #666;
  font-style: italic;
  margin-top: 4px;
`]))),w1e=ge.div(S1e||(S1e=H([`
  display: flex;
  gap: 8px;
  align-items: center;
`]))),E1e=ge.input(T1e||(T1e=H([`
  width: 40px;
  height: 28px;
  border: 1px solid #3a3a3a;
  border-radius: 4px;
  background: transparent;
  cursor: pointer;

  &::-webkit-color-swatch-wrapper {
    padding: 2px;
  }

  &::-webkit-color-swatch {
    border: none;
    border-radius: 2px;
  }
`]))),C1e=ge(L4)(M1e||(M1e=H([`
  flex: 1;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
`]))),N1e=ge.textarea(A1e||(A1e=H([`
  width: 100%;
  min-height: 120px;
  padding: 8px;
  border: 1px solid #3a3a3a;
  border-radius: 4px;
  background: #2a2a2a;
  color: #ccc;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-size: 12px;
  resize: vertical;

  &::placeholder {
    color: #666;
  }

  &:focus {
    outline: none;
    border-color: #4a9eff;
  }
`]))),R1e=ge.div(P1e||(P1e=H([`
  display: flex;
  gap: 8px;
  justify-content: flex-end;
`]))),Vj=ge.button(I1e||(I1e=H([`
  padding: 8px 16px;
  border: 1px solid
    `,`;
  border-radius: 4px;
  background: `,`;
  color: `,`;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;

  &:hover {
    background: `,`;
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
`])),a=>a.variant==="primary"?"#4a9eff":"#3a3a3a",a=>a.variant==="primary"?"#4a9eff":"transparent",a=>a.variant==="primary"?"#fff":"#ccc",a=>a.variant==="primary"?"#3a8eef":"#3a3a3a"),D1e=ge.div(k1e||(k1e=H([`
  border-top: 1px solid #3a3a3a;
  padding-top: 16px;
  margin-top: 8px;
`]))),L1e=ge.div(O1e||(O1e=H([`
  display: flex;
  flex-direction: column;
  gap: 8px;
`]))),B1e=ge.div(F1e||(F1e=H([`
  border: 2px dashed `,`;
  border-radius: 4px;
  padding: 16px;
  text-align: center;
  background: `,`;
  cursor: pointer;
  transition: all 0.2s;

  `,`

  &:hover {
    border-color: #4a9eff;
    background: rgba(74, 158, 255, 0.05);
  }
`])),a=>a.isDragOver?"#4a9eff":"#3a3a3a",a=>a.isDragOver?"rgba(74, 158, 255, 0.1)":"transparent",a=>a.hasFile&&`
    border-color: #4a9eff;
    background: rgba(74, 158, 255, 0.05);
  `),Gj=ge.div(U1e||(U1e=H([`
  color: #999;
  font-size: 12px;
  margin-bottom: 4px;
`]))),V1e=ge.div(z1e||(z1e=H([`
  color: #ccc;
  font-size: 11px;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
`]))),j1e=ge.div(G1e||(G1e=H([`
  display: flex;
  gap: 16px;
  align-items: center;
  margin-top: 8px;
`]))),$1e=ge.div(H1e||(H1e=H([`
  display: flex;
  flex-direction: column;
  gap: 4px;
`]))),q1e=ge.label(W1e||(W1e=H([`
  `,`;
  font-size: 11px;
  color: #999;
`])),Tf),Y1e=ge.input(X1e||(X1e=H([`
  width: 80px;
  padding: 4px 8px;
  border: 1px solid #3a3a3a;
  border-radius: 4px;
  background: #2a2a2a;
  color: #ccc;
  font-size: 12px;

  &:focus {
    outline: none;
    border-color: #4a9eff;
  }
`]))),Z1e=ge.div(K1e||(K1e=H([`
  font-size: 11px;
  margin-top: 8px;
  color: `,`;
`])),a=>{switch(a.status){case"analyzing":return"#4a9eff";case"complete":return"#4a9eff";case"error":return"#ff6b6b";default:return"#666"}}),Q1e=`[
  {"time": 0, "value": 0},
  {"time": 1, "value": 0.5},
  {"time": 2, "value": 0.2},
  {"time": 3, "value": 1}
]

Or CSV format:
time,value
0,0
1,0.5
2,0.2
3,1

Or space-separated:
0 0
1 0.5
2 0.2
3 1`,J1e=({onLoad:a,onCancel:u})=>{let[d,g]=(0,_i.useState)("#4a9eff"),[_,T]=(0,_i.useState)("#4a9eff"),[N,R]=(0,_i.useState)(""),[O,B]=(0,_i.useState)(null),[V,Y]=(0,_i.useState)(!1),[W,$]=(0,_i.useState)(100),[K,J]=(0,_i.useState)("idle"),[oe,ae]=(0,_i.useState)(""),ue=(0,_i.useRef)(null),xe=(0,_i.useRef)(null);(0,_i.useEffect)(()=>{ue.current&&ue.current.focus()},[]);let Re=Ce=>{try{let ut=JSON.parse(Ce);if(Array.isArray(ut))return ut.filter(kt=>typeof kt=="object"&&typeof kt.time=="number"&&typeof kt.value=="number")}catch{let kt=Ce.trim().split(`
`),De=[];for(let at of kt){if(!at.trim()||at.toLowerCase().includes("time")||at.toLowerCase().includes("value"))continue;let $t=at.split(",").map(Qt=>Qt.trim());if($t.length>=2){let Qt=parseFloat($t[0]),Et=parseFloat($t[1]);!isNaN(Qt)&&!isNaN(Et)&&De.push({time:Qt,value:Et})}else{let Qt=at.split(/\s+/).filter(Et=>Et.length>0);if(Qt.length>=2){let Et=parseFloat(Qt[0]),Te=parseFloat(Qt[1]);!isNaN(Et)&&!isNaN(Te)&&De.push({time:Et,value:Te})}}}return De}return[]},Ae=Re(N).length,we=Ae>0||O!==null,ft=Ce=>Me(void 0,null,function*(){J("analyzing"),ae("");try{let ut=(yield gLe(Ce,{sampleRate:W,normalize:!0})).map(kt=>({time:kt.time,value:kt.amplitude}));R(JSON.stringify(ut,null,2)),J("complete")}catch(ut){console.error("Audio analysis failed:",ut),ae(ut instanceof Error?ut.message:"Analysis failed"),J("error")}}),Le=Ce=>{if(!c1e(Ce)){ae("Please select a supported audio file (MP3, WAV, OGG, M4A, AAC)"),J("error");return}B(Ce),J("idle"),ae(""),ft(Ce)},Se=Ce=>{Ce.preventDefault(),Y(!0)},Ge=Ce=>{Ce.preventDefault(),Y(!1)},Je=Ce=>{Ce.preventDefault(),Y(!1);let ut=Array.from(Ce.dataTransfer.files);ut.length>0&&Le(ut[0])},He=Ce=>{let ut=Ce.target.files;ut&&ut.length>0&&Le(ut[0])},Bt=()=>{var Ce;(Ce=xe.current)==null||Ce.click()},Qe=()=>{let Ce=Re(N);Ce.length>0?a(Ce,d):console.warn("No valid data found in input")};(0,_i.useEffect)(()=>{let Ce=ut=>{ut.key==="Escape"?it():ut.key==="Enter"&&(ut.ctrlKey||ut.metaKey)&&we&&Qe()};return document.addEventListener("keydown",Ce),()=>document.removeEventListener("keydown",Ce)},[we]);let Zt=Ce=>{g(Ce),T(Ce)},gt=Ce=>{T(Ce),/^#[0-9A-F]{6}$/i.test(Ce)&&g(Ce)},it=()=>{R(""),g("#4a9eff"),T("#4a9eff"),B(null),J("idle"),ae(""),u()};return _i.default.createElement(p1e,{onClick:it},_i.default.createElement(m1e,{onClick:Ce=>Ce.stopPropagation()},_i.default.createElement(y1e,null,"Load SVG Data"),_i.default.createElement(zj,null,_i.default.createElement(ik,null,"Color"),_i.default.createElement(w1e,null,_i.default.createElement(E1e,{type:"color",value:d,onChange:Ce=>Zt(Ce.target.value)}),_i.default.createElement(C1e,{value:_,temporarilySetValue:gt,discardTemporaryValue:()=>T(d),permanentlySetValue:gt,isValid:Ce=>/^#[0-9A-F]{6}$/i.test(Ce)}))),_i.default.createElement(zj,null,_i.default.createElement(ik,null,"SVG Data"),_i.default.createElement(N1e,{ref:ue,value:N,onChange:Ce=>R(Ce.target.value),placeholder:Q1e}),N&&_i.default.createElement(_1e,null,Ae>0?"".concat(Ae," data points will be loaded"):"No valid data points found")),_i.default.createElement(D1e,null,_i.default.createElement(ik,null,"Or Analyze Audio File"),_i.default.createElement(L1e,null,_i.default.createElement(B1e,{isDragOver:V,hasFile:O!==null,onClick:Bt,onDragOver:Se,onDragLeave:Ge,onDrop:Je},_i.default.createElement(Gj,null,O?"Click to select a different audio file":"Click to select or drag & drop an audio file"),_i.default.createElement(Gj,{style:{fontSize:"11px",color:"#666"}},"Supported formats: MP3, WAV, OGG, M4A, AAC"),O&&_i.default.createElement(V1e,null," ",O.name," (",u1e(O.size),")")),_i.default.createElement("input",{ref:xe,type:"file",accept:"audio/*,.mp3,.wav,.ogg,.m4a,.aac",onChange:He,style:{display:"none"}}),_i.default.createElement(j1e,null,_i.default.createElement($1e,null,_i.default.createElement(q1e,null,"Sample Rate (Hz)"),_i.default.createElement(Y1e,{type:"number",min:"10",max:"1000",value:W,onChange:Ce=>$(parseInt(Ce.target.value)||100)}))),K!=="idle"&&_i.default.createElement(Z1e,{status:K},K==="analyzing"&&" Analyzing audio...",K==="complete"&&" Audio analysis complete! Data loaded above.",K==="error"&&" ".concat(oe)))),_i.default.createElement(R1e,null,_i.default.createElement(Vj,{onClick:it},"Cancel"),_i.default.createElement(Vj,{variant:"primary",onClick:Qe,disabled:!we},"Create"))))},ege=J1e}),Wi,tge,nge,rge,ige,sge,oge,age,jj,lge,Hj,cge,sk,uge,dge,hge,$j,pge,fge,mge,gge,yge,Wj,vge,xge,bge,_ge,Sge,wge,Tge,Ege,Mge,Cge,Age,qj,Nge,Pge,vLe=C(()=>{Wi=z(nt()),tn(),ob(),Z2(),d1e(),nge=ge.div(tge||(tge=H([`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
`]))),ige=ge.div(rge||(rge=H([`
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 16px;
  min-width: 400px;
  max-width: 500px;
  background: #2a2a2a;
  border: 1px solid #3a3a3a;
  border-radius: 6px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
`]))),oge=ge.h3(sge||(sge=H([`
  margin: 0;
  font-size: 14px;
  font-weight: 500;
  color: #ccc;
`]))),jj=ge.div(age||(age=H([`
  display: flex;
  flex-direction: column;
  gap: 8px;
`]))),Hj=ge.div(lge||(lge=H([`
  `,`;
  font-size: 12px;
  color: #999;
`])),Tf),sk=ge.div(cge||(cge=H([`
  font-size: 11px;
  color: #666;
  font-style: italic;
  margin-bottom: 8px;
`]))),dge=ge.div(uge||(uge=H([`
  display: flex;
  gap: 8px;
  justify-content: flex-end;
`]))),$j=ge.button(hge||(hge=H([`
  padding: 8px 16px;
  border: 1px solid
    `,`;
  border-radius: 4px;
  background: `,`;
  color: `,`;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;

  &:hover {
    background: `,`;
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
`])),a=>a.variant==="primary"?"#4a9eff":"#3a3a3a",a=>a.variant==="primary"?"#4a9eff":"transparent",a=>a.variant==="primary"?"#fff":"#ccc",a=>a.variant==="primary"?"#3a8eef":"#3a3a3a"),fge=ge.div(pge||(pge=H([`
  display: flex;
  flex-direction: column;
  gap: 8px;
`]))),gge=ge.div(mge||(mge=H([`
  border: 2px dashed `,`;
  border-radius: 4px;
  padding: 16px;
  text-align: center;
  background: `,`;
  cursor: pointer;
  transition: all 0.2s;

  `,`

  &:hover {
    border-color: #4a9eff;
    background: rgba(74, 158, 255, 0.05);
  }
`])),a=>a.isDragOver?"#4a9eff":"#3a3a3a",a=>a.isDragOver?"rgba(74, 158, 255, 0.1)":"transparent",a=>a.hasFile&&`
    border-color: #4a9eff;
    background: rgba(74, 158, 255, 0.05);
  `),Wj=ge.div(yge||(yge=H([`
  color: #999;
  font-size: 12px;
  margin-bottom: 4px;
`]))),xge=ge.div(vge||(vge=H([`
  color: #ccc;
  font-size: 11px;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
`]))),_ge=ge(L4)(bge||(bge=H([`
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-size: 12px;

  &::placeholder {
    color: #666;
  }
`]))),wge=ge.div(Sge||(Sge=H([`
  color: #ff6b6b;
  font-size: 11px;
  margin-top: 4px;
`]))),Ege=ge.div(Tge||(Tge=H([`
  color: #4a9eff;
  font-size: 11px;
  margin-top: 4px;
`]))),Cge=ge.div(Mge||(Mge=H([`
  display: flex;
  border-bottom: 1px solid #3a3a3a;
  margin-bottom: 16px;
`]))),qj=ge.button(Age||(Age=H([`
  padding: 8px 16px;
  border: none;
  background: `,`;
  color: `,`;
  font-size: 12px;
  cursor: pointer;
  border-bottom: 2px solid
    `,`;
  transition: all 0.2s;

  &:hover {
    background: #3a3a3a;
    color: #ccc;
  }
`])),a=>a.active?"#3a3a3a":"transparent",a=>a.active?"#ccc":"#999",a=>a.active?"#4a9eff":"transparent"),Nge=({onAttach:a,onCancel:u})=>{let[d,g]=(0,Wi.useState)("file"),[_,T]=(0,Wi.useState)(null),[N,R]=(0,Wi.useState)(""),[O,B]=(0,Wi.useState)(!1),[V,Y]=(0,Wi.useState)(!1),[W,$]=(0,Wi.useState)(""),[K,J]=(0,Wi.useState)(""),oe=(0,Wi.useRef)(null);(0,Wi.useEffect)(()=>{$(""),J("")},[d]);let ae=Je=>{if(!c1e(Je)){$("Please select a supported audio file (MP3, WAV, OGG, M4A, AAC)");return}T(Je),$(""),J("")},ue=Je=>{Je.preventDefault(),B(!0)},xe=Je=>{Je.preventDefault(),B(!1)},Re=Je=>{Je.preventDefault(),B(!1);let He=Array.from(Je.dataTransfer.files);He.length>0&&ae(He[0])},Ae=Je=>{let He=Je.target.files;He&&He.length>0&&ae(He[0])},we=()=>{var Je;(Je=oe.current)==null||Je.click()},ft=Je=>{try{return new URL(Je),!0}catch{return!1}},Le=()=>d==="file"?_!==null:N.trim()!==""&&ft(N.trim()),Se=()=>Me(void 0,null,function*(){if(Le()){Y(!0),$(""),J("");try{let Je=d==="file"?_:N.trim();yield a(Je),J("Audio attached successfully!"),setTimeout(()=>{u()},1e3)}catch(Je){console.error("Failed to attach audio:",Je),$(Je instanceof Error?Je.message:"Failed to attach audio")}finally{Y(!1)}}});(0,Wi.useEffect)(()=>{let Je=He=>{He.key==="Escape"?Ge():He.key==="Enter"&&(He.ctrlKey||He.metaKey)&&Le()&&Se()};return document.addEventListener("keydown",Je),()=>document.removeEventListener("keydown",Je)},[d,_,N]);let Ge=()=>{T(null),R(""),$(""),J(""),u()};return Wi.default.createElement(nge,{onClick:Ge},Wi.default.createElement(ige,{onClick:Je=>Je.stopPropagation()},Wi.default.createElement(oge,null,"Attach Audio to Sequence"),Wi.default.createElement(sk,null,"Attach an audio file to sync with your sequence playback. The audio will play automatically when the sequence plays."),Wi.default.createElement(Cge,null,Wi.default.createElement(qj,{active:d==="file",onClick:()=>g("file")},"Upload File"),Wi.default.createElement(qj,{active:d==="url",onClick:()=>g("url")},"From URL")),d==="file"?Wi.default.createElement(jj,null,Wi.default.createElement(Hj,null,"Audio File"),Wi.default.createElement(fge,null,Wi.default.createElement(gge,{isDragOver:O,hasFile:_!==null,onClick:we,onDragOver:ue,onDragLeave:xe,onDrop:Re},Wi.default.createElement(Wj,null,_?"Click to select a different audio file":"Click to select or drag & drop an audio file"),Wi.default.createElement(Wj,{style:{fontSize:"11px",color:"#666"}},"Supported formats: MP3, WAV, OGG, M4A, AAC"),_&&Wi.default.createElement(xge,null," ",_.name," (",u1e(_.size),")")),Wi.default.createElement("input",{ref:oe,type:"file",accept:"audio/*,.mp3,.wav,.ogg,.m4a,.aac",onChange:Ae,style:{display:"none"}}))):Wi.default.createElement(jj,null,Wi.default.createElement(Hj,null,"Audio URL"),Wi.default.createElement(_ge,{value:N,temporarilySetValue:R,discardTemporaryValue:()=>R(""),permanentlySetValue:R,isValid:Je=>Je.trim()===""||ft(Je.trim())}),N.trim()===""&&Wi.default.createElement(sk,{style:{marginTop:"4px",fontSize:"11px",color:"#666"}},"Example: https://example.com/audio.mp3"),Wi.default.createElement(sk,null,"Enter a URL to an audio file. Make sure the server supports CORS if loading from a different domain.")),W&&Wi.default.createElement(wge,null," ",W),K&&Wi.default.createElement(Ege,null," ",K),Wi.default.createElement(dge,null,Wi.default.createElement($j,{onClick:Ge,disabled:V},"Cancel"),Wi.default.createElement($j,{variant:"primary",onClick:Se,disabled:!Le()||V},V?"Attaching...":"Attach Audio"))))},Pge=Nge});function xLe(){return Eo.default.createElement("svg",{fill:"#FFFFFF",width:"800px",height:"800px",viewBox:"0 0 1920 1920",xmlns:"http://www.w3.org/2000/svg",style:{width:"15px",height:"15px"}},Eo.default.createElement("path",{d:"M1637.718 0c93.4 0 169.406 76.007 169.406 169.407v1581.13c0 93.512-76.007 169.407-169.406 169.407H451.87V0h1185.848zM1158.7 581l-79.861 79.861 242.422 242.423H667v112.94h654.262l-242.422 242.423 79.861 79.862 378.755-378.755L1158.7 581zM225.938 1920h112.938V.056H225.938z"}))}var Eo,Rge,Ige,kge,Dge,Oge,Lge,Fge,Bge,Uge,zge,Vge,Gge,jge,Hge,$ge,Wge,Xj,qge,Xge,Yge,Kge,bLe=C(()=>{Eo=z(nt()),tn(),Rge=un(),Ar(),kge=ge.div(Ige||(Ige=H([`
  position: absolute;
  bottom: 10px;
  left: 10px;
  z-index: 100;
  display: flex;
  align-items: center;
  gap: 8px;
  width: `,`px; /* Subtract left/right margins */
  box-sizing: border-box;
`])),a=>a.width-20),Oge=ge.input(Dge||(Dge=H([`
  background: `,`;
  color: #cccccc;
  border: 1px solid `,`;
  padding: 8px 12px;
  border-radius: 4px;
  font-size: 12px;
  font-family: inherit;
  flex: 1; /* Expand to fill available space */
  min-width: 80px; /* Minimum width to ensure usability */
  transition: all 0.15s ease-out;

  &:focus {
    outline: none;
    border-color: #0078d4;
    background: #1e1e1e;
  }

  &::placeholder {
    color: #6a6a6a;
  }
`])),a=>a.hasValue?"#1e1e1e":"#2d2d30",a=>a.hasValue?"#0078d4":"#3e3e42"),Fge=ge.button(Lge||(Lge=H([`
  background: #2d2d30;
  color: white;
  border: 1px solid #3e3e42;
  padding: 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  font-family: inherit;
  display: flex;
  align-items: center;
  gap: 4px;

  &:hover {
    background: #3e3e42;
  }

  &:active {
    background: #1e1e1e;
  }
`]))),Uge=ge.button(Bge||(Bge=H([`
  background: `,`;
  color: white;
  border: 1px solid #3e3e42;
  padding: 8px 10px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  font-family: inherit;
  display: flex;
  align-items: center;
  gap: 6px;

  &:hover {
    background: `,`;
  }

  &:active {
    background: #005a9e;
  }
`])),a=>a.isOpen?"#0078d4":"#2d2d30",a=>a.isOpen?"#106ebe":"#3e3e42"),Vge=ge.div(zge||(zge=H([`
  position: absolute;
  bottom: 100%;
  left: 0;
  background: #2d2d30;
  border: 1px solid #3e3e42;
  border-radius: 4px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  min-width: 200px;
  opacity: `,`;
  visibility: `,`;
  transform: `,`;
  transition: all 0.15s ease-out;
  z-index: 1000;
`])),a=>a.isOpen?1:0,a=>a.isOpen?"visible":"hidden",a=>a.isOpen?"translateY(0)":"translateY(10px)"),jge=ge.div(Gge||(Gge=H([`
  padding: 4px 0;

  &:not(:last-child) {
    border-bottom: 1px solid #3e3e42;
  }
`]))),$ge=ge.div(Hge||(Hge=H([`
  position: relative;

  &:hover > div:last-child {
    opacity: `,`;
    visibility: `,`;
  }
`])),a=>a.hasSubmenu?1:0,a=>a.hasSubmenu?"visible":"hidden"),Xj=ge.button(Wge||(Wge=H([`
  width: 100%;
  background: transparent;
  color: #cccccc;
  border: none;
  padding: 8px 16px;
  text-align: left;
  cursor: pointer;
  font-size: 12px;
  font-family: inherit;
  display: flex;
  align-items: center;
  justify-content: space-between;

  &:hover {
    background: #3e3e42;
    color: white;
  }

  &:active {
    background: #0078d4;
  }
`]))),Xge=ge.div(qge||(qge=H([`
  position: absolute;
  left: 100%;
  top: 0;
  background: #2d2d30;
  border: 1px solid #3e3e42;
  border-radius: 4px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  min-width: 150px;
  opacity: 0;
  visibility: hidden;
  transition: all 0.15s ease-out;
  z-index: 1001;
`]))),Yge=({layoutP:a,onSVGViewerClear:u,onSVGViewerLoad:d,onSVGViewerShow:g,onSVGViewerHide:_,onFileSave:T,onMarkersAdd:N,onMarkersClear:R,onMarkersLog:O,onEventsAdd:B,onEventsClear:V,onEventsLog:Y,onSheetCreate:W,onSheetDuplicate:$,onSheetObjectCreate:K,onSearchChange:J,onSearchTrigger:oe})=>{let[ae,ue]=(0,Eo.useState)(!1),[xe,Re]=(0,Eo.useState)(""),[Ae,we]=(0,Eo.useState)(0),ft=(0,Eo.useCallback)(()=>{ue(Qe=>!Qe)},[]),Le=(0,Eo.useCallback)(()=>{ue(!1)},[]),Se=(0,Eo.useCallback)(Qe=>{let Zt=Qe.target.value;Re(Zt),J&&J(Zt)},[J]),Ge=(0,Eo.useCallback)(Qe=>{if(Qe.key==="Enter"){let Zt=Ae+1;we(Zt),oe&&oe(Zt),J&&J(xe)}},[J,oe,xe,Ae]),Je=(0,Eo.useCallback)(Qe=>{Qe&&Qe(),Le()},[Le]),He=[{label:"File",submenu:[{label:"Save",action:T}]},{label:"Sheets",submenu:[{label:"Create Sheet",action:W},{label:"Duplicate Sheet",action:$},{label:"Create Sheet Object",action:K}]},{label:"Markers",submenu:[{label:"Add",action:N},{label:"Log",action:O},{label:"Clear",action:R}]},{label:"Events",submenu:[{label:"Add",action:B},{label:"Log",action:Y},{label:"Clear",action:V}]},{label:"Data Viewer",submenu:[{label:"Show",action:g},{label:"Hide",action:_},{label:"Load",action:d},{label:"Clear",action:u}]}],Bt=(Qe,Zt)=>Eo.default.createElement($ge,{key:Zt,hasSubmenu:!!Qe.submenu},Eo.default.createElement(Xj,{hasSubmenu:!!Qe.submenu,onClick:()=>!Qe.submenu&&Je(Qe.action)},Qe.label,Qe.submenu&&Eo.default.createElement("span",null,"")),Qe.submenu&&Eo.default.createElement(Xge,null,Qe.submenu.map((gt,it)=>Eo.default.createElement(Xj,{key:it,onClick:()=>Je(gt.action)},gt.label))));return di(()=>{let Qe=(0,Rge.val)(a),Zt=Qe.rightPanelOpen,gt=Qe.leftDims.width;return Eo.default.createElement(kge,{width:gt},Eo.default.createElement(Uge,{isOpen:ae,onClick:ft},Eo.default.createElement("span",null,"")),Eo.default.createElement(Vge,{isOpen:ae},Eo.default.createElement(jge,null,He.map(Bt))),Eo.default.createElement(Oge,{type:"text",placeholder:"Search...",value:xe,onChange:Se,onKeyDown:Ge,hasValue:xe.length>0}),Eo.default.createElement(Fge,{isActive:Zt,onClick:()=>{Qe.setRightPanelOpen(!Zt)},title:Zt?"Hide timeline editor":"Show timeline editor",style:{transform:"scale(".concat(Zt?-1:1,", 1)")}},Eo.default.createElement(xLe,null)),ae&&Eo.default.createElement("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:99},onClick:Le}))},[a,ae,He])},Kge=Yge}),M0,Zge,Qge,Jge,e2e,t2e,n2e,r2e,i2e,s2e,o2e,a2e,Yj,l2e,c2e,_Le=C(()=>{M0=z(nt()),tn(),Qge=ge.div(Zge||(Zge=H([`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: `,`;
  align-items: center;
  justify-content: center;
  z-index: 10000;
`])),a=>a.isOpen?"flex":"none"),e2e=ge.div(Jge||(Jge=H([`
  background: #2d2d30;
  border: 1px solid #3e3e42;
  border-radius: 8px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
  padding: 24px;
  min-width: 400px;
  max-width: 500px;
`]))),n2e=ge.h3(t2e||(t2e=H([`
  color: #ffffff;
  font-size: 16px;
  font-family: inherit;
  margin: 0 0 16px 0;
  font-weight: 500;
`]))),i2e=ge.input(r2e||(r2e=H([`
  width: 100%;
  background: #1e1e1e;
  border: 1px solid #3e3e42;
  border-radius: 4px;
  padding: 8px 12px;
  color: #ffffff;
  font-size: 14px;
  font-family: inherit;
  margin-bottom: 20px;
  box-sizing: border-box;

  &:focus {
    outline: none;
    border-color: #0078d4;
    box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.3);
  }

  &::placeholder {
    color: #888888;
  }
`]))),o2e=ge.div(s2e||(s2e=H([`
  display: flex;
  gap: 12px;
  justify-content: flex-end;
`]))),Yj=ge.button(a2e||(a2e=H([`
  background: `,`;
  color: `,`;
  border: 1px solid
    `,`;
  border-radius: 4px;
  padding: 8px 16px;
  font-size: 14px;
  font-family: inherit;
  cursor: pointer;
  min-width: 80px;

  &:hover {
    background: `,`;
  }

  &:active {
    background: `,`;
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
`])),a=>a.variant==="primary"?"#0078d4":"transparent",a=>a.variant==="primary"?"#ffffff":"#cccccc",a=>a.variant==="primary"?"#0078d4":"#3e3e42",a=>a.variant==="primary"?"#106ebe":"#3e3e42",a=>a.variant==="primary"?"#005a9e":"#4a4a4a"),l2e=(0,M0.forwardRef)(({onConfirm:a,onCancel:u},d)=>{let[g,_]=(0,M0.useState)(!1),[T,N]=(0,M0.useState)("create"),[R,O]=(0,M0.useState)(""),B=T==="create"?"Create New Sheet":"Duplicate Sheet",V="Enter sheet name";(0,M0.useImperativeHandle)(d,()=>({open:(J,oe)=>{N(J),_(!0),O(J==="duplicate"&&oe?"".concat(oe," Copy"):"")},close:()=>{_(!1),O("")}}));let Y=(0,M0.useCallback)(()=>{let J=R.trim();J&&(a(J,T),_(!1),O(""))},[R,T,a]),W=(0,M0.useCallback)(()=>{u(),_(!1),O("")},[u]),$=(0,M0.useCallback)(J=>{J.key==="Enter"?Y():J.key==="Escape"&&W()},[Y,W]),K=(0,M0.useCallback)(J=>{J.target===J.currentTarget&&W()},[W]);return M0.default.createElement(Qge,{isOpen:g,onClick:K},M0.default.createElement(e2e,null,M0.default.createElement(n2e,null,B),M0.default.createElement(i2e,{type:"text",value:R,onChange:J=>O(J.target.value),onKeyDown:$,placeholder:V,autoFocus:!0}),M0.default.createElement(o2e,null,M0.default.createElement(Yj,{variant:"secondary",onClick:W},"Cancel"),M0.default.createElement(Yj,{variant:"primary",onClick:Y,disabled:!R.trim()},"Create"))))}),c2e=l2e}),Er,u2e,d2e,h2e,p2e,f2e,m2e,g2e,Ab,y2e,l3,v2e,Q4,x2e,b2e,_2e,S2e,w2e,T2e,E2e,M2e,C2e,A2e,N2e,P2e,R2e,I2e,k2e,D2e,O2e,L2e,F2e,B2e,U2e,z2e,V2e,Kj,Zj,G2e,SLe=C(()=>{Er=z(nt()),tn(),d2e=ge.div(u2e||(u2e=H([`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: `,`;
  align-items: center;
  justify-content: center;
  z-index: 10000;
`])),a=>a.isOpen?"flex":"none"),p2e=ge.div(h2e||(h2e=H([`
  background: #2d2d30;
  border: 1px solid #3e3e42;
  border-radius: 8px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
  padding: 24px;
  min-width: 500px;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
`]))),m2e=ge.h3(f2e||(f2e=H([`
  color: #ffffff;
  font-size: 16px;
  font-family: inherit;
  margin: 0 0 20px 0;
  font-weight: 500;
`]))),Ab=ge.div(g2e||(g2e=H([`
  margin-bottom: 16px;
`]))),l3=ge.label(y2e||(y2e=H([`
  display: block;
  color: #cccccc;
  font-size: 12px;
  font-family: inherit;
  margin-bottom: 6px;
  font-weight: 500;
`]))),Q4=ge.input(v2e||(v2e=H([`
  width: 100%;
  background: #1e1e1e;
  border: 1px solid #3e3e42;
  border-radius: 4px;
  padding: 8px 12px;
  color: #ffffff;
  font-size: 14px;
  font-family: inherit;
  box-sizing: border-box;

  &:focus {
    outline: none;
    border-color: #0078d4;
    box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.3);
  }

  &::placeholder {
    color: #888888;
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
`]))),b2e=ge.select(x2e||(x2e=H([`
  width: 100%;
  background: #1e1e1e;
  border: 1px solid #3e3e42;
  border-radius: 4px;
  padding: 8px 12px;
  color: #ffffff;
  font-size: 14px;
  font-family: inherit;
  box-sizing: border-box;

  &:focus {
    outline: none;
    border-color: #0078d4;
    box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.3);
  }

  option {
    background: #1e1e1e;
    color: #ffffff;
  }
`]))),S2e=ge.div(_2e||(_2e=H([`
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 12px;
`]))),T2e=ge.div(w2e||(w2e=H([`
  display: flex;
  gap: 12px;
  align-items: flex-end;
`]))),M2e=ge.div(E2e||(E2e=H([`
  width: 40px;
  height: 32px;
  border-radius: 4px;
  border: 1px solid #3e3e42;
  background: `,`;
  cursor: pointer;
  position: relative;

  &:hover {
    border-color: #0078d4;
  }
`])),a=>a.color),A2e=ge.input(C2e||(C2e=H([`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
`]))),P2e=ge(Q4)(N2e||(N2e=H([`
  flex: 1;
  font-family: 'Courier New', monospace;
  text-transform: uppercase;
`]))),I2e=ge.div(R2e||(R2e=H([`
  display: flex;
  align-items: center;
  gap: 12px;
`]))),D2e=ge.div(k2e||(k2e=H([`
  width: 48px;
  height: 24px;
  border-radius: 12px;
  background: `,`;
  border: 1px solid `,`;
  position: relative;
  cursor: pointer;
  transition: all 0.2s ease;

  &:hover {
    background: `,`;
  }
`])),a=>a.isOn?"#0078d4":"#3e3e42",a=>a.isOn?"#0078d4":"#5a5a5a",a=>a.isOn?"#106ebe":"#4a4a4a"),L2e=ge.div(O2e||(O2e=H([`
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #ffffff;
  position: absolute;
  top: 2px;
  left: `,`;
  transition: all 0.2s ease;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
`])),a=>a.isOn?"26px":"2px"),B2e=ge.span(F2e||(F2e=H([`
  color: `,`;
  font-size: 14px;
  font-family: inherit;
  font-weight: `,`;
`])),a=>a.isOn?"#ffffff":"#cccccc",a=>a.isOn?"500":"normal"),z2e=ge.div(U2e||(U2e=H([`
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  margin-top: 24px;
`]))),Kj=ge.button(V2e||(V2e=H([`
  background: `,`;
  color: `,`;
  border: 1px solid
    `,`;
  border-radius: 4px;
  padding: 8px 16px;
  font-size: 14px;
  font-family: inherit;
  cursor: pointer;
  min-width: 80px;

  &:hover {
    background: `,`;
  }

  &:active {
    background: `,`;
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
`])),a=>a.variant==="primary"?"#0078d4":"transparent",a=>a.variant==="primary"?"#ffffff":"#cccccc",a=>a.variant==="primary"?"#0078d4":"#3e3e42",a=>a.variant==="primary"?"#106ebe":"#3e3e42",a=>a.variant==="primary"?"#005a9e":"#4a4a4a"),Zj=(0,Er.forwardRef)(({onConfirm:a,onCancel:u},d)=>{let[g,_]=(0,Er.useState)(!1),[T,N]=(0,Er.useState)(""),[R,O]=(0,Er.useState)(""),[B,V]=(0,Er.useState)("number"),[Y,W]=(0,Er.useState)(""),[$,K]=(0,Er.useState)(""),[J,oe]=(0,Er.useState)(""),[ae,ue]=(0,Er.useState)(""),[xe,Re]=(0,Er.useState)("#FFFFFF"),[Ae,we]=(0,Er.useState)(!1),ft=Et=>{let Te=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(Et);return Te?{r:parseInt(Te[1],16)/255,g:parseInt(Te[2],16)/255,b:parseInt(Te[3],16)/255,a:1}:{r:1,g:1,b:1,a:1}},Le=Et=>{let Te=vt=>{let Mt=Math.round(vt*255).toString(16);return Mt.length===1?"0"+Mt:Mt};return"#".concat(Te(Et.r)).concat(Te(Et.g)).concat(Te(Et.b)).toUpperCase()},Se=Et=>{try{let Te=JSON.parse(Et);if(Te&&typeof Te=="object"&&"r"in Te&&"g"in Te&&"b"in Te)return{r:Te.r,g:Te.g,b:Te.b,a:1}}catch{}return{r:1,g:1,b:1,a:1}};(0,Er.useImperativeHandle)(d,()=>({open:Et=>{_(!0),N(Et||""),O(""),V("number"),W(""),K(""),oe(""),ue(""),Re("#FFFFFF"),we(!1)},close:()=>{_(!1)}}));let Ge=Et=>{switch(Et){case"number":return"0";case"string":return"Hello World";case"boolean":return"false";case"rgba":return'{"r": 1, "g": 1, "b": 1, "a": 1}';case"compound":return'{"x": 0, "y": 0, "z": 0}';default:return""}},Je=Et=>{switch(Et){case"number":return"e.g. 0, 3.14, -10";case"string":return'e.g. "Hello World"';case"boolean":return"Use toggle below";case"rgba":return"Use color picker or enter hex";case"compound":return'{"x": 0, "y": 0, "z": 0}';default:return""}},He=Et=>{V(Et);let Te=Ge(Et);if(W(Te),Et==="rgba"){let vt=Se(Te);Re(Le(vt))}else Et==="boolean"&&(we(!1),W("false"));Et!=="number"&&(K(""),oe(""),ue(""))},Bt=()=>{let Et=!Ae;we(Et),W(Et.toString())},Qe=Et=>{Re(Et);let Te=ft(Et);W(JSON.stringify(Te))},Zt=Et=>{/^#[0-9A-Fa-f]{6}$/.test(Et)?Qe(Et):Re(Et)},gt=(Et,Te)=>{switch(Te){case"number":let vt=parseFloat(Et);return isNaN(vt)?0:vt;case"string":return Et;case"boolean":return Et.toLowerCase()==="true";case"rgba":try{return JSON.parse(Et)}catch{return{r:1,g:1,b:1,a:1}}case"compound":try{return JSON.parse(Et)}catch{return{}}default:return Et}},it=(0,Er.useCallback)(()=>{let Et=T.trim(),Te=R.trim();if(!Et||!Te)return;let vt=gt(Y,B),Mt={name:Et,key:Te,type:B,value:vt};B==="number"&&($!==""&&(Mt.min=parseFloat($)),J!==""&&(Mt.max=parseFloat(J)),ae!==""&&(Mt.step=parseFloat(ae))),a(Mt),_(!1)},[T,R,B,Y,$,J,ae,a]),Ce=(0,Er.useCallback)(()=>{u(),_(!1)},[u]),ut=(0,Er.useCallback)(Et=>{Et.key==="Enter"&&Et.ctrlKey?it():Et.key==="Escape"&&Ce()},[it,Ce]),kt=(0,Er.useCallback)(Et=>{Et.target===Et.currentTarget&&Ce()},[Ce]),De=B==="number",at=B==="rgba",$t=B==="boolean",Qt=T.trim()!==""&&R.trim()!=="";return Er.default.createElement(d2e,{isOpen:g,onClick:kt},Er.default.createElement(p2e,null,Er.default.createElement(m2e,null,"Create Sheet Object"),Er.default.createElement(Ab,null,Er.default.createElement(l3,null,"Object Name"),Er.default.createElement(Q4,{type:"text",value:T,onChange:Et=>N(Et.target.value),onKeyDown:ut,placeholder:"Enter object name (e.g. 'myBox', 'character')",autoFocus:!0})),Er.default.createElement(Ab,null,Er.default.createElement(l3,null,"Property Key"),Er.default.createElement(Q4,{type:"text",value:R,onChange:Et=>O(Et.target.value),onKeyDown:ut,placeholder:"Enter property key (e.g. 'position', 'color', 'scale')"})),Er.default.createElement(Ab,null,Er.default.createElement(l3,null,"Type"),Er.default.createElement(b2e,{value:B,onChange:Et=>He(Et.target.value)},Er.default.createElement("option",{value:"number"},"Number"),Er.default.createElement("option",{value:"string"},"String"),Er.default.createElement("option",{value:"boolean"},"Boolean"),Er.default.createElement("option",{value:"rgba"},"Color"),Er.default.createElement("option",{value:"compound"},"Object"))),Er.default.createElement(Ab,null,Er.default.createElement(l3,null,"Default Value"),at?Er.default.createElement(T2e,null,Er.default.createElement(M2e,{color:xe},Er.default.createElement(A2e,{type:"color",value:xe,onChange:Et=>Qe(Et.target.value)})),Er.default.createElement(P2e,{type:"text",value:xe,onChange:Et=>Zt(Et.target.value),onKeyDown:ut,placeholder:"#FFFFFF"})):$t?Er.default.createElement(I2e,null,Er.default.createElement(D2e,{isOn:Ae,onClick:Bt},Er.default.createElement(L2e,{isOn:Ae})),Er.default.createElement(B2e,{isOn:Ae},Ae?"True":"False")):Er.default.createElement(Q4,{type:"text",value:Y,onChange:Et=>W(Et.target.value),onKeyDown:ut,placeholder:Je(B)})),De&&Er.default.createElement(Ab,null,Er.default.createElement(l3,null,"Range (Optional)"),Er.default.createElement(S2e,null,Er.default.createElement("div",null,Er.default.createElement(l3,{style:{fontSize:"11px",marginBottom:"4px"}},"Min"),Er.default.createElement(Q4,{type:"number",value:$,onChange:Et=>K(Et.target.value),onKeyDown:ut,placeholder:"Min"})),Er.default.createElement("div",null,Er.default.createElement(l3,{style:{fontSize:"11px",marginBottom:"4px"}},"Max"),Er.default.createElement(Q4,{type:"number",value:J,onChange:Et=>oe(Et.target.value),onKeyDown:ut,placeholder:"Max"})),Er.default.createElement("div",null,Er.default.createElement(l3,{style:{fontSize:"11px",marginBottom:"4px"}},"Step"),Er.default.createElement(Q4,{type:"number",value:ae,onChange:Et=>ue(Et.target.value),onKeyDown:ut,placeholder:"Step"})))),Er.default.createElement(z2e,null,Er.default.createElement(Kj,{variant:"secondary",onClick:Ce},"Cancel"),Er.default.createElement(Kj,{variant:"primary",onClick:it,disabled:!Qt},"Create"))))}),Zj.displayName="SheetObjectModal",G2e=Zj});function wLe(a,u){let d=new File([a],u),g=URL.createObjectURL(d),_=Object.assign(document.createElement("a"),{href:g,target:"_blank",rel:"noopener"});_.setAttribute("download",u),_.click(),setTimeout(()=>{URL.revokeObjectURL(g)},4e4)}var Ys,Hn,Nb,j2e,H2e,$2e,W2e,Of,q2e,X2e,Y2e,K2e,Z2e,Q2e,J2e,e3e,t3e,n3e,r3e,i3e,s3e,DE,o3e,a3e,l3e,c3e,u3e,d3e,h3e,p3e,f3e,m3e,F1=C(()=>{Pe(),q7(),wf(),Ar(),gie(),Ys=un(),Hn=z(nt()),tn(),Nb=N_e(),TOe(),LI(),DOe(),pLe(),Z7(),rE(),lf(),pre(),Gre(),fl(),Wt(),b0(),fLe(),O4(),dE(),mLe(),yLe(),vLe(),bLe(),_Le(),SLe(),tj(),H2e=ge(lV)(j2e||(j2e=H([`
  z-index: `,`;
  box-shadow: 2px 2px 0 rgb(0 0 0 / 11%);
  `,`
`])),v8.sequenceEditorPanel,a=>a.collapsedWidth?"width: ".concat(a.collapsedWidth,"px !important; max-width: ").concat(a.collapsedWidth,"px !important;"):""),W2e=ge.div($2e||($2e=H([`
  background-color: rgba(40, 43, 47, 0.99);
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  z-index: -1;
  pointer-events: none;
`]))),Of=(()=>{let a={svgViewer:0,rightBackground:0,scrollableArea:0,rightOverlay:0,lengthIndicatorCover:0,lengthIndicatorStrip:0,playhead:0,currentFrameStamp:0,marker:0,horizontalScrollbar:0},u=-1;for(let d of Object.keys(a))a[d]=u,u++;return a})(),X2e=ge(tV)(q2e||(q2e=H([`
  position: absolute;
  left: 0;
  top: 0;
  z-index: 2;

  `,` {
    height: 60px;
    display: flex;
    flex-direction: column;
    align-items: normal;
    padding: 0;
  }
`])),aR),Y2e={edges:{left:{from:"screenLeft",distance:.1},right:{from:"screenRight",distance:.2},top:{from:"screenBottom",distance:.4},bottom:{from:"screenBottom",distance:.01}}},K2e=()=>di(()=>{var a;let u=ce(),d={width:(a=(0,Ys.val)(u.atomP.historic.panels.sequenceEditor.rightPanelOpen))==null||a?_j*2:_j,height:200};return Hn.default.createElement(Xz,{panelId:"sequenceEditor",defaultPosition:Y2e,minDims:d},Hn.default.createElement(Z2e,null))},[]),Z2e=()=>{let{dims:a}=K7(),[u,d]=(0,Hn.useState)(null),[g,_]=(0,Hn.useState)(""),[T,N]=(0,Hn.useState)(0),R=(0,Hn.useRef)(null),[O,B]=(0,Hn.useState)(!1),[V,Y]=(0,Hn.useState)(!1),[W,$]=(0,Hn.useState)(null),K=(0,Hn.useRef)(null),J=(0,Hn.useRef)(null),oe=(0,Hn.useRef)(new Map),ae=(0,Hn.useRef)(null),ue=(0,Hn.useCallback)(()=>{var Te;(Te=R.current)==null||Te.clearData()},[]),xe=(0,Hn.useCallback)(()=>{B(!0)},[]),Re=(0,Hn.useCallback)(()=>{var Te;(Te=R.current)==null||Te.show()},[]),Ae=(0,Hn.useCallback)(()=>{var Te;(Te=R.current)==null||Te.hide()},[]),we=(0,Hn.useCallback)((Te,vt)=>{var Mt;(Mt=R.current)==null||Mt.addData(Te,vt),B(!1)},[]),ft=(0,Hn.useCallback)(()=>{B(!1)},[]),Le=(0,Hn.useCallback)(Te=>Me(void 0,null,function*(){if(!W)throw new Error("No sheet selected");try{let vt=W.project.publicApi.sheet(W.address.sheetId).sequence,Mt;Te instanceof File?Mt=URL.createObjectURL(Te):Mt=Te,yield vt.attachAudio({source:Mt}),console.log(" Audio attached successfully"),Te instanceof File&&setTimeout(()=>{URL.revokeObjectURL(Mt)},5e3)}catch(vt){throw console.error(" Failed to attach audio:",vt),vt}}),[W]),Se=(0,Hn.useCallback)(()=>{Y(!1),$(null)},[]),Ge=(0,Hn.useCallback)(()=>{var Te;(Te=K.current)==null||Te.open("create")},[]),Je=(0,Hn.useCallback)(()=>{var Te,vt;let Mt=ae.current,En=((Te=Mt==null?void 0:Mt.address)==null?void 0:Te.sheetId)||"Sheet";(vt=K.current)==null||vt.open("duplicate",En)},[]),He=(0,Hn.useCallback)((Te,vt)=>{var Mt;try{let En=ae.current;if((Mt=En==null?void 0:En.project)!=null&&Mt.publicApi){let pr=En.project.publicApi.sheet(Te);console.log(" Successfully ".concat(vt==="create"?"created":"duplicated"," sheet: ").concat(Te))}else console.error(" No current sheet or project available")}catch(En){console.error(" Failed to ".concat(vt," sheet:"),En)}},[]),Bt=(0,Hn.useCallback)(()=>{console.log(" Sheet modal cancelled")},[]),Qe=(0,Hn.useCallback)(()=>{var Te;(Te=J.current)==null||Te.open()},[]),Zt=(0,Hn.useCallback)(Te=>{_(Te)},[]),gt=(0,Hn.useCallback)(Te=>{N(Te)},[]);Hn.default.useEffect(()=>{let Te=vt=>{let{sheet:Mt}=vt.detail;$(Mt),Y(!0)};return document.addEventListener("theatre:attachAudio",Te),()=>{document.removeEventListener("theatre:attachAudio",Te)}},[]);let it=(0,Hn.useCallback)(Te=>{try{let vt=ae.current;if(vt){let Mt;switch(Te.type){case"number":if(Te.min!==void 0||Te.max!==void 0||Te.step!==void 0){let Ei={};Te.min!==void 0&&Te.max!==void 0&&(Ei.range=[Te.min,Te.max]),Te.step!==void 0&&(Ei.nudgeMultiplier=Te.step),Mt=Nb.types.number(Te.value,Ei)}else Mt=Nb.types.number(Te.value);break;case"string":Mt=Nb.types.string(Te.value);break;case"boolean":Mt=Nb.types.boolean(Te.value);break;case"rgba":Mt=Nb.types.rgba(Te.value);break;case"compound":Mt=Te.value;break;default:Mt=Te.value}let En=vt.project.publicApi.sheet(vt.address.sheetId),pr="".concat(vt.address.sheetId,":").concat(Te.name),wr=oe.current.get(pr)||{};wr[Te.key]=Mt,oe.current.set(pr,wr);let Or;try{let Ei,Vs={};try{Ei=En.object(Te.name,{}),Vs=Ei.value||{}}catch{}let li=P({},wr);Or=En.object(Te.name,li,{reconfigure:!0});let Mo=Object.keys(wr),Si=Object.keys(Or.value||{}),Ri=Mo.filter(Wl=>!Si.includes(Wl));Ri.length!==0&&(console.log(" Still missing props:",Ri),console.log("This indicates a fundamental Theatre.js limitation with reconfigure"))}catch(Ei){throw console.error(" Object creation failed:",Ei),Ei}}else console.error(" No current sheet available")}catch(vt){console.error(" Failed to create sheet object:",vt)}},[]),Ce=(0,Hn.useCallback)(()=>{console.log(" Sheet object modal cancelled")},[]),ut=(0,Hn.useCallback)(()=>{console.log(" Start Menu: Saving project files");try{let Te=(0,Ys.val)(ce().projectsP);Object.values(Te).forEach(vt=>{if(vt){let Mt=vt.address.projectId,En=Mt.replace(/[^\w\d'_\-]+/g," ").trim(),pr="".concat(En,".json"),wr=JSON.stringify(ce().createContentOfSaveFile(Mt),null,2);wLe(wr,pr),console.log(" Saved project: ".concat(pr))}})}catch(Te){console.error(" Failed to save project files:",Te)}},[]),kt=(0,Hn.useCallback)(()=>{try{let Te=lo(ep().filter(vt=>Ne(vt)||Pt(vt)).map(vt=>Pt(vt)?vt.sheet:vt));if(Te.length>0){let vt=Te[0],Mt=vt.getSequence();ce().transaction(({stateEditors:En})=>{En.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.replaceMarkers({sheetAddress:vt.address,markers:[{id:fie(),position:Mt.position,label:"Marker ".concat(Math.floor(Mt.position*100)/100,"s")}],snappingFunction:Mt.closestGridPosition})})}else console.warn(" No sheet selected for adding marker")}catch(Te){console.error(" Failed to add marker:",Te)}},[]),De=(0,Hn.useCallback)(()=>{try{let Te=lo(ep().filter(vt=>Ne(vt)||Pt(vt)).map(vt=>Pt(vt)?vt.sheet:vt));if(Te.length>0){let vt=Te[0],Mt=vt.getSequence();ce().transaction(({stateEditors:En})=>{En.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.replaceEvents({sheetAddress:vt.address,events:[{id:mie(),name:"event",position:Mt.position}]})})}else console.warn(" No sheet selected for adding event")}catch(Te){console.error(" Failed to add event:",Te)}},[]),at=(0,Hn.useCallback)(()=>{try{let Te=lo(ep().filter(vt=>Ne(vt)||Pt(vt)).map(vt=>Pt(vt)?vt.sheet:vt));if(Te.length>0){let vt=Te[0],Mt=ce().atomP.historic.projects.stateByProjectId[vt.address.projectId].stateBySheetId[vt.address.sheetId].sequenceEditor.markerSet,En=(0,Ys.val)(Mt.allIds);En&&Object.keys(En).length>0?Object.keys(En).forEach(pr=>{ce().transaction(({stateEditors:wr})=>{wr.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.removeMarker({sheetAddress:vt.address,markerId:pr})})}):console.log(" No markers to clear")}else console.warn(" No sheet selected for clearing markers")}catch(Te){console.error(" Failed to clear markers:",Te)}},[]),$t=(0,Hn.useCallback)(()=>{try{let Te=lo(ep().filter(vt=>Ne(vt)||Pt(vt)).map(vt=>Pt(vt)?vt.sheet:vt));if(Te.length>0){let vt=Te[0],Mt=(0,Ys.val)(ce().atomP.historic.projects.stateByProjectId[vt.address.projectId].stateBySheetId[vt.address.sheetId]),En=(0,Ys.val)(ce().atomP.historic.coreByProject[vt.address.projectId].sheetsById[vt.address.sheetId].sequence.markers)||[];console.group(" Markers for sheet:",vt.address.sheetId),console.log("Total markers:",En.length),En.forEach((pr,wr)=>{console.log("".concat(wr+1,'. "').concat(pr.label||"Unnamed",'" at ').concat(pr.position,"s (ID: ").concat(pr.id,")"))}),console.groupEnd()}else console.warn(" No sheet selected for logging markers")}catch(Te){console.error(" Failed to log markers:",Te)}},[]),Qt=(0,Hn.useCallback)(()=>{try{let Te=lo(ep().filter(vt=>Ne(vt)||Pt(vt)).map(vt=>Pt(vt)?vt.sheet:vt));if(Te.length>0){let vt=Te[0],Mt=ce().atomP.historic.projects.stateByProjectId[vt.address.projectId].stateBySheetId[vt.address.sheetId].sequenceEditor.eventSet,En=(0,Ys.val)(Mt==null?void 0:Mt.allIds);En&&Object.keys(En).length>0?Object.keys(En).forEach(pr=>{ce().transaction(({stateEditors:wr})=>{wr.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.removeEvent({sheetAddress:vt.address,eventId:pr})})}):console.log(" No events to clear")}else console.warn(" No sheet selected for clearing events")}catch(Te){console.error(" Failed to clear events:",Te)}},[]),Et=(0,Hn.useCallback)(()=>{try{let Te=lo(ep().filter(vt=>Ne(vt)||Pt(vt)).map(vt=>Pt(vt)?vt.sheet:vt));if(Te.length>0){let vt=Te[0],Mt=(0,Ys.val)(ce().atomP.historic.coreByProject[vt.address.projectId].sheetsById[vt.address.sheetId].sequence.events)||[];console.group(" Events for sheet:",vt.address.sheetId),console.log("Total events:",Mt.length),Mt.forEach((En,pr)=>{console.log("".concat(pr+1,'. "').concat(En.name,'" at ').concat(En.position,"s").concat(En.value!==void 0?" (value: ".concat(JSON.stringify(En.value),")"):""," (ID: ").concat(En.id,")"))}),console.groupEnd()}else console.warn(" No sheet selected for logging events")}catch(Te){console.error(" Failed to log events:",Te)}},[]);return wke(u),di(()=>{var Te;let vt=ce(),Mt=(Te=(0,Ys.val)(vt.atomP.historic.panels.sequenceEditor.rightPanelOpen))!=null?Te:!0,En=Ys.prism.memo("panelSize",()=>{let yi=a.width,d3=a.height;return{width:yi,height:d3,widthWithoutBorder:yi-2,heightWithoutBorder:d3-4,screenX:a.left,screenY:a.top}},[a,Mt]),pr=lo(ep().filter(yi=>Ne(yi)||Pt(yi)).map(yi=>Pt(yi)?yi.sheet:yi));if(lo(pr.map(yi=>yi.template)).length!==1)return Hn.default.createElement(Hn.default.Fragment,null);let wr=pr[0];if(!wr)return Hn.default.createElement(Hn.default.Fragment,null);ae.current=wr;let Or=wr.getSequence().length,Ei=(0,Ys.val)(ce().atomP.ahistoric.projects.stateByProjectId[wr.address.projectId].stateBySheetId[wr.address.sheetId].sequence.clippedSpaceRange)||{start:0,end:10},Vs=Ei.start===0&&Ei.end===10,li=Or*1.05;Or>0&&Or!==10&&Ei.end!==li&&Vs&&setTimeout(()=>{ce().transaction(({stateEditors:yi})=>{yi.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.clippedSpaceRange.set(U(P({},wr.address),{range:{start:0,end:li}}))})},0);let Mo=fV("panelSizeP",En).pointer,Si=Ys.prism.memo("key",()=>JSON.stringify(wr.address),[wr]),Ri=kOe(wr,Mo).getValue();(0,Ys.val)(Ri.tree.children).length>0;let Wl=(0,Ys.val)(wr.project.pointers.historic.sheetsById[wr.address.sheetId].sequence);Wl!=null&&Wl.length&&Wl.length>0||Wl!=null&&Wl.markers&&Wl.markers.length>0;let ea=Ys.prism.memo("containerRef",m3e,[]),op=(0,Ys.val)(Ri.graphEditorDims.isAvailable),ed=(0,Ys.val)(Ri.graphEditorDims.isOpen),ql=(0,Ys.val)(Ri.rightPanelOpen),ei=ql?void 0:(0,Ys.val)(Ri.leftDims.width);return Hn.default.createElement(H2e,{collapsedWidth:ei,ref:yi=>{ea(yi),yi!==u&&d(yi)}},Hn.default.createElement(W2e,{style:{width:"".concat((0,Ys.val)(Ri.leftDims.width),"px")}}),Hn.default.createElement(Kge,{layoutP:Ri,onSVGViewerClear:ue,onSVGViewerLoad:xe,onSVGViewerShow:Re,onSVGViewerHide:Ae,onFileSave:ut,onMarkersAdd:kt,onMarkersClear:at,onMarkersLog:$t,onEventsAdd:De,onEventsClear:Qt,onEventsLog:Et,onSheetCreate:Ge,onSheetDuplicate:Je,onSheetObjectCreate:Qe,onSearchChange:Zt,onSearchTrigger:gt}),Hn.default.createElement(Zle,{layoutP:Ri},Hn.default.createElement(Q2e,{layoutP:Ri}),Hn.default.createElement(l1e,{ref:R,key:Si+"-svgViewer",layoutP:Ri,sheetAddress:wr.address,renderMode:"both",color:"#4575e3"}),Hn.default.createElement(ade,{searchTerm:g,searchTrigger:T},Hn.default.createElement(upe,{key:Si+"-dopeSheet-"+g+"-"+T,layoutP:Ri})),ed&&Hn.default.createElement(xhe,{key:Si+"-graphEditor",layoutP:Ri}),op&&Hn.default.createElement(r1e,{layoutP:Ri}),ql&&Hn.default.createElement(Qme,{layoutP:Ri})),Hn.default.createElement(c2e,{ref:K,onConfirm:He,onCancel:Bt}),Hn.default.createElement(G2e,{ref:J,onConfirm:it,onCancel:Ce}),O&&Hn.default.createElement(ege,{onLoad:we,onCancel:ft}),V&&Hn.default.createElement(Pge,{onAttach:Le,onCancel:Se}))},[a,u,g,T,O,V])},Q2e=({layoutP:a})=>di(()=>{let u=(0,Ys.val)(a.sheet);return u.getSequence(),Hn.default.createElement(X2e,{style:{width:(0,Ys.val)(a.leftDims.width)}},Hn.default.createElement(aR,{style:{borderRight:"1px solid #222"}},Hn.default.createElement(n3e,{style:{borderBottom:"1px solid #222"}},Hn.default.createElement(Iz,{style:{color:"white",fontSize:"14px",fontWeight:"bold"}},u.address.sheetId)),Hn.default.createElement(i3e,null,Hn.default.createElement(e3e,null,Hn.default.createElement(u3e,{layoutP:a}),Hn.default.createElement(oR,null,"/"),Hn.default.createElement(d3e,{layoutP:a}),Hn.default.createElement(oR,null,"-"),Hn.default.createElement(p3e,{layoutP:a}),Hn.default.createElement(oR,null,":"),Hn.default.createElement(h3e,{layoutP:a}),Hn.default.createElement(Iz,{style:{fontSize:"9px",opacity:.7}},"fps")))))},[a]),e3e=ge.div(J2e||(J2e=H([`
  display: flex;
  align-items: center;
  gap: 4px;
  height: 30px;
`]))),n3e=ge.div(t3e||(t3e=H([`
  display: flex;
  align-items: center;
  height: 30px;
  padding: 0 8px;
`]))),i3e=ge.div(r3e||(r3e=H([`
  display: flex;
  align-items: center;
  height: 30px;
  padding: 0 8px;
`]))),DE=ge(sb)(s3e||(s3e=H([`
  flex: 1;
  min-width: 0;
  height: 20px;
  font-size: 12px;
  padding: 0;
  background: rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: #adadadb3;
  border-radius: 2px;

  &:hover {
    background: rgba(0, 0, 0, 0.3);
    border-color: rgba(255, 255, 255, 0.15);
  }

  &:focus {
    background: rgba(0, 0, 0, 0.4);
    border-color: rgba(255, 255, 255, 0.2);
    color: white;
  }
`]))),a3e=ge(DE)(o3e||(o3e=H([`
  width: 40px;
`]))),c3e=ge(DE)(l3e||(l3e=H([`
  width: 40px;
`]))),u3e=({layoutP:a})=>di(()=>{let u=(0,Ys.val)(a.sheet).getSequence(),d=Number((0,Ys.val)(u.pointer.position).toFixed(3)),g,_=u.position;return Hn.default.createElement(DE,U(P({value:d},{temporarilySetValue(T){g!==void 0&&(g=void 0),g=os(T,0,u.length),u.position=g},discardTemporaryValue(){g!==void 0&&(g=void 0,u.position=_)},permanentlySetValue(T){g!==void 0&&(g=void 0),u.position=os(T,0,u.length)}}),{isValid:T=>isFinite(T)&&T>=0,nudge:({deltaX:T})=>T*.01}))},[a]),d3e=({layoutP:a})=>di(()=>{let u=(0,Ys.val)(a.sheet),d=u.getSequence().length,g;return Hn.default.createElement(DE,U(P({value:d},{temporarilySetValue(_){g&&(g.discard(),g=void 0),g=ce().tempTransaction(({stateEditors:T})=>{T.coreByProject.historic.sheetsById.sequence.setLength(U(P({},u.address),{length:_}))})},discardTemporaryValue(){g&&(g.discard(),g=void 0)},permanentlySetValue(_){g&&(g.discard(),g=void 0),ce().transaction(({stateEditors:T})=>{T.coreByProject.historic.sheetsById.sequence.setLength(U(P({},u.address),{length:_}))})}}),{isValid:_=>isFinite(_)&&_>0,nudge:({deltaX:_})=>_*.1}))},[a]),h3e=({layoutP:a})=>di(()=>{let u=(0,Ys.val)(a.sheet),d=u.getSequence().subUnitsPerUnit,g;return Hn.default.createElement(c3e,U(P({value:d},{temporarilySetValue(_){g&&(g.discard(),g=void 0),g=ce().tempTransaction(({stateEditors:T})=>{T.coreByProject.historic.sheetsById.sequence.setSubUnitsPerUnit(U(P({},u.address),{subUnitsPerUnit:_}))})},discardTemporaryValue(){g&&(g.discard(),g=void 0)},permanentlySetValue(_){g&&(g.discard(),g=void 0),ce().transaction(({stateEditors:T})=>{T.coreByProject.historic.sheetsById.sequence.setSubUnitsPerUnit(U(P({},u.address),{subUnitsPerUnit:_}))})}}),{isValid:_=>isFinite(_)&&_>=1&&_<=I(2,12),nudge:({deltaX:_})=>_*1}))},[a]),p3e=({layoutP:a})=>di(()=>{let u=(0,Ys.val)(a.sheet).getSequence(),d=u.subUnitsPerUnit,g=(0,Ys.val)(u.pointer.position),_=Math.round(g*d),T,N=u.position;return Hn.default.createElement(a3e,U(P({value:_},{temporarilySetValue(R){T!==void 0&&(T=void 0),T=R;let O=os(R/d,0,u.length);u.position=O},discardTemporaryValue(){T!==void 0&&(T=void 0,u.position=N)},permanentlySetValue(R){T!==void 0&&(T=void 0);let O=os(R/d,0,u.length);u.position=O}}),{isValid:R=>isFinite(R)&&R>=0,nudge:({deltaX:R})=>R*1}))},[a]),f3e=K2e,m3e=()=>{let a=null,u={passive:!1,capture:!1},d=g=>{Math.abs(g.deltaY)<Math.abs(g.deltaX)&&(g.preventDefault(),g.stopPropagation())};return g=>{a!==g&&a&&a.removeEventListener("wheel",d,u),a=g,g&&g.addEventListener("wheel",d,u)}}}),Pb,g3e,y3e,TLe=C(()=>{BRe(),Pb=z(nt()),Pe(),Ar(),PIe(),F1(),g3e=()=>{let a=ti(ce().paneManager.allPanesD),u=Object.entries(a).map(([d,g])=>Pb.default.createElement(uie,{key:"pane-".concat(d),paneInstance:g}));return Pb.default.createElement(Pb.default.Fragment,null,u,Pb.default.createElement(zne,null),Pb.default.createElement(f3e,null))},y3e=g3e}),v3e,x3e,ok,Qj=C(()=>{tn(),Mf(),x3e=ge(Xu)(v3e||(v3e=H([`
  padding: 1em;
  max-width: 240px;
  pointer-events: none !important;
  --popover-outer-stroke: transparent;
  --popover-inner-stroke: #45464d;
`]))),ok=x3e}),b3e,_3e,S3e,ELe=C(()=>{tn(),Qj(),_3e=ge(ok)(b3e||(b3e=H([`
  --popover-outer-stroke: #e11c1c;
  --popover-inner-stroke: #2c1c1c;
  --popover-bg: #2c1c1c;
  pointer-events: none !important;
`]))),S3e=_3e}),MLe=Z((a,u)=>{var d,g;d=[],g=[];function _(T,N,R){var O,B,V,Y,W,$,K,J;if(T===N)return 0;if(O=T.length,B=N.length,O===0)return B;if(B===0)return O;for(R&&(T=T.toLowerCase(),N=N.toLowerCase()),K=0;K<O;)g[K]=T.charCodeAt(K),d[K]=++K;for(J=0;J<B;)for(V=N.charCodeAt(J),Y=W=J++,K=-1;++K<O;)$=V===g[K]?W:W+1,W=d[K],d[K]=Y=W>Y?$>Y?Y+1:$:$>W?W+1:$;return Y}u.exports=_}),CLe=Z((a,u)=>{var d=MLe();function g(){var _,T,N,R,O,B=0,V=arguments[0],Y=arguments[1],W=Y.length,$=arguments[2];$&&(R=$.threshold,O=$.ignoreCase),R===void 0&&(R=0);for(var K=0;K<W;++K)O?T=d(V,Y[K],!0):T=d(V,Y[K]),T>V.length?_=1-T/Y[K].length:_=1-T/V.length,_>B&&(B=_,N=Y[K]);return B>=R?N:null}u.exports=g});function ALe(a,u,d="Did you mean ",g="?"){let _=(0,w3e.default)(a,u,{threshold:.7});return _?d+JSON.stringify(_)+g:""}var w3e,NLe=C(()=>{w3e=z(CLe())});function T3e(a,u){return a.length<=u?a:a.substr(0,u-3)+"..."}var PLe=C(()=>{}),E3e,Jj,M3e=C(()=>{PLe(),E3e=a=>typeof a=="string"?'string("'.concat(T3e(a,10),'")'):typeof a=="number"?"number(".concat(T3e(String(a),10),")"):a===null?"null":a===void 0?"undefined":typeof a=="boolean"?String(a):Array.isArray(a)?"array":typeof a=="object"?"object":"unknown",Jj=E3e}),C3e,A3e,eH,N3e=C(()=>{tn(),Qj(),A3e=ge(ok)(C3e||(C3e=H([`
  padding: 6px;
`]))),eH=A3e}),P3e,R3e,tH,I3e=C(()=>{tn(),y8(),R3e=ge(Fte)(P3e||(P3e=H([`
  display: flex;
  height: fit-content;
  backdrop-filter: blur(14px);
  border-radius: 2px;
`]))),tH=R3e}),Rb,k3e,D3e,O3e,OE,ak=C(()=>{tn(),ms(),Rb=z(nt()),fI(),SR(),N3e(),I3e(),D3e=ge.button(k3e||(k3e=H([`
  `,`;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 600;
  width: 32px;
  height: 32px;
  outline: none;

  color: #a8a8a9;

  background: rgba(40, 43, 47, 0.8);
  backdrop-filter: blur(14px);
  border: none;
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 2px;

  svg {
    display: block;
  }

  &:hover {
    background: rgba(59, 63, 69, 0.8);
  }

  &:active {
    background: rgba(82, 88, 96, 0.8);
  }

  &.selected {
    color: rgba(255, 255, 255, 0.8);
    border-bottom: 1px solid rgba(255, 255, 255, 0.7);
  }

  // Don't blur if in a button group, because it already blurs. We need to blur
  // on the group-level, otherwise we get seams.
  `,` > & {
    backdrop-filter: none;
    filter: none;
    border-radius: 0;

    &:first-child {
      border-top-left-radius: 2px;
      border-bottom-left-radius: 2px;
    }

    &:last-child {
      border-bottom-right-radius: 2px;
      border-top-right-radius: 2px;
    }
  }

  @supports not (backdrop-filter: blur()) {
    background: rgba(40, 43, 47, 0.95);
  }
`])),Zi,tH),O3e=Rb.default.forwardRef((a,u)=>{var d=a,{title:g}=d,_=j(d,["title"]);let[T,N]=hI({enabled:typeof g=="string"},()=>Rb.default.createElement(eH,null,g));return Rb.default.createElement(Rb.default.Fragment,null,T,Rb.default.createElement(D3e,P({ref:_R([N,u])},_))," ")}),OE=O3e}),L3e,F3e,B3e,U3e,z3e,RLe=C(()=>{L3e=z(nt()),ak(),tn(),ms(),B3e=ge(OE)(F3e||(F3e=H([`
  `,`;
  & > svg {
    width: 1em;
    height: 1em;
    pointer-events: none;
  }
`])),Zi),U3e=({config:a,testId:u})=>{var d;return L3e.default.createElement(B3e,{onClick:a.onClick,"data-testid":u,title:a.title,dangerouslySetInnerHTML:{__html:(d=a.svgSource)!=null?d:""}})},z3e=U3e});function ILe({value:a,label:u,icon:d,onClick:g,isSelected:_}){return Ib.default.createElement(Ib.default.Fragment,null,Ib.default.createElement(OE,{forwardedAs:Dte,className:_?"selected":void 0,"aria-label":u,onClick:g,title:u},d))}var Ib,V3e,G3e,kLe=C(()=>{Ib=z(nt()),y8(),ak(),I3e(),V3e=({value:a,onChange:u,options:d})=>Ib.default.createElement(tH,null,d.map(({label:g,icon:_,value:T})=>Ib.default.createElement(ILe,{key:T,value:T,isSelected:a===T,label:g,icon:_,onClick:()=>u(T)}))),G3e=V3e}),nH,j3e,H3e,$3e,W3e,DLe=C(()=>{nH=z(nt()),tn(),ms(),kLe(),H3e=ge.div(j3e||(j3e=H([`
  `,`;
  & > svg {
    width: 1em;
    height: 1em;
    pointer-events: none;
  }
`])),Zi),$3e=({config:a})=>nH.default.createElement(G3e,{onChange:a.onChange,options:a.options.map(({label:u,value:d,svgSource:g})=>({label:u,value:d,icon:nH.default.createElement(H3e,{dangerouslySetInnerHTML:{__html:g}})})),value:a.value}),W3e=$3e}),LE,q3e,X3e,Y3e,K3e,OLe=C(()=>{LE=z(nt()),tn(),ms(),ak(),Uie(),Ef(),X3e=ge.div(q3e||(q3e=H([`
  `,`;
  & > svg {
    width: 1em;
    height: 1em;
    pointer-events: none;
  }
`])),Zi),Y3e=({config:a})=>{let u=(0,LE.useRef)(null),d=qu(()=>{let g=u.current.getBoundingClientRect();return{debugName:"ExtensionFlyoutMenu:"+a.label,constraints:{maxX:g.right,maxY:8,minX:g.left,minY:8},verticalGap:2}},()=>LE.default.createElement(bV,{items:a.items.map((g,_)=>({label:g.label,callback:()=>{var T;try{(T=g.onClick)==null||T.call(g)}catch(N){console.error(N)}}})),onRequestClose:()=>{d.close("clicked")}}));return LE.default.createElement(X3e,null,d.node,LE.default.createElement(OE,{ref:u,onClick:g=>{d.open(g,u.current)}},a.label))},K3e=Y3e});function LLe(a){return rH[a]}var FE,Z3e,rH,Q3e,J3e,FLe=C(()=>{NLe(),M3e(),FE=z(nt()),RLe(),DLe(),OLe(),Z3e=a=>FE.default.createElement(FE.default.Fragment,null,a.config.map((u,d)=>FE.default.createElement(Q3e,{config:u,key:d}))),rH={Icon:z3e,Switch:W3e,Flyout:K3e},Q3e=({config:a})=>{let u=LLe(a.type);if(!u)throw new Error("No tool with tool.type ".concat(Jj(a.type)," exists. Did you mean ").concat(ALe(a.type,Object.keys(rH))));return FE.default.createElement(u,{config:a})},J3e=Z3e}),e9e,B1,t9e,n9e,r9e,iH,i9e,s9e,sH,o9e=C(()=>{e9e=un(),Ar(),Pe(),B1=z(nt()),tn(),FLe(),n9e=ge.div(t9e||(t9e=H([`
  height: 36px;
  /* pointer-events: none; */

  display: flex;
  gap: 0.5rem;
  justify-content: center;
`]))),iH=ge.div(r9e||(r9e=H([`
  position: abolute;
  height: 32px;
  width: 1px;
  background: #373b40;
  opacity: 0.4;
`]))),i9e=({extension:a,toolbarId:u})=>{var d;let g=(0,B1.useMemo)(()=>new e9e.Atom([]),[]),_=(d=a.toolbars)==null?void 0:d[u];(0,B1.useLayoutEffect)(()=>{let N=_==null?void 0:_(g.set.bind(g),ce().publicApi);if(typeof N=="function")return N},[a,u,_]);let T=ti(g.prism);return B1.default.createElement(J3e,{config:T})},s9e=({toolbarId:a,showLeftDivider:u})=>{var d;let g=[],_=ti(ce().atomP.ephemeral.extensions.byId),T=!1;for(let[,N]of Object.entries(_))!N||!((d=N.toolbars)!=null&&d[a])||(g.push(B1.default.createElement(B1.default.Fragment,{key:"extensionToolbar-"+N.id},T?B1.default.createElement(iH,null):void 0,B1.default.createElement(i9e,{extension:N,toolbarId:a}))),T=!0);return g.length===0?null:B1.default.createElement(n9e,{"data-testid":"theatre-extensionToolbar-".concat(a)},u?B1.default.createElement(iH,null):void 0,g)},sH=s9e}),BE,a9e,l9e,c9e,u9e,BLe=C(()=>{tn(),BE=z(nt()),ak(),l9e=ge(OE)(a9e||(a9e=H([`
  color: `,`;

  border-bottom: 1px solid
    `,`;
`])),({pinned:a})=>a?"rgba(255, 255, 255, 0.8)":"#A8A8A9",({pinned:a})=>a?"rgba(255, 255, 255, 0.7)":"rgba(255, 255, 255, 0.08)"),c9e=(0,BE.forwardRef)((a,u)=>{var d=a,{children:g,hint:_,pinned:T,icon:N,pinHintIcon:R,unpinHintIcon:O}=d,B=j(d,["children","hint","pinned","icon","pinHintIcon","unpinHintIcon"]);let[V,Y]=(0,BE.useState)(!1),W=V||_;return BE.default.createElement(l9e,U(P({},B),{pinned:T,ref:u,onMouseOver:()=>Y(!0),onMouseOut:()=>Y(!1)}),BE.default.createElement("div",{style:{pointerEvents:"none",width:"fit-content",height:"fit-content",inset:0}},W&&!T?R:W&&T?O:N),g)}),u9e=c9e});function ULe(a){return oH.createElement("svg",P({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a),oH.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.732 4.048l-.792-.792L7.2 8l4.74 4.744.792-.792L8.781 8l3.951-3.952zm-3.932 0l-.792-.792L3.268 8l4.74 4.744.792-.792L4.848 8 8.8 4.048z",fill:"currentColor"}))}var oH,d9e,zLe=C(()=>{oH=z(nt()),d9e=ULe});function VLe(a){return aH.createElement("svg",P({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a),aH.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.694 3.765l.792-.792 4.74 4.744-4.74 4.744-.792-.793 3.951-3.951-3.951-3.952zm3.932 0l.792-.792 4.74 4.744-4.74 4.744-.792-.793 3.952-3.951-3.952-3.952z",fill:"currentColor"}))}var aH,h9e,GLe=C(()=>{aH=z(nt()),h9e=VLe}),Za,p9e,f9e,m9e,lH,g9e,J4,y9e,v9e,x9e,b9e,_9e,S9e,w9e,T9e,E9e,lk,M9e,C9e,cH,uH,A9e,N9e,jLe=C(()=>{Ar(),Pe(),Za=z(nt()),tn(),f9e=ge.div(p9e||(p9e=H([`
  width: 138px;
  border-radius: 2px;
  background-color: rgba(42, 45, 50, 0.9);
  position: absolute;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  box-shadow: 0px 1px 1px rgba(0, 0, 0, 0.25), 0px 2px 6px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(14px);
  pointer-events: auto;
  // makes the edges of the item highlights match the rounded corners
  overflow: hidden;

  @supports not (backdrop-filter: blur()) {
    background-color: rgba(42, 45, 50, 0.98);
  }

  color: rgba(255, 255, 255, 0.9);

  & a {
    // Fix colors of links to not be default
    color: inherit;
  }
`]))),lH=ge.div(m9e||(m9e=H([`
  position: relative;
  padding: 0px 12px;
  font-weight: 400;
  font-size: 11px;
  height: 32px;
  text-decoration: none;
  user-select: none;
  display: flex;
  flex-direction: row;
  align-items: center;
  cursor: default;
`]))),J4=ge(lH)(g9e||(g9e=H([`
  &:before {
    position: absolute;
    display: block;
    content: ' ';
    inset: 3px;
    border-radius: 3px;
    background: rgba(255, 255, 255, 0.1);
    opacity: 0;
  }

  &.secondary {
    color: rgba(255, 255, 255, 0.5);
  }

  &:hover {
    /* background-color: #398995; */
    color: white !important;
    &:before {
      opacity: 1;
    }
  }
`]))),v9e=ge(lH)(y9e||(y9e=H([`
  height: auto;
  min-height: 32px;
  padding-top: 12px;
  padding-bottom: 10px;
  flex-direction: column;
  justify-content: flex-start;
  align-items: stretch;
  gap: 8px;
  color: rgba(255, 255, 255, 0.5);
`]))),b9e=ge.div(x9e||(x9e=H([`
  font-weight: 600;
`]))),S9e=ge.div(_9e||(_9e=H([`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
`]))),T9e=ge.div(w9e||(w9e=H([`
  margin-left: 2px;
`]))),lk=ge.div(E9e||(E9e=H([`
  height: 1px;
  margin: 0 2px;
  background: rgba(255, 255, 255, 0.02);
`]))),C9e=ge.div(M9e||(M9e=H([`
  position: absolute;
  width: 8px;
  height: 8px;
  background: #40aaa4;
  right: 14px;
  top: 12px;
  border-radius: 50%;
`]))),cH="1.0.19",uH=cH.match(/^[^\-]+/)[0],A9e=Za.default.forwardRef((a,u)=>{let d=ti(ce().atomP.ahistoric.updateChecker.result.hasUpdates);return Za.default.createElement(f9e,{ref:u},Za.default.createElement(J4,{as:"a",href:"https://www.theatrejs.com/docs/latest",className:"",target:"_blank"},"Docs"),Za.default.createElement(J4,{as:"a",href:"https://www.theatrejs.com/docs/latest/releases",className:"",target:"_blank"},"Changelog"),Za.default.createElement(lk,null),Za.default.createElement(J4,{as:"a",href:"https://github.com/theatre-js/theatre",className:"",target:"_blank"},"Github"),Za.default.createElement(J4,{as:"a",href:"https://twitter.com/theatre_js",className:"",target:"_blank"},"Twitter"),Za.default.createElement(J4,{className:"",as:"a",href:"https://discord.gg/bm9f8F9Y9N",target:"_blank"},"Discord"),Za.default.createElement(lk,null),Za.default.createElement(v9e,null,Za.default.createElement(b9e,null,"Version"),Za.default.createElement(S9e,null,Za.default.createElement(T9e,null,cH," ",d===!0?"(outdated)":d===!1?"(latest)":""))),d===!0&&Za.default.createElement(Za.default.Fragment,null,Za.default.createElement(lk,null),Za.default.createElement(J4,{as:"a",href:"https://www.theatrejs.com/docs/latest/releases".concat(encodeURIComponent(uH)),className:"",target:"_blank"},"Update",Za.default.createElement(C9e,null)),Za.default.createElement(J4,{as:"a",href:"https://www.theatrejs.com/docs/latest/releases#".concat(encodeURIComponent(uH)),className:"",target:"_blank"},"What's new?")))}),N9e=A9e}),dH,ck,P9e,hH,R9e,I9e,UE,k9e,pH,D9e,uk,zE,VE,ey,O9e,L9e,F9e,kb,Ju,B9e,U9e,z9e,fH,HLe=C(()=>{dH=z(nt(),1),ck=z(nt(),1),P9e=a=>typeof a=="function",hH=(a,u)=>P9e(a)?a(u):a,R9e=(()=>{let a=0;return()=>(++a).toString()})(),I9e=20,UE=new Map,k9e=1e3,pH=a=>{if(UE.has(a))return;let u=setTimeout(()=>{UE.delete(a),ey({type:4,toastId:a})},k9e);UE.set(a,u)},D9e=a=>{let u=UE.get(a);u&&clearTimeout(u)},uk=(a,u)=>{switch(u.type){case 0:return U(P({},a),{toasts:[u.toast,...a.toasts].slice(0,I9e)});case 1:return u.toast.id&&D9e(u.toast.id),U(P({},a),{toasts:a.toasts.map(T=>T.id===u.toast.id?P(P({},T),u.toast):T)});case 2:let{toast:d}=u;return a.toasts.find(T=>T.id===d.id)?uk(a,{type:1,toast:d}):uk(a,{type:0,toast:d});case 3:let{toastId:g}=u;return g?pH(g):a.toasts.forEach(T=>{pH(T.id)}),U(P({},a),{toasts:a.toasts.map(T=>T.id===g||g===void 0?U(P({},T),{visible:!1}):T)});case 4:return u.toastId===void 0?U(P({},a),{toasts:[]}):U(P({},a),{toasts:a.toasts.filter(T=>T.id!==u.toastId)});case 5:return U(P({},a),{pausedAt:u.time});case 6:let _=u.time-(a.pausedAt||0);return U(P({},a),{pausedAt:void 0,toasts:a.toasts.map(T=>U(P({},T),{pauseDuration:T.pauseDuration+_}))})}},zE=[],VE={toasts:[],pausedAt:void 0},ey=a=>{VE=uk(VE,a),zE.forEach(u=>{u(VE)})},O9e={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},L9e=(a={})=>{let[u,d]=(0,dH.useState)(VE);(0,dH.useEffect)(()=>(zE.push(d),()=>{let _=zE.indexOf(d);_>-1&&zE.splice(_,1)}),[u]);let g=u.toasts.map(_=>{var T,N;return U(P(P(P({},a),a[_.type]),_),{duration:_.duration||((T=a[_.type])==null?void 0:T.duration)||(a==null?void 0:a.duration)||O9e[_.type],style:P(P(P({},a.style),(N=a[_.type])==null?void 0:N.style),_.style)})});return U(P({},u),{toasts:g})},F9e=(a,u="blank",d)=>U(P({createdAt:Date.now(),visible:!0,type:u,ariaProps:{role:"status","aria-live":"polite"},message:a,pauseDuration:0},d),{id:(d==null?void 0:d.id)||R9e()}),kb=a=>(u,d)=>{let g=F9e(u,a,d);return ey({type:2,toast:g}),g.id},Ju=(a,u)=>kb("blank")(a,u),Ju.error=kb("error"),Ju.success=kb("success"),Ju.loading=kb("loading"),Ju.custom=kb("custom"),Ju.dismiss=a=>{ey({type:3,toastId:a})},Ju.remove=a=>ey({type:4,toastId:a}),Ju.promise=(a,u,d)=>{let g=Ju.loading(u.loading,P(P({},d),d==null?void 0:d.loading));return a.then(_=>(Ju.success(hH(u.success,_),P(P({id:g},d),d==null?void 0:d.success)),_)).catch(_=>{Ju.error(hH(u.error,_),P(P({id:g},d),d==null?void 0:d.error))}),a},B9e=(a,u)=>{ey({type:1,toast:{id:a,height:u}})},U9e=()=>{ey({type:5,time:Date.now()})},z9e=a=>{let{toasts:u,pausedAt:d}=L9e(a);(0,ck.useEffect)(()=>{if(d)return;let T=Date.now(),N=u.map(R=>{if(R.duration===1/0)return;let O=(R.duration||0)+R.pauseDuration-(T-R.createdAt);if(O<0){R.visible&&Ju.dismiss(R.id);return}return setTimeout(()=>Ju.dismiss(R.id),O)});return()=>{N.forEach(R=>R&&clearTimeout(R))}},[u,d]);let g=(0,ck.useCallback)(()=>{d&&ey({type:6,time:Date.now()})},[d]),_=(0,ck.useCallback)((T,N)=>{let{reverseOrder:R=!1,gutter:O=8,defaultPosition:B}=N||{},V=u.filter($=>($.position||B)===(T.position||B)&&$.height),Y=V.findIndex($=>$.id===T.id),W=V.filter(($,K)=>K<Y&&$.visible).length;return V.filter($=>$.visible).slice(...R?[W+1]:[0,W]).reduce(($,K)=>$+(K.height||0)+O,0)},[u]);return{toasts:u,handlers:{updateHeight:B9e,startPause:U9e,endPause:g,calculateOffset:_}}},fH=Ju});function V9e(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}function $Le(a){q8=a}function $l(a,u){if(u){if(Y9e.test(a))return a.replace(K9e,mH)}else if(Z9e.test(a))return a.replace(Q9e,mH);return a}function G9e(a){return a.replace(e4e,(u,d)=>(d=d.toLowerCase(),d==="colon"?":":d.charAt(0)==="#"?d.charAt(1)==="x"?String.fromCharCode(parseInt(d.substring(2),16)):String.fromCharCode(+d.substring(1)):""))}function to(a,u){a=typeof a=="string"?a:a.source,u=u||"";let d={replace:(g,_)=>(_=_.source||_,_=_.replace(t4e,"$1"),a=a.replace(g,_),d),getRegex:()=>new RegExp(a,u)};return d}function j9e(a,u,d){if(a){let g;try{g=decodeURIComponent(G9e(d)).replace(n4e,"").toLowerCase()}catch{return null}if(g.indexOf("javascript:")===0||g.indexOf("vbscript:")===0||g.indexOf("data:")===0)return null}u&&!r4e.test(d)&&(d=WLe(u,d));try{d=encodeURI(d).replace(/%25/g,"%")}catch{return null}return d}function WLe(a,u){GE[" "+a]||(i4e.test(a)?GE[" "+a]=a+"/":GE[" "+a]=dk(a,"/",!0)),a=GE[" "+a];let d=a.indexOf(":")===-1;return u.substring(0,2)==="//"?d?u:a.replace(s4e,"$1")+u:u.charAt(0)==="/"?d?u:a.replace(o4e,"$1")+u:a+u}function Lf(a){let u=1,d,g;for(;u<arguments.length;u++){d=arguments[u];for(g in d)Object.prototype.hasOwnProperty.call(d,g)&&(a[g]=d[g])}return a}function H9e(a,u){let d=a.replace(/\|/g,(T,N,R)=>{let O=!1,B=N;for(;--B>=0&&R[B]==="\\";)O=!O;return O?"|":" |"}),g=d.split(/ \|/),_=0;if(g[0].trim()||g.shift(),g.length>0&&!g[g.length-1].trim()&&g.pop(),g.length>u)g.splice(u);else for(;g.length<u;)g.push("");for(;_<g.length;_++)g[_]=g[_].trim().replace(/\\\|/g,"|");return g}function dk(a,u,d){let g=a.length;if(g===0)return"";let _=0;for(;_<g;){let T=a.charAt(g-_-1);if(T===u&&!d)_++;else if(T!==u&&d)_++;else break}return a.slice(0,g-_)}function qLe(a,u){if(a.indexOf(u[1])===-1)return-1;let d=a.length,g=0,_=0;for(;_<d;_++)if(a[_]==="\\")_++;else if(a[_]===u[0])g++;else if(a[_]===u[1]&&(g--,g<0))return _;return-1}function $9e(a){a&&a.sanitize&&!a.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function W9e(a,u){if(u<1)return"";let d="";for(;u>1;)u&1&&(d+=a),u>>=1,a+=a;return d+a}function q9e(a,u,d,g){let _=u.href,T=u.title?$l(u.title):null,N=a[1].replace(/\\([\[\]])/g,"$1");if(a[0].charAt(0)!=="!"){g.state.inLink=!0;let R={type:"link",raw:d,href:_,title:T,text:N,tokens:g.inlineTokens(N)};return g.state.inLink=!1,R}return{type:"image",raw:d,href:_,title:T,text:$l(N)}}function XLe(a,u){let d=a.match(/^(\s+)(?:```)/);if(d===null)return u;let g=d[1];return u.split(`
`).map(_=>{let T=_.match(/^\s+/);if(T===null)return _;let[N]=T;return N.length>=g.length?_.slice(g.length):_}).join(`
`)}function YLe(a){return a.replace(/---/g,"").replace(/--/g,"").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1").replace(/'/g,"").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1").replace(/"/g,"").replace(/\.{3}/g,"")}function X9e(a){let u="",d,g,_=a.length;for(d=0;d<_;d++)g=a.charCodeAt(d),Math.random()>.5&&(g="x"+g.toString(16)),u+="&#"+g+";";return u}function ni(a,u,d){if(typeof a>"u"||a===null)throw new Error("marked(): input parameter is undefined or null");if(typeof a!="string")throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(a)+", string expected");if(typeof u=="function"&&(d=u,u=null),u=Lf({},ni.defaults,u||{}),$9e(u),d){let _=u.highlight,T;try{T=X8.lex(a,u)}catch(O){return d(O)}let N=function(O){let B;if(!O)try{u.walkTokens&&ni.walkTokens(T,u.walkTokens),B=ty.parse(T,u)}catch(V){O=V}return u.highlight=_,O?d(O):d(null,B)};if(!_||_.length<3||(delete u.highlight,!T.length))return N();let R=0;ni.walkTokens(T,function(O){O.type==="code"&&(R++,setTimeout(()=>{_(O.text,O.lang,function(B,V){if(B)return N(B);V!=null&&V!==O.text&&(O.text=V,O.escaped=!0),R--,R===0&&N()})},0))}),R===0&&N();return}function g(_){if(_.message+=`
Please report this to https://github.com/markedjs/marked.`,u.silent)return"<p>An error occurred:</p><pre>"+$l(_.message+"",!0)+"</pre>";throw _}try{let _=X8.lex(a,u);if(u.walkTokens){if(u.async)return Promise.all(ni.walkTokens(_,u.walkTokens)).then(()=>ty.parse(_,u)).catch(g);ni.walkTokens(_,u.walkTokens)}return ty.parse(_,u)}catch(_){g(_)}}var q8,Y9e,K9e,Z9e,Q9e,J9e,mH,e4e,t4e,n4e,r4e,GE,i4e,s4e,o4e,jE,hk,Gr,hr,X8,pk,gH,yH,ty,KLe=C(()=>{q8=V9e(),Y9e=/[&<>"']/,K9e=/[&<>"']/g,Z9e=/[<>"']|&(?!#?\w+;)/,Q9e=/[<>"']|&(?!#?\w+;)/g,J9e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},mH=a=>J9e[a],e4e=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,t4e=/(^|[^\[])\^/g,n4e=/[^\w:]/g,r4e=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i,GE={},i4e=/^[^:]+:\/*[^/]*$/,s4e=/^([^:]+:)[\s\S]*$/,o4e=/^([^:]+:\/*[^/]*)[\s\S]*$/,jE={exec:function(){}},hk=class{constructor(a){this.options=a||q8}space(a){let u=this.rules.block.newline.exec(a);if(u&&u[0].length>0)return{type:"space",raw:u[0]}}code(a){let u=this.rules.block.code.exec(a);if(u){let d=u[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:u[0],codeBlockStyle:"indented",text:this.options.pedantic?d:dk(d,`
`)}}}fences(a){let u=this.rules.block.fences.exec(a);if(u){let d=u[0],g=XLe(d,u[3]||"");return{type:"code",raw:d,lang:u[2]?u[2].trim():u[2],text:g}}}heading(a){let u=this.rules.block.heading.exec(a);if(u){let d=u[2].trim();if(/#$/.test(d)){let g=dk(d,"#");(this.options.pedantic||!g||/ $/.test(g))&&(d=g.trim())}return{type:"heading",raw:u[0],depth:u[1].length,text:d,tokens:this.lexer.inline(d)}}}hr(a){let u=this.rules.block.hr.exec(a);if(u)return{type:"hr",raw:u[0]}}blockquote(a){let u=this.rules.block.blockquote.exec(a);if(u){let d=u[0].replace(/^ *>[ \t]?/gm,"");return{type:"blockquote",raw:u[0],tokens:this.lexer.blockTokens(d,[]),text:d}}}list(a){let u=this.rules.block.list.exec(a);if(u){let d,g,_,T,N,R,O,B,V,Y,W,$,K=u[1].trim(),J=K.length>1,oe={type:"list",raw:"",ordered:J,start:J?+K.slice(0,-1):"",loose:!1,items:[]};K=J?"\\d{1,9}\\".concat(K.slice(-1)):"\\".concat(K),this.options.pedantic&&(K=J?K:"[*+-]");let ae=new RegExp("^( {0,3}".concat(K,")((?:[	 ][^\\n]*)?(?:\\n|$))"));for(;a&&($=!1,!(!(u=ae.exec(a))||this.rules.block.hr.test(a)));){if(d=u[0],a=a.substring(d.length),B=u[2].split(`
`,1)[0],V=a.split(`
`,1)[0],this.options.pedantic?(T=2,W=B.trimLeft()):(T=u[2].search(/[^ ]/),T=T>4?1:T,W=B.slice(T),T+=u[1].length),R=!1,!B&&/^ *$/.test(V)&&(d+=V+`
`,a=a.substring(V.length+1),$=!0),!$){let xe=new RegExp("^ {0,".concat(Math.min(3,T-1),"}(?:[*+-]|\\d{1,9}[.)])((?: [^\\n]*)?(?:\\n|$))")),Re=new RegExp("^ {0,".concat(Math.min(3,T-1),"}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)")),Ae=new RegExp("^ {0,".concat(Math.min(3,T-1),"}(?:```|~~~)")),we=new RegExp("^ {0,".concat(Math.min(3,T-1),"}#"));for(;a&&(Y=a.split(`
`,1)[0],B=Y,this.options.pedantic&&(B=B.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(Ae.test(B)||we.test(B)||xe.test(B)||Re.test(a)));){if(B.search(/[^ ]/)>=T||!B.trim())W+=`
`+B.slice(T);else if(!R)W+=`
`+B;else break;!R&&!B.trim()&&(R=!0),d+=Y+`
`,a=a.substring(Y.length+1)}}oe.loose||(O?oe.loose=!0:/\n *\n *$/.test(d)&&(O=!0)),this.options.gfm&&(g=/^\[[ xX]\] /.exec(W),g&&(_=g[0]!=="[ ] ",W=W.replace(/^\[[ xX]\] +/,""))),oe.items.push({type:"list_item",raw:d,task:!!g,checked:_,loose:!1,text:W}),oe.raw+=d}oe.items[oe.items.length-1].raw=d.trimRight(),oe.items[oe.items.length-1].text=W.trimRight(),oe.raw=oe.raw.trimRight();let ue=oe.items.length;for(N=0;N<ue;N++){this.lexer.state.top=!1,oe.items[N].tokens=this.lexer.blockTokens(oe.items[N].text,[]);let xe=oe.items[N].tokens.filter(Ae=>Ae.type==="space"),Re=xe.every(Ae=>{let we=Ae.raw.split(""),ft=0;for(let Le of we)if(Le===`
`&&(ft+=1),ft>1)return!0;return!1});!oe.loose&&xe.length&&Re&&(oe.loose=!0,oe.items[N].loose=!0)}return oe}}html(a){let u=this.rules.block.html.exec(a);if(u){let d={type:"html",raw:u[0],pre:!this.options.sanitizer&&(u[1]==="pre"||u[1]==="script"||u[1]==="style"),text:u[0]};if(this.options.sanitize){let g=this.options.sanitizer?this.options.sanitizer(u[0]):$l(u[0]);d.type="paragraph",d.text=g,d.tokens=this.lexer.inline(g)}return d}}def(a){let u=this.rules.block.def.exec(a);if(u)return u[3]&&(u[3]=u[3].substring(1,u[3].length-1)),{type:"def",tag:u[1].toLowerCase().replace(/\s+/g," "),raw:u[0],href:u[2],title:u[3]}}table(a){let u=this.rules.block.table.exec(a);if(u){let d={type:"table",header:H9e(u[1]).map(g=>({text:g})),align:u[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:u[3]&&u[3].trim()?u[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(d.header.length===d.align.length){d.raw=u[0];let g=d.align.length,_,T,N,R;for(_=0;_<g;_++)/^ *-+: *$/.test(d.align[_])?d.align[_]="right":/^ *:-+: *$/.test(d.align[_])?d.align[_]="center":/^ *:-+ *$/.test(d.align[_])?d.align[_]="left":d.align[_]=null;for(g=d.rows.length,_=0;_<g;_++)d.rows[_]=H9e(d.rows[_],d.header.length).map(O=>({text:O}));for(g=d.header.length,T=0;T<g;T++)d.header[T].tokens=this.lexer.inline(d.header[T].text);for(g=d.rows.length,T=0;T<g;T++)for(R=d.rows[T],N=0;N<R.length;N++)R[N].tokens=this.lexer.inline(R[N].text);return d}}}lheading(a){let u=this.rules.block.lheading.exec(a);if(u)return{type:"heading",raw:u[0],depth:u[2].charAt(0)==="="?1:2,text:u[1],tokens:this.lexer.inline(u[1])}}paragraph(a){let u=this.rules.block.paragraph.exec(a);if(u){let d=u[1].charAt(u[1].length-1)===`
`?u[1].slice(0,-1):u[1];return{type:"paragraph",raw:u[0],text:d,tokens:this.lexer.inline(d)}}}text(a){let u=this.rules.block.text.exec(a);if(u)return{type:"text",raw:u[0],text:u[0],tokens:this.lexer.inline(u[0])}}escape(a){let u=this.rules.inline.escape.exec(a);if(u)return{type:"escape",raw:u[0],text:$l(u[1])}}tag(a){let u=this.rules.inline.tag.exec(a);if(u)return!this.lexer.state.inLink&&/^<a /i.test(u[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(u[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(u[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(u[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:u[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(u[0]):$l(u[0]):u[0]}}link(a){let u=this.rules.inline.link.exec(a);if(u){let d=u[2].trim();if(!this.options.pedantic&&/^</.test(d)){if(!/>$/.test(d))return;let T=dk(d.slice(0,-1),"\\");if((d.length-T.length)%2===0)return}else{let T=qLe(u[2],"()");if(T>-1){let N=(u[0].indexOf("!")===0?5:4)+u[1].length+T;u[2]=u[2].substring(0,T),u[0]=u[0].substring(0,N).trim(),u[3]=""}}let g=u[2],_="";if(this.options.pedantic){let T=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(g);T&&(g=T[1],_=T[3])}else _=u[3]?u[3].slice(1,-1):"";return g=g.trim(),/^</.test(g)&&(this.options.pedantic&&!/>$/.test(d)?g=g.slice(1):g=g.slice(1,-1)),q9e(u,{href:g&&g.replace(this.rules.inline._escapes,"$1"),title:_&&_.replace(this.rules.inline._escapes,"$1")},u[0],this.lexer)}}reflink(a,u){let d;if((d=this.rules.inline.reflink.exec(a))||(d=this.rules.inline.nolink.exec(a))){let g=(d[2]||d[1]).replace(/\s+/g," ");if(g=u[g.toLowerCase()],!g||!g.href){let _=d[0].charAt(0);return{type:"text",raw:_,text:_}}return q9e(d,g,d[0],this.lexer)}}emStrong(a,u,d=""){let g=this.rules.inline.emStrong.lDelim.exec(a);if(!g||g[3]&&d.match(/[\p{L}\p{N}]/u))return;let _=g[1]||g[2]||"";if(!_||_&&(d===""||this.rules.inline.punctuation.exec(d))){let T=g[0].length-1,N,R,O=T,B=0,V=g[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(V.lastIndex=0,u=u.slice(-1*a.length+T);(g=V.exec(u))!=null;){if(N=g[1]||g[2]||g[3]||g[4]||g[5]||g[6],!N)continue;if(R=N.length,g[3]||g[4]){O+=R;continue}else if((g[5]||g[6])&&T%3&&!((T+R)%3)){B+=R;continue}if(O-=R,O>0)continue;if(R=Math.min(R,R+O+B),Math.min(T,R)%2){let W=a.slice(1,T+g.index+R);return{type:"em",raw:a.slice(0,T+g.index+R+1),text:W,tokens:this.lexer.inlineTokens(W)}}let Y=a.slice(2,T+g.index+R-1);return{type:"strong",raw:a.slice(0,T+g.index+R+1),text:Y,tokens:this.lexer.inlineTokens(Y)}}}}codespan(a){let u=this.rules.inline.code.exec(a);if(u){let d=u[2].replace(/\n/g," "),g=/[^ ]/.test(d),_=/^ /.test(d)&&/ $/.test(d);return g&&_&&(d=d.substring(1,d.length-1)),d=$l(d,!0),{type:"codespan",raw:u[0],text:d}}}br(a){let u=this.rules.inline.br.exec(a);if(u)return{type:"br",raw:u[0]}}del(a){let u=this.rules.inline.del.exec(a);if(u)return{type:"del",raw:u[0],text:u[2],tokens:this.lexer.inlineTokens(u[2])}}autolink(a,u){let d=this.rules.inline.autolink.exec(a);if(d){let g,_;return d[2]==="@"?(g=$l(this.options.mangle?u(d[1]):d[1]),_="mailto:"+g):(g=$l(d[1]),_=g),{type:"link",raw:d[0],text:g,href:_,tokens:[{type:"text",raw:g,text:g}]}}}url(a,u){let d;if(d=this.rules.inline.url.exec(a)){let g,_;if(d[2]==="@")g=$l(this.options.mangle?u(d[0]):d[0]),_="mailto:"+g;else{let T;do T=d[0],d[0]=this.rules.inline._backpedal.exec(d[0])[0];while(T!==d[0]);g=$l(d[0]),d[1]==="www."?_="http://"+g:_=g}return{type:"link",raw:d[0],text:g,href:_,tokens:[{type:"text",raw:g,text:g}]}}}inlineText(a,u){let d=this.rules.inline.text.exec(a);if(d){let g;return this.lexer.state.inRawBlock?g=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(d[0]):$l(d[0]):d[0]:g=$l(this.options.smartypants?u(d[0]):d[0]),{type:"text",raw:d[0],text:g}}}},Gr={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?<?([^\s>]+)>?(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:jE,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/},Gr._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Gr._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/,Gr.def=to(Gr.def).replace("label",Gr._label).replace("title",Gr._title).getRegex(),Gr.bullet=/(?:[*+-]|\d{1,9}[.)])/,Gr.listItemStart=to(/^( *)(bull) */).replace("bull",Gr.bullet).getRegex(),Gr.list=to(Gr.list).replace(/bull/g,Gr.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+Gr.def.source+")").getRegex(),Gr._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Gr._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,Gr.html=to(Gr.html,"i").replace("comment",Gr._comment).replace("tag",Gr._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Gr.paragraph=to(Gr._paragraph).replace("hr",Gr.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Gr._tag).getRegex(),Gr.blockquote=to(Gr.blockquote).replace("paragraph",Gr.paragraph).getRegex(),Gr.normal=Lf({},Gr),Gr.gfm=Lf({},Gr.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"}),Gr.gfm.table=to(Gr.gfm.table).replace("hr",Gr.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Gr._tag).getRegex(),Gr.gfm.paragraph=to(Gr._paragraph).replace("hr",Gr.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",Gr.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Gr._tag).getRegex(),Gr.pedantic=Lf({},Gr.normal,{html:to(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Gr._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:jE,paragraph:to(Gr.normal._paragraph).replace("hr",Gr.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Gr.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()}),hr={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:jE,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^[^_*]*?\_\_[^_*]*?\*[^_*]*?(?=\_\_)|[^*]+(?=[^*])|[punct_](\*+)(?=[\s]|$)|[^punct*_\s](\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|[^punct*_\s](\*+)(?=[^punct*_\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?\_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|[punct*](\_+)(?=[\s]|$)|[^punct*_\s](\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:jE,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/},hr._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~",hr.punctuation=to(hr.punctuation).replace(/punctuation/g,hr._punctuation).getRegex(),hr.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g,hr.escapedEmSt=/\\\*|\\_/g,hr._comment=to(Gr._comment).replace("(?:-->|$)","-->").getRegex(),hr.emStrong.lDelim=to(hr.emStrong.lDelim).replace(/punct/g,hr._punctuation).getRegex(),hr.emStrong.rDelimAst=to(hr.emStrong.rDelimAst,"g").replace(/punct/g,hr._punctuation).getRegex(),hr.emStrong.rDelimUnd=to(hr.emStrong.rDelimUnd,"g").replace(/punct/g,hr._punctuation).getRegex(),hr._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,hr._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,hr._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,hr.autolink=to(hr.autolink).replace("scheme",hr._scheme).replace("email",hr._email).getRegex(),hr._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,hr.tag=to(hr.tag).replace("comment",hr._comment).replace("attribute",hr._attribute).getRegex(),hr._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,hr._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,hr._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,hr.link=to(hr.link).replace("label",hr._label).replace("href",hr._href).replace("title",hr._title).getRegex(),hr.reflink=to(hr.reflink).replace("label",hr._label).replace("ref",Gr._label).getRegex(),hr.nolink=to(hr.nolink).replace("ref",Gr._label).getRegex(),hr.reflinkSearch=to(hr.reflinkSearch,"g").replace("reflink",hr.reflink).replace("nolink",hr.nolink).getRegex(),hr.normal=Lf({},hr),hr.pedantic=Lf({},hr.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:to(/^!?\[(label)\]\((.*?)\)/).replace("label",hr._label).getRegex(),reflink:to(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",hr._label).getRegex()}),hr.gfm=Lf({},hr.normal,{escape:to(hr.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/}),hr.gfm.url=to(hr.gfm.url,"i").replace("email",hr.gfm._extended_email).getRegex(),hr.breaks=Lf({},hr.gfm,{br:to(hr.br).replace("{2,}","*").getRegex(),text:to(hr.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()}),X8=class _Y{constructor(u){this.tokens=[],this.tokens.links=Object.create(null),this.options=u||q8,this.options.tokenizer=this.options.tokenizer||new hk,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let d={block:Gr.normal,inline:hr.normal};this.options.pedantic?(d.block=Gr.pedantic,d.inline=hr.pedantic):this.options.gfm&&(d.block=Gr.gfm,this.options.breaks?d.inline=hr.breaks:d.inline=hr.gfm),this.tokenizer.rules=d}static get rules(){return{block:Gr,inline:hr}}static lex(u,d){return new _Y(d).lex(u)}static lexInline(u,d){return new _Y(d).inlineTokens(u)}lex(u){u=u.replace(/\r\n|\r/g,`
`),this.blockTokens(u,this.tokens);let d;for(;d=this.inlineQueue.shift();)this.inlineTokens(d.src,d.tokens);return this.tokens}blockTokens(u,d=[]){this.options.pedantic?u=u.replace(/\t/g,"    ").replace(/^ +$/gm,""):u=u.replace(/^( *)(\t+)/gm,(R,O,B)=>O+"    ".repeat(B.length));let g,_,T,N;for(;u;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(R=>(g=R.call({lexer:this},u,d))?(u=u.substring(g.raw.length),d.push(g),!0):!1))){if(g=this.tokenizer.space(u)){u=u.substring(g.raw.length),g.raw.length===1&&d.length>0?d[d.length-1].raw+=`
`:d.push(g);continue}if(g=this.tokenizer.code(u)){u=u.substring(g.raw.length),_=d[d.length-1],_&&(_.type==="paragraph"||_.type==="text")?(_.raw+=`
`+g.raw,_.text+=`
`+g.text,this.inlineQueue[this.inlineQueue.length-1].src=_.text):d.push(g);continue}if(g=this.tokenizer.fences(u)){u=u.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.heading(u)){u=u.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.hr(u)){u=u.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.blockquote(u)){u=u.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.list(u)){u=u.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.html(u)){u=u.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.def(u)){u=u.substring(g.raw.length),_=d[d.length-1],_&&(_.type==="paragraph"||_.type==="text")?(_.raw+=`
`+g.raw,_.text+=`
`+g.raw,this.inlineQueue[this.inlineQueue.length-1].src=_.text):this.tokens.links[g.tag]||(this.tokens.links[g.tag]={href:g.href,title:g.title});continue}if(g=this.tokenizer.table(u)){u=u.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.lheading(u)){u=u.substring(g.raw.length),d.push(g);continue}if(T=u,this.options.extensions&&this.options.extensions.startBlock){let R=1/0,O=u.slice(1),B;this.options.extensions.startBlock.forEach(function(V){B=V.call({lexer:this},O),typeof B=="number"&&B>=0&&(R=Math.min(R,B))}),R<1/0&&R>=0&&(T=u.substring(0,R+1))}if(this.state.top&&(g=this.tokenizer.paragraph(T))){_=d[d.length-1],N&&_.type==="paragraph"?(_.raw+=`
`+g.raw,_.text+=`
`+g.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=_.text):d.push(g),N=T.length!==u.length,u=u.substring(g.raw.length);continue}if(g=this.tokenizer.text(u)){u=u.substring(g.raw.length),_=d[d.length-1],_&&_.type==="text"?(_.raw+=`
`+g.raw,_.text+=`
`+g.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=_.text):d.push(g);continue}if(u){let R="Infinite loop on byte: "+u.charCodeAt(0);if(this.options.silent){console.error(R);break}else throw new Error(R)}}return this.state.top=!0,d}inline(u,d=[]){return this.inlineQueue.push({src:u,tokens:d}),d}inlineTokens(u,d=[]){let g,_,T,N=u,R,O,B;if(this.tokens.links){let V=Object.keys(this.tokens.links);if(V.length>0)for(;(R=this.tokenizer.rules.inline.reflinkSearch.exec(N))!=null;)V.includes(R[0].slice(R[0].lastIndexOf("[")+1,-1))&&(N=N.slice(0,R.index)+"["+W9e("a",R[0].length-2)+"]"+N.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(R=this.tokenizer.rules.inline.blockSkip.exec(N))!=null;)N=N.slice(0,R.index)+"["+W9e("a",R[0].length-2)+"]"+N.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(R=this.tokenizer.rules.inline.escapedEmSt.exec(N))!=null;)N=N.slice(0,R.index)+"++"+N.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);for(;u;)if(O||(B=""),O=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(V=>(g=V.call({lexer:this},u,d))?(u=u.substring(g.raw.length),d.push(g),!0):!1))){if(g=this.tokenizer.escape(u)){u=u.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.tag(u)){u=u.substring(g.raw.length),_=d[d.length-1],_&&g.type==="text"&&_.type==="text"?(_.raw+=g.raw,_.text+=g.text):d.push(g);continue}if(g=this.tokenizer.link(u)){u=u.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.reflink(u,this.tokens.links)){u=u.substring(g.raw.length),_=d[d.length-1],_&&g.type==="text"&&_.type==="text"?(_.raw+=g.raw,_.text+=g.text):d.push(g);continue}if(g=this.tokenizer.emStrong(u,N,B)){u=u.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.codespan(u)){u=u.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.br(u)){u=u.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.del(u)){u=u.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.autolink(u,X9e)){u=u.substring(g.raw.length),d.push(g);continue}if(!this.state.inLink&&(g=this.tokenizer.url(u,X9e))){u=u.substring(g.raw.length),d.push(g);continue}if(T=u,this.options.extensions&&this.options.extensions.startInline){let V=1/0,Y=u.slice(1),W;this.options.extensions.startInline.forEach(function($){W=$.call({lexer:this},Y),typeof W=="number"&&W>=0&&(V=Math.min(V,W))}),V<1/0&&V>=0&&(T=u.substring(0,V+1))}if(g=this.tokenizer.inlineText(T,YLe)){u=u.substring(g.raw.length),g.raw.slice(-1)!=="_"&&(B=g.raw.slice(-1)),O=!0,_=d[d.length-1],_&&_.type==="text"?(_.raw+=g.raw,_.text+=g.text):d.push(g);continue}if(u){let V="Infinite loop on byte: "+u.charCodeAt(0);if(this.options.silent){console.error(V);break}else throw new Error(V)}}return d}},pk=class{constructor(a){this.options=a||q8}code(a,u,d){let g=(u||"").match(/\S*/)[0];if(this.options.highlight){let _=this.options.highlight(a,g);_!=null&&_!==a&&(d=!0,a=_)}return a=a.replace(/\n$/,"")+`
`,g?'<pre><code class="'+this.options.langPrefix+$l(g,!0)+'">'+(d?a:$l(a,!0))+`</code></pre>
`:"<pre><code>"+(d?a:$l(a,!0))+`</code></pre>
`}blockquote(a){return`<blockquote>
`.concat(a,`</blockquote>
`)}html(a){return a}heading(a,u,d,g){if(this.options.headerIds){let _=this.options.headerPrefix+g.slug(d);return"<h".concat(u,' id="').concat(_,'">').concat(a,"</h").concat(u,`>
`)}return"<h".concat(u,">").concat(a,"</h").concat(u,`>
`)}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(a,u,d){let g=u?"ol":"ul",_=u&&d!==1?' start="'+d+'"':"";return"<"+g+_+`>
`+a+"</"+g+`>
`}listitem(a){return"<li>".concat(a,`</li>
`)}checkbox(a){return"<input "+(a?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(a){return"<p>".concat(a,`</p>
`)}table(a,u){return u&&(u="<tbody>".concat(u,"</tbody>")),`<table>
<thead>
`+a+`</thead>
`+u+`</table>
`}tablerow(a){return`<tr>
`.concat(a,`</tr>
`)}tablecell(a,u){let d=u.header?"th":"td";return(u.align?"<".concat(d,' align="').concat(u.align,'">'):"<".concat(d,">"))+a+"</".concat(d,`>
`)}strong(a){return"<strong>".concat(a,"</strong>")}em(a){return"<em>".concat(a,"</em>")}codespan(a){return"<code>".concat(a,"</code>")}br(){return this.options.xhtml?"<br/>":"<br>"}del(a){return"<del>".concat(a,"</del>")}link(a,u,d){if(a=j9e(this.options.sanitize,this.options.baseUrl,a),a===null)return d;let g='<a href="'+$l(a)+'"';return u&&(g+=' title="'+u+'"'),g+=">"+d+"</a>",g}image(a,u,d){if(a=j9e(this.options.sanitize,this.options.baseUrl,a),a===null)return d;let g='<img src="'.concat(a,'" alt="').concat(d,'"');return u&&(g+=' title="'.concat(u,'"')),g+=this.options.xhtml?"/>":">",g}text(a){return a}},gH=class{strong(a){return a}em(a){return a}codespan(a){return a}del(a){return a}html(a){return a}text(a){return a}link(a,u,d){return""+d}image(a,u,d){return""+d}br(){return""}},yH=class{constructor(){this.seen={}}serialize(a){return a.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(a,u){let d=a,g=0;if(this.seen.hasOwnProperty(d)){g=this.seen[a];do g++,d=a+"-"+g;while(this.seen.hasOwnProperty(d))}return u||(this.seen[a]=g,this.seen[d]=0),d}slug(a,u={}){let d=this.serialize(a);return this.getNextSafeSlug(d,u.dryrun)}},ty=class SY{constructor(u){this.options=u||q8,this.options.renderer=this.options.renderer||new pk,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new gH,this.slugger=new yH}static parse(u,d){return new SY(d).parse(u)}static parseInline(u,d){return new SY(d).parseInline(u)}parse(u,d=!0){let g="",_,T,N,R,O,B,V,Y,W,$,K,J,oe,ae,ue,xe,Re,Ae,we,ft=u.length;for(_=0;_<ft;_++){if($=u[_],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[$.type]&&(we=this.options.extensions.renderers[$.type].call({parser:this},$),we!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes($.type))){g+=we||"";continue}switch($.type){case"space":continue;case"hr":{g+=this.renderer.hr();continue}case"heading":{g+=this.renderer.heading(this.parseInline($.tokens),$.depth,G9e(this.parseInline($.tokens,this.textRenderer)),this.slugger);continue}case"code":{g+=this.renderer.code($.text,$.lang,$.escaped);continue}case"table":{for(Y="",V="",R=$.header.length,T=0;T<R;T++)V+=this.renderer.tablecell(this.parseInline($.header[T].tokens),{header:!0,align:$.align[T]});for(Y+=this.renderer.tablerow(V),W="",R=$.rows.length,T=0;T<R;T++){for(B=$.rows[T],V="",O=B.length,N=0;N<O;N++)V+=this.renderer.tablecell(this.parseInline(B[N].tokens),{header:!1,align:$.align[N]});W+=this.renderer.tablerow(V)}g+=this.renderer.table(Y,W);continue}case"blockquote":{W=this.parse($.tokens),g+=this.renderer.blockquote(W);continue}case"list":{for(K=$.ordered,J=$.start,oe=$.loose,R=$.items.length,W="",T=0;T<R;T++)ue=$.items[T],xe=ue.checked,Re=ue.task,ae="",ue.task&&(Ae=this.renderer.checkbox(xe),oe?ue.tokens.length>0&&ue.tokens[0].type==="paragraph"?(ue.tokens[0].text=Ae+" "+ue.tokens[0].text,ue.tokens[0].tokens&&ue.tokens[0].tokens.length>0&&ue.tokens[0].tokens[0].type==="text"&&(ue.tokens[0].tokens[0].text=Ae+" "+ue.tokens[0].tokens[0].text)):ue.tokens.unshift({type:"text",text:Ae}):ae+=Ae),ae+=this.parse(ue.tokens,oe),W+=this.renderer.listitem(ae,Re,xe);g+=this.renderer.list(W,K,J);continue}case"html":{g+=this.renderer.html($.text);continue}case"paragraph":{g+=this.renderer.paragraph(this.parseInline($.tokens));continue}case"text":{for(W=$.tokens?this.parseInline($.tokens):$.text;_+1<ft&&u[_+1].type==="text";)$=u[++_],W+=`
`+($.tokens?this.parseInline($.tokens):$.text);g+=d?this.renderer.paragraph(W):W;continue}default:{let Le='Token with "'+$.type+'" type was not found.';if(this.options.silent){console.error(Le);return}else throw new Error(Le)}}}return g}parseInline(u,d){d=d||this.renderer;let g="",_,T,N,R=u.length;for(_=0;_<R;_++){if(T=u[_],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[T.type]&&(N=this.options.extensions.renderers[T.type].call({parser:this},T),N!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(T.type))){g+=N||"";continue}switch(T.type){case"escape":{g+=d.text(T.text);break}case"html":{g+=d.html(T.text);break}case"link":{g+=d.link(T.href,T.title,this.parseInline(T.tokens,d));break}case"image":{g+=d.image(T.href,T.title,T.text);break}case"strong":{g+=d.strong(this.parseInline(T.tokens,d));break}case"em":{g+=d.em(this.parseInline(T.tokens,d));break}case"codespan":{g+=d.codespan(T.text);break}case"br":{g+=d.br();break}case"del":{g+=d.del(this.parseInline(T.tokens,d));break}case"text":{g+=d.text(T.text);break}default:{let O='Token with "'+T.type+'" type was not found.';if(this.options.silent){console.error(O);return}else throw new Error(O)}}}return g}},ni.options=ni.setOptions=function(a){return Lf(ni.defaults,a),$Le(ni.defaults),ni},ni.getDefaults=V9e,ni.defaults=q8,ni.use=function(...a){let u=Lf({},...a),d=ni.defaults.extensions||{renderers:{},childTokens:{}},g;a.forEach(_=>{if(_.extensions&&(g=!0,_.extensions.forEach(T=>{if(!T.name)throw new Error("extension name required");if(T.renderer){let N=d.renderers?d.renderers[T.name]:null;N?d.renderers[T.name]=function(...R){let O=T.renderer.apply(this,R);return O===!1&&(O=N.apply(this,R)),O}:d.renderers[T.name]=T.renderer}if(T.tokenizer){if(!T.level||T.level!=="block"&&T.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");d[T.level]?d[T.level].unshift(T.tokenizer):d[T.level]=[T.tokenizer],T.start&&(T.level==="block"?d.startBlock?d.startBlock.push(T.start):d.startBlock=[T.start]:T.level==="inline"&&(d.startInline?d.startInline.push(T.start):d.startInline=[T.start]))}T.childTokens&&(d.childTokens[T.name]=T.childTokens)})),_.renderer){let T=ni.defaults.renderer||new pk;for(let N in _.renderer){let R=T[N];T[N]=(...O)=>{let B=_.renderer[N].apply(T,O);return B===!1&&(B=R.apply(T,O)),B}}u.renderer=T}if(_.tokenizer){let T=ni.defaults.tokenizer||new hk;for(let N in _.tokenizer){let R=T[N];T[N]=(...O)=>{let B=_.tokenizer[N].apply(T,O);return B===!1&&(B=R.apply(T,O)),B}}u.tokenizer=T}if(_.walkTokens){let T=ni.defaults.walkTokens;u.walkTokens=function(N){let R=[];return R.push(_.walkTokens.call(this,N)),T&&(R=R.concat(T.call(this,N))),R}}g&&(u.extensions=d),ni.setOptions(u)})},ni.walkTokens=function(a,u){let d=[];for(let g of a)switch(d=d.concat(u.call(ni,g)),g.type){case"table":{for(let _ of g.header)d=d.concat(ni.walkTokens(_.tokens,u));for(let _ of g.rows)for(let T of _)d=d.concat(ni.walkTokens(T.tokens,u));break}case"list":{d=d.concat(ni.walkTokens(g.items,u));break}default:ni.defaults.extensions&&ni.defaults.extensions.childTokens&&ni.defaults.extensions.childTokens[g.type]?ni.defaults.extensions.childTokens[g.type].forEach(function(_){d=d.concat(ni.walkTokens(g[_],u))}):g.tokens&&(d=d.concat(ni.walkTokens(g.tokens,u)))}return d},ni.parseInline=function(a,u){if(typeof a>"u"||a===null)throw new Error("marked.parseInline(): input parameter is undefined or null");if(typeof a!="string")throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(a)+", string expected");u=Lf({},ni.defaults,u||{}),$9e(u);try{let d=X8.lexInline(a,u);return u.walkTokens&&ni.walkTokens(d,u.walkTokens),ty.parseInline(d,u)}catch(d){if(d.message+=`
Please report this to https://github.com/markedjs/marked.`,u.silent)return"<p>An error occurred:</p><pre>"+$l(d.message+"",!0)+"</pre>";throw d}},ni.Parser=ty,ni.parser=ty.parse,ni.Renderer=pk,ni.TextRenderer=gH,ni.Lexer=X8,ni.lexer=X8.lex,ni.Tokenizer=hk,ni.Slugger=yH,ni.parse=ni,ni.options,ni.setOptions,ni.use,ni.walkTokens,ni.parseInline,ty.parse,X8.lex}),su,fk,mk,vH,a4e,l4e,c4e,xH,u4e,d4e,h4e,bH,p4e,f4e,m4e,g4e,y4e,HE,gk,v4e,x4e,b4e,_4e,S4e,w4e,T4e,_H,SH=C(()=>{su=z(nt()),HLe(),tn(),ms(),Ar(),KLe(),fI(),N3e(),fk=({title:a,message:u})=>"".concat(a," ").concat(u),mk=(()=>{let a=new Map;return{add:u=>{let d=fk(u);a.has(d)?a.set(d,a.get(d)+1):a.set(d,1)},delete:u=>{let d=fk(u);a.has(d)&&a.get(d)>1?a.set(d,a.get(d)-1):a.delete(d)},clear:()=>{a.clear()},check:u=>a.has(fk(u))}})(),vH=(()=>{let a=new Map;return{add:u=>{a.has(u)?a.set(u,a.get(u)+1):a.set(u,1)},delete:u=>{a.has(u)&&a.get(u)>1?a.set(u,a.get(u)-1):a.delete(u)},clear:()=>{a.clear()},check:u=>a.has(u),get types(){return Array.of(...a.keys())}}})(),l4e=ge.div(a4e||(a4e=H([`
  width: 100%;
  border-radius: 4px;
  display: flex;
  gap: 12px;
  `,`;
  background-color: rgba(40, 43, 47, 0.8);
  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.25), 0 2px 6px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(14px);

  @supports not (backdrop-filter: blur()) {
    background: rgba(40, 43, 47, 0.95);
  }
`])),Zi),xH=ge.div(c4e||(c4e=H([`
  font-size: 14px;
  font-weight: bold;
  color: #fff;
`]))),d4e=ge.div(u4e||(u4e=H([`
  flex: 1;
  flex-direction: column;
  width: 0;
  display: flex;
  padding: 16px 0;
  gap: 12px;
`]))),bH=ge.div(h4e||(h4e=H([`
  color: #b4b4b4;
  font-size: 12px;
  line-height: 1.4;

  a {
    color: rgba(255, 255, 255, 0.9);
  }

  em {
    font-style: italic;
  }

  strong {
    font-weight: bold;
    color: #d5d5d5;
  }

  p {
    margin-bottom: 8px;
  }

  code {
    font-family: monospace;
    background: rgba(0, 0, 0, 0.3);
    padding: 1px 1px 2px;
    border-radius: 4px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    white-space: pre-wrap;
  }

  pre > code {
    white-space: pre;
    display: block;
    overflow: auto;
    padding: 4px;
  }

  pre {
    white-space: pre-wrap;
    margin-bottom: 8px;
  }
`]))),f4e=ge.button(p4e||(p4e=H([`
  color: rgba(255, 255, 255, 0.9);
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: center;
  background: none;
  border: none;
  padding-left: 12px;
  padding-right: 12px;
  border-left: 1px solid rgba(255, 255, 255, 0.05);

  &:hover {
    background: rgba(255, 255, 255, 0.05);
  }
`]))),m4e={info:"#3b82f6",success:"#10b981",warning:"#f59e0b",error:"#ef4444"},y4e=ge.div(g4e||(g4e=H([`
  display: flex;
  justify-content: center;
  margin-left: 12px;
  padding-top: 21px;

  ::before {
    content: '';
    width: 8px;
    height: 8px;
    border-radius: 999999px;
    background-color: `,`;
  }
`])),({type:a})=>m4e[a]),HE=a=>(u,d,g=[],_=!1)=>{(_||!mk.check({title:u,message:d}))&&(mk.add({title:u,message:d}),vH.add(a),fH.custom(T=>su.default.createElement(l4e,null,su.default.createElement(y4e,{type:a}),su.default.createElement(d4e,null,su.default.createElement(xH,null,u),su.default.createElement(bH,{dangerouslySetInnerHTML:{__html:ni.parse(d)}}),g.length>0&&su.default.createElement(bH,null,su.default.createElement("span",null,"Docs:"," ",g.map((N,R)=>su.default.createElement(su.Fragment,{key:R},R>0&&", ",su.default.createElement("a",{target:"_blank",href:N.url},N.title)))))),su.default.createElement(f4e,{onClick:()=>{fH.remove(T.id),mk.delete({title:u,message:d}),vH.delete(a)}},"Close")),{duration:1/0}))},gk={warning:HE("warning"),success:HE("success"),info:HE("info"),error:HE("error")},ge.div(v4e||(v4e=H([`
  display: flex;
  justify-content: `,`;
  gap: 12px;
`])),({align:a})=>a==="center"?"center":"flex-end"),ge.button(x4e||(x4e=H([`
  position: relative;
  border-radius: 4px;
  display: flex;
  align-items: center;
  gap: 12px;
  `,`;
  background-color: rgba(40, 43, 47, 0.8);
  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.25), 0 2px 6px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(14px);
  border: none;
  padding: 12px;
  color: #fff;
  overflow: hidden;

  ::before {
    content: '';
    position: absolute;
    inset: 0;
  }

  :hover::before {
    background: `,`;
  }

  @supports not (backdrop-filter: blur()) {
    background: rgba(40, 43, 47, 0.95);
  }
`])),Zi,({danger:a})=>a?"rgba(255, 0, 0, 0.1)":"rgba(255, 255, 255, 0.1)"),ge.div(b4e||(b4e=H([`
  z-index: 10;
  display: flex;
  flex-direction: column;
  gap: 8px;
  position: fixed;
  right: 92px;
  top: 50px;
  width: 500px;
  height: 85vh;
  min-height: 400px;
`]))),ge.div(_4e||(_4e=H([`
  overflow: hidden;
  pointer-events: auto;
  border-radius: 4px;

  & > div {
    display: flex;
    flex-direction: column-reverse;
    gap: 8px;
    overflow: scroll;
    height: 100%;
  }
`]))),w4e=ge.div(S4e||(S4e=H([`
  width: fit-content;
  padding: 8px;
  border-radius: 4px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  color: #b4b4b4;
  font-size: 12px;
  line-height: 1.4;
`]))),T4e=()=>{let{hasNotifications:a}=_H();return hI({enabled:!a},()=>su.default.createElement(eH,null,su.default.createElement(w4e,null,su.default.createElement(xH,null,"No notifications"),"Notifications will appear here when you get them.")))},_H=()=>{let{toasts:a}=z9e();return{hasNotifications:a.length>0}}}),uc,E4e,M4e,C4e,A4e,N4e,P4e,R4e,I4e,k4e,wH,D4e,O4e,ZLe=C(()=>{Ar(),Pe(),uc=z(nt()),tn(),fI(),ELe(),Qj(),E4e=un(),o9e(),BLe(),lR(),zLe(),GLe(),Ef(),jLe(),SH(),C4e=ge.div(M4e||(M4e=H([`
  height: 36px;
  pointer-events: none;

  display: flex;
  justify-content: space-between;
  padding: 12px;
`]))),N4e=ge.div(A4e||(A4e=H([`
  color: white;
  width: 14px;
  height: 14px;
  background: #d00;
  border-radius: 4px;
  text-align: center;
  line-height: 14px;
  font-weight: 600;
  font-size: 8px;
  position: relative;
  left: -6px;
  top: -11px;
  margin-right: -14px;
  box-shadow: 0 4px 6px -4px #00000059;
`]))),R4e=ge.div(P4e||(P4e=H([`
  display: flex;
  gap: 8px;
`]))),ge.div(I4e||(I4e=H([`
  position: absolute;
  background: `,`;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  right: -2px;
  top: -2px;
`])),({type:a})=>a==="info"?"#40aaa4":"#f59e0b"),ge.div(k4e||(k4e=H([`
  position: absolute;
  height: 32px;
  width: 1px;
  background: #373b40;
  opacity: 0.4;
`]))),wH=!1,D4e=()=>{var a;let u=di(()=>{let V=(0,E4e.val)(ce().atomP.ephemeral.coreByProject);return Object.entries(V).map(([Y,W])=>({projectId:Y,state:W})).filter(({state:Y})=>Y.loadingState.type==="browserStateIsNotBasedOnDiskState")},[]),[d,g]=hI({enabled:u.length>0,enterDelay:u.length>0?0:200},()=>u.length>0?uc.default.createElement(S3e,null,u.length===1?'There is a state conflict in project "'.concat(u[0].projectId,'". Select the project in the outline below in order to fix it.'):"There are ".concat(u.length," projects that have state conflicts. They are highlighted in the outline below. ")):uc.default.createElement(ok,null,uc.default.createElement(uc.default.Fragment,null,"Outline"))),_=(a=ti(ce().atomP.ahistoric.pinOutline))!=null?a:!0,T=ti(ce().atomP.ahistoric.updateChecker.result.hasUpdates)===!0;qu(()=>{let V=N.current.getBoundingClientRect();return{debugName:"More Menu",constraints:{maxX:V.right,maxY:8,minX:V.left-140,minY:8},verticalGap:2}},()=>uc.default.createElement(N9e,null));let N=(0,uc.useRef)(null);(0,uc.useMemo)(()=>(window.__IS_VISUAL_REGRESSION_TESTING&&(wH||(wH=!0,console.warn("Visual regression testing enabled, so we're showing the updates badge unconditionally"))),T||window.__IS_VISUAL_REGRESSION_TESTING?!0:T),[T]);let{hasNotifications:R}=_H(),[O,B]=T4e();return uc.default.createElement(C4e,null,uc.default.createElement(R4e,null,d,uc.default.createElement(u9e,{ref:g,"data-testid":"OutlinePanel-TriggerButton",onClick:()=>{ce().transaction(({stateEditors:V,drafts:Y})=>{var W;V.studio.ahistoric.setPinOutline(!((W=Y.ahistoric.pinOutline)==null||W))})},icon:uc.default.createElement(Jte,null),pinHintIcon:uc.default.createElement(h9e,null),unpinHintIcon:uc.default.createElement(d9e,null),pinned:_}),u.length>0?uc.default.createElement(N4e,null,u.length):null,uc.default.createElement(sH,{showLeftDivider:!0,toolbarId:"global"})))},O4e=D4e}),L4e,$E,F4e,WE,B4e,U4e,z4e,V4e,G4e=C(()=>{L4e=un(),Ar(),$E=z(nt()),F4e=z(H2()),WE=new L4e.Atom({set:{},byId:{}}),B4e=1,U4e=()=>{let a=B4e++;function u(g,_,T){WE.reduce(N=>({byId:U(P({},N.byId),{[a]:{comp:g,props:_,portalNode:T}}),set:U(P({},N.set),{[a]:!0})}))}function d(){WE.reduce(g=>{let _=P({},g.set),T=P({},g.byId);return delete _[a],{byId:T,set:_}})}return{mountOrRender:u,unmount:d}},z4e=()=>{let a=Object.keys(ti(WE.pointer.set));return $E.default.createElement($E.default.Fragment,null,a.map(u=>$E.default.createElement(V4e,{key:"id-"+u,id:u})))},V4e=({id:a})=>{let{comp:u,portalNode:d,props:g}=ti(WE.pointer.byId[a]);return(0,F4e.createPortal)($E.default.createElement(u,P({},g)),d)}});function QLe(a){let u=ce(),[d,g]=Ni(void 0),_=dpe();_.configureLogging({min:128,dev:EH,internal:EH});let T=_.getLogger().named("Theatre.js UIRoot");JOe();let N=ti(u.atomP.ahistoric.visibilityState);return(0,dc.useEffect)(()=>(N==="everythingIsHidden"&&console.warn("Theatre.js Studio is hidden. Use the keyboard shortcut 'alt + \\' to restore the studio, or call studio.ui.restore()."),()=>{}),[N]),di(()=>{let R=(0,TH.val)(u.atomP.ahistoric.visibilityState);return(0,TH.val)(u.atomP.ephemeral.initialised)?dc.default.createElement(ore,{logger:T},dc.default.createElement(L0e,null,dc.default.createElement(XRe,null,dc.default.createElement(X4e,null),dc.default.createElement(H7.Provider,{value:g},dc.default.createElement(Rz,{target:window.__IS_VISUAL_REGRESSION_TESTING===!0?void 0:a.containerShadow},dc.default.createElement(dc.default.Fragment,null,dc.default.createElement(H4e,null),dc.default.createElement(W4e,{className:R==="everythingIsHidden"?"invisible":""},dc.default.createElement(Pz,{ref:d}),dc.default.createElement(O4e,null),dc.default.createElement(y3e,null)))))))):null},[u,d,g])}var TH,dc,j4e,H4e,$4e,W4e,q4e,EH,X4e,JLe=C(()=>{Pe(),Ar(),TH=un(),dc=z(nt()),tn(),TLe(),ZLe(),ls(),y8(),Ij(),rc(),F0e(),Qz(),G4e(),ms(),VI(),x8(),H4e=typeof window<"u"?tee(j4e||(j4e=H([`
  :host {
    contain: strict;
  }
`]))):{},W4e=ge(sre)($4e||($4e=H([`
  z-index: 50;
  position: fixed;
  inset: 0;

  &.invisible {
    pointer-events: none !important;
    opacity: 0;
    transform: translateX(1000000px);
  }
`]))),EH=/Playground.+Theatre\.js/.test((q4e=typeof document<"u"?document==null?void 0:document.title:null)!=null?q4e:""),X4e=()=>dc.default.createElement(z4e,null)}),eFe=Z(a=>{var u=H2();a.createRoot=u.createRoot,a.hydrateRoot=u.hydrateRoot}),Y4e={};ie(Y4e,{default:()=>Q4e});var K4e,Z4e,Q4e,tFe=C(()=>{JLe(),K4e=z(nt()),Z4e=z(eFe()),G4e(),ms(),o9e(),Q4e=class{constructor(){ye(this,"containerEl",document.createElement("div")),ye(this,"_renderTimeout"),ye(this,"_documentBodyUIIsRenderedIn"),ye(this,"containerShadow"),this.containerEl.id="theatrejs-studio-root",this.containerEl.style.cssText=`
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      pointer-events: none;
      z-index: 100;
    `;let a=()=>{if(window.__IS_VISUAL_REGRESSION_TESTING===!0){let u=document.createElement("div");return u.id="theatrejs-faux-shadow-root",document.body.appendChild(u),u}else return this.containerEl.attachShadow({mode:"open"})};this.containerShadow=a()}render(){let a=()=>{if(!document.body){this._renderTimeout=setTimeout(a,5);return}this._renderTimeout=void 0,this._documentBodyUIIsRenderedIn=document.body,this._documentBodyUIIsRenderedIn.appendChild(this.containerEl),Z4e.default.createRoot(this.containerShadow).render(K4e.default.createElement(QLe,{containerShadow:this.containerShadow}))};this._renderTimeout=setTimeout(a,10)}renderToolset(a,u){let d=U4e();return d.mountOrRender(yRe(sH),{toolbarId:a},u),d.unmount}}}),nFe=Z(a=>{a.compare=_,a.reduce=T;var u,d,g;a.REMOVE=u=-1,a.ADD=d=1,a.EQUAL=g=0;function _(V,Y){var W=V.length,$=Y.length,K=N(V,Y),J=K<W&&K<$?R(V,Y):0,oe=J+K-1;W-=oe,$-=oe;for(var ae=B(W,$),ue=W-1;ue>=0;--ue)for(var xe=$-1;xe>=0;--xe)ae[xe][ue]=O(ae,V,Y,K,ue,xe);return{prefix:K,matrix:ae,suffix:J}}function T(V,Y,W){var $,K,J,oe,ae=W.matrix,ue=W.prefix;for($=0;$<ue;++$)Y=V(Y,g,$,$);for(J=$,ue=ae.length,$=0,K=0;$<ue;)switch(oe=ae[$][K].type,Y=V(Y,oe,$+J,K+J),oe){case g:++$,++K;break;case u:++K;break;case d:++$;break}for($+=J,K+=J,ue=W.suffix,J=0;J<ue;++J)Y=V(Y,g,$+J,K+J);return Y}function N(V,Y){for(var W=0,$=Math.min(V.length,Y.length);W<$&&V[W]===Y[W];)++W;return W}function R(V,Y){for(var W=V.length-1,$=Y.length-1,K=Math.min(W,$),J=0;J<K&&V[W-J]===Y[$-J];)++J;return J}function O(V,Y,W,$,K,J){return Y[K+$]===W[J+$]?{value:V[J+1][K+1].value,type:g}:V[J][K+1].value<V[J+1][K].value?{value:V[J][K+1].value+1,type:u}:{value:V[J+1][K].value+1,type:d}}function B(V,Y){var W=[],$,K,J;for(J=W[Y]=[],K=0;K<V;++K)J[K]={value:V-K,type:u};for($=0;$<Y;++$)W[$]=[],W[$][V]={value:Y-$,type:d};return W[Y][V]={value:0,type:g},W}}),J4e=Z(a=>{a.cons=u,a.tail=d,a.map=g;function u(_,T){var N=T.length,R=new Array(N+1);R[0]=_;for(var O=0;O<N;++O)R[O+1]=T[O];return R}function d(_){for(var T=_.length-1,N=new Array(T),R=0;R<T;++R)N[R]=_[R+1];return N}function g(_,T){for(var N=new Array(T.length),R=0;R<T.length;++R)N[R]=_(T[R]);return N}}),rFe=Z((a,u)=>{u.exports=N;var d=/\/|~1|~0/g,g="/",_="~",T="~1";function N(R,O){var B,V,Y,W;for(B=R.charAt(0)===g?1:0,V="",d.lastIndex=B;Y=d.exec(R);)if(W=Y[0],V+=R.slice(B,d.lastIndex-W.length),B=d.lastIndex,W===g){if(O(V)===!1)return R;V=""}else V+=W===T?g:_;return V+=R.slice(B),O(V),R}}),MH=Z(a=>{var u=rFe();a.find=V,a.join=W,a.absolute=Y,a.parse=$,a.contains=K,a.encodeSegment=oe,a.decodeSegment=J,a.parseArrayIndex=xe,a.isValidArrayIndex=ue;var d="/",g=/\//g,_="~1",T=/~1/g,N="~",R=/~/g,O="~0",B=/~0/g;function V(Ae,we,ft,Le){if(typeof we=="string"){if(we==="")return{target:Ae,key:void 0};if(we===d)return{target:Ae,key:""};var Se=Ae,Ge,Je=Le!==void 0;return u(we,function(He){if(Ae==null)return Se=null,!1;Array.isArray(Ae)?Ge=Je?Re(ft,xe(He),Ae,Le):He==="-"?He:xe(He):Ge=He,Se=Ae,Ae=Ae[Ge]}),Se===null?void 0:{target:Se,key:Ge}}}function Y(Ae){return Ae[0]===d?Ae:d+Ae}function W(Ae){return Ae.join(d)}function $(Ae){var we=[];return u(Ae,we.push.bind(we)),we}function K(Ae,we){return we.indexOf(Ae)===0&&we[Ae.length]===d}function J(Ae){return Ae.replace(T,d).replace(B,N)}function oe(Ae){return Ae.replace(R,O).replace(g,_)}var ae=/^(0|[1-9]\d*)$/;function ue(Ae){return ae.test(Ae)}function xe(Ae){if(ue(Ae))return+Ae;throw new SyntaxError("invalid array index "+Ae)}function Re(Ae,we,ft,Le){var Se=we;if(Se<0)throw new Error("array index out of bounds "+Se);if(Le!==void 0&&typeof Ae=="function"&&(Se=Ae(we,ft,Le),Se<0))throw new Error("could not find patch context "+Le);return Se}}),eye=Z((a,u)=>{u.exports=d;function d(T){return T==null||typeof T!="object"?T:Array.isArray(T)?g(T):_(T)}function g(T){for(var N=T.length,R=new Array(N),O=0;O<N;++O)R[O]=d(T[O]);return R}function _(T){for(var N=Object.keys(T),R={},O,B=0,V=N.length;B<V;++B)O=N[B],R[O]=d(T[O]);return R}}),iFe=Z((a,u)=>{u.exports=d;function d(T,N){return T===N?!0:Array.isArray(T)&&Array.isArray(N)?g(T,N):typeof T=="object"&&typeof N=="object"?_(T,N):!1}function g(T,N){if(T.length!==N.length)return!1;for(var R=0;R<T.length;++R)if(!d(T[R],N[R]))return!1;return!0}function _(T,N){if(T===null&&N!==null||T!==null&&N===null)return!1;var R=Object.keys(T),O=Object.keys(N);if(R.length!==O.length)return!1;for(var B=0,V;B<R.length;++B)if(V=R[B],!(V in N&&d(T[V],N[V])))return!1;return!0}}),sFe=Z((a,u)=>{var d=MH();u.exports=function(V,Y){var W=d.parse(V.path),$=d.parse(Y.path),K=O(W,$),J=T(W,$,K.length),oe=B(V),ae=B(Y);return K.length===0&&!J?[ae,oe]:J?_(oe,W,ae,$):g(oe,W,ae)};function g(V,Y,W,$){if(V.path===W.path)throw new TypeError("cannot commute "+V.op+","+W.op+" with identical object paths");return[W,V]}function _(V,Y,W,$){return Y.length===$.length?N(V,Y,W,$):(Y.length>$.length?(Y=R(W,$,V,Y,-1),V.path=d.absolute(d.join(Y))):($=R(V,Y,W,$,1),W.path=d.absolute(d.join($))),[W,V])}function T(V,Y,W){return d.isValidArrayIndex(V[W])&&d.isValidArrayIndex(Y[W])}function N(V,Y,W,$){var K=Y.length-1,J=+Y[K],oe=+$[K],ae;return J<oe?V.op==="add"||V.op==="copy"?(ae=$.slice(),ae[K]=Math.max(0,oe-1),W.path=d.absolute(d.join(ae))):V.op==="remove"&&(ae=$.slice(),ae[K]=oe+1,W.path=d.absolute(d.join(ae))):W.op==="add"||W.op==="copy"?(ae=Y.slice(),ae[K]=J+1,V.path=d.absolute(d.join(ae))):J>oe&&W.op==="remove"&&(ae=Y.slice(),ae[K]=Math.max(0,J-1),V.path=d.absolute(d.join(ae))),[W,V]}function R(V,Y,W,$,K){var J=Y.length-1,oe=+Y[J],ae=+$[J],ue=$.slice();return oe>ae||(V.op==="add"||V.op==="copy"?ue[J]=Math.max(0,ae-K):V.op==="remove"&&(ue[J]=Math.max(0,ae+K))),ue}function O(V,Y){var W=V.length,$=Y.length;if(W===0||$===0||W<2&&$<2)return[];for(var K=W===$?W-1:Math.min(W,$),J=0;J<K&&V[J]===Y[J];)++J;return V.slice(0,J)}function B(V){return V.op==="remove"?{op:V.op,path:V.path}:V.op==="copy"||V.op==="move"?{op:V.op,path:V.path,from:V.from}:{op:V.op,path:V.path,value:V.value}}}),tye=Z((a,u)=>{u.exports=d;function d(g){Error.call(this),this.name=this.constructor.name,this.message=g,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,this.constructor)}d.prototype=Object.create(Error.prototype),d.prototype.constructor=d}),CH=Z((a,u)=>{u.exports=d;function d(g){Error.call(this),this.name=this.constructor.name,this.message=g,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,this.constructor)}d.prototype=Object.create(Error.prototype),d.prototype.constructor=d}),nye=Z((a,u)=>{u.exports=d;function d(g){Error.call(this),this.name=this.constructor.name,this.message=g,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,this.constructor)}d.prototype=Object.create(Error.prototype),d.prototype.constructor=d}),rye=Z(a=>{var u=MH(),d=eye(),g=iFe(),_=sFe(),T=J4e(),N=tye(),R=CH(),O=nye(),B=u.find,V=u.parseArrayIndex;a.test={apply:Y,inverse:W,commute:$},a.add={apply:K,inverse:oe,commute:ae},a.remove={apply:Ae,inverse:ft,commute:Le},a.replace={apply:ue,inverse:xe,commute:Re},a.move={apply:Se,inverse:Ge,commute:Je},a.copy={apply:He,inverse:Bt,commute:ae};function Y(it,Ce,ut){var kt=B(it,Ce.path,ut.findContext,Ce.context),De=kt.target,at,$t;if(Array.isArray(De)?(at=V(kt.key),$t=De[at]):$t=kt.key===void 0?kt.target:kt.target[kt.key],!g($t,Ce.value))throw new N("test failed "+JSON.stringify(Ce));return it}function W(it,Ce){return it.push(Ce),1}function $(it,Ce){if(it.path===Ce.path&&Ce.op==="remove")throw new TypeError("Can't commute test,remove -> remove,test for same path");return Ce.op==="test"||Ce.op==="replace"?[Ce,it]:_(it,Ce)}function K(it,Ce,ut){var kt=B(it,Ce.path,ut.findContext,Ce.context);if(Qe(kt))throw new R("path does not exist "+Ce.path);if(Ce.value===void 0)throw new R("missing value");var De=d(Ce.value);return kt.key===void 0?De:(J(kt,De),it)}function J(it,Ce){var ut=it.target;if(Array.isArray(ut))if(it.key==="-")ut.push(Ce);else{if(it.key>ut.length)throw new R("target of add outside of array bounds");ut.splice(it.key,0,Ce)}else if(gt(ut))ut[it.key]=Ce;else throw new R("target of add must be an object or array "+it.key)}function oe(it,Ce){var ut=Ce.context;return ut!==void 0&&(ut={before:ut.before,after:T.cons(Ce.value,ut.after)}),it.push({op:"test",path:Ce.path,value:Ce.value,context:ut}),it.push({op:"remove",path:Ce.path,context:ut}),1}function ae(it,Ce){if(it.path===Ce.path&&Ce.op==="remove")throw new TypeError("Can't commute add,remove -> remove,add for same path");return _(it,Ce)}function ue(it,Ce,ut){var kt=B(it,Ce.path,ut.findContext,Ce.context);if(Qe(kt)||Zt(kt))throw new R("path does not exist "+Ce.path);if(Ce.value===void 0)throw new R("missing value");var De=d(Ce.value);if(kt.key===void 0)return De;var at=kt.target;return Array.isArray(at)?at[V(kt.key)]=De:at[kt.key]=De,it}function xe(it,Ce,ut,kt){var De=kt[ut-1];if(De===void 0||De.op!=="test"||De.path!==Ce.path)throw new O("cannot invert replace w/o test");var at=De.context;return at!==void 0&&(at={before:at.before,after:T.cons(De.value,T.tail(at.after))}),it.push({op:"test",path:De.path,value:Ce.value}),it.push({op:"replace",path:De.path,value:De.value}),2}function Re(it,Ce){if(it.path===Ce.path&&Ce.op==="remove")throw new TypeError("Can't commute replace,remove -> remove,replace for same path");return Ce.op==="test"||Ce.op==="replace"?[Ce,it]:_(it,Ce)}function Ae(it,Ce,ut){var kt=B(it,Ce.path,ut.findContext,Ce.context);if(Qe(kt)||kt.target[kt.key]===void 0)throw new R("path does not exist "+Ce.path);return we(kt),it}function we(it){var Ce=it.target,ut;if(Array.isArray(Ce))return ut=Ce.splice(V(it.key),1),ut[0];if(gt(Ce))return ut=Ce[it.key],delete Ce[it.key],ut;throw new R("target of remove must be an object or array")}function ft(it,Ce,ut,kt){var De=kt[ut-1];if(De===void 0||De.op!=="test"||De.path!==Ce.path)throw new O("cannot invert remove w/o test");var at=De.context;return at!==void 0&&(at={before:at.before,after:T.tail(at.after)}),it.push({op:"add",path:De.path,value:De.value,context:at}),2}function Le(it,Ce){return it.path===Ce.path&&Ce.op==="remove"?[Ce,it]:_(it,Ce)}function Se(it,Ce,ut){if(u.contains(Ce.path,Ce.from))throw new R("move.from cannot be ancestor of move.path");var kt=B(it,Ce.path,ut.findContext,Ce.context),De=B(it,Ce.from,ut.findContext,Ce.fromContext);return J(kt,we(De)),it}function Ge(it,Ce){return it.push({op:"move",path:Ce.from,context:Ce.fromContext,from:Ce.path,fromContext:Ce.context}),1}function Je(it,Ce){if(it.path===Ce.path&&Ce.op==="remove")throw new TypeError("Can't commute move,remove -> move,replace for same path");return _(it,Ce)}function He(it,Ce,ut){var kt=B(it,Ce.path,ut.findContext,Ce.context),De=B(it,Ce.from,ut.findContext,Ce.fromContext);if(Qe(De)||Zt(De))throw new R("copy.from must exist");var at=De.target,$t;return Array.isArray(at)?$t=at[V(De.key)]:$t=at[De.key],J(kt,d($t)),it}function Bt(it,Ce){throw new O("cannot invert "+Ce.op)}function Qe(it){return it===void 0||it.target==null&&it.key!==void 0}function Zt(it){return it.key!==void 0&&it.target[it.key]===void 0}function gt(it){return it!==null&&typeof it=="object"}}),oFe=Z(a=>{var u=rye(),d=eye(),g=CH();a.apply=T,a.applyInPlace=N,a.clone=d,a.isValidObject=O,a.defaultHash=R;var _={};function T(V,Y,W){return N(V,d(Y),W)}function N(V,Y,W){if(W||(W=_),!Array.isArray(V))return Y;for(var $,K,J=0;J<V.length;++J){if(K=V[J],$=u[K.op],$===void 0)throw new g("invalid op "+JSON.stringify(K));Y=$.apply(Y,K,W)}return Y}function R(V){return O(V)||B(V)?JSON.stringify(V):V}function O(V){return V!==null&&Object.prototype.toString.call(V)==="[object Object]"}function B(V){return Object.prototype.toString.call(V)==="[object Array]"}}),aFe=Z((a,u)=>{var d=rye();u.exports=function(_){var T=[],N,R;for(N=_.length-1;N>=0;N-=R)R=g(T,_[N],N,_);return T};function g(_,T,N,R){var O=d[T.op];return O!==void 0&&typeof O.inverse=="function"?O.inverse(_,T,N,R):1}}),lFe=Z(a=>{var u=nFe(),d=J4e(),g=oFe(),_=aFe(),T=MH(),N=T.encodeSegment;a.diff=B,a.patch=g.apply,a.patchInPlace=g.applyInPlace,a.inverse=_,a.clone=g.clone,a.InvalidPatchOperationError=CH(),a.TestFailedError=tye(),a.PatchNotInvertibleError=nye();var R=g.isValidObject,O=g.defaultHash;function B(xe,Re,Ae){return Y(xe,Re,"",V(Ae,[])).patch}function V(xe,Re){return typeof xe=="object"?{patch:Re,hash:oe(ue,xe.hash,O),makeContext:oe(ue,xe.makeContext,ae),invertible:xe.invertible!==!1}:{patch:Re,hash:oe(ue,xe,O),makeContext:ae,invertible:!0}}function Y(xe,Re,Ae,we){return Array.isArray(xe)&&Array.isArray(Re)?$(xe,Re,Ae,we):R(xe)&&R(Re)?W(xe,Re,Ae,we):J(xe,Re,Ae,we)}function W(xe,Re,Ae,we){var ft=Object.keys(Re),Le=we.patch,Se,Ge;for(Se=ft.length-1;Se>=0;--Se){Ge=ft[Se];var Je=Ae+"/"+N(Ge);xe[Ge]!==void 0?Y(xe[Ge],Re[Ge],Je,we):Le.push({op:"add",path:Je,value:Re[Ge]})}for(ft=Object.keys(xe),Se=ft.length-1;Se>=0;--Se)if(Ge=ft[Se],Re[Ge]===void 0){var He=Ae+"/"+N(Ge);we.invertible&&Le.push({op:"test",path:He,value:xe[Ge]}),Le.push({op:"remove",path:He})}return we}function $(xe,Re,Ae,we){var ft=d.map(we.hash,xe),Le=d.map(we.hash,Re),Se=u.compare(ft,Le);return K(xe,Re,Ae,we,Se)}function K(xe,Re,Ae,we,ft){var Le=0;return u.reduce(function(Se,Ge,Je,He){var Bt,Qe,Zt=Se.patch,gt=Ae+"/"+(He+Le);return Ge===u.REMOVE?(Bt=Zt[Zt.length-1],Qe=Se.makeContext(He,xe),Se.invertible&&Zt.push({op:"test",path:gt,value:xe[He],context:Qe}),Bt!==void 0&&Bt.op==="add"&&Bt.path===gt?(Bt.op="replace",Bt.context=Qe):Zt.push({op:"remove",path:gt,context:Qe}),Le-=1):Ge===u.ADD?(Zt.push({op:"add",path:gt,value:Re[Je],context:Se.makeContext(He,xe)}),Le+=1):Y(xe[He],Re[Je],gt,Se),Se},we,ft)}function J(xe,Re,Ae,we){return xe!==Re&&(we.invertible&&we.patch.push({op:"test",path:Ae,value:xe}),we.patch.push({op:"replace",path:Ae,value:Re})),we}function oe(xe,Re,Ae){return xe(Re)?Re:Ae}function ae(){}function ue(xe){return typeof xe=="function"}}),Y8=Z((a,u)=>{function d(g,_){for(var T=0,N=_.length-1;T<N;T++){if(!g[_[T]])return null;g=g[_[T]]}return g}u.exports=d}),ny=Z((a,u)=>{function d(_){return _==="~0"?"~":"/"}function g(_){var T=_.split("/");if(_.indexOf("~")===-1)return T;for(var N=0,R=T.length;N<R;N++)T[N].indexOf("~")!==-1&&(T[N]=T[N].replace(/~[01]/g,d));return T}u.exports=g}),cFe=Z((a,u)=>{var d=Y8(),g=ny();function _(T,N){var R=g(N),O=R[R.length-1],B=d(T,R);return B?B[O]:void 0}u.exports=_}),yk=Z((a,u)=>{function d(g,_){if(g===_)return!0;if(!(g&&_)||typeof g!="object"||typeof _!="object"||g.length!==_.length)return!1;if(Array.isArray(g)){if(!Array.isArray(_))return!1;for(var T=0,N=g.length;T<N;T++)if(!d(g[T],_[T]))return!1;return!0}var R=Object.keys(g);if(R.length!==Object.keys(_).length)return!1;for(var O=0,B=R.length;O<B;O++){var V=R[O];if(!d(g[V],_[V]))return!1}return!0}u.exports=d}),vk=Z((a,u)=>{function d(g,_){if(_==="-")return g.length;for(var T=0,N=_.length;T<N;T++){var R=_.charCodeAt(T);if(57<R||R<48)return 1/0}return+_}u.exports=d}),xk=Z((a,u)=>{var d=yk(),g=Y8(),_=vk(),T=ny();function N(R,O,B,V){if(typeof B>"u")return"[op:add] require value, but got undefined";var Y=T(O),W=Y[Y.length-1],$=g(R,Y);if($===null)return"[op:add] path not found: "+O;if(Array.isArray($)){var K=_($,W);if($.length<K)return"[op:add] invalid array index: "+O;V(R,Y).splice(K,0,B)}else d($[W],B)||(V(R,Y)[W]=B)}u.exports=N}),iye=Z((a,u)=>{var d=Y8(),g=vk(),_=ny();function T(N,R,O){var B=_(R),V=B[B.length-1],Y=d(N,B);if(Y===null)return"[op:remove] path not found: "+R;if(Array.isArray(Y)){var W=g(Y,V);if(Y.length<=W)return"[op:remove] invalid array index: "+R;O(N,B).splice(W,1)}else delete O(N,B)[V]}u.exports=T}),sye=Z((a,u)=>{var d=yk(),g=Y8(),_=vk(),T=ny();function N(R,O,B,V){if(typeof B>"u")return"[op:replace] require value, but got undefined";var Y=T(O),W=Y[Y.length-1],$=g(R,Y);if($===null)return"[op:replace] path not found: "+O;if(Array.isArray($)){var K=_($,W);if($.length<=K)return"[op:replace] invalid array index: "+O;d($[K],B)||V(R,Y).splice(K,1,B)}else d($[W],B)||(V(R,Y)[W]=B)}u.exports=N}),oye=Z((a,u)=>{var d=xk(),g=Y8(),_=vk(),T=ny();function N(R,O,B,V){if(B!==O){var Y=T(O),W=Y[Y.length-1],$=g(R,Y);if($===null)return"[op:move] path not found: "+O;var K=void 0;if(Array.isArray($)){var J=_($,W);if($.length<=J)return"[op:move] invalid array index: "+B;K=$[J],V(R,Y).splice(J,1)}else K=$[W],delete V(R,Y)[W];return d(R,B,K,V)}}u.exports=N}),aye=Z((a,u)=>{var d=Y8(),g=ny(),_=xk();function T(N,R,O,B){var V=g(R),Y=V[V.length-1],W=d(N,V);return W===null?"[op:copy] path not found: "+R:_(N,O,W[Y],B)}u.exports=T}),lye=Z((a,u)=>{var d=yk(),g=Y8(),_=ny();function T(N,R,O){var B=_(R),V=B[B.length-1],Y=g(N,B);if(Y===null)return"[op:test] path not found: "+R;if(!d(Y[V],O)){var W=JSON.stringify(Y[V]),$=JSON.stringify(O);return"[op:test] not matched: "+W+" "+$}}u.exports=T}),AH=Z((a,u)=>{function d(g){if(!g||typeof g!="object")return g;if(Array.isArray(g)){for(var _=g.length,T=new Array(_),N=0;N<_;N++)T[N]=g[N];return T}for(var R=Object.keys(g),O={},B=0,V=R.length;B<V;B++){var Y=R[B];O[Y]=g[Y]}return O}u.exports=d}),uFe=Z((a,u)=>{var d=cFe(),g=xk(),_=iye(),T=sye(),N=oye(),R=aye(),O=lye(),B=yk(),V=AH(),Y=ny();function W($,K){return{get:function(J){return d($,J)},add:function(J,oe){return g($,J,oe,K)},remove:function(J){return _($,J,K)},replace:function(J,oe){return T($,J,oe,K)},move:function(J,oe){return N($,J,oe,K)},copy:function(J,oe){return R($,J,oe,K)},test:function(J,oe){return O($,J,oe)},deepEqual:B,shallowCopy:V,toKeys:Y}}u.exports=W}),dFe=Z((a,u)=>{function d(g,_,T,N){return N.error=T,N.partial?_[""]:g}u.exports=d}),hFe=Z((a,u)=>{function d(g){return!!g}u.exports=d}),pFe=Z((a,u)=>{function d(g){if(g)throw new TypeError(g)}u.exports=d}),fFe=Z((a,u)=>{var d=AH();function g(_,T){for(var N=0,R=T.length-1;N<R;N++)_=_[T[N]]=d(_[T[N]]);return _}u.exports=g}),mFe=Z((a,u)=>{var d=AH();function g(T,N,R){var O=T[N];return R.has(O)||(O=d(O),R.add(O)),O}function _(T,N,R){for(var O=0,B=N.length-1;O<B;O++)T=T[N[O]]=g(T,N[O],R);return T}u.exports=_}),gFe=Z((a,u)=>{var d=uFe(),g=dFe(),_=hFe(),T=pFe(),N=fFe(),R=mFe(),O=xk(),B=iye(),V=sye(),Y=oye(),W=aye(),$=lye(),K=Set||function(){var oe=[];return oe.has=function(ae){return this.indexOf(ae)!==-1},oe.add=function(ae){this.push(ae)},oe};function J(oe,ae,ue){if(ae.length===0)return oe;ue=ue||{};for(var xe=ue.strict?T:_,Re=ae.length===1?N:function(Ge){return function(Je,He){return R(Je,He,Ge)}}(new K),Ae={"":oe},we,ft=0,Le=ae.length;ft<Le;ft++){var Se=ae[ft];switch(Se.op){case"add":if(xe(O(Ae,""+Se.path,Se.value,Re)))return g(oe,Ae,Se,ue);break;case"remove":if(xe(B(Ae,""+Se.path,Re)))return g(oe,Ae,Se,ue);break;case"replace":if(xe(V(Ae,""+Se.path,Se.value,Re)))return g(oe,Ae,Se,ue);break;case"move":if(xe(Y(Ae,""+Se.from,""+Se.path,Re)))return g(oe,Ae,Se,ue);break;case"copy":if(xe(W(Ae,""+Se.from,""+Se.path,Re)))return g(oe,Ae,Se,ue);break;case"test":if(xe($(Ae,""+Se.path,Se.value)))return g(oe,Ae,Se,ue);break;default:if(ue.custom&&ue.custom[Se.op]){if(we=we||d(Ae,Re),xe(ue.custom[Se.op](we,Se,ft,ae)))return g(oe,Ae,Se,ue)}else return xe("[op:"+Se.op+"] unknown"),g(oe,Ae,Se,ue);break}}return Ae[""]}u.exports=J}),yFe=Z((a,u)=>{u.exports=gFe()}),vFe=Z((a,u)=>{(function(d,g){typeof a=="object"&&typeof u=="object"?u.exports=g():typeof a=="object"?a.blobCompare=g():d.blobCompare=g()})(window,function(){return function(d){var g={};function _(T){if(g[T])return g[T].exports;var N=g[T]={i:T,l:!1,exports:{}};return d[T].call(N.exports,N,N.exports,_),N.l=!0,N.exports}return _.m=d,_.c=g,_.d=function(T,N,R){_.o(T,N)||Object.defineProperty(T,N,{enumerable:!0,get:R})},_.r=function(T){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(T,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(T,"__esModule",{value:!0})},_.t=function(T,N){if(1&N&&(T=_(T)),8&N||4&N&&typeof T=="object"&&T&&T.__esModule)return T;var R=Object.create(null);if(_.r(R),Object.defineProperty(R,"default",{enumerable:!0,value:T}),2&N&&typeof T!="string")for(var O in T)_.d(R,O,(function(B){return T[B]}).bind(null,O));return R},_.n=function(T){var N=T&&T.__esModule?function(){return T.default}:function(){return T};return _.d(N,"a",N),N},_.o=function(T,N){return Object.prototype.hasOwnProperty.call(T,N)},_.p="",_(_.s=4)}([function(d,g,_){var T=function(V,Y){if(Array.isArray(V))return V;if(Symbol.iterator in Object(V))return function(W,$){var K=[],J=!0,oe=!1,ae=void 0;try{for(var ue,xe=W[Symbol.iterator]();!(J=(ue=xe.next()).done)&&(K.push(ue.value),!$||K.length!==$);J=!0);}catch(Re){oe=!0,ae=Re}finally{try{!J&&xe.return&&xe.return()}finally{if(oe)throw ae}}return K}(V,Y);throw new TypeError("Invalid attempt to destructure non-iterable instance")},N=function(){function V(Y,W){for(var $=0;$<W.length;$++){var K=W[$];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(Y,K.key,K)}}return function(Y,W,$){return W&&V(Y.prototype,W),$&&V(Y,$),Y}}();function R(V){if(Array.isArray(V)){for(var Y=0,W=Array(V.length);Y<V.length;Y++)W[Y]=V[Y];return W}return Array.from(V)}var O=_(2),B=function(V){function Y(W){(function(K,J){if(!(K instanceof J))throw new TypeError("Cannot call a class as a function")})(this,Y);var $=function(K,J){if(!K)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!J||typeof J!="object"&&typeof J!="function"?K:J}(this,(Y.__proto__||Object.getPrototypeOf(Y)).call(this));return $._messageId=1,$._messages=new Map,$._worker=W,$._worker.onmessage=$._onMessage.bind($),$._id=Math.ceil(1e7*Math.random()),$}return function(W,$){if(typeof $!="function"&&$!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof $);W.prototype=Object.create($&&$.prototype,{constructor:{value:W,enumerable:!1,writable:!0,configurable:!0}}),$&&(Object.setPrototypeOf?Object.setPrototypeOf(W,$):W.__proto__=$)}(Y,V),N(Y,[{key:"terminate",value:function(){this._worker.terminate()}},{key:"isFree",value:function(){return this._messages.size===0}},{key:"jobsLength",value:function(){return this._messages.size}},{key:"exec",value:function(W){var $=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,K=this,J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],oe=arguments[3];return new Promise(function(ae,ue){var xe=K._messageId++;K._messages.set(xe,[ae,ue,oe]),K._worker.postMessage([xe,$,W],J||[])})}},{key:"postMessage",value:function(){var W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,$=this,K=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],J=arguments[2];return new Promise(function(oe,ae){var ue=$._messageId++;$._messages.set(ue,[oe,ae,J]),$._worker.postMessage([ue,W],K||[])})}},{key:"emit",value:function(W){for(var $=arguments.length,K=Array($>1?$-1:0),J=1;J<$;J++)K[J-1]=arguments[J];this._worker.postMessage({eventName:W,args:K})}},{key:"_onMessage",value:function(W){var $;if(!Array.isArray(W.data)&&W.data.eventName)return($=function ue(xe,Re,Ae){xe===null&&(xe=Function.prototype);var we=Object.getOwnPropertyDescriptor(xe,Re);if(we===void 0){var ft=Object.getPrototypeOf(xe);return ft===null?void 0:ue(ft,Re,Ae)}if("value"in we)return we.value;var Le=we.get;return Le!==void 0?Le.call(Ae):void 0}(Y.prototype.__proto__||Object.getPrototypeOf(Y.prototype),"emit",this)).call.apply($,[this,W.data.eventName].concat(R(W.data.args)));var K,J=(K=W.data,Array.isArray(K)?K:Array.from(K)),oe=J[0],ae=J.slice(1);if(oe===1)this._onEvent.apply(this,R(ae));else{if(oe!==0)throw new Error("Wrong message type '"+oe+"'");this._onResult.apply(this,R(ae))}}},{key:"_onResult",value:function(W,$,K){var J=this._messages.get(W),oe=T(J,2),ae=oe[0],ue=oe[1];return this._messages.delete(W),$===1?ae(K):ue(K)}},{key:"_onEvent",value:function(W,$,K){var J=this._messages.get(W),oe=T(J,3)[2];oe&&oe($,K)}}]),Y}(O);d.exports=B},function(d,g,_){d.exports=function(){return _(3)(`!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var f=r(1),c=0,l=1,s=0,y=1,p="main",b=function(e){return"object"===(void 0===e?"undefined":i(e))&&"function"==typeof e.then&&"function"==typeof e.catch};var v=function e(t,r){u(this,e),this.payload=t,this.transferable=r};e.exports=function(e){var t,r,i,h=(i=e,(r=p)in(t={})?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t),d=self.postMessage.bind(self),m=new(function(e){function t(){return u(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"emit",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return d({eventName:e,args:r}),this}},{key:"emitLocally",value:function(e){for(var r,n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];(r=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"emit",this)).call.apply(r,[this,e].concat(i))}},{key:"operation",value:function(e,t){return h[e]=t,this}}]),t}(f)),g=function(e,t,r){var n=function(t){t&&t instanceof v?w(e,y,t.payload,t.transferable):w(e,y,t)},o=function(t){w(e,s,{message:t.message,stack:t.stack})};try{var i=_(e,t,r);b(i)?i.then(n).catch(o):n(i)}catch(e){o(e)}},_=function(e,t,r){var n=h[r||p];if(!n)throw new Error("Not found handler for this request");return n(t,O.bind(null,e))},w=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];d([c,e,t,r],n)},O=function(e,t,r){if(!t)throw new Error("eventName is required");if("string"!=typeof t)throw new Error("eventName should be string");d([l,e,t,r])};return self.addEventListener("message",(function(e){var t=e.data;Array.isArray(t)?g.apply(void 0,a(t)):t&&t.eventName&&m.emitLocally.apply(m,[t.eventName].concat(a(t.args)))})),m},e.exports.TransferableResponse=v},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperty(this,"__listeners",{value:{},enumerable:!1,writable:!1})}return n(e,[{key:"emit",value:function(e){if(!this.__listeners[e])return this;for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o=!0,i=!1,a=void 0;try{for(var u,f=this.__listeners[e][Symbol.iterator]();!(o=(u=f.next()).done);o=!0){var c=u.value;c.apply(void 0,r)}}catch(e){i=!0,a=e}finally{try{!o&&f.return&&f.return()}finally{if(i)throw a}}return this}},{key:"once",value:function(e,t){var r=this,n=function n(){r.off(e,n),t.apply(void 0,arguments)};return this.on(e,n)}},{key:"on",value:function(e,t){return this.__listeners[e]||(this.__listeners[e]=[]),this.__listeners[e].push(t),this}},{key:"off",value:function(e,t){return this.__listeners[e]=t?this.__listeners[e].filter((function(e){return e!==t})):[],this}}]),e}();e.exports=o},function(e,t,r){"use strict";r.r(t);var n=r(0);r.n(n)()().operation("binary",async({blob:e,chunk:t})=>await function(e,t){return new Promise((r,n)=>{const o=new FileReader,i=t?Math.min(t,e.size):e.size,a=e.slice(0,i);o.onload=()=>r(o.result),o.onerror=n,o.readAsBinaryString(a)})}(e,t)).operation("buffer",async({blob:e,chunk:t})=>await function(e,t){return new Promise((r,n)=>{const o=new FileReader,i=t?Math.min(t,e.size):e.size,a=e.slice(0,i);o.onload=()=>r(o.result),o.onerror=n,o.readAsArrayBuffer(a)})}(e,t)).operation("compare",({buf1:e,buf2:t})=>(function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;const r=new DataView(e),n=new DataView(t);for(var o=e.byteLength;o--;)if(r.getUint8(o)!==n.getUint8(o))return!1;return!0})(e,t))}]);`,null)}},function(d,g,_){var T=function(){function R(O,B){for(var V=0;V<B.length;V++){var Y=B[V];Y.enumerable=Y.enumerable||!1,Y.configurable=!0,"value"in Y&&(Y.writable=!0),Object.defineProperty(O,Y.key,Y)}}return function(O,B,V){return B&&R(O.prototype,B),V&&R(O,V),O}}(),N=function(){function R(){(function(O,B){if(!(O instanceof B))throw new TypeError("Cannot call a class as a function")})(this,R),Object.defineProperty(this,"__listeners",{value:{},enumerable:!1,writable:!1})}return T(R,[{key:"emit",value:function(O){if(!this.__listeners[O])return this;for(var B=arguments.length,V=Array(B>1?B-1:0),Y=1;Y<B;Y++)V[Y-1]=arguments[Y];var W=!0,$=!1,K=void 0;try{for(var J,oe=this.__listeners[O][Symbol.iterator]();!(W=(J=oe.next()).done);W=!0){var ae=J.value;ae.apply(void 0,V)}}catch(ue){$=!0,K=ue}finally{try{!W&&oe.return&&oe.return()}finally{if($)throw K}}return this}},{key:"once",value:function(O,B){var V=this,Y=function W(){V.off(O,W),B.apply(void 0,arguments)};return this.on(O,Y)}},{key:"on",value:function(O,B){return this.__listeners[O]||(this.__listeners[O]=[]),this.__listeners[O].push(B),this}},{key:"off",value:function(O,B){return this.__listeners[O]=B?this.__listeners[O].filter(function(V){return V!==B}):[],this}}]),R}();d.exports=N},function(d,g,_){var T=window.URL||window.webkitURL;d.exports=function(N,R){try{try{var O;try{(O=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(N),O=O.getBlob()}catch{O=new Blob([N])}return new Worker(T.createObjectURL(O))}catch{return new Worker("data:application/javascript,"+encodeURIComponent(N))}}catch{if(!R)throw Error("Inline worker is not supported");return new Worker(R)}}},function(d,g,_){_.r(g);var T=_(0),N=_.n(T),R=_(1),O=_.n(R);_.d(g,"workersEnabled",function(){return B}),_.d(g,"default",function(){return V});let B=!!window.Worker;class V{static toBinaryStringWithWorker(W,$){return Me(this,null,function*(){let K=new N.a(new O.a),J=yield K.exec("binary",{blob:W,chunk:$});return K.terminate(),J})}static toBinaryStringWithoutWorker(W,$){return function(K,J){return new Promise((oe,ae)=>{let ue=new FileReader,xe=J?Math.min(J,K.size):K.size,Re=K.slice(0,xe);ue.onload=()=>oe(ue.result),ue.onerror=ae,ue.readAsBinaryString(Re)})}(W,$)}static toBinaryString(W,$,K=!0){return K&&B?this.toBinaryStringWithWorker(W,$):this.toBinaryStringWithoutWorker(W,$)}static toArrayBufferWithWorker(W,$){return Me(this,null,function*(){let K=new N.a(new O.a),J=yield K.exec("buffer",{blob:W,chunk:$});return K.terminate(),J})}static toArrayBufferWithoutWorker(W,$){return function(K,J){return new Promise((oe,ae)=>{let ue=new FileReader,xe=J?Math.min(J,K.size):K.size,Re=K.slice(0,xe);ue.onload=()=>oe(ue.result),ue.onerror=ae,ue.readAsArrayBuffer(Re)})}(W,$)}static toArrayBuffer(W,$,K=!0){return K&&B?this.toArrayBufferWithWorker(W,$):this.toArrayBufferWithoutWorker(W,$)}static compareBuffersWithWorker(W,$){return Me(this,null,function*(){if(W===$)return!0;let K=new N.a(new O.a),J=yield K.exec("compare",{buf1:W,buf2:$},[W,$]);return K.terminate(),J})}static compareBuffersWithoutWorker(W,$){return function(K,J){if(K===J)return!0;if(K.byteLength!==J.byteLength)return!1;let oe=new DataView(K),ae=new DataView(J);for(var ue=K.byteLength;ue--;)if(oe.getUint8(ue)!==ae.getUint8(ue))return!1;return!0}(W,$)}static compareBuffers(W,$,K=!0){return K&&B?this.compareBuffersWithWorker(W,$):this.compareBuffersWithoutWorker(W,$)}static sizeEqual(W,$){return W.size===$.size}static typeEqual(W,$){return W.type===$.type}static magicNumbersEqual(W,$,K=!0){return Me(this,null,function*(){if(W===$)return!0;let J=[24,16,14,12,8,6,4],[oe,ae]=yield Promise.all([this.toBinaryString(W,24,K),this.toBinaryString($,24,K)]);for(let ue of J)if(oe.substring(0,ue)===ae.substring(0,ue))return!0;return!1})}static bytesEqualWithBinaryString(W,$,K,J=!0){return Me(this,null,function*(){if(W===$)return!0;let[oe,ae]=yield Promise.all([this.toBinaryString(W,K,J),this.toBinaryString($,K,J)]);return oe===ae})}static bytesEqualWithArrayBuffer(W,$,K,J=!0){return Me(this,null,function*(){if(W===$)return!0;let[oe,ae]=yield Promise.all([this.toArrayBuffer(W,K,J),this.toArrayBuffer($,K,J)]);return this.compareBuffers(oe,ae,J)})}static isEqual(W,$){return Me(this,arguments,function*(K,J,{methods:oe=["size","type","magic","byte"],byte:ae="buffer",partial:ue=!1,chunks:xe=null,worker:Re=!0}={}){let Ae=null;for(let we of oe){if(Ae===!1||ue&&Ae===!0)break;switch(we){case"byte":case"bytes":case"content":xe=xe instanceof Array?xe:[K.size],Ae=!0;for(let ft of xe){let Le=!1;Le=ae==="buffer"?yield this.bytesEqualWithArrayBuffer(K,J,ft,Re):yield this.bytesEqualWithBinaryString(K,J,ft,Re),Le||(Ae=!1)}break;case"magic":case"headers":case"numbers":case"mime":Ae=yield this.magicNumbersEqual(K,J,Re);break;case"size":case"sizes":Ae=this.sizeEqual(K,J);break;case"type":case"types":Ae=this.typeEqual(K,J);break;default:throw new Error("Blob-compare : Unknown comparison method")}}return Ae})}}}])})}),cye={};ie(cye,{ToolbarDropdownSelect:()=>VBe,default:()=>jBe}),s.exports=re(cye),Pe();function bk(a,u,d=[]){if(typeof a=="object"&&a){if(xFe(a)||bFe(a)){u(a,d);return}for(let[g,_]of Object.entries(a))bk(_,u,[...d,g])}else{if(a==null)return;u(a,d)}}var xFe=a=>typeof a=="object"&&a!==null&&Object.hasOwnProperty.call(a,"type")&&a.type==="image"&&Object.hasOwnProperty.call(a,"id")&&typeof a.id=="string"&&a.id!=="",bFe=a=>typeof a=="object"&&a!==null&&Object.hasOwnProperty.call(a,"r")&&Object.hasOwnProperty.call(a,"g")&&Object.hasOwnProperty.call(a,"b")&&Object.hasOwnProperty.call(a,"a")&&typeof a.r=="number"&&typeof a.g=="number"&&typeof a.b=="number"&&typeof a.a=="number",uye=un();Wt();var _Fe=0,SFe=class{constructor(a){this._studio=a,ye(this,"_id"),ye(this,"_state",{type:"Ready"}),this._id=String(_Fe++)}get status(){return this._state.type}reset(){let{_state:a}=this;if(a.type!=="Ready")if(a.type==="Captured")this._state={type:"Ready"},a.transaction.discard(),a.flagsTransaction.discard();else throw a.type==="Committed"?new Error("This scrub is already committed and can't be reset."):new Error("This scrub is already discarded and can't be reset.")}commit(){let{_state:a}=this;if(a.type==="Captured")a.transaction.commit(),a.flagsTransaction.discard(),this._state={type:"Committed"};else if(a.type==="Ready"){console.warn("Scrub is empty. Nothing to commit.");return}else throw a.type==="Committed"?new Error("This scrub is already committed."):new Error("This scrub is already discarded and can't be comitted.")}capture(a){if(this._state.type==="Captured"&&this.reset(),this._state.type==="Ready"){let u=!0;try{this._state=P({type:"Captured"},this._capture(a)),u=!1}finally{u&&(console.error("This scrub's callback threw an error. We're undo-ing all of the changes made by this scrub, and marking it as discarded."),this._state={type:"Discarded"})}}else throw this._state.type==="Committed"?new Error("This scrub is already committed and cannot capture again. If you wish to capture more, you can start a new studio.scrub() or do so before scrub.commit()"):new Error("This scrub is already discarded and cannot capture again. If you wish to capture more, you can start a new studio.scrub() or do so before scrub.discard()")}_capture(a){let u=[],d=this._studio.tempTransaction(_=>{let T=!0,N={set:(R,O)=>{if(!T)throw new Error("You seem to have called the scrub api after scrub.capture()");let{root:B,path:V}=(0,uye.getPointerParts)(R);if(!Pt(B))throw new Error("We can only scrub props of Sheet Objects for now");_.set(R,O),u.push(R)}};try{a(N)}finally{T=!1}}),g=this._studio.tempTransaction(({stateEditors:_})=>{u.forEach(T=>{let{root:N,path:R}=(0,uye.getPointerParts)(T);if(!Pt(N))return;let O=N.template.getDefaultsAtPointer(T);bk(O,(B,V)=>{_.studio.ephemeral.projects.stateByProjectId.stateBySheetId.stateByObjectKey.propsBeingScrubbed.flag(U(P({},N.address),{pathToProp:V}))},R)})});return{transaction:d,flagsTransaction:g}}discard(){let{_state:a}=this;if(a.type==="Captured"||a.type==="Ready")a.type==="Captured"&&(a.transaction.discard(),a.flagsTransaction.discard()),this._state={type:"Discarded"};else throw a.type==="Committed"?new Error("This scrub is already committed and can't be discarded."):new Error("This scrub is already discarded")}},wFe=un(),dye=typeof window<"u"?Promise.resolve().then(()=>(tFe(),Y4e)).then(a=>a.default):null,TFe=class{constructor(a){this.studio=a,ye(this,"_rendered",!1),ye(this,"_nonSSRBits",dye?dye.then(u=>new u):Promise.reject()),ye(this,"ready",this._nonSSRBits.then(()=>{},()=>{}))}render(){this._rendered||(this._rendered=!0,this._nonSSRBits.then(a=>{a.render()}).catch(a=>{throw console.error(a),a}))}hide(){this.studio.transaction(({drafts:a})=>{a.ahistoric.visibilityState="everythingIsHidden"})}restore(){this.render(),this.studio.transaction(({drafts:a})=>{a.ahistoric.visibilityState="everythingIsVisible"})}get isHidden(){return(0,wFe.val)(this.studio.atomP.ahistoric.visibilityState)==="everythingIsHidden"}renderToolset(a,u){let d=!1,g=null;return this._nonSSRBits.then(_=>{d||(g=_.renderToolset(a,u))}).catch(_=>{console.error(_)}),()=>{if(g){g();return}d||(d=!0)}}},_k=un();function EFe(a){return a}var MFe=(a,u=EFe)=>{let d=g=>({type:a,payload:u(g)});return d.type=a,d.is=g=>g&&g.type&&g.type===a,d},U1=MFe,hye=z(lFe()),pye=z(yFe());I4();var Sk,CFe=new Uint8Array(16);function AFe(){if(!Sk&&(Sk=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Sk))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Sk(CFe)}var NFe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function PFe(a){return typeof a=="string"&&NFe.test(a)}var RFe=PFe,C0=[];for(wk=0;wk<256;++wk)C0.push((wk+256).toString(16).substr(1));var wk;function IFe(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,d=(C0[a[u+0]]+C0[a[u+1]]+C0[a[u+2]]+C0[a[u+3]]+"-"+C0[a[u+4]]+C0[a[u+5]]+"-"+C0[a[u+6]]+C0[a[u+7]]+"-"+C0[a[u+8]]+C0[a[u+9]]+"-"+C0[a[u+10]]+C0[a[u+11]]+C0[a[u+12]]+C0[a[u+13]]+C0[a[u+14]]+C0[a[u+15]]).toLowerCase();if(!RFe(d))throw TypeError("Stringified UUID is invalid");return d}var kFe=IFe;function DFe(a,u,d){a=a||{};var g=a.random||(a.rng||AFe)();if(g[6]=g[6]&15|64,g[8]=g[8]&63|128,u){d=d||0;for(var _=0;_<16;++_)u[d+_]=g[_];return u}return kFe(g)}var OFe=DFe,qE={replaceHistory:U1("@history/replaceHistory"),startHistoryFromScratch:U1("@history/startHistoryFromScratch"),undo:U1("@history/undo"),redo:U1("@history/redo")},LFe={type:"@history/unknownAction",payload:""},FFe={maxNumberOfCommits:100},BFe=(a,u=FFe)=>{let d=NH(a(void 0,LFe));return function(g,_){return qE.startHistoryFromScratch.is(_)?NH(a(void 0,_.payload)):qE.replaceHistory.is(_)?_.payload:qE.undo.is(_)?g?VFe(g):d:qE.redo.is(_)?g?GFe(g):d:g?UFe(g,a(g.innerState,_),u):NH(a(void 0,_))}};function NH(a){return{currentCommitHash:void 0,commitsByHash:{},listOfCommitHashes:[],innerState:a}}function UFe(a,u,d){if(u===a.innerState)return a;let g=zFe(a.innerState,u);if(g.forwardDiff.length===0)return a;let _=j2(a.listOfCommitHashes),T={currentCommitHash:g.hash,commitsByHash:P({},a.commitsByHash),listOfCommitHashes:[...a.listOfCommitHashes],innerState:u};if(a.currentCommitHash!==_){let N=a.listOfCommitHashes.findIndex(R=>R===a.currentCommitHash);a.listOfCommitHashes.slice(N+1).forEach(R=>{delete T.commitsByHash[R]}),T.listOfCommitHashes.splice(N+1,T.listOfCommitHashes.length)}if(T.listOfCommitHashes.push(g.hash),T.commitsByHash[g.hash]=g,T.listOfCommitHashes.length>d.maxNumberOfCommits){let N=T.listOfCommitHashes.length-d.maxNumberOfCommits;T.listOfCommitHashes.slice(0,N).forEach(R=>{delete T.commitsByHash[R]}),T.listOfCommitHashes.splice(0,N)}return T}function zFe(a,u){let d=hye.default.diff(a,u,{invertible:!1}),g=hye.default.diff(u,a,{invertible:!1}),_=Date.now(),T=OFe();return{forwardDiff:d,backwardDiff:g,timestamp:_,hash:T}}function VFe(a){if(a.currentCommitHash===void 0)return a;let u=a.listOfCommitHashes.findIndex(N=>N===a.currentCommitHash);if(u===-1)throw new Error("This should never happen");let d=a.commitsByHash[a.currentCommitHash],g=(0,pye.default)(a.innerState,d.backwardDiff),_=u-1,T=_===-1?void 0:a.listOfCommitHashes[_];return U(P({},a),{currentCommitHash:T,innerState:g})}function GFe(a){if(a.listOfCommitHashes.length===0)return a;let u=a.listOfCommitHashes.findIndex(N=>N===a.currentCommitHash);if(u===a.listOfCommitHashes.length-1)return a;let d=u+1,g=a.listOfCommitHashes[d],_=a.commitsByHash[g],T=(0,pye.default)(a.innerState,_.forwardDiff);return U(P({},a),{currentCommitHash:g,innerState:T})}VI();var Tk={ahistoric:{visibilityState:"everythingIsVisible",theTrigger:{position:{closestCorner:"bottomLeft",distanceFromHorizontalEdge:.02,distanceFromVerticalEdge:.02}},coreByProject:{},projects:{stateByProjectId:{}}},historic:{projects:{stateByProjectId:{}},autoKey:!0,coreByProject:{},panels:{sequenceEditor:{rightPanelOpen:!0}},panelInstanceDesceriptors:{}},ephemeral:{initialised:!1,coreByProject:{},projects:{stateByProjectId:{}},extensions:{byId:{},paneClasses:{}},showOutline:!1}},fye=U1("@storeBundle/replacePersistentState",a=>a),mye=U1("@storeBundle/reduceParts",a=>a),Db={historic:qE,replacePersistentState:fye,reduceParts:mye},gye=U1("@storeBundle/setInnerHistoricState",a=>a),jFe=(a=Tk.historic,u)=>gye.is(u)?u.payload:a,PH=BFe(jFe),yye=(a,u)=>{if(fye.is(u)){let{historic:d,ahistoric:g}=u.payload,_=(a==null?void 0:a.ephemeral)||Tk.ephemeral;return{$persistent:{historic:d,ahistoric:g},ephemeral:_}}else if(a){let{historic:d,ahistoric:g}=a.$persistent,{ephemeral:_}=a;if(mye.is(u)){let T={historic:a.$persistent.historic.innerState,ahistoric:a.$persistent.ahistoric,ephemeral:a.ephemeral},N=u.payload(T);if(N===T)return a;d.innerState!==N.historic&&(d=PH(d,gye(N.historic))),g=N.ahistoric,_=N.ephemeral}else{let T=PH(d,u);if(T===d)return a;d=T}return{$persistent:d===a.$persistent.historic&&g===a.$persistent.ahistoric?a.$persistent:{historic:d,ahistoric:g},ephemeral:_}}else{let d=PH(void 0,{}),g=Tk.ahistoric,_=Tk.ephemeral;return{$persistent:{historic:d,ahistoric:g},ephemeral:_}}},vye=U1("@history/pushTempAction",a=>a),xye=U1("@history/discardTempAction",a=>a),bye=U1("@history/commitTempAction",a=>a),HFe=0,$Fe=()=>{let a=HFe++;return{push:u=>vye({id:a,originalAction:u}),discard:()=>xye(a),commit:()=>bye(a)}},WFe=(a,u)=>{if(a){let{tempActions:d,permanent:g}=a.$temps,_;if(vye.is(u))d=[...d,u];else if(bye.is(u)){let N=d.find(R=>R.payload.id===u.payload);N?(_=N.payload.originalAction,d=d.filter(R=>R.payload.id!==u.payload)):zI.error("Comitting temp action group ".concat(u.payload," isn't possible as this group doesn't exist"))}else xye.is(u)?d=d.filter(N=>N.payload.id!==u.payload):_=u;_&&(g=yye(a.$temps.permanent,_));let T={historic:g.$persistent.historic.innerState,ahistoric:g.$persistent.ahistoric,ephemeral:g.ephemeral};for(let N of d)T=N.payload.originalAction.payload(T);return P({$temps:{tempActions:d,permanent:g},$persistent:g.$persistent},T)}else{let d=yye(void 0,u);return{$temps:{permanent:d,tempActions:[]},$persistent:d.$persistent,historic:d.$persistent.historic.innerState,ahistoric:d.$persistent.ahistoric,ephemeral:d.ephemeral}}};V4(),V4(),wf();function _ye(a,u){if(typeof a!="object"||a===null)return;if(u.length===0){for(let N of Object.keys(a))delete a[N];return}let d=u.slice(0,u.length-1),g=a,_=new WeakMap;for(let N of d){let R=g,O=R[N];if(typeof O!="object"||O===null)return;_.set(O,R),g=O}let T=u.slice().reverse();for(let N of T){if(delete g[N],Object.keys(g).length>0)return;g=_.get(g)}}function qFe(a,{scale:u,origin:d,translate:g}){let _=d+(a-d)*u;return g+_}function Ff(a){for(var u=arguments.length,d=Array(u>1?u-1:0),g=1;g<u;g++)d[g-1]=arguments[g];throw Error("[Immer] minified error nr: "+a+(d.length?" "+d.map(function(_){return"'"+_+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Ob(a){return!!a&&!!a[Jd]}function K8(a){return!!a&&(function(u){if(!u||typeof u!="object")return!1;var d=Object.getPrototypeOf(u);if(d===null)return!0;var g=Object.hasOwnProperty.call(d,"constructor")&&d.constructor;return g===Object||typeof g=="function"&&Function.toString.call(g)===eBe}(a)||Array.isArray(a)||!!a[Rye]||!!a.constructor[Rye]||IH(a)||kH(a))}function XE(a,u,d){d===void 0&&(d=!1),Lb(a)===0?(d?Object.keys:$H)(a).forEach(function(g){d&&typeof g=="symbol"||u(g,a[g],a)}):a.forEach(function(g,_){return u(_,g,a)})}function Lb(a){var u=a[Jd];return u?u.i>3?u.i-4:u.i:Array.isArray(a)?1:IH(a)?2:kH(a)?3:0}function RH(a,u){return Lb(a)===2?a.has(u):Object.prototype.hasOwnProperty.call(a,u)}function XFe(a,u){return Lb(a)===2?a.get(u):a[u]}function Sye(a,u,d){var g=Lb(a);g===2?a.set(u,d):g===3?(a.delete(u),a.add(d)):a[u]=d}function YFe(a,u){return a===u?a!==0||1/a==1/u:a!=a&&u!=u}function IH(a){return QFe&&a instanceof Map}function kH(a){return JFe&&a instanceof Set}function Z8(a){return a.o||a.t}function DH(a){if(Array.isArray(a))return Array.prototype.slice.call(a);var u=tBe(a);delete u[Jd];for(var d=$H(u),g=0;g<d.length;g++){var _=d[g],T=u[_];T.writable===!1&&(T.writable=!0,T.configurable=!0),(T.get||T.set)&&(u[_]={configurable:!0,writable:!0,enumerable:T.enumerable,value:a[_]})}return Object.create(Object.getPrototypeOf(a),u)}function OH(a,u){return u===void 0&&(u=!1),LH(a)||Ob(a)||!K8(a)||(Lb(a)>1&&(a.set=a.add=a.clear=a.delete=KFe),Object.freeze(a),u&&XE(a,function(d,g){return OH(g,!0)},!0)),a}function KFe(){Ff(2)}function LH(a){return a==null||typeof a!="object"||Object.isFrozen(a)}function c3(a){var u=nBe[a];return u||Ff(18,a),u}function wye(){return YE}function FH(a,u){u&&(c3("Patches"),a.u=[],a.s=[],a.v=u)}function Ek(a){BH(a),a.p.forEach(ZFe),a.p=null}function BH(a){a===YE&&(YE=a.l)}function Tye(a){return YE={p:[],l:YE,h:a,m:!0,_:0}}function ZFe(a){var u=a[Jd];u.i===0||u.i===1?u.j():u.O=!0}function UH(a,u){u._=u.p.length;var d=u.p[0],g=a!==void 0&&a!==d;return u.h.g||c3("ES5").S(u,a,g),g?(d[Jd].P&&(Ek(u),Ff(4)),K8(a)&&(a=Mk(u,a),u.l||Ck(u,a)),u.u&&c3("Patches").M(d[Jd],a,u.u,u.s)):a=Mk(u,d,[]),Ek(u),u.u&&u.v(u.u,u.s),a!==Pye?a:void 0}function Mk(a,u,d){if(LH(u))return u;var g=u[Jd];if(!g)return XE(u,function(T,N){return Eye(a,g,u,T,N,d)},!0),u;if(g.A!==a)return u;if(!g.P)return Ck(a,g.t,!0),g.t;if(!g.I){g.I=!0,g.A._--;var _=g.i===4||g.i===5?g.o=DH(g.k):g.o;XE(g.i===3?new Set(_):_,function(T,N){return Eye(a,g,_,T,N,d)}),Ck(a,_,!1),d&&a.u&&c3("Patches").R(g,d,a.u,a.s)}return g.o}function Eye(a,u,d,g,_,T){if(Ob(_)){var N=Mk(a,_,T&&u&&u.i!==3&&!RH(u.D,g)?T.concat(g):void 0);if(Sye(d,g,N),!Ob(N))return;a.m=!1}if(K8(_)&&!LH(_)){if(!a.h.F&&a._<1)return;Mk(a,_),u&&u.A.l||Ck(a,_)}}function Ck(a,u,d){d===void 0&&(d=!1),a.h.F&&a.m&&OH(u,d)}function zH(a,u){var d=a[Jd];return(d?Z8(d):a)[u]}function Mye(a,u){if(u in a)for(var d=Object.getPrototypeOf(a);d;){var g=Object.getOwnPropertyDescriptor(d,u);if(g)return g;d=Object.getPrototypeOf(d)}}function VH(a){a.P||(a.P=!0,a.l&&VH(a.l))}function GH(a){a.o||(a.o=DH(a.t))}function jH(a,u,d){var g=IH(u)?c3("MapSet").N(u,d):kH(u)?c3("MapSet").T(u,d):a.g?function(_,T){var N=Array.isArray(_),R={i:N?1:0,A:T?T.A:wye(),P:!1,I:!1,D:{},l:T,t:_,k:null,o:null,j:null,C:!1},O=R,B=Nk;N&&(O=[R],B=Pk);var V=Proxy.revocable(O,B),Y=V.revoke,W=V.proxy;return R.k=W,R.j=Y,W}(u,d):c3("ES5").J(u,d);return(d?d.A:wye()).p.push(g),g}function Ak(a){return Ob(a)||Ff(22,a),function u(d){if(!K8(d))return d;var g,_=d[Jd],T=Lb(d);if(_){if(!_.P&&(_.i<4||!c3("ES5").K(_)))return _.t;_.I=!0,g=Cye(d,T),_.I=!1}else g=Cye(d,T);return XE(g,function(N,R){_&&XFe(_.t,N)===R||Sye(g,N,u(R))}),T===3?new Set(g):g}(a)}function Cye(a,u){switch(u){case 2:return new Map(a);case 3:return Array.from(a)}return DH(a)}var Aye,YE,HH=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",QFe=typeof Map<"u",JFe=typeof Set<"u",Nye=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Pye=HH?Symbol.for("immer-nothing"):((Aye={})["immer-nothing"]=!0,Aye),Rye=HH?Symbol.for("immer-draftable"):"__$immer_draftable",Jd=HH?Symbol.for("immer-state"):"__$immer_state",eBe=""+Object.prototype.constructor,$H=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(a){return Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a))}:Object.getOwnPropertyNames,tBe=Object.getOwnPropertyDescriptors||function(a){var u={};return $H(a).forEach(function(d){u[d]=Object.getOwnPropertyDescriptor(a,d)}),u},nBe={},Nk={get:function(a,u){if(u===Jd)return a;var d=Z8(a);if(!RH(d,u))return function(_,T,N){var R,O=Mye(T,N);return O?"value"in O?O.value:(R=O.get)===null||R===void 0?void 0:R.call(_.k):void 0}(a,d,u);var g=d[u];return a.I||!K8(g)?g:g===zH(a.t,u)?(GH(a),a.o[u]=jH(a.A.h,g,a)):g},has:function(a,u){return u in Z8(a)},ownKeys:function(a){return Reflect.ownKeys(Z8(a))},set:function(a,u,d){var g=Mye(Z8(a),u);if(g!=null&&g.set)return g.set.call(a.k,d),!0;if(!a.P){var _=zH(Z8(a),u),T=_==null?void 0:_[Jd];if(T&&T.t===d)return a.o[u]=d,a.D[u]=!1,!0;if(YFe(d,_)&&(d!==void 0||RH(a.t,u)))return!0;GH(a),VH(a)}return a.o[u]===d&&typeof d!="number"&&(d!==void 0||u in a.o)||(a.o[u]=d,a.D[u]=!0,!0)},deleteProperty:function(a,u){return zH(a.t,u)!==void 0||u in a.t?(a.D[u]=!1,GH(a),VH(a)):delete a.D[u],a.o&&delete a.o[u],!0},getOwnPropertyDescriptor:function(a,u){var d=Z8(a),g=Reflect.getOwnPropertyDescriptor(d,u);return g&&{writable:!0,configurable:a.i!==1||u!=="length",enumerable:g.enumerable,value:d[u]}},defineProperty:function(){Ff(11)},getPrototypeOf:function(a){return Object.getPrototypeOf(a.t)},setPrototypeOf:function(){Ff(12)}},Pk={};XE(Nk,function(a,u){Pk[a]=function(){return arguments[0]=arguments[0][0],u.apply(this,arguments)}}),Pk.deleteProperty=function(a,u){return Nk.deleteProperty.call(this,a[0],u)},Pk.set=function(a,u,d){return Nk.set.call(this,a[0],u,d,a[0])};var rBe=function(){function a(d){var g=this;this.g=Nye,this.F=!0,this.produce=function(_,T,N){if(typeof _=="function"&&typeof T!="function"){var R=T;T=_;var O=g;return function($){var K=this;$===void 0&&($=R);for(var J=arguments.length,oe=Array(J>1?J-1:0),ae=1;ae<J;ae++)oe[ae-1]=arguments[ae];return O.produce($,function(ue){var xe;return(xe=T).call.apply(xe,[K,ue].concat(oe))})}}var B;if(typeof T!="function"&&Ff(6),N!==void 0&&typeof N!="function"&&Ff(7),K8(_)){var V=Tye(g),Y=jH(g,_,void 0),W=!0;try{B=T(Y),W=!1}finally{W?Ek(V):BH(V)}return typeof Promise<"u"&&B instanceof Promise?B.then(function($){return FH(V,N),UH($,V)},function($){throw Ek(V),$}):(FH(V,N),UH(B,V))}if(!_||typeof _!="object")return(B=T(_))===Pye?void 0:(B===void 0&&(B=_),g.F&&OH(B,!0),B);Ff(21,_)},this.produceWithPatches=function(_,T){return typeof _=="function"?function(O){for(var B=arguments.length,V=Array(B>1?B-1:0),Y=1;Y<B;Y++)V[Y-1]=arguments[Y];return g.produceWithPatches(O,function(W){return _.apply(void 0,[W].concat(V))})}:[g.produce(_,T,function(O,B){N=O,R=B}),N,R];var N,R},typeof(d==null?void 0:d.useProxies)=="boolean"&&this.setUseProxies(d.useProxies),typeof(d==null?void 0:d.autoFreeze)=="boolean"&&this.setAutoFreeze(d.autoFreeze)}var u=a.prototype;return u.createDraft=function(d){K8(d)||Ff(8),Ob(d)&&(d=Ak(d));var g=Tye(this),_=jH(this,d,void 0);return _[Jd].C=!0,BH(g),_},u.finishDraft=function(d,g){var _=d&&d[Jd],T=_.A;return FH(T,g),UH(void 0,T)},u.setAutoFreeze=function(d){this.F=d},u.setUseProxies=function(d){d&&!Nye&&Ff(20),this.g=d},u.applyPatches=function(d,g){var _;for(_=g.length-1;_>=0;_--){var T=g[_];if(T.path.length===0&&T.op==="replace"){d=T.value;break}}var N=c3("Patches").$;return Ob(d)?N(d,g):this.produce(d,function(R){return N(R,g.slice(_+1))})},a}(),eh=new rBe;eh.produce,eh.produceWithPatches.bind(eh),eh.setAutoFreeze.bind(eh),eh.setUseProxies.bind(eh),eh.applyPatches.bind(eh);var WH=eh.createDraft.bind(eh),qH=eh.finishDraft.bind(eh);EP(),eu(),ii(),Zo(),Vl(),LI(),b0(),Wt();var Jo={create(a){let u={byId:{},allIds:{}};if(a)for(let[d,g]of a)u.byId[d]=g,u.allIds[d]=!0;return u},shallowCopy(a){return{byId:P({},a==null?void 0:a.byId),allIds:P({},a==null?void 0:a.allIds)}},add(a,u,d){return{byId:U(P({},a==null?void 0:a.byId),{[u]:d}),allIds:U(P({},a==null?void 0:a.allIds),{[u]:!0})}},merge(a){let u=Jo.create();for(let d=0;d<a.length;d++)u.byId=P(P({},u.byId),a[d].byId),u.allIds=P(P({},u.allIds),a[d].allIds);return u},remove(a,u){let d=Jo.shallowCopy(a);return delete d.allIds[u],delete d.byId[u],d},filter(a,u){let d=Jo.shallowCopy(a);for(let[g,_]of Object.entries(d.byId))u(_)||(delete d.allIds[g],delete d.byId[g]);return d}},Iye=a=>(XH=a,YH),XH,A0=()=>{if(XH===void 0)throw new Error("Calling stateEditors outside of a transaction is not allowed.");return XH},YH;(a=>{(u=>{(d=>{(g=>{function _(T){let N=A0().historic;N.panelPositions!=null||(N.panelPositions={}),N.panelPositions[T.panelId]=T.position}g.setPanelPosition=_})(d.panelPositions||(d.panelPositions={})),(g=>{function _(){var T;return(T=A0().historic).panels!=null||(T.panels={}),A0().historic.panels}g._ensure=_,(T=>{function N(){let R=a.studio.historic.panels._ensure();return R.outlinePanel!=null||(R.outlinePanel={}),R.outlinePanel}T._ensure=N,(R=>{function O(V){let Y=[];for(let W of lo(V))pt(W)?Y.push(P({type:"Project"},W.address)):Ne(W)?(Y.push(P({type:"Sheet"},W.template.address)),a.studio.historic.projects.stateByProjectId.stateBySheetId.setSelectedInstanceId(W.address)):st(W)?Y.push(P({type:"Sheet"},W.address)):Pt(W)?(Y.push(P({type:"SheetObject"},W.template.address)),a.studio.historic.projects.stateByProjectId.stateBySheetId.setSelectedInstanceId(W.sheet.address)):bn(W)&&Y.push(P({type:"SheetObject"},W.address));T._ensure().selection=Y}R.set=O;function B(){T._ensure().selection=[]}R.unset=B})(T.selection||(T.selection={}))})(g.outline||(g.outline={})),(T=>{function N(){let V=a.studio.historic.panels._ensure();return V.sequenceEditor!=null||(V.sequenceEditor={}),V.sequenceEditor}T._ensure=N,(V=>{function Y(){let $=T._ensure();return $.graphEditor!=null||($.graphEditor={height:.5,isOpen:!1}),$.graphEditor}function W($){Y().isOpen=$.isOpen}V.setIsOpen=W})(T.graphEditor||(T.graphEditor={}));function R(V){let Y=T._ensure();Y.rightPanelOpen=V}T.setRightPanelOpen=R;function O(V){let Y=T._ensure();Y.dopesheetLeftWidth=V}T.setDopesheetLeftWidth=O;function B(){let V=T._ensure();return V.rightPanelOpen===void 0&&(V.rightPanelOpen=!0),V.rightPanelOpen}T._ensureRightPanelOpen=B})(g.sequenceEditor||(g.sequenceEditor={}))})(d.panels||(d.panels={})),(g=>{(_=>{function T(N){let R=A0().historic;return R.projects.stateByProjectId[N.projectId]||(R.projects.stateByProjectId[N.projectId]={stateBySheetId:{}}),R.projects.stateByProjectId[N.projectId]}_._ensure=T,(N=>{function R(B){let V=a.studio.historic.projects.stateByProjectId._ensure(B);return V.stateBySheetId[B.sheetId]||(V.stateBySheetId[B.sheetId]={selectedInstanceId:void 0,sequenceEditor:{selectedPropsByObject:{}}}),V.stateBySheetId[B.sheetId]}N._ensure=R;function O(B){a.studio.historic.projects.stateByProjectId.stateBySheetId._ensure(B).selectedInstanceId=B.sheetInstanceId}N.setSelectedInstanceId=O,(B=>{function V(Le){let{selectedPropsByObject:Se}=N._ensure(Le).sequenceEditor;Se[Le.objectKey]||(Se[Le.objectKey]={});let Ge=Se[Le.objectKey],Je=Pf(Le.pathToProp),He=new Set(Object.keys(CE));for(let[Qe,Zt]of Object.entries(Ak(Se)))for(let[gt,it]of Object.entries(Zt))He.delete(it);let Bt=He.size>0?He.values().next().value:Object.keys(CE)[0];Ge[Je]=Bt}B.addPropToGraphEditor=V;function Y(Le){let{selectedPropsByObject:Se}=N._ensure(Le).sequenceEditor;if(!Se[Le.objectKey])return;let Ge=Se[Le.objectKey],Je=Pf(Le.pathToProp);Ge[Je]&&_ye(Se,[Le.objectKey,Je])}B.removePropFromGraphEditor=Y;function W(Le){let Se=a.studio.historic.projects.stateByProjectId.stateBySheetId._ensure(Le).sequenceEditor;return Se.markerSet||(Se.markerSet=Jo.create()),Se.markerSet}function $(Le){let Se=W(Le.sheetAddress),Ge=Le.markers.filter(gt=>!!isFinite(gt.position)).map(gt=>U(P({},gt),{position:Le.snappingFunction(gt.position)})),Je=S1(Ge,"id"),He=Jo.filter(Se,gt=>gt&&!Je[gt.id]),Bt=S1(Object.values(He.byId),"position");Ge.forEach(({position:gt})=>{let it=Bt[gt];it&&(He=Jo.remove(He,it.id))}),Object.assign(Se,Jo.merge([He,Jo.create(Ge.map(gt=>[gt.id,gt]))]));let Qe=a.coreByProject.historic.sheetsById._ensure(Le.sheetAddress);Qe.sequence||(Qe.sequence={type:"PositionalSequence",length:10,subUnitsPerUnit:30,tracksByObject:{}});let Zt=[...Object.values(He.byId).filter(gt=>gt!==void 0),...Ge].sort((gt,it)=>gt.position-it.position);Qe.sequence.markers=Zt.map(gt=>({id:gt.id,label:gt.label,position:gt.position}))}B.replaceMarkers=$;function K(Le){var Se;let Ge=W(Le.sheetAddress);Object.assign(Ge,Jo.remove(Ge,Le.markerId));let Je=a.coreByProject.historic.sheetsById._ensure(Le.sheetAddress);(Se=Je.sequence)!=null&&Se.markers&&(Je.sequence.markers=Je.sequence.markers.filter(He=>He.id!==Le.markerId))}B.removeMarker=K;function J(Le){var Se;let Ge=W(Le.sheetAddress).byId[Le.markerId];if(Ge!==void 0){Ge.label=Le.label;let Je=a.coreByProject.historic.sheetsById._ensure(Le.sheetAddress);if((Se=Je.sequence)!=null&&Se.markers){let He=Je.sequence.markers.find(Bt=>Bt.id===Le.markerId);He&&(He.label=Le.label)}}}B.updateMarker=J;function oe(Le){let Se=a.studio.historic.projects.stateByProjectId.stateBySheetId._ensure(Le).sequenceEditor;return Se.eventSet||(Se.eventSet=Jo.create()),Se.eventSet}function ae(Le){let Se=oe(Le.sheetAddress),Ge=Le.events.filter(gt=>isFinite(gt.position)?!gt.name||typeof gt.name!="string"?(console.warn("Event filtered out: invalid name",gt),!1):!0:(console.warn("Event filtered out: invalid position",gt),!1)).map(gt=>U(P({},gt),{position:Le.snappingFunction?Le.snappingFunction(gt.position):gt.position})),Je=S1(Ge,"id"),He=Jo.filter(Se,gt=>gt&&!Je[gt.id]),Bt=S1(Object.values(He.byId),"position");Ge.forEach(({position:gt})=>{let it=Bt[gt];it&&(He=Jo.remove(He,it.id))}),Object.assign(Se,Jo.merge([He,Jo.create(Ge.map(gt=>[gt.id,gt]))]));let Qe=a.coreByProject.historic.sheetsById._ensure(Le.sheetAddress);Qe.sequence||(Qe.sequence={type:"PositionalSequence",length:10,subUnitsPerUnit:30,tracksByObject:{}});let Zt=[...Object.values(He.byId).filter(gt=>gt!==void 0),...Ge].sort((gt,it)=>gt.position-it.position);Qe.sequence.events=Zt.map(gt=>({id:gt.id,name:gt.name,position:gt.position,value:gt.value}))}B.replaceEvents=ae;function ue(Le){var Se;let Ge=oe(Le.sheetAddress);Object.assign(Ge,Jo.remove(Ge,Le.eventId));let Je=a.coreByProject.historic.sheetsById._ensure(Le.sheetAddress);(Se=Je.sequence)!=null&&Se.events&&(Je.sequence.events=Je.sequence.events.filter(He=>He.id!==Le.eventId))}B.removeEvent=ue;function xe(Le){var Se;let Ge=oe(Le.sheetAddress).byId[Le.eventId];if(Ge!==void 0){Ge.name=Le.name,Ge.value=Le.value;let Je=a.coreByProject.historic.sheetsById._ensure(Le.sheetAddress);if((Se=Je.sequence)!=null&&Se.events){let He=Je.sequence.events.find(Bt=>Bt.id===Le.eventId);He&&(He.name=Le.name,He.value=Le.value)}}}B.updateEvent=xe;function Re(Le){let Se=a.studio.historic.projects.stateByProjectId.stateBySheetId._ensure(Le).sequenceEditor;return Se.subSequenceSet||(Se.subSequenceSet=Jo.create()),Se.subSequenceSet}function Ae(Le){let Se=Re(Le.sheetAddress),Ge=Le.subSequences.filter(gt=>isFinite(gt.position)?!gt.sheetId||typeof gt.sheetId!="string"?(console.warn("SubSequence filtered out: invalid sheetId",gt),!1):gt.duration!==void 0&&!isFinite(gt.duration)?(console.warn("SubSequence filtered out: invalid duration",gt),!1):gt.timeScale!==void 0&&(!isFinite(gt.timeScale)||gt.timeScale<=0)?(console.warn("SubSequence filtered out: invalid timeScale",gt),!1):!0:(console.warn("SubSequence filtered out: invalid position",gt),!1)).map(gt=>{var it;return U(P({},gt),{position:Le.snappingFunction(gt.position),timeScale:(it=gt.timeScale)!=null?it:1})}),Je=S1(Ge,"id"),He=Jo.filter(Se,gt=>gt&&!Je[gt.id]),Bt=Object.values(He.byId).filter(gt=>gt!==void 0);Ge.forEach(gt=>{var it;let Ce=gt.position,ut=gt.position+((it=gt.duration)!=null?it:0);Bt.forEach(kt=>{var De;let at=kt.position,$t=kt.position+((De=kt.duration)!=null?De:0);Ce<$t&&ut>at&&(He=Jo.remove(He,kt.id))})}),Object.assign(Se,Jo.merge([He,Jo.create(Ge.map(gt=>[gt.id,gt]))]));let Qe=a.coreByProject.historic.sheetsById._ensure(Le.sheetAddress);Qe.sequence||(Qe.sequence={type:"PositionalSequence",length:10,subUnitsPerUnit:30,tracksByObject:{}});let Zt=[...Object.values(He.byId).filter(gt=>gt!==void 0),...Ge].sort((gt,it)=>gt.position-it.position);Qe.sequence.subSequences=Zt.map(gt=>({id:gt.id,sheetId:gt.sheetId,position:gt.position,duration:gt.duration,timeScale:gt.timeScale,label:gt.label}))}B.replaceSubSequences=Ae;function we(Le){var Se;let Ge=Re(Le.sheetAddress);Object.assign(Ge,Jo.remove(Ge,Le.subSequenceId));let Je=a.coreByProject.historic.sheetsById._ensure(Le.sheetAddress);(Se=Je.sequence)!=null&&Se.subSequences&&(Je.sequence.subSequences=Je.sequence.subSequences.filter(He=>He.id!==Le.subSequenceId))}B.removeSubSequence=we;function ft(Le){var Se;let Ge=Re(Le.sheetAddress).byId[Le.subSequenceId];if(Ge!==void 0){Le.updates.position!==void 0&&(Ge.position=Le.updates.position),Le.updates.duration!==void 0&&(Ge.duration=Le.updates.duration),Le.updates.timeScale!==void 0&&(Ge.timeScale=Le.updates.timeScale),Le.updates.label!==void 0&&(Ge.label=Le.updates.label);let Je=a.coreByProject.historic.sheetsById._ensure(Le.sheetAddress);if((Se=Je.sequence)!=null&&Se.subSequences){let He=Je.sequence.subSequences.find(Bt=>Bt.id===Le.subSequenceId);He&&(Le.updates.position!==void 0&&(He.position=Le.updates.position),Le.updates.duration!==void 0&&(He.duration=Le.updates.duration),Le.updates.timeScale!==void 0&&(He.timeScale=Le.updates.timeScale),Le.updates.label!==void 0&&(He.label=Le.updates.label))}}}B.updateSubSequence=ft})(N.sequenceEditor||(N.sequenceEditor={}))})(_.stateBySheetId||(_.stateBySheetId={}))})(g.stateByProjectId||(g.stateByProjectId={}))})(d.projects||(d.projects={}))})(u.historic||(u.historic={})),(d=>{function g(_){A0().ephemeral.showOutline=_}d.setShowOutline=g,(_=>{(T=>{function N(R){let O=A0().ephemeral;return O.projects.stateByProjectId[R.projectId]||(O.projects.stateByProjectId[R.projectId]={stateBySheetId:{}}),O.projects.stateByProjectId[R.projectId]}T._ensure=N,(R=>{function O(B){let V=a.studio.ephemeral.projects.stateByProjectId._ensure(B);return V.stateBySheetId[B.sheetId]||(V.stateBySheetId[B.sheetId]={stateByObjectKey:{}}),V.stateBySheetId[B.sheetId]}R._ensure=O,(B=>{function V(Y){var W;let $=a.studio.ephemeral.projects.stateByProjectId.stateBySheetId._ensure(Y).stateByObjectKey;return $[W=Y.objectKey]!=null||($[W]={}),$[Y.objectKey]}B._ensure=V,(Y=>{function W(K){let J=a.studio.ephemeral.projects.stateByProjectId.stateBySheetId.stateByObjectKey._ensure(K);return J.valuesBeingScrubbed!=null||(J.valuesBeingScrubbed={}),J.valuesBeingScrubbed}Y._ensure=W;function $(K){Do(W(K),K.pathToProp,!0)}Y.flag=$})(B.propsBeingScrubbed||(B.propsBeingScrubbed={}))})(R.stateByObjectKey||(R.stateByObjectKey={}))})(T.stateBySheetId||(T.stateBySheetId={}))})(_.stateByProjectId||(_.stateByProjectId={}))})(d.projects||(d.projects={}))})(u.ephemeral||(u.ephemeral={})),(d=>{function g(O){A0().ahistoric.pinOutline=O}d.setPinOutline=g;function _(O){A0().ahistoric.pinDetails=O}d.setPinDetails=_;function T(O){A0().ahistoric.pinNotifications=O}d.setPinNotifications=T;function N(O){A0().ahistoric.visibilityState=O}d.setVisibilityState=N;function R(O){let B=oG(O.map(W=>W.pathToProp)),V=O.map(({keyframe:W,pathToProp:$})=>({keyframe:W,pathToProp:$.slice(B.length)})),Y=A0();Y.ahistoric.clipboard?Y.ahistoric.clipboard.keyframesWithRelativePaths=V:Y.ahistoric.clipboard={keyframesWithRelativePaths:V}}d.setClipboardKeyframes=R,(O=>{(B=>{function V(Y){let W=A0().ahistoric;return W.projects.stateByProjectId[Y.projectId]||(W.projects.stateByProjectId[Y.projectId]={stateBySheetId:{}}),W.projects.stateByProjectId[Y.projectId]}B._ensure=V,(Y=>{function W(K){let J=a.studio.ahistoric.projects.stateByProjectId._ensure(K);return J.collapsedItemsInOutline||(J.collapsedItemsInOutline={}),J.collapsedItemsInOutline}Y._ensure=W;function $(K){let J=a.studio.ahistoric.projects.stateByProjectId.collapsedItemsInOutline._ensure(K);K.isCollapsed?J[K.itemKey]=!0:delete J[K.itemKey]}Y.set=$})(B.collapsedItemsInOutline||(B.collapsedItemsInOutline={})),(Y=>{function W($){let K=a.studio.ahistoric.projects.stateByProjectId._ensure($);return K.stateBySheetId[$.sheetId]||(K.stateBySheetId[$.sheetId]={}),K.stateBySheetId[$.sheetId]}Y._ensure=W,($=>{function K(J){let oe=a.studio.ahistoric.projects.stateByProjectId.stateBySheetId._ensure(J);return oe.sequence||(oe.sequence={}),oe.sequence}$._ensure=K,(J=>{function oe(ue){a.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence._ensure(ue).focusRange={range:ue.range,enabled:ue.enabled}}J.set=oe;function ae(ue){a.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence._ensure(ue).focusRange=void 0}J.unset=ae})($.focusRange||($.focusRange={})),(J=>{function oe(ae){a.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence._ensure(ae).clippedSpaceRange=P({},ae.range)}J.set=oe})($.clippedSpaceRange||($.clippedSpaceRange={})),(J=>{function oe(ue){let xe=a.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence._ensure(ue),Re=xe.collapsableItems;return Re||(Re=xe.collapsableItems=Jo.create()),Re}function ae(ue){let xe=oe(ue);Object.assign(xe,Jo.add(xe,ue.studioSheetItemKey,{isCollapsed:ue.isCollapsed}))}J.set=ae})($.sequenceEditorCollapsableItems||($.sequenceEditorCollapsableItems={}))})(Y.sequence||(Y.sequence={}))})(B.stateBySheetId||(B.stateBySheetId={}))})(O.stateByProjectId||(O.stateByProjectId={}))})(d.projects||(d.projects={}))})(u.ahistoric||(u.ahistoric={}))})(a.studio||(a.studio={})),(u=>{(d=>{(g=>{function _(T){let N=A0().historic.coreByProject[T.projectId].revisionHistory,R=50;N.unshift(T.revision),N.length>R&&(N.length=R)}g.add=_})(d.revisionHistory||(d.revisionHistory={})),(g=>{function _(R){let O=A0().historic.coreByProject[R.projectId].sheetsById;return O[R.sheetId]||(O[R.sheetId]={staticOverrides:{byObject:{}}}),O[R.sheetId]}g._ensure=_;function T(R){let O=A0().historic.coreByProject[R.projectId].sheetsById[R.sheetId];if(!O)return;delete O.staticOverrides.byObject[R.objectKey];let B=O.sequence;B&&delete B.tracksByObject[R.objectKey]}g.forgetObject=T;function N(R){A0().historic.coreByProject[R.projectId].sheetsById[R.sheetId]&&delete A0().historic.coreByProject[R.projectId].sheetsById[R.sheetId]}g.forgetSheet=N,(R=>{function O(Se){let Ge=a.coreByProject.historic.sheetsById._ensure(Se);return Ge.sequence!=null||(Ge.sequence={subUnitsPerUnit:30,length:10,type:"PositionalSequence",tracksByObject:{}}),Ge.sequence}R._ensure=O;function B(Se){O(Se).length=os(parseFloat(Se.length.toFixed(2)),.01,1/0)}R.setLength=B;function V(Se){O(Se).subUnitsPerUnit=os(Se.subUnitsPerUnit,1,I(2,12))}R.setSubUnitsPerUnit=V;function Y(Se){var Ge;let Je=a.coreByProject.historic.sheetsById.sequence._ensure(Se).tracksByObject;return Je[Ge=Se.objectKey]!=null||(Je[Ge]={trackData:{},trackIdByPropPath:{}}),Je[Se.objectKey]}function W(Se,Ge){let Je=Y(Se),He=Pf(Se.pathToProp);if(typeof Je.trackIdByPropPath[He]=="string")return;let Bt=IIe(),Qe={type:"BasicKeyframedTrack",__debugName:"".concat(Se.objectKey,":").concat(He),keyframes:[]};Je.trackData[Bt]=Qe,Je.trackIdByPropPath[He]=Bt}R.setPrimitivePropAsSequenced=W;function $(Se){let Ge=Y(Se),Je=Pf(Se.pathToProp),He=Ge.trackIdByPropPath[Je];typeof He=="string"&&(delete Ge.trackIdByPropPath[Je],delete Ge.trackData[He],a.coreByProject.historic.sheetsById.staticOverrides.byObject.setValueOfPrimitiveProp(Se))}R.setPrimitivePropAsStatic=$;function K(Se){let Ge=Y(Se);for(let Je of Object.keys(Ge.trackIdByPropPath)){let He=JSON.parse(Je);if(Se.pathToProp.every((Bt,Qe)=>He[Qe]===Bt)){let Bt=Ge.trackIdByPropPath[Je];if(typeof Bt!="string")continue;delete Ge.trackIdByPropPath[Je],delete Ge.trackData[Bt]}}a.coreByProject.historic.sheetsById.staticOverrides.byObject.setValueOfCompoundProp(Se)}R.setCompoundPropAsStatic=K;function J(Se){return Y(Se).trackData[Se.trackId]}function oe(Se){let Ge=J(Se);if(Ge)return Ge.keyframes.find(Je=>Je.id===Se.keyframeId)}function ae(Se){let Ge=Se.snappingFunction(Se.position),Je=J(Se);if(!Je)return;let{keyframes:He}=Je,Bt=He.findIndex(gt=>gt.position===Ge);if(Bt!==-1){let gt=He[Bt];gt.value=Se.value;return}let Qe=TP(He,gt=>gt.position<Ge);if(Qe===-1){He.unshift({id:pie(),position:Ge,connectedRight:!0,handles:Se.handles||[.5,1,.5,0],type:Se.type||"bezier",value:Se.value});return}let Zt=He[Qe];He.splice(Qe+1,0,{id:pie(),position:Ge,connectedRight:Zt.connectedRight,handles:Se.handles||[.5,1,.5,0],type:Se.type||"bezier",value:Se.value})}R.setKeyframeAtPosition=ae;function ue(Se){let Ge=J(Se);if(!Ge)return;let{keyframes:Je}=Ge,He=Je.findIndex(Bt=>Bt.position===Se.position);He!==-1&&Je.splice(He,1)}R.unsetKeyframeAtPosition=ue;function xe(Se){let Ge=J(Se);if(!Ge)return;let Je=Ak(Ge.keyframes).filter(He=>Se.keyframeIds.includes(He.id)).map(He=>{let Bt=He.position,Qe=Se.snappingFunction(qFe(Bt,Se));return U(P({},He),{position:Qe})});Le(U(P({},Se),{keyframes:Je}))}R.transformKeyframes=xe;function Re(Se){let Ge=J(Se);Ge&&(Ge.keyframes=Ge.keyframes.map((Je,He)=>{let Bt=Ge.keyframes[He-1],Qe=Se.keyframeIds.includes(Je.id),Zt=Se.keyframeIds.includes(Bt==null?void 0:Bt.id);return Qe&&!Zt?U(P({},Je),{handles:[Je.handles[0],Je.handles[1],Se.handles[0],Se.handles[1]]}):Qe&&Zt?U(P({},Je),{handles:[Se.handles[2],Se.handles[3],Se.handles[0],Se.handles[1]]}):Zt?U(P({},Je),{handles:[Se.handles[2],Se.handles[3],Je.handles[2],Je.handles[3]]}):Je}))}R.setTweenBetweenKeyframes=Re;function Ae(Se){var Ge,Je,He,Bt,Qe,Zt,gt,it;let Ce=oe(Se);Ce&&(Ce.handles=[(Je=(Ge=Se.end)==null?void 0:Ge[0])!=null?Je:Ce.handles[0],(Bt=(He=Se.end)==null?void 0:He[1])!=null?Bt:Ce.handles[1],(Zt=(Qe=Se.start)==null?void 0:Qe[0])!=null?Zt:Ce.handles[2],(it=(gt=Se.start)==null?void 0:gt[1])!=null?it:Ce.handles[3]])}R.setHandlesForKeyframe=Ae;function we(Se){let Ge=J(Se);Ge&&(Ge.keyframes=Ge.keyframes.filter(Je=>Se.keyframeIds.indexOf(Je.id)===-1))}R.deleteKeyframes=we;function ft(Se){let Ge=oe(Se);Ge&&(Ge.type=Se.keyframeType)}R.setKeyframeType=ft;function Le(Se){let Ge=J(Se);if(!Ge)return;let Je=Ak(Ge.keyframes),He=Se.keyframes.filter(it=>!(typeof it.value=="number"&&!isFinite(it.value)||!it.handles.every(Ce=>isFinite(Ce)))).map(it=>U(P({},it),{position:Se.snappingFunction(it.position)})),Bt=S1(He,"id"),Qe=Je.filter(it=>!Bt[it.id]),Zt=S1(Qe,"position");He.forEach(({position:it})=>{let Ce=Zt[it];Ce&&sr(Qe,Ce)});let gt=ga([...Qe,...He],"position");Ge.keyframes=gt}R.replaceKeyframes=Le})(g.sequence||(g.sequence={})),(R=>{(O=>{function B($){var K;let J=a.coreByProject.historic.sheetsById._ensure($).staticOverrides.byObject;return J[K=$.objectKey]!=null||(J[K]={}),J[$.objectKey]}function V($){let K=B($);Do(K,$.pathToProp,$.value)}O.setValueOfCompoundProp=V;function Y($){let K=B($);Do(K,$.pathToProp,$.value)}O.setValueOfPrimitiveProp=Y;function W($){let K=a.coreByProject.historic.sheetsById._ensure($).staticOverrides.byObject[$.objectKey];K&&_ye(K,$.pathToProp)}O.unsetValueOfPrimitiveProp=W})(R.byObject||(R.byObject={}))})(g.staticOverrides||(g.staticOverrides={}))})(d.sheetsById||(d.sheetsById={}))})(u.historic||(u.historic={}))})(a.coreByProject||(a.coreByProject={}))})(YH||(YH={}));function KH(){let a,u,d=new Promise((_,T)=>{a=N=>{_(N),g.status="resolved"},u=N=>{T(N),g.status="rejected"}}),g={resolve:a,reject:u,promise:d,status:"pending"};return g}var iBe=un();function sBe(a){let u=a.getState(),d=new iBe.Atom(u);return a.subscribe(()=>{let g=a.getState();d.set(g),u=g}),d}_v();function oBe(a){var u,d=a.Symbol;return typeof d=="function"?d.observable?u=d.observable:(u=d("observable"),d.observable=u):u="@@observable",u}var KE;typeof self<"u"?KE=self:typeof window<"u"?KE=window:typeof D0<"u"?KE=D0:KE=s;var aBe=oBe(KE),kye=aBe,Dye={INIT:"@@redux/INIT"};function Oye(a,u,d){var g;if(typeof u=="function"&&typeof d>"u"&&(d=u,u=void 0),typeof d<"u"){if(typeof d!="function")throw new Error("Expected the enhancer to be a function.");return d(Oye)(a,u)}if(typeof a!="function")throw new Error("Expected the reducer to be a function.");var _=a,T=u,N=[],R=N,O=!1;function B(){R===N&&(R=N.slice())}function V(){return T}function Y(J){if(typeof J!="function")throw new Error("Expected listener to be a function.");var oe=!0;return B(),R.push(J),function(){if(oe){oe=!1,B();var ae=R.indexOf(J);R.splice(ae,1)}}}function W(J){if(!u1(J))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(typeof J.type>"u")throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(O)throw new Error("Reducers may not dispatch actions.");try{O=!0,T=_(T,J)}finally{O=!1}for(var oe=N=R,ae=0;ae<oe.length;ae++){var ue=oe[ae];ue()}return J}function $(J){if(typeof J!="function")throw new Error("Expected the nextReducer to be a function.");_=J,W({type:Dye.INIT})}function K(){var J,oe=Y;return J={subscribe:function(ae){if(typeof ae!="object")throw new TypeError("Expected the observer to be an object.");function ue(){ae.next&&ae.next(V())}ue();var xe=oe(ue);return{unsubscribe:xe}}},J[kye]=function(){return this},J}return W({type:Dye.INIT}),g={dispatch:W,subscribe:Y,getState:V,replaceReducer:$},g[kye]=K,g}function lBe(){for(var a=arguments.length,u=Array(a),d=0;d<a;d++)u[d]=arguments[d];return u.length===0?function(g){return g}:u.length===1?u[0]:u.reduce(function(g,_){return function(){return g(_.apply(void 0,arguments))}})}function cBe(a){let u=lBe();return Oye(a.rootReducer,void 0,u)}VI(),P7();var ZH=new WeakMap,uBe=(a,u,d)=>{let g=O=>{a.dispatch(Db.replacePersistentState(O))},_=Lye(d),T=()=>a.getState().$persistent;R();let N=()=>{let O=T(),B=ZH.get(a);O!==B&&(ZH.set(a,O),localStorage.setItem(_,JSON.stringify(O)))};a.subscribe(N7(N,1e3)),window&&window.addEventListener("beforeunload",N);function R(){let O=localStorage.getItem(_);if(O){let B,V=!0;try{B=JSON.parse(O),V=!1}catch{zI.warn("Could not parse Theatre's persisted state. This must be a bug. Please report it.")}finally{V||g(B),u()}}else u()}},dBe=(a,u)=>{let d=Lye(u),g=a.getState().$persistent;localStorage.removeItem(d),ZH.set(a,g)};function Lye(a){return a+".persistent"}var hBe=(a=21)=>{let u="",d=crypto.getRandomValues(new Uint8Array(a));for(;a--;){let g=d[a]&63;g<36?u+=g.toString(36):g<62?u+=(g-26).toString(36).toUpperCase():g<63?u+="_":u+="-"}return u};function pBe(){return hBe(16)}DN(),Wt(),Z0(),c8(),UR();var Rk=un();B4(),b0(),M3e();function QH(a){if(typeof a=="boolean"||typeof a=="string"||typeof a=="number")return a;if(u1(a)){let u={},d=!1;for(let[g,_]of Object.entries(a))QH(_)!==void 0&&(u[g]=_,d=!0);if(d)return u}else return}function Fye(a,u,d){for(let[g,_]of Object.entries(a.props))if(_.type==="compound")Fye(_,[...u,g],d);else{if(_.type==="enum")throw new Error("Not yet implemented");d(_,[...u,g])}}function fBe(a,u,d){return{set:(g,_)=>{a();let T=QH(_);if(typeof T>"u")return;let{root:N,path:R}=(0,Rk.getPointerParts)(g);if(Pt(N)){let O=N.template.getMapOfValidSequenceTracks_forStudio().getValue(),B=cb(N.template.staticConfig,R);if(!B)throw new Error("Object ".concat(N.address.objectKey," does not have a prop at ").concat(JSON.stringify(R)));let V=(Y,W,$)=>{if(Y==null)return;if(QH(W.deserializeAndSanitize(Y))===void 0)throw new Error("Invalid value ".concat(Jj(Y)," for object.props").concat($.map(oe=>"[".concat(JSON.stringify(oe),"]")).join("")," is invalid"));let K=U(P({},N.address),{pathToProp:$}),J=Uu(O,$);if(typeof J=="string"){let oe=N.sheet.getSequence();oe.position=oe.closestGridPosition(oe.position),u.coreByProject.historic.sheetsById.sequence.setKeyframeAtPosition(U(P({},K),{trackId:J,position:oe.position,value:Y,snappingFunction:oe.closestGridPosition,type:"bezier"}))}else u.coreByProject.historic.sheetsById.staticOverrides.byObject.setValueOfPrimitiveProp(U(P({},K),{value:Y}))};if(B.type==="compound"){let Y=(0,Rk.getPointerParts)(g).path,W=Y.length;Fye(B,Y,($,K)=>{let J=K.slice(W),oe=U4(T,J);if(typeof oe<"u")V(oe,$,K);else throw new Error("Property object.props".concat(K.map(ae=>"[".concat(JSON.stringify(ae),"]")).join("")," is required but not provided"))})}else{if(B.type==="enum")throw new Error("Enums aren't implemented yet");V(T,B,R)}}else if(yn(N)){let[O]=R;if(O==="subUnitsPerUnit"){if(typeof T!="number"||!MT(T)||T<1)throw new Error("Value ".concat(T," is not an integer, which is required for setting sequence prop ").concat(O));u.coreByProject.historic.sheetsById.sequence.setSubUnitsPerUnit(U(P({},N.address),{subUnitsPerUnit:T}))}else if(O==="length"){if(typeof T!="number"||T<=.001)throw new Error("Value ".concat(T," is not a positive number, which is required for setting sequence prop ").concat(O));u.coreByProject.historic.sheetsById.sequence.setLength(U(P({},N.address),{length:T}))}else throw new Error("Setting sequence prop ".concat(O," is not supported"))}else throw new Error("Only setting props of SheetObject-s and sequences is supported in a transaction so far")},unset:g=>{a();let{root:_,path:T}=(0,Rk.getPointerParts)(g);if(Pt(_)){let N=_.template.getMapOfValidSequenceTracks_forStudio().getValue(),R=U4(_.template.getDefaultValues().getValue(),T),O=cb(_.template.staticConfig,T),B=(V,Y)=>{let W=U(P({},_.address),{pathToProp:Y}),$=Uu(N,Y);typeof $=="string"?u.coreByProject.historic.sheetsById.sequence.unsetKeyframeAtPosition(U(P({},W),{trackId:$,position:_.sheet.getSequence().positionSnappedToGrid})):O!==void 0&&u.coreByProject.historic.sheetsById.staticOverrides.byObject.unsetValueOfPrimitiveProp(W)};O.type==="compound"?bk(R,(V,Y)=>{B(V,Y)},(0,Rk.getPointerParts)(g).path):B(R,T)}else throw new Error("Only setting props of SheetObject-s is supported in a transaction so far")},get drafts(){return a(),d},get stateEditors(){return u}}}var mBe=class{constructor(){ye(this,"_reduxStore"),ye(this,"_atom"),ye(this,"atomP"),this._reduxStore=cBe({rootReducer:WFe}),this._atom=sBe(this._reduxStore),this.atomP=this._atom.pointer}initialize(a){let u=KH();return a.usePersistentStorage===!0?uBe(this._reduxStore,()=>{this.tempTransaction(({drafts:d})=>{d.ephemeral.initialised=!0}).commit(),u.resolve()},a.persistenceKey):(this.tempTransaction(({drafts:d})=>{d.ephemeral.initialised=!0}).commit(),u.resolve()),u.promise}getState(){return this._reduxStore.getState()}__experimental_clearPersistentStorage(a){return dBe(this._reduxStore,a),this.getState()}__dev_startHistoryFromScratch(a){this._reduxStore.dispatch(Db.historic.startHistoryFromScratch(Db.reduceParts(u=>U(P({},u),{historic:a}))))}tempTransaction(a){let u=$Fe(),d,g=u.push(Db.reduceParts(_=>{let T={historic:WH(_.historic),ahistoric:WH(_.ahistoric),ephemeral:WH(_.ephemeral)},N=!0,R=()=>{if(!N)throw new Error("You seem to have called the transaction api after studio.transaction() has finished running")},O=Iye(T),B=fBe(R,O,T);try{return a(B),N=!1,{historic:qH(T.historic),ahistoric:qH(T.ahistoric),ephemeral:qH(T.ephemeral)}}catch(V){return d=V,_}finally{Iye(void 0)}}));if(this._reduxStore.dispatch(g),d)throw this._reduxStore.dispatch(u.discard()),d;return{commit:()=>{this._reduxStore.dispatch(u.commit())},discard:()=>{this._reduxStore.dispatch(u.discard())}}}undo(){this._reduxStore.dispatch(Db.historic.undo())}redo(){this._reduxStore.dispatch(Db.historic.redo())}createContentOfSaveFile(a){var u,d,g,_;if(!this._reduxStore.getState().$persistent.historic.innerState.coreByProject[a])throw new Error("Project ".concat(a," has not been initialized."));let T=pBe();this.tempTransaction(({stateEditors:B})=>{B.coreByProject.historic.revisionHistory.add({projectId:a,revision:T})}).commit();let N=this._reduxStore.getState().$persistent.historic.innerState.coreByProject[a],R=(u=this._reduxStore.getState().$persistent.historic.innerState.projects)==null?void 0:u.stateByProjectId[a],O=kN(N);if(R!=null&&R.stateBySheetId)for(let[B,V]of Object.entries(R.stateBySheetId)){if((d=V==null?void 0:V.sequenceEditor)!=null&&d.markerSet){let Y=V.sequenceEditor.markerSet;if(Y.allIds&&Object.keys(Y.allIds).length>0){O.sheetsById[B]||(O.sheetsById[B]={staticOverrides:{byObject:{}}});let W=O.sheetsById[B];W&&!W.sequence&&(W.sequence={type:"PositionalSequence",length:10,subUnitsPerUnit:30,tracksByObject:{}});let $=Object.entries(Y.byId).map(([K,J])=>J).filter(K=>K!==void 0).sort((K,J)=>K.position-J.position);W!=null&&W.sequence&&(W.sequence.markers=$)}}if((g=V==null?void 0:V.sequenceEditor)!=null&&g.eventSet){let Y=V.sequenceEditor.eventSet;if(Y.allIds&&Object.keys(Y.allIds).length>0){O.sheetsById[B]||(O.sheetsById[B]={staticOverrides:{byObject:{}}});let W=O.sheetsById[B];W&&!W.sequence&&(W.sequence={type:"PositionalSequence",length:10,subUnitsPerUnit:30,tracksByObject:{}});let $=Object.entries(Y.byId).map(([K,J])=>J).filter(K=>K!==void 0).sort((K,J)=>K.position-J.position);W!=null&&W.sequence&&(W.sequence.events=$)}}if((_=V==null?void 0:V.sequenceEditor)!=null&&_.subSequenceSet){let Y=V.sequenceEditor.subSequenceSet;if(Y.allIds&&Object.keys(Y.allIds).length>0){O.sheetsById[B]||(O.sheetsById[B]={staticOverrides:{byObject:{}}});let W=O.sheetsById[B];W&&!W.sequence&&(W.sequence={type:"PositionalSequence",length:10,subUnitsPerUnit:30,tracksByObject:{}});let $=Object.entries(Y.byId).map(([K,J])=>J).filter(K=>K!==void 0).sort((K,J)=>K.position-J.position);W!=null&&W.sequence&&(W.sequence.subSequences=$)}}}return O}},gBe=un(),JH=class{constructor(){ye(this,"_values",{})}get(a,u){if(this.has(a))return this._values[a];{let d=u();return this._values[a]=d,d}}has(a){return this._values.hasOwnProperty(a)}};Wt(),q7(),Pe(),b0(),Ij();var yBe=class{constructor(a){ye(this,"ui",{hide(){ce().ui.hide()},get isHidden(){return ce().ui.isHidden},restore(){ce().ui.restore()},renderToolset(u,d){return ce().ui.renderToolset(u,d)}}),ye(this,"_cache",new JH),ye(this,"__experimental",{__experimental_disblePlayPauseKeyboardShortcut(){ZOe()},__experimental_enablePlayPauseKeyboardShortcut(){QOe()},__experimental_clearPersistentStorage(u){return ce().clearPersistentStorage(u)},__experimental_createContentOfSaveFileTyped(u){return ce().createContentOfSaveFile(u)}})}initialize(a){return ce().initialize(a)}extend(a,u){ce().extend(a,u)}transaction(a){return ce().transaction(({set:u,unset:d,stateEditors:g})=>a({set:u,unset:d,__experimental_forgetObject:_=>{if(!Ut(_))throw new Error("object in transactionApi.__experimental_forgetObject(object) must be the return type of sheet.object(...)");g.coreByProject.historic.sheetsById.forgetObject(_.address)},__experimental_forgetSheet:_=>{if(!St(_))throw new Error("sheet in transactionApi.__experimental_forgetSheet(sheet) must be the return type of project.sheet()");g.coreByProject.historic.sheetsById.forgetSheet(_.address)}}))}_getSelectionPrism(){return this._cache.get("_getSelectionPrism()",()=>(0,gBe.prism)(()=>ep().filter(a=>a.type==="Theatre_SheetObject"||a.type==="Theatre_Sheet").map(a=>a.publicApi)))}_getSelection(){return this._getSelectionPrism().getValue()}setSelection(a){let u=[...a].filter(d=>Ut(d)||St(d)).map(d=>ce().corePrivateAPI(d));ce().transaction(({stateEditors:d})=>{d.studio.historic.panels.outline.selection.set(u)})}onSelectionChange(a){let u=ce();return this._getSelectionPrism().onChange(u.ticker,a,!0)}get selection(){return this._getSelection()}scrub(){return ce().scrub()}getStudioProject(){let a=ce().core;if(!a)throw new Error("You're calling studio.getStudioProject() before `@tomorrowevening/theatre-core` is loaded. To fix this:\n1. Check if `@tomorrowevening/theatre-core` is import/required in your bundle.\n2. Check the stack trace of this error and make sure the funciton that calls getStudioProject() is run after `@tomorrowevening/theatre-core` is loaded.");return ce().getStudioProject(a)}debouncedScrub(a=1e3){let u,d=N7(()=>{let g=u;g&&(u=void 0,g.commit())},a);return{capture:g=>{u||(u=this.scrub());let _=!0;try{u.capture(g),_=!1}finally{if(_){let T=u;u=void 0,T.discard()}else d()}}}}createPane(a){return ce().paneManager.createPane(a)}destroyPane(a){return ce().paneManager.destroyPane(a)}createContentOfSaveFile(a){return ce().createContentOfSaveFile(a)}};hie();var Q8=un(),vBe=class{constructor(a){this._studio=a,ye(this,"_cache",new JH),this._instantiatePanesAsTheyComeIn()}_instantiatePanesAsTheyComeIn(){let a=this._getAllPanes();a.onStale(()=>{a.getValue()})}_getAllPanes(){return this._cache.get("_getAllPanels()",()=>(0,Q8.prism)(()=>{if(!(0,Q8.val)(this._studio.coreP))return{};let a=(0,Q8.val)(this._studio.atomP.historic.panelInstanceDesceriptors),u=(0,Q8.val)(this._studio.atomP.ephemeral.extensions.paneClasses),d={};for(let g of Object.values(a)){if(!g)continue;let _=u[g.paneClass];if(!_)continue;let{instanceId:T}=g,{extensionId:N,classDefinition:R}=_,O=Q8.prism.memo("instance-".concat(g.instanceId),()=>({extensionId:N,instanceId:T,definition:R}),[R]);d[T]=O}return d}))}get allPanesD(){return this._getAllPanes()}createPane(a){if(!this._studio.core)throw new Error("Can't create a pane because @tomorrowevening/theatre-core is not yet loaded");let u=(0,Q8.val)(this._studio.atomP.ephemeral.extensions.paneClasses[a].extensionId),d=(0,Q8.val)(this._studio.atomP.historic.panelInstanceDesceriptors),g;for(let _=1;_<1e3&&(g="".concat(a," #").concat(_),!!d[g]);_++);if(!u)throw new Error('Pane class "'.concat(a,'" is not registered.'));return this._studio.transaction(({drafts:_})=>{_.historic.panelInstanceDesceriptors[g]={instanceId:g,paneClass:a},_.historic.paneFocusOrder||(_.historic.paneFocusOrder=[]);let T=_.historic.paneFocusOrder,N=T.indexOf(g);N!==-1&&T.splice(N,1),T.push(g)}),this._getAllPanes().getValue()[g]}destroyPane(a){if(!this._studio.core)throw new Error("Can't do this yet because @tomorrowevening/theatre-core is not yet loaded");this._studio.transaction(({drafts:u})=>{if(delete u.historic.panelInstanceDesceriptors[a],u.historic.paneFocusOrder){let d=u.historic.paneFocusOrder.indexOf(a);d!==-1&&u.historic.paneFocusOrder.splice(d,1)}})}bringPaneToFront(a){this._studio.transaction(({drafts:u})=>{u.historic.paneFocusOrder||(u.historic.paneFocusOrder=[]);let d=u.historic.paneFocusOrder,g=d.indexOf(a);g!==-1&&d.splice(g,1),d.push(a)})}},Ik=un();Pe();var Bye=30*60*1e3,xBe=1e3*60*60;function bBe(){return Me(this,null,function*(){let a=ce().atomP.ahistoric.visibilityState;if((0,Ik.val)(a)==="everythingIsVisible")return;let u=KH(),d=(0,Ik.pointerToPrism)(a).onStale(()=>{(0,Ik.val)(a)==="everythingIsVisible"&&(d(),u.resolve(void 0))});return u.promise})}function _Be(){return Me(this,null,function*(){if(!"1.0.19".match(/COMPAT/))for(yield kk(500),yield bBe();;){let a=(0,Ik.val)(ce().atomP.ahistoric.updateChecker);if(a&&a.result!=="error"){let u=a.lastChecked,d=Date.now(),g=Math.abs(d-u);g<Bye&&(yield kk(Bye-g))}try{let u=yield fetch(new Request("https://updates.theatrejs.com/updates/1.0.19"));if(u.ok){let d=yield u.json();if(!SBe(d))throw new Error("Bad response");ce().transaction(({drafts:g})=>{g.ahistoric.updateChecker={lastChecked:Date.now(),result:P({},d)}}),yield kk(1e3)}else throw new Error("HTTP Error ".concat(u.statusText))}catch{yield kk(xBe)}}})}var kk=a=>new Promise(u=>setTimeout(u,a));function SBe(a){if(typeof a!="object")return!1;let u=a;return typeof u.hasUpdates!="boolean"?!1:u.hasUpdates===!0&&typeof u.newVersion=="string"&&typeof u.releasePage=="string"||u.hasUpdates===!1}var wBe=z(zJ());function u3(a){return new Promise((u,d)=>{a.oncomplete=a.onsuccess=()=>u(a.result),a.onabort=a.onerror=()=>d(a.error)})}function Uye(a,u){let d=indexedDB.open(a);d.onupgradeneeded=()=>d.result.createObjectStore(u);let g=u3(d);return(_,T)=>g.then(N=>T(N.transaction(u,_).objectStore(u)))}var e$;function Fb(){return e$||(e$=Uye("keyval-store","keyval")),e$}function TBe(a,u=Fb()){return u("readonly",d=>u3(d.get(a)))}function EBe(a,u,d=Fb()){return d("readwrite",g=>(g.put(u,a),u3(g.transaction)))}function MBe(a,u=Fb()){return u("readwrite",d=>(d.delete(a),u3(d.transaction)))}function t$(a,u){return a.openCursor().onsuccess=function(){this.result&&(u(this.result),this.result.continue())},u3(a.transaction)}function CBe(a=Fb()){return a("readonly",u=>{if(u.getAllKeys)return u3(u.getAllKeys());let d=[];return t$(u,g=>d.push(g.key)).then(()=>d)})}function ABe(a=Fb()){return a("readonly",u=>{if(u.getAll)return u3(u.getAll());let d=[];return t$(u,g=>d.push(g.value)).then(()=>d)})}function NBe(a=Fb()){return a("readonly",u=>{if(u.getAll&&u.getAllKeys)return Promise.all([u3(u.getAllKeys()),u3(u.getAll())]).then(([g,_])=>g.map((T,N)=>[T,_[N]]));let d=[];return a("readonly",g=>t$(g,_=>d.push([_.key,_.value])).then(()=>d))})}var PBe=a=>{let u=Uye("theatrejs-".concat(a),"default-store");return{set:(d,g)=>EBe(d,g,u),get:d=>TBe(d,u),del:d=>MBe(d,u),keys:()=>CBe(u),entries:()=>NBe(u),values:()=>ABe(u)}},RBe=un();function zye(a,u){var d;let g=Object.values((d=(0,RBe.val)(a.pointers.historic.sheetsById))!=null?d:{}),_=g.flatMap(N=>{var R;return Object.values((R=N==null?void 0:N.staticOverrides.byObject)!=null?R:{})}).flatMap(N=>Object.values(N??{})),T=[...g.flatMap(N=>{var R,O;return Object.values((O=(R=N==null?void 0:N.sequence)==null?void 0:R.tracksByObject)!=null?O:{})}).flatMap(N=>{var R;return Object.values((R=N==null?void 0:N.trackData)!=null?R:{})}).flatMap(N=>N==null?void 0:N.keyframes).map(N=>N==null?void 0:N.value)];return _.forEach(N=>{bk(N,R=>{T.push(R)},[])}),T.filter(N=>(N==null?void 0:N.type)&&typeof(N==null?void 0:N.type)=="string").map(N=>N.id).filter((N,R,O)=>N!==null&&N!==""&&O.indexOf(N)===R)}SH();var Vye="theatre-0.4",IBe=`You seem to have imported '@tomorrowevening/theatre-studio' but haven't initialized it. You can initialize the studio by:
\`\`\`
import studio from '@tomorrowevening/theatre-studio'
studio.initialize()
\`\`\`

* If you didn't mean to import '@tomorrowevening/theatre-studio', this means that your bundler is not tree-shaking it. This is most likely a bundler misconfiguration.

* If you meant to import '@tomorrowevening/theatre-studio' without showing its UI, you can do that by running:

\`\`\`
import studio from '@tomorrowevening/theatre-studio'
studio.initialize()
studio.ui.hide()
\`\`\`
`,kBe="You seem to have imported '@tomorrowevening/theatre-studio' but called `studio.initialize()` after some delay.\nTheatre.js projects remain in pending mode (won't play their sequences) until the studio is initialized, so you should place the `studio.initialize()` line right after the import line:\n\n```\nimport studio from '@tomorrowevening/theatre-studio'\n// ... and other imports\n\nstudio.initialize()\n```\n",DBe=class{constructor(){ye(this,"ui"),ye(this,"publicApi"),ye(this,"address"),ye(this,"_projectsProxy",new _k.PointerProxy(new _k.Atom({}).pointer)),ye(this,"projectsP",this._projectsProxy.pointer),ye(this,"_store",new mBe),ye(this,"_corePrivateApi"),ye(this,"_cache",new JH),ye(this,"paneManager"),ye(this,"_coreAtom",new _k.Atom({})),ye(this,"_initializedDeferred",KH()),ye(this,"_initializeFnCalled",!1),ye(this,"_didWarnAboutNotInitializing",!1),ye(this,"_coreBits"),ye(this,"_rafDriver"),this.address={studioId:rb(10)},this.publicApi=new yBe(this),this.ui=new TFe(this),this._attachToIncomingProjects(),this.paneManager=new vBe(this),typeof window<"u"&&setTimeout(()=>{this._initializeFnCalled||(console.error(IBe),this._didWarnAboutNotInitializing=!0)},100)}get ticker(){if(!this._rafDriver)throw new Error("`studio.ticker` was read before studio.initialize() was called.");return this._rafDriver.ticker}get atomP(){return this._store.atomP}initialize(a){return Me(this,null,function*(){if(!this._coreBits)throw new Error("You seem to have imported `@tomorrowevening/theatre-studio` without importing `@tomorrowevening/theatre-core`. Make sure to include an import of `@tomorrowevening/theatre-core` before calling `studio.initializer()`.");if(this._initializeFnCalled)return this._initializedDeferred.promise;this._initializeFnCalled=!0,this._didWarnAboutNotInitializing&&console.warn(kBe);let u={persistenceKey:Vye,usePersistentStorage:!0};if(typeof(a==null?void 0:a.persistenceKey)=="string"&&(u.persistenceKey=a.persistenceKey),((a==null?void 0:a.usePersistentStorage)===!1||typeof window>"u")&&(u.usePersistentStorage=!1),a!=null&&a.__experimental_rafDriver){if(a.__experimental_rafDriver.type!=="Theatre_RafDriver_PublicAPI")throw new Error("parameter `rafDriver` in `studio.initialize({__experimental_rafDriver})` must be either be undefined, or the return type of core.createRafDriver()");let d=this._coreBits.privateAPI(a.__experimental_rafDriver);if(!d)throw new Error("parameter `rafDriver` in `studio.initialize({__experimental_rafDriver})` seems to come from a different version of `@tomorrowevening/theatre-core` than the version that is attached to `@tomorrowevening/theatre-studio`");this._rafDriver=d}else this._rafDriver=this._coreBits.getCoreRafDriver();try{yield this._store.initialize(u)}catch(d){this._initializedDeferred.reject(d);return}typeof window<"u"&&(yield this.ui.ready),this._initializedDeferred.resolve(),this.ui.render(),_Be().catch(d=>{console.error(d)})})}get initialized(){return this._initializedDeferred.promise}_attachToIncomingProjects(){let a=(0,_k.pointerToPrism)(this.projectsP),u=d=>{for(let g of Object.values(d))g.isAttachedToStudio||g.attachToStudio(this)};a.onStale(()=>{u(a.getValue())}),u(a.getValue())}setCoreBits(a){this._coreBits=a,this._corePrivateApi=a.privateAPI,this._coreAtom.setByPointer(u=>u.core,a.coreExports),this._setProjectsP(a.projectsP)}_setProjectsP(a){this._projectsProxy.setPointer(a)}scrub(){return new SFe(this)}tempTransaction(a){return this._store.tempTransaction(a)}transaction(a){return this.tempTransaction(a).commit()}__dev_startHistoryFromScratch(a){return this._store.__dev_startHistoryFromScratch(a)}get corePrivateAPI(){return this._corePrivateApi}get core(){return this._coreAtom.get().core}get coreP(){return this._coreAtom.pointer.core}extend(a,u){if(!a||typeof a!="object")throw new Error("Extensions must be JS objects");if(typeof a.id!="string")throw new Error("extension.id must be a string");let d=(u==null?void 0:u.__experimental_reconfigure)===!0,g=a.id,_=this._store.getState().ephemeral.extensions.byId[g];if(_&&!d){if(a===_||(0,wBe.default)(a,_))return;throw new Error('Extension id "'.concat(a.id,'" is already defined. If you mean to re-configure the extension, do it like this: studio.extend(extension, {__experimental_reconfigure: true})})'))}this.transaction(({drafts:T})=>{var N,R;T.ephemeral.extensions.byId[a.id]=a;let O=T.ephemeral.extensions.paneClasses;d&&_&&((N=_.panes)==null||N.forEach(B=>{delete O[B.class]})),(R=a.panes)==null||R.forEach(B=>{if(typeof B.class!="string")throw new Error("pane.class must be a string");if(B.class.length<3)throw new Error("pane.class should be a string with 3 or more characters");let V=O[B.class];if(V)if(d&&V.extensionId===a.id)console.warn('Pane class "'.concat(B.class,'" already exists. This is a bug in Theatre.js. Please report it at https://github.com/theatre-js/theatre/issues/new'));else throw new Error('Pane class "'.concat(B.class,'" already exists and is supplied by extension ').concat(V));O[B.class]={extensionId:a.id,classDefinition:B}})})}getStudioProject(a){return this._cache.get("getStudioProject",()=>a.getProject("Studio"))}getExtensionSheet(a,u){return this._cache.get("extensionSheet-"+a,()=>this.getStudioProject(u).sheet("Extension "+a))}undo(){this._store.undo()}redo(){this._store.redo()}createContentOfSaveFile(a){return this._store.createContentOfSaveFile(a)}createAssetStorage(a,u){return Me(this,null,function*(){if(typeof window>"u")return{getAssetUrl:()=>"",createAsset:()=>Promise.resolve(null)};if(!("indexedDB"in window))return console.log("This browser doesn't support IndexedDB."),{getAssetUrl:B=>{throw new Error("IndexedDB is required by the default asset manager, but it's not supported by this browser. To use assets, please provide your own asset manager to the project config.")},createAsset:B=>{throw new Error("IndexedDB is required by the default asset manager, but it's not supported by this browser. To use assets, please provide your own asset manager to the project config.")}};let d=PBe("".concat(a.address.projectId,"-assets")),g=zye(a),_=yield d.keys();yield Promise.all(_.map(B=>Me(this,null,function*(){g.includes(B)||(yield d.del(B))}))),yield Promise.all(_.map(B=>Me(this,null,function*(){var V,Y;let W="".concat(u,"/").concat(B);try{(yield fetch(W,{method:"HEAD"})).ok&&(yield d.del(B))}catch{gk.error("Failed to access assets","Failed to access assets at ".concat((Y=(V=a.config.assets)==null?void 0:V.baseUrl)!=null?Y:"/",". This is likely due to a CORS issue."))}})));let T=new Map(yield d.entries()),N=new Map,R=B=>{if(N.has(B))return N.get(B);{let V=URL.createObjectURL(B);return N.set(B,V),V}},O=B=>{let V=T.get(B);if(!V)throw new Error("Asset with id ".concat(B," not found"));return R(V)};return{getAssetUrl:B=>T.has(B)?O(B):"".concat(u,"/").concat(B),createAsset:B=>Me(this,null,function*(){var V,Y,W;let $=zye(a),K=!1;if($.includes(B.name)){let J;try{J=(V=T.get(B.name))!=null?V:yield fetch("".concat(u,"/").concat(B.name)).then(oe=>oe.ok?oe.blob():void 0)}catch{return gk.error("Failed to access assets","Failed to access assets at ".concat((W=(Y=a.config.assets)==null?void 0:Y.baseUrl)!=null?W:"/",". This is likely due to a CORS issue.")),Promise.resolve(null)}if(J){if(K=yield(yield Promise.resolve().then(()=>z(vFe()))).default.isEqual(B,J),K)return B.name;{let oe=ae=>{let ue=prompt(ae,B.name);return ue===null?!1:ue===""?oe("Asset name cannot be empty. Please choose a different file name for this asset."):$.includes(ue)?(console.log($),oe("An asset with this name already exists. Please choose a different file name for this asset.")):(B=new File([B],ue,{type:B.type}),!0)};if(!oe("An asset with this name already exists. Please choose a different file name for this asset."))return null}}}return T.set(B.name,B),yield d.set(B.name,B),B.name})}})}clearPersistentStorage(a=Vye){this._store.__experimental_clearPersistentStorage(a)}},n$="__TheatreJS_StudioBundle",OBe="__TheatreJS_CoreBundle",LBe="__TheatreJS_Notifications",FBe=class{constructor(a){this._studio=a,ye(this,"_coreBundle")}get type(){return"Theatre_StudioBundle"}registerCoreBundle(a){if(this._coreBundle)throw new Error("StudioBundle.coreBundle is already registered. This is a bug.");this._coreBundle=a;let u;a.getBitsForStudio(this._studio,d=>{u=d}),this._studio.setCoreBits(u)}},BBe=z(nt());tn();var Gye,UBe=ge.div(Gye||(Gye=H([""]))),zBe=a=>BBe.default.createElement(UBe,null),VBe=zBe;SH();var r$=new DBe;Ie(r$);var GBe=r$.publicApi,jBe=GBe;HBe();function HBe(){if(typeof window>"u")return;let a=window[n$];if(typeof a<"u")throw typeof a=="object"&&a&&typeof a.version=="string"?new Error(`It seems that the module '@tomorrowevening/theatre-studio' is loaded more than once. This could have two possible causes:
1. You might have two separate versions of Theatre.js in node_modules.
2. Or this might be a bundling misconfiguration, in case you're using a bundler like Webpack/ESBuild/Rollup.

Note that it **is okay** to import '@tomorrowevening/theatre-studio' multiple times. But those imports should point to the same module.`):new Error("The variable window.".concat(n$," seems to be already set by a module other than @tomorrowevening/theatre-core."));let u=new FBe(r$);window[n$]=u;let d=window[OBe];d&&d!==null&&d.type==="Theatre_CoreBundle"&&u.registerCoreBundle(d)}typeof window<"u"&&(window[LBe]={notify:gk});/*! Bundled license information:

		lodash-es/lodash.js:
		  (**
		   * @license
		   * Lodash (Custom Build) <https://lodash.com/>
		   * Build: `lodash modularize exports="es" -o ./`
		   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
		   * Released under MIT license <https://lodash.com/license>
		   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
		   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
		   *)

		queue-microtask/index.js:
		  (*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

		react/cjs/react.production.min.js:
		  (**
		   * @license React
		   * react.production.min.js
		   *
		   * Copyright (c) Facebook, Inc. and its affiliates.
		   *
		   * This source code is licensed under the MIT license found in the
		   * LICENSE file in the root directory of this source tree.
		   *)

		scheduler/cjs/scheduler.production.min.js:
		  (**
		   * @license React
		   * scheduler.production.min.js
		   *
		   * Copyright (c) Facebook, Inc. and its affiliates.
		   *
		   * This source code is licensed under the MIT license found in the
		   * LICENSE file in the root directory of this source tree.
		   *)

		react-dom/cjs/react-dom.production.min.js:
		  (**
		   * @license React
		   * react-dom.production.min.js
		   *
		   * Copyright (c) Facebook, Inc. and its affiliates.
		   *
		   * This source code is licensed under the MIT license found in the
		   * LICENSE file in the root directory of this source tree.
		   *)

		react-is/cjs/react-is.production.min.js:
		  (** @license React v17.0.2
		   * react-is.production.min.js
		   *
		   * Copyright (c) Facebook, Inc. and its affiliates.
		   *
		   * This source code is licensed under the MIT license found in the
		   * LICENSE file in the root directory of this source tree.
		   *)

		react-is/cjs/react-is.production.min.js:
		  (** @license React v16.13.1
		   * react-is.production.min.js
		   *
		   * Copyright (c) Facebook, Inc. and its affiliates.
		   *
		   * This source code is licensed under the MIT license found in the
		   * LICENSE file in the root directory of this source tree.
		   *)

		jiff/lib/lcs.js:
		  (** @license MIT License (c) copyright 2010-2014 original author or authors *)

		jiff/lib/array.js:
		  (** @license MIT License (c) copyright 2010-2014 original author or authors *)

		jiff/lib/jsonPointerParse.js:
		  (** @license MIT License (c) copyright 2010-2014 original author or authors *)

		jiff/lib/jsonPointer.js:
		  (** @license MIT License (c) copyright 2010-2014 original author or authors *)

		jiff/lib/clone.js:
		  (** @license MIT License (c) copyright 2010-2014 original author or authors *)

		jiff/lib/jsonPatch.js:
		  (** @license MIT License (c) copyright 2010-2014 original author or authors *)

		jiff/jiff.js:
		  (** @license MIT License (c) copyright 2010-2014 original author or authors *)
		*/}(SC,SC.exports)),SC.exports}var Qze=Zze();const P_e=A_e(Qze);/**
 * @license
 * Copyright 2010-2026 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const fx="183",fS={ROTATE:0,DOLLY:1,PAN:2},lS={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},R_e=0,wY=1,I_e=2,Jze=0,mS=1,k_e=2,mg=3,Mc=0,bs=1,oa=2,El=0,L0=1,U3=2,z3=3,V3=4,Jy=5,PK=6,i0=100,HF=101,$F=102,RK=103,IK=104,im=200,UA=201,zA=202,VA=203,h5=204,p5=205,GA=206,jA=207,HA=208,$A=209,WF=210,kK=211,DK=212,OK=213,LK=214,aA=0,lA=1,cA=2,f5=3,uA=4,dA=5,hA=6,pA=7,WA=0,D_e=1,O_e=2,Ta=0,qF=1,XF=2,YF=3,KF=4,FK=5,ZF=6,QF=7,H8e="attached",eVe="detached",G6=300,fm=301,Eg=302,K6=303,gS=304,sx=306,vh=1e3,zo=1001,ox=1002,Yi=1003,BK=1004,G3=1005,ds=1006,yS=1007,fd=1008,tVe=1008,yo=1009,Z6=1010,Q6=1011,um=1012,r0=1013,Ds=1014,vo=1015,ro=1016,JF=1017,eB=1018,gh=1020,tB=35902,nB=35899,UK=1021,qA=1022,io=1023,B0=1026,_u=1027,mw=1028,gw=1029,Su=1030,yw=1031,nVe=1032,vw=1033,e5=33776,t5=33777,n5=33778,r5=33779,fA=35840,mA=35841,gA=35842,yA=35843,MS=36196,CS=37492,AS=37496,NS=37488,PS=37489,ax=37490,RS=37491,IS=37808,kS=37809,DS=37810,OS=37811,LS=37812,FS=37813,BS=37814,US=37815,zS=37816,VS=37817,GS=37818,jS=37819,HS=37820,$S=37821,WS=36492,TY=36494,EY=36495,qS=36283,XS=36284,lx=36285,YS=36286,rVe=2200,iVe=2201,sVe=2202,aF=2300,MY=2301,YW=2302,$8e=2303,cS=2400,uS=2401,lF=2402,zK=2500,oVe=2501,aVe=3200,yg=0,L_e=1,gu="",Is="srgb",vd="srgb-linear",KS="linear",Yn="srgb",KW="",F_e="rg",lVe="ga",cVe=0,R6=7680,uVe=7681,dVe=7682,hVe=7683,pVe=34055,fVe=34056,mVe=5386,gVe=512,yVe=513,vVe=514,xVe=515,bVe=516,_Ve=517,SVe=518,CY=519,VK=512,rB=513,GK=514,mx=515,jK=516,HK=517,gx=518,$K=519,ZS=35044,vA=35048,AY="300 es",Tc=2e3,xh=2001,md={COMPUTE:"compute",RENDER:"render"},i5={TEXTURE_COMPARE:"depthTextureCompare"};function wVe(s){for(let e=s.length-1;e>=0;--e)if(s[e]>=65535)return!0;return!1}function xA(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function bA(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}function B_e(){const s=bA("canvas");return s.style.display="block",s}const W8e={};let cx=null;function TVe(s){cx=s}function _A(...s){const e="THREE."+s.shift();cx?cx("log",e,...s):console.log(e,...s)}function U_e(s){const e=s[0];if(typeof e=="string"&&e.startsWith("TSL:")){const t=s[1];t&&t.isStackTrace?s[0]+=" "+t.getLocation():s[1]='Stack trace not available. Enable "THREE.Node.captureStackTrace" to capture stack traces.'}return s}function qt(...s){s=U_e(s);const e="THREE."+s.shift();if(cx)cx("warn",e,...s);else{const t=s[0];t&&t.isStackTrace?console.warn(t.getError(e)):console.warn(e,...s)}}function Ht(...s){s=U_e(s);const e="THREE."+s.shift();if(cx)cx("error",e,...s);else{const t=s[0];t&&t.isStackTrace?console.error(t.getError(e)):console.error(e,...s)}}function es(...s){const e=s.join(" ");e in W8e||(W8e[e]=!0,qt(...s))}function EVe(s,e,t){return new Promise(function(n,r){function i(){switch(s.clientWaitSync(e,s.SYNC_FLUSH_COMMANDS_BIT,0)){case s.WAIT_FAILED:r();break;case s.TIMEOUT_EXPIRED:setTimeout(i,t);break;default:n()}}setTimeout(i,t)})}const WK={[aA]:lA,[cA]:hA,[uA]:pA,[f5]:dA,[lA]:aA,[hA]:cA,[pA]:uA,[dA]:f5};let _d=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const r=n[e];if(r!==void 0){const i=r.indexOf(t);i!==-1&&r.splice(i,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let i=0,o=r.length;i<o;i++)r[i].call(this,e);e.target=null}}};const gc=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let q8e=1234567;const BC=Math.PI/180,ux=180/Math.PI;function dm(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(gc[s&255]+gc[s>>8&255]+gc[s>>16&255]+gc[s>>24&255]+"-"+gc[e&255]+gc[e>>8&255]+"-"+gc[e>>16&15|64]+gc[e>>24&255]+"-"+gc[t&63|128]+gc[t>>8&255]+"-"+gc[t>>16&255]+gc[t>>24&255]+gc[n&255]+gc[n>>8&255]+gc[n>>16&255]+gc[n>>24&255]).toLowerCase()}function xi(s,e,t){return Math.max(e,Math.min(t,s))}function qK(s,e){return(s%e+e)%e}function MVe(s,e,t,n,r){return n+(s-e)*(r-n)/(t-e)}function CVe(s,e,t){return s!==e?(t-s)/(e-s):0}function UC(s,e,t){return(1-t)*s+t*e}function AVe(s,e,t,n){return UC(s,e,1-Math.exp(-t*n))}function NVe(s,e=1){return e-Math.abs(qK(s,e*2)-e)}function PVe(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*(3-2*s))}function RVe(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*s*(s*(s*6-15)+10))}function IVe(s,e){return s+Math.floor(Math.random()*(e-s+1))}function kVe(s,e){return s+Math.random()*(e-s)}function DVe(s){return s*(.5-Math.random())}function OVe(s){s!==void 0&&(q8e=s);let e=q8e+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function LVe(s){return s*BC}function FVe(s){return s*ux}function BVe(s){return(s&s-1)===0&&s!==0}function UVe(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function zVe(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function VVe(s,e,t,n,r){const i=Math.cos,o=Math.sin,l=i(t/2),c=o(t/2),h=i((e+n)/2),m=o((e+n)/2),y=i((e-n)/2),b=o((e-n)/2),w=i((n-e)/2),A=o((n-e)/2);switch(r){case"XYX":s.set(l*m,c*y,c*b,l*h);break;case"YZY":s.set(c*b,l*m,c*y,l*h);break;case"ZXZ":s.set(c*y,c*b,l*m,l*h);break;case"XZX":s.set(l*m,c*A,c*w,l*h);break;case"YXY":s.set(c*w,l*m,c*A,l*h);break;case"ZYZ":s.set(c*A,c*w,l*m,l*h);break;default:qt("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function yu(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function vi(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const t0={DEG2RAD:BC,RAD2DEG:ux,generateUUID:dm,clamp:xi,euclideanModulo:qK,mapLinear:MVe,inverseLerp:CVe,lerp:UC,damp:AVe,pingpong:NVe,smoothstep:PVe,smootherstep:RVe,randInt:IVe,randFloat:kVe,randFloatSpread:DVe,seededRandom:OVe,degToRad:LVe,radToDeg:FVe,isPowerOfTwo:BVe,ceilPowerOfTwo:UVe,floorPowerOfTwo:zVe,setQuaternionFromProperEuler:VVe,normalize:vi,denormalize:yu};let Ln=class z_e{constructor(e=0,t=0){z_e.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=xi(this.x,e.x,t.x),this.y=xi(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=xi(this.x,e,t),this.y=xi(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(xi(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(xi(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},vs=class{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,o,l){let c=n[r+0],h=n[r+1],m=n[r+2],y=n[r+3],b=i[o+0],w=i[o+1],A=i[o+2],I=i[o+3];if(y!==I||c!==b||h!==w||m!==A){let D=c*b+h*w+m*A+y*I;D<0&&(b=-b,w=-w,A=-A,I=-I,D=-D);let P=1-l;if(D<.9995){const U=Math.acos(D),j=Math.sin(U);P=Math.sin(P*U)/j,l=Math.sin(l*U)/j,c=c*P+b*l,h=h*P+w*l,m=m*P+A*l,y=y*P+I*l}else{c=c*P+b*l,h=h*P+w*l,m=m*P+A*l,y=y*P+I*l;const U=1/Math.sqrt(c*c+h*h+m*m+y*y);c*=U,h*=U,m*=U,y*=U}}e[t]=c,e[t+1]=h,e[t+2]=m,e[t+3]=y}static multiplyQuaternionsFlat(e,t,n,r,i,o){const l=n[r],c=n[r+1],h=n[r+2],m=n[r+3],y=i[o],b=i[o+1],w=i[o+2],A=i[o+3];return e[t]=l*A+m*y+c*w-h*b,e[t+1]=c*A+m*b+h*y-l*w,e[t+2]=h*A+m*w+l*b-c*y,e[t+3]=m*A-l*y-c*b-h*w,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,i=e._z,o=e._order,l=Math.cos,c=Math.sin,h=l(n/2),m=l(r/2),y=l(i/2),b=c(n/2),w=c(r/2),A=c(i/2);switch(o){case"XYZ":this._x=b*m*y+h*w*A,this._y=h*w*y-b*m*A,this._z=h*m*A+b*w*y,this._w=h*m*y-b*w*A;break;case"YXZ":this._x=b*m*y+h*w*A,this._y=h*w*y-b*m*A,this._z=h*m*A-b*w*y,this._w=h*m*y+b*w*A;break;case"ZXY":this._x=b*m*y-h*w*A,this._y=h*w*y+b*m*A,this._z=h*m*A+b*w*y,this._w=h*m*y-b*w*A;break;case"ZYX":this._x=b*m*y-h*w*A,this._y=h*w*y+b*m*A,this._z=h*m*A-b*w*y,this._w=h*m*y+b*w*A;break;case"YZX":this._x=b*m*y+h*w*A,this._y=h*w*y+b*m*A,this._z=h*m*A-b*w*y,this._w=h*m*y-b*w*A;break;case"XZY":this._x=b*m*y-h*w*A,this._y=h*w*y-b*m*A,this._z=h*m*A+b*w*y,this._w=h*m*y+b*w*A;break;default:qt("Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],o=t[1],l=t[5],c=t[9],h=t[2],m=t[6],y=t[10],b=n+l+y;if(b>0){const w=.5/Math.sqrt(b+1);this._w=.25/w,this._x=(m-c)*w,this._y=(i-h)*w,this._z=(o-r)*w}else if(n>l&&n>y){const w=2*Math.sqrt(1+n-l-y);this._w=(m-c)/w,this._x=.25*w,this._y=(r+o)/w,this._z=(i+h)/w}else if(l>y){const w=2*Math.sqrt(1+l-n-y);this._w=(i-h)/w,this._x=(r+o)/w,this._y=.25*w,this._z=(c+m)/w}else{const w=2*Math.sqrt(1+y-n-l);this._w=(o-r)/w,this._x=(i+h)/w,this._y=(c+m)/w,this._z=.25*w}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(xi(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,o=e._w,l=t._x,c=t._y,h=t._z,m=t._w;return this._x=n*m+o*l+r*h-i*c,this._y=r*m+o*c+i*l-n*h,this._z=i*m+o*h+n*c-r*l,this._w=o*m-n*l-r*c-i*h,this._onChangeCallback(),this}slerp(e,t){let n=e._x,r=e._y,i=e._z,o=e._w,l=this.dot(e);l<0&&(n=-n,r=-r,i=-i,o=-o,l=-l);let c=1-t;if(l<.9995){const h=Math.acos(l),m=Math.sin(h);c=Math.sin(c*h)/m,t=Math.sin(t*h)/m,this._x=this._x*c+n*t,this._y=this._y*c+r*t,this._z=this._z*c+i*t,this._w=this._w*c+o*t,this._onChangeCallback()}else this._x=this._x*c+n*t,this._y=this._y*c+r*t,this._z=this._z*c+i*t,this._w=this._w*c+o*t,this.normalize();return this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),i*Math.sin(t),i*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},be=class V_e{constructor(e=0,t=0,n=0){V_e.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(X8e.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(X8e.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,l=e.z,c=e.w,h=2*(o*r-l*n),m=2*(l*t-i*r),y=2*(i*n-o*t);return this.x=t+c*h+o*y-l*m,this.y=n+c*m+l*h-i*y,this.z=r+c*y+i*m-o*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=xi(this.x,e.x,t.x),this.y=xi(this.y,e.y,t.y),this.z=xi(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=xi(this.x,e,t),this.y=xi(this.y,e,t),this.z=xi(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(xi(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,o=t.x,l=t.y,c=t.z;return this.x=r*c-i*l,this.y=i*o-n*c,this.z=n*l-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return ZW.copy(this).projectOnVector(e),this.sub(ZW)}reflect(e){return this.sub(ZW.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(xi(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const ZW=new be,X8e=new vs;let ci=class G_e{constructor(e,t,n,r,i,o,l,c,h){G_e.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,i,o,l,c,h)}set(e,t,n,r,i,o,l,c,h){const m=this.elements;return m[0]=e,m[1]=r,m[2]=l,m[3]=t,m[4]=i,m[5]=c,m[6]=n,m[7]=o,m[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],l=n[3],c=n[6],h=n[1],m=n[4],y=n[7],b=n[2],w=n[5],A=n[8],I=r[0],D=r[3],P=r[6],U=r[1],j=r[4],C=r[7],Z=r[2],ie=r[5],se=r[8];return i[0]=o*I+l*U+c*Z,i[3]=o*D+l*j+c*ie,i[6]=o*P+l*C+c*se,i[1]=h*I+m*U+y*Z,i[4]=h*D+m*j+y*ie,i[7]=h*P+m*C+y*se,i[2]=b*I+w*U+A*Z,i[5]=b*D+w*j+A*ie,i[8]=b*P+w*C+A*se,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],l=e[5],c=e[6],h=e[7],m=e[8];return t*o*m-t*l*h-n*i*m+n*l*c+r*i*h-r*o*c}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],l=e[5],c=e[6],h=e[7],m=e[8],y=m*o-l*h,b=l*c-m*i,w=h*i-o*c,A=t*y+n*b+r*w;if(A===0)return this.set(0,0,0,0,0,0,0,0,0);const I=1/A;return e[0]=y*I,e[1]=(r*h-m*n)*I,e[2]=(l*n-r*o)*I,e[3]=b*I,e[4]=(m*t-r*c)*I,e[5]=(r*i-l*t)*I,e[6]=w*I,e[7]=(n*c-h*t)*I,e[8]=(o*t-n*i)*I,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,o,l){const c=Math.cos(i),h=Math.sin(i);return this.set(n*c,n*h,-n*(c*o+h*l)+o+e,-r*h,r*c,-r*(-h*o+c*l)+l+t,0,0,1),this}scale(e,t){return this.premultiply(QW.makeScale(e,t)),this}rotate(e){return this.premultiply(QW.makeRotation(-e)),this}translate(e,t){return this.premultiply(QW.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const QW=new ci,Y8e=new ci().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),K8e=new ci().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function GVe(){const s={enabled:!0,workingColorSpace:vd,spaces:{},convert:function(r,i,o){return this.enabled===!1||i===o||!i||!o||(this.spaces[i].transfer===Yn&&(r.r=X3(r.r),r.g=X3(r.g),r.b=X3(r.b)),this.spaces[i].primaries!==this.spaces[o].primaries&&(r.applyMatrix3(this.spaces[i].toXYZ),r.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Yn&&(r.r=vS(r.r),r.g=vS(r.g),r.b=vS(r.b))),r},workingToColorSpace:function(r,i){return this.convert(r,this.workingColorSpace,i)},colorSpaceToWorking:function(r,i){return this.convert(r,i,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===gu?KS:this.spaces[r].transfer},getToneMappingMode:function(r){return this.spaces[r].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(r,i=this.workingColorSpace){return r.fromArray(this.spaces[i].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,i,o){return r.copy(this.spaces[i].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(r,i){return es("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),s.workingToColorSpace(r,i)},toWorkingColorSpace:function(r,i){return es("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),s.colorSpaceToWorking(r,i)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return s.define({[vd]:{primaries:e,whitePoint:n,transfer:KS,toXYZ:Y8e,fromXYZ:K8e,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Is},outputColorSpaceConfig:{drawingBufferColorSpace:Is}},[Is]:{primaries:e,whitePoint:n,transfer:Yn,toXYZ:Y8e,fromXYZ:K8e,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Is}}}),s}const Zn=GVe();function X3(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function vS(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}let u_,jVe=class{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{u_===void 0&&(u_=bA("canvas")),u_.width=e.width,u_.height=e.height;const r=u_.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=u_}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=bA("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let o=0;o<i.length;o++)i[o]=X3(i[o]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(X3(t[n]/255)*255):t[n]=X3(t[n]);return{data:t,width:e.width,height:e.height}}else return qt("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},HVe=0,XK=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:HVe++}),this.uuid=dm(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):typeof VideoFrame<"u"&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let i;if(Array.isArray(r)){i=[];for(let o=0,l=r.length;o<l;o++)r[o].isDataTexture?i.push(JW(r[o].image)):i.push(JW(r[o]))}else i=JW(r);n.url=i}return t||(e.images[this.uuid]=n),n}};function JW(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?jVe.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(qt("Texture: Unable to serialize Texture."),{})}let $Ve=0;const eq=new be;let ol=class GL extends _d{constructor(e=GL.DEFAULT_IMAGE,t=GL.DEFAULT_MAPPING,n=zo,r=zo,i=ds,o=fd,l=io,c=yo,h=GL.DEFAULT_ANISOTROPY,m=gu){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:$Ve++}),this.uuid=dm(),this.name="",this.source=new XK(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=h,this.format=l,this.internalFormat=null,this.type=c,this.offset=new Ln(0,0),this.repeat=new Ln(1,1),this.center=new Ln(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ci,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=m,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(eq).x}get height(){return this.source.getSize(eq).y}get depth(){return this.source.getSize(eq).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){qt(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){qt(`Texture.setValues(): property '${t}' does not exist.`);continue}r&&n&&r.isVector2&&n.isVector2||r&&n&&r.isVector3&&n.isVector3||r&&n&&r.isMatrix3&&n.isMatrix3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==G6)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case vh:e.x=e.x-Math.floor(e.x);break;case zo:e.x=e.x<0?0:1;break;case ox:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case vh:e.y=e.y-Math.floor(e.y);break;case zo:e.y=e.y<0?0:1;break;case ox:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};ol.DEFAULT_IMAGE=null;ol.DEFAULT_MAPPING=G6;ol.DEFAULT_ANISOTROPY=1;let zr=class j_e{constructor(e=0,t=0,n=0,r=1){j_e.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const c=e.elements,h=c[0],m=c[4],y=c[8],b=c[1],w=c[5],A=c[9],I=c[2],D=c[6],P=c[10];if(Math.abs(m-b)<.01&&Math.abs(y-I)<.01&&Math.abs(A-D)<.01){if(Math.abs(m+b)<.1&&Math.abs(y+I)<.1&&Math.abs(A+D)<.1&&Math.abs(h+w+P-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const j=(h+1)/2,C=(w+1)/2,Z=(P+1)/2,ie=(m+b)/4,se=(y+I)/4,z=(A+D)/4;return j>C&&j>Z?j<.01?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(j),r=ie/n,i=se/n):C>Z?C<.01?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(C),n=ie/r,i=z/r):Z<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(Z),n=se/i,r=z/i),this.set(n,r,i,t),this}let U=Math.sqrt((D-A)*(D-A)+(y-I)*(y-I)+(b-m)*(b-m));return Math.abs(U)<.001&&(U=1),this.x=(D-A)/U,this.y=(y-I)/U,this.z=(b-m)/U,this.w=Math.acos((h+w+P-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=xi(this.x,e.x,t.x),this.y=xi(this.y,e.y,t.y),this.z=xi(this.z,e.z,t.z),this.w=xi(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=xi(this.x,e,t),this.y=xi(this.y,e,t),this.z=xi(this.z,e,t),this.w=xi(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(xi(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Op=class extends _d{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ds,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new zr(0,0,e,t),this.scissorTest=!1,this.viewport=new zr(0,0,e,t),this.textures=[];const r={width:e,height:t,depth:n.depth},i=new ol(r),o=n.count;for(let l=0;l<o;l++)this.textures[l]=i.clone(),this.textures[l].isRenderTargetTexture=!0,this.textures[l].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:ds,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n,this.textures[r].isData3DTexture!==!0&&(this.textures[r].isArrayTexture=this.textures[r].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const r=Object.assign({},e.textures[t].image);this.textures[t].source=new XK(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}};class hm extends Op{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}let YK=class extends ol{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Yi,this.minFilter=Yi,this.wrapR=zo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}};class WVe extends ol{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Yi,this.minFilter=Yi,this.wrapR=zo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let Pn=class NY{constructor(e,t,n,r,i,o,l,c,h,m,y,b,w,A,I,D){NY.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,r,i,o,l,c,h,m,y,b,w,A,I,D)}set(e,t,n,r,i,o,l,c,h,m,y,b,w,A,I,D){const P=this.elements;return P[0]=e,P[4]=t,P[8]=n,P[12]=r,P[1]=i,P[5]=o,P[9]=l,P[13]=c,P[2]=h,P[6]=m,P[10]=y,P[14]=b,P[3]=w,P[7]=A,P[11]=I,P[15]=D,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new NY().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return this.determinant()===0?(e.set(1,0,0),t.set(0,1,0),n.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this)}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const t=this.elements,n=e.elements,r=1/d_.setFromMatrixColumn(e,0).length(),i=1/d_.setFromMatrixColumn(e,1).length(),o=1/d_.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r),m=Math.cos(i),y=Math.sin(i);if(e.order==="XYZ"){const b=o*m,w=o*y,A=l*m,I=l*y;t[0]=c*m,t[4]=-c*y,t[8]=h,t[1]=w+A*h,t[5]=b-I*h,t[9]=-l*c,t[2]=I-b*h,t[6]=A+w*h,t[10]=o*c}else if(e.order==="YXZ"){const b=c*m,w=c*y,A=h*m,I=h*y;t[0]=b+I*l,t[4]=A*l-w,t[8]=o*h,t[1]=o*y,t[5]=o*m,t[9]=-l,t[2]=w*l-A,t[6]=I+b*l,t[10]=o*c}else if(e.order==="ZXY"){const b=c*m,w=c*y,A=h*m,I=h*y;t[0]=b-I*l,t[4]=-o*y,t[8]=A+w*l,t[1]=w+A*l,t[5]=o*m,t[9]=I-b*l,t[2]=-o*h,t[6]=l,t[10]=o*c}else if(e.order==="ZYX"){const b=o*m,w=o*y,A=l*m,I=l*y;t[0]=c*m,t[4]=A*h-w,t[8]=b*h+I,t[1]=c*y,t[5]=I*h+b,t[9]=w*h-A,t[2]=-h,t[6]=l*c,t[10]=o*c}else if(e.order==="YZX"){const b=o*c,w=o*h,A=l*c,I=l*h;t[0]=c*m,t[4]=I-b*y,t[8]=A*y+w,t[1]=y,t[5]=o*m,t[9]=-l*m,t[2]=-h*m,t[6]=w*y+A,t[10]=b-I*y}else if(e.order==="XZY"){const b=o*c,w=o*h,A=l*c,I=l*h;t[0]=c*m,t[4]=-y,t[8]=h*m,t[1]=b*y+I,t[5]=o*m,t[9]=w*y-A,t[2]=A*y-w,t[6]=l*m,t[10]=I*y+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(qVe,e,XVe)}lookAt(e,t,n){const r=this.elements;return sh.subVectors(e,t),sh.lengthSq()===0&&(sh.z=1),sh.normalize(),Sy.crossVectors(n,sh),Sy.lengthSq()===0&&(Math.abs(n.z)===1?sh.x+=1e-4:sh.z+=1e-4,sh.normalize(),Sy.crossVectors(n,sh)),Sy.normalize(),$D.crossVectors(sh,Sy),r[0]=Sy.x,r[4]=$D.x,r[8]=sh.x,r[1]=Sy.y,r[5]=$D.y,r[9]=sh.y,r[2]=Sy.z,r[6]=$D.z,r[10]=sh.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],l=n[4],c=n[8],h=n[12],m=n[1],y=n[5],b=n[9],w=n[13],A=n[2],I=n[6],D=n[10],P=n[14],U=n[3],j=n[7],C=n[11],Z=n[15],ie=r[0],se=r[4],z=r[8],re=r[12],ye=r[1],H=r[5],Me=r[9],Oe=r[13],Ue=r[2],Ie=r[6],ce=r[10],Ve=r[14],Pe=r[3],We=r[7],pt=r[11],Ne=r[15];return i[0]=o*ie+l*ye+c*Ue+h*Pe,i[4]=o*se+l*H+c*Ie+h*We,i[8]=o*z+l*Me+c*ce+h*pt,i[12]=o*re+l*Oe+c*Ve+h*Ne,i[1]=m*ie+y*ye+b*Ue+w*Pe,i[5]=m*se+y*H+b*Ie+w*We,i[9]=m*z+y*Me+b*ce+w*pt,i[13]=m*re+y*Oe+b*Ve+w*Ne,i[2]=A*ie+I*ye+D*Ue+P*Pe,i[6]=A*se+I*H+D*Ie+P*We,i[10]=A*z+I*Me+D*ce+P*pt,i[14]=A*re+I*Oe+D*Ve+P*Ne,i[3]=U*ie+j*ye+C*Ue+Z*Pe,i[7]=U*se+j*H+C*Ie+Z*We,i[11]=U*z+j*Me+C*ce+Z*pt,i[15]=U*re+j*Oe+C*Ve+Z*Ne,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],l=e[5],c=e[9],h=e[13],m=e[2],y=e[6],b=e[10],w=e[14],A=e[3],I=e[7],D=e[11],P=e[15],U=c*w-h*b,j=l*w-h*y,C=l*b-c*y,Z=o*w-h*m,ie=o*b-c*m,se=o*y-l*m;return t*(I*U-D*j+P*C)-n*(A*U-D*Z+P*ie)+r*(A*j-I*Z+P*se)-i*(A*C-I*ie+D*se)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],l=e[5],c=e[6],h=e[7],m=e[8],y=e[9],b=e[10],w=e[11],A=e[12],I=e[13],D=e[14],P=e[15],U=t*l-n*o,j=t*c-r*o,C=t*h-i*o,Z=n*c-r*l,ie=n*h-i*l,se=r*h-i*c,z=m*I-y*A,re=m*D-b*A,ye=m*P-w*A,H=y*D-b*I,Me=y*P-w*I,Oe=b*P-w*D,Ue=U*Oe-j*Me+C*H+Z*ye-ie*re+se*z;if(Ue===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ie=1/Ue;return e[0]=(l*Oe-c*Me+h*H)*Ie,e[1]=(r*Me-n*Oe-i*H)*Ie,e[2]=(I*se-D*ie+P*Z)*Ie,e[3]=(b*ie-y*se-w*Z)*Ie,e[4]=(c*ye-o*Oe-h*re)*Ie,e[5]=(t*Oe-r*ye+i*re)*Ie,e[6]=(D*C-A*se-P*j)*Ie,e[7]=(m*se-b*C+w*j)*Ie,e[8]=(o*Me-l*ye+h*z)*Ie,e[9]=(n*ye-t*Me-i*z)*Ie,e[10]=(A*ie-I*C+P*U)*Ie,e[11]=(y*C-m*ie-w*U)*Ie,e[12]=(l*re-o*H-c*z)*Ie,e[13]=(t*H-n*re+r*z)*Ie,e[14]=(I*j-A*Z-D*U)*Ie,e[15]=(m*Z-y*j+b*U)*Ie,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,l=e.y,c=e.z,h=i*o,m=i*l;return this.set(h*o+n,h*l-r*c,h*c+r*l,0,h*l+r*c,m*l+n,m*c-r*o,0,h*c-r*l,m*c+r*o,i*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,o){return this.set(1,n,i,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,o=t._y,l=t._z,c=t._w,h=i+i,m=o+o,y=l+l,b=i*h,w=i*m,A=i*y,I=o*m,D=o*y,P=l*y,U=c*h,j=c*m,C=c*y,Z=n.x,ie=n.y,se=n.z;return r[0]=(1-(I+P))*Z,r[1]=(w+C)*Z,r[2]=(A-j)*Z,r[3]=0,r[4]=(w-C)*ie,r[5]=(1-(b+P))*ie,r[6]=(D+U)*ie,r[7]=0,r[8]=(A+j)*se,r[9]=(D-U)*se,r[10]=(1-(b+I))*se,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;e.x=r[12],e.y=r[13],e.z=r[14];const i=this.determinant();if(i===0)return n.set(1,1,1),t.identity(),this;let o=d_.set(r[0],r[1],r[2]).length();const l=d_.set(r[4],r[5],r[6]).length(),c=d_.set(r[8],r[9],r[10]).length();i<0&&(o=-o),$f.copy(this);const h=1/o,m=1/l,y=1/c;return $f.elements[0]*=h,$f.elements[1]*=h,$f.elements[2]*=h,$f.elements[4]*=m,$f.elements[5]*=m,$f.elements[6]*=m,$f.elements[8]*=y,$f.elements[9]*=y,$f.elements[10]*=y,t.setFromRotationMatrix($f),n.x=o,n.y=l,n.z=c,this}makePerspective(e,t,n,r,i,o,l=Tc,c=!1){const h=this.elements,m=2*i/(t-e),y=2*i/(n-r),b=(t+e)/(t-e),w=(n+r)/(n-r);let A,I;if(c)A=i/(o-i),I=o*i/(o-i);else if(l===Tc)A=-(o+i)/(o-i),I=-2*o*i/(o-i);else if(l===xh)A=-o/(o-i),I=-o*i/(o-i);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return h[0]=m,h[4]=0,h[8]=b,h[12]=0,h[1]=0,h[5]=y,h[9]=w,h[13]=0,h[2]=0,h[6]=0,h[10]=A,h[14]=I,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(e,t,n,r,i,o,l=Tc,c=!1){const h=this.elements,m=2/(t-e),y=2/(n-r),b=-(t+e)/(t-e),w=-(n+r)/(n-r);let A,I;if(c)A=1/(o-i),I=o/(o-i);else if(l===Tc)A=-2/(o-i),I=-(o+i)/(o-i);else if(l===xh)A=-1/(o-i),I=-i/(o-i);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return h[0]=m,h[4]=0,h[8]=0,h[12]=b,h[1]=0,h[5]=y,h[9]=0,h[13]=w,h[2]=0,h[6]=0,h[10]=A,h[14]=I,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}};const d_=new be,$f=new Pn,qVe=new be(0,0,0),XVe=new be(1,1,1),Sy=new be,$D=new be,sh=new be,Z8e=new Pn,Q8e=new vs;let Sa=class H_e{constructor(e=0,t=0,n=0,r=H_e.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,i=r[0],o=r[4],l=r[8],c=r[1],h=r[5],m=r[9],y=r[2],b=r[6],w=r[10];switch(t){case"XYZ":this._y=Math.asin(xi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-m,w),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(b,h),this._z=0);break;case"YXZ":this._x=Math.asin(-xi(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(l,w),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-y,i),this._z=0);break;case"ZXY":this._x=Math.asin(xi(b,-1,1)),Math.abs(b)<.9999999?(this._y=Math.atan2(-y,w),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(c,i));break;case"ZYX":this._y=Math.asin(-xi(y,-1,1)),Math.abs(y)<.9999999?(this._x=Math.atan2(b,w),this._z=Math.atan2(c,i)):(this._x=0,this._z=Math.atan2(-o,h));break;case"YZX":this._z=Math.asin(xi(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-m,h),this._y=Math.atan2(-y,i)):(this._x=0,this._y=Math.atan2(l,w));break;case"XZY":this._z=Math.asin(-xi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(b,h),this._y=Math.atan2(l,i)):(this._x=Math.atan2(-m,w),this._y=0);break;default:qt("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Z8e.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Z8e,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Q8e.setFromEuler(this),this.setFromQuaternion(Q8e,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Sa.DEFAULT_ORDER="XYZ";let KK=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},YVe=0;const J8e=new be,h_=new vs,b3=new Pn,WD=new be,LM=new be,KVe=new be,ZVe=new vs,e6e=new be(1,0,0),t6e=new be(0,1,0),n6e=new be(0,0,1),r6e={type:"added"},QVe={type:"removed"},p_={type:"childadded",child:null},tq={type:"childremoved",child:null};let Bi=class jL extends _d{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:YVe++}),this.uuid=dm(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=jL.DEFAULT_UP.clone();const e=new be,t=new Sa,n=new vs,r=new be(1,1,1);function i(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(i),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Pn},normalMatrix:{value:new ci}}),this.matrix=new Pn,this.matrixWorld=new Pn,this.matrixAutoUpdate=jL.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=jL.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new KK,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.static=!1,this.userData={},this.pivot=null}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return h_.setFromAxisAngle(e,t),this.quaternion.multiply(h_),this}rotateOnWorldAxis(e,t){return h_.setFromAxisAngle(e,t),this.quaternion.premultiply(h_),this}rotateX(e){return this.rotateOnAxis(e6e,e)}rotateY(e){return this.rotateOnAxis(t6e,e)}rotateZ(e){return this.rotateOnAxis(n6e,e)}translateOnAxis(e,t){return J8e.copy(e).applyQuaternion(this.quaternion),this.position.add(J8e.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(e6e,e)}translateY(e){return this.translateOnAxis(t6e,e)}translateZ(e){return this.translateOnAxis(n6e,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(b3.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?WD.copy(e):WD.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),LM.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?b3.lookAt(LM,WD,this.up):b3.lookAt(WD,LM,this.up),this.quaternion.setFromRotationMatrix(b3),r&&(b3.extractRotation(r.matrixWorld),h_.setFromRotationMatrix(b3),this.quaternion.premultiply(h_.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(Ht("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(r6e),p_.child=e,this.dispatchEvent(p_),p_.child=null):Ht("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(QVe),tq.child=e,this.dispatchEvent(tq),tq.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),b3.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),b3.multiply(e.parent.matrixWorld)),e.applyMatrix4(b3),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(r6e),p_.child=e,this.dispatchEvent(p_),p_.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let i=0,o=r.length;i<o;i++)r[i].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(LM,e,KVe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(LM,ZVe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);const e=this.pivot;if(e!==null){const t=e.x,n=e.y,r=e.z,i=this.matrix.elements;i[12]+=t-i[0]*t-i[4]*n-i[8]*r,i[13]+=n-i[1]*t-i[5]*n-i[9]*r,i[14]+=r-i[2]*t-i[6]*n-i[10]*r}this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let i=0,o=r.length;i<o;i++)r[i].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),this.static!==!1&&(r.static=this.static),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.pivot!==null&&(r.pivot=this.pivot.toArray()),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.morphTargetDictionary!==void 0&&(r.morphTargetDictionary=Object.assign({},this.morphTargetDictionary)),this.morphTargetInfluences!==void 0&&(r.morphTargetInfluences=this.morphTargetInfluences.slice()),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(l=>({...l,boundingBox:l.boundingBox?l.boundingBox.toJSON():void 0,boundingSphere:l.boundingSphere?l.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(l=>({...l})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(r.boundingBox=this.boundingBox.toJSON()));function i(l,c){return l[c.uuid]===void 0&&(l[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const c=l.shapes;if(Array.isArray(c))for(let h=0,m=c.length;h<m;h++){const y=c[h];i(e.shapes,y)}else i(e.shapes,c)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let c=0,h=this.material.length;c<h;c++)l.push(i(e.materials,this.material[c]));r.material=l}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let l=0;l<this.children.length;l++)r.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let l=0;l<this.animations.length;l++){const c=this.animations[l];r.animations.push(i(e.animations,c))}}if(t){const l=o(e.geometries),c=o(e.materials),h=o(e.textures),m=o(e.images),y=o(e.shapes),b=o(e.skeletons),w=o(e.animations),A=o(e.nodes);l.length>0&&(n.geometries=l),c.length>0&&(n.materials=c),h.length>0&&(n.textures=h),m.length>0&&(n.images=m),y.length>0&&(n.shapes=y),b.length>0&&(n.skeletons=b),w.length>0&&(n.animations=w),A.length>0&&(n.nodes=A)}return n.object=r,n;function o(l){const c=[];for(const h in l){const m=l[h];delete m.metadata,c.push(m)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),e.pivot!==null&&(this.pivot=e.pivot.clone()),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.static=e.static,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}};Bi.DEFAULT_UP=new be(0,1,0);Bi.DEFAULT_MATRIX_AUTO_UPDATE=!0;Bi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class j6 extends Bi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const JVe={type:"move"};class HL{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new j6,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new j6,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new be,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new be),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new j6,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new be,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new be),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,o=null;const l=this._targetRay,c=this._grip,h=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(h&&e.hand){o=!0;for(const I of e.hand.values()){const D=t.getJointPose(I,n),P=this._getHandJoint(h,I);D!==null&&(P.matrix.fromArray(D.transform.matrix),P.matrix.decompose(P.position,P.rotation,P.scale),P.matrixWorldNeedsUpdate=!0,P.jointRadius=D.radius),P.visible=D!==null}const m=h.joints["index-finger-tip"],y=h.joints["thumb-tip"],b=m.position.distanceTo(y.position),w=.02,A=.005;h.inputState.pinching&&b>w+A?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&b<=w-A&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),i!==null&&(c.matrix.fromArray(i.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,i.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(i.linearVelocity)):c.hasLinearVelocity=!1,i.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(i.angularVelocity)):c.hasAngularVelocity=!1));l!==null&&(r=t.getPose(e.targetRaySpace,n),r===null&&i!==null&&(r=i),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(JVe)))}return l!==null&&(l.visible=r!==null),c!==null&&(c.visible=i!==null),h!==null&&(h.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new j6;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}const $_e={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},wy={h:0,s:0,l:0},qD={h:0,s:0,l:0};function nq(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*6*(2/3-t):s}let Tn=class{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Is){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Zn.colorSpaceToWorking(this,t),this}setRGB(e,t,n,r=Zn.workingColorSpace){return this.r=e,this.g=t,this.b=n,Zn.colorSpaceToWorking(this,r),this}setHSL(e,t,n,r=Zn.workingColorSpace){if(e=qK(e,1),t=xi(t,0,1),n=xi(n,0,1),t===0)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,o=2*n-i;this.r=nq(o,i,e+1/3),this.g=nq(o,i,e),this.b=nq(o,i,e-1/3)}return Zn.colorSpaceToWorking(this,r),this}setStyle(e,t=Is){function n(i){i!==void 0&&parseFloat(i)<1&&qt("Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const o=r[1],l=r[2];switch(o){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:qt("Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const i=r[1],o=i.length;if(o===3)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(i,16),t);qt("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Is){const n=$_e[e.toLowerCase()];return n!==void 0?this.setHex(n,t):qt("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=X3(e.r),this.g=X3(e.g),this.b=X3(e.b),this}copyLinearToSRGB(e){return this.r=vS(e.r),this.g=vS(e.g),this.b=vS(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Is){return Zn.workingToColorSpace(yc.copy(this),e),Math.round(xi(yc.r*255,0,255))*65536+Math.round(xi(yc.g*255,0,255))*256+Math.round(xi(yc.b*255,0,255))}getHexString(e=Is){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Zn.workingColorSpace){Zn.workingToColorSpace(yc.copy(this),t);const n=yc.r,r=yc.g,i=yc.b,o=Math.max(n,r,i),l=Math.min(n,r,i);let c,h;const m=(l+o)/2;if(l===o)c=0,h=0;else{const y=o-l;switch(h=m<=.5?y/(o+l):y/(2-o-l),o){case n:c=(r-i)/y+(r<i?6:0);break;case r:c=(i-n)/y+2;break;case i:c=(n-r)/y+4;break}c/=6}return e.h=c,e.s=h,e.l=m,e}getRGB(e,t=Zn.workingColorSpace){return Zn.workingToColorSpace(yc.copy(this),t),e.r=yc.r,e.g=yc.g,e.b=yc.b,e}getStyle(e=Is){Zn.workingToColorSpace(yc.copy(this),e);const t=yc.r,n=yc.g,r=yc.b;return e!==Is?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(wy),this.setHSL(wy.h+e,wy.s+t,wy.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(wy),e.getHSL(qD);const n=UC(wy.h,qD.h,t),r=UC(wy.s,qD.s,t),i=UC(wy.l,qD.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const yc=new Tn;Tn.NAMES=$_e;let XA=class extends Bi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Sa,this.environmentIntensity=1,this.environmentRotation=new Sa,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}};const Wf=new be,_3=new be,rq=new be,S3=new be,f_=new be,m_=new be,i6e=new be,iq=new be,sq=new be,oq=new be,aq=new zr,lq=new zr,cq=new zr;let FM=class nS{constructor(e=new be,t=new be,n=new be){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Wf.subVectors(e,t),r.cross(Wf);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Wf.subVectors(r,t),_3.subVectors(n,t),rq.subVectors(e,t);const o=Wf.dot(Wf),l=Wf.dot(_3),c=Wf.dot(rq),h=_3.dot(_3),m=_3.dot(rq),y=o*h-l*l;if(y===0)return i.set(0,0,0),null;const b=1/y,w=(h*c-l*m)*b,A=(o*m-l*c)*b;return i.set(1-w-A,A,w)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,S3)===null?!1:S3.x>=0&&S3.y>=0&&S3.x+S3.y<=1}static getInterpolation(e,t,n,r,i,o,l,c){return this.getBarycoord(e,t,n,r,S3)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(i,S3.x),c.addScaledVector(o,S3.y),c.addScaledVector(l,S3.z),c)}static getInterpolatedAttribute(e,t,n,r,i,o){return aq.setScalar(0),lq.setScalar(0),cq.setScalar(0),aq.fromBufferAttribute(e,t),lq.fromBufferAttribute(e,n),cq.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(aq,i.x),o.addScaledVector(lq,i.y),o.addScaledVector(cq,i.z),o}static isFrontFacing(e,t,n,r){return Wf.subVectors(n,t),_3.subVectors(e,t),Wf.cross(_3).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Wf.subVectors(this.c,this.b),_3.subVectors(this.a,this.b),Wf.cross(_3).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return nS.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return nS.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,i){return nS.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return nS.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return nS.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let o,l;f_.subVectors(r,n),m_.subVectors(i,n),iq.subVectors(e,n);const c=f_.dot(iq),h=m_.dot(iq);if(c<=0&&h<=0)return t.copy(n);sq.subVectors(e,r);const m=f_.dot(sq),y=m_.dot(sq);if(m>=0&&y<=m)return t.copy(r);const b=c*y-m*h;if(b<=0&&c>=0&&m<=0)return o=c/(c-m),t.copy(n).addScaledVector(f_,o);oq.subVectors(e,i);const w=f_.dot(oq),A=m_.dot(oq);if(A>=0&&w<=A)return t.copy(i);const I=w*h-c*A;if(I<=0&&h>=0&&A<=0)return l=h/(h-A),t.copy(n).addScaledVector(m_,l);const D=m*A-w*y;if(D<=0&&y-m>=0&&w-A>=0)return i6e.subVectors(i,r),l=(y-m)/(y-m+(w-A)),t.copy(r).addScaledVector(i6e,l);const P=1/(D+I+b);return o=I*P,l=b*P,t.copy(n).addScaledVector(f_,o).addScaledVector(m_,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},i9=class{constructor(e=new be(1/0,1/0,1/0),t=new be(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(qf.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(qf.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=qf.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const i=n.getAttribute("position");if(t===!0&&i!==void 0&&e.isInstancedMesh!==!0)for(let o=0,l=i.count;o<l;o++)e.isMesh===!0?e.getVertexPosition(o,qf):qf.fromBufferAttribute(i,o),qf.applyMatrix4(e.matrixWorld),this.expandByPoint(qf);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),XD.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),XD.copy(n.boundingBox)),XD.applyMatrix4(e.matrixWorld),this.union(XD)}const r=e.children;for(let i=0,o=r.length;i<o;i++)this.expandByObject(r[i],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,qf),qf.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(BM),YD.subVectors(this.max,BM),g_.subVectors(e.a,BM),y_.subVectors(e.b,BM),v_.subVectors(e.c,BM),Ty.subVectors(y_,g_),Ey.subVectors(v_,y_),h6.subVectors(g_,v_);let t=[0,-Ty.z,Ty.y,0,-Ey.z,Ey.y,0,-h6.z,h6.y,Ty.z,0,-Ty.x,Ey.z,0,-Ey.x,h6.z,0,-h6.x,-Ty.y,Ty.x,0,-Ey.y,Ey.x,0,-h6.y,h6.x,0];return!uq(t,g_,y_,v_,YD)||(t=[1,0,0,0,1,0,0,0,1],!uq(t,g_,y_,v_,YD))?!1:(KD.crossVectors(Ty,Ey),t=[KD.x,KD.y,KD.z],uq(t,g_,y_,v_,YD))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,qf).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(qf).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(w3[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),w3[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),w3[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),w3[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),w3[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),w3[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),w3[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),w3[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(w3),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}};const w3=[new be,new be,new be,new be,new be,new be,new be,new be],qf=new be,XD=new i9,g_=new be,y_=new be,v_=new be,Ty=new be,Ey=new be,h6=new be,BM=new be,YD=new be,KD=new be,p6=new be;function uq(s,e,t,n,r){for(let i=0,o=s.length-3;i<=o;i+=3){p6.fromArray(s,i);const l=r.x*Math.abs(p6.x)+r.y*Math.abs(p6.y)+r.z*Math.abs(p6.z),c=e.dot(p6),h=t.dot(p6),m=n.dot(p6);if(Math.max(-Math.max(c,h,m),Math.min(c,h,m))>l)return!1}return!0}const L3=eGe();function eGe(){const s=new ArrayBuffer(4),e=new Float32Array(s),t=new Uint32Array(s),n=new Uint32Array(512),r=new Uint32Array(512);for(let c=0;c<256;++c){const h=c-127;h<-27?(n[c]=0,n[c|256]=32768,r[c]=24,r[c|256]=24):h<-14?(n[c]=1024>>-h-14,n[c|256]=1024>>-h-14|32768,r[c]=-h-1,r[c|256]=-h-1):h<=15?(n[c]=h+15<<10,n[c|256]=h+15<<10|32768,r[c]=13,r[c|256]=13):h<128?(n[c]=31744,n[c|256]=64512,r[c]=24,r[c|256]=24):(n[c]=31744,n[c|256]=64512,r[c]=13,r[c|256]=13)}const i=new Uint32Array(2048),o=new Uint32Array(64),l=new Uint32Array(64);for(let c=1;c<1024;++c){let h=c<<13,m=0;for(;(h&8388608)===0;)h<<=1,m-=8388608;h&=-8388609,m+=947912704,i[c]=h|m}for(let c=1024;c<2048;++c)i[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)o[c]=c<<23;o[31]=1199570944,o[32]=2147483648;for(let c=33;c<63;++c)o[c]=2147483648+(c-32<<23);o[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(l[c]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:r,mantissaTable:i,exponentTable:o,offsetTable:l}}function cd(s){Math.abs(s)>65504&&qt("DataUtils.toHalfFloat(): Value out of range."),s=xi(s,-65504,65504),L3.floatView[0]=s;const e=L3.uint32View[0],t=e>>23&511;return L3.baseTable[t]+((e&8388607)>>L3.shiftTable[t])}function TC(s){const e=s>>10;return L3.uint32View[0]=L3.mantissaTable[L3.offsetTable[e]+(s&1023)]+L3.exponentTable[e],L3.floatView[0]}class s6e{static toHalfFloat(e){return cd(e)}static fromHalfFloat(e){return TC(e)}}const Ja=new be,ZD=new Ln;let tGe=0,ja=class{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:tGe++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=ZS,this.updateRanges=[],this.gpuType=vo,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)ZD.fromBufferAttribute(this,t),ZD.applyMatrix3(e),this.setXY(t,ZD.x,ZD.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Ja.fromBufferAttribute(this,t),Ja.applyMatrix3(e),this.setXYZ(t,Ja.x,Ja.y,Ja.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ja.fromBufferAttribute(this,t),Ja.applyMatrix4(e),this.setXYZ(t,Ja.x,Ja.y,Ja.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ja.fromBufferAttribute(this,t),Ja.applyNormalMatrix(e),this.setXYZ(t,Ja.x,Ja.y,Ja.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ja.fromBufferAttribute(this,t),Ja.transformDirection(e),this.setXYZ(t,Ja.x,Ja.y,Ja.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=yu(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=vi(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=yu(t,this.array)),t}setX(e,t){return this.normalized&&(t=vi(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=yu(t,this.array)),t}setY(e,t){return this.normalized&&(t=vi(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=yu(t,this.array)),t}setZ(e,t){return this.normalized&&(t=vi(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=yu(t,this.array)),t}setW(e,t){return this.normalized&&(t=vi(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=vi(t,this.array),n=vi(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=vi(t,this.array),n=vi(n,this.array),r=vi(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=vi(t,this.array),n=vi(n,this.array),r=vi(r,this.array),i=vi(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==ZS&&(e.usage=this.usage),e}},iB=class extends ja{constructor(e,t,n){super(new Uint16Array(e),t,n)}},ZK=class extends ja{constructor(e,t,n){super(new Uint32Array(e),t,n)}};class W_e extends ja{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=TC(this.array[e*this.itemSize]);return this.normalized&&(t=yu(t,this.array)),t}setX(e,t){return this.normalized&&(t=vi(t,this.array)),this.array[e*this.itemSize]=cd(t),this}getY(e){let t=TC(this.array[e*this.itemSize+1]);return this.normalized&&(t=yu(t,this.array)),t}setY(e,t){return this.normalized&&(t=vi(t,this.array)),this.array[e*this.itemSize+1]=cd(t),this}getZ(e){let t=TC(this.array[e*this.itemSize+2]);return this.normalized&&(t=yu(t,this.array)),t}setZ(e,t){return this.normalized&&(t=vi(t,this.array)),this.array[e*this.itemSize+2]=cd(t),this}getW(e){let t=TC(this.array[e*this.itemSize+3]);return this.normalized&&(t=yu(t,this.array)),t}setW(e,t){return this.normalized&&(t=vi(t,this.array)),this.array[e*this.itemSize+3]=cd(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=vi(t,this.array),n=vi(n,this.array)),this.array[e+0]=cd(t),this.array[e+1]=cd(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=vi(t,this.array),n=vi(n,this.array),r=vi(r,this.array)),this.array[e+0]=cd(t),this.array[e+1]=cd(n),this.array[e+2]=cd(r),this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=vi(t,this.array),n=vi(n,this.array),r=vi(r,this.array),i=vi(i,this.array)),this.array[e+0]=cd(t),this.array[e+1]=cd(n),this.array[e+2]=cd(r),this.array[e+3]=cd(i),this}}let Fr=class extends ja{constructor(e,t,n){super(new Float32Array(e),t,n)}};const nGe=new i9,UM=new be,dq=new be;let xm=class{constructor(e=new be,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):nGe.setFromPoints(e).getCenter(n);let r=0;for(let i=0,o=e.length;i<o;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;UM.subVectors(e,this.center);const t=UM.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.addScaledVector(UM,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(dq.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(UM.copy(e.center).add(dq)),this.expandByPoint(UM.copy(e.center).sub(dq))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}},rGe=0;const fp=new Pn,hq=new Bi,x_=new be,oh=new i9,zM=new i9,Zl=new be;let Ki=class q_e extends _d{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:rGe++}),this.uuid=dm(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(wVe(e)?ZK:iB)(e,1):this.index=e,this}setIndirect(e,t=0){return this.indirect=e,this.indirectOffset=t,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const i=new ci().getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return fp.makeRotationFromQuaternion(e),this.applyMatrix4(fp),this}rotateX(e){return fp.makeRotationX(e),this.applyMatrix4(fp),this}rotateY(e){return fp.makeRotationY(e),this.applyMatrix4(fp),this}rotateZ(e){return fp.makeRotationZ(e),this.applyMatrix4(fp),this}translate(e,t,n){return fp.makeTranslation(e,t,n),this.applyMatrix4(fp),this}scale(e,t,n){return fp.makeScale(e,t,n),this.applyMatrix4(fp),this}lookAt(e){return hq.lookAt(e),hq.updateMatrix(),this.applyMatrix4(hq.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(x_).negate(),this.translate(x_.x,x_.y,x_.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let r=0,i=e.length;r<i;r++){const o=e[r];n.push(o.x,o.y,o.z||0)}this.setAttribute("position",new Fr(n,3))}else{const n=Math.min(e.length,t.count);for(let r=0;r<n;r++){const i=e[r];t.setXYZ(r,i.x,i.y,i.z||0)}e.length>t.count&&qt("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new i9);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Ht("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new be(-1/0,-1/0,-1/0),new be(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const i=t[n];oh.setFromBufferAttribute(i),this.morphTargetsRelative?(Zl.addVectors(this.boundingBox.min,oh.min),this.boundingBox.expandByPoint(Zl),Zl.addVectors(this.boundingBox.max,oh.max),this.boundingBox.expandByPoint(Zl)):(this.boundingBox.expandByPoint(oh.min),this.boundingBox.expandByPoint(oh.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Ht('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new xm);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Ht("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new be,1/0);return}if(e){const n=this.boundingSphere.center;if(oh.setFromBufferAttribute(e),t)for(let i=0,o=t.length;i<o;i++){const l=t[i];zM.setFromBufferAttribute(l),this.morphTargetsRelative?(Zl.addVectors(oh.min,zM.min),oh.expandByPoint(Zl),Zl.addVectors(oh.max,zM.max),oh.expandByPoint(Zl)):(oh.expandByPoint(zM.min),oh.expandByPoint(zM.max))}oh.getCenter(n);let r=0;for(let i=0,o=e.count;i<o;i++)Zl.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(Zl));if(t)for(let i=0,o=t.length;i<o;i++){const l=t[i],c=this.morphTargetsRelative;for(let h=0,m=l.count;h<m;h++)Zl.fromBufferAttribute(l,h),c&&(x_.fromBufferAttribute(e,h),Zl.add(x_)),r=Math.max(r,n.distanceToSquared(Zl))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&Ht('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){Ht("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,r=t.normal,i=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ja(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),l=[],c=[];for(let z=0;z<n.count;z++)l[z]=new be,c[z]=new be;const h=new be,m=new be,y=new be,b=new Ln,w=new Ln,A=new Ln,I=new be,D=new be;function P(z,re,ye){h.fromBufferAttribute(n,z),m.fromBufferAttribute(n,re),y.fromBufferAttribute(n,ye),b.fromBufferAttribute(i,z),w.fromBufferAttribute(i,re),A.fromBufferAttribute(i,ye),m.sub(h),y.sub(h),w.sub(b),A.sub(b);const H=1/(w.x*A.y-A.x*w.y);isFinite(H)&&(I.copy(m).multiplyScalar(A.y).addScaledVector(y,-w.y).multiplyScalar(H),D.copy(y).multiplyScalar(w.x).addScaledVector(m,-A.x).multiplyScalar(H),l[z].add(I),l[re].add(I),l[ye].add(I),c[z].add(D),c[re].add(D),c[ye].add(D))}let U=this.groups;U.length===0&&(U=[{start:0,count:e.count}]);for(let z=0,re=U.length;z<re;++z){const ye=U[z],H=ye.start,Me=ye.count;for(let Oe=H,Ue=H+Me;Oe<Ue;Oe+=3)P(e.getX(Oe+0),e.getX(Oe+1),e.getX(Oe+2))}const j=new be,C=new be,Z=new be,ie=new be;function se(z){Z.fromBufferAttribute(r,z),ie.copy(Z);const re=l[z];j.copy(re),j.sub(Z.multiplyScalar(Z.dot(re))).normalize(),C.crossVectors(ie,re);const H=C.dot(c[z])<0?-1:1;o.setXYZW(z,j.x,j.y,j.z,H)}for(let z=0,re=U.length;z<re;++z){const ye=U[z],H=ye.start,Me=ye.count;for(let Oe=H,Ue=H+Me;Oe<Ue;Oe+=3)se(e.getX(Oe+0)),se(e.getX(Oe+1)),se(e.getX(Oe+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new ja(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let b=0,w=n.count;b<w;b++)n.setXYZ(b,0,0,0);const r=new be,i=new be,o=new be,l=new be,c=new be,h=new be,m=new be,y=new be;if(e)for(let b=0,w=e.count;b<w;b+=3){const A=e.getX(b+0),I=e.getX(b+1),D=e.getX(b+2);r.fromBufferAttribute(t,A),i.fromBufferAttribute(t,I),o.fromBufferAttribute(t,D),m.subVectors(o,i),y.subVectors(r,i),m.cross(y),l.fromBufferAttribute(n,A),c.fromBufferAttribute(n,I),h.fromBufferAttribute(n,D),l.add(m),c.add(m),h.add(m),n.setXYZ(A,l.x,l.y,l.z),n.setXYZ(I,c.x,c.y,c.z),n.setXYZ(D,h.x,h.y,h.z)}else for(let b=0,w=t.count;b<w;b+=3)r.fromBufferAttribute(t,b+0),i.fromBufferAttribute(t,b+1),o.fromBufferAttribute(t,b+2),m.subVectors(o,i),y.subVectors(r,i),m.cross(y),n.setXYZ(b+0,m.x,m.y,m.z),n.setXYZ(b+1,m.x,m.y,m.z),n.setXYZ(b+2,m.x,m.y,m.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Zl.fromBufferAttribute(e,t),Zl.normalize(),e.setXYZ(t,Zl.x,Zl.y,Zl.z)}toNonIndexed(){function e(l,c){const h=l.array,m=l.itemSize,y=l.normalized,b=new h.constructor(c.length*m);let w=0,A=0;for(let I=0,D=c.length;I<D;I++){l.isInterleavedBufferAttribute?w=c[I]*l.data.stride+l.offset:w=c[I]*m;for(let P=0;P<m;P++)b[A++]=h[w++]}return new ja(b,m,y)}if(this.index===null)return qt("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new q_e,n=this.index.array,r=this.attributes;for(const l in r){const c=r[l],h=e(c,n);t.setAttribute(l,h)}const i=this.morphAttributes;for(const l in i){const c=[],h=i[l];for(let m=0,y=h.length;m<y;m++){const b=h[m],w=e(b,n);c.push(w)}t.morphAttributes[l]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let l=0,c=o.length;l<c;l++){const h=o[l];t.addGroup(h.start,h.count,h.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const c in n){const h=n[c];e.data.attributes[c]=h.toJSON(e.data)}const r={};let i=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],m=[];for(let y=0,b=h.length;y<b;y++){const w=h[y];m.push(w.toJSON(e.data))}m.length>0&&(r[c]=m,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere=l.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const r=e.attributes;for(const h in r){const m=r[h];this.setAttribute(h,m.clone(t))}const i=e.morphAttributes;for(const h in i){const m=[],y=i[h];for(let b=0,w=y.length;b<w;b++)m.push(y[b].clone(t));this.morphAttributes[h]=m}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let h=0,m=o.length;h<m;h++){const y=o[h];this.addGroup(y.start,y.count,y.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}},X_e=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=ZS,this.updateRanges=[],this.version=0,this.uuid=dm()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=dm()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=dm()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};const lu=new be;let iGe=class Y_e{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)lu.fromBufferAttribute(this,t),lu.applyMatrix4(e),this.setXYZ(t,lu.x,lu.y,lu.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)lu.fromBufferAttribute(this,t),lu.applyNormalMatrix(e),this.setXYZ(t,lu.x,lu.y,lu.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)lu.fromBufferAttribute(this,t),lu.transformDirection(e),this.setXYZ(t,lu.x,lu.y,lu.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=yu(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=vi(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=vi(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=vi(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=vi(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=vi(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=yu(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=yu(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=yu(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=yu(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=vi(t,this.array),n=vi(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=vi(t,this.array),n=vi(n,this.array),r=vi(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=vi(t,this.array),n=vi(n,this.array),r=vi(r,this.array),i=vi(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(e===void 0){_A("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)t.push(this.data.array[r+i])}return new ja(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Y_e(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){_A("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)t.push(this.data.array[r+i])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},sGe=0,Nc=class extends _d{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:sGe++}),this.uuid=dm(),this.name="",this.type="Material",this.blending=L0,this.side=Mc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=h5,this.blendDst=p5,this.blendEquation=i0,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Tn(0,0,0),this.blendAlpha=0,this.depthFunc=f5,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=CY,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=R6,this.stencilZFail=R6,this.stencilZPass=R6,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){qt(`Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){qt(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==L0&&(n.blending=this.blending),this.side!==Mc&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==h5&&(n.blendSrc=this.blendSrc),this.blendDst!==p5&&(n.blendDst=this.blendDst),this.blendEquation!==i0&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==f5&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==CY&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==R6&&(n.stencilFail=this.stencilFail),this.stencilZFail!==R6&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==R6&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.allowOverride===!1&&(n.allowOverride=!1),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(i){const o=[];for(const l in i){const c=i[l];delete c.metadata,o.push(c)}return o}if(t){const i=r(e.textures),o=r(e.images);i.length>0&&(n.textures=i),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};class oGe extends Nc{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Tn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const T3=new be,pq=new be,QD=new be,My=new be,fq=new be,JD=new be,mq=new be;let xw=class{constructor(e=new be,t=new be(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,T3)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=T3.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(T3.copy(this.origin).addScaledVector(this.direction,t),T3.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){pq.copy(e).add(t).multiplyScalar(.5),QD.copy(t).sub(e).normalize(),My.copy(this.origin).sub(pq);const i=e.distanceTo(t)*.5,o=-this.direction.dot(QD),l=My.dot(this.direction),c=-My.dot(QD),h=My.lengthSq(),m=Math.abs(1-o*o);let y,b,w,A;if(m>0)if(y=o*c-l,b=o*l-c,A=i*m,y>=0)if(b>=-A)if(b<=A){const I=1/m;y*=I,b*=I,w=y*(y+o*b+2*l)+b*(o*y+b+2*c)+h}else b=i,y=Math.max(0,-(o*b+l)),w=-y*y+b*(b+2*c)+h;else b=-i,y=Math.max(0,-(o*b+l)),w=-y*y+b*(b+2*c)+h;else b<=-A?(y=Math.max(0,-(-o*i+l)),b=y>0?-i:Math.min(Math.max(-i,-c),i),w=-y*y+b*(b+2*c)+h):b<=A?(y=0,b=Math.min(Math.max(-i,-c),i),w=b*(b+2*c)+h):(y=Math.max(0,-(o*i+l)),b=y>0?i:Math.min(Math.max(-i,-c),i),w=-y*y+b*(b+2*c)+h);else b=o>0?-i:i,y=Math.max(0,-(o*b+l)),w=-y*y+b*(b+2*c)+h;return n&&n.copy(this.origin).addScaledVector(this.direction,y),r&&r.copy(pq).addScaledVector(QD,b),w}intersectSphere(e,t){T3.subVectors(e.center,this.origin);const n=T3.dot(this.direction),r=T3.dot(T3)-n*n,i=e.radius*e.radius;if(r>i)return null;const o=Math.sqrt(i-r),l=n-o,c=n+o;return c<0?null:l<0?this.at(c,t):this.at(l,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,o,l,c;const h=1/this.direction.x,m=1/this.direction.y,y=1/this.direction.z,b=this.origin;return h>=0?(n=(e.min.x-b.x)*h,r=(e.max.x-b.x)*h):(n=(e.max.x-b.x)*h,r=(e.min.x-b.x)*h),m>=0?(i=(e.min.y-b.y)*m,o=(e.max.y-b.y)*m):(i=(e.max.y-b.y)*m,o=(e.min.y-b.y)*m),n>o||i>r||((i>n||isNaN(n))&&(n=i),(o<r||isNaN(r))&&(r=o),y>=0?(l=(e.min.z-b.z)*y,c=(e.max.z-b.z)*y):(l=(e.max.z-b.z)*y,c=(e.min.z-b.z)*y),n>c||l>r)||((l>n||n!==n)&&(n=l),(c<r||r!==r)&&(r=c),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,T3)!==null}intersectTriangle(e,t,n,r,i){fq.subVectors(t,e),JD.subVectors(n,e),mq.crossVectors(fq,JD);let o=this.direction.dot(mq),l;if(o>0){if(r)return null;l=1}else if(o<0)l=-1,o=-o;else return null;My.subVectors(this.origin,e);const c=l*this.direction.dot(JD.crossVectors(My,JD));if(c<0)return null;const h=l*this.direction.dot(fq.cross(My));if(h<0||c+h>o)return null;const m=-l*My.dot(mq);return m<0?null:this.at(m/o,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},rl=class extends Nc{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Tn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Sa,this.combine=WA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}};const o6e=new Pn,f6=new xw,eO=new xm,a6e=new be,tO=new be,nO=new be,rO=new be,gq=new be,iO=new be,l6e=new be,sO=new be;let gn=class extends Bi{constructor(e=new Ki,t=new rl){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,o=r.length;i<o;i++){const l=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=i}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const l=this.morphTargetInfluences;if(i&&l){iO.set(0,0,0);for(let c=0,h=i.length;c<h;c++){const m=l[c],y=i[c];m!==0&&(gq.fromBufferAttribute(y,e),o?iO.addScaledVector(gq,m):iO.addScaledVector(gq.sub(t),m))}t.add(iO)}return t}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),eO.copy(n.boundingSphere),eO.applyMatrix4(i),f6.copy(e.ray).recast(e.near),!(eO.containsPoint(f6.origin)===!1&&(f6.intersectSphere(eO,a6e)===null||f6.origin.distanceToSquared(a6e)>(e.far-e.near)**2))&&(o6e.copy(i).invert(),f6.copy(e.ray).applyMatrix4(o6e),!(n.boundingBox!==null&&f6.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,f6)))}_computeIntersections(e,t,n){let r;const i=this.geometry,o=this.material,l=i.index,c=i.attributes.position,h=i.attributes.uv,m=i.attributes.uv1,y=i.attributes.normal,b=i.groups,w=i.drawRange;if(l!==null)if(Array.isArray(o))for(let A=0,I=b.length;A<I;A++){const D=b[A],P=o[D.materialIndex],U=Math.max(D.start,w.start),j=Math.min(l.count,Math.min(D.start+D.count,w.start+w.count));for(let C=U,Z=j;C<Z;C+=3){const ie=l.getX(C),se=l.getX(C+1),z=l.getX(C+2);r=oO(this,P,e,n,h,m,y,ie,se,z),r&&(r.faceIndex=Math.floor(C/3),r.face.materialIndex=D.materialIndex,t.push(r))}}else{const A=Math.max(0,w.start),I=Math.min(l.count,w.start+w.count);for(let D=A,P=I;D<P;D+=3){const U=l.getX(D),j=l.getX(D+1),C=l.getX(D+2);r=oO(this,o,e,n,h,m,y,U,j,C),r&&(r.faceIndex=Math.floor(D/3),t.push(r))}}else if(c!==void 0)if(Array.isArray(o))for(let A=0,I=b.length;A<I;A++){const D=b[A],P=o[D.materialIndex],U=Math.max(D.start,w.start),j=Math.min(c.count,Math.min(D.start+D.count,w.start+w.count));for(let C=U,Z=j;C<Z;C+=3){const ie=C,se=C+1,z=C+2;r=oO(this,P,e,n,h,m,y,ie,se,z),r&&(r.faceIndex=Math.floor(C/3),r.face.materialIndex=D.materialIndex,t.push(r))}}else{const A=Math.max(0,w.start),I=Math.min(c.count,w.start+w.count);for(let D=A,P=I;D<P;D+=3){const U=D,j=D+1,C=D+2;r=oO(this,o,e,n,h,m,y,U,j,C),r&&(r.faceIndex=Math.floor(D/3),t.push(r))}}}};function aGe(s,e,t,n,r,i,o,l){let c;if(e.side===bs?c=n.intersectTriangle(o,i,r,!0,l):c=n.intersectTriangle(r,i,o,e.side===Mc,l),c===null)return null;sO.copy(l),sO.applyMatrix4(s.matrixWorld);const h=t.ray.origin.distanceTo(sO);return h<t.near||h>t.far?null:{distance:h,point:sO.clone(),object:s}}function oO(s,e,t,n,r,i,o,l,c,h){s.getVertexPosition(l,tO),s.getVertexPosition(c,nO),s.getVertexPosition(h,rO);const m=aGe(s,e,t,n,tO,nO,rO,l6e);if(m){const y=new be;FM.getBarycoord(l6e,tO,nO,rO,y),r&&(m.uv=FM.getInterpolatedAttribute(r,l,c,h,y,new Ln)),i&&(m.uv1=FM.getInterpolatedAttribute(i,l,c,h,y,new Ln)),o&&(m.normal=FM.getInterpolatedAttribute(o,l,c,h,y,new be),m.normal.dot(n.direction)>0&&m.normal.multiplyScalar(-1));const b={a:l,b:c,c:h,normal:new be,materialIndex:0};FM.getNormal(tO,nO,rO,b.normal),m.face=b,m.barycoord=y}return m}const c6e=new be,u6e=new zr,d6e=new zr,lGe=new be,h6e=new Pn,aO=new be,yq=new xm,p6e=new Pn,vq=new xw;class QK extends gn{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=H8e,this.bindMatrix=new Pn,this.bindMatrixInverse=new Pn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new i9),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,aO),this.boundingBox.expandByPoint(aO)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new xm),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,aO),this.boundingSphere.expandByPoint(aO)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,r=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),yq.copy(this.boundingSphere),yq.applyMatrix4(r),e.ray.intersectsSphere(yq)!==!1&&(p6e.copy(r).invert(),vq.copy(e.ray).applyMatrix4(p6e),!(this.boundingBox!==null&&vq.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,vq)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new zr,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===H8e?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===eVe?this.bindMatrixInverse.copy(this.bindMatrix).invert():qt("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;u6e.fromBufferAttribute(r.attributes.skinIndex,e),d6e.fromBufferAttribute(r.attributes.skinWeight,e),c6e.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let i=0;i<4;i++){const o=d6e.getComponent(i);if(o!==0){const l=u6e.getComponent(i);h6e.multiplyMatrices(n.bones[l].matrixWorld,n.boneInverses[l]),t.addScaledVector(lGe.copy(c6e).applyMatrix4(h6e),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class PY extends Bi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class j3 extends ol{constructor(e=null,t=1,n=1,r,i,o,l,c,h=Yi,m=Yi,y,b){super(null,o,l,c,h,m,r,i,y,b),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const f6e=new Pn,cGe=new Pn;class JK{constructor(e=[],t=[]){this.uuid=dm(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.previousBoneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){qt("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Pn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new Pn;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let i=0,o=e.length;i<o;i++){const l=e[i]?e[i].matrixWorld:cGe;f6e.multiplyMatrices(l,t[i]),f6e.toArray(n,i*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new JK(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new j3(t,e,e,io,vo);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const i=e.bones[n];let o=t[i];o===void 0&&(qt("Skeleton: No bone found with UUID:",i),o=new PY),this.bones.push(o),this.boneInverses.push(new Pn().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const o=t[r];e.bones.push(o.uuid);const l=n[r];e.boneInverses.push(l.toArray())}return e}}let s5=class extends ja{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}};const b_=new Pn,m6e=new Pn,lO=[],g6e=new i9,uGe=new Pn,VM=new gn,GM=new xm;class dGe extends gn{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new s5(new Float32Array(n*16),16),this.previousInstanceMatrix=null,this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<n;r++)this.setMatrixAt(r,uGe)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new i9),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,b_),g6e.copy(e.boundingBox).applyMatrix4(b_),this.boundingBox.union(g6e)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new xm),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,b_),GM.copy(e.boundingSphere).applyMatrix4(b_),this.boundingSphere.union(GM)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.previousInstanceMatrix!==null&&(this.previousInstanceMatrix=e.previousInstanceMatrix.clone()),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const n=t.morphTargetInfluences,r=this.morphTexture.source.data.data,i=n.length+1,o=e*i+1;for(let l=0;l<n.length;l++)n[l]=r[o+l]}raycast(e,t){const n=this.matrixWorld,r=this.count;if(VM.geometry=this.geometry,VM.material=this.material,VM.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),GM.copy(this.boundingSphere),GM.applyMatrix4(n),e.ray.intersectsSphere(GM)!==!1))for(let i=0;i<r;i++){this.getMatrixAt(i,b_),m6e.multiplyMatrices(n,b_),VM.matrixWorld=m6e,VM.raycast(e,lO);for(let o=0,l=lO.length;o<l;o++){const c=lO[o];c.instanceId=i,c.object=this,t.push(c)}lO.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new s5(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const n=t.morphTargetInfluences,r=n.length+1;this.morphTexture===null&&(this.morphTexture=new j3(new Float32Array(r*this.count),r,this.count,mw,vo));const i=this.morphTexture.source.data.data;let o=0;for(let h=0;h<n.length;h++)o+=n[h];const l=this.geometry.morphTargetsRelative?1:1-o,c=r*e;i[c]=l,i.set(n,c+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const xq=new be,hGe=new be,pGe=new ci;let dg=class{constructor(e=new be(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=xq.subVectors(n,t).cross(hGe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(xq),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||pGe.getNormalMatrix(e),r=this.coplanarPoint(xq).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const m6=new xm,fGe=new Ln(.5,.5),cO=new be;class YA{constructor(e=new dg,t=new dg,n=new dg,r=new dg,i=new dg,o=new dg){this.planes=[e,t,n,r,i,o]}set(e,t,n,r,i,o){const l=this.planes;return l[0].copy(e),l[1].copy(t),l[2].copy(n),l[3].copy(r),l[4].copy(i),l[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Tc,n=!1){const r=this.planes,i=e.elements,o=i[0],l=i[1],c=i[2],h=i[3],m=i[4],y=i[5],b=i[6],w=i[7],A=i[8],I=i[9],D=i[10],P=i[11],U=i[12],j=i[13],C=i[14],Z=i[15];if(r[0].setComponents(h-o,w-m,P-A,Z-U).normalize(),r[1].setComponents(h+o,w+m,P+A,Z+U).normalize(),r[2].setComponents(h+l,w+y,P+I,Z+j).normalize(),r[3].setComponents(h-l,w-y,P-I,Z-j).normalize(),n)r[4].setComponents(c,b,D,C).normalize(),r[5].setComponents(h-c,w-b,P-D,Z-C).normalize();else if(r[4].setComponents(h-c,w-b,P-D,Z-C).normalize(),t===Tc)r[5].setComponents(h+c,w+b,P+D,Z+C).normalize();else if(t===xh)r[5].setComponents(c,b,D,C).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),m6.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),m6.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(m6)}intersectsSprite(e){m6.center.set(0,0,0);const t=fGe.distanceTo(e.center);return m6.radius=.7071067811865476+t,m6.applyMatrix4(e.matrixWorld),this.intersectsSphere(m6)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let i=0;i<6;i++)if(t[i].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(cO.x=r.normal.x>0?e.max.x:e.min.x,cO.y=r.normal.y>0?e.max.y:e.min.y,cO.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(cO)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const $1=new Pn,W1=new YA;class eZ{constructor(){this.coordinateSystem=Tc}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if($1.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),W1.setFromProjectionMatrix($1,r.coordinateSystem,r.reversedDepth),W1.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if($1.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),W1.setFromProjectionMatrix($1,r.coordinateSystem,r.reversedDepth),W1.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if($1.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),W1.setFromProjectionMatrix($1,r.coordinateSystem,r.reversedDepth),W1.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if($1.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),W1.setFromProjectionMatrix($1,r.coordinateSystem,r.reversedDepth),W1.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if($1.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),W1.setFromProjectionMatrix($1,r.coordinateSystem,r.reversedDepth),W1.containsPoint(e))return!0}return!1}clone(){return new eZ}}class Sh extends Nc{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Tn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const cF=new be,uF=new be,y6e=new Pn,jM=new xw,uO=new xm,bq=new be,v6e=new be;class dd extends Bi{constructor(e=new Ki,t=new Sh){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let r=1,i=t.count;r<i;r++)cF.fromBufferAttribute(t,r-1),uF.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=cF.distanceTo(uF);e.setAttribute("lineDistance",new Fr(n,1))}else qt("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),uO.copy(n.boundingSphere),uO.applyMatrix4(r),uO.radius+=i,e.ray.intersectsSphere(uO)===!1)return;y6e.copy(r).invert(),jM.copy(e.ray).applyMatrix4(y6e);const l=i/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,h=this.isLineSegments?2:1,m=n.index,b=n.attributes.position;if(m!==null){const w=Math.max(0,o.start),A=Math.min(m.count,o.start+o.count);for(let I=w,D=A-1;I<D;I+=h){const P=m.getX(I),U=m.getX(I+1),j=dO(this,e,jM,c,P,U,I);j&&t.push(j)}if(this.isLineLoop){const I=m.getX(A-1),D=m.getX(w),P=dO(this,e,jM,c,I,D,A-1);P&&t.push(P)}}else{const w=Math.max(0,o.start),A=Math.min(b.count,o.start+o.count);for(let I=w,D=A-1;I<D;I+=h){const P=dO(this,e,jM,c,I,I+1,I);P&&t.push(P)}if(this.isLineLoop){const I=dO(this,e,jM,c,A-1,w,A-1);I&&t.push(I)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,o=r.length;i<o;i++){const l=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=i}}}}}function dO(s,e,t,n,r,i,o){const l=s.geometry.attributes.position;if(cF.fromBufferAttribute(l,r),uF.fromBufferAttribute(l,i),t.distanceSqToSegment(cF,uF,bq,v6e)>n)return;bq.applyMatrix4(s.matrixWorld);const h=e.ray.origin.distanceTo(bq);if(!(h<e.near||h>e.far))return{distance:h,point:v6e.clone().applyMatrix4(s.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:s}}const x6e=new be,b6e=new be;class KA extends dd{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let r=0,i=t.count;r<i;r+=2)x6e.fromBufferAttribute(t,r),b6e.fromBufferAttribute(t,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+x6e.distanceTo(b6e);e.setAttribute("lineDistance",new Fr(n,1))}else qt("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class tZ extends Nc{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Tn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const _6e=new Pn,RY=new xw,hO=new xm,pO=new be;class mGe extends Bi{constructor(e=new Ki,t=new tZ){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),hO.copy(n.boundingSphere),hO.applyMatrix4(r),hO.radius+=i,e.ray.intersectsSphere(hO)===!1)return;_6e.copy(r).invert(),RY.copy(e.ray).applyMatrix4(_6e);const l=i/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,h=n.index,y=n.attributes.position;if(h!==null){const b=Math.max(0,o.start),w=Math.min(h.count,o.start+o.count);for(let A=b,I=w;A<I;A++){const D=h.getX(A);pO.fromBufferAttribute(y,D),S6e(pO,D,c,r,e,t,this)}}else{const b=Math.max(0,o.start),w=Math.min(y.count,o.start+o.count);for(let A=b,I=w;A<I;A++)pO.fromBufferAttribute(y,A),S6e(pO,A,c,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,o=r.length;i<o;i++){const l=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=i}}}}}function S6e(s,e,t,n,r,i,o){const l=RY.distanceSqToPoint(s);if(l<t){const c=new be;RY.closestPointToPoint(s,c),c.applyMatrix4(n);const h=r.ray.origin.distanceTo(c);if(h<r.near||h>r.far)return;i.push({distance:h,distanceToRay:Math.sqrt(l),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}let nZ=class extends ol{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Yi,this.minFilter=Yi,this.generateMipmaps=!1,this.needsUpdate=!0}},yx=class extends ol{constructor(e=[],t=fm,n,r,i,o,l,c,h,m){super(e,t,n,r,i,o,l,c,h,m),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},Cc=class extends ol{constructor(e,t,n=Ds,r,i,o,l=Yi,c=Yi,h,m=B0,y=1){if(m!==B0&&m!==_u)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const b={width:e,height:t,depth:y};super(b,r,i,o,l,c,m,n,h),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new XK(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}};class K_e extends Cc{constructor(e,t=Ds,n=fm,r,i,o=Yi,l=Yi,c,h=B0){const m={width:e,height:e,depth:1},y=[m,m,m,m,m,m];super(e,e,t,n,r,i,o,l,c,h),this.image=y,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class Z_e extends ol{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}let _a=class Q_e extends Ki{constructor(e=1,t=1,n=1,r=1,i=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const l=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const c=[],h=[],m=[],y=[];let b=0,w=0;A("z","y","x",-1,-1,n,t,e,o,i,0),A("z","y","x",1,-1,n,t,-e,o,i,1),A("x","z","y",1,1,e,n,t,r,o,2),A("x","z","y",1,-1,e,n,-t,r,o,3),A("x","y","z",1,-1,e,t,n,r,i,4),A("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(c),this.setAttribute("position",new Fr(h,3)),this.setAttribute("normal",new Fr(m,3)),this.setAttribute("uv",new Fr(y,2));function A(I,D,P,U,j,C,Z,ie,se,z,re){const ye=C/se,H=Z/z,Me=C/2,Oe=Z/2,Ue=ie/2,Ie=se+1,ce=z+1;let Ve=0,Pe=0;const We=new be;for(let pt=0;pt<ce;pt++){const Ne=pt*H-Oe;for(let st=0;st<Ie;st++){const Pt=st*ye-Me;We[I]=Pt*U,We[D]=Ne*j,We[P]=Ue,h.push(We.x,We.y,We.z),We[I]=0,We[D]=0,We[P]=ie>0?1:-1,m.push(We.x,We.y,We.z),y.push(st/se),y.push(1-pt/z),Ve+=1}}for(let pt=0;pt<z;pt++)for(let Ne=0;Ne<se;Ne++){const st=b+Ne+Ie*pt,Pt=b+Ne+Ie*(pt+1),yn=b+(Ne+1)+Ie*(pt+1),bn=b+(Ne+1)+Ie*pt;c.push(st,Pt,bn),c.push(Pt,yn,bn),Pe+=6}l.addGroup(w,Pe,re),w+=Pe,b+=Ve}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Q_e(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};class sB extends Ki{constructor(e=1,t=32,n=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const i=[],o=[],l=[],c=[],h=new be,m=new Ln;o.push(0,0,0),l.push(0,0,1),c.push(.5,.5);for(let y=0,b=3;y<=t;y++,b+=3){const w=n+y/t*r;h.x=e*Math.cos(w),h.y=e*Math.sin(w),o.push(h.x,h.y,h.z),l.push(0,0,1),m.x=(o[b]/e+1)/2,m.y=(o[b+1]/e+1)/2,c.push(m.x,m.y)}for(let y=1;y<=t;y++)i.push(y,y+1,0);this.setIndex(i),this.setAttribute("position",new Fr(o,3)),this.setAttribute("normal",new Fr(l,3)),this.setAttribute("uv",new Fr(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sB(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class k0 extends Ki{constructor(e=1,t=1,n=1,r=32,i=1,o=!1,l=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:l,thetaLength:c};const h=this;r=Math.floor(r),i=Math.floor(i);const m=[],y=[],b=[],w=[];let A=0;const I=[],D=n/2;let P=0;U(),o===!1&&(e>0&&j(!0),t>0&&j(!1)),this.setIndex(m),this.setAttribute("position",new Fr(y,3)),this.setAttribute("normal",new Fr(b,3)),this.setAttribute("uv",new Fr(w,2));function U(){const C=new be,Z=new be;let ie=0;const se=(t-e)/n;for(let z=0;z<=i;z++){const re=[],ye=z/i,H=ye*(t-e)+e;for(let Me=0;Me<=r;Me++){const Oe=Me/r,Ue=Oe*c+l,Ie=Math.sin(Ue),ce=Math.cos(Ue);Z.x=H*Ie,Z.y=-ye*n+D,Z.z=H*ce,y.push(Z.x,Z.y,Z.z),C.set(Ie,se,ce).normalize(),b.push(C.x,C.y,C.z),w.push(Oe,1-ye),re.push(A++)}I.push(re)}for(let z=0;z<r;z++)for(let re=0;re<i;re++){const ye=I[re][z],H=I[re+1][z],Me=I[re+1][z+1],Oe=I[re][z+1];(e>0||re!==0)&&(m.push(ye,H,Oe),ie+=3),(t>0||re!==i-1)&&(m.push(H,Me,Oe),ie+=3)}h.addGroup(P,ie,0),P+=ie}function j(C){const Z=A,ie=new Ln,se=new be;let z=0;const re=C===!0?e:t,ye=C===!0?1:-1;for(let Me=1;Me<=r;Me++)y.push(0,D*ye,0),b.push(0,ye,0),w.push(.5,.5),A++;const H=A;for(let Me=0;Me<=r;Me++){const Ue=Me/r*c+l,Ie=Math.cos(Ue),ce=Math.sin(Ue);se.x=re*ce,se.y=D*ye,se.z=re*Ie,y.push(se.x,se.y,se.z),b.push(0,ye,0),ie.x=Ie*.5+.5,ie.y=ce*.5*ye+.5,w.push(ie.x,ie.y),A++}for(let Me=0;Me<r;Me++){const Oe=Z+Me,Ue=H+Me;C===!0?m.push(Ue,Ue+1,Oe):m.push(Ue+1,Ue,Oe),z+=3}h.addGroup(P,z,C===!0?1:2),P+=z}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new k0(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class rZ extends Ki{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],o=[];l(r),h(n),m(),this.setAttribute("position",new Fr(i,3)),this.setAttribute("normal",new Fr(i.slice(),3)),this.setAttribute("uv",new Fr(o,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function l(U){const j=new be,C=new be,Z=new be;for(let ie=0;ie<t.length;ie+=3)w(t[ie+0],j),w(t[ie+1],C),w(t[ie+2],Z),c(j,C,Z,U)}function c(U,j,C,Z){const ie=Z+1,se=[];for(let z=0;z<=ie;z++){se[z]=[];const re=U.clone().lerp(C,z/ie),ye=j.clone().lerp(C,z/ie),H=ie-z;for(let Me=0;Me<=H;Me++)Me===0&&z===ie?se[z][Me]=re:se[z][Me]=re.clone().lerp(ye,Me/H)}for(let z=0;z<ie;z++)for(let re=0;re<2*(ie-z)-1;re++){const ye=Math.floor(re/2);re%2===0?(b(se[z][ye+1]),b(se[z+1][ye]),b(se[z][ye])):(b(se[z][ye+1]),b(se[z+1][ye+1]),b(se[z+1][ye]))}}function h(U){const j=new be;for(let C=0;C<i.length;C+=3)j.x=i[C+0],j.y=i[C+1],j.z=i[C+2],j.normalize().multiplyScalar(U),i[C+0]=j.x,i[C+1]=j.y,i[C+2]=j.z}function m(){const U=new be;for(let j=0;j<i.length;j+=3){U.x=i[j+0],U.y=i[j+1],U.z=i[j+2];const C=D(U)/2/Math.PI+.5,Z=P(U)/Math.PI+.5;o.push(C,1-Z)}A(),y()}function y(){for(let U=0;U<o.length;U+=6){const j=o[U+0],C=o[U+2],Z=o[U+4],ie=Math.max(j,C,Z),se=Math.min(j,C,Z);ie>.9&&se<.1&&(j<.2&&(o[U+0]+=1),C<.2&&(o[U+2]+=1),Z<.2&&(o[U+4]+=1))}}function b(U){i.push(U.x,U.y,U.z)}function w(U,j){const C=U*3;j.x=e[C+0],j.y=e[C+1],j.z=e[C+2]}function A(){const U=new be,j=new be,C=new be,Z=new be,ie=new Ln,se=new Ln,z=new Ln;for(let re=0,ye=0;re<i.length;re+=9,ye+=6){U.set(i[re+0],i[re+1],i[re+2]),j.set(i[re+3],i[re+4],i[re+5]),C.set(i[re+6],i[re+7],i[re+8]),ie.set(o[ye+0],o[ye+1]),se.set(o[ye+2],o[ye+3]),z.set(o[ye+4],o[ye+5]),Z.copy(U).add(j).add(C).divideScalar(3);const H=D(Z);I(ie,ye+0,U,H),I(se,ye+2,j,H),I(z,ye+4,C,H)}}function I(U,j,C,Z){Z<0&&U.x===1&&(o[j]=U.x-1),C.x===0&&C.z===0&&(o[j]=Z/2/Math.PI+.5)}function D(U){return Math.atan2(U.z,-U.x)}function P(U){return Math.atan2(-U.y,Math.sqrt(U.x*U.x+U.z*U.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new rZ(e.vertices,e.indices,e.radius,e.detail)}}class J_e{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){qt("Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let r=0;const i=n.length;let o;t?o=t:o=e*n[i-1];let l=0,c=i-1,h;for(;l<=c;)if(r=Math.floor(l+(c-l)/2),h=n[r]-o,h<0)l=r+1;else if(h>0)c=r-1;else{c=r;break}if(r=c,n[r]===o)return r/(i-1);const m=n[r],b=n[r+1]-m,w=(o-m)/b;return(r+w)/(i-1)}getTangent(e,t){let r=e-1e-4,i=e+1e-4;r<0&&(r=0),i>1&&(i=1);const o=this.getPoint(r),l=this.getPoint(i),c=t||(o.isVector2?new Ln:new be);return c.copy(l).sub(o).normalize(),c}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new be,r=[],i=[],o=[],l=new be,c=new Pn;for(let w=0;w<=e;w++){const A=w/e;r[w]=this.getTangentAt(A,new be)}i[0]=new be,o[0]=new be;let h=Number.MAX_VALUE;const m=Math.abs(r[0].x),y=Math.abs(r[0].y),b=Math.abs(r[0].z);m<=h&&(h=m,n.set(1,0,0)),y<=h&&(h=y,n.set(0,1,0)),b<=h&&n.set(0,0,1),l.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],l),o[0].crossVectors(r[0],i[0]);for(let w=1;w<=e;w++){if(i[w]=i[w-1].clone(),o[w]=o[w-1].clone(),l.crossVectors(r[w-1],r[w]),l.length()>Number.EPSILON){l.normalize();const A=Math.acos(xi(r[w-1].dot(r[w]),-1,1));i[w].applyMatrix4(c.makeRotationAxis(l,A))}o[w].crossVectors(r[w],i[w])}if(t===!0){let w=Math.acos(xi(i[0].dot(i[e]),-1,1));w/=e,r[0].dot(l.crossVectors(i[0],i[e]))>0&&(w=-w);for(let A=1;A<=e;A++)i[A].applyMatrix4(c.makeRotationAxis(r[A],w*A)),o[A].crossVectors(r[A],i[A])}return{tangents:r,normals:i,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}function iZ(){let s=0,e=0,t=0,n=0;function r(i,o,l,c){s=i,e=l,t=-3*i+3*o-2*l-c,n=2*i-2*o+l+c}return{initCatmullRom:function(i,o,l,c,h){r(o,l,h*(l-i),h*(c-o))},initNonuniformCatmullRom:function(i,o,l,c,h,m,y){let b=(o-i)/h-(l-i)/(h+m)+(l-o)/m,w=(l-o)/m-(c-o)/(m+y)+(c-l)/y;b*=m,w*=m,r(o,l,b,w)},calc:function(i){const o=i*i,l=o*i;return s+e*i+t*o+n*l}}}const fO=new be,_q=new iZ,Sq=new iZ,wq=new iZ;class w6e extends J_e{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new be){const n=t,r=this.points,i=r.length,o=(i-(this.closed?0:1))*e;let l=Math.floor(o),c=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:c===0&&l===i-1&&(l=i-2,c=1);let h,m;this.closed||l>0?h=r[(l-1)%i]:(fO.subVectors(r[0],r[1]).add(r[0]),h=fO);const y=r[l%i],b=r[(l+1)%i];if(this.closed||l+2<i?m=r[(l+2)%i]:(fO.subVectors(r[i-1],r[i-2]).add(r[i-1]),m=fO),this.curveType==="centripetal"||this.curveType==="chordal"){const w=this.curveType==="chordal"?.5:.25;let A=Math.pow(h.distanceToSquared(y),w),I=Math.pow(y.distanceToSquared(b),w),D=Math.pow(b.distanceToSquared(m),w);I<1e-4&&(I=1),A<1e-4&&(A=I),D<1e-4&&(D=I),_q.initNonuniformCatmullRom(h.x,y.x,b.x,m.x,A,I,D),Sq.initNonuniformCatmullRom(h.y,y.y,b.y,m.y,A,I,D),wq.initNonuniformCatmullRom(h.z,y.z,b.z,m.z,A,I,D)}else this.curveType==="catmullrom"&&(_q.initCatmullRom(h.x,y.x,b.x,m.x,this.tension),Sq.initCatmullRom(h.y,y.y,b.y,m.y,this.tension),wq.initCatmullRom(h.z,y.z,b.z,m.z,this.tension));return n.set(_q.calc(c),Sq.calc(c),wq.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new be().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function gGe(s,e,t=2){const n=e&&e.length,r=n?e[0]*t:s.length;let i=eSe(s,0,r,t,!0);const o=[];if(!i||i.next===i.prev)return o;let l,c,h;if(n&&(i=_Ge(s,e,i,t)),s.length>80*t){l=s[0],c=s[1];let m=l,y=c;for(let b=t;b<r;b+=t){const w=s[b],A=s[b+1];w<l&&(l=w),A<c&&(c=A),w>m&&(m=w),A>y&&(y=A)}h=Math.max(m-l,y-c),h=h!==0?32767/h:0}return SA(i,o,t,l,c,h,0),o}function eSe(s,e,t,n,r){let i;if(r===IGe(s,e,t,n)>0)for(let o=e;o<t;o+=n)i=T6e(o/n|0,s[o],s[o+1],i);else for(let o=t-n;o>=e;o-=n)i=T6e(o/n|0,s[o],s[o+1],i);return i&&QS(i,i.next)&&(TA(i),i=i.next),i}function dx(s,e){if(!s)return s;e||(e=s);let t=s,n;do if(n=!1,!t.steiner&&(QS(t,t.next)||aa(t.prev,t,t.next)===0)){if(TA(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function SA(s,e,t,n,r,i,o){if(!s)return;!o&&i&&MGe(s,n,r,i);let l=s;for(;s.prev!==s.next;){const c=s.prev,h=s.next;if(i?vGe(s,n,r,i):yGe(s)){e.push(c.i,s.i,h.i),TA(s),s=h.next,l=h.next;continue}if(s=h,s===l){o?o===1?(s=xGe(dx(s),e),SA(s,e,t,n,r,i,2)):o===2&&bGe(s,e,t,n,r,i):SA(dx(s),e,t,n,r,i,1);break}}}function yGe(s){const e=s.prev,t=s,n=s.next;if(aa(e,t,n)>=0)return!1;const r=e.x,i=t.x,o=n.x,l=e.y,c=t.y,h=n.y,m=Math.min(r,i,o),y=Math.min(l,c,h),b=Math.max(r,i,o),w=Math.max(l,c,h);let A=n.next;for(;A!==e;){if(A.x>=m&&A.x<=b&&A.y>=y&&A.y<=w&&EC(r,l,i,c,o,h,A.x,A.y)&&aa(A.prev,A,A.next)>=0)return!1;A=A.next}return!0}function vGe(s,e,t,n){const r=s.prev,i=s,o=s.next;if(aa(r,i,o)>=0)return!1;const l=r.x,c=i.x,h=o.x,m=r.y,y=i.y,b=o.y,w=Math.min(l,c,h),A=Math.min(m,y,b),I=Math.max(l,c,h),D=Math.max(m,y,b),P=IY(w,A,e,t,n),U=IY(I,D,e,t,n);let j=s.prevZ,C=s.nextZ;for(;j&&j.z>=P&&C&&C.z<=U;){if(j.x>=w&&j.x<=I&&j.y>=A&&j.y<=D&&j!==r&&j!==o&&EC(l,m,c,y,h,b,j.x,j.y)&&aa(j.prev,j,j.next)>=0||(j=j.prevZ,C.x>=w&&C.x<=I&&C.y>=A&&C.y<=D&&C!==r&&C!==o&&EC(l,m,c,y,h,b,C.x,C.y)&&aa(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;j&&j.z>=P;){if(j.x>=w&&j.x<=I&&j.y>=A&&j.y<=D&&j!==r&&j!==o&&EC(l,m,c,y,h,b,j.x,j.y)&&aa(j.prev,j,j.next)>=0)return!1;j=j.prevZ}for(;C&&C.z<=U;){if(C.x>=w&&C.x<=I&&C.y>=A&&C.y<=D&&C!==r&&C!==o&&EC(l,m,c,y,h,b,C.x,C.y)&&aa(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function xGe(s,e){let t=s;do{const n=t.prev,r=t.next.next;!QS(n,r)&&nSe(n,t,t.next,r)&&wA(n,r)&&wA(r,n)&&(e.push(n.i,t.i,r.i),TA(t),TA(t.next),t=s=r),t=t.next}while(t!==s);return dx(t)}function bGe(s,e,t,n,r,i){let o=s;do{let l=o.next.next;for(;l!==o.prev;){if(o.i!==l.i&&NGe(o,l)){let c=rSe(o,l);o=dx(o,o.next),c=dx(c,c.next),SA(o,e,t,n,r,i,0),SA(c,e,t,n,r,i,0);return}l=l.next}o=o.next}while(o!==s)}function _Ge(s,e,t,n){const r=[];for(let i=0,o=e.length;i<o;i++){const l=e[i]*n,c=i<o-1?e[i+1]*n:s.length,h=eSe(s,l,c,n,!1);h===h.next&&(h.steiner=!0),r.push(AGe(h))}r.sort(SGe);for(let i=0;i<r.length;i++)t=wGe(r[i],t);return t}function SGe(s,e){let t=s.x-e.x;if(t===0&&(t=s.y-e.y,t===0)){const n=(s.next.y-s.y)/(s.next.x-s.x),r=(e.next.y-e.y)/(e.next.x-e.x);t=n-r}return t}function wGe(s,e){const t=TGe(s,e);if(!t)return e;const n=rSe(t,s);return dx(n,n.next),dx(t,t.next)}function TGe(s,e){let t=e;const n=s.x,r=s.y;let i=-1/0,o;if(QS(s,t))return t;do{if(QS(s,t.next))return t.next;if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const y=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(y<=n&&y>i&&(i=y,o=t.x<t.next.x?t:t.next,y===n))return o}t=t.next}while(t!==e);if(!o)return null;const l=o,c=o.x,h=o.y;let m=1/0;t=o;do{if(n>=t.x&&t.x>=c&&n!==t.x&&tSe(r<h?n:i,r,c,h,r<h?i:n,r,t.x,t.y)){const y=Math.abs(r-t.y)/(n-t.x);wA(t,s)&&(y<m||y===m&&(t.x>o.x||t.x===o.x&&EGe(o,t)))&&(o=t,m=y)}t=t.next}while(t!==l);return o}function EGe(s,e){return aa(s.prev,s,e.prev)<0&&aa(e.next,s,s.next)<0}function MGe(s,e,t,n){let r=s;do r.z===0&&(r.z=IY(r.x,r.y,e,t,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==s);r.prevZ.nextZ=null,r.prevZ=null,CGe(r)}function CGe(s){let e,t=1;do{let n=s,r;s=null;let i=null;for(e=0;n;){e++;let o=n,l=0;for(let h=0;h<t&&(l++,o=o.nextZ,!!o);h++);let c=t;for(;l>0||c>0&&o;)l!==0&&(c===0||!o||n.z<=o.z)?(r=n,n=n.nextZ,l--):(r=o,o=o.nextZ,c--),i?i.nextZ=r:s=r,r.prevZ=i,i=r;n=o}i.nextZ=null,t*=2}while(e>1);return s}function IY(s,e,t,n,r){return s=(s-t)*r|0,e=(e-n)*r|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function AGe(s){let e=s,t=s;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==s);return t}function tSe(s,e,t,n,r,i,o,l){return(r-o)*(e-l)>=(s-o)*(i-l)&&(s-o)*(n-l)>=(t-o)*(e-l)&&(t-o)*(i-l)>=(r-o)*(n-l)}function EC(s,e,t,n,r,i,o,l){return!(s===o&&e===l)&&tSe(s,e,t,n,r,i,o,l)}function NGe(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!PGe(s,e)&&(wA(s,e)&&wA(e,s)&&RGe(s,e)&&(aa(s.prev,s,e.prev)||aa(s,e.prev,e))||QS(s,e)&&aa(s.prev,s,s.next)>0&&aa(e.prev,e,e.next)>0)}function aa(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function QS(s,e){return s.x===e.x&&s.y===e.y}function nSe(s,e,t,n){const r=gO(aa(s,e,t)),i=gO(aa(s,e,n)),o=gO(aa(t,n,s)),l=gO(aa(t,n,e));return!!(r!==i&&o!==l||r===0&&mO(s,t,e)||i===0&&mO(s,n,e)||o===0&&mO(t,s,n)||l===0&&mO(t,e,n))}function mO(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function gO(s){return s>0?1:s<0?-1:0}function PGe(s,e){let t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&nSe(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}function wA(s,e){return aa(s.prev,s,s.next)<0?aa(s,e,s.next)>=0&&aa(s,s.prev,e)>=0:aa(s,e,s.prev)<0||aa(s,s.next,e)<0}function RGe(s,e){let t=s,n=!1;const r=(s.x+e.x)/2,i=(s.y+e.y)/2;do t.y>i!=t.next.y>i&&t.next.y!==t.y&&r<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==s);return n}function rSe(s,e){const t=kY(s.i,s.x,s.y),n=kY(e.i,e.x,e.y),r=s.next,i=e.prev;return s.next=e,e.prev=s,t.next=r,r.prev=t,n.next=t,t.prev=n,i.next=n,n.prev=i,n}function T6e(s,e,t,n){const r=kY(s,e,t);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function TA(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function kY(s,e,t){return{i:s,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function IGe(s,e,t,n){let r=0;for(let i=e,o=t-n;i<t;i+=n)r+=(s[o]-s[i])*(s[i+1]+s[o+1]),o=i;return r}class kGe{static triangulate(e,t,n=2){return gGe(e,t,n)}}class sZ{static area(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return n*.5}static isClockWise(e){return sZ.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];E6e(e),M6e(n,e);let o=e.length;t.forEach(E6e);for(let c=0;c<t.length;c++)r.push(o),o+=t[c].length,M6e(n,t[c]);const l=kGe.triangulate(n,r);for(let c=0;c<l.length;c+=3)i.push(l.slice(c,c+3));return i}}function E6e(s){const e=s.length;e>2&&s[e-1].equals(s[0])&&s.pop()}function M6e(s,e){for(let t=0;t<e.length;t++)s.push(e[t].x),s.push(e[t].y)}class H6 extends rZ{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new H6(e.radius,e.detail)}}class Ng extends Ki{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,o=t/2,l=Math.floor(n),c=Math.floor(r),h=l+1,m=c+1,y=e/l,b=t/c,w=[],A=[],I=[],D=[];for(let P=0;P<m;P++){const U=P*b-o;for(let j=0;j<h;j++){const C=j*y-i;A.push(C,-U,0),I.push(0,0,1),D.push(j/l),D.push(1-P/c)}}for(let P=0;P<c;P++)for(let U=0;U<l;U++){const j=U+h*P,C=U+h*(P+1),Z=U+1+h*(P+1),ie=U+1+h*P;w.push(j,C,ie),w.push(C,Z,ie)}this.setIndex(w),this.setAttribute("position",new Fr(A,3)),this.setAttribute("normal",new Fr(I,3)),this.setAttribute("uv",new Fr(D,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ng(e.width,e.height,e.widthSegments,e.heightSegments)}}class Mg extends Ki{constructor(e=1,t=32,n=16,r=0,i=Math.PI*2,o=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:l},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const c=Math.min(o+l,Math.PI);let h=0;const m=[],y=new be,b=new be,w=[],A=[],I=[],D=[];for(let P=0;P<=n;P++){const U=[],j=P/n;let C=0;P===0&&o===0?C=.5/t:P===n&&c===Math.PI&&(C=-.5/t);for(let Z=0;Z<=t;Z++){const ie=Z/t;y.x=-e*Math.cos(r+ie*i)*Math.sin(o+j*l),y.y=e*Math.cos(o+j*l),y.z=e*Math.sin(r+ie*i)*Math.sin(o+j*l),A.push(y.x,y.y,y.z),b.copy(y).normalize(),I.push(b.x,b.y,b.z),D.push(ie+C,1-j),U.push(h++)}m.push(U)}for(let P=0;P<n;P++)for(let U=0;U<t;U++){const j=m[P][U+1],C=m[P][U],Z=m[P+1][U],ie=m[P+1][U+1];(P!==0||o>0)&&w.push(j,C,ie),(P!==n-1||c<Math.PI)&&w.push(C,Z,ie)}this.setIndex(w),this.setAttribute("position",new Fr(A,3)),this.setAttribute("normal",new Fr(I,3)),this.setAttribute("uv",new Fr(D,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Mg(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class L6 extends Ki{constructor(e=1,t=.4,n=12,r=48,i=Math.PI*2,o=0,l=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i,thetaStart:o,thetaLength:l},n=Math.floor(n),r=Math.floor(r);const c=[],h=[],m=[],y=[],b=new be,w=new be,A=new be;for(let I=0;I<=n;I++){const D=o+I/n*l;for(let P=0;P<=r;P++){const U=P/r*i;w.x=(e+t*Math.cos(D))*Math.cos(U),w.y=(e+t*Math.cos(D))*Math.sin(U),w.z=t*Math.sin(D),h.push(w.x,w.y,w.z),b.x=e*Math.cos(U),b.y=e*Math.sin(U),A.subVectors(w,b).normalize(),m.push(A.x,A.y,A.z),y.push(P/r),y.push(I/n)}}for(let I=1;I<=n;I++)for(let D=1;D<=r;D++){const P=(r+1)*I+D-1,U=(r+1)*(I-1)+D-1,j=(r+1)*(I-1)+D,C=(r+1)*I+D;c.push(P,U,C),c.push(U,j,C)}this.setIndex(c),this.setAttribute("position",new Fr(h,3)),this.setAttribute("normal",new Fr(m,3)),this.setAttribute("uv",new Fr(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new L6(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class oZ extends Ki{constructor(e=1,t=.4,n=64,r=8,i=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},n=Math.floor(n),r=Math.floor(r);const l=[],c=[],h=[],m=[],y=new be,b=new be,w=new be,A=new be,I=new be,D=new be,P=new be;for(let j=0;j<=n;++j){const C=j/n*i*Math.PI*2;U(C,i,o,e,w),U(C+.01,i,o,e,A),D.subVectors(A,w),P.addVectors(A,w),I.crossVectors(D,P),P.crossVectors(I,D),I.normalize(),P.normalize();for(let Z=0;Z<=r;++Z){const ie=Z/r*Math.PI*2,se=-t*Math.cos(ie),z=t*Math.sin(ie);y.x=w.x+(se*P.x+z*I.x),y.y=w.y+(se*P.y+z*I.y),y.z=w.z+(se*P.z+z*I.z),c.push(y.x,y.y,y.z),b.subVectors(y,w).normalize(),h.push(b.x,b.y,b.z),m.push(j/n),m.push(Z/r)}}for(let j=1;j<=n;j++)for(let C=1;C<=r;C++){const Z=(r+1)*(j-1)+(C-1),ie=(r+1)*j+(C-1),se=(r+1)*j+C,z=(r+1)*(j-1)+C;l.push(Z,ie,z),l.push(ie,se,z)}this.setIndex(l),this.setAttribute("position",new Fr(c,3)),this.setAttribute("normal",new Fr(h,3)),this.setAttribute("uv",new Fr(m,2));function U(j,C,Z,ie,se){const z=Math.cos(j),re=Math.sin(j),ye=Z/C*j,H=Math.cos(ye);se.x=ie*(2+H)*.5*z,se.y=ie*(2+H)*re*.5,se.z=ie*Math.sin(ye)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new oZ(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class DGe extends Nc{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Tn(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}function JS(s){const e={};for(const t in s){e[t]={};for(const n in s[t]){const r=s[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(qt("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function uu(s){const e={};for(let t=0;t<s.length;t++){const n=JS(s[t]);for(const r in n)e[r]=n[r]}return e}function OGe(s){const e=[];for(let t=0;t<s.length;t++)e.push(s[t].clone());return e}function iSe(s){const e=s.getRenderTarget();return e===null?s.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Zn.workingColorSpace}const LGe={clone:JS,merge:uu};var FGe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,BGe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class bh extends Nc{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=FGe,this.fragmentShader=BGe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=JS(e.uniforms),this.uniformsGroups=OGe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this.defaultAttributeValues=Object.assign({},e.defaultAttributeValues),this.index0AttributeName=e.index0AttributeName,this.uniformsNeedUpdate=e.uniformsNeedUpdate,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class UGe extends bh{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class aZ extends Nc{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Tn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yg,this.normalScale=new Ln(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Sa,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class EA extends aZ{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ln(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return xi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Tn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Tn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Tn(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class $6 extends Nc{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Tn(16777215),this.specular=new Tn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yg,this.normalScale=new Ln(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Sa,this.combine=WA,this.reflectivity=1,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class zGe extends Nc{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Tn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yg,this.normalScale=new Ln(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class lZ extends Nc{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yg,this.normalScale=new Ln(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class sSe extends Nc{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Tn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yg,this.normalScale=new Ln(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Sa,this.combine=WA,this.reflectivity=1,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class oSe extends Nc{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=aVe,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class VGe extends Nc{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class cZ extends Nc{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Tn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yg,this.normalScale=new Ln(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class GGe extends Sh{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function yO(s,e){return!s||s.constructor===e?s:typeof e.BYTES_PER_ELEMENT=="number"?new e(s):Array.prototype.slice.call(s)}function jGe(s){function e(r,i){return s[r]-s[i]}const t=s.length,n=new Array(t);for(let r=0;r!==t;++r)n[r]=r;return n.sort(e),n}function C6e(s,e,t){const n=s.length,r=new s.constructor(n);for(let i=0,o=0;o!==n;++i){const l=t[i]*e;for(let c=0;c!==e;++c)r[o++]=s[l+c]}return r}function aSe(s,e,t,n){let r=1,i=s[0];for(;i!==void 0&&i[n]===void 0;)i=s[r++];if(i===void 0)return;let o=i[n];if(o!==void 0)if(Array.isArray(o))do o=i[n],o!==void 0&&(e.push(i.time),t.push(...o)),i=s[r++];while(i!==void 0);else if(o.toArray!==void 0)do o=i[n],o!==void 0&&(e.push(i.time),o.toArray(t,t.length)),i=s[r++];while(i!==void 0);else do o=i[n],o!==void 0&&(e.push(i.time),t.push(o)),i=s[r++];while(i!==void 0)}class ZA{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let o;n:{r:if(!(e<r)){for(let l=n+2;;){if(r===void 0){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===l)break;if(i=r,r=t[++n],e<r)break t}o=t.length;break n}if(!(e>=i)){const l=t[1];e<l&&(n=2,i=l);for(let c=n-2;;){if(i===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===c)break;if(r=i,i=t[--n-1],e>=i)break t}o=n,n=0;break n}break e}for(;n<o;){const l=n+o>>>1;e<t[l]?o=l:n=l+1}if(r=t[n],i=t[n-1],i===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let o=0;o!==r;++o)t[o]=n[i+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class HGe extends ZA{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:cS,endingEnd:cS}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,o=e+1,l=r[i],c=r[o];if(l===void 0)switch(this.getSettings_().endingStart){case uS:i=e,l=2*t-n;break;case lF:i=r.length-2,l=t+r[i]-r[i+1];break;default:i=e,l=n}if(c===void 0)switch(this.getSettings_().endingEnd){case uS:o=e,c=2*n-t;break;case lF:o=1,c=n+r[1]-r[0];break;default:o=e-1,c=t}const h=(n-t)*.5,m=this.valueSize;this._weightPrev=h/(t-l),this._weightNext=h/(c-n),this._offsetPrev=i*m,this._offsetNext=o*m}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,l=this.valueSize,c=e*l,h=c-l,m=this._offsetPrev,y=this._offsetNext,b=this._weightPrev,w=this._weightNext,A=(n-t)/(r-t),I=A*A,D=I*A,P=-b*D+2*b*I-b*A,U=(1+b)*D+(-1.5-2*b)*I+(-.5+b)*A+1,j=(-1-w)*D+(1.5+w)*I+.5*A,C=w*D-w*I;for(let Z=0;Z!==l;++Z)i[Z]=P*o[m+Z]+U*o[h+Z]+j*o[c+Z]+C*o[y+Z];return i}}class lSe extends ZA{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,l=this.valueSize,c=e*l,h=c-l,m=(n-t)/(r-t),y=1-m;for(let b=0;b!==l;++b)i[b]=o[h+b]*y+o[c+b]*m;return i}}class $Ge extends ZA{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class WGe extends ZA{interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,l=this.valueSize,c=e*l,h=c-l,m=this.settings||this.DefaultSettings_,y=m.inTangents,b=m.outTangents;if(!y||!b){const I=(n-t)/(r-t),D=1-I;for(let P=0;P!==l;++P)i[P]=o[h+P]*D+o[c+P]*I;return i}const w=l*2,A=e-1;for(let I=0;I!==l;++I){const D=o[h+I],P=o[c+I],U=A*w+I*2,j=b[U],C=b[U+1],Z=e*w+I*2,ie=y[Z],se=y[Z+1];let z=(n-t)/(r-t),re,ye,H,Me,Oe;for(let Ue=0;Ue<8;Ue++){re=z*z,ye=re*z,H=1-z,Me=H*H,Oe=Me*H;const ce=Oe*t+3*Me*z*j+3*H*re*ie+ye*r-n;if(Math.abs(ce)<1e-10)break;const Ve=3*Me*(j-t)+6*H*z*(ie-j)+3*re*(r-ie);if(Math.abs(Ve)<1e-10)break;z=z-ce/Ve,z=Math.max(0,Math.min(1,z))}i[I]=Oe*D+3*Me*z*C+3*H*re*se+ye*P}return i}}class bm{constructor(e,t,n,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=yO(t,this.TimeBufferType),this.values=yO(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:yO(e.times,Array),values:yO(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(n.interpolation=r)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new $Ge(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new lSe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new HGe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodBezier(e){const t=new WGe(this.times,this.values,this.getValueSize(),e);return this.settings&&(t.settings=this.settings),t}setInterpolation(e){let t;switch(e){case aF:t=this.InterpolantFactoryMethodDiscrete;break;case MY:t=this.InterpolantFactoryMethodLinear;break;case YW:t=this.InterpolantFactoryMethodSmooth;break;case $8e:t=this.InterpolantFactoryMethodBezier;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return qt("KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return aF;case this.InterpolantFactoryMethodLinear:return MY;case this.InterpolantFactoryMethodSmooth:return YW;case this.InterpolantFactoryMethodBezier:return $8e}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,o=r-1;for(;i!==r&&n[i]<e;)++i;for(;o!==-1&&n[o]>t;)--o;if(++o,i!==0||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const l=this.getValueSize();this.times=n.slice(i,o),this.values=this.values.slice(i*l,o*l)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(Ht("KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;i===0&&(Ht("KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let l=0;l!==i;l++){const c=n[l];if(typeof c=="number"&&isNaN(c)){Ht("KeyframeTrack: Time is not a valid number.",this,l,c),e=!1;break}if(o!==null&&o>c){Ht("KeyframeTrack: Out of order keys.",this,l,c,o),e=!1;break}o=c}if(r!==void 0&&xA(r))for(let l=0,c=r.length;l!==c;++l){const h=r[l];if(isNaN(h)){Ht("KeyframeTrack: Value is not a valid number.",this,l,h),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===YW,i=e.length-1;let o=1;for(let l=1;l<i;++l){let c=!1;const h=e[l],m=e[l+1];if(h!==m&&(l!==1||h!==e[0]))if(r)c=!0;else{const y=l*n,b=y-n,w=y+n;for(let A=0;A!==n;++A){const I=t[y+A];if(I!==t[b+A]||I!==t[w+A]){c=!0;break}}}if(c){if(l!==o){e[o]=e[l];const y=l*n,b=o*n;for(let w=0;w!==n;++w)t[b+w]=t[y+w]}++o}}if(i>0){e[o]=e[i];for(let l=i*n,c=o*n,h=0;h!==n;++h)t[c+h]=t[l+h];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,r=new n(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}bm.prototype.ValueTypeName="";bm.prototype.TimeBufferType=Float32Array;bm.prototype.ValueBufferType=Float32Array;bm.prototype.DefaultInterpolation=MY;class bw extends bm{constructor(e,t,n){super(e,t,n)}}bw.prototype.ValueTypeName="bool";bw.prototype.ValueBufferType=Array;bw.prototype.DefaultInterpolation=aF;bw.prototype.InterpolantFactoryMethodLinear=void 0;bw.prototype.InterpolantFactoryMethodSmooth=void 0;class cSe extends bm{constructor(e,t,n,r){super(e,t,n,r)}}cSe.prototype.ValueTypeName="color";class MA extends bm{constructor(e,t,n,r){super(e,t,n,r)}}MA.prototype.ValueTypeName="number";class qGe extends ZA{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,l=this.valueSize,c=(n-t)/(r-t);let h=e*l;for(let m=h+l;h!==m;h+=4)vs.slerpFlat(i,0,o,h-l,o,h,c);return i}}class ew extends bm{constructor(e,t,n,r){super(e,t,n,r)}InterpolantFactoryMethodLinear(e){return new qGe(this.times,this.values,this.getValueSize(),e)}}ew.prototype.ValueTypeName="quaternion";ew.prototype.InterpolantFactoryMethodSmooth=void 0;class _w extends bm{constructor(e,t,n){super(e,t,n)}}_w.prototype.ValueTypeName="string";_w.prototype.ValueBufferType=Array;_w.prototype.DefaultInterpolation=aF;_w.prototype.InterpolantFactoryMethodLinear=void 0;_w.prototype.InterpolantFactoryMethodSmooth=void 0;class CA extends bm{constructor(e,t,n,r){super(e,t,n,r)}}CA.prototype.ValueTypeName="vector";class DY{constructor(e="",t=-1,n=[],r=zK){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=dm(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let o=0,l=n.length;o!==l;++o)t.push(YGe(n[o]).scale(r));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i.userData=JSON.parse(e.userData||"{}"),i}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let i=0,o=n.length;i!==o;++i)t.push(bm.toJSON(n[i]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const i=t.length,o=[];for(let l=0;l<i;l++){let c=[],h=[];c.push((l+i-1)%i,l,(l+1)%i),h.push(0,1,0);const m=jGe(c);c=C6e(c,1,m),h=C6e(h,1,m),!r&&c[0]===0&&(c.push(i),h.push(h[0])),o.push(new MA(".morphTargetInfluences["+t[l].name+"]",c,h).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const r=e;n=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let l=0,c=e.length;l<c;l++){const h=e[l],m=h.name.match(i);if(m&&m.length>1){const y=m[1];let b=r[y];b||(r[y]=b=[]),b.push(h)}}const o=[];for(const l in r)o.push(this.CreateFromMorphTargetSequence(l,r[l],t,n));return o}static parseAnimation(e,t){if(qt("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return Ht("AnimationClip: No animation in JSONLoader data."),null;const n=function(y,b,w,A,I){if(w.length!==0){const D=[],P=[];aSe(w,D,P,A),D.length!==0&&I.push(new y(b,D,P))}},r=[],i=e.name||"default",o=e.fps||30,l=e.blendMode;let c=e.length||-1;const h=e.hierarchy||[];for(let y=0;y<h.length;y++){const b=h[y].keys;if(!(!b||b.length===0))if(b[0].morphTargets){const w={};let A;for(A=0;A<b.length;A++)if(b[A].morphTargets)for(let I=0;I<b[A].morphTargets.length;I++)w[b[A].morphTargets[I]]=-1;for(const I in w){const D=[],P=[];for(let U=0;U!==b[A].morphTargets.length;++U){const j=b[A];D.push(j.time),P.push(j.morphTarget===I?1:0)}r.push(new MA(".morphTargetInfluence["+I+"]",D,P))}c=w.length*o}else{const w=".bones["+t[y].name+"]";n(CA,w+".position",b,"pos",r),n(ew,w+".quaternion",b,"rot",r),n(CA,w+".scale",b,"scl",r)}}return r.length===0?null:new this(i,c,r,l)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,r=e.length;n!==r;++n){const i=this.tracks[n];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function XGe(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return MA;case"vector":case"vector2":case"vector3":case"vector4":return CA;case"color":return cSe;case"quaternion":return ew;case"bool":case"boolean":return bw;case"string":return _w}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+s)}function YGe(s){if(s.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=XGe(s.type);if(s.times===void 0){const t=[],n=[];aSe(s.keys,t,n,"value"),s.times=t,s.values=n}return e.parse!==void 0?e.parse(s):new e(s.name,s.times,s.values,s.interpolation)}const zC={enabled:!1,files:{},add:function(s,e){this.enabled!==!1&&(A6e(s)||(this.files[s]=e))},get:function(s){if(this.enabled!==!1&&!A6e(s))return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};function A6e(s){try{const e=s.slice(s.indexOf(":")+1);return new URL(e).protocol==="blob:"}catch{return!1}}class KGe{constructor(e,t,n){const r=this;let i=!1,o=0,l=0,c;const h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this._abortController=null,this.itemStart=function(m){l++,i===!1&&r.onStart!==void 0&&r.onStart(m,o,l),i=!0},this.itemEnd=function(m){o++,r.onProgress!==void 0&&r.onProgress(m,o,l),o===l&&(i=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(m){r.onError!==void 0&&r.onError(m)},this.resolveURL=function(m){return c?c(m):m},this.setURLModifier=function(m){return c=m,this},this.addHandler=function(m,y){return h.push(m,y),this},this.removeHandler=function(m){const y=h.indexOf(m);return y!==-1&&h.splice(y,2),this},this.getHandler=function(m){for(let y=0,b=h.length;y<b;y+=2){const w=h[y],A=h[y+1];if(w.global&&(w.lastIndex=0),w.test(m))return A}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const ZGe=new KGe;class m5{constructor(e){this.manager=e!==void 0?e:ZGe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,i){n.load(e,r,t,i)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}m5.DEFAULT_MATERIAL_NAME="__DEFAULT";const E3={};class QGe extends Error{constructor(e,t){super(e),this.response=t}}class JGe extends m5{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const i=zC.get(`file:${e}`);if(i!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(i),this.manager.itemEnd(e)},0),i;if(E3[e]!==void 0){E3[e].push({onLoad:t,onProgress:n,onError:r});return}E3[e]=[],E3[e].push({onLoad:t,onProgress:n,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),l=this.mimeType,c=this.responseType;fetch(o).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&qt("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;const m=E3[e],y=h.body.getReader(),b=h.headers.get("X-File-Size")||h.headers.get("Content-Length"),w=b?parseInt(b):0,A=w!==0;let I=0;const D=new ReadableStream({start(P){U();function U(){y.read().then(({done:j,value:C})=>{if(j)P.close();else{I+=C.byteLength;const Z=new ProgressEvent("progress",{lengthComputable:A,loaded:I,total:w});for(let ie=0,se=m.length;ie<se;ie++){const z=m[ie];z.onProgress&&z.onProgress(Z)}P.enqueue(C),U()}},j=>{P.error(j)})}}});return new Response(D)}else throw new QGe(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(c){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(m=>new DOMParser().parseFromString(m,l));case"json":return h.json();default:if(l==="")return h.text();{const y=/charset="?([^;"\s]*)"?/i.exec(l),b=y&&y[1]?y[1].toLowerCase():void 0,w=new TextDecoder(b);return h.arrayBuffer().then(A=>w.decode(A))}}}).then(h=>{zC.add(`file:${e}`,h);const m=E3[e];delete E3[e];for(let y=0,b=m.length;y<b;y++){const w=m[y];w.onLoad&&w.onLoad(h)}}).catch(h=>{const m=E3[e];if(m===void 0)throw this.manager.itemError(e),h;delete E3[e];for(let y=0,b=m.length;y<b;y++){const w=m[y];w.onError&&w.onError(h)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}const __=new WeakMap;class uSe extends m5{constructor(e){super(e)}load(e,t,n,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=zC.get(`image:${e}`);if(o!==void 0){if(o.complete===!0)i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0);else{let y=__.get(o);y===void 0&&(y=[],__.set(o,y)),y.push({onLoad:t,onError:r})}return o}const l=bA("img");function c(){m(),t&&t(this);const y=__.get(this)||[];for(let b=0;b<y.length;b++){const w=y[b];w.onLoad&&w.onLoad(this)}__.delete(this),i.manager.itemEnd(e)}function h(y){m(),r&&r(y),zC.remove(`image:${e}`);const b=__.get(this)||[];for(let w=0;w<b.length;w++){const A=b[w];A.onError&&A.onError(y)}__.delete(this),i.manager.itemError(e),i.manager.itemEnd(e)}function m(){l.removeEventListener("load",c,!1),l.removeEventListener("error",h,!1)}return l.addEventListener("load",c,!1),l.addEventListener("error",h,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),zC.add(`image:${e}`,l),i.manager.itemStart(e),l.src=e,l}}class eje extends m5{constructor(e){super(e)}load(e,t,n,r){const i=new yx;i.colorSpace=Is;const o=new uSe(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let l=0;function c(h){o.load(e[h],function(m){i.images[h]=m,l++,l===6&&(i.needsUpdate=!0,t&&t(i))},void 0,r)}for(let h=0;h<e.length;++h)c(h);return i}}class dSe extends m5{constructor(e){super(e)}load(e,t,n,r){const i=new ol,o=new uSe(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(l){i.image=l,i.needsUpdate=!0,t!==void 0&&t(i)},n,r),i}}class vx extends Bi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Tn(e),this.intensity=t}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t}}class hSe extends vx{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Bi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Tn(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}toJSON(e){const t=super.toJSON(e);return t.object.groundColor=this.groundColor.getHex(),t}}const Tq=new Pn,N6e=new be,P6e=new be;class uZ{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.biasNode=null,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ln(512,512),this.mapType=yo,this.map=null,this.mapPass=null,this.matrix=new Pn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new YA,this._frameExtents=new Ln(1,1),this._viewportCount=1,this._viewports=[new zr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;N6e.setFromMatrixPosition(e.matrixWorld),t.position.copy(N6e),P6e.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(P6e),t.updateMatrixWorld(),Tq.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Tq,t.coordinateSystem,t.reversedDepth),t.coordinateSystem===xh||t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Tq)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this.biasNode=e.biasNode,this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}const vO=new be,xO=new vs,q1=new be;let dZ=class extends Bi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Pn,this.projectionMatrix=new Pn,this.projectionMatrixInverse=new Pn,this.coordinateSystem=Tc,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorld.decompose(vO,xO,q1),q1.x===1&&q1.y===1&&q1.z===1?this.matrixWorldInverse.copy(this.matrixWorld).invert():this.matrixWorldInverse.compose(vO,xO,q1.set(1,1,1)).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorld.decompose(vO,xO,q1),q1.x===1&&q1.y===1&&q1.z===1?this.matrixWorldInverse.copy(this.matrixWorld).invert():this.matrixWorldInverse.compose(vO,xO,q1.set(1,1,1)).invert()}clone(){return new this.constructor().copy(this)}};const Cy=new be,R6e=new Ln,I6e=new Ln;let Va=class extends dZ{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=ux*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(BC*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return ux*2*Math.atan(Math.tan(BC*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Cy.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Cy.x,Cy.y).multiplyScalar(-e/Cy.z),Cy.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Cy.x,Cy.y).multiplyScalar(-e/Cy.z)}getViewSize(e,t){return this.getViewBounds(e,R6e,I6e),t.subVectors(I6e,R6e)}setViewOffset(e,t,n,r,i,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(BC*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,h=o.fullHeight;i+=o.offsetX*r/c,t-=o.offsetY*n/h,r*=o.width/c,n*=o.height/h}const l=this.filmOffset;l!==0&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};class tje extends uZ{constructor(){super(new Va(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=ux*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,i=e.distance||t.far;(n!==t.fov||r!==t.aspect||i!==t.far)&&(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Sw extends vx{constructor(e,t,n=0,r=Math.PI/3,i=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Bi.DEFAULT_UP),this.updateMatrix(),this.target=new Bi,this.distance=n,this.angle=r,this.penumbra=i,this.decay=o,this.map=null,this.shadow=new tje}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.map=e.map,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.angle=this.angle,t.object.decay=this.decay,t.object.penumbra=this.penumbra,t.object.target=this.target.uuid,this.map&&this.map.isTexture&&(t.object.map=this.map.toJSON(e).uuid),t.object.shadow=this.shadow.toJSON(),t}}class nje extends uZ{constructor(){super(new Va(90,1,.5,500)),this.isPointLightShadow=!0}}class dF extends vx{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new nje}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.decay=this.decay,t.object.shadow=this.shadow.toJSON(),t}}class J3 extends dZ{constructor(e=-1,t=1,n=1,r=-1,i=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,o=n+e,l=r+t,c=r-t;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,m=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=h*this.view.offsetX,o=i+h*this.view.width,l-=m*this.view.offsetY,c=l-m*this.view.height}this.projectionMatrix.makeOrthographic(i,o,l,c,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class rje extends uZ{constructor(){super(new J3(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class QA extends vx{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Bi.DEFAULT_UP),this.updateMatrix(),this.target=new Bi,this.shadow=new rje}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.shadow=this.shadow.toJSON(),t.object.target=this.target.uuid,t}}class pSe extends vx{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class fSe extends vx{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class ije{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new be)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*i),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*r)),t.addScaledVector(o[5],1.092548*(r*i)),t.addScaledVector(o[6],.315392*(3*i*i-1)),t.addScaledVector(o[7],1.092548*(n*i)),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*i),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*r),t.addScaledVector(o[5],2*.429043*r*i),t.addScaledVector(o[6],.743125*i*i-.247708),t.addScaledVector(o[7],2*.429043*n*i),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}class sje extends vx{constructor(e=new ije,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class oje{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}const S_=-90,w_=1;let mSe=class extends Bi{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Va(S_,w_,e,t);r.layers=this.layers,this.add(r);const i=new Va(S_,w_,e,t);i.layers=this.layers,this.add(i);const o=new Va(S_,w_,e,t);o.layers=this.layers,this.add(o);const l=new Va(S_,w_,e,t);l.layers=this.layers,this.add(l);const c=new Va(S_,w_,e,t);c.layers=this.layers,this.add(c);const h=new Va(S_,w_,e,t);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,i,o,l,c]=t;for(const h of t)this.remove(h);if(e===Tc)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===xh)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const h of t)this.add(h),h.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,o,l,c,h,m]=this.children,y=e.getRenderTarget(),b=e.getActiveCubeFace(),w=e.getActiveMipmapLevel(),A=e.xr.enabled;e.xr.enabled=!1;const I=n.texture.generateMipmaps;n.texture.generateMipmaps=!1;let D=!1;e.isWebGLRenderer===!0?D=e.state.buffers.depth.getReversed():D=e.reversedDepthBuffer,e.setRenderTarget(n,0,r),D&&e.autoClear===!1&&e.clearDepth(),e.render(t,i),e.setRenderTarget(n,1,r),D&&e.autoClear===!1&&e.clearDepth(),e.render(t,o),e.setRenderTarget(n,2,r),D&&e.autoClear===!1&&e.clearDepth(),e.render(t,l),e.setRenderTarget(n,3,r),D&&e.autoClear===!1&&e.clearDepth(),e.render(t,c),e.setRenderTarget(n,4,r),D&&e.autoClear===!1&&e.clearDepth(),e.render(t,h),n.texture.generateMipmaps=I,e.setRenderTarget(n,5,r),D&&e.autoClear===!1&&e.clearDepth(),e.render(t,m),e.setRenderTarget(y,b,w),e.xr.enabled=A,n.texture.needsPMREMUpdate=!0}};class gSe extends Va{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class aje{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,e.hidden!==void 0&&(this._pageVisibilityHandler=lje.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(e!==void 0?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function lje(){this._document.hidden===!1&&this.reset()}class cje{constructor(e,t,n){this.binding=e,this.valueSize=n;let r,i,o;switch(t){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let l=0;l!==r;++l)n[i+l]=n[l];o=t}else{o+=t;const l=t/o;this._mixBufferRegion(n,i,0,l,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,l=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const c=t*this._origIndex;this._mixBufferRegion(n,r,c,1-i,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let c=t,h=t+t;c!==h;++c)if(n[c]!==n[c+t]){l.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let i=n,o=r;i!==o;++i)t[i]=t[r+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,i){if(r>=.5)for(let o=0;o!==i;++o)e[t+o]=e[n+o]}_slerp(e,t,n,r){vs.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){const o=this._workIndex*i;vs.multiplyQuaternionsFlat(e,o,e,t,e,n),vs.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,n,r,i){const o=1-r;for(let l=0;l!==i;++l){const c=t+l;e[c]=e[c]*o+e[n+l]*r}}_lerpAdditive(e,t,n,r,i){for(let o=0;o!==i;++o){const l=t+o;e[l]=e[l]+e[n+o]*r}}}const hZ="\\[\\]\\.:\\/",uje=new RegExp("["+hZ+"]","g"),pZ="[^"+hZ+"]",dje="[^"+hZ.replace("\\.","")+"]",hje=/((?:WC+[\/:])*)/.source.replace("WC",pZ),pje=/(WCOD+)?/.source.replace("WCOD",dje),fje=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",pZ),mje=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",pZ),gje=new RegExp("^"+hje+pje+fje+mje+"$"),yje=["material","materials","bones","map"];class vje{constructor(e,t,n){const r=n||us.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];r!==void 0&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class us{constructor(e,t,n){this.path=t,this.parsedPath=n||us.parseTrackName(t),this.node=us.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new us.Composite(e,t,n):new us(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(uje,"")}static parseTrackName(e){const t=gje.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const i=n.nodeName.substring(r+1);yje.indexOf(i)!==-1&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(i){for(let o=0;o<i.length;o++){const l=i[o];if(l.name===t||l.uuid===t)return l;const c=n(l.children);if(c)return c}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=us.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){qt("PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let h=t.objectIndex;switch(n){case"materials":if(!e.material){Ht("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){Ht("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){Ht("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let m=0;m<e.length;m++)if(e[m].name===h){h=m;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){Ht("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){Ht("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){Ht("PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(h!==void 0){if(e[h]===void 0){Ht("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}const o=e[r];if(o===void 0){const h=t.nodeName;Ht("PropertyBinding: Trying to update property for track: "+h+"."+r+" but it wasn't found.",e);return}let l=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?l=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(i!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){Ht("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){Ht("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[i]!==void 0&&(i=e.morphTargetDictionary[i])}c=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else o.fromArray!==void 0&&o.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(c=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}us.Composite=vje;us.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};us.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};us.prototype.GetterByBindingType=[us.prototype._getValue_direct,us.prototype._getValue_array,us.prototype._getValue_arrayElement,us.prototype._getValue_toArray];us.prototype.SetterByBindingTypeAndVersioning=[[us.prototype._setValue_direct,us.prototype._setValue_direct_setNeedsUpdate,us.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[us.prototype._setValue_array,us.prototype._setValue_array_setNeedsUpdate,us.prototype._setValue_array_setMatrixWorldNeedsUpdate],[us.prototype._setValue_arrayElement,us.prototype._setValue_arrayElement_setNeedsUpdate,us.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[us.prototype._setValue_fromArray,us.prototype._setValue_fromArray_setNeedsUpdate,us.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class xje{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,o=i.length,l=new Array(o),c={endingStart:cS,endingEnd:cS};for(let h=0;h!==o;++h){const m=i[h].createInterpolant(null);l[h]=m,m.settings=c}this._interpolantSettings=c,this._interpolants=l,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=iVe,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n=!1){if(e.fadeOut(t),this.fadeIn(t),n===!0){const r=this._clip.duration,i=e._clip.duration,o=i/r,l=r/i;e.warp(1,o,t),this.warp(l,1,t)}return this}crossFadeTo(e,t,n=!1){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,o=this.timeScale;let l=this._timeScaleInterpolant;l===null&&(l=r._lendControlInterpolant(),this._timeScaleInterpolant=l);const c=l.parameterPositions,h=l.sampleValues;return c[0]=i,c[1]=i+n,h[0]=e/o,h[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled){this._updateWeight(e);return}const i=this._startTime;if(i!==null){const c=(e-i)*n;c<0||n===0?t=0:(this._startTime=null,t=n*c)}t*=this._updateTimeScale(e);const o=this._updateTime(t),l=this._updateWeight(e);if(l>0){const c=this._interpolants,h=this._propertyBindings;switch(this.blendMode){case oVe:for(let m=0,y=c.length;m!==y;++m)c[m].evaluate(o),h[m].accumulateAdditive(l);break;case zK:default:for(let m=0,y=c.length;m!==y;++m)c[m].evaluate(o),h[m].accumulate(r,l)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const o=n===sVe;if(e===0)return i===-1?r:o&&(i&1)===1?t-r:r;if(n===rVe){i===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(i===-1&&(e>=0?(i=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=t||r<0){const l=Math.floor(r/t);r-=t*l,i+=Math.abs(l);const c=this.repetitions-i;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(c===1){const h=e<0;this._setEndings(h,!h,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:l})}}else this.time=r;if(o&&(i&1)===1)return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=uS,r.endingEnd=uS):(e?r.endingStart=this.zeroSlopeAtStart?uS:cS:r.endingStart=lF,t?r.endingEnd=this.zeroSlopeAtEnd?uS:cS:r.endingEnd=lF)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=i,c[0]=t,l[1]=i+e,c[1]=n,this}}const bje=new Float32Array(1);class _je extends _d{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,o=e._propertyBindings,l=e._interpolants,c=n.uuid,h=this._bindingsByRootAndName;let m=h[c];m===void 0&&(m={},h[c]=m);for(let y=0;y!==i;++y){const b=r[y],w=b.name;let A=m[w];if(A!==void 0)++A.referenceCount,o[y]=A;else{if(A=o[y],A!==void 0){A._cacheIndex===null&&(++A.referenceCount,this._addInactiveBinding(A,c,w));continue}const I=t&&t._propertyBindings[y].binding.parsedPath;A=new cje(us.create(n,w,I),b.ValueTypeName,b.getValueSize()),++A.referenceCount,this._addInactiveBinding(A,c,w),o[y]=A}l[y].resultBuffer=A.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,r=e._clip.uuid,i=this._actionsByClip[r];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,r,n)}const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const i=t[n];i.useCount++===0&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const i=t[n];--i.useCount===0&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,i=this._actionsByClip;let o=i[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{const l=o.knownActions;e._byClipCacheIndex=l.length,l.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,o=this._actionsByClip,l=o[i],c=l.knownActions,h=c[c.length-1],m=e._byClipCacheIndex;h._byClipCacheIndex=m,c[m]=h,c.pop(),e._byClipCacheIndex=null;const y=l.actionByRoot,b=(e._localRoot||this._root).uuid;delete y[b],c.length===0&&delete o[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const i=t[n];--i.referenceCount===0&&this._removeInactiveBinding(i)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let o=r[t];o===void 0&&(o={},r[t]=o),o[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,l=o[r],c=t[t.length-1],h=e._cacheIndex;c._cacheIndex=h,t[h]=c,t.pop(),delete l[i],Object.keys(l).length===0&&delete o[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new lSe(new Float32Array(2),new Float32Array(2),1,bje),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){const r=t||this._root,i=r.uuid;let o=typeof e=="string"?DY.findByName(r,e):e;const l=o!==null?o.uuid:e,c=this._actionsByClip[l];let h=null;if(n===void 0&&(o!==null?n=o.blendMode:n=zK),c!==void 0){const y=c.actionByRoot[i];if(y!==void 0&&y.blendMode===n)return y;h=c.knownActions[0],o===null&&(o=h._clip)}if(o===null)return null;const m=new xje(this,o,t,n);return this._bindAction(m,h),this._addInactiveAction(m,l,i),m}existingAction(e,t){const n=t||this._root,r=n.uuid,i=typeof e=="string"?DY.findByName(n,e):e,o=i?i.uuid:e,l=this._actionsByClip[o];return l!==void 0&&l.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1;for(let h=0;h!==n;++h)t[h]._update(r,e,i,o);const l=this._bindings,c=this._nActiveBindings;for(let h=0;h!==c;++h)l[h].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(i!==void 0){const o=i.knownActions;for(let l=0,c=o.length;l!==c;++l){const h=o[l];this._deactivateAction(h);const m=h._cacheIndex,y=t[t.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,y._cacheIndex=m,t[m]=y,t.pop(),this._removeInactiveBindingsForAction(h)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const l=n[o].actionByRoot,c=l[t];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}const r=this._bindingsByRootAndName,i=r[t];if(i!==void 0)for(const o in i){const l=i[o];l.restoreOriginalState(),this._removeInactiveBinding(l)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}let Sje=class extends X_e{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}};const k6e=new Pn;class AA{constructor(e,t,n=0,r=1/0){this.ray=new xw(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new KK,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):Ht("Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return k6e.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(k6e),this}intersectObject(e,t=!0,n=[]){return OY(e,this,n,t),n.sort(D6e),n}intersectObjects(e,t=!0,n=[]){for(let r=0,i=e.length;r<i;r++)OY(e[r],this,n,t);return n.sort(D6e),n}}function D6e(s,e){return s.distance-e.distance}function OY(s,e,t,n){let r=!0;if(s.layers.test(e.layers)&&s.raycast(e,t)===!1&&(r=!1),r===!0&&n===!0){const i=s.children;for(let o=0,l=i.length;o<l;o++)OY(i[o],e,t,!0)}}class wje{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1,qt("THREE.Clock: This module has been deprecated. Please use THREE.Timer instead.")}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}class LY{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=xi(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(xi(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}let ySe=class vSe{constructor(e,t,n,r){vSe.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,r){const i=this.elements;return i[0]=e,i[2]=t,i[1]=n,i[3]=r,this}};const O6e=new be;class Tje extends Bi{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Ki,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,l=1,c=32;o<c;o++,l++){const h=o/c*Math.PI*2,m=l/c*Math.PI*2;r.push(Math.cos(h),Math.sin(h),1,Math.cos(m),Math.sin(m),1)}n.setAttribute("position",new Fr(r,3));const i=new Sh({fog:!1,toneMapped:!1});this.cone=new KA(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),O6e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(O6e),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Ay=new be,bO=new Pn,Eq=new Pn;class Eje extends KA{constructor(e){const t=xSe(e),n=new Ki,r=[],i=[];for(let h=0;h<t.length;h++){const m=t[h];m.parent&&m.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(0,0,0),i.push(0,0,0))}n.setAttribute("position",new Fr(r,3)),n.setAttribute("color",new Fr(i,3));const o=new Sh({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,o),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const l=new Tn(255),c=new Tn(65280);this.setColors(l,c)}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");Eq.copy(this.root.matrixWorld).invert();for(let i=0,o=0;i<t.length;i++){const l=t[i];l.parent&&l.parent.isBone&&(bO.multiplyMatrices(Eq,l.matrixWorld),Ay.setFromMatrixPosition(bO),r.setXYZ(o,Ay.x,Ay.y,Ay.z),bO.multiplyMatrices(Eq,l.parent.matrixWorld),Ay.setFromMatrixPosition(bO),r.setXYZ(o+1,Ay.x,Ay.y,Ay.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const r=this.geometry.getAttribute("color");for(let i=0;i<r.count;i+=2)r.setXYZ(i,e.r,e.g,e.b),r.setXYZ(i+1,t.r,t.g,t.b);return r.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function xSe(s){const e=[];s.isBone===!0&&e.push(s);for(let t=0;t<s.children.length;t++)e.push(...xSe(s.children[t]));return e}class bSe extends gn{constructor(e,t,n){const r=new Mg(t,4,2),i=new rl({wireframe:!0,fog:!1,toneMapped:!1});super(r,i),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Mje=new be,L6e=new Tn,F6e=new Tn;class Cje extends Bi{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new H6(t);r.rotateY(Math.PI*.5),this.material=new rl({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),o=new Float32Array(i.count*3);r.setAttribute("color",new ja(o,3)),this.add(new gn(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");L6e.copy(this.light.color),F6e.copy(this.light.groundColor);for(let n=0,r=t.count;n<r;n++){const i=n<r/2?L6e:F6e;t.setXYZ(n,i.r,i.g,i.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Mje.setFromMatrixPosition(this.light.matrixWorld).negate())}}const B6e=new be,_O=new be,U6e=new be;class Aje extends Bi{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new Ki;r.setAttribute("position",new Fr([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new Sh({fog:!1,toneMapped:!1});this.lightPlane=new dd(r,i),this.add(this.lightPlane),r=new Ki,r.setAttribute("position",new Fr([0,0,0,0,0,1],3)),this.targetLine=new dd(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),B6e.setFromMatrixPosition(this.light.matrixWorld),_O.setFromMatrixPosition(this.light.target.matrixWorld),U6e.subVectors(_O,B6e),this.lightPlane.lookAt(_O),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_O),this.targetLine.scale.z=U6e.length()}}const SO=new be,ba=new dZ;class Nje extends KA{constructor(e){const t=new Ki,n=new Sh({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],o={};l("n1","n2"),l("n2","n4"),l("n4","n3"),l("n3","n1"),l("f1","f2"),l("f2","f4"),l("f4","f3"),l("f3","f1"),l("n1","f1"),l("n2","f2"),l("n3","f3"),l("n4","f4"),l("p","n1"),l("p","n2"),l("p","n3"),l("p","n4"),l("u1","u2"),l("u2","u3"),l("u3","u1"),l("c","t"),l("p","c"),l("cn1","cn2"),l("cn3","cn4"),l("cf1","cf2"),l("cf3","cf4");function l(A,I){c(A),c(I)}function c(A){r.push(0,0,0),i.push(0,0,0),o[A]===void 0&&(o[A]=[]),o[A].push(r.length/3-1)}t.setAttribute("position",new Fr(r,3)),t.setAttribute("color",new Fr(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const h=new Tn(16755200),m=new Tn(16711680),y=new Tn(43775),b=new Tn(16777215),w=new Tn(3355443);this.setColors(h,m,y,b,w)}setColors(e,t,n,r,i){const l=this.geometry.getAttribute("color");return l.setXYZ(0,e.r,e.g,e.b),l.setXYZ(1,e.r,e.g,e.b),l.setXYZ(2,e.r,e.g,e.b),l.setXYZ(3,e.r,e.g,e.b),l.setXYZ(4,e.r,e.g,e.b),l.setXYZ(5,e.r,e.g,e.b),l.setXYZ(6,e.r,e.g,e.b),l.setXYZ(7,e.r,e.g,e.b),l.setXYZ(8,e.r,e.g,e.b),l.setXYZ(9,e.r,e.g,e.b),l.setXYZ(10,e.r,e.g,e.b),l.setXYZ(11,e.r,e.g,e.b),l.setXYZ(12,e.r,e.g,e.b),l.setXYZ(13,e.r,e.g,e.b),l.setXYZ(14,e.r,e.g,e.b),l.setXYZ(15,e.r,e.g,e.b),l.setXYZ(16,e.r,e.g,e.b),l.setXYZ(17,e.r,e.g,e.b),l.setXYZ(18,e.r,e.g,e.b),l.setXYZ(19,e.r,e.g,e.b),l.setXYZ(20,e.r,e.g,e.b),l.setXYZ(21,e.r,e.g,e.b),l.setXYZ(22,e.r,e.g,e.b),l.setXYZ(23,e.r,e.g,e.b),l.setXYZ(24,t.r,t.g,t.b),l.setXYZ(25,t.r,t.g,t.b),l.setXYZ(26,t.r,t.g,t.b),l.setXYZ(27,t.r,t.g,t.b),l.setXYZ(28,t.r,t.g,t.b),l.setXYZ(29,t.r,t.g,t.b),l.setXYZ(30,t.r,t.g,t.b),l.setXYZ(31,t.r,t.g,t.b),l.setXYZ(32,n.r,n.g,n.b),l.setXYZ(33,n.r,n.g,n.b),l.setXYZ(34,n.r,n.g,n.b),l.setXYZ(35,n.r,n.g,n.b),l.setXYZ(36,n.r,n.g,n.b),l.setXYZ(37,n.r,n.g,n.b),l.setXYZ(38,r.r,r.g,r.b),l.setXYZ(39,r.r,r.g,r.b),l.setXYZ(40,i.r,i.g,i.b),l.setXYZ(41,i.r,i.g,i.b),l.setXYZ(42,i.r,i.g,i.b),l.setXYZ(43,i.r,i.g,i.b),l.setXYZ(44,i.r,i.g,i.b),l.setXYZ(45,i.r,i.g,i.b),l.setXYZ(46,i.r,i.g,i.b),l.setXYZ(47,i.r,i.g,i.b),l.setXYZ(48,i.r,i.g,i.b),l.setXYZ(49,i.r,i.g,i.b),l.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap,n=1,r=1;let i,o;if(ba.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)i=1,o=0;else if(this.camera.coordinateSystem===Tc)i=-1,o=1;else if(this.camera.coordinateSystem===xh)i=0,o=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);Ba("c",t,e,ba,0,0,i),Ba("t",t,e,ba,0,0,o),Ba("n1",t,e,ba,-n,-r,i),Ba("n2",t,e,ba,n,-r,i),Ba("n3",t,e,ba,-n,r,i),Ba("n4",t,e,ba,n,r,i),Ba("f1",t,e,ba,-n,-r,o),Ba("f2",t,e,ba,n,-r,o),Ba("f3",t,e,ba,-n,r,o),Ba("f4",t,e,ba,n,r,o),Ba("u1",t,e,ba,n*.7,r*1.1,i),Ba("u2",t,e,ba,-n*.7,r*1.1,i),Ba("u3",t,e,ba,0,r*2,i),Ba("cf1",t,e,ba,-n,0,o),Ba("cf2",t,e,ba,n,0,o),Ba("cf3",t,e,ba,0,-r,o),Ba("cf4",t,e,ba,0,r,o),Ba("cn1",t,e,ba,-n,0,i),Ba("cn2",t,e,ba,n,0,i),Ba("cn3",t,e,ba,0,-r,i),Ba("cn4",t,e,ba,0,r,i),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ba(s,e,t,n,r,i,o){SO.set(r,i,o).unproject(n);const l=e[s];if(l!==void 0){const c=t.getAttribute("position");for(let h=0,m=l.length;h<m;h++)c.setXYZ(l[h],SO.x,SO.y,SO.z)}}class Pje extends KA{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Ki;r.setAttribute("position",new Fr(t,3)),r.setAttribute("color",new Fr(n,3));const i=new Sh({vertexColors:!0,toneMapped:!1});super(r,i),this.type="AxesHelper"}setColors(e,t,n){const r=new Tn,i=this.geometry.attributes.color.array;return r.set(e),r.toArray(i,0),r.toArray(i,3),r.set(t),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class _Se extends _d{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){qt("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function FY(s,e,t,n){const r=Rje(n);switch(t){case UK:return s*e;case mw:return s*e/r.components*r.byteLength;case gw:return s*e/r.components*r.byteLength;case Su:return s*e*2/r.components*r.byteLength;case yw:return s*e*2/r.components*r.byteLength;case qA:return s*e*3/r.components*r.byteLength;case io:return s*e*4/r.components*r.byteLength;case vw:return s*e*4/r.components*r.byteLength;case e5:case t5:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*8;case n5:case r5:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case mA:case yA:return Math.max(s,16)*Math.max(e,8)/4;case fA:case gA:return Math.max(s,8)*Math.max(e,8)/2;case MS:case CS:case NS:case PS:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*8;case AS:case ax:case RS:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case IS:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case kS:return Math.floor((s+4)/5)*Math.floor((e+3)/4)*16;case DS:return Math.floor((s+4)/5)*Math.floor((e+4)/5)*16;case OS:return Math.floor((s+5)/6)*Math.floor((e+4)/5)*16;case LS:return Math.floor((s+5)/6)*Math.floor((e+5)/6)*16;case FS:return Math.floor((s+7)/8)*Math.floor((e+4)/5)*16;case BS:return Math.floor((s+7)/8)*Math.floor((e+5)/6)*16;case US:return Math.floor((s+7)/8)*Math.floor((e+7)/8)*16;case zS:return Math.floor((s+9)/10)*Math.floor((e+4)/5)*16;case VS:return Math.floor((s+9)/10)*Math.floor((e+5)/6)*16;case GS:return Math.floor((s+9)/10)*Math.floor((e+7)/8)*16;case jS:return Math.floor((s+9)/10)*Math.floor((e+9)/10)*16;case HS:return Math.floor((s+11)/12)*Math.floor((e+9)/10)*16;case $S:return Math.floor((s+11)/12)*Math.floor((e+11)/12)*16;case WS:case TY:case EY:return Math.ceil(s/4)*Math.ceil(e/4)*16;case qS:case XS:return Math.ceil(s/4)*Math.ceil(e/4)*8;case lx:case YS:return Math.ceil(s/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function Rje(s){switch(s){case yo:case Z6:return{byteLength:1,components:1};case um:case Q6:case ro:return{byteLength:2,components:1};case JF:case eB:return{byteLength:2,components:4};case Ds:case r0:case vo:return{byteLength:4,components:1};case tB:case nB:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${s}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:fx}}));typeof window<"u"&&(window.__THREE__?qt("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=fx);/**
 * @license
 * Copyright 2010-2026 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function SSe(){let s=null,e=!1,t=null,n=null;function r(i,o){t(i,o),n=s.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=s.requestAnimationFrame(r),e=!0)},stop:function(){s.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(i){t=i},setContext:function(i){s=i}}}function Ije(s){const e=new WeakMap;function t(l,c){const h=l.array,m=l.usage,y=h.byteLength,b=s.createBuffer();s.bindBuffer(c,b),s.bufferData(c,h,m),l.onUploadCallback();let w;if(h instanceof Float32Array)w=s.FLOAT;else if(typeof Float16Array<"u"&&h instanceof Float16Array)w=s.HALF_FLOAT;else if(h instanceof Uint16Array)l.isFloat16BufferAttribute?w=s.HALF_FLOAT:w=s.UNSIGNED_SHORT;else if(h instanceof Int16Array)w=s.SHORT;else if(h instanceof Uint32Array)w=s.UNSIGNED_INT;else if(h instanceof Int32Array)w=s.INT;else if(h instanceof Int8Array)w=s.BYTE;else if(h instanceof Uint8Array)w=s.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)w=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:b,type:w,bytesPerElement:h.BYTES_PER_ELEMENT,version:l.version,size:y}}function n(l,c,h){const m=c.array,y=c.updateRanges;if(s.bindBuffer(h,l),y.length===0)s.bufferSubData(h,0,m);else{y.sort((w,A)=>w.start-A.start);let b=0;for(let w=1;w<y.length;w++){const A=y[b],I=y[w];I.start<=A.start+A.count+1?A.count=Math.max(A.count,I.start+I.count-A.start):(++b,y[b]=I)}y.length=b+1;for(let w=0,A=y.length;w<A;w++){const I=y[w];s.bufferSubData(h,I.start*m.BYTES_PER_ELEMENT,m,I.start,I.count)}c.clearUpdateRanges()}c.onUploadCallback()}function r(l){return l.isInterleavedBufferAttribute&&(l=l.data),e.get(l)}function i(l){l.isInterleavedBufferAttribute&&(l=l.data);const c=e.get(l);c&&(s.deleteBuffer(c.buffer),e.delete(l))}function o(l,c){if(l.isInterleavedBufferAttribute&&(l=l.data),l.isGLBufferAttribute){const m=e.get(l);(!m||m.version<l.version)&&e.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}const h=e.get(l);if(h===void 0)e.set(l,t(l,c));else if(h.version<l.version){if(h.size!==l.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(h.buffer,l,c),h.version=l.version}}return{get:r,remove:i,update:o}}var kje=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Dje=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Oje=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Lje=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Fje=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,Bje=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Uje=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,zje=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Vje=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec4 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 );
	}
#endif`,Gje=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,jje=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Hje=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,$je=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Wje=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,qje=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Xje=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Yje=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Kje=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Zje=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Qje=`#if defined( USE_COLOR ) || defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#endif`,Jje=`#if defined( USE_COLOR ) || defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#endif`,eHe=`#if defined( USE_COLOR ) || defined( USE_COLOR_ALPHA ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec4 vColor;
#endif`,tHe=`#if defined( USE_COLOR ) || defined( USE_COLOR_ALPHA ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec4( 1.0 );
#endif
#ifdef USE_COLOR_ALPHA
	vColor *= color;
#elif defined( USE_COLOR )
	vColor.rgb *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.rgb *= instanceColor.rgb;
#endif
#ifdef USE_BATCHING_COLOR
	vColor *= getBatchingColor( getIndirectIndex( gl_DrawID ) );
#endif`,nHe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,rHe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,iHe=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,sHe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,oHe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,aHe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,lHe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,cHe="gl_FragColor = linearToOutputTexel( gl_FragColor );",uHe=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,dHe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
		#ifdef ENVMAP_BLENDING_MULTIPLY
			outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
		#elif defined( ENVMAP_BLENDING_MIX )
			outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
		#elif defined( ENVMAP_BLENDING_ADD )
			outgoingLight += envColor.xyz * specularStrength * reflectivity;
		#endif
	#endif
#endif`,hHe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,pHe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,fHe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,mHe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,gHe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,yHe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,vHe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,xHe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,bHe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,_He=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,SHe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,wHe=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,THe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,EHe=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,MHe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,CHe=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,AHe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,NHe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,PHe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.diffuseContribution = diffuseColor.rgb * ( 1.0 - metalnessFactor );
material.metalness = metalnessFactor;
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor;
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = vec3( 0.04 );
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.0001, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,RHe=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	vec3 diffuseContribution;
	vec3 specularColor;
	vec3 specularColorBlended;
	float roughness;
	float metalness;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
		vec3 iridescenceFresnelDielectric;
		vec3 iridescenceFresnelMetallic;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return v;
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColorBlended;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float rInv = 1.0 / ( roughness + 0.1 );
	float a = -1.9362 + 1.0678 * roughness + 0.4573 * r2 - 0.8469 * rInv;
	float b = -0.6014 + 0.5538 * roughness - 0.4670 * r2 - 0.1255 * rInv;
	float DG = exp( a * dotNV + b );
	return saturate( DG );
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = texture2D( dfgLUT, vec2( material.roughness, dotNV ) ).rg;
	vec2 dfgL = texture2D( dfgLUT, vec2( material.roughness, dotNL ) ).rg;
	vec3 FssEss_V = material.specularColorBlended * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColorBlended * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColorBlended + ( 1.0 - material.specularColorBlended ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColorBlended * t2.x + ( material.specularF90 - material.specularColorBlended ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseContribution * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
		#ifdef USE_CLEARCOAT
			vec3 Ncc = geometryClearcoatNormal;
			vec2 uvClearcoat = LTC_Uv( Ncc, viewDir, material.clearcoatRoughness );
			vec4 t1Clearcoat = texture2D( ltc_1, uvClearcoat );
			vec4 t2Clearcoat = texture2D( ltc_2, uvClearcoat );
			mat3 mInvClearcoat = mat3(
				vec3( t1Clearcoat.x, 0, t1Clearcoat.y ),
				vec3(             0, 1,             0 ),
				vec3( t1Clearcoat.z, 0, t1Clearcoat.w )
			);
			vec3 fresnelClearcoat = material.clearcoatF0 * t2Clearcoat.x + ( material.clearcoatF90 - material.clearcoatF0 ) * t2Clearcoat.y;
			clearcoatSpecularDirect += lightColor * fresnelClearcoat * LTC_Evaluate( Ncc, viewDir, position, mInvClearcoat, rectCoords );
		#endif
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
 
 		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
 
 		float sheenAlbedoV = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
 		float sheenAlbedoL = IBLSheenBRDF( geometryNormal, directLight.direction, material.sheenRoughness );
 
 		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * max( sheenAlbedoV, sheenAlbedoL );
 
 		irradiance *= sheenEnergyComp;
 
 	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseContribution );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 diffuse = irradiance * BRDF_Lambert( material.diffuseContribution );
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		diffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectDiffuse += diffuse;
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness ) * RECIPROCAL_PI;
 	#endif
	vec3 singleScatteringDielectric = vec3( 0.0 );
	vec3 multiScatteringDielectric = vec3( 0.0 );
	vec3 singleScatteringMetallic = vec3( 0.0 );
	vec3 multiScatteringMetallic = vec3( 0.0 );
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnelDielectric, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.iridescence, material.iridescenceFresnelMetallic, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscattering( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#endif
	vec3 singleScattering = mix( singleScatteringDielectric, singleScatteringMetallic, material.metalness );
	vec3 multiScattering = mix( multiScatteringDielectric, multiScatteringMetallic, material.metalness );
	vec3 totalScatteringDielectric = singleScatteringDielectric + multiScatteringDielectric;
	vec3 diffuse = material.diffuseContribution * ( 1.0 - totalScatteringDielectric );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	vec3 indirectSpecular = radiance * singleScattering;
	indirectSpecular += multiScattering * cosineWeightedIrradiance;
	vec3 indirectDiffuse = diffuse * cosineWeightedIrradiance;
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		indirectSpecular *= sheenEnergyComp;
		indirectDiffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectSpecular += indirectSpecular;
	reflectedLight.indirectDiffuse += indirectDiffuse;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,IHe=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnelDielectric = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceFresnelMetallic = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.diffuseColor );
		material.iridescenceFresnel = mix( material.iridescenceFresnelDielectric, material.iridescenceFresnelMetallic, material.metalness );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS ) && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,kHe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( ENVMAP_TYPE_CUBE_UV )
		#if defined( STANDARD ) || defined( LAMBERT ) || defined( PHONG )
			iblIrradiance += getIBLIrradiance( geometryNormal );
		#endif
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,DHe=`#if defined( RE_IndirectDiffuse )
	#if defined( LAMBERT ) || defined( PHONG )
		irradiance += iblIrradiance;
	#endif
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,OHe=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,LHe=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,FHe=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,BHe=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,UHe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,zHe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,VHe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,GHe=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,jHe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,HHe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,$He=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,WHe=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,qHe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,XHe=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,YHe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,KHe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,ZHe=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,QHe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,JHe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,e$e=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,t$e=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,n$e=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,r$e=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,i$e=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,s$e=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,o$e=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,a$e=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	#ifdef USE_REVERSED_DEPTH_BUFFER
	
		return depth * ( far - near ) - far;
	#else
		return depth * ( near - far ) - near;
	#endif
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	
	#ifdef USE_REVERSED_DEPTH_BUFFER
		return ( near * far ) / ( ( near - far ) * depth - near );
	#else
		return ( near * far ) / ( ( far - near ) * depth - far );
	#endif
}`,l$e=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,c$e=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,u$e=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,d$e=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,h$e=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,p$e=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,f$e=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#else
			uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#endif
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#else
			uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#endif
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform samplerCubeShadow pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#elif defined( SHADOWMAP_TYPE_BASIC )
			uniform samplerCube pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#endif
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float interleavedGradientNoise( vec2 position ) {
			return fract( 52.9829189 * fract( dot( position, vec2( 0.06711056, 0.00583715 ) ) ) );
		}
		vec2 vogelDiskSample( int sampleIndex, int samplesCount, float phi ) {
			const float goldenAngle = 2.399963229728653;
			float r = sqrt( ( float( sampleIndex ) + 0.5 ) / float( samplesCount ) );
			float theta = float( sampleIndex ) * goldenAngle + phi;
			return vec2( cos( theta ), sin( theta ) ) * r;
		}
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float getShadow( sampler2DShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
				float radius = shadowRadius * texelSize.x;
				float phi = interleavedGradientNoise( gl_FragCoord.xy ) * PI2;
				shadow = (
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 0, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 1, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 2, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 3, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 4, 5, phi ) * radius, shadowCoord.z ) )
				) * 0.2;
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#elif defined( SHADOWMAP_TYPE_VSM )
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			#ifdef USE_REVERSED_DEPTH_BUFFER
				shadowCoord.z -= shadowBias;
			#else
				shadowCoord.z += shadowBias;
			#endif
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 distribution = texture2D( shadowMap, shadowCoord.xy ).rg;
				float mean = distribution.x;
				float variance = distribution.y * distribution.y;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					float hard_shadow = step( mean, shadowCoord.z );
				#else
					float hard_shadow = step( shadowCoord.z, mean );
				#endif
				
				if ( hard_shadow == 1.0 ) {
					shadow = 1.0;
				} else {
					variance = max( variance, 0.0000001 );
					float d = shadowCoord.z - mean;
					float p_max = variance / ( variance + d * d );
					p_max = clamp( ( p_max - 0.3 ) / 0.65, 0.0, 1.0 );
					shadow = max( hard_shadow, p_max );
				}
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#else
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			#ifdef USE_REVERSED_DEPTH_BUFFER
				shadowCoord.z -= shadowBias;
			#else
				shadowCoord.z += shadowBias;
			#endif
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				float depth = texture2D( shadowMap, shadowCoord.xy ).r;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					shadow = step( depth, shadowCoord.z );
				#else
					shadow = step( shadowCoord.z, depth );
				#endif
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#if defined( SHADOWMAP_TYPE_PCF )
	float getPointShadow( samplerCubeShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			#ifdef USE_REVERSED_DEPTH_BUFFER
				float dp = ( shadowCameraNear * ( shadowCameraFar - viewSpaceZ ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
				dp -= shadowBias;
			#else
				float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
				dp += shadowBias;
			#endif
			float texelSize = shadowRadius / shadowMapSize.x;
			vec3 absDir = abs( bd3D );
			vec3 tangent = absDir.x > absDir.z ? vec3( 0.0, 1.0, 0.0 ) : vec3( 1.0, 0.0, 0.0 );
			tangent = normalize( cross( bd3D, tangent ) );
			vec3 bitangent = cross( bd3D, tangent );
			float phi = interleavedGradientNoise( gl_FragCoord.xy ) * PI2;
			vec2 sample0 = vogelDiskSample( 0, 5, phi );
			vec2 sample1 = vogelDiskSample( 1, 5, phi );
			vec2 sample2 = vogelDiskSample( 2, 5, phi );
			vec2 sample3 = vogelDiskSample( 3, 5, phi );
			vec2 sample4 = vogelDiskSample( 4, 5, phi );
			shadow = (
				texture( shadowMap, vec4( bd3D + ( tangent * sample0.x + bitangent * sample0.y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * sample1.x + bitangent * sample1.y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * sample2.x + bitangent * sample2.y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * sample3.x + bitangent * sample3.y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * sample4.x + bitangent * sample4.y ) * texelSize, dp ) )
			) * 0.2;
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#elif defined( SHADOWMAP_TYPE_BASIC )
	float getPointShadow( samplerCube shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			float depth = textureCube( shadowMap, bd3D ).r;
			#ifdef USE_REVERSED_DEPTH_BUFFER
				depth = 1.0 - depth;
			#endif
			shadow = step( dp, depth );
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#endif
	#endif
#endif`,m$e=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,g$e=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,y$e=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0 && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,v$e=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,x$e=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,b$e=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,_$e=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,S$e=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,w$e=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,T$e=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,E$e=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,M$e=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseContribution, material.specularColorBlended, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,C$e=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,A$e=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,N$e=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,P$e=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,R$e=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const I$e=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,k$e=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,D$e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,O$e=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,L$e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,F$e=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,B$e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,U$e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,z$e=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,V$e=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = vec4( dist, 0.0, 0.0, 1.0 );
}`,G$e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,j$e=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,H$e=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,$$e=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,W$e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,q$e=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,X$e=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Y$e=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,K$e=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Z$e=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Q$e=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,J$e=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( normalize( normal ) * 0.5 + 0.5, diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,eWe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,tWe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,nWe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,rWe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
 
		outgoingLight = outgoingLight + sheenSpecularDirect + sheenSpecularIndirect;
 
 	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,iWe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sWe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,oWe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,aWe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,lWe=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,cWe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,uWe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,dWe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Mi={alphahash_fragment:kje,alphahash_pars_fragment:Dje,alphamap_fragment:Oje,alphamap_pars_fragment:Lje,alphatest_fragment:Fje,alphatest_pars_fragment:Bje,aomap_fragment:Uje,aomap_pars_fragment:zje,batching_pars_vertex:Vje,batching_vertex:Gje,begin_vertex:jje,beginnormal_vertex:Hje,bsdfs:$je,iridescence_fragment:Wje,bumpmap_pars_fragment:qje,clipping_planes_fragment:Xje,clipping_planes_pars_fragment:Yje,clipping_planes_pars_vertex:Kje,clipping_planes_vertex:Zje,color_fragment:Qje,color_pars_fragment:Jje,color_pars_vertex:eHe,color_vertex:tHe,common:nHe,cube_uv_reflection_fragment:rHe,defaultnormal_vertex:iHe,displacementmap_pars_vertex:sHe,displacementmap_vertex:oHe,emissivemap_fragment:aHe,emissivemap_pars_fragment:lHe,colorspace_fragment:cHe,colorspace_pars_fragment:uHe,envmap_fragment:dHe,envmap_common_pars_fragment:hHe,envmap_pars_fragment:pHe,envmap_pars_vertex:fHe,envmap_physical_pars_fragment:EHe,envmap_vertex:mHe,fog_vertex:gHe,fog_pars_vertex:yHe,fog_fragment:vHe,fog_pars_fragment:xHe,gradientmap_pars_fragment:bHe,lightmap_pars_fragment:_He,lights_lambert_fragment:SHe,lights_lambert_pars_fragment:wHe,lights_pars_begin:THe,lights_toon_fragment:MHe,lights_toon_pars_fragment:CHe,lights_phong_fragment:AHe,lights_phong_pars_fragment:NHe,lights_physical_fragment:PHe,lights_physical_pars_fragment:RHe,lights_fragment_begin:IHe,lights_fragment_maps:kHe,lights_fragment_end:DHe,logdepthbuf_fragment:OHe,logdepthbuf_pars_fragment:LHe,logdepthbuf_pars_vertex:FHe,logdepthbuf_vertex:BHe,map_fragment:UHe,map_pars_fragment:zHe,map_particle_fragment:VHe,map_particle_pars_fragment:GHe,metalnessmap_fragment:jHe,metalnessmap_pars_fragment:HHe,morphinstance_vertex:$He,morphcolor_vertex:WHe,morphnormal_vertex:qHe,morphtarget_pars_vertex:XHe,morphtarget_vertex:YHe,normal_fragment_begin:KHe,normal_fragment_maps:ZHe,normal_pars_fragment:QHe,normal_pars_vertex:JHe,normal_vertex:e$e,normalmap_pars_fragment:t$e,clearcoat_normal_fragment_begin:n$e,clearcoat_normal_fragment_maps:r$e,clearcoat_pars_fragment:i$e,iridescence_pars_fragment:s$e,opaque_fragment:o$e,packing:a$e,premultiplied_alpha_fragment:l$e,project_vertex:c$e,dithering_fragment:u$e,dithering_pars_fragment:d$e,roughnessmap_fragment:h$e,roughnessmap_pars_fragment:p$e,shadowmap_pars_fragment:f$e,shadowmap_pars_vertex:m$e,shadowmap_vertex:g$e,shadowmask_pars_fragment:y$e,skinbase_vertex:v$e,skinning_pars_vertex:x$e,skinning_vertex:b$e,skinnormal_vertex:_$e,specularmap_fragment:S$e,specularmap_pars_fragment:w$e,tonemapping_fragment:T$e,tonemapping_pars_fragment:E$e,transmission_fragment:M$e,transmission_pars_fragment:C$e,uv_pars_fragment:A$e,uv_pars_vertex:N$e,uv_vertex:P$e,worldpos_vertex:R$e,background_vert:I$e,background_frag:k$e,backgroundCube_vert:D$e,backgroundCube_frag:O$e,cube_vert:L$e,cube_frag:F$e,depth_vert:B$e,depth_frag:U$e,distance_vert:z$e,distance_frag:V$e,equirect_vert:G$e,equirect_frag:j$e,linedashed_vert:H$e,linedashed_frag:$$e,meshbasic_vert:W$e,meshbasic_frag:q$e,meshlambert_vert:X$e,meshlambert_frag:Y$e,meshmatcap_vert:K$e,meshmatcap_frag:Z$e,meshnormal_vert:Q$e,meshnormal_frag:J$e,meshphong_vert:eWe,meshphong_frag:tWe,meshphysical_vert:nWe,meshphysical_frag:rWe,meshtoon_vert:iWe,meshtoon_frag:sWe,points_vert:oWe,points_frag:aWe,shadow_vert:lWe,shadow_frag:cWe,sprite_vert:uWe,sprite_frag:dWe},Fn={common:{diffuse:{value:new Tn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new ci},alphaMap:{value:null},alphaMapTransform:{value:new ci},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ci}},envmap:{envMap:{value:null},envMapRotation:{value:new ci},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ci}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ci}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ci},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ci},normalScale:{value:new Ln(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ci},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ci}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ci}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ci}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Tn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Tn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new ci},alphaTest:{value:0},uvTransform:{value:new ci}},sprite:{diffuse:{value:new Tn(16777215)},opacity:{value:1},center:{value:new Ln(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ci},alphaMap:{value:null},alphaMapTransform:{value:new ci},alphaTest:{value:0}}},hg={basic:{uniforms:uu([Fn.common,Fn.specularmap,Fn.envmap,Fn.aomap,Fn.lightmap,Fn.fog]),vertexShader:Mi.meshbasic_vert,fragmentShader:Mi.meshbasic_frag},lambert:{uniforms:uu([Fn.common,Fn.specularmap,Fn.envmap,Fn.aomap,Fn.lightmap,Fn.emissivemap,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.fog,Fn.lights,{emissive:{value:new Tn(0)},envMapIntensity:{value:1}}]),vertexShader:Mi.meshlambert_vert,fragmentShader:Mi.meshlambert_frag},phong:{uniforms:uu([Fn.common,Fn.specularmap,Fn.envmap,Fn.aomap,Fn.lightmap,Fn.emissivemap,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.fog,Fn.lights,{emissive:{value:new Tn(0)},specular:{value:new Tn(1118481)},shininess:{value:30},envMapIntensity:{value:1}}]),vertexShader:Mi.meshphong_vert,fragmentShader:Mi.meshphong_frag},standard:{uniforms:uu([Fn.common,Fn.envmap,Fn.aomap,Fn.lightmap,Fn.emissivemap,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.roughnessmap,Fn.metalnessmap,Fn.fog,Fn.lights,{emissive:{value:new Tn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Mi.meshphysical_vert,fragmentShader:Mi.meshphysical_frag},toon:{uniforms:uu([Fn.common,Fn.aomap,Fn.lightmap,Fn.emissivemap,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.gradientmap,Fn.fog,Fn.lights,{emissive:{value:new Tn(0)}}]),vertexShader:Mi.meshtoon_vert,fragmentShader:Mi.meshtoon_frag},matcap:{uniforms:uu([Fn.common,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,Fn.fog,{matcap:{value:null}}]),vertexShader:Mi.meshmatcap_vert,fragmentShader:Mi.meshmatcap_frag},points:{uniforms:uu([Fn.points,Fn.fog]),vertexShader:Mi.points_vert,fragmentShader:Mi.points_frag},dashed:{uniforms:uu([Fn.common,Fn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Mi.linedashed_vert,fragmentShader:Mi.linedashed_frag},depth:{uniforms:uu([Fn.common,Fn.displacementmap]),vertexShader:Mi.depth_vert,fragmentShader:Mi.depth_frag},normal:{uniforms:uu([Fn.common,Fn.bumpmap,Fn.normalmap,Fn.displacementmap,{opacity:{value:1}}]),vertexShader:Mi.meshnormal_vert,fragmentShader:Mi.meshnormal_frag},sprite:{uniforms:uu([Fn.sprite,Fn.fog]),vertexShader:Mi.sprite_vert,fragmentShader:Mi.sprite_frag},background:{uniforms:{uvTransform:{value:new ci},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Mi.background_vert,fragmentShader:Mi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new ci}},vertexShader:Mi.backgroundCube_vert,fragmentShader:Mi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Mi.cube_vert,fragmentShader:Mi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Mi.equirect_vert,fragmentShader:Mi.equirect_frag},distance:{uniforms:uu([Fn.common,Fn.displacementmap,{referencePosition:{value:new be},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Mi.distance_vert,fragmentShader:Mi.distance_frag},shadow:{uniforms:uu([Fn.lights,Fn.fog,{color:{value:new Tn(0)},opacity:{value:1}}]),vertexShader:Mi.shadow_vert,fragmentShader:Mi.shadow_frag}};hg.physical={uniforms:uu([hg.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ci},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ci},clearcoatNormalScale:{value:new Ln(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ci},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ci},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ci},sheen:{value:0},sheenColor:{value:new Tn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ci},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ci},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ci},transmissionSamplerSize:{value:new Ln},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ci},attenuationDistance:{value:0},attenuationColor:{value:new Tn(0)},specularColor:{value:new Tn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ci},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ci},anisotropyVector:{value:new Ln},anisotropyMap:{value:null},anisotropyMapTransform:{value:new ci}}]),vertexShader:Mi.meshphysical_vert,fragmentShader:Mi.meshphysical_frag};const wO={r:0,b:0,g:0},g6=new Sa,hWe=new Pn;function pWe(s,e,t,n,r,i){const o=new Tn(0);let l=r===!0?0:1,c,h,m=null,y=0,b=null;function w(U){let j=U.isScene===!0?U.background:null;if(j&&j.isTexture){const C=U.backgroundBlurriness>0;j=e.get(j,C)}return j}function A(U){let j=!1;const C=w(U);C===null?D(o,l):C&&C.isColor&&(D(C,1),j=!0);const Z=s.xr.getEnvironmentBlendMode();Z==="additive"?t.buffers.color.setClear(0,0,0,1,i):Z==="alpha-blend"&&t.buffers.color.setClear(0,0,0,0,i),(s.autoClear||j)&&(t.buffers.depth.setTest(!0),t.buffers.depth.setMask(!0),t.buffers.color.setMask(!0),s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil))}function I(U,j){const C=w(j);C&&(C.isCubeTexture||C.mapping===sx)?(h===void 0&&(h=new gn(new _a(1,1,1),new bh({name:"BackgroundCubeMaterial",uniforms:JS(hg.backgroundCube.uniforms),vertexShader:hg.backgroundCube.vertexShader,fragmentShader:hg.backgroundCube.fragmentShader,side:bs,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(Z,ie,se){this.matrixWorld.copyPosition(se.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),g6.copy(j.backgroundRotation),g6.x*=-1,g6.y*=-1,g6.z*=-1,C.isCubeTexture&&C.isRenderTargetTexture===!1&&(g6.y*=-1,g6.z*=-1),h.material.uniforms.envMap.value=C,h.material.uniforms.flipEnvMap.value=C.isCubeTexture&&C.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=j.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=j.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(hWe.makeRotationFromEuler(g6)),h.material.toneMapped=Zn.getTransfer(C.colorSpace)!==Yn,(m!==C||y!==C.version||b!==s.toneMapping)&&(h.material.needsUpdate=!0,m=C,y=C.version,b=s.toneMapping),h.layers.enableAll(),U.unshift(h,h.geometry,h.material,0,0,null)):C&&C.isTexture&&(c===void 0&&(c=new gn(new Ng(2,2),new bh({name:"BackgroundMaterial",uniforms:JS(hg.background.uniforms),vertexShader:hg.background.vertexShader,fragmentShader:hg.background.fragmentShader,side:Mc,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=C,c.material.uniforms.backgroundIntensity.value=j.backgroundIntensity,c.material.toneMapped=Zn.getTransfer(C.colorSpace)!==Yn,C.matrixAutoUpdate===!0&&C.updateMatrix(),c.material.uniforms.uvTransform.value.copy(C.matrix),(m!==C||y!==C.version||b!==s.toneMapping)&&(c.material.needsUpdate=!0,m=C,y=C.version,b=s.toneMapping),c.layers.enableAll(),U.unshift(c,c.geometry,c.material,0,0,null))}function D(U,j){U.getRGB(wO,iSe(s)),t.buffers.color.setClear(wO.r,wO.g,wO.b,j,i)}function P(){h!==void 0&&(h.geometry.dispose(),h.material.dispose(),h=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return o},setClearColor:function(U,j=1){o.set(U),l=j,D(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(U){l=U,D(o,l)},render:A,addToRenderList:I,dispose:P}}function fWe(s,e){const t=s.getParameter(s.MAX_VERTEX_ATTRIBS),n={},r=b(null);let i=r,o=!1;function l(H,Me,Oe,Ue,Ie){let ce=!1;const Ve=y(H,Ue,Oe,Me);i!==Ve&&(i=Ve,h(i.object)),ce=w(H,Ue,Oe,Ie),ce&&A(H,Ue,Oe,Ie),Ie!==null&&e.update(Ie,s.ELEMENT_ARRAY_BUFFER),(ce||o)&&(o=!1,C(H,Me,Oe,Ue),Ie!==null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.get(Ie).buffer))}function c(){return s.createVertexArray()}function h(H){return s.bindVertexArray(H)}function m(H){return s.deleteVertexArray(H)}function y(H,Me,Oe,Ue){const Ie=Ue.wireframe===!0;let ce=n[Me.id];ce===void 0&&(ce={},n[Me.id]=ce);const Ve=H.isInstancedMesh===!0?H.id:0;let Pe=ce[Ve];Pe===void 0&&(Pe={},ce[Ve]=Pe);let We=Pe[Oe.id];We===void 0&&(We={},Pe[Oe.id]=We);let pt=We[Ie];return pt===void 0&&(pt=b(c()),We[Ie]=pt),pt}function b(H){const Me=[],Oe=[],Ue=[];for(let Ie=0;Ie<t;Ie++)Me[Ie]=0,Oe[Ie]=0,Ue[Ie]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Me,enabledAttributes:Oe,attributeDivisors:Ue,object:H,attributes:{},index:null}}function w(H,Me,Oe,Ue){const Ie=i.attributes,ce=Me.attributes;let Ve=0;const Pe=Oe.getAttributes();for(const We in Pe)if(Pe[We].location>=0){const Ne=Ie[We];let st=ce[We];if(st===void 0&&(We==="instanceMatrix"&&H.instanceMatrix&&(st=H.instanceMatrix),We==="instanceColor"&&H.instanceColor&&(st=H.instanceColor)),Ne===void 0||Ne.attribute!==st||st&&Ne.data!==st.data)return!0;Ve++}return i.attributesNum!==Ve||i.index!==Ue}function A(H,Me,Oe,Ue){const Ie={},ce=Me.attributes;let Ve=0;const Pe=Oe.getAttributes();for(const We in Pe)if(Pe[We].location>=0){let Ne=ce[We];Ne===void 0&&(We==="instanceMatrix"&&H.instanceMatrix&&(Ne=H.instanceMatrix),We==="instanceColor"&&H.instanceColor&&(Ne=H.instanceColor));const st={};st.attribute=Ne,Ne&&Ne.data&&(st.data=Ne.data),Ie[We]=st,Ve++}i.attributes=Ie,i.attributesNum=Ve,i.index=Ue}function I(){const H=i.newAttributes;for(let Me=0,Oe=H.length;Me<Oe;Me++)H[Me]=0}function D(H){P(H,0)}function P(H,Me){const Oe=i.newAttributes,Ue=i.enabledAttributes,Ie=i.attributeDivisors;Oe[H]=1,Ue[H]===0&&(s.enableVertexAttribArray(H),Ue[H]=1),Ie[H]!==Me&&(s.vertexAttribDivisor(H,Me),Ie[H]=Me)}function U(){const H=i.newAttributes,Me=i.enabledAttributes;for(let Oe=0,Ue=Me.length;Oe<Ue;Oe++)Me[Oe]!==H[Oe]&&(s.disableVertexAttribArray(Oe),Me[Oe]=0)}function j(H,Me,Oe,Ue,Ie,ce,Ve){Ve===!0?s.vertexAttribIPointer(H,Me,Oe,Ie,ce):s.vertexAttribPointer(H,Me,Oe,Ue,Ie,ce)}function C(H,Me,Oe,Ue){I();const Ie=Ue.attributes,ce=Oe.getAttributes(),Ve=Me.defaultAttributeValues;for(const Pe in ce){const We=ce[Pe];if(We.location>=0){let pt=Ie[Pe];if(pt===void 0&&(Pe==="instanceMatrix"&&H.instanceMatrix&&(pt=H.instanceMatrix),Pe==="instanceColor"&&H.instanceColor&&(pt=H.instanceColor)),pt!==void 0){const Ne=pt.normalized,st=pt.itemSize,Pt=e.get(pt);if(Pt===void 0)continue;const yn=Pt.buffer,bn=Pt.type,St=Pt.bytesPerElement,Ut=bn===s.INT||bn===s.UNSIGNED_INT||pt.gpuType===r0;if(pt.isInterleavedBufferAttribute){const Wt=pt.data,kn=Wt.stride,Dn=pt.offset;if(Wt.isInstancedInterleavedBuffer){for(let or=0;or<We.locationSize;or++)P(We.location+or,Wt.meshPerAttribute);H.isInstancedMesh!==!0&&Ue._maxInstanceCount===void 0&&(Ue._maxInstanceCount=Wt.meshPerAttribute*Wt.count)}else for(let or=0;or<We.locationSize;or++)D(We.location+or);s.bindBuffer(s.ARRAY_BUFFER,yn);for(let or=0;or<We.locationSize;or++)j(We.location+or,st/We.locationSize,bn,Ne,kn*St,(Dn+st/We.locationSize*or)*St,Ut)}else{if(pt.isInstancedBufferAttribute){for(let Wt=0;Wt<We.locationSize;Wt++)P(We.location+Wt,pt.meshPerAttribute);H.isInstancedMesh!==!0&&Ue._maxInstanceCount===void 0&&(Ue._maxInstanceCount=pt.meshPerAttribute*pt.count)}else for(let Wt=0;Wt<We.locationSize;Wt++)D(We.location+Wt);s.bindBuffer(s.ARRAY_BUFFER,yn);for(let Wt=0;Wt<We.locationSize;Wt++)j(We.location+Wt,st/We.locationSize,bn,Ne,st*St,st/We.locationSize*Wt*St,Ut)}}else if(Ve!==void 0){const Ne=Ve[Pe];if(Ne!==void 0)switch(Ne.length){case 2:s.vertexAttrib2fv(We.location,Ne);break;case 3:s.vertexAttrib3fv(We.location,Ne);break;case 4:s.vertexAttrib4fv(We.location,Ne);break;default:s.vertexAttrib1fv(We.location,Ne)}}}}U()}function Z(){re();for(const H in n){const Me=n[H];for(const Oe in Me){const Ue=Me[Oe];for(const Ie in Ue){const ce=Ue[Ie];for(const Ve in ce)m(ce[Ve].object),delete ce[Ve];delete Ue[Ie]}}delete n[H]}}function ie(H){if(n[H.id]===void 0)return;const Me=n[H.id];for(const Oe in Me){const Ue=Me[Oe];for(const Ie in Ue){const ce=Ue[Ie];for(const Ve in ce)m(ce[Ve].object),delete ce[Ve];delete Ue[Ie]}}delete n[H.id]}function se(H){for(const Me in n){const Oe=n[Me];for(const Ue in Oe){const Ie=Oe[Ue];if(Ie[H.id]===void 0)continue;const ce=Ie[H.id];for(const Ve in ce)m(ce[Ve].object),delete ce[Ve];delete Ie[H.id]}}}function z(H){for(const Me in n){const Oe=n[Me],Ue=H.isInstancedMesh===!0?H.id:0,Ie=Oe[Ue];if(Ie!==void 0){for(const ce in Ie){const Ve=Ie[ce];for(const Pe in Ve)m(Ve[Pe].object),delete Ve[Pe];delete Ie[ce]}delete Oe[Ue],Object.keys(Oe).length===0&&delete n[Me]}}}function re(){ye(),o=!0,i!==r&&(i=r,h(i.object))}function ye(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:l,reset:re,resetDefaultState:ye,dispose:Z,releaseStatesOfGeometry:ie,releaseStatesOfObject:z,releaseStatesOfProgram:se,initAttributes:I,enableAttribute:D,disableUnusedAttributes:U}}function mWe(s,e,t){let n;function r(h){n=h}function i(h,m){s.drawArrays(n,h,m),t.update(m,n,1)}function o(h,m,y){y!==0&&(s.drawArraysInstanced(n,h,m,y),t.update(m,n,y))}function l(h,m,y){if(y===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,h,0,m,0,y);let w=0;for(let A=0;A<y;A++)w+=m[A];t.update(w,n,1)}function c(h,m,y,b){if(y===0)return;const w=e.get("WEBGL_multi_draw");if(w===null)for(let A=0;A<h.length;A++)o(h[A],m[A],b[A]);else{w.multiDrawArraysInstancedWEBGL(n,h,0,m,0,b,0,y);let A=0;for(let I=0;I<y;I++)A+=m[I]*b[I];t.update(A,n,1)}}this.setMode=r,this.render=i,this.renderInstances=o,this.renderMultiDraw=l,this.renderMultiDrawInstances=c}function gWe(s,e,t,n){let r;function i(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const se=e.get("EXT_texture_filter_anisotropic");r=s.getParameter(se.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(se){return!(se!==io&&n.convert(se)!==s.getParameter(s.IMPLEMENTATION_COLOR_READ_FORMAT))}function l(se){const z=se===ro&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(se!==yo&&n.convert(se)!==s.getParameter(s.IMPLEMENTATION_COLOR_READ_TYPE)&&se!==vo&&!z)}function c(se){if(se==="highp"){if(s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision>0)return"highp";se="mediump"}return se==="mediump"&&s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let h=t.precision!==void 0?t.precision:"highp";const m=c(h);m!==h&&(qt("WebGLRenderer:",h,"not supported, using",m,"instead."),h=m);const y=t.logarithmicDepthBuffer===!0,b=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),w=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),A=s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS),I=s.getParameter(s.MAX_TEXTURE_SIZE),D=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),P=s.getParameter(s.MAX_VERTEX_ATTRIBS),U=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS),j=s.getParameter(s.MAX_VARYING_VECTORS),C=s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS),Z=s.getParameter(s.MAX_SAMPLES),ie=s.getParameter(s.SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:i,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:l,precision:h,logarithmicDepthBuffer:y,reversedDepthBuffer:b,maxTextures:w,maxVertexTextures:A,maxTextureSize:I,maxCubemapSize:D,maxAttributes:P,maxVertexUniforms:U,maxVaryings:j,maxFragmentUniforms:C,maxSamples:Z,samples:ie}}function yWe(s){const e=this;let t=null,n=0,r=!1,i=!1;const o=new dg,l=new ci,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(y,b){const w=y.length!==0||b||n!==0||r;return r=b,n=y.length,w},this.beginShadows=function(){i=!0,m(null)},this.endShadows=function(){i=!1},this.setGlobalState=function(y,b){t=m(y,b,0)},this.setState=function(y,b,w){const A=y.clippingPlanes,I=y.clipIntersection,D=y.clipShadows,P=s.get(y);if(!r||A===null||A.length===0||i&&!D)i?m(null):h();else{const U=i?0:n,j=U*4;let C=P.clippingState||null;c.value=C,C=m(A,b,j,w);for(let Z=0;Z!==j;++Z)C[Z]=t[Z];P.clippingState=C,this.numIntersection=I?this.numPlanes:0,this.numPlanes+=U}};function h(){c.value!==t&&(c.value=t,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function m(y,b,w,A){const I=y!==null?y.length:0;let D=null;if(I!==0){if(D=c.value,A!==!0||D===null){const P=w+I*4,U=b.matrixWorldInverse;l.getNormalMatrix(U),(D===null||D.length<P)&&(D=new Float32Array(P));for(let j=0,C=w;j!==I;++j,C+=4)o.copy(y[j]).applyMatrix4(U,l),o.normal.toArray(D,C),D[C+3]=o.constant}c.value=D,c.needsUpdate=!0}return e.numPlanes=I,e.numIntersection=0,D}}const Ky=4,z6e=[.125,.215,.35,.446,.526,.582],F6=20,vWe=256,HM=new J3,V6e=new Tn;let Mq=null,Cq=0,Aq=0,Nq=!1;const xWe=new be;let G6e=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,t=0,n=.1,r=100,i={}){const{size:o=256,position:l=xWe}=i;Mq=this._renderer.getRenderTarget(),Cq=this._renderer.getActiveCubeFace(),Aq=this._renderer.getActiveMipmapLevel(),Nq=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,n,r,c,l),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=$6e(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=H6e(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(Mq,Cq,Aq),this._renderer.xr.enabled=Nq,e.scissorTest=!1,T_(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===fm||e.mapping===Eg?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Mq=this._renderer.getRenderTarget(),Cq=this._renderer.getActiveCubeFace(),Aq=this._renderer.getActiveMipmapLevel(),Nq=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:ds,minFilter:ds,generateMipmaps:!1,type:ro,format:io,colorSpace:vd,depthBuffer:!1},r=j6e(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=j6e(e,t,n);const{_lodMax:i}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=bWe(i)),this._blurMaterial=SWe(i,e,t),this._ggxMaterial=_We(i,e,t)}return r}_compileMaterial(e){const t=new gn(new Ki,e);this._renderer.compile(t,HM)}_sceneToCubeUV(e,t,n,r,i){const c=new Va(90,1,t,n),h=[1,-1,1,1,1,1],m=[1,1,1,-1,-1,-1],y=this._renderer,b=y.autoClear,w=y.toneMapping;y.getClearColor(V6e),y.toneMapping=Ta,y.autoClear=!1,y.state.buffers.depth.getReversed()&&(y.setRenderTarget(r),y.clearDepth(),y.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new gn(new _a,new rl({name:"PMREM.Background",side:bs,depthWrite:!1,depthTest:!1})));const I=this._backgroundBox,D=I.material;let P=!1;const U=e.background;U?U.isColor&&(D.color.copy(U),e.background=null,P=!0):(D.color.copy(V6e),P=!0);for(let j=0;j<6;j++){const C=j%3;C===0?(c.up.set(0,h[j],0),c.position.set(i.x,i.y,i.z),c.lookAt(i.x+m[j],i.y,i.z)):C===1?(c.up.set(0,0,h[j]),c.position.set(i.x,i.y,i.z),c.lookAt(i.x,i.y+m[j],i.z)):(c.up.set(0,h[j],0),c.position.set(i.x,i.y,i.z),c.lookAt(i.x,i.y,i.z+m[j]));const Z=this._cubeSize;T_(r,C*Z,j>2?Z:0,Z,Z),y.setRenderTarget(r),P&&y.render(I,c),y.render(e,c)}y.toneMapping=w,y.autoClear=b,e.background=U}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===fm||e.mapping===Eg;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=$6e()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=H6e());const i=r?this._cubemapMaterial:this._equirectMaterial,o=this._lodMeshes[0];o.material=i;const l=i.uniforms;l.envMap.value=e;const c=this._cubeSize;T_(t,0,0,3*c,2*c),n.setRenderTarget(t),n.render(o,HM)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodMeshes.length;for(let i=1;i<r;i++)this._applyGGXFilter(e,i-1,i);t.autoClear=n}_applyGGXFilter(e,t,n){const r=this._renderer,i=this._pingPongRenderTarget,o=this._ggxMaterial,l=this._lodMeshes[n];l.material=o;const c=o.uniforms,h=n/(this._lodMeshes.length-1),m=t/(this._lodMeshes.length-1),y=Math.sqrt(h*h-m*m),b=0+h*1.25,w=y*b,{_lodMax:A}=this,I=this._sizeLods[n],D=3*I*(n>A-Ky?n-A+Ky:0),P=4*(this._cubeSize-I);c.envMap.value=e.texture,c.roughness.value=w,c.mipInt.value=A-t,T_(i,D,P,3*I,2*I),r.setRenderTarget(i),r.render(l,HM),c.envMap.value=i.texture,c.roughness.value=0,c.mipInt.value=A-n,T_(e,D,P,3*I,2*I),r.setRenderTarget(e),r.render(l,HM)}_blur(e,t,n,r,i){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",i),this._halfBlur(o,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,o,l){const c=this._renderer,h=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&Ht("blur direction must be either latitudinal or longitudinal!");const m=3,y=this._lodMeshes[r];y.material=h;const b=h.uniforms,w=this._sizeLods[n]-1,A=isFinite(i)?Math.PI/(2*w):2*Math.PI/(2*F6-1),I=i/A,D=isFinite(i)?1+Math.floor(m*I):F6;D>F6&&qt(`sigmaRadians, ${i}, is too large and will clip, as it requested ${D} samples when the maximum is set to ${F6}`);const P=[];let U=0;for(let se=0;se<F6;++se){const z=se/I,re=Math.exp(-z*z/2);P.push(re),se===0?U+=re:se<D&&(U+=2*re)}for(let se=0;se<P.length;se++)P[se]=P[se]/U;b.envMap.value=e.texture,b.samples.value=D,b.weights.value=P,b.latitudinal.value=o==="latitudinal",l&&(b.poleAxis.value=l);const{_lodMax:j}=this;b.dTheta.value=A,b.mipInt.value=j-n;const C=this._sizeLods[r],Z=3*C*(r>j-Ky?r-j+Ky:0),ie=4*(this._cubeSize-C);T_(t,Z,ie,3*C,2*C),c.setRenderTarget(t),c.render(y,HM)}};function bWe(s){const e=[],t=[],n=[];let r=s;const i=s-Ky+1+z6e.length;for(let o=0;o<i;o++){const l=Math.pow(2,r);e.push(l);let c=1/l;o>s-Ky?c=z6e[o-s+Ky-1]:o===0&&(c=0),t.push(c);const h=1/(l-2),m=-h,y=1+h,b=[m,m,y,m,y,y,m,m,y,y,m,y],w=6,A=6,I=3,D=2,P=1,U=new Float32Array(I*A*w),j=new Float32Array(D*A*w),C=new Float32Array(P*A*w);for(let ie=0;ie<w;ie++){const se=ie%3*2/3-1,z=ie>2?0:-1,re=[se,z,0,se+2/3,z,0,se+2/3,z+1,0,se,z,0,se+2/3,z+1,0,se,z+1,0];U.set(re,I*A*ie),j.set(b,D*A*ie);const ye=[ie,ie,ie,ie,ie,ie];C.set(ye,P*A*ie)}const Z=new Ki;Z.setAttribute("position",new ja(U,I)),Z.setAttribute("uv",new ja(j,D)),Z.setAttribute("faceIndex",new ja(C,P)),n.push(new gn(Z,null)),r>Ky&&r--}return{lodMeshes:n,sizeLods:e,sigmas:t}}function j6e(s,e,t){const n=new hm(s,e,t);return n.texture.mapping=sx,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function T_(s,e,t,n,r){s.viewport.set(e,t,n,r),s.scissor.set(e,t,n,r)}function _We(s,e,t){return new bh({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:vWe,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${s}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:oB(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 4.1: Orthonormal basis
				vec3 T1 = vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(V, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + V.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * V;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:El,depthTest:!1,depthWrite:!1})}function SWe(s,e,t){const n=new Float32Array(F6),r=new be(0,1,0);return new bh({name:"SphericalGaussianBlur",defines:{n:F6,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${s}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:oB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:El,depthTest:!1,depthWrite:!1})}function H6e(){return new bh({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:oB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:El,depthTest:!1,depthWrite:!1})}function $6e(){return new bh({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:oB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:El,depthTest:!1,depthWrite:!1})}function oB(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}class wSe extends hm{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new yx(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new _a(5,5,5),i=new bh({name:"CubemapFromEquirect",uniforms:JS(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:bs,blending:El});i.uniforms.tEquirect.value=t;const o=new gn(r,i),l=t.minFilter;return t.minFilter===fd&&(t.minFilter=ds),new mSe(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,n=!0,r=!0){const i=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(i)}}function wWe(s){let e=new WeakMap,t=new WeakMap,n=null;function r(b,w=!1){return b==null?null:w?o(b):i(b)}function i(b){if(b&&b.isTexture){const w=b.mapping;if(w===K6||w===gS)if(e.has(b)){const A=e.get(b).texture;return l(A,b.mapping)}else{const A=b.image;if(A&&A.height>0){const I=new wSe(A.height);return I.fromEquirectangularTexture(s,b),e.set(b,I),b.addEventListener("dispose",h),l(I.texture,b.mapping)}else return null}}return b}function o(b){if(b&&b.isTexture){const w=b.mapping,A=w===K6||w===gS,I=w===fm||w===Eg;if(A||I){let D=t.get(b);const P=D!==void 0?D.texture.pmremVersion:0;if(b.isRenderTargetTexture&&b.pmremVersion!==P)return n===null&&(n=new G6e(s)),D=A?n.fromEquirectangular(b,D):n.fromCubemap(b,D),D.texture.pmremVersion=b.pmremVersion,t.set(b,D),D.texture;if(D!==void 0)return D.texture;{const U=b.image;return A&&U&&U.height>0||I&&U&&c(U)?(n===null&&(n=new G6e(s)),D=A?n.fromEquirectangular(b):n.fromCubemap(b),D.texture.pmremVersion=b.pmremVersion,t.set(b,D),b.addEventListener("dispose",m),D.texture):null}}}return b}function l(b,w){return w===K6?b.mapping=fm:w===gS&&(b.mapping=Eg),b}function c(b){let w=0;const A=6;for(let I=0;I<A;I++)b[I]!==void 0&&w++;return w===A}function h(b){const w=b.target;w.removeEventListener("dispose",h);const A=e.get(w);A!==void 0&&(e.delete(w),A.dispose())}function m(b){const w=b.target;w.removeEventListener("dispose",m);const A=t.get(w);A!==void 0&&(t.delete(w),A.dispose())}function y(){e=new WeakMap,t=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:r,dispose:y}}function TWe(s){const e={};function t(n){if(e[n]!==void 0)return e[n];const r=s.getExtension(n);return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const r=t(n);return r===null&&es("WebGLRenderer: "+n+" extension not supported."),r}}}function EWe(s,e,t,n){const r={},i=new WeakMap;function o(y){const b=y.target;b.index!==null&&e.remove(b.index);for(const A in b.attributes)e.remove(b.attributes[A]);b.removeEventListener("dispose",o),delete r[b.id];const w=i.get(b);w&&(e.remove(w),i.delete(b)),n.releaseStatesOfGeometry(b),b.isInstancedBufferGeometry===!0&&delete b._maxInstanceCount,t.memory.geometries--}function l(y,b){return r[b.id]===!0||(b.addEventListener("dispose",o),r[b.id]=!0,t.memory.geometries++),b}function c(y){const b=y.attributes;for(const w in b)e.update(b[w],s.ARRAY_BUFFER)}function h(y){const b=[],w=y.index,A=y.attributes.position;let I=0;if(A===void 0)return;if(w!==null){const U=w.array;I=w.version;for(let j=0,C=U.length;j<C;j+=3){const Z=U[j+0],ie=U[j+1],se=U[j+2];b.push(Z,ie,ie,se,se,Z)}}else{const U=A.array;I=A.version;for(let j=0,C=U.length/3-1;j<C;j+=3){const Z=j+0,ie=j+1,se=j+2;b.push(Z,ie,ie,se,se,Z)}}const D=new(A.count>=65535?ZK:iB)(b,1);D.version=I;const P=i.get(y);P&&e.remove(P),i.set(y,D)}function m(y){const b=i.get(y);if(b){const w=y.index;w!==null&&b.version<w.version&&h(y)}else h(y);return i.get(y)}return{get:l,update:c,getWireframeAttribute:m}}function MWe(s,e,t){let n;function r(b){n=b}let i,o;function l(b){i=b.type,o=b.bytesPerElement}function c(b,w){s.drawElements(n,w,i,b*o),t.update(w,n,1)}function h(b,w,A){A!==0&&(s.drawElementsInstanced(n,w,i,b*o,A),t.update(w,n,A))}function m(b,w,A){if(A===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,w,0,i,b,0,A);let D=0;for(let P=0;P<A;P++)D+=w[P];t.update(D,n,1)}function y(b,w,A,I){if(A===0)return;const D=e.get("WEBGL_multi_draw");if(D===null)for(let P=0;P<b.length;P++)h(b[P]/o,w[P],I[P]);else{D.multiDrawElementsInstancedWEBGL(n,w,0,i,b,0,I,0,A);let P=0;for(let U=0;U<A;U++)P+=w[U]*I[U];t.update(P,n,1)}}this.setMode=r,this.setIndex=l,this.render=c,this.renderInstances=h,this.renderMultiDraw=m,this.renderMultiDrawInstances=y}function CWe(s){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(i,o,l){switch(t.calls++,o){case s.TRIANGLES:t.triangles+=l*(i/3);break;case s.LINES:t.lines+=l*(i/2);break;case s.LINE_STRIP:t.lines+=l*(i-1);break;case s.LINE_LOOP:t.lines+=l*i;break;case s.POINTS:t.points+=l*i;break;default:Ht("WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:n}}function AWe(s,e,t){const n=new WeakMap,r=new zr;function i(o,l,c){const h=o.morphTargetInfluences,m=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,y=m!==void 0?m.length:0;let b=n.get(l);if(b===void 0||b.count!==y){let ye=function(){z.dispose(),n.delete(l),l.removeEventListener("dispose",ye)};var w=ye;b!==void 0&&b.texture.dispose();const A=l.morphAttributes.position!==void 0,I=l.morphAttributes.normal!==void 0,D=l.morphAttributes.color!==void 0,P=l.morphAttributes.position||[],U=l.morphAttributes.normal||[],j=l.morphAttributes.color||[];let C=0;A===!0&&(C=1),I===!0&&(C=2),D===!0&&(C=3);let Z=l.attributes.position.count*C,ie=1;Z>e.maxTextureSize&&(ie=Math.ceil(Z/e.maxTextureSize),Z=e.maxTextureSize);const se=new Float32Array(Z*ie*4*y),z=new YK(se,Z,ie,y);z.type=vo,z.needsUpdate=!0;const re=C*4;for(let H=0;H<y;H++){const Me=P[H],Oe=U[H],Ue=j[H],Ie=Z*ie*4*H;for(let ce=0;ce<Me.count;ce++){const Ve=ce*re;A===!0&&(r.fromBufferAttribute(Me,ce),se[Ie+Ve+0]=r.x,se[Ie+Ve+1]=r.y,se[Ie+Ve+2]=r.z,se[Ie+Ve+3]=0),I===!0&&(r.fromBufferAttribute(Oe,ce),se[Ie+Ve+4]=r.x,se[Ie+Ve+5]=r.y,se[Ie+Ve+6]=r.z,se[Ie+Ve+7]=0),D===!0&&(r.fromBufferAttribute(Ue,ce),se[Ie+Ve+8]=r.x,se[Ie+Ve+9]=r.y,se[Ie+Ve+10]=r.z,se[Ie+Ve+11]=Ue.itemSize===4?r.w:1)}}b={count:y,texture:z,size:new Ln(Z,ie)},n.set(l,b),l.addEventListener("dispose",ye)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(s,"morphTexture",o.morphTexture,t);else{let A=0;for(let D=0;D<h.length;D++)A+=h[D];const I=l.morphTargetsRelative?1:1-A;c.getUniforms().setValue(s,"morphTargetBaseInfluence",I),c.getUniforms().setValue(s,"morphTargetInfluences",h)}c.getUniforms().setValue(s,"morphTargetsTexture",b.texture,t),c.getUniforms().setValue(s,"morphTargetsTextureSize",b.size)}return{update:i}}function NWe(s,e,t,n,r){let i=new WeakMap;function o(h){const m=r.render.frame,y=h.geometry,b=e.get(h,y);if(i.get(b)!==m&&(e.update(b),i.set(b,m)),h.isInstancedMesh&&(h.hasEventListener("dispose",c)===!1&&h.addEventListener("dispose",c),i.get(h)!==m&&(t.update(h.instanceMatrix,s.ARRAY_BUFFER),h.instanceColor!==null&&t.update(h.instanceColor,s.ARRAY_BUFFER),i.set(h,m))),h.isSkinnedMesh){const w=h.skeleton;i.get(w)!==m&&(w.update(),i.set(w,m))}return b}function l(){i=new WeakMap}function c(h){const m=h.target;m.removeEventListener("dispose",c),n.releaseStatesOfObject(m),t.remove(m.instanceMatrix),m.instanceColor!==null&&t.remove(m.instanceColor)}return{update:o,dispose:l}}const PWe={[qF]:"LINEAR_TONE_MAPPING",[XF]:"REINHARD_TONE_MAPPING",[YF]:"CINEON_TONE_MAPPING",[KF]:"ACES_FILMIC_TONE_MAPPING",[ZF]:"AGX_TONE_MAPPING",[QF]:"NEUTRAL_TONE_MAPPING",[FK]:"CUSTOM_TONE_MAPPING"};function RWe(s,e,t,n,r){const i=new hm(e,t,{type:s,depthBuffer:n,stencilBuffer:r}),o=new hm(e,t,{type:ro,depthBuffer:!1,stencilBuffer:!1}),l=new Ki;l.setAttribute("position",new Fr([-1,3,0,-1,-1,0,3,-1,0],3)),l.setAttribute("uv",new Fr([0,2,0,0,2,0],2));const c=new UGe({uniforms:{tDiffuse:{value:null}},vertexShader:`
			precision highp float;

			uniform mat4 modelViewMatrix;
			uniform mat4 projectionMatrix;

			attribute vec3 position;
			attribute vec2 uv;

			varying vec2 vUv;

			void main() {
				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}`,fragmentShader:`
			precision highp float;

			uniform sampler2D tDiffuse;

			varying vec2 vUv;

			#include <tonemapping_pars_fragment>
			#include <colorspace_pars_fragment>

			void main() {
				gl_FragColor = texture2D( tDiffuse, vUv );

				#ifdef LINEAR_TONE_MAPPING
					gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );
				#elif defined( REINHARD_TONE_MAPPING )
					gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );
				#elif defined( CINEON_TONE_MAPPING )
					gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );
				#elif defined( ACES_FILMIC_TONE_MAPPING )
					gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );
				#elif defined( AGX_TONE_MAPPING )
					gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );
				#elif defined( NEUTRAL_TONE_MAPPING )
					gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );
				#elif defined( CUSTOM_TONE_MAPPING )
					gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );
				#endif

				#ifdef SRGB_TRANSFER
					gl_FragColor = sRGBTransferOETF( gl_FragColor );
				#endif
			}`,depthTest:!1,depthWrite:!1}),h=new gn(l,c),m=new J3(-1,1,1,-1,0,1);let y=null,b=null,w=!1,A,I=null,D=[],P=!1;this.setSize=function(U,j){i.setSize(U,j),o.setSize(U,j);for(let C=0;C<D.length;C++){const Z=D[C];Z.setSize&&Z.setSize(U,j)}},this.setEffects=function(U){D=U,P=D.length>0&&D[0].isRenderPass===!0;const j=i.width,C=i.height;for(let Z=0;Z<D.length;Z++){const ie=D[Z];ie.setSize&&ie.setSize(j,C)}},this.begin=function(U,j){if(w||U.toneMapping===Ta&&D.length===0)return!1;if(I=j,j!==null){const C=j.width,Z=j.height;(i.width!==C||i.height!==Z)&&this.setSize(C,Z)}return P===!1&&U.setRenderTarget(i),A=U.toneMapping,U.toneMapping=Ta,!0},this.hasRenderPass=function(){return P},this.end=function(U,j){U.toneMapping=A,w=!0;let C=i,Z=o;for(let ie=0;ie<D.length;ie++){const se=D[ie];if(se.enabled!==!1&&(se.render(U,Z,C,j),se.needsSwap!==!1)){const z=C;C=Z,Z=z}}if(y!==U.outputColorSpace||b!==U.toneMapping){y=U.outputColorSpace,b=U.toneMapping,c.defines={},Zn.getTransfer(y)===Yn&&(c.defines.SRGB_TRANSFER="");const ie=PWe[b];ie&&(c.defines[ie]=""),c.needsUpdate=!0}c.uniforms.tDiffuse.value=C.texture,U.setRenderTarget(I),U.render(h,m),I=null,w=!1},this.isCompositing=function(){return w},this.dispose=function(){i.dispose(),o.dispose(),l.dispose(),c.dispose()}}const TSe=new ol,BY=new Cc(1,1),ESe=new YK,MSe=new WVe,CSe=new yx,W6e=[],q6e=[],X6e=new Float32Array(16),Y6e=new Float32Array(9),K6e=new Float32Array(4);function ww(s,e,t){const n=s[0];if(n<=0||n>0)return s;const r=e*t;let i=W6e[r];if(i===void 0&&(i=new Float32Array(r),W6e[r]=i),e!==0){n.toArray(i,0);for(let o=1,l=0;o!==e;++o)l+=t,s[o].toArray(i,l)}return i}function Ml(s,e){if(s.length!==e.length)return!1;for(let t=0,n=s.length;t<n;t++)if(s[t]!==e[t])return!1;return!0}function Cl(s,e){for(let t=0,n=e.length;t<n;t++)s[t]=e[t]}function aB(s,e){let t=q6e[e];t===void 0&&(t=new Int32Array(e),q6e[e]=t);for(let n=0;n!==e;++n)t[n]=s.allocateTextureUnit();return t}function IWe(s,e){const t=this.cache;t[0]!==e&&(s.uniform1f(this.addr,e),t[0]=e)}function kWe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ml(t,e))return;s.uniform2fv(this.addr,e),Cl(t,e)}}function DWe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(s.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ml(t,e))return;s.uniform3fv(this.addr,e),Cl(t,e)}}function OWe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ml(t,e))return;s.uniform4fv(this.addr,e),Cl(t,e)}}function LWe(s,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ml(t,e))return;s.uniformMatrix2fv(this.addr,!1,e),Cl(t,e)}else{if(Ml(t,n))return;K6e.set(n),s.uniformMatrix2fv(this.addr,!1,K6e),Cl(t,n)}}function FWe(s,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ml(t,e))return;s.uniformMatrix3fv(this.addr,!1,e),Cl(t,e)}else{if(Ml(t,n))return;Y6e.set(n),s.uniformMatrix3fv(this.addr,!1,Y6e),Cl(t,n)}}function BWe(s,e){const t=this.cache,n=e.elements;if(n===void 0){if(Ml(t,e))return;s.uniformMatrix4fv(this.addr,!1,e),Cl(t,e)}else{if(Ml(t,n))return;X6e.set(n),s.uniformMatrix4fv(this.addr,!1,X6e),Cl(t,n)}}function UWe(s,e){const t=this.cache;t[0]!==e&&(s.uniform1i(this.addr,e),t[0]=e)}function zWe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ml(t,e))return;s.uniform2iv(this.addr,e),Cl(t,e)}}function VWe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ml(t,e))return;s.uniform3iv(this.addr,e),Cl(t,e)}}function GWe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ml(t,e))return;s.uniform4iv(this.addr,e),Cl(t,e)}}function jWe(s,e){const t=this.cache;t[0]!==e&&(s.uniform1ui(this.addr,e),t[0]=e)}function HWe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ml(t,e))return;s.uniform2uiv(this.addr,e),Cl(t,e)}}function $We(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ml(t,e))return;s.uniform3uiv(this.addr,e),Cl(t,e)}}function WWe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ml(t,e))return;s.uniform4uiv(this.addr,e),Cl(t,e)}}function qWe(s,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(s.uniform1i(this.addr,r),n[0]=r);let i;this.type===s.SAMPLER_2D_SHADOW?(BY.compareFunction=t.isReversedDepthBuffer()?gx:mx,i=BY):i=TSe,t.setTexture2D(e||i,r)}function XWe(s,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(s.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||MSe,r)}function YWe(s,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(s.uniform1i(this.addr,r),n[0]=r),t.setTextureCube(e||CSe,r)}function KWe(s,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(s.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||ESe,r)}function ZWe(s){switch(s){case 5126:return IWe;case 35664:return kWe;case 35665:return DWe;case 35666:return OWe;case 35674:return LWe;case 35675:return FWe;case 35676:return BWe;case 5124:case 35670:return UWe;case 35667:case 35671:return zWe;case 35668:case 35672:return VWe;case 35669:case 35673:return GWe;case 5125:return jWe;case 36294:return HWe;case 36295:return $We;case 36296:return WWe;case 35678:case 36198:case 36298:case 36306:case 35682:return qWe;case 35679:case 36299:case 36307:return XWe;case 35680:case 36300:case 36308:case 36293:return YWe;case 36289:case 36303:case 36311:case 36292:return KWe}}function QWe(s,e){s.uniform1fv(this.addr,e)}function JWe(s,e){const t=ww(e,this.size,2);s.uniform2fv(this.addr,t)}function eqe(s,e){const t=ww(e,this.size,3);s.uniform3fv(this.addr,t)}function tqe(s,e){const t=ww(e,this.size,4);s.uniform4fv(this.addr,t)}function nqe(s,e){const t=ww(e,this.size,4);s.uniformMatrix2fv(this.addr,!1,t)}function rqe(s,e){const t=ww(e,this.size,9);s.uniformMatrix3fv(this.addr,!1,t)}function iqe(s,e){const t=ww(e,this.size,16);s.uniformMatrix4fv(this.addr,!1,t)}function sqe(s,e){s.uniform1iv(this.addr,e)}function oqe(s,e){s.uniform2iv(this.addr,e)}function aqe(s,e){s.uniform3iv(this.addr,e)}function lqe(s,e){s.uniform4iv(this.addr,e)}function cqe(s,e){s.uniform1uiv(this.addr,e)}function uqe(s,e){s.uniform2uiv(this.addr,e)}function dqe(s,e){s.uniform3uiv(this.addr,e)}function hqe(s,e){s.uniform4uiv(this.addr,e)}function pqe(s,e,t){const n=this.cache,r=e.length,i=aB(t,r);Ml(n,i)||(s.uniform1iv(this.addr,i),Cl(n,i));let o;this.type===s.SAMPLER_2D_SHADOW?o=BY:o=TSe;for(let l=0;l!==r;++l)t.setTexture2D(e[l]||o,i[l])}function fqe(s,e,t){const n=this.cache,r=e.length,i=aB(t,r);Ml(n,i)||(s.uniform1iv(this.addr,i),Cl(n,i));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||MSe,i[o])}function mqe(s,e,t){const n=this.cache,r=e.length,i=aB(t,r);Ml(n,i)||(s.uniform1iv(this.addr,i),Cl(n,i));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||CSe,i[o])}function gqe(s,e,t){const n=this.cache,r=e.length,i=aB(t,r);Ml(n,i)||(s.uniform1iv(this.addr,i),Cl(n,i));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||ESe,i[o])}function yqe(s){switch(s){case 5126:return QWe;case 35664:return JWe;case 35665:return eqe;case 35666:return tqe;case 35674:return nqe;case 35675:return rqe;case 35676:return iqe;case 5124:case 35670:return sqe;case 35667:case 35671:return oqe;case 35668:case 35672:return aqe;case 35669:case 35673:return lqe;case 5125:return cqe;case 36294:return uqe;case 36295:return dqe;case 36296:return hqe;case 35678:case 36198:case 36298:case 36306:case 35682:return pqe;case 35679:case 36299:case 36307:return fqe;case 35680:case 36300:case 36308:case 36293:return mqe;case 36289:case 36303:case 36311:case 36292:return gqe}}class vqe{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=ZWe(t.type)}}class xqe{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=yqe(t.type)}}class bqe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const l=r[i];l.setValue(e,t[l.id],n)}}}const Pq=/(\w+)(\])?(\[|\.)?/g;function Z6e(s,e){s.seq.push(e),s.map[e.id]=e}function _qe(s,e,t){const n=s.name,r=n.length;for(Pq.lastIndex=0;;){const i=Pq.exec(n),o=Pq.lastIndex;let l=i[1];const c=i[2]==="]",h=i[3];if(c&&(l=l|0),h===void 0||h==="["&&o+2===r){Z6e(t,h===void 0?new vqe(l,s,e):new xqe(l,s,e));break}else{let y=t.map[l];y===void 0&&(y=new bqe(l),Z6e(t,y)),t=y}}}class $L{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let o=0;o<n;++o){const l=e.getActiveUniform(t,o),c=e.getUniformLocation(t,l.name);_qe(l,c,this)}const r=[],i=[];for(const o of this.seq)o.type===e.SAMPLER_2D_SHADOW||o.type===e.SAMPLER_CUBE_SHADOW||o.type===e.SAMPLER_2D_ARRAY_SHADOW?r.push(o):i.push(o);r.length>0&&(this.seq=r.concat(i))}setValue(e,t,n,r){const i=this.map[t];i!==void 0&&i.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let i=0,o=t.length;i!==o;++i){const l=t[i],c=n[l.id];c.needsUpdate!==!1&&l.setValue(e,c.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const o=e[r];o.id in t&&n.push(o)}return n}}function Q6e(s,e,t){const n=s.createShader(e);return s.shaderSource(n,t),s.compileShader(n),n}const Sqe=37297;let wqe=0;function Tqe(s,e){const t=s.split(`
`),n=[],r=Math.max(e-6,0),i=Math.min(e+6,t.length);for(let o=r;o<i;o++){const l=o+1;n.push(`${l===e?">":" "} ${l}: ${t[o]}`)}return n.join(`
`)}const J6e=new ci;function Eqe(s){Zn._getMatrix(J6e,Zn.workingColorSpace,s);const e=`mat3( ${J6e.elements.map(t=>t.toFixed(4))} )`;switch(Zn.getTransfer(s)){case KS:return[e,"LinearTransferOETF"];case Yn:return[e,"sRGBTransferOETF"];default:return qt("WebGLProgram: Unsupported color space: ",s),[e,"LinearTransferOETF"]}}function exe(s,e,t){const n=s.getShaderParameter(e,s.COMPILE_STATUS),i=(s.getShaderInfoLog(e)||"").trim();if(n&&i==="")return"";const o=/ERROR: 0:(\d+)/.exec(i);if(o){const l=parseInt(o[1]);return t.toUpperCase()+`

`+i+`

`+Tqe(s.getShaderSource(e),l)}else return i}function Mqe(s,e){const t=Eqe(e);return[`vec4 ${s}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}const Cqe={[qF]:"Linear",[XF]:"Reinhard",[YF]:"Cineon",[KF]:"ACESFilmic",[ZF]:"AgX",[QF]:"Neutral",[FK]:"Custom"};function Aqe(s,e){const t=Cqe[e];return t===void 0?(qt("WebGLProgram: Unsupported toneMapping:",e),"vec3 "+s+"( vec3 color ) { return LinearToneMapping( color ); }"):"vec3 "+s+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const TO=new be;function Nqe(){Zn.getLuminanceCoefficients(TO);const s=TO.x.toFixed(4),e=TO.y.toFixed(4),t=TO.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${s}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function Pqe(s){return[s.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",s.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(MC).join(`
`)}function Rqe(s){const e=[];for(const t in s){const n=s[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function Iqe(s,e){const t={},n=s.getProgramParameter(e,s.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const i=s.getActiveAttrib(e,r),o=i.name;let l=1;i.type===s.FLOAT_MAT2&&(l=2),i.type===s.FLOAT_MAT3&&(l=3),i.type===s.FLOAT_MAT4&&(l=4),t[o]={type:i.type,location:s.getAttribLocation(e,o),locationSize:l}}return t}function MC(s){return s!==""}function txe(s,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return s.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function nxe(s,e){return s.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const kqe=/^[ \t]*#include +<([\w\d./]+)>/gm;function UY(s){return s.replace(kqe,Oqe)}const Dqe=new Map;function Oqe(s,e){let t=Mi[e];if(t===void 0){const n=Dqe.get(e);if(n!==void 0)t=Mi[n],qt('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return UY(t)}const Lqe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function rxe(s){return s.replace(Lqe,Fqe)}function Fqe(s,e,t,n){let r="";for(let i=parseInt(e);i<parseInt(t);i++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+i+" ]").replace(/UNROLLED_LOOP_INDEX/g,i);return r}function ixe(s){let e=`precision ${s.precision} float;
	precision ${s.precision} int;
	precision ${s.precision} sampler2D;
	precision ${s.precision} samplerCube;
	precision ${s.precision} sampler3D;
	precision ${s.precision} sampler2DArray;
	precision ${s.precision} sampler2DShadow;
	precision ${s.precision} samplerCubeShadow;
	precision ${s.precision} sampler2DArrayShadow;
	precision ${s.precision} isampler2D;
	precision ${s.precision} isampler3D;
	precision ${s.precision} isamplerCube;
	precision ${s.precision} isampler2DArray;
	precision ${s.precision} usampler2D;
	precision ${s.precision} usampler3D;
	precision ${s.precision} usamplerCube;
	precision ${s.precision} usampler2DArray;
	`;return s.precision==="highp"?e+=`
#define HIGH_PRECISION`:s.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:s.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}const Bqe={[mS]:"SHADOWMAP_TYPE_PCF",[mg]:"SHADOWMAP_TYPE_VSM"};function Uqe(s){return Bqe[s.shadowMapType]||"SHADOWMAP_TYPE_BASIC"}const zqe={[fm]:"ENVMAP_TYPE_CUBE",[Eg]:"ENVMAP_TYPE_CUBE",[sx]:"ENVMAP_TYPE_CUBE_UV"};function Vqe(s){return s.envMap===!1?"ENVMAP_TYPE_CUBE":zqe[s.envMapMode]||"ENVMAP_TYPE_CUBE"}const Gqe={[Eg]:"ENVMAP_MODE_REFRACTION"};function jqe(s){return s.envMap===!1?"ENVMAP_MODE_REFLECTION":Gqe[s.envMapMode]||"ENVMAP_MODE_REFLECTION"}const Hqe={[WA]:"ENVMAP_BLENDING_MULTIPLY",[D_e]:"ENVMAP_BLENDING_MIX",[O_e]:"ENVMAP_BLENDING_ADD"};function $qe(s){return s.envMap===!1?"ENVMAP_BLENDING_NONE":Hqe[s.combine]||"ENVMAP_BLENDING_NONE"}function Wqe(s){const e=s.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function qqe(s,e,t,n){const r=s.getContext(),i=t.defines;let o=t.vertexShader,l=t.fragmentShader;const c=Uqe(t),h=Vqe(t),m=jqe(t),y=$qe(t),b=Wqe(t),w=Pqe(t),A=Rqe(i),I=r.createProgram();let D,P,U=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(D=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,A].filter(MC).join(`
`),D.length>0&&(D+=`
`),P=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,A].filter(MC).join(`
`),P.length>0&&(P+=`
`)):(D=[ixe(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,A,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+m:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(MC).join(`
`),P=[ixe(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,A,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.envMap?"#define "+m:"",t.envMap?"#define "+y:"",b?"#define CUBEUV_TEXEL_WIDTH "+b.texelWidth:"",b?"#define CUBEUV_TEXEL_HEIGHT "+b.texelHeight:"",b?"#define CUBEUV_MAX_MIP "+b.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas||t.batchingColor?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Ta?"#define TONE_MAPPING":"",t.toneMapping!==Ta?Mi.tonemapping_pars_fragment:"",t.toneMapping!==Ta?Aqe("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Mi.colorspace_pars_fragment,Mqe("linearToOutputTexel",t.outputColorSpace),Nqe(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(MC).join(`
`)),o=UY(o),o=txe(o,t),o=nxe(o,t),l=UY(l),l=txe(l,t),l=nxe(l,t),o=rxe(o),l=rxe(l),t.isRawShaderMaterial!==!0&&(U=`#version 300 es
`,D=[w,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+D,P=["#define varying in",t.glslVersion===AY?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===AY?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+P);const j=U+D+o,C=U+P+l,Z=Q6e(r,r.VERTEX_SHADER,j),ie=Q6e(r,r.FRAGMENT_SHADER,C);r.attachShader(I,Z),r.attachShader(I,ie),t.index0AttributeName!==void 0?r.bindAttribLocation(I,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(I,0,"position"),r.linkProgram(I);function se(H){if(s.debug.checkShaderErrors){const Me=r.getProgramInfoLog(I)||"",Oe=r.getShaderInfoLog(Z)||"",Ue=r.getShaderInfoLog(ie)||"",Ie=Me.trim(),ce=Oe.trim(),Ve=Ue.trim();let Pe=!0,We=!0;if(r.getProgramParameter(I,r.LINK_STATUS)===!1)if(Pe=!1,typeof s.debug.onShaderError=="function")s.debug.onShaderError(r,I,Z,ie);else{const pt=exe(r,Z,"vertex"),Ne=exe(r,ie,"fragment");Ht("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(I,r.VALIDATE_STATUS)+`

Material Name: `+H.name+`
Material Type: `+H.type+`

Program Info Log: `+Ie+`
`+pt+`
`+Ne)}else Ie!==""?qt("WebGLProgram: Program Info Log:",Ie):(ce===""||Ve==="")&&(We=!1);We&&(H.diagnostics={runnable:Pe,programLog:Ie,vertexShader:{log:ce,prefix:D},fragmentShader:{log:Ve,prefix:P}})}r.deleteShader(Z),r.deleteShader(ie),z=new $L(r,I),re=Iqe(r,I)}let z;this.getUniforms=function(){return z===void 0&&se(this),z};let re;this.getAttributes=function(){return re===void 0&&se(this),re};let ye=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return ye===!1&&(ye=r.getProgramParameter(I,Sqe)),ye},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(I),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=wqe++,this.cacheKey=e,this.usedTimes=1,this.program=I,this.vertexShader=Z,this.fragmentShader=ie,this}let Xqe=0;class Yqe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(i)===!1&&(o.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new Kqe(e),t.set(e,n)),n}}class Kqe{constructor(e){this.id=Xqe++,this.code=e,this.usedTimes=0}}function Zqe(s,e,t,n,r,i){const o=new KK,l=new Yqe,c=new Set,h=[],m=new Map,y=n.logarithmicDepthBuffer;let b=n.precision;const w={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distance",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function A(z){return c.add(z),z===0?"uv":`uv${z}`}function I(z,re,ye,H,Me){const Oe=H.fog,Ue=Me.geometry,Ie=z.isMeshStandardMaterial||z.isMeshLambertMaterial||z.isMeshPhongMaterial?H.environment:null,ce=z.isMeshStandardMaterial||z.isMeshLambertMaterial&&!z.envMap||z.isMeshPhongMaterial&&!z.envMap,Ve=e.get(z.envMap||Ie,ce),Pe=Ve&&Ve.mapping===sx?Ve.image.height:null,We=w[z.type];z.precision!==null&&(b=n.getMaxPrecision(z.precision),b!==z.precision&&qt("WebGLProgram.getParameters:",z.precision,"not supported, using",b,"instead."));const pt=Ue.morphAttributes.position||Ue.morphAttributes.normal||Ue.morphAttributes.color,Ne=pt!==void 0?pt.length:0;let st=0;Ue.morphAttributes.position!==void 0&&(st=1),Ue.morphAttributes.normal!==void 0&&(st=2),Ue.morphAttributes.color!==void 0&&(st=3);let Pt,yn,bn,St;if(We){const Pr=hg[We];Pt=Pr.vertexShader,yn=Pr.fragmentShader}else Pt=z.vertexShader,yn=z.fragmentShader,l.update(z),bn=l.getVertexShaderID(z),St=l.getFragmentShaderID(z);const Ut=s.getRenderTarget(),Wt=s.state.buffers.depth.getReversed(),kn=Me.isInstancedMesh===!0,Dn=Me.isBatchedMesh===!0,or=!!z.map,ns=!!z.matcap,Xr=!!Ve,Vr=!!z.aoMap,Kr=!!z.lightMap,Yr=!!z.bumpMap,mi=!!z.normalMap,Ke=!!z.displacementMap,_s=!!z.emissiveMap,ui=!!z.metalnessMap,Ti=!!z.roughnessMap,Vn=z.anisotropy>0,ke=z.clearcoat>0,de=z.dispersion>0,ht=z.iridescence>0,Xt=z.sheen>0,Kt=z.transmission>0,Vt=Vn&&!!z.anisotropyMap,Qn=ke&&!!z.clearcoatMap,wn=ke&&!!z.clearcoatNormalMap,ar=ke&&!!z.clearcoatRoughnessMap,Ir=ht&&!!z.iridescenceMap,en=ht&&!!z.iridescenceThicknessMap,vn=Xt&&!!z.sheenColorMap,Gn=Xt&&!!z.sheenRoughnessMap,$n=!!z.specularMap,Bn=!!z.specularColorMap,Cr=!!z.specularIntensityMap,et=Kt&&!!z.transmissionMap,_n=Kt&&!!z.thicknessMap,pn=!!z.gradientMap,Nn=!!z.alphaMap,cn=z.alphaTest>0,jt=!!z.alphaHash,Wn=!!z.extensions;let Br=Ta;z.toneMapped&&(Ut===null||Ut.isXRRenderTarget===!0)&&(Br=s.toneMapping);const Hi={shaderID:We,shaderType:z.type,shaderName:z.name,vertexShader:Pt,fragmentShader:yn,defines:z.defines,customVertexShaderID:bn,customFragmentShaderID:St,isRawShaderMaterial:z.isRawShaderMaterial===!0,glslVersion:z.glslVersion,precision:b,batching:Dn,batchingColor:Dn&&Me._colorsTexture!==null,instancing:kn,instancingColor:kn&&Me.instanceColor!==null,instancingMorph:kn&&Me.morphTexture!==null,outputColorSpace:Ut===null?s.outputColorSpace:Ut.isXRRenderTarget===!0?Ut.texture.colorSpace:vd,alphaToCoverage:!!z.alphaToCoverage,map:or,matcap:ns,envMap:Xr,envMapMode:Xr&&Ve.mapping,envMapCubeUVHeight:Pe,aoMap:Vr,lightMap:Kr,bumpMap:Yr,normalMap:mi,displacementMap:Ke,emissiveMap:_s,normalMapObjectSpace:mi&&z.normalMapType===L_e,normalMapTangentSpace:mi&&z.normalMapType===yg,metalnessMap:ui,roughnessMap:Ti,anisotropy:Vn,anisotropyMap:Vt,clearcoat:ke,clearcoatMap:Qn,clearcoatNormalMap:wn,clearcoatRoughnessMap:ar,dispersion:de,iridescence:ht,iridescenceMap:Ir,iridescenceThicknessMap:en,sheen:Xt,sheenColorMap:vn,sheenRoughnessMap:Gn,specularMap:$n,specularColorMap:Bn,specularIntensityMap:Cr,transmission:Kt,transmissionMap:et,thicknessMap:_n,gradientMap:pn,opaque:z.transparent===!1&&z.blending===L0&&z.alphaToCoverage===!1,alphaMap:Nn,alphaTest:cn,alphaHash:jt,combine:z.combine,mapUv:or&&A(z.map.channel),aoMapUv:Vr&&A(z.aoMap.channel),lightMapUv:Kr&&A(z.lightMap.channel),bumpMapUv:Yr&&A(z.bumpMap.channel),normalMapUv:mi&&A(z.normalMap.channel),displacementMapUv:Ke&&A(z.displacementMap.channel),emissiveMapUv:_s&&A(z.emissiveMap.channel),metalnessMapUv:ui&&A(z.metalnessMap.channel),roughnessMapUv:Ti&&A(z.roughnessMap.channel),anisotropyMapUv:Vt&&A(z.anisotropyMap.channel),clearcoatMapUv:Qn&&A(z.clearcoatMap.channel),clearcoatNormalMapUv:wn&&A(z.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ar&&A(z.clearcoatRoughnessMap.channel),iridescenceMapUv:Ir&&A(z.iridescenceMap.channel),iridescenceThicknessMapUv:en&&A(z.iridescenceThicknessMap.channel),sheenColorMapUv:vn&&A(z.sheenColorMap.channel),sheenRoughnessMapUv:Gn&&A(z.sheenRoughnessMap.channel),specularMapUv:$n&&A(z.specularMap.channel),specularColorMapUv:Bn&&A(z.specularColorMap.channel),specularIntensityMapUv:Cr&&A(z.specularIntensityMap.channel),transmissionMapUv:et&&A(z.transmissionMap.channel),thicknessMapUv:_n&&A(z.thicknessMap.channel),alphaMapUv:Nn&&A(z.alphaMap.channel),vertexTangents:!!Ue.attributes.tangent&&(mi||Vn),vertexColors:z.vertexColors,vertexAlphas:z.vertexColors===!0&&!!Ue.attributes.color&&Ue.attributes.color.itemSize===4,pointsUvs:Me.isPoints===!0&&!!Ue.attributes.uv&&(or||Nn),fog:!!Oe,useFog:z.fog===!0,fogExp2:!!Oe&&Oe.isFogExp2,flatShading:z.wireframe===!1&&(z.flatShading===!0||Ue.attributes.normal===void 0&&mi===!1&&(z.isMeshLambertMaterial||z.isMeshPhongMaterial||z.isMeshStandardMaterial||z.isMeshPhysicalMaterial)),sizeAttenuation:z.sizeAttenuation===!0,logarithmicDepthBuffer:y,reversedDepthBuffer:Wt,skinning:Me.isSkinnedMesh===!0,morphTargets:Ue.morphAttributes.position!==void 0,morphNormals:Ue.morphAttributes.normal!==void 0,morphColors:Ue.morphAttributes.color!==void 0,morphTargetsCount:Ne,morphTextureStride:st,numDirLights:re.directional.length,numPointLights:re.point.length,numSpotLights:re.spot.length,numSpotLightMaps:re.spotLightMap.length,numRectAreaLights:re.rectArea.length,numHemiLights:re.hemi.length,numDirLightShadows:re.directionalShadowMap.length,numPointLightShadows:re.pointShadowMap.length,numSpotLightShadows:re.spotShadowMap.length,numSpotLightShadowsWithMaps:re.numSpotLightShadowsWithMaps,numLightProbes:re.numLightProbes,numClippingPlanes:i.numPlanes,numClipIntersection:i.numIntersection,dithering:z.dithering,shadowMapEnabled:s.shadowMap.enabled&&ye.length>0,shadowMapType:s.shadowMap.type,toneMapping:Br,decodeVideoTexture:or&&z.map.isVideoTexture===!0&&Zn.getTransfer(z.map.colorSpace)===Yn,decodeVideoTextureEmissive:_s&&z.emissiveMap.isVideoTexture===!0&&Zn.getTransfer(z.emissiveMap.colorSpace)===Yn,premultipliedAlpha:z.premultipliedAlpha,doubleSided:z.side===oa,flipSided:z.side===bs,useDepthPacking:z.depthPacking>=0,depthPacking:z.depthPacking||0,index0AttributeName:z.index0AttributeName,extensionClipCullDistance:Wn&&z.extensions.clipCullDistance===!0&&t.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Wn&&z.extensions.multiDraw===!0||Dn)&&t.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:t.has("KHR_parallel_shader_compile"),customProgramCacheKey:z.customProgramCacheKey()};return Hi.vertexUv1s=c.has(1),Hi.vertexUv2s=c.has(2),Hi.vertexUv3s=c.has(3),c.clear(),Hi}function D(z){const re=[];if(z.shaderID?re.push(z.shaderID):(re.push(z.customVertexShaderID),re.push(z.customFragmentShaderID)),z.defines!==void 0)for(const ye in z.defines)re.push(ye),re.push(z.defines[ye]);return z.isRawShaderMaterial===!1&&(P(re,z),U(re,z),re.push(s.outputColorSpace)),re.push(z.customProgramCacheKey),re.join()}function P(z,re){z.push(re.precision),z.push(re.outputColorSpace),z.push(re.envMapMode),z.push(re.envMapCubeUVHeight),z.push(re.mapUv),z.push(re.alphaMapUv),z.push(re.lightMapUv),z.push(re.aoMapUv),z.push(re.bumpMapUv),z.push(re.normalMapUv),z.push(re.displacementMapUv),z.push(re.emissiveMapUv),z.push(re.metalnessMapUv),z.push(re.roughnessMapUv),z.push(re.anisotropyMapUv),z.push(re.clearcoatMapUv),z.push(re.clearcoatNormalMapUv),z.push(re.clearcoatRoughnessMapUv),z.push(re.iridescenceMapUv),z.push(re.iridescenceThicknessMapUv),z.push(re.sheenColorMapUv),z.push(re.sheenRoughnessMapUv),z.push(re.specularMapUv),z.push(re.specularColorMapUv),z.push(re.specularIntensityMapUv),z.push(re.transmissionMapUv),z.push(re.thicknessMapUv),z.push(re.combine),z.push(re.fogExp2),z.push(re.sizeAttenuation),z.push(re.morphTargetsCount),z.push(re.morphAttributeCount),z.push(re.numDirLights),z.push(re.numPointLights),z.push(re.numSpotLights),z.push(re.numSpotLightMaps),z.push(re.numHemiLights),z.push(re.numRectAreaLights),z.push(re.numDirLightShadows),z.push(re.numPointLightShadows),z.push(re.numSpotLightShadows),z.push(re.numSpotLightShadowsWithMaps),z.push(re.numLightProbes),z.push(re.shadowMapType),z.push(re.toneMapping),z.push(re.numClippingPlanes),z.push(re.numClipIntersection),z.push(re.depthPacking)}function U(z,re){o.disableAll(),re.instancing&&o.enable(0),re.instancingColor&&o.enable(1),re.instancingMorph&&o.enable(2),re.matcap&&o.enable(3),re.envMap&&o.enable(4),re.normalMapObjectSpace&&o.enable(5),re.normalMapTangentSpace&&o.enable(6),re.clearcoat&&o.enable(7),re.iridescence&&o.enable(8),re.alphaTest&&o.enable(9),re.vertexColors&&o.enable(10),re.vertexAlphas&&o.enable(11),re.vertexUv1s&&o.enable(12),re.vertexUv2s&&o.enable(13),re.vertexUv3s&&o.enable(14),re.vertexTangents&&o.enable(15),re.anisotropy&&o.enable(16),re.alphaHash&&o.enable(17),re.batching&&o.enable(18),re.dispersion&&o.enable(19),re.batchingColor&&o.enable(20),re.gradientMap&&o.enable(21),z.push(o.mask),o.disableAll(),re.fog&&o.enable(0),re.useFog&&o.enable(1),re.flatShading&&o.enable(2),re.logarithmicDepthBuffer&&o.enable(3),re.reversedDepthBuffer&&o.enable(4),re.skinning&&o.enable(5),re.morphTargets&&o.enable(6),re.morphNormals&&o.enable(7),re.morphColors&&o.enable(8),re.premultipliedAlpha&&o.enable(9),re.shadowMapEnabled&&o.enable(10),re.doubleSided&&o.enable(11),re.flipSided&&o.enable(12),re.useDepthPacking&&o.enable(13),re.dithering&&o.enable(14),re.transmission&&o.enable(15),re.sheen&&o.enable(16),re.opaque&&o.enable(17),re.pointsUvs&&o.enable(18),re.decodeVideoTexture&&o.enable(19),re.decodeVideoTextureEmissive&&o.enable(20),re.alphaToCoverage&&o.enable(21),z.push(o.mask)}function j(z){const re=w[z.type];let ye;if(re){const H=hg[re];ye=LGe.clone(H.uniforms)}else ye=z.uniforms;return ye}function C(z,re){let ye=m.get(re);return ye!==void 0?++ye.usedTimes:(ye=new qqe(s,re,z,r),h.push(ye),m.set(re,ye)),ye}function Z(z){if(--z.usedTimes===0){const re=h.indexOf(z);h[re]=h[h.length-1],h.pop(),m.delete(z.cacheKey),z.destroy()}}function ie(z){l.remove(z)}function se(){l.dispose()}return{getParameters:I,getProgramCacheKey:D,getUniforms:j,acquireProgram:C,releaseProgram:Z,releaseShaderCache:ie,programs:h,dispose:se}}function Qqe(){let s=new WeakMap;function e(o){return s.has(o)}function t(o){let l=s.get(o);return l===void 0&&(l={},s.set(o,l)),l}function n(o){s.delete(o)}function r(o,l,c){s.get(o)[l]=c}function i(){s=new WeakMap}return{has:e,get:t,remove:n,update:r,dispose:i}}function Jqe(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.material.id!==e.material.id?s.material.id-e.material.id:s.materialVariant!==e.materialVariant?s.materialVariant-e.materialVariant:s.z!==e.z?s.z-e.z:s.id-e.id}function sxe(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.z!==e.z?e.z-s.z:s.id-e.id}function oxe(){const s=[];let e=0;const t=[],n=[],r=[];function i(){e=0,t.length=0,n.length=0,r.length=0}function o(b){let w=0;return b.isInstancedMesh&&(w+=2),b.isSkinnedMesh&&(w+=1),w}function l(b,w,A,I,D,P){let U=s[e];return U===void 0?(U={id:b.id,object:b,geometry:w,material:A,materialVariant:o(b),groupOrder:I,renderOrder:b.renderOrder,z:D,group:P},s[e]=U):(U.id=b.id,U.object=b,U.geometry=w,U.material=A,U.materialVariant=o(b),U.groupOrder=I,U.renderOrder=b.renderOrder,U.z=D,U.group=P),e++,U}function c(b,w,A,I,D,P){const U=l(b,w,A,I,D,P);A.transmission>0?n.push(U):A.transparent===!0?r.push(U):t.push(U)}function h(b,w,A,I,D,P){const U=l(b,w,A,I,D,P);A.transmission>0?n.unshift(U):A.transparent===!0?r.unshift(U):t.unshift(U)}function m(b,w){t.length>1&&t.sort(b||Jqe),n.length>1&&n.sort(w||sxe),r.length>1&&r.sort(w||sxe)}function y(){for(let b=e,w=s.length;b<w;b++){const A=s[b];if(A.id===null)break;A.id=null,A.object=null,A.geometry=null,A.material=null,A.group=null}}return{opaque:t,transmissive:n,transparent:r,init:i,push:c,unshift:h,finish:y,sort:m}}function eXe(){let s=new WeakMap;function e(n,r){const i=s.get(n);let o;return i===void 0?(o=new oxe,s.set(n,[o])):r>=i.length?(o=new oxe,i.push(o)):o=i[r],o}function t(){s=new WeakMap}return{get:e,dispose:t}}function tXe(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new be,color:new Tn};break;case"SpotLight":t={position:new be,direction:new be,color:new Tn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new be,color:new Tn,distance:0,decay:0};break;case"HemisphereLight":t={direction:new be,skyColor:new Tn,groundColor:new Tn};break;case"RectAreaLight":t={color:new Tn,position:new be,halfWidth:new be,halfHeight:new be};break}return s[e.id]=t,t}}}function nXe(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ln};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ln};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ln,shadowCameraNear:1,shadowCameraFar:1e3};break}return s[e.id]=t,t}}}let rXe=0;function iXe(s,e){return(e.castShadow?2:0)-(s.castShadow?2:0)+(e.map?1:0)-(s.map?1:0)}function sXe(s){const e=new tXe,t=nXe(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let h=0;h<9;h++)n.probe.push(new be);const r=new be,i=new Pn,o=new Pn;function l(h){let m=0,y=0,b=0;for(let re=0;re<9;re++)n.probe[re].set(0,0,0);let w=0,A=0,I=0,D=0,P=0,U=0,j=0,C=0,Z=0,ie=0,se=0;h.sort(iXe);for(let re=0,ye=h.length;re<ye;re++){const H=h[re],Me=H.color,Oe=H.intensity,Ue=H.distance;let Ie=null;if(H.shadow&&H.shadow.map&&(H.shadow.map.texture.format===Su?Ie=H.shadow.map.texture:Ie=H.shadow.map.depthTexture||H.shadow.map.texture),H.isAmbientLight)m+=Me.r*Oe,y+=Me.g*Oe,b+=Me.b*Oe;else if(H.isLightProbe){for(let ce=0;ce<9;ce++)n.probe[ce].addScaledVector(H.sh.coefficients[ce],Oe);se++}else if(H.isDirectionalLight){const ce=e.get(H);if(ce.color.copy(H.color).multiplyScalar(H.intensity),H.castShadow){const Ve=H.shadow,Pe=t.get(H);Pe.shadowIntensity=Ve.intensity,Pe.shadowBias=Ve.bias,Pe.shadowNormalBias=Ve.normalBias,Pe.shadowRadius=Ve.radius,Pe.shadowMapSize=Ve.mapSize,n.directionalShadow[w]=Pe,n.directionalShadowMap[w]=Ie,n.directionalShadowMatrix[w]=H.shadow.matrix,U++}n.directional[w]=ce,w++}else if(H.isSpotLight){const ce=e.get(H);ce.position.setFromMatrixPosition(H.matrixWorld),ce.color.copy(Me).multiplyScalar(Oe),ce.distance=Ue,ce.coneCos=Math.cos(H.angle),ce.penumbraCos=Math.cos(H.angle*(1-H.penumbra)),ce.decay=H.decay,n.spot[I]=ce;const Ve=H.shadow;if(H.map&&(n.spotLightMap[Z]=H.map,Z++,Ve.updateMatrices(H),H.castShadow&&ie++),n.spotLightMatrix[I]=Ve.matrix,H.castShadow){const Pe=t.get(H);Pe.shadowIntensity=Ve.intensity,Pe.shadowBias=Ve.bias,Pe.shadowNormalBias=Ve.normalBias,Pe.shadowRadius=Ve.radius,Pe.shadowMapSize=Ve.mapSize,n.spotShadow[I]=Pe,n.spotShadowMap[I]=Ie,C++}I++}else if(H.isRectAreaLight){const ce=e.get(H);ce.color.copy(Me).multiplyScalar(Oe),ce.halfWidth.set(H.width*.5,0,0),ce.halfHeight.set(0,H.height*.5,0),n.rectArea[D]=ce,D++}else if(H.isPointLight){const ce=e.get(H);if(ce.color.copy(H.color).multiplyScalar(H.intensity),ce.distance=H.distance,ce.decay=H.decay,H.castShadow){const Ve=H.shadow,Pe=t.get(H);Pe.shadowIntensity=Ve.intensity,Pe.shadowBias=Ve.bias,Pe.shadowNormalBias=Ve.normalBias,Pe.shadowRadius=Ve.radius,Pe.shadowMapSize=Ve.mapSize,Pe.shadowCameraNear=Ve.camera.near,Pe.shadowCameraFar=Ve.camera.far,n.pointShadow[A]=Pe,n.pointShadowMap[A]=Ie,n.pointShadowMatrix[A]=H.shadow.matrix,j++}n.point[A]=ce,A++}else if(H.isHemisphereLight){const ce=e.get(H);ce.skyColor.copy(H.color).multiplyScalar(Oe),ce.groundColor.copy(H.groundColor).multiplyScalar(Oe),n.hemi[P]=ce,P++}}D>0&&(s.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Fn.LTC_FLOAT_1,n.rectAreaLTC2=Fn.LTC_FLOAT_2):(n.rectAreaLTC1=Fn.LTC_HALF_1,n.rectAreaLTC2=Fn.LTC_HALF_2)),n.ambient[0]=m,n.ambient[1]=y,n.ambient[2]=b;const z=n.hash;(z.directionalLength!==w||z.pointLength!==A||z.spotLength!==I||z.rectAreaLength!==D||z.hemiLength!==P||z.numDirectionalShadows!==U||z.numPointShadows!==j||z.numSpotShadows!==C||z.numSpotMaps!==Z||z.numLightProbes!==se)&&(n.directional.length=w,n.spot.length=I,n.rectArea.length=D,n.point.length=A,n.hemi.length=P,n.directionalShadow.length=U,n.directionalShadowMap.length=U,n.pointShadow.length=j,n.pointShadowMap.length=j,n.spotShadow.length=C,n.spotShadowMap.length=C,n.directionalShadowMatrix.length=U,n.pointShadowMatrix.length=j,n.spotLightMatrix.length=C+Z-ie,n.spotLightMap.length=Z,n.numSpotLightShadowsWithMaps=ie,n.numLightProbes=se,z.directionalLength=w,z.pointLength=A,z.spotLength=I,z.rectAreaLength=D,z.hemiLength=P,z.numDirectionalShadows=U,z.numPointShadows=j,z.numSpotShadows=C,z.numSpotMaps=Z,z.numLightProbes=se,n.version=rXe++)}function c(h,m){let y=0,b=0,w=0,A=0,I=0;const D=m.matrixWorldInverse;for(let P=0,U=h.length;P<U;P++){const j=h[P];if(j.isDirectionalLight){const C=n.directional[y];C.direction.setFromMatrixPosition(j.matrixWorld),r.setFromMatrixPosition(j.target.matrixWorld),C.direction.sub(r),C.direction.transformDirection(D),y++}else if(j.isSpotLight){const C=n.spot[w];C.position.setFromMatrixPosition(j.matrixWorld),C.position.applyMatrix4(D),C.direction.setFromMatrixPosition(j.matrixWorld),r.setFromMatrixPosition(j.target.matrixWorld),C.direction.sub(r),C.direction.transformDirection(D),w++}else if(j.isRectAreaLight){const C=n.rectArea[A];C.position.setFromMatrixPosition(j.matrixWorld),C.position.applyMatrix4(D),o.identity(),i.copy(j.matrixWorld),i.premultiply(D),o.extractRotation(i),C.halfWidth.set(j.width*.5,0,0),C.halfHeight.set(0,j.height*.5,0),C.halfWidth.applyMatrix4(o),C.halfHeight.applyMatrix4(o),A++}else if(j.isPointLight){const C=n.point[b];C.position.setFromMatrixPosition(j.matrixWorld),C.position.applyMatrix4(D),b++}else if(j.isHemisphereLight){const C=n.hemi[I];C.direction.setFromMatrixPosition(j.matrixWorld),C.direction.transformDirection(D),I++}}}return{setup:l,setupView:c,state:n}}function axe(s){const e=new sXe(s),t=[],n=[];function r(m){h.camera=m,t.length=0,n.length=0}function i(m){t.push(m)}function o(m){n.push(m)}function l(){e.setup(t)}function c(m){e.setupView(t,m)}const h={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:h,setupLights:l,setupLightsView:c,pushLight:i,pushShadow:o}}function oXe(s){let e=new WeakMap;function t(r,i=0){const o=e.get(r);let l;return o===void 0?(l=new axe(s),e.set(r,[l])):i>=o.length?(l=new axe(s),o.push(l)):l=o[i],l}function n(){e=new WeakMap}return{get:t,dispose:n}}const aXe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,lXe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ).rg;
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ).r;
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( max( 0.0, squared_mean - mean * mean ) );
	gl_FragColor = vec4( mean, std_dev, 0.0, 1.0 );
}`,cXe=[new be(1,0,0),new be(-1,0,0),new be(0,1,0),new be(0,-1,0),new be(0,0,1),new be(0,0,-1)],uXe=[new be(0,-1,0),new be(0,-1,0),new be(0,0,1),new be(0,0,-1),new be(0,-1,0),new be(0,-1,0)],lxe=new Pn,$M=new be,Rq=new be;function dXe(s,e,t){let n=new YA;const r=new Ln,i=new Ln,o=new zr,l=new oSe,c=new VGe,h={},m=t.maxTextureSize,y={[Mc]:bs,[bs]:Mc,[oa]:oa},b=new bh({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ln},radius:{value:4}},vertexShader:aXe,fragmentShader:lXe}),w=b.clone();w.defines.HORIZONTAL_PASS=1;const A=new Ki;A.setAttribute("position",new ja(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const I=new gn(A,b),D=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=mS;let P=this.type;this.render=function(ie,se,z){if(D.enabled===!1||D.autoUpdate===!1&&D.needsUpdate===!1||ie.length===0)return;this.type===k_e&&(qt("WebGLShadowMap: PCFSoftShadowMap has been deprecated. Using PCFShadowMap instead."),this.type=mS);const re=s.getRenderTarget(),ye=s.getActiveCubeFace(),H=s.getActiveMipmapLevel(),Me=s.state;Me.setBlending(El),Me.buffers.depth.getReversed()===!0?Me.buffers.color.setClear(0,0,0,0):Me.buffers.color.setClear(1,1,1,1),Me.buffers.depth.setTest(!0),Me.setScissorTest(!1);const Oe=P!==this.type;Oe&&se.traverse(function(Ue){Ue.material&&(Array.isArray(Ue.material)?Ue.material.forEach(Ie=>Ie.needsUpdate=!0):Ue.material.needsUpdate=!0)});for(let Ue=0,Ie=ie.length;Ue<Ie;Ue++){const ce=ie[Ue],Ve=ce.shadow;if(Ve===void 0){qt("WebGLShadowMap:",ce,"has no shadow.");continue}if(Ve.autoUpdate===!1&&Ve.needsUpdate===!1)continue;r.copy(Ve.mapSize);const Pe=Ve.getFrameExtents();r.multiply(Pe),i.copy(Ve.mapSize),(r.x>m||r.y>m)&&(r.x>m&&(i.x=Math.floor(m/Pe.x),r.x=i.x*Pe.x,Ve.mapSize.x=i.x),r.y>m&&(i.y=Math.floor(m/Pe.y),r.y=i.y*Pe.y,Ve.mapSize.y=i.y));const We=s.state.buffers.depth.getReversed();if(Ve.camera._reversedDepth=We,Ve.map===null||Oe===!0){if(Ve.map!==null&&(Ve.map.depthTexture!==null&&(Ve.map.depthTexture.dispose(),Ve.map.depthTexture=null),Ve.map.dispose()),this.type===mg){if(ce.isPointLight){qt("WebGLShadowMap: VSM shadow maps are not supported for PointLights. Use PCF or BasicShadowMap instead.");continue}Ve.map=new hm(r.x,r.y,{format:Su,type:ro,minFilter:ds,magFilter:ds,generateMipmaps:!1}),Ve.map.texture.name=ce.name+".shadowMap",Ve.map.depthTexture=new Cc(r.x,r.y,vo),Ve.map.depthTexture.name=ce.name+".shadowMapDepth",Ve.map.depthTexture.format=B0,Ve.map.depthTexture.compareFunction=null,Ve.map.depthTexture.minFilter=Yi,Ve.map.depthTexture.magFilter=Yi}else ce.isPointLight?(Ve.map=new wSe(r.x),Ve.map.depthTexture=new K_e(r.x,Ds)):(Ve.map=new hm(r.x,r.y),Ve.map.depthTexture=new Cc(r.x,r.y,Ds)),Ve.map.depthTexture.name=ce.name+".shadowMap",Ve.map.depthTexture.format=B0,this.type===mS?(Ve.map.depthTexture.compareFunction=We?gx:mx,Ve.map.depthTexture.minFilter=ds,Ve.map.depthTexture.magFilter=ds):(Ve.map.depthTexture.compareFunction=null,Ve.map.depthTexture.minFilter=Yi,Ve.map.depthTexture.magFilter=Yi);Ve.camera.updateProjectionMatrix()}const pt=Ve.map.isWebGLCubeRenderTarget?6:1;for(let Ne=0;Ne<pt;Ne++){if(Ve.map.isWebGLCubeRenderTarget)s.setRenderTarget(Ve.map,Ne),s.clear();else{Ne===0&&(s.setRenderTarget(Ve.map),s.clear());const st=Ve.getViewport(Ne);o.set(i.x*st.x,i.y*st.y,i.x*st.z,i.y*st.w),Me.viewport(o)}if(ce.isPointLight){const st=Ve.camera,Pt=Ve.matrix,yn=ce.distance||st.far;yn!==st.far&&(st.far=yn,st.updateProjectionMatrix()),$M.setFromMatrixPosition(ce.matrixWorld),st.position.copy($M),Rq.copy(st.position),Rq.add(cXe[Ne]),st.up.copy(uXe[Ne]),st.lookAt(Rq),st.updateMatrixWorld(),Pt.makeTranslation(-$M.x,-$M.y,-$M.z),lxe.multiplyMatrices(st.projectionMatrix,st.matrixWorldInverse),Ve._frustum.setFromProjectionMatrix(lxe,st.coordinateSystem,st.reversedDepth)}else Ve.updateMatrices(ce);n=Ve.getFrustum(),C(se,z,Ve.camera,ce,this.type)}Ve.isPointLightShadow!==!0&&this.type===mg&&U(Ve,z),Ve.needsUpdate=!1}P=this.type,D.needsUpdate=!1,s.setRenderTarget(re,ye,H)};function U(ie,se){const z=e.update(I);b.defines.VSM_SAMPLES!==ie.blurSamples&&(b.defines.VSM_SAMPLES=ie.blurSamples,w.defines.VSM_SAMPLES=ie.blurSamples,b.needsUpdate=!0,w.needsUpdate=!0),ie.mapPass===null&&(ie.mapPass=new hm(r.x,r.y,{format:Su,type:ro})),b.uniforms.shadow_pass.value=ie.map.depthTexture,b.uniforms.resolution.value=ie.mapSize,b.uniforms.radius.value=ie.radius,s.setRenderTarget(ie.mapPass),s.clear(),s.renderBufferDirect(se,null,z,b,I,null),w.uniforms.shadow_pass.value=ie.mapPass.texture,w.uniforms.resolution.value=ie.mapSize,w.uniforms.radius.value=ie.radius,s.setRenderTarget(ie.map),s.clear(),s.renderBufferDirect(se,null,z,w,I,null)}function j(ie,se,z,re){let ye=null;const H=z.isPointLight===!0?ie.customDistanceMaterial:ie.customDepthMaterial;if(H!==void 0)ye=H;else if(ye=z.isPointLight===!0?c:l,s.localClippingEnabled&&se.clipShadows===!0&&Array.isArray(se.clippingPlanes)&&se.clippingPlanes.length!==0||se.displacementMap&&se.displacementScale!==0||se.alphaMap&&se.alphaTest>0||se.map&&se.alphaTest>0||se.alphaToCoverage===!0){const Me=ye.uuid,Oe=se.uuid;let Ue=h[Me];Ue===void 0&&(Ue={},h[Me]=Ue);let Ie=Ue[Oe];Ie===void 0&&(Ie=ye.clone(),Ue[Oe]=Ie,se.addEventListener("dispose",Z)),ye=Ie}if(ye.visible=se.visible,ye.wireframe=se.wireframe,re===mg?ye.side=se.shadowSide!==null?se.shadowSide:se.side:ye.side=se.shadowSide!==null?se.shadowSide:y[se.side],ye.alphaMap=se.alphaMap,ye.alphaTest=se.alphaToCoverage===!0?.5:se.alphaTest,ye.map=se.map,ye.clipShadows=se.clipShadows,ye.clippingPlanes=se.clippingPlanes,ye.clipIntersection=se.clipIntersection,ye.displacementMap=se.displacementMap,ye.displacementScale=se.displacementScale,ye.displacementBias=se.displacementBias,ye.wireframeLinewidth=se.wireframeLinewidth,ye.linewidth=se.linewidth,z.isPointLight===!0&&ye.isMeshDistanceMaterial===!0){const Me=s.properties.get(ye);Me.light=z}return ye}function C(ie,se,z,re,ye){if(ie.visible===!1)return;if(ie.layers.test(se.layers)&&(ie.isMesh||ie.isLine||ie.isPoints)&&(ie.castShadow||ie.receiveShadow&&ye===mg)&&(!ie.frustumCulled||n.intersectsObject(ie))){ie.modelViewMatrix.multiplyMatrices(z.matrixWorldInverse,ie.matrixWorld);const Oe=e.update(ie),Ue=ie.material;if(Array.isArray(Ue)){const Ie=Oe.groups;for(let ce=0,Ve=Ie.length;ce<Ve;ce++){const Pe=Ie[ce],We=Ue[Pe.materialIndex];if(We&&We.visible){const pt=j(ie,We,re,ye);ie.onBeforeShadow(s,ie,se,z,Oe,pt,Pe),s.renderBufferDirect(z,null,Oe,pt,ie,Pe),ie.onAfterShadow(s,ie,se,z,Oe,pt,Pe)}}}else if(Ue.visible){const Ie=j(ie,Ue,re,ye);ie.onBeforeShadow(s,ie,se,z,Oe,Ie,null),s.renderBufferDirect(z,null,Oe,Ie,ie,null),ie.onAfterShadow(s,ie,se,z,Oe,Ie,null)}}const Me=ie.children;for(let Oe=0,Ue=Me.length;Oe<Ue;Oe++)C(Me[Oe],se,z,re,ye)}function Z(ie){ie.target.removeEventListener("dispose",Z);for(const z in h){const re=h[z],ye=ie.target.uuid;ye in re&&(re[ye].dispose(),delete re[ye])}}}function hXe(s,e){function t(){let et=!1;const _n=new zr;let pn=null;const Nn=new zr(0,0,0,0);return{setMask:function(cn){pn!==cn&&!et&&(s.colorMask(cn,cn,cn,cn),pn=cn)},setLocked:function(cn){et=cn},setClear:function(cn,jt,Wn,Br,Hi){Hi===!0&&(cn*=Br,jt*=Br,Wn*=Br),_n.set(cn,jt,Wn,Br),Nn.equals(_n)===!1&&(s.clearColor(cn,jt,Wn,Br),Nn.copy(_n))},reset:function(){et=!1,pn=null,Nn.set(-1,0,0,0)}}}function n(){let et=!1,_n=!1,pn=null,Nn=null,cn=null;return{setReversed:function(jt){if(_n!==jt){const Wn=e.get("EXT_clip_control");jt?Wn.clipControlEXT(Wn.LOWER_LEFT_EXT,Wn.ZERO_TO_ONE_EXT):Wn.clipControlEXT(Wn.LOWER_LEFT_EXT,Wn.NEGATIVE_ONE_TO_ONE_EXT),_n=jt;const Br=cn;cn=null,this.setClear(Br)}},getReversed:function(){return _n},setTest:function(jt){jt?Ut(s.DEPTH_TEST):Wt(s.DEPTH_TEST)},setMask:function(jt){pn!==jt&&!et&&(s.depthMask(jt),pn=jt)},setFunc:function(jt){if(_n&&(jt=WK[jt]),Nn!==jt){switch(jt){case aA:s.depthFunc(s.NEVER);break;case lA:s.depthFunc(s.ALWAYS);break;case cA:s.depthFunc(s.LESS);break;case f5:s.depthFunc(s.LEQUAL);break;case uA:s.depthFunc(s.EQUAL);break;case dA:s.depthFunc(s.GEQUAL);break;case hA:s.depthFunc(s.GREATER);break;case pA:s.depthFunc(s.NOTEQUAL);break;default:s.depthFunc(s.LEQUAL)}Nn=jt}},setLocked:function(jt){et=jt},setClear:function(jt){cn!==jt&&(cn=jt,_n&&(jt=1-jt),s.clearDepth(jt))},reset:function(){et=!1,pn=null,Nn=null,cn=null,_n=!1}}}function r(){let et=!1,_n=null,pn=null,Nn=null,cn=null,jt=null,Wn=null,Br=null,Hi=null;return{setTest:function(Pr){et||(Pr?Ut(s.STENCIL_TEST):Wt(s.STENCIL_TEST))},setMask:function(Pr){_n!==Pr&&!et&&(s.stencilMask(Pr),_n=Pr)},setFunc:function(Pr,Ls,la){(pn!==Pr||Nn!==Ls||cn!==la)&&(s.stencilFunc(Pr,Ls,la),pn=Pr,Nn=Ls,cn=la)},setOp:function(Pr,Ls,la){(jt!==Pr||Wn!==Ls||Br!==la)&&(s.stencilOp(Pr,Ls,la),jt=Pr,Wn=Ls,Br=la)},setLocked:function(Pr){et=Pr},setClear:function(Pr){Hi!==Pr&&(s.clearStencil(Pr),Hi=Pr)},reset:function(){et=!1,_n=null,pn=null,Nn=null,cn=null,jt=null,Wn=null,Br=null,Hi=null}}}const i=new t,o=new n,l=new r,c=new WeakMap,h=new WeakMap;let m={},y={},b=new WeakMap,w=[],A=null,I=!1,D=null,P=null,U=null,j=null,C=null,Z=null,ie=null,se=new Tn(0,0,0),z=0,re=!1,ye=null,H=null,Me=null,Oe=null,Ue=null;const Ie=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ce=!1,Ve=0;const Pe=s.getParameter(s.VERSION);Pe.indexOf("WebGL")!==-1?(Ve=parseFloat(/^WebGL (\d)/.exec(Pe)[1]),ce=Ve>=1):Pe.indexOf("OpenGL ES")!==-1&&(Ve=parseFloat(/^OpenGL ES (\d)/.exec(Pe)[1]),ce=Ve>=2);let We=null,pt={};const Ne=s.getParameter(s.SCISSOR_BOX),st=s.getParameter(s.VIEWPORT),Pt=new zr().fromArray(Ne),yn=new zr().fromArray(st);function bn(et,_n,pn,Nn){const cn=new Uint8Array(4),jt=s.createTexture();s.bindTexture(et,jt),s.texParameteri(et,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(et,s.TEXTURE_MAG_FILTER,s.NEAREST);for(let Wn=0;Wn<pn;Wn++)et===s.TEXTURE_3D||et===s.TEXTURE_2D_ARRAY?s.texImage3D(_n,0,s.RGBA,1,1,Nn,0,s.RGBA,s.UNSIGNED_BYTE,cn):s.texImage2D(_n+Wn,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,cn);return jt}const St={};St[s.TEXTURE_2D]=bn(s.TEXTURE_2D,s.TEXTURE_2D,1),St[s.TEXTURE_CUBE_MAP]=bn(s.TEXTURE_CUBE_MAP,s.TEXTURE_CUBE_MAP_POSITIVE_X,6),St[s.TEXTURE_2D_ARRAY]=bn(s.TEXTURE_2D_ARRAY,s.TEXTURE_2D_ARRAY,1,1),St[s.TEXTURE_3D]=bn(s.TEXTURE_3D,s.TEXTURE_3D,1,1),i.setClear(0,0,0,1),o.setClear(1),l.setClear(0),Ut(s.DEPTH_TEST),o.setFunc(f5),Yr(!1),mi(wY),Ut(s.CULL_FACE),Vr(El);function Ut(et){m[et]!==!0&&(s.enable(et),m[et]=!0)}function Wt(et){m[et]!==!1&&(s.disable(et),m[et]=!1)}function kn(et,_n){return y[et]!==_n?(s.bindFramebuffer(et,_n),y[et]=_n,et===s.DRAW_FRAMEBUFFER&&(y[s.FRAMEBUFFER]=_n),et===s.FRAMEBUFFER&&(y[s.DRAW_FRAMEBUFFER]=_n),!0):!1}function Dn(et,_n){let pn=w,Nn=!1;if(et){pn=b.get(_n),pn===void 0&&(pn=[],b.set(_n,pn));const cn=et.textures;if(pn.length!==cn.length||pn[0]!==s.COLOR_ATTACHMENT0){for(let jt=0,Wn=cn.length;jt<Wn;jt++)pn[jt]=s.COLOR_ATTACHMENT0+jt;pn.length=cn.length,Nn=!0}}else pn[0]!==s.BACK&&(pn[0]=s.BACK,Nn=!0);Nn&&s.drawBuffers(pn)}function or(et){return A!==et?(s.useProgram(et),A=et,!0):!1}const ns={[i0]:s.FUNC_ADD,[HF]:s.FUNC_SUBTRACT,[$F]:s.FUNC_REVERSE_SUBTRACT};ns[RK]=s.MIN,ns[IK]=s.MAX;const Xr={[im]:s.ZERO,[UA]:s.ONE,[zA]:s.SRC_COLOR,[h5]:s.SRC_ALPHA,[WF]:s.SRC_ALPHA_SATURATE,[HA]:s.DST_COLOR,[GA]:s.DST_ALPHA,[VA]:s.ONE_MINUS_SRC_COLOR,[p5]:s.ONE_MINUS_SRC_ALPHA,[$A]:s.ONE_MINUS_DST_COLOR,[jA]:s.ONE_MINUS_DST_ALPHA,[kK]:s.CONSTANT_COLOR,[DK]:s.ONE_MINUS_CONSTANT_COLOR,[OK]:s.CONSTANT_ALPHA,[LK]:s.ONE_MINUS_CONSTANT_ALPHA};function Vr(et,_n,pn,Nn,cn,jt,Wn,Br,Hi,Pr){if(et===El){I===!0&&(Wt(s.BLEND),I=!1);return}if(I===!1&&(Ut(s.BLEND),I=!0),et!==Jy){if(et!==D||Pr!==re){if((P!==i0||C!==i0)&&(s.blendEquation(s.FUNC_ADD),P=i0,C=i0),Pr)switch(et){case L0:s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case U3:s.blendFunc(s.ONE,s.ONE);break;case z3:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case V3:s.blendFuncSeparate(s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ZERO,s.ONE);break;default:Ht("WebGLState: Invalid blending: ",et);break}else switch(et){case L0:s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case U3:s.blendFuncSeparate(s.SRC_ALPHA,s.ONE,s.ONE,s.ONE);break;case z3:Ht("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case V3:Ht("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Ht("WebGLState: Invalid blending: ",et);break}U=null,j=null,Z=null,ie=null,se.set(0,0,0),z=0,D=et,re=Pr}return}cn=cn||_n,jt=jt||pn,Wn=Wn||Nn,(_n!==P||cn!==C)&&(s.blendEquationSeparate(ns[_n],ns[cn]),P=_n,C=cn),(pn!==U||Nn!==j||jt!==Z||Wn!==ie)&&(s.blendFuncSeparate(Xr[pn],Xr[Nn],Xr[jt],Xr[Wn]),U=pn,j=Nn,Z=jt,ie=Wn),(Br.equals(se)===!1||Hi!==z)&&(s.blendColor(Br.r,Br.g,Br.b,Hi),se.copy(Br),z=Hi),D=et,re=!1}function Kr(et,_n){et.side===oa?Wt(s.CULL_FACE):Ut(s.CULL_FACE);let pn=et.side===bs;_n&&(pn=!pn),Yr(pn),et.blending===L0&&et.transparent===!1?Vr(El):Vr(et.blending,et.blendEquation,et.blendSrc,et.blendDst,et.blendEquationAlpha,et.blendSrcAlpha,et.blendDstAlpha,et.blendColor,et.blendAlpha,et.premultipliedAlpha),o.setFunc(et.depthFunc),o.setTest(et.depthTest),o.setMask(et.depthWrite),i.setMask(et.colorWrite);const Nn=et.stencilWrite;l.setTest(Nn),Nn&&(l.setMask(et.stencilWriteMask),l.setFunc(et.stencilFunc,et.stencilRef,et.stencilFuncMask),l.setOp(et.stencilFail,et.stencilZFail,et.stencilZPass)),_s(et.polygonOffset,et.polygonOffsetFactor,et.polygonOffsetUnits),et.alphaToCoverage===!0?Ut(s.SAMPLE_ALPHA_TO_COVERAGE):Wt(s.SAMPLE_ALPHA_TO_COVERAGE)}function Yr(et){ye!==et&&(et?s.frontFace(s.CW):s.frontFace(s.CCW),ye=et)}function mi(et){et!==R_e?(Ut(s.CULL_FACE),et!==H&&(et===wY?s.cullFace(s.BACK):et===I_e?s.cullFace(s.FRONT):s.cullFace(s.FRONT_AND_BACK))):Wt(s.CULL_FACE),H=et}function Ke(et){et!==Me&&(ce&&s.lineWidth(et),Me=et)}function _s(et,_n,pn){et?(Ut(s.POLYGON_OFFSET_FILL),(Oe!==_n||Ue!==pn)&&(Oe=_n,Ue=pn,o.getReversed()&&(_n=-_n),s.polygonOffset(_n,pn))):Wt(s.POLYGON_OFFSET_FILL)}function ui(et){et?Ut(s.SCISSOR_TEST):Wt(s.SCISSOR_TEST)}function Ti(et){et===void 0&&(et=s.TEXTURE0+Ie-1),We!==et&&(s.activeTexture(et),We=et)}function Vn(et,_n,pn){pn===void 0&&(We===null?pn=s.TEXTURE0+Ie-1:pn=We);let Nn=pt[pn];Nn===void 0&&(Nn={type:void 0,texture:void 0},pt[pn]=Nn),(Nn.type!==et||Nn.texture!==_n)&&(We!==pn&&(s.activeTexture(pn),We=pn),s.bindTexture(et,_n||St[et]),Nn.type=et,Nn.texture=_n)}function ke(){const et=pt[We];et!==void 0&&et.type!==void 0&&(s.bindTexture(et.type,null),et.type=void 0,et.texture=void 0)}function de(){try{s.compressedTexImage2D(...arguments)}catch(et){Ht("WebGLState:",et)}}function ht(){try{s.compressedTexImage3D(...arguments)}catch(et){Ht("WebGLState:",et)}}function Xt(){try{s.texSubImage2D(...arguments)}catch(et){Ht("WebGLState:",et)}}function Kt(){try{s.texSubImage3D(...arguments)}catch(et){Ht("WebGLState:",et)}}function Vt(){try{s.compressedTexSubImage2D(...arguments)}catch(et){Ht("WebGLState:",et)}}function Qn(){try{s.compressedTexSubImage3D(...arguments)}catch(et){Ht("WebGLState:",et)}}function wn(){try{s.texStorage2D(...arguments)}catch(et){Ht("WebGLState:",et)}}function ar(){try{s.texStorage3D(...arguments)}catch(et){Ht("WebGLState:",et)}}function Ir(){try{s.texImage2D(...arguments)}catch(et){Ht("WebGLState:",et)}}function en(){try{s.texImage3D(...arguments)}catch(et){Ht("WebGLState:",et)}}function vn(et){Pt.equals(et)===!1&&(s.scissor(et.x,et.y,et.z,et.w),Pt.copy(et))}function Gn(et){yn.equals(et)===!1&&(s.viewport(et.x,et.y,et.z,et.w),yn.copy(et))}function $n(et,_n){let pn=h.get(_n);pn===void 0&&(pn=new WeakMap,h.set(_n,pn));let Nn=pn.get(et);Nn===void 0&&(Nn=s.getUniformBlockIndex(_n,et.name),pn.set(et,Nn))}function Bn(et,_n){const Nn=h.get(_n).get(et);c.get(_n)!==Nn&&(s.uniformBlockBinding(_n,Nn,et.__bindingPointIndex),c.set(_n,Nn))}function Cr(){s.disable(s.BLEND),s.disable(s.CULL_FACE),s.disable(s.DEPTH_TEST),s.disable(s.POLYGON_OFFSET_FILL),s.disable(s.SCISSOR_TEST),s.disable(s.STENCIL_TEST),s.disable(s.SAMPLE_ALPHA_TO_COVERAGE),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ONE,s.ZERO),s.blendFuncSeparate(s.ONE,s.ZERO,s.ONE,s.ZERO),s.blendColor(0,0,0,0),s.colorMask(!0,!0,!0,!0),s.clearColor(0,0,0,0),s.depthMask(!0),s.depthFunc(s.LESS),o.setReversed(!1),s.clearDepth(1),s.stencilMask(4294967295),s.stencilFunc(s.ALWAYS,0,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),s.clearStencil(0),s.cullFace(s.BACK),s.frontFace(s.CCW),s.polygonOffset(0,0),s.activeTexture(s.TEXTURE0),s.bindFramebuffer(s.FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.useProgram(null),s.lineWidth(1),s.scissor(0,0,s.canvas.width,s.canvas.height),s.viewport(0,0,s.canvas.width,s.canvas.height),m={},We=null,pt={},y={},b=new WeakMap,w=[],A=null,I=!1,D=null,P=null,U=null,j=null,C=null,Z=null,ie=null,se=new Tn(0,0,0),z=0,re=!1,ye=null,H=null,Me=null,Oe=null,Ue=null,Pt.set(0,0,s.canvas.width,s.canvas.height),yn.set(0,0,s.canvas.width,s.canvas.height),i.reset(),o.reset(),l.reset()}return{buffers:{color:i,depth:o,stencil:l},enable:Ut,disable:Wt,bindFramebuffer:kn,drawBuffers:Dn,useProgram:or,setBlending:Vr,setMaterial:Kr,setFlipSided:Yr,setCullFace:mi,setLineWidth:Ke,setPolygonOffset:_s,setScissorTest:ui,activeTexture:Ti,bindTexture:Vn,unbindTexture:ke,compressedTexImage2D:de,compressedTexImage3D:ht,texImage2D:Ir,texImage3D:en,updateUBOMapping:$n,uniformBlockBinding:Bn,texStorage2D:wn,texStorage3D:ar,texSubImage2D:Xt,texSubImage3D:Kt,compressedTexSubImage2D:Vt,compressedTexSubImage3D:Qn,scissor:vn,viewport:Gn,reset:Cr}}function pXe(s,e,t,n,r,i,o){const l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),h=new Ln,m=new WeakMap;let y;const b=new WeakMap;let w=!1;try{w=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function A(ke,de){return w?new OffscreenCanvas(ke,de):bA("canvas")}function I(ke,de,ht){let Xt=1;const Kt=Vn(ke);if((Kt.width>ht||Kt.height>ht)&&(Xt=ht/Math.max(Kt.width,Kt.height)),Xt<1)if(typeof HTMLImageElement<"u"&&ke instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ke instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ke instanceof ImageBitmap||typeof VideoFrame<"u"&&ke instanceof VideoFrame){const Vt=Math.floor(Xt*Kt.width),Qn=Math.floor(Xt*Kt.height);y===void 0&&(y=A(Vt,Qn));const wn=de?A(Vt,Qn):y;return wn.width=Vt,wn.height=Qn,wn.getContext("2d").drawImage(ke,0,0,Vt,Qn),qt("WebGLRenderer: Texture has been resized from ("+Kt.width+"x"+Kt.height+") to ("+Vt+"x"+Qn+")."),wn}else return"data"in ke&&qt("WebGLRenderer: Image in DataTexture is too big ("+Kt.width+"x"+Kt.height+")."),ke;return ke}function D(ke){return ke.generateMipmaps}function P(ke){s.generateMipmap(ke)}function U(ke){return ke.isWebGLCubeRenderTarget?s.TEXTURE_CUBE_MAP:ke.isWebGL3DRenderTarget?s.TEXTURE_3D:ke.isWebGLArrayRenderTarget||ke.isCompressedArrayTexture?s.TEXTURE_2D_ARRAY:s.TEXTURE_2D}function j(ke,de,ht,Xt,Kt=!1){if(ke!==null){if(s[ke]!==void 0)return s[ke];qt("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ke+"'")}let Vt=de;if(de===s.RED&&(ht===s.FLOAT&&(Vt=s.R32F),ht===s.HALF_FLOAT&&(Vt=s.R16F),ht===s.UNSIGNED_BYTE&&(Vt=s.R8)),de===s.RED_INTEGER&&(ht===s.UNSIGNED_BYTE&&(Vt=s.R8UI),ht===s.UNSIGNED_SHORT&&(Vt=s.R16UI),ht===s.UNSIGNED_INT&&(Vt=s.R32UI),ht===s.BYTE&&(Vt=s.R8I),ht===s.SHORT&&(Vt=s.R16I),ht===s.INT&&(Vt=s.R32I)),de===s.RG&&(ht===s.FLOAT&&(Vt=s.RG32F),ht===s.HALF_FLOAT&&(Vt=s.RG16F),ht===s.UNSIGNED_BYTE&&(Vt=s.RG8)),de===s.RG_INTEGER&&(ht===s.UNSIGNED_BYTE&&(Vt=s.RG8UI),ht===s.UNSIGNED_SHORT&&(Vt=s.RG16UI),ht===s.UNSIGNED_INT&&(Vt=s.RG32UI),ht===s.BYTE&&(Vt=s.RG8I),ht===s.SHORT&&(Vt=s.RG16I),ht===s.INT&&(Vt=s.RG32I)),de===s.RGB_INTEGER&&(ht===s.UNSIGNED_BYTE&&(Vt=s.RGB8UI),ht===s.UNSIGNED_SHORT&&(Vt=s.RGB16UI),ht===s.UNSIGNED_INT&&(Vt=s.RGB32UI),ht===s.BYTE&&(Vt=s.RGB8I),ht===s.SHORT&&(Vt=s.RGB16I),ht===s.INT&&(Vt=s.RGB32I)),de===s.RGBA_INTEGER&&(ht===s.UNSIGNED_BYTE&&(Vt=s.RGBA8UI),ht===s.UNSIGNED_SHORT&&(Vt=s.RGBA16UI),ht===s.UNSIGNED_INT&&(Vt=s.RGBA32UI),ht===s.BYTE&&(Vt=s.RGBA8I),ht===s.SHORT&&(Vt=s.RGBA16I),ht===s.INT&&(Vt=s.RGBA32I)),de===s.RGB&&(ht===s.UNSIGNED_INT_5_9_9_9_REV&&(Vt=s.RGB9_E5),ht===s.UNSIGNED_INT_10F_11F_11F_REV&&(Vt=s.R11F_G11F_B10F)),de===s.RGBA){const Qn=Kt?KS:Zn.getTransfer(Xt);ht===s.FLOAT&&(Vt=s.RGBA32F),ht===s.HALF_FLOAT&&(Vt=s.RGBA16F),ht===s.UNSIGNED_BYTE&&(Vt=Qn===Yn?s.SRGB8_ALPHA8:s.RGBA8),ht===s.UNSIGNED_SHORT_4_4_4_4&&(Vt=s.RGBA4),ht===s.UNSIGNED_SHORT_5_5_5_1&&(Vt=s.RGB5_A1)}return(Vt===s.R16F||Vt===s.R32F||Vt===s.RG16F||Vt===s.RG32F||Vt===s.RGBA16F||Vt===s.RGBA32F)&&e.get("EXT_color_buffer_float"),Vt}function C(ke,de){let ht;return ke?de===null||de===Ds||de===gh?ht=s.DEPTH24_STENCIL8:de===vo?ht=s.DEPTH32F_STENCIL8:de===um&&(ht=s.DEPTH24_STENCIL8,qt("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):de===null||de===Ds||de===gh?ht=s.DEPTH_COMPONENT24:de===vo?ht=s.DEPTH_COMPONENT32F:de===um&&(ht=s.DEPTH_COMPONENT16),ht}function Z(ke,de){return D(ke)===!0||ke.isFramebufferTexture&&ke.minFilter!==Yi&&ke.minFilter!==ds?Math.log2(Math.max(de.width,de.height))+1:ke.mipmaps!==void 0&&ke.mipmaps.length>0?ke.mipmaps.length:ke.isCompressedTexture&&Array.isArray(ke.image)?de.mipmaps.length:1}function ie(ke){const de=ke.target;de.removeEventListener("dispose",ie),z(de),de.isVideoTexture&&m.delete(de)}function se(ke){const de=ke.target;de.removeEventListener("dispose",se),ye(de)}function z(ke){const de=n.get(ke);if(de.__webglInit===void 0)return;const ht=ke.source,Xt=b.get(ht);if(Xt){const Kt=Xt[de.__cacheKey];Kt.usedTimes--,Kt.usedTimes===0&&re(ke),Object.keys(Xt).length===0&&b.delete(ht)}n.remove(ke)}function re(ke){const de=n.get(ke);s.deleteTexture(de.__webglTexture);const ht=ke.source,Xt=b.get(ht);delete Xt[de.__cacheKey],o.memory.textures--}function ye(ke){const de=n.get(ke);if(ke.depthTexture&&(ke.depthTexture.dispose(),n.remove(ke.depthTexture)),ke.isWebGLCubeRenderTarget)for(let Xt=0;Xt<6;Xt++){if(Array.isArray(de.__webglFramebuffer[Xt]))for(let Kt=0;Kt<de.__webglFramebuffer[Xt].length;Kt++)s.deleteFramebuffer(de.__webglFramebuffer[Xt][Kt]);else s.deleteFramebuffer(de.__webglFramebuffer[Xt]);de.__webglDepthbuffer&&s.deleteRenderbuffer(de.__webglDepthbuffer[Xt])}else{if(Array.isArray(de.__webglFramebuffer))for(let Xt=0;Xt<de.__webglFramebuffer.length;Xt++)s.deleteFramebuffer(de.__webglFramebuffer[Xt]);else s.deleteFramebuffer(de.__webglFramebuffer);if(de.__webglDepthbuffer&&s.deleteRenderbuffer(de.__webglDepthbuffer),de.__webglMultisampledFramebuffer&&s.deleteFramebuffer(de.__webglMultisampledFramebuffer),de.__webglColorRenderbuffer)for(let Xt=0;Xt<de.__webglColorRenderbuffer.length;Xt++)de.__webglColorRenderbuffer[Xt]&&s.deleteRenderbuffer(de.__webglColorRenderbuffer[Xt]);de.__webglDepthRenderbuffer&&s.deleteRenderbuffer(de.__webglDepthRenderbuffer)}const ht=ke.textures;for(let Xt=0,Kt=ht.length;Xt<Kt;Xt++){const Vt=n.get(ht[Xt]);Vt.__webglTexture&&(s.deleteTexture(Vt.__webglTexture),o.memory.textures--),n.remove(ht[Xt])}n.remove(ke)}let H=0;function Me(){H=0}function Oe(){const ke=H;return ke>=r.maxTextures&&qt("WebGLTextures: Trying to use "+ke+" texture units while this GPU supports only "+r.maxTextures),H+=1,ke}function Ue(ke){const de=[];return de.push(ke.wrapS),de.push(ke.wrapT),de.push(ke.wrapR||0),de.push(ke.magFilter),de.push(ke.minFilter),de.push(ke.anisotropy),de.push(ke.internalFormat),de.push(ke.format),de.push(ke.type),de.push(ke.generateMipmaps),de.push(ke.premultiplyAlpha),de.push(ke.flipY),de.push(ke.unpackAlignment),de.push(ke.colorSpace),de.join()}function Ie(ke,de){const ht=n.get(ke);if(ke.isVideoTexture&&ui(ke),ke.isRenderTargetTexture===!1&&ke.isExternalTexture!==!0&&ke.version>0&&ht.__version!==ke.version){const Xt=ke.image;if(Xt===null)qt("WebGLRenderer: Texture marked for update but no image data found.");else if(Xt.complete===!1)qt("WebGLRenderer: Texture marked for update but image is incomplete");else{St(ht,ke,de);return}}else ke.isExternalTexture&&(ht.__webglTexture=ke.sourceTexture?ke.sourceTexture:null);t.bindTexture(s.TEXTURE_2D,ht.__webglTexture,s.TEXTURE0+de)}function ce(ke,de){const ht=n.get(ke);if(ke.isRenderTargetTexture===!1&&ke.version>0&&ht.__version!==ke.version){St(ht,ke,de);return}else ke.isExternalTexture&&(ht.__webglTexture=ke.sourceTexture?ke.sourceTexture:null);t.bindTexture(s.TEXTURE_2D_ARRAY,ht.__webglTexture,s.TEXTURE0+de)}function Ve(ke,de){const ht=n.get(ke);if(ke.isRenderTargetTexture===!1&&ke.version>0&&ht.__version!==ke.version){St(ht,ke,de);return}t.bindTexture(s.TEXTURE_3D,ht.__webglTexture,s.TEXTURE0+de)}function Pe(ke,de){const ht=n.get(ke);if(ke.isCubeDepthTexture!==!0&&ke.version>0&&ht.__version!==ke.version){Ut(ht,ke,de);return}t.bindTexture(s.TEXTURE_CUBE_MAP,ht.__webglTexture,s.TEXTURE0+de)}const We={[vh]:s.REPEAT,[zo]:s.CLAMP_TO_EDGE,[ox]:s.MIRRORED_REPEAT},pt={[Yi]:s.NEAREST,[BK]:s.NEAREST_MIPMAP_NEAREST,[G3]:s.NEAREST_MIPMAP_LINEAR,[ds]:s.LINEAR,[yS]:s.LINEAR_MIPMAP_NEAREST,[fd]:s.LINEAR_MIPMAP_LINEAR},Ne={[VK]:s.NEVER,[$K]:s.ALWAYS,[rB]:s.LESS,[mx]:s.LEQUAL,[GK]:s.EQUAL,[gx]:s.GEQUAL,[jK]:s.GREATER,[HK]:s.NOTEQUAL};function st(ke,de){if(de.type===vo&&e.has("OES_texture_float_linear")===!1&&(de.magFilter===ds||de.magFilter===yS||de.magFilter===G3||de.magFilter===fd||de.minFilter===ds||de.minFilter===yS||de.minFilter===G3||de.minFilter===fd)&&qt("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),s.texParameteri(ke,s.TEXTURE_WRAP_S,We[de.wrapS]),s.texParameteri(ke,s.TEXTURE_WRAP_T,We[de.wrapT]),(ke===s.TEXTURE_3D||ke===s.TEXTURE_2D_ARRAY)&&s.texParameteri(ke,s.TEXTURE_WRAP_R,We[de.wrapR]),s.texParameteri(ke,s.TEXTURE_MAG_FILTER,pt[de.magFilter]),s.texParameteri(ke,s.TEXTURE_MIN_FILTER,pt[de.minFilter]),de.compareFunction&&(s.texParameteri(ke,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(ke,s.TEXTURE_COMPARE_FUNC,Ne[de.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(de.magFilter===Yi||de.minFilter!==G3&&de.minFilter!==fd||de.type===vo&&e.has("OES_texture_float_linear")===!1)return;if(de.anisotropy>1||n.get(de).__currentAnisotropy){const ht=e.get("EXT_texture_filter_anisotropic");s.texParameterf(ke,ht.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(de.anisotropy,r.getMaxAnisotropy())),n.get(de).__currentAnisotropy=de.anisotropy}}}function Pt(ke,de){let ht=!1;ke.__webglInit===void 0&&(ke.__webglInit=!0,de.addEventListener("dispose",ie));const Xt=de.source;let Kt=b.get(Xt);Kt===void 0&&(Kt={},b.set(Xt,Kt));const Vt=Ue(de);if(Vt!==ke.__cacheKey){Kt[Vt]===void 0&&(Kt[Vt]={texture:s.createTexture(),usedTimes:0},o.memory.textures++,ht=!0),Kt[Vt].usedTimes++;const Qn=Kt[ke.__cacheKey];Qn!==void 0&&(Kt[ke.__cacheKey].usedTimes--,Qn.usedTimes===0&&re(de)),ke.__cacheKey=Vt,ke.__webglTexture=Kt[Vt].texture}return ht}function yn(ke,de,ht){return Math.floor(Math.floor(ke/ht)/de)}function bn(ke,de,ht,Xt){const Vt=ke.updateRanges;if(Vt.length===0)t.texSubImage2D(s.TEXTURE_2D,0,0,0,de.width,de.height,ht,Xt,de.data);else{Vt.sort((en,vn)=>en.start-vn.start);let Qn=0;for(let en=1;en<Vt.length;en++){const vn=Vt[Qn],Gn=Vt[en],$n=vn.start+vn.count,Bn=yn(Gn.start,de.width,4),Cr=yn(vn.start,de.width,4);Gn.start<=$n+1&&Bn===Cr&&yn(Gn.start+Gn.count-1,de.width,4)===Bn?vn.count=Math.max(vn.count,Gn.start+Gn.count-vn.start):(++Qn,Vt[Qn]=Gn)}Vt.length=Qn+1;const wn=s.getParameter(s.UNPACK_ROW_LENGTH),ar=s.getParameter(s.UNPACK_SKIP_PIXELS),Ir=s.getParameter(s.UNPACK_SKIP_ROWS);s.pixelStorei(s.UNPACK_ROW_LENGTH,de.width);for(let en=0,vn=Vt.length;en<vn;en++){const Gn=Vt[en],$n=Math.floor(Gn.start/4),Bn=Math.ceil(Gn.count/4),Cr=$n%de.width,et=Math.floor($n/de.width),_n=Bn,pn=1;s.pixelStorei(s.UNPACK_SKIP_PIXELS,Cr),s.pixelStorei(s.UNPACK_SKIP_ROWS,et),t.texSubImage2D(s.TEXTURE_2D,0,Cr,et,_n,pn,ht,Xt,de.data)}ke.clearUpdateRanges(),s.pixelStorei(s.UNPACK_ROW_LENGTH,wn),s.pixelStorei(s.UNPACK_SKIP_PIXELS,ar),s.pixelStorei(s.UNPACK_SKIP_ROWS,Ir)}}function St(ke,de,ht){let Xt=s.TEXTURE_2D;(de.isDataArrayTexture||de.isCompressedArrayTexture)&&(Xt=s.TEXTURE_2D_ARRAY),de.isData3DTexture&&(Xt=s.TEXTURE_3D);const Kt=Pt(ke,de),Vt=de.source;t.bindTexture(Xt,ke.__webglTexture,s.TEXTURE0+ht);const Qn=n.get(Vt);if(Vt.version!==Qn.__version||Kt===!0){t.activeTexture(s.TEXTURE0+ht);const wn=Zn.getPrimaries(Zn.workingColorSpace),ar=de.colorSpace===gu?null:Zn.getPrimaries(de.colorSpace),Ir=de.colorSpace===gu||wn===ar?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,de.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,de.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,de.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ir);let en=I(de.image,!1,r.maxTextureSize);en=Ti(de,en);const vn=i.convert(de.format,de.colorSpace),Gn=i.convert(de.type);let $n=j(de.internalFormat,vn,Gn,de.colorSpace,de.isVideoTexture);st(Xt,de);let Bn;const Cr=de.mipmaps,et=de.isVideoTexture!==!0,_n=Qn.__version===void 0||Kt===!0,pn=Vt.dataReady,Nn=Z(de,en);if(de.isDepthTexture)$n=C(de.format===_u,de.type),_n&&(et?t.texStorage2D(s.TEXTURE_2D,1,$n,en.width,en.height):t.texImage2D(s.TEXTURE_2D,0,$n,en.width,en.height,0,vn,Gn,null));else if(de.isDataTexture)if(Cr.length>0){et&&_n&&t.texStorage2D(s.TEXTURE_2D,Nn,$n,Cr[0].width,Cr[0].height);for(let cn=0,jt=Cr.length;cn<jt;cn++)Bn=Cr[cn],et?pn&&t.texSubImage2D(s.TEXTURE_2D,cn,0,0,Bn.width,Bn.height,vn,Gn,Bn.data):t.texImage2D(s.TEXTURE_2D,cn,$n,Bn.width,Bn.height,0,vn,Gn,Bn.data);de.generateMipmaps=!1}else et?(_n&&t.texStorage2D(s.TEXTURE_2D,Nn,$n,en.width,en.height),pn&&bn(de,en,vn,Gn)):t.texImage2D(s.TEXTURE_2D,0,$n,en.width,en.height,0,vn,Gn,en.data);else if(de.isCompressedTexture)if(de.isCompressedArrayTexture){et&&_n&&t.texStorage3D(s.TEXTURE_2D_ARRAY,Nn,$n,Cr[0].width,Cr[0].height,en.depth);for(let cn=0,jt=Cr.length;cn<jt;cn++)if(Bn=Cr[cn],de.format!==io)if(vn!==null)if(et){if(pn)if(de.layerUpdates.size>0){const Wn=FY(Bn.width,Bn.height,de.format,de.type);for(const Br of de.layerUpdates){const Hi=Bn.data.subarray(Br*Wn/Bn.data.BYTES_PER_ELEMENT,(Br+1)*Wn/Bn.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,cn,0,0,Br,Bn.width,Bn.height,1,vn,Hi)}de.clearLayerUpdates()}else t.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,cn,0,0,0,Bn.width,Bn.height,en.depth,vn,Bn.data)}else t.compressedTexImage3D(s.TEXTURE_2D_ARRAY,cn,$n,Bn.width,Bn.height,en.depth,0,Bn.data,0,0);else qt("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else et?pn&&t.texSubImage3D(s.TEXTURE_2D_ARRAY,cn,0,0,0,Bn.width,Bn.height,en.depth,vn,Gn,Bn.data):t.texImage3D(s.TEXTURE_2D_ARRAY,cn,$n,Bn.width,Bn.height,en.depth,0,vn,Gn,Bn.data)}else{et&&_n&&t.texStorage2D(s.TEXTURE_2D,Nn,$n,Cr[0].width,Cr[0].height);for(let cn=0,jt=Cr.length;cn<jt;cn++)Bn=Cr[cn],de.format!==io?vn!==null?et?pn&&t.compressedTexSubImage2D(s.TEXTURE_2D,cn,0,0,Bn.width,Bn.height,vn,Bn.data):t.compressedTexImage2D(s.TEXTURE_2D,cn,$n,Bn.width,Bn.height,0,Bn.data):qt("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):et?pn&&t.texSubImage2D(s.TEXTURE_2D,cn,0,0,Bn.width,Bn.height,vn,Gn,Bn.data):t.texImage2D(s.TEXTURE_2D,cn,$n,Bn.width,Bn.height,0,vn,Gn,Bn.data)}else if(de.isDataArrayTexture)if(et){if(_n&&t.texStorage3D(s.TEXTURE_2D_ARRAY,Nn,$n,en.width,en.height,en.depth),pn)if(de.layerUpdates.size>0){const cn=FY(en.width,en.height,de.format,de.type);for(const jt of de.layerUpdates){const Wn=en.data.subarray(jt*cn/en.data.BYTES_PER_ELEMENT,(jt+1)*cn/en.data.BYTES_PER_ELEMENT);t.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,jt,en.width,en.height,1,vn,Gn,Wn)}de.clearLayerUpdates()}else t.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,0,en.width,en.height,en.depth,vn,Gn,en.data)}else t.texImage3D(s.TEXTURE_2D_ARRAY,0,$n,en.width,en.height,en.depth,0,vn,Gn,en.data);else if(de.isData3DTexture)et?(_n&&t.texStorage3D(s.TEXTURE_3D,Nn,$n,en.width,en.height,en.depth),pn&&t.texSubImage3D(s.TEXTURE_3D,0,0,0,0,en.width,en.height,en.depth,vn,Gn,en.data)):t.texImage3D(s.TEXTURE_3D,0,$n,en.width,en.height,en.depth,0,vn,Gn,en.data);else if(de.isFramebufferTexture){if(_n)if(et)t.texStorage2D(s.TEXTURE_2D,Nn,$n,en.width,en.height);else{let cn=en.width,jt=en.height;for(let Wn=0;Wn<Nn;Wn++)t.texImage2D(s.TEXTURE_2D,Wn,$n,cn,jt,0,vn,Gn,null),cn>>=1,jt>>=1}}else if(Cr.length>0){if(et&&_n){const cn=Vn(Cr[0]);t.texStorage2D(s.TEXTURE_2D,Nn,$n,cn.width,cn.height)}for(let cn=0,jt=Cr.length;cn<jt;cn++)Bn=Cr[cn],et?pn&&t.texSubImage2D(s.TEXTURE_2D,cn,0,0,vn,Gn,Bn):t.texImage2D(s.TEXTURE_2D,cn,$n,vn,Gn,Bn);de.generateMipmaps=!1}else if(et){if(_n){const cn=Vn(en);t.texStorage2D(s.TEXTURE_2D,Nn,$n,cn.width,cn.height)}pn&&t.texSubImage2D(s.TEXTURE_2D,0,0,0,vn,Gn,en)}else t.texImage2D(s.TEXTURE_2D,0,$n,vn,Gn,en);D(de)&&P(Xt),Qn.__version=Vt.version,de.onUpdate&&de.onUpdate(de)}ke.__version=de.version}function Ut(ke,de,ht){if(de.image.length!==6)return;const Xt=Pt(ke,de),Kt=de.source;t.bindTexture(s.TEXTURE_CUBE_MAP,ke.__webglTexture,s.TEXTURE0+ht);const Vt=n.get(Kt);if(Kt.version!==Vt.__version||Xt===!0){t.activeTexture(s.TEXTURE0+ht);const Qn=Zn.getPrimaries(Zn.workingColorSpace),wn=de.colorSpace===gu?null:Zn.getPrimaries(de.colorSpace),ar=de.colorSpace===gu||Qn===wn?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,de.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,de.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,de.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,ar);const Ir=de.isCompressedTexture||de.image[0].isCompressedTexture,en=de.image[0]&&de.image[0].isDataTexture,vn=[];for(let jt=0;jt<6;jt++)!Ir&&!en?vn[jt]=I(de.image[jt],!0,r.maxCubemapSize):vn[jt]=en?de.image[jt].image:de.image[jt],vn[jt]=Ti(de,vn[jt]);const Gn=vn[0],$n=i.convert(de.format,de.colorSpace),Bn=i.convert(de.type),Cr=j(de.internalFormat,$n,Bn,de.colorSpace),et=de.isVideoTexture!==!0,_n=Vt.__version===void 0||Xt===!0,pn=Kt.dataReady;let Nn=Z(de,Gn);st(s.TEXTURE_CUBE_MAP,de);let cn;if(Ir){et&&_n&&t.texStorage2D(s.TEXTURE_CUBE_MAP,Nn,Cr,Gn.width,Gn.height);for(let jt=0;jt<6;jt++){cn=vn[jt].mipmaps;for(let Wn=0;Wn<cn.length;Wn++){const Br=cn[Wn];de.format!==io?$n!==null?et?pn&&t.compressedTexSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+jt,Wn,0,0,Br.width,Br.height,$n,Br.data):t.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+jt,Wn,Cr,Br.width,Br.height,0,Br.data):qt("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):et?pn&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+jt,Wn,0,0,Br.width,Br.height,$n,Bn,Br.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+jt,Wn,Cr,Br.width,Br.height,0,$n,Bn,Br.data)}}}else{if(cn=de.mipmaps,et&&_n){cn.length>0&&Nn++;const jt=Vn(vn[0]);t.texStorage2D(s.TEXTURE_CUBE_MAP,Nn,Cr,jt.width,jt.height)}for(let jt=0;jt<6;jt++)if(en){et?pn&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+jt,0,0,0,vn[jt].width,vn[jt].height,$n,Bn,vn[jt].data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+jt,0,Cr,vn[jt].width,vn[jt].height,0,$n,Bn,vn[jt].data);for(let Wn=0;Wn<cn.length;Wn++){const Hi=cn[Wn].image[jt].image;et?pn&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+jt,Wn+1,0,0,Hi.width,Hi.height,$n,Bn,Hi.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+jt,Wn+1,Cr,Hi.width,Hi.height,0,$n,Bn,Hi.data)}}else{et?pn&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+jt,0,0,0,$n,Bn,vn[jt]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+jt,0,Cr,$n,Bn,vn[jt]);for(let Wn=0;Wn<cn.length;Wn++){const Br=cn[Wn];et?pn&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+jt,Wn+1,0,0,$n,Bn,Br.image[jt]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+jt,Wn+1,Cr,$n,Bn,Br.image[jt])}}}D(de)&&P(s.TEXTURE_CUBE_MAP),Vt.__version=Kt.version,de.onUpdate&&de.onUpdate(de)}ke.__version=de.version}function Wt(ke,de,ht,Xt,Kt,Vt){const Qn=i.convert(ht.format,ht.colorSpace),wn=i.convert(ht.type),ar=j(ht.internalFormat,Qn,wn,ht.colorSpace),Ir=n.get(de),en=n.get(ht);if(en.__renderTarget=de,!Ir.__hasExternalTextures){const vn=Math.max(1,de.width>>Vt),Gn=Math.max(1,de.height>>Vt);Kt===s.TEXTURE_3D||Kt===s.TEXTURE_2D_ARRAY?t.texImage3D(Kt,Vt,ar,vn,Gn,de.depth,0,Qn,wn,null):t.texImage2D(Kt,Vt,ar,vn,Gn,0,Qn,wn,null)}t.bindFramebuffer(s.FRAMEBUFFER,ke),_s(de)?l.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,Xt,Kt,en.__webglTexture,0,Ke(de)):(Kt===s.TEXTURE_2D||Kt>=s.TEXTURE_CUBE_MAP_POSITIVE_X&&Kt<=s.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&s.framebufferTexture2D(s.FRAMEBUFFER,Xt,Kt,en.__webglTexture,Vt),t.bindFramebuffer(s.FRAMEBUFFER,null)}function kn(ke,de,ht){if(s.bindRenderbuffer(s.RENDERBUFFER,ke),de.depthBuffer){const Xt=de.depthTexture,Kt=Xt&&Xt.isDepthTexture?Xt.type:null,Vt=C(de.stencilBuffer,Kt),Qn=de.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT;_s(de)?l.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,Ke(de),Vt,de.width,de.height):ht?s.renderbufferStorageMultisample(s.RENDERBUFFER,Ke(de),Vt,de.width,de.height):s.renderbufferStorage(s.RENDERBUFFER,Vt,de.width,de.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,Qn,s.RENDERBUFFER,ke)}else{const Xt=de.textures;for(let Kt=0;Kt<Xt.length;Kt++){const Vt=Xt[Kt],Qn=i.convert(Vt.format,Vt.colorSpace),wn=i.convert(Vt.type),ar=j(Vt.internalFormat,Qn,wn,Vt.colorSpace);_s(de)?l.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,Ke(de),ar,de.width,de.height):ht?s.renderbufferStorageMultisample(s.RENDERBUFFER,Ke(de),ar,de.width,de.height):s.renderbufferStorage(s.RENDERBUFFER,ar,de.width,de.height)}}s.bindRenderbuffer(s.RENDERBUFFER,null)}function Dn(ke,de,ht){const Xt=de.isWebGLCubeRenderTarget===!0;if(t.bindFramebuffer(s.FRAMEBUFFER,ke),!(de.depthTexture&&de.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Kt=n.get(de.depthTexture);if(Kt.__renderTarget=de,(!Kt.__webglTexture||de.depthTexture.image.width!==de.width||de.depthTexture.image.height!==de.height)&&(de.depthTexture.image.width=de.width,de.depthTexture.image.height=de.height,de.depthTexture.needsUpdate=!0),Xt){if(Kt.__webglInit===void 0&&(Kt.__webglInit=!0,de.depthTexture.addEventListener("dispose",ie)),Kt.__webglTexture===void 0){Kt.__webglTexture=s.createTexture(),t.bindTexture(s.TEXTURE_CUBE_MAP,Kt.__webglTexture),st(s.TEXTURE_CUBE_MAP,de.depthTexture);const Ir=i.convert(de.depthTexture.format),en=i.convert(de.depthTexture.type);let vn;de.depthTexture.format===B0?vn=s.DEPTH_COMPONENT24:de.depthTexture.format===_u&&(vn=s.DEPTH24_STENCIL8);for(let Gn=0;Gn<6;Gn++)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Gn,0,vn,de.width,de.height,0,Ir,en,null)}}else Ie(de.depthTexture,0);const Vt=Kt.__webglTexture,Qn=Ke(de),wn=Xt?s.TEXTURE_CUBE_MAP_POSITIVE_X+ht:s.TEXTURE_2D,ar=de.depthTexture.format===_u?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT;if(de.depthTexture.format===B0)_s(de)?l.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,ar,wn,Vt,0,Qn):s.framebufferTexture2D(s.FRAMEBUFFER,ar,wn,Vt,0);else if(de.depthTexture.format===_u)_s(de)?l.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,ar,wn,Vt,0,Qn):s.framebufferTexture2D(s.FRAMEBUFFER,ar,wn,Vt,0);else throw new Error("Unknown depthTexture format")}function or(ke){const de=n.get(ke),ht=ke.isWebGLCubeRenderTarget===!0;if(de.__boundDepthTexture!==ke.depthTexture){const Xt=ke.depthTexture;if(de.__depthDisposeCallback&&de.__depthDisposeCallback(),Xt){const Kt=()=>{delete de.__boundDepthTexture,delete de.__depthDisposeCallback,Xt.removeEventListener("dispose",Kt)};Xt.addEventListener("dispose",Kt),de.__depthDisposeCallback=Kt}de.__boundDepthTexture=Xt}if(ke.depthTexture&&!de.__autoAllocateDepthBuffer)if(ht)for(let Xt=0;Xt<6;Xt++)Dn(de.__webglFramebuffer[Xt],ke,Xt);else{const Xt=ke.texture.mipmaps;Xt&&Xt.length>0?Dn(de.__webglFramebuffer[0],ke,0):Dn(de.__webglFramebuffer,ke,0)}else if(ht){de.__webglDepthbuffer=[];for(let Xt=0;Xt<6;Xt++)if(t.bindFramebuffer(s.FRAMEBUFFER,de.__webglFramebuffer[Xt]),de.__webglDepthbuffer[Xt]===void 0)de.__webglDepthbuffer[Xt]=s.createRenderbuffer(),kn(de.__webglDepthbuffer[Xt],ke,!1);else{const Kt=ke.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,Vt=de.__webglDepthbuffer[Xt];s.bindRenderbuffer(s.RENDERBUFFER,Vt),s.framebufferRenderbuffer(s.FRAMEBUFFER,Kt,s.RENDERBUFFER,Vt)}}else{const Xt=ke.texture.mipmaps;if(Xt&&Xt.length>0?t.bindFramebuffer(s.FRAMEBUFFER,de.__webglFramebuffer[0]):t.bindFramebuffer(s.FRAMEBUFFER,de.__webglFramebuffer),de.__webglDepthbuffer===void 0)de.__webglDepthbuffer=s.createRenderbuffer(),kn(de.__webglDepthbuffer,ke,!1);else{const Kt=ke.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,Vt=de.__webglDepthbuffer;s.bindRenderbuffer(s.RENDERBUFFER,Vt),s.framebufferRenderbuffer(s.FRAMEBUFFER,Kt,s.RENDERBUFFER,Vt)}}t.bindFramebuffer(s.FRAMEBUFFER,null)}function ns(ke,de,ht){const Xt=n.get(ke);de!==void 0&&Wt(Xt.__webglFramebuffer,ke,ke.texture,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,0),ht!==void 0&&or(ke)}function Xr(ke){const de=ke.texture,ht=n.get(ke),Xt=n.get(de);ke.addEventListener("dispose",se);const Kt=ke.textures,Vt=ke.isWebGLCubeRenderTarget===!0,Qn=Kt.length>1;if(Qn||(Xt.__webglTexture===void 0&&(Xt.__webglTexture=s.createTexture()),Xt.__version=de.version,o.memory.textures++),Vt){ht.__webglFramebuffer=[];for(let wn=0;wn<6;wn++)if(de.mipmaps&&de.mipmaps.length>0){ht.__webglFramebuffer[wn]=[];for(let ar=0;ar<de.mipmaps.length;ar++)ht.__webglFramebuffer[wn][ar]=s.createFramebuffer()}else ht.__webglFramebuffer[wn]=s.createFramebuffer()}else{if(de.mipmaps&&de.mipmaps.length>0){ht.__webglFramebuffer=[];for(let wn=0;wn<de.mipmaps.length;wn++)ht.__webglFramebuffer[wn]=s.createFramebuffer()}else ht.__webglFramebuffer=s.createFramebuffer();if(Qn)for(let wn=0,ar=Kt.length;wn<ar;wn++){const Ir=n.get(Kt[wn]);Ir.__webglTexture===void 0&&(Ir.__webglTexture=s.createTexture(),o.memory.textures++)}if(ke.samples>0&&_s(ke)===!1){ht.__webglMultisampledFramebuffer=s.createFramebuffer(),ht.__webglColorRenderbuffer=[],t.bindFramebuffer(s.FRAMEBUFFER,ht.__webglMultisampledFramebuffer);for(let wn=0;wn<Kt.length;wn++){const ar=Kt[wn];ht.__webglColorRenderbuffer[wn]=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,ht.__webglColorRenderbuffer[wn]);const Ir=i.convert(ar.format,ar.colorSpace),en=i.convert(ar.type),vn=j(ar.internalFormat,Ir,en,ar.colorSpace,ke.isXRRenderTarget===!0),Gn=Ke(ke);s.renderbufferStorageMultisample(s.RENDERBUFFER,Gn,vn,ke.width,ke.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+wn,s.RENDERBUFFER,ht.__webglColorRenderbuffer[wn])}s.bindRenderbuffer(s.RENDERBUFFER,null),ke.depthBuffer&&(ht.__webglDepthRenderbuffer=s.createRenderbuffer(),kn(ht.__webglDepthRenderbuffer,ke,!0)),t.bindFramebuffer(s.FRAMEBUFFER,null)}}if(Vt){t.bindTexture(s.TEXTURE_CUBE_MAP,Xt.__webglTexture),st(s.TEXTURE_CUBE_MAP,de);for(let wn=0;wn<6;wn++)if(de.mipmaps&&de.mipmaps.length>0)for(let ar=0;ar<de.mipmaps.length;ar++)Wt(ht.__webglFramebuffer[wn][ar],ke,de,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+wn,ar);else Wt(ht.__webglFramebuffer[wn],ke,de,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+wn,0);D(de)&&P(s.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Qn){for(let wn=0,ar=Kt.length;wn<ar;wn++){const Ir=Kt[wn],en=n.get(Ir);let vn=s.TEXTURE_2D;(ke.isWebGL3DRenderTarget||ke.isWebGLArrayRenderTarget)&&(vn=ke.isWebGL3DRenderTarget?s.TEXTURE_3D:s.TEXTURE_2D_ARRAY),t.bindTexture(vn,en.__webglTexture),st(vn,Ir),Wt(ht.__webglFramebuffer,ke,Ir,s.COLOR_ATTACHMENT0+wn,vn,0),D(Ir)&&P(vn)}t.unbindTexture()}else{let wn=s.TEXTURE_2D;if((ke.isWebGL3DRenderTarget||ke.isWebGLArrayRenderTarget)&&(wn=ke.isWebGL3DRenderTarget?s.TEXTURE_3D:s.TEXTURE_2D_ARRAY),t.bindTexture(wn,Xt.__webglTexture),st(wn,de),de.mipmaps&&de.mipmaps.length>0)for(let ar=0;ar<de.mipmaps.length;ar++)Wt(ht.__webglFramebuffer[ar],ke,de,s.COLOR_ATTACHMENT0,wn,ar);else Wt(ht.__webglFramebuffer,ke,de,s.COLOR_ATTACHMENT0,wn,0);D(de)&&P(wn),t.unbindTexture()}ke.depthBuffer&&or(ke)}function Vr(ke){const de=ke.textures;for(let ht=0,Xt=de.length;ht<Xt;ht++){const Kt=de[ht];if(D(Kt)){const Vt=U(ke),Qn=n.get(Kt).__webglTexture;t.bindTexture(Vt,Qn),P(Vt),t.unbindTexture()}}}const Kr=[],Yr=[];function mi(ke){if(ke.samples>0){if(_s(ke)===!1){const de=ke.textures,ht=ke.width,Xt=ke.height;let Kt=s.COLOR_BUFFER_BIT;const Vt=ke.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,Qn=n.get(ke),wn=de.length>1;if(wn)for(let Ir=0;Ir<de.length;Ir++)t.bindFramebuffer(s.FRAMEBUFFER,Qn.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Ir,s.RENDERBUFFER,null),t.bindFramebuffer(s.FRAMEBUFFER,Qn.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+Ir,s.TEXTURE_2D,null,0);t.bindFramebuffer(s.READ_FRAMEBUFFER,Qn.__webglMultisampledFramebuffer);const ar=ke.texture.mipmaps;ar&&ar.length>0?t.bindFramebuffer(s.DRAW_FRAMEBUFFER,Qn.__webglFramebuffer[0]):t.bindFramebuffer(s.DRAW_FRAMEBUFFER,Qn.__webglFramebuffer);for(let Ir=0;Ir<de.length;Ir++){if(ke.resolveDepthBuffer&&(ke.depthBuffer&&(Kt|=s.DEPTH_BUFFER_BIT),ke.stencilBuffer&&ke.resolveStencilBuffer&&(Kt|=s.STENCIL_BUFFER_BIT)),wn){s.framebufferRenderbuffer(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,Qn.__webglColorRenderbuffer[Ir]);const en=n.get(de[Ir]).__webglTexture;s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,en,0)}s.blitFramebuffer(0,0,ht,Xt,0,0,ht,Xt,Kt,s.NEAREST),c===!0&&(Kr.length=0,Yr.length=0,Kr.push(s.COLOR_ATTACHMENT0+Ir),ke.depthBuffer&&ke.resolveDepthBuffer===!1&&(Kr.push(Vt),Yr.push(Vt),s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,Yr)),s.invalidateFramebuffer(s.READ_FRAMEBUFFER,Kr))}if(t.bindFramebuffer(s.READ_FRAMEBUFFER,null),t.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),wn)for(let Ir=0;Ir<de.length;Ir++){t.bindFramebuffer(s.FRAMEBUFFER,Qn.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Ir,s.RENDERBUFFER,Qn.__webglColorRenderbuffer[Ir]);const en=n.get(de[Ir]).__webglTexture;t.bindFramebuffer(s.FRAMEBUFFER,Qn.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+Ir,s.TEXTURE_2D,en,0)}t.bindFramebuffer(s.DRAW_FRAMEBUFFER,Qn.__webglMultisampledFramebuffer)}else if(ke.depthBuffer&&ke.resolveDepthBuffer===!1&&c){const de=ke.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT;s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,[de])}}}function Ke(ke){return Math.min(r.maxSamples,ke.samples)}function _s(ke){const de=n.get(ke);return ke.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&de.__useRenderToTexture!==!1}function ui(ke){const de=o.render.frame;m.get(ke)!==de&&(m.set(ke,de),ke.update())}function Ti(ke,de){const ht=ke.colorSpace,Xt=ke.format,Kt=ke.type;return ke.isCompressedTexture===!0||ke.isVideoTexture===!0||ht!==vd&&ht!==gu&&(Zn.getTransfer(ht)===Yn?(Xt!==io||Kt!==yo)&&qt("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):Ht("WebGLTextures: Unsupported texture color space:",ht)),de}function Vn(ke){return typeof HTMLImageElement<"u"&&ke instanceof HTMLImageElement?(h.width=ke.naturalWidth||ke.width,h.height=ke.naturalHeight||ke.height):typeof VideoFrame<"u"&&ke instanceof VideoFrame?(h.width=ke.displayWidth,h.height=ke.displayHeight):(h.width=ke.width,h.height=ke.height),h}this.allocateTextureUnit=Oe,this.resetTextureUnits=Me,this.setTexture2D=Ie,this.setTexture2DArray=ce,this.setTexture3D=Ve,this.setTextureCube=Pe,this.rebindTextures=ns,this.setupRenderTarget=Xr,this.updateRenderTargetMipmap=Vr,this.updateMultisampleRenderTarget=mi,this.setupDepthRenderbuffer=or,this.setupFrameBufferTexture=Wt,this.useMultisampledRTT=_s,this.isReversedDepthBuffer=function(){return t.buffers.depth.getReversed()}}function fXe(s,e){function t(n,r=gu){let i;const o=Zn.getTransfer(r);if(n===yo)return s.UNSIGNED_BYTE;if(n===JF)return s.UNSIGNED_SHORT_4_4_4_4;if(n===eB)return s.UNSIGNED_SHORT_5_5_5_1;if(n===tB)return s.UNSIGNED_INT_5_9_9_9_REV;if(n===nB)return s.UNSIGNED_INT_10F_11F_11F_REV;if(n===Z6)return s.BYTE;if(n===Q6)return s.SHORT;if(n===um)return s.UNSIGNED_SHORT;if(n===r0)return s.INT;if(n===Ds)return s.UNSIGNED_INT;if(n===vo)return s.FLOAT;if(n===ro)return s.HALF_FLOAT;if(n===UK)return s.ALPHA;if(n===qA)return s.RGB;if(n===io)return s.RGBA;if(n===B0)return s.DEPTH_COMPONENT;if(n===_u)return s.DEPTH_STENCIL;if(n===mw)return s.RED;if(n===gw)return s.RED_INTEGER;if(n===Su)return s.RG;if(n===yw)return s.RG_INTEGER;if(n===vw)return s.RGBA_INTEGER;if(n===e5||n===t5||n===n5||n===r5)if(o===Yn)if(i=e.get("WEBGL_compressed_texture_s3tc_srgb"),i!==null){if(n===e5)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===t5)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===n5)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===r5)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(i=e.get("WEBGL_compressed_texture_s3tc"),i!==null){if(n===e5)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===t5)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===n5)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===r5)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===fA||n===mA||n===gA||n===yA)if(i=e.get("WEBGL_compressed_texture_pvrtc"),i!==null){if(n===fA)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===mA)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===gA)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===yA)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===MS||n===CS||n===AS||n===NS||n===PS||n===ax||n===RS)if(i=e.get("WEBGL_compressed_texture_etc"),i!==null){if(n===MS||n===CS)return o===Yn?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===AS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC;if(n===NS)return i.COMPRESSED_R11_EAC;if(n===PS)return i.COMPRESSED_SIGNED_R11_EAC;if(n===ax)return i.COMPRESSED_RG11_EAC;if(n===RS)return i.COMPRESSED_SIGNED_RG11_EAC}else return null;if(n===IS||n===kS||n===DS||n===OS||n===LS||n===FS||n===BS||n===US||n===zS||n===VS||n===GS||n===jS||n===HS||n===$S)if(i=e.get("WEBGL_compressed_texture_astc"),i!==null){if(n===IS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===kS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===DS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===OS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===LS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===FS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===BS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===US)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===zS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===VS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===GS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===jS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===HS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===$S)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===WS||n===TY||n===EY)if(i=e.get("EXT_texture_compression_bptc"),i!==null){if(n===WS)return o===Yn?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===TY)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===EY)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===qS||n===XS||n===lx||n===YS)if(i=e.get("EXT_texture_compression_rgtc"),i!==null){if(n===qS)return i.COMPRESSED_RED_RGTC1_EXT;if(n===XS)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===lx)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===YS)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===gh?s.UNSIGNED_INT_24_8:s[n]!==void 0?s[n]:null}return{convert:t}}const mXe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,gXe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class yXe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const n=new Z_e(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new bh({vertexShader:mXe,fragmentShader:gXe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new gn(new Ng(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class vXe extends _d{constructor(e,t){super();const n=this;let r=null,i=1,o=null,l="local-floor",c=1,h=null,m=null,y=null,b=null,w=null,A=null;const I=typeof XRWebGLBinding<"u",D=new yXe,P={},U=t.getContextAttributes();let j=null,C=null;const Z=[],ie=[],se=new Ln;let z=null;const re=new Va;re.viewport=new zr;const ye=new Va;ye.viewport=new zr;const H=[re,ye],Me=new gSe;let Oe=null,Ue=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(St){let Ut=Z[St];return Ut===void 0&&(Ut=new HL,Z[St]=Ut),Ut.getTargetRaySpace()},this.getControllerGrip=function(St){let Ut=Z[St];return Ut===void 0&&(Ut=new HL,Z[St]=Ut),Ut.getGripSpace()},this.getHand=function(St){let Ut=Z[St];return Ut===void 0&&(Ut=new HL,Z[St]=Ut),Ut.getHandSpace()};function Ie(St){const Ut=ie.indexOf(St.inputSource);if(Ut===-1)return;const Wt=Z[Ut];Wt!==void 0&&(Wt.update(St.inputSource,St.frame,h||o),Wt.dispatchEvent({type:St.type,data:St.inputSource}))}function ce(){r.removeEventListener("select",Ie),r.removeEventListener("selectstart",Ie),r.removeEventListener("selectend",Ie),r.removeEventListener("squeeze",Ie),r.removeEventListener("squeezestart",Ie),r.removeEventListener("squeezeend",Ie),r.removeEventListener("end",ce),r.removeEventListener("inputsourceschange",Ve);for(let St=0;St<Z.length;St++){const Ut=ie[St];Ut!==null&&(ie[St]=null,Z[St].disconnect(Ut))}Oe=null,Ue=null,D.reset();for(const St in P)delete P[St];e.setRenderTarget(j),w=null,b=null,y=null,r=null,C=null,bn.stop(),n.isPresenting=!1,e.setPixelRatio(z),e.setSize(se.width,se.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(St){i=St,n.isPresenting===!0&&qt("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(St){l=St,n.isPresenting===!0&&qt("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||o},this.setReferenceSpace=function(St){h=St},this.getBaseLayer=function(){return b!==null?b:w},this.getBinding=function(){return y===null&&I&&(y=new XRWebGLBinding(r,t)),y},this.getFrame=function(){return A},this.getSession=function(){return r},this.setSession=async function(St){if(r=St,r!==null){if(j=e.getRenderTarget(),r.addEventListener("select",Ie),r.addEventListener("selectstart",Ie),r.addEventListener("selectend",Ie),r.addEventListener("squeeze",Ie),r.addEventListener("squeezestart",Ie),r.addEventListener("squeezeend",Ie),r.addEventListener("end",ce),r.addEventListener("inputsourceschange",Ve),U.xrCompatible!==!0&&await t.makeXRCompatible(),z=e.getPixelRatio(),e.getSize(se),I&&"createProjectionLayer"in XRWebGLBinding.prototype){let Wt=null,kn=null,Dn=null;U.depth&&(Dn=U.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Wt=U.stencil?_u:B0,kn=U.stencil?gh:Ds);const or={colorFormat:t.RGBA8,depthFormat:Dn,scaleFactor:i};y=this.getBinding(),b=y.createProjectionLayer(or),r.updateRenderState({layers:[b]}),e.setPixelRatio(1),e.setSize(b.textureWidth,b.textureHeight,!1),C=new hm(b.textureWidth,b.textureHeight,{format:io,type:yo,depthTexture:new Cc(b.textureWidth,b.textureHeight,kn,void 0,void 0,void 0,void 0,void 0,void 0,Wt),stencilBuffer:U.stencil,colorSpace:e.outputColorSpace,samples:U.antialias?4:0,resolveDepthBuffer:b.ignoreDepthValues===!1,resolveStencilBuffer:b.ignoreDepthValues===!1})}else{const Wt={antialias:U.antialias,alpha:!0,depth:U.depth,stencil:U.stencil,framebufferScaleFactor:i};w=new XRWebGLLayer(r,t,Wt),r.updateRenderState({baseLayer:w}),e.setPixelRatio(1),e.setSize(w.framebufferWidth,w.framebufferHeight,!1),C=new hm(w.framebufferWidth,w.framebufferHeight,{format:io,type:yo,colorSpace:e.outputColorSpace,stencilBuffer:U.stencil,resolveDepthBuffer:w.ignoreDepthValues===!1,resolveStencilBuffer:w.ignoreDepthValues===!1})}C.isXRRenderTarget=!0,this.setFoveation(c),h=null,o=await r.requestReferenceSpace(l),bn.setContext(r),bn.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return D.getDepthTexture()};function Ve(St){for(let Ut=0;Ut<St.removed.length;Ut++){const Wt=St.removed[Ut],kn=ie.indexOf(Wt);kn>=0&&(ie[kn]=null,Z[kn].disconnect(Wt))}for(let Ut=0;Ut<St.added.length;Ut++){const Wt=St.added[Ut];let kn=ie.indexOf(Wt);if(kn===-1){for(let or=0;or<Z.length;or++)if(or>=ie.length){ie.push(Wt),kn=or;break}else if(ie[or]===null){ie[or]=Wt,kn=or;break}if(kn===-1)break}const Dn=Z[kn];Dn&&Dn.connect(Wt)}}const Pe=new be,We=new be;function pt(St,Ut,Wt){Pe.setFromMatrixPosition(Ut.matrixWorld),We.setFromMatrixPosition(Wt.matrixWorld);const kn=Pe.distanceTo(We),Dn=Ut.projectionMatrix.elements,or=Wt.projectionMatrix.elements,ns=Dn[14]/(Dn[10]-1),Xr=Dn[14]/(Dn[10]+1),Vr=(Dn[9]+1)/Dn[5],Kr=(Dn[9]-1)/Dn[5],Yr=(Dn[8]-1)/Dn[0],mi=(or[8]+1)/or[0],Ke=ns*Yr,_s=ns*mi,ui=kn/(-Yr+mi),Ti=ui*-Yr;if(Ut.matrixWorld.decompose(St.position,St.quaternion,St.scale),St.translateX(Ti),St.translateZ(ui),St.matrixWorld.compose(St.position,St.quaternion,St.scale),St.matrixWorldInverse.copy(St.matrixWorld).invert(),Dn[10]===-1)St.projectionMatrix.copy(Ut.projectionMatrix),St.projectionMatrixInverse.copy(Ut.projectionMatrixInverse);else{const Vn=ns+ui,ke=Xr+ui,de=Ke-Ti,ht=_s+(kn-Ti),Xt=Vr*Xr/ke*Vn,Kt=Kr*Xr/ke*Vn;St.projectionMatrix.makePerspective(de,ht,Xt,Kt,Vn,ke),St.projectionMatrixInverse.copy(St.projectionMatrix).invert()}}function Ne(St,Ut){Ut===null?St.matrixWorld.copy(St.matrix):St.matrixWorld.multiplyMatrices(Ut.matrixWorld,St.matrix),St.matrixWorldInverse.copy(St.matrixWorld).invert()}this.updateCamera=function(St){if(r===null)return;let Ut=St.near,Wt=St.far;D.texture!==null&&(D.depthNear>0&&(Ut=D.depthNear),D.depthFar>0&&(Wt=D.depthFar)),Me.near=ye.near=re.near=Ut,Me.far=ye.far=re.far=Wt,(Oe!==Me.near||Ue!==Me.far)&&(r.updateRenderState({depthNear:Me.near,depthFar:Me.far}),Oe=Me.near,Ue=Me.far),Me.layers.mask=St.layers.mask|6,re.layers.mask=Me.layers.mask&-5,ye.layers.mask=Me.layers.mask&-3;const kn=St.parent,Dn=Me.cameras;Ne(Me,kn);for(let or=0;or<Dn.length;or++)Ne(Dn[or],kn);Dn.length===2?pt(Me,re,ye):Me.projectionMatrix.copy(re.projectionMatrix),st(St,Me,kn)};function st(St,Ut,Wt){Wt===null?St.matrix.copy(Ut.matrixWorld):(St.matrix.copy(Wt.matrixWorld),St.matrix.invert(),St.matrix.multiply(Ut.matrixWorld)),St.matrix.decompose(St.position,St.quaternion,St.scale),St.updateMatrixWorld(!0),St.projectionMatrix.copy(Ut.projectionMatrix),St.projectionMatrixInverse.copy(Ut.projectionMatrixInverse),St.isPerspectiveCamera&&(St.fov=ux*2*Math.atan(1/St.projectionMatrix.elements[5]),St.zoom=1)}this.getCamera=function(){return Me},this.getFoveation=function(){if(!(b===null&&w===null))return c},this.setFoveation=function(St){c=St,b!==null&&(b.fixedFoveation=St),w!==null&&w.fixedFoveation!==void 0&&(w.fixedFoveation=St)},this.hasDepthSensing=function(){return D.texture!==null},this.getDepthSensingMesh=function(){return D.getMesh(Me)},this.getCameraTexture=function(St){return P[St]};let Pt=null;function yn(St,Ut){if(m=Ut.getViewerPose(h||o),A=Ut,m!==null){const Wt=m.views;w!==null&&(e.setRenderTargetFramebuffer(C,w.framebuffer),e.setRenderTarget(C));let kn=!1;Wt.length!==Me.cameras.length&&(Me.cameras.length=0,kn=!0);for(let Xr=0;Xr<Wt.length;Xr++){const Vr=Wt[Xr];let Kr=null;if(w!==null)Kr=w.getViewport(Vr);else{const mi=y.getViewSubImage(b,Vr);Kr=mi.viewport,Xr===0&&(e.setRenderTargetTextures(C,mi.colorTexture,mi.depthStencilTexture),e.setRenderTarget(C))}let Yr=H[Xr];Yr===void 0&&(Yr=new Va,Yr.layers.enable(Xr),Yr.viewport=new zr,H[Xr]=Yr),Yr.matrix.fromArray(Vr.transform.matrix),Yr.matrix.decompose(Yr.position,Yr.quaternion,Yr.scale),Yr.projectionMatrix.fromArray(Vr.projectionMatrix),Yr.projectionMatrixInverse.copy(Yr.projectionMatrix).invert(),Yr.viewport.set(Kr.x,Kr.y,Kr.width,Kr.height),Xr===0&&(Me.matrix.copy(Yr.matrix),Me.matrix.decompose(Me.position,Me.quaternion,Me.scale)),kn===!0&&Me.cameras.push(Yr)}const Dn=r.enabledFeatures;if(Dn&&Dn.includes("depth-sensing")&&r.depthUsage=="gpu-optimized"&&I){y=n.getBinding();const Xr=y.getDepthInformation(Wt[0]);Xr&&Xr.isValid&&Xr.texture&&D.init(Xr,r.renderState)}if(Dn&&Dn.includes("camera-access")&&I){e.state.unbindTexture(),y=n.getBinding();for(let Xr=0;Xr<Wt.length;Xr++){const Vr=Wt[Xr].camera;if(Vr){let Kr=P[Vr];Kr||(Kr=new Z_e,P[Vr]=Kr);const Yr=y.getCameraImage(Vr);Kr.sourceTexture=Yr}}}}for(let Wt=0;Wt<Z.length;Wt++){const kn=ie[Wt],Dn=Z[Wt];kn!==null&&Dn!==void 0&&Dn.update(kn,Ut,h||o)}Pt&&Pt(St,Ut),Ut.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Ut}),A=null}const bn=new SSe;bn.setAnimationLoop(yn),this.setAnimationLoop=function(St){Pt=St},this.dispose=function(){}}}const y6=new Sa,xXe=new Pn;function bXe(s,e){function t(D,P){D.matrixAutoUpdate===!0&&D.updateMatrix(),P.value.copy(D.matrix)}function n(D,P){P.color.getRGB(D.fogColor.value,iSe(s)),P.isFog?(D.fogNear.value=P.near,D.fogFar.value=P.far):P.isFogExp2&&(D.fogDensity.value=P.density)}function r(D,P,U,j,C){P.isMeshBasicMaterial?i(D,P):P.isMeshLambertMaterial?(i(D,P),P.envMap&&(D.envMapIntensity.value=P.envMapIntensity)):P.isMeshToonMaterial?(i(D,P),y(D,P)):P.isMeshPhongMaterial?(i(D,P),m(D,P),P.envMap&&(D.envMapIntensity.value=P.envMapIntensity)):P.isMeshStandardMaterial?(i(D,P),b(D,P),P.isMeshPhysicalMaterial&&w(D,P,C)):P.isMeshMatcapMaterial?(i(D,P),A(D,P)):P.isMeshDepthMaterial?i(D,P):P.isMeshDistanceMaterial?(i(D,P),I(D,P)):P.isMeshNormalMaterial?i(D,P):P.isLineBasicMaterial?(o(D,P),P.isLineDashedMaterial&&l(D,P)):P.isPointsMaterial?c(D,P,U,j):P.isSpriteMaterial?h(D,P):P.isShadowMaterial?(D.color.value.copy(P.color),D.opacity.value=P.opacity):P.isShaderMaterial&&(P.uniformsNeedUpdate=!1)}function i(D,P){D.opacity.value=P.opacity,P.color&&D.diffuse.value.copy(P.color),P.emissive&&D.emissive.value.copy(P.emissive).multiplyScalar(P.emissiveIntensity),P.map&&(D.map.value=P.map,t(P.map,D.mapTransform)),P.alphaMap&&(D.alphaMap.value=P.alphaMap,t(P.alphaMap,D.alphaMapTransform)),P.bumpMap&&(D.bumpMap.value=P.bumpMap,t(P.bumpMap,D.bumpMapTransform),D.bumpScale.value=P.bumpScale,P.side===bs&&(D.bumpScale.value*=-1)),P.normalMap&&(D.normalMap.value=P.normalMap,t(P.normalMap,D.normalMapTransform),D.normalScale.value.copy(P.normalScale),P.side===bs&&D.normalScale.value.negate()),P.displacementMap&&(D.displacementMap.value=P.displacementMap,t(P.displacementMap,D.displacementMapTransform),D.displacementScale.value=P.displacementScale,D.displacementBias.value=P.displacementBias),P.emissiveMap&&(D.emissiveMap.value=P.emissiveMap,t(P.emissiveMap,D.emissiveMapTransform)),P.specularMap&&(D.specularMap.value=P.specularMap,t(P.specularMap,D.specularMapTransform)),P.alphaTest>0&&(D.alphaTest.value=P.alphaTest);const U=e.get(P),j=U.envMap,C=U.envMapRotation;j&&(D.envMap.value=j,y6.copy(C),y6.x*=-1,y6.y*=-1,y6.z*=-1,j.isCubeTexture&&j.isRenderTargetTexture===!1&&(y6.y*=-1,y6.z*=-1),D.envMapRotation.value.setFromMatrix4(xXe.makeRotationFromEuler(y6)),D.flipEnvMap.value=j.isCubeTexture&&j.isRenderTargetTexture===!1?-1:1,D.reflectivity.value=P.reflectivity,D.ior.value=P.ior,D.refractionRatio.value=P.refractionRatio),P.lightMap&&(D.lightMap.value=P.lightMap,D.lightMapIntensity.value=P.lightMapIntensity,t(P.lightMap,D.lightMapTransform)),P.aoMap&&(D.aoMap.value=P.aoMap,D.aoMapIntensity.value=P.aoMapIntensity,t(P.aoMap,D.aoMapTransform))}function o(D,P){D.diffuse.value.copy(P.color),D.opacity.value=P.opacity,P.map&&(D.map.value=P.map,t(P.map,D.mapTransform))}function l(D,P){D.dashSize.value=P.dashSize,D.totalSize.value=P.dashSize+P.gapSize,D.scale.value=P.scale}function c(D,P,U,j){D.diffuse.value.copy(P.color),D.opacity.value=P.opacity,D.size.value=P.size*U,D.scale.value=j*.5,P.map&&(D.map.value=P.map,t(P.map,D.uvTransform)),P.alphaMap&&(D.alphaMap.value=P.alphaMap,t(P.alphaMap,D.alphaMapTransform)),P.alphaTest>0&&(D.alphaTest.value=P.alphaTest)}function h(D,P){D.diffuse.value.copy(P.color),D.opacity.value=P.opacity,D.rotation.value=P.rotation,P.map&&(D.map.value=P.map,t(P.map,D.mapTransform)),P.alphaMap&&(D.alphaMap.value=P.alphaMap,t(P.alphaMap,D.alphaMapTransform)),P.alphaTest>0&&(D.alphaTest.value=P.alphaTest)}function m(D,P){D.specular.value.copy(P.specular),D.shininess.value=Math.max(P.shininess,1e-4)}function y(D,P){P.gradientMap&&(D.gradientMap.value=P.gradientMap)}function b(D,P){D.metalness.value=P.metalness,P.metalnessMap&&(D.metalnessMap.value=P.metalnessMap,t(P.metalnessMap,D.metalnessMapTransform)),D.roughness.value=P.roughness,P.roughnessMap&&(D.roughnessMap.value=P.roughnessMap,t(P.roughnessMap,D.roughnessMapTransform)),P.envMap&&(D.envMapIntensity.value=P.envMapIntensity)}function w(D,P,U){D.ior.value=P.ior,P.sheen>0&&(D.sheenColor.value.copy(P.sheenColor).multiplyScalar(P.sheen),D.sheenRoughness.value=P.sheenRoughness,P.sheenColorMap&&(D.sheenColorMap.value=P.sheenColorMap,t(P.sheenColorMap,D.sheenColorMapTransform)),P.sheenRoughnessMap&&(D.sheenRoughnessMap.value=P.sheenRoughnessMap,t(P.sheenRoughnessMap,D.sheenRoughnessMapTransform))),P.clearcoat>0&&(D.clearcoat.value=P.clearcoat,D.clearcoatRoughness.value=P.clearcoatRoughness,P.clearcoatMap&&(D.clearcoatMap.value=P.clearcoatMap,t(P.clearcoatMap,D.clearcoatMapTransform)),P.clearcoatRoughnessMap&&(D.clearcoatRoughnessMap.value=P.clearcoatRoughnessMap,t(P.clearcoatRoughnessMap,D.clearcoatRoughnessMapTransform)),P.clearcoatNormalMap&&(D.clearcoatNormalMap.value=P.clearcoatNormalMap,t(P.clearcoatNormalMap,D.clearcoatNormalMapTransform),D.clearcoatNormalScale.value.copy(P.clearcoatNormalScale),P.side===bs&&D.clearcoatNormalScale.value.negate())),P.dispersion>0&&(D.dispersion.value=P.dispersion),P.iridescence>0&&(D.iridescence.value=P.iridescence,D.iridescenceIOR.value=P.iridescenceIOR,D.iridescenceThicknessMinimum.value=P.iridescenceThicknessRange[0],D.iridescenceThicknessMaximum.value=P.iridescenceThicknessRange[1],P.iridescenceMap&&(D.iridescenceMap.value=P.iridescenceMap,t(P.iridescenceMap,D.iridescenceMapTransform)),P.iridescenceThicknessMap&&(D.iridescenceThicknessMap.value=P.iridescenceThicknessMap,t(P.iridescenceThicknessMap,D.iridescenceThicknessMapTransform))),P.transmission>0&&(D.transmission.value=P.transmission,D.transmissionSamplerMap.value=U.texture,D.transmissionSamplerSize.value.set(U.width,U.height),P.transmissionMap&&(D.transmissionMap.value=P.transmissionMap,t(P.transmissionMap,D.transmissionMapTransform)),D.thickness.value=P.thickness,P.thicknessMap&&(D.thicknessMap.value=P.thicknessMap,t(P.thicknessMap,D.thicknessMapTransform)),D.attenuationDistance.value=P.attenuationDistance,D.attenuationColor.value.copy(P.attenuationColor)),P.anisotropy>0&&(D.anisotropyVector.value.set(P.anisotropy*Math.cos(P.anisotropyRotation),P.anisotropy*Math.sin(P.anisotropyRotation)),P.anisotropyMap&&(D.anisotropyMap.value=P.anisotropyMap,t(P.anisotropyMap,D.anisotropyMapTransform))),D.specularIntensity.value=P.specularIntensity,D.specularColor.value.copy(P.specularColor),P.specularColorMap&&(D.specularColorMap.value=P.specularColorMap,t(P.specularColorMap,D.specularColorMapTransform)),P.specularIntensityMap&&(D.specularIntensityMap.value=P.specularIntensityMap,t(P.specularIntensityMap,D.specularIntensityMapTransform))}function A(D,P){P.matcap&&(D.matcap.value=P.matcap)}function I(D,P){const U=e.get(P).light;D.referencePosition.value.setFromMatrixPosition(U.matrixWorld),D.nearDistance.value=U.shadow.camera.near,D.farDistance.value=U.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:r}}function _Xe(s,e,t,n){let r={},i={},o=[];const l=s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS);function c(U,j){const C=j.program;n.uniformBlockBinding(U,C)}function h(U,j){let C=r[U.id];C===void 0&&(A(U),C=m(U),r[U.id]=C,U.addEventListener("dispose",D));const Z=j.program;n.updateUBOMapping(U,Z);const ie=e.render.frame;i[U.id]!==ie&&(b(U),i[U.id]=ie)}function m(U){const j=y();U.__bindingPointIndex=j;const C=s.createBuffer(),Z=U.__size,ie=U.usage;return s.bindBuffer(s.UNIFORM_BUFFER,C),s.bufferData(s.UNIFORM_BUFFER,Z,ie),s.bindBuffer(s.UNIFORM_BUFFER,null),s.bindBufferBase(s.UNIFORM_BUFFER,j,C),C}function y(){for(let U=0;U<l;U++)if(o.indexOf(U)===-1)return o.push(U),U;return Ht("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function b(U){const j=r[U.id],C=U.uniforms,Z=U.__cache;s.bindBuffer(s.UNIFORM_BUFFER,j);for(let ie=0,se=C.length;ie<se;ie++){const z=Array.isArray(C[ie])?C[ie]:[C[ie]];for(let re=0,ye=z.length;re<ye;re++){const H=z[re];if(w(H,ie,re,Z)===!0){const Me=H.__offset,Oe=Array.isArray(H.value)?H.value:[H.value];let Ue=0;for(let Ie=0;Ie<Oe.length;Ie++){const ce=Oe[Ie],Ve=I(ce);typeof ce=="number"||typeof ce=="boolean"?(H.__data[0]=ce,s.bufferSubData(s.UNIFORM_BUFFER,Me+Ue,H.__data)):ce.isMatrix3?(H.__data[0]=ce.elements[0],H.__data[1]=ce.elements[1],H.__data[2]=ce.elements[2],H.__data[3]=0,H.__data[4]=ce.elements[3],H.__data[5]=ce.elements[4],H.__data[6]=ce.elements[5],H.__data[7]=0,H.__data[8]=ce.elements[6],H.__data[9]=ce.elements[7],H.__data[10]=ce.elements[8],H.__data[11]=0):(ce.toArray(H.__data,Ue),Ue+=Ve.storage/Float32Array.BYTES_PER_ELEMENT)}s.bufferSubData(s.UNIFORM_BUFFER,Me,H.__data)}}}s.bindBuffer(s.UNIFORM_BUFFER,null)}function w(U,j,C,Z){const ie=U.value,se=j+"_"+C;if(Z[se]===void 0)return typeof ie=="number"||typeof ie=="boolean"?Z[se]=ie:Z[se]=ie.clone(),!0;{const z=Z[se];if(typeof ie=="number"||typeof ie=="boolean"){if(z!==ie)return Z[se]=ie,!0}else if(z.equals(ie)===!1)return z.copy(ie),!0}return!1}function A(U){const j=U.uniforms;let C=0;const Z=16;for(let se=0,z=j.length;se<z;se++){const re=Array.isArray(j[se])?j[se]:[j[se]];for(let ye=0,H=re.length;ye<H;ye++){const Me=re[ye],Oe=Array.isArray(Me.value)?Me.value:[Me.value];for(let Ue=0,Ie=Oe.length;Ue<Ie;Ue++){const ce=Oe[Ue],Ve=I(ce),Pe=C%Z,We=Pe%Ve.boundary,pt=Pe+We;C+=We,pt!==0&&Z-pt<Ve.storage&&(C+=Z-pt),Me.__data=new Float32Array(Ve.storage/Float32Array.BYTES_PER_ELEMENT),Me.__offset=C,C+=Ve.storage}}}const ie=C%Z;return ie>0&&(C+=Z-ie),U.__size=C,U.__cache={},this}function I(U){const j={boundary:0,storage:0};return typeof U=="number"||typeof U=="boolean"?(j.boundary=4,j.storage=4):U.isVector2?(j.boundary=8,j.storage=8):U.isVector3||U.isColor?(j.boundary=16,j.storage=12):U.isVector4?(j.boundary=16,j.storage=16):U.isMatrix3?(j.boundary=48,j.storage=48):U.isMatrix4?(j.boundary=64,j.storage=64):U.isTexture?qt("WebGLRenderer: Texture samplers can not be part of an uniforms group."):qt("WebGLRenderer: Unsupported uniform value type.",U),j}function D(U){const j=U.target;j.removeEventListener("dispose",D);const C=o.indexOf(j.__bindingPointIndex);o.splice(C,1),s.deleteBuffer(r[j.id]),delete r[j.id],delete i[j.id]}function P(){for(const U in r)s.deleteBuffer(r[U]);o=[],r={},i={}}return{bind:c,update:h,dispose:P}}const SXe=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let X1=null;function wXe(){return X1===null&&(X1=new j3(SXe,16,16,Su,ro),X1.name="DFG_LUT",X1.minFilter=ds,X1.magFilter=ds,X1.wrapS=zo,X1.wrapT=zo,X1.generateMipmaps=!1,X1.needsUpdate=!0),X1}class VC{constructor(e={}){const{canvas:t=B_e(),context:n=null,depth:r=!0,stencil:i=!1,alpha:o=!1,antialias:l=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:h=!1,powerPreference:m="default",failIfMajorPerformanceCaveat:y=!1,reversedDepthBuffer:b=!1,outputBufferType:w=yo}=e;this.isWebGLRenderer=!0;let A;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");A=n.getContextAttributes().alpha}else A=o;const I=w,D=new Set([vw,yw,gw]),P=new Set([yo,Ds,um,gh,JF,eB]),U=new Uint32Array(4),j=new Int32Array(4);let C=null,Z=null;const ie=[],se=[];let z=null;this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Ta,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const re=this;let ye=!1;this._outputColorSpace=Is;let H=0,Me=0,Oe=null,Ue=-1,Ie=null;const ce=new zr,Ve=new zr;let Pe=null;const We=new Tn(0);let pt=0,Ne=t.width,st=t.height,Pt=1,yn=null,bn=null;const St=new zr(0,0,Ne,st),Ut=new zr(0,0,Ne,st);let Wt=!1;const kn=new YA;let Dn=!1,or=!1;const ns=new Pn,Xr=new be,Vr=new zr,Kr={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Yr=!1;function mi(){return Oe===null?Pt:1}let Ke=n;function _s(me,mt){return t.getContext(me,mt)}try{const me={alpha:!0,depth:r,stencil:i,antialias:l,premultipliedAlpha:c,preserveDrawingBuffer:h,powerPreference:m,failIfMajorPerformanceCaveat:y};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${fx}`),t.addEventListener("webglcontextlost",Wn,!1),t.addEventListener("webglcontextrestored",Br,!1),t.addEventListener("webglcontextcreationerror",Hi,!1),Ke===null){const mt="webgl2";if(Ke=_s(mt,me),Ke===null)throw _s(mt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(me){throw Ht("WebGLRenderer: "+me.message),me}let ui,Ti,Vn,ke,de,ht,Xt,Kt,Vt,Qn,wn,ar,Ir,en,vn,Gn,$n,Bn,Cr,et,_n,pn,Nn;function cn(){ui=new TWe(Ke),ui.init(),_n=new fXe(Ke,ui),Ti=new gWe(Ke,ui,e,_n),Vn=new hXe(Ke,ui),Ti.reversedDepthBuffer&&b&&Vn.buffers.depth.setReversed(!0),ke=new CWe(Ke),de=new Qqe,ht=new pXe(Ke,ui,Vn,de,Ti,_n,ke),Xt=new wWe(re),Kt=new Ije(Ke),pn=new fWe(Ke,Kt),Vt=new EWe(Ke,Kt,ke,pn),Qn=new NWe(Ke,Vt,Kt,pn,ke),Bn=new AWe(Ke,Ti,ht),vn=new yWe(de),wn=new Zqe(re,Xt,ui,Ti,pn,vn),ar=new bXe(re,de),Ir=new eXe,en=new oXe(ui),$n=new pWe(re,Xt,Vn,Qn,A,c),Gn=new dXe(re,Qn,Ti),Nn=new _Xe(Ke,ke,Ti,Vn),Cr=new mWe(Ke,ui,ke),et=new MWe(Ke,ui,ke),ke.programs=wn.programs,re.capabilities=Ti,re.extensions=ui,re.properties=de,re.renderLists=Ir,re.shadowMap=Gn,re.state=Vn,re.info=ke}cn(),I!==yo&&(z=new RWe(I,t.width,t.height,r,i));const jt=new vXe(re,Ke);this.xr=jt,this.getContext=function(){return Ke},this.getContextAttributes=function(){return Ke.getContextAttributes()},this.forceContextLoss=function(){const me=ui.get("WEBGL_lose_context");me&&me.loseContext()},this.forceContextRestore=function(){const me=ui.get("WEBGL_lose_context");me&&me.restoreContext()},this.getPixelRatio=function(){return Pt},this.setPixelRatio=function(me){me!==void 0&&(Pt=me,this.setSize(Ne,st,!1))},this.getSize=function(me){return me.set(Ne,st)},this.setSize=function(me,mt,At=!0){if(jt.isPresenting){qt("WebGLRenderer: Can't change size while VR device is presenting.");return}Ne=me,st=mt,t.width=Math.floor(me*Pt),t.height=Math.floor(mt*Pt),At===!0&&(t.style.width=me+"px",t.style.height=mt+"px"),z!==null&&z.setSize(t.width,t.height),this.setViewport(0,0,me,mt)},this.getDrawingBufferSize=function(me){return me.set(Ne*Pt,st*Pt).floor()},this.setDrawingBufferSize=function(me,mt,At){Ne=me,st=mt,Pt=At,t.width=Math.floor(me*At),t.height=Math.floor(mt*At),this.setViewport(0,0,me,mt)},this.setEffects=function(me){if(I===yo){console.error("THREE.WebGLRenderer: setEffects() requires outputBufferType set to HalfFloatType or FloatType.");return}if(me){for(let mt=0;mt<me.length;mt++)if(me[mt].isOutputPass===!0){console.warn("THREE.WebGLRenderer: OutputPass is not needed in setEffects(). Tone mapping and color space conversion are applied automatically.");break}}z.setEffects(me||[])},this.getCurrentViewport=function(me){return me.copy(ce)},this.getViewport=function(me){return me.copy(St)},this.setViewport=function(me,mt,At,wt){me.isVector4?St.set(me.x,me.y,me.z,me.w):St.set(me,mt,At,wt),Vn.viewport(ce.copy(St).multiplyScalar(Pt).round())},this.getScissor=function(me){return me.copy(Ut)},this.setScissor=function(me,mt,At,wt){me.isVector4?Ut.set(me.x,me.y,me.z,me.w):Ut.set(me,mt,At,wt),Vn.scissor(Ve.copy(Ut).multiplyScalar(Pt).round())},this.getScissorTest=function(){return Wt},this.setScissorTest=function(me){Vn.setScissorTest(Wt=me)},this.setOpaqueSort=function(me){yn=me},this.setTransparentSort=function(me){bn=me},this.getClearColor=function(me){return me.copy($n.getClearColor())},this.setClearColor=function(){$n.setClearColor(...arguments)},this.getClearAlpha=function(){return $n.getClearAlpha()},this.setClearAlpha=function(){$n.setClearAlpha(...arguments)},this.clear=function(me=!0,mt=!0,At=!0){let wt=0;if(me){let bt=!1;if(Oe!==null){const Rn=Oe.texture.format;bt=D.has(Rn)}if(bt){const Rn=Oe.texture.type,jn=P.has(Rn),An=$n.getClearColor(),Un=$n.getClearAlpha(),er=An.r,yr=An.g,Zr=An.b;jn?(U[0]=er,U[1]=yr,U[2]=Zr,U[3]=Un,Ke.clearBufferuiv(Ke.COLOR,0,U)):(j[0]=er,j[1]=yr,j[2]=Zr,j[3]=Un,Ke.clearBufferiv(Ke.COLOR,0,j))}else wt|=Ke.COLOR_BUFFER_BIT}mt&&(wt|=Ke.DEPTH_BUFFER_BIT),At&&(wt|=Ke.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),wt!==0&&Ke.clear(wt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Wn,!1),t.removeEventListener("webglcontextrestored",Br,!1),t.removeEventListener("webglcontextcreationerror",Hi,!1),$n.dispose(),Ir.dispose(),en.dispose(),de.dispose(),Xt.dispose(),Qn.dispose(),pn.dispose(),Nn.dispose(),wn.dispose(),jt.dispose(),jt.removeEventListener("sessionstart",Pc),jt.removeEventListener("sessionend",wd),Pl.stop()};function Wn(me){me.preventDefault(),_A("WebGLRenderer: Context Lost."),ye=!0}function Br(){_A("WebGLRenderer: Context Restored."),ye=!1;const me=ke.autoReset,mt=Gn.enabled,At=Gn.autoUpdate,wt=Gn.needsUpdate,bt=Gn.type;cn(),ke.autoReset=me,Gn.enabled=mt,Gn.autoUpdate=At,Gn.needsUpdate=wt,Gn.type=bt}function Hi(me){Ht("WebGLRenderer: A WebGL context could not be created. Reason: ",me.statusMessage)}function Pr(me){const mt=me.target;mt.removeEventListener("dispose",Pr),Ls(mt)}function Ls(me){la(me),de.remove(me)}function la(me){const mt=de.get(me).programs;mt!==void 0&&(mt.forEach(function(At){wn.releaseProgram(At)}),me.isShaderMaterial&&wn.releaseShaderCache(me))}this.renderBufferDirect=function(me,mt,At,wt,bt,Rn){mt===null&&(mt=Kr);const jn=bt.isMesh&&bt.matrixWorld.determinant()<0,An=ca(me,mt,At,wt,bt);Vn.setMaterial(wt,jn);let Un=At.index,er=1;if(wt.wireframe===!0){if(Un=Vt.getWireframeAttribute(At),Un===void 0)return;er=2}const yr=At.drawRange,Zr=At.attributes.position;let xr=yr.start*er,gi=(yr.start+yr.count)*er;Rn!==null&&(xr=Math.max(xr,Rn.start*er),gi=Math.min(gi,(Rn.start+Rn.count)*er)),Un!==null?(xr=Math.max(xr,0),gi=Math.min(gi,Un.count)):Zr!=null&&(xr=Math.max(xr,0),gi=Math.min(gi,Zr.count));const Ui=gi-xr;if(Ui<0||Ui===1/0)return;pn.setup(bt,wt,An,At,Un);let ss,hi=Cr;if(Un!==null&&(ss=Kt.get(Un),hi=et,hi.setIndex(ss)),bt.isMesh)wt.wireframe===!0?(Vn.setLineWidth(wt.wireframeLinewidth*mi()),hi.setMode(Ke.LINES)):hi.setMode(Ke.TRIANGLES);else if(bt.isLine){let $s=wt.linewidth;$s===void 0&&($s=1),Vn.setLineWidth($s*mi()),bt.isLineSegments?hi.setMode(Ke.LINES):bt.isLineLoop?hi.setMode(Ke.LINE_LOOP):hi.setMode(Ke.LINE_STRIP)}else bt.isPoints?hi.setMode(Ke.POINTS):bt.isSprite&&hi.setMode(Ke.TRIANGLES);if(bt.isBatchedMesh)if(bt._multiDrawInstances!==null)es("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),hi.renderMultiDrawInstances(bt._multiDrawStarts,bt._multiDrawCounts,bt._multiDrawCount,bt._multiDrawInstances);else if(ui.get("WEBGL_multi_draw"))hi.renderMultiDraw(bt._multiDrawStarts,bt._multiDrawCounts,bt._multiDrawCount);else{const $s=bt._multiDrawStarts,lr=bt._multiDrawCounts,ua=bt._multiDrawCount,pi=Un?Kt.get(Un).bytesPerElement:1,Ca=de.get(wt).currentProgram.getUniforms();for(let oo=0;oo<ua;oo++)Ca.setValue(Ke,"_gl_DrawID",oo),hi.render($s[oo]/pi,lr[oo])}else if(bt.isInstancedMesh)hi.renderInstances(xr,Ui,bt.count);else if(At.isInstancedBufferGeometry){const $s=At._maxInstanceCount!==void 0?At._maxInstanceCount:1/0,lr=Math.min(At.instanceCount,$s);hi.renderInstances(xr,Ui,lr)}else hi.render(xr,Ui)};function Sd(me,mt,At){me.transparent===!0&&me.side===oa&&me.forceSinglePass===!1?(me.side=bs,me.needsUpdate=!0,Mu(me,mt,At),me.side=Mc,me.needsUpdate=!0,Mu(me,mt,At),me.side=oa):Mu(me,mt,At)}this.compile=function(me,mt,At=null){At===null&&(At=me),Z=en.get(At),Z.init(mt),se.push(Z),At.traverseVisible(function(bt){bt.isLight&&bt.layers.test(mt.layers)&&(Z.pushLight(bt),bt.castShadow&&Z.pushShadow(bt))}),me!==At&&me.traverseVisible(function(bt){bt.isLight&&bt.layers.test(mt.layers)&&(Z.pushLight(bt),bt.castShadow&&Z.pushShadow(bt))}),Z.setupLights();const wt=new Set;return me.traverse(function(bt){if(!(bt.isMesh||bt.isPoints||bt.isLine||bt.isSprite))return;const Rn=bt.material;if(Rn)if(Array.isArray(Rn))for(let jn=0;jn<Rn.length;jn++){const An=Rn[jn];Sd(An,At,bt),wt.add(An)}else Sd(Rn,At,bt),wt.add(Rn)}),Z=se.pop(),wt},this.compileAsync=function(me,mt,At=null){const wt=this.compile(me,mt,At);return new Promise(bt=>{function Rn(){if(wt.forEach(function(jn){de.get(jn).currentProgram.isReady()&&wt.delete(jn)}),wt.size===0){bt(me);return}setTimeout(Rn,10)}ui.get("KHR_parallel_shader_compile")!==null?Rn():setTimeout(Rn,10)})};let u0=null;function Up(me){u0&&u0(me)}function Pc(){Pl.stop()}function wd(){Pl.start()}const Pl=new SSe;Pl.setAnimationLoop(Up),typeof self<"u"&&Pl.setContext(self),this.setAnimationLoop=function(me){u0=me,jt.setAnimationLoop(me),me===null?Pl.stop():Pl.start()},jt.addEventListener("sessionstart",Pc),jt.addEventListener("sessionend",wd),this.render=function(me,mt){if(mt!==void 0&&mt.isCamera!==!0){Ht("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(ye===!0)return;const At=jt.enabled===!0&&jt.isPresenting===!0,wt=z!==null&&(Oe===null||At)&&z.begin(re,Oe);if(me.matrixWorldAutoUpdate===!0&&me.updateMatrixWorld(),mt.parent===null&&mt.matrixWorldAutoUpdate===!0&&mt.updateMatrixWorld(),jt.enabled===!0&&jt.isPresenting===!0&&(z===null||z.isCompositing()===!1)&&(jt.cameraAutoUpdate===!0&&jt.updateCamera(mt),mt=jt.getCamera()),me.isScene===!0&&me.onBeforeRender(re,me,mt,Oe),Z=en.get(me,se.length),Z.init(mt),se.push(Z),ns.multiplyMatrices(mt.projectionMatrix,mt.matrixWorldInverse),kn.setFromProjectionMatrix(ns,Tc,mt.reversedDepth),or=this.localClippingEnabled,Dn=vn.init(this.clippingPlanes,or),C=Ir.get(me,ie.length),C.init(),ie.push(C),jt.enabled===!0&&jt.isPresenting===!0){const jn=re.xr.getDepthSensingMesh();jn!==null&&cl(jn,mt,-1/0,re.sortObjects)}cl(me,mt,0,re.sortObjects),C.finish(),re.sortObjects===!0&&C.sort(yn,bn),Yr=jt.enabled===!1||jt.isPresenting===!1||jt.hasDepthSensing()===!1,Yr&&$n.addToRenderList(C,me),this.info.render.frame++,Dn===!0&&vn.beginShadows();const bt=Z.state.shadowsArray;if(Gn.render(bt,me,mt),Dn===!0&&vn.endShadows(),this.info.autoReset===!0&&this.info.reset(),(wt&&z.hasRenderPass())===!1){const jn=C.opaque,An=C.transmissive;if(Z.setupLights(),mt.isArrayCamera){const Un=mt.cameras;if(An.length>0)for(let er=0,yr=Un.length;er<yr;er++){const Zr=Un[er];_m(jn,An,me,Zr)}Yr&&$n.render(me);for(let er=0,yr=Un.length;er<yr;er++){const Zr=Un[er];wh(C,me,Zr,Zr.viewport)}}else An.length>0&&_m(jn,An,me,mt),Yr&&$n.render(me),wh(C,me,mt)}Oe!==null&&Me===0&&(ht.updateMultisampleRenderTarget(Oe),ht.updateRenderTargetMipmap(Oe)),wt&&z.end(re),me.isScene===!0&&me.onAfterRender(re,me,mt),pn.resetDefaultState(),Ue=-1,Ie=null,se.pop(),se.length>0?(Z=se[se.length-1],Dn===!0&&vn.setGlobalState(re.clippingPlanes,Z.state.camera)):Z=null,ie.pop(),ie.length>0?C=ie[ie.length-1]:C=null};function cl(me,mt,At,wt){if(me.visible===!1)return;if(me.layers.test(mt.layers)){if(me.isGroup)At=me.renderOrder;else if(me.isLOD)me.autoUpdate===!0&&me.update(mt);else if(me.isLight)Z.pushLight(me),me.castShadow&&Z.pushShadow(me);else if(me.isSprite){if(!me.frustumCulled||kn.intersectsSprite(me)){wt&&Vr.setFromMatrixPosition(me.matrixWorld).applyMatrix4(ns);const jn=Qn.update(me),An=me.material;An.visible&&C.push(me,jn,An,At,Vr.z,null)}}else if((me.isMesh||me.isLine||me.isPoints)&&(!me.frustumCulled||kn.intersectsObject(me))){const jn=Qn.update(me),An=me.material;if(wt&&(me.boundingSphere!==void 0?(me.boundingSphere===null&&me.computeBoundingSphere(),Vr.copy(me.boundingSphere.center)):(jn.boundingSphere===null&&jn.computeBoundingSphere(),Vr.copy(jn.boundingSphere.center)),Vr.applyMatrix4(me.matrixWorld).applyMatrix4(ns)),Array.isArray(An)){const Un=jn.groups;for(let er=0,yr=Un.length;er<yr;er++){const Zr=Un[er],xr=An[Zr.materialIndex];xr&&xr.visible&&C.push(me,jn,xr,At,Vr.z,Zr)}}else An.visible&&C.push(me,jn,An,At,Vr.z,null)}}const Rn=me.children;for(let jn=0,An=Rn.length;jn<An;jn++)cl(Rn[jn],mt,At,wt)}function wh(me,mt,At,wt){const{opaque:bt,transmissive:Rn,transparent:jn}=me;Z.setupLightsView(At),Dn===!0&&vn.setGlobalState(re.clippingPlanes,At),wt&&Vn.viewport(ce.copy(wt)),bt.length>0&&Th(bt,mt,At),Rn.length>0&&Th(Rn,mt,At),jn.length>0&&Th(jn,mt,At),Vn.buffers.depth.setTest(!0),Vn.buffers.depth.setMask(!0),Vn.buffers.color.setMask(!0),Vn.setPolygonOffset(!1)}function _m(me,mt,At,wt){if((At.isScene===!0?At.overrideMaterial:null)!==null)return;if(Z.state.transmissionRenderTarget[wt.id]===void 0){const xr=ui.has("EXT_color_buffer_half_float")||ui.has("EXT_color_buffer_float");Z.state.transmissionRenderTarget[wt.id]=new hm(1,1,{generateMipmaps:!0,type:xr?ro:yo,minFilter:fd,samples:Ti.samples,stencilBuffer:i,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Zn.workingColorSpace})}const Rn=Z.state.transmissionRenderTarget[wt.id],jn=wt.viewport||ce;Rn.setSize(jn.z*re.transmissionResolutionScale,jn.w*re.transmissionResolutionScale);const An=re.getRenderTarget(),Un=re.getActiveCubeFace(),er=re.getActiveMipmapLevel();re.setRenderTarget(Rn),re.getClearColor(We),pt=re.getClearAlpha(),pt<1&&re.setClearColor(16777215,.5),re.clear(),Yr&&$n.render(At);const yr=re.toneMapping;re.toneMapping=Ta;const Zr=wt.viewport;if(wt.viewport!==void 0&&(wt.viewport=void 0),Z.setupLightsView(wt),Dn===!0&&vn.setGlobalState(re.clippingPlanes,wt),Th(me,At,wt),ht.updateMultisampleRenderTarget(Rn),ht.updateRenderTargetMipmap(Rn),ui.has("WEBGL_multisampled_render_to_texture")===!1){let xr=!1;for(let gi=0,Ui=mt.length;gi<Ui;gi++){const ss=mt[gi],{object:hi,geometry:$s,material:lr,group:ua}=ss;if(lr.side===oa&&hi.layers.test(wt.layers)){const pi=lr.side;lr.side=bs,lr.needsUpdate=!0,$o(hi,At,wt,$s,lr,ua),lr.side=pi,lr.needsUpdate=!0,xr=!0}}xr===!0&&(ht.updateMultisampleRenderTarget(Rn),ht.updateRenderTargetMipmap(Rn))}re.setRenderTarget(An,Un,er),re.setClearColor(We,pt),Zr!==void 0&&(wt.viewport=Zr),re.toneMapping=yr}function Th(me,mt,At){const wt=mt.isScene===!0?mt.overrideMaterial:null;for(let bt=0,Rn=me.length;bt<Rn;bt++){const jn=me[bt],{object:An,geometry:Un,group:er}=jn;let yr=jn.material;yr.allowOverride===!0&&wt!==null&&(yr=wt),An.layers.test(At.layers)&&$o(An,mt,At,Un,yr,er)}}function $o(me,mt,At,wt,bt,Rn){me.onBeforeRender(re,mt,At,wt,bt,Rn),me.modelViewMatrix.multiplyMatrices(At.matrixWorldInverse,me.matrixWorld),me.normalMatrix.getNormalMatrix(me.modelViewMatrix),bt.onBeforeRender(re,mt,At,wt,me,Rn),bt.transparent===!0&&bt.side===oa&&bt.forceSinglePass===!1?(bt.side=bs,bt.needsUpdate=!0,re.renderBufferDirect(At,mt,wt,bt,me,Rn),bt.side=Mc,bt.needsUpdate=!0,re.renderBufferDirect(At,mt,wt,bt,me,Rn),bt.side=oa):re.renderBufferDirect(At,mt,wt,bt,me,Rn),me.onAfterRender(re,mt,At,wt,bt,Rn)}function Mu(me,mt,At){mt.isScene!==!0&&(mt=Kr);const wt=de.get(me),bt=Z.state.lights,Rn=Z.state.shadowsArray,jn=bt.state.version,An=wn.getParameters(me,bt.state,Rn,mt,At),Un=wn.getProgramCacheKey(An);let er=wt.programs;wt.environment=me.isMeshStandardMaterial||me.isMeshLambertMaterial||me.isMeshPhongMaterial?mt.environment:null,wt.fog=mt.fog;const yr=me.isMeshStandardMaterial||me.isMeshLambertMaterial&&!me.envMap||me.isMeshPhongMaterial&&!me.envMap;wt.envMap=Xt.get(me.envMap||wt.environment,yr),wt.envMapRotation=wt.environment!==null&&me.envMap===null?mt.environmentRotation:me.envMapRotation,er===void 0&&(me.addEventListener("dispose",Pr),er=new Map,wt.programs=er);let Zr=er.get(Un);if(Zr!==void 0){if(wt.currentProgram===Zr&&wt.lightsStateVersion===jn)return Td(me,An),Zr}else An.uniforms=wn.getUniforms(me),me.onBeforeCompile(An,re),Zr=wn.acquireProgram(An,Un),er.set(Un,Zr),wt.uniforms=An.uniforms;const xr=wt.uniforms;return(!me.isShaderMaterial&&!me.isRawShaderMaterial||me.clipping===!0)&&(xr.clippingPlanes=vn.uniform),Td(me,An),wt.needsLights=Sm(me),wt.lightsStateVersion=jn,wt.needsLights&&(xr.ambientLightColor.value=bt.state.ambient,xr.lightProbe.value=bt.state.probe,xr.directionalLights.value=bt.state.directional,xr.directionalLightShadows.value=bt.state.directionalShadow,xr.spotLights.value=bt.state.spot,xr.spotLightShadows.value=bt.state.spotShadow,xr.rectAreaLights.value=bt.state.rectArea,xr.ltc_1.value=bt.state.rectAreaLTC1,xr.ltc_2.value=bt.state.rectAreaLTC2,xr.pointLights.value=bt.state.point,xr.pointLightShadows.value=bt.state.pointShadow,xr.hemisphereLights.value=bt.state.hemi,xr.directionalShadowMatrix.value=bt.state.directionalShadowMatrix,xr.spotLightMatrix.value=bt.state.spotLightMatrix,xr.spotLightMap.value=bt.state.spotLightMap,xr.pointShadowMatrix.value=bt.state.pointShadowMatrix),wt.currentProgram=Zr,wt.uniformsList=null,Zr}function Rc(me){if(me.uniformsList===null){const mt=me.currentProgram.getUniforms();me.uniformsList=$L.seqWithValue(mt.seq,me.uniforms)}return me.uniformsList}function Td(me,mt){const At=de.get(me);At.outputColorSpace=mt.outputColorSpace,At.batching=mt.batching,At.batchingColor=mt.batchingColor,At.instancing=mt.instancing,At.instancingColor=mt.instancingColor,At.instancingMorph=mt.instancingMorph,At.skinning=mt.skinning,At.morphTargets=mt.morphTargets,At.morphNormals=mt.morphNormals,At.morphColors=mt.morphColors,At.morphTargetsCount=mt.morphTargetsCount,At.numClippingPlanes=mt.numClippingPlanes,At.numIntersection=mt.numClipIntersection,At.vertexAlphas=mt.vertexAlphas,At.vertexTangents=mt.vertexTangents,At.toneMapping=mt.toneMapping}function ca(me,mt,At,wt,bt){mt.isScene!==!0&&(mt=Kr),ht.resetTextureUnits();const Rn=mt.fog,jn=wt.isMeshStandardMaterial||wt.isMeshLambertMaterial||wt.isMeshPhongMaterial?mt.environment:null,An=Oe===null?re.outputColorSpace:Oe.isXRRenderTarget===!0?Oe.texture.colorSpace:vd,Un=wt.isMeshStandardMaterial||wt.isMeshLambertMaterial&&!wt.envMap||wt.isMeshPhongMaterial&&!wt.envMap,er=Xt.get(wt.envMap||jn,Un),yr=wt.vertexColors===!0&&!!At.attributes.color&&At.attributes.color.itemSize===4,Zr=!!At.attributes.tangent&&(!!wt.normalMap||wt.anisotropy>0),xr=!!At.morphAttributes.position,gi=!!At.morphAttributes.normal,Ui=!!At.morphAttributes.color;let ss=Ta;wt.toneMapped&&(Oe===null||Oe.isXRRenderTarget===!0)&&(ss=re.toneMapping);const hi=At.morphAttributes.position||At.morphAttributes.normal||At.morphAttributes.color,$s=hi!==void 0?hi.length:0,lr=de.get(wt),ua=Z.state.lights;if(Dn===!0&&(or===!0||me!==Ie)){const As=me===Ie&&wt.id===Ue;vn.setState(wt,me,As)}let pi=!1;wt.version===lr.__version?(lr.needsLights&&lr.lightsStateVersion!==ua.state.version||lr.outputColorSpace!==An||bt.isBatchedMesh&&lr.batching===!1||!bt.isBatchedMesh&&lr.batching===!0||bt.isBatchedMesh&&lr.batchingColor===!0&&bt.colorTexture===null||bt.isBatchedMesh&&lr.batchingColor===!1&&bt.colorTexture!==null||bt.isInstancedMesh&&lr.instancing===!1||!bt.isInstancedMesh&&lr.instancing===!0||bt.isSkinnedMesh&&lr.skinning===!1||!bt.isSkinnedMesh&&lr.skinning===!0||bt.isInstancedMesh&&lr.instancingColor===!0&&bt.instanceColor===null||bt.isInstancedMesh&&lr.instancingColor===!1&&bt.instanceColor!==null||bt.isInstancedMesh&&lr.instancingMorph===!0&&bt.morphTexture===null||bt.isInstancedMesh&&lr.instancingMorph===!1&&bt.morphTexture!==null||lr.envMap!==er||wt.fog===!0&&lr.fog!==Rn||lr.numClippingPlanes!==void 0&&(lr.numClippingPlanes!==vn.numPlanes||lr.numIntersection!==vn.numIntersection)||lr.vertexAlphas!==yr||lr.vertexTangents!==Zr||lr.morphTargets!==xr||lr.morphNormals!==gi||lr.morphColors!==Ui||lr.toneMapping!==ss||lr.morphTargetsCount!==$s)&&(pi=!0):(pi=!0,lr.__version=wt.version);let Ca=lr.currentProgram;pi===!0&&(Ca=Mu(wt,mt,bt));let oo=!1,Wo=!1,Cu=!1;const Ai=Ca.getUniforms(),Ur=lr.uniforms;if(Vn.useProgram(Ca.program)&&(oo=!0,Wo=!0,Cu=!0),wt.id!==Ue&&(Ue=wt.id,Wo=!0),oo||Ie!==me){Vn.buffers.depth.getReversed()&&me.reversedDepth!==!0&&(me._reversedDepth=!0,me.updateProjectionMatrix()),Ai.setValue(Ke,"projectionMatrix",me.projectionMatrix),Ai.setValue(Ke,"viewMatrix",me.matrixWorldInverse);const Rl=Ai.map.cameraPosition;Rl!==void 0&&Rl.setValue(Ke,Xr.setFromMatrixPosition(me.matrixWorld)),Ti.logarithmicDepthBuffer&&Ai.setValue(Ke,"logDepthBufFC",2/(Math.log(me.far+1)/Math.LN2)),(wt.isMeshPhongMaterial||wt.isMeshToonMaterial||wt.isMeshLambertMaterial||wt.isMeshBasicMaterial||wt.isMeshStandardMaterial||wt.isShaderMaterial)&&Ai.setValue(Ke,"isOrthographic",me.isOrthographicCamera===!0),Ie!==me&&(Ie=me,Wo=!0,Cu=!0)}if(lr.needsLights&&(ua.state.directionalShadowMap.length>0&&Ai.setValue(Ke,"directionalShadowMap",ua.state.directionalShadowMap,ht),ua.state.spotShadowMap.length>0&&Ai.setValue(Ke,"spotShadowMap",ua.state.spotShadowMap,ht),ua.state.pointShadowMap.length>0&&Ai.setValue(Ke,"pointShadowMap",ua.state.pointShadowMap,ht)),bt.isSkinnedMesh){Ai.setOptional(Ke,bt,"bindMatrix"),Ai.setOptional(Ke,bt,"bindMatrixInverse");const As=bt.skeleton;As&&(As.boneTexture===null&&As.computeBoneTexture(),Ai.setValue(Ke,"boneTexture",As.boneTexture,ht))}bt.isBatchedMesh&&(Ai.setOptional(Ke,bt,"batchingTexture"),Ai.setValue(Ke,"batchingTexture",bt._matricesTexture,ht),Ai.setOptional(Ke,bt,"batchingIdTexture"),Ai.setValue(Ke,"batchingIdTexture",bt._indirectTexture,ht),Ai.setOptional(Ke,bt,"batchingColorTexture"),bt._colorsTexture!==null&&Ai.setValue(Ke,"batchingColorTexture",bt._colorsTexture,ht));const qo=At.morphAttributes;if((qo.position!==void 0||qo.normal!==void 0||qo.color!==void 0)&&Bn.update(bt,At,Ca),(Wo||lr.receiveShadow!==bt.receiveShadow)&&(lr.receiveShadow=bt.receiveShadow,Ai.setValue(Ke,"receiveShadow",bt.receiveShadow)),(wt.isMeshStandardMaterial||wt.isMeshLambertMaterial||wt.isMeshPhongMaterial)&&wt.envMap===null&&mt.environment!==null&&(Ur.envMapIntensity.value=mt.environmentIntensity),Ur.dfgLUT!==void 0&&(Ur.dfgLUT.value=wXe()),Wo&&(Ai.setValue(Ke,"toneMappingExposure",re.toneMappingExposure),lr.needsLights&&ul(Ur,Cu),Rn&&wt.fog===!0&&ar.refreshFogUniforms(Ur,Rn),ar.refreshMaterialUniforms(Ur,wt,Pt,st,Z.state.transmissionRenderTarget[me.id]),$L.upload(Ke,Rc(lr),Ur,ht)),wt.isShaderMaterial&&wt.uniformsNeedUpdate===!0&&($L.upload(Ke,Rc(lr),Ur,ht),wt.uniformsNeedUpdate=!1),wt.isSpriteMaterial&&Ai.setValue(Ke,"center",bt.center),Ai.setValue(Ke,"modelViewMatrix",bt.modelViewMatrix),Ai.setValue(Ke,"normalMatrix",bt.normalMatrix),Ai.setValue(Ke,"modelMatrix",bt.matrixWorld),wt.isShaderMaterial||wt.isRawShaderMaterial){const As=wt.uniformsGroups;for(let Rl=0,Wa=As.length;Rl<Wa;Rl++){const Mh=As[Rl];Nn.update(Mh,Ca),Nn.bind(Mh,Ca)}}return Ca}function ul(me,mt){me.ambientLightColor.needsUpdate=mt,me.lightProbe.needsUpdate=mt,me.directionalLights.needsUpdate=mt,me.directionalLightShadows.needsUpdate=mt,me.pointLights.needsUpdate=mt,me.pointLightShadows.needsUpdate=mt,me.spotLights.needsUpdate=mt,me.spotLightShadows.needsUpdate=mt,me.rectAreaLights.needsUpdate=mt,me.hemisphereLights.needsUpdate=mt}function Sm(me){return me.isMeshLambertMaterial||me.isMeshToonMaterial||me.isMeshPhongMaterial||me.isMeshStandardMaterial||me.isShadowMaterial||me.isShaderMaterial&&me.lights===!0}this.getActiveCubeFace=function(){return H},this.getActiveMipmapLevel=function(){return Me},this.getRenderTarget=function(){return Oe},this.setRenderTargetTextures=function(me,mt,At){const wt=de.get(me);wt.__autoAllocateDepthBuffer=me.resolveDepthBuffer===!1,wt.__autoAllocateDepthBuffer===!1&&(wt.__useRenderToTexture=!1),de.get(me.texture).__webglTexture=mt,de.get(me.depthTexture).__webglTexture=wt.__autoAllocateDepthBuffer?void 0:At,wt.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(me,mt){const At=de.get(me);At.__webglFramebuffer=mt,At.__useDefaultFramebuffer=mt===void 0};const Eh=Ke.createFramebuffer();this.setRenderTarget=function(me,mt=0,At=0){Oe=me,H=mt,Me=At;let wt=null,bt=!1,Rn=!1;if(me){const An=de.get(me);if(An.__useDefaultFramebuffer!==void 0){Vn.bindFramebuffer(Ke.FRAMEBUFFER,An.__webglFramebuffer),ce.copy(me.viewport),Ve.copy(me.scissor),Pe=me.scissorTest,Vn.viewport(ce),Vn.scissor(Ve),Vn.setScissorTest(Pe),Ue=-1;return}else if(An.__webglFramebuffer===void 0)ht.setupRenderTarget(me);else if(An.__hasExternalTextures)ht.rebindTextures(me,de.get(me.texture).__webglTexture,de.get(me.depthTexture).__webglTexture);else if(me.depthBuffer){const yr=me.depthTexture;if(An.__boundDepthTexture!==yr){if(yr!==null&&de.has(yr)&&(me.width!==yr.image.width||me.height!==yr.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ht.setupDepthRenderbuffer(me)}}const Un=me.texture;(Un.isData3DTexture||Un.isDataArrayTexture||Un.isCompressedArrayTexture)&&(Rn=!0);const er=de.get(me).__webglFramebuffer;me.isWebGLCubeRenderTarget?(Array.isArray(er[mt])?wt=er[mt][At]:wt=er[mt],bt=!0):me.samples>0&&ht.useMultisampledRTT(me)===!1?wt=de.get(me).__webglMultisampledFramebuffer:Array.isArray(er)?wt=er[At]:wt=er,ce.copy(me.viewport),Ve.copy(me.scissor),Pe=me.scissorTest}else ce.copy(St).multiplyScalar(Pt).floor(),Ve.copy(Ut).multiplyScalar(Pt).floor(),Pe=Wt;if(At!==0&&(wt=Eh),Vn.bindFramebuffer(Ke.FRAMEBUFFER,wt)&&Vn.drawBuffers(me,wt),Vn.viewport(ce),Vn.scissor(Ve),Vn.setScissorTest(Pe),bt){const An=de.get(me.texture);Ke.framebufferTexture2D(Ke.FRAMEBUFFER,Ke.COLOR_ATTACHMENT0,Ke.TEXTURE_CUBE_MAP_POSITIVE_X+mt,An.__webglTexture,At)}else if(Rn){const An=mt;for(let Un=0;Un<me.textures.length;Un++){const er=de.get(me.textures[Un]);Ke.framebufferTextureLayer(Ke.FRAMEBUFFER,Ke.COLOR_ATTACHMENT0+Un,er.__webglTexture,At,An)}}else if(me!==null&&At!==0){const An=de.get(me.texture);Ke.framebufferTexture2D(Ke.FRAMEBUFFER,Ke.COLOR_ATTACHMENT0,Ke.TEXTURE_2D,An.__webglTexture,At)}Ue=-1},this.readRenderTargetPixels=function(me,mt,At,wt,bt,Rn,jn,An=0){if(!(me&&me.isWebGLRenderTarget)){Ht("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Un=de.get(me).__webglFramebuffer;if(me.isWebGLCubeRenderTarget&&jn!==void 0&&(Un=Un[jn]),Un){Vn.bindFramebuffer(Ke.FRAMEBUFFER,Un);try{const er=me.textures[An],yr=er.format,Zr=er.type;if(me.textures.length>1&&Ke.readBuffer(Ke.COLOR_ATTACHMENT0+An),!Ti.textureFormatReadable(yr)){Ht("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ti.textureTypeReadable(Zr)){Ht("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}mt>=0&&mt<=me.width-wt&&At>=0&&At<=me.height-bt&&Ke.readPixels(mt,At,wt,bt,_n.convert(yr),_n.convert(Zr),Rn)}finally{const er=Oe!==null?de.get(Oe).__webglFramebuffer:null;Vn.bindFramebuffer(Ke.FRAMEBUFFER,er)}}},this.readRenderTargetPixelsAsync=async function(me,mt,At,wt,bt,Rn,jn,An=0){if(!(me&&me.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Un=de.get(me).__webglFramebuffer;if(me.isWebGLCubeRenderTarget&&jn!==void 0&&(Un=Un[jn]),Un)if(mt>=0&&mt<=me.width-wt&&At>=0&&At<=me.height-bt){Vn.bindFramebuffer(Ke.FRAMEBUFFER,Un);const er=me.textures[An],yr=er.format,Zr=er.type;if(me.textures.length>1&&Ke.readBuffer(Ke.COLOR_ATTACHMENT0+An),!Ti.textureFormatReadable(yr))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ti.textureTypeReadable(Zr))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const xr=Ke.createBuffer();Ke.bindBuffer(Ke.PIXEL_PACK_BUFFER,xr),Ke.bufferData(Ke.PIXEL_PACK_BUFFER,Rn.byteLength,Ke.STREAM_READ),Ke.readPixels(mt,At,wt,bt,_n.convert(yr),_n.convert(Zr),0);const gi=Oe!==null?de.get(Oe).__webglFramebuffer:null;Vn.bindFramebuffer(Ke.FRAMEBUFFER,gi);const Ui=Ke.fenceSync(Ke.SYNC_GPU_COMMANDS_COMPLETE,0);return Ke.flush(),await EVe(Ke,Ui,4),Ke.bindBuffer(Ke.PIXEL_PACK_BUFFER,xr),Ke.getBufferSubData(Ke.PIXEL_PACK_BUFFER,0,Rn),Ke.deleteBuffer(xr),Ke.deleteSync(Ui),Rn}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(me,mt=null,At=0){const wt=Math.pow(2,-At),bt=Math.floor(me.image.width*wt),Rn=Math.floor(me.image.height*wt),jn=mt!==null?mt.x:0,An=mt!==null?mt.y:0;ht.setTexture2D(me,0),Ke.copyTexSubImage2D(Ke.TEXTURE_2D,At,0,0,jn,An,bt,Rn),Vn.unbindTexture()};const wm=Ke.createFramebuffer(),Tm=Ke.createFramebuffer();this.copyTextureToTexture=function(me,mt,At=null,wt=null,bt=0,Rn=0){let jn,An,Un,er,yr,Zr,xr,gi,Ui;const ss=me.isCompressedTexture?me.mipmaps[Rn]:me.image;if(At!==null)jn=At.max.x-At.min.x,An=At.max.y-At.min.y,Un=At.isBox3?At.max.z-At.min.z:1,er=At.min.x,yr=At.min.y,Zr=At.isBox3?At.min.z:0;else{const Ur=Math.pow(2,-bt);jn=Math.floor(ss.width*Ur),An=Math.floor(ss.height*Ur),me.isDataArrayTexture?Un=ss.depth:me.isData3DTexture?Un=Math.floor(ss.depth*Ur):Un=1,er=0,yr=0,Zr=0}wt!==null?(xr=wt.x,gi=wt.y,Ui=wt.z):(xr=0,gi=0,Ui=0);const hi=_n.convert(mt.format),$s=_n.convert(mt.type);let lr;mt.isData3DTexture?(ht.setTexture3D(mt,0),lr=Ke.TEXTURE_3D):mt.isDataArrayTexture||mt.isCompressedArrayTexture?(ht.setTexture2DArray(mt,0),lr=Ke.TEXTURE_2D_ARRAY):(ht.setTexture2D(mt,0),lr=Ke.TEXTURE_2D),Ke.pixelStorei(Ke.UNPACK_FLIP_Y_WEBGL,mt.flipY),Ke.pixelStorei(Ke.UNPACK_PREMULTIPLY_ALPHA_WEBGL,mt.premultiplyAlpha),Ke.pixelStorei(Ke.UNPACK_ALIGNMENT,mt.unpackAlignment);const ua=Ke.getParameter(Ke.UNPACK_ROW_LENGTH),pi=Ke.getParameter(Ke.UNPACK_IMAGE_HEIGHT),Ca=Ke.getParameter(Ke.UNPACK_SKIP_PIXELS),oo=Ke.getParameter(Ke.UNPACK_SKIP_ROWS),Wo=Ke.getParameter(Ke.UNPACK_SKIP_IMAGES);Ke.pixelStorei(Ke.UNPACK_ROW_LENGTH,ss.width),Ke.pixelStorei(Ke.UNPACK_IMAGE_HEIGHT,ss.height),Ke.pixelStorei(Ke.UNPACK_SKIP_PIXELS,er),Ke.pixelStorei(Ke.UNPACK_SKIP_ROWS,yr),Ke.pixelStorei(Ke.UNPACK_SKIP_IMAGES,Zr);const Cu=me.isDataArrayTexture||me.isData3DTexture,Ai=mt.isDataArrayTexture||mt.isData3DTexture;if(me.isDepthTexture){const Ur=de.get(me),qo=de.get(mt),As=de.get(Ur.__renderTarget),Rl=de.get(qo.__renderTarget);Vn.bindFramebuffer(Ke.READ_FRAMEBUFFER,As.__webglFramebuffer),Vn.bindFramebuffer(Ke.DRAW_FRAMEBUFFER,Rl.__webglFramebuffer);for(let Wa=0;Wa<Un;Wa++)Cu&&(Ke.framebufferTextureLayer(Ke.READ_FRAMEBUFFER,Ke.COLOR_ATTACHMENT0,de.get(me).__webglTexture,bt,Zr+Wa),Ke.framebufferTextureLayer(Ke.DRAW_FRAMEBUFFER,Ke.COLOR_ATTACHMENT0,de.get(mt).__webglTexture,Rn,Ui+Wa)),Ke.blitFramebuffer(er,yr,jn,An,xr,gi,jn,An,Ke.DEPTH_BUFFER_BIT,Ke.NEAREST);Vn.bindFramebuffer(Ke.READ_FRAMEBUFFER,null),Vn.bindFramebuffer(Ke.DRAW_FRAMEBUFFER,null)}else if(bt!==0||me.isRenderTargetTexture||de.has(me)){const Ur=de.get(me),qo=de.get(mt);Vn.bindFramebuffer(Ke.READ_FRAMEBUFFER,wm),Vn.bindFramebuffer(Ke.DRAW_FRAMEBUFFER,Tm);for(let As=0;As<Un;As++)Cu?Ke.framebufferTextureLayer(Ke.READ_FRAMEBUFFER,Ke.COLOR_ATTACHMENT0,Ur.__webglTexture,bt,Zr+As):Ke.framebufferTexture2D(Ke.READ_FRAMEBUFFER,Ke.COLOR_ATTACHMENT0,Ke.TEXTURE_2D,Ur.__webglTexture,bt),Ai?Ke.framebufferTextureLayer(Ke.DRAW_FRAMEBUFFER,Ke.COLOR_ATTACHMENT0,qo.__webglTexture,Rn,Ui+As):Ke.framebufferTexture2D(Ke.DRAW_FRAMEBUFFER,Ke.COLOR_ATTACHMENT0,Ke.TEXTURE_2D,qo.__webglTexture,Rn),bt!==0?Ke.blitFramebuffer(er,yr,jn,An,xr,gi,jn,An,Ke.COLOR_BUFFER_BIT,Ke.NEAREST):Ai?Ke.copyTexSubImage3D(lr,Rn,xr,gi,Ui+As,er,yr,jn,An):Ke.copyTexSubImage2D(lr,Rn,xr,gi,er,yr,jn,An);Vn.bindFramebuffer(Ke.READ_FRAMEBUFFER,null),Vn.bindFramebuffer(Ke.DRAW_FRAMEBUFFER,null)}else Ai?me.isDataTexture||me.isData3DTexture?Ke.texSubImage3D(lr,Rn,xr,gi,Ui,jn,An,Un,hi,$s,ss.data):mt.isCompressedArrayTexture?Ke.compressedTexSubImage3D(lr,Rn,xr,gi,Ui,jn,An,Un,hi,ss.data):Ke.texSubImage3D(lr,Rn,xr,gi,Ui,jn,An,Un,hi,$s,ss):me.isDataTexture?Ke.texSubImage2D(Ke.TEXTURE_2D,Rn,xr,gi,jn,An,hi,$s,ss.data):me.isCompressedTexture?Ke.compressedTexSubImage2D(Ke.TEXTURE_2D,Rn,xr,gi,ss.width,ss.height,hi,ss.data):Ke.texSubImage2D(Ke.TEXTURE_2D,Rn,xr,gi,jn,An,hi,$s,ss);Ke.pixelStorei(Ke.UNPACK_ROW_LENGTH,ua),Ke.pixelStorei(Ke.UNPACK_IMAGE_HEIGHT,pi),Ke.pixelStorei(Ke.UNPACK_SKIP_PIXELS,Ca),Ke.pixelStorei(Ke.UNPACK_SKIP_ROWS,oo),Ke.pixelStorei(Ke.UNPACK_SKIP_IMAGES,Wo),Rn===0&&mt.generateMipmaps&&Ke.generateMipmap(lr),Vn.unbindTexture()},this.initRenderTarget=function(me){de.get(me).__webglFramebuffer===void 0&&ht.setupRenderTarget(me)},this.initTexture=function(me){me.isCubeTexture?ht.setTextureCube(me,0):me.isData3DTexture?ht.setTexture3D(me,0):me.isDataArrayTexture||me.isCompressedArrayTexture?ht.setTexture2DArray(me,0):ht.setTexture2D(me,0),Vn.unbindTexture()},this.resetState=function(){H=0,Me=0,Oe=null,Vn.reset(),pn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Tc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Zn._getDrawingBufferColorSpace(e),t.unpackColorSpace=Zn._getUnpackColorSpace()}}const Iq=!0,kq=document.location.hash.search("editor")>-1;var hF=(s=>(s.LOAD_COMPLETE="Events::loadComplete",s))(hF||{});const zY=new _d;function Dq(s,e,t,n){return new(t||(t=Promise))(function(r,i){function o(h){try{c(n.next(h))}catch(m){i(m)}}function l(h){try{c(n.throw(h))}catch(m){i(m)}}function c(h){var m;h.done?r(h.value):(m=h.value,m instanceof t?m:new t(function(y){y(m)})).then(o,l)}c((n=n.apply(s,[])).next())})}const TXe=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function cxe(s){return s=s.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const ASe=typeof window>"u",lg=(()=>{if(ASe)return;const{userAgent:s,platform:e,maxTouchPoints:t}=window.navigator,n=/(iphone|ipod|ipad)/i.test(s),r=e==="iPad"||e==="MacIntel"&&t>0&&!window.MSStream;return{isIpad:r,isMobile:/android/i.test(s)||n||r,isSafari12:/Version\/12.+Safari/.test(s),isFirefox:/Firefox/.test(s)}})();function EXe(s,e,t){if(!t)return[e];const n=function(h){const m=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,y=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,b=h.createShader(35633),w=h.createShader(35632),A=h.createProgram();if(!(w&&b&&A))return;h.shaderSource(b,m),h.shaderSource(w,y),h.compileShader(b),h.compileShader(w),h.attachShader(A,b),h.attachShader(A,w),h.linkProgram(A),h.detachShader(A,b),h.detachShader(A,w),h.deleteShader(b),h.deleteShader(w),h.useProgram(A);const I=h.createBuffer();h.bindBuffer(34962,I),h.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const D=h.getAttribLocation(A,"aPosition");h.vertexAttribPointer(D,3,5126,!1,0,0),h.enableVertexAttribArray(D),h.clearColor(1,1,1,1),h.clear(16384),h.viewport(0,0,1,1),h.drawArrays(4,0,3);const P=new Uint8Array(4);return h.readPixels(0,0,1,1,6408,5121,P),h.deleteProgram(A),h.deleteBuffer(I),P.join("")}(s),r="801621810",i="8016218135",o="80162181161",l=lg!=null&&lg.isIpad?[["a7",o,12],["a8",i,15],["a8x",i,15],["a9",i,15],["a9x",i,15],["a10",i,15],["a10x",i,15],["a12",r,15],["a12x",r,15],["a12z",r,15],["a14",r,15],["a15",r,15],["m1",r,15],["m2",r,15]]:[["a7",o,12],["a8",i,12],["a9",i,15],["a10",i,15],["a11",r,15],["a12",r,15],["a13",r,15],["a14",r,15],["a15",r,15],["a16",r,15],["a17",r,15]];let c;return n==="80162181255"?c=l.filter(([,,h])=>h>=14):(c=l.filter(([,h])=>h===n),c.length||(c=l)),c.map(([h])=>`apple ${h} gpu`)}let uxe=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};const Oq=[],dxe=[];function MXe(s,e){if(s===e)return 0;const t=s;s.length>e.length&&(s=e,e=t);let n=s.length,r=e.length;for(;n>0&&s.charCodeAt(~-n)===e.charCodeAt(~-r);)n--,r--;let i,o=0;for(;o<n&&s.charCodeAt(o)===e.charCodeAt(o);)o++;if(n-=o,r-=o,n===0)return r;let l,c,h=0,m=0,y=0;for(;m<n;)dxe[m]=s.charCodeAt(o+m),Oq[m]=++m;for(;y<r;)for(i=e.charCodeAt(o+y),l=y++,h=y,m=0;m<n;m++)c=i===dxe[m]?l:l+1,l=Oq[m],h=Oq[m]=l>h?c>h?h+1:c:c>l?l+1:c;return h}function CXe(s){return s!=null}const AXe=({mobileTiers:s=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:t={},glContext:n,failIfMajorPerformanceCaveat:r=!1,benchmarksURL:i="https://unpkg.com/detect-gpu@5.0.70/dist/benchmarks"}={})=>Dq(void 0,void 0,void 0,function*(){const o={};if(ASe)return{tier:0,type:"SSR"};const{isIpad:l=!!(lg!=null&&lg.isIpad),isMobile:c=!!(lg!=null&&lg.isMobile),screenSize:h=window.screen,loadBenchmarks:m=Z=>Dq(void 0,void 0,void 0,function*(){const ie=yield fetch(`${i}/${Z}`).then(se=>se.json());if(parseInt(ie.shift().split(".")[0],10)<4)throw new uxe("Detect GPU benchmark data is out of date. Please update to version 4x");return ie})}=t;let{renderer:y}=t;const b=(Z,ie,se,z,re)=>({device:re,fps:z,gpu:se,isMobile:c,tier:Z,type:ie});let w,A="";if(y)y=cxe(y),w=[y];else{const Z=n||function(se,z=!1){const re={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:z,powerPreference:"high-performance",stencil:!1};se&&delete re.powerPreference;const ye=window.document.createElement("canvas"),H=ye.getContext("webgl",re)||ye.getContext("experimental-webgl",re);return H??void 0}(lg==null?void 0:lg.isSafari12,r);if(!Z)return b(0,"WEBGL_UNSUPPORTED");const ie=lg!=null&&lg.isFirefox?null:Z.getExtension("WEBGL_debug_renderer_info");if(y=ie?Z.getParameter(ie.UNMASKED_RENDERER_WEBGL):Z.getParameter(Z.RENDERER),!y)return b(1,"FALLBACK");A=y,y=cxe(y),w=function(se,z,re){return z==="apple gpu"?EXe(se,z,re):[z]}(Z,y,c)}const I=(yield Promise.all(w.map(function(Z){var ie;return Dq(this,void 0,void 0,function*(){const se=(Pt=>{const yn=c?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const bn of yn)if(Pt.includes(bn))return bn})(Z);if(!se)return;const z=`${c?"m":"d"}-${se}${l?"-ipad":""}.json`,re=o[z]=(ie=o[z])!==null&&ie!==void 0?ie:m(z);let ye;try{ye=yield re}catch(Pt){if(Pt instanceof uxe)throw Pt;return}const H=function(Pt){var yn;const bn=(Pt=Pt.replace(/\([^)]+\)/,"")).match(/\d+/)||Pt.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(yn=bn==null?void 0:bn.join("").replace(/\W|amd/g,""))!==null&&yn!==void 0?yn:""}(Z);let Me=ye.filter(([,Pt])=>Pt===H);Me.length||(Me=ye.filter(([Pt])=>Pt.includes(Z)));const Oe=Me.length;if(Oe===0)return;const Ue=Z.split(/[.,()\[\]/\s]/g).sort().filter((Pt,yn,bn)=>yn===0||Pt!==bn[yn-1]).join(" ");let Ie,[ce,,,,Ve]=Oe>1?Me.map(Pt=>[Pt,MXe(Ue,Pt[2])]).sort(([,Pt],[,yn])=>Pt-yn)[0][0]:Me[0],Pe=Number.MAX_VALUE;const{devicePixelRatio:We}=window,pt=h.width*We*h.height*We;for(const Pt of Ve){const[yn,bn]=Pt,St=yn*bn,Ut=Math.abs(pt-St);Ut<Pe&&(Pe=Ut,Ie=Pt)}if(!Ie)return;const[,,Ne,st]=Ie;return[Pe,Ne,ce,st]})}))).filter(CXe).sort(([Z=Number.MAX_VALUE,ie],[se=Number.MAX_VALUE,z])=>Z===se?ie-z:Z-se);if(!I.length){const Z=TXe.find(ie=>y.includes(ie));return Z?b(0,"BLOCKLISTED",Z):b(1,"FALLBACK",`${y} (${A})`)}const[,D,P,U]=I[0];if(D===-1)return b(0,"BLOCKLISTED",P,D,U);const j=c?s:e;let C=0;for(let Z=0;Z<j.length;Z++)D>=j[Z]&&(C=Z);return b(C,"BENCHMARK",P,D,U)});function NXe(s){let e=0;const t=performance.now();function n(){e++;const r=performance.now();if(r-t>=100){const i=e/((r-t)/1e3),o=Math.round(i/30)*30;s(o)}else requestAnimationFrame(n)}requestAnimationFrame(n)}function PXe(s=!1,e=!1){return new Promise(t=>{AXe().then(n=>{let r=!1;const i=document.createElement("canvas"),o=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);if(r="transferControlToOffscreen"in i,o){const c=navigator.userAgent.match(/version\/(\d+)/i);r=(c?parseInt(c[1]):0)>=17}const l={dpr:devicePixelRatio,fps:30,width:innerWidth,height:innerHeight,mobile:n.isMobile!==void 0?n.isMobile:!1,supportOffScreenCanvas:r,supportWebGPU:!!navigator.gpu,quality:"Low",dev:s,editor:e};n.tier===3?l.quality="High":n.tier===2&&(l.quality="Medium"),NXe(c=>{l.fps=c,t(l)})})})}class RXe{constructor(){qe(this,"assets",{audio:new Map,image:new Map,json:new Map,model:new Map,video:new Map});qe(this,"components",new Map);qe(this,"settings",{dpr:1,fps:30,width:0,height:0,mobile:!1,supportOffScreenCanvas:!1,supportWebGPU:!1,quality:"Low",dev:!1,editor:!1});qe(this,"onUpdateCallback");qe(this,"playing",!1);qe(this,"rafID",-1);qe(this,"play",()=>{this.playing||(this.playing=!0,this.onUpdate())});qe(this,"pause",()=>{this.playing&&(this.playing=!1,cancelAnimationFrame(this.rafID),this.rafID=-1)});qe(this,"onUpdate",()=>{this.update(),this.isApp&&this.draw(),this.onUpdateCallback&&this.onUpdateCallback(),this.rafID=requestAnimationFrame(this.onUpdate)})}dispose(){this.pause(),this.components.forEach(e=>e.dispose()),this.components.clear()}detectSettings(e=!1,t=!1){return new Promise(n=>{PXe(e,t).then(r=>{this.settings=r,n()})})}update(){}draw(){}addComponent(e,t){this.components.set(e,t)}get debugEnabled(){return this.settings.dev}get isApp(){return!this.editor}set isApp(e){this.editor=!e}get editor(){return this.settings.editor}set editor(e){this.settings.editor=e}}var IXe=N_e();class NSe{constructor(e,t=!1,n=!1){qe(this,"name");qe(this,"_debug",!1);qe(this,"_editor",!1);qe(this,"broadcastChannel");this.name=e,this._debug=t,this._editor=n,t&&(this.broadcastChannel=new BroadcastChannel(e),this.broadcastChannel.addEventListener("message",this.messageHandler.bind(this)))}dispose(){var e,t;(e=this.broadcastChannel)==null||e.removeEventListener("message",this.messageHandler.bind(this)),(t=this.broadcastChannel)==null||t.close()}get debug(){return this._debug}get editor(){return this._editor}send(e){var n;if(this.editor&&e.target==="app"||!this.editor&&e.target==="editor")try{(n=this.broadcastChannel)==null||n.postMessage(e)}catch(r){console.log("Hermes - Error sending message:"),console.log(r),console.log(e)}}messageHandler(e){const t=e.data;t.target==="app"?this.handleApp(t):this.handleEditor(t)}handleApp(e){}handleEditor(e){}}const PSe=()=>{};function pF(s){return s.substring(0,1).toUpperCase()+s.substring(1)}function kXe(s){const e=JSON.stringify(s);return navigator.clipboard.writeText(e),e}function O0(){return Math.round(Math.random()*1e6).toString()}function DXe(s){return s.r!==void 0&&s.g!==void 0&&s.b!==void 0}function hxe(s){const e=Math.round(s.r*255),t=Math.round(s.g*255),n=Math.round(s.b*255),r=c=>{const h=c.toString(16);return h.length===1?"0"+h:h},i=r(e),o=r(t),l=r(n);return"#"+i+o+l}function OXe(s,e,t,n,r){const i=1-s;return i*i*i*e+3*i*i*s*t+3*i*s*s*n+s*s*s*r}function LXe(s,e,t){if(s.type!=="bezier"||s.handles.length!==4)throw new Error("Invalid keyframe data for Bzier interpolation.");const[n,r]=s.handles,i=(t-s.position)/(e.position-s.position);return OXe(i,s.value,s.value+n,e.value+r,e.value)}class FXe extends NSe{constructor(t=!1,n=!1){super("RemoteTheatre",t,n);qe(this,"project");qe(this,"sheets",new Map);qe(this,"sheetObjects",new Map);qe(this,"sheetObjectCBs",new Map);qe(this,"sheetObjectUnsubscribe",new Map);qe(this,"activeSheet");qe(this,"studio")}dispose(){this.project=void 0,this.sheets=new Map,this.sheetObjects=new Map,this.sheetObjectCBs=new Map,this.sheetObjectUnsubscribe=new Map}loadProject(t,n){return this.project=IXe.getProject(t,{state:n}),new Promise((r,i)=>{var o;(o=this.project)==null||o.ready.then(()=>{if(n){const l=n.sheetsById;for(const c in l)this.sheet(c)}r()}).catch(()=>i())})}getSheetInstance(t,n){return n!==void 0?`${t}-${n}`:t}sheet(t,n){var o;if(this.project===void 0){console.error("Theatre Project hasn't been created yet.");return}const r=this.getSheetInstance(t,n);let i=this.sheets.get(r);return i!==void 0||(i=(o=this.project)==null?void 0:o.sheet(t,n),this.sheets.set(r,i)),i}playSheet(t,n,r){return new Promise(i=>{var o;(o=this.sheet(t,r))==null||o.sequence.play(n).then(l=>i(l)),this.send({event:"playSheet",target:"editor",data:{sheet:t,instance:r,value:n}})})}pauseSheet(t,n){var r;(r=this.sheet(t,n))==null||r.sequence.pause(),this.send({event:"pauseSheet",target:"editor",data:{sheet:t,instance:n}})}clearSheetObjects(t){this.sheetObjects.forEach((n,r)=>{r.search(`${t}_`)>-1&&this.unsubscribe(n)})}sheetObject(t,n,r,i,o){if(this.project===void 0){console.error("Theatre Project hasn't been created yet.");return}const l=this.sheet(t,o);if(l===void 0)return;const h=`${this.getSheetInstance(t,o)}_${n}`;let m=this.sheetObjects.get(h),y=r;m!==void 0&&(y={...r,...m.value}),m=l.object(n,y,{reconfigure:!0}),this.sheetObjects.set(h,m),this.sheetObjectCBs.set(h,i!==void 0?i:PSe);function b(A,I,D){if(typeof D=="object")if(DXe(D))A[I]={r:D.r,g:D.g,b:D.b,a:D.a};else for(const P in D){const U=D[P];typeof U=="object"&&b(D,P,U)}}const w=m.onValuesChange(A=>{const I=this.sheetObjectCBs.get(h);if(this.editor){for(const D in A){const P=A[D];typeof P=="object"&&b(A,D,P)}this.send({event:"updateSheetObject",target:"app",data:{sheet:t,sheetObject:h,values:A}}),I&&I(A)}else I&&I(A)});return this.sheetObjectUnsubscribe.set(h,w),m}getSheetObjectKeyframes(t,n,r){const i=this.sheet(t);if(i===void 0)return[];const o=`${t}_${n}`,l=this.sheetObjects.get(o);return l===void 0?[]:i.sequence.__experimental_getKeyframes(l.props[r])}getSheetObjectVectors(t,n){const r=this.sheet(t);if(r===void 0)return[];const i=`${t}_${n}`,o=this.sheetObjects.get(i);if(o===void 0)return[];const l=[],c=r.sequence.__experimental_getKeyframes(o.props.x),h=r.sequence.__experimental_getKeyframes(o.props.y),m=r.sequence.__experimental_getKeyframes(o.props.z),y=new Set;return c.forEach(w=>y.add(w.position)),h.forEach(w=>y.add(w.position)),m.forEach(w=>y.add(w.position)),Array.from(y).sort((w,A)=>w-A).forEach(w=>{const A=(I,D)=>{const P=I.find((C,Z)=>{var ie;return C.position<=D&&(((ie=I[Z+1])==null?void 0:ie.position)||1/0)>D}),U=I.find(C=>C.position>D);if(!P)return(U==null?void 0:U.value)||0;if(!U||P.position===D)return P.value;if(P.type==="bezier")return LXe(P,U,D);const j=(D-P.position)/(U.position-P.position);return P.value+j*(U.value-P.value)};l.push({position:w,x:A(c,w),y:A(h,w),z:A(m,w)})}),l}update(t){}unsubscribe(t){if(this.project===void 0){console.error("Theatre Project hasn't been created yet.");return}const n=t.address.sheetId,r=t.address.objectKey,i=this.sheets.get(n);i==null||i.detachObject(r);const o=`${n}_${r}`,l=this.sheetObjectUnsubscribe.get(o);l!==void 0&&(this.sheetObjects.delete(o),this.sheetObjectCBs.delete(o),this.sheetObjectUnsubscribe.delete(o),l())}handleApp(t){var r,i;let n;switch(t.event){case"setSheet":n=this.sheets.get(t.data.sheet),n!==void 0?(r=this.studio)==null||r.setSelection([n]):console.log(`Hermes - Can't set Sheet: ${t.data.sheet}`,n);break;case"setSheetObject":n=this.sheetObjects.get(`${t.data.sheet}_${t.data.key}`),n!==void 0?(i=this.studio)==null||i.setSelection([n]):console.log(`Hermes - Can't set Sheet Object: ${t.data.sheet}, ${t.data.key}: ${t.data.sheet}_${t.data.key}`,n);break;case"updateSheetObject":n=this.sheets.get(t.data.sheet),n!==void 0&&n.sequence.pause(),n=this.sheetObjectCBs.get(t.data.sheetObject),n!==void 0?n(t.data.values):console.log(`Hermes - Can't update Sheet Object: ${t.data.sheetObject}, ${t.data.sheet}`,n);break;case"updateTimeline":n=this.sheets.get(t.data.sheet),n!==void 0?n.sequence.position=t.data.position:console.log(`Hermes - Can't update sheet position: ${t.data.sheet}, ${t.data.position}`);break}}handleEditor(t){var n,r;switch(t.event){case"playSheet":(n=this.sheet(t.data.sheet,t.data.instance))==null||n.sequence.play(t.data.value);break;case"pauseSheet":(r=this.sheet(t.data.sheet,t.data.instance))==null||r.sequence.pause();break}}getSheetNames(){const t=[];return this.sheets.forEach((n,r)=>{t.push(r)}),t}handleEditorApp(){var t,n,r;if(this.editor){(t=this.studio)==null||t.ui.restore(),(n=this.studio)==null||n.onSelectionChange(c=>{c.length<1||c.forEach(h=>{let m=h.address.sheetId,y="setSheet",b={};switch(h.type){case"Theatre_Sheet_PublicAPI":y="setSheet",b={sheet:h.address.sheetId},this.activeSheet=this.sheets.get(h.address.sheetId);break;case"Theatre_SheetObject_PublicAPI":y="setSheetObject",m+=`_${h.address.objectKey}`,b={id:m,sheet:h.address.sheetId,key:h.address.objectKey},this.activeSheet=this.sheets.get(h.address.sheetId);break}this.send({event:y,target:"app",data:b})})});let i=-1;const o=()=>{if(this.activeSheet!==void 0&&i!==this.activeSheet.sequence.position){i=this.activeSheet.sequence.position;const c=this.activeSheet;this.send({event:"updateTimeline",target:"app",data:{position:i,sheet:c.address.sheetId}})}},l=()=>{o(),requestAnimationFrame(l)};o(),l()}else(r=this.studio)==null||r.ui.hide()}}/**
 * @license
 * Copyright 2010-2026 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const BXe=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],Lq=new WeakMap;let UXe=class{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=BXe,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:n,material:r,object:i}=e;if(t={material:this.getMaterialData(r),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexId:n.index?n.index.id:null,indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:i.matrixWorld.clone()},i.center&&(t.center=i.center.clone()),i.morphTargetInfluences&&(t.morphTargetInfluences=i.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:l}=e.context;t.bufferWidth=o,t.bufferHeight=l}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const r=e[n];t[n]={id:r.id,version:r.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return!!(e.context.modelViewMatrix||e.context.modelNormalViewMatrix||e.context.getAO||e.context.getShadow)}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const r=e[n];r!=null&&(typeof r=="object"&&r.clone!==void 0?r.isTexture===!0?t[n]={id:r.id,version:r.version}:t[n]=r.clone():t[n]=r)}return t}equals(e,t){const{object:n,material:r,geometry:i}=e,o=this.getRenderObjectData(e);if(o.worldMatrix.equals(n.matrixWorld)!==!0)return o.worldMatrix.copy(n.matrixWorld),!1;const l=o.material;for(const U in l){const j=l[U],C=r[U];if(j.equals!==void 0){if(j.equals(C)===!1)return j.copy(C),!1}else if(C.isTexture===!0){if(j.id!==C.id||j.version!==C.version)return j.id=C.id,j.version=C.version,!1}else if(j!==C)return l[U]=C,!1}if(l.transmission>0){const{width:U,height:j}=e.context;if(o.bufferWidth!==U||o.bufferHeight!==j)return o.bufferWidth=U,o.bufferHeight=j,!1}const c=o.geometry,h=i.attributes,m=c.attributes,y=Object.keys(m),b=Object.keys(h);if(c.id!==i.id)return c.id=i.id,!1;if(y.length!==b.length)return o.geometry.attributes=this.getAttributesData(h),!1;for(const U of y){const j=m[U],C=h[U];if(C===void 0)return delete m[U],!1;if(j.id!==C.id||j.version!==C.version)return j.id=C.id,j.version=C.version,!1}const w=i.index,A=c.indexId,I=c.indexVersion,D=w?w.id:null,P=w?w.version:null;if(A!==D||I!==P)return c.indexId=D,c.indexVersion=P,!1;if(c.drawRange.start!==i.drawRange.start||c.drawRange.count!==i.drawRange.count)return c.drawRange.start=i.drawRange.start,c.drawRange.count=i.drawRange.count,!1;if(o.morphTargetInfluences){let U=!1;for(let j=0;j<o.morphTargetInfluences.length;j++)o.morphTargetInfluences[j]!==n.morphTargetInfluences[j]&&(o.morphTargetInfluences[j]=n.morphTargetInfluences[j],U=!0);if(U)return!1}if(o.lights){for(let U=0;U<t.length;U++)if(o.lights[U].map!==t[U].map)return!1}return o.center&&o.center.equals(n.center)===!1?(o.center.copy(n.center),!0):(e.bundle!==null&&(o.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const n of e)n.isSpotLight===!0&&n.map!==null&&t.push({map:n.map.version});return t}getLights(e,t){if(Lq.has(e)){const r=Lq.get(e);if(r.renderId===t)return r.lightsData}const n=this.getLightsData(e.getLights());return Lq.set(e,{renderId:t,lightsData:n}),n}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const r=e.object.static===!0,i=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(r||i)return!1;const o=this.getLights(e.lightsNode,n);return this.equals(e,o)!==!0}};const zXe=[/^StackTrace\.js$/,/^TSLCore\.js$/,/^.*Node\.js$/,/^three\.webgpu.*\.js$/];function VXe(s){const e=/(?:at\s+(.+?)\s+\()?(?:(.+?)@)?([^@\s()]+):(\d+):(\d+)/;return s.split(`
`).map(t=>{const n=t.match(e);if(!n)return null;const r=n[1]||n[2]||"",i=n[3].split("?")[0],o=parseInt(n[4],10),l=parseInt(n[5],10),c=i.split("/").pop();return{fn:r,file:c,line:o,column:l}}).filter(t=>t&&!zXe.some(n=>n.test(t.file)))}let Ea=class{constructor(e=null){this.isStackTrace=!0,this.stack=VXe(e||new Error().stack)}getLocation(){if(this.stack.length===0)return"[Unknown location]";const e=this.stack[0],t=e.fn;return`${t?`"${t}()" at `:""}"${e.file}:${e.line}"`}getError(e){if(this.stack.length===0)return e;const t=this.stack.map(n=>{const r=`${n.file}:${n.line}:${n.column}`;return n.fn?`    at ${n.fn} (${r})`:`    at ${r}`}).join(`
`);return`${e}
${t}`}};function fZ(s,e=0){let t=3735928559^e,n=1103547991^e;if(s instanceof Array)for(let r=0,i;r<s.length;r++)i=s[r],t=Math.imul(t^i,2654435761),n=Math.imul(n^i,1597334677);else for(let r=0,i;r<s.length;r++)i=s.charCodeAt(r),t=Math.imul(t^i,2654435761),n=Math.imul(n^i,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&n)+(t>>>0)}const Tw=s=>fZ(s),JA=s=>fZ(s),GC=(...s)=>fZ(s),GXe=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),pxe=new WeakMap;function RSe(s){return GXe.get(s)}function fF(s){if(/[iu]?vec\d/.test(s))return s.startsWith("ivec")?Int32Array:s.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(s)||/float/.test(s))return Float32Array;if(/uint/.test(s))return Uint32Array;if(/int/.test(s))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${s}`)}function ISe(s){if(/float|int|uint/.test(s))return 1;if(/vec2/.test(s))return 2;if(/vec3/.test(s))return 3;if(/vec4/.test(s)||/mat2/.test(s))return 4;if(/mat3/.test(s))return 9;if(/mat4/.test(s))return 16;Ht(`TSL: Unsupported type: ${s}`,new Ea)}function jXe(s){if(/float|int|uint/.test(s))return 1;if(/vec2/.test(s))return 2;if(/vec3/.test(s))return 3;if(/vec4/.test(s)||/mat2/.test(s))return 4;if(/mat3/.test(s))return 12;if(/mat4/.test(s))return 16;Ht(`TSL: Unsupported type: ${s}`,new Ea)}function HXe(s){if(/float|int|uint/.test(s))return 4;if(/vec2/.test(s))return 8;if(/vec3/.test(s)||/vec4/.test(s))return 16;if(/mat2/.test(s))return 8;if(/mat3/.test(s)||/mat4/.test(s))return 16;Ht(`TSL: Unsupported type: ${s}`,new Ea)}function Zy(s){if(s==null)return null;const e=typeof s;return s.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":s.isVector2===!0?"vec2":s.isVector3===!0?"vec3":s.isVector4===!0?"vec4":s.isMatrix2===!0?"mat2":s.isMatrix3===!0?"mat3":s.isMatrix4===!0?"mat4":s.isColor===!0?"color":s instanceof ArrayBuffer?"ArrayBuffer":null}function mZ(s,...e){const t=s?s.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),s==="color"?new Tn(...e):t==="vec2"?new Ln(...e):t==="vec3"?new be(...e):t==="vec4"?new zr(...e):t==="mat2"?new ySe(...e):t==="mat3"?new ci(...e):t==="mat4"?new Pn(...e):s==="bool"?e[0]||!1:s==="float"||s==="int"||s==="uint"?e[0]||0:s==="string"?e[0]||"":s==="ArrayBuffer"?WXe(e[0]):null}function kSe(s){let e=pxe.get(s);return e===void 0&&(e={},pxe.set(s,e)),e}function $Xe(s){let e="";const t=new Uint8Array(s);for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function WXe(s){return Uint8Array.from(atob(s),e=>e.charCodeAt(0)).buffer}const CC={VERTEX:"vertex",FRAGMENT:"fragment"},Wr={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},qXe={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},F0={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},DSe=["fragment","vertex"],VY=["setup","analyze","generate"],GY=[...DSe,"compute"],xx=["x","y","z","w"],XXe={analyze:"setup",generate:"analyze"};let YXe=0,Jn=class OSe extends _d{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Wr.NONE,this.updateBeforeType=Wr.NONE,this.updateAfterType=Wr.NONE,this.uuid=t0.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:YXe++}),this.stackTrace=null,OSe.captureStackTrace===!0&&(this.stackTrace=new Ea)}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,Wr.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Wr.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Wr.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const n of Object.getOwnPropertyNames(this)){const r=this[n];if(!(n.startsWith("_")===!0||e.has(r))){if(Array.isArray(r)===!0)for(let i=0;i<r.length;i++){const o=r[i];o&&o.isNode===!0&&t.push({property:n,index:i,childNode:o})}else if(r&&r.isNode===!0)t.push({property:n,childNode:r});else if(r&&Object.getPrototypeOf(r)===Object.prototype)for(const i in r){if(i.startsWith("_")===!0)continue;const o=r[i];o&&o.isNode===!0&&t.push({property:n,index:i,childNode:o})}}}return t}getCacheKey(e=!1,t=null){if(e=e||this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);const n=[];for(const{property:r,childNode:i}of this._getChildren(t))n.push(Tw(r.slice(0,-4)),i.getCacheKey(e,t));this._cacheKey=GC(JA(n),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let n=0;for(const r of this.getChildren())t["node"+n++]=r;return t.outputNode||null}analyze(e,t=null){const n=e.increaseUsage(this);if(this.parents===!0){const r=e.getDataFromNode(this,"any");r.stages=r.stages||{},r.stages[e.shaderStage]=r.stages[e.shaderStage]||[],r.stages[e.shaderStage].push(t)}if(n===1){const r=e.getNodeProperties(this);for(const i of Object.values(r))i&&i.isNode===!0&&i.build(e,this)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(e,t)}updateBefore(){qt("Abstract function.")}updateAfter(){qt("Abstract function.")}update(){qt("Abstract function.")}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const n=this.getShared(e);if(this!==n)return n.build(e,t);if(this._beforeNodes!==null){const c=this._beforeNodes;this._beforeNodes=null;for(const h of c)h.build(e,t);this._beforeNodes=c}const r=e.getDataFromNode(this);r.buildStages=r.buildStages||{},r.buildStages[e.buildStage]=!0;const i=XXe[e.buildStage];if(i&&r.buildStages[i]!==!0){const c=e.getBuildStage();e.setBuildStage(i),this.build(e),e.setBuildStage(c)}e.addChain(this);let o=null;const l=e.getBuildStage();if(l==="setup"){e.addNode(this),this.updateReference(e);const c=e.getNodeProperties(this);if(c.initialized!==!0){c.initialized=!0,c.outputNode=this.setup(e)||c.outputNode||null;for(const h of Object.values(c))if(h&&h.isNode===!0){if(h.parents===!0){const m=e.getNodeProperties(h);m.parents=m.parents||[],m.parents.push(this)}h.build(e)}e.addSequentialNode(this)}o=c.outputNode}else if(l==="analyze")this.analyze(e,t);else if(l==="generate"){if(this.generate.length<2){const h=this.getNodeType(e),m=e.getDataFromNode(this);o=m.snippet,o===void 0?m.generated===void 0?(m.generated=!0,o=this.generate(e)||"",m.snippet=o):(qt("Node: Recursion detected.",this),o="/* Recursion detected. */"):m.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,h,t)}else o=this.generate(e,t)||"";o===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(Ht(`TSL: Invalid generated code, expected a "${t}".`),o=e.generateConst(t))}return e.removeChain(this),o}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:r,index:i,childNode:o}of t)i!==void 0?(n[r]===void 0&&(n[r]=Number.isInteger(i)?[]:{}),n[r][i]=o.toJSON(e.meta).uuid):n[r]=o.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const r=[];for(const i of e.inputNodes[n])r.push(t[i]);this[n]=r}else if(typeof e.inputNodes[n]=="object"){const r={};for(const i in e.inputNodes[n]){const o=e.inputNodes[n][i];r[i]=t[o]}this[n]=r}else{const r=e.inputNodes[n];this[n]=t[r]}}}toJSON(e){const{uuid:t,type:n}=this,r=e===void 0||typeof e=="string";r&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];i===void 0&&(i={uuid:t,type:n,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},r!==!0&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta);function o(l){const c=[];for(const h in l){const m=l[h];delete m.metadata,c.push(m)}return c}if(r){const l=o(e.textures),c=o(e.images),h=o(e.nodes);l.length>0&&(i.textures=l),c.length>0&&(i.images=c),h.length>0&&(i.nodes=h)}return i}};Jn.captureStackTrace=!1;let bx=class extends Jn{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}generate(e){const t=this.indexNode.getNodeType(e),n=this.node.build(e),r=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${n}[ ${r} ]`}},LSe=class extends Jn{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const r of this.convertTo.split("|"))(n===null||e.getTypeLength(t)===e.getTypeLength(r))&&(n=r);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,r=this.getNodeType(e),i=n.build(e,r);return e.format(i,r,t)}},Ho=class extends Jn{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const r=e.getVectorType(this.getNodeType(e,t)),i=e.getDataFromNode(this);if(i.propertyName!==void 0)return e.format(i.propertyName,r,t);if(r!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,r),l=e.getVarFromNode(this,null,r),c=e.getPropertyName(l);return e.addLineFlowCode(`${c} = ${o}`,this),i.snippet=o,i.propertyName=c,e.format(i.propertyName,r,t)}}return super.build(e,t)}},KXe=class extends Ho{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),r=e.getTypeLength(n),i=this.nodes,o=e.getComponentType(n),l=[];let c=0;for(const m of i){if(c>=r){Ht(`TSL: Length of parameters exceeds maximum length of function '${n}()' type.`,this.stackTrace);break}let y=m.getNodeType(e),b=e.getTypeLength(y),w;if(c+b>r&&(Ht(`TSL: Length of '${n}()' data exceeds maximum length of output type.`,this.stackTrace),b=r-c,y=e.getTypeFromLength(b)),c+=b,w=m.build(e,y),e.getComponentType(y)!==o){const I=e.getTypeFromLength(b,o);w=e.format(w,y,I)}l.push(w)}const h=`${e.getType(n)}( ${l.join(", ")} )`;return e.format(h,n,t)}};const ZXe=xx.join("");let FSe=class extends Jn{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(xx.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const n=this.node,r=e.getTypeLength(n.getNodeType(e));let i=null;if(r>1){let o=null;this.getVectorLength()>=r&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=n.build(e,o);this.components.length===r&&this.components===ZXe.slice(0,this.components.length)?i=e.format(c,o,t):i=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else i=n.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}},QXe=class extends Ho{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:r}=this,i=this.getNodeType(e),o=e.getComponentType(r.getNodeType(e)),l=e.getTypeFromLength(n.length,o),c=r.build(e,l),h=t.build(e,i),m=e.getTypeLength(i),y=[];for(let b=0;b<m;b++){const w=xx[b];w===n[0]?(y.push(c),b+=n.length-1):y.push(h+"."+w)}return`${e.getType(i)}( ${y.join(", ")} )`}},JXe=class extends Ho{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,r=this.getNodeType(e),i=n.build(e),o=e.getVarFromNode(this),l=e.getPropertyName(o);e.addLineFlowCode(l+" = "+i,this);const c=e.getTypeLength(r),h=[];let m=0;for(let y=0;y<c;y++){const b=xx[y];b===t[m]?(h.push("1.0 - "+(l+"."+b)),m++):h.push(l+"."+b)}return`${e.getType(r)}( ${h.join(", ")} )`}},gZ=class extends Jn{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?Zy(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=Zy(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=$Xe(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?mZ(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){qt("Abstract function.")}};const fxe=/float|u?int/;let Lp=class extends gZ{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return fxe.test(n)&&fxe.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}},eYe=class extends Jn{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){qt(`TSL: Member "${this.property}" does not exist in struct.`,this.stackTrace);const n=this.getNodeType(e);return e.generateConst(n)}return this.structNode.build(e)+"."+this.property}},g5=null;const jY=new Map;function zt(s,e){if(jY.has(s)){qt(`TSL: Redefinition of method chaining '${s}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${s} is not a function`);jY.set(s,e),s!=="assign"&&(Jn.prototype[s]=function(...t){return this.isStackNode?this.addToStack(e(...t)):e(this,...t)},Jn.prototype[s+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const tYe=s=>s.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),mxe=s=>tYe(s).split("").sort().join("");Jn.prototype.assign=function(...s){if(this.isStackNode!==!0)return g5!==null?g5.assign(this,...s):Ht("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn().",new Ea),this;{const e=jY.get("assign");return this.addToStack(e(...s))}};Jn.prototype.toVarIntent=function(){return this};Jn.prototype.get=function(s){return new eYe(this,s)};const jC={};function EO(s,e,t){jC[s]=jC[e]=jC[t]={get(){this._cache=this._cache||{};let o=this._cache[s];return o===void 0&&(o=new FSe(this,s),this._cache[s]=o),o},set(o){this[s].assign(Kn(o))}};const n=s.toUpperCase(),r=e.toUpperCase(),i=t.toUpperCase();Jn.prototype["set"+n]=Jn.prototype["set"+r]=Jn.prototype["set"+i]=function(o){const l=mxe(s);return new QXe(this,l,Kn(o))},Jn.prototype["flip"+n]=Jn.prototype["flip"+r]=Jn.prototype["flip"+i]=function(){const o=mxe(s);return new JXe(this,o)}}const Y1=["x","y","z","w"],K1=["r","g","b","a"],Z1=["s","t","p","q"];for(let s=0;s<4;s++){let e=Y1[s],t=K1[s],n=Z1[s];EO(e,t,n);for(let r=0;r<4;r++){e=Y1[s]+Y1[r],t=K1[s]+K1[r],n=Z1[s]+Z1[r],EO(e,t,n);for(let i=0;i<4;i++){e=Y1[s]+Y1[r]+Y1[i],t=K1[s]+K1[r]+K1[i],n=Z1[s]+Z1[r]+Z1[i],EO(e,t,n);for(let o=0;o<4;o++)e=Y1[s]+Y1[r]+Y1[i]+Y1[o],t=K1[s]+K1[r]+K1[i]+K1[o],n=Z1[s]+Z1[r]+Z1[i]+Z1[o],EO(e,t,n)}}}for(let s=0;s<32;s++)jC[s]={get(){this._cache=this._cache||{};let e=this._cache[s];return e===void 0&&(e=new bx(this,new Lp(s,"uint")),this._cache[s]=e),e},set(e){this[s].assign(Kn(e))}};Object.defineProperties(Jn.prototype,jC);const gxe=new WeakMap,nYe=function(s,e=null){const t=Zy(s);return t==="node"?s:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?Kn(HY(s,e)):t==="shader"?s.isFn?s:Ye(s):s},rYe=function(s,e=null){for(const t in s)s[t]=Kn(s[t],e);return s},iYe=function(s,e=null){const t=s.length;for(let n=0;n<t;n++)s[n]=Kn(s[n],e);return s},BSe=function(s,e=null,t=null,n=null){function r(m){return n!==null?(m=Kn(Object.assign(m,n)),n.intent===!0&&(m=m.toVarIntent())):m=Kn(m),m}let i,o=e,l,c;function h(m){let y;return o?y=/[a-z]/i.test(o)?o+"()":o:y=s.type,l!==void 0&&m.length<l?(Ht(`TSL: "${y}" parameter length is less than minimum required.`,new Ea),m.concat(new Array(l-m.length).fill(0))):c!==void 0&&m.length>c?(Ht(`TSL: "${y}" parameter length exceeds limit.`,new Ea),m.slice(0,c)):m}return e===null?i=(...m)=>r(new s(...J6(h(m)))):t!==null?(t=Kn(t),i=(...m)=>r(new s(e,...J6(h(m)),t))):i=(...m)=>r(new s(e,...J6(h(m)))),i.setParameterLength=(...m)=>(m.length===1?l=c=m[0]:m.length===2&&([l,c]=m),i),i.setName=m=>(o=m,i),i},sYe=function(s,...e){return new s(...J6(e))};let oYe=class extends Jn{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:n}=this,r=e.getNodeProperties(t),i=e.getClosestSubBuild(t.subBuilds)||"",o=i||"default";if(r[o])return r[o];const l=e.subBuildFn,c=e.fnCall;e.subBuildFn=i,e.fnCall=this;let h=null;if(t.layout){let m=gxe.get(e.constructor);m===void 0&&(m=new WeakMap,gxe.set(e.constructor,m));let y=m.get(t);y===void 0&&(y=Kn(e.buildFunctionNode(t)),m.set(t,y)),e.addInclude(y);const b=n?aYe(n):null;h=Kn(y.call(b))}else{const m=new Proxy(e,{get:(I,D,P)=>{let U;return Symbol.iterator===D?U=function*(){yield void 0}:U=Reflect.get(I,D,P),U}}),y=n?lYe(n):null,b=Array.isArray(n)?n.length>0:n!==null,w=t.jsFunc,A=b||w.length>1?w(y,m):w(m);h=Kn(A)}return e.subBuildFn=l,e.fnCall=c,t.once&&(r[o]=h),h}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),n=e.getSubBuildOutput(this);return t[n]=t[n]||this.setupOutput(e),t[n].subBuild=e.getClosestSubBuild(this),t[n]}build(e,t=null){let n=null;const r=e.getBuildStage(),i=e.getNodeProperties(this),o=e.getSubBuildOutput(this),l=this.getOutputNode(e),c=e.fnCall;if(e.fnCall=this,r==="setup"){const h=e.getSubBuildProperty("initialized",this);if(i[h]!==!0&&(i[h]=!0,i[o]=this.getOutputNode(e),i[o].build(e),this.shaderNode.subBuilds))for(const m of e.chaining){const y=e.getDataFromNode(m,"any");y.subBuilds=y.subBuilds||new Set;for(const b of this.shaderNode.subBuilds)y.subBuilds.add(b)}n=i[o]}else r==="analyze"?l.build(e,t):r==="generate"&&(n=l.build(e,t)||"");return e.fnCall=c,n}};function aYe(s){let e;return uB(s),s[0]&&(s[0].isNode||Object.getPrototypeOf(s[0])!==Object.prototype)?e=[...s]:e=s[0],e}function lYe(s){let e=0;return uB(s),new Proxy(s,{get:(t,n,r)=>{let i;if(n==="length")return i=s.length,i;if(Symbol.iterator===n)i=function*(){for(const o of s)yield Kn(o)};else{if(s.length>0)if(Object.getPrototypeOf(s[0])===Object.prototype){const o=s[0];o[n]===void 0?i=o[e++]:i=Reflect.get(o,n,r)}else s[0]instanceof Jn&&(s[n]===void 0?i=s[e++]:i=Reflect.get(s,n,r));else i=Reflect.get(t,n,r);i=Kn(i)}return i}})}let cYe=class extends Jn{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new oYe(this,e)}setup(){return this.call()}};const uYe=[!1,!0],dYe=[0,1,2,3],hYe=[-1,-2],USe=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],yZ=new Map;for(const s of uYe)yZ.set(s,new Lp(s));const vZ=new Map;for(const s of dYe)vZ.set(s,new Lp(s,"uint"));const xZ=new Map([...vZ].map(s=>new Lp(s.value,"int")));for(const s of hYe)xZ.set(s,new Lp(s,"int"));const lB=new Map([...xZ].map(s=>new Lp(s.value)));for(const s of USe)lB.set(s,new Lp(s));for(const s of USe)lB.set(-s,new Lp(-s));const cB={bool:yZ,uint:vZ,ints:xZ,float:lB},yxe=new Map([...yZ,...lB]),HY=(s,e)=>yxe.has(s)?yxe.get(s):s.isNode===!0?s:new Lp(s,e),al=function(s,e=null){return(...t)=>{for(const r of t)if(r===void 0)return Ht(`TSL: Invalid parameter for the type "${s}".`,new Ea),new Lp(0,s);if((t.length===0||!["bool","float","int","uint"].includes(s)&&t.every(r=>{const i=typeof r;return i!=="object"&&i!=="function"}))&&(t=[mZ(s,...t)]),t.length===1&&e!==null&&e.has(t[0]))return AC(e.get(t[0]));if(t.length===1){const r=HY(t[0],s);return r.nodeType===s?AC(r):AC(new LSe(r,s))}const n=t.map(r=>HY(r));return AC(new KXe(n,s))}},NA=s=>typeof s=="object"&&s!==null?s.value:s,zSe=s=>s!=null?s.nodeType||s.convertTo||(typeof s=="string"?s:null):null;function dS(s,e){return new cYe(s,e)}const Kn=(s,e=null)=>nYe(s,e),AC=(s,e=null)=>Kn(s,e).toVarIntent(),uB=(s,e=null)=>new rYe(s,e),J6=(s,e=null)=>new iYe(s,e),ri=(s,e=null,t=null,n=null)=>new BSe(s,e,t,n),Cn=(s,...e)=>new sYe(s,...e),ln=(s,e=null,t=null,n={})=>new BSe(s,e,t,{...n,intent:!0});let pYe=0,fYe=class extends Jn{constructor(e,t=null){super();let n=null;t!==null&&(typeof t=="object"?n=t.return:(typeof t=="string"?n=t:Ht("TSL: Invalid layout type.",new Ea),t=null)),this.shaderNode=new dS(e,n),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const n={name:"fn"+pYe++,type:t,inputs:[]};for(const r in e)r!=="return"&&n.inputs.push({name:r,type:e[r]});e=n}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return Ht('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".',this.stackTrace),e.generateConst(t)}};function Ye(s,e=null){const t=new fYe(s,e);return new Proxy(()=>{},{apply(n,r,i){return t.call(...i)},get(n,r,i){return Reflect.get(t,r,i)},set(n,r,i,o){return Reflect.set(t,r,i,o)}})}const PA=s=>{g5=s},bZ=()=>g5,_r=(...s)=>g5.If(...s),mYe=(...s)=>g5.Switch(...s);function dB(s){return g5&&g5.addToStack(s),s}zt("toStack",dB);const VSe=new al("color"),_e=new al("float",cB.float),ze=new al("int",cB.ints),Jt=new al("uint",cB.uint),Ap=new al("bool",cB.bool),rn=new al("vec2"),tl=new al("ivec2"),_Z=new al("uvec2"),GSe=new al("bvec2"),$e=new al("vec3"),SZ=new al("ivec3"),_x=new al("uvec3"),wZ=new al("bvec3"),mr=new al("vec4"),TZ=new al("ivec4"),EZ=new al("uvec4"),jSe=new al("bvec4"),hB=new al("mat2"),o0=new al("mat3"),o5=new al("mat4"),gYe=(s="")=>new Lp(s,"string"),yYe=s=>new Lp(s,"ArrayBuffer");zt("toColor",VSe);zt("toFloat",_e);zt("toInt",ze);zt("toUint",Jt);zt("toBool",Ap);zt("toVec2",rn);zt("toIVec2",tl);zt("toUVec2",_Z);zt("toBVec2",GSe);zt("toVec3",$e);zt("toIVec3",SZ);zt("toUVec3",_x);zt("toBVec3",wZ);zt("toVec4",mr);zt("toIVec4",TZ);zt("toUVec4",EZ);zt("toBVec4",jSe);zt("toMat2",hB);zt("toMat3",o0);zt("toMat4",o5);const HSe=ri(bx).setParameterLength(2),$Se=(s,e)=>new LSe(Kn(s),e),vYe=(s,e)=>new FSe(Kn(s),e);zt("element",HSe);zt("convert",$Se);const xYe=s=>(qt("TSL: append() has been renamed to Stack().",new Ea),dB(s));zt("append",s=>(qt("TSL: .append() has been renamed to .toStack().",new Ea),dB(s)));let hs=class extends Jn{static get type(){return"PropertyNode"}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return Tw(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}};const Y3=(s,e)=>new hs(s,e),RA=(s,e)=>new hs(s,e,!0),Ms=Cn(hs,"vec4","DiffuseColor"),B6=Cn(hs,"vec3","DiffuseContribution"),$Y=Cn(hs,"vec3","EmissiveColor"),fg=Cn(hs,"float","Roughness"),H3=Cn(hs,"float","Metalness"),mF=Cn(hs,"float","Clearcoat"),xS=Cn(hs,"float","ClearcoatRoughness"),ph=Cn(hs,"vec3","Sheen"),$y=Cn(hs,"float","SheenRoughness"),pB=Cn(hs,"float","Iridescence"),gF=Cn(hs,"float","IridescenceIOR"),yF=Cn(hs,"float","IridescenceThickness"),vF=Cn(hs,"float","AlphaT"),jy=Cn(hs,"float","Anisotropy"),HC=Cn(hs,"vec3","AnisotropyT"),ex=Cn(hs,"vec3","AnisotropyB"),y5=Cn(hs,"color","SpecularColor"),W6=Cn(hs,"color","SpecularColorBlended"),q6=Cn(hs,"float","SpecularF90"),xF=Cn(hs,"float","Shininess"),bS=Cn(hs,"vec4","Output"),WL=Cn(hs,"float","dashSize"),WY=Cn(hs,"float","gapSize"),bYe=Cn(hs,"float","pointWidth"),$C=Cn(hs,"float","IOR"),bF=Cn(hs,"float","Transmission"),MZ=Cn(hs,"float","Thickness"),CZ=Cn(hs,"float","AttenuationDistance"),AZ=Cn(hs,"color","AttenuationColor"),NZ=Cn(hs,"float","Dispersion");let WSe=class extends Jn{static get type(){return"UniformGroupNode"}constructor(e,t=!1,n=1){super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}};const qSe=s=>new WSe(s),fB=(s,e=0)=>new WSe(s,!0,e),XSe=fB("frame"),gr=fB("render"),PZ=qSe("object");let eN=class extends gZ{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=PZ}setName(e){return this.name=e,this}label(e){return qt('TSL: "label()" has been deprecated. Use "setName()" instead.',new Ea),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(n=>{const r=e(n,this);r!==void 0&&(this.value=r)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const n=this.getNodeType(e),r=this.getUniformHash(e);let i=e.getNodeFromHash(r);i===void 0&&(e.setHashNode(this,r),i=this);const o=i.getInputType(e),l=e.getUniformFromNode(i,o,e.shaderStage,this.name||e.context.nodeName),c=e.getPropertyName(l);e.context.nodeName!==void 0&&delete e.context.nodeName;let h=c;if(n==="bool"){const m=e.getDataFromNode(this);let y=m.propertyName;if(y===void 0){const b=e.getVarFromNode(this,null,"bool");y=e.getPropertyName(b),m.propertyName=y,h=e.format(c,o,n),e.addLineFlowCode(`${y} = ${h}`,this)}h=y}return e.format(h,n,t)}};const cr=(s,e)=>{const t=zSe(e||s);if(t===s&&(s=mZ(t)),s&&s.isNode===!0){let n=s.value;s.traverse(r=>{r.isConstNode===!0&&(n=r.value)}),s=n}return new eN(s,t)};let vxe=class extends Ho{static get type(){return"ArrayNode"}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null?this.values[0].getNodeType(e):this.nodeType}getElementType(e){return this.getNodeType(e)}getMemberType(e,t){return this.nodeType===null?this.values[0].getMemberType(e,t):super.getMemberType(e,t)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}};const YSe=(...s)=>{let e;if(s.length===1){const t=s[0];e=new vxe(null,t.length,t)}else{const t=s[0],n=s[1];e=new vxe(t,n)}return Kn(e)};zt("toArray",(s,e)=>YSe(Array(e).fill(s)));let _Ye=class extends Ho{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return xx.join("").slice(0,n)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:n}=this,r=t.getScope(),i=e.getDataFromNode(r);i.assign=!0;const o=e.getNodeProperties(this);o.sourceNode=n,o.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:n,sourceNode:r}=e.getNodeProperties(this),i=this.needsSplitAssign(e),o=n.build(e),l=n.getNodeType(e),c=r.build(e,l),h=r.getNodeType(e),m=e.getDataFromNode(this);let y;if(m.initialized===!0)t!=="void"&&(y=o);else if(i){const b=e.getVarFromNode(this,null,l),w=e.getPropertyName(b);e.addLineFlowCode(`${w} = ${c}`,this);const A=n.node,D=A.node.context({assign:!0}).build(e);for(let P=0;P<A.components.length;P++){const U=A.components[P];e.addLineFlowCode(`${D}.${U} = ${w}[ ${P} ]`,this)}t!=="void"&&(y=o)}else y=`${o} = ${c}`,(t==="void"||h==="void")&&(e.addLineFlowCode(y,this),t!=="void"&&(y=o));return m.initialized=!0,e.format(y,l,t)}};const KSe=ri(_Ye).setParameterLength(2);zt("assign",KSe);let SYe=class extends Ho{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],n=this.functionNode,r=n.getInputs(e),i=this.parameters,o=(c,h)=>{const m=h.type,y=m==="pointer";let b;return y?b="&"+c.build(e):b=c.build(e,m),b};if(Array.isArray(i)){if(i.length>r.length)Ht("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),i.length=r.length;else if(i.length<r.length)for(Ht("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");i.length<r.length;)i.push(_e(0));for(let c=0;c<i.length;c++)t.push(o(i[c],r[c]))}else for(const c of r){const h=i[c.name];h!==void 0?t.push(o(h,c)):(Ht(`TSL: Input '${c.name}' not found in 'Fn()'.`),t.push(o(_e(0),c)))}return`${n.build(e,"property")}( ${t.join(", ")} )`}};const ZSe=(s,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?J6(e):uB(e[0]),new SYe(Kn(s),e));zt("call",ZSe);const wYe={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};let $a=class qY extends Ho{static get type(){return"OperatorNode"}constructor(e,t,n,...r){if(super(),r.length>0){let i=new qY(e,t,n);for(let o=0;o<r.length-1;o++)i=new qY(e,i,r[o]);t=i,n=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(wYe[this.op],t)}getNodeType(e,t=null){const n=this.op,r=this.aNode,i=this.bNode,o=r.getNodeType(e),l=i?i.getNodeType(e):null;if(o==="void"||l==="void")return t||"void";if(n==="%")return o;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return e.getIntegerType(o);if(n==="!"||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">="){const c=Math.max(e.getTypeLength(o),e.getTypeLength(l));return c>1?`bvec${c}`:"bool"}else{if(e.isMatrix(o)){if(l==="float")return o;if(e.isVector(l))return e.getVectorFromMatrix(o);if(e.isMatrix(l))return o}else if(e.isMatrix(l)){if(o==="float")return l;if(e.isVector(o))return e.getVectorFromMatrix(l)}return e.getTypeLength(l)>e.getTypeLength(o)?l:o}}generate(e,t){const n=this.op,{aNode:r,bNode:i}=this,o=this.getNodeType(e,t);let l=null,c=null;o!=="void"?(l=r.getNodeType(e),c=i?i.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="||n==="!="?e.isVector(l)?c=l:e.isVector(c)?l=c:l!==c&&(l=c="float"):n===">>"||n==="<<"?(l=o,c=e.changeComponentType(c,"uint")):n==="%"?(l=o,c=e.isInteger(l)&&e.isInteger(c)?c:l):e.isMatrix(l)?c==="float"?c="float":e.isVector(c)?c=e.getVectorFromMatrix(l):e.isMatrix(c)||(l=c=o):e.isMatrix(c)?l==="float"?l="float":e.isVector(l)?l=e.getVectorFromMatrix(c):l=c=o:l=c=o):l=c=o;const h=r.build(e,l),m=i?i.build(e,c):null,y=e.getFunctionOperator(n);if(t!=="void"){const b=e.renderer.coordinateSystem===Tc;if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">=")return b?e.isVector(l)?e.format(`${this.getOperatorMethod(e,t)}( ${h}, ${m} )`,o,t):e.format(`( ${h} ${n} ${m} )`,o,t):e.format(`( ${h} ${n} ${m} )`,o,t);if(n==="%")return e.isInteger(c)?e.format(`( ${h} % ${m} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${h}, ${m} )`,o,t);if(n==="!"||n==="~")return e.format(`(${n}${h})`,l,t);if(y)return e.format(`${y}( ${h}, ${m} )`,o,t);if(e.isMatrix(l)&&c==="float")return e.format(`( ${m} ${n} ${h} )`,o,t);if(l==="float"&&e.isMatrix(c))return e.format(`${h} ${n} ${m}`,o,t);{let w=`( ${h} ${n} ${m} )`;return!b&&o==="bool"&&e.isVector(l)&&e.isVector(c)&&(w=`all${w}`),e.format(w,o,t)}}else if(l!=="void")return y?e.format(`${y}( ${h}, ${m} )`,o,t):e.isMatrix(l)&&c==="float"?e.format(`${m} ${n} ${h}`,o,t):e.format(`${h} ${n} ${m}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}};const Ha=ln($a,"+").setParameterLength(2,1/0).setName("add"),Fi=ln($a,"-").setParameterLength(2,1/0).setName("sub"),qr=ln($a,"*").setParameterLength(2,1/0).setName("mul"),_h=ln($a,"/").setParameterLength(2,1/0).setName("div"),tN=ln($a,"%").setParameterLength(2).setName("mod"),QSe=ln($a,"==").setParameterLength(2).setName("equal"),JSe=ln($a,"!=").setParameterLength(2).setName("notEqual"),ewe=ln($a,"<").setParameterLength(2).setName("lessThan"),RZ=ln($a,">").setParameterLength(2).setName("greaterThan"),twe=ln($a,"<=").setParameterLength(2).setName("lessThanEqual"),nwe=ln($a,">=").setParameterLength(2).setName("greaterThanEqual"),rwe=ln($a,"&&").setParameterLength(2,1/0).setName("and"),iwe=ln($a,"||").setParameterLength(2,1/0).setName("or"),swe=ln($a,"!").setParameterLength(1).setName("not"),owe=ln($a,"^^").setParameterLength(2).setName("xor"),awe=ln($a,"&").setParameterLength(2).setName("bitAnd"),lwe=ln($a,"~").setParameterLength(1).setName("bitNot"),cwe=ln($a,"|").setParameterLength(2).setName("bitOr"),uwe=ln($a,"^").setParameterLength(2).setName("bitXor"),dwe=ln($a,"<<").setParameterLength(2).setName("shiftLeft"),hwe=ln($a,">>").setParameterLength(2).setName("shiftRight"),pwe=Ye(([s])=>(s.addAssign(1),s)),fwe=Ye(([s])=>(s.subAssign(1),s)),mwe=Ye(([s])=>{const e=ze(s).toConst();return s.addAssign(1),e}),gwe=Ye(([s])=>{const e=ze(s).toConst();return s.subAssign(1),e});zt("add",Ha);zt("sub",Fi);zt("mul",qr);zt("div",_h);zt("mod",tN);zt("equal",QSe);zt("notEqual",JSe);zt("lessThan",ewe);zt("greaterThan",RZ);zt("lessThanEqual",twe);zt("greaterThanEqual",nwe);zt("and",rwe);zt("or",iwe);zt("not",swe);zt("xor",owe);zt("bitAnd",awe);zt("bitNot",lwe);zt("bitOr",cwe);zt("bitXor",uwe);zt("shiftLeft",dwe);zt("shiftRight",hwe);zt("incrementBefore",pwe);zt("decrementBefore",fwe);zt("increment",mwe);zt("decrement",gwe);const ywe=(s,e)=>(qt('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.',new Ea),tN(ze(s),ze(e)));zt("modInt",ywe);let Dt=class po extends Ho{static get type(){return"MathNode"}constructor(e,t,n=null,r=null){if(super(),(e===po.MAX||e===po.MIN)&&arguments.length>3){let i=new po(e,t,n);for(let o=2;o<arguments.length-1;o++)i=new po(e,i,arguments[o]);t=i,n=arguments[arguments.length-1],r=null}this.method=e,this.aNode=t,this.bNode=n,this.cNode=r,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(n)?0:e.getTypeLength(n),l=e.isMatrix(r)?0:e.getTypeLength(r);return i>o&&i>l?t:o>l?n:l>i?r:t}getNodeType(e){const t=this.method;return t===po.LENGTH||t===po.DISTANCE||t===po.DOT?"float":t===po.CROSS?"vec3":t===po.ALL||t===po.ANY?"bool":t===po.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:n,method:r}=this;let i=null;if(r===po.ONE_MINUS)i=Fi(1,t);else if(r===po.RECIPROCAL)i=_h(1,t);else if(r===po.DIFFERENCE)i=Zs(Fi(t,n));else if(r===po.TRANSFORM_DIRECTION){let o=t,l=n;e.isMatrix(o.getNodeType(e))?l=mr($e(l),0):o=mr($e(o),0);const c=qr(o,l).xyz;i=yd(c)}return i!==null?i:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let r=this.method;const i=this.getNodeType(e),o=this.getInputType(e),l=this.aNode,c=this.bNode,h=this.cNode,m=e.renderer.coordinateSystem;if(r===po.NEGATE)return e.format("( - "+l.build(e,o)+" )",i,t);{const y=[];return r===po.CROSS?y.push(l.build(e,i),c.build(e,i)):m===Tc&&r===po.STEP?y.push(l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":o),c.build(e,o)):m===Tc&&(r===po.MIN||r===po.MAX)?y.push(l.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):r===po.REFRACT?y.push(l.build(e,o),c.build(e,o),h.build(e,"float")):r===po.MIX?y.push(l.build(e,o),c.build(e,o),h.build(e,e.getTypeLength(h.getNodeType(e))===1?"float":o)):(m===xh&&r===po.ATAN&&c!==null&&(r="atan2"),e.shaderStage!=="fragment"&&(r===po.DFDX||r===po.DFDY)&&(qt(`TSL: '${r}' is not supported in the ${e.shaderStage} stage.`,this.stackTrace),r="/*"+r+"*/"),y.push(l.build(e,o)),c!==null&&y.push(c.build(e,o)),h!==null&&y.push(h.build(e,o))),e.format(`${e.getMethod(r,i)}( ${y.join(", ")} )`,i,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}};Dt.ALL="all";Dt.ANY="any";Dt.RADIANS="radians";Dt.DEGREES="degrees";Dt.EXP="exp";Dt.EXP2="exp2";Dt.LOG="log";Dt.LOG2="log2";Dt.SQRT="sqrt";Dt.INVERSE_SQRT="inversesqrt";Dt.FLOOR="floor";Dt.CEIL="ceil";Dt.NORMALIZE="normalize";Dt.FRACT="fract";Dt.SIN="sin";Dt.COS="cos";Dt.TAN="tan";Dt.ASIN="asin";Dt.ACOS="acos";Dt.ATAN="atan";Dt.ABS="abs";Dt.SIGN="sign";Dt.LENGTH="length";Dt.NEGATE="negate";Dt.ONE_MINUS="oneMinus";Dt.DFDX="dFdx";Dt.DFDY="dFdy";Dt.ROUND="round";Dt.RECIPROCAL="reciprocal";Dt.TRUNC="trunc";Dt.FWIDTH="fwidth";Dt.TRANSPOSE="transpose";Dt.DETERMINANT="determinant";Dt.INVERSE="inverse";Dt.EQUALS="equals";Dt.MIN="min";Dt.MAX="max";Dt.STEP="step";Dt.REFLECT="reflect";Dt.DISTANCE="distance";Dt.DIFFERENCE="difference";Dt.DOT="dot";Dt.CROSS="cross";Dt.POW="pow";Dt.TRANSFORM_DIRECTION="transformDirection";Dt.MIX="mix";Dt.CLAMP="clamp";Dt.REFRACT="refract";Dt.SMOOTHSTEP="smoothstep";Dt.FACEFORWARD="faceforward";const IZ=_e(1e-6),TYe=_e(1e6),_F=_e(Math.PI),EYe=_e(Math.PI*2),MYe=_e(Math.PI*2),CYe=_e(Math.PI*.5),vwe=ln(Dt,Dt.ALL).setParameterLength(1),xwe=ln(Dt,Dt.ANY).setParameterLength(1),bwe=ln(Dt,Dt.RADIANS).setParameterLength(1),_we=ln(Dt,Dt.DEGREES).setParameterLength(1),kZ=ln(Dt,Dt.EXP).setParameterLength(1),tw=ln(Dt,Dt.EXP2).setParameterLength(1),mB=ln(Dt,Dt.LOG).setParameterLength(1),vg=ln(Dt,Dt.LOG2).setParameterLength(1),wu=ln(Dt,Dt.SQRT).setParameterLength(1),DZ=ln(Dt,Dt.INVERSE_SQRT).setParameterLength(1),xg=ln(Dt,Dt.FLOOR).setParameterLength(1),gB=ln(Dt,Dt.CEIL).setParameterLength(1),yd=ln(Dt,Dt.NORMALIZE).setParameterLength(1),mm=ln(Dt,Dt.FRACT).setParameterLength(1),mu=ln(Dt,Dt.SIN).setParameterLength(1),sm=ln(Dt,Dt.COS).setParameterLength(1),Swe=ln(Dt,Dt.TAN).setParameterLength(1),wwe=ln(Dt,Dt.ASIN).setParameterLength(1),OZ=ln(Dt,Dt.ACOS).setParameterLength(1),LZ=ln(Dt,Dt.ATAN).setParameterLength(1,2),Zs=ln(Dt,Dt.ABS).setParameterLength(1),FZ=ln(Dt,Dt.SIGN).setParameterLength(1),bg=ln(Dt,Dt.LENGTH).setParameterLength(1),BZ=ln(Dt,Dt.NEGATE).setParameterLength(1),Twe=ln(Dt,Dt.ONE_MINUS).setParameterLength(1),UZ=ln(Dt,Dt.DFDX).setParameterLength(1),zZ=ln(Dt,Dt.DFDY).setParameterLength(1),Ewe=ln(Dt,Dt.ROUND).setParameterLength(1),Mwe=ln(Dt,Dt.RECIPROCAL).setParameterLength(1),VZ=ln(Dt,Dt.TRUNC).setParameterLength(1),GZ=ln(Dt,Dt.FWIDTH).setParameterLength(1),Cwe=ln(Dt,Dt.TRANSPOSE).setParameterLength(1),Awe=ln(Dt,Dt.DETERMINANT).setParameterLength(1),Nwe=ln(Dt,Dt.INVERSE).setParameterLength(1),xd=ln(Dt,Dt.MIN).setParameterLength(2,1/0),Go=ln(Dt,Dt.MAX).setParameterLength(2,1/0),nw=ln(Dt,Dt.STEP).setParameterLength(2),Pwe=ln(Dt,Dt.REFLECT).setParameterLength(2),Rwe=ln(Dt,Dt.DISTANCE).setParameterLength(2),Iwe=ln(Dt,Dt.DIFFERENCE).setParameterLength(2),Np=ln(Dt,Dt.DOT).setParameterLength(2),e9=ln(Dt,Dt.CROSS).setParameterLength(2),wp=ln(Dt,Dt.POW).setParameterLength(2),jZ=s=>qr(s,s),kwe=s=>qr(s,s,s),HZ=s=>qr(s,s,s,s),Dwe=ln(Dt,Dt.TRANSFORM_DIRECTION).setParameterLength(2),Owe=s=>qr(FZ(s),wp(Zs(s),1/3)),$Z=s=>Np(s,s),ki=ln(Dt,Dt.MIX).setParameterLength(3),gm=(s,e=0,t=1)=>new Dt(Dt.CLAMP,Kn(s),Kn(e),Kn(t)),yB=s=>gm(s),WZ=ln(Dt,Dt.REFRACT).setParameterLength(3),ym=ln(Dt,Dt.SMOOTHSTEP).setParameterLength(3),qZ=ln(Dt,Dt.FACEFORWARD).setParameterLength(3),Lwe=Ye(([s])=>{const n=43758.5453,r=Np(s.xy,rn(12.9898,78.233)),i=tN(r,_F);return mm(mu(i).mul(n))}),Fwe=(s,e,t)=>ki(e,t,s),Bwe=(s,e,t)=>ym(e,t,s),Uwe=(s,e)=>nw(e,s),AYe=qZ,NYe=DZ;zt("all",vwe);zt("any",xwe);zt("radians",bwe);zt("degrees",_we);zt("exp",kZ);zt("exp2",tw);zt("log",mB);zt("log2",vg);zt("sqrt",wu);zt("inverseSqrt",DZ);zt("floor",xg);zt("ceil",gB);zt("normalize",yd);zt("fract",mm);zt("sin",mu);zt("cos",sm);zt("tan",Swe);zt("asin",wwe);zt("acos",OZ);zt("atan",LZ);zt("abs",Zs);zt("sign",FZ);zt("length",bg);zt("lengthSq",$Z);zt("negate",BZ);zt("oneMinus",Twe);zt("dFdx",UZ);zt("dFdy",zZ);zt("round",Ewe);zt("reciprocal",Mwe);zt("trunc",VZ);zt("fwidth",GZ);zt("min",xd);zt("max",Go);zt("step",Uwe);zt("reflect",Pwe);zt("distance",Rwe);zt("dot",Np);zt("cross",e9);zt("pow",wp);zt("pow2",jZ);zt("pow3",kwe);zt("pow4",HZ);zt("transformDirection",Dwe);zt("mix",Fwe);zt("clamp",gm);zt("refract",WZ);zt("smoothstep",Bwe);zt("faceForward",qZ);zt("difference",Iwe);zt("saturate",yB);zt("cbrt",Owe);zt("transpose",Cwe);zt("determinant",Awe);zt("inverse",Nwe);zt("rand",Lwe);let PYe=class extends Jn{static get type(){return"ConditionalNode"}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const r=t.getNodeType(e);if(n!==null){const i=n.getNodeType(e);if(e.getTypeLength(i)>e.getTypeLength(r))return i}return r}setup(e){const t=this.condNode,n=this.ifNode.isolate(),r=this.elseNode?this.elseNode.isolate():null,i=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=i,r!==null&&(e.getDataFromNode(r).parentNodeBlock=i);const o=e.context.uniformFlow,l=e.getNodeProperties(this);l.condNode=t,l.ifNode=o?n:n.context({nodeBlock:n}),l.elseNode=r?o?r:r.context({nodeBlock:r}):null}generate(e,t){const n=this.getNodeType(e),r=e.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;const{condNode:i,ifNode:o,elseNode:l}=e.getNodeProperties(this),c=e.currentFunctionNode,h=t!=="void",m=h?Y3(n).build(e):"";r.nodeProperty=m;const y=i.build(e,"bool");if(e.context.uniformFlow&&l!==null){const A=o.build(e,n),I=l.build(e,n),D=e.getTernary(y,A,I);return e.format(D,n,t)}e.addFlowCode(`
${e.tab}if ( ${y} ) {

`).addFlowTab();let w=o.build(e,n);if(w&&(h?w=m+" = "+w+";":(w="return "+w+";",c===null&&(qt("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values.",this.stackTrace),w="// "+w))),e.removeFlowTab().addFlowCode(e.tab+"	"+w+`

`+e.tab+"}"),l!==null){e.addFlowCode(` else {

`).addFlowTab();let A=l.build(e,n);A&&(h?A=m+" = "+A+";":(A="return "+A+";",c===null&&(qt("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values.",this.stackTrace),A="// "+A))),e.removeFlowTab().addFlowCode(e.tab+"	"+A+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(m,n,t)}};const Ec=ri(PYe).setParameterLength(2,3);zt("select",Ec);let zwe=class extends Jn{static get type(){return"ContextNode"}constructor(e=null,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getFlowContextData(){const e=[];return this.traverse(t=>{t.isContextNode===!0&&e.push(t.value)}),Object.assign({},...e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const n=e.addContext(this.value),r=this.node.build(e,t);return e.setContext(n),r}};const s9=(s=null,e={})=>{let t=s;return(t===null||t.isNode!==!0)&&(e=t||e,t=null),new zwe(t,e)},Vwe=s=>s9(s,{uniformFlow:!0}),XZ=(s,e)=>s9(s,{nodeName:e});function Gwe(s,e,t=null){return s9(t,{getShadow:({light:n,shadowColorNode:r})=>e===n?r.mul(s):r})}function jwe(s,e=null){return s9(e,{getAO:(t,{material:n})=>n.transparent===!0?t:t!==null?t.mul(s):s})}function Hwe(s,e){return qt('TSL: "label()" has been deprecated. Use "setName()" instead.'),XZ(s,e)}zt("context",s9);zt("label",Hwe);zt("uniformFlow",Vwe);zt("setName",XZ);zt("builtinShadowContext",(s,e,t)=>Gwe(e,t,s));zt("builtinAOContext",(s,e)=>jwe(e,s));let qL=class extends Jn{static get type(){return"VarNode"}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}isIntent(e){return e.getDataFromNode(this).forceDeclaration===!0?!1:this.intent}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){return e.getDataFromNode(this).assign}build(...e){const t=e[0];if(this._hasStack(t)===!1&&t.buildStage==="setup"&&(t.context.nodeLoop||t.context.nodeBlock)){let n=!1;if(this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&t.fnCall&&t.fnCall.shaderNode&&t.getDataFromNode(this.node.shaderNode).hasLoop){const o=t.getDataFromNode(this);o.forceDeclaration=!0,n=!0}const r=t.getBaseStack();n?r.addToStackBefore(this):r.addToStack(this)}return this.isIntent(t)&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:n,readOnly:r}=this,{renderer:i}=e,o=i.backend.isWebGPUBackend===!0;let l=!1,c=!1;r&&(l=e.isDeterministic(t),c=o?r:l);const h=this.getNodeType(e);if(h=="void")return this.isIntent(e)!==!0&&Ht('TSL: ".toVar()" can not be used with void type.',this.stackTrace),t.build(e);const m=e.getVectorType(h),y=t.build(e,m),b=e.getVarFromNode(this,n,m,void 0,c),w=e.getPropertyName(b);let A=w;if(c)if(o)A=l?`const ${w}`:`let ${w}`;else{const I=t.getArrayCount(e);A=`const ${e.getVar(b.type,w,I)}`}return e.addLineFlowCode(`${A} = ${y}`,this),w}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}};const YZ=ri(qL),$we=(s,e=null)=>YZ(s,e).toStack(),Wwe=(s,e=null)=>YZ(s,e,!0).toStack(),qwe=s=>YZ(s).setIntent(!0).toStack();zt("toVar",$we);zt("toConst",Wwe);zt("toVarIntent",qwe);let RYe=class extends Jn{static get type(){return"SubBuild"}constructor(e,t,n=null){super(n),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const n=this.node.build(e,...t);return e.removeSubBuild(),n}};const tx=(s,e,t=null)=>new RYe(Kn(s),e,t);let IYe=class extends Jn{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=tx(e,"VERTEX"),this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(n===void 0){const r=this.name,i=this.getNodeType(e),o=this.interpolationType,l=this.interpolationSampling;t.varying=n=e.getVaryingFromNode(this,r,i,o,l),t.node=tx(this.node,"VERTEX")}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(CC.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(CC.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),n=e.getNodeProperties(this),r=this.setupVarying(e);if(n[t]===void 0){const i=this.getNodeType(e),o=e.getPropertyName(r,CC.VERTEX);e.flowNodeFromShaderStage(CC.VERTEX,n.node,i,o),n[t]=o}return e.getPropertyName(r)}};const w5=ri(IYe).setParameterLength(1,2),Xwe=s=>w5(s);zt("toVarying",w5);zt("toVertexStage",Xwe);const Ywe=Ye(([s])=>{const e=s.mul(.9478672986).add(.0521327014).pow(2.4),t=s.mul(.0773993808),n=s.lessThanEqual(.04045);return ki(e,t,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Kwe=Ye(([s])=>{const e=s.pow(.41666).mul(1.055).sub(.055),t=s.mul(12.92),n=s.lessThanEqual(.0031308);return ki(e,t,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),KZ="WorkingColorSpace",kYe="OutputColorSpace";let ZZ=class extends Ho{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===KZ?Zn.workingColorSpace:t===kYe?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let i=t;return Zn.enabled===!1||n===r||!n||!r||(Zn.getTransfer(n)===Yn&&(i=mr(Ywe(i.rgb),i.a)),Zn.getPrimaries(n)!==Zn.getPrimaries(r)&&(i=mr(o0(Zn._getMatrix(new ci,n,r)).mul(i.rgb),i.a)),Zn.getTransfer(r)===Yn&&(i=mr(Kwe(i.rgb),i.a))),i}};const Zwe=(s,e)=>new ZZ(Kn(s),KZ,e),vB=(s,e)=>new ZZ(Kn(s),e,KZ),DYe=(s,e,t)=>new ZZ(Kn(s),e,t);zt("workingToColorSpace",Zwe);zt("colorSpaceToWorking",vB);let OYe=class extends bx{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}},Qwe=class extends Jn{static get type(){return"ReferenceBaseNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=Wr.OBJECT}setGroup(e){return this.group=e,this}element(e){return new OYe(this,Kn(e))}setNodeType(e){const t=cr(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}};const LYe=(s,e,t)=>new Qwe(s,e,t);let FYe=class extends Qwe{static get type(){return"RendererReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(gr)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}};const Jwe=(s,e,t=null)=>new FYe(s,e,t);let BYe=class extends Ho{static get type(){return"ToneMappingNode"}constructor(e,t=tTe,n=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return GC(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,n=this._toneMapping;if(n===Ta)return t;let r=null;const i=e.renderer.library.getToneMappingFunction(n);return i!==null?r=mr(i(t.rgb,this.exposureNode),t.a):(Ht("ToneMappingNode: Unsupported Tone Mapping configuration.",n),r=t),r}};const eTe=(s,e,t)=>new BYe(s,Kn(e),Kn(t)),tTe=Jwe("toneMappingExposure","float");zt("toneMapping",(s,e,t)=>eTe(e,t,s));const xxe=new WeakMap;function bxe(s,e){let t=xxe.get(s);return t===void 0&&(t=new X_e(s,e),xxe.set(s,t)),t}let Ny=class extends gZ{static get type(){return"BufferAttributeNode"}constructor(e,t=null,n=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=r,this.usage=ZS,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&e.itemSize<=4&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),n=e.getTypeLength(t),r=this.value,i=this.bufferStride||n,o=this.bufferOffset;let l;r.isInterleavedBuffer===!0?l=r:r.isBufferAttribute===!0?l=bxe(r.array,i):l=bxe(r,i);const c=new iGe(l,n,o);l.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(n);let i=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=r,i=r):i=w5(this).build(e,t),i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}};function xB(s,e=null,t=0,n=0,r=ZS,i=!1){return e==="mat3"||e===null&&s.itemSize===9?o0(new Ny(s,"vec3",9,0).setUsage(r).setInstanced(i),new Ny(s,"vec3",9,3).setUsage(r).setInstanced(i),new Ny(s,"vec3",9,6).setUsage(r).setInstanced(i)):e==="mat4"||e===null&&s.itemSize===16?o5(new Ny(s,"vec4",16,0).setUsage(r).setInstanced(i),new Ny(s,"vec4",16,4).setUsage(r).setInstanced(i),new Ny(s,"vec4",16,8).setUsage(r).setInstanced(i),new Ny(s,"vec4",16,12).setUsage(r).setInstanced(i)):new Ny(s,e,t,n).setUsage(r)}const QZ=(s,e=null,t=0,n=0)=>xB(s,e,t,n),UYe=(s,e=null,t=0,n=0)=>xB(s,e,t,n,vA),SF=(s,e=null,t=0,n=0)=>xB(s,e,t,n,ZS,!0),XY=(s,e=null,t=0,n=0)=>xB(s,e,t,n,vA,!0);zt("toAttribute",s=>QZ(s.value));let zYe=class extends Jn{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=Wr.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return qt('TSL: "label()" has been deprecated. Use "setName()" instead.',new Ea),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const n=e.getNodeProperties(this);n.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:n}=e;if(n==="compute"){const r=this.computeNode.build(e,"void");r!==""&&e.addLineFlowCode(r,this)}else{const i=e.getNodeProperties(this).outputComputeNode;if(i)return i.build(e,t)}}};const JZ=(s,e=[64])=>{(e.length===0||e.length>3)&&Ht("TSL: compute() workgroupSize must have 1, 2, or 3 elements",new Ea);for(let t=0;t<e.length;t++){const n=e[t];(typeof n!="number"||n<=0||!Number.isInteger(n))&&Ht(`TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`,new Ea)}for(;e.length<3;)e.push(1);return new zYe(Kn(s),e)},nTe=(s,e,t)=>JZ(s,t).setCount(e);zt("compute",nTe);zt("computeKernel",JZ);let VYe=class extends Jn{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){const n=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const i=this.node.build(e,...t);return e.setCache(n),i}setParent(e){return this.parent=e,this}getParent(){return this.parent}};const _S=s=>new VYe(Kn(s));function rTe(s,e=!0){return qt('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),_S(s).setParent(e)}zt("cache",rTe);zt("isolate",_S);let GYe=class extends Jn{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}};const iTe=ri(GYe).setParameterLength(2);zt("bypass",iTe);let sTe=class extends Jn{static get type(){return"RemapNode"}constructor(e,t,n,r=_e(0),i=_e(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=r,this.outHighNode=i,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:r,outHighNode:i,doClamp:o}=this;let l=e.sub(t).div(n.sub(t));return o===!0&&(l=l.clamp()),l.mul(i.sub(r)).add(r)}};const oTe=ri(sTe,null,null,{doClamp:!1}).setParameterLength(3,5),aTe=ri(sTe).setParameterLength(3,5);zt("remap",oTe);zt("remapClamp",aTe);let XL=class extends Jn{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const n=this.getNodeType(e),r=this.snippet;if(n==="void")e.addLineFlowCode(r,this);else return e.format(r,n,t)}};const pm=ri(XL).setParameterLength(1,2),lTe=s=>(s?Ec(s,pm("discard")):pm("discard")).toStack(),jYe=()=>pm("return").toStack();zt("discard",lTe);let HYe=class extends Ho{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const n=(this._toneMapping!==null?this._toneMapping:e.toneMapping)||Ta,r=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||gu;return n!==Ta&&(t=t.toneMapping(n)),r!==gu&&r!==Zn.workingColorSpace&&(t=t.workingToColorSpace(r)),t}};const eQ=(s,e=null,t=null)=>new HYe(Kn(s),e,t);zt("renderOutput",eQ);let $Ye=class extends Ho{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,n=this.node.build(e);if(t!==null)t(e,n);else{const r="--- TSL debug - "+e.shaderStage+" shader ---",i="-".repeat(r.length);let o="";o+="// #"+r+`#
`,o+=e.flow.code.replace(/^\t/mg,"")+`
`,o+="/* ... */ "+n+` /* ... */
`,o+="// #"+i+`#
`,_A(o)}return n}};const cTe=(s,e=null)=>new $Ye(Kn(s),e).toStack();zt("debug",cTe);let tQ=class{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}},WYe=class extends Jn{static get type(){return"InspectorNode"}constructor(e,t="",n=null){super(),this.node=e,this.name=t,this.callback=n,this.updateType=Wr.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==tQ&&es('TSL: ".toInspector()" is only available with WebGPU.'),t}};function uTe(s,e="",t=null){return s=Kn(s),s.before(new WYe(s,e,t))}zt("toInspector",uTe);function qYe(s){qt("TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",s)}let dTe=class extends Jn{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const r=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const i=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(i),l=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(l.name,o,n):w5(this).build(e,n)}else return qt(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}};const t9=(s,e=null)=>new dTe(s,e),Os=(s=0)=>t9("uv"+(s>0?s:""),"vec2");let XYe=class extends Jn{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),r=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${r} )`,this.getNodeType(e),t)}};const a5=ri(XYe).setParameterLength(1,2);let YYe=class extends eN{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Wr.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&n.width!==void 0){const{width:r,height:i}=n;this.value=Math.log2(Math.max(r,i))}}};const nQ=ri(YYe).setParameterLength(1);let hTe=class extends Error{constructor(e,t=null){super(e),this.name="NodeError",this.stackTrace=t}};const rQ=new ol;let Cg=class extends eN{static get type(){return"TextureNode"}constructor(e=rQ,t=null,n=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Wr.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Ds?"uvec4":this.value.type===r0?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Os(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=cr(this.value.matrix)),this._matrixUniform.mul($e(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=cr(!1)),t=t.toVar(),this.sampler?t=this._flipYUniform.select(t.flipY(),t):t=this._flipYUniform.select(t.setY(ze(a5(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new hTe("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().",this.stackTrace);const r=Ye(()=>{let c=this.uvNode;return(c===null||e.context.forceUVContext===!0)&&e.context.getUV&&(c=e.context.getUV(this,e)),c||(c=this.getDefaultUV()),this.updateMatrix===!0&&(c=this.getTransformedUV(c)),c=this.setupUV(e,c),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?Wr.OBJECT:Wr.NONE,c})();let i=this.levelNode;i===null&&e.context.getTextureLevel&&(i=e.context.getTextureLevel(this));let o=null,l=null;this.compareNode!==null&&(e.renderer.hasCompatibility(i5.TEXTURE_COMPARE)?o=this.compareNode:this.value.compareFunction===null||this.value.compareFunction===rB?l=this.compareNode:(o=this.compareNode,es('TSL: Only "LessCompare" is supported for depth texture comparison fallback.'))),t.uvNode=r,t.levelNode=i,t.biasNode=this.biasNode,t.compareNode=o,t.compareStepNode=l,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,n,r,i,o,l,c,h){const m=this.value;let y;return i?y=e.generateTextureBias(m,t,n,i,o,h):c?y=e.generateTextureGrad(m,t,n,c,o,h):l?y=e.generateTextureCompare(m,t,n,l,o,h):this.sampler===!1?y=e.generateTextureLoad(m,t,n,r,o,h):r?y=e.generateTextureLevel(m,t,n,r,o,h):y=e.generateTexture(m,t,n,o,h),y}generate(e,t){const n=this.value,r=e.getNodeProperties(this),i=super.generate(e,"property");if(/^sampler/.test(t))return i+"_sampler";if(e.isReference(t))return i;{const o=e.getDataFromNode(this),l=this.getNodeType(e);let c=o.propertyName;if(c===void 0){const{uvNode:m,levelNode:y,biasNode:b,compareNode:w,compareStepNode:A,depthNode:I,gradNode:D,offsetNode:P}=r,U=this.generateUV(e,m),j=y?y.build(e,"float"):null,C=b?b.build(e,"float"):null,Z=I?I.build(e,"int"):null,ie=w?w.build(e,"float"):null,se=A?A.build(e,"float"):null,z=D?[D[0].build(e,"vec2"),D[1].build(e,"vec2")]:null,re=P?this.generateOffset(e,P):null,ye=e.getVarFromNode(this);c=e.getPropertyName(ye);let H=this.generateSnippet(e,i,U,j,C,Z,ie,z,re);se!==null&&(H=nw(pm(se,"float"),pm(H,l)).build(e,l)),e.addLineFlowCode(`${c} = ${H}`,this),o.snippet=H,o.propertyName=c}let h=c;return e.needsToWorkingColorSpace(n)&&(h=vB(pm(h,l),n.colorSpace).setup(e).build(e,l)),e.format(h,l,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}sample(e){const t=this.clone();return t.uvNode=Kn(e),t.referenceNode=this.getBase(),Kn(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=Kn(e).mul(nQ(t)),t.referenceNode=this.getBase();const n=t.value;return t.generateMipmaps===!1&&(n&&n.generateMipmaps===!1||n.minFilter===Yi||n.magFilter===Yi)&&(qt("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),Kn(t)}level(e){const t=this.clone();return t.levelNode=Kn(e),t.referenceNode=this.getBase(),Kn(t)}size(e){return a5(this,e)}bias(e){const t=this.clone();return t.biasNode=Kn(e),t.referenceNode=this.getBase(),Kn(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=Kn(e),t.referenceNode=this.getBase(),Kn(t)}grad(e,t){const n=this.clone();return n.gradNode=[Kn(e),Kn(t)],n.referenceNode=this.getBase(),Kn(n)}depth(e){const t=this.clone();return t.depthNode=Kn(e),t.referenceNode=this.getBase(),Kn(t)}offset(e){const t=this.clone();return t.offsetNode=Kn(e),t.referenceNode=this.getBase(),Kn(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();const n=this._flipYUniform;n!==null&&(n.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}};const KYe=ri(Cg).setParameterLength(1,4).setName("texture"),ts=(s=rQ,e=null,t=null,n=null)=>{let r;return s&&s.isTextureNode===!0?(r=Kn(s.clone()),r.referenceNode=s.getBase(),e!==null&&(r.uvNode=Kn(e)),t!==null&&(r.levelNode=Kn(t)),n!==null&&(r.biasNode=Kn(n))):r=KYe(s,e,t,n),r},ZYe=(s=rQ)=>ts(s),sa=(...s)=>ts(...s).setSampler(!1),QYe=(s,e,t)=>ts(s,e).level(t),JYe=s=>(s.isNode===!0?s:ts(s)).convert("sampler"),eKe=s=>(s.isNode===!0?s:ts(s)).convert("samplerComparison");let iQ=class extends eN{static get type(){return"BufferNode"}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n,this.updateRanges=[]}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}};const nN=(s,e,t)=>new iQ(s,e,t);let tKe=class extends bx{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,n)}},nKe=class extends iQ{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?Zy(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Wr.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let r=0;r<e.length;r++){const i=r*4;t[i]=e[r]}else if(n==="color")for(let r=0;r<e.length;r++){const i=r*4,o=e[r];t[i]=o.r,t[i+1]=o.g,t[i+2]=o.b||0}else if(n==="mat2")for(let r=0;r<e.length;r++){const i=r*4,o=e[r];t[i]=o.elements[0],t[i+1]=o.elements[1],t[i+2]=o.elements[2],t[i+3]=o.elements[3]}else if(n==="mat3")for(let r=0;r<e.length;r++){const i=r*16,o=e[r];t[i]=o.elements[0],t[i+1]=o.elements[1],t[i+2]=o.elements[2],t[i+4]=o.elements[3],t[i+5]=o.elements[4],t[i+6]=o.elements[5],t[i+8]=o.elements[6],t[i+9]=o.elements[7],t[i+10]=o.elements[8],t[i+15]=1}else if(n==="mat4")for(let r=0;r<e.length;r++){const i=r*16,o=e[r];for(let l=0;l<o.elements.length;l++)t[i+l]=o.elements[l]}else for(let r=0;r<e.length;r++){const i=r*4,o=e[r];t[i]=o.x,t[i+1]=o.y,t[i+2]=o.z||0,t[i+3]=o.w||0}}setup(e){const t=this.array.length,n=this.elementType;let r=Float32Array;const i=this.paddedType,o=e.getTypeLength(i);return n.charAt(0)==="i"&&(r=Int32Array),n.charAt(0)==="u"&&(r=Uint32Array),this.value=new r(t*o),this.bufferCount=t,this.bufferType=i,this.update(),super.setup(e)}element(e){return new tKe(this,Kn(e))}};const wc=(s,e)=>new nKe(s,e);let rKe=class extends Jn{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}};const o9=ri(rKe).setParameterLength(1);let WM,qM,Tu=class xp extends Jn{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===xp.DPR?"float":this.scope===xp.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Wr.NONE;return(this.scope===xp.SIZE||this.scope===xp.VIEWPORT||this.scope===xp.DPR)&&(e=Wr.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===xp.VIEWPORT?t!==null?qM.copy(t.viewport):(e.getViewport(qM),qM.multiplyScalar(e.getPixelRatio())):this.scope===xp.DPR?this._output.value=e.getPixelRatio():t!==null?(WM.width=t.width,WM.height=t.height):e.getDrawingBufferSize(WM)}setup(){const e=this.scope;let t=null;return e===xp.SIZE?t=cr(WM||(WM=new Ln)):e===xp.VIEWPORT?t=cr(qM||(qM=new zr)):e===xp.DPR?t=cr(1):t=rn(Sx.div(hx)),this._output=t,t}generate(e){if(this.scope===xp.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(hx).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}};Tu.COORDINATE="coordinate";Tu.VIEWPORT="viewport";Tu.SIZE="size";Tu.UV="uv";Tu.DPR="dpr";const pTe=Cn(Tu,Tu.DPR),_g=Cn(Tu,Tu.UV),hx=Cn(Tu,Tu.SIZE),Sx=Cn(Tu,Tu.COORDINATE),sQ=Cn(Tu,Tu.VIEWPORT),oQ=sQ.zw,fTe=Sx.sub(sQ.xy),iKe=fTe.div(oQ),sKe=Ye(()=>(qt('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.',new Ea),hx),"vec2").once()();let Fq=null,MO=null,Bq=null,CO=null,Uq=null,AO=null,zq=null,NO=null,Vq=null,PO=null,Gq=null,RO=null,jq=null,IO=null;const T5=cr(0,"uint").setName("u_cameraIndex").setGroup(fB("cameraIndex")).toVarying("v_cameraIndex"),Wy=cr("float").setName("cameraNear").setGroup(gr).onRenderUpdate(({camera:s})=>s.near),qy=cr("float").setName("cameraFar").setGroup(gr).onRenderUpdate(({camera:s})=>s.far),K3=Ye(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const n of s.cameras)t.push(n.projectionMatrix);MO===null?MO=wc(t).setGroup(gr).setName("cameraProjectionMatrices"):MO.array=t,e=MO.element(s.isMultiViewCamera?o9("gl_ViewID_OVR"):T5).toConst("cameraProjectionMatrix")}else Fq===null&&(Fq=cr(s.projectionMatrix).setName("cameraProjectionMatrix").setGroup(gr).onRenderUpdate(({camera:t})=>t.projectionMatrix)),e=Fq;return e}).once()(),mTe=Ye(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const n of s.cameras)t.push(n.projectionMatrixInverse);CO===null?CO=wc(t).setGroup(gr).setName("cameraProjectionMatricesInverse"):CO.array=t,e=CO.element(s.isMultiViewCamera?o9("gl_ViewID_OVR"):T5).toConst("cameraProjectionMatrixInverse")}else Bq===null&&(Bq=cr(s.projectionMatrixInverse).setName("cameraProjectionMatrixInverse").setGroup(gr).onRenderUpdate(({camera:t})=>t.projectionMatrixInverse)),e=Bq;return e}).once()(),Fp=Ye(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const n of s.cameras)t.push(n.matrixWorldInverse);AO===null?AO=wc(t).setGroup(gr).setName("cameraViewMatrices"):AO.array=t,e=AO.element(s.isMultiViewCamera?o9("gl_ViewID_OVR"):T5).toConst("cameraViewMatrix")}else Uq===null&&(Uq=cr(s.matrixWorldInverse).setName("cameraViewMatrix").setGroup(gr).onRenderUpdate(({camera:t})=>t.matrixWorldInverse)),e=Uq;return e}).once()(),oKe=Ye(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const n of s.cameras)t.push(n.matrixWorld);NO===null?NO=wc(t).setGroup(gr).setName("cameraWorldMatrices"):NO.array=t,e=NO.element(s.isMultiViewCamera?o9("gl_ViewID_OVR"):T5).toConst("cameraWorldMatrix")}else zq===null&&(zq=cr(s.matrixWorld).setName("cameraWorldMatrix").setGroup(gr).onRenderUpdate(({camera:t})=>t.matrixWorld)),e=zq;return e}).once()(),aKe=Ye(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const n of s.cameras)t.push(n.normalMatrix);PO===null?PO=wc(t).setGroup(gr).setName("cameraNormalMatrices"):PO.array=t,e=PO.element(s.isMultiViewCamera?o9("gl_ViewID_OVR"):T5).toConst("cameraNormalMatrix")}else Vq===null&&(Vq=cr(s.normalMatrix).setName("cameraNormalMatrix").setGroup(gr).onRenderUpdate(({camera:t})=>t.normalMatrix)),e=Vq;return e}).once()(),gTe=Ye(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(let n=0,r=s.cameras.length;n<r;n++)t.push(new be);RO===null?RO=wc(t).setGroup(gr).setName("cameraPositions").onRenderUpdate(({camera:n},r)=>{const i=n.cameras,o=r.array;for(let l=0,c=i.length;l<c;l++)o[l].setFromMatrixPosition(i[l].matrixWorld)}):RO.array=t,e=RO.element(s.isMultiViewCamera?o9("gl_ViewID_OVR"):T5).toConst("cameraPosition")}else Gq===null&&(Gq=cr(new be).setName("cameraPosition").setGroup(gr).onRenderUpdate(({camera:t},n)=>n.value.setFromMatrixPosition(t.matrixWorld))),e=Gq;return e}).once()(),lKe=Ye(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const n of s.cameras)t.push(n.viewport);IO===null?IO=wc(t,"vec4").setGroup(gr).setName("cameraViewports"):IO.array=t,e=IO.element(T5).toConst("cameraViewport")}else jq===null&&(jq=mr(0,0,hx.x,hx.y).toConst("cameraViewport")),e=jq;return e}).once()(),_xe=new xm;let Al=class vl extends Jn{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Wr.OBJECT,this.uniformNode=new eN(null)}getNodeType(){const e=this.scope;if(e===vl.WORLD_MATRIX)return"mat4";if(e===vl.POSITION||e===vl.VIEW_POSITION||e===vl.DIRECTION||e===vl.SCALE)return"vec3";if(e===vl.RADIUS)return"float"}update(e){const t=this.object3d,n=this.uniformNode,r=this.scope;if(r===vl.WORLD_MATRIX)n.value=t.matrixWorld;else if(r===vl.POSITION)n.value=n.value||new be,n.value.setFromMatrixPosition(t.matrixWorld);else if(r===vl.SCALE)n.value=n.value||new be,n.value.setFromMatrixScale(t.matrixWorld);else if(r===vl.DIRECTION)n.value=n.value||new be,t.getWorldDirection(n.value);else if(r===vl.VIEW_POSITION){const i=e.camera;n.value=n.value||new be,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(i.matrixWorldInverse)}else if(r===vl.RADIUS){const i=e.object.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),_xe.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),n.value=_xe.radius}}generate(e){const t=this.scope;return t===vl.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===vl.POSITION||t===vl.VIEW_POSITION||t===vl.DIRECTION||t===vl.SCALE?this.uniformNode.nodeType="vec3":t===vl.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}};Al.WORLD_MATRIX="worldMatrix";Al.POSITION="position";Al.SCALE="scale";Al.VIEW_POSITION="viewPosition";Al.DIRECTION="direction";Al.RADIUS="radius";const cKe=ri(Al,Al.DIRECTION).setParameterLength(1),uKe=ri(Al,Al.WORLD_MATRIX).setParameterLength(1),dKe=ri(Al,Al.POSITION).setParameterLength(1),hKe=ri(Al,Al.SCALE).setParameterLength(1),pKe=ri(Al,Al.VIEW_POSITION).setParameterLength(1),fKe=ri(Al,Al.RADIUS).setParameterLength(1);let Pp=class extends Al{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}};const mKe=Cn(Pp,Pp.DIRECTION),Tp=Cn(Pp,Pp.WORLD_MATRIX),gKe=Cn(Pp,Pp.POSITION),yKe=Cn(Pp,Pp.SCALE),vKe=Cn(Pp,Pp.VIEW_POSITION),xKe=Cn(Pp,Pp.RADIUS),yTe=cr(new ci).onObjectUpdate(({object:s},e)=>e.value.getNormalMatrix(s.matrixWorld)),bKe=cr(new Pn).onObjectUpdate(({object:s},e)=>e.value.copy(s.matrixWorld).invert()),E5=Ye(s=>s.context.modelViewMatrix||vTe).once()().toVar("modelViewMatrix"),vTe=Fp.mul(Tp),YY=Ye(s=>(s.context.isHighPrecisionModelViewMatrix=!0,cr("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),KY=Ye(s=>{const e=s.context.isHighPrecisionModelViewMatrix;return cr("mat3").onObjectUpdate(({object:t,camera:n})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),xTe=Ye(s=>s.shaderStage!=="fragment"?(es("TSL: `clipSpace` is only available in fragment stage."),mr()):s.context.clipSpace.toVarying("v_clipSpace")).once()(),rN=t9("position","vec3"),Vo=rN.toVarying("positionLocal"),rw=rN.toVarying("positionPrevious"),Sg=Ye(s=>Tp.mul(Vo).xyz.toVarying(s.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),aQ=Ye(()=>Vo.transformDirection(Tp).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),wa=Ye(s=>{if(s.shaderStage==="fragment"&&s.material.vertexNode){const e=mTe.mul(xTe);return e.xyz.div(e.w).toVar("positionView")}return s.context.setupPositionView().toVarying("v_positionView")},"vec3").once(["POSITION","VERTEX"])(),Hs=Ye(s=>{let e;return s.camera.isOrthographicCamera?e=$e(0,0,1):e=wa.negate().toVarying("v_positionViewDirection").normalize(),e.toVar("positionViewDirection")},"vec3").once(["POSITION"])();let _Ke=class extends Jn{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===bs?"false":e.getFrontFacing()}};const bTe=Cn(_Ke),lQ=_e(bTe).mul(2).sub(1),Ew=Ye(([s],{material:e})=>{const t=e.side;return t===bs?s=s.mul(-1):t===oa&&(s=s.mul(lQ)),s}),bB=t9("normal","vec3"),bd=Ye(s=>s.geometry.hasAttribute("normal")===!1?(qt('TSL: Vertex attribute "normal" not found on geometry.'),$e(0,1,0)):bB,"vec3").once()().toVar("normalLocal"),_Te=wa.dFdx().cross(wa.dFdy()).normalize().toVar("normalFlat"),iw=Ye(s=>{let e;return s.isFlatShading()?e=_Te:e=cQ(bd).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),STe=Ye(s=>{let e=iw.transformDirection(Fp);return s.isFlatShading()!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),qi=Ye(s=>{let e;return s.subBuildFn==="NORMAL"||s.subBuildFn==="VERTEX"?(e=iw,s.isFlatShading()!==!0&&(e=Ew(e))):e=s.context.setupNormal().context({getUV:null,getTextureLevel:null}),e},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),M5=qi.transformDirection(Fp).toVar("normalWorld"),Xy=Ye(({subBuildFn:s,context:e})=>{let t;return s==="NORMAL"||s==="VERTEX"?t=qi:t=e.setupClearcoatNormal().context({getUV:null,getTextureLevel:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),wTe=Ye(([s,e=Tp])=>{const t=o0(e),n=s.div($e(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(n).xyz}),cQ=Ye(([s],e)=>{const t=e.context.modelNormalViewMatrix;if(t)return t.transformDirection(s);const n=yTe.mul(s);return Fp.transformDirection(n)}),SKe=Ye(()=>(qt('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),qi)).once(["NORMAL","VERTEX"])(),wKe=Ye(()=>(qt('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),M5)).once(["NORMAL","VERTEX"])(),TKe=Ye(()=>(qt('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),Xy)).once(["NORMAL","VERTEX"])(),Sxe=new Sa,Hq=new Pn,TTe=cr(0).onReference(({material:s})=>s).onObjectUpdate(({material:s})=>s.refractionRatio),YL=cr(1).onReference(({material:s})=>s).onObjectUpdate(function({material:s,scene:e}){return s.envMap?s.envMapIntensity:e.environmentIntensity}),uQ=cr(new Pn).onReference(function(s){return s.material}).onObjectUpdate(function({material:s,scene:e}){const t=e.environment!==null&&s.envMap===null?e.environmentRotation:s.envMapRotation;return t?(Sxe.copy(t),Hq.makeRotationFromEuler(Sxe)):Hq.identity(),Hq}),ETe=Hs.negate().reflect(qi),MTe=Hs.negate().refract(qi,TTe),CTe=ETe.transformDirection(Fp).toVar("reflectVector"),ATe=MTe.transformDirection(Fp).toVar("reflectVector"),NTe=new yx;let EKe=class extends Cg{static get type(){return"CubeTextureNode"}constructor(e,t=null,n=null,r=null){super(e,t,n,r),this.isCubeTextureNode=!0}getInputType(){return this.value.isDepthTexture===!0?"cubeDepthTexture":"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===fm?CTe:e.mapping===Eg?ATe:(Ht('CubeTextureNode: Mapping "%s" not supported.',e.mapping),$e(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return n.isDepthTexture===!0?e.renderer.coordinateSystem===xh?$e(t.x,t.y.negate(),t.z):t:((e.renderer.coordinateSystem===xh||!n.isRenderTargetTexture)&&(t=$e(t.x.negate(),t.yz)),uQ.mul(t))}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}};const dQ=ri(EKe).setParameterLength(1,4).setName("cubeTexture"),vu=(s=NTe,e=null,t=null,n=null)=>{let r;return s&&s.isCubeTextureNode===!0?(r=Kn(s.clone()),r.referenceNode=s,e!==null&&(r.uvNode=Kn(e)),t!==null&&(r.levelNode=Kn(t)),n!==null&&(r.biasNode=Kn(n))):r=dQ(s,e,t,n),r},MKe=(s=NTe)=>dQ(s);let CKe=class extends bx{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}},_B=class extends Jn{static get type(){return"ReferenceNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=Wr.OBJECT}element(e){return new CKe(this,Kn(e))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return qt('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=nN(null,e,this.count):Array.isArray(this.getValueFromReference())?t=wc(null,e):e==="texture"?t=ts(null):e==="cubeTexture"?t=vu(null):t=cr(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}};const go=(s,e,t)=>new _B(s,e,t),ZY=(s,e,t,n)=>new _B(s,e,n,t);let AKe=class extends _B{static get type(){return"MaterialReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}};const F3=(s,e,t=null)=>new AKe(s,e,t),PTe=Os(),NKe=wa.dFdx(),PKe=wa.dFdy(),RTe=PTe.dFdx(),ITe=PTe.dFdy(),kTe=qi,DTe=PKe.cross(kTe),OTe=kTe.cross(NKe),QY=DTe.mul(RTe.x).add(OTe.mul(ITe.x)),JY=DTe.mul(RTe.y).add(OTe.mul(ITe.y)),wxe=QY.dot(QY).max(JY.dot(JY)),LTe=wxe.equal(0).select(0,wxe.inverseSqrt()),RKe=QY.mul(LTe).toVar("tangentViewFrame"),IKe=JY.mul(LTe).toVar("bitangentViewFrame"),SB=t9("tangent","vec4"),sw=SB.xyz.toVar("tangentLocal"),wB=Ye(s=>{let e;return s.subBuildFn==="VERTEX"||s.geometry.hasAttribute("tangent")?e=E5.mul(mr(sw,0)).xyz.toVarying("v_tangentView").normalize():e=RKe,s.isFlatShading()!==!0&&(e=Ew(e)),e},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),FTe=wB.transformDirection(Fp).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),TB=Ye(([s,e],t)=>{let n=s.mul(SB.w).xyz;return t.subBuildFn==="NORMAL"&&t.isFlatShading()!==!0&&(n=n.toVarying(e)),n}).once(["NORMAL"]),kKe=TB(bB.cross(SB),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),DKe=TB(bd.cross(sw),"v_bitangentLocal").normalize().toVar("bitangentLocal"),BTe=Ye(s=>{let e;return s.subBuildFn==="VERTEX"||s.geometry.hasAttribute("tangent")?e=TB(qi.cross(wB),"v_bitangentView").normalize():e=IKe,s.isFlatShading()!==!0&&(e=Ew(e)),e},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),OKe=TB(M5.cross(FTe),"v_bitangentWorld").normalize().toVar("bitangentWorld"),X6=o0(wB,BTe,qi).toVar("TBNViewMatrix"),UTe=Hs.mul(X6),LKe=(s,e)=>s.sub(UTe.mul(e)),zTe=Ye(()=>{let s=ex.cross(Hs);return s=s.cross(ex).normalize(),s=ki(s,qi,jy.mul(fg.oneMinus()).oneMinus().pow2().pow2()).normalize(),s}).once()(),VTe=s=>Kn(s).mul(.5).add(.5),FKe=s=>Kn(s).mul(2).sub(1),eK=s=>$e(s,wu(yB(_e(1).sub(Np(s,s)))));let BKe=class extends Ho{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=yg,this.unpackNormalMode=KW}setup(e){const{normalMapType:t,scaleNode:n,unpackNormalMode:r}=this;let i=this.node.mul(2).sub(1);if(t===yg?r===F_e?i=eK(i.xy):r===lVe?i=eK(i.yw):r!==KW&&console.error(`THREE.NodeMaterial: Unexpected unpack normal mode: ${r}`):r!==KW&&console.error(`THREE.NodeMaterial: Normal map type '${t}' is not compatible with unpack normal mode '${r}'`),n!==null){let l=n;e.isFlatShading()===!0&&(l=Ew(l)),i=$e(i.xy.mul(l),i.z)}let o=null;return t===L_e?o=cQ(i):t===yg?o=X6.mul(i).normalize():(Ht(`NodeMaterial: Unsupported normal map type: ${t}`),o=qi),o}};const tK=ri(BKe).setParameterLength(1,2),UKe=Ye(({textureNode:s,bumpScale:e})=>{const t=r=>s.isolate().context({getUV:i=>r(i.uvNode||Os()),forceUVContext:!0}),n=_e(t(r=>r));return rn(_e(t(r=>r.add(r.dFdx()))).sub(n),_e(t(r=>r.add(r.dFdy()))).sub(n)).mul(e)}),zKe=Ye(s=>{const{surf_pos:e,surf_norm:t,dHdxy:n}=s,r=e.dFdx().normalize(),i=e.dFdy().normalize(),o=t,l=i.cross(o),c=o.cross(r),h=r.dot(l).mul(lQ),m=h.sign().mul(n.x.mul(l).add(n.y.mul(c)));return h.abs().mul(t).sub(m).normalize()});let VKe=class extends Ho{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=UKe({textureNode:this.textureNode,bumpScale:e});return zKe({surf_pos:wa,surf_norm:qi,dHdxy:t})}};const hQ=ri(VKe).setParameterLength(1,2),Txe=new Map;let nn=class ia extends Jn{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=Txe.get(e);return n===void 0&&(n=F3(e,t),Txe.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let r=null;if(n===ia.COLOR){const i=t.color!==void 0?this.getColor(n):$e();t.map&&t.map.isTexture===!0?r=i.mul(this.getTexture("map")):r=i}else if(n===ia.OPACITY){const i=this.getFloat(n);t.alphaMap&&t.alphaMap.isTexture===!0?r=i.mul(this.getTexture("alpha")):r=i}else if(n===ia.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?r=this.getTexture("specular").r:r=_e(1);else if(n===ia.SPECULAR_INTENSITY){const i=this.getFloat(n);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?r=i.mul(this.getTexture(n).a):r=i}else if(n===ia.SPECULAR_COLOR){const i=this.getColor(n);t.specularColorMap&&t.specularColorMap.isTexture===!0?r=i.mul(this.getTexture(n).rgb):r=i}else if(n===ia.ROUGHNESS){const i=this.getFloat(n);t.roughnessMap&&t.roughnessMap.isTexture===!0?r=i.mul(this.getTexture(n).g):r=i}else if(n===ia.METALNESS){const i=this.getFloat(n);t.metalnessMap&&t.metalnessMap.isTexture===!0?r=i.mul(this.getTexture(n).b):r=i}else if(n===ia.EMISSIVE){const i=this.getFloat("emissiveIntensity"),o=this.getColor(n).mul(i);t.emissiveMap&&t.emissiveMap.isTexture===!0?r=o.mul(this.getTexture(n)):r=o}else if(n===ia.NORMAL)t.normalMap?(r=tK(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType,(t.normalMap.format==Su||t.normalMap.format==lx||t.normalMap.format==ax)&&(r.unpackNormalMode=F_e)):t.bumpMap?r=hQ(this.getTexture("bump").r,this.getFloat("bumpScale")):r=qi;else if(n===ia.CLEARCOAT){const i=this.getFloat(n);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?r=i.mul(this.getTexture(n).r):r=i}else if(n===ia.CLEARCOAT_ROUGHNESS){const i=this.getFloat(n);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?r=i.mul(this.getTexture(n).r):r=i}else if(n===ia.CLEARCOAT_NORMAL)t.clearcoatNormalMap?r=tK(this.getTexture(n),this.getCache(n+"Scale","vec2")):r=qi;else if(n===ia.SHEEN){const i=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?r=i.mul(this.getTexture("sheenColor").rgb):r=i}else if(n===ia.SHEEN_ROUGHNESS){const i=this.getFloat(n);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?r=i.mul(this.getTexture(n).a):r=i,r=r.clamp(1e-4,1)}else if(n===ia.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const i=this.getTexture(n);r=hB(rS.x,rS.y,rS.y.negate(),rS.x).mul(i.rg.mul(2).sub(rn(1)).normalize().mul(i.b))}else r=rS;else if(n===ia.IRIDESCENCE_THICKNESS){const i=go("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=go("0","float",t.iridescenceThicknessRange);r=i.sub(o).mul(this.getTexture(n).g).add(o)}else r=i}else if(n===ia.TRANSMISSION){const i=this.getFloat(n);t.transmissionMap?r=i.mul(this.getTexture(n).r):r=i}else if(n===ia.THICKNESS){const i=this.getFloat(n);t.thicknessMap?r=i.mul(this.getTexture(n).g):r=i}else if(n===ia.IOR)r=this.getFloat(n);else if(n===ia.LIGHT_MAP)r=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===ia.AO)r=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(n===ia.LINE_DASH_OFFSET)r=t.dashOffset?this.getFloat(n):_e(0);else{const i=this.getNodeType(e);r=this.getCache(n,i)}return r}};nn.ALPHA_TEST="alphaTest";nn.COLOR="color";nn.OPACITY="opacity";nn.SHININESS="shininess";nn.SPECULAR="specular";nn.SPECULAR_STRENGTH="specularStrength";nn.SPECULAR_INTENSITY="specularIntensity";nn.SPECULAR_COLOR="specularColor";nn.REFLECTIVITY="reflectivity";nn.ROUGHNESS="roughness";nn.METALNESS="metalness";nn.NORMAL="normal";nn.CLEARCOAT="clearcoat";nn.CLEARCOAT_ROUGHNESS="clearcoatRoughness";nn.CLEARCOAT_NORMAL="clearcoatNormal";nn.EMISSIVE="emissive";nn.ROTATION="rotation";nn.SHEEN="sheen";nn.SHEEN_ROUGHNESS="sheenRoughness";nn.ANISOTROPY="anisotropy";nn.IRIDESCENCE="iridescence";nn.IRIDESCENCE_IOR="iridescenceIOR";nn.IRIDESCENCE_THICKNESS="iridescenceThickness";nn.IOR="ior";nn.TRANSMISSION="transmission";nn.THICKNESS="thickness";nn.ATTENUATION_DISTANCE="attenuationDistance";nn.ATTENUATION_COLOR="attenuationColor";nn.LINE_SCALE="scale";nn.LINE_DASH_SIZE="dashSize";nn.LINE_GAP_SIZE="gapSize";nn.LINE_WIDTH="linewidth";nn.LINE_DASH_OFFSET="dashOffset";nn.POINT_SIZE="size";nn.DISPERSION="dispersion";nn.LIGHT_MAP="light";nn.AO="ao";const GTe=Cn(nn,nn.ALPHA_TEST),jTe=Cn(nn,nn.COLOR),HTe=Cn(nn,nn.SHININESS),$Te=Cn(nn,nn.EMISSIVE),pQ=Cn(nn,nn.OPACITY),WTe=Cn(nn,nn.SPECULAR),nK=Cn(nn,nn.SPECULAR_INTENSITY),qTe=Cn(nn,nn.SPECULAR_COLOR),WC=Cn(nn,nn.SPECULAR_STRENGTH),KL=Cn(nn,nn.REFLECTIVITY),XTe=Cn(nn,nn.ROUGHNESS),YTe=Cn(nn,nn.METALNESS),KTe=Cn(nn,nn.NORMAL),ZTe=Cn(nn,nn.CLEARCOAT),QTe=Cn(nn,nn.CLEARCOAT_ROUGHNESS),JTe=Cn(nn,nn.CLEARCOAT_NORMAL),eEe=Cn(nn,nn.ROTATION),tEe=Cn(nn,nn.SHEEN),nEe=Cn(nn,nn.SHEEN_ROUGHNESS),rEe=Cn(nn,nn.ANISOTROPY),iEe=Cn(nn,nn.IRIDESCENCE),sEe=Cn(nn,nn.IRIDESCENCE_IOR),oEe=Cn(nn,nn.IRIDESCENCE_THICKNESS),aEe=Cn(nn,nn.TRANSMISSION),lEe=Cn(nn,nn.THICKNESS),cEe=Cn(nn,nn.IOR),uEe=Cn(nn,nn.ATTENUATION_DISTANCE),dEe=Cn(nn,nn.ATTENUATION_COLOR),hEe=Cn(nn,nn.LINE_SCALE),pEe=Cn(nn,nn.LINE_DASH_SIZE),fEe=Cn(nn,nn.LINE_GAP_SIZE),GKe=Cn(nn,nn.LINE_WIDTH),mEe=Cn(nn,nn.LINE_DASH_OFFSET),gEe=Cn(nn,nn.POINT_SIZE),yEe=Cn(nn,nn.DISPERSION),fQ=Cn(nn,nn.LIGHT_MAP),vEe=Cn(nn,nn.AO),rS=cr(new Ln).onReference(function(s){return s.material}).onRenderUpdate(function({material:s}){this.value.set(s.anisotropy*Math.cos(s.anisotropyRotation),s.anisotropy*Math.sin(s.anisotropyRotation))}),xEe=Ye(s=>s.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");let jKe=class extends bx{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const n=this.storageBufferNode.structTypeNode;return n?n.getMemberType(e,t):"void"}setup(e){return e.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let n;const r=e.context.assign;if(e.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&r!==!0&&(this.node.value.isInstancedBufferAttribute||e.shaderStage!=="compute")?n=e.generatePBO(this):n=this.node.build(e):n=super.generate(e),r!==!0){const i=this.getNodeType(e);n=e.format(n,i,t)}return n}};const HKe=ri(jKe).setParameterLength(2);let $Ke=class extends iQ{static get type(){return"StorageBufferNode"}constructor(e,t=null,n=0){let r,i=null;t&&t.isStruct?(r="struct",i=t.layout,(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(n=e.count)):t===null&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(r=RSe(e.itemSize),n=e.count):r=t,super(e,r,n),this.isStorageBufferNode=!0,this.structTypeNode=i,this.access=F0.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return HKe(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(F0.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=QZ(this.value),this._varying=w5(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}getMemberType(e,t){return this.structTypeNode!==null?this.structTypeNode.getMemberType(e,t):"void"}generate(e){if(this.structTypeNode!==null&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:n}=this.getAttributeData(),r=n.build(e);return e.registerTransform(r,t),r}};const l5=(s,e=null,t=0)=>new $Ke(s,e,t);let l0=class I6 extends Jn{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let r;if(n===I6.VERTEX)r=e.getVertexIndex();else if(n===I6.INSTANCE)r=e.getInstanceIndex();else if(n===I6.DRAW)r=e.getDrawIndex();else if(n===I6.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(n===I6.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else if(n===I6.SUBGROUP)r=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let i;return e.shaderStage==="vertex"||e.shaderStage==="compute"?i=r:i=w5(this).build(e,t),i}};l0.VERTEX="vertex";l0.INSTANCE="instance";l0.SUBGROUP="subgroup";l0.INVOCATION_LOCAL="invocationLocal";l0.INVOCATION_SUBGROUP="invocationSubgroup";l0.DRAW="draw";const bEe=Cn(l0,l0.VERTEX),wg=Cn(l0,l0.INSTANCE),WKe=Cn(l0,l0.SUBGROUP),qKe=Cn(l0,l0.INVOCATION_SUBGROUP),XKe=Cn(l0,l0.INVOCATION_LOCAL),_Ee=Cn(l0,l0.DRAW);let SEe=class extends Jn{static get type(){return"InstanceNode"}constructor(e,t,n=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Wr.FRAME,this.buffer=null,this.bufferColor=null,this.previousInstanceMatrixNode=null}get isStorageMatrix(){const{instanceMatrix:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}get isStorageColor(){const{instanceColor:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}setup(e){let{instanceMatrixNode:t,instanceColorNode:n}=this;t===null&&(t=this._createInstanceMatrixNode(!0,e),this.instanceMatrixNode=t);const{instanceColor:r,isStorageColor:i}=this;if(r&&n===null){if(i)n=l5(r,"vec3",Math.max(r.count,1)).element(wg);else{const l=new s5(r.array,3),c=r.usage===vA?XY:SF;this.bufferColor=l,n=$e(c(l,"vec3",3,0))}this.instanceColorNode=n}const o=t.mul(Vo).xyz;if(Vo.assign(o),e.needsPreviousData()&&rw.assign(this.getPreviousInstancedPosition(e)),e.hasGeometryAttribute("normal")){const l=wTe(bd,t);bd.assign(l)}this.instanceColorNode!==null&&RA("vec3","vInstanceColor").assign(this.instanceColorNode)}update(e){this.buffer!==null&&this.isStorageMatrix!==!0&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&this.isStorageColor!==!0&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)),this.previousInstanceMatrixNode!==null&&e.object.previousInstanceMatrix.array.set(this.instanceMatrix.array)}getPreviousInstancedPosition(e){const t=e.object;return this.previousInstanceMatrixNode===null&&(t.previousInstanceMatrix=this.instanceMatrix.clone(),this.previousInstanceMatrixNode=this._createInstanceMatrixNode(!1,e)),this.previousInstanceMatrixNode.mul(rw).xyz}_createInstanceMatrixNode(e,t){let n;const{instanceMatrix:r}=this,{count:i}=r;if(this.isStorageMatrix)n=l5(r,"mat4",Math.max(i,1)).element(wg);else if(i*16*4<=t.getUniformBufferLimit())n=nN(r.array,"mat4",Math.max(i,1)).element(wg);else{const l=new Sje(r.array,16,1);e===!0&&(this.buffer=l);const c=r.usage===vA?XY:SF,h=[c(l,"vec4",16,0),c(l,"vec4",16,4),c(l,"vec4",16,8),c(l,"vec4",16,12)];n=o5(...h)}return n}};const YKe=ri(SEe).setParameterLength(2,3);let KKe=class extends SEe{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:r}=e;super(t,n,r),this.instancedMesh=e}};const wEe=ri(KKe).setParameterLength(1);let ZKe=class extends Jn{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=wg:this.batchingIdNode=_Ee);const n=Ye(([A])=>{const I=ze(a5(sa(this.batchMesh._indirectTexture),0).x).toConst(),D=ze(A).mod(I).toConst(),P=ze(A).div(I).toConst();return sa(this.batchMesh._indirectTexture,tl(D,P)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(ze(this.batchingIdNode)),r=this.batchMesh._matricesTexture,i=ze(a5(sa(r),0).x).toConst(),o=_e(n).mul(4).toInt().toConst(),l=o.mod(i).toConst(),c=o.div(i).toConst(),h=o5(sa(r,tl(l,c)),sa(r,tl(l.add(1),c)),sa(r,tl(l.add(2),c)),sa(r,tl(l.add(3),c))),m=this.batchMesh._colorsTexture;if(m!==null){const I=Ye(([D])=>{const P=ze(a5(sa(m),0).x).toConst(),U=D,j=U.mod(P).toConst(),C=U.div(P).toConst();return sa(m,tl(j,C)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(n);RA("vec3","vBatchColor").assign(I)}const y=o0(h);Vo.assign(h.mul(Vo));const b=bd.div($e(y[0].dot(y[0]),y[1].dot(y[1]),y[2].dot(y[2]))),w=y.mul(b).xyz;bd.assign(w),e.hasGeometryAttribute("tangent")&&sw.mulAssign(y)}};const TEe=ri(ZKe).setParameterLength(1),Exe=new WeakMap;let EEe=class extends Jn{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Wr.OBJECT,this.skinIndexNode=t9("skinIndex","uvec4"),this.skinWeightNode=t9("skinWeight","vec4"),this.bindMatrixNode=go("bindMatrix","mat4"),this.bindMatrixInverseNode=go("bindMatrixInverse","mat4"),this.boneMatricesNode=ZY("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=Vo,this.toPositionNode=Vo,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:o}=this,l=e.element(n.x),c=e.element(n.y),h=e.element(n.z),m=e.element(n.w),y=i.mul(t),b=Ha(l.mul(r.x).mul(y),c.mul(r.y).mul(y),h.mul(r.z).mul(y),m.mul(r.w).mul(y));return o.mul(b).xyz}getSkinnedNormalAndTangent(e=this.boneMatricesNode,t=bd,n=sw){const{skinIndexNode:r,skinWeightNode:i,bindMatrixNode:o,bindMatrixInverseNode:l}=this,c=e.element(r.x),h=e.element(r.y),m=e.element(r.z),y=e.element(r.w);let b=Ha(i.x.mul(c),i.y.mul(h),i.z.mul(m),i.w.mul(y));b=l.mul(b).mul(o);const w=b.transformDirection(t).xyz,A=b.transformDirection(n).xyz;return{skinNormal:w,skinTangent:A}}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=ZY("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,rw)}setup(e){e.needsPreviousData()&&rw.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const{skinNormal:n,skinTangent:r}=this.getSkinnedNormalAndTangent();bd.assign(n),e.hasGeometryAttribute("tangent")&&sw.assign(r)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;Exe.get(t)!==e.frameId&&(Exe.set(t,e.frameId),this.previousBoneMatricesNode!==null&&(t.previousBoneMatrices===null&&(t.previousBoneMatrices=new Float32Array(t.boneMatrices)),t.previousBoneMatrices.set(t.boneMatrices)),t.update())}};const MEe=s=>new EEe(s),QKe=(s,e=null)=>{const t=new EEe(s);return t.positionNode=l5(new s5(s.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(wg).toVar(),t.skinIndexNode=l5(new s5(new Uint32Array(s.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(wg).toVar(),t.skinWeightNode=l5(new s5(s.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(wg).toVar(),t.bindMatrixNode=cr(s.bindMatrix,"mat4"),t.bindMatrixInverseNode=cr(s.bindMatrixInverse,"mat4"),t.boneMatricesNode=nN(s.skeleton.boneMatrices,"mat4",s.skeleton.bones.length),t.toPositionNode=e,Kn(t)};let JKe=class extends Jn{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const n={};for(let l=0,c=this.params.length-1;l<c;l++){const h=this.params[l],m=h.isNode!==!0&&h.name||this.getVarName(l),y=h.isNode!==!0&&h.type||"int";n[m]=pm(m,y)}const r=e.addStack(),i=this.params[this.params.length-1](n);t.returnsNode=i.context({nodeLoop:i}),t.stackNode=r;const o=this.params[0];if(o.isNode!==!0&&typeof o.update=="function"){const l=Ye(this.params[0].update)(n);t.updateNode=l.context({nodeLoop:l})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){const t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){const t=this.getProperties(e),n=this.params,r=t.stackNode;for(let o=0,l=n.length-1;o<l;o++){const c=n[o];let h=!1,m=null,y=null,b=null,w=null,A=null,I=null;c.isNode?c.getNodeType(e)==="bool"?(h=!0,w="bool",y=c.build(e,w)):(w="int",b=this.getVarName(o),m="0",y=c.build(e,w),A="<"):(w=c.type||"int",b=c.name||this.getVarName(o),m=c.start,y=c.end,A=c.condition,I=c.update,typeof m=="number"?m=e.generateConst(w,m):m&&m.isNode&&(m=m.build(e,w)),typeof y=="number"?y=e.generateConst(w,y):y&&y.isNode&&(y=y.build(e,w)),m!==void 0&&y===void 0?(m=m+" - 1",y="0",A=">="):y!==void 0&&m===void 0&&(m="0",A="<"),A===void 0&&(Number(m)>Number(y)?A=">=":A="<"));let D;if(h)D=`while ( ${y} )`;else{const P={start:m,end:y},U=P.start,j=P.end;let C;const Z=()=>A.includes("<")?"+=":"-=";if(I!=null)switch(typeof I){case"function":C=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":C=b+" "+Z()+" "+e.generateConst(w,I);break;case"string":C=b+" "+I;break;default:I.isNode?C=b+" "+Z()+" "+I.build(e):(Ht("TSL: 'Loop( { update: ... } )' is not a function, string or number.",this.stackTrace),C="break /* invalid update */")}else w==="int"||w==="uint"?I=A.includes("<")?"++":"--":I=Z()+" 1.",C=b+" "+I;const ie=e.getVar(w,b)+" = "+U,se=b+" "+A+" "+j;D=`for ( ${ie}; ${se}; ${C} )`}e.addFlowCode((o===0?`
`:"")+e.tab+D+` {

`).addFlowTab()}const i=r.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode(`
`+e.tab+i);for(let o=0,l=this.params.length-1;o<l;o++)e.addFlowCode((o===0?"":e.tab)+`}

`).removeFlowTab();e.addFlowTab()}};const Cs=(...s)=>new JKe(J6(s,"int")).toStack(),eZe=()=>pm("continue").toStack(),CEe=()=>pm("break").toStack(),$q=new WeakMap,ah=new zr,Mxe=Ye(({bufferMap:s,influence:e,stride:t,width:n,depth:r,offset:i})=>{const o=ze(bEe).mul(t).add(i),l=o.div(n),c=o.sub(l.mul(n));return sa(s,tl(c,l)).depth(r).xyz.mul(e)});function tZe(s){const e=s.morphAttributes.position!==void 0,t=s.morphAttributes.normal!==void 0,n=s.morphAttributes.color!==void 0,r=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,i=r!==void 0?r.length:0;let o=$q.get(s);if(o===void 0||o.count!==i){let U=function(){D.dispose(),$q.delete(s),s.removeEventListener("dispose",U)};var l=U;o!==void 0&&o.texture.dispose();const c=s.morphAttributes.position||[],h=s.morphAttributes.normal||[],m=s.morphAttributes.color||[];let y=0;e===!0&&(y=1),t===!0&&(y=2),n===!0&&(y=3);let b=s.attributes.position.count*y,w=1;const A=4096;b>A&&(w=Math.ceil(b/A),b=A);const I=new Float32Array(b*w*4*i),D=new YK(I,b,w,i);D.type=vo,D.needsUpdate=!0;const P=y*4;for(let j=0;j<i;j++){const C=c[j],Z=h[j],ie=m[j],se=b*w*4*j;for(let z=0;z<C.count;z++){const re=z*P;e===!0&&(ah.fromBufferAttribute(C,z),I[se+re+0]=ah.x,I[se+re+1]=ah.y,I[se+re+2]=ah.z,I[se+re+3]=0),t===!0&&(ah.fromBufferAttribute(Z,z),I[se+re+4]=ah.x,I[se+re+5]=ah.y,I[se+re+6]=ah.z,I[se+re+7]=0),n===!0&&(ah.fromBufferAttribute(ie,z),I[se+re+8]=ah.x,I[se+re+9]=ah.y,I[se+re+10]=ah.z,I[se+re+11]=ie.itemSize===4?ah.w:1)}}o={count:i,texture:D,stride:y,size:new Ln(b,w)},$q.set(s,o),s.addEventListener("dispose",U)}return o}let nZe=class extends Jn{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=cr(1),this.updateType=Wr.OBJECT}setup(e){const{geometry:t}=e,n=t.morphAttributes.position!==void 0,r=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=i!==void 0?i.length:0,{texture:l,stride:c,size:h}=tZe(t);n===!0&&Vo.mulAssign(this.morphBaseInfluence),r===!0&&bd.mulAssign(this.morphBaseInfluence);const m=ze(h.width);Cs(o,({i:y})=>{const b=_e(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?b.assign(sa(this.mesh.morphTexture,tl(ze(y).add(1),ze(wg))).r):b.assign(go("morphTargetInfluences","float").element(y).toVar()),_r(b.notEqual(0),()=>{n===!0&&Vo.addAssign(Mxe({bufferMap:l,influence:b,stride:c,width:m,depth:y,offset:ze(0)})),r===!0&&bd.addAssign(Mxe({bufferMap:l,influence:b,stride:c,width:m,depth:y,offset:ze(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,n)=>t+n,0)}};const AEe=ri(nZe).setParameterLength(1);let Mw=class extends Jn{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}},rZe=class extends Mw{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}},iZe=class extends zwe{static get type(){return"LightingContextNode"}constructor(e,t=null,n=null,r=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n=$e().toVar("directDiffuse"),r=$e().toVar("directSpecular"),i=$e().toVar("indirectDiffuse"),o=$e().toVar("indirectSpecular"),l={directDiffuse:n,directSpecular:r,indirectDiffuse:i,indirectSpecular:o};return{radiance:$e().toVar("radiance"),irradiance:$e().toVar("irradiance"),iblIrradiance:$e().toVar("iblIrradiance"),ambientOcclusion:_e(1).toVar("ambientOcclusion"),reflectedLight:l,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}};const NEe=ri(iZe);let sZe=class extends Mw{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}};const E_=new Ln;let EB=class extends Cg{static get type(){return"ViewportTextureNode"}constructor(e=_g,t=null,n=null){let r=null;n===null?(r=new nZ,r.minFilter=fd,n=r):r=n,super(n,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=r,this.isOutputTextureNode=!0,this.updateBeforeType=Wr.RENDER,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,n;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,n=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,n=this._cacheTextures),e===null)return t;if(n.has(e)===!1){const r=t.clone();n.set(e,r)}return n.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,n=t.getRenderTarget();n===null?t.getDrawingBufferSize(E_):E_.set(n.width,n.height);const r=this.getTextureForReference(n);(r.image.width!==E_.width||r.image.height!==E_.height)&&(r.image.width=E_.width,r.image.height=E_.height,r.needsUpdate=!0);const i=r.generateMipmaps;r.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(r),r.generateMipmaps=i}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}};const oZe=ri(EB).setParameterLength(0,3),mQ=ri(EB,null,null,{generateMipmaps:!0}).setParameterLength(0,3),aZe=mQ(),PEe=(s=_g,e=null)=>aZe.sample(s,e);let kO=null,lZe=class extends EB{static get type(){return"ViewportDepthTextureNode"}constructor(e=_g,t=null){kO===null&&(kO=new Cc),super(e,t,kO)}getTextureForReference(){return kO}};const gQ=ri(lZe).setParameterLength(0,2);let n9=class NC extends Jn{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===NC.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,n=this.valueNode;let r=null;if(t===NC.DEPTH_BASE)n!==null&&(r=IEe().assign(n));else if(t===NC.DEPTH)e.isPerspectiveCamera?r=yQ(wa.z,Wy,qy):r=SS(wa.z,Wy,qy);else if(t===NC.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const i=vQ(n,Wy,qy);r=SS(i,Wy,qy)}else r=n;else r=SS(wa.z,Wy,qy);return r}};n9.DEPTH_BASE="depthBase";n9.DEPTH="depth";n9.LINEAR_DEPTH="linearDepth";const SS=(s,e,t)=>s.add(e).div(e.sub(t)),cZe=(s,e,t)=>s.add(t).div(t.sub(e)),uZe=Ye(([s,e,t],n)=>n.renderer.reversedDepthBuffer===!0?t.sub(e).mul(s).sub(t):e.sub(t).mul(s).sub(e)),yQ=(s,e,t)=>e.add(s).mul(t).div(t.sub(e).mul(s)),REe=(s,e,t)=>e.mul(s.add(t)).div(s.mul(e.sub(t))),vQ=Ye(([s,e,t],n)=>n.renderer.reversedDepthBuffer===!0?e.mul(t).div(e.sub(t).mul(s).sub(e)):e.mul(t).div(t.sub(e).mul(s).sub(t))),xQ=(s,e,t)=>{e=e.max(1e-6).toVar();const n=vg(s.negate().div(e)),r=vg(t.div(e));return n.div(r)},dZe=(s,e,t)=>{const n=s.mul(mB(t.div(e)));return _e(Math.E).pow(n).mul(e).negate()},IEe=ri(n9,n9.DEPTH_BASE),bQ=Cn(n9,n9.DEPTH),wF=ri(n9,n9.LINEAR_DEPTH).setParameterLength(0,1),hZe=wF(gQ());bQ.assign=s=>IEe(s);let v5=class ZL extends Jn{static get type(){return"ClippingNode"}constructor(e=ZL.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===ZL.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,r):this.scope===ZL.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(n,r)}setupAlphaToCoverage(e,t){return Ye(()=>{const n=_e().toVar("distanceToPlane"),r=_e().toVar("distanceToGradient"),i=_e(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const c=wc(t).setGroup(gr);Cs(o,({i:h})=>{const m=c.element(h);n.assign(wa.dot(m.xyz).negate().add(m.w)),r.assign(n.fwidth().div(2)),i.mulAssign(ym(r.negate(),r,n))})}const l=e.length;if(l>0){const c=wc(e).setGroup(gr),h=_e(1).toVar("intersectionClipOpacity");Cs(l,({i:m})=>{const y=c.element(m);n.assign(wa.dot(y.xyz).negate().add(y.w)),r.assign(n.fwidth().div(2)),h.mulAssign(ym(r.negate(),r,n).oneMinus())}),i.mulAssign(h.oneMinus())}Ms.a.mulAssign(i),Ms.a.equal(0).discard()})()}setupDefault(e,t){return Ye(()=>{const n=t.length;if(this.hardwareClipping===!1&&n>0){const i=wc(t).setGroup(gr);Cs(n,({i:o})=>{const l=i.element(o);wa.dot(l.xyz).greaterThan(l.w).discard()})}const r=e.length;if(r>0){const i=wc(e).setGroup(gr),o=Ap(!0).toVar("clipped");Cs(r,({i:l})=>{const c=i.element(l);o.assign(wa.dot(c.xyz).greaterThan(c.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),Ye(()=>{const r=wc(e).setGroup(gr),i=o9(t.getClipDistance());Cs(n,({i:o})=>{const l=r.element(o),c=wa.dot(l.xyz).sub(l.w).negate();i.element(o).assign(c)})})()}};v5.ALPHA_TO_COVERAGE="alphaToCoverage";v5.DEFAULT="default";v5.HARDWARE="hardware";const pZe=()=>new v5,fZe=()=>new v5(v5.ALPHA_TO_COVERAGE),mZe=()=>new v5(v5.HARDWARE),gZe=.05,Cxe=Ye(([s])=>mm(qr(1e4,mu(qr(17,s.x).add(qr(.1,s.y)))).mul(Ha(.1,Zs(mu(qr(13,s.y).add(s.x))))))),Axe=Ye(([s])=>Cxe(rn(Cxe(s.xy),s.z))),yZe=Ye(([s])=>{const e=Go(bg(UZ(s.xyz)),bg(zZ(s.xyz))),t=_e(1).div(_e(gZe).mul(e)).toVar("pixScale"),n=rn(tw(xg(vg(t))),tw(gB(vg(t)))),r=rn(Axe(xg(n.x.mul(s.xyz))),Axe(xg(n.y.mul(s.xyz)))),i=mm(vg(t)),o=Ha(qr(i.oneMinus(),r.x),qr(i,r.y)),l=xd(i,i.oneMinus()),c=$e(o.mul(o).div(qr(2,l).mul(Fi(1,l))),o.sub(qr(.5,l)).div(Fi(1,l)),Fi(1,Fi(1,o).mul(Fi(1,o)).div(qr(2,l).mul(Fi(1,l))))),h=o.lessThan(l.oneMinus()).select(o.lessThan(l).select(c.x,c.y),c.z);return gm(h,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});let vZe=class extends dTe{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),n=e.hasGeometryAttribute(t);let r;return n===!0?r=super.generate(e):r=e.generateConst(this.nodeType,new zr(1,1,1,1)),r}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}};const kEe=(s=0)=>new vZe(s),xZe=Ye(([s,e])=>xd(1,s.oneMinus().div(e)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),bZe=Ye(([s,e])=>xd(s.div(e.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),_Ze=Ye(([s,e])=>s.oneMinus().mul(e.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),SZe=Ye(([s,e])=>ki(s.mul(2).mul(e),s.oneMinus().mul(2).mul(e.oneMinus()).oneMinus(),nw(.5,s))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),wZe=Ye(([s,e])=>{const t=e.a.add(s.a.mul(e.a.oneMinus()));return mr(e.rgb.mul(e.a).add(s.rgb.mul(s.a).mul(e.a.oneMinus())).div(t),t)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),DEe=Ye(([s])=>mr(s.rgb.mul(s.a),s.a),{color:"vec4",return:"vec4"}),TZe=Ye(([s])=>(_r(s.a.equal(0),()=>mr(0)),mr(s.rgb.div(s.a),s.a)),{color:"vec4",return:"vec4"});let xo=class extends Nc{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.maskShadowNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,this.contextNode=null}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(t.startsWith("_")===!0)continue;const n=this[t];n&&n.isNode===!0&&e.push({property:t,childNode:n})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:n}of this._getNodeChildren())e.push(Tw(t.slice(0,-4)),n.getCacheKey());return this.type+JA(e)}build(e){this.setup(e)}setupObserver(e){return new UXe(e)}setup(e){e.context.setupNormal=()=>tx(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();t.contextNode.isContextNode===!0?e.context={...e.context,...t.contextNode.getFlowContextData()}:Ht('NodeMaterial: "renderer.contextNode" must be an instance of `context()`.'),this.contextNode!==null&&(this.contextNode.isContextNode===!0?e.context={...e.context,...this.contextNode.getFlowContextData()}:Ht('NodeMaterial: "material.contextNode" must be an instance of `context()`.')),e.addStack();const r=this.setupVertex(e),i=tx(this.vertexNode||r,"VERTEX");e.context.clipSpace=i,e.stack.outputNode=i,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let o;const l=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(n!==null?n.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const c=this.setupLighting(e);l!==null&&e.stack.addToStack(l);const h=mr(c,Ms.a).max(0);o=this.setupOutput(e,h),bS.assign(o);const m=this.outputNode!==null;if(m&&(o=this.outputNode),e.context.getOutput&&(o=e.context.getOutput(o,e)),n!==null){const y=t.getMRT(),b=this.mrtNode;y!==null?(m&&bS.assign(o),o=y,b!==null&&(o=y.merge(b))):b!==null&&(o=b)}}else{let c=this.fragmentNode;c.isOutputStructNode!==!0&&(c=mr(c)),o=this.setupOutput(e,c)}e.stack.outputNode=o,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let r=null;if(t.length>0||n.length>0){const i=e.renderer.currentSamples;this.alphaToCoverage&&i>1?r=fZe():e.stack.addToStack(pZe())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(mZe()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let r=this.depthNode;if(r===null){const i=t.getMRT();i&&i.has("depth")?r=i.get("depth"):t.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?r=xQ(wa.z,Wy,qy):r=SS(wa.z,Wy,qy))}r!==null&&bQ.assign(r).toStack()}setupPositionView(){return E5.mul(Vo).xyz}setupModelViewProjection(){return K3.mul(wa)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.position=e.removeStack(),xEe}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&AEe(t).toStack(),t.isSkinnedMesh===!0&&MEe(t).toStack(),this.displacementMap){const r=F3("displacementMap","texture"),i=F3("displacementScale","float"),o=F3("displacementBias","float");Vo.addAssign(bd.normalize().mul(r.x.mul(i).add(o)))}return t.isBatchedMesh&&TEe(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&wEe(t).toStack(),this.positionNode!==null&&Vo.assign(tx(this.positionNode,"POSITION","vec3")),Vo}setupDiffuseColor(e){const{object:t,geometry:n}=e;this.maskNode!==null&&Ap(this.maskNode).not().discard();let r=this.colorNode?mr(this.colorNode):jTe;this.vertexColors===!0&&n.hasAttribute("color")&&(r=r.mul(kEe())),t.instanceColor&&(r=RA("vec3","vInstanceColor").mul(r)),t.isBatchedMesh&&t._colorsTexture&&(r=RA("vec3","vBatchColor").mul(r)),Ms.assign(r);const i=this.opacityNode?_e(this.opacityNode):pQ;Ms.a.assign(Ms.a.mul(i));let o=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(o=this.alphaTestNode!==null?_e(this.alphaTestNode):GTe,this.alphaToCoverage===!0?(Ms.a=ym(o,o.add(GZ(Ms.a)),Ms.a),Ms.a.lessThanEqual(0).discard()):Ms.a.lessThanEqual(o).discard()),this.alphaHash===!0&&Ms.a.lessThan(yZe(Vo)).discard(),e.isOpaque()&&Ms.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?$e(0):Ms.rgb}setupNormal(){return this.normalNode?$e(this.normalNode):KTe}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?F3("envMap","cubeTexture"):F3("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new sZe(fQ)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const r=this.setupLightMap(e);r&&r.isLightingNode&&t.push(r);let i=this.aoNode;i===null&&e.material.aoMap&&(i=vEe),e.context.getAO&&(i=e.context.getAO(i,e)),i&&t.push(new rZe(i));let o=this.lightsNode||e.lightsNode;return t.length>0&&(o=e.renderer.lighting.createNode([...o.getLights(),...t])),o}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:r,emissiveNode:i}=this,l=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=this.setupOutgoingLight(e);if(l&&l.getScope().hasLights){const h=this.setupLightingModel(e)||null;c=NEe(l,h,n,r)}else n!==null&&(c=$e(r!==null?ki(c,n,r):n));return(i&&i.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&($Y.assign($e(i||$Te)),c=c.add($Y)),c}setupFog(e,t){const n=e.fogNode;return n&&(bS.assign(t),t=mr(n.toVar())),t}setupPremultipliedAlpha(e,t){return DEe(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const n in e){const r=e[n];this[n]===void 0&&(this[n]=r,r&&r.clone&&(this[n]=r.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&t[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const n=Nc.prototype.toJSON.call(this,e);n.inputNodes={};for(const{property:i,childNode:o}of this._getNodeChildren())n.inputNodes[i]=o.toJSON(e).uuid;function r(i){const o=[];for(const l in i){const c=i[l];delete c.metadata,o.push(c)}return o}if(t){const i=r(e.textures),o=r(e.images),l=r(e.nodes);i.length>0&&(n.textures=i),o.length>0&&(n.images=o),l.length>0&&(n.nodes=l)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.maskShadowNode=e.maskShadowNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,this.contextNode=e.contextNode,super.copy(e)}};const EZe=new Sh;class MZe extends xo{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(EZe),this.setValues(e)}}const CZe=new GGe;class AZe extends xo{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(CZe),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?_e(this.offsetNode):mEe,t=this.dashScaleNode?_e(this.dashScaleNode):hEe,n=this.dashSizeNode?_e(this.dashSizeNode):pEe,r=this.gapSizeNode?_e(this.gapSizeNode):fEe;WL.assign(n),WY.assign(r);const i=w5(t9("lineDistance").mul(t));(e?i.add(e):i).mod(WL.add(WY)).greaterThan(WL).discard()}}const NZe=new lZ;class OEe extends xo{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(NZe),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?_e(this.opacityNode):pQ;Ms.assign(vB(mr(VTe(qi),e),Is))}}const _Q=Ye(([s=aQ])=>{const e=s.z.atan(s.x).mul(1/(Math.PI*2)).add(.5),t=s.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return rn(e,t)});let LEe=class extends Op{constructor(e=1,t={}){super(e,e,t),this.isCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new yx(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i=new _a(5,5,5),o=_Q(aQ),l=new xo;l.colorNode=ts(t,o,0),l.side=bs,l.blending=El;const c=new gn(i,l),h=new XA;h.add(c),t.minFilter===fd&&(t.minFilter=ds);const m=new mSe(1,10,this),y=e.getMRT();return e.setMRT(null),m.update(e,h),e.setMRT(y),t.minFilter=n,t.currentGenerateMipmaps=r,c.geometry.dispose(),c.material.dispose(),this}clear(e,t=!0,n=!0,r=!0){const i=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(i)}};const qC=new WeakMap;let PZe=class extends Ho{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=vu(null);const t=new yx;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Wr.RENDER}updateBefore(e){const{renderer:t,material:n}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const i=r.isTextureNode?r.value:n[r.property];if(i&&i.isTexture){const o=i.mapping;if(o===K6||o===gS){if(qC.has(i)){const l=qC.get(i);Nxe(l,i.mapping),this._cubeTexture=l}else{const l=i.image;if(RZe(l)){const c=new LEe(l.height);c.fromEquirectangularTexture(t,i),Nxe(c.texture,i.mapping),this._cubeTexture=c.texture,qC.set(i,c.texture),i.addEventListener("dispose",FEe)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}};function RZe(s){return s==null?!1:s.height>0}function FEe(s){const e=s.target;e.removeEventListener("dispose",FEe);const t=qC.get(e);t!==void 0&&(qC.delete(e),t.dispose())}function Nxe(s,e){e===K6?s.mapping=fm:e===gS&&(s.mapping=Eg)}const BEe=ri(PZe).setParameterLength(1);let SQ=class extends Mw{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=BEe(this.envNode)}},IZe=class extends Mw{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=_e(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}},MB=class{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}},UEe=class extends MB{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,n=e.reflectedLight,r=e.irradianceLightMap;n.indirectDiffuse.assign(mr(0)),r?n.indirectDiffuse.addAssign(r):n.indirectDiffuse.addAssign(mr(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(Ms.rgb)}finish(e){const{material:t,context:n}=e,r=n.outgoingLight,i=e.context.environment;if(i)switch(t.combine){case WA:r.rgb.assign(ki(r.rgb,r.rgb.mul(i.rgb),WC.mul(KL)));break;case D_e:r.rgb.assign(ki(r.rgb,i.rgb,WC.mul(KL)));break;case O_e:r.rgb.addAssign(i.rgb.mul(WC.mul(KL)));break;default:qt("BasicLightingModel: Unsupported .combine value:",t.combine);break}}};const kZe=new rl;let DZe=class extends xo{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(kZe),this.setValues(e)}setupNormal(){return Ew(iw)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new SQ(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new IZe(fQ)),t}setupOutgoingLight(){return Ms.rgb}setupLightingModel(){return new UEe}};const ow=Ye(({f0:s,f90:e,dotVH:t})=>{const n=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return s.mul(n.oneMinus()).add(e.mul(n))}),px=Ye(s=>s.diffuseColor.mul(1/Math.PI)),OZe=()=>_e(.25),LZe=Ye(({dotNH:s})=>xF.mul(_e(.5)).add(1).mul(_e(1/Math.PI)).mul(s.pow(xF))),FZe=Ye(({lightDirection:s})=>{const e=s.add(Hs).normalize(),t=qi.dot(e).clamp(),n=Hs.dot(e).clamp(),r=ow({f0:y5,f90:1,dotVH:n}),i=OZe(),o=LZe({dotNH:t});return r.mul(i).mul(o)});class zEe extends UEe{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const i=qi.dot(e).clamp().mul(t);n.directDiffuse.addAssign(i.mul(px({diffuseColor:Ms.rgb}))),this.specular===!0&&n.directSpecular.addAssign(i.mul(FZe({lightDirection:e})).mul(WC))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(px({diffuseColor:Ms}))),r.indirectDiffuse.mulAssign(t)}}const BZe=new sSe;class UZe extends xo{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(BZe),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new SQ(t):null}setupLightingModel(){return new zEe(!1)}}const zZe=new $6;class VZe extends xo{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(zZe),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new SQ(t):null}setupLightingModel(){return new zEe}setupVariants(){const e=(this.shininessNode?_e(this.shininessNode):HTe).max(1e-4);xF.assign(e);const t=this.specularNode||WTe;y5.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const VEe=Ye(s=>{if(s.geometry.hasAttribute("normal")===!1)return _e(0);const e=iw.dFdx().abs().max(iw.dFdy().abs());return e.x.max(e.y).max(e.z)}),wQ=Ye(s=>{const{roughness:e}=s,t=VEe();let n=e.max(.0525);return n=n.add(t),n=n.min(1),n}),GEe=Ye(({alpha:s,dotNL:e,dotNV:t})=>{const n=s.pow2(),r=e.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt()),i=t.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt());return _h(.5,r.add(i).max(IZ))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),GZe=Ye(({alphaT:s,alphaB:e,dotTV:t,dotBV:n,dotTL:r,dotBL:i,dotNV:o,dotNL:l})=>{const c=l.mul($e(s.mul(t),e.mul(n),o).length()),h=o.mul($e(s.mul(r),e.mul(i),l).length());return _h(.5,c.add(h))}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),jEe=Ye(({alpha:s,dotNH:e})=>{const t=s.pow2(),n=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),jZe=_e(1/Math.PI),HZe=Ye(({alphaT:s,alphaB:e,dotNH:t,dotTH:n,dotBH:r})=>{const i=s.mul(e),o=$e(e.mul(n),s.mul(r),i.mul(t)),l=o.dot(o),c=i.div(l);return jZe.mul(i.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),TQ=Ye(({lightDirection:s,f0:e,f90:t,roughness:n,f:r,normalView:i=qi,USE_IRIDESCENCE:o,USE_ANISOTROPY:l})=>{const c=n.pow2(),h=s.add(Hs).normalize(),m=i.dot(s).clamp(),y=i.dot(Hs).clamp(),b=i.dot(h).clamp(),w=Hs.dot(h).clamp();let A=ow({f0:e,f90:t,dotVH:w}),I,D;if(NA(o)&&(A=pB.mix(A,r)),NA(l)){const P=HC.dot(s),U=HC.dot(Hs),j=HC.dot(h),C=ex.dot(s),Z=ex.dot(Hs),ie=ex.dot(h);I=GZe({alphaT:vF,alphaB:c,dotTV:U,dotBV:Z,dotTL:P,dotBL:C,dotNV:y,dotNL:m}),D=HZe({alphaT:vF,alphaB:c,dotNH:b,dotTH:j,dotBH:ie})}else I=GEe({alpha:c,dotNL:m,dotNV:y}),D=jEe({alpha:c,dotNH:b});return A.mul(I).mul(D)}),$Ze=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let Q1=null;const IA=Ye(({roughness:s,dotNV:e})=>{Q1===null&&(Q1=new j3($Ze,16,16,Su,ro),Q1.name="DFG_LUT",Q1.minFilter=ds,Q1.magFilter=ds,Q1.wrapS=zo,Q1.wrapT=zo,Q1.generateMipmaps=!1,Q1.needsUpdate=!0);const t=rn(s,e);return ts(Q1,t).rg}),WZe=Ye(({lightDirection:s,f0:e,f90:t,roughness:n,f:r,USE_IRIDESCENCE:i,USE_ANISOTROPY:o})=>{const l=TQ({lightDirection:s,f0:e,f90:t,roughness:n,f:r,USE_IRIDESCENCE:i,USE_ANISOTROPY:o}),c=qi.dot(s).clamp(),h=qi.dot(Hs).clamp(),m=IA({roughness:n,dotNV:h}),y=IA({roughness:n,dotNV:c}),b=e.mul(m.x).add(t.mul(m.y)),w=e.mul(y.x).add(t.mul(y.y)),A=m.x.add(m.y),I=y.x.add(y.y),D=_e(1).sub(A),P=_e(1).sub(I),U=e.add(e.oneMinus().mul(.047619)),j=b.mul(w).mul(U).div(_e(1).sub(D.mul(P).mul(U).mul(U)).add(IZ)),C=D.mul(P),Z=j.mul(C);return l.add(Z)}),HEe=Ye(s=>{const{dotNV:e,specularColor:t,specularF90:n,roughness:r}=s,i=IA({dotNV:e,roughness:r});return t.mul(i.x).add(n.mul(i.y))}),rK=Ye(({f:s,f90:e,dotVH:t})=>{const n=t.oneMinus().saturate(),r=n.mul(n),i=n.mul(r,r).clamp(0,.9999);return s.sub($e(e).mul(i)).div(i.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),qZe=Ye(({roughness:s,dotNH:e})=>{const t=s.pow2(),n=_e(1).div(t),i=e.pow2().oneMinus().max(.0078125);return _e(2).add(n).mul(i.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),XZe=Ye(({dotNV:s,dotNL:e})=>_e(1).div(_e(4).mul(e.add(s).sub(e.mul(s))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),YZe=Ye(({lightDirection:s})=>{const e=s.add(Hs).normalize(),t=qi.dot(s).clamp(),n=qi.dot(Hs).clamp(),r=qi.dot(e).clamp(),i=qZe({roughness:$y,dotNH:r}),o=XZe({dotNV:n,dotNL:t});return ph.mul(i).mul(o)}),Pxe=Ye(({N:s,V:e,roughness:t})=>{const i=.0078125,o=s.dot(e).saturate(),l=rn(t,o.oneMinus().sqrt());return l.assign(l.mul(.984375).add(i)),l}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),KZe=Ye(({f:s})=>{const e=s.length();return Go(e.mul(e).add(s.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),DO=Ye(({v1:s,v2:e})=>{const t=s.dot(e),n=t.abs().toVar(),r=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),i=n.add(4.1616724).mul(n).add(3.417594).toVar(),o=r.div(i),l=t.greaterThan(0).select(o,Go(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return s.cross(e).mul(l)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),Wq=Ye(({N:s,V:e,P:t,mInv:n,p0:r,p1:i,p2:o,p3:l})=>{const c=i.sub(r).toVar(),h=l.sub(r).toVar(),m=c.cross(h),y=$e().toVar();return _r(m.dot(t.sub(r)).greaterThanEqual(0),()=>{const b=e.sub(s.mul(e.dot(s))).normalize(),w=s.cross(b).negate(),A=n.mul(o0(b,w,s).transpose()).toVar(),I=A.mul(r.sub(t)).normalize().toVar(),D=A.mul(i.sub(t)).normalize().toVar(),P=A.mul(o.sub(t)).normalize().toVar(),U=A.mul(l.sub(t)).normalize().toVar(),j=$e(0).toVar();j.addAssign(DO({v1:I,v2:D})),j.addAssign(DO({v1:D,v2:P})),j.addAssign(DO({v1:P,v2:U})),j.addAssign(DO({v1:U,v2:I})),y.assign($e(KZe({f:j})))}),y}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),CB=1/6,$Ee=s=>qr(CB,qr(s,qr(s,s.negate().add(3)).sub(3)).add(1)),iK=s=>qr(CB,qr(s,qr(s,qr(3,s).sub(6))).add(4)),WEe=s=>qr(CB,qr(s,qr(s,qr(-3,s).add(3)).add(3)).add(1)),sK=s=>qr(CB,wp(s,3)),Rxe=s=>$Ee(s).add(iK(s)),Ixe=s=>WEe(s).add(sK(s)),kxe=s=>Ha(-1,iK(s).div($Ee(s).add(iK(s)))),Dxe=s=>Ha(1,sK(s).div(WEe(s).add(sK(s)))),Oxe=(s,e,t)=>{const n=s.uvNode,r=qr(n,e.zw).add(.5),i=xg(r),o=mm(r),l=Rxe(o.x),c=Ixe(o.x),h=kxe(o.x),m=Dxe(o.x),y=kxe(o.y),b=Dxe(o.y),w=rn(i.x.add(h),i.y.add(y)).sub(.5).mul(e.xy),A=rn(i.x.add(m),i.y.add(y)).sub(.5).mul(e.xy),I=rn(i.x.add(h),i.y.add(b)).sub(.5).mul(e.xy),D=rn(i.x.add(m),i.y.add(b)).sub(.5).mul(e.xy),P=Rxe(o.y).mul(Ha(l.mul(s.sample(w).level(t)),c.mul(s.sample(A).level(t)))),U=Ixe(o.y).mul(Ha(l.mul(s.sample(I).level(t)),c.mul(s.sample(D).level(t))));return P.add(U)},EQ=Ye(([s,e])=>{const t=rn(s.size(ze(e))),n=rn(s.size(ze(e.add(1)))),r=_h(1,t),i=_h(1,n),o=Oxe(s,mr(r,t),xg(e)),l=Oxe(s,mr(i,n),gB(e));return mm(e).mix(o,l)}),ZZe=Ye(([s,e])=>{const t=e.mul(nQ(s));return EQ(s,t)}),Lxe=Ye(([s,e,t,n,r])=>{const i=$e(WZ(e.negate(),yd(s),_h(1,n))),o=$e(bg(r[0].xyz),bg(r[1].xyz),bg(r[2].xyz));return yd(i).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),QZe=Ye(([s,e])=>s.mul(gm(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),JZe=mQ(),eQe=PEe(),Fxe=Ye(([s,e,t],{material:n})=>{const i=(n.side===bs?JZe:eQe).sample(s),o=vg(hx.x).mul(QZe(e,t));return EQ(i,o)}),Bxe=Ye(([s,e,t])=>(_r(t.notEqual(0),()=>{const n=mB(e).negate().div(t);return kZ(n.negate().mul(s))}),$e(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),tQe=Ye(([s,e,t,n,r,i,o,l,c,h,m,y,b,w,A])=>{let I,D;if(A){I=mr().toVar(),D=$e().toVar();const Z=m.sub(1).mul(A.mul(.025)),ie=$e(m.sub(Z),m,m.add(Z));Cs({start:0,end:3},({i:se})=>{const z=ie.element(se),re=Lxe(s,e,y,z,l),ye=o.add(re),H=h.mul(c.mul(mr(ye,1))),Me=rn(H.xy.div(H.w)).toVar();Me.addAssign(1),Me.divAssign(2),Me.assign(rn(Me.x,Me.y.oneMinus()));const Oe=Fxe(Me,t,z);I.element(se).assign(Oe.element(se)),I.a.addAssign(Oe.a),D.element(se).assign(n.element(se).mul(Bxe(bg(re),b,w).element(se)))}),I.a.divAssign(3)}else{const Z=Lxe(s,e,y,m,l),ie=o.add(Z),se=h.mul(c.mul(mr(ie,1))),z=rn(se.xy.div(se.w)).toVar();z.addAssign(1),z.divAssign(2),z.assign(rn(z.x,z.y.oneMinus())),I=Fxe(z,t,m),D=n.mul(Bxe(bg(Z),b,w))}const P=D.rgb.mul(I.rgb),U=s.dot(e).clamp(),j=$e(HEe({dotNV:U,specularColor:r,specularF90:i,roughness:t})),C=D.r.add(D.g,D.b).div(3);return mr(j.oneMinus().mul(P),I.a.oneMinus().mul(C).oneMinus())}),nQe=o0(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),rQe=s=>{const e=s.sqrt();return $e(1).add(e).div($e(1).sub(e))},Uxe=(s,e)=>s.sub(e).div(s.add(e)).pow2(),iQe=(s,e)=>{const t=s.mul(2*Math.PI*1e-9),n=$e(54856e-17,44201e-17,52481e-17),r=$e(1681e3,1795300,2208400),i=$e(43278e5,93046e5,66121e5),o=_e(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let l=n.mul(i.mul(2*Math.PI).sqrt()).mul(r.mul(t).add(e).cos()).mul(t.pow2().negate().mul(i).exp());return l=$e(l.x.add(o),l.y,l.z).div(10685e-11),nQe.mul(l)},zxe=Ye(({outsideIOR:s,eta2:e,cosTheta1:t,thinFilmThickness:n,baseF0:r})=>{const i=ki(s,e,ym(0,.03,n)),l=s.div(i).pow2().mul(t.pow2().oneMinus()).oneMinus();_r(l.lessThan(0),()=>$e(1));const c=l.sqrt(),h=Uxe(i,s),m=ow({f0:h,f90:1,dotVH:t}),y=m.oneMinus(),b=i.lessThan(s).select(Math.PI,0),w=_e(Math.PI).sub(b),A=rQe(r.clamp(0,.9999)),I=Uxe(A,i.toVec3()),D=ow({f0:I,f90:1,dotVH:c}),P=$e(A.x.lessThan(i).select(Math.PI,0),A.y.lessThan(i).select(Math.PI,0),A.z.lessThan(i).select(Math.PI,0)),U=i.mul(n,c,2),j=$e(w).add(P),C=m.mul(D).clamp(1e-5,.9999),Z=C.sqrt(),ie=y.pow2().mul(D).div($e(1).sub(C)),z=m.add(ie).toVar(),re=ie.sub(y).toVar();return Cs({start:1,end:2,condition:"<=",name:"m"},({m:ye})=>{re.mulAssign(Z);const H=iQe(_e(ye).mul(U),_e(ye).mul(j)).mul(2);z.addAssign(re.mul(H))}),z.max($e(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),XM=Ye(({normal:s,viewDir:e,roughness:t})=>{const n=s.dot(e).saturate(),r=t.mul(t),i=t.add(.1).reciprocal(),o=_e(-1.9362).add(t.mul(1.0678)).add(r.mul(.4573)).sub(i.mul(.8469)),l=_e(-.6014).add(t.mul(.5538)).sub(r.mul(.467)).sub(i.mul(.1255));return o.mul(n).add(l).exp().saturate()}),YM=$e(.04),OO=_e(1);class qEe extends MB{constructor(e=!1,t=!1,n=!1,r=!1,i=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=r,this.transmission=i,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null,this.iridescenceF0Dielectric=null,this.iridescenceF0Metallic=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=$e().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=$e().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=$e().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=$e().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=$e().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=qi.dot(Hs).clamp(),n=zxe({outsideIOR:_e(1),eta2:gF,cosTheta1:t,thinFilmThickness:yF,baseF0:y5}),r=zxe({outsideIOR:_e(1),eta2:gF,cosTheta1:t,thinFilmThickness:yF,baseF0:Ms.rgb});this.iridescenceFresnel=ki(n,r,H3),this.iridescenceF0Dielectric=rK({f:n,f90:1,dotVH:t}),this.iridescenceF0Metallic=rK({f:r,f90:1,dotVH:t}),this.iridescenceF0=ki(this.iridescenceF0Dielectric,this.iridescenceF0Metallic,H3)}if(this.transmission===!0){const t=Sg,n=gTe.sub(Sg).normalize(),r=M5,i=e.context;i.backdrop=tQe(r,n,fg,B6,W6,q6,t,Tp,Fp,K3,$C,MZ,AZ,CZ,this.dispersion?NZ:null),i.backdropAlpha=bF,Ms.a.mulAssign(ki(1,i.backdrop.a,bF))}super.start(e)}computeMultiscattering(e,t,n,r,i=null){const o=qi.dot(Hs).clamp(),l=IA({roughness:fg,dotNV:o}),c=i?pB.mix(r,i):r,h=c.mul(l.x).add(n.mul(l.y)),y=l.x.add(l.y).oneMinus(),b=c.add(c.oneMinus().mul(.047619)),w=h.mul(b).div(y.mul(b).oneMinus());e.addAssign(h),t.addAssign(w.mul(y))}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const i=qi.dot(e).clamp().mul(t).toVar();if(this.sheen===!0){this.sheenSpecularDirect.addAssign(i.mul(YZe({lightDirection:e})));const o=XM({normal:qi,viewDir:Hs,roughness:$y}),l=XM({normal:qi,viewDir:e,roughness:$y}),c=ph.r.max(ph.g).max(ph.b).mul(o.max(l)).oneMinus();i.mulAssign(c)}if(this.clearcoat===!0){const l=Xy.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(l.mul(TQ({lightDirection:e,f0:YM,f90:OO,roughness:xS,normalView:Xy})))}n.directDiffuse.addAssign(i.mul(px({diffuseColor:B6}))),n.directSpecular.addAssign(i.mul(WZe({lightDirection:e,f0:W6,f90:1,roughness:fg,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:r,reflectedLight:i,ltc_1:o,ltc_2:l}){const c=t.add(n).sub(r),h=t.sub(n).sub(r),m=t.sub(n).add(r),y=t.add(n).add(r),b=qi,w=Hs,A=wa.toVar(),I=Pxe({N:b,V:w,roughness:fg}),D=o.sample(I).toVar(),P=l.sample(I).toVar(),U=o0($e(D.x,0,D.y),$e(0,1,0),$e(D.z,0,D.w)).toVar(),j=W6.mul(P.x).add(q6.sub(W6).mul(P.y)).toVar();if(i.directSpecular.addAssign(e.mul(j).mul(Wq({N:b,V:w,P:A,mInv:U,p0:c,p1:h,p2:m,p3:y}))),i.directDiffuse.addAssign(e.mul(B6).mul(Wq({N:b,V:w,P:A,mInv:o0(1,0,0,0,1,0,0,0,1),p0:c,p1:h,p2:m,p3:y}))),this.clearcoat===!0){const C=Xy,Z=Pxe({N:C,V:w,roughness:xS}),ie=o.sample(Z),se=l.sample(Z),z=o0($e(ie.x,0,ie.y),$e(0,1,0),$e(ie.z,0,ie.w)),re=YM.mul(se.x).add(OO.sub(YM).mul(se.y));this.clearcoatSpecularDirect.addAssign(e.mul(re).mul(Wq({N:C,V:w,P:A,mInv:z,p0:c,p1:h,p2:m,p3:y})))}}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context,r=t.mul(px({diffuseColor:B6})).toVar();if(this.sheen===!0){const i=XM({normal:qi,viewDir:Hs,roughness:$y}),o=ph.r.max(ph.g).max(ph.b).mul(i).oneMinus();r.mulAssign(o)}n.indirectDiffuse.addAssign(r)}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:r}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(n.mul(ph,XM({normal:qi,viewDir:Hs,roughness:$y}))),this.clearcoat===!0){const D=Xy.dot(Hs).clamp(),P=HEe({dotNV:D,specularColor:YM,specularF90:OO,roughness:xS});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(P))}const i=$e().toVar("singleScatteringDielectric"),o=$e().toVar("multiScatteringDielectric"),l=$e().toVar("singleScatteringMetallic"),c=$e().toVar("multiScatteringMetallic");this.computeMultiscattering(i,o,q6,y5,this.iridescenceF0Dielectric),this.computeMultiscattering(l,c,q6,Ms.rgb,this.iridescenceF0Metallic);const h=ki(i,l,H3),m=ki(o,c,H3),y=i.add(o),b=B6.mul(y.oneMinus()),w=n.mul(1/Math.PI),A=t.mul(h).add(m.mul(w)).toVar(),I=b.mul(w).toVar();if(this.sheen===!0){const D=XM({normal:qi,viewDir:Hs,roughness:$y}),P=ph.r.max(ph.g).max(ph.b).mul(D).oneMinus();A.mulAssign(P),I.mulAssign(P)}r.indirectSpecular.addAssign(A),r.indirectDiffuse.addAssign(I)}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,i=qi.dot(Hs).clamp().add(t),o=fg.mul(-16).oneMinus().negate().exp2(),l=t.sub(i.pow(o).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(l)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const n=Xy.dot(Hs).clamp(),r=ow({dotVH:n,f0:YM,f90:OO}),i=t.mul(mF.mul(r).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(mF));t.assign(i)}if(this.sheen===!0){const n=t.add(this.sheenSpecularDirect,this.sheenSpecularIndirect.mul(1/Math.PI));t.assign(n)}}}const Vxe=_e(1),oK=_e(-2),LO=_e(.8),qq=_e(-1),FO=_e(.4),Xq=_e(2),BO=_e(.305),Yq=_e(3),Gxe=_e(.21),sQe=_e(4),jxe=_e(4),oQe=_e(16),aQe=Ye(([s])=>{const e=$e(Zs(s)).toVar(),t=_e(-1).toVar();return _r(e.x.greaterThan(e.z),()=>{_r(e.x.greaterThan(e.y),()=>{t.assign(Ec(s.x.greaterThan(0),0,3))}).Else(()=>{t.assign(Ec(s.y.greaterThan(0),1,4))})}).Else(()=>{_r(e.z.greaterThan(e.y),()=>{t.assign(Ec(s.z.greaterThan(0),2,5))}).Else(()=>{t.assign(Ec(s.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),lQe=Ye(([s,e])=>{const t=rn().toVar();return _r(e.equal(0),()=>{t.assign(rn(s.z,s.y).div(Zs(s.x)))}).ElseIf(e.equal(1),()=>{t.assign(rn(s.x.negate(),s.z.negate()).div(Zs(s.y)))}).ElseIf(e.equal(2),()=>{t.assign(rn(s.x.negate(),s.y).div(Zs(s.z)))}).ElseIf(e.equal(3),()=>{t.assign(rn(s.z.negate(),s.y).div(Zs(s.x)))}).ElseIf(e.equal(4),()=>{t.assign(rn(s.x.negate(),s.z).div(Zs(s.y)))}).Else(()=>{t.assign(rn(s.x,s.y).div(Zs(s.z)))}),qr(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),cQe=Ye(([s])=>{const e=_e(0).toVar();return _r(s.greaterThanEqual(LO),()=>{e.assign(Vxe.sub(s).mul(qq.sub(oK)).div(Vxe.sub(LO)).add(oK))}).ElseIf(s.greaterThanEqual(FO),()=>{e.assign(LO.sub(s).mul(Xq.sub(qq)).div(LO.sub(FO)).add(qq))}).ElseIf(s.greaterThanEqual(BO),()=>{e.assign(FO.sub(s).mul(Yq.sub(Xq)).div(FO.sub(BO)).add(Xq))}).ElseIf(s.greaterThanEqual(Gxe),()=>{e.assign(BO.sub(s).mul(sQe.sub(Yq)).div(BO.sub(Gxe)).add(Yq))}).Else(()=>{e.assign(_e(-2).mul(vg(qr(1.16,s))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),XEe=Ye(([s,e])=>{const t=s.toVar();t.assign(qr(2,t).sub(1));const n=$e(t,1).toVar();return _r(e.equal(0),()=>{n.assign(n.zyx)}).ElseIf(e.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),YEe=Ye(([s,e,t,n,r,i])=>{const o=_e(t),l=$e(e),c=gm(cQe(o),oK,i),h=mm(c),m=xg(c),y=$e(kA(s,l,m,n,r,i)).toVar();return _r(h.notEqual(0),()=>{const b=$e(kA(s,l,m.add(1),n,r,i)).toVar();y.assign(ki(y,b,h))}),y}),kA=Ye(([s,e,t,n,r,i])=>{const o=_e(t).toVar(),l=$e(e),c=_e(aQe(l)).toVar(),h=_e(Go(jxe.sub(o),0)).toVar();o.assign(Go(o,jxe));const m=_e(tw(o)).toVar(),y=rn(lQe(l,c).mul(m.sub(2)).add(1)).toVar();return _r(c.greaterThan(2),()=>{y.y.addAssign(m),c.subAssign(3)}),y.x.addAssign(c.mul(m)),y.x.addAssign(h.mul(qr(3,oQe))),y.y.addAssign(qr(4,tw(i).sub(m))),y.x.mulAssign(n),y.y.mulAssign(r),s.sample(y).grad(rn(),rn())}),Kq=Ye(({envMap:s,mipInt:e,outputDirection:t,theta:n,axis:r,CUBEUV_TEXEL_WIDTH:i,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:l})=>{const c=sm(n),h=t.mul(c).add(r.cross(t).mul(mu(n))).add(r.mul(r.dot(t).mul(c.oneMinus())));return kA(s,h,e,i,o,l)}),KEe=Ye(({n:s,latitudinal:e,poleAxis:t,outputDirection:n,weights:r,samples:i,dTheta:o,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:m,CUBEUV_MAX_MIP:y})=>{const b=$e(Ec(e,t,e9(t,n))).toVar();_r(b.equal($e(0)),()=>{b.assign($e(n.z,0,n.x.negate()))}),b.assign(yd(b));const w=$e().toVar();return w.addAssign(r.element(0).mul(Kq({theta:0,axis:b,outputDirection:n,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:m,CUBEUV_MAX_MIP:y}))),Cs({start:ze(1),end:s},({i:A})=>{_r(A.greaterThanEqual(i),()=>{CEe()});const I=_e(o.mul(_e(A))).toVar();w.addAssign(r.element(A).mul(Kq({theta:I.mul(-1),axis:b,outputDirection:n,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:m,CUBEUV_MAX_MIP:y}))),w.addAssign(r.element(A).mul(Kq({theta:I,axis:b,outputDirection:n,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:m,CUBEUV_MAX_MIP:y})))}),mr(w,1)}),uQe=Ye(([s])=>{const e=Jt(s).toVar();return e.assign(e.shiftLeft(Jt(16)).bitOr(e.shiftRight(Jt(16)))),e.assign(e.bitAnd(Jt(1431655765)).shiftLeft(Jt(1)).bitOr(e.bitAnd(Jt(2863311530)).shiftRight(Jt(1)))),e.assign(e.bitAnd(Jt(858993459)).shiftLeft(Jt(2)).bitOr(e.bitAnd(Jt(3435973836)).shiftRight(Jt(2)))),e.assign(e.bitAnd(Jt(252645135)).shiftLeft(Jt(4)).bitOr(e.bitAnd(Jt(4042322160)).shiftRight(Jt(4)))),e.assign(e.bitAnd(Jt(16711935)).shiftLeft(Jt(8)).bitOr(e.bitAnd(Jt(4278255360)).shiftRight(Jt(8)))),_e(e).mul(23283064365386963e-26)}),dQe=Ye(([s,e])=>rn(_e(s).div(_e(e)),uQe(s))),hQe=Ye(([s,e,t])=>{const n=t.mul(t).toConst(),r=$e(1,0,0).toConst(),i=e9(e,r).toConst(),o=wu(s.x).toConst(),l=qr(2,3.14159265359).mul(s.y).toConst(),c=o.mul(sm(l)).toConst(),h=o.mul(mu(l)).toVar(),m=qr(.5,e.z.add(1)).toConst();h.assign(m.oneMinus().mul(wu(c.mul(c).oneMinus())).add(m.mul(h)));const y=r.mul(c).add(i.mul(h)).add(e.mul(wu(Go(0,c.mul(c).add(h.mul(h)).oneMinus()))));return yd($e(n.mul(y.x),n.mul(y.y),Go(0,y.z)))}),ZEe=Ye(({roughness:s,mipInt:e,envMap:t,N_immutable:n,GGX_SAMPLES:r,CUBEUV_TEXEL_WIDTH:i,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:l})=>{const c=$e(n).toVar(),h=$e(0).toVar(),m=_e(0).toVar();return _r(s.lessThan(.001),()=>{h.assign(kA(t,c,e,i,o,l))}).Else(()=>{const y=Ec(Zs(c.z).lessThan(.999),$e(0,0,1),$e(1,0,0)),b=yd(e9(y,c)).toVar(),w=e9(c,b).toVar();Cs({start:Jt(0),end:r},({i:A})=>{const I=dQe(A,r),D=hQe(I,$e(0,0,1),s),P=yd(b.mul(D.x).add(w.mul(D.y)).add(c.mul(D.z))),U=yd(P.mul(Np(c,P).mul(2)).sub(c)),j=Go(Np(c,U),0);_r(j.greaterThan(0),()=>{const C=kA(t,U,e,i,o,l);h.addAssign(C.mul(j)),m.addAssign(j)})}),_r(m.greaterThan(0),()=>{h.assign(h.div(m))})}),mr(h,1)}),Qy=4,Hxe=[.125,.215,.35,.446,.526,.582],U6=20,pQe=512,KM=new J3(-1,1,1,-1,0,1),fQe=new Va(90,1),$xe=new Tn;let Zq=null,Qq=0,Jq=0;const mQe=new be,TF=new WeakMap,gQe=[3,1,5,0,4,2],eX=XEe(Os(),t9("faceIndex")).normalize(),AB=$e(eX.x,eX.y,eX.z);class yQe{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,n=.1,r=100,i={}){const{size:o=256,position:l=mQe,renderTarget:c=null}=i;if(this._setSize(o),this._hasInitialized===!1){qt('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const m=c||this._allocateTarget();return i.renderTarget=m,this.fromSceneAsync(e,t,n,r,i),m}Zq=this._renderer.getRenderTarget(),Qq=this._renderer.getActiveCubeFace(),Jq=this._renderer.getActiveMipmapLevel();const h=c||this._allocateTarget();return h.depthBuffer=!0,this._init(h),this._sceneToCubeUV(e,n,r,h,l),t>0&&this._blur(h,0,0,t),this._applyPMREM(h),this._cleanup(h),h}async fromSceneAsync(e,t=0,n=.1,r=100,i={}){return es('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(e,t,n,r,i)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){qt('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return es('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){qt("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return es('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=qxe(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Xxe(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===fm||e.mapping===Eg?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(Zq,Qq,Jq),e.scissorTest=!1,M_(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),Zq=this._renderer.getRenderTarget(),Qq=this._renderer.getActiveCubeFace(),Jq=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTarget();return this._init(n),this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return Wxe(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Wxe(e.width,e.height);const{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=vQe(t)),this._blurMaterial=xQe(t,e.width,e.height),this._ggxMaterial=bQe(t,e.width,e.height)}}async _compileMaterial(e){const t=new gn(new Ki,e);await this._renderer.compile(t,KM)}_sceneToCubeUV(e,t,n,r,i){const o=fQe;o.near=t,o.far=n;const l=[1,1,1,1,-1,1],c=[1,-1,1,-1,1,-1],h=this._renderer,m=h.autoClear;h.getClearColor($xe),h.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new gn(new _a,new rl({name:"PMREM.Background",side:bs,depthWrite:!1,depthTest:!1})));const y=this._backgroundBox,b=y.material;let w=!1;const A=e.background;A?A.isColor&&(b.color.copy(A),e.background=null,w=!0):(b.color.copy($xe),w=!0),h.setRenderTarget(r),h.clear(),w&&h.render(y,o);for(let I=0;I<6;I++){const D=I%3;D===0?(o.up.set(0,l[I],0),o.position.set(i.x,i.y,i.z),o.lookAt(i.x+c[I],i.y,i.z)):D===1?(o.up.set(0,0,l[I]),o.position.set(i.x,i.y,i.z),o.lookAt(i.x,i.y+c[I],i.z)):(o.up.set(0,l[I],0),o.position.set(i.x,i.y,i.z),o.lookAt(i.x,i.y,i.z+c[I]));const P=this._cubeSize;M_(r,D*P,I>2?P:0,P,P),h.render(e,o)}h.autoClear=m,e.background=A}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===fm||e.mapping===Eg;r?this._cubemapMaterial===null&&(this._cubemapMaterial=qxe(e)):this._equirectMaterial===null&&(this._equirectMaterial=Xxe(e));const i=r?this._cubemapMaterial:this._equirectMaterial;i.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=i;const l=this._cubeSize;M_(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(o,KM)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodMeshes.length;for(let i=1;i<r;i++)this._applyGGXFilter(e,i-1,i);t.autoClear=n}_applyGGXFilter(e,t,n){const r=this._renderer,i=this._pingPongRenderTarget,o=this._ggxMaterial,l=this._lodMeshes[n];l.material=o;const c=TF.get(o),h=n/(this._lodMeshes.length-1),m=t/(this._lodMeshes.length-1),y=Math.sqrt(h*h-m*m),b=0+h*1.25,w=y*b,{_lodMax:A}=this,I=this._sizeLods[n],D=3*I*(n>A-Qy?n-A+Qy:0),P=4*(this._cubeSize-I);e.texture.frame=(e.texture.frame||0)+1,c.envMap.value=e.texture,c.roughness.value=w,c.mipInt.value=A-t,M_(i,D,P,3*I,2*I),r.setRenderTarget(i),r.render(l,KM),i.texture.frame=(i.texture.frame||0)+1,c.envMap.value=i.texture,c.roughness.value=0,c.mipInt.value=A-n,M_(e,D,P,3*I,2*I),r.setRenderTarget(e),r.render(l,KM)}_blur(e,t,n,r,i){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",i),this._halfBlur(o,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,o,l){const c=this._renderer,h=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&Ht("blur direction must be either latitudinal or longitudinal!");const m=3,y=this._lodMeshes[r];y.material=h;const b=TF.get(h),w=this._sizeLods[n]-1,A=isFinite(i)?Math.PI/(2*w):2*Math.PI/(2*U6-1),I=i/A,D=isFinite(i)?1+Math.floor(m*I):U6;D>U6&&qt(`sigmaRadians, ${i}, is too large and will clip, as it requested ${D} samples when the maximum is set to ${U6}`);const P=[];let U=0;for(let se=0;se<U6;++se){const z=se/I,re=Math.exp(-z*z/2);P.push(re),se===0?U+=re:se<D&&(U+=2*re)}for(let se=0;se<P.length;se++)P[se]=P[se]/U;e.texture.frame=(e.texture.frame||0)+1,b.envMap.value=e.texture,b.samples.value=D,b.weights.array=P,b.latitudinal.value=o==="latitudinal"?1:0,l&&(b.poleAxis.value=l);const{_lodMax:j}=this;b.dTheta.value=A,b.mipInt.value=j-n;const C=this._sizeLods[r],Z=3*C*(r>j-Qy?r-j+Qy:0),ie=4*(this._cubeSize-C);M_(t,Z,ie,3*C,2*C),c.setRenderTarget(t),c.render(y,KM)}}function vQe(s){const e=[],t=[],n=[];let r=s;const i=s-Qy+1+Hxe.length;for(let o=0;o<i;o++){const l=Math.pow(2,r);e.push(l);let c=1/l;o>s-Qy?c=Hxe[o-s+Qy-1]:o===0&&(c=0),t.push(c);const h=1/(l-2),m=-h,y=1+h,b=[m,m,y,m,y,y,m,m,y,y,m,y],w=6,A=6,I=3,D=2,P=1,U=new Float32Array(I*A*w),j=new Float32Array(D*A*w),C=new Float32Array(P*A*w);for(let ie=0;ie<w;ie++){const se=ie%3*2/3-1,z=ie>2?0:-1,re=[se,z,0,se+2/3,z,0,se+2/3,z+1,0,se,z,0,se+2/3,z+1,0,se,z+1,0],ye=gQe[ie];U.set(re,I*A*ye),j.set(b,D*A*ye);const H=[ye,ye,ye,ye,ye,ye];C.set(H,P*A*ye)}const Z=new Ki;Z.setAttribute("position",new ja(U,I)),Z.setAttribute("uv",new ja(j,D)),Z.setAttribute("faceIndex",new ja(C,P)),n.push(new gn(Z,null)),r>Qy&&r--}return{lodMeshes:n,sizeLods:e,sigmas:t}}function Wxe(s,e){const t={magFilter:ds,minFilter:ds,generateMipmaps:!1,type:ro,format:io,colorSpace:vd},n=new Op(s,e,t);return n.texture.mapping=sx,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function M_(s,e,t,n,r){s.viewport.set(e,t,n,r),s.scissor.set(e,t,n,r)}function NB(s){const e=new xo;return e.depthTest=!1,e.depthWrite=!1,e.blending=El,e.name=`PMREM_${s}`,e}function xQe(s,e,t){const n=wc(new Array(U6).fill(0)),r=cr(new be(0,1,0)),i=cr(0),o=_e(U6),l=cr(0),c=cr(1),h=ts(),m=cr(0),y=_e(1/e),b=_e(1/t),w=_e(s),A={n:o,latitudinal:l,weights:n,poleAxis:r,outputDirection:AB,dTheta:i,samples:c,envMap:h,mipInt:m,CUBEUV_TEXEL_WIDTH:y,CUBEUV_TEXEL_HEIGHT:b,CUBEUV_MAX_MIP:w},I=NB("blur");return I.fragmentNode=KEe({...A,latitudinal:l.equal(1)}),TF.set(I,A),I}function bQe(s,e,t){const n=ts(),r=cr(0),i=cr(0),o=_e(1/e),l=_e(1/t),c=_e(s),h={envMap:n,roughness:r,mipInt:i,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:l,CUBEUV_MAX_MIP:c},m=NB("ggx");return m.fragmentNode=ZEe({...h,N_immutable:AB,GGX_SAMPLES:Jt(pQe)}),TF.set(m,h),m}function qxe(s){const e=NB("cubemap");return e.fragmentNode=vu(s,AB),e}function Xxe(s){const e=NB("equirect");return e.fragmentNode=ts(s,_Q(AB),0),e}const Yxe=new WeakMap;function _Qe(s){const e=Math.log2(s)-2,t=1/s;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function SQe(s,e,t){const n=wQe(e);let r=n.get(s);if((r!==void 0?r.pmremVersion:-1)!==s.pmremVersion){const o=s.image;if(s.isCubeTexture)if(EQe(o))r=t.fromCubemap(s,r);else return null;else if(MQe(o))r=t.fromEquirectangular(s,r);else return null;r.pmremVersion=s.pmremVersion,n.set(s,r)}return r.texture}function wQe(s){let e=Yxe.get(s);return e===void 0&&(e=new WeakMap,Yxe.set(s,e)),e}class TQe extends Ho{static get type(){return"PMREMNode"}constructor(e,t=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const r=new ol;r.isRenderTargetTexture=!0,this._texture=ts(r),this._width=cr(0),this._height=cr(0),this._maxMip=cr(0),this.updateBeforeType=Wr.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=_Qe(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,r=this._value;n!==r.pmremVersion&&(r.isPMREMTexture===!0?t=r:t=SQe(r,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new yQe(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this,e)),t=uQ.mul($e(t.x,t.y.negate(),t.z));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),YEe(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function EQe(s){if(s==null)return!1;let e=0;const t=6;for(let n=0;n<t;n++)s[n]!==void 0&&e++;return e===t}function MQe(s){return s==null?!1:s.height>0}const MQ=ri(TQe).setParameterLength(1,3),Kxe=new WeakMap;class CQe extends Mw{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const y=n.isTextureNode?n.value:t[n.property],b=this._getPMREMNodeCache(e.renderer);let w=b.get(y);w===void 0&&(w=MQ(y),b.set(y,w)),n=w}const i=t.useAnisotropy===!0||t.anisotropy>0?zTe:qi,o=n.context(Zxe(fg,i)).mul(YL),l=n.context(AQe(M5)).mul(Math.PI).mul(YL),c=_S(o),h=_S(l);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(h);const m=e.context.lightingModel.clearcoatRadiance;if(m){const y=n.context(Zxe(xS,Xy)).mul(YL),b=_S(y);m.addAssign(b)}}_getPMREMNodeCache(e){let t=Kxe.get(e);return t===void 0&&(t=new WeakMap,Kxe.set(e,t)),t}}const Zxe=(s,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Hs.negate().reflect(e),t=HZ(s).mix(t,e).normalize(),t=t.transformDirection(Fp)),t),getTextureLevel:()=>s}},AQe=s=>({getUV:()=>s,getTextureLevel:()=>_e(1)}),NQe=new aZ;class CQ extends xo{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(NQe),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new CQe(t):null}setupLightingModel(){return new qEe}setupSpecular(){const e=ki($e(.04),Ms.rgb,H3);y5.assign($e(.04)),W6.assign(e),q6.assign(1)}setupVariants(){const e=this.metalnessNode?_e(this.metalnessNode):YTe;H3.assign(e);let t=this.roughnessNode?_e(this.roughnessNode):XTe;t=wQ({roughness:t}),fg.assign(t),this.setupSpecular(),B6.assign(Ms.rgb.mul(e.oneMinus()))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const PQe=new EA;class RQe extends CQ{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(PQe),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?_e(this.iorNode):cEe;$C.assign(e),y5.assign(xd(jZ($C.sub(1).div($C.add(1))).mul(qTe),$e(1)).mul(nK)),W6.assign(ki(y5,Ms.rgb,H3)),q6.assign(ki(nK,1,H3))}setupLightingModel(){return new qEe(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?_e(this.clearcoatNode):ZTe,n=this.clearcoatRoughnessNode?_e(this.clearcoatRoughnessNode):QTe;mF.assign(t),xS.assign(wQ({roughness:n}))}if(this.useSheen){const t=this.sheenNode?$e(this.sheenNode):tEe,n=this.sheenRoughnessNode?_e(this.sheenRoughnessNode):nEe;ph.assign(t),$y.assign(n)}if(this.useIridescence){const t=this.iridescenceNode?_e(this.iridescenceNode):iEe,n=this.iridescenceIORNode?_e(this.iridescenceIORNode):sEe,r=this.iridescenceThicknessNode?_e(this.iridescenceThicknessNode):oEe;pB.assign(t),gF.assign(n),yF.assign(r)}if(this.useAnisotropy){const t=(this.anisotropyNode?rn(this.anisotropyNode):rEe).toVar();jy.assign(t.length()),_r(jy.equal(0),()=>{t.assign(rn(1,0))}).Else(()=>{t.divAssign(rn(jy)),jy.assign(jy.saturate())}),vF.assign(jy.pow2().mix(fg.pow2(),1)),HC.assign(X6[0].mul(t.x).add(X6[1].mul(t.y))),ex.assign(X6[1].mul(t.x).sub(X6[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?_e(this.transmissionNode):aEe,n=this.thicknessNode?_e(this.thicknessNode):lEe,r=this.attenuationDistanceNode?_e(this.attenuationDistanceNode):uEe,i=this.attenuationColorNode?$e(this.attenuationColorNode):dEe;if(bF.assign(t),MZ.assign(n),CZ.assign(r),AZ.assign(i),this.useDispersion){const o=this.dispersionNode?_e(this.dispersionNode):yEe;NZ.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?$e(this.clearcoatNormalNode):JTe}setup(e){e.context.setupClearcoatNormal=()=>tx(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.iorNode=e.iorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const IQe=Ye(({normal:s,lightDirection:e,builder:t})=>{const n=s.dot(e),r=rn(n.mul(.5).add(.5),0);if(t.material.gradientMap){const i=F3("gradientMap","texture").context({getUV:()=>r});return $e(i.r)}else{const i=r.fwidth().mul(.5);return ki($e(.7),$e(1),ym(_e(.7).sub(i.x),_e(.7).add(i.x),r.x))}});class kQe extends MB{direct({lightDirection:e,lightColor:t,reflectedLight:n},r){const i=IQe({normal:bB,lightDirection:e,builder:r}).mul(t);n.directDiffuse.addAssign(i.mul(px({diffuseColor:Ms.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(px({diffuseColor:Ms}))),r.indirectDiffuse.mulAssign(t)}}const DQe=new zGe;class OQe extends xo{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(DQe),this.setValues(e)}setupLightingModel(){return new kQe}}const QEe=Ye(()=>{const s=$e(Hs.z,0,Hs.x.negate()).normalize(),e=Hs.cross(s);return rn(s.dot(qi),e.dot(qi)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),LQe=new cZ;class FQe extends xo{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(LQe),this.setValues(e)}setupVariants(e){const t=QEe;let n;e.material.matcap?n=F3("matcap","texture").context({getUV:()=>t}):n=$e(ki(.2,.8,t.y)),Ms.rgb.mulAssign(n.rgb)}}class BQe extends Ho{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if(this.getNodeType(e)==="vec2"){const i=t.cos(),o=t.sin();return hB(i,o,o.negate(),i).mul(n)}else{const i=t,o=o5(mr(1,0,0,0),mr(0,sm(i.x),mu(i.x).negate(),0),mr(0,mu(i.x),sm(i.x),0),mr(0,0,0,1)),l=o5(mr(sm(i.y),0,mu(i.y),0),mr(0,1,0,0),mr(mu(i.y).negate(),0,sm(i.y),0),mr(0,0,0,1)),c=o5(mr(sm(i.z),mu(i.z).negate(),0,0),mr(mu(i.z),sm(i.z),0,0),mr(0,0,1,0),mr(0,0,0,1));return o.mul(l).mul(c).mul(mr(n,1)).xyz}}}const iN=ri(BQe).setParameterLength(2),UQe=new oGe;class JEe extends xo{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(UQe),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,{positionNode:r,rotationNode:i,scaleNode:o,sizeAttenuation:l}=this,c=E5.mul($e(r||0));let h=rn(Tp[0].xyz.length(),Tp[1].xyz.length());o!==null&&(h=h.mul(rn(o))),n.isPerspectiveCamera&&l===!1&&(h=h.mul(c.z.negate()));let m=rN.xy;if(t.center&&t.center.isVector2===!0){const w=LYe("center","vec2",t);m=m.sub(w.sub(.5))}m=m.mul(h);const y=_e(i||eEe),b=iN(m,y);return mr(c.xy.add(b),c.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const zQe=new tZ,VQe=new Ln;class GQe extends JEe{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(zQe),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return E5.mul($e(e||Vo)).xyz}setupVertexSprite(e){const{material:t,camera:n}=e,{rotationNode:r,scaleNode:i,sizeNode:o,sizeAttenuation:l}=this;let c=super.setupVertex(e);if(t.isNodeMaterial!==!0)return c;let h=o!==null?rn(o):gEe;h=h.mul(pTe),n.isPerspectiveCamera&&l===!0&&(h=h.mul(jQe.div(wa.z.negate()))),i&&i.isNode&&(h=h.mul(rn(i)));let m=rN.xy;if(r&&r.isNode){const y=_e(r);m=iN(m,y)}return m=m.mul(h),m=m.div(oQ.div(2)),m=m.mul(c.w),c=c.add(mr(m,0,0)),c}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const jQe=cr(1).onFrameUpdate(function({renderer:s}){const e=s.getSize(VQe);this.value=.5*e.y});class HQe extends MB{constructor(){super(),this.shadowNode=_e(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){Ms.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Ms.rgb)}}const $Qe=new DGe;class WQe extends xo{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues($Qe),this.setValues(e)}setupLightingModel(){return new HQe}}Y3("vec3");Y3("vec3");Y3("vec3");class qQe{constructor(e,t,n){this.renderer=e,this.nodes=t,this.info=n,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(t,n),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class x5{constructor(){this.weakMaps={}}_getWeakMap(e){const t=e.length;let n=this.weakMaps[t];return n===void 0&&(n=new WeakMap,this.weakMaps[t]=n),n}get(e){let t=this._getWeakMap(e);for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let n=this._getWeakMap(e);for(let r=0;r<e.length-1;r++){const i=e[r];n.has(i)===!1&&n.set(i,new WeakMap),n=n.get(i)}return n.set(e[e.length-1],t),this}delete(e){let t=this._getWeakMap(e);for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return!1;return t.delete(e[e.length-1])}}let XQe=0;function YQe(s){const e=Object.keys(s);let t=Object.getPrototypeOf(s);for(;t;){const n=Object.getOwnPropertyDescriptors(t);for(const r in n)if(n[r]!==void 0){const i=n[r];i&&typeof i.get=="function"&&e.push(r)}t=Object.getPrototypeOf(t)}return e}class KQe{constructor(e,t,n,r,i,o,l,c,h,m){this.id=XQe++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=r,this.material=i,this.scene=o,this.camera=l,this.lightsNode=c,this.context=h,this.geometry=r.geometry,this.version=i.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=m,this.clippingContextCacheKey=m!==null?m.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getIndirectOffset(){return this._geometries.getIndirectOffset(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],r=new Set,i={};for(const o of e){let l;if(o.node&&o.node.attribute?l=o.node.attribute:(l=t.getAttribute(o.name),i[o.name]=l.id),l===void 0)continue;n.push(l);const c=l.isInterleavedBufferAttribute?l.data:l;r.add(c)}return this.attributes=n,this.attributesId=i,this.vertexBuffers=Array.from(r.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:r,drawRange:i}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),l=this.getIndex(),c=l!==null;let h=1;if(n.isInstancedBufferGeometry===!0?h=n.instanceCount:e.count!==void 0&&(h=Math.max(0,e.count)),h===0)return null;if(o.instanceCount=h,e.isBatchedMesh===!0)return o;let m=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(m=2);let y=i.start*m,b=(i.start+i.count)*m;r!==null&&(y=Math.max(y,r.start*m),b=Math.min(b,(r.start+r.count)*m));const w=n.attributes.position;let A=1/0;c?A=l.count:w!=null&&(A=w.count),y=Math.max(y,0),b=Math.min(b,A);const I=b-y;return I<0||I===1/0?null:(o.vertexCount=I,o.firstVertex=y,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const r=e.attributes[n];t+=n+",",r.data&&(t+=r.data.stride+","),r.offset&&(t+=r.offset+","),r.itemSize&&(t+=r.itemSize+","),r.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const r=e.morphAttributes[n];t+="morph-"+n+",";for(let i=0,o=r.length;i<o;i++){const l=r[i];t+=l.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:n}=this;let r=t.customProgramCacheKey();for(const i of YQe(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(i))continue;const o=t[i];let l;if(o!==null){const c=typeof o;c==="number"?l=o!==0?"1":"0":c==="object"?(l="{",o.isTexture&&(l+=o.mapping,n.backend.isWebGPUBackend===!0&&(l+=o.magFilter,l+=o.minFilter,l+=o.wrapS,l+=o.wrapT,l+=o.wrapR)),l+="}"):l=String(o)}else l=String(o);r+=l+","}return r+=this.clippingContextCacheKey+",",e.geometry&&(r+=this.getGeometryCacheKey()),e.skeleton&&(r+=e.skeleton.bones.length+","),e.isBatchedMesh&&(r+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(r+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(r+=e.uuid+","),r+=this.context.id+",",r+=e.receiveShadow+",",Tw(r)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const n=this.geometry.getAttribute(t);if(n===void 0||e[t]!==n.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=GC(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=GC(e,1)),e=GC(e,this.renderer.contextNode.id,this.renderer.contextNode.version),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const J1=[];class ZQe{constructor(e,t,n,r,i,o){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=r,this.bindings=i,this.info=o,this.chainMaps={}}get(e,t,n,r,i,o,l,c){const h=this.getChainMap(c);J1[0]=e,J1[1]=t,J1[2]=o,J1[3]=i;let m=h.get(J1);return m===void 0?(m=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,r,i,o,l,c),h.set(J1,m)):(m.camera=r,m.updateClipping(l),m.needsGeometryUpdate&&m.setGeometry(e.geometry),(m.version!==t.version||m.needsUpdate)&&(m.initialCacheKey!==m.getCacheKey()?(m.dispose(),m=this.get(e,t,n,r,i,o,l,c)):m.version=t.version)),J1[0]=null,J1[1]=null,J1[2]=null,J1[3]=null,m}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new x5)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,r,i,o,l,c,h,m,y){const b=this.getChainMap(y),w=new KQe(e,t,n,r,i,o,l,c,h,m);return w.onDispose=()=>{this.pipelines.delete(w),this.bindings.deleteForRender(w),this.nodes.delete(w),b.delete(w.getChainArray())},w}}class C5{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const Ep={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Yy=16,QQe=211,JQe=212;class eJe extends C5{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(n.version===void 0)t===Ep.VERTEX?this.backend.createAttribute(e):t===Ep.INDEX?this.backend.createIndexAttribute(e):t===Ep.STORAGE?this.backend.createStorageAttribute(e):t===Ep.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const r=this._getBufferAttribute(e);(n.version<r.version||r.usage===vA)&&(this.backend.updateAttribute(e),n.version=r.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function eMe(s){return s.index!==null?s.index.version:s.attributes.position.version}function tMe(s){return s.index!==null?s.index.id:s.attributes.position.id}function Qxe(s){const e=[],t=s.index,n=s.attributes.position;if(t!==null){const i=t.array;for(let o=0,l=i.length;o<l;o+=3){const c=i[o+0],h=i[o+1],m=i[o+2];e.push(c,h,h,m,m,c)}}else{const i=n.array;for(let o=0,l=i.length/3-1;o<l;o+=3){const c=o+0,h=o+1,m=o+2;e.push(c,h,h,m,m,c)}}const r=new(n.count>=65535?ZK:iB)(e,1);return r.version=eMe(s),r.__id=tMe(s),r}class tJe extends C5{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,n=this.get(t);n.initialized=!0,this.info.memory.geometries++;const r=()=>{this.info.memory.geometries--;const i=t.index,o=e.getAttributes();i!==null&&this.attributes.delete(i);for(const c of o)this.attributes.delete(c);const l=this.wireframes.get(t);l!==void 0&&this.attributes.delete(l),t.removeEventListener("dispose",r),this._geometryDisposeListeners.delete(t)};t.addEventListener("dispose",r),this._geometryDisposeListeners.set(t,r)}updateAttributes(e){const t=e.getAttributes();for(const i of t)i.isStorageBufferAttribute||i.isStorageInstancedBufferAttribute?this.updateAttribute(i,Ep.STORAGE):this.updateAttribute(i,Ep.VERTEX);const n=this.getIndex(e);n!==null&&this.updateAttribute(n,Ep.INDEX);const r=e.geometry.indirect;r!==null&&this.updateAttribute(r,Ep.INDIRECT)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndirectOffset(e){return e.geometry.indirectOffset}getIndex(e){const{geometry:t,material:n}=e;let r=t.index;if(n.wireframe===!0){const i=this.wireframes;let o=i.get(t);o===void 0?(o=Qxe(t),i.set(t,o)):(o.version!==eMe(t)||o.__id!==tMe(t))&&(this.attributes.delete(o),o=Qxe(t),i.set(t,o)),r=o}return r}dispose(){for(const[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener("dispose",t);this._geometryDisposeListeners.clear()}}class nJe{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):Ht("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class nMe{constructor(e){this.cacheKey=e,this.usedTimes=0}}class rJe extends nMe{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}}class iJe extends nMe{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let sJe=0;class tX{constructor(e,t,n,r=null,i=null){this.id=sJe++,this.code=e,this.stage=t,this.name=n,this.transforms=r,this.attributes=i,this.usedTimes=0}}class oJe extends C5{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,r=this.get(e);if(this._needsComputeUpdate(e)){const i=r.pipeline;i&&(i.usedTimes--,i.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let l=this.programs.compute.get(o.computeShader);l===void 0&&(i&&i.computeProgram.usedTimes===0&&this._releaseProgram(i.computeProgram),l=new tX(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,l),n.createProgram(l));const c=this._getComputeCacheKey(e,l);let h=this.caches.get(c);h===void 0&&(i&&i.usedTimes===0&&this._releasePipeline(i),h=this._getComputePipeline(e,l,c,t)),h.usedTimes++,l.usedTimes++,r.version=e.version,r.pipeline=h}return r.pipeline}getForRender(e,t=null){const{backend:n}=this,r=this.get(e);if(this._needsRenderUpdate(e)){const i=r.pipeline;i&&(i.usedTimes--,i.vertexProgram.usedTimes--,i.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),l=e.material?e.material.name:"";let c=this.programs.vertex.get(o.vertexShader);c===void 0&&(i&&i.vertexProgram.usedTimes===0&&this._releaseProgram(i.vertexProgram),c=new tX(o.vertexShader,"vertex",l),this.programs.vertex.set(o.vertexShader,c),n.createProgram(c));let h=this.programs.fragment.get(o.fragmentShader);h===void 0&&(i&&i.fragmentProgram.usedTimes===0&&this._releaseProgram(i.fragmentProgram),h=new tX(o.fragmentShader,"fragment",l),this.programs.fragment.set(o.fragmentShader,h),n.createProgram(h));const m=this._getRenderCacheKey(e,c,h);let y=this.caches.get(m);y===void 0?(i&&i.usedTimes===0&&this._releasePipeline(i),y=this._getRenderPipeline(e,c,h,m,t)):e.pipeline=y,y.usedTimes++,c.usedTimes++,h.usedTimes++,r.pipeline=y}return r.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,r){n=n||this._getComputeCacheKey(e,t);let i=this.caches.get(n);return i===void 0&&(i=new iJe(n,t),this.caches.set(n,i),this.backend.createComputePipeline(i,r)),i}_getRenderPipeline(e,t,n,r,i){r=r||this._getRenderCacheKey(e,t,n);let o=this.caches.get(r);return o===void 0&&(o=new rJe(r,t,n),this.caches.set(r,o),e.pipeline=o,this.backend.createRenderPipeline(e,i)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class aJe extends C5{constructor(e,t,n,r,i,o){super(),this.backend=e,this.textures=n,this.pipelines=i,this.attributes=r,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const n of t){const r=this.get(n);r.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),r.bindGroup=n)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t){const r=this.get(n);r.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),r.bindGroup=n)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t)this.backend.deleteBindGroupData(n),this.delete(n)}deleteForRender(e){const t=e.getBindings();for(const n of t)this.backend.deleteBindGroupData(n),this.delete(n)}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){const n=t.attribute,r=n.isIndirectStorageBufferAttribute?Ep.INDIRECT:Ep.STORAGE;this.attributes.update(n,r)}}_update(e,t){const{backend:n}=this;let r=!1,i=!0,o=0,l=0;for(const c of e.bindings)if(this.nodes.updateGroup(c)!==!1){if(c.isStorageBuffer){const m=c.attribute,y=m.isIndirectStorageBufferAttribute?Ep.INDIRECT:Ep.STORAGE,b=n.get(c);this.attributes.update(m,y),b.attribute!==m&&(b.attribute=m,r=!0)}if(c.isUniformBuffer)c.update()&&n.updateBinding(c);else if(c.isSampledTexture){const m=c.update(),y=c.texture,b=this.textures.get(y);if(m&&(this.textures.updateTexture(y),c.generation!==b.generation&&(c.generation=b.generation,r=!0),b.bindGroups.add(e)),n.get(y).externalTexture!==void 0||b.isDefaultTexture?i=!1:(o=o*10+y.id,l+=y.version),y.isStorageTexture===!0&&y.mipmapsAutoUpdate===!0){const A=this.get(y);c.store===!0?A.needsMipmap=!0:this.textures.needsMipmaps(y)&&A.needsMipmap===!0&&(this.backend.generateMipmaps(y),A.needsMipmap=!1)}}else if(c.isSampler&&c.update()){const y=this.textures.updateSampler(c.texture);c.samplerKey!==y&&(c.samplerKey=y,r=!0)}c.isBuffer&&c.updateRanges.length>0&&c.clearUpdateRanges()}r===!0&&this.backend.updateBindings(e,t,i?o:0,l)}}function lJe(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.z!==e.z?s.z-e.z:s.id-e.id}function Jxe(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.z!==e.z?e.z-s.z:s.id-e.id}function e7e(s){return(s.transmission>0||s.transmissionNode&&s.transmissionNode.isNode)&&s.side===oa&&s.forceSinglePass===!1}class cJe{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,r,i,o,l){let c=this.renderItems[this.renderItemsIndex];return c===void 0?(c={id:e.id,object:e,geometry:t,material:n,groupOrder:r,renderOrder:e.renderOrder,z:i,group:o,clippingContext:l},this.renderItems[this.renderItemsIndex]=c):(c.id=e.id,c.object=e,c.geometry=t,c.material=n,c.groupOrder=r,c.renderOrder=e.renderOrder,c.z=i,c.group=o,c.clippingContext=l),this.renderItemsIndex++,c}push(e,t,n,r,i,o,l){const c=this.getNextRenderItem(e,t,n,r,i,o,l);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(e7e(n)&&this.transparentDoublePass.push(c),this.transparent.push(c)):this.opaque.push(c)}unshift(e,t,n,r,i,o,l){const c=this.getNextRenderItem(e,t,n,r,i,o,l);n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(e7e(n)&&this.transparentDoublePass.unshift(c),this.transparent.unshift(c)):this.opaque.unshift(c)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||lJe),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||Jxe),this.transparent.length>1&&this.transparent.sort(t||Jxe)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const n=this.renderItems[e];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null,n.clippingContext=null}}}const C_=[];class uJe{constructor(e){this.lighting=e,this.lists=new x5}get(e,t){const n=this.lists;C_[0]=e,C_[1]=t;let r=n.get(C_);return r===void 0&&(r=new cJe(this.lighting,e,t),n.set(C_,r)),C_[0]=null,C_[1]=null,r}dispose(){this.lists=new x5}}let dJe=0;class hJe{constructor(){this.id=dJe++,this.mrt=null,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new zr,this.scissor=!1,this.scissorValue=new zr,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.camera=null,this.isRenderContext=!0}getCacheKey(){return rMe(this)}}function rMe(s){const{textures:e,activeCubeFace:t,activeMipmapLevel:n}=s,r=[t,n];for(const i of e)r.push(i.id);return JA(r)}class pJe{constructor(e){this.renderer=e,this._renderContexts={}}get(e=null,t=null,n=0){let r;if(e===null)r="default";else{const c=e.texture.format,h=e.texture.type;r=`${e.textures.length}:${c}:${h}:${e.samples}:${e.depthBuffer}:${e.stencilBuffer}`}const i=t!==null?t.id:"default",o=r+"-"+i+"-"+n;let l=this._renderContexts[o];return l===void 0&&(l=new hJe,l.mrt=t,this._renderContexts[o]=l),e!==null&&(l.sampleCount=e.samples===0?1:e.samples),l.clearDepthValue=this.renderer.getClearDepth(),l.clearStencilValue=this.renderer.getClearStencil(),l}dispose(){this._renderContexts={}}}const fJe=new be;class mJe extends C5{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e,t=0){const n=this.get(e),r=e.samples===0?1:e.samples,i=n.depthTextureMips||(n.depthTextureMips={}),o=e.textures,l=this.getSize(o[0]),c=l.width>>t,h=l.height>>t;let m=e.depthTexture||i[t];const y=e.depthBuffer===!0||e.stencilBuffer===!0;let b=!1;m===void 0&&y&&(m=new Cc,m.format=e.stencilBuffer?_u:B0,m.type=e.stencilBuffer?gh:Ds,m.image.width=c,m.image.height=h,m.image.depth=l.depth,m.renderTarget=e,m.isArrayTexture=e.multiview===!0&&l.depth>1,i[t]=m),(n.width!==l.width||l.height!==n.height)&&(b=!0,m&&(m.needsUpdate=!0,m.image.width=c,m.image.height=h,m.image.depth=m.isArrayTexture?m.image.depth:1)),n.width=l.width,n.height=l.height,n.textures=o,n.depthTexture=m||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==r&&(b=!0,m&&(m.needsUpdate=!0),n.sampleCount=r);const w={sampleCount:r};if(e.isXRRenderTarget!==!0){for(let A=0;A<o.length;A++){const I=o[A];b&&(I.needsUpdate=!0),this.updateTexture(I,w)}m&&this.updateTexture(m,w)}n.initialized!==!0&&(n.initialized=!0,n.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener("dispose",n.onDispose))}updateTexture(e,t={}){const n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;const r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,i=this.backend;if(r&&n.initialized===!0&&i.destroyTexture(e),e.isFramebufferTexture){const h=this.renderer.getRenderTarget();h?e.type=h.texture.type:e.type=yo}const{width:o,height:l,depth:c}=this.getSize(e);if(t.width=o,t.height=l,t.depth=c,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,l):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,r||e.isStorageTexture===!0||e.isExternalTexture===!0)i.createTexture(e,t),n.generation=e.version;else if(e.version>0){const h=e.image;if(h===void 0)qt("Renderer: Texture marked for update but image is undefined.");else if(h.complete===!1)qt("Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const y=[];for(const b of e.images)y.push(b);t.images=y}else t.image=h;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(i.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&i.updateTexture(e,t);const m=e.isStorageTexture===!0&&e.mipmapsAutoUpdate===!1;t.needsMipmaps&&e.mipmaps.length===0&&!m&&i.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else i.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;n.initialized!==!0&&(n.initialized=!0,n.generation=e.version,n.bindGroups=new Set,this.info.memory.textures++,e.isVideoTexture&&Zn.enabled===!0&&Zn.getTransfer(e.colorSpace)!==Yn&&qt("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),n.onDispose=()=>{this._destroyTexture(e)},e.addEventListener("dispose",n.onDispose)),n.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=fJe){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?(t.width=n.videoWidth||1,t.height=n.videoHeight||1,t.depth=1):typeof VideoFrame<"u"&&n instanceof VideoFrame?(t.width=n.displayWidth||1,t.height=n.displayHeight||1,t.depth=1):(t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let r;return e.mipmaps.length>0?r=e.mipmaps.length:e.isCompressedTexture===!0?r=1:r=Math.floor(Math.log2(Math.max(t,n)))+1,r}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyRenderTarget(e){if(this.has(e)===!0){const t=this.get(e),n=t.textures,r=t.depthTexture;e.removeEventListener("dispose",t.onDispose);for(let i=0;i<n.length;i++)this._destroyTexture(n[i]);r&&this._destroyTexture(r),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(this.has(e)===!0){const t=this.get(e);e.removeEventListener("dispose",t.onDispose);const n=t.isDefaultTexture;if(this.backend.destroyTexture(e,n),t.bindGroups)for(const r of t.bindGroups){const i=this.backend.get(r);i.groups=void 0,i.versions=void 0}this.delete(e),this.info.memory.textures--}}}class AQ extends Tn{constructor(e,t,n,r=1){super(e,t,n),this.a=r}set(e,t,n,r=1){return this.a=r,super.set(e,t,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class iMe extends hs{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){const n=this.getNodeType(e),r=e.getStructTypeNode(n);let i;return r!==null?i=r.getMemberType(e,t):(Ht(`TSL: Member "${t}" not found in struct "${n}".`,new Ea),i="float"),i}getHash(){return this.uuid}generate(){return this.name}}const gJe=(s,e)=>new iMe(s,e);class yJe extends Jn{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this._currentNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput(e)?this.outputNode.getElementType(e):"void"}getNodeType(e){return this.hasOutput(e)?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput(e)?this.outputNode.getMemberType(e,t):"void"}addToStack(e,t=this.nodes.length){return e.isNode!==!0?(Ht("TSL: Invalid node added to stack.",new Ea),this):(this.nodes.splice(t,0,e),this)}addToStackBefore(e){const t=this._currentNode?this.nodes.indexOf(this._currentNode):0;return this.addToStack(e,t)}If(e,t){const n=new dS(t);return this._currentCond=Ec(e,n),this.addToStack(this._currentCond)}ElseIf(e,t){const n=new dS(t),r=Ec(e,n);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new dS(e),this}Switch(e){return this._expressionNode=Kn(e),this}Case(...e){const t=[];if(e.length>=2)for(let l=0;l<e.length-1;l++)t.push(this._expressionNode.equal(Kn(e[l])));else Ht("TSL: Invalid parameter length. Case() requires at least two parameters.",new Ea);const n=e[e.length-1],r=new dS(n);let i=t[0];for(let l=1;l<t.length;l++)i=i.or(t[l]);const o=Ec(i,r);return this._currentCond===null?(this._currentCond=o,this.addToStack(this._currentCond)):(this._currentCond.elseNode=o,this._currentCond=o,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const r of this.getChildren())r.isVarNode&&r.isIntent(e)&&r.isAssign(e)!==!0||(t["node"+n++]=r);return t.outputNode||null}hasOutput(e){return this.outputNode&&this.outputNode.isNode&&this.outputNode.getNodeType(e)!=="void"}build(e,...t){const n=bZ(),r=e.buildStage;PA(this),e.setActiveStack(this);const i=h=>{if(this._currentNode=h,!(h.isVarNode&&h.isIntent(e)&&h.isAssign(e)!==!0)){if(r==="setup")h.build(e);else if(r==="analyze")h.build(e,this);else if(r==="generate"){const m=e.getDataFromNode(h,"any").stages,y=m&&m[e.shaderStage];if(h.isVarNode&&y&&y.length===1&&y[0]&&y[0].isStackNode)return;h.build(e,"void")}}},o=[...this.nodes];for(const h of o)i(h);this._currentNode=null;const l=this.nodes.filter(h=>o.indexOf(h)===-1);for(const h of l)i(h);let c;return this.hasOutput(e)?c=this.outputNode.build(e,...t):c=super.build(e,...t),PA(n),e.removeActiveStack(this),c}}const QL=ri(yJe).setParameterLength(0,1);function vJe(s){return Object.entries(s).map(([e,t])=>typeof t=="string"?{name:e,type:t,atomic:!1}:{name:e,type:t.type,atomic:t.atomic||!1})}class xJe extends Jn{static get type(){return"StructTypeNode"}constructor(e,t=null){super("struct"),this.membersLayout=vJe(e),this.name=t,this.isStructLayoutNode=!0}getLength(){const e=Float32Array.BYTES_PER_ELEMENT;let t=1,n=0;for(const r of this.membersLayout){const i=r.type,o=jXe(i),l=HXe(i)/e;t=Math.max(t,l);const h=n%t%l;h!==0&&(n+=l-h),n+=o}return Math.ceil(n/t)*t}getMemberType(e,t){const n=this.membersLayout.find(r=>r.name===t);return n?n.type:"void"}getNodeType(e){return e.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(e){e.getStructTypeFromNode(this,this.membersLayout,this.name),e.addInclude(this)}generate(e){return this.getNodeType(e)}}class bJe extends Jn{static get type(){return"StructNode"}constructor(e,t){super("vec3"),this.structTypeNode=e,this.values=t,this.isStructNode=!0}getNodeType(e){return this.structTypeNode.getNodeType(e)}getMemberType(e,t){return this.structTypeNode.getMemberType(e,t)}_getChildren(){const e=super._getChildren(),t=e.find(n=>n.childNode===this.structTypeNode);return e.splice(e.indexOf(t),1),e.push(t),e}generate(e){const t=e.getVarFromNode(this),n=t.type,r=e.getPropertyName(t);return e.addLineFlowCode(`${r} = ${e.generateStruct(n,this.structTypeNode.membersLayout,this.values)}`,this),t.name}}const _Je=(s,e=null)=>{const t=new xJe(s,e),n=(...r)=>{let i=null;if(r.length>0)if(r[0].isNode){i={};const o=Object.keys(s);for(let l=0;l<r.length;l++)i[o[l]]=r[l]}else i=r[0];return new bJe(t,i)};return n.layout=t,n.isStruct=!0,n};class sMe extends Jn{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}getNodeType(){return"OutputType"}generate(e){const t=e.getDataFromNode(this);if(t.membersLayout===void 0){const o=this.members,l=[];for(let c=0;c<o.length;c++){const h="m"+c,m=o[c].getNodeType(e);l.push({name:h,type:m,index:c})}t.membersLayout=l,t.structType=e.getOutputStructTypeFromNode(this,t.membersLayout)}const n=e.getOutputStructName(),r=this.members,i=n!==""?n+".":"";for(let o=0;o<r.length;o++){const l=r[o].build(e);e.addLineFlowCode(`${i}m${o} = ${l}`,this)}return n}}const SJe=ri(sMe);class oMe{constructor(e=L0){this.blending=e,this.blendSrc=h5,this.blendDst=p5,this.blendEquation=i0,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.premultiplyAlpha=!1}copy(e){return this.blending=e.blending,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.premultiplyAlpha=e.premultiplyAlpha,this}clone(){return new this.constructor().copy(this)}}const wJe=new oMe(El),TJe=new oMe(PK);function aMe(s,e){for(let t=0;t<s.length;t++)if(s[t].name===e)return t;return-1}class EJe extends sMe{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.blendModes={output:TJe},this.isMRTNode=!0}setBlendMode(e,t){return this.blendModes[e]=t,this}getBlendMode(e){return this.blendModes[e]||wJe}has(e){return this.outputNodes[e]!==void 0}get(e){return this.outputNodes[e]}merge(e){const t={...this.outputNodes,...e.outputNodes},n={...this.blendModes,...e.blendModes},r=lMe(t);return r.blendings=n,r}setup(e){const t=this.outputNodes,n=e.renderer.getRenderTarget(),r=[],i=n.textures;for(const o in t){const l=aMe(i,o);r[l]=mr(t[o])}return this.members=r,super.setup(e)}}const lMe=ri(EJe);let sN=class extends Ho{static get type(){return"BitcastNode"}constructor(e,t,n=null){super(),this.valueNode=e,this.conversionType=t,this.inputType=n,this.isBitcastNode=!0}getNodeType(e){if(this.inputType!==null){const t=this.valueNode.getNodeType(e),n=e.getTypeLength(t);return e.getTypeFromLength(n,this.conversionType)}return this.conversionType}generate(e){const t=this.getNodeType(e);let n="";if(this.inputType!==null){const r=this.valueNode.getNodeType(e);n=e.getTypeLength(r)===1?this.inputType:e.changeComponentType(r,this.inputType)}else n=this.valueNode.getNodeType(e);return`${e.getBitcastMethod(t,n)}( ${this.valueNode.build(e,n)} )`}};const cMe=ln(sN).setParameterLength(2),MJe=s=>new sN(s,"int","float"),uMe=s=>new sN(s,"uint","float"),CJe=s=>new sN(s,"float","int"),AJe=s=>new sN(s,"float","uint"),UO={};let r9=class JL extends Dt{static get type(){return"BitcountNode"}constructor(e,t){super(e,t),this.isBitcountNode=!0}_resolveElementType(e,t,n){n==="int"?t.assign(cMe(e,"uint")):t.assign(e)}_returnDataNode(e){switch(e){case"uint":return Jt;case"int":return ze;case"uvec2":return _Z;case"uvec3":return _x;case"uvec4":return EZ;case"ivec2":return tl;case"ivec3":return SZ;case"ivec4":return TZ}}_createTrailingZerosBaseLayout(e,t){const n=this._returnDataNode(t);return Ye(([i])=>{const o=Jt(0);this._resolveElementType(i,o,t);const l=_e(o.bitAnd(BZ(o))),h=uMe(l).shiftRight(23).sub(127);return n(h)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createLeadingZerosBaseLayout(e,t){const n=this._returnDataNode(t);return Ye(([i])=>{_r(i.equal(Jt(0)),()=>Jt(32));const o=Jt(0),l=Jt(0);return this._resolveElementType(i,o,t),_r(o.shiftRight(16).equal(0),()=>{l.addAssign(16),o.shiftLeftAssign(16)}),_r(o.shiftRight(24).equal(0),()=>{l.addAssign(8),o.shiftLeftAssign(8)}),_r(o.shiftRight(28).equal(0),()=>{l.addAssign(4),o.shiftLeftAssign(4)}),_r(o.shiftRight(30).equal(0),()=>{l.addAssign(2),o.shiftLeftAssign(2)}),_r(o.shiftRight(31).equal(0),()=>{l.addAssign(1)}),n(l)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createOneBitsBaseLayout(e,t){const n=this._returnDataNode(t);return Ye(([i])=>{const o=Jt(0);this._resolveElementType(i,o,t),o.assign(o.sub(o.shiftRight(Jt(1)).bitAnd(Jt(1431655765)))),o.assign(o.bitAnd(Jt(858993459)).add(o.shiftRight(Jt(2)).bitAnd(Jt(858993459))));const l=o.add(o.shiftRight(Jt(4))).bitAnd(Jt(252645135)).mul(Jt(16843009)).shiftRight(Jt(24));return n(l)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createMainLayout(e,t,n,r){const i=this._returnDataNode(t);return Ye(([l])=>{if(n===1)return i(r(l));{const c=i(0),h=["x","y","z","w"];for(let m=0;m<n;m++){const y=h[m];c[y].assign(r(l[y]))}return c}}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}setup(e){const{method:t,aNode:n}=this,{renderer:r}=e;if(r.backend.isWebGPUBackend)return super.setup(e);const i=this.getInputType(e),o=e.getElementType(i),l=e.getTypeLength(i),c=`${t}_base_${o}`,h=`${t}_${i}`;let m=UO[c];if(m===void 0){switch(t){case JL.COUNT_LEADING_ZEROS:{m=this._createLeadingZerosBaseLayout(c,o);break}case JL.COUNT_TRAILING_ZEROS:{m=this._createTrailingZerosBaseLayout(c,o);break}case JL.COUNT_ONE_BITS:{m=this._createOneBitsBaseLayout(c,o);break}}UO[c]=m}let y=UO[h];return y===void 0&&(y=this._createMainLayout(h,i,l,m),UO[h]=y),Ye(()=>y(n))()}};r9.COUNT_TRAILING_ZEROS="countTrailingZeros";r9.COUNT_LEADING_ZEROS="countLeadingZeros";r9.COUNT_ONE_BITS="countOneBits";const NJe=ln(r9,r9.COUNT_TRAILING_ZEROS).setParameterLength(1),PJe=ln(r9,r9.COUNT_LEADING_ZEROS).setParameterLength(1),RJe=ln(r9,r9.COUNT_ONE_BITS).setParameterLength(1),IJe=Ye(([s])=>{const e=s.toUint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).toFloat().mul(1/2**32)}),aK=(s,e)=>wp(qr(4,s.mul(Fi(1,s))),e),kJe=(s,e)=>s.lessThan(.5)?aK(s.mul(2),e).div(2):Fi(1,aK(qr(Fi(1,s),2),e).div(2)),DJe=(s,e,t)=>wp(_h(wp(s,e),Ha(wp(s,e),wp(Fi(1,s),t))),1/e),OJe=(s,e)=>mu(_F.mul(e.mul(s).sub(1))).div(_F.mul(e.mul(s).sub(1)));class NQ extends Ho{static get type(){return"PackFloatNode"}constructor(e,t){super(),this.vectorNode=t,this.encoding=e,this.isPackFloatNode=!0}getNodeType(){return"uint"}generate(e){const t=this.vectorNode.getNodeType(e);return`${e.getFloatPackingMethod(this.encoding)}(${this.vectorNode.build(e,t)})`}}const LJe=ln(NQ,"snorm").setParameterLength(1),FJe=ln(NQ,"unorm").setParameterLength(1),BJe=ln(NQ,"float16").setParameterLength(1);class PQ extends Ho{static get type(){return"UnpackFloatNode"}constructor(e,t){super(),this.uintNode=t,this.encoding=e,this.isUnpackFloatNode=!0}getNodeType(){return"vec2"}generate(e){const t=this.uintNode.getNodeType(e);return`${e.getFloatUnpackingMethod(this.encoding)}(${this.uintNode.build(e,t)})`}}const UJe=ln(PQ,"snorm").setParameterLength(1),zJe=ln(PQ,"unorm").setParameterLength(1),VJe=ln(PQ,"float16").setParameterLength(1),D3=Ye(([s])=>s.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),GJe=Ye(([s])=>$e(D3(s.z.add(D3(s.y.mul(1)))),D3(s.z.add(D3(s.x.mul(1)))),D3(s.y.add(D3(s.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),jJe=Ye(([s,e,t])=>{const n=$e(s).toVar(),r=_e(1.4).toVar(),i=_e(0).toVar(),o=$e(n).toVar();return Cs({start:_e(0),end:_e(3),type:"float",condition:"<="},()=>{const l=$e(GJe(o.mul(2))).toVar();n.addAssign(l.add(t.mul(_e(.1).mul(e)))),o.mulAssign(1.8),r.mulAssign(1.5),n.mulAssign(1.2);const c=_e(D3(n.z.add(D3(n.x.add(D3(n.y)))))).toVar();i.addAssign(c.div(r)),o.addAssign(.14)}),i}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class HJe extends Jn{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFn=null,this.global=!0}getNodeType(e){return this.getCandidateFn(e).shaderNode.layout.type}getCandidateFn(e){const t=this.parametersNodes;let n=this._candidateFn;if(n===null){let r=null,i=-1;for(const o of this.functionNodes){const c=o.shaderNode.layout;if(c===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const h=c.inputs;if(t.length===h.length){let m=0;for(let y=0;y<t.length;y++){const b=t[y],w=h[y];b.getNodeType(e)===w.type&&m++}m>i&&(r=o,i=m)}}this._candidateFn=n=r}return n}setup(e){return this.getCandidateFn(e)(...this.parametersNodes)}}const $Je=ri(HJe),U0=s=>(...e)=>$Je(s,...e),Cw=cr(0).setGroup(gr).onRenderUpdate(s=>s.time),WJe=cr(0).setGroup(gr).onRenderUpdate(s=>s.deltaTime),dMe=cr(0,"uint").setGroup(gr).onRenderUpdate(s=>s.frameId),qJe=(s=Cw)=>s.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),XJe=(s=Cw)=>s.fract().round(),YJe=(s=Cw)=>s.add(.5).fract().mul(2).sub(1).abs(),KJe=(s=Cw)=>s.fract();function ZJe(s,e=null){return s9(e,{getUV:typeof s=="function"?s:()=>s})}const QJe=Ye(([s,e,t=rn(.5)])=>iN(s.sub(t),e).add(t)),JJe=Ye(([s,e,t=rn(.5)])=>{const n=s.sub(t),r=n.dot(n),o=r.mul(r).mul(e);return s.add(n.mul(o))}),eet=Ye(({position:s=null,horizontal:e=!0,vertical:t=!1})=>{let n;s!==null?(n=Tp.toVar(),n[3][0]=s.x,n[3][1]=s.y,n[3][2]=s.z):n=Tp;const r=Fp.mul(n);return NA(e)&&(r[0][0]=Tp[0].length(),r[0][1]=0,r[0][2]=0),NA(t)&&(r[1][0]=0,r[1][1]=Tp[1].length(),r[1][2]=0),r[2][0]=0,r[2][1]=0,r[2][2]=1,K3.mul(r).mul(Vo)}),tet=Ye(([s=null])=>{const e=wF();return wF(gQ(s)).sub(e).lessThan(0).select(_g,s)}),net=Ye(([s,e=Os(),t=_e(0)])=>{const n=s.x,r=s.y,i=t.mod(n.mul(r)).floor(),o=i.mod(n),l=r.sub(i.add(1).div(n).ceil()),c=s.reciprocal(),h=rn(o,l);return e.add(h).mul(c)}),hMe=Ye(([s,e=null,t=null,n=_e(1),r=Vo,i=bd])=>{let o=i.abs().normalize();o=o.div(o.dot($e(1)));const l=r.yz.mul(n),c=r.zx.mul(n),h=r.xy.mul(n),m=s.value,y=e!==null?e.value:m,b=t!==null?t.value:m,w=ts(m,l).mul(o.x),A=ts(y,c).mul(o.y),I=ts(b,h).mul(o.z);return Ha(w,A,I)}),ret=(...s)=>hMe(...s),A_=new dg,v6=new be,N_=new be,nX=new be,ZM=new Pn,zO=new be(0,0,-1),eg=new zr,QM=new be,VO=new be,JM=new zr,GO=new Ln,EF=new Op,iet=_g.flipX();EF.depthTexture=new Cc(1,1);let jO=!1;class RQ extends Cg{static get type(){return"ReflectorNode"}constructor(e={}){super(e.defaultTexture||EF.texture,iet),this._reflectorBaseNode=e.reflector||new set(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=new RQ({defaultTexture:EF.depthTexture,reflector:this._reflectorBaseNode})}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){const e=new this.constructor(this.reflectorNode);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e._reflectorBaseNode=this._reflectorBaseNode,e}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}}class set extends Jn{static get type(){return"ReflectorBaseNode"}constructor(e,t={}){super();const{target:n=new Bi,resolutionScale:r=1,generateMipmaps:i=!1,bounces:o=!0,depth:l=!1,samples:c=0}=t;this.textureNode=e,this.target=n,this.resolutionScale=r,t.resolution!==void 0&&(es('ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".'),this.resolutionScale=t.resolution),this.generateMipmaps=i,this.bounces=o,this.depth=l,this.samples=c,this.updateBeforeType=o?Wr.RENDER:Wr.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(e,t){const n=this.resolutionScale;t.getDrawingBufferSize(GO),e.setSize(Math.round(GO.width*n),Math.round(GO.height*n))}setup(e){return this._updateResolution(EF,e.renderer),super.setup(e)}dispose(){super.dispose();for(const e of this.renderTargets.values())e.dispose()}getVirtualCamera(e){let t=this.virtualCameras.get(e);return t===void 0&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return t===void 0&&(t=new Op(0,0,{type:ro,samples:this.samples}),this.generateMipmaps===!0&&(t.texture.minFilter=tVe,t.texture.generateMipmaps=!0),this.depth===!0&&(t.depthTexture=new Cc),this.renderTargets.set(e,t)),t}updateBefore(e){if(this.bounces===!1&&jO)return!1;jO=!0;const{scene:t,camera:n,renderer:r,material:i}=e,{target:o}=this,l=this.getVirtualCamera(n),c=this.getRenderTarget(l);r.getDrawingBufferSize(GO),this._updateResolution(c,r),N_.setFromMatrixPosition(o.matrixWorld),nX.setFromMatrixPosition(n.matrixWorld),ZM.extractRotation(o.matrixWorld),v6.set(0,0,1),v6.applyMatrix4(ZM),QM.subVectors(N_,nX);const h=QM.dot(v6)>0;let m=!1;if(h===!0&&this.forceUpdate===!1){if(this.hasOutput===!1){jO=!1;return}m=!0}QM.reflect(v6).negate(),QM.add(N_),ZM.extractRotation(n.matrixWorld),zO.set(0,0,-1),zO.applyMatrix4(ZM),zO.add(nX),VO.subVectors(N_,zO),VO.reflect(v6).negate(),VO.add(N_),l.coordinateSystem=n.coordinateSystem,l.position.copy(QM),l.up.set(0,1,0),l.up.applyMatrix4(ZM),l.up.reflect(v6),l.lookAt(VO),l.near=n.near,l.far=n.far,l.updateMatrixWorld(),l.projectionMatrix.copy(n.projectionMatrix),A_.setFromNormalAndCoplanarPoint(v6,N_),A_.applyMatrix4(l.matrixWorldInverse),eg.set(A_.normal.x,A_.normal.y,A_.normal.z,A_.constant);const y=l.projectionMatrix;JM.x=(Math.sign(eg.x)+y.elements[8])/y.elements[0],JM.y=(Math.sign(eg.y)+y.elements[9])/y.elements[5],JM.z=-1,JM.w=(1+y.elements[10])/y.elements[14],eg.multiplyScalar(1/eg.dot(JM));const b=0;y.elements[2]=eg.x,y.elements[6]=eg.y,y.elements[10]=r.coordinateSystem===xh?eg.z-b:eg.z+1-b,y.elements[14]=eg.w,this.textureNode.value=c.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=c.depthTexture),i.visible=!1;const w=r.getRenderTarget(),A=r.getMRT(),I=r.autoClear;r.setMRT(null),r.setRenderTarget(c),r.autoClear=!0;const D=t.name;t.name=(t.name||"Scene")+" [ Reflector ]",m?(r.clear(),this.hasOutput=!1):(r.render(t,l),this.hasOutput=!0),t.name=D,r.setMRT(A),r.setRenderTarget(w),r.autoClear=I,i.visible=!0,jO=!1,this.forceUpdate=!1}get resolution(){return es('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale}set resolution(e){es('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale=e}}const oet=s=>new RQ(s),rX=new J3(-1,1,1,-1,0,1);class aet extends Ki{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Fr([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Fr(t,2))}}const cet=new aet;class Aw extends gn{constructor(e=null){super(cet,e),this.camera=rX,this.isQuadMesh=!0}async renderAsync(e){es('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await e.init(),e.render(this,rX)}render(e){e.render(this,rX)}}const uet=new Ln;class det extends Cg{static get type(){return"RTTNode"}constructor(e,t=null,n=null,r={type:ro}){const i=new Op(t,n,r);super(i.texture,Os()),this.isRTTNode=!0,this.node=e,this.width=t,this.height=n,this.pixelRatio=1,this.renderTarget=i,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new Aw(new xo),this.updateBeforeType=Wr.RENDER}get autoResize(){return this.width===null}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;const n=e*this.pixelRatio,r=t*this.pixelRatio;this.renderTarget.setSize(n,r),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoResize===!0){const r=e.getPixelRatio(),i=e.getSize(uet),o=Math.floor(i.width*r),l=Math.floor(i.height*r);(o!==this.renderTarget.width||l!==this.renderTarget.height)&&(this.renderTarget.setSize(o,l),this.textureNeedsUpdate=!0)}let t="RTT";this.node.name&&(t=this.node.name+" [ "+t+" ]"),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=t;const n=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(n)}clone(){const e=new Cg(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const pMe=(s,...e)=>new det(Kn(s),...e),het=(s,...e)=>s.isSampleNode||s.isTextureNode?s:s.isPassNode?s.getTextureNode():pMe(s,...e),iS=Ye(([s,e,t],n)=>{let r;n.renderer.coordinateSystem===xh?(s=rn(s.x,s.y.oneMinus()).mul(2).sub(1),r=mr($e(s,e),1)):r=mr($e(s.x,s.y.oneMinus(),e).mul(2).sub(1),1);const i=mr(t.mul(r));return i.xyz.div(i.w)}),pet=Ye(([s,e])=>{const t=e.mul(mr(s,1)),n=t.xy.div(t.w).mul(.5).add(.5).toVar();return rn(n.x,n.y.oneMinus())}),fet=Ye(([s,e,t])=>{const n=a5(sa(e)),r=tl(s.mul(n)).toVar(),i=sa(e,r).toVar(),o=sa(e,r.sub(tl(2,0))).toVar(),l=sa(e,r.sub(tl(1,0))).toVar(),c=sa(e,r.add(tl(1,0))).toVar(),h=sa(e,r.add(tl(2,0))).toVar(),m=sa(e,r.add(tl(0,2))).toVar(),y=sa(e,r.add(tl(0,1))).toVar(),b=sa(e,r.sub(tl(0,1))).toVar(),w=sa(e,r.sub(tl(0,2))).toVar(),A=Zs(Fi(_e(2).mul(l).sub(o),i)).toVar(),I=Zs(Fi(_e(2).mul(c).sub(h),i)).toVar(),D=Zs(Fi(_e(2).mul(y).sub(m),i)).toVar(),P=Zs(Fi(_e(2).mul(b).sub(w),i)).toVar(),U=iS(s,i,t).toVar(),j=A.lessThan(I).select(U.sub(iS(s.sub(rn(_e(1).div(n.x),0)),l,t)),U.negate().add(iS(s.add(rn(_e(1).div(n.x),0)),c,t))),C=D.lessThan(P).select(U.sub(iS(s.add(rn(0,_e(1).div(n.y))),y,t)),U.negate().add(iS(s.sub(rn(0,_e(1).div(n.y))),b,t)));return yd(e9(j,C))}),IQ=Ye(([s])=>mm(_e(52.9829189).mul(mm(Np(s,rn(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]}),am=Ye(([s,e,t])=>{const n=_e(2.399963229728653),r=wu(_e(s).add(.5).div(_e(e))),i=_e(s).mul(n).add(t);return rn(sm(i),mu(i)).mul(r)}).setLayout({name:"vogelDiskSample",type:"vec2",inputs:[{name:"sampleIndex",type:"int"},{name:"samplesCount",type:"int"},{name:"phi",type:"float"}]});class met extends Jn{static get type(){return"SampleNode"}constructor(e,t=null){super(),this.callback=e,this.uvNode=t,this.isSampleNode=!0}setup(){return this.sample(Os())}sample(e){return this.callback(e)}}const get=(s,e=null)=>new met(s,Kn(e));let a9=class PC extends Jn{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===PC.OBJECT?this.updateType=Wr.OBJECT:e===PC.MATERIAL?this.updateType=Wr.RENDER:e===PC.BEFORE_OBJECT?this.updateBeforeType=Wr.OBJECT:e===PC.BEFORE_MATERIAL&&(this.updateBeforeType=Wr.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}};a9.OBJECT="object";a9.MATERIAL="material";a9.BEFORE_OBJECT="beforeObject";a9.BEFORE_MATERIAL="beforeMaterial";const PB=(s,e)=>new a9(s,e).toStack(),yet=s=>PB(a9.OBJECT,s),vet=s=>PB(a9.MATERIAL,s),xet=s=>PB(a9.BEFORE_OBJECT,s),bet=s=>PB(a9.BEFORE_MATERIAL,s);class _et extends s5{constructor(e,t,n=Float32Array){const r=ArrayBuffer.isView(e)?e:new n(e*t);super(r,t),this.isStorageInstancedBufferAttribute=!0}}class wet extends ja{constructor(e,t,n=Float32Array){const r=ArrayBuffer.isView(e)?e:new n(e*t);super(r,t),this.isStorageBufferAttribute=!0}}const Tet=(s,e="float")=>{let t,n;e.isStruct===!0?(t=e.layout.getLength(),n=fF("float")):(t=ISe(e),n=fF(e));const r=new wet(s,t,n);return l5(r,e,s)},Eet=(s,e="float")=>{let t,n;e.isStruct===!0?(t=e.layout.getLength(),n=fF("float")):(t=ISe(e),n=fF(e));const r=new _et(s,t,n);return l5(r,e,r.count)};class Met extends Jn{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const Cet=Cn(Met),eC=new Sa,iX=new Pn,fMe=cr(0).setGroup(gr).onRenderUpdate(({scene:s})=>s.backgroundBlurriness),lK=cr(1).setGroup(gr).onRenderUpdate(({scene:s})=>s.backgroundIntensity),mMe=cr(new Pn).setGroup(gr).onRenderUpdate(({scene:s})=>{const e=s.background;return e!==null&&e.isTexture&&e.mapping!==G6?(eC.copy(s.backgroundRotation),eC.x*=-1,eC.y*=-1,eC.z*=-1,iX.makeRotationFromEuler(eC)):iX.identity(),iX});class Aet extends Cg{static get type(){return"StorageTextureNode"}constructor(e,t,n=null){super(e,t),this.storeNode=n,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=F0.WRITE_ONLY}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);return t.storeNode=this.storeNode,t}setAccess(e){return this.access=e,this}setMipLevel(e){return this.mipLevel=e,this}generate(e,t){let n;return this.storeNode!==null?n=this.generateStore(e):n=super.generate(e,t),n}generateSnippet(e,t,n,r,i,o,l,c,h){const m=this.value;return e.generateStorageTextureLoad(m,t,n,r,o,h)}toReadWrite(){return this.setAccess(F0.READ_WRITE)}toReadOnly(){return this.setAccess(F0.READ_ONLY)}toWriteOnly(){return this.setAccess(F0.WRITE_ONLY)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:n,storeNode:r,depthNode:i}=t,o=super.generate(e,"property"),l=n.build(e,this.value.is3DTexture===!0?"uvec3":"uvec2"),c=r.build(e,"vec4"),h=i?i.build(e,"int"):null,m=e.generateTextureStore(e,o,l,h,c);e.addLineFlowCode(m,this)}clone(){const e=super.clone();return e.storeNode=this.storeNode,e.mipLevel=this.mipLevel,e.access=this.access,e}}const gMe=ri(Aet).setParameterLength(1,3),Net=(s,e,t)=>{let n;return s.isStorageTextureNode===!0?(n=s.clone(),n.uvNode=e,n.storeNode=t):n=gMe(s,e,t),t!==null&&n.toStack(),n},Pet=Ye(({texture:s,uv:e})=>{const n=$e().toVar();return _r(e.x.lessThan(1e-4),()=>{n.assign($e(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{n.assign($e(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{n.assign($e(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{n.assign($e(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{n.assign($e(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{n.assign($e(0,0,-1))}).Else(()=>{const i=s.sample(e.add($e(-.01,0,0))).r.sub(s.sample(e.add($e(.01,0,0))).r),o=s.sample(e.add($e(0,-.01,0))).r.sub(s.sample(e.add($e(0,.01,0))).r),l=s.sample(e.add($e(0,0,-.01))).r.sub(s.sample(e.add($e(0,0,.01))).r);n.assign($e(i,o,l))}),n.normalize()});class Ret extends Cg{static get type(){return"Texture3DNode"}constructor(e,t=null,n=null){super(e,t,n),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return $e(.5,.5,.5)}setUpdateMatrix(){}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return Pet({texture:this,uv:e})}}const RB=ri(Ret).setParameterLength(1,3),Iet=(...s)=>RB(...s).setSampler(!1),ket=(s,e,t)=>RB(s,e).level(t);class Det extends _B{static get type(){return"UserDataNode"}constructor(e,t,n=null){super(e,t,n),this.userData=n}updateReference(e){return this.reference=this.userData!==null?this.userData:e.object.userData,this.reference}}const Oet=(s,e,t)=>new Det(s,e,t),t7e=new WeakMap;class Let extends Ho{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=Wr.OBJECT,this.updateAfterType=Wr.OBJECT,this.previousModelWorldMatrix=cr(new Pn),this.previousProjectionMatrix=cr(new Pn).setGroup(gr),this.previousCameraViewMatrix=cr(new Pn)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:n}){const r=n7e(n);this.previousModelWorldMatrix.value.copy(r);const i=yMe(t);i.frameId!==e&&(i.frameId=e,i.previousProjectionMatrix===void 0?(i.previousProjectionMatrix=new Pn,i.previousCameraViewMatrix=new Pn,i.currentProjectionMatrix=new Pn,i.currentCameraViewMatrix=new Pn,i.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),i.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(i.previousProjectionMatrix.copy(i.currentProjectionMatrix),i.previousCameraViewMatrix.copy(i.currentCameraViewMatrix)),i.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),i.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(i.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(i.previousCameraViewMatrix))}updateAfter({object:e}){n7e(e).copy(e.matrixWorld)}setup(){const e=this.projectionMatrix===null?K3:cr(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),n=e.mul(E5).mul(Vo),r=this.previousProjectionMatrix.mul(t).mul(rw),i=n.xy.div(n.w),o=r.xy.div(r.w);return Fi(i,o)}}function yMe(s){let e=t7e.get(s);return e===void 0&&(e={},t7e.set(s,e)),e}function n7e(s,e=0){const t=yMe(s);let n=t[e];return n===void 0&&(t[e]=n=new Pn,t[e].copy(s.matrixWorld)),n}const Fet=Cn(Let),Bet=Ye(([s])=>kQ(s.rgb)),Uet=Ye(([s,e=_e(1)])=>e.mix(kQ(s.rgb),s.rgb)),zet=Ye(([s,e=_e(1)])=>{const t=Ha(s.r,s.g,s.b).div(3),n=s.r.max(s.g.max(s.b)),r=n.sub(t).mul(e).mul(-3);return ki(s.rgb,n,r)}),Vet=Ye(([s,e=_e(1)])=>{const t=$e(.57735,.57735,.57735),n=e.cos();return $e(s.rgb.mul(n).add(t.cross(s.rgb).mul(e.sin()).add(t.mul(Np(t,s.rgb).mul(n.oneMinus())))))}),kQ=(s,e=$e(Zn.getLuminanceCoefficients(new be)))=>Np(s,e),Get=Ye(([s,e=$e(1),t=$e(0),n=$e(1),r=_e(1),i=$e(Zn.getLuminanceCoefficients(new be,vd))])=>{const o=s.rgb.dot($e(i)),l=Go(s.rgb.mul(e).add(t),0).toVar(),c=l.pow(n).toVar();return _r(l.r.greaterThan(0),()=>{l.r.assign(c.r)}),_r(l.g.greaterThan(0),()=>{l.g.assign(c.g)}),_r(l.b.greaterThan(0),()=>{l.b.assign(c.b)}),l.assign(o.add(l.sub(o).mul(r))),mr(l.rgb,s.a)}),jet=Ye(([s,e])=>s.mul(e).floor().div(e));let HO=null;class Het extends EB{static get type(){return"ViewportSharedTextureNode"}constructor(e=_g,t=null){HO===null&&(HO=new nZ),super(e,t,HO)}getTextureForReference(){return HO}updateReference(){return this}}const $et=ri(Het).setParameterLength(0,2),$O=new Ln;let vMe=class extends Cg{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.isPassTextureNode=!0,this.setUpdateMatrix(!1)}setup(e){const t=e.getNodeProperties(this);return t.passNode=this.passNode,super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}},r7e=class extends vMe{static get type(){return"PassMultipleTextureNode"}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n,this.isPassMultipleTextureNode=!0}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}},b5=class xMe extends Ho{static get type(){return"PassNode"}constructor(e,t,n,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const i=new Cc;i.isRenderTargetTexture=!0,i.name="depth";const o=new Op(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:ro,...r});o.texture.name="output",o.depthTexture=i,this.renderTarget=o,this.overrideMaterial=null,this.transparent=!0,this.opaque=!0,this.contextNode=null,this._contextNodeCache=null,this._textures={output:o.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=cr(0),this._cameraFar=cr(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=Wr.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return qt("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return qt("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const n=this._textures[e],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=new r7e(this,e),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=new r7e(this,e,!0),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const n=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=vQ(this.getTextureNode(e),n,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const n=this._cameraNear,r=this._cameraFar,i=this.getViewZNode(e);this._linearDepthNodes[e]=t=SS(i,n,r)}return t}async compileAsync(e){const t=e.getRenderTarget(),n=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(n)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getOutputBufferType(),this.scope===xMe.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let r,i;const o=t.getOutputRenderTarget();o&&o.isXRRenderTarget===!0?(i=1,r=t.xr.getCamera(),t.xr.updateCamera(r),$O.set(o.width,o.height)):(r=this.camera,i=t.getPixelRatio(),t.getSize($O)),this._pixelRatio=i,this.setSize($O.width,$O.height);const l=t.getRenderTarget(),c=t.getMRT(),h=t.autoClear,m=t.transparent,y=t.opaque,b=r.layers.mask,w=t.contextNode,A=n.overrideMaterial;this._cameraNear.value=r.near,this._cameraFar.value=r.far,this._layers!==null&&(r.layers.mask=this._layers.mask);for(const D in this._previousTextures)this.toggleTexture(D);this.overrideMaterial!==null&&(n.overrideMaterial=this.overrideMaterial),t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0,t.transparent=this.transparent,t.opaque=this.opaque,this.contextNode!==null&&((this._contextNodeCache===null||this._contextNodeCache.version!==this.version)&&(this._contextNodeCache={version:this.version,context:s9({...t.contextNode.getFlowContextData(),...this.contextNode.getFlowContextData()})}),t.contextNode=this._contextNodeCache.context);const I=n.name;n.name=this.name?this.name:n.name,t.render(n,r),n.name=I,n.overrideMaterial=A,t.setRenderTarget(l),t.setMRT(c),t.autoClear=h,t.transparent=m,t.opaque=y,t.contextNode=w,r.layers.mask=b}setSize(e,t){this._width=e,this._height=t;const n=Math.floor(this._width*this._pixelRatio*this._resolutionScale),r=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(n,r),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,n,r){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new zr),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,n,r),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,n,r){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new zr),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,n,r),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}};b5.COLOR="color";b5.DEPTH="depth";const Wet=(s,e,t)=>new b5(b5.COLOR,s,e,t),qet=(s,e)=>new vMe(s,e),Xet=(s,e,t)=>new b5(b5.DEPTH,s,e,t);class Yet extends b5{static get type(){return"ToonOutlinePassNode"}constructor(e,t,n,r,i){super(b5.COLOR,e,t),this.colorNode=n,this.thicknessNode=r,this.alphaNode=i,this._materialCache=new WeakMap,this.name="Outline Pass"}updateBefore(e){const{renderer:t}=e,n=t.getRenderObjectFunction();t.setRenderObjectFunction((r,i,o,l,c,h,m,y)=>{if((c.isMeshToonMaterial||c.isMeshToonNodeMaterial)&&c.wireframe===!1){const b=this._getOutlineMaterial(c);t.renderObject(r,i,o,l,b,h,m,y)}t.renderObject(r,i,o,l,c,h,m,y)}),super.updateBefore(e),t.setRenderObjectFunction(n)}_createMaterial(){const e=new xo;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=bs;const t=bd.negate(),n=K3.mul(E5),r=_e(1),i=n.mul(mr(Vo,1)),o=n.mul(mr(Vo.add(t),1)),l=yd(i.sub(o));return e.vertexNode=i.add(l.mul(this.thicknessNode).mul(i.w).mul(r)),e.colorNode=mr(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return t===void 0&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}const Ket=(s,e,t=new Tn(0,0,0),n=.003,r=1)=>new Yet(s,e,Kn(t),Kn(n),Kn(r)),bMe=Ye(([s,e])=>s.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),_Me=Ye(([s,e])=>(s=s.mul(e),s.div(s.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),SMe=Ye(([s,e])=>{s=s.mul(e),s=s.sub(.004).max(0);const t=s.mul(s.mul(6.2).add(.5)),n=s.mul(s.mul(6.2).add(1.7)).add(.06);return t.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Zet=Ye(([s])=>{const e=s.mul(s.add(.0245786)).sub(90537e-9),t=s.mul(s.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),wMe=Ye(([s,e])=>{const t=o0(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=o0(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return s=s.mul(e).div(.6),s=t.mul(s),s=Zet(s),s=n.mul(s),s.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Qet=o0($e(1.6605,-.1246,-.0182),$e(-.5876,1.1329,-.1006),$e(-.0728,-.0083,1.1187)),Jet=o0($e(.6274,.0691,.0164),$e(.3293,.9195,.088),$e(.0433,.0113,.8956)),ett=Ye(([s])=>{const e=$e(s).toVar(),t=$e(e.mul(e)).toVar(),n=$e(t.mul(t)).toVar();return _e(15.5).mul(n.mul(t)).sub(qr(40.14,n.mul(e))).add(qr(31.96,n).sub(qr(6.868,t.mul(e))).add(qr(.4298,t).add(qr(.1191,e).sub(.00232))))}),TMe=Ye(([s,e])=>{const t=$e(s).toVar(),n=o0($e(.856627153315983,.137318972929847,.11189821299995),$e(.0951212405381588,.761241990602591,.0767994186031903),$e(.0482516061458583,.101439036467562,.811302368396859)),r=o0($e(1.1271005818144368,-.1413297634984383,-.14132976349843826),$e(-.11060664309660323,1.157823702216272,-.11060664309660294),$e(-.016493938717834573,-.016493938717834257,1.2519364065950405)),i=_e(-12.47393),o=_e(4.026069);return t.mulAssign(e),t.assign(Jet.mul(t)),t.assign(n.mul(t)),t.assign(Go(t,1e-10)),t.assign(vg(t)),t.assign(t.sub(i).div(o.sub(i))),t.assign(gm(t,0,1)),t.assign(ett(t)),t.assign(r.mul(t)),t.assign(wp(Go($e(0),t),$e(2.2))),t.assign(Qet.mul(t)),t.assign(gm(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),EMe=Ye(([s,e])=>{const t=_e(.76),n=_e(.15);s=s.mul(e);const r=xd(s.r,xd(s.g,s.b)),i=Ec(r.lessThan(.08),r.sub(qr(6.25,r.mul(r))),.04);s.subAssign(i);const o=Go(s.r,Go(s.g,s.b));_r(o.lessThan(t),()=>s);const l=Fi(1,t),c=Fi(1,l.mul(l).div(o.add(l.sub(t))));s.mulAssign(c.div(o));const h=Fi(1,_h(1,n.mul(o.sub(c)).add(1)));return ki(s,$e(c),h)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class xl extends Jn{static get type(){return"CodeNode"}constructor(e="",t=[],n=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=n}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const r of t)r.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const IB=ri(xl).setParameterLength(1,3),ttt=(s,e)=>IB(s,e,"js"),ntt=(s,e)=>IB(s,e,"wgsl"),rtt=(s,e)=>IB(s,e,"glsl");class MMe extends xl{static get type(){return"FunctionNode"}constructor(e="",t=[],n=""){super(e,t,n)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),r=n.name,i=n.type,o=e.getCodeFromNode(this,i);r!==""&&(o.name=r);const l=e.getPropertyName(o),c=this.getNodeFunction(e).getCode(l);return o.code=c+`
`,t==="property"?l:e.format(`${l}()`,i,t)}}const CMe=(s,e=[],t="")=>{for(let i=0;i<e.length;i++){const o=e[i];typeof o=="function"&&(e[i]=o.functionNode)}const n=new MMe(s,e,t),r=(...i)=>n.call(...i);return r.functionNode=n,r},itt=(s,e)=>CMe(s,e,"glsl"),stt=(s,e)=>CMe(s,e,"wgsl");function DQ(s){let e;const t=s.context.getViewZ;return t!==void 0&&(e=t(this)),(e||wa.z).negate()}const AMe=Ye(([s,e],t)=>{const n=DQ(t);return ym(s,e,n)}),NMe=Ye(([s],e)=>{const t=DQ(e);return s.mul(s,t,t).negate().exp().oneMinus()}),ott=Ye(([s,e],t)=>{const n=DQ(t),i=e.sub(Sg.y).max(0).toConst().mul(n).toConst();return s.mul(s,i,i).negate().exp().oneMinus()}),cK=Ye(([s,e])=>mr(e.toFloat().mix(bS.rgb,s.toVec3()),bS.a));let x6=null,b6=null;class att extends Jn{static get type(){return"RangeNode"}constructor(e=_e(),t=_e()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=this.getConstNode(this.minNode),n=this.getConstNode(this.maxNode),r=e.getTypeLength(Zy(t.value)),i=e.getTypeLength(Zy(n.value));return r>i?r:i}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}getConstNode(e){let t=null;if(e.traverse(n=>{n.isConstNode===!0&&(t=n)}),t===null)throw new hTe('THREE.TSL: No "ConstNode" found in node graph.',this.stackTrace);return t}setup(e){const t=e.object;let n=null;if(t.count>1){const r=this.getConstNode(this.minNode),i=this.getConstNode(this.maxNode),o=r.value,l=i.value,c=e.getTypeLength(Zy(o)),h=e.getTypeLength(Zy(l));x6=x6||new zr,b6=b6||new zr,x6.setScalar(0),b6.setScalar(0),c===1?x6.setScalar(o):o.isColor?x6.set(o.r,o.g,o.b,1):x6.set(o.x,o.y,o.z||0,o.w||0),h===1?b6.setScalar(l):l.isColor?b6.set(l.r,l.g,l.b,1):b6.set(l.x,l.y,l.z||0,l.w||0);const m=4,y=m*t.count,b=new Float32Array(y);for(let I=0;I<y;I++){const D=I%m,P=x6.getComponent(D),U=b6.getComponent(D);b[I]=t0.lerp(P,U,Math.random())}const w=this.getNodeType(e);if(t.count*4*4<=e.getUniformBufferLimit())n=nN(b,"vec4",t.count).element(wg).convert(w);else{const I=new s5(b,4);e.geometry.setAttribute("__range"+this.id,I),n=SF(I).convert(w)}}else n=_e(0);return n}}const ltt=ri(att).setParameterLength(2);class ctt extends Jn{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){return e.hasBuiltin(this._builtinName)}generate(e,t){const n=this.getBuiltinName(e),r=this.getNodeType(e);return e.shaderStage==="compute"?e.format(n,r,t):(qt(`ComputeBuiltinNode: Compute built-in value ${n} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(r))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const oN=(s,e)=>new ctt(s,e),utt=oN("numWorkgroups","uvec3"),dtt=oN("workgroupId","uvec3"),htt=oN("globalId","uvec3"),ptt=oN("localId","uvec3"),ftt=oN("subgroupSize","uint");let mtt=class extends Jn{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}};const OQ=ri(mtt),gtt=()=>OQ("workgroup").toStack(),ytt=()=>OQ("storage").toStack(),vtt=()=>OQ("texture").toStack();class xtt extends bx{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let n;const r=e.context.assign;if(n=super.generate(e),r!==!0){const i=this.getNodeType(e);n=e.format(n,i,t)}return n}}class btt extends Jn{constructor(e,t,n=0){super(t),this.bufferType=t,this.bufferCount=n,this.isWorkgroupInfoNode=!0,this.elementType=t,this.scope=e,this.name=""}setName(e){return this.name=e,this}label(e){return qt('TSL: "label()" has been deprecated. Use "setName()" instead.',new Ea),this.setName(e)}setScope(e){return this.scope=e,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(e){return new xtt(this,e)}generate(e){const t=this.name!==""?this.name:`${this.scope}Array_${this.id}`;return e.getScopedArray(t,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const _tt=(s,e)=>new btt("Workgroup",s,e);let Nl=class extends Jn{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),n=t.parents,r=this.method,i=this.getNodeType(e),o=this.getInputType(e),l=this.pointerNode,c=this.valueNode,h=[];h.push(`&${l.build(e,o)}`),c!==null&&h.push(c.build(e,o));const m=`${e.getMethod(r,i)}( ${h.join(", ")} )`;if(n?n.length===1&&n[0].isStackNode===!0:!1)e.addLineFlowCode(m,this);else return t.constNode===void 0&&(t.constNode=pm(m,i).toConst()),t.constNode.build(e)}};Nl.ATOMIC_LOAD="atomicLoad";Nl.ATOMIC_STORE="atomicStore";Nl.ATOMIC_ADD="atomicAdd";Nl.ATOMIC_SUB="atomicSub";Nl.ATOMIC_MAX="atomicMax";Nl.ATOMIC_MIN="atomicMin";Nl.ATOMIC_AND="atomicAnd";Nl.ATOMIC_OR="atomicOr";Nl.ATOMIC_XOR="atomicXor";const Stt=ri(Nl),Pg=(s,e,t)=>Stt(s,e,t).toStack(),wtt=s=>Pg(Nl.ATOMIC_LOAD,s,null),Ttt=(s,e)=>Pg(Nl.ATOMIC_STORE,s,e),Ett=(s,e)=>Pg(Nl.ATOMIC_ADD,s,e),Mtt=(s,e)=>Pg(Nl.ATOMIC_SUB,s,e),Ctt=(s,e)=>Pg(Nl.ATOMIC_MAX,s,e),Att=(s,e)=>Pg(Nl.ATOMIC_MIN,s,e),Ntt=(s,e)=>Pg(Nl.ATOMIC_AND,s,e),Ptt=(s,e)=>Pg(Nl.ATOMIC_OR,s,e),Rtt=(s,e)=>Pg(Nl.ATOMIC_XOR,s,e);let qn=class k3 extends Ho{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,n=null){super(),this.method=e,this.aNode=t,this.bNode=n}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,n=this.bNode?this.bNode.getNodeType(e):null,r=e.isMatrix(t)?0:e.getTypeLength(t),i=e.isMatrix(n)?0:e.getTypeLength(n);return r>i?t:n}getNodeType(e){const t=this.method;return t===k3.SUBGROUP_ELECT?"bool":t===k3.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const n=this.method,r=this.getNodeType(e),i=this.getInputType(e),o=this.aNode,l=this.bNode,c=[];if(n===k3.SUBGROUP_BROADCAST||n===k3.SUBGROUP_SHUFFLE||n===k3.QUAD_BROADCAST){const m=l.getNodeType(e);c.push(o.build(e,r),l.build(e,m==="float"?"int":r))}else n===k3.SUBGROUP_SHUFFLE_XOR||n===k3.SUBGROUP_SHUFFLE_DOWN||n===k3.SUBGROUP_SHUFFLE_UP?c.push(o.build(e,r),l.build(e,"uint")):(o!==null&&c.push(o.build(e,i)),l!==null&&c.push(l.build(e,i)));const h=c.length===0?"()":`( ${c.join(", ")} )`;return e.format(`${e.getMethod(n,r)}${h}`,r,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}};qn.SUBGROUP_ELECT="subgroupElect";qn.SUBGROUP_BALLOT="subgroupBallot";qn.SUBGROUP_ADD="subgroupAdd";qn.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";qn.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";qn.SUBGROUP_MUL="subgroupMul";qn.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";qn.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";qn.SUBGROUP_AND="subgroupAnd";qn.SUBGROUP_OR="subgroupOr";qn.SUBGROUP_XOR="subgroupXor";qn.SUBGROUP_MIN="subgroupMin";qn.SUBGROUP_MAX="subgroupMax";qn.SUBGROUP_ALL="subgroupAll";qn.SUBGROUP_ANY="subgroupAny";qn.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";qn.QUAD_SWAP_X="quadSwapX";qn.QUAD_SWAP_Y="quadSwapY";qn.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";qn.SUBGROUP_BROADCAST="subgroupBroadcast";qn.SUBGROUP_SHUFFLE="subgroupShuffle";qn.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";qn.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";qn.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";qn.QUAD_BROADCAST="quadBroadcast";const Itt=ln(qn,qn.SUBGROUP_ELECT).setParameterLength(0),ktt=ln(qn,qn.SUBGROUP_BALLOT).setParameterLength(1),Dtt=ln(qn,qn.SUBGROUP_ADD).setParameterLength(1),Ott=ln(qn,qn.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),Ltt=ln(qn,qn.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),Ftt=ln(qn,qn.SUBGROUP_MUL).setParameterLength(1),Btt=ln(qn,qn.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),Utt=ln(qn,qn.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),ztt=ln(qn,qn.SUBGROUP_AND).setParameterLength(1),Vtt=ln(qn,qn.SUBGROUP_OR).setParameterLength(1),Gtt=ln(qn,qn.SUBGROUP_XOR).setParameterLength(1),jtt=ln(qn,qn.SUBGROUP_MIN).setParameterLength(1),Htt=ln(qn,qn.SUBGROUP_MAX).setParameterLength(1),$tt=ln(qn,qn.SUBGROUP_ALL).setParameterLength(0),Wtt=ln(qn,qn.SUBGROUP_ANY).setParameterLength(0),qtt=ln(qn,qn.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),Xtt=ln(qn,qn.QUAD_SWAP_X).setParameterLength(1),Ytt=ln(qn,qn.QUAD_SWAP_Y).setParameterLength(1),Ktt=ln(qn,qn.QUAD_SWAP_DIAGONAL).setParameterLength(1),Ztt=ln(qn,qn.SUBGROUP_BROADCAST).setParameterLength(2),Qtt=ln(qn,qn.SUBGROUP_SHUFFLE).setParameterLength(2),Jtt=ln(qn,qn.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),ent=ln(qn,qn.SUBGROUP_SHUFFLE_UP).setParameterLength(2),tnt=ln(qn,qn.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),nnt=ln(qn,qn.QUAD_BROADCAST).setParameterLength(1);let WO;function kB(s){WO=WO||new WeakMap;let e=WO.get(s);return e===void 0&&WO.set(s,e={}),e}function DB(s){const e=kB(s);return e.shadowMatrix||(e.shadowMatrix=cr("mat4").setGroup(gr).onRenderUpdate(t=>((s.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&(s.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(s.shadow.camera.coordinateSystem=t.camera.coordinateSystem,s.shadow.camera.updateProjectionMatrix()),s.shadow.updateMatrices(s)),s.shadow.matrix)))}function PMe(s,e=Sg){const t=DB(s).mul(e);return t.xyz.div(t.w)}function LQ(s){const e=kB(s);return e.position||(e.position=cr(new be).setGroup(gr).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(s.matrixWorld)))}function RMe(s){const e=kB(s);return e.targetPosition||(e.targetPosition=cr(new be).setGroup(gr).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(s.target.matrixWorld)))}function FQ(s){const e=kB(s);return e.viewPosition||(e.viewPosition=cr(new be).setGroup(gr).onRenderUpdate(({camera:t},n)=>{n.value=n.value||new be,n.value.setFromMatrixPosition(s.matrixWorld),n.value.applyMatrix4(t.matrixWorldInverse)}))}const BQ=s=>Fp.transformDirection(LQ(s).sub(RMe(s))),rnt=s=>s.sort((e,t)=>e.id-t.id),int=(s,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===s)return t;return null},sX=new WeakMap,tC=[];class UQ extends Jn{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Y3("vec3","totalDiffuse"),this.totalSpecularNode=Y3("vec3","totalSpecular"),this.outgoingLightNode=Y3("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let n=0;n<e.length;n++){const r=e[n];if(tC.push(r.id),tC.push(r.castShadow?1:0),r.isSpotLight===!0){const i=r.map!==null?r.map.id:-1,o=r.colorNode?r.colorNode.getCacheKey():-1;tC.push(i,o)}}const t=JA(tC);return tC.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const n of this._lightNodes)t.push(n.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const n of t.nodes)n.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,r=rnt(this._lights),i=e.renderer.library;for(const o of r)if(o.isNode)t.push(Kn(o));else{let l=null;if(n!==null&&(l=int(o.id,n)),l===null){const c=i.getLightNodeClass(o.constructor);if(c===null){qt(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let h=null;sX.has(o)?h=sX.get(o):(h=new c(o),sX.set(o,h)),t.push(h)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:r,reflectedLight:i}=e.context;r.direct({...n,lightNode:t,reflectedLight:i},e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:r,reflectedLight:i}=e.context;r.directRectArea({...n,lightNode:t,reflectedLight:i},e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const r=e.context,i=r.lightingModel,o=e.getNodeProperties(this);if(i){const{totalDiffuseNode:l,totalSpecularNode:c}=this;r.outgoingLight=n;const h=e.addStack();o.nodes=h.nodes,i.start(e);const{backdrop:m,backdropAlpha:y}=r,{directDiffuse:b,directSpecular:w,indirectDiffuse:A,indirectSpecular:I}=r.reflectedLight;let D=b.add(A);m!==null&&(y!==null?D=$e(y.mix(D,m)):D=$e(m)),l.assign(D),c.assign(w.add(I)),n.assign(l.add(c)),i.finish(e),n=n.bypass(e.removeStack())}else o.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const snt=(s=[])=>new UQ().setLights(s);class ont extends Jn{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=Wr.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){zQ.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||Sg)}}const zQ=Y3("vec3","shadowPositionWorld");function VQ(s,e={}){return e.toneMapping=s.toneMapping,e.toneMappingExposure=s.toneMappingExposure,e.outputColorSpace=s.outputColorSpace,e.renderTarget=s.getRenderTarget(),e.activeCubeFace=s.getActiveCubeFace(),e.activeMipmapLevel=s.getActiveMipmapLevel(),e.renderObjectFunction=s.getRenderObjectFunction(),e.pixelRatio=s.getPixelRatio(),e.mrt=s.getMRT(),e.clearColor=s.getClearColor(e.clearColor||new Tn),e.clearAlpha=s.getClearAlpha(),e.autoClear=s.autoClear,e.scissorTest=s.getScissorTest(),e}function IMe(s,e){return e=VQ(s,e),s.setMRT(null),s.setRenderObjectFunction(null),s.setClearColor(0,1),s.autoClear=!0,e}function kMe(s,e){s.toneMapping=e.toneMapping,s.toneMappingExposure=e.toneMappingExposure,s.outputColorSpace=e.outputColorSpace,s.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),s.setRenderObjectFunction(e.renderObjectFunction),s.setPixelRatio(e.pixelRatio),s.setMRT(e.mrt),s.setClearColor(e.clearColor,e.clearAlpha),s.autoClear=e.autoClear,s.setScissorTest(e.scissorTest)}function GQ(s,e={}){return e.background=s.background,e.backgroundNode=s.backgroundNode,e.overrideMaterial=s.overrideMaterial,e}function DMe(s,e){return e=GQ(s,e),s.background=null,s.backgroundNode=null,s.overrideMaterial=null,e}function OMe(s,e){s.background=e.background,s.backgroundNode=e.backgroundNode,s.overrideMaterial=e.overrideMaterial}function ant(s,e,t={}){return t=VQ(s,t),t=GQ(e,t),t}function LMe(s,e,t){return t=IMe(s,t),t=DMe(e,t),t}function FMe(s,e,t){kMe(s,t),OMe(e,t)}var i7e=Object.freeze({__proto__:null,resetRendererAndSceneState:LMe,resetRendererState:IMe,resetSceneState:DMe,restoreRendererAndSceneState:FMe,restoreRendererState:kMe,restoreSceneState:OMe,saveRendererAndSceneState:ant,saveRendererState:VQ,saveSceneState:GQ});const MF=new WeakMap,BMe=Ye(({depthTexture:s,shadowCoord:e,depthLayer:t})=>{let n=ts(s,e.xy).setName("t_basic");return s.isArrayTexture&&(n=n.depth(t)),n.compare(e.z)}),UMe=Ye(({depthTexture:s,shadowCoord:e,shadow:t,depthLayer:n})=>{const r=(m,y)=>{let b=ts(s,m);return s.isArrayTexture&&(b=b.depth(n)),b.compare(y)},i=go("mapSize","vec2",t).setGroup(gr),o=go("radius","float",t).setGroup(gr),l=rn(1).div(i),c=o.mul(l.x),h=IQ(Sx.xy).mul(6.28318530718);return Ha(r(e.xy.add(am(0,5,h).mul(c)),e.z),r(e.xy.add(am(1,5,h).mul(c)),e.z),r(e.xy.add(am(2,5,h).mul(c)),e.z),r(e.xy.add(am(3,5,h).mul(c)),e.z),r(e.xy.add(am(4,5,h).mul(c)),e.z)).mul(1/5)}),zMe=Ye(({depthTexture:s,shadowCoord:e,shadow:t,depthLayer:n})=>{const r=(y,b)=>{let w=ts(s,y);return s.isArrayTexture&&(w=w.depth(n)),w.compare(b)},i=go("mapSize","vec2",t).setGroup(gr),o=rn(1).div(i),l=o.x,c=o.y,h=e.xy,m=mm(h.mul(i).add(.5));return h.subAssign(m.mul(o)),Ha(r(h,e.z),r(h.add(rn(l,0)),e.z),r(h.add(rn(0,c)),e.z),r(h.add(o),e.z),ki(r(h.add(rn(l.negate(),0)),e.z),r(h.add(rn(l.mul(2),0)),e.z),m.x),ki(r(h.add(rn(l.negate(),c)),e.z),r(h.add(rn(l.mul(2),c)),e.z),m.x),ki(r(h.add(rn(0,c.negate())),e.z),r(h.add(rn(0,c.mul(2))),e.z),m.y),ki(r(h.add(rn(l,c.negate())),e.z),r(h.add(rn(l,c.mul(2))),e.z),m.y),ki(ki(r(h.add(rn(l.negate(),c.negate())),e.z),r(h.add(rn(l.mul(2),c.negate())),e.z),m.x),ki(r(h.add(rn(l.negate(),c.mul(2))),e.z),r(h.add(rn(l.mul(2),c.mul(2))),e.z),m.x),m.y)).mul(1/9)}),VMe=Ye(({depthTexture:s,shadowCoord:e,depthLayer:t},n)=>{let r=ts(s).sample(e.xy);s.isArrayTexture&&(r=r.depth(t)),r=r.rg;const i=r.x,o=Go(1e-7,r.y.mul(r.y)),l=n.renderer.reversedDepthBuffer?nw(i,e.z):nw(e.z,i),c=_e(1).toVar();return _r(l.notEqual(1),()=>{const h=e.z.sub(i);let m=o.div(o.add(h.mul(h)));m=gm(Fi(m,.3).div(.65)),c.assign(Go(l,m))}),c}),GMe=s=>{let e=MF.get(s);return e===void 0&&(e=new xo,e.colorNode=mr(0,0,0,1),e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.blending=El,e.fog=!1,MF.set(s,e)),e},jMe=s=>{const e=MF.get(s);e!==void 0&&(e.dispose(),MF.delete(s))},s7e=new x5,P_=[],HMe=(s,e,t,n)=>{P_[0]=s,P_[1]=e;let r=s7e.get(P_);return(r===void 0||r.shadowType!==t||r.useVelocity!==n)&&(r=(i,o,l,c,h,m,...y)=>{(i.castShadow===!0||i.receiveShadow&&t===mg)&&(n&&(kSe(i).useVelocity=!0),i.onBeforeShadow(s,i,l,e.camera,c,o.overrideMaterial,m),s.renderObject(i,o,l,c,h,m,...y),i.onAfterShadow(s,i,l,e.camera,c,o.overrideMaterial,m))},r.shadowType=t,r.useVelocity=n,s7e.set(P_,r)),P_[0]=null,P_[1]=null,r},lnt=Ye(({samples:s,radius:e,size:t,shadowPass:n,depthLayer:r})=>{const i=_e(0).toVar("meanVertical"),o=_e(0).toVar("squareMeanVertical"),l=s.lessThanEqual(_e(1)).select(_e(0),_e(2).div(s.sub(1))),c=s.lessThanEqual(_e(1)).select(_e(0),_e(-1));Cs({start:ze(0),end:ze(s),type:"int",condition:"<"},({i:m})=>{const y=c.add(_e(m).mul(l));let b=n.sample(Ha(Sx.xy,rn(0,y).mul(e)).div(t));n.value.isArrayTexture&&(b=b.depth(r)),b=b.x,i.addAssign(b),o.addAssign(b.mul(b))}),i.divAssign(s),o.divAssign(s);const h=wu(o.sub(i.mul(i)).max(0));return rn(i,h)}),cnt=Ye(({samples:s,radius:e,size:t,shadowPass:n,depthLayer:r})=>{const i=_e(0).toVar("meanHorizontal"),o=_e(0).toVar("squareMeanHorizontal"),l=s.lessThanEqual(_e(1)).select(_e(0),_e(2).div(s.sub(1))),c=s.lessThanEqual(_e(1)).select(_e(0),_e(-1));Cs({start:ze(0),end:ze(s),type:"int",condition:"<"},({i:m})=>{const y=c.add(_e(m).mul(l));let b=n.sample(Ha(Sx.xy,rn(y,0).mul(e)).div(t));n.value.isArrayTexture&&(b=b.depth(r)),i.addAssign(b.x),o.addAssign(Ha(b.y.mul(b.y),b.x.mul(b.x)))}),i.divAssign(s),o.divAssign(s);const h=wu(o.sub(i.mul(i)).max(0));return rn(i,h)}),unt=[BMe,UMe,zMe,VMe];let oX;const qO=new Aw;class $Me extends ont{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:r,shadow:i,depthLayer:o}){const l=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),c=t({depthTexture:n,shadowCoord:r,shadow:i,depthLayer:o});return l.select(c,_e(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:r}=e,i=n.biasNode||go("bias","float",n).setGroup(gr);let o=t,l;if(n.camera.isOrthographicCamera||r.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),l=o.z;else{const c=o.w;o=o.xy.div(c);const h=go("near","float",n.camera).setGroup(gr),m=go("far","float",n.camera).setGroup(gr);l=xQ(c.negate(),h,m)}return o=$e(o.x,o.y.oneMinus(),r.reversedDepthBuffer?l.sub(i):l.add(i)),o}getShadowFilterFn(e){return unt[e]}setupRenderTarget(e,t){const n=new Cc(e.mapSize.width,e.mapSize.height);n.name="ShadowDepthTexture",n.compareFunction=t.renderer.reversedDepthBuffer?gx:mx;const r=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return r.texture.name="ShadowMap",r.texture.type=e.mapType,r.depthTexture=n,{shadowMap:r,depthTexture:n}}setupShadow(e){const{renderer:t,camera:n}=e,{light:r,shadow:i}=this,{depthTexture:o,shadowMap:l}=this.setupRenderTarget(i,e),c=t.shadowMap.type;if(c===mS||c===k_e?(o.minFilter=ds,o.magFilter=ds):(o.minFilter=Yi,o.magFilter=Yi),i.camera.coordinateSystem=n.coordinateSystem,i.camera.updateProjectionMatrix(),c===mg&&i.isPointLightShadow!==!0){o.compareFunction=null,l.depth>1?(l._vsmShadowMapVertical||(l._vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Su,type:ro,depth:l.depth,depthBuffer:!1}),l._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=l._vsmShadowMapVertical,l._vsmShadowMapHorizontal||(l._vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Su,type:ro,depth:l.depth,depthBuffer:!1}),l._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=l._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Su,type:ro,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Su,type:ro,depthBuffer:!1}));let j=ts(o);o.isArrayTexture&&(j=j.depth(this.depthLayer));let C=ts(this.vsmShadowMapVertical.texture);o.isArrayTexture&&(C=C.depth(this.depthLayer));const Z=go("blurSamples","float",i).setGroup(gr),ie=go("radius","float",i).setGroup(gr),se=go("mapSize","vec2",i).setGroup(gr);let z=this.vsmMaterialVertical||(this.vsmMaterialVertical=new xo);z.fragmentNode=lnt({samples:Z,radius:ie,size:se,shadowPass:j,depthLayer:this.depthLayer}).context(e.getSharedContext()),z.name="VSMVertical",z=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new xo),z.fragmentNode=cnt({samples:Z,radius:ie,size:se,shadowPass:C,depthLayer:this.depthLayer}).context(e.getSharedContext()),z.name="VSMHorizontal"}const h=go("intensity","float",i).setGroup(gr),m=go("normalBias","float",i).setGroup(gr),y=DB(r).mul(zQ.add(M5.mul(m))),b=this.setupShadowCoord(e,y),w=i.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(w===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const A=c===mg&&i.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:o,I=this.setupShadowFilter(e,{filterFn:w,shadowTexture:l.texture,depthTexture:A,shadowCoord:b,shadow:i,depthLayer:this.depthLayer});let D;t.shadowMap.transmitted===!0&&(l.texture.isCubeTexture?D=vu(l.texture,b.xyz):(D=ts(l.texture,b),o.isArrayTexture&&(D=D.depth(this.depthLayer))));let P;D?P=ki(1,I.rgb.mix(D,1),h.mul(D.a)).toVar():P=ki(1,I,h).toVar(),this.shadowMap=l,this.shadow.map=l;const U=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return D&&P.toInspector(`${U} / Color`,()=>this.shadowMap.texture.isCubeTexture?vu(this.shadowMap.texture):ts(this.shadowMap.texture)),P.toInspector(`${U} / Depth`,()=>this.shadowMap.texture.isCubeTexture?vu(this.shadowMap.texture).r.oneMinus():sa(this.shadowMap.depthTexture,Os().mul(a5(ts(this.shadowMap.depthTexture)))).r.oneMinus())}setup(e){if(e.renderer.shadowMap.enabled!==!1)return Ye(()=>{const t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let n=this._node;return this.setupShadowPosition(e),n===null&&(this._node=n=this.setupShadow(e),this._currentShadowType=t),e.material.receivedShadowNode&&(n=e.material.receivedShadowNode(n)),n})()}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:i,scene:o}=e;t.updateMatrices(r),n.setSize(t.mapSize.width,t.mapSize.height,n.depth);const l=o.name;o.name=`Shadow Map [ ${r.name||"ID: "+r.id} ]`,i.render(o,t.camera),o.name=l}updateShadow(e){const{shadowMap:t,light:n,shadow:r}=this,{renderer:i,scene:o,camera:l}=e,c=i.shadowMap.type,h=t.depthTexture.version;this._depthVersionCached=h;const m=r.camera.layers.mask;(r.camera.layers.mask&4294967294)===0&&(r.camera.layers.mask=l.layers.mask);const y=i.getRenderObjectFunction(),b=i.getMRT(),w=b?b.has("velocity"):!1;oX=LMe(i,o,oX),o.overrideMaterial=GMe(n),i.setRenderObjectFunction(HMe(i,r,c,w)),i.setClearColor(0,0),i.setRenderTarget(t),this.renderShadow(e),i.setRenderObjectFunction(y),c===mg&&r.isPointLightShadow!==!0&&this.vsmPass(i),r.camera.layers.mask=m,FMe(i,o,oX)}vsmPass(e){const{shadow:t}=this,n=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,n),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,n),e.setRenderTarget(this.vsmShadowMapVertical),qO.material=this.vsmMaterialVertical,qO.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),qO.material=this.vsmMaterialHorizontal,qO.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,jMe(this.light),this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const WMe=(s,e)=>new $Me(s,e),dnt=new Tn,o7e=new Pn,nC=new be,aX=new be,hnt=[new be(1,0,0),new be(-1,0,0),new be(0,-1,0),new be(0,1,0),new be(0,0,1),new be(0,0,-1)],pnt=[new be(0,-1,0),new be(0,-1,0),new be(0,0,-1),new be(0,0,1),new be(0,-1,0),new be(0,-1,0)],fnt=[new be(1,0,0),new be(-1,0,0),new be(0,1,0),new be(0,-1,0),new be(0,0,1),new be(0,0,-1)],mnt=[new be(0,-1,0),new be(0,-1,0),new be(0,0,1),new be(0,0,-1),new be(0,-1,0),new be(0,-1,0)],qMe=Ye(({depthTexture:s,bd3D:e,dp:t})=>vu(s,e).compare(t)),XMe=Ye(({depthTexture:s,bd3D:e,dp:t,shadow:n})=>{const r=go("radius","float",n).setGroup(gr),i=go("mapSize","vec2",n).setGroup(gr),o=r.div(i.x),l=Zs(e),c=yd(e9(e,l.x.greaterThan(l.z).select($e(0,1,0),$e(1,0,0)))),h=e9(e,c),m=IQ(Sx.xy).mul(6.28318530718),y=am(0,5,m),b=am(1,5,m),w=am(2,5,m),A=am(3,5,m),I=am(4,5,m);return vu(s,e.add(c.mul(y.x).add(h.mul(y.y)).mul(o))).compare(t).add(vu(s,e.add(c.mul(b.x).add(h.mul(b.y)).mul(o))).compare(t)).add(vu(s,e.add(c.mul(w.x).add(h.mul(w.y)).mul(o))).compare(t)).add(vu(s,e.add(c.mul(A.x).add(h.mul(A.y)).mul(o))).compare(t)).add(vu(s,e.add(c.mul(I.x).add(h.mul(I.y)).mul(o))).compare(t)).mul(1/5)}),gnt=Ye(({filterFn:s,depthTexture:e,shadowCoord:t,shadow:n},r)=>{const i=t.xyz.toConst(),o=i.abs().toConst(),l=o.x.max(o.y).max(o.z),c=cr("float").setGroup(gr).onRenderUpdate(()=>n.camera.near),h=cr("float").setGroup(gr).onRenderUpdate(()=>n.camera.far),m=go("bias","float",n).setGroup(gr),y=_e(1).toVar();return _r(l.sub(h).lessThanEqual(0).and(l.sub(c).greaterThanEqual(0)),()=>{let b;r.renderer.reversedDepthBuffer?(b=REe(l.negate(),c,h),b.subAssign(m)):(b=yQ(l.negate(),c,h),b.addAssign(m));const w=i.normalize();y.assign(s({depthTexture:e,bd3D:w,dp:b,shadow:n}))}),y});class ynt extends $Me{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===Jze?qMe:XMe}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:r,shadow:i}){return gnt({filterFn:t,depthTexture:n,shadowCoord:r,shadow:i})}setupRenderTarget(e,t){const n=new K_e(e.mapSize.width);n.name="PointShadowDepthTexture",n.compareFunction=t.renderer.reversedDepthBuffer?gx:mx;const r=t.createCubeRenderTarget(e.mapSize.width);return r.texture.name="PointShadowMap",r.depthTexture=n,{shadowMap:r,depthTexture:n}}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:i,scene:o}=e,l=t.camera,c=t.matrix,h=i.coordinateSystem===xh,m=h?hnt:fnt,y=h?pnt:mnt;n.setSize(t.mapSize.width,t.mapSize.width);const b=i.autoClear,w=i.getClearColor(dnt),A=i.getClearAlpha();i.autoClear=!1,i.setClearColor(t.clearColor,t.clearAlpha);for(let I=0;I<6;I++){i.setRenderTarget(n,I),i.clear();const D=r.distance||l.far;D!==l.far&&(l.far=D,l.updateProjectionMatrix()),nC.setFromMatrixPosition(r.matrixWorld),l.position.copy(nC),aX.copy(l.position),aX.add(m[I]),l.up.copy(y[I]),l.lookAt(aX),l.updateMatrixWorld(),c.makeTranslation(-nC.x,-nC.y,-nC.z),o7e.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse),t._frustum.setFromProjectionMatrix(o7e,l.coordinateSystem,l.reversedDepth);const P=o.name;o.name=`Point Light Shadow [ ${r.name||"ID: "+r.id} ] - Face ${I+1}`,i.render(o,l),o.name=P}i.autoClear=b,i.setClearColor(w,A)}}const YMe=(s,e)=>new ynt(s,e);class wx extends Mw{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new Tn,this.colorNode=e&&e.colorNode||cr(this.color).setGroup(gr),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=Wr.FRAME,e&&e.shadow&&(this._shadowDisposeListener=()=>{this.disposeShadow()},e.addEventListener("dispose",this._shadowDisposeListener))}dispose(){this._shadowDisposeListener&&this.light.removeEventListener("dispose",this._shadowDisposeListener),super.dispose()}disposeShadow(){this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null),this.shadowColorNode=null,this.baseColorNode!==null&&(this.colorNode=this.baseColorNode,this.baseColorNode=null)}getHash(){return this.light.uuid}getLightVector(e){return FQ(this.light).sub(e.context.positionView||wa)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return WMe(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const r=this.light.shadow.shadowNode;let i;r!==void 0?i=Kn(r):i=this.setupShadowNode(),this.shadowNode=i,this.shadowColorNode=n=this.colorNode.mul(i),this.baseColorNode=this.colorNode}e.context.getShadow&&(n=e.context.getShadow(this,e)),this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const jQ=Ye(({lightDistance:s,cutoffDistance:e,decayExponent:t})=>{const n=s.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(n.mul(s.div(e).pow4().oneMinus().clamp().pow2()),n)}),KMe=({color:s,lightVector:e,cutoffDistance:t,decayExponent:n})=>{const r=e.normalize(),i=e.length(),o=jQ({lightDistance:i,cutoffDistance:t,decayExponent:n}),l=s.mul(o);return{lightDirection:r,lightColor:l}};class vnt extends wx{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=cr(0).setGroup(gr),this.decayExponentNode=cr(2).setGroup(gr)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return YMe(this.light)}setupDirect(e){return KMe({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const xnt=Ye(([s=Os()])=>{const e=s.mul(2),t=e.x.floor(),n=e.y.floor();return t.add(n).mod(2).sign()}),bnt=Ye(([s=Os()],{renderer:e,material:t})=>{const n=$Z(s.mul(2).sub(1));let r;if(t.alphaToCoverage&&e.currentSamples>0){const i=_e(n.fwidth()).toVar();r=ym(i.oneMinus(),i.add(1),n).oneMinus()}else r=Ec(n.greaterThan(1),0,1);return r}),XC=Ye(([s,e,t])=>{const n=_e(t).toVar(),r=_e(e).toVar(),i=Ap(s).toVar();return Ec(i,r,n)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),CF=Ye(([s,e])=>{const t=Ap(e).toVar(),n=_e(s).toVar();return Ec(t,n.negate(),n)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),Ga=Ye(([s])=>{const e=_e(s).toVar();return ze(xg(e))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),Ro=Ye(([s,e])=>{const t=_e(s).toVar();return e.assign(Ga(t)),t.sub(_e(e))}),_nt=Ye(([s,e,t,n,r,i])=>{const o=_e(i).toVar(),l=_e(r).toVar(),c=_e(n).toVar(),h=_e(t).toVar(),m=_e(e).toVar(),y=_e(s).toVar(),b=_e(Fi(1,l)).toVar();return Fi(1,o).mul(y.mul(b).add(m.mul(l))).add(o.mul(h.mul(b).add(c.mul(l))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),Snt=Ye(([s,e,t,n,r,i])=>{const o=_e(i).toVar(),l=_e(r).toVar(),c=$e(n).toVar(),h=$e(t).toVar(),m=$e(e).toVar(),y=$e(s).toVar(),b=_e(Fi(1,l)).toVar();return Fi(1,o).mul(y.mul(b).add(m.mul(l))).add(o.mul(h.mul(b).add(c.mul(l))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),ZMe=U0([_nt,Snt]),wnt=Ye(([s,e,t,n,r,i,o,l,c,h,m])=>{const y=_e(m).toVar(),b=_e(h).toVar(),w=_e(c).toVar(),A=_e(l).toVar(),I=_e(o).toVar(),D=_e(i).toVar(),P=_e(r).toVar(),U=_e(n).toVar(),j=_e(t).toVar(),C=_e(e).toVar(),Z=_e(s).toVar(),ie=_e(Fi(1,w)).toVar(),se=_e(Fi(1,b)).toVar();return _e(Fi(1,y)).toVar().mul(se.mul(Z.mul(ie).add(C.mul(w))).add(b.mul(j.mul(ie).add(U.mul(w))))).add(y.mul(se.mul(P.mul(ie).add(D.mul(w))).add(b.mul(I.mul(ie).add(A.mul(w))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),Tnt=Ye(([s,e,t,n,r,i,o,l,c,h,m])=>{const y=_e(m).toVar(),b=_e(h).toVar(),w=_e(c).toVar(),A=$e(l).toVar(),I=$e(o).toVar(),D=$e(i).toVar(),P=$e(r).toVar(),U=$e(n).toVar(),j=$e(t).toVar(),C=$e(e).toVar(),Z=$e(s).toVar(),ie=_e(Fi(1,w)).toVar(),se=_e(Fi(1,b)).toVar();return _e(Fi(1,y)).toVar().mul(se.mul(Z.mul(ie).add(C.mul(w))).add(b.mul(j.mul(ie).add(U.mul(w))))).add(y.mul(se.mul(P.mul(ie).add(D.mul(w))).add(b.mul(I.mul(ie).add(A.mul(w))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),QMe=U0([wnt,Tnt]),Ent=Ye(([s,e,t])=>{const n=_e(t).toVar(),r=_e(e).toVar(),i=Jt(s).toVar(),o=Jt(i.bitAnd(Jt(7))).toVar(),l=_e(XC(o.lessThan(Jt(4)),r,n)).toVar(),c=_e(qr(2,XC(o.lessThan(Jt(4)),n,r))).toVar();return CF(l,Ap(o.bitAnd(Jt(1)))).add(CF(c,Ap(o.bitAnd(Jt(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),Mnt=Ye(([s,e,t,n])=>{const r=_e(n).toVar(),i=_e(t).toVar(),o=_e(e).toVar(),l=Jt(s).toVar(),c=Jt(l.bitAnd(Jt(15))).toVar(),h=_e(XC(c.lessThan(Jt(8)),o,i)).toVar(),m=_e(XC(c.lessThan(Jt(4)),i,XC(c.equal(Jt(12)).or(c.equal(Jt(14))),o,r))).toVar();return CF(h,Ap(c.bitAnd(Jt(1)))).add(CF(m,Ap(c.bitAnd(Jt(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),n0=U0([Ent,Mnt]),Cnt=Ye(([s,e,t])=>{const n=_e(t).toVar(),r=_e(e).toVar(),i=_x(s).toVar();return $e(n0(i.x,r,n),n0(i.y,r,n),n0(i.z,r,n))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),Ant=Ye(([s,e,t,n])=>{const r=_e(n).toVar(),i=_e(t).toVar(),o=_e(e).toVar(),l=_x(s).toVar();return $e(n0(l.x,o,i,r),n0(l.y,o,i,r),n0(l.z,o,i,r))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),bp=U0([Cnt,Ant]),Nnt=Ye(([s])=>{const e=_e(s).toVar();return qr(.6616,e)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),Pnt=Ye(([s])=>{const e=_e(s).toVar();return qr(.982,e)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),Rnt=Ye(([s])=>{const e=$e(s).toVar();return qr(.6616,e)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),JMe=U0([Nnt,Rnt]),Int=Ye(([s])=>{const e=$e(s).toVar();return qr(.982,e)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),eCe=U0([Pnt,Int]),mh=Ye(([s,e])=>{const t=ze(e).toVar(),n=Jt(s).toVar();return n.shiftLeft(t).bitOr(n.shiftRight(ze(32).sub(t)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),tCe=Ye(([s,e,t])=>{s.subAssign(t),s.bitXorAssign(mh(t,ze(4))),t.addAssign(e),e.subAssign(s),e.bitXorAssign(mh(s,ze(6))),s.addAssign(t),t.subAssign(e),t.bitXorAssign(mh(e,ze(8))),e.addAssign(s),s.subAssign(t),s.bitXorAssign(mh(t,ze(16))),t.addAssign(e),e.subAssign(s),e.bitXorAssign(mh(s,ze(19))),s.addAssign(t),t.subAssign(e),t.bitXorAssign(mh(e,ze(4))),e.addAssign(s)}),aN=Ye(([s,e,t])=>{const n=Jt(t).toVar(),r=Jt(e).toVar(),i=Jt(s).toVar();return n.bitXorAssign(r),n.subAssign(mh(r,ze(14))),i.bitXorAssign(n),i.subAssign(mh(n,ze(11))),r.bitXorAssign(i),r.subAssign(mh(i,ze(25))),n.bitXorAssign(r),n.subAssign(mh(r,ze(16))),i.bitXorAssign(n),i.subAssign(mh(n,ze(4))),r.bitXorAssign(i),r.subAssign(mh(i,ze(14))),n.bitXorAssign(r),n.subAssign(mh(r,ze(24))),n}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),Ac=Ye(([s])=>{const e=Jt(s).toVar();return _e(e).div(_e(Jt(ze(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),Tg=Ye(([s])=>{const e=_e(s).toVar();return e.mul(e).mul(e).mul(e.mul(e.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),knt=Ye(([s])=>{const e=ze(s).toVar(),t=Jt(Jt(1)).toVar(),n=Jt(Jt(ze(3735928559)).add(t.shiftLeft(Jt(2))).add(Jt(13))).toVar();return aN(n.add(Jt(e)),n,n)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),Dnt=Ye(([s,e])=>{const t=ze(e).toVar(),n=ze(s).toVar(),r=Jt(Jt(2)).toVar(),i=Jt().toVar(),o=Jt().toVar(),l=Jt().toVar();return i.assign(o.assign(l.assign(Jt(ze(3735928559)).add(r.shiftLeft(Jt(2))).add(Jt(13))))),i.addAssign(Jt(n)),o.addAssign(Jt(t)),aN(i,o,l)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),Ont=Ye(([s,e,t])=>{const n=ze(t).toVar(),r=ze(e).toVar(),i=ze(s).toVar(),o=Jt(Jt(3)).toVar(),l=Jt().toVar(),c=Jt().toVar(),h=Jt().toVar();return l.assign(c.assign(h.assign(Jt(ze(3735928559)).add(o.shiftLeft(Jt(2))).add(Jt(13))))),l.addAssign(Jt(i)),c.addAssign(Jt(r)),h.addAssign(Jt(n)),aN(l,c,h)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),Lnt=Ye(([s,e,t,n])=>{const r=ze(n).toVar(),i=ze(t).toVar(),o=ze(e).toVar(),l=ze(s).toVar(),c=Jt(Jt(4)).toVar(),h=Jt().toVar(),m=Jt().toVar(),y=Jt().toVar();return h.assign(m.assign(y.assign(Jt(ze(3735928559)).add(c.shiftLeft(Jt(2))).add(Jt(13))))),h.addAssign(Jt(l)),m.addAssign(Jt(o)),y.addAssign(Jt(i)),tCe(h,m,y),h.addAssign(Jt(r)),aN(h,m,y)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),Fnt=Ye(([s,e,t,n,r])=>{const i=ze(r).toVar(),o=ze(n).toVar(),l=ze(t).toVar(),c=ze(e).toVar(),h=ze(s).toVar(),m=Jt(Jt(5)).toVar(),y=Jt().toVar(),b=Jt().toVar(),w=Jt().toVar();return y.assign(b.assign(w.assign(Jt(ze(3735928559)).add(m.shiftLeft(Jt(2))).add(Jt(13))))),y.addAssign(Jt(h)),b.addAssign(Jt(c)),w.addAssign(Jt(l)),tCe(y,b,w),y.addAssign(Jt(o)),b.addAssign(Jt(i)),aN(y,b,w)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),ks=U0([knt,Dnt,Ont,Lnt,Fnt]),Bnt=Ye(([s,e])=>{const t=ze(e).toVar(),n=ze(s).toVar(),r=Jt(ks(n,t)).toVar(),i=_x().toVar();return i.x.assign(r.bitAnd(ze(255))),i.y.assign(r.shiftRight(ze(8)).bitAnd(ze(255))),i.z.assign(r.shiftRight(ze(16)).bitAnd(ze(255))),i}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),Unt=Ye(([s,e,t])=>{const n=ze(t).toVar(),r=ze(e).toVar(),i=ze(s).toVar(),o=Jt(ks(i,r,n)).toVar(),l=_x().toVar();return l.x.assign(o.bitAnd(ze(255))),l.y.assign(o.shiftRight(ze(8)).bitAnd(ze(255))),l.z.assign(o.shiftRight(ze(16)).bitAnd(ze(255))),l}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),_p=U0([Bnt,Unt]),znt=Ye(([s])=>{const e=rn(s).toVar(),t=ze().toVar(),n=ze().toVar(),r=_e(Ro(e.x,t)).toVar(),i=_e(Ro(e.y,n)).toVar(),o=_e(Tg(r)).toVar(),l=_e(Tg(i)).toVar(),c=_e(ZMe(n0(ks(t,n),r,i),n0(ks(t.add(ze(1)),n),r.sub(1),i),n0(ks(t,n.add(ze(1))),r,i.sub(1)),n0(ks(t.add(ze(1)),n.add(ze(1))),r.sub(1),i.sub(1)),o,l)).toVar();return JMe(c)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),Vnt=Ye(([s])=>{const e=$e(s).toVar(),t=ze().toVar(),n=ze().toVar(),r=ze().toVar(),i=_e(Ro(e.x,t)).toVar(),o=_e(Ro(e.y,n)).toVar(),l=_e(Ro(e.z,r)).toVar(),c=_e(Tg(i)).toVar(),h=_e(Tg(o)).toVar(),m=_e(Tg(l)).toVar(),y=_e(QMe(n0(ks(t,n,r),i,o,l),n0(ks(t.add(ze(1)),n,r),i.sub(1),o,l),n0(ks(t,n.add(ze(1)),r),i,o.sub(1),l),n0(ks(t.add(ze(1)),n.add(ze(1)),r),i.sub(1),o.sub(1),l),n0(ks(t,n,r.add(ze(1))),i,o,l.sub(1)),n0(ks(t.add(ze(1)),n,r.add(ze(1))),i.sub(1),o,l.sub(1)),n0(ks(t,n.add(ze(1)),r.add(ze(1))),i,o.sub(1),l.sub(1)),n0(ks(t.add(ze(1)),n.add(ze(1)),r.add(ze(1))),i.sub(1),o.sub(1),l.sub(1)),c,h,m)).toVar();return eCe(y)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),HQ=U0([znt,Vnt]),Gnt=Ye(([s])=>{const e=rn(s).toVar(),t=ze().toVar(),n=ze().toVar(),r=_e(Ro(e.x,t)).toVar(),i=_e(Ro(e.y,n)).toVar(),o=_e(Tg(r)).toVar(),l=_e(Tg(i)).toVar(),c=$e(ZMe(bp(_p(t,n),r,i),bp(_p(t.add(ze(1)),n),r.sub(1),i),bp(_p(t,n.add(ze(1))),r,i.sub(1)),bp(_p(t.add(ze(1)),n.add(ze(1))),r.sub(1),i.sub(1)),o,l)).toVar();return JMe(c)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),jnt=Ye(([s])=>{const e=$e(s).toVar(),t=ze().toVar(),n=ze().toVar(),r=ze().toVar(),i=_e(Ro(e.x,t)).toVar(),o=_e(Ro(e.y,n)).toVar(),l=_e(Ro(e.z,r)).toVar(),c=_e(Tg(i)).toVar(),h=_e(Tg(o)).toVar(),m=_e(Tg(l)).toVar(),y=$e(QMe(bp(_p(t,n,r),i,o,l),bp(_p(t.add(ze(1)),n,r),i.sub(1),o,l),bp(_p(t,n.add(ze(1)),r),i,o.sub(1),l),bp(_p(t.add(ze(1)),n.add(ze(1)),r),i.sub(1),o.sub(1),l),bp(_p(t,n,r.add(ze(1))),i,o,l.sub(1)),bp(_p(t.add(ze(1)),n,r.add(ze(1))),i.sub(1),o,l.sub(1)),bp(_p(t,n.add(ze(1)),r.add(ze(1))),i,o.sub(1),l.sub(1)),bp(_p(t.add(ze(1)),n.add(ze(1)),r.add(ze(1))),i.sub(1),o.sub(1),l.sub(1)),c,h,m)).toVar();return eCe(y)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),lN=U0([Gnt,jnt]),Hnt=Ye(([s])=>{const e=_e(s).toVar(),t=ze(Ga(e)).toVar();return Ac(ks(t))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),$nt=Ye(([s])=>{const e=rn(s).toVar(),t=ze(Ga(e.x)).toVar(),n=ze(Ga(e.y)).toVar();return Ac(ks(t,n))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),Wnt=Ye(([s])=>{const e=$e(s).toVar(),t=ze(Ga(e.x)).toVar(),n=ze(Ga(e.y)).toVar(),r=ze(Ga(e.z)).toVar();return Ac(ks(t,n,r))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),qnt=Ye(([s])=>{const e=mr(s).toVar(),t=ze(Ga(e.x)).toVar(),n=ze(Ga(e.y)).toVar(),r=ze(Ga(e.z)).toVar(),i=ze(Ga(e.w)).toVar();return Ac(ks(t,n,r,i))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),Xnt=U0([Hnt,$nt,Wnt,qnt]),Ynt=Ye(([s])=>{const e=_e(s).toVar(),t=ze(Ga(e)).toVar();return $e(Ac(ks(t,ze(0))),Ac(ks(t,ze(1))),Ac(ks(t,ze(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),Knt=Ye(([s])=>{const e=rn(s).toVar(),t=ze(Ga(e.x)).toVar(),n=ze(Ga(e.y)).toVar();return $e(Ac(ks(t,n,ze(0))),Ac(ks(t,n,ze(1))),Ac(ks(t,n,ze(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),Znt=Ye(([s])=>{const e=$e(s).toVar(),t=ze(Ga(e.x)).toVar(),n=ze(Ga(e.y)).toVar(),r=ze(Ga(e.z)).toVar();return $e(Ac(ks(t,n,r,ze(0))),Ac(ks(t,n,r,ze(1))),Ac(ks(t,n,r,ze(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),Qnt=Ye(([s])=>{const e=mr(s).toVar(),t=ze(Ga(e.x)).toVar(),n=ze(Ga(e.y)).toVar(),r=ze(Ga(e.z)).toVar(),i=ze(Ga(e.w)).toVar();return $e(Ac(ks(t,n,r,i,ze(0))),Ac(ks(t,n,r,i,ze(1))),Ac(ks(t,n,r,i,ze(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),OB=U0([Ynt,Knt,Znt,Qnt]),AF=Ye(([s,e,t,n])=>{const r=_e(n).toVar(),i=_e(t).toVar(),o=ze(e).toVar(),l=$e(s).toVar(),c=_e(0).toVar(),h=_e(1).toVar();return Cs(o,()=>{c.addAssign(h.mul(HQ(l))),h.mulAssign(r),l.mulAssign(i)}),c}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),LB=Ye(([s,e,t,n])=>{const r=_e(n).toVar(),i=_e(t).toVar(),o=ze(e).toVar(),l=$e(s).toVar(),c=$e(0).toVar(),h=_e(1).toVar();return Cs(o,()=>{c.addAssign(h.mul(lN(l))),h.mulAssign(r),l.mulAssign(i)}),c}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Jnt=Ye(([s,e,t,n])=>{const r=_e(n).toVar(),i=_e(t).toVar(),o=ze(e).toVar(),l=$e(s).toVar();return rn(AF(l,o,i,r),AF(l.add($e(ze(19),ze(193),ze(17))),o,i,r))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),ert=Ye(([s,e,t,n])=>{const r=_e(n).toVar(),i=_e(t).toVar(),o=ze(e).toVar(),l=$e(s).toVar(),c=$e(LB(l,o,i,r)).toVar(),h=_e(AF(l.add($e(ze(19),ze(193),ze(17))),o,i,r)).toVar();return mr(c,h)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),trt=Ye(([s,e,t,n,r,i,o])=>{const l=ze(o).toVar(),c=_e(i).toVar(),h=ze(r).toVar(),m=ze(n).toVar(),y=ze(t).toVar(),b=ze(e).toVar(),w=rn(s).toVar(),A=$e(OB(rn(b.add(m),y.add(h)))).toVar(),I=rn(A.x,A.y).toVar();I.subAssign(.5),I.mulAssign(c),I.addAssign(.5);const D=rn(rn(_e(b),_e(y)).add(I)).toVar(),P=rn(D.sub(w)).toVar();return _r(l.equal(ze(2)),()=>Zs(P.x).add(Zs(P.y))),_r(l.equal(ze(3)),()=>Go(Zs(P.x),Zs(P.y))),Np(P,P)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),nrt=Ye(([s,e,t,n,r,i,o,l,c])=>{const h=ze(c).toVar(),m=_e(l).toVar(),y=ze(o).toVar(),b=ze(i).toVar(),w=ze(r).toVar(),A=ze(n).toVar(),I=ze(t).toVar(),D=ze(e).toVar(),P=$e(s).toVar(),U=$e(OB($e(D.add(w),I.add(b),A.add(y)))).toVar();U.subAssign(.5),U.mulAssign(m),U.addAssign(.5);const j=$e($e(_e(D),_e(I),_e(A)).add(U)).toVar(),C=$e(j.sub(P)).toVar();return _r(h.equal(ze(2)),()=>Zs(C.x).add(Zs(C.y)).add(Zs(C.z))),_r(h.equal(ze(3)),()=>Go(Zs(C.x),Zs(C.y),Zs(C.z))),Np(C,C)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Nw=U0([trt,nrt]),rrt=Ye(([s,e,t])=>{const n=ze(t).toVar(),r=_e(e).toVar(),i=rn(s).toVar(),o=ze().toVar(),l=ze().toVar(),c=rn(Ro(i.x,o),Ro(i.y,l)).toVar(),h=_e(1e6).toVar();return Cs({start:-1,end:ze(1),name:"x",condition:"<="},({x:m})=>{Cs({start:-1,end:ze(1),name:"y",condition:"<="},({y})=>{const b=_e(Nw(c,m,y,o,l,r,n)).toVar();h.assign(xd(h,b))})}),_r(n.equal(ze(0)),()=>{h.assign(wu(h))}),h}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),irt=Ye(([s,e,t])=>{const n=ze(t).toVar(),r=_e(e).toVar(),i=rn(s).toVar(),o=ze().toVar(),l=ze().toVar(),c=rn(Ro(i.x,o),Ro(i.y,l)).toVar(),h=rn(1e6,1e6).toVar();return Cs({start:-1,end:ze(1),name:"x",condition:"<="},({x:m})=>{Cs({start:-1,end:ze(1),name:"y",condition:"<="},({y})=>{const b=_e(Nw(c,m,y,o,l,r,n)).toVar();_r(b.lessThan(h.x),()=>{h.y.assign(h.x),h.x.assign(b)}).ElseIf(b.lessThan(h.y),()=>{h.y.assign(b)})})}),_r(n.equal(ze(0)),()=>{h.assign(wu(h))}),h}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),srt=Ye(([s,e,t])=>{const n=ze(t).toVar(),r=_e(e).toVar(),i=rn(s).toVar(),o=ze().toVar(),l=ze().toVar(),c=rn(Ro(i.x,o),Ro(i.y,l)).toVar(),h=$e(1e6,1e6,1e6).toVar();return Cs({start:-1,end:ze(1),name:"x",condition:"<="},({x:m})=>{Cs({start:-1,end:ze(1),name:"y",condition:"<="},({y})=>{const b=_e(Nw(c,m,y,o,l,r,n)).toVar();_r(b.lessThan(h.x),()=>{h.z.assign(h.y),h.y.assign(h.x),h.x.assign(b)}).ElseIf(b.lessThan(h.y),()=>{h.z.assign(h.y),h.y.assign(b)}).ElseIf(b.lessThan(h.z),()=>{h.z.assign(b)})})}),_r(n.equal(ze(0)),()=>{h.assign(wu(h))}),h}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),ort=Ye(([s,e,t])=>{const n=ze(t).toVar(),r=_e(e).toVar(),i=$e(s).toVar(),o=ze().toVar(),l=ze().toVar(),c=ze().toVar(),h=$e(Ro(i.x,o),Ro(i.y,l),Ro(i.z,c)).toVar(),m=_e(1e6).toVar();return Cs({start:-1,end:ze(1),name:"x",condition:"<="},({x:y})=>{Cs({start:-1,end:ze(1),name:"y",condition:"<="},({y:b})=>{Cs({start:-1,end:ze(1),name:"z",condition:"<="},({z:w})=>{const A=_e(Nw(h,y,b,w,o,l,c,r,n)).toVar();m.assign(xd(m,A))})})}),_r(n.equal(ze(0)),()=>{m.assign(wu(m))}),m}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),art=U0([rrt,ort]),lrt=Ye(([s,e,t])=>{const n=ze(t).toVar(),r=_e(e).toVar(),i=$e(s).toVar(),o=ze().toVar(),l=ze().toVar(),c=ze().toVar(),h=$e(Ro(i.x,o),Ro(i.y,l),Ro(i.z,c)).toVar(),m=rn(1e6,1e6).toVar();return Cs({start:-1,end:ze(1),name:"x",condition:"<="},({x:y})=>{Cs({start:-1,end:ze(1),name:"y",condition:"<="},({y:b})=>{Cs({start:-1,end:ze(1),name:"z",condition:"<="},({z:w})=>{const A=_e(Nw(h,y,b,w,o,l,c,r,n)).toVar();_r(A.lessThan(m.x),()=>{m.y.assign(m.x),m.x.assign(A)}).ElseIf(A.lessThan(m.y),()=>{m.y.assign(A)})})})}),_r(n.equal(ze(0)),()=>{m.assign(wu(m))}),m}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),crt=U0([irt,lrt]),urt=Ye(([s,e,t])=>{const n=ze(t).toVar(),r=_e(e).toVar(),i=$e(s).toVar(),o=ze().toVar(),l=ze().toVar(),c=ze().toVar(),h=$e(Ro(i.x,o),Ro(i.y,l),Ro(i.z,c)).toVar(),m=$e(1e6,1e6,1e6).toVar();return Cs({start:-1,end:ze(1),name:"x",condition:"<="},({x:y})=>{Cs({start:-1,end:ze(1),name:"y",condition:"<="},({y:b})=>{Cs({start:-1,end:ze(1),name:"z",condition:"<="},({z:w})=>{const A=_e(Nw(h,y,b,w,o,l,c,r,n)).toVar();_r(A.lessThan(m.x),()=>{m.z.assign(m.y),m.y.assign(m.x),m.x.assign(A)}).ElseIf(A.lessThan(m.y),()=>{m.z.assign(m.y),m.y.assign(A)}).ElseIf(A.lessThan(m.z),()=>{m.z.assign(A)})})})}),_r(n.equal(ze(0)),()=>{m.assign(wu(m))}),m}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),$Q=U0([srt,urt]),drt=Ye(([s,e,t,n,r,i,o,l,c,h,m])=>{const y=ze(s).toVar(),b=rn(e).toVar(),w=rn(t).toVar(),A=rn(n).toVar(),I=_e(r).toVar(),D=_e(i).toVar(),P=_e(o).toVar(),U=Ap(l).toVar(),j=ze(c).toVar(),C=_e(h).toVar(),Z=_e(m).toVar(),ie=b.mul(w).add(A),se=_e(0).toVar();return _r(y.equal(ze(0)),()=>{se.assign(lN(ie))}),_r(y.equal(ze(1)),()=>{se.assign(OB(ie))}),_r(y.equal(ze(2)),()=>{se.assign($Q(ie,I,ze(0)))}),_r(y.equal(ze(3)),()=>{se.assign(LB($e(ie,0),j,C,Z))}),se.assign(se.mul(P.sub(D)).add(D)),_r(U,()=>{se.assign(gm(se,D,P))}),se}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),hrt=Ye(([s,e,t,n,r,i,o,l,c,h,m])=>{const y=ze(s).toVar(),b=$e(e).toVar(),w=$e(t).toVar(),A=$e(n).toVar(),I=_e(r).toVar(),D=_e(i).toVar(),P=_e(o).toVar(),U=Ap(l).toVar(),j=ze(c).toVar(),C=_e(h).toVar(),Z=_e(m).toVar(),ie=b.mul(w).add(A),se=_e(0).toVar();return _r(y.equal(ze(0)),()=>{se.assign(lN(ie))}),_r(y.equal(ze(1)),()=>{se.assign(OB(ie))}),_r(y.equal(ze(2)),()=>{se.assign($Q(ie,I,ze(0)))}),_r(y.equal(ze(3)),()=>{se.assign(LB(ie,j,C,Z))}),se.assign(se.mul(P.sub(D)).add(D)),_r(U,()=>{se.assign(gm(se,D,P))}),se}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),prt=Ye(([s])=>{const e=s.y,t=s.z,n=$e().toVar();return _r(e.lessThan(1e-4),()=>{n.assign($e(t,t,t))}).Else(()=>{let r=s.x;r=r.sub(xg(r)).mul(6).toVar();const i=ze(VZ(r)),o=r.sub(_e(i)),l=t.mul(e.oneMinus()),c=t.mul(e.mul(o).oneMinus()),h=t.mul(e.mul(o.oneMinus()).oneMinus());_r(i.equal(ze(0)),()=>{n.assign($e(t,h,l))}).ElseIf(i.equal(ze(1)),()=>{n.assign($e(c,t,l))}).ElseIf(i.equal(ze(2)),()=>{n.assign($e(l,t,h))}).ElseIf(i.equal(ze(3)),()=>{n.assign($e(l,c,t))}).ElseIf(i.equal(ze(4)),()=>{n.assign($e(h,l,t))}).Else(()=>{n.assign($e(t,l,c))})}),n}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),frt=Ye(([s])=>{const e=$e(s).toVar(),t=_e(e.x).toVar(),n=_e(e.y).toVar(),r=_e(e.z).toVar(),i=_e(xd(t,xd(n,r))).toVar(),o=_e(Go(t,Go(n,r))).toVar(),l=_e(o.sub(i)).toVar(),c=_e().toVar(),h=_e().toVar(),m=_e().toVar();return m.assign(o),_r(o.greaterThan(0),()=>{h.assign(l.div(o))}).Else(()=>{h.assign(0)}),_r(h.lessThanEqual(0),()=>{c.assign(0)}).Else(()=>{_r(t.greaterThanEqual(o),()=>{c.assign(n.sub(r).div(l))}).ElseIf(n.greaterThanEqual(o),()=>{c.assign(Ha(2,r.sub(t).div(l)))}).Else(()=>{c.assign(Ha(4,t.sub(n).div(l)))}),c.mulAssign(1/6),_r(c.lessThan(0),()=>{c.addAssign(1)})}),$e(c,h,m)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),mrt=Ye(([s])=>{const e=$e(s).toVar(),t=wZ(RZ(e,$e(.04045))).toVar(),n=$e(e.div(12.92)).toVar(),r=$e(wp(Go(e.add($e(.055)),$e(0)).div(1.055),$e(2.4))).toVar();return ki(n,r,t)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),nCe=(s,e)=>{s=_e(s),e=_e(e);const t=rn(e.dFdx(),e.dFdy()).length().mul(.7071067811865476);return ym(s.sub(t),s.add(t),e)},rCe=(s,e,t,n)=>ki(s,e,t[n].clamp()),grt=(s,e,t=Os())=>rCe(s,e,t,"x"),yrt=(s,e,t=Os())=>rCe(s,e,t,"y"),vrt=(s,e,t,n,r=Os())=>{const i=r.x.clamp(),o=r.y.clamp(),l=ki(s,e,i),c=ki(t,n,i);return ki(l,c,o)},iCe=(s,e,t,n,r)=>ki(s,e,nCe(t,n[r])),xrt=(s,e,t,n=Os())=>iCe(s,e,t,n,"x"),brt=(s,e,t,n=Os())=>iCe(s,e,t,n,"y"),_rt=(s=1,e=0,t=Os())=>t.mul(s).add(e),Srt=(s,e=1)=>(s=_e(s),s.abs().pow(e).mul(s.sign())),wrt=(s,e=1,t=.5)=>_e(s).sub(t).mul(e).add(t),Trt=(s=Os(),e=1,t=0)=>HQ(s.convert("vec2|vec3")).mul(e).add(t),Ert=(s=Os(),e=1,t=0)=>lN(s.convert("vec2|vec3")).mul(e).add(t),Mrt=(s=Os(),e=1,t=0)=>(s=s.convert("vec2|vec3"),mr(lN(s),HQ(s.add(rn(19,73)))).mul(e).add(t)),Crt=(s,e=Os(),t=rn(1,1),n=rn(0,0),r=1,i=0,o=1,l=!1,c=1,h=2,m=.5)=>drt(s,e.convert("vec2|vec3"),t,n,r,i,o,l,c,h,m),Art=(s,e=Os(),t=rn(1,1),n=rn(0,0),r=1,i=0,o=1,l=!1,c=1,h=2,m=.5)=>hrt(s,e.convert("vec2|vec3"),t,n,r,i,o,l,c,h,m),Nrt=(s=Os(),e=1)=>art(s.convert("vec2|vec3"),e,ze(1)),Prt=(s=Os(),e=1)=>crt(s.convert("vec2|vec3"),e,ze(1)),Rrt=(s=Os(),e=1)=>$Q(s.convert("vec2|vec3"),e,ze(1)),Irt=(s=Os())=>Xnt(s.convert("vec2|vec3")),krt=(s=Os(),e=3,t=2,n=.5,r=1)=>AF(s,ze(e),t,n).mul(r),Drt=(s=Os(),e=3,t=2,n=.5,r=1)=>Jnt(s,ze(e),t,n).mul(r),Ort=(s=Os(),e=3,t=2,n=.5,r=1)=>LB(s,ze(e),t,n).mul(r),Lrt=(s=Os(),e=3,t=2,n=.5,r=1)=>ert(s,ze(e),t,n).mul(r),Frt=(s,e=_e(0))=>Ha(s,e),Brt=(s,e=_e(0))=>Fi(s,e),Urt=(s,e=_e(1))=>qr(s,e),zrt=(s,e=_e(1))=>_h(s,e),Vrt=(s,e=_e(1))=>tN(s,e),Grt=(s,e=_e(1))=>wp(s,e),jrt=(s=_e(0),e=_e(1))=>LZ(s,e),Hrt=()=>Cw,$rt=()=>dMe,Wrt=(s,e=_e(1))=>Fi(e,s),qrt=(s,e,t,n)=>s.greaterThan(e).mix(t,n),Xrt=(s,e,t,n)=>s.greaterThanEqual(e).mix(t,n),Yrt=(s,e,t,n)=>s.equal(e).mix(t,n),Krt=(s,e=null)=>{if(typeof e=="string"){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},n=e.replace(/^out/,"").toLowerCase();if(t[n]!==void 0)return s.element(t[n])}if(typeof e=="number")return s.element(e);if(typeof e=="string"&&e.length===1){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(t[e]!==void 0)return s.element(t[e])}return s},Zrt=(s,e=rn(.5,.5),t=rn(1,1),n=_e(0),r=rn(0,0))=>{let i=s;if(e&&(i=i.sub(e)),t&&(i=i.mul(t)),n){const o=n.mul(Math.PI/180),l=o.cos(),c=o.sin();i=rn(i.x.mul(l).sub(i.y.mul(c)),i.x.mul(c).add(i.y.mul(l)))}return e&&(i=i.add(e)),r&&(i=i.add(r)),i},Qrt=(s,e)=>{s=rn(s),e=_e(e);const t=e.mul(Math.PI/180);return iN(s,t)},Jrt=(s,e,t)=>{s=$e(s),e=_e(e),t=$e(t);const n=e.mul(Math.PI/180),r=t.normalize(),i=n.cos(),o=n.sin(),l=_e(1).sub(i);return s.mul(i).add(r.cross(s).mul(o)).add(r.mul(r.dot(s)).mul(l))},eit=(s,e)=>(s=$e(s),e=_e(e),hQ(s,e)),tit=Ye(([s,e,t])=>{const n=yd(s).toVar(),r=Fi(_e(.5).mul(e.sub(t)),Sg).div(n).toVar(),i=Fi(_e(-.5).mul(e.sub(t)),Sg).div(n).toVar(),o=$e().toVar();o.x=n.x.greaterThan(_e(0)).select(r.x,i.x),o.y=n.y.greaterThan(_e(0)).select(r.y,i.y),o.z=n.z.greaterThan(_e(0)).select(r.z,i.z);const l=xd(o.x,o.y,o.z).toVar();return Sg.add(n.mul(l)).toVar().sub(t)}),sCe=Ye(([s,e])=>{const t=s.x,n=s.y,r=s.z;let i=e.element(0).mul(.886227);return i=i.add(e.element(1).mul(2*.511664).mul(n)),i=i.add(e.element(2).mul(2*.511664).mul(r)),i=i.add(e.element(3).mul(2*.511664).mul(t)),i=i.add(e.element(4).mul(2*.429043).mul(t).mul(n)),i=i.add(e.element(5).mul(2*.429043).mul(n).mul(r)),i=i.add(e.element(6).mul(r.mul(r).mul(.743125).sub(.247708))),i=i.add(e.element(7).mul(2*.429043).mul(t).mul(r)),i=i.add(e.element(8).mul(.429043).mul(qr(t,t).sub(qr(n,n)))),i});var Q=Object.freeze({__proto__:null,BRDF_GGX:TQ,BRDF_Lambert:px,BasicPointShadowFilter:qMe,BasicShadowFilter:BMe,Break:CEe,Const:Wwe,Continue:eZe,DFGLUT:IA,D_GGX:jEe,Discard:lTe,EPSILON:IZ,F_Schlick:ow,Fn:Ye,HALF_PI:CYe,INFINITY:TYe,If:_r,Loop:Cs,NodeAccess:F0,NodeShaderStage:CC,NodeType:qXe,NodeUpdateType:Wr,OnBeforeMaterialUpdate:bet,OnBeforeObjectUpdate:xet,OnMaterialUpdate:vet,OnObjectUpdate:yet,PCFShadowFilter:UMe,PCFSoftShadowFilter:zMe,PI:_F,PI2:EYe,PointShadowFilter:XMe,Return:jYe,Schlick_to_F0:rK,ShaderNode:dS,Stack:dB,Switch:mYe,TBNViewMatrix:X6,TWO_PI:MYe,VSMShadowFilter:VMe,V_GGX_SmithCorrelated:GEe,Var:$we,VarIntent:qwe,abs:Zs,acesFilmicToneMapping:wMe,acos:OZ,add:Ha,addMethodChaining:zt,addNodeElement:qYe,agxToneMapping:TMe,all:vwe,alphaT:vF,and:rwe,anisotropy:jy,anisotropyB:ex,anisotropyT:HC,any:xwe,append:xYe,array:YSe,arrayBuffer:yYe,asin:wwe,assign:KSe,atan:LZ,atomicAdd:Ett,atomicAnd:Ntt,atomicFunc:Pg,atomicLoad:wtt,atomicMax:Ctt,atomicMin:Att,atomicOr:Ptt,atomicStore:Ttt,atomicSub:Mtt,atomicXor:Rtt,attenuationColor:AZ,attenuationDistance:CZ,attribute:t9,attributeArray:Tet,backgroundBlurriness:fMe,backgroundIntensity:lK,backgroundRotation:mMe,batch:TEe,bentNormalView:zTe,billboarding:eet,bitAnd:awe,bitNot:lwe,bitOr:cwe,bitXor:uwe,bitangentGeometry:kKe,bitangentLocal:DKe,bitangentView:BTe,bitangentWorld:OKe,bitcast:cMe,blendBurn:xZe,blendColor:wZe,blendDodge:bZe,blendOverlay:SZe,blendScreen:_Ze,blur:KEe,bool:Ap,buffer:nN,bufferAttribute:QZ,builtin:o9,builtinAOContext:jwe,builtinShadowContext:Gwe,bumpMap:hQ,bvec2:GSe,bvec3:wZ,bvec4:jSe,bypass:iTe,cache:rTe,call:ZSe,cameraFar:qy,cameraIndex:T5,cameraNear:Wy,cameraNormalMatrix:aKe,cameraPosition:gTe,cameraProjectionMatrix:K3,cameraProjectionMatrixInverse:mTe,cameraViewMatrix:Fp,cameraViewport:lKe,cameraWorldMatrix:oKe,cbrt:Owe,cdl:Get,ceil:gB,checker:xnt,cineonToneMapping:SMe,clamp:gm,clearcoat:mF,clearcoatNormalView:Xy,clearcoatRoughness:xS,clipSpace:xTe,code:IB,color:VSe,colorSpaceToWorking:vB,colorToDirection:FKe,compute:nTe,computeKernel:JZ,computeSkinning:QKe,context:s9,convert:$Se,convertColorSpace:DYe,convertToTexture:het,cos:sm,countLeadingZeros:PJe,countOneBits:RJe,countTrailingZeros:NJe,cross:e9,cubeTexture:vu,cubeTextureBase:dQ,dFdx:UZ,dFdy:zZ,dashSize:WL,debug:cTe,decrement:gwe,decrementBefore:fwe,defaultBuildStages:VY,defaultShaderStages:DSe,defined:NA,degrees:_we,deltaTime:WJe,densityFogFactor:NMe,depth:bQ,depthPass:Xet,determinant:Awe,difference:Iwe,diffuseColor:Ms,diffuseContribution:B6,directPointLight:KMe,directionToColor:VTe,directionToFaceDirection:Ew,dispersion:NZ,disposeShadowMaterial:jMe,distance:Rwe,div:_h,dot:Np,drawIndex:_Ee,dynamicBufferAttribute:UYe,element:HSe,emissive:$Y,equal:QSe,equirectUV:_Q,exp:kZ,exp2:tw,exponentialHeightFogFactor:ott,expression:pm,faceDirection:lQ,faceForward:qZ,faceforward:AYe,float:_e,floatBitsToInt:MJe,floatBitsToUint:uMe,floor:xg,fog:cK,fract:mm,frameGroup:XSe,frameId:dMe,frontFacing:bTe,fwidth:GZ,gain:kJe,gapSize:WY,getConstNodeType:zSe,getCurrentStack:bZ,getDirection:XEe,getDistanceAttenuation:jQ,getGeometryRoughness:VEe,getNormalFromDepth:fet,getParallaxCorrectNormal:tit,getRoughness:wQ,getScreenPosition:pet,getShIrradianceAt:sCe,getShadowMaterial:GMe,getShadowRenderObjectFunction:HMe,getTextureIndex:aMe,getViewPosition:iS,ggxConvolution:ZEe,globalId:htt,glsl:rtt,glslFn:itt,grayscale:Bet,greaterThan:RZ,greaterThanEqual:nwe,hash:IJe,highpModelNormalViewMatrix:KY,highpModelViewMatrix:YY,hue:Vet,increment:mwe,incrementBefore:pwe,inspector:uTe,instance:YKe,instanceIndex:wg,instancedArray:Eet,instancedBufferAttribute:SF,instancedDynamicBufferAttribute:XY,instancedMesh:wEe,int:ze,intBitsToFloat:CJe,interleavedGradientNoise:IQ,inverse:Nwe,inverseSqrt:DZ,inversesqrt:NYe,invocationLocalIndex:XKe,invocationSubgroupIndex:qKe,ior:$C,iridescence:pB,iridescenceIOR:gF,iridescenceThickness:yF,isolate:_S,ivec2:tl,ivec3:SZ,ivec4:TZ,js:ttt,label:Hwe,length:bg,lengthSq:$Z,lessThan:ewe,lessThanEqual:twe,lightPosition:LQ,lightProjectionUV:PMe,lightShadowMatrix:DB,lightTargetDirection:BQ,lightTargetPosition:RMe,lightViewPosition:FQ,lightingContext:NEe,lights:snt,linearDepth:wF,linearToneMapping:bMe,localId:ptt,log:mB,log2:vg,logarithmicDepthToViewZ:dZe,luminance:kQ,mat2:hB,mat3:o0,mat4:o5,matcapUV:QEe,materialAO:vEe,materialAlphaTest:GTe,materialAnisotropy:rEe,materialAnisotropyVector:rS,materialAttenuationColor:dEe,materialAttenuationDistance:uEe,materialClearcoat:ZTe,materialClearcoatNormal:JTe,materialClearcoatRoughness:QTe,materialColor:jTe,materialDispersion:yEe,materialEmissive:$Te,materialEnvIntensity:YL,materialEnvRotation:uQ,materialIOR:cEe,materialIridescence:iEe,materialIridescenceIOR:sEe,materialIridescenceThickness:oEe,materialLightMap:fQ,materialLineDashOffset:mEe,materialLineDashSize:pEe,materialLineGapSize:fEe,materialLineScale:hEe,materialLineWidth:GKe,materialMetalness:YTe,materialNormal:KTe,materialOpacity:pQ,materialPointSize:gEe,materialReference:F3,materialReflectivity:KL,materialRefractionRatio:TTe,materialRotation:eEe,materialRoughness:XTe,materialSheen:tEe,materialSheenRoughness:nEe,materialShininess:HTe,materialSpecular:WTe,materialSpecularColor:qTe,materialSpecularIntensity:nK,materialSpecularStrength:WC,materialThickness:lEe,materialTransmission:aEe,max:Go,maxMipLevel:nQ,mediumpModelViewMatrix:vTe,metalness:H3,min:xd,mix:ki,mixElement:Fwe,mod:tN,modInt:ywe,modelDirection:mKe,modelNormalMatrix:yTe,modelPosition:gKe,modelRadius:xKe,modelScale:yKe,modelViewMatrix:E5,modelViewPosition:vKe,modelViewProjection:xEe,modelWorldMatrix:Tp,modelWorldMatrixInverse:bKe,morphReference:AEe,mrt:lMe,mul:qr,mx_aastep:nCe,mx_add:Frt,mx_atan2:jrt,mx_cell_noise_float:Irt,mx_contrast:wrt,mx_divide:zrt,mx_fractal_noise_float:krt,mx_fractal_noise_vec2:Drt,mx_fractal_noise_vec3:Ort,mx_fractal_noise_vec4:Lrt,mx_frame:$rt,mx_heighttonormal:eit,mx_hsvtorgb:prt,mx_ifequal:Yrt,mx_ifgreater:qrt,mx_ifgreatereq:Xrt,mx_invert:Wrt,mx_modulo:Vrt,mx_multiply:Urt,mx_noise_float:Trt,mx_noise_vec3:Ert,mx_noise_vec4:Mrt,mx_place2d:Zrt,mx_power:Grt,mx_ramp4:vrt,mx_ramplr:grt,mx_ramptb:yrt,mx_rgbtohsv:frt,mx_rotate2d:Qrt,mx_rotate3d:Jrt,mx_safepower:Srt,mx_separate:Krt,mx_splitlr:xrt,mx_splittb:brt,mx_srgb_texture_to_lin_rec709:mrt,mx_subtract:Brt,mx_timer:Hrt,mx_transform_uv:_rt,mx_unifiednoise2d:Crt,mx_unifiednoise3d:Art,mx_worley_noise_float:Nrt,mx_worley_noise_vec2:Prt,mx_worley_noise_vec3:Rrt,negate:BZ,neutralToneMapping:EMe,nodeArray:J6,nodeImmutable:Cn,nodeObject:Kn,nodeObjectIntent:AC,nodeObjects:uB,nodeProxy:ri,nodeProxyIntent:ln,normalFlat:_Te,normalGeometry:bB,normalLocal:bd,normalMap:tK,normalView:qi,normalViewGeometry:iw,normalWorld:M5,normalWorldGeometry:STe,normalize:yd,not:swe,notEqual:JSe,numWorkgroups:utt,objectDirection:cKe,objectGroup:PZ,objectPosition:dKe,objectRadius:fKe,objectScale:hKe,objectViewPosition:pKe,objectWorldMatrix:uKe,oneMinus:Twe,or:iwe,orthographicDepthToViewZ:uZe,oscSawtooth:KJe,oscSine:qJe,oscSquare:XJe,oscTriangle:YJe,output:bS,outputStruct:SJe,overloadingFn:U0,packHalf2x16:BJe,packSnorm2x16:LJe,packUnorm2x16:FJe,parabola:aK,parallaxDirection:UTe,parallaxUV:LKe,parameter:gJe,pass:Wet,passTexture:qet,pcurve:DJe,perspectiveDepthToViewZ:vQ,pmremTexture:MQ,pointShadow:YMe,pointUV:Cet,pointWidth:bYe,positionGeometry:rN,positionLocal:Vo,positionPrevious:rw,positionView:wa,positionViewDirection:Hs,positionWorld:Sg,positionWorldDirection:aQ,posterize:jet,pow:wp,pow2:jZ,pow3:kwe,pow4:HZ,premultiplyAlpha:DEe,property:Y3,quadBroadcast:nnt,quadSwapDiagonal:Ktt,quadSwapX:Xtt,quadSwapY:Ytt,radians:bwe,rand:Lwe,range:ltt,rangeFogFactor:AMe,reciprocal:Mwe,reference:go,referenceBuffer:ZY,reflect:Pwe,reflectVector:CTe,reflectView:ETe,reflector:oet,refract:WZ,refractVector:ATe,refractView:MTe,reinhardToneMapping:_Me,remap:oTe,remapClamp:aTe,renderGroup:gr,renderOutput:eQ,rendererReference:Jwe,replaceDefaultUV:ZJe,rotate:iN,rotateUV:QJe,roughness:fg,round:Ewe,rtt:pMe,sRGBTransferEOTF:Ywe,sRGBTransferOETF:Kwe,sample:get,sampler:JYe,samplerComparison:eKe,saturate:yB,saturation:Uet,screenCoordinate:Sx,screenDPR:pTe,screenSize:hx,screenUV:_g,select:Ec,setCurrentStack:PA,setName:XZ,shaderStages:GY,shadow:WMe,shadowPositionWorld:zQ,shapeCircle:bnt,sharedUniformGroup:fB,sheen:ph,sheenRoughness:$y,shiftLeft:dwe,shiftRight:hwe,shininess:xF,sign:FZ,sin:mu,sinc:OJe,skinning:MEe,smoothstep:ym,smoothstepElement:Bwe,specularColor:y5,specularColorBlended:W6,specularF90:q6,spherizeUV:JJe,split:vYe,spritesheetUV:net,sqrt:wu,stack:QL,step:nw,stepElement:Uwe,storage:l5,storageBarrier:ytt,storageTexture:gMe,string:gYe,struct:_Je,sub:Fi,subBuild:tx,subgroupAdd:Dtt,subgroupAll:$tt,subgroupAnd:ztt,subgroupAny:Wtt,subgroupBallot:ktt,subgroupBroadcast:Ztt,subgroupBroadcastFirst:qtt,subgroupElect:Itt,subgroupExclusiveAdd:Ltt,subgroupExclusiveMul:Utt,subgroupInclusiveAdd:Ott,subgroupInclusiveMul:Btt,subgroupIndex:WKe,subgroupMax:Htt,subgroupMin:jtt,subgroupMul:Ftt,subgroupOr:Vtt,subgroupShuffle:Qtt,subgroupShuffleDown:tnt,subgroupShuffleUp:ent,subgroupShuffleXor:Jtt,subgroupSize:ftt,subgroupXor:Gtt,tan:Swe,tangentGeometry:SB,tangentLocal:sw,tangentView:wB,tangentWorld:FTe,texture:ts,texture3D:RB,texture3DLevel:ket,texture3DLoad:Iet,textureBarrier:vtt,textureBicubic:ZZe,textureBicubicLevel:EQ,textureCubeUV:YEe,textureLevel:QYe,textureLoad:sa,textureSize:a5,textureStore:Net,thickness:MZ,time:Cw,toneMapping:eTe,toneMappingExposure:tTe,toonOutlinePass:Ket,transformDirection:Dwe,transformNormal:wTe,transformNormalToView:cQ,transformedClearcoatNormalView:TKe,transformedNormalView:SKe,transformedNormalWorld:wKe,transmission:bF,transpose:Cwe,triNoise3D:jJe,triplanarTexture:ret,triplanarTextures:hMe,trunc:VZ,uint:Jt,uintBitsToFloat:AJe,uniform:cr,uniformArray:wc,uniformCubeTexture:MKe,uniformFlow:Vwe,uniformGroup:qSe,uniformTexture:ZYe,unpackHalf2x16:VJe,unpackNormal:eK,unpackSnorm2x16:UJe,unpackUnorm2x16:zJe,unpremultiplyAlpha:TZe,userData:Oet,uv:Os,uvec2:_Z,uvec3:_x,uvec4:EZ,varying:w5,varyingProperty:RA,vec2:rn,vec3:$e,vec4:mr,vectorComponents:xx,velocity:Fet,vertexColor:kEe,vertexIndex:bEe,vertexStage:Xwe,vibrance:zet,viewZToLogarithmicDepth:xQ,viewZToOrthographicDepth:SS,viewZToPerspectiveDepth:yQ,viewZToReversedOrthographicDepth:cZe,viewZToReversedPerspectiveDepth:REe,viewport:sQ,viewportCoordinate:fTe,viewportDepthTexture:gQ,viewportLinearDepth:hZe,viewportMipTexture:mQ,viewportOpaqueMipTexture:PEe,viewportResolution:sKe,viewportSafeUV:tet,viewportSharedTexture:$et,viewportSize:oQ,viewportTexture:oZe,viewportUV:iKe,vogelDiskSample:am,wgsl:ntt,wgslFn:stt,workgroupArray:_tt,workgroupBarrier:gtt,workgroupId:dtt,workingToColorSpace:Zwe,xor:owe});const Xf=new AQ;class nit extends C5{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const r=this.renderer,i=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(i===null)r._clearColor.getRGB(Xf),Xf.a=r._clearColor.a;else if(i.isColor===!0)i.getRGB(Xf),Xf.a=1,o=!0;else if(i.isNode===!0){const h=this.get(e),m=i;Xf.copy(r._clearColor);let y=h.backgroundMesh;if(y===void 0){let C=function(){i.removeEventListener("dispose",C),y.material.dispose(),y.geometry.dispose()};var c=C;const w=mr(m).mul(lK).context({getUV:()=>mMe.mul(STe),getTextureLevel:()=>fMe}),A=K3.element(3).element(3).equal(1),I=_h(1,K3.element(1).element(1)).mul(3),D=A.select(Vo.mul(I),Vo),P=E5.mul(mr(D,0));let U=K3.mul(mr(P.xyz,1));U=U.setZ(U.w);const j=new xo;j.name="Background.material",j.side=bs,j.depthTest=!1,j.depthWrite=!1,j.allowOverride=!1,j.fog=!1,j.lights=!1,j.vertexNode=U,j.colorNode=w,h.backgroundMeshNode=w,h.backgroundMesh=y=new gn(new Mg(1,32,32),j),y.frustumCulled=!1,y.name="Background.mesh",i.addEventListener("dispose",C)}const b=m.getCacheKey();h.backgroundCacheKey!==b&&(h.backgroundMeshNode.node=mr(m).mul(lK),h.backgroundMeshNode.needsUpdate=!0,y.material.needsUpdate=!0,h.backgroundCacheKey=b),t.unshift(y,y.geometry,y.material,0,0,null,null)}else Ht("Renderer: Unsupported background configuration.",i);const l=r.xr.getEnvironmentBlendMode();if(l==="additive"?Xf.set(0,0,0,1):l==="alpha-blend"&&Xf.set(0,0,0,0),r.autoClear===!0||o===!0){const h=n.clearColorValue;h.r=Xf.r,h.g=Xf.g,h.b=Xf.b,h.a=Xf.a,(r.backend.isWebGLBackend===!0||r.alpha===!0)&&(h.r*=h.a,h.g*=h.a,h.b*=h.a),n.depthClearValue=r.getClearDepth(),n.stencilClearValue=r.getClearStencil(),n.clearColor=r.autoClearColor===!0,n.clearDepth=r.autoClearDepth===!0,n.clearStencil=r.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let rit=0;class uK{constructor(e="",t=[],n=0){this.name=e,this.bindings=t,this.index=n,this.id=rit++}}class iit{constructor(e,t,n,r,i,o,l,c,h,m=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=m,this.nodeAttributes=r,this.bindings=i,this.updateNodes=o,this.updateBeforeNodes=l,this.updateAfterNodes=c,this.observer=h,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const r=new uK(t.name,[],t.index);e.push(r);for(const i of t.bindings)r.bindings.push(i.clone())}else e.push(t);return e}}class a7e{constructor(e,t,n=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}}class sit{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class oCe{constructor(e,t,n=!1,r=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=r}}class oit extends oCe{constructor(e,t,n=null,r=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=n,this.interpolationSampling=r}}class ait{constructor(e,t,n=""){this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let lit=0;class lX{constructor(e=null){this.id=lit++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class cit{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class A5{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0,this.index=-1}setValue(e){this.value=e}getValue(){return this.value}}class uit extends A5{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class dit extends A5{constructor(e,t=new Ln){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class hit extends A5{constructor(e,t=new be){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class pit extends A5{constructor(e,t=new zr){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class fit extends A5{constructor(e,t=new Tn){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class mit extends A5{constructor(e,t=new ySe){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class git extends A5{constructor(e,t=new ci){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class yit extends A5{constructor(e,t=new Pn){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class vit extends uit{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class xit extends dit{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class bit extends hit{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class _it extends pit{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Sit extends fit{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class wit extends mit{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Tit extends git{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Eit extends yit{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let Mit=0;const l7e=new WeakMap,Cit=new WeakMap,Ait=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),XO=s=>/e/g.test(s)?String(s).replace(/\+/g,""):(s=Number(s),s+(s%1?"":".0"));class aCe{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=QL(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new lX,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:Mit++})}isFlatShading(){return this.material.flatShading===!0||this.geometry.hasAttribute("normal")===!1}isOpaque(){const e=this.material;return e.transparent===!1&&e.blending===L0&&e.alphaToCoverage===!1}createRenderTarget(e,t,n){return new Op(e,t,n)}createCubeRenderTarget(e,t){return new LEe(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=t[0].groupNode;let r=n.shared;if(r)for(let o=1;o<t.length;o++)n!==t[o].groupNode&&(r=!1);let i;if(r){let o="";for(const m of t)if(m.isNodeUniformsGroup){m.uniforms.sort((y,b)=>y.nodeUniform.node.id-b.nodeUniform.node.id);for(const y of m.uniforms)o+=y.nodeUniform.node.id}else o+=m.nodeUniform.id;const l=this.renderer._currentRenderContext||this.renderer;let c=l7e.get(l);c===void 0&&(c=new Map,l7e.set(l,c));const h=Tw(o);i=c.get(h),i===void 0&&(i=new uK(e,t,this.bindingsIndexes[e].group),c.set(h,i))}else i=new uK(e,t,this.bindingsIndexes[e].group);return i}getBindGroupArray(e,t){const n=this.bindings[t];let r=n[e];return r===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(e===null){const t={},n=this.bindings;for(const r of GY)for(const i in n[r]){const o=n[r][i],l=t[i]||(t[i]=[]);for(const c of o)l.includes(c)===!1&&l.push(c)}e=[];for(const r in t){const i=t[r],o=this._getBindGroup(r,i);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,n)=>t.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();(t!==Wr.NONE||n!==Wr.NONE)&&this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==Wr.NONE&&this.updateNodes.push(e);for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==Wr.NONE&&this.updateBeforeNodes.push(e),n!==Wr.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===ds||e.magFilter===yS||e.magFilter===G3||e.magFilter===fd||e.minFilter===ds||e.minFilter===yS||e.minFilter===G3||e.minFilter===fd}getUniformBufferLimit(){return 16384}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){const t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){const e={...this.context};return delete e.material,delete e.getUV,delete e.getOutput,delete e.getTextureLevel,delete e.getAO,delete e.getShadow,e}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new lX(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){qt("Abstract function.")}getInstanceIndex(){qt("Abstract function.")}getDrawIndex(){qt("Abstract function.")}getFrontFacing(){qt("Abstract function.")}getFragCoord(){qt("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){qt("Abstract function.")}generateTextureLod(){qt("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,n=null){let r=this.generateArrayDeclaration(e,t)+"( ";for(let i=0;i<t;i++){const o=n?n[i]:null;o!==null?r+=o.build(this,e):r+=this.generateConst(e),i<t-1&&(r+=", ")}return r+=" )",r}generateStruct(e,t,n=null){const r=[];for(const i of t){const{name:o,type:l}=i;n&&n[o]&&n[o].isNode?r.push(n[o].build(this,l)):r.push(this.generateConst(l))}return e+"( "+r.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new Tn:e==="vec2"||e==="uvec2"||e==="ivec2"?t=new Ln:e==="vec3"||e==="uvec3"||e==="ivec3"?t=new be:(e==="vec4"||e==="uvec4"||e==="ivec4")&&(t=new zr)),e==="float")return XO(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${XO(t.r)}, ${XO(t.g)}, ${XO(t.b)} )`;const n=this.getTypeLength(e),r=this.getComponentType(e),i=o=>this.generateConst(r,o);if(n===2)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)} )`;if(n===3)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)}, ${i(t.z)} )`;if(n===4&&e!=="mat2")return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)}, ${i(t.z)}, ${i(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(i).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const n=this.attributes;for(const i of n)if(i.name===e)return i;const r=new a7e(e,t);return this.registerDeclaration(r),n.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===r0)return"int";if(t===Ds)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let n=RSe(e);const r=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(n=n.replace("vec","mat")),r+n}getTypeFromArray(e){return Ait.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,r=e.itemSize,i=e.normalized;let o;return!(e instanceof W_e)&&i!==!0&&(o=this.getTypeFromArray(n)),this.getTypeFromLength(r,o)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return n!==null?Number(n[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]===e)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=QL(this.stack);const e=bZ();return this.stacks.push(e),PA(this.stack),this.stack}removeStack(){const e=this.stack;for(const t of e.nodes){const n=this.getDataFromNode(t);n.stack=e}return this.stack=e.parent,PA(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let r=n.getData(e);r===void 0&&(r={},n.setData(e,r)),r[t]===void 0&&(r[t]={});let i=r[t];const o=r.any?r.any.subBuilds:null,l=this.getClosestSubBuild(o);return l&&(i.subBuildsCache===void 0&&(i.subBuildsCache={}),i=i.subBuildsCache[l]||(i.subBuildsCache[l]={}),i.subBuilds=o),i}getNodeProperties(e,t="any"){const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e,"vertex");let r=n.bufferAttribute;if(r===void 0){const i=this.uniforms.index++;r=new a7e("nodeAttribute"+i,t,e),this.bufferAttributes.push(r),n.bufferAttribute=r}return r}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,n=null,r=this.shaderStage){const i=this.getDataFromNode(e,r,this.globalCache);let o=i.structType;if(o===void 0){const l=this.structs.index++;n===null&&(n="StructType"+l),o=new cit(n,t),this.structs[r].push(o),this.types[r][n]=e,i.structType=o}return o}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t,n=this.shaderStage,r=null){const i=this.getDataFromNode(e,n,this.globalCache);let o=i.uniform;if(o===void 0){const l=this.uniforms.index++;o=new sit(r||"nodeUniform"+l,t,e),this.uniforms[n].push(o),this.registerDeclaration(o),i.uniform=o}return o}getVarFromNode(e,t=null,n=e.getNodeType(this),r=this.shaderStage,i=!1){const o=this.getDataFromNode(e,r),l=this.getSubBuildProperty("variable",o.subBuilds);let c=o[l];if(c===void 0){const h=i?"_const":"_var",m=this.vars[r]||(this.vars[r]=[]),y=this.vars[h]||(this.vars[h]=0);t===null&&(t=(i?"nodeConst":"nodeVar")+y,this.vars[h]++),l!=="variable"&&(t=this.getSubBuildProperty(t,o.subBuilds));const b=e.getArrayCount(this);c=new oCe(t,n,i,b),i||m.push(c),this.registerDeclaration(c),o[l]=c}return c}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,n=e.getNodeType(this),r=null,i=null){const o=this.getDataFromNode(e,"any"),l=this.getSubBuildProperty("varying",o.subBuilds);let c=o[l];if(c===void 0){const h=this.varyings,m=h.length;t===null&&(t="nodeVarying"+m),l!=="varying"&&(t=this.getSubBuildProperty(t,o.subBuilds)),c=new oit(t,n,r,i),h.push(c),this.registerDeclaration(c),o[l]=c}return c}registerDeclaration(e){const t=this.shaderStage,n=this.declarations[t]||(this.declarations[t]={}),r=this.getPropertyName(e);let i=1,o=r;for(;n[o]!==void 0;)o=r+"_"+i++;i>1&&(e.name=o,qt(`TSL: Declaration name '${r}' of '${e.type}' already in use. Renamed to '${o}'.`)),n[o]=e}getCodeFromNode(e,t,n=this.shaderStage){const r=this.getDataFromNode(e);let i=r.code;if(i===void 0){const o=this.codes[n]||(this.codes[n]=[]),l=o.length;i=new ait("nodeCode"+l,t),o.push(i),r.code=i}return i}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:r}=this.getDataFromNode(e);let i=!0,o=t;for(;o;){if(r.get(o)===!0){i=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(i)for(const l of n)this.addLineFlowCode(l)}addLineFlowCodeBlock(e,t,n){const r=this.getDataFromNode(e),i=r.flowCodes||(r.flowCodes=[]),o=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);i.push(t),o.set(n,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new MMe,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let o=0;const l=Object.values(this);return{next:()=>({value:l[o],done:o++>=l.length})}}};for(const o of t.inputs)n[o.name]=new iMe(o.type,o.name);e.layout=null;const r=e.call(n),i=this.flowStagesNode(r,t.type);return e.layout=t,i}flowBuildStage(e,t,n=null){const r=this.getBuildStage();this.setBuildStage(t);const i=e.build(this,n);return this.setBuildStage(r),i}flowStagesNode(e,t=null){const n=this.flow,r=this.vars,i=this.declarations,o=this.cache,l=this.buildStage,c=this.stack,h={code:""};this.flow=h,this.vars={},this.declarations={},this.cache=new lX,this.stack=QL();for(const m of VY)this.setBuildStage(m),h.result=e.build(this,t);return h.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=r,this.declarations=i,this.cache=o,this.stack=c,this.setBuildStage(l),h}getFunctionOperator(){return null}buildFunctionCode(){qt("Abstract function.")}flowChildNode(e,t=null){const n=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,t),this.flow=n,r}flowNodeFromShaderStage(e,t,n=null,r=null){const i=this.tab,o=this.cache,l=this.shaderStage,c=this.context;this.setShaderStage(e);const h={...this.context};delete h.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=h;let m=null;if(this.buildStage==="generate"){const y=this.flowChildNode(t,n);r!==null&&(y.code+=`${this.tab+r} = ${y.result};
`),this.flowCode[e]=this.flowCode[e]+y.code,m=y}else m=t.build(this);return this.setShaderStage(l),this.cache=o,this.tab=i,this.context=c,m}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){qt("Abstract function.")}getVaryings(){qt("Abstract function.")}getVar(e,t,n=null){return`${n!==null?this.generateArrayDeclaration(e,n):this.getType(e)} ${t}`}getVars(e){let t="";const n=this.vars[e];if(n!==void 0)for(const r of n)t+=`${this.getVar(r.type,r.name)}; `;return t}getUniforms(){qt("Abstract function.")}getCodes(e){const t=this.codes[e];let n="";if(t!==void 0)for(const r of t)n+=r.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){qt("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const n=this.subBuildLayers;for(let r=t.length-1;r>=0;r--){const i=t[r];if(n.includes(i))return i}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let n;t!==null?n=this.getClosestSubBuild(t):n=this.subBuildFn;let r;return n?r=e?n+"_"+e:n:r=e,r}build(){const{object:e,material:t,renderer:n}=this;if(t!==null){let r=n.library.fromMaterial(t);r===null&&(Ht(`NodeMaterial: Material "${t.type}" is not compatible.`),r=new xo),r.build(this)}else this.addFlow("compute",e);for(const r of VY){this.setBuildStage(r),this.context.position&&this.context.position.isNode&&this.flowNodeFromShaderStage("vertex",this.context.position);for(const i of GY){this.setShaderStage(i);const o=this.flowNodes[i];for(const l of o)r==="generate"?this.flowNode(l):l.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getSharedDataFromNode(e){let t=Cit.get(e);return t===void 0&&(t={}),t}getNodeUniform(e,t){const n=this.getSharedDataFromNode(e);let r=n.cache;if(r===void 0){if(t==="float"||t==="int"||t==="uint")r=new vit(e);else if(t==="vec2"||t==="ivec2"||t==="uvec2")r=new xit(e);else if(t==="vec3"||t==="ivec3"||t==="uvec3")r=new bit(e);else if(t==="vec4"||t==="ivec4"||t==="uvec4")r=new _it(e);else if(t==="color")r=new Sit(e);else if(t==="mat2")r=new wit(e);else if(t==="mat3")r=new Tit(e);else if(t==="mat4")r=new Eit(e);else throw new Error(`Uniform "${t}" not implemented.`);n.cache=r}return r}format(e,t,n){if(t=this.getVectorType(t),n=this.getVectorType(n),t===n||n===null||this.isReference(n))return e;const r=this.getTypeLength(t),i=this.getTypeLength(n);return r===16&&i===9?`${this.getType(n)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:r===9&&i===4?`${this.getType(n)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:r>4||i>4||i===0?e:r===i?`${this.getType(n)}( ${e} )`:r>i?(e=n==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,i)}`,this.format(e,this.getTypeFromLength(i,this.getComponentType(t)),n)):i===4&&r>1?`${this.getType(n)}( ${this.format(e,t,"vec3")}, 1.0 )`:r===2?`${this.getType(n)}( ${this.format(e,t,"vec2")}, 0.0 )`:(r===1&&i>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${fx} - Node System
`}needsPreviousData(){const e=this.renderer.getMRT();return e&&e.has("velocity")||kSe(this.object).useVelocity===!0}}class c7e{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return n===void 0&&(n={renderId:0,frameId:0},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===Wr.FRAME){const r=this._getMaps(this.updateBeforeMap,n);if(r.frameId!==this.frameId){const i=r.frameId;r.frameId=this.frameId,e.updateBefore(this)===!1&&(r.frameId=i)}}else if(t===Wr.RENDER){const r=this._getMaps(this.updateBeforeMap,n);if(r.renderId!==this.renderId){const i=r.renderId;r.renderId=this.renderId,e.updateBefore(this)===!1&&(r.renderId=i)}}else t===Wr.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===Wr.FRAME){const r=this._getMaps(this.updateAfterMap,n);r.frameId!==this.frameId&&e.updateAfter(this)!==!1&&(r.frameId=this.frameId)}else if(t===Wr.RENDER){const r=this._getMaps(this.updateAfterMap,n);r.renderId!==this.renderId&&e.updateAfter(this)!==!1&&(r.renderId=this.renderId)}else t===Wr.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===Wr.FRAME){const r=this._getMaps(this.updateMap,n);r.frameId!==this.frameId&&e.update(this)!==!1&&(r.frameId=this.frameId)}else if(t===Wr.RENDER){const r=this._getMaps(this.updateMap,n);r.renderId!==this.renderId&&e.update(this)!==!1&&(r.renderId=this.renderId)}else t===Wr.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class WQ{constructor(e,t,n=null,r="",i=!1){this.type=e,this.name=t,this.count=n,this.qualifier=r,this.isConst=i}}WQ.isNodeFunctionInput=!0;class Nit extends wx{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class Pit extends wx{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:BQ(this.light),lightColor:e}}}class Rit extends wx{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=LQ(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=cr(new Tn).setGroup(gr)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:r}=this,o=M5.dot(r).mul(.5).add(.5),l=ki(n,t,o);e.context.irradiance.addAssign(l)}}class qQ extends wx{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=cr(0).setGroup(gr),this.penumbraCosNode=cr(0).setGroup(gr),this.cutoffDistanceNode=cr(0).setGroup(gr),this.decayExponentNode=cr(0).setGroup(gr),this.colorNode=cr(this.color).setGroup(gr)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:n,penumbraCosNode:r}=this;return ym(n,r,t)}getLightCoord(e){const t=e.getNodeProperties(this);let n=t.projectionUV;return n===void 0&&(n=PMe(this.light,e.context.positionWorld),t.projectionUV=n),n}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:r,light:i}=this,o=this.getLightVector(e),l=o.normalize(),c=l.dot(BQ(i)),h=this.getSpotAttenuation(e,c),m=o.length(),y=jQ({lightDistance:m,cutoffDistance:n,decayExponent:r});let b=t.mul(h).mul(y),w,A;return i.colorNode?(A=this.getLightCoord(e),w=i.colorNode(A)):i.map&&(A=this.getLightCoord(e),w=ts(i.map,A.xy).onRenderUpdate(()=>i.map)),w&&(b=A.mul(2).sub(1).abs().lessThan(1).all().select(b.mul(w),b)),{lightColor:b,lightDirection:l}}}class Iit extends qQ{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const n=this.light.iesMap;let r=null;if(n&&n.isTexture===!0){const i=t.acos().mul(1/Math.PI);r=ts(n,rn(i,0),0).r}else r=super.getSpotAttenuation(t);return r}}class kit extends wx{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let n=0;n<9;n++)t.push(new be);this.lightProbe=wc(t)}update(e){const{light:t}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(t.sh.coefficients[n]).multiplyScalar(t.intensity)}setup(e){const t=sCe(M5,this.lightProbe);e.context.irradiance.addAssign(t)}}const Dit=Ye(([s,e])=>{const t=s.abs().sub(e);return bg(Go(t,0)).add(xd(Go(t.x,t.y),0))});class Oit extends qQ{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let n=1;t.map!==null&&(n=t.map.width/t.map.height),t.shadow.aspect=n}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=_e(0),n=this.penumbraCosNode,r=DB(this.light).mul(e.context.positionWorld||Sg);return _r(r.w.greaterThan(0),()=>{const i=r.xyz.div(r.w),o=Dit(i.xy.sub(rn(.5)),rn(.5)),l=_h(-1,Fi(1,OZ(n)).sub(1));t.assign(yB(o.mul(-2).mul(l)))}),t}}const cX=new Pn,YO=new Pn;let rC=null;class Lit extends wx{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=cr(new be).setGroup(gr),this.halfWidth=cr(new be).setGroup(gr),this.updateType=Wr.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;YO.identity(),cX.copy(t.matrixWorld),cX.premultiply(n),YO.extractRotation(cX),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(YO),this.halfHeight.value.applyMatrix4(YO)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=ts(rC.LTC_FLOAT_1),n=ts(rC.LTC_FLOAT_2)):(t=ts(rC.LTC_HALF_1),n=ts(rC.LTC_HALF_2));const{colorNode:r,light:i}=this,o=FQ(i);return{lightColor:r,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){rC=e}}class lCe{parseFunction(){qt("Abstract function.")}}class XQ{constructor(e,t,n="",r=""){this.type=e,this.inputs=t,this.name=n,this.precision=r}getCode(){qt("Abstract function.")}}XQ.isNodeFunction=!0;const Fit=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,Bit=/[a-z_0-9]+/ig,u7e="#pragma main",Uit=s=>{s=s.trim();const e=s.indexOf(u7e),t=e!==-1?s.slice(e+u7e.length):s,n=t.match(Fit);if(n!==null&&n.length===5){const r=n[4],i=[];let o=null;for(;(o=Bit.exec(r))!==null;)i.push(o);const l=[];let c=0;for(;c<i.length;){const A=i[c][0]==="const";A===!0&&c++;let I=i[c][0];I==="in"||I==="out"||I==="inout"?c++:I="";const D=i[c++][0];let P=Number.parseInt(i[c][0]);Number.isNaN(P)===!1?c++:P=null;const U=i[c++][0];l.push(new WQ(D,U,P,I,A))}const h=t.substring(n[0].length),m=n[3]!==void 0?n[3]:"",y=n[2],b=n[1]!==void 0?n[1]:"",w=e!==-1?s.slice(0,e):"";return{type:y,inputs:l,name:m,precision:b,inputsCode:r,blockCode:h,headerCode:w}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class zit extends XQ{constructor(e){const{type:t,inputs:n,name:r,precision:i,inputsCode:o,blockCode:l,headerCode:c}=Uit(e);super(t,n,r,i),this.inputsCode=o,this.blockCode=l,this.headerCode=c}getCode(e=this.name){let t;const n=this.blockCode;if(n!==""){const{type:r,inputsCode:i,headerCode:o,precision:l}=this;let c=`${r} ${e} ( ${i.trim()} )`;l!==""&&(c=`${l} ${c}`),t=o+c+n}else t="";return t}}class Vit extends lCe{parseFunction(e){return new zit(e)}}const d7e=new WeakMap,mp=[],Py=[];class Git extends C5{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new c7e,this.nodeBuilderCache=new Map,this.callHashCache=new x5,this.groupsData=new x5,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===PZ.name)return!0;if(n===gr.name){const i=this.get(e),o=this.nodeFrame.renderId;return i.renderId!==o?(i.renderId=o,!0):!1}if(n===XSe.name){const i=this.get(e),o=this.nodeFrame.frameId;return i.frameId!==o?(i.frameId=o,!0):!1}mp[0]=t,mp[1]=e;let r=this.groupsData.get(mp);return r===void 0&&this.groupsData.set(mp,r={}),mp[0]=null,mp[1]=null,r.version!==t.version?(r.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:r}=this,i=this.getForRenderCacheKey(e);if(n=r.get(i),n===void 0){const o=c=>{const h=this.backend.createNodeBuilder(e.object,this.renderer);return h.scene=e.scene,h.material=c,h.camera=e.camera,h.context.material=c,h.lightsNode=e.lightsNode,h.environmentNode=this.getEnvironmentNode(e.scene),h.fogNode=this.getFogNode(e.scene),h.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&h.enableMultiview(),h};let l=o(e.material);try{l.build()}catch(c){l=o(new xo),l.build();let h=c.stackTrace;!h&&c.stack&&(h=new Ea(c.stack)),Ht("TSL: "+c,h)}n=this._createNodeBuilderState(l),r.set(i,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const r=this.backend.createNodeBuilder(e,this.renderer);r.build(),n=this._createNodeBuilderState(r),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new iit(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){mp[0]=e,mp[1]=t;const n=this.renderer.info.calls,r=this.callHashCache.get(mp)||{};if(r.callId!==n){const i=this.getEnvironmentNode(e),o=this.getFogNode(e);t&&Py.push(t.getCacheKey(!0)),i&&Py.push(i.getCacheKey()),o&&Py.push(o.getCacheKey()),Py.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),Py.push(this.renderer.shadowMap.enabled?1:0),Py.push(this.renderer.shadowMap.type),r.callId=n,r.cacheKey=JA(Py),this.callHashCache.set(mp,r),Py.length=0}return mp[0]=null,mp[1]=null,r.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const r=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==n||r){const i=this.getCacheNode("background",n,()=>{if(n.isCubeTexture===!0||n.mapping===K6||n.mapping===gS||n.mapping===sx){if(e.backgroundBlurriness>0||n.mapping===sx)return MQ(n);{let o;return n.isCubeTexture===!0?o=vu(n):o=ts(n),BEe(o)}}else{if(n.isTexture===!0)return ts(n,_g.flipY()).setUpdateMatrix(!0);n.isColor!==!0&&Ht("WebGPUNodes: Unsupported background configuration.",n)}},r);t.backgroundNode=i,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n,r=!1){const i=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=i.get(t);return(o===void 0||r)&&(o=n(),i.set(t,o)),o}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const r=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const i=go("color","color",n).setGroup(gr),o=go("density","float",n).setGroup(gr);return cK(i,NMe(o))}else if(n.isFog){const i=go("color","color",n).setGroup(gr),o=go("near","float",n).setGroup(gr),l=go("far","float",n).setGroup(gr);return cK(i,AMe(o,l))}else Ht("Renderer: Unsupported fog configuration.",n)});t.fogNode=r,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const r=this.getCacheNode("environment",n,()=>{if(n.isCubeTexture===!0)return vu(n);if(n.isTexture===!0)return ts(n);Ht("Nodes: Unsupported environment configuration.",n)});t.environmentNode=r,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,n=null,r=null,i=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=n,o.camera=r,o.material=i,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return d7e.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),r=e.isArrayTexture?RB(e,$e(_g,o9("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):ts(e,_g).renderOutput(t.toneMapping,t.currentColorSpace);return d7e.set(e,n),r}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const r of n.updateNodes)t.updateNode(r)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const r of n.updateNodes)t.updateNode(r)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new c7e,this.nodeBuilderCache=new Map,this.cacheLib={}}}const uX=new dg;class NF{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new ci,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const r=e.length;for(let i=0;i<r;i++){uX.copy(e[i]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=t[n+i],l=uX.normal;o.x=-l.x,o.y=-l.y,o.z=-l.z,o.w=uX.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const r=t.clippingPlanes,i=r.length;let o,l;if(this.clipIntersection?(o=this.intersectionPlanes,l=e.intersectionPlanes.length):(o=this.unionPlanes,l=e.unionPlanes.length),o.length!==l+i){o.length=l+i;for(let c=0;c<i;c++)o[l+c]=new zr;n=!0}this.projectPlanes(r,o,l),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new NF(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class jit{constructor(e,t){this.bundleGroup=e,this.camera=t}}const R_=[];class Hit{constructor(){this.bundles=new x5}get(e,t){const n=this.bundles;R_[0]=e,R_[1]=t;let r=n.get(R_);return r===void 0&&(r=new jit(e,t),n.set(R_,r)),R_[0]=null,R_[1]=null,r}dispose(){this.bundles=new x5}}class cCe{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(n!==null){t=new n;for(const r in e)t[r]=e[r]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t)){qt(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);n.set(t,e)}addClass(e,t,n){if(n.has(t)){qt(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);n.set(t,e)}}const $it=new UQ,h7e=new WeakMap;class Wit{createNode(e=[]){return new UQ().setLights(e)}getNode(e){if(e.isQuadMesh)return $it;let t=h7e.get(e);return t===void 0&&(t=this.createNode(),h7e.set(e,t)),t}}class RC extends Op{constructor(e=1,t=1,n={}){super(e,t,n),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const p7e=new be,f7e=new be;class qit extends _d{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new Va,this._cameraL.viewport=new zr,this._cameraR=new Va,this._cameraR.viewport=new zr,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new gSe,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=Jit.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new Ln,this._onSessionEvent=Kit.bind(this),this._onSessionEnd=Zit.bind(this),this._onInputSourcesChange=Qit.bind(this),this._onAnimationFrame=est.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&qt("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&qt("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,n,r,i,o,l,c={}){const h=new Ng(e,t),m=new RC(i,o,{format:io,type:yo,depthTexture:new Cc(i,o,c.stencil?gh:Ds,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?_u:B0),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});m._autoAllocateDepthBuffer=!0;const y=new rl({color:16777215,side:Mc});y.map=m.texture,y.map.offset.y=1,y.map.repeat.y=-1;const b=new gn(h,y);b.position.copy(n),b.quaternion.copy(r);const w={type:"quad",width:e,height:t,translation:n,quaternion:r,pixelwidth:i,pixelheight:o,plane:b,material:y,rendercall:l,renderTarget:m};if(this._layers.push(w),this._session!==null){w.plane.material=new rl({color:16777215,side:Mc}),w.plane.material.blending=Jy,w.plane.material.blendEquation=i0,w.plane.material.blendSrc=im,w.plane.material.blendDst=im,w.xrlayer=this._createXRLayer(w);const A=this._session.renderState.layers;A.unshift(w.xrlayer),this._session.updateRenderState({layers:A})}else m.isXRRenderTarget=!1;return b}createCylinderLayer(e,t,n,r,i,o,l,c,h={}){const m=new k0(e,e,e*t/n,64,64,!0,Math.PI-t/2,t),y=new RC(o,l,{format:io,type:yo,depthTexture:new Cc(o,l,h.stencil?gh:Ds,void 0,void 0,void 0,void 0,void 0,void 0,h.stencil?_u:B0),stencilBuffer:h.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});y._autoAllocateDepthBuffer=!0;const b=new rl({color:16777215,side:bs});b.map=y.texture,b.map.offset.y=1,b.map.repeat.y=-1;const w=new gn(m,b);w.position.copy(r),w.quaternion.copy(i);const A={type:"cylinder",radius:e,centralAngle:t,aspectratio:n,translation:r,quaternion:i,pixelwidth:o,pixelheight:l,plane:w,material:b,rendercall:c,renderTarget:y};if(this._layers.push(A),this._session!==null){A.plane.material=new rl({color:16777215,side:bs}),A.plane.material.blending=Jy,A.plane.material.blendEquation=i0,A.plane.material.blendSrc=im,A.plane.material.blendDst=im,A.xrlayer=this._createXRLayer(A);const I=this._session.renderState.layers;I.unshift(A.xrlayer),this._session.updateRenderState({layers:I})}else y.isXRRenderTarget=!1;return w}renderLayers(){const e=new be,t=new vs,n=this._renderer,r=this.isPresenting,i=n.getOutputRenderTarget(),o=n._frameBufferTarget;this.isPresenting=!1;const l=new Ln;n.getSize(l);const c=n._quad;for(const h of this._layers)if(h.renderTarget.isXRRenderTarget=this._session!==null,h.renderTarget._hasExternalTextures=h.renderTarget.isXRRenderTarget,h.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){h.xrlayer.transform=new XRRigidTransform(h.plane.getWorldPosition(e),h.plane.getWorldQuaternion(t));const m=this._glBinding.getSubImage(h.xrlayer,this._xrFrame);n.backend.setXRRenderTargetTextures(h.renderTarget,m.colorTexture,void 0),n._setXRLayerSize(h.renderTarget.width,h.renderTarget.height),n.setOutputRenderTarget(h.renderTarget),n.setRenderTarget(null),n._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:y,quad:b}=this._frameBufferTargets.get(h.renderTarget)||{frameBufferTarget:null,quad:null};y?(n._frameBufferTarget=y,n._quad=b):(n._quad=new Aw(new xo),this._frameBufferTargets.set(h.renderTarget,{frameBufferTarget:n._getFrameBufferTarget(),quad:n._quad})),h.rendercall(),n._frameBufferTarget=null}else n.setRenderTarget(h.renderTarget),h.rendercall();n.setRenderTarget(null),n.setOutputRenderTarget(i),n._frameBufferTarget=o,n._setXRLayerSize(l.x,l.y),n._quad=c,this.isPresenting=r}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend;this._gl=t.getContext();const r=this._gl,i=r.getContextAttributes();if(this._session=e,e!==null){if(n.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let o=null,l=null,c=null;t.depth&&(c=t.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,o=t.stencil?_u:B0,l=t.stencil?gh:Ds);const h={colorFormat:r.RGBA8,depthFormat:c,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(h.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const m=this._glBinding.createProjectionLayer(h),y=[m];this._glProjLayer=m,t.setPixelRatio(1),t._setXRLayerSize(m.textureWidth,m.textureHeight);const b=this._useMultiview?2:1,w=new Cc(m.textureWidth,m.textureHeight,l,void 0,void 0,void 0,void 0,void 0,void 0,o,b);if(this._xrRenderTarget=new RC(m.textureWidth,m.textureHeight,{format:io,type:yo,colorSpace:t.outputColorSpace,depthTexture:w,stencilBuffer:t.stencil,samples:i.antialias?4:0,resolveDepthBuffer:m.ignoreDepthValues===!1,resolveStencilBuffer:m.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const A of this._layers)A.plane.material=new rl({color:16777215,side:A.type==="cylinder"?bs:Mc}),A.plane.material.blending=Jy,A.plane.material.blendEquation=i0,A.plane.material.blendSrc=im,A.plane.material.blendDst=im,A.xrlayer=this._createXRLayer(A),y.unshift(A.xrlayer);e.updateRenderState({layers:y})}else{const o={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},l=new XRWebGLLayer(e,r,o);this._glBaseLayer=l,e.updateRenderState({baseLayer:l}),t.setPixelRatio(1),t._setXRLayerSize(l.framebufferWidth,l.framebufferHeight),this._xrRenderTarget=new RC(l.framebufferWidth,l.framebufferHeight,{format:io,type:yo,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:l.ignoreDepthValues===!1,resolveStencilBuffer:l.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const n=e.near,r=e.far,i=this._cameraXR,o=this._cameraL,l=this._cameraR;i.near=l.near=o.near=n,i.far=l.far=o.far=r,i.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==i.near||this._currentDepthFar!==i.far)&&(t.updateRenderState({depthNear:i.near,depthFar:i.far}),this._currentDepthNear=i.near,this._currentDepthFar=i.far),i.layers.mask=e.layers.mask|6,o.layers.mask=i.layers.mask&-5,l.layers.mask=i.layers.mask&-3;const c=e.parent,h=i.cameras;m7e(i,c);for(let m=0;m<h.length;m++)m7e(h[m],c);h.length===2?Xit(i,o,l):i.projectionMatrix.copy(o.projectionMatrix),Yit(e,i,c)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new HL,this._controllers[e]=t),t}}function Xit(s,e,t){p7e.setFromMatrixPosition(e.matrixWorld),f7e.setFromMatrixPosition(t.matrixWorld);const n=p7e.distanceTo(f7e),r=e.projectionMatrix.elements,i=t.projectionMatrix.elements,o=r[14]/(r[10]-1),l=r[14]/(r[10]+1),c=(r[9]+1)/r[5],h=(r[9]-1)/r[5],m=(r[8]-1)/r[0],y=(i[8]+1)/i[0],b=o*m,w=o*y,A=n/(-m+y),I=A*-m;if(e.matrixWorld.decompose(s.position,s.quaternion,s.scale),s.translateX(I),s.translateZ(A),s.matrixWorld.compose(s.position,s.quaternion,s.scale),s.matrixWorldInverse.copy(s.matrixWorld).invert(),r[10]===-1)s.projectionMatrix.copy(e.projectionMatrix),s.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const D=o+A,P=l+A,U=b-I,j=w+(n-I),C=c*l/P*D,Z=h*l/P*D;s.projectionMatrix.makePerspective(U,j,C,Z,D,P),s.projectionMatrixInverse.copy(s.projectionMatrix).invert()}}function m7e(s,e){e===null?s.matrixWorld.copy(s.matrix):s.matrixWorld.multiplyMatrices(e.matrixWorld,s.matrix),s.matrixWorldInverse.copy(s.matrixWorld).invert()}function Yit(s,e,t){t===null?s.matrix.copy(e.matrixWorld):(s.matrix.copy(t.matrixWorld),s.matrix.invert(),s.matrix.multiply(e.matrixWorld)),s.matrix.decompose(s.position,s.quaternion,s.scale),s.updateMatrixWorld(!0),s.projectionMatrix.copy(e.projectionMatrix),s.projectionMatrixInverse.copy(e.projectionMatrixInverse),s.isPerspectiveCamera&&(s.fov=ux*2*Math.atan(1/s.projectionMatrix.elements[5]),s.zoom=1)}function Kit(s){const e=this._controllerInputSources.indexOf(s.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const n=this.getReferenceSpace();t.update(s.inputSource,s.frame,n),t.dispatchEvent({type:s.type,data:s.inputSource})}}function Zit(){const s=this._session,e=this._renderer;s.removeEventListener("select",this._onSessionEvent),s.removeEventListener("selectstart",this._onSessionEvent),s.removeEventListener("selectend",this._onSessionEvent),s.removeEventListener("squeeze",this._onSessionEvent),s.removeEventListener("squeezestart",this._onSessionEvent),s.removeEventListener("squeezeend",this._onSessionEvent),s.removeEventListener("end",this._onSessionEnd),s.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const n=this._controllerInputSources[t];n!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(n))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const t of this._layers)t.renderTarget=new RC(t.pixelwidth,t.pixelheight,{format:io,type:yo,depthTexture:new Cc(t.pixelwidth,t.pixelheight,t.stencilBuffer?gh:Ds,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?_u:B0),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function Qit(s){const e=this._controllers,t=this._controllerInputSources;for(let n=0;n<s.removed.length;n++){const r=s.removed[n],i=t.indexOf(r);i>=0&&(t[i]=null,e[i].disconnect(r))}for(let n=0;n<s.added.length;n++){const r=s.added[n];let i=t.indexOf(r);if(i===-1){for(let l=0;l<e.length;l++)if(l>=t.length){t.push(r),i=l;break}else if(t[l]===null){t[l]=r,i=l;break}if(i===-1)break}const o=e[i];o&&o.connect(r)}}function Jit(s){return s.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(s.translation,s.quaternion),width:s.width/2,height:s.height/2,space:this._referenceSpace,viewPixelWidth:s.pixelwidth,viewPixelHeight:s.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(s.translation,s.quaternion),radius:s.radius,centralAngle:s.centralAngle,aspectRatio:s.aspectRatio,space:this._referenceSpace,viewPixelWidth:s.pixelwidth,viewPixelHeight:s.pixelheight,clearOnAccess:!1})}function est(s,e){if(e===void 0)return;const t=this._cameraXR,n=this._renderer,r=n.backend,i=this._glBaseLayer,o=this.getReferenceSpace(),l=e.getViewerPose(o);if(this._xrFrame=e,l!==null){const c=l.views;this._glBaseLayer!==null&&r.setXRTarget(i.framebuffer);let h=!1;c.length!==t.cameras.length&&(t.cameras.length=0,h=!0);for(let m=0;m<c.length;m++){const y=c[m];let b;if(this._supportsLayers===!0){const A=this._glBinding.getViewSubImage(this._glProjLayer,y);b=A.viewport,m===0&&r.setXRRenderTargetTextures(this._xrRenderTarget,A.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:A.depthStencilTexture)}else b=i.getViewport(y);let w=this._cameras[m];w===void 0&&(w=new Va,w.layers.enable(m),w.viewport=new zr,this._cameras[m]=w),w.matrix.fromArray(y.transform.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale),w.projectionMatrix.fromArray(y.projectionMatrix),w.projectionMatrixInverse.copy(w.projectionMatrix).invert(),w.viewport.set(b.x,b.y,b.width,b.height),m===0&&(t.matrix.copy(w.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),h===!0&&t.cameras.push(w)}n.setOutputRenderTarget(this._xrRenderTarget)}for(let c=0;c<this._controllers.length;c++){const h=this._controllerInputSources[c],m=this._controllers[c];h!==null&&m!==void 0&&m.update(h,e,o)}this._currentAnimationLoop&&this._currentAnimationLoop(s,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}class uCe extends _d{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new zr(0,0,this._width,this._height),this._scissor=new zr(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new nZ,this.depthTexture=new Cc}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),n===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,r){const i=this._scissor;e.isVector4?i.copy(e):i.set(e,t,n,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,r,i=0,o=1){const l=this._viewport;e.isVector4?l.copy(e):l.set(e,t,n,r),l.minDepth=i,l.maxDepth=o}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const g7e=new XA,I_=new Ln,dX=new zr,hX=new YA,pX=new eZ,KO=new Pn,M3=new zr,tst={[Mc]:bs,[bs]:Mc,[oa]:oa};class nst{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,reversedDepthBuffer:r=!1,alpha:i=!0,depth:o=!0,stencil:l=!1,antialias:c=!1,samples:h=0,getFallback:m=null,outputBufferType:y=ro,multiview:b=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=i,this.logarithmicDepthBuffer=n,this.reversedDepthBuffer=r,this.outputColorSpace=Is,this.toneMapping=Ta,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=o,this.stencil=l,this.info=new nJe,this.contextNode=s9(),this.library=new cCe,this.lighting=new Wit,this._samples=h||c===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new uCe(e.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new tQ,this._inspector.setRenderer(this),this._getFallback=m,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new Aw(new xo),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const w=this.alpha===!0?0:1;this._clearColor=new AQ(0,0,0,w),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._outputBufferType=y,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._callDepth=-1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,transmitted:!1,type:mS},this.xr=new qit(this,b),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(A,I,D)=>{await this.compileAsync(A,I);const P=this._renderLists.get(A,I),U=this._renderContexts.get(this._renderTarget,this._mrt),j=A.overrideMaterial||D.material,C=this._objects.get(D,j,A,I,P.lightsNode,U,U.clippingContext),{fragmentShader:Z,vertexShader:ie}=C.getNodeBuilderState();return{fragmentShader:Z,vertexShader:ie}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(r){if(this._getFallback!==null)try{this.backend=n=this._getFallback(r),await n.init(this)}catch(i){t(i);return}else{t(r);return}}this._nodes=new Git(this,n),this._animation=new qQe(this,this._nodes,this.info),this._attributes=new eJe(n),this._background=new nit(this,this._nodes),this._geometries=new tJe(this._attributes,this.info),this._textures=new mJe(this,n,this.info),this._pipelines=new oJe(n,this._nodes),this._bindings=new aJe(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new ZQe(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new uJe(this.lighting),this._bundles=new Hit,this._renderContexts=new pJe(this),this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const r=this._nodes.nodeFrame,i=r.renderId,o=this._currentRenderContext,l=this._currentRenderObjectFunction,c=this._handleObjectFunction,h=this._compilationPromises,m=e.isScene===!0?e:g7e;n===null&&(n=e);const y=this._renderTarget,b=this._renderContexts.get(y,this._mrt),w=this._activeMipmapLevel,A=[];this._currentRenderContext=b,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=A,r.renderId++,r.update(),b.depth=this.depth,b.stencil=this.stencil,b.clippingContext||(b.clippingContext=new NF),b.clippingContext.updateGlobal(m,t),m.onBeforeRender(this,e,t,y);const I=this._renderLists.get(e,t);if(I.begin(),this._projectObject(e,t,0,I,b.clippingContext),n!==e&&n.traverseVisible(function(C){C.isLight&&C.layers.test(t.layers)&&I.pushLight(C)}),I.finish(),y!==null){this._textures.updateRenderTarget(y,w);const C=this._textures.get(y);b.textures=C.textures,b.depthTexture=C.depthTexture}else b.textures=null,b.depthTexture=null;n!==e?this._background.update(n,I,b):this._background.update(m,I,b);const D=I.opaque,P=I.transparent,U=I.transparentDoublePass,j=I.lightsNode;this.opaque===!0&&D.length>0&&this._renderObjects(D,t,m,j),this.transparent===!0&&P.length>0&&this._renderTransparents(P,U,t,m,j),r.renderId=i,this._currentRenderContext=o,this._currentRenderObjectFunction=l,this._handleObjectFunction=c,this._compilationPromises=h,await Promise.all(A)}async renderAsync(e,t){es('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(e,t)}async waitForGPU(){Ht("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(e){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){const t=this.contextNode.value;e===!0?(t.modelViewMatrix=YY,t.modelNormalViewMatrix=KY):this.highPrecision&&(delete t.modelViewMatrix,delete t.modelNormalViewMatrix)}get highPrecision(){const e=this.contextNode.value;return e.modelViewMatrix===YY&&e.modelNormalViewMatrix===KY}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getOutputBufferType(){return this._outputBufferType}getColorBufferType(){return es('Renderer: ".getColorBufferType()" has been renamed to ".getOutputBufferType()".'),this.getOutputBufferType()}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),Ht(t),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:r,camera:i,renderList:o}=e,l=this._currentRenderContext,c=this._bundles.get(r,i),h=this.backend.get(c);h.renderContexts===void 0&&(h.renderContexts=new Set);const m=r.version!==h.version,y=h.renderContexts.has(l)===!1||m;if(h.renderContexts.add(l),y){this.backend.beginBundle(l),(h.renderObjects===void 0||m)&&(h.renderObjects=[]),this._currentRenderBundle=c;const{transparentDoublePass:b,transparent:w,opaque:A}=o;this.opaque===!0&&A.length>0&&this._renderObjects(A,i,t,n),this.transparent===!0&&w.length>0&&this._renderTransparents(w,b,i,t,n),this._currentRenderBundle=null,this.backend.finishBundle(l,c),h.version=r.version}else{const{renderObjects:b}=h;for(let w=0,A=b.length;w<A;w++){const I=b[w];this._nodes.needsRefresh(I)&&(this._nodes.updateBefore(I),this._nodes.updateForRender(I),this._bindings.updateForRender(I),this._nodes.updateAfter(I))}}this.backend.addBundle(l,c)}render(e,t){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,n=e!==Ta,r=t!==Zn.workingColorSpace;if(n===!1&&r===!1)return null;const{width:i,height:o}=this.getDrawingBufferSize(I_),{depth:l,stencil:c}=this;let h=this._frameBufferTarget;h===null&&(h=new Op(i,o,{depthBuffer:l,stencilBuffer:c,type:this._outputBufferType,format:io,colorSpace:Zn.workingColorSpace,generateMipmaps:!1,minFilter:ds,magFilter:ds,samples:this.samples}),h.isPostProcessingRenderTarget=!0,this._frameBufferTarget=h);const m=this.getOutputRenderTarget();h.depthBuffer=l,h.stencilBuffer=c,m!==null?h.setSize(m.width,m.height,m.depth):h.setSize(i,o,1);const y=this._canvasTarget;return h.viewport.copy(y._viewport),h.scissor.copy(y._scissor),h.viewport.multiplyScalar(y._pixelRatio),h.scissor.multiplyScalar(y._pixelRatio),h.scissorTest=y._scissorTest,h.multiview=m!==null?m.multiview:!1,h.resolveDepthBuffer=m!==null?m.resolveDepthBuffer:!0,h._autoAllocateDepthBuffer=m!==null?m._autoAllocateDepthBuffer:!1,h}_renderScene(e,t,n=!0){if(this._isDeviceLost===!0)return;const r=n?this._getFrameBufferTarget():null,i=this._nodes.nodeFrame,o=i.renderId,l=this._currentRenderContext,c=this._currentRenderObjectFunction,h=this._handleObjectFunction;this._callDepth++;const m=e.isScene===!0?e:g7e,y=this._renderTarget||this._outputRenderTarget,b=this._activeCubeFace,w=this._activeMipmapLevel;let A;r!==null?(A=r,this.setRenderTarget(A)):A=y;const I=this._renderContexts.get(A,this._mrt,this._callDepth);this._currentRenderContext=I,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this._handleObjectFunction=this._renderObjectDirect,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,i.renderId=this.info.calls,this.backend.updateTimeStampUID(I),this.inspector.beginRender(this.backend.getTimestampUID(I),e,t,A);const D=this.xr;if(D.isPresenting===!1){let Ue=!1;if(this.reversedDepthBuffer===!0&&t.reversedDepth!==!0){if(t._reversedDepth=!0,t.isArrayCamera)for(const ce of t.cameras)ce._reversedDepth=!0;Ue=!0}const Ie=this.coordinateSystem;if(t.coordinateSystem!==Ie){if(t.coordinateSystem=Ie,t.isArrayCamera)for(const ce of t.cameras)ce.coordinateSystem=Ie;Ue=!0}if(Ue===!0&&(t.updateProjectionMatrix(),t.isArrayCamera))for(const ce of t.cameras)ce.updateProjectionMatrix()}e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),D.enabled===!0&&D.isPresenting===!0&&(D.cameraAutoUpdate===!0&&D.updateCamera(t),t=D.getCamera());const P=this._canvasTarget;let U=P._viewport,j=P._scissor,C=P._pixelRatio;A!==null&&(U=A.viewport,j=A.scissor,C=1),this.getDrawingBufferSize(I_),dX.set(0,0,I_.width,I_.height);const Z=U.minDepth===void 0?0:U.minDepth,ie=U.maxDepth===void 0?1:U.maxDepth;I.viewportValue.copy(U).multiplyScalar(C).floor(),I.viewportValue.width>>=w,I.viewportValue.height>>=w,I.viewportValue.minDepth=Z,I.viewportValue.maxDepth=ie,I.viewport=I.viewportValue.equals(dX)===!1,I.scissorValue.copy(j).multiplyScalar(C).floor(),I.scissor=P._scissorTest&&I.scissorValue.equals(dX)===!1,I.scissorValue.width>>=w,I.scissorValue.height>>=w,I.clippingContext||(I.clippingContext=new NF),I.clippingContext.updateGlobal(m,t),m.onBeforeRender(this,e,t,A);const se=t.isArrayCamera?pX:hX;t.isArrayCamera||(KO.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),se.setFromProjectionMatrix(KO,t.coordinateSystem,t.reversedDepth));const z=this._renderLists.get(e,t);if(z.begin(),this._projectObject(e,t,0,z,I.clippingContext),z.finish(),this.sortObjects===!0&&z.sort(this._opaqueSort,this._transparentSort),A!==null){this._textures.updateRenderTarget(A,w);const Ue=this._textures.get(A);I.textures=Ue.textures,I.depthTexture=Ue.depthTexture,I.width=Ue.width,I.height=Ue.height,I.renderTarget=A,I.depth=A.depthBuffer,I.stencil=A.stencilBuffer}else I.textures=null,I.depthTexture=null,I.width=I_.width,I.height=I_.height,I.depth=this.depth,I.stencil=this.stencil;I.width>>=w,I.height>>=w,I.activeCubeFace=b,I.activeMipmapLevel=w,I.occlusionQueryCount=z.occlusionQueryCount,I.scissorValue.max(M3.set(0,0,0,0)),I.scissorValue.x+I.scissorValue.width>I.width&&(I.scissorValue.width=Math.max(I.width-I.scissorValue.x,0)),I.scissorValue.y+I.scissorValue.height>I.height&&(I.scissorValue.height=Math.max(I.height-I.scissorValue.y,0)),this._background.update(m,z,I),I.camera=t,this.backend.beginRender(I);const{bundles:re,lightsNode:ye,transparentDoublePass:H,transparent:Me,opaque:Oe}=z;return re.length>0&&this._renderBundles(re,m,ye),this.opaque===!0&&Oe.length>0&&this._renderObjects(Oe,t,m,ye),this.transparent===!0&&Me.length>0&&this._renderTransparents(Me,H,t,m,ye),this.backend.finishRender(I),i.renderId=o,this._currentRenderContext=l,this._currentRenderObjectFunction=c,this._handleObjectFunction=h,this._callDepth--,r!==null&&(this.setRenderTarget(y,b,w),this._renderOutput(A)),m.onAfterRender(this,e,t,A),this.inspector.finishRender(this.backend.getTimestampUID(I)),I}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,r=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=r}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,n)}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,n)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,n,r){this._canvasTarget.setScissor(e,t,n,r)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,n,r,i=0,o=1){this._canvasTarget.setViewport(e,t,n,r,i,o)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this.reversedDepthBuffer===!0?1-this._clearDepth:this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,n=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const r=this._renderTarget||this._getFrameBufferTarget();let i=null;if(r!==null){this._textures.updateRenderTarget(r);const o=this._textures.get(r);i=this._renderContexts.get(r),i.textures=o.textures,i.depthTexture=o.depthTexture,i.width=o.width,i.height=o.height,i.renderTarget=r,i.depth=r.depthBuffer,i.stencil=r.stencilBuffer;const l=this.backend.getClearColor();i.clearColorValue.r=l.r,i.clearColorValue.g=l.g,i.clearColorValue.b=l.b,i.clearColorValue.a=l.a,i.clearDepthValue=this.getClearDepth(),i.clearStencilValue=this.getClearStencil(),i.activeCubeFace=this.getActiveCubeFace(),i.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,n,i),r!==null&&this._renderTarget===null&&this._renderOutput(r)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,n=!0){es('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(e,t,n)}async clearColorAsync(){es('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){es('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){es('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const e=this.currentToneMapping!==Ta,t=this.currentColorSpace!==Zn.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return this._renderTarget!==null?e=this._renderTarget.samples:this.needsFrameBufferTarget&&(e=0),e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Ta}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:Zn.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,n=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return qt("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e,t);const n=this._nodes.nodeFrame,r=n.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,n.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);const i=this.backend,o=this._pipelines,l=this._bindings,c=this._nodes,h=Array.isArray(e)?e:[e];if(h[0]===void 0||h[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");i.beginCompute(e);for(const m of h){if(o.has(m)===!1){const w=()=>{m.removeEventListener("dispose",w),o.delete(m),l.deleteForCompute(m),c.delete(m)};m.addEventListener("dispose",w);const A=m.onInitFunction;A!==null&&A.call(m,{renderer:this})}c.updateForCompute(m),l.updateForCompute(m);const y=l.getForCompute(m),b=o.getForCompute(m,y);i.compute(e,m,y,b,t)}i.finishCompute(e),n.renderId=r,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return es('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){es('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(e)}initTexture(e){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(e)}initRenderTarget(e){if(this._initialized===!1)throw new Error('Renderer: .initRenderTarget() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateRenderTarget(e);const t=this._textures.get(e),n=this._renderContexts.get(e);n.textures=t.textures,n.depthTexture=t.depthTexture,n.width=t.width,n.height=t.height,n.renderTarget=e,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,this.backend.initRenderTarget(n)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=M3.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=M3.copy(t).floor();else{Ht("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=M3.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,r;n!==null?r=n.renderTarget:(r=this._renderTarget||this._getFrameBufferTarget(),r!==null&&(this._textures.updateRenderTarget(r),n=this._textures.get(r))),this._textures.updateTexture(e,{renderTarget:r}),this.backend.copyFramebufferToTexture(e,n,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,n=null,r=null,i=0,o=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,r,i,o),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,n,r,i,o=0,l=0){return this.backend.copyTextureToBuffer(e.textures[o],t,n,r,i,l)}_projectObject(e,t,n,r,i){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(i=i.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){const c=t.isArrayCamera?pX:hX;if(!e.frustumCulled||c.intersectsSprite(e,t)){this.sortObjects===!0&&M3.setFromMatrixPosition(e.matrixWorld).applyMatrix4(KO);const{geometry:h,material:m}=e;m.visible&&r.push(e,h,m,n,M3.z,null,i)}}else if(e.isLineLoop)Ht("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const c=t.isArrayCamera?pX:hX;if(!e.frustumCulled||c.intersectsObject(e,t)){const{geometry:h,material:m}=e;if(this.sortObjects===!0&&(h.boundingSphere===null&&h.computeBoundingSphere(),M3.copy(h.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(KO)),Array.isArray(m)){const y=h.groups;for(let b=0,w=y.length;b<w;b++){const A=y[b],I=m[A.materialIndex];I&&I.visible&&r.push(e,h,I,n,M3.z,A,i)}}else m.visible&&r.push(e,h,m,n,M3.z,null,i)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const c=r;r=this._renderLists.get(e,t),r.begin(),c.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}const l=e.children;for(let c=0,h=l.length;c<h;c++)this._projectObject(l[c],t,n,r,i)}_renderBundles(e,t,n){for(const r of e)this._renderBundle(r,t,n)}_renderTransparents(e,t,n,r,i){if(t.length>0){for(const{material:o}of t)o.side=bs;this._renderObjects(t,n,r,i,"backSide");for(const{material:o}of t)o.side=Mc;this._renderObjects(e,n,r,i);for(const{material:o}of t)o.side=oa}else this._renderObjects(e,n,r,i)}_renderObjects(e,t,n,r,i=null){for(let o=0,l=e.length;o<l;o++){const{object:c,geometry:h,material:m,group:y,clippingContext:b}=e[o];this._currentRenderObjectFunction(c,n,t,h,m,y,r,b,i)}}_getShadowNodes(e){const t=e.version;let n=this._cacheShadowNodes.get(e);if(n===void 0||n.version!==t){const r=e.map!==null,i=e.colorNode&&e.colorNode.isNode,o=e.castShadowNode&&e.castShadowNode.isNode,l=e.maskShadowNode&&e.maskShadowNode.isNode||e.maskNode&&e.maskNode.isNode;let c=null,h=null,m=null;if(r||i||o||l){let y,b;if(o?(y=e.castShadowNode.rgb,b=e.castShadowNode.a,this.shadowMap.transmitted!==!0&&es("Renderer: `shadowMap.transmitted` needs to be set to `true` when using `material.castShadowNode`.")):(y=$e(0),b=_e(1)),r&&(b=b.mul(go("map","texture",e).a)),i&&(b=b.mul(e.colorNode.a)),h=mr(y,b),l){const w=e.maskShadowNode||e.maskNode;h=Ye(([A])=>(w.not().discard(),A))(h)}}e.depthNode&&e.depthNode.isNode&&(m=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?c=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(c=e.positionNode),n={version:t,colorNode:h,depthNode:m,positionNode:c},this._cacheShadowNodes.set(e,n)}return n}renderObject(e,t,n,r,i,o,l,c=null,h=null){let m=!1,y,b,w,A;if(e.onBeforeRender(this,t,n,r,i,o),i.allowOverride===!0&&t.overrideMaterial!==null){const I=t.overrideMaterial;if(m=!0,y=I.isNodeMaterial?I.colorNode:null,b=I.isNodeMaterial?I.depthNode:null,w=I.isNodeMaterial?I.positionNode:null,A=t.overrideMaterial.side,i.positionNode&&i.positionNode.isNode&&(I.positionNode=i.positionNode),I.alphaTest=i.alphaTest,I.alphaMap=i.alphaMap,I.transparent=i.transparent||i.transmission>0||i.transmissionNode&&i.transmissionNode.isNode||i.backdropNode&&i.backdropNode.isNode,I.isShadowPassMaterial){const{colorNode:D,depthNode:P,positionNode:U}=this._getShadowNodes(i);this.shadowMap.type===mg?I.side=i.shadowSide!==null?i.shadowSide:i.side:I.side=i.shadowSide!==null?i.shadowSide:tst[i.side],D!==null&&(I.colorNode=D),P!==null&&(I.depthNode=P),U!==null&&(I.positionNode=U)}i=I}i.transparent===!0&&i.side===oa&&i.forceSinglePass===!1?(i.side=bs,this._handleObjectFunction(e,i,t,n,l,o,c,"backSide"),i.side=Mc,this._handleObjectFunction(e,i,t,n,l,o,c,h),i.side=oa):this._handleObjectFunction(e,i,t,n,l,o,c,h),m&&(t.overrideMaterial.colorNode=y,t.overrideMaterial.depthNode=b,t.overrideMaterial.positionNode=w,t.overrideMaterial.side=A),e.onAfterRender(this,t,n,r,i,o)}hasCompatibility(e){return this.backend.hasCompatibility(e)}_renderObjectDirect(e,t,n,r,i,o,l,c){const h=this._objects.get(e,t,n,r,i,this._currentRenderContext,l,c);h.drawRange=e.geometry.drawRange,h.group=o,this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(h),h.bundle=this._currentRenderBundle.bundleGroup);const m=this._nodes.needsRefresh(h);m&&(this._nodes.updateBefore(h),this._geometries.updateForRender(h),this._nodes.updateForRender(h),this._bindings.updateForRender(h)),this._pipelines.updateForRender(h),this.backend.draw(h,this.info),m&&this._nodes.updateAfter(h)}_createObjectPipeline(e,t,n,r,i,o,l,c){const h=this._objects.get(e,t,n,r,i,this._currentRenderContext,l,c);h.drawRange=e.geometry.drawRange,h.group=o,this._nodes.updateBefore(h),this._geometries.updateForRender(h),this._nodes.updateForRender(h),this._bindings.updateForRender(h),this._pipelines.getForRender(h,this._compilationPromises),this._nodes.updateAfter(h)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class dCe{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}getVisibility(){return this.visibility}clone(){return Object.assign(new this.constructor,this)}}function rst(s){return s+(Yy-s%Yy)%Yy}class hCe extends dCe{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t,this._updateRanges=[]}get updateRanges(){return this._updateRanges}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}get byteLength(){return rst(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class pCe extends hCe{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let ist=0;class fCe extends pCe{constructor(e,t){super("UniformBuffer_"+ist++,e?e.value:null),this.nodeUniform=e,this.groupNode=t,this.isNodeUniformBuffer=!0}set updateRanges(e){this.nodeUniform.updateRanges=e}get updateRanges(){return this.nodeUniform.updateRanges}addUpdateRange(e,t){this.nodeUniform.addUpdateRange(e,t)}clearUpdateRanges(){this.nodeUniform.clearUpdateRanges()}get buffer(){return this.nodeUniform.value}}class sst extends pCe{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[],this._updateRangeCache=new Map}addUniformUpdateRange(e){const t=e.index;if(this._updateRangeCache.has(t)!==!0){const n=this.updateRanges,r=e.offset,i=e.itemSize,o={start:r,count:i};n.push(o),this._updateRangeCache.set(t,o)}}clearUpdateRanges(){this._updateRangeCache.clear(),super.clearUpdateRanges()}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let n=0,r=this.uniforms.length;n<r;n++){const i=this.uniforms[n],o=i.boundary,l=i.itemSize*e,c=t%Yy,h=c%o,m=c+h;t+=h,m!==0&&Yy-m<l&&(t+=Yy-m),i.offset=t/e,i.index=n,t+=l}return Math.ceil(t/Yy)*Yy}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);Ht("WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,o=e.getType();if(n[i]!==r){const l=this._getBufferForType(o);l[i]=n[i]=r,t=!0,this.addUniformUpdateRange(e)}return t}updateVector2(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,o=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y){const l=this._getBufferForType(o);l[i+0]=n[i+0]=r.x,l[i+1]=n[i+1]=r.y,t=!0,this.addUniformUpdateRange(e)}return t}updateVector3(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,o=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y||n[i+2]!==r.z){const l=this._getBufferForType(o);l[i+0]=n[i+0]=r.x,l[i+1]=n[i+1]=r.y,l[i+2]=n[i+2]=r.z,t=!0,this.addUniformUpdateRange(e)}return t}updateVector4(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,o=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y||n[i+2]!==r.z||n[i+4]!==r.w){const l=this._getBufferForType(o);l[i+0]=n[i+0]=r.x,l[i+1]=n[i+1]=r.y,l[i+2]=n[i+2]=r.z,l[i+3]=n[i+3]=r.w,t=!0,this.addUniformUpdateRange(e)}return t}updateColor(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset;if(n[i+0]!==r.r||n[i+1]!==r.g||n[i+2]!==r.b){const o=this.buffer;o[i+0]=n[i+0]=r.r,o[i+1]=n[i+1]=r.g,o[i+2]=n[i+2]=r.b,t=!0,this.addUniformUpdateRange(e)}return t}updateMatrix3(e){let t=!1;const n=this.values,r=e.getValue().elements,i=e.offset;if(n[i+0]!==r[0]||n[i+1]!==r[1]||n[i+2]!==r[2]||n[i+4]!==r[3]||n[i+5]!==r[4]||n[i+6]!==r[5]||n[i+8]!==r[6]||n[i+9]!==r[7]||n[i+10]!==r[8]){const o=this.buffer;o[i+0]=n[i+0]=r[0],o[i+1]=n[i+1]=r[1],o[i+2]=n[i+2]=r[2],o[i+4]=n[i+4]=r[3],o[i+5]=n[i+5]=r[4],o[i+6]=n[i+6]=r[5],o[i+8]=n[i+8]=r[6],o[i+9]=n[i+9]=r[7],o[i+10]=n[i+10]=r[8],t=!0,this.addUniformUpdateRange(e)}return t}updateMatrix4(e){let t=!1;const n=this.values,r=e.getValue().elements,i=e.offset;return ast(n,r,i)===!1&&(this.buffer.set(r,i),ost(n,r,i),t=!0,this.addUniformUpdateRange(e)),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function ost(s,e,t){for(let n=0,r=e.length;n<r;n++)s[t+n]=e[n]}function ast(s,e,t){for(let n=0,r=e.length;n<r;n++)if(s[t+n]!==e[n])return!1;return!0}let lst=0;class mCe extends sst{constructor(e,t){super(e),this.id=lst++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class gCe extends dCe{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=-1},this.texture=t,this.version=t?t.version:-1,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=e,this.generation=null,this.version=-1,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}clone(){const e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=-1},e.texture=this.texture,e}}let cst=0;class ust extends gCe{constructor(e,t){super(e,t),this.id=cst++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class FB extends ust{constructor(e,t,n,r=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=r}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class yCe extends FB{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledCubeTexture=!0}}class dK extends FB{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledTexture3D=!0}}const y7e={bitcast_int_uint:new xl("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }"),bitcast_uint_int:new xl("uint tsl_bitcast_uint_to_int ( uint x ) { return floatBitsToInt( uintBitsToFloat ( x ) ); }")},dst={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint",floatpack_snorm_2x16:"packSnorm2x16",floatpack_unorm_2x16:"packUnorm2x16",floatpack_float16_2x16:"packHalf2x16",floatunpack_snorm_2x16:"unpackSnorm2x16",floatunpack_unorm_2x16:"unpackUnorm2x16",floatunpack_float16_2x16:"unpackHalf2x16"},v7e={low:"lowp",medium:"mediump",high:"highp"},x7e={swizzleAssign:!0,storageBuffer:!1},b7e={perspective:"smooth",linear:"noperspective"},_7e={centroid:"centroid"},S7e=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision highp sampler2DShadow;
precision highp sampler2DArrayShadow;
precision highp samplerCubeShadow;
`;class hst extends aCe{constructor(e,t){super(e,t,new Vit),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==gu}_include(e){const t=y7e[e];return t.build(this),this.addInclude(t),t}getMethod(e){return y7e[e]!==void 0&&this._include(e),dst[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,n){return`${e} ? ${t} : ${n}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${r.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const n=t.array,r=t.count*t.itemSize,{itemSize:i}=t,o=t.array.constructor.name.toLowerCase().includes("int");let l=o?gw:mw;i===2?l=o?yw:Su:i===3?l=o?nVe:qA:i===4&&(l=o?vw:io);const c={Float32Array:vo,Uint8Array:yo,Uint16Array:um,Uint32Array:Ds,Int8Array:Z6,Int16Array:Q6,Int32Array:r0,Uint8ClampedArray:yo},h=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(r/i))));let m=Math.ceil(r/i/h);h*m*i<r&&m++;const y=h*m*i,b=new n.constructor(y);b.set(n,0),t.array=b;const w=new j3(t.array,h,m,l,c[t.array.constructor.name]||vo);w.needsUpdate=!0,w.isPBOTexture=!0;const A=new Cg(w,null,null);A.setPrecision("high"),t.pboNode=A,t.pbo=A.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,r=t.value;if(this.renderer.backend.has(r)){const m=this.renderer.backend.get(r);m.pbo=r.pbo}const i=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.nodeName),o=this.getPropertyName(i);this.increaseUsage(n);const l=n.build(this,"uint"),c=this.getDataFromNode(e);let h=c.propertyName;if(h===void 0){const m=this.getVarFromNode(e);h=this.getPropertyName(m);const y=this.getDataFromNode(t);let b=y.propertySizeName;b===void 0&&(b=h+"Size",this.getVarFromNode(t,b,"uint"),this.addLineFlowCode(`${b} = uint( textureSize( ${o}, 0 ).x )`,e),y.propertySizeName=b);const{itemSize:w}=r,A="."+xx.join("").slice(0,w),I=`ivec2(${l} % ${b}, ${l} / ${b})`,D=this.generateTextureLoad(null,o,I,"0",null,null);let P="vec4";r.pbo.type===Ds?P="uvec4":r.pbo.type===r0&&(P="ivec4"),this.addLineFlowCode(`${h} = ${P}(${D})${A}`,e),c.propertyName=h}return h}generateTextureLoad(e,t,n,r,i,o){r===null&&(r="0");let l;return i?o?l=`texelFetchOffset( ${t}, ivec3( ${n}, ${i} ), ${r}, ${o} )`:l=`texelFetch( ${t}, ivec3( ${n}, ${i} ), ${r} )`:o?l=`texelFetchOffset( ${t}, ${n}, ${r}, ${o} )`:l=`texelFetch( ${t}, ${n}, ${r} )`,e!==null&&e.isDepthTexture&&(l+=".x"),l}generateTexture(e,t,n,r,i){return r&&(n=`vec3( ${n}, ${r} )`),e.isDepthTexture?i?`textureOffset( ${t}, ${n}, ${i} ).x`:`texture( ${t}, ${n} ).x`:i?`textureOffset( ${t}, ${n}, ${i} )`:`texture( ${t}, ${n} )`}generateTextureLevel(e,t,n,r,i,o){return i&&(n=`vec3( ${n}, ${i} )`),o?`textureLodOffset( ${t}, ${n}, ${r}, ${o} )`:`textureLod( ${t}, ${n}, ${r} )`}generateTextureBias(e,t,n,r,i,o){return i&&(n=`vec3( ${n}, ${i} )`),o?`textureOffset( ${t}, ${n}, ${o}, ${r} )`:`texture( ${t}, ${n}, ${r} )`}generateTextureGrad(e,t,n,r,i,o){return i&&(n=`vec3( ${n}, ${i} )`),o?`textureGradOffset( ${t}, ${n}, ${r[0]}, ${r[1]}, ${o} )`:`textureGrad( ${t}, ${n}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,n,r,i,o,l=this.shaderStage){if(l==="fragment")return e.isCubeTexture?`texture( ${t}, vec4( ${n}, ${r} ) )`:i?o?`textureOffset( ${t}, vec4( ${n}, ${i}, ${r} ), ${o} )`:`texture( ${t}, vec4( ${n}, ${i}, ${r} ) )`:o?`textureOffset( ${t}, vec3( ${n}, ${r} ), ${o} )`:`texture( ${t}, vec3( ${n}, ${r} ) )`;Ht(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${l} shader.`)}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const r of n)t.push(`${this.getVar(r.type,r.name,r.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],n=[],r={};for(const o of t){let l=null,c=!1;if(o.type==="texture"||o.type==="texture3D"){const h=o.node.value;let m="";(h.isDataTexture===!0||h.isData3DTexture===!0)&&(h.type===Ds?m="u":h.type===r0&&(m="i")),o.type==="texture3D"&&h.isArrayTexture===!1?l=`${m}sampler3D ${o.name};`:h.compareFunction?h.isArrayTexture===!0?l=`sampler2DArrayShadow ${o.name};`:l=`sampler2DShadow ${o.name};`:h.isArrayTexture===!0||h.isDataArrayTexture===!0||h.isCompressedArrayTexture===!0?l=`${m}sampler2DArray ${o.name};`:l=`${m}sampler2D ${o.name};`}else if(o.type==="cubeTexture")l=`samplerCube ${o.name};`;else if(o.type==="cubeDepthTexture")o.node.value.compareFunction?l=`samplerCubeShadow ${o.name};`:l=`samplerCube ${o.name};`;else if(o.type==="buffer"){const h=o.node,m=this.getType(h.bufferType),y=h.bufferCount,b=y>0?y:"";l=`${h.name} {
	${m} ${o.name}[${b}];
};
`}else{const h=o.groupNode.name;if(r[h]===void 0){const m=this.uniformGroups[h];if(m!==void 0){const y=[];for(const b of m.uniforms){const w=b.getType(),A=this.getVectorType(w),I=b.nodeUniform.node.precision;let D=`${A} ${b.name};`;I!==null&&(D=v7e[I]+" "+D),y.push("	"+D)}r[h]=y}}c=!0}if(!c){const h=o.node.precision;h!==null&&(l=v7e[h]+" "+l),l="uniform "+l,n.push(l)}}let i="";for(const o in r){const l=r[o];i+=this._getGLSLUniformStruct(o,l.join(`
`))+`
`}return i+=n.join(`
`),i}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==r0){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const r=n.array;r instanceof Uint32Array||r instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const n=this.getAttributesArray();let r=0;for(const i of n)t+=`layout( location = ${r++} ) in ${i.type} ${i.name};
`}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push(`	${n.type} ${n.name};`);return t.join(`
`)}getStructs(e){const t=[],n=this.structs[e],r=[];for(const i of n)if(i.output)for(const o of i.members)r.push(`layout( location = ${o.index} ) out ${o.type} ${o.name};`);else{let o="struct "+i.name+` {
`;o+=this.getStructMembers(i),o+=`
};
`,t.push(o)}return r.length===0&&r.push("layout( location = 0 ) out vec4 fragColor;"),`
`+r.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const n=this.varyings;if(e==="vertex"||e==="compute")for(const r of n){e==="compute"&&(r.needsInterpolation=!0);const i=this.getType(r.type);if(r.needsInterpolation)if(r.interpolationType){const o=b7e[r.interpolationType]||r.interpolationType,l=_7e[r.interpolationSampling]||"";t+=`${o} ${l} out ${i} ${r.name};
`}else{const o=i.includes("int")||i.includes("uv")||i.includes("iv")?"flat ":"";t+=`${o}out ${i} ${r.name};
`}else t+=`${i} ${r.name};
`}else if(e==="fragment"){for(const r of n)if(r.needsInterpolation){const i=this.getType(r.type);if(r.interpolationType){const o=b7e[r.interpolationType]||r.interpolationType,l=_7e[r.interpolationSampling]||"";t+=`${o} ${l} in ${i} ${r.name};
`}else{const o=i.includes("int")||i.includes("uv")||i.includes("iv")?"flat ":"";t+=`${o}in ${i} ${r.name};
`}}}for(const r of this.builtins[e])t+=`${r};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((n,r)=>n*r,1)}u`}getSubgroupSize(){Ht("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){Ht("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){Ht("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,n=this.shaderStage){const r=this.extensions[n]||(this.extensions[n]=new Map);r.has(e)===!1&&r.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const r=this.renderer.backend.extensions;this.object.isBatchedMesh&&r.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(n!==void 0)for(const{name:r,behavior:i}of n.values())t.push(`#extension ${r} : ${i}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=x7e[e];if(t===void 0){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance";break}if(n!==void 0){const r=this.renderer.backend.extensions;r.has(n)&&(r.get(n),t=!0)}x7e[e]=t}return t}isFlipY(){return!0}getUniformBufferLimit(){const e=this.renderer.backend.gl;return e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE)}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const r=e[n],i=this.getPropertyName(r.attributeNode);i&&(t+=`${r.varyingName} = ${i};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${S7e}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${S7e}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n=`// code

`;n+=this.flowCode[t];const r=this.flowNodes[t],i=r[r.length-1];for(const l of r){const c=this.getFlowData(l),h=l.name;h&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${h}
	`),n+=`${c.code}
	`,l===i&&t!=="compute"&&(n+=`// result
	`,t==="vertex"?(n+="gl_Position = ",n+=`${c.result};`):t==="fragment"&&(l.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${c.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n,r=null){const i=super.getUniformFromNode(e,t,n,r),o=this.getDataFromNode(e,n,this.globalCache);let l=o.uniformGPU;if(l===void 0){const c=e.groupNode,h=c.name,m=this.getBindGroupArray(h,n);if(t==="texture")l=new FB(i.name,i.node,c),m.push(l);else if(t==="cubeTexture"||t==="cubeDepthTexture")l=new yCe(i.name,i.node,c),m.push(l);else if(t==="texture3D")l=new dK(i.name,i.node,c),m.push(l);else if(t==="buffer"){i.name=`buffer${e.id}`;const y=this.getSharedDataFromNode(e);let b=y.buffer;b===void 0&&(e.name=`NodeBuffer_${e.id}`,b=new fCe(e,c),b.name=e.name,y.buffer=b),m.push(b),l=b}else{let y=this.uniformGroups[h];y===void 0?(y=new mCe(h,c),this.uniformGroups[h]=y,m.push(y)):m.indexOf(y)===-1&&m.push(y),l=this.getNodeUniform(i,t);const b=l.name;y.uniforms.some(A=>A.name===b)||y.addUniform(l)}o.uniformGPU=l}return i}}let fX=null,k_=null;class vCe{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[md.RENDER]:null,[md.COMPUTE]:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){const t=this.get(e),n=this.renderer.info.frame;let r;e.isComputeNode===!0?r="c:"+this.renderer.info.compute.frameCalls:r="r:"+this.renderer.info.render.frameCalls,t.timestampUID=r+":"+e.id+":f"+n}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){const t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){const t=e.startsWith("c:")?md.COMPUTE:md.RENDER;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){es("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t)return;const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return fX=fX||new Ln,this.renderer.getDrawingBufferSize(fX)}setScissorTest(){}getClearColor(){const e=this.renderer;return k_=k_||new AQ,e.getClearColor(k_),k_.getRGB(k_),k_}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:B_e(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${fx} webgpu`),this.domElement=e),e}hasCompatibility(){return!1}initRenderTarget(){}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}deleteBindGroupData(){}dispose(){}}let pst=0;class fst{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class mst{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:r}=n,i=e.array,o=e.usage||r.STATIC_DRAW,l=e.isInterleavedBufferAttribute?e.data:e,c=n.get(l);let h=c.bufferGPU;h===void 0&&(h=this._createBuffer(r,t,i,o),c.bufferGPU=h,c.bufferType=t,c.version=l.version);let m;if(i instanceof Float32Array)m=r.FLOAT;else if(typeof Float16Array<"u"&&i instanceof Float16Array)m=r.HALF_FLOAT;else if(i instanceof Uint16Array)e.isFloat16BufferAttribute?m=r.HALF_FLOAT:m=r.UNSIGNED_SHORT;else if(i instanceof Int16Array)m=r.SHORT;else if(i instanceof Uint32Array)m=r.UNSIGNED_INT;else if(i instanceof Int32Array)m=r.INT;else if(i instanceof Int8Array)m=r.BYTE;else if(i instanceof Uint8Array)m=r.UNSIGNED_BYTE;else if(i instanceof Uint8ClampedArray)m=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+i);let y={bufferGPU:h,bufferType:t,type:m,byteLength:i.byteLength,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:m===r.INT||m===r.UNSIGNED_INT||e.gpuType===r0,id:pst++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const b=this._createBuffer(r,t,i,o);y=new fst(y,b)}n.set(e,y)}updateAttribute(e){const t=this.backend,{gl:n}=t,r=e.array,i=e.isInterleavedBufferAttribute?e.data:e,o=t.get(i),l=o.bufferType,c=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(l,o.bufferGPU),c.length===0)n.bufferSubData(l,0,r);else{for(let h=0,m=c.length;h<m;h++){const y=c[h];n.bufferSubData(l,y.start*r.BYTES_PER_ELEMENT,r,y.start,y.count)}i.clearUpdateRanges()}n.bindBuffer(l,null),o.version=i.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const r=t.get(e);n.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:i}=t.get(r),o=e.array,l=o.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,i);const c=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.bufferData(n.COPY_WRITE_BUFFER,l,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,l),await t.utils._clientWaitAsync();const h=new e.array.constructor(o.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,h),n.deleteBuffer(c),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),h.buffer}_createBuffer(e,t,n,r){const i=e.createBuffer();return e.bindBuffer(t,i),e.bufferData(t,n,r),e.bindBuffer(t,null),i}}let iC,C3;class gst{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthReversed=!1,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;iC={[i0]:e.FUNC_ADD,[HF]:e.FUNC_SUBTRACT,[$F]:e.FUNC_REVERSE_SUBTRACT},C3={[im]:e.ZERO,[UA]:e.ONE,[zA]:e.SRC_COLOR,[h5]:e.SRC_ALPHA,[WF]:e.SRC_ALPHA_SATURATE,[HA]:e.DST_COLOR,[GA]:e.DST_ALPHA,[VA]:e.ONE_MINUS_SRC_COLOR,[p5]:e.ONE_MINUS_SRC_ALPHA,[$A]:e.ONE_MINUS_DST_COLOR,[jA]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=new zr().fromArray(t),this.currentViewport=new zr().fromArray(n),this._tempVec4=new zr}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==R_e?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===wY?t.cullFace(t.BACK):e===I_e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setMRTBlending(e,t,n){const r=this.gl,i=this.backend.drawBuffersIndexedExt;if(!i){es("WebGPURenderer: Multiple Render Targets (MRT) blending configuration is not fully supported in compatibility mode. The material blending will be used for all render targets.");return}for(let o=0;o<e.length;o++){const l=e[o];let c=null;if(t!==null){const h=t.getBlendMode(l.name);h.blending===PK?c=n:h.blending!==El&&(c=h)}else c=n;c!==null?this._setMRTBlendingIndex(o,c):i.blendFuncSeparateiOES(o,r.ONE,r.ZERO,r.ONE,r.ZERO)}}_setMRTBlendingIndex(e,t){const{gl:n}=this,r=this.backend.drawBuffersIndexedExt,i=t.blending,o=t.blendSrc,l=t.blendDst,c=t.blendEquation,h=t.premultipliedAlpha;if(i===Jy){const m=t.blendSrcAlpha!==null?t.blendSrcAlpha:o,y=t.blendDstAlpha!==null?t.blendDstAlpha:l,b=t.blendEquationAlpha!==null?t.blendEquationAlpha:c;r.blendEquationSeparateiOES(e,iC[c],iC[b]),r.blendFuncSeparateiOES(e,C3[o],C3[l],C3[m],C3[y])}else if(r.blendEquationSeparateiOES(e,n.FUNC_ADD,n.FUNC_ADD),h)switch(i){case L0:r.blendFuncSeparateiOES(e,n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case U3:r.blendFuncSeparateiOES(e,n.ONE,n.ONE,n.ONE,n.ONE);break;case z3:r.blendFuncSeparateiOES(e,n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case V3:r.blendFuncSeparateiOES(e,n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:r.blendFuncSeparateiOES(e,n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break}else switch(i){case L0:r.blendFuncSeparateiOES(e,n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case U3:r.blendFuncSeparateiOES(e,n.SRC_ALPHA,n.ONE,n.ONE,n.ONE);break;case z3:r.blendFuncSeparateiOES(e,n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case V3:r.blendFuncSeparateiOES(e,n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:r.blendFuncSeparateiOES(e,n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break}}setBlending(e,t,n,r,i,o,l,c){const{gl:h}=this;if(e===El){this.currentBlendingEnabled===!0&&(this.disable(h.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(h.BLEND),this.currentBlendingEnabled=!0),e!==Jy){if(e!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==i0||this.currentBlendEquationAlpha!==i0)&&(h.blendEquation(h.FUNC_ADD),this.currentBlendEquation=i0,this.currentBlendEquationAlpha=i0),c)switch(e){case L0:h.blendFuncSeparate(h.ONE,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);break;case U3:h.blendFunc(h.ONE,h.ONE);break;case z3:h.blendFuncSeparate(h.ZERO,h.ONE_MINUS_SRC_COLOR,h.ZERO,h.ONE);break;case V3:h.blendFuncSeparate(h.DST_COLOR,h.ONE_MINUS_SRC_ALPHA,h.ZERO,h.ONE);break;default:Ht("WebGLState: Invalid blending: ",e);break}else switch(e){case L0:h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);break;case U3:h.blendFuncSeparate(h.SRC_ALPHA,h.ONE,h.ONE,h.ONE);break;case z3:Ht("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case V3:Ht("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Ht("WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=c}return}i=i||t,o=o||n,l=l||r,(t!==this.currentBlendEquation||i!==this.currentBlendEquationAlpha)&&(h.blendEquationSeparate(iC[t],iC[i]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=i),(n!==this.currentBlendSrc||r!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||l!==this.currentBlendDstAlpha)&&(h.blendFuncSeparate(C3[n],C3[r],C3[o],C3[l]),this.currentBlendSrc=n,this.currentBlendDst=r,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=l),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setReversedDepth(e){if(this.currentDepthReversed!==e){const t=this.backend.extensions.get("EXT_clip_control");e?t.clipControlEXT(t.LOWER_LEFT_EXT,t.ZERO_TO_ONE_EXT):t.clipControlEXT(t.LOWER_LEFT_EXT,t.NEGATIVE_ONE_TO_ONE_EXT),this.currentDepthReversed=e}}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthReversed&&(e=WK[e]),this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case aA:t.depthFunc(t.NEVER);break;case lA:t.depthFunc(t.ALWAYS);break;case cA:t.depthFunc(t.LESS);break;case f5:t.depthFunc(t.LEQUAL);break;case uA:t.depthFunc(t.EQUAL);break;case dA:t.depthFunc(t.GEQUAL);break;case hA:t.depthFunc(t.GREATER);break;case pA:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,r){const i=this._tempVec4.set(e,t,n,r);if(this.currentScissor.equals(i)===!1){const{gl:o}=this;o.scissor(i.x,i.y,i.z,i.w),this.currentScissor.copy(i)}}viewport(e,t,n,r){const i=this._tempVec4.set(e,t,n,r);if(this.currentViewport.equals(i)===!1){const{gl:o}=this;o.viewport(i.x,i.y,i.z,i.w),this.currentViewport.copy(i)}}setScissorTest(e){const t=this.gl;e?this.enable(t.SCISSOR_TEST):this.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:r}=this;e.side===oa?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let i=e.side===bs;t&&(i=!i),this.setFlipSided(i),e.blending===L0&&e.transparent===!1?this.setBlending(El):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n)for(let c=0;c<8;c++)c<n?this.enable(12288+c):this.disable(12288+c)}setPolygonOffset(e,t,n){const{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==n)&&(r.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const n=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(n.bindVertexArray(e),t!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:r}=this;return r[e]!==t?(n.bindFramebuffer(e,t),r[e]=t,e===n.DRAW_FRAMEBUFFER&&(r[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(r[n.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:n}=this;let r=[],i=!1;if(e.textures!==null){r=this.currentDrawbuffers.get(t),r===void 0&&(r=[],this.currentDrawbuffers.set(t,r));const o=e.textures;if(r.length!==o.length||r[0]!==n.COLOR_ATTACHMENT0){for(let l=0,c=o.length;l<c;l++)r[l]=n.COLOR_ATTACHMENT0+l;r.length=o.length,i=!0}}else r[0]!==n.BACK&&(r[0]=n.BACK,i=!0);i&&n.drawBuffers(r)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:r}=this;e===void 0&&(e=t.TEXTURE0+r-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:r,currentTextureSlot:i,currentBoundTextures:o,maxTextures:l}=this;n===void 0&&(i===null?n=r.TEXTURE0+l-1:n=i);let c=o[n];c===void 0&&(c={type:void 0,texture:void 0},o[n]=c),(c.type!==e||c.texture!==t)&&(i!==n&&(r.activeTexture(n),this.currentTextureSlot=n),r.bindTexture(e,t),c.type=e,c.texture=t)}bindBufferBase(e,t,n){const{gl:r}=this,i=`${e}-${t}`;return this.currentBoundBufferBases[i]!==n?(r.bindBufferBase(e,t,n),this.currentBoundBufferBases[i]=n,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,r=n[t];r!==void 0&&r.type!==void 0&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class yst{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=gu){const{gl:n,extensions:r}=this;let i;const o=Zn.getTransfer(t);if(e===yo)return n.UNSIGNED_BYTE;if(e===JF)return n.UNSIGNED_SHORT_4_4_4_4;if(e===eB)return n.UNSIGNED_SHORT_5_5_5_1;if(e===tB)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===nB)return n.UNSIGNED_INT_10F_11F_11F_REV;if(e===Z6)return n.BYTE;if(e===Q6)return n.SHORT;if(e===um)return n.UNSIGNED_SHORT;if(e===r0)return n.INT;if(e===Ds)return n.UNSIGNED_INT;if(e===vo)return n.FLOAT;if(e===ro)return n.HALF_FLOAT;if(e===UK)return n.ALPHA;if(e===qA)return n.RGB;if(e===io)return n.RGBA;if(e===B0)return n.DEPTH_COMPONENT;if(e===_u)return n.DEPTH_STENCIL;if(e===mw)return n.RED;if(e===gw)return n.RED_INTEGER;if(e===Su)return n.RG;if(e===yw)return n.RG_INTEGER;if(e===vw)return n.RGBA_INTEGER;if(e===e5||e===t5||e===n5||e===r5)if(o===Yn)if(i=r.get("WEBGL_compressed_texture_s3tc_srgb"),i!==null){if(e===e5)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===t5)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===n5)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===r5)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(i=r.get("WEBGL_compressed_texture_s3tc"),i!==null){if(e===e5)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===t5)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===n5)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===r5)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===fA||e===mA||e===gA||e===yA)if(i=r.get("WEBGL_compressed_texture_pvrtc"),i!==null){if(e===fA)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===mA)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===gA)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===yA)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===MS||e===CS||e===AS||e===NS||e===PS||e===ax||e===RS)if(i=r.get("WEBGL_compressed_texture_etc"),i!==null){if(e===MS||e===CS)return o===Yn?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(e===AS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC;if(e===NS)return i.COMPRESSED_R11_EAC;if(e===PS)return i.COMPRESSED_SIGNED_R11_EAC;if(e===ax)return i.COMPRESSED_RG11_EAC;if(e===RS)return i.COMPRESSED_SIGNED_RG11_EAC}else return null;if(e===IS||e===kS||e===DS||e===OS||e===LS||e===FS||e===BS||e===US||e===zS||e===VS||e===GS||e===jS||e===HS||e===$S)if(i=r.get("WEBGL_compressed_texture_astc"),i!==null){if(e===IS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===kS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===DS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===OS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===LS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===FS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===BS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===US)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===zS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===VS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===GS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===jS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===HS)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===$S)return o===Yn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===WS)if(i=r.get("EXT_texture_compression_bptc"),i!==null){if(e===WS)return o===Yn?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===qS||e===XS||e===lx||e===YS)if(i=r.get("EXT_texture_compression_rgtc"),i!==null){if(e===qS)return i.COMPRESSED_RED_RGTC1_EXT;if(e===XS)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===lx)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===YS)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===gh?n.UNSIGNED_INT_24_8:n[e]!==void 0?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,r)=>{function i(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(t),r();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(i);return}e.deleteSync(t),n()}i()})}}let w7e=!1,ZO,mX,T7e;class vst{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,w7e===!1&&(this._init(),w7e=!0)}_init(){const e=this.gl;ZO={[vh]:e.REPEAT,[zo]:e.CLAMP_TO_EDGE,[ox]:e.MIRRORED_REPEAT},mX={[Yi]:e.NEAREST,[BK]:e.NEAREST_MIPMAP_NEAREST,[G3]:e.NEAREST_MIPMAP_LINEAR,[ds]:e.LINEAR,[yS]:e.LINEAR_MIPMAP_NEAREST,[fd]:e.LINEAR_MIPMAP_LINEAR},T7e={[VK]:e.NEVER,[$K]:e.ALWAYS,[rB]:e.LESS,[mx]:e.LEQUAL,[GK]:e.EQUAL,[gx]:e.GEQUAL,[jK]:e.GREATER,[HK]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return e.isCubeTexture===!0?n=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?n=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?n=t.TEXTURE_3D:n=t.TEXTURE_2D,n}getInternalFormat(e,t,n,r,i=!1){const{gl:o,extensions:l}=this;if(e!==null){if(o[e]!==void 0)return o[e];qt("WebGLBackend: Attempt to use non-existing WebGL internal format '"+e+"'")}let c=t;if(t===o.RED&&(n===o.FLOAT&&(c=o.R32F),n===o.HALF_FLOAT&&(c=o.R16F),n===o.UNSIGNED_BYTE&&(c=o.R8),n===o.UNSIGNED_SHORT&&(c=o.R16),n===o.UNSIGNED_INT&&(c=o.R32UI),n===o.BYTE&&(c=o.R8I),n===o.SHORT&&(c=o.R16I),n===o.INT&&(c=o.R32I)),t===o.RED_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.R8UI),n===o.UNSIGNED_SHORT&&(c=o.R16UI),n===o.UNSIGNED_INT&&(c=o.R32UI),n===o.BYTE&&(c=o.R8I),n===o.SHORT&&(c=o.R16I),n===o.INT&&(c=o.R32I)),t===o.RG&&(n===o.FLOAT&&(c=o.RG32F),n===o.HALF_FLOAT&&(c=o.RG16F),n===o.UNSIGNED_BYTE&&(c=o.RG8),n===o.UNSIGNED_SHORT&&(c=o.RG16),n===o.UNSIGNED_INT&&(c=o.RG32UI),n===o.BYTE&&(c=o.RG8I),n===o.SHORT&&(c=o.RG16I),n===o.INT&&(c=o.RG32I)),t===o.RG_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RG8UI),n===o.UNSIGNED_SHORT&&(c=o.RG16UI),n===o.UNSIGNED_INT&&(c=o.RG32UI),n===o.BYTE&&(c=o.RG8I),n===o.SHORT&&(c=o.RG16I),n===o.INT&&(c=o.RG32I)),t===o.RGB){const h=i?KS:Zn.getTransfer(r);n===o.FLOAT&&(c=o.RGB32F),n===o.HALF_FLOAT&&(c=o.RGB16F),n===o.UNSIGNED_BYTE&&(c=o.RGB8),n===o.UNSIGNED_SHORT&&(c=o.RGB16),n===o.UNSIGNED_INT&&(c=o.RGB32UI),n===o.BYTE&&(c=o.RGB8I),n===o.SHORT&&(c=o.RGB16I),n===o.INT&&(c=o.RGB32I),n===o.UNSIGNED_BYTE&&(c=h===Yn?o.SRGB8:o.RGB8),n===o.UNSIGNED_SHORT_5_6_5&&(c=o.RGB565),n===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1),n===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGB4),n===o.UNSIGNED_INT_5_9_9_9_REV&&(c=o.RGB9_E5),n===o.UNSIGNED_INT_10F_11F_11F_REV&&(c=o.R11F_G11F_B10F)}if(t===o.RGB_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RGB8UI),n===o.UNSIGNED_SHORT&&(c=o.RGB16UI),n===o.UNSIGNED_INT&&(c=o.RGB32UI),n===o.BYTE&&(c=o.RGB8I),n===o.SHORT&&(c=o.RGB16I),n===o.INT&&(c=o.RGB32I)),t===o.RGBA){const h=i?KS:Zn.getTransfer(r);n===o.FLOAT&&(c=o.RGBA32F),n===o.HALF_FLOAT&&(c=o.RGBA16F),n===o.UNSIGNED_BYTE&&(c=o.RGBA8),n===o.UNSIGNED_SHORT&&(c=o.RGBA16),n===o.UNSIGNED_INT&&(c=o.RGBA32UI),n===o.BYTE&&(c=o.RGBA8I),n===o.SHORT&&(c=o.RGBA16I),n===o.INT&&(c=o.RGBA32I),n===o.UNSIGNED_BYTE&&(c=h===Yn?o.SRGB8_ALPHA8:o.RGBA8),n===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGBA4),n===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1)}return t===o.RGBA_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RGBA8UI),n===o.UNSIGNED_SHORT&&(c=o.RGBA16UI),n===o.UNSIGNED_INT&&(c=o.RGBA32UI),n===o.BYTE&&(c=o.RGBA8I),n===o.SHORT&&(c=o.RGBA16I),n===o.INT&&(c=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(n===o.UNSIGNED_SHORT&&(c=o.DEPTH_COMPONENT16),n===o.UNSIGNED_INT&&(c=o.DEPTH_COMPONENT24),n===o.FLOAT&&(c=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&n===o.UNSIGNED_INT_24_8&&(c=o.DEPTH24_STENCIL8),(c===o.R16F||c===o.R32F||c===o.RG16F||c===o.RG32F||c===o.RGBA16F||c===o.RGBA32F)&&l.get("EXT_color_buffer_float"),c}setTextureParameters(e,t){const{gl:n,extensions:r,backend:i}=this,o=Zn.getPrimaries(Zn.workingColorSpace),l=t.colorSpace===gu?null:Zn.getPrimaries(t.colorSpace),c=t.colorSpace===gu||o===l?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,c),n.texParameteri(e,n.TEXTURE_WRAP_S,ZO[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,ZO[t.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||n.texParameteri(e,n.TEXTURE_WRAP_R,ZO[t.wrapR])),n.texParameteri(e,n.TEXTURE_MAG_FILTER,mX[t.magFilter]);const h=t.mipmaps!==void 0&&t.mipmaps.length>0,m=t.minFilter===ds&&h?fd:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,mX[m]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,T7e[t.compareFunction])),r.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===Yi||t.minFilter!==G3&&t.minFilter!==fd||t.type===vo&&r.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const y=r.get("EXT_texture_filter_anisotropic");n.texParameterf(e,y.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,i.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:r}=this,i=this.getGLTextureType(e);let o=r[i];o===void 0&&(o=t.createTexture(),n.state.bindTexture(i,o),t.texParameteri(i,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(i,t.TEXTURE_MAG_FILTER,t.NEAREST),r[i]=o),n.set(e,{textureGPU:o,glTextureType:i})}createTexture(e,t){const{gl:n,backend:r}=this,{levels:i,width:o,height:l,depth:c}=t,h=r.utils.convert(e.format,e.colorSpace),m=r.utils.convert(e.type),y=this.getInternalFormat(e.internalFormat,h,m,e.colorSpace,e.isVideoTexture),b=n.createTexture(),w=this.getGLTextureType(e);r.state.bindTexture(w,b),this.setTextureParameters(w,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,i,y,o,l,c):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,i,y,o,l,c):e.isVideoTexture||n.texStorage2D(w,i,y,o,l),r.set(e,{textureGPU:b,glTextureType:w,glFormat:h,glType:m,glInternalFormat:y})}copyBufferToTexture(e,t){const{gl:n,backend:r}=this,{textureGPU:i,glTextureType:o,glFormat:l,glType:c}=r.get(t),{width:h,height:m}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(o,i),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(o,0,0,0,h,m,l,c,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:r,height:i}=t,{textureGPU:o,glTextureType:l,glFormat:c,glType:h,glInternalFormat:m}=this.backend.get(e);if(!(e.isRenderTargetTexture||o===void 0))if(this.backend.state.bindTexture(l,o),this.setTextureParameters(l,e),e.isCompressedTexture){const y=e.mipmaps,b=t.image;for(let w=0;w<y.length;w++){const A=y[w];e.isCompressedArrayTexture?e.format!==n.RGBA?c!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,w,0,0,0,A.width,A.height,b.depth,c,A.data):qt("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,w,0,0,0,A.width,A.height,b.depth,c,h,A.data):c!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,w,0,0,A.width,A.height,c,A.data):qt("WebGLBackend: Unsupported compressed texture format")}}else if(e.isCubeTexture){const y=t.images,b=e.mipmaps;for(let w=0;w<6;w++){const A=QO(y[w]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+w,0,0,0,r,i,c,h,A);for(let I=0;I<b.length;I++){const D=b[I],P=QO(D.images[w]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+w,I+1,0,0,P.width,P.height,c,h,P)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const y=t.image;if(e.layerUpdates.size>0){const b=FY(y.width,y.height,e.format,e.type);for(const w of e.layerUpdates){const A=y.data.subarray(w*b/y.data.BYTES_PER_ELEMENT,(w+1)*b/y.data.BYTES_PER_ELEMENT);n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,w,y.width,y.height,1,c,h,A)}e.clearLayerUpdates()}else n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,y.width,y.height,y.depth,c,h,y.data)}else if(e.isData3DTexture){const y=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,y.width,y.height,y.depth,c,h,y.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(l,0,m,c,h,t.image);else{const y=e.mipmaps;if(y.length>0)for(let b=0,w=y.length;b<w;b++){const A=y[b],I=QO(A);n.texSubImage2D(l,b,0,0,A.width,A.height,c,h,I)}else{const b=QO(t.image);n.texSubImage2D(l,0,0,0,r,i,c,h,b)}}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:r,glTextureType:i}=n.get(e);n.state.bindTexture(i,r),t.generateMipmap(i)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const r=n.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const i in r.framebuffers)t.deleteFramebuffer(r.framebuffers[i]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let i=0;i<r.msaaRenderbuffers.length;i++)t.deleteRenderbuffer(r.msaaRenderbuffers[i]);delete r.msaaRenderbuffers}}}destroyTexture(e,t=!1){const{gl:n,backend:r}=this,{textureGPU:i,renderTarget:o}=r.get(e);this.deallocateRenderBuffers(o),t===!1&&n.deleteTexture(i),r.delete(e)}copyTextureToTexture(e,t,n=null,r=null,i=0,o=0){const{gl:l,backend:c}=this,{state:h}=this.backend,{textureGPU:m,glTextureType:y,glType:b,glFormat:w}=c.get(t);h.bindTexture(y,m);let A,I,D,P,U,j,C,Z,ie;const se=e.isCompressedTexture?e.mipmaps[o]:e.image;if(n!==null)A=n.max.x-n.min.x,I=n.max.y-n.min.y,D=n.isBox3?n.max.z-n.min.z:1,P=n.min.x,U=n.min.y,j=n.isBox3?n.min.z:0;else{const Ie=Math.pow(2,-i);A=Math.floor(se.width*Ie),I=Math.floor(se.height*Ie),e.isDataArrayTexture||e.isArrayTexture?D=se.depth:e.isData3DTexture?D=Math.floor(se.depth*Ie):D=1,P=0,U=0,j=0}r!==null?(C=r.x,Z=r.y,ie=r.z):(C=0,Z=0,ie=0),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,t.flipY),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),l.pixelStorei(l.UNPACK_ALIGNMENT,t.unpackAlignment);const z=l.getParameter(l.UNPACK_ROW_LENGTH),re=l.getParameter(l.UNPACK_IMAGE_HEIGHT),ye=l.getParameter(l.UNPACK_SKIP_PIXELS),H=l.getParameter(l.UNPACK_SKIP_ROWS),Me=l.getParameter(l.UNPACK_SKIP_IMAGES);l.pixelStorei(l.UNPACK_ROW_LENGTH,se.width),l.pixelStorei(l.UNPACK_IMAGE_HEIGHT,se.height),l.pixelStorei(l.UNPACK_SKIP_PIXELS,P),l.pixelStorei(l.UNPACK_SKIP_ROWS,U),l.pixelStorei(l.UNPACK_SKIP_IMAGES,j);const Oe=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,Ue=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){const Ie=c.get(e),ce=c.get(t),Ve=c.get(Ie.renderTarget),Pe=c.get(ce.renderTarget),We=Ve.framebuffers[Ie.cacheKey],pt=Pe.framebuffers[ce.cacheKey];h.bindFramebuffer(l.READ_FRAMEBUFFER,We),h.bindFramebuffer(l.DRAW_FRAMEBUFFER,pt);for(let Ne=0;Ne<D;Ne++)Oe&&(l.framebufferTextureLayer(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,Ie.textureGPU,i,j+Ne),l.framebufferTextureLayer(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0,m,o,ie+Ne)),l.blitFramebuffer(P,U,A,I,C,Z,A,I,l.DEPTH_BUFFER_BIT,l.NEAREST);h.bindFramebuffer(l.READ_FRAMEBUFFER,null),h.bindFramebuffer(l.DRAW_FRAMEBUFFER,null)}else if(i!==0||e.isRenderTargetTexture||c.has(e)){const Ie=c.get(e);this._srcFramebuffer===null&&(this._srcFramebuffer=l.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=l.createFramebuffer()),h.bindFramebuffer(l.READ_FRAMEBUFFER,this._srcFramebuffer),h.bindFramebuffer(l.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let ce=0;ce<D;ce++)Oe?l.framebufferTextureLayer(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,Ie.textureGPU,i,j+ce):l.framebufferTexture2D(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,Ie.textureGPU,i),Ue?l.framebufferTextureLayer(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0,m,o,ie+ce):l.framebufferTexture2D(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,m,o),i!==0?l.blitFramebuffer(P,U,A,I,C,Z,A,I,l.COLOR_BUFFER_BIT,l.NEAREST):Ue?l.copyTexSubImage3D(y,o,C,Z,ie+ce,P,U,A,I):l.copyTexSubImage2D(y,o,C,Z,P,U,A,I);h.bindFramebuffer(l.READ_FRAMEBUFFER,null),h.bindFramebuffer(l.DRAW_FRAMEBUFFER,null)}else Ue?e.isDataTexture||e.isData3DTexture?l.texSubImage3D(y,o,C,Z,ie,A,I,D,w,b,se.data):t.isCompressedArrayTexture?l.compressedTexSubImage3D(y,o,C,Z,ie,A,I,D,w,se.data):l.texSubImage3D(y,o,C,Z,ie,A,I,D,w,b,se):e.isDataTexture?l.texSubImage2D(l.TEXTURE_2D,o,C,Z,A,I,w,b,se.data):e.isCompressedTexture?l.compressedTexSubImage2D(l.TEXTURE_2D,o,C,Z,se.width,se.height,w,se.data):l.texSubImage2D(l.TEXTURE_2D,o,C,Z,A,I,w,b,se);l.pixelStorei(l.UNPACK_ROW_LENGTH,z),l.pixelStorei(l.UNPACK_IMAGE_HEIGHT,re),l.pixelStorei(l.UNPACK_SKIP_PIXELS,ye),l.pixelStorei(l.UNPACK_SKIP_ROWS,H),l.pixelStorei(l.UNPACK_SKIP_IMAGES,Me),o===0&&t.generateMipmaps&&l.generateMipmap(y),h.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:r}=this,{state:i}=this.backend,{textureGPU:o}=this.backend.get(e),{x:l,y:c,z:h,w:m}=n,y=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,b=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(y){const w=l!==0||c!==0;let A,I;if(e.isDepthTexture===!0?(A=r.DEPTH_BUFFER_BIT,I=r.DEPTH_ATTACHMENT,t.stencil&&(A|=r.STENCIL_BUFFER_BIT)):(A=r.COLOR_BUFFER_BIT,I=r.COLOR_ATTACHMENT0),w){const D=this.backend.get(t.renderTarget),P=D.framebuffers[t.getCacheKey()],U=D.msaaFrameBuffer;i.bindFramebuffer(r.DRAW_FRAMEBUFFER,P),i.bindFramebuffer(r.READ_FRAMEBUFFER,U);const j=b-c-m;r.blitFramebuffer(l,j,l+h,j+m,l,j,l+h,j+m,A,r.NEAREST),i.bindFramebuffer(r.READ_FRAMEBUFFER,P),i.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,l,j,h,m),i.unbindTexture()}else{const D=r.createFramebuffer();i.bindFramebuffer(r.DRAW_FRAMEBUFFER,D),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,I,r.TEXTURE_2D,o,0),r.blitFramebuffer(0,0,h,m,0,0,h,m,A,r.NEAREST),r.deleteFramebuffer(D)}}else i.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,l,b-m-c,h,m),i.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n,r=!1){const{gl:i}=this,o=t.renderTarget,{depthTexture:l,depthBuffer:c,stencilBuffer:h,width:m,height:y}=o;if(i.bindRenderbuffer(i.RENDERBUFFER,e),c&&!h){let b=i.DEPTH_COMPONENT24;r===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(i.RENDERBUFFER,o.samples,b,m,y):n>0?(l&&l.isDepthTexture&&l.type===i.FLOAT&&(b=i.DEPTH_COMPONENT32F),i.renderbufferStorageMultisample(i.RENDERBUFFER,n,b,m,y)):i.renderbufferStorage(i.RENDERBUFFER,b,m,y),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e)}else c&&h&&(n>0?i.renderbufferStorageMultisample(i.RENDERBUFFER,n,i.DEPTH24_STENCIL8,m,y):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,m,y),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e));i.bindRenderbuffer(i.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,n,r,i,o){const{backend:l,gl:c}=this,{textureGPU:h,glFormat:m,glType:y}=this.backend.get(e),b=c.createFramebuffer();l.state.bindFramebuffer(c.READ_FRAMEBUFFER,b);const w=e.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+o:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,w,h,0);const A=this._getTypedArrayType(y),I=this._getBytesPerTexel(y,m),P=r*i*I,U=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,U),c.bufferData(c.PIXEL_PACK_BUFFER,P,c.STREAM_READ),c.readPixels(t,n,r,i,m,y,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await l.utils._clientWaitAsync();const j=new A(P/A.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,U),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,j),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l.state.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.deleteFramebuffer(b),j}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:n}=this;let r=0;if(e===n.UNSIGNED_BYTE&&(r=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(r=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(r=4),t===n.RGBA)return r*4;if(t===n.RGB)return r*3;if(t===n.ALPHA)return r}dispose(){const{gl:e}=this;this._srcFramebuffer!==null&&e.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&e.deleteFramebuffer(this._dstFramebuffer)}}function QO(s){return s.isDataTexture?s.image.data:typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas?s:s.data}class xst{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class bst{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const E7e={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class _st{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:r,object:i,type:o,info:l,index:c}=this;c!==0?n.drawElements(r,t,o,e):n.drawArrays(r,e,t),l.update(i,t,1)}renderInstances(e,t,n){const{gl:r,mode:i,type:o,index:l,object:c,info:h}=this;n!==0&&(l!==0?r.drawElementsInstanced(i,t,o,e,n):r.drawArraysInstanced(i,e,t,n),h.update(c,t,n))}renderMultiDraw(e,t,n){const{extensions:r,mode:i,object:o,info:l}=this;if(n===0)return;const c=r.get("WEBGL_multi_draw");if(c===null)for(let h=0;h<n;h++)this.render(e[h],t[h]);else{this.index!==0?c.multiDrawElementsWEBGL(i,t,0,this.type,e,0,n):c.multiDrawArraysWEBGL(i,e,0,t,0,n);let h=0;for(let m=0;m<n;m++)h+=t[m];l.update(o,h,1)}}renderMultiDrawInstances(e,t,n,r){const{extensions:i,mode:o,object:l,info:c}=this;if(n===0)return;const h=i.get("WEBGL_multi_draw");if(h===null)for(let m=0;m<n;m++)this.renderInstances(e[m],t[m],r[m]);else{this.index!==0?h.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,r,0,n):h.multiDrawArraysInstancedWEBGL(o,e,0,t,0,r,0,n);let m=0;for(let y=0;y<n;y++)m+=t[y]*r[y];c.update(l,m,1)}}}class xCe{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return t===void 0&&(qt(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class Sst extends xCe{constructor(e,t,n=2048){if(super(n),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){qt("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let r=0;r<this.maxQueries;r++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return es(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;const n=this.queries[t];if(n)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(r){Ht("Error in beginQuery:",r),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(n){Ht("Error in endQuery:",n),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=new Map;for(const[i,o]of this.queryOffsets)if(this.queryStates.get(o)==="ended"){const c=this.queries[o];e.set(i,this.resolveQuery(c))}if(e.size===0)return this.lastValue;const t={},n=[];for(const[i,o]of e){const l=i.match(/^(.*):f(\d+)$/),c=parseInt(l[2]);n.includes(c)===!1&&n.push(c),t[c]===void 0&&(t[c]=0);const h=await o;this.timestamps.set(i,h),t[c]+=h}const r=t[n[n.length-1]];return this.lastValue=r,this.frames=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,r}catch(e){return Ht("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let n,r=!1;const i=()=>{n&&(clearTimeout(n),n=null)},o=c=>{r||(r=!0,i(),t(c))},l=()=>{if(this.isDisposed){o(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){o(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){n=setTimeout(l,1);return}const m=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(m)/1e6)}catch(c){Ht("Error checking query:",c),t(this.lastValue)}};l()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class M7e extends vCe{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},r=t.context!==void 0?t.context:e.domElement.getContext("webgl2",n);function i(o){o.preventDefault();const l={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(l)}this._onContextLost=i,e.domElement.addEventListener("webglcontextlost",i,!1),this.gl=r,this.extensions=new xst(this),this.capabilities=new bst(this),this.attributeUtils=new mst(this),this.textureUtils=new vst(this),this.bufferRenderer=new _st(this),this.state=new gst(this),this.utils=new yst(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.extensions.get("EXT_clip_control"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this.drawBuffersIndexedExt=this.extensions.get("OES_draw_buffers_indexed"),t.reversedDepthBuffer===!0&&this.extensions.has("EXT_clip_control")&&this.state.setReversedDepth(!0)}get coordinateSystem(){return Tc}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,n=null){const r=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:r.RGBA8}),n!==null){const i=e.stencilBuffer?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:i}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&qt("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new Sst(this.gl,e,2048));const n=this.timestampQueryPool[e];n.allocateQueriesForContext(t)!==null&&n.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,n=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:i,height:o}=this.getDrawingBufferSize();t.viewport(0,0,i,o)}if(e.scissor)this.updateScissor(e);else{const{width:i,height:o}=this.getDrawingBufferSize();t.scissor(0,0,i,o)}this.initTimestampQuery(md.RENDER,this.getTimestampUID(e)),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const r=e.occlusionQueryCount;r>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(r),n.occlusionQueryObjects=new Array(r),n.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,r=this.get(e),i=r.previousContext;n.resetVertexState();const o=e.occlusionQueryCount;o>0&&(o>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const l=e.textures;if(l!==null)for(let c=0;c<l.length;c++){const h=l[c];h.generateMipmaps&&this.generateMipmaps(h)}if(this._currentContext=i,this._resolveRenderTarget(e),i!==null){if(this._setFramebuffer(i),i.viewport)this.updateViewport(i);else{const{width:c,height:h}=this.getDrawingBufferSize();n.viewport(0,0,c,h)}if(i.scissor)this.updateScissor(i);else{const{width:c,height:h}=this.getDrawingBufferSize();n.scissor(0,0,c,h)}}this.prepareTimestampBuffer(md.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const i=new WeakSet,{gl:o}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const l=()=>{let c=0;for(let h=0;h<n.length;h++){const m=n[h];m!==null&&o.getQueryParameter(m,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(m,o.QUERY_RESULT)===0&&i.add(r[h]),n[h]=null,o.deleteQuery(m),c++)}c<n.length?requestAnimationFrame(l):t.occluded=i};l()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:r,width:i,height:o}=e.viewportValue;t.viewport(n,e.height-o-r,i,o)}updateScissor(e){const{state:t}=this,{x:n,y:r,width:i,height:o}=e.scissorValue;t.scissor(n,e.height-o-r,i,o)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n,r=null,i=!0,o=!0){const{gl:l,renderer:c}=this;r===null&&(r={textures:null,clearColorValue:this.getClearColor()});let h=0;if(e&&(h|=l.COLOR_BUFFER_BIT),t&&(h|=l.DEPTH_BUFFER_BIT),n&&(h|=l.STENCIL_BUFFER_BIT),h!==0){let m;r.clearColorValue?m=r.clearColorValue:m=this.getClearColor();const y=c.getClearDepth(),b=c.getClearStencil();if(t&&this.state.setDepthMask(!0),r.textures===null)l.clearColor(m.r,m.g,m.b,m.a),l.clear(h);else{if(i&&this._setFramebuffer(r),e)for(let w=0;w<r.textures.length;w++)w===0?l.clearBufferfv(l.COLOR,w,[m.r,m.g,m.b,m.a]):l.clearBufferfv(l.COLOR,w,[0,0,0,1]);t&&n?l.clearBufferfi(l.DEPTH_STENCIL,0,y,b):t?l.clearBufferfv(l.DEPTH,0,[y]):n&&l.clearBufferiv(l.STENCIL,0,[b]),i&&o&&this._resolveRenderTarget(r)}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(md.COMPUTE,this.getTimestampUID(e))}compute(e,t,n,r,i=null){const{state:o,gl:l}=this;this.discard===!1&&(o.enable(l.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:c,transformBuffers:h,attributes:m}=this.get(r),y=this._getVaoKey(m),b=this.vaoCache[y];b===void 0?this.vaoCache[y]=this._createVao(m):o.setVertexState(b),o.useProgram(c),this._bindUniforms(n);const w=this._getTransformFeedback(h);l.bindTransformFeedback(l.TRANSFORM_FEEDBACK,w),l.beginTransformFeedback(l.POINTS),i=i!==null?i:t.count,Array.isArray(i)?(es("WebGLBackend.compute(): The count parameter must be a single number, not an array."),i=i[0]):i&&typeof i=="object"&&i.isIndirectStorageBufferAttribute&&(es("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),i=t.count),m[0].isStorageInstancedBufferAttribute?l.drawArraysInstanced(l.POINTS,0,1,i):l.drawArrays(l.POINTS,0,i),l.endTransformFeedback(),l.bindTransformFeedback(l.TRANSFORM_FEEDBACK,null);for(let A=0;A<h.length;A++){const I=h[A];I.pbo&&this.has(I.pbo)&&this.textureUtils.copyBufferToTexture(I.transformBuffer,I.pbo),I.switchBuffers()}}finishCompute(e){const{state:t,gl:n}=this;this.discard=!1,t.disable(n.RASTERIZER_DISCARD),this.prepareTimestampBuffer(md.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:n,material:r,context:i,hardwareClippingPlanes:o}=e,{programGPU:l}=this.get(n),{gl:c,state:h}=this,m=this.get(i),y=e.getDrawParameters();if(y===null)return;this._bindUniforms(e.getBindings());const b=t.isMesh&&t.matrixWorld.determinant()<0;h.setMaterial(r,b,o),i.mrt!==null&&i.textures!==null&&h.setMRTBlending(i.textures,i.mrt,r),h.useProgram(l);const w=e.getAttributes(),A=this.get(w);let I=A.vaoGPU;if(I===void 0){const z=this._getVaoKey(w);I=this.vaoCache[z],I===void 0&&(I=this._createVao(w),this.vaoCache[z]=I,A.vaoGPU=I)}const D=e.getIndex(),P=D!==null?this.get(D).bufferGPU:null;h.setVertexState(I,P);const U=m.lastOcclusionObject;if(U!==t&&U!==void 0){if(U!==null&&U.occlusionTest===!0&&(c.endQuery(c.ANY_SAMPLES_PASSED),m.occlusionQueryIndex++),t.occlusionTest===!0){const z=c.createQuery();c.beginQuery(c.ANY_SAMPLES_PASSED,z),m.occlusionQueries[m.occlusionQueryIndex]=z,m.occlusionQueryObjects[m.occlusionQueryIndex]=t}m.lastOcclusionObject=t}const j=this.bufferRenderer;t.isPoints?j.mode=c.POINTS:t.isLineSegments?j.mode=c.LINES:t.isLine?j.mode=c.LINE_STRIP:t.isLineLoop?j.mode=c.LINE_LOOP:r.wireframe===!0?(h.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),j.mode=c.LINES):j.mode=c.TRIANGLES;const{vertexCount:C,instanceCount:Z}=y;let{firstVertex:ie}=y;if(j.object=t,D!==null){ie*=D.array.BYTES_PER_ELEMENT;const z=this.get(D);j.index=D.count,j.type=z.type}else j.index=0;const se=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(es("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),j.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?j.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):es("WebGLBackend: WEBGL_multi_draw not supported."):Z>1?j.renderInstances(ie,C,Z):j.render(ie,C)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const z=this.get(e.camera),re=e.camera.cameras,ye=e.getBindingGroup("cameraIndex").bindings[0];if(z.indexesGPU===void 0||z.indexesGPU.length!==re.length){const ce=new Uint32Array([0,0,0,0]),Ve=[];for(let Pe=0,We=re.length;Pe<We;Pe++){const pt=c.createBuffer();ce[0]=Pe,c.bindBuffer(c.UNIFORM_BUFFER,pt),c.bufferData(c.UNIFORM_BUFFER,ce,c.STATIC_DRAW),Ve.push(pt)}z.indexesGPU=Ve}const H=this.get(ye),Me=this.renderer.getPixelRatio(),Oe=this._currentContext.renderTarget,Ue=this._isRenderCameraDepthArray(this._currentContext),Ie=this._currentContext.activeCubeFace;if(Ue){const ce=this.get(Oe.depthTexture);if(ce.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){ce.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:Ve}=Oe;for(let Pe=0,We=re.length;Pe<We;Pe++)this.renderer._activeCubeFace=Pe,this._currentContext.activeCubeFace=Pe,this._setFramebuffer(this._currentContext),this.clear(!1,!0,Ve,this._currentContext,!1,!1);this.renderer._activeCubeFace=Ie,this._currentContext.activeCubeFace=Ie}}for(let ce=0,Ve=re.length;ce<Ve;ce++){const Pe=re[ce];if(t.layers.test(Pe.layers)){Ue&&(this.renderer._activeCubeFace=ce,this._currentContext.activeCubeFace=ce,this._setFramebuffer(this._currentContext));const We=Pe.viewport;if(We!==void 0){const pt=We.x*Me,Ne=We.y*Me,st=We.width*Me,Pt=We.height*Me;h.viewport(Math.floor(pt),Math.floor(e.context.height-Pt-Ne),Math.floor(st),Math.floor(Pt))}h.bindBufferBase(c.UNIFORM_BUFFER,H.index,z.indexesGPU[ce]),se()}this._currentContext.activeCubeFace=Ie,this.renderer._activeCubeFace=Ie}}else se()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,n,r,i,o){return this.textureUtils.copyTextureToBuffer(e,t,n,r,i,o)}updateSampler(){return""}createNodeBuilder(e,t){return new hst(e,t)}createProgram(e){const t=this.gl,{stage:n,code:r}=e,i=n==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(i,r),t.compileShader(i),this.set(e,{shaderGPU:i})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,r=e.pipeline,{fragmentProgram:i,vertexProgram:o}=r,l=n.createProgram(),c=this.get(i).shaderGPU,h=this.get(o).shaderGPU;if(n.attachShader(l,c),n.attachShader(l,h),n.linkProgram(l),this.set(r,{programGPU:l,fragmentShader:c,vertexShader:h}),t!==null&&this.parallel){const m=new Promise(y=>{const b=this.parallel,w=()=>{n.getProgramParameter(l,b.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),y()):requestAnimationFrame(w)};w()});t.push(m);return}this._completeCompile(e,r)}_handleSource(e,t){const n=e.split(`
`),r=[],i=Math.max(t-6,0),o=Math.min(t+6,n.length);for(let l=i;l<o;l++){const c=l+1;r.push(`${c===t?">":" "} ${c}: ${n[l]}`)}return r.join(`
`)}_getShaderErrors(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),o=(e.getShaderInfoLog(t)||"").trim();if(r&&o==="")return"";const l=/ERROR: 0:(\d+)/.exec(o);if(l){const c=parseInt(l[1]);return n.toUpperCase()+`

`+o+`

`+this._handleSource(e.getShaderSource(t),c)}else return o}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const r=this.gl,o=(r.getProgramInfoLog(e)||"").trim();if(r.getProgramParameter(e,r.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(r,e,n,t);else{const l=this._getShaderErrors(r,n,"vertex"),c=this._getShaderErrors(r,t,"fragment");Ht("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(e,r.VALIDATE_STATUS)+`

Program Info Log: `+o+`
`+l+`
`+c)}else o!==""&&qt("WebGLProgram: Program Info Log:",o)}}_completeCompile(e,t){const{state:n,gl:r}=this,i=this.get(t),{programGPU:o,fragmentShader:l,vertexShader:c}=i;r.getProgramParameter(o,r.LINK_STATUS)===!1&&this._logProgramError(o,l,c),n.useProgram(o);const h=e.getBindings();this._setupBindings(h,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:n,gl:r}=this,i={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(i);const{computeProgram:o}=e,l=r.createProgram(),c=this.get(i).shaderGPU,h=this.get(o).shaderGPU,m=o.transforms,y=[],b=[];for(let D=0;D<m.length;D++){const P=m[D];y.push(P.varyingName),b.push(P.attributeNode)}r.attachShader(l,c),r.attachShader(l,h),r.transformFeedbackVaryings(l,y,r.SEPARATE_ATTRIBS),r.linkProgram(l),r.getProgramParameter(l,r.LINK_STATUS)===!1&&this._logProgramError(l,c,h),n.useProgram(l),this._setupBindings(t,l);const w=o.attributes,A=[],I=[];for(let D=0;D<w.length;D++){const P=w[D].node.attribute;A.push(P),this.has(P)||this.attributeUtils.createAttribute(P,r.ARRAY_BUFFER)}for(let D=0;D<b.length;D++){const P=b[D].attribute;this.has(P)||this.attributeUtils.createAttribute(P,r.ARRAY_BUFFER);const U=this.get(P);I.push(U)}this.set(e,{programGPU:l,transformBuffers:I,attributes:A})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let n=0,r=0;for(const i of t){this.set(i,{textures:r,uniformBuffers:n});for(const o of i.bindings)o.isUniformBuffer&&n++,o.isSampledTexture&&r++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let r=n.uniformBuffers,i=n.textures;for(const o of e.bindings){const l=this.get(o);if(o.isUniformsGroup||o.isUniformBuffer){const c=o.buffer;let{bufferGPU:h}=this.get(c);h===void 0?(h=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,h),t.bufferData(t.UNIFORM_BUFFER,c.byteLength,t.DYNAMIC_DRAW),this.set(c,{bufferGPU:h})):t.bindBuffer(t.UNIFORM_BUFFER,h);const m=o.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,h),m.length===0)t.bufferData(t.UNIFORM_BUFFER,c,t.DYNAMIC_DRAW);else{const y=xA(c),b=y?1:c.BYTES_PER_ELEMENT;for(let w=0,A=m.length;w<A;w++){const I=m[w],D=I.start*b,P=I.count*b,U=D*(y?c.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,U,c,D,P)}}l.index=r++,l.bufferGPU=h,this.set(o,l)}else if(o.isSampledTexture){const{textureGPU:c,glTextureType:h}=this.get(o.texture);l.index=i++,l.textureGPU=c,l.glTextureType=h,this.set(o,l)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const r=this.get(e).bufferGPU,i=e.buffer,o=e.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,r),o.length===0)t.bufferData(t.UNIFORM_BUFFER,i,t.DYNAMIC_DRAW);else{const l=xA(i),c=l?1:i.BYTES_PER_ELEMENT;for(let h=0,m=o.length;h<m;h++){const y=o[h],b=y.start*c,w=y.count*c,A=b*(l?i.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,A,i,b,w)}}}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(E7e).filter(r=>E7e[r]===e),n=this.extensions;for(let r=0;r<t.length;r++)if(n.has(t[r]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,n=null,r=null,i=0,o=0){this.textureUtils.copyTextureToTexture(e,t,n,r,i,o)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}hasCompatibility(e){return e===i5.TEXTURE_COMPARE?!0:super.hasCompatibility(e)}initRenderTarget(e){const{gl:t,state:n}=this;this._setFramebuffer(e),n.bindFramebuffer(t.FRAMEBUFFER,null)}_setFramebuffer(e){const{gl:t,state:n}=this;let r=null;if(e.textures!==null){const i=e.renderTarget,o=this.get(i),{samples:l,depthBuffer:c,stencilBuffer:h}=i,m=i.isCubeRenderTarget===!0,y=i.isRenderTarget3D===!0,b=i.depth>1,w=i.isXRRenderTarget===!0,A=w===!0&&i._hasExternalTextures===!0;let I=o.msaaFrameBuffer,D=o.depthRenderbuffer;const P=this.extensions.get("WEBGL_multisampled_render_to_texture"),U=this.extensions.get("OVR_multiview2"),j=this._useMultisampledExtension(i),C=rMe(e);let Z;if(m?(o.cubeFramebuffers||(o.cubeFramebuffers={}),Z=o.cubeFramebuffers[C]):w&&A===!1?Z=this._xrFramebuffer:(o.framebuffers||(o.framebuffers={}),Z=o.framebuffers[C]),Z===void 0){Z=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,Z);const ie=e.textures,se=[];if(m){o.cubeFramebuffers[C]=Z;const{textureGPU:re}=this.get(ie[0]),ye=this.renderer._activeCubeFace,H=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+ye,re,H)}else{o.framebuffers[C]=Z;for(let re=0;re<ie.length;re++){const ye=ie[re],H=this.get(ye);H.renderTarget=e.renderTarget,H.cacheKey=C;const Me=t.COLOR_ATTACHMENT0+re;if(i.multiview)U.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,Me,H.textureGPU,0,l,0,2);else if(y||b){const Oe=this.renderer._activeCubeFace,Ue=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,Me,H.textureGPU,Ue,Oe)}else if(j)P.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,Me,t.TEXTURE_2D,H.textureGPU,0,l);else{const Oe=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,Me,t.TEXTURE_2D,H.textureGPU,Oe)}}}const z=h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(i._autoAllocateDepthBuffer===!0){const re=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(re,e,0,j),o.xrDepthRenderbuffer=re,se.push(h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,re),t.framebufferRenderbuffer(t.FRAMEBUFFER,z,t.RENDERBUFFER,re)}else if(e.depthTexture!==null){se.push(h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const re=this.get(e.depthTexture);if(re.renderTarget=e.renderTarget,re.cacheKey=C,i.multiview)U.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,z,re.textureGPU,0,l,0,2);else if(A&&j)P.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,z,t.TEXTURE_2D,re.textureGPU,0,l);else if(e.depthTexture.isArrayTexture){const ye=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,z,re.textureGPU,0,ye)}else if(e.depthTexture.isCubeTexture){const ye=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,z,t.TEXTURE_CUBE_MAP_POSITIVE_X+ye,re.textureGPU,0)}else t.framebufferTexture2D(t.FRAMEBUFFER,z,t.TEXTURE_2D,re.textureGPU,0)}o.depthInvalidationArray=se}else{if(this._isRenderCameraDepthArray(e)){n.bindFramebuffer(t.FRAMEBUFFER,Z);const se=this.renderer._activeCubeFace,z=this.get(e.depthTexture),re=h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,re,z.textureGPU,0,se)}if((w||j||i.multiview)&&i._isOpaqueFramebuffer!==!0){n.bindFramebuffer(t.FRAMEBUFFER,Z);const se=this.get(e.textures[0]);i.multiview?U.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,se.textureGPU,0,l,0,2):j?P.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,se.textureGPU,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,se.textureGPU,0);const z=h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(i._autoAllocateDepthBuffer===!0){const re=o.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,re),t.framebufferRenderbuffer(t.FRAMEBUFFER,z,t.RENDERBUFFER,re)}else{const re=this.get(e.depthTexture);i.multiview?U.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,z,re.textureGPU,0,l,0,2):j?P.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,z,t.TEXTURE_2D,re.textureGPU,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,z,t.TEXTURE_2D,re.textureGPU,0)}}}if(l>0&&j===!1&&!i.multiview){if(I===void 0){const ie=[];I=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,I);const se=[],z=e.textures;for(let re=0;re<z.length;re++){se[re]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,se[re]),ie.push(t.COLOR_ATTACHMENT0+re);const ye=e.textures[re],H=this.get(ye);t.renderbufferStorageMultisample(t.RENDERBUFFER,l,H.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+re,t.RENDERBUFFER,se[re])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),o.msaaFrameBuffer=I,o.msaaRenderbuffers=se,c&&D===void 0){D=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(D,e,l),o.depthRenderbuffer=D;const re=h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;ie.push(re)}o.invalidationArray=ie}r=o.msaaFrameBuffer}else r=Z;n.drawBuffers(e,Z)}n.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){const r=this.get(e[n]);t+=":"+r.id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();t.bindVertexArray(n);for(let r=0;r<e.length;r++){const i=e[r],o=this.get(i);t.bindBuffer(t.ARRAY_BUFFER,o.bufferGPU),t.enableVertexAttribArray(r);let l,c;i.isInterleavedBufferAttribute===!0?(l=i.data.stride*o.bytesPerElement,c=i.offset*o.bytesPerElement):(l=0,c=0),o.isInteger?t.vertexAttribIPointer(r,i.itemSize,o.type,l,c):t.vertexAttribPointer(r,i.itemSize,o.type,i.normalized,l,c),i.isInstancedBufferAttribute&&!i.isInterleavedBufferAttribute?t.vertexAttribDivisor(r,i.meshPerAttribute):i.isInterleavedBufferAttribute&&i.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(r,i.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),n}_getTransformFeedback(e){let t="";for(let i=0;i<e.length;i++)t+=":"+e[i].id;let n=this.transformFeedbackCache[t];if(n!==void 0)return n;const{gl:r}=this;n=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n);for(let i=0;i<e.length;i++){const o=e[i];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,i,o.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const r of e)for(const i of r.bindings){const l=this.get(i).index;if(i.isUniformsGroup||i.isUniformBuffer){const c=n.getUniformBlockIndex(t,i.name);n.uniformBlockBinding(t,c,l)}else if(i.isSampledTexture){const c=n.getUniformLocation(t,i.name);n.uniform1i(c,l)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const r of e)for(const i of r.bindings){const o=this.get(i),l=o.index;i.isUniformsGroup||i.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,l,o.bufferGPU):i.isSampledTexture&&n.bindTexture(o.glTextureType,o.textureGPU,t.TEXTURE0+l)}}_resolveRenderTarget(e){const{gl:t,state:n}=this,r=e.renderTarget;if(e.textures!==null&&r){const i=this.get(r);if(r.samples>0&&this._useMultisampledExtension(r)===!1){const o=i.framebuffers[e.getCacheKey()];let l=t.COLOR_BUFFER_BIT;r.resolveDepthBuffer&&(r.depthBuffer&&(l|=t.DEPTH_BUFFER_BIT),r.stencilBuffer&&r.resolveStencilBuffer&&(l|=t.STENCIL_BUFFER_BIT));const c=i.msaaFrameBuffer,h=i.msaaRenderbuffers,m=e.textures,y=m.length>1;if(n.bindFramebuffer(t.READ_FRAMEBUFFER,c),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),y)for(let b=0;b<m.length;b++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+b,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+b,t.TEXTURE_2D,null,0);for(let b=0;b<m.length;b++){if(y){const{textureGPU:w}=this.get(m[b]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,h[b]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,w,0)}if(e.scissor){const{x:w,y:A,width:I,height:D}=e.scissorValue,P=e.height-D-A;t.blitFramebuffer(w,P,w+I,P+D,w,P,w+I,P+D,l,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,l,t.NEAREST)}if(y)for(let b=0;b<m.length;b++){const{textureGPU:w}=this.get(m[b]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+b,t.RENDERBUFFER,h[b]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+b,t.TEXTURE_2D,w,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,i.invalidationArray)}else if(r.resolveDepthBuffer===!1&&i.framebuffers){const o=i.framebuffers[e.getCacheKey()];n.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,i.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const JO={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list"},gg=typeof self<"u"&&self.GPUShaderStage?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},R0={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},du={Store:"store"},Es={Load:"load",Clear:"clear"},C7e={CCW:"ccw",CW:"cw"},A7e={None:"none",Back:"back"},PF={Uint16:"uint16",Uint32:"uint32"},Xe={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},gX={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},cg={Linear:"linear",Nearest:"nearest"},ji={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},_6={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},N7e={None:0,All:15},Ry={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},yX={Storage:"storage",ReadOnlyStorage:"read-only-storage"},vX={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},P7e={NonFiltering:"non-filtering",Comparison:"comparison"},S6={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},R7e={TwoD:"2d",ThreeD:"3d"},Sc={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},wst={All:"all"},eL={Vertex:"vertex",Instance:"instance"},hK={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},I7e={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class Tst extends gCe{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class Est extends hCe{constructor(e,t){super(e,t?t.array:null),this._attribute=t,this.isStorageBuffer=!0}get attribute(){return this._attribute}}let Mst=0;class Cst extends Est{constructor(e,t){super("StorageBuffer_"+Mst++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:F0.READ_WRITE,this.groupNode=t}get attribute(){return this.nodeUniform.value}get buffer(){return this.nodeUniform.value.array}}class Ast extends C5{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4f,
	@location( 0 ) vTex : vec2f,
	@location( 1 ) @interpolate(flat, either) vBaseArrayLayer: u32,
};

@group( 0 ) @binding ( 2 )
var<uniform> flipY: u32;

@vertex
fn mainVS(
		@builtin( vertex_index ) vertexIndex : u32,
		@builtin( instance_index ) instanceIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array(
		vec2f( -1, -1 ),
		vec2f( -1,  3 ),
		vec2f(  3, -1 ),
	);

	let p = pos[ vertexIndex ];
	let mult = select( vec2f( 0.5, -0.5 ), vec2f( 0.5, 0.5 ), flipY != 0 );
	Varys.vTex = p * mult + vec2f( 0.5 );
	Varys.Position = vec4f( p, 0, 1 );
	Varys.vBaseArrayLayer = instanceIndex;

	return Varys;

}

@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img2d : texture_2d<f32>;

@fragment
fn main_2d( Varys: VarysStruct ) -> @location( 0 ) vec4<f32> {

	return textureSample( img2d, imgSampler, Varys.vTex );

}

@group( 0 ) @binding( 1 )
var img2dArray : texture_2d_array<f32>;

@fragment
fn main_2d_array( Varys: VarysStruct ) -> @location( 0 ) vec4<f32> {

	return textureSample( img2dArray, imgSampler, Varys.vTex, Varys.vBaseArrayLayer );

}

const faceMat = array(
  mat3x3f(  0,  0,  -2,  0, -2,   0,  1,  1,   1 ),   // pos-x
  mat3x3f(  0,  0,   2,  0, -2,   0, -1,  1,  -1 ),   // neg-x
  mat3x3f(  2,  0,   0,  0,  0,   2, -1,  1,  -1 ),   // pos-y
  mat3x3f(  2,  0,   0,  0,  0,  -2, -1, -1,   1 ),   // neg-y
  mat3x3f(  2,  0,   0,  0, -2,   0, -1,  1,   1 ),   // pos-z
  mat3x3f( -2,  0,   0,  0, -2,   0,  1,  1,  -1 ),   // neg-z
);

@group( 0 ) @binding( 1 )
var imgCube : texture_cube<f32>;

@fragment
fn main_cube( Varys: VarysStruct ) -> @location( 0 ) vec4<f32> {

	return textureSample( imgCube, imgSampler, faceMat[ Varys.vBaseArrayLayer ] * vec3f( fract( Varys.vTex ), 1 ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:cg.Linear}),this.flipYSampler=e.createSampler({minFilter:cg.Nearest}),this.flipUniformBuffer=e.createBuffer({size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),e.queue.writeBuffer(this.flipUniformBuffer,0,new Uint32Array([1])),this.noFlipUniformBuffer=e.createBuffer({size:4,usage:GPUBufferUsage.UNIFORM}),this.transferPipelines={},this.mipmapShaderModule=e.createShaderModule({label:"mipmap",code:t})}getTransferPipeline(e,t){t=t||"2d-array";const n=`${e}-${t}`;let r=this.transferPipelines[n];return r===void 0&&(r=this.device.createRenderPipeline({label:`mipmap-${e}-${t}`,vertex:{module:this.mipmapShaderModule},fragment:{module:this.mipmapShaderModule,entryPoint:`main_${t.replace("-","_")}`,targets:[{format:e}]},layout:"auto"}),this.transferPipelines[n]=r),r}flipY(e,t,n=0){const r=t.format,{width:i,height:o}=t.size,l=this.device.createTexture({size:{width:i,height:o},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),c=this.getTransferPipeline(r,e.textureBindingViewDimension),h=this.getTransferPipeline(r,l.textureBindingViewDimension),m=this.device.createCommandEncoder({}),y=(b,w,A,I,D,P)=>{const U=b.getBindGroupLayout(0),j=this.device.createBindGroup({layout:U,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:w.createView({dimension:w.textureBindingViewDimension||"2d-array",baseMipLevel:0,mipLevelCount:1})},{binding:2,resource:{buffer:P?this.flipUniformBuffer:this.noFlipUniformBuffer}}]}),C=m.beginRenderPass({colorAttachments:[{view:I.createView({dimension:"2d",baseMipLevel:0,mipLevelCount:1,baseArrayLayer:D,arrayLayerCount:1}),loadOp:Es.Clear,storeOp:du.Store}]});C.setPipeline(b),C.setBindGroup(0,j),C.draw(3,1,0,A),C.end()};y(c,e,n,l,0,!1),y(h,l,0,e,n,!0),this.device.queue.submit([m.finish()]),l.destroy()}generateMipmaps(e,t=null){const n=this.get(e),r=n.layers||this._mipmapCreateBundles(e),i=t||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(i,r),t===null&&this.device.queue.submit([i.finish()]),n.layers=r}_mipmapCreateBundles(e){const t=e.textureBindingViewDimension||"2d-array",n=this.getTransferPipeline(e.format,t),r=n.getBindGroupLayout(0),i=[];for(let o=1;o<e.mipLevelCount;o++)for(let l=0;l<e.depthOrArrayLayers;l++){const c=this.device.createBindGroup({layout:r,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:e.createView({dimension:t,baseMipLevel:o-1,mipLevelCount:1})},{binding:2,resource:{buffer:this.noFlipUniformBuffer}}]}),h={colorAttachments:[{view:e.createView({dimension:"2d",baseMipLevel:o,mipLevelCount:1,baseArrayLayer:l,arrayLayerCount:1}),loadOp:Es.Clear,storeOp:du.Store}]},m=this.device.createRenderBundleEncoder({colorFormats:[e.format]});m.setPipeline(n),m.setBindGroup(0,c),m.draw(3,1,0,l),i.push({renderBundles:[m.finish()],passDescriptor:h})}return i}_mipmapRunBundles(e,t){const n=t.length;for(let r=0;r<n;r++){const i=t[r],o=e.beginRenderPass(i.passDescriptor);o.executeBundles(i.renderBundles),o.end()}}}const Nst={[VK]:"never",[rB]:"less",[GK]:"equal",[mx]:"less-equal",[jK]:"greater",[gx]:"greater-equal",[$K]:"always",[HK]:"not-equal"},Pst=[0,1,3,2,4,5];class Rst{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){const t=this.backend,n=e.minFilter+"-"+e.magFilter+"-"+e.wrapS+"-"+e.wrapT+"-"+(e.wrapR||"0")+"-"+e.anisotropy+"-"+(e.compareFunction||0);let r=this._samplerCache.get(n);if(r===void 0){const o={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};e.isDepthTexture&&e.compareFunction===null&&(o.magFilter=cg.Nearest,o.minFilter=cg.Nearest,o.mipmapFilter=cg.Nearest),o.magFilter===cg.Linear&&o.minFilter===cg.Linear&&o.mipmapFilter===cg.Linear&&(o.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&t.hasCompatibility(i5.TEXTURE_COMPARE)&&(o.compare=Nst[e.compareFunction]),r={sampler:t.device.createSampler(o),usedTimes:0},this._samplerCache.set(n,r)}const i=t.get(e);if(i.sampler!==r.sampler){if(i.sampler!==void 0){const o=this._samplerCache.get(i.samplerKey);o.usedTimes--,o.usedTimes===0&&this._samplerCache.delete(i.samplerKey)}i.samplerKey=n,i.sampler=r.sampler,r.usedTimes++}return n}createDefaultTexture(e){let t;const n=pK(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(n):t=this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e,t={}){const n=this.backend,r=n.get(e);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture){r.texture=e.sourceTexture,r.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:i,height:o,depth:l,levels:c}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const h=this._getDimension(e),m=e.internalFormat||t.format||pK(e,n.device);r.format=m;const{samples:y,primarySamples:b,isMSAA:w}=n.utils.getTextureSampleData(e);let A=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(A|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&m!==Xe.RGB9E5UFloat&&(A|=GPUTextureUsage.RENDER_ATTACHMENT);const I={label:e.name,size:{width:i,height:o,depthOrArrayLayers:l},mipLevelCount:c,sampleCount:b,dimension:h,format:m,usage:A};if(m===void 0){qt("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}e.isCubeTexture&&(I.textureBindingViewDimension=Sc.Cube);try{r.texture=n.device.createTexture(I)}catch{qt("WebGPURenderer: Failed to create texture with descriptor:",I),this.createDefaultTexture(e);return}if(w){const D=Object.assign({},I);D.label=D.label+"-msaa",D.sampleCount=y,D.mipLevelCount=1,r.msaaTexture=n.device.createTexture(D)}r.initialized=!0,r.textureDescriptorGPU=I}destroyTexture(e,t=!1){const n=this.backend,r=n.get(e);r.texture!==void 0&&t===!1&&r.texture.destroy(),r.msaaTexture!==void 0&&r.msaaTexture.destroy(),n.delete(e)}generateMipmaps(e,t=null){const n=this.backend.get(e);this._generateMipmaps(n.texture,t)}getColorBuffer(){const e=this.backend,t=e.renderer.getCanvasTarget(),{width:n,height:r}=e.getDrawingBufferSize(),i=e.renderer.currentSamples,o=t.colorTexture,l=e.get(o);if(o.width===n&&o.height===r&&o.samples===i)return l.texture;let c=l.texture;return c&&c.destroy(),c=e.device.createTexture({label:"colorBuffer",size:{width:n,height:r,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),o.source.width=n,o.source.height=r,o.samples=i,l.texture=c,c}getDepthBuffer(e=!0,t=!1){const n=this.backend,r=n.renderer.getCanvasTarget(),{width:i,height:o}=n.getDrawingBufferSize(),l=n.renderer.currentSamples,c=r.depthTexture;if(c.width===i&&c.height===o&&c.samples===l&&c.depth===e&&c.stencil===t)return n.get(c).texture;const h=n.get(c).texture;let m,y;if(t?(m=_u,y=gh):e&&(m=B0,y=Ds),h!==void 0){if(c.image.width===i&&c.image.height===o&&c.format===m&&c.type===y&&c.samples===l)return h;this.destroyTexture(c)}return c.name="depthBuffer",c.format=m,c.type=y,c.image.width=i,c.image.height=o,c.samples=l,this.createTexture(c,{width:i,height:o}),n.get(c).texture}updateTexture(e,t){const n=this.backend.get(e),r=e.mipmaps,{textureDescriptorGPU:i}=n;if(!(e.isRenderTargetTexture||i===void 0)){if(e.isDataTexture)if(r.length>0)for(let o=0,l=r.length;o<l;o++){const c=r[o];this._copyBufferToTexture(c,n.texture,i,0,e.flipY,0,o)}else this._copyBufferToTexture(t.image,n.texture,i,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let o=0;o<t.image.depth;o++)this._copyBufferToTexture(t.image,n.texture,i,o,e.flipY,o);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,i);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,n.texture,i);else if(r.length>0)for(let o=0,l=r.length;o<l;o++){const c=r[o];this._copyImageToTexture(c,n.texture,i,0,e.flipY,e.premultiplyAlpha,o)}else this._copyImageToTexture(t.image,n.texture,i,0,e.flipY,e.premultiplyAlpha);n.version=e.version}}async copyTextureToBuffer(e,t,n,r,i,o){const l=this.backend.device,c=this.backend.get(e),h=c.texture,m=c.textureDescriptorGPU.format,y=this._getBytesPerTexel(m);let b=r*y;b=Math.ceil(b/256)*256;const w=l.createBuffer({size:(i-1)*b+r*y,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),A=l.createCommandEncoder();A.copyTextureToBuffer({texture:h,origin:{x:t,y:n,z:o}},{buffer:w,bytesPerRow:b},{width:r,height:i});const I=this._getTypedArrayType(m);l.queue.submit([A.finish()]),await w.mapAsync(GPUMapMode.READ);const D=w.getMappedRange();return new I(D)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new ol;n.minFilter=Yi,n.magFilter=Yi,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultCubeTexture[e];if(t===void 0){const n=new yx;n.minFilter=Yi,n.magFilter=Yi,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,n){const r=e.images,i=e.mipmaps;for(let o=0;o<6;o++){const l=r[o],c=e.flipY===!0?Pst[o]:o;l.isDataTexture?this._copyBufferToTexture(l.image,t,n,c,e.flipY):this._copyImageToTexture(l,t,n,c,e.flipY,e.premultiplyAlpha);for(let h=0;h<i.length;h++){const y=i[h].images[o];y.isDataTexture?this._copyBufferToTexture(y.image,t,n,c,e.flipY,0,h+1):this._copyImageToTexture(y,t,n,c,e.flipY,e.premultiplyAlpha,h+1)}}}_copyImageToTexture(e,t,n,r,i,o,l=0){const c=this.backend.device,h=l>0?e.width:n.size.width,m=l>0?e.height:n.size.height;try{c.queue.copyExternalImageToTexture({source:e,flipY:i},{texture:t,mipLevel:l,origin:{x:0,y:0,z:r},premultipliedAlpha:o},{width:h,height:m,depthOrArrayLayers:1})}catch{}}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new Ast(this.backend.device)),e}_generateMipmaps(e,t=null){this._getPassUtils().generateMipmaps(e,t)}_flipY(e,t,n=0){this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,r,i,o=0,l=0){const c=this.backend.device,h=e.data,m=this._getBytesPerTexel(n.format),y=e.width*m;c.queue.writeTexture({texture:t,mipLevel:l,origin:{x:0,y:0,z:r}},h,{offset:e.width*e.height*m*o,bytesPerRow:y},{width:e.width,height:e.height,depthOrArrayLayers:1}),i===!0&&this._flipY(t,n,r)}_copyCompressedBufferToTexture(e,t,n){const r=this.backend.device,i=this._getBlockData(n.format),o=n.size.depthOrArrayLayers>1;for(let l=0;l<e.length;l++){const c=e[l],h=c.width,m=c.height,y=o?n.size.depthOrArrayLayers:1,b=Math.ceil(h/i.width)*i.byteLength,w=b*Math.ceil(m/i.height);for(let A=0;A<y;A++)r.queue.writeTexture({texture:t,mipLevel:l,origin:{x:0,y:0,z:A}},c.data,{offset:A*w,bytesPerRow:b,rowsPerImage:Math.ceil(m/i.height)},{width:Math.ceil(h/i.width)*i.width,height:Math.ceil(m/i.height)*i.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===Xe.BC1RGBAUnorm||e===Xe.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===Xe.BC2RGBAUnorm||e===Xe.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===Xe.BC3RGBAUnorm||e===Xe.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===Xe.BC4RUnorm||e===Xe.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===Xe.BC5RGUnorm||e===Xe.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===Xe.BC6HRGBUFloat||e===Xe.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===Xe.BC7RGBAUnorm||e===Xe.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===Xe.ETC2RGB8Unorm||e===Xe.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===Xe.ETC2RGB8A1Unorm||e===Xe.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===Xe.ETC2RGBA8Unorm||e===Xe.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===Xe.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===Xe.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===Xe.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===Xe.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===Xe.ASTC4x4Unorm||e===Xe.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===Xe.ASTC5x4Unorm||e===Xe.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===Xe.ASTC5x5Unorm||e===Xe.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===Xe.ASTC6x5Unorm||e===Xe.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===Xe.ASTC6x6Unorm||e===Xe.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===Xe.ASTC8x5Unorm||e===Xe.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===Xe.ASTC8x6Unorm||e===Xe.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===Xe.ASTC8x8Unorm||e===Xe.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===Xe.ASTC10x5Unorm||e===Xe.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===Xe.ASTC10x6Unorm||e===Xe.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===Xe.ASTC10x8Unorm||e===Xe.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===Xe.ASTC10x10Unorm||e===Xe.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===Xe.ASTC12x10Unorm||e===Xe.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===Xe.ASTC12x12Unorm||e===Xe.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=gX.ClampToEdge;return e===vh?t=gX.Repeat:e===ox&&(t=gX.MirrorRepeat),t}_convertFilterMode(e){let t=cg.Linear;return(e===Yi||e===BK||e===G3)&&(t=cg.Nearest),t}_getBytesPerTexel(e){if(e===Xe.R8Unorm||e===Xe.R8Snorm||e===Xe.R8Uint||e===Xe.R8Sint)return 1;if(e===Xe.R16Uint||e===Xe.R16Sint||e===Xe.R16Float||e===Xe.RG8Unorm||e===Xe.RG8Snorm||e===Xe.RG8Uint||e===Xe.RG8Sint)return 2;if(e===Xe.R32Uint||e===Xe.R32Sint||e===Xe.R32Float||e===Xe.RG16Uint||e===Xe.RG16Sint||e===Xe.RG16Float||e===Xe.RGBA8Unorm||e===Xe.RGBA8UnormSRGB||e===Xe.RGBA8Snorm||e===Xe.RGBA8Uint||e===Xe.RGBA8Sint||e===Xe.BGRA8Unorm||e===Xe.BGRA8UnormSRGB||e===Xe.RGB9E5UFloat||e===Xe.RGB10A2Unorm||e===Xe.RG11B10UFloat||e===Xe.Depth32Float||e===Xe.Depth24Plus||e===Xe.Depth24PlusStencil8||e===Xe.Depth32FloatStencil8)return 4;if(e===Xe.RG32Uint||e===Xe.RG32Sint||e===Xe.RG32Float||e===Xe.RGBA16Uint||e===Xe.RGBA16Sint||e===Xe.RGBA16Float)return 8;if(e===Xe.RGBA32Uint||e===Xe.RGBA32Sint||e===Xe.RGBA32Float)return 16}_getTypedArrayType(e){if(e===Xe.R8Uint)return Uint8Array;if(e===Xe.R8Sint)return Int8Array;if(e===Xe.R8Unorm)return Uint8Array;if(e===Xe.R8Snorm)return Int8Array;if(e===Xe.RG8Uint)return Uint8Array;if(e===Xe.RG8Sint)return Int8Array;if(e===Xe.RG8Unorm)return Uint8Array;if(e===Xe.RG8Snorm)return Int8Array;if(e===Xe.RGBA8Uint)return Uint8Array;if(e===Xe.RGBA8Sint)return Int8Array;if(e===Xe.RGBA8Unorm||e===Xe.RGBA8UnormSRGB)return Uint8Array;if(e===Xe.RGBA8Snorm)return Int8Array;if(e===Xe.R16Uint)return Uint16Array;if(e===Xe.R16Sint)return Int16Array;if(e===Xe.RG16Uint)return Uint16Array;if(e===Xe.RG16Sint)return Int16Array;if(e===Xe.RGBA16Uint)return Uint16Array;if(e===Xe.RGBA16Sint)return Int16Array;if(e===Xe.R16Float||e===Xe.RG16Float||e===Xe.RGBA16Float)return Uint16Array;if(e===Xe.R32Uint)return Uint32Array;if(e===Xe.R32Sint)return Int32Array;if(e===Xe.R32Float)return Float32Array;if(e===Xe.RG32Uint)return Uint32Array;if(e===Xe.RG32Sint)return Int32Array;if(e===Xe.RG32Float)return Float32Array;if(e===Xe.RGBA32Uint)return Uint32Array;if(e===Xe.RGBA32Sint)return Int32Array;if(e===Xe.RGBA32Float)return Float32Array;if(e===Xe.BGRA8Unorm||e===Xe.BGRA8UnormSRGB)return Uint8Array;if(e===Xe.RGB10A2Unorm||e===Xe.RGB9E5UFloat||e===Xe.RG11B10UFloat)return Uint32Array;if(e===Xe.Depth32Float)return Float32Array;if(e===Xe.Depth24Plus||e===Xe.Depth24PlusStencil8)return Uint32Array;if(e===Xe.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=R7e.ThreeD:t=R7e.TwoD,t}}function pK(s,e=null){const t=s.format,n=s.type,r=s.colorSpace,i=Zn.getTransfer(r);let o;if(s.isCompressedTexture===!0||s.isCompressedArrayTexture===!0)switch(t){case e5:case t5:o=i===Yn?Xe.BC1RGBAUnormSRGB:Xe.BC1RGBAUnorm;break;case n5:o=i===Yn?Xe.BC2RGBAUnormSRGB:Xe.BC2RGBAUnorm;break;case r5:o=i===Yn?Xe.BC3RGBAUnormSRGB:Xe.BC3RGBAUnorm;break;case qS:o=Xe.BC4RUnorm;break;case XS:o=Xe.BC4RSnorm;break;case lx:o=Xe.BC5RGUnorm;break;case YS:o=Xe.BC5RGSnorm;break;case WS:o=i===Yn?Xe.BC7RGBAUnormSRGB:Xe.BC7RGBAUnorm;break;case CS:case MS:o=i===Yn?Xe.ETC2RGB8UnormSRGB:Xe.ETC2RGB8Unorm;break;case AS:o=i===Yn?Xe.ETC2RGBA8UnormSRGB:Xe.ETC2RGBA8Unorm;break;case NS:o=Xe.EACR11Unorm;break;case PS:o=Xe.EACR11Snorm;break;case ax:o=Xe.EACRG11Unorm;break;case RS:o=Xe.EACRG11Snorm;break;case IS:o=i===Yn?Xe.ASTC4x4UnormSRGB:Xe.ASTC4x4Unorm;break;case kS:o=i===Yn?Xe.ASTC5x4UnormSRGB:Xe.ASTC5x4Unorm;break;case DS:o=i===Yn?Xe.ASTC5x5UnormSRGB:Xe.ASTC5x5Unorm;break;case OS:o=i===Yn?Xe.ASTC6x5UnormSRGB:Xe.ASTC6x5Unorm;break;case LS:o=i===Yn?Xe.ASTC6x6UnormSRGB:Xe.ASTC6x6Unorm;break;case FS:o=i===Yn?Xe.ASTC8x5UnormSRGB:Xe.ASTC8x5Unorm;break;case BS:o=i===Yn?Xe.ASTC8x6UnormSRGB:Xe.ASTC8x6Unorm;break;case US:o=i===Yn?Xe.ASTC8x8UnormSRGB:Xe.ASTC8x8Unorm;break;case zS:o=i===Yn?Xe.ASTC10x5UnormSRGB:Xe.ASTC10x5Unorm;break;case VS:o=i===Yn?Xe.ASTC10x6UnormSRGB:Xe.ASTC10x6Unorm;break;case GS:o=i===Yn?Xe.ASTC10x8UnormSRGB:Xe.ASTC10x8Unorm;break;case jS:o=i===Yn?Xe.ASTC10x10UnormSRGB:Xe.ASTC10x10Unorm;break;case HS:o=i===Yn?Xe.ASTC12x10UnormSRGB:Xe.ASTC12x10Unorm;break;case $S:o=i===Yn?Xe.ASTC12x12UnormSRGB:Xe.ASTC12x12Unorm;break;case io:o=i===Yn?Xe.RGBA8UnormSRGB:Xe.RGBA8Unorm;break;default:Ht("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case io:switch(n){case Z6:o=Xe.RGBA8Snorm;break;case Q6:o=Xe.RGBA16Sint;break;case um:o=Xe.RGBA16Uint;break;case Ds:o=Xe.RGBA32Uint;break;case r0:o=Xe.RGBA32Sint;break;case yo:o=i===Yn?Xe.RGBA8UnormSRGB:Xe.RGBA8Unorm;break;case ro:o=Xe.RGBA16Float;break;case vo:o=Xe.RGBA32Float;break;default:Ht("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case qA:switch(n){case tB:o=Xe.RGB9E5UFloat;break;case nB:o=Xe.RG11B10UFloat;break;default:Ht("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case mw:switch(n){case Z6:o=Xe.R8Snorm;break;case Q6:o=Xe.R16Sint;break;case um:o=Xe.R16Uint;break;case Ds:o=Xe.R32Uint;break;case r0:o=Xe.R32Sint;break;case yo:o=Xe.R8Unorm;break;case ro:o=Xe.R16Float;break;case vo:o=Xe.R32Float;break;default:Ht("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case Su:switch(n){case Z6:o=Xe.RG8Snorm;break;case Q6:o=Xe.RG16Sint;break;case um:o=Xe.RG16Uint;break;case Ds:o=Xe.RG32Uint;break;case r0:o=Xe.RG32Sint;break;case yo:o=Xe.RG8Unorm;break;case ro:o=Xe.RG16Float;break;case vo:o=Xe.RG32Float;break;default:Ht("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case B0:switch(n){case um:o=Xe.Depth16Unorm;break;case Ds:o=Xe.Depth24Plus;break;case vo:o=Xe.Depth32Float;break;default:Ht("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case _u:switch(n){case gh:o=Xe.Depth24PlusStencil8;break;case vo:e&&e.features.has(hK.Depth32FloatStencil8)===!1&&Ht('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=Xe.Depth32FloatStencil8;break;default:Ht("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case gw:switch(n){case r0:o=Xe.R32Sint;break;case Ds:o=Xe.R32Uint;break;default:Ht("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case yw:switch(n){case r0:o=Xe.RG32Sint;break;case Ds:o=Xe.RG32Uint;break;default:Ht("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case vw:switch(n){case r0:o=Xe.RGBA32Sint;break;case Ds:o=Xe.RGBA32Uint;break;default:Ht("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:Ht("WebGPURenderer: Unsupported texture format.",t)}return o}const Ist=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,kst=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,k7e={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},Dst=s=>{s=s.trim();const e=s.match(Ist);if(e!==null&&e.length===4){const t=e[2],n=[];let r=null;for(;(r=kst.exec(t))!==null;)n.push({name:r[1],type:r[2]});const i=[];for(let m=0;m<n.length;m++){const{name:y,type:b}=n[m];let w=b;w.startsWith("ptr")?w="pointer":(w.startsWith("texture")&&(w=b.split("<")[0]),w=k7e[w]),i.push(new WQ(w,y))}const o=s.substring(e[0].length),l=e[3]||"void",c=e[1]!==void 0?e[1]:"";return{type:k7e[l]||l,inputs:i,name:c,inputsCode:t,blockCode:o,outputType:l}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class Ost extends XQ{constructor(e){const{type:t,inputs:n,name:r,inputsCode:i,blockCode:o,outputType:l}=Dst(e);super(t,n,r),this.inputsCode=i,this.blockCode=o,this.outputType=l}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class Lst extends lCe{parseFunction(e){return new Ost(e)}}const Fst={[F0.READ_ONLY]:"read",[F0.WRITE_ONLY]:"write",[F0.READ_WRITE]:"read_write"},D7e={[vh]:"repeat",[zo]:"clamp",[ox]:"mirror"},xX={vertex:gg.VERTEX,fragment:gg.FRAGMENT,compute:gg.COMPUTE},O7e={instance:!0,swizzleAssign:!1,storageBuffer:!0},Bst={"^^":"tsl_xor"},Ust={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},L7e={},sC={tsl_xor:new xl("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new xl("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new xl("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new xl("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new xl("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new xl("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new xl("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new xl("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new xl("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new xl("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new xl("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new xl("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new xl(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`),biquadraticTextureArray:new xl(`
fn tsl_biquadraticTexture_array( map : texture_2d_array<f32>, coord : vec2f, iRes : vec2u, layer : u32, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, layer, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, layer, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, layer, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, layer, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},zst={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>",floatpack_snorm_2x16:"pack2x16snorm",floatpack_unorm_2x16:"pack2x16unorm",floatpack_float16_2x16:"pack2x16float",floatunpack_snorm_2x16:"unpack2x16snorm",floatunpack_unorm_2x16:"unpack2x16unorm",floatunpack_float16_2x16:"unpack2x16float"};let bCe="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(bCe+=`diagnostic( off, derivative_uniformity );
`);class Vst extends aCe{constructor(e,t){super(e,t,new Lst),this.uniformGroups={},this.uniformGroupsBindings={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,n,r,i,o=this.shaderStage){return o==="fragment"?r?i?`textureSample( ${t}, ${t}_sampler, ${n}, ${r}, ${i} )`:`textureSample( ${t}, ${t}_sampler, ${n}, ${r} )`:i?`textureSample( ${t}, ${t}_sampler, ${n}, ${i} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this.generateTextureSampleLevel(e,t,n,"0",r)}generateTextureSampleLevel(e,t,n,r,i,o){return this.isUnfilterable(e)===!1?i?o?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${i}, ${r}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${i}, ${r} )`:o?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,o,r,i):this.generateTextureLod(e,t,n,i,o,r)}generateWrapFunction(e){const t=`tsl_coord_${D7e[e.wrapS]}S_${D7e[e.wrapT]}_${e.is3DTexture||e.isData3DTexture?"3d":"2d"}T`;let n=L7e[t];if(n===void 0){const r=[],i=e.is3DTexture||e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${i} ) -> ${i} {

	return ${i}(
`;const l=(c,h)=>{c===vh?(r.push(sC.repeatWrapping_float),o+=`		tsl_repeatWrapping_float( coord.${h} )`):c===zo?(r.push(sC.clampWrapping_float),o+=`		tsl_clampWrapping_float( coord.${h} )`):c===ox?(r.push(sC.mirrorWrapping_float),o+=`		tsl_mirrorWrapping_float( coord.${h} )`):(o+=`		coord.${h}`,qt(`WebGPURenderer: Unsupported texture wrap type "${c}" for vertex shader.`))};l(e.wrapS,"x"),o+=`,
`,l(e.wrapT,"y"),(e.is3DTexture||e.isData3DTexture)&&(o+=`,
`,l(e.wrapR,"z")),o+=`
	);

}
`,L7e[t]=n=new xl(o,r)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){const r=this.getDataFromNode(e,this.shaderStage,this.globalCache);r.dimensionsSnippet===void 0&&(r.dimensionsSnippet={});let i=r.dimensionsSnippet[n];if(r.dimensionsSnippet[n]===void 0){let o,l;const{primarySamples:c}=this.renderer.backend.utils.getTextureSampleData(e),h=c>1;e.is3DTexture||e.isData3DTexture?l="vec3<u32>":l="vec2<u32>",h||e.isStorageTexture?o=t:o=`${t}${n?`, u32( ${n} )`:""}`,i=new qL(new XL(`textureDimensions( ${o} )`,l)),r.dimensionsSnippet[n]=i,(e.isArrayTexture||e.isDataArrayTexture||e.is3DTexture||e.isData3DTexture)&&(r.arrayLayerCount=new qL(new XL(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(r.cubeFaceCount=new qL(new XL("6u","u32")))}return i.build(this)}generateFilteredTexture(e,t,n,r,i="0u",o){const l=this.generateWrapFunction(e),c=this.generateTextureDimension(e,t,i);return r&&(n=`${n} + vec2<f32>(${r}) / ${c}`),o?(this._include("biquadraticTextureArray"),`tsl_biquadraticTexture_array( ${t}, ${l}( ${n} ), ${c}, u32( ${o} ), u32( ${i} ) )`):(this._include("biquadraticTexture"),`tsl_biquadraticTexture( ${t}, ${l}( ${n} ), ${c}, u32( ${i} ) )`)}generateTextureLod(e,t,n,r,i,o="0u"){if(e.isCubeTexture===!0){i&&(n=`${n} + vec3<f32>(${i})`);const w=e.isDepthTexture?"u32":"f32";return`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${w}( ${o} ) )`}const l=this.generateWrapFunction(e),c=this.generateTextureDimension(e,t,o),h=e.is3DTexture||e.isData3DTexture?"vec3":"vec2",m=h==="vec3"?"vec3<u32>( 1, 1, 1 )":"vec2<u32>( 1, 1 )";i&&(n=`${n} + ${h}<f32>(${i}) / ${h}<f32>( ${c} )`);const y=`${h}<f32>( 0 )`,b=`${h}<f32>( ${c} - ${m} )`;return n=`${h}<u32>( clamp( floor( ${l}( ${n} ) * ${h}<f32>( ${c} ) ), ${y}, ${b} ) )`,this.generateTextureLoad(e,t,n,o,r,null)}generateStorageTextureLoad(e,t,n,r,i,o){o&&(n=`${n} + ${o}`);let l;return i?l=`textureLoad( ${t}, ${n}, ${i} )`:l=`textureLoad( ${t}, ${n} )`,l}generateTextureLoad(e,t,n,r,i,o){r===null&&(r="0u"),o&&(n=`${n} + ${o}`);let l;return i?l=`textureLoad( ${t}, ${n}, ${i}, u32( ${r} ) )`:(l=`textureLoad( ${t}, ${n}, u32( ${r} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(l+=".x")),l}generateTextureStore(e,t,n,r,i){let o;return r?o=`textureStore( ${t}, ${n}, ${r}, ${i} )`:o=`textureStore( ${t}, ${n}, ${i} )`,o}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null&&this.renderer.hasCompatibility(i5.TEXTURE_COMPARE)}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===vo||this.isSampleCompare(e)===!1&&e.minFilter===Yi&&e.magFilter===Yi||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,r,i,o=this.shaderStage){let l=null;return this.isUnfilterable(e)?l=this.generateTextureLod(e,t,n,r,i,"0",o):l=this._generateTextureSample(e,t,n,r,i,o),l}generateTextureGrad(e,t,n,r,i,o,l=this.shaderStage){if(l==="fragment")return i?o?`textureSampleGrad( ${t}, ${t}_sampler, ${n}, ${i}, ${r[0]}, ${r[1]}, ${o} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${n}, ${i}, ${r[0]}, ${r[1]} )`:o?`textureSampleGrad( ${t}, ${t}_sampler, ${n}, ${r[0]}, ${r[1]}, ${o} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${n}, ${r[0]}, ${r[1]} )`;Ht(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${l} shader.`)}generateTextureCompare(e,t,n,r,i,o,l=this.shaderStage){if(l==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?o?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${i}, ${r}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${i}, ${r} )`:o?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r} )`;Ht(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${l} shader.`)}generateTextureLevel(e,t,n,r,i,o){return this.isUnfilterable(e)===!1?i?o?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${i}, ${r}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${i}, ${r} )`:o?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,o,r,i):this.generateTextureLod(e,t,n,i,o,r)}generateTextureBias(e,t,n,r,i,o,l=this.shaderStage){if(l==="fragment")return i?o?`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${i}, ${r}, ${o} )`:`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${i}, ${r} )`:o?`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${r}, ${o} )`:`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${r} )`;Ht(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${l} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const n=e.name,r=e.type;return r==="texture"||r==="cubeTexture"||r==="cubeDepthTexture"||r==="storageTexture"||r==="texture3D"?n:r==="buffer"||r==="storageBuffer"||r==="indirectStorageBuffer"?this.isCustomStruct(e)?n:n+".value":e.groupNode.name+"."+n}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=Bst[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?e.isAtomic===!0?(qt("WebGPURenderer: Atomic operations are only supported in compute shaders."),F0.READ_WRITE):F0.READ_ONLY:e.access}getStorageAccess(e,t){return Fst[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n,r=null){const i=super.getUniformFromNode(e,t,n,r),o=this.getDataFromNode(e,n,this.globalCache);if(o.uniformGPU===void 0){let l;const c=e.groupNode,h=c.name,m=this.getBindGroupArray(h,n);if(t==="texture"||t==="cubeTexture"||t==="cubeDepthTexture"||t==="storageTexture"||t==="texture3D"){let y=null;const b=this.getNodeAccess(e,n);if(t==="texture"||t==="storageTexture"?e.value.is3DTexture===!0?y=new dK(i.name,i.node,c,b):y=new FB(i.name,i.node,c,b):t==="cubeTexture"||t==="cubeDepthTexture"?y=new yCe(i.name,i.node,c,b):t==="texture3D"&&(y=new dK(i.name,i.node,c,b)),y.store=e.isStorageTextureNode===!0,y.mipLevel=y.store?e.mipLevel:0,y.setVisibility(xX[n]),e.value.isCubeTexture===!0||this.isUnfilterable(e.value)===!1&&y.store===!1){const A=new Tst(`${i.name}_sampler`,i.node,c);A.setVisibility(xX[n]),m.push(A,y),l=[A,y]}else m.push(y),l=[y]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const y=this.getSharedDataFromNode(e);let b=y.buffer;if(b===void 0){const w=t==="buffer"?fCe:Cst;b=new w(e,c),y.buffer=b}b.setVisibility(b.getVisibility()|xX[n]),m.push(b),l=b,i.name=r||"NodeBuffer_"+i.id}else{let y=this.uniformGroups[h];y===void 0&&(y=new mCe(h,c),y.setVisibility(gg.VERTEX|gg.FRAGMENT|gg.COMPUTE),this.uniformGroups[h]=y),m.indexOf(y)===-1&&m.push(y),l=this.getNodeUniform(i,t);const b=l.name;y.uniforms.some(A=>A.name===b)||y.addUniform(l)}o.uniformGPU=l}return i}getBuiltin(e,t,n,r=this.shaderStage){const i=this.builtins[r]||(this.builtins[r]=new Map);return i.has(e)===!1&&i.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(o.name+" : "+this.getType(o.type));let i=`fn ${t.name}( ${r.join(", ")} ) -> ${this.getType(t.type)} {
${n.vars}
${n.code}
`;return n.result&&(i+=`	return ${n.result};
`),i+=`
}
`,i}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(n!==void 0)for(const r of n)t.push(`enable ${r};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(n!==void 0)for(const{name:r,property:i,type:o}of n.values())t.push(`@builtin( ${r} ) ${i} : ${o}`);return t.join(`,
	`)}getScopedArray(e,t,n,r){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:r}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:n,scope:r,bufferType:i,bufferCount:o}of this.scopedArrays.values()){const l=this.getType(i);t.push(`var<${r}> ${n}: array< ${l}, ${o} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const n=this.getBuiltins("attribute");n&&t.push(n);const r=this.getAttributesArray();for(let i=0,o=r.length;i<o;i++){const l=r[i],c=l.name,h=this.getType(l.type);t.push(`@location( ${i} ) ${c} : ${h}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const n of e.members){const r=e.output?"@location( "+n.index+" ) ":"";let i=this.getType(n.type);n.atomic&&(i="atomic< "+i+" >"),t.push(`	${r+n.name} : ${i}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const r=[];for(const i of n){let o=`struct ${i.name} {
`;o+=this.getStructMembers(i),o+=`
};`,r.push(o)}t=`
`+r.join(`

`)+`
`}return t}getVar(e,t,n=null){let r=`var ${t} : `;return n!==null?r+=this.generateArrayDeclaration(e,n):r+=this.getType(e),r}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const r of n)t.push(`	${this.getVar(r.type,r.name,r.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","builtinClipSpace","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const i=this.varyings,o=this.vars[e];for(let l=0;l<i.length;l++){const c=i[l];if(c.needsInterpolation){let h=`@location( ${l} )`;if(c.interpolationType){const m=c.interpolationSampling!==null?`, ${c.interpolationSampling} )`:" )";h+=` @interpolate( ${c.interpolationType}${m}`}else/^(int|uint|ivec|uvec)/.test(c.type)&&(h+=" @interpolate(flat, either)");t.push(`${h} ${c.name} : ${this.getType(c.type)}`)}else e==="vertex"&&o.includes(c)===!1&&o.push(c)}}const n=this.getBuiltins(e);n&&t.push(n);const r=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+r):r}isCustomStruct(e){const t=e.value,n=e.node,r=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&n.structTypeNode!==null,i=n.value&&n.value.array&&typeof n.value.itemSize=="number"&&n.value.array.length>n.value.itemSize;return r&&!i}getUniforms(e){const t=this.uniforms[e],n=[],r=[],i=[],o={};for(const c of t){const h=c.groupNode.name,m=this.bindingsIndexes[h];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="cubeDepthTexture"||c.type==="storageTexture"||c.type==="texture3D"){const y=c.node.value;(y.isCubeTexture===!0||this.isUnfilterable(y)===!1&&c.node.isStorageTextureNode!==!0)&&(this.isSampleCompare(y)?n.push(`@binding( ${m.binding++} ) @group( ${m.group} ) var ${c.name}_sampler : sampler_comparison;`):n.push(`@binding( ${m.binding++} ) @group( ${m.group} ) var ${c.name}_sampler : sampler;`));let w,A="";const{primarySamples:I}=this.renderer.backend.utils.getTextureSampleData(y);if(I>1&&(A="_multisampled"),y.isCubeTexture===!0&&y.isDepthTexture===!0)w="texture_depth_cube";else if(y.isCubeTexture===!0)w="texture_cube<f32>";else if(y.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&y.compareFunction===null?w=`texture${A}_2d<f32>`:w=`texture_depth${A}_2d${y.isArrayTexture===!0?"_array":""}`;else if(c.node.isStorageTextureNode===!0){const D=pK(y),P=this.getStorageAccess(c.node,e),U=c.node.value.is3DTexture,j=c.node.value.isArrayTexture;w=`texture_storage_${U?"3d":`2d${j?"_array":""}`}<${D}, ${P}>`}else if(y.isArrayTexture===!0||y.isDataArrayTexture===!0||y.isCompressedArrayTexture===!0)w="texture_2d_array<f32>";else if(y.is3DTexture===!0||y.isData3DTexture===!0)w="texture_3d<f32>";else{const D=this.getComponentTypeFromTexture(y).charAt(0);w=`texture${A}_2d<${D}32>`}n.push(`@binding( ${m.binding++} ) @group( ${m.group} ) var ${c.name} : ${w};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const y=c.node,b=this.getType(y.getNodeType(this)),w=y.bufferCount,A=w>0&&c.type==="buffer"?", "+w:"",I=y.isStorageBufferNode?`storage, ${this.getStorageAccess(y,e)}`:"uniform";if(this.isCustomStruct(c))r.push(`@binding( ${m.binding++} ) @group( ${m.group} ) var<${I}> ${c.name} : ${b};`);else{const P=`	value : array< ${y.isAtomic?`atomic<${b}>`:`${b}`}${A} >`;r.push(this._getWGSLStructBinding(c.name,P,I,m.binding++,m.group))}}else{const y=c.groupNode.name;if(o[y]===void 0){const b=this.uniformGroups[y];if(b!==void 0){const w=[];for(const I of b.uniforms){const D=I.getType(),P=this.getType(this.getVectorType(D));w.push(`	${I.name} : ${P}`)}let A=this.uniformGroupsBindings[y];A===void 0&&(A={index:m.binding++,id:m.group},this.uniformGroupsBindings[y]=A),o[y]={index:A.index,id:A.id,snippets:w}}}}}for(const c in o){const h=o[c];i.push(this._getWGSLStructBinding(c,h.snippets.join(`,
`),"uniform",h.index,h.id))}return[...n,...r,...i].join(`
`)}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let r=`// code

`;r+=this.flowCode[t];const i=this.flowNodes[t],o=i[i.length-1],l=o.outputNode,c=l!==void 0&&l.isOutputStructNode===!0;for(const h of i){const m=this.getFlowData(h),y=h.name;if(y&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${y}
`),r+=`${m.code}
	`,h===o&&t!=="compute"){if(r+=`// result

	`,t==="vertex")r+=`varyings.builtinClipSpace = ${m.result};`;else if(t==="fragment")if(c)n.returnType=l.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",r+=`return ${m.result};`;else{let b="	@location(0) color: vec4<f32>";const w=this.getBuiltins("output");w&&(b+=`,
	`+w),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",b),n.structs+=`
var<private> output : OutputStruct;`,r+=`output.color = ${m.result};

	return output;`}}}n.flow=r}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let n;return t!==null&&(n=this._getWGSLMethod(e+"_"+t)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,n){return`select( ${n}, ${t}, ${e} )`}getType(e){return Ust[e]||e}isAvailable(e){let t=O7e[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),O7e[e]=t),t}getUniformBufferLimit(){return this.renderer.backend.device.limits.maxUniformBufferBindingSize}_getWGSLMethod(e){return sC[e]!==void 0&&this._include(e),zst[e]}_include(e){const t=sC[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${bCe}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){const[n,r,i]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${n}, ${r}, ${i} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${n} * numWorkgroups.x )
		+ globalId.z * ( ${n} * numWorkgroups.x ) * ( ${r} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,n,r=0,i=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}
@binding( ${r} ) @group( ${i} )
var<${n}> ${e} : ${o};`}}class Gst{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depth&&(e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.stencil?t=Xe.Depth24PlusStencil8:t=Xe.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const i=this.backend.renderer,o=i.getRenderTarget();t=o?o.samples:i.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorFormats(e){return e.textures!==null?e.textures.map(t=>this.getTextureFormatGPU(t)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return JO.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return JO.LineList;if(e.isLine)return JO.LineStrip;if(e.isMesh)return JO.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const t=this.backend.parameters.outputType;if(t===void 0)return navigator.gpu.getPreferredCanvasFormat();if(t===yo)return Xe.BGRA8Unorm;if(t===ro)return Xe.RGBA16Float;throw new Error("Unsupported output buffer type.")}}const _Ce=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&_Ce.set(Float16Array,["float16"]);const jst=new Map([[W_e,["float16"]]]),Hst=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class $st{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),r=this.backend,i=r.get(n);let o=i.buffer;if(o===void 0){const l=r.device;let c=n.array;if(e.normalized===!1){if(c.constructor===Int16Array||c.constructor===Int8Array)c=new Int32Array(c);else if((c.constructor===Uint16Array||c.constructor===Uint8Array)&&(c=new Uint32Array(c),t&GPUBufferUsage.INDEX))for(let y=0;y<c.length;y++)c[y]===65535&&(c[y]=4294967295)}if(n.array=c,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){c=new c.constructor(n.count*4);for(let y=0;y<n.count;y++)c.set(n.array.subarray(y*3,y*3+3),y*4);n.itemSize=4,n.array=c,i._force3to4BytesAlignment=!0}const h=c.byteLength,m=h+(4-h%4)%4;o=l.createBuffer({label:n.name,size:m,usage:t,mappedAtCreation:!0}),new c.constructor(o.getMappedRange()).set(c),o.unmap(),i.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,r=n.device,i=n.get(t),o=n.get(t).buffer;let l=t.array;if(i._force3to4BytesAlignment===!0){l=new l.constructor(t.count*4);for(let h=0;h<t.count;h++)l.set(t.array.subarray(h*3,h*3+3),h*4);t.array=l}const c=t.updateRanges;if(c.length===0)r.queue.writeBuffer(o,0,l,0);else{const h=xA(l),m=h?1:l.BYTES_PER_ELEMENT;for(let y=0,b=c.length;y<b;y++){const w=c[y];let A,I;if(i._force3to4BytesAlignment===!0){const P=Math.floor(w.start/3),U=Math.ceil(w.count/3);A=P*4*m,I=U*4*m}else A=w.start*m,I=w.count*m;const D=A*(h?l.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(o,D,l,A,I)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let r=0;r<t.length;r++){const i=t[r],o=i.array.BYTES_PER_ELEMENT,l=this._getBufferAttribute(i);let c=n.get(l);if(c===void 0){let y,b;i.isInterleavedBufferAttribute===!0?(y=i.data.stride*o,b=i.data.isInstancedInterleavedBuffer?eL.Instance:eL.Vertex):(y=i.itemSize*o,b=i.isInstancedBufferAttribute?eL.Instance:eL.Vertex),i.normalized===!1&&(i.array.constructor===Int16Array||i.array.constructor===Uint16Array)&&(y=4),c={arrayStride:y,attributes:[],stepMode:b},n.set(l,c)}const h=this._getVertexFormat(i),m=i.isInterleavedBufferAttribute===!0?i.offset*o:0;c.attributes.push({shaderLocation:r,offset:m,format:h})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,i=t.get(this._getBufferAttribute(e)).buffer,o=i.size,l=n.createBuffer({label:`${e.name}_readback`,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),c=n.createCommandEncoder({label:`readback_encoder_${e.name}`});c.copyBufferToBuffer(i,0,l,0,o);const h=c.finish();n.queue.submit([h]),await l.mapAsync(GPUMapMode.READ);const m=l.getMappedRange(),y=new e.array.constructor(m.slice(0));return l.unmap(),y.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,r=e.array.constructor,i=e.constructor;let o;if(t===1)o=Hst.get(r);else{const c=(jst.get(i)||_Ce.get(r))[n?1:0];if(c){const h=r.BYTES_PER_ELEMENT*t,y=Math.floor((h+3)/4)*4/r.BYTES_PER_ELEMENT;if(y%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${c}x${y}`}}return o||Ht("WebGPUAttributeUtils: Vertex format not supported yet."),o}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class Wst{constructor(e){this.layoutGPU=e,this.usedTimes=0}}class qst{constructor(e){this.backend=e,this._bindGroupLayoutCache=new Map}createBindingsLayout(e){const t=this.backend,n=t.device,r=t.get(e);if(r.layout)return r.layout.layoutGPU;const i=this._createLayoutEntries(e),o=Tw(JSON.stringify(i));let l=this._bindGroupLayoutCache.get(o);return l===void 0&&(l=new Wst(n.createBindGroupLayout({entries:i})),this._bindGroupLayoutCache.set(o,l)),l.usedTimes++,r.layout=l,r.layoutKey=o,l.layoutGPU}createBindings(e,t,n,r=0){const{backend:i}=this,o=i.get(e),l=this.createBindingsLayout(e);let c;n>0&&(o.groups===void 0&&(o.groups=[],o.versions=[]),o.versions[n]===r&&(c=o.groups[n])),c===void 0&&(c=this.createBindGroup(e,l),n>0&&(o.groups[n]=c,o.versions[n]=r)),o.group=c}updateBinding(e){const t=this.backend,n=t.device,r=e.buffer,i=t.get(e).buffer,o=e.updateRanges;if(o.length===0)n.queue.writeBuffer(i,0,r,0);else{const l=xA(r),c=l?1:r.BYTES_PER_ELEMENT;for(let h=0,m=o.length;h<m;h++){const y=o[h],b=y.start*c,w=y.count*c,A=b*(l?r.BYTES_PER_ELEMENT:1);n.queue.writeBuffer(i,A,r,b,w)}}}createBindGroupIndex(e,t){const r=this.backend.device,i=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,o=e[0],l=r.createBuffer({label:"bindingCameraIndex_"+o,size:16,usage:i});r.queue.writeBuffer(l,0,e,0);const c=[{binding:0,resource:{buffer:l}}];return r.createBindGroup({label:"bindGroupCameraIndex_"+o,layout:t,entries:c})}createBindGroup(e,t){const n=this.backend,r=n.device;let i=0;const o=[];for(const l of e.bindings){if(l.isUniformBuffer){const c=n.get(l);if(c.buffer===void 0){const h=l.byteLength,m=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,y=[];l.visibility&gg.VERTEX&&y.push("vertex"),l.visibility&gg.FRAGMENT&&y.push("fragment"),l.visibility&gg.COMPUTE&&y.push("compute");const b=`(${y.join(",")})`,w=r.createBuffer({label:`bindingBuffer${l.id}_${l.name}_${b}`,size:h,usage:m});c.buffer=w}o.push({binding:i,resource:{buffer:c.buffer}})}else if(l.isStorageBuffer){const c=n.get(l.attribute).buffer;o.push({binding:i,resource:{buffer:c}})}else if(l.isSampledTexture){const c=n.get(l.texture);let h;if(c.externalTexture!==void 0)h=r.importExternalTexture({source:c.externalTexture});else{const m=l.store?1:c.texture.mipLevelCount,y=l.store?l.mipLevel:0;let b=`view-${c.texture.width}-${c.texture.height}`;if(c.texture.depthOrArrayLayers>1&&(b+=`-${c.texture.depthOrArrayLayers}`),b+=`-${m}-${y}`,h=c[b],h===void 0){const w=wst.All;let A;l.isSampledCubeTexture?A=Sc.Cube:l.isSampledTexture3D?A=Sc.ThreeD:l.texture.isArrayTexture||l.texture.isDataArrayTexture||l.texture.isCompressedArrayTexture?A=Sc.TwoDArray:A=Sc.TwoD,h=c[b]=c.texture.createView({aspect:w,dimension:A,mipLevelCount:m,baseMipLevel:y})}}o.push({binding:i,resource:h})}else if(l.isSampler){const c=n.get(l.texture);o.push({binding:i,resource:c.sampler})}i++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}_createLayoutEntries(e){const t=[];let n=0;for(const r of e.bindings){const i=this.backend,o={binding:n,visibility:r.visibility};if(r.isUniformBuffer||r.isStorageBuffer){const l={};r.isStorageBuffer&&(r.visibility&gg.COMPUTE&&(r.access===F0.READ_WRITE||r.access===F0.WRITE_ONLY)?l.type=yX.Storage:l.type=yX.ReadOnlyStorage),o.buffer=l}else if(r.isSampledTexture&&r.store){const l={};l.format=this.backend.get(r.texture).texture.format;const c=r.access;c===F0.READ_WRITE?l.access=vX.ReadWrite:c===F0.WRITE_ONLY?l.access=vX.WriteOnly:l.access=vX.ReadOnly,r.texture.isArrayTexture?l.viewDimension=Sc.TwoDArray:r.texture.is3DTexture&&(l.viewDimension=Sc.ThreeD),o.storageTexture=l}else if(r.isSampledTexture){const l={},{primarySamples:c}=i.utils.getTextureSampleData(r.texture);if(c>1&&(l.multisampled=!0,r.texture.isDepthTexture||(l.sampleType=S6.UnfilterableFloat)),r.texture.isDepthTexture)i.compatibilityMode&&r.texture.compareFunction===null?l.sampleType=S6.UnfilterableFloat:l.sampleType=S6.Depth;else if(r.texture.isDataTexture||r.texture.isDataArrayTexture||r.texture.isData3DTexture){const h=r.texture.type;h===r0?l.sampleType=S6.SInt:h===Ds?l.sampleType=S6.UInt:h===vo&&(this.backend.hasFeature("float32-filterable")?l.sampleType=S6.Float:l.sampleType=S6.UnfilterableFloat)}r.isSampledCubeTexture?l.viewDimension=Sc.Cube:r.texture.isArrayTexture||r.texture.isDataArrayTexture||r.texture.isCompressedArrayTexture?l.viewDimension=Sc.TwoDArray:r.isSampledTexture3D&&(l.viewDimension=Sc.ThreeD),o.texture=l}else if(r.isSampler){const l={};r.texture.isDepthTexture&&(r.texture.compareFunction!==null&&i.hasCompatibility(i5.TEXTURE_COMPARE)?l.type=P7e.Comparison:l.type=P7e.NonFiltering),o.sampler=l}else Ht(`WebGPUBindingUtils: Unsupported binding "${r}".`);t.push(o),n++}return t}deleteBindGroupData(e){const{backend:t}=this,n=t.get(e);n.layout&&(n.layout.usedTimes--,n.layout.usedTimes===0&&this._bindGroupLayoutCache.delete(n.layoutKey),n.layout=void 0,n.layoutKey=void 0)}dispose(){this._bindGroupLayoutCache.clear()}}class Xst{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:r,geometry:i,pipeline:o}=e,{vertexProgram:l,fragmentProgram:c}=o,h=this.backend,m=h.device,y=h.utils,b=h.get(o),w=[];for(const Oe of e.getBindings()){const Ue=h.get(Oe),{layoutGPU:Ie}=Ue.layout;w.push(Ie)}const A=h.attributeUtils.createShaderVertexBuffers(e);let I;r.blending!==El&&(r.blending!==L0||r.transparent!==!1)&&(I=this._getBlending(r));let D={};r.stencilWrite===!0&&(D={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const P=this._getColorWriteMask(r),U=[];if(e.context.textures!==null){const Oe=e.context.textures,Ue=e.context.mrt;for(let Ie=0;Ie<Oe.length;Ie++){const ce=Oe[Ie],Ve=y.getTextureFormatGPU(ce);let Pe;if(Ue!==null)if(this.backend.compatibilityMode!==!0){const We=Ue.getBlendMode(ce.name);We.blending===PK?Pe=I:We.blending!==El&&(Pe=this._getBlending(We))}else es("WebGPURenderer: Multiple Render Targets (MRT) blending configuration is not fully supported in compatibility mode. The material blending will be used for all render targets."),Pe=I;else Pe=I;U.push({format:Ve,blend:Pe,writeMask:P})}}else{const Oe=y.getCurrentColorFormat(e.context);U.push({format:Oe,blend:I,writeMask:P})}const j=h.get(l).module,C=h.get(c).module,Z=this._getPrimitiveState(n,i,r),ie=this._getDepthCompare(r),se=y.getCurrentDepthStencilFormat(e.context),z=this._getSampleCount(e.context),re={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},j,{buffers:A}),fragment:Object.assign({},C,{targets:U}),primitive:Z,multisample:{count:z,alphaToCoverageEnabled:r.alphaToCoverage&&z>1},layout:m.createPipelineLayout({bindGroupLayouts:w})},ye={},H=e.context.depth,Me=e.context.stencil;if((H===!0||Me===!0)&&(H===!0&&(ye.format=se,ye.depthWriteEnabled=r.depthWrite,ye.depthCompare=ie),Me===!0&&(ye.stencilFront=D,ye.stencilBack=D,ye.stencilReadMask=r.stencilFuncMask,ye.stencilWriteMask=r.stencilWriteMask),r.polygonOffset===!0&&(ye.depthBias=r.polygonOffsetUnits,ye.depthBiasSlopeScale=r.polygonOffsetFactor,ye.depthBiasClamp=0),re.depthStencil=ye),m.pushErrorScope("validation"),t===null)b.pipeline=m.createRenderPipeline(re),m.popErrorScope().then(Oe=>{Oe!==null&&(b.error=!0,Ht(Oe.message))});else{const Oe=new Promise(async Ue=>{try{b.pipeline=await m.createRenderPipelineAsync(re)}catch{}const Ie=await m.popErrorScope();Ie!==null&&(b.error=!0,Ht(Ie.message)),Ue()});t.push(Oe)}}createBundleEncoder(e,t="renderBundleEncoder"){const n=this.backend,{utils:r,device:i}=n,o=r.getCurrentDepthStencilFormat(e),l=r.getCurrentColorFormats(e),c=this._getSampleCount(e),h={label:t,colorFormats:l,depthStencilFormat:o,sampleCount:c};return i.createRenderBundleEncoder(h)}createComputePipeline(e,t){const n=this.backend,r=n.device,i=n.get(e.computeProgram).module,o=n.get(e),l=[];for(const c of t){const h=n.get(c),{layoutGPU:m}=h.layout;l.push(m)}o.pipeline=r.createComputePipeline({compute:i,layout:r.createPipelineLayout({bindGroupLayouts:l})})}_getBlending(e){let t,n;const r=e.blending,i=e.blendSrc,o=e.blendDst,l=e.blendEquation;if(r===Jy){const c=e.blendSrcAlpha!==null?e.blendSrcAlpha:i,h=e.blendDstAlpha!==null?e.blendDstAlpha:o,m=e.blendEquationAlpha!==null?e.blendEquationAlpha:l;t={srcFactor:this._getBlendFactor(i),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(l)},n={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(h),operation:this._getBlendOperation(m)}}else{const c=e.premultipliedAlpha,h=(m,y,b,w)=>{t={srcFactor:m,dstFactor:y,operation:_6.Add},n={srcFactor:b,dstFactor:w,operation:_6.Add}};if(c)switch(r){case L0:h(ji.One,ji.OneMinusSrcAlpha,ji.One,ji.OneMinusSrcAlpha);break;case U3:h(ji.One,ji.One,ji.One,ji.One);break;case z3:h(ji.Zero,ji.OneMinusSrc,ji.Zero,ji.One);break;case V3:h(ji.Dst,ji.OneMinusSrcAlpha,ji.Zero,ji.One);break}else switch(r){case L0:h(ji.SrcAlpha,ji.OneMinusSrcAlpha,ji.One,ji.OneMinusSrcAlpha);break;case U3:h(ji.SrcAlpha,ji.One,ji.One,ji.One);break;case z3:Ht(`WebGPURenderer: "SubtractiveBlending" requires "${e.isMaterial?"material":"blendMode"}.premultipliedAlpha = true".`);break;case V3:Ht(`WebGPURenderer: "MultiplyBlending" requires "${e.isMaterial?"material":"blendMode"}.premultipliedAlpha = true".`);break}}if(t!==void 0&&n!==void 0)return{color:t,alpha:n};Ht("WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(e){let t;switch(e){case im:t=ji.Zero;break;case UA:t=ji.One;break;case zA:t=ji.Src;break;case VA:t=ji.OneMinusSrc;break;case h5:t=ji.SrcAlpha;break;case p5:t=ji.OneMinusSrcAlpha;break;case HA:t=ji.Dst;break;case $A:t=ji.OneMinusDst;break;case GA:t=ji.DstAlpha;break;case jA:t=ji.OneMinusDstAlpha;break;case WF:t=ji.SrcAlphaSaturated;break;case QQe:t=ji.Constant;break;case JQe:t=ji.OneMinusConstant;break;default:Ht("WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const n=e.stencilFunc;switch(n){case gVe:t=R0.Never;break;case CY:t=R0.Always;break;case yVe:t=R0.Less;break;case xVe:t=R0.LessEqual;break;case vVe:t=R0.Equal;break;case SVe:t=R0.GreaterEqual;break;case bVe:t=R0.Greater;break;case _Ve:t=R0.NotEqual;break;default:Ht("WebGPURenderer: Invalid stencil function.",n)}return t}_getStencilOperation(e){let t;switch(e){case R6:t=Ry.Keep;break;case cVe:t=Ry.Zero;break;case uVe:t=Ry.Replace;break;case mVe:t=Ry.Invert;break;case dVe:t=Ry.IncrementClamp;break;case hVe:t=Ry.DecrementClamp;break;case pVe:t=Ry.IncrementWrap;break;case fVe:t=Ry.DecrementWrap;break;default:Ht("WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case i0:t=_6.Add;break;case HF:t=_6.Subtract;break;case $F:t=_6.ReverseSubtract;break;case RK:t=_6.Min;break;case IK:t=_6.Max;break;default:Ht("WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,n){const r={},i=this.backend.utils;r.topology=i.getPrimitiveTopology(e,n),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?PF.Uint16:PF.Uint32);let o=n.side===bs;return e.isMesh&&e.matrixWorld.determinant()<0&&(o=!o),r.frontFace=o===!0?C7e.CW:C7e.CCW,r.cullMode=n.side===oa?A7e.None:A7e.Back,r}_getColorWriteMask(e){return e.colorWrite===!0?N7e.All:N7e.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=R0.Always;else{const n=this.backend.parameters.reversedDepthBuffer?WK[e.depthFunc]:e.depthFunc;switch(n){case aA:t=R0.Never;break;case lA:t=R0.Always;break;case cA:t=R0.Less;break;case f5:t=R0.LessEqual;break;case uA:t=R0.Equal;break;case dA:t=R0.GreaterEqual;break;case hA:t=R0.Greater;break;case pA:t=R0.NotEqual;break;default:Ht("WebGPUPipelineUtils: Invalid depth function.",n)}}return t}}class Yst extends xCe{constructor(e,t,n=2048){super(n),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const r=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return es(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const r=this.device.createCommandEncoder();r.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),r.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const i=r.finish();if(this.device.queue.submit([i]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const o=new BigUint64Array(this.resultBuffer.getMappedRange(0,n)),l={},c=[];for(const[m,y]of e){const b=m.match(/^(.*):f(\d+)$/),w=parseInt(b[2]);c.includes(w)===!1&&c.push(w),l[w]===void 0&&(l[w]=0);const A=o[y],I=o[y+1],D=Number(I-A)/1e6;this.timestamps.set(m,D),l[w]+=D}const h=l[c[c.length-1]];return this.resultBuffer.unmap(),this.lastValue=h,this.frames=c,h}catch(e){return Ht("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){Ht("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){Ht("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class Kst extends vCe{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=null,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new Gst(this),this.attributeUtils=new $st(this),this.bindingUtils=new qst(this),this.pipelineUtils=new Xst(this),this.textureUtils=new Rst(this),this.occludedResolveCache=new Map;const t=typeof navigator>"u"?!0:/Android/.test(navigator.userAgent)===!1;this._compatibility={[i5.TEXTURE_COMPARE]:t}}async init(e){await super.init(e);const t=this.parameters;let n;if(t.device===void 0){const r={powerPreference:t.powerPreference,featureLevel:"compatibility"},i=typeof navigator<"u"?await navigator.gpu.requestAdapter(r):null;if(i===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const o=Object.values(hK),l=[];for(const h of o)i.features.has(h)&&l.push(h);const c={requiredFeatures:l,requiredLimits:t.requiredLimits};n=await i.requestDevice(c)}else n=t.device;this.compatibilityMode=!n.features.has("core-features-and-limits"),this.compatibilityMode&&(e._samples=0),n.lost.then(r=>{if(r.reason==="destroyed")return;const i={api:"WebGPU",message:r.message||"Unknown reason",reason:r.reason||null,originalEvent:r};e.onDeviceLost(i)}),this.device=n,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(hK.TimestampQuery),this.updateSize()}get context(){const e=this.renderer.getCanvasTarget(),t=this.get(e);let n=t.context;if(n===void 0){const r=this.parameters;e.isDefaultCanvasTarget===!0&&r.context!==void 0?n=r.context:n=e.domElement.getContext("webgpu"),"setAttribute"in e.domElement&&e.domElement.setAttribute("data-engine",`three.js r${fx} webgpu`);const i=r.alpha?"premultiplied":"opaque",o=r.outputType===ro?"extended":"standard";n.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:i,toneMapping:{mode:o}}),t.context=n}return n}get coordinateSystem(){return xh}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const e=this.renderer,t=e.getCanvasTarget(),n=this.get(t),r=e.currentSamples;let i=n.descriptor;if(i===void 0||n.samples!==r){i={colorAttachments:[{view:null}]},(e.depth===!0||e.stencil===!0)&&(i.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const l=i.colorAttachments[0];r>0?l.view=this.textureUtils.getColorBuffer().createView():l.resolveTarget=void 0,n.descriptor=i,n.samples=r}const o=i.colorAttachments[0];return r>0?o.resolveTarget=this.context.getCurrentTexture().createView():o.view=this.context.getCurrentTexture().createView(),i}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const n=e.renderTarget,r=this.get(n);let i=r.descriptors;(i===void 0||r.width!==n.width||r.height!==n.height||r.samples!==n.samples)&&(i={},r.descriptors=i);const o=e.getCacheKey();let l=i[o];if(l===void 0){const h=e.textures,m=[];let y;const b=this._isRenderCameraDepthArray(e);for(let w=0;w<h.length;w++){const A=this.get(h[w]),I={label:`colorAttachment_${w}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:Sc.TwoD};if(n.isRenderTarget3D)y=e.activeCubeFace,I.baseArrayLayer=0,I.dimension=Sc.ThreeD,I.depthOrArrayLayers=h[w].image.depth;else if(n.isRenderTarget&&h[w].image.depth>1)if(b===!0){const D=e.camera.cameras;for(let P=0;P<D.length;P++){const U={...I,baseArrayLayer:P,arrayLayerCount:1,dimension:Sc.TwoD},j=A.texture.createView(U);m.push({view:j,resolveTarget:void 0,depthSlice:void 0})}}else I.dimension=Sc.TwoDArray,I.depthOrArrayLayers=h[w].image.depth;if(b!==!0){const D=A.texture.createView(I);let P,U;A.msaaTexture!==void 0?(P=A.msaaTexture.createView(),U=D):(P=D,U=void 0),m.push({view:P,resolveTarget:U,depthSlice:y})}}if(l={textureViews:m},e.depth){const w=this.get(e.depthTexture),A={};(e.depthTexture.isArrayTexture||e.depthTexture.isCubeTexture)&&(A.dimension=Sc.TwoD,A.arrayLayerCount=1,A.baseArrayLayer=e.activeCubeFace),l.depthStencilView=w.texture.createView(A)}i[o]=l,r.width=n.width,r.height=n.height,r.samples=n.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace}const c={colorAttachments:[]};for(let h=0;h<l.textureViews.length;h++){const m=l.textureViews[h];let y={r:0,g:0,b:0,a:1};h===0&&t.clearValue&&(y=t.clearValue),c.colorAttachments.push({view:m.view,depthSlice:m.depthSlice,resolveTarget:m.resolveTarget,loadOp:t.loadOp||Es.Load,storeOp:t.storeOp||du.Store,clearValue:y})}return l.depthStencilView&&(c.depthStencilAttachment={view:l.depthStencilView}),c}beginRender(e){const t=this.get(e),n=this.device,r=e.occlusionQueryCount;let i;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,i=n.createQuerySet({type:"occlusion",count:r,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=i,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(r),t.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e,{loadOp:Es.Load}),this.initTimestampQuery(md.RENDER,this.getTimestampUID(e),o),o.occlusionQuerySet=i;const l=o.depthStencilAttachment;if(e.textures!==null){const h=o.colorAttachments;for(let m=0;m<h.length;m++){const y=h[m];e.clearColor?(y.clearValue=m===0?e.clearColorValue:{r:0,g:0,b:0,a:1},y.loadOp=Es.Clear):y.loadOp=Es.Load,y.storeOp=du.Store}}else{const h=o.colorAttachments[0];e.clearColor?(h.clearValue=e.clearColorValue,h.loadOp=Es.Clear):h.loadOp=Es.Load,h.storeOp=du.Store}e.depth&&(e.clearDepth?(l.depthClearValue=e.clearDepthValue,l.depthLoadOp=Es.Clear):l.depthLoadOp=Es.Load,l.depthStoreOp=du.Store),e.stencil&&(e.clearStencil?(l.stencilClearValue=e.clearStencilValue,l.stencilLoadOp=Es.Clear):l.stencilLoadOp=Es.Load,l.stencilStoreOp=du.Store);const c=n.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const h=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==h.length?this._createDepthLayerDescriptors(e,t,o,h):this._updateDepthLayerDescriptors(e,t,h),t.bundleEncoders=[],t.bundleSets=[];for(let m=0;m<h.length;m++){const y=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+m),b={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(y),t.bundleSets.push(b)}t.currentPass=null}else{const h=c.beginRenderPass(o);t.currentPass=h,e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}t.descriptor=o,t.encoder=c,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,n,r){const i=n.depthStencilAttachment;t.layerDescriptors=[];const o=this.get(e.depthTexture);o.viewCache||(o.viewCache=[]);for(let l=0;l<r.length;l++){const c={...n,colorAttachments:[{...n.colorAttachments[0],view:n.colorAttachments[l].view}]};if(n.depthStencilAttachment){const h=l;o.viewCache[h]||(o.viewCache[h]=o.texture.createView({dimension:Sc.TwoD,baseArrayLayer:l,arrayLayerCount:1})),c.depthStencilAttachment={view:o.viewCache[h],depthLoadOp:i.depthLoadOp||Es.Clear,depthStoreOp:i.depthStoreOp||du.Store,depthClearValue:i.depthClearValue||1},e.stencil&&(c.depthStencilAttachment.stencilLoadOp=i.stencilLoadOp,c.depthStencilAttachment.stencilStoreOp=i.stencilStoreOp,c.depthStencilAttachment.stencilClearValue=i.stencilClearValue)}else c.depthStencilAttachment={...i};t.layerDescriptors.push(c)}}_updateDepthLayerDescriptors(e,t,n){for(let r=0;r<n.length;r++){const i=t.layerDescriptors[r];if(i.depthStencilAttachment){const o=i.depthStencilAttachment;e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=Es.Clear):o.depthLoadOp=Es.Load),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=Es.Clear):o.stencilLoadOp=Es.Load)}}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const r=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const i=[];for(let o=0;o<t.bundleEncoders.length;o++){const l=t.bundleEncoders[o];i.push(l.finish())}for(let o=0;o<t.layerDescriptors.length;o++)if(o<i.length){const l=t.layerDescriptors[o],c=r.beginRenderPass(l);if(e.viewport){const{x:h,y:m,width:y,height:b,minDepth:w,maxDepth:A}=e.viewportValue;c.setViewport(h,m,y,b,w,A)}if(e.scissor){const{x:h,y:m,width:y,height:b}=e.scissorValue;c.setScissorRect(h,m,y,b)}c.executeBundles([i[o]]),c.end()}}else t.currentPass&&t.currentPass.end();if(n>0){const i=n*8;let o=this.occludedResolveCache.get(i);o===void 0&&(o=this.device.createBuffer({size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(i,o));const l=this.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,o,0),t.encoder.copyBufferToBuffer(o,0,l,0,i),t.occlusionQueryBuffer=l,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const i=e.textures;for(let o=0;o<i.length;o++){const l=i[o];l.generateMipmaps===!0&&this.textureUtils.generateMipmaps(l)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const i=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const o=n.getMappedRange(),l=new BigUint64Array(o);for(let c=0;c<r.length;c++)l[c]===BigInt(0)&&i.add(r[c]);n.destroy(),t.occluded=i}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:r,width:i,height:o,minDepth:l,maxDepth:c}=e.viewportValue;t.setViewport(n,r,i,o,l,c)}updateScissor(e){const{currentPass:t}=this.get(e),{x:n,y:r,width:i,height:o}=e.scissorValue;t.setScissorRect(n,r,i,o)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n,r=null){const i=this.device,o=this.renderer;let l=[],c,h,m,y;if(e){const A=this.getClearColor();h={r:A.r,g:A.g,b:A.b,a:A.a}}if(r===null){m=o.depth,y=o.stencil;const A=this._getDefaultRenderPassDescriptor();if(e){l=A.colorAttachments;const I=l[0];I.clearValue=h,I.loadOp=Es.Clear,I.storeOp=du.Store}(m||y)&&(c=A.depthStencilAttachment)}else{m=r.depth,y=r.stencil;const A={loadOp:e?Es.Clear:Es.Load,clearValue:e?h:void 0};m&&(A.depthLoadOp=t?Es.Clear:Es.Load,A.depthClearValue=t?o.getClearDepth():void 0,A.depthStoreOp=du.Store),y&&(A.stencilLoadOp=n?Es.Clear:Es.Load,A.stencilClearValue=n?o.getClearStencil():void 0,A.stencilStoreOp=du.Store);const I=this._getRenderPassDescriptor(r,A);l=I.colorAttachments,c=I.depthStencilAttachment}m&&c&&(t?(c.depthLoadOp=Es.Clear,c.depthClearValue=o.getClearDepth(),c.depthStoreOp=du.Store):(c.depthLoadOp=Es.Load,c.depthStoreOp=du.Store)),y&&c&&(n?(c.stencilLoadOp=Es.Clear,c.stencilClearValue=o.getClearStencil(),c.stencilStoreOp=du.Store):(c.stencilLoadOp=Es.Load,c.stencilStoreOp=du.Store));const b=i.createCommandEncoder({label:"clear"});b.beginRenderPass({colorAttachments:l,depthStencilAttachment:c}).end(),i.queue.submit([b.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(md.COMPUTE,this.getTimestampUID(e),n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,r,i=null){const o=this.get(t),{passEncoderGPU:l}=this.get(e),c=this.get(r).pipeline;this.pipelineUtils.setPipeline(l,c);for(let h=0,m=n.length;h<m;h++){const y=n[h],b=this.get(y);l.setBindGroup(h,b.group)}if(i===null&&(i=t.count),i&&typeof i=="object"&&i.isIndirectStorageBufferAttribute){const h=this.get(i).buffer;l.dispatchWorkgroupsIndirect(h,0);return}if(typeof i=="number"){const h=i;if(o.dispatchSize===void 0||o.count!==h){o.dispatchSize=[0,1,1],o.count=h;const m=t.workgroupSize;let y=m[0];for(let A=1;A<m.length;A++)y*=m[A];const b=Math.ceil(h/y),w=this.device.limits.maxComputeWorkgroupsPerDimension;i=[b,1,1],b>w&&(i[0]=Math.min(b,w),i[1]=Math.ceil(b/w)),o.dispatchSize=i}i=o.dispatchSize}l.dispatchWorkgroups(i[0],i[1]||1,i[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){const{object:n,material:r,context:i,pipeline:o}=e,l=e.getBindings(),c=this.get(i),h=this.get(o),m=h.pipeline;if(h.error===!0)return;const y=e.getIndex(),b=y!==null,w=e.getDrawParameters();if(w===null)return;const A=(D,P)=>{this.pipelineUtils.setPipeline(D,m),P.pipeline=m;const U=P.bindingGroups;for(let C=0,Z=l.length;C<Z;C++){const ie=l[C],se=this.get(ie);U[ie.index]!==ie.id&&(D.setBindGroup(ie.index,se.group),U[ie.index]=ie.id)}if(b===!0&&P.index!==y){const C=this.get(y).buffer,Z=y.array instanceof Uint16Array?PF.Uint16:PF.Uint32;D.setIndexBuffer(C,Z),P.index=y}const j=e.getVertexBuffers();for(let C=0,Z=j.length;C<Z;C++){const ie=j[C];if(P.attributes[C]!==ie){const se=this.get(ie).buffer;D.setVertexBuffer(C,se),P.attributes[C]=ie}}i.stencil===!0&&r.stencilWrite===!0&&c.currentStencilRef!==r.stencilRef&&(D.setStencilReference(r.stencilRef),c.currentStencilRef=r.stencilRef)},I=(D,P)=>{if(A(D,P),n.isBatchedMesh===!0){const U=n._multiDrawStarts,j=n._multiDrawCounts,C=n._multiDrawCount,Z=n._multiDrawInstances;Z!==null&&es("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");let ie=b===!0?y.array.BYTES_PER_ELEMENT:1;r.wireframe&&(ie=n.geometry.attributes.position.count>65535?4:2);for(let se=0;se<C;se++){const z=Z?Z[se]:1,re=z>1?0:se;b===!0?D.drawIndexed(j[se],z,U[se]/ie,0,re):D.draw(j[se],z,U[se],re),t.update(n,j[se],z)}}else if(b===!0){const{vertexCount:U,instanceCount:j,firstVertex:C}=w,Z=e.getIndirect();if(Z!==null){const ie=this.get(Z).buffer,se=e.getIndirectOffset(),z=Array.isArray(se)?se:[se];for(let re=0;re<z.length;re++)D.drawIndexedIndirect(ie,z[re])}else D.drawIndexed(U,j,C,0,0);t.update(n,U,j)}else{const{vertexCount:U,instanceCount:j,firstVertex:C}=w,Z=e.getIndirect();if(Z!==null){const ie=this.get(Z).buffer,se=e.getIndirectOffset(),z=Array.isArray(se)?se:[se];for(let re=0;re<z.length;re++)D.drawIndirect(ie,z[re])}else D.draw(U,j,C,0);t.update(n,U,j)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const D=this.get(e.camera),P=e.camera.cameras,U=e.getBindingGroup("cameraIndex");if(D.indexesGPU===void 0||D.indexesGPU.length!==P.length){const C=this.get(U),Z=[],ie=new Uint32Array([0,0,0,0]);for(let se=0,z=P.length;se<z;se++){ie[0]=se;const{layoutGPU:re}=C.layout,ye=this.bindingUtils.createBindGroupIndex(ie,re);Z.push(ye)}D.indexesGPU=Z}const j=this.renderer.getPixelRatio();for(let C=0,Z=P.length;C<Z;C++){const ie=P[C];if(n.layers.test(ie.layers)){const se=ie.viewport;let z=c.currentPass,re=c.currentSets;if(c.bundleEncoders){const ye=c.bundleEncoders[C],H=c.bundleSets[C];z=ye,re=H}se&&z.setViewport(Math.floor(se.x*j),Math.floor(se.y*j),Math.floor(se.width*j),Math.floor(se.height*j),i.viewportValue.minDepth,i.viewportValue.maxDepth),U&&D.indexesGPU&&(z.setBindGroup(U.index,D.indexesGPU[C]),re.bindingGroups[U.index]=U.id),I(z,re)}}}else if(c.currentPass){if(c.occlusionQuerySet!==void 0){const D=c.lastOcclusionObject;D!==n&&(D!==null&&D.occlusionTest===!0&&(c.currentPass.endOcclusionQuery(),c.occlusionQueryIndex++),n.occlusionTest===!0&&(c.currentPass.beginOcclusionQuery(c.occlusionQueryIndex),c.occlusionQueryObjects[c.occlusionQueryIndex]=n),c.lastOcclusionObject=n)}I(c.currentPass,c.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:n,material:r}=e,i=this.utils,o=i.getSampleCountRenderContext(e.context),l=i.getCurrentColorSpace(e.context),c=i.getCurrentColorFormat(e.context),h=i.getCurrentDepthStencilFormat(e.context),m=i.getPrimitiveTopology(n,r);let y=!1;return(t.material!==r||t.materialVersion!==r.version||t.transparent!==r.transparent||t.blending!==r.blending||t.premultipliedAlpha!==r.premultipliedAlpha||t.blendSrc!==r.blendSrc||t.blendDst!==r.blendDst||t.blendEquation!==r.blendEquation||t.blendSrcAlpha!==r.blendSrcAlpha||t.blendDstAlpha!==r.blendDstAlpha||t.blendEquationAlpha!==r.blendEquationAlpha||t.colorWrite!==r.colorWrite||t.depthWrite!==r.depthWrite||t.depthTest!==r.depthTest||t.depthFunc!==r.depthFunc||t.stencilWrite!==r.stencilWrite||t.stencilFunc!==r.stencilFunc||t.stencilFail!==r.stencilFail||t.stencilZFail!==r.stencilZFail||t.stencilZPass!==r.stencilZPass||t.stencilFuncMask!==r.stencilFuncMask||t.stencilWriteMask!==r.stencilWriteMask||t.side!==r.side||t.alphaToCoverage!==r.alphaToCoverage||t.sampleCount!==o||t.colorSpace!==l||t.colorFormat!==c||t.depthStencilFormat!==h||t.primitiveTopology!==m||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=o,t.colorSpace=l,t.colorFormat=c,t.depthStencilFormat=h,t.primitiveTopology=m,t.clippingContextCacheKey=e.clippingContextCacheKey,y=!0),y}getRenderCacheKey(e){const{object:t,material:n}=e,r=this.utils,i=e.context,o=t.isMesh&&t.matrixWorld.determinant()<0;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,o,r.getSampleCountRenderContext(i),r.getCurrentColorSpace(i),r.getCurrentColorFormat(i),r.getCurrentDepthStencilFormat(i),r.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,n,r,i,o){return this.textureUtils.copyTextureToBuffer(e,t,n,r,i,o)}initTimestampQuery(e,t,n){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new Yst(this.device,e,2048));const r=this.timestampQueryPool[e],i=r.allocateQueriesForContext(t);n.timestampWrites={querySet:r.querySet,beginningOfPassWriteIndex:i,endOfPassWriteIndex:i+1}}createNodeBuilder(e,t){return new Vst(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),i=n.currentPass.finish();this.get(t).bundleGPU=i,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}deleteBindGroupData(e){this.bindingUtils.deleteBindGroupData(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return I7e[e]!==void 0&&(e=I7e[e]),this.device.features.has(e)}copyTextureToTexture(e,t,n=null,r=null,i=0,o=0){let l=0,c=0,h=0,m=0,y=0,b=0,w=e.image.width,A=e.image.height,I=1;n!==null&&(n.isBox3===!0?(m=n.min.x,y=n.min.y,b=n.min.z,w=n.max.x-n.min.x,A=n.max.y-n.min.y,I=n.max.z-n.min.z):(m=n.min.x,y=n.min.y,w=n.max.x-n.min.x,A=n.max.y-n.min.y,I=1)),r!==null&&(l=r.x,c=r.y,h=r.z||0);const D=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),P=this.get(e).texture,U=this.get(t).texture;D.copyTextureToTexture({texture:P,mipLevel:i,origin:{x:m,y,z:b}},{texture:U,mipLevel:o,origin:{x:l,y:c,z:h}},[w,A,I]),this.device.queue.submit([D.finish()]),o===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,n){const r=this.get(t);let i=null;t.renderTarget?e.isDepthTexture?i=this.get(t.depthTexture).texture:i=this.get(t.textures[0]).texture:e.isDepthTexture?i=this.textureUtils.getDepthBuffer(t.depth,t.stencil):i=this.context.getCurrentTexture();const o=this.get(e).texture;if(i.format!==o.format){Ht("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",i.format,o.format);return}let l;if(r.currentPass?(r.currentPass.end(),l=r.encoder):l=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),l.copyTextureToTexture({texture:i,origin:[n.x,n.y,0]},{texture:o},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,l),r.currentPass){const{descriptor:c}=r;for(let h=0;h<c.colorAttachments.length;h++)c.colorAttachments[h].loadOp=Es.Load;t.depth&&(c.depthStencilAttachment.depthLoadOp=Es.Load),t.stencil&&(c.depthStencilAttachment.stencilLoadOp=Es.Load),r.currentPass=l.beginRenderPass(c),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([l.finish()])}hasCompatibility(e){return this._compatibility[i5.TEXTURE_COMPARE]!==void 0?this._compatibility[i5.TEXTURE_COMPARE]:super.hasCompatibility(e)}dispose(){if(this.bindingUtils.dispose(),this.textureUtils.dispose(),this.occludedResolveCache){for(const e of this.occludedResolveCache.values())e.destroy();this.occludedResolveCache.clear()}if(this.timestampQueryPool)for(const e of Object.values(this.timestampQueryPool))e!==null&&e.dispose();this.parameters.device===void 0&&this.device!==null&&this.device.destroy()}}class Zst extends Sw{constructor(e,t,n,r,i,o){super(e,t,n,r,i,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class Qst extends Sw{constructor(e,t,n,r,i,o){super(e,t,n,r,i,o),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class Jst extends cCe{constructor(){super(),this.addMaterial(VZe,"MeshPhongMaterial"),this.addMaterial(CQ,"MeshStandardMaterial"),this.addMaterial(RQe,"MeshPhysicalMaterial"),this.addMaterial(OQe,"MeshToonMaterial"),this.addMaterial(DZe,"MeshBasicMaterial"),this.addMaterial(UZe,"MeshLambertMaterial"),this.addMaterial(OEe,"MeshNormalMaterial"),this.addMaterial(FQe,"MeshMatcapMaterial"),this.addMaterial(MZe,"LineBasicMaterial"),this.addMaterial(AZe,"LineDashedMaterial"),this.addMaterial(GQe,"PointsMaterial"),this.addMaterial(JEe,"SpriteMaterial"),this.addMaterial(WQe,"ShadowMaterial"),this.addLight(vnt,dF),this.addLight(Pit,QA),this.addLight(Lit,fSe),this.addLight(qQ,Sw),this.addLight(Nit,pSe),this.addLight(Rit,hSe),this.addLight(kit,sje),this.addLight(Iit,Zst),this.addLight(Oit,Qst),this.addToneMapping(bMe,qF),this.addToneMapping(_Me,XF),this.addToneMapping(SMe,YF),this.addToneMapping(wMe,KF),this.addToneMapping(TMe,ZF),this.addToneMapping(EMe,QF)}}class hS extends nst{constructor(e={}){let t;e.forceWebGL?t=M7e:(t=Kst,e.getFallback=()=>(qt("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new M7e(e)));const n=new t(e);super(n,e),this.library=new Jst,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}class SCe{constructor(e,t=mr(0,0,1,1)){this.renderer=e,this.outputNode=t,this.outputColorTransform=!0,this.needsUpdate=!0;const n=new xo;n.name="RenderPipeline",this._quadMesh=new Aw(n),this._quadMesh.name="Render Pipeline",this._context=null}render(){const e=this.renderer;this._update(),this._context.onBeforeRenderPipeline!==null&&this._context.onBeforeRenderPipeline();const t=e.toneMapping,n=e.outputColorSpace;e.toneMapping=Ta,e.outputColorSpace=Zn.workingColorSpace;const r=e.xr.enabled;e.xr.enabled=!1,this._quadMesh.render(e),e.xr.enabled=r,e.toneMapping=t,e.outputColorSpace=n,this._context.onAfterRenderPipeline!==null&&this._context.onAfterRenderPipeline()}get context(){return this._context}dispose(){this._quadMesh.material.dispose()}_update(){if(this.needsUpdate===!0){const e=this.renderer,t=e.toneMapping,n=e.outputColorSpace,r={renderPipeline:this,onBeforeRenderPipeline:null,onAfterRenderPipeline:null};let i=this.outputNode;this.outputColorTransform===!0?(i=i.context(r),i=eQ(i,t,n)):(r.toneMapping=t,r.outputColorSpace=n,i=i.context(r)),this._context=r,this._quadMesh.material.fragmentNode=i,this._quadMesh.material.needsUpdate=!0,this.needsUpdate=!1}}async renderAsync(){es('RenderPipeline: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.renderer.init(),this.render()}}const YQ=new Ki;YQ.setAttribute("position",new Fr([-.5,-.5,0,1.5,-.5,0,-.5,1.5,0],3));YQ.setAttribute("normal",new Fr([0,0,1,0,0,1],3));YQ.setAttribute("uv",new Fr([0,0,2,0,0,2],2));new J3(-.5,.5,.5,-.5,0,100);const F7e=s=>{s==null||s.dispose()},wCe=s=>{if(s)if(Array.isArray(s))s.forEach(e=>wCe(e));else{for(const e in s){const t=s[e];t!==null&&t instanceof ol&&F7e(t)}if(s.isShaderMaterial===!0){const e=s;for(const t in e.uniforms){const n=e.uniforms[t];n.value!==null&&n.value instanceof ol&&F7e(n.value)}}s.dispose()}},Rp=s=>{var e;if(s){for(;s.children.length>0;){const t=s.children[0];t.type==="Audio"?(t.pause(),t.parent&&t.parent.remove(t)):Rp(t)}if(s.parent&&s.parent.remove(s),s.isMesh){const t=s;(e=t.geometry)==null||e.dispose(),wCe(t.material)}s.dispose!==void 0&&s.dispose()}};let fK=0;const tL=()=>{fK=0},$3=s=>{if(!s)return;let e=s.name.replaceAll(" ","").replaceAll("/",".");if(e.length===0&&(e=`obj_${fK}`,fK++),s.parent!==null&&s.parent.uuid.length>0&&(e=`${s.parent.uuid}.${e}`),s.uuid=e,s.isMesh!==void 0){const t=s;if(Array.isArray(t.material))t.material.forEach((n,r)=>{n.uuid=`${e}.material.${r}`});else{const n=t.material;n.uuid=`${e}.material`}}s.children.forEach(t=>$3(t))};class ud{static init(){this.inited||(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.inited=!0)}static renderToBlob(e){this.init();const t=e.repeat.clone(),n=e.offset.clone();if(e.repeat.set(1,1),e.offset.set(0,0),this.context!==null){this.context.clearRect(0,0,this.width,this.height);const r=e.image;if(r!=null&&r.width>0){this.canvas.title=e.sourceFile;const i=this.canvas.width/r.width,o=this.renderToCanvas(e);this.context.drawImage(o,0,0,r.width*i,r.height*i)}}return e.repeat.copy(t),e.offset.copy(n),this.canvas.toDataURL("image/png")}static renderToCanvas(e){if(this.material===null){this.camera=new J3(-.5,.5,.5,-.5,0,100),this.scene=new XA,this.material=new rl;const t=new Ki;t.setAttribute("position",new Fr([-.5,-.5,0,1.5,-.5,0,-.5,1.5,0],3)),t.setAttribute("normal",new Fr([0,0,1,0,0,1],3)),t.setAttribute("uv",new Fr([0,0,2,0,0,2],2));const n=new gn(t,this.material);this.scene.add(n)}if(e.isRenderTargetTexture)this.material.map=e,this.renderer.render(this.scene,this.camera);else{const t=this.renderer.outputColorSpace,n=e.colorSpace;this.renderer.outputColorSpace=vd,e.colorSpace=vd,this.material.map=e,this.renderer.render(this.scene,this.camera),this.renderer.outputColorSpace=t,e.colorSpace=n}return this.renderer.domElement}}qe(ud,"renderer"),qe(ud,"canvas"),qe(ud,"context",null),qe(ud,"scene",null),qe(ud,"camera",null),qe(ud,"material",null),qe(ud,"inited",!1),qe(ud,"width",100),qe(ud,"height",100);function eot(s){if(s.name==="cameras")return"camera";if(s.name==="interactive")return"interactive";if(s.name==="lights")return"light";if(s.name==="ui")return"ui";if(s.name==="utils")return"utils";const e=s.type;return e.search("Helper")>-1?"icon_utils":e.search("Camera")>-1?"camera":e.search("Light")>-1?"light":"obj3D"}function Vy(s){const e={name:s.name,type:s.type,uuid:s.uuid,children:[]};return s.children.forEach(t=>{e.children.push(Vy(t))}),e}function tot(s){const e={};for(const t in s){const n=s[t].value;e[t]={value:n},n===null?e[t].value={src:"",offset:[0,0],repeat:[1,1]}:n!==void 0&&n.isTexture&&(e[t].value={src:n.image.src,offset:[n.offset.x,n.offset.y],repeat:[n.repeat.x,n.repeat.y]})}return e}function not(s){switch(s){case"blendSrcAlpha":case"blendDstAlpha":case"blendEquationAlpha":case"clippingPlanes":case"shadowSide":case"precision":return!0}return!1}function D_(s){const e={};for(const t in s){if(t.substring(0,1)==="_"||t.substring(0,2)==="is"||not(t))continue;const n=typeof s[t],r=s[t];switch(n){case"boolean":case"number":case"string":e[t]=r;break;case"object":r!==null?(e[t]=r,r.isTexture?e[t]={src:ud.renderToBlob(r),offset:[r.offset.x,r.offset.y],repeat:[r.repeat.x,r.repeat.y]}:t==="uniforms"&&(e[t]=tot(e[t]))):t==="glslVersion"?e[t]="":e[t]={src:"",offset:[0,0],repeat:[1,1]};break}}return s.anisotropy!==void 0&&(e.anisotropy=s.anisotropy),s.clearcoat!==void 0&&(e.clearcoat=s.clearcoat),s.iridescence!==void 0&&(e.iridescence=s.iridescence),s.dispersion!==void 0&&(e.dispersion=s.dispersion),s.sheen!==void 0&&(e.sheen=s.sheen),s.transmission!==void 0&&(e.transmission=s.transmission),s.transmission!==void 0&&(e.transmission=s.transmission),e}function bX(s){s.updateMatrix();const e={name:s.name,type:s.type,uuid:s.uuid,visible:s.visible,matrix:s.matrix.elements,animations:[],material:void 0,perspectiveCameraInfo:void 0,orthographicCameraInfo:void 0,lightInfo:void 0,children:[]};s.animations.forEach(n=>{e.animations.push({name:n.name,duration:n.duration,blendMode:n.blendMode})});const t=s.type.toLowerCase();if(t.search("mesh")>-1){const n=s;if(Array.isArray(n.material)){const r=[];n.material.forEach(i=>{r.push(D_(i))}),e.material=r}else e.material=D_(n.material)}else if(t.search("points")>-1){const n=s;if(Array.isArray(n.material)){const r=[];n.material.forEach(i=>{r.push(D_(i))}),e.material=r}else e.material=D_(n.material)}else if(t.search("line")>-1){const n=s;if(Array.isArray(n.material)){const r=[];n.material.forEach(i=>{r.push(D_(i))}),e.material=r}else e.material=D_(n.material)}else t.search("camera")>-1?s.type==="PerspectiveCamera"?e.perspectiveCameraInfo={fov:s.fov,zoom:s.zoom,near:s.near,far:s.far,focus:s.focus,aspect:s.aspect,filmGauge:s.filmGauge,filmOffset:s.filmOffset}:s.type==="OrthographicCamera"&&(e.orthographicCameraInfo={zoom:s.zoom,near:s.near,far:s.far,left:s.left,right:s.right,top:s.top,bottom:s.bottom}):t.search("light")>-1&&(e.lightInfo={color:s.color,intensity:s.intensity,decay:s.decay,distance:s.distance,angle:s.angle,penumbra:s.penumbra,groundColor:s.groundColor,width:s.width,height:s.height});return e}function rot(s,e){const t=e.split(".");switch(t.length){case 1:return s[t[0]];case 2:return s[t[0]][t[1]];case 3:return s[t[0]][t[1]][t[2]];case 4:return s[t[0]][t[1]][t[2]][t[3]];case 5:return s[t[0]][t[1]][t[2]][t[3]][t[4]];case 6:return s[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]]}}function iot(s,e){for(const t in e)s[t]=e[t]}function za(s,e,t){if(s===void 0){console.log(`Hermes - Can't set props: ${e}`,t);return}const n=e.split("."),r=n.length;if(typeof t!="object")switch(r){case 1:s[n[0]]=t;break;case 2:s[n[0]][n[1]]=t;break;case 3:s[n[0]][n[1]][n[2]]=t;break;case 4:s[n[0]][n[1]][n[2]][n[3]]=t;break;case 5:s[n[0]][n[1]][n[2]][n[3]][n[4]]=t;break}else{let o;switch(r){case 1:o=s[n[0]];break;case 2:o=s[n[0]][n[1]];break;case 3:o=s[n[0]][n[1]][n[2]];break;case 4:o=s[n[0]][n[1]][n[2]][n[3]];break;case 5:o=s[n[0]][n[1]][n[2]][n[3]][n[4]];break}o!=null?iot(o,t):console.log(`Hermes - Can't set props because target isn't found: ${e}`,t)}}function KQ(s){return new Promise((e,t)=>{const n=new Image;n.onload=()=>{const r=new ol(n);r.wrapS=vh,r.wrapT=vh,r.needsUpdate=!0,e(r)},n.onerror=t,n.src=s})}function k6(s,e,t){return Math.min(e,Math.max(s,t))}function B7e(s,e,t){return(t-s)/(e-s)}function mK(s,e,t){return s*(1-t)+e*t}function om(s,e=1){return Number(s.toFixed(e))}var Ci=(s=>(s.CUSTOM="ToolEvents::custom",s.SELECT_DROPDOWN="ToolEvents::selectDropdown",s.DRAG_UPDATE="ToolEvents::dragUpdate",s.ADD_SCENE="ToolEvents::addScene",s.REFRESH_SCENE="ToolEvents::refreshScene",s.REMOVE_SCENE="ToolEvents::removeScene",s.SET_SCENE="ToolEvents::setScene",s.SET_OBJECT="ToolEvents::setObject",s.CLEAR_OBJECT="ToolEvents::clearObject",s.ADD_CAMERA="ToolEvents::addCamera",s.REMOVE_CAMERA="ToolEvents::removeCamera",s.ADD_GROUP="ToolEvents::addGroup",s.REMOVE_GROUP="ToolEvents::removeGroup",s.ADD_SPLINE="ToolEvents::addSpline",s.ADD_RENDERER="ToolEvents::addRenderer",s.UPDATE_RENDERER="ToolEvents::updateRenderer",s))(Ci||{});class sot extends NSe{constructor(t,n=!1,r=!1){super("RemoteThree",n,r);qe(this,"name");qe(this,"canvas",null);qe(this,"inputElement",null);qe(this,"scene");qe(this,"scenes",new Map);qe(this,"renderer");qe(this,"renderTargets",new Map);qe(this,"renderTargetsResize",new Map);qe(this,"groups",new Map);qe(this,"_listeners",{});this.name=t}dispose(){var t;this.scenes.forEach(n=>{Rp(n)}),this.scenes.clear(),this.scene&&Rp(this.scene),this.renderTargets.forEach(n=>{n.dispose()}),this.renderTargets.clear(),(t=this.renderer)==null||t.dispose()}addEventListener(t,n){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(n)===-1&&r[t].push(n)}hasEventListener(t,n){const r=this._listeners;return r===void 0?!1:r[t]!==void 0&&r[t].indexOf(n)!==-1}removeEventListener(t,n){const r=this._listeners;if(r===void 0)return;const i=r[t];if(i!==void 0){const o=i.indexOf(n);o!==-1&&i.splice(o,1)}}dispatchEvent(t){const n=this._listeners;if(n===void 0)return;const r=n[t.type];if(r!==void 0){const i={...t,target:this},o=r.slice(0);for(let l=0,c=o.length;l<c;l++)o[l].call(this,i)}}getObjectByUUID(t){const n=t.split(".")[0],r=this.scenes.get(n);if(r!==void 0)return r.getObjectByProperty("uuid",t)}getObject(t){if(!this.debug)return;this.renderer!==void 0&&(ud.renderer=this.renderer);const n=this.getObjectByUUID(t);n&&this.setObject(n)}setObject(t){this.renderer!==void 0&&(ud.renderer=this.renderer);const n=bX(t);this.dispatchEvent({type:"ToolEvents::setObject",value:n})}requestMethod(t,n,r,i){const o=this.getObjectByUUID(t);if(o)try{i!==void 0?rot(o,i)[n](r):o[n](r)}catch(l){console.log("Hermes - Error requesting method:",t,n,r),console.log(l)}}updateObject(t,n,r){this.send({event:"updateObject",target:"app",data:{uuid:t,key:n,value:r}})}createTexture(t,n,r){this.send({event:"createTexture",target:"app",data:{uuid:t,key:n,value:r}})}onUpdateObject(t,n,r){const i=this.getObjectByUUID(t);i&&za(i,n,r)}onCreateTexture(t,n,r){const i=this.getObjectByUUID(t);if(i){const o=l=>{const c=n.split(".");switch(c.length){case 1:i[c[0]]=l;break;case 2:i[c[0]][c[1]]=l;break;case 3:i[c[0]][c[1]][c[2]]=l;break;case 4:i[c[0]][c[1]][c[2]][c[3]]=l;break;case 5:i[c[0]][c[1]][c[2]][c[3]][c[4]]=l;break}i.material.needsUpdate=!0};r.src.length>0?KQ(r.src).then(l=>{l.offset.set(r.offset[0],r.offset[1]),l.repeat.set(r.repeat[0],r.repeat[1]),o(l)}):o(null)}}addGroup(t){this.groups.get(t.title)===void 0&&(this.groups.set(t.title,{title:t.title,onUpdate:t.onUpdate}),this.send({event:"addGroup",target:"editor",data:JSON.stringify(t)}))}removeGroup(t){this.groups.get(t)!==void 0&&(this.groups.delete(t),this.send({event:"removeGroup",target:"editor",data:t}))}updateGroup(t,n,r){this.send({event:"updateGroup",target:"app",data:JSON.stringify({group:t,prop:n,value:r})})}addSplineCurve(t){setTimeout(()=>{this.send({event:"addSpline",target:"editor",data:JSON.stringify(t.toJSON())})},1)}addSplineObject(t){setTimeout(()=>{this.send({event:"addSpline",target:"editor",data:JSON.stringify(t)})},1)}setRenderer(t,n=null){if(this.renderer=t,this.canvas=t.domElement,this.inputElement=n!==null?n:this.canvas,!this.debug)return;const r=`#${t.getClearColor(new Tn).getHexString()}`;this.send({event:"addRenderer",target:"editor",data:{autoClear:t.autoClear,autoClearColor:t.autoClearColor,autoClearDepth:t.autoClearDepth,autoClearStencil:t.autoClearStencil,outputColorSpace:t.outputColorSpace,localClippingEnabled:t.localClippingEnabled,clearColor:r,clearAlpha:t.getClearAlpha(),colorManagement:Zn.enabled,toneMapping:t.toneMapping,toneMappingExposure:t.toneMappingExposure,type:t.isWebGLRenderer?"WebGLRenderer":"WebGPURenderer"}})}updateRenderer(t){this.send({event:"updateRenderer",target:"app",data:t})}addScene(t){if(t===void 0||(this.scenes.set(t.name,t),!this.debug))return;tL(),$3(t);const n=Vy(t);this.send({event:"addScene",target:"editor",data:n})}refreshScene(t){if(!this.debug)return;const n=this.scenes.get(t);if(n!==void 0){const r=Vy(n);this.send({event:"refreshScene",target:"app",data:r})}}removeScene(t){if(t===void 0||(this.scenes.delete(t.name),!this.debug))return;const n=Vy(t);this.send({event:"removeScene",target:"editor",data:n})}removeAllScenes(){this.scenes.forEach(t=>this.removeScene(t))}getScene(t){let n=null;return this.scene!==void 0&&this.scene.uuid.search(t)>-1?this.scene:(this.scenes.forEach((r,i)=>{t.search(i)>-1&&(n=r)}),n)}setScene(t){if(t===void 0||(this.scene=t,!this.debug))return;this.renderer!==void 0&&(ud.renderer=this.renderer),tL(),$3(t);const n=Vy(t);this.send({event:"setScene",target:"editor",data:n})}requestSize(){this.send({event:"requestSize",target:"app"})}requestRenderer(){this.send({event:"requestRenderer",target:"app"})}requestScene(){this.send({event:"requestScene",target:"app"})}addCamera(t){if(!this.debug)return;const n=bX(t);this.send({event:"addCamera",target:"editor",data:n})}removeCamera(t){if(!this.debug)return;const n=bX(t);this.send({event:"removeCamera",target:"editor",data:n})}handleApp(t){switch(t.event){case"refreshScene":this.send({event:"refreshScene",target:"editor",data:Vy(this.scenes.get(t.data.name))});break;case"updateRenderer":this.renderer&&(this.renderer.autoClearColor=t.data.autoClearColor,this.renderer.outputColorSpace=t.data.outputColorSpace,this.renderer.localClippingEnabled=t.data.localClippingEnabled,this.renderer.setClearColor(t.data.clearColor,t.data.clearAlpha),this.renderer.toneMapping=t.data.toneMapping,this.renderer.toneMappingExposure=t.data.toneMappingExposure,Zn.enabled=t.data.colorManagement);break;case"requestRenderer":if(this.renderer!==void 0){const n=`#${this.renderer.getClearColor(new Tn).getHexString()}`;this.send({event:"addRenderer",target:"editor",data:{autoClear:this.renderer.autoClear,autoClearColor:this.renderer.autoClearColor,autoClearDepth:this.renderer.autoClearDepth,autoClearStencil:this.renderer.autoClearStencil,outputColorSpace:this.renderer.outputColorSpace,localClippingEnabled:this.renderer.localClippingEnabled,clearColor:n,clearAlpha:this.renderer.getClearAlpha(),colorManagement:Zn.enabled,toneMapping:this.renderer.toneMapping,toneMappingExposure:this.renderer.toneMappingExposure,type:this.renderer.isWebGLRenderer?"WebGLRenderer":"WebGPURenderer"}})}break;case"requestScene":this.scenes.forEach(n=>{tL(),$3(n),this.send({event:"addScene",target:"editor",data:Vy(n)})}),this.scene!==void 0&&(this.renderer!==void 0&&(ud.renderer=this.renderer),tL(),$3(this.scene),this.send({event:"setScene",target:"editor",data:Vy(this.scene)}));break}if(t.event==="updateGroup"){const n=JSON.parse(t.data),r=this.groups.get(n.group);r==null||r.onUpdate(n.prop,n.value)}}handleEditor(t){switch(t.event){case"addScene":this.dispatchEvent({type:"ToolEvents::addScene",value:t.data});break;case"refreshScene":this.dispatchEvent({type:"ToolEvents::refreshScene",value:t.data});break;case"removeScene":this.dispatchEvent({type:"ToolEvents::removeScene",value:t.data});break;case"setScene":this.dispatchEvent({type:"ToolEvents::setScene",value:t.data});break;case"addCamera":this.dispatchEvent({type:"ToolEvents::addCamera",value:t.data});break;case"removeCamera":this.dispatchEvent({type:"ToolEvents::removeCamera",value:t.data});break;case"addGroup":this.dispatchEvent({type:"ToolEvents::addGroup",value:t.data});break;case"removeGroup":this.dispatchEvent({type:"ToolEvents::removeGroup",value:t.data});break;case"addSpline":this.dispatchEvent({type:"ToolEvents::addSpline",value:t.data});break;case"addRenderer":this.dispatchEvent({type:"ToolEvents::addRenderer",value:t.data})}}messageHandler(t){const n=t.data;if(n.event==="updateObject"){this.onUpdateObject(n.data.uuid,n.data.key,n.data.value);return}else if(n.event==="createTexture"){this.onCreateTexture(n.data.uuid,n.data.key,n.data.value);return}else if(n.event==="requestSize"){n.target==="app"?this.send({event:"requestSize",target:"editor",data:{width:this.width,height:this.height}}):this.scenes.forEach(r=>{r.resize!==void 0&&r.resize(n.data.width,n.data.height)});return}n.target==="app"?this.handleApp(n):this.handleEditor(n)}addRT(t,n=!0,r){if(!this.renderer)return;let i;this.renderer instanceof hS?i=new Op(32,32,r):i=new hm(32,32,r),i.texture.name=t,this.renderTargets.set(t,i),this.renderTargetsResize.set(t,n)}removeRT(t){this.renderTargets.delete(t),this.renderTargetsResize.delete(t)}resize(t,n){var o,l;const r=this.dpr;this.renderTargets.forEach((c,h)=>{this.renderTargetsResize.get(h)&&c.setSize(t*r,n*r)});const i=!(((o=this.renderer)==null?void 0:o.domElement)instanceof OffscreenCanvas);(l=this.renderer)==null||l.setSize(t,n,i)}set dpr(t){var n;(n=this.renderer)==null||n.setPixelRatio(k6(1,2,t))}get dpr(){var t;return this.renderer!==void 0?(t=this.renderer)==null?void 0:t.getPixelRatio():1}get width(){return this.renderer!==void 0?this.renderer.domElement.width/this.dpr:0}get height(){return this.renderer!==void 0?this.renderer.domElement.height/this.dpr:0}}function oot(s){const t=s.app.components.get("theatre");return t.studio=P_e,t.handleEditorApp(),null}function aot(s){return ot.jsxs("div",{className:"editor",ref:s.ref,style:s.style,children:[ot.jsx("div",{className:"header",children:s.header}),s.children,ot.jsx("div",{className:"footer",children:s.footer})]})}class lot extends dd{constructor(e,t){const n=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],r=new Ki;r.setAttribute("position",new Fr(n,3)),r.computeBoundingSphere();const i=new Sh({fog:!1});super(r,i),this.light=e,this.color=t,this.type="RectAreaLightHelper";const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new Ki;l.setAttribute("position",new Fr(o,3)),l.computeBoundingSphere(),this.add(new gn(l,new rl({side:bs,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),this.color!==void 0)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const U7e={type:"change"},ZQ={type:"start"},TCe={type:"end"},nL=new xw,z7e=new dg,cot=Math.cos(70*t0.DEG2RAD),yl=new be,ad=2*Math.PI,Ks={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},_X=1e-6;class ECe extends _Se{constructor(e,t=null){super(e,t),this.state=Ks.NONE,this.target=new be,this.cursor=new be,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:fS.ROTATE,MIDDLE:fS.DOLLY,RIGHT:fS.PAN},this.touches={ONE:lS.ROTATE,TWO:lS.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._cursorStyle="auto",this._domElementKeyEvents=null,this._lastPosition=new be,this._lastQuaternion=new vs,this._lastTargetPosition=new be,this._quat=new vs().setFromUnitVectors(e.up,new be(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new LY,this._sphericalDelta=new LY,this._scale=1,this._panOffset=new be,this._rotateStart=new Ln,this._rotateEnd=new Ln,this._rotateDelta=new Ln,this._panStart=new Ln,this._panEnd=new Ln,this._panDelta=new Ln,this._dollyStart=new Ln,this._dollyEnd=new Ln,this._dollyDelta=new Ln,this._dollyDirection=new be,this._mouse=new Ln,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=dot.bind(this),this._onPointerDown=uot.bind(this),this._onPointerUp=hot.bind(this),this._onContextMenu=xot.bind(this),this._onMouseWheel=mot.bind(this),this._onKeyDown=got.bind(this),this._onTouchStart=yot.bind(this),this._onTouchMove=vot.bind(this),this._onMouseDown=pot.bind(this),this._onMouseMove=fot.bind(this),this._interceptControlDown=bot.bind(this),this._interceptControlUp=_ot.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}set cursorStyle(e){this._cursorStyle=e,e==="grab"?this.domElement.style.cursor="grab":this.domElement.style.cursor="auto"}get cursorStyle(){return this._cursorStyle}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(U7e),this.update(),this.state=Ks.NONE}pan(e,t){this._pan(e,t),this.update()}dollyIn(e){this._dollyIn(e),this.update()}dollyOut(e){this._dollyOut(e),this.update()}rotateLeft(e){this._rotateLeft(e),this.update()}rotateUp(e){this._rotateUp(e),this.update()}update(e=null){const t=this.object.position;yl.copy(t).sub(this.target),yl.applyQuaternion(this._quat),this._spherical.setFromVector3(yl),this.autoRotate&&this.state===Ks.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(n)&&isFinite(r)&&(n<-Math.PI?n+=ad:n>Math.PI&&(n-=ad),r<-Math.PI?r+=ad:r>Math.PI&&(r-=ad),n<=r?this._spherical.theta=Math.max(n,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+r)/2?Math.max(n,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let i=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),i=o!=this._spherical.radius}if(yl.setFromSpherical(this._spherical),yl.applyQuaternion(this._quatInverse),t.copy(this.target).add(yl),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const l=yl.length();o=this._clampDistance(l*this._scale);const c=l-o;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),i=!!c}else if(this.object.isOrthographicCamera){const l=new be(this._mouse.x,this._mouse.y,0);l.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),i=c!==this.object.zoom;const h=new be(this._mouse.x,this._mouse.y,0);h.unproject(this.object),this.object.position.sub(h).add(l),this.object.updateMatrixWorld(),o=yl.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(nL.origin.copy(this.object.position),nL.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(nL.direction))<cot?this.object.lookAt(this.target):(z7e.setFromNormalAndCoplanarPoint(this.object.up,this.target),nL.intersectPlane(z7e,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),i=!0)}return this._scale=1,this._performCursorZoom=!1,i||this._lastPosition.distanceToSquared(this.object.position)>_X||8*(1-this._lastQuaternion.dot(this.object.quaternion))>_X||this._lastTargetPosition.distanceToSquared(this.target)>_X?(this.dispatchEvent(U7e),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?ad/60*this.autoRotateSpeed*e:ad/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){yl.setFromMatrixColumn(t,0),yl.multiplyScalar(-e),this._panOffset.add(yl)}_panUp(e,t){this.screenSpacePanning===!0?yl.setFromMatrixColumn(t,1):(yl.setFromMatrixColumn(t,0),yl.crossVectors(this.object.up,yl)),yl.multiplyScalar(e),this._panOffset.add(yl)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;yl.copy(r).sub(this.target);let i=yl.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*i/n.clientHeight,this.object.matrix),this._panUp(2*t*i/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),r=e-n.left,i=t-n.top,o=n.width,l=n.height;this._mouse.x=r/o*2-1,this._mouse.y=-(i/l)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(ad*this._rotateDelta.x/t.clientHeight),this._rotateUp(ad*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(ad*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-ad*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(ad*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-ad*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._rotateStart.set(n,r)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panStart.set(n,r)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y,i=Math.sqrt(n*n+r*r);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),r=.5*(e.pageX+n.x),i=.5*(e.pageY+n.y);this._rotateEnd.set(r,i)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(ad*this._rotateDelta.x/t.clientHeight),this._rotateUp(ad*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panEnd.set(n,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y,i=Math.sqrt(n*n+r*r);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,l=(e.pageY+t.y)*.5;this._updateZoomParameters(o,l)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Ln,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function uot(s){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(s.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(s)&&(this._addPointer(s),s.pointerType==="touch"?this._onTouchStart(s):this._onMouseDown(s),this._cursorStyle==="grab"&&(this.domElement.style.cursor="grabbing")))}function dot(s){this.enabled!==!1&&(s.pointerType==="touch"?this._onTouchMove(s):this._onMouseMove(s))}function hot(s){switch(this._removePointer(s),this._pointers.length){case 0:this.domElement.releasePointerCapture(s.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(TCe),this.state=Ks.NONE,this._cursorStyle==="grab"&&(this.domElement.style.cursor="grab");break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function pot(s){let e;switch(s.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case fS.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(s),this.state=Ks.DOLLY;break;case fS.ROTATE:if(s.ctrlKey||s.metaKey||s.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(s),this.state=Ks.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(s),this.state=Ks.ROTATE}break;case fS.PAN:if(s.ctrlKey||s.metaKey||s.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(s),this.state=Ks.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(s),this.state=Ks.PAN}break;default:this.state=Ks.NONE}this.state!==Ks.NONE&&this.dispatchEvent(ZQ)}function fot(s){switch(this.state){case Ks.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(s);break;case Ks.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(s);break;case Ks.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(s);break}}function mot(s){this.enabled===!1||this.enableZoom===!1||this.state!==Ks.NONE||(s.preventDefault(),this.dispatchEvent(ZQ),this._handleMouseWheel(this._customWheelEvent(s)),this.dispatchEvent(TCe))}function got(s){this.enabled!==!1&&this._handleKeyDown(s)}function yot(s){switch(this._trackPointer(s),this._pointers.length){case 1:switch(this.touches.ONE){case lS.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(s),this.state=Ks.TOUCH_ROTATE;break;case lS.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(s),this.state=Ks.TOUCH_PAN;break;default:this.state=Ks.NONE}break;case 2:switch(this.touches.TWO){case lS.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(s),this.state=Ks.TOUCH_DOLLY_PAN;break;case lS.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(s),this.state=Ks.TOUCH_DOLLY_ROTATE;break;default:this.state=Ks.NONE}break;default:this.state=Ks.NONE}this.state!==Ks.NONE&&this.dispatchEvent(ZQ)}function vot(s){switch(this._trackPointer(s),this.state){case Ks.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(s),this.update();break;case Ks.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(s),this.update();break;case Ks.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(s),this.update();break;case Ks.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(s),this.update();break;default:this.state=Ks.NONE}}function xot(s){this.enabled!==!1&&s.preventDefault()}function bot(s){s.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function _ot(s){s.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const gK=0,BB=1,Sot=2,wot=0,V7e=1,G7e=100,j7e=204,H7e=205,$7e=3,MCe=0,Tot=1,Eot=2,yK=0,CCe=300,QQ=301,ACe=302,NCe=303,PCe=304,W7e=1e3,IC=1001,q7e=1002,_5=1003,RF=1006,JQ=1008,Mot=1009,Cot=1013,RCe=1014,ICe=1015,Aot=1016,Not=1023,X7e=1026,Pot=1027,Rot=1030,Iot=37490,kot=36285,SX=0,Dot=1,IF="",rm="srgb",Y7e="srgb-linear",K7e="linear",YC="srgb",wX="",kCe="rg",Oot="ga",O_=7680,Z7e=519,Lot=513,aw=35044,vK=35048,W3=2e3,lw=2001,Fot={TEXTURE_COMPARE:"depthTextureCompare"};function Bot(s){for(let e=s.length-1;e>=0;--e)if(s[e]>=65535)return!0;return!1}function Q7e(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}const J7e={};function xK(...s){const e="THREE."+s.shift();console.log(e,...s)}function DCe(s){const e=s[0];if(typeof e=="string"&&e.startsWith("TSL:")){const t=s[1];t&&t.isStackTrace?s[0]+=" "+t.getLocation():s[1]='Stack trace not available. Enable "THREE.Node.captureStackTrace" to capture stack traces.'}return s}function bi(...s){s=DCe(s);const e="THREE."+s.shift();{const t=s[0];t&&t.isStackTrace?console.warn(t.getError(e)):console.warn(e,...s)}}function Js(...s){s=DCe(s);const e="THREE."+s.shift();{const t=s[0];t&&t.isStackTrace?console.error(t.getError(e)):console.error(e,...s)}}function DA(...s){const e=s.join(" ");e in J7e||(J7e[e]=!0,bi(...s))}const vc=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let ebe=1234567;const KC=Math.PI/180,kF=180/Math.PI;function Z3(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(vc[s&255]+vc[s>>8&255]+vc[s>>16&255]+vc[s>>24&255]+"-"+vc[e&255]+vc[e>>8&255]+"-"+vc[e>>16&15|64]+vc[e>>24&255]+"-"+vc[t&63|128]+vc[t>>8&255]+"-"+vc[t>>16&255]+vc[t>>24&255]+vc[n&255]+vc[n>>8&255]+vc[n>>16&255]+vc[n>>24&255]).toLowerCase()}function Xi(s,e,t){return Math.max(e,Math.min(t,s))}function eJ(s,e){return(s%e+e)%e}function D6(s,e,t,n,r){return n+(s-e)*(r-n)/(t-e)}function Uot(s,e,t){return s!==e?(t-s)/(e-s):0}function c5(s,e,t){return(1-t)*s+t*e}function zot(s,e,t,n){return c5(s,e,1-Math.exp(-t*n))}function Vot(s,e=1){return e-Math.abs(eJ(s,e*2)-e)}function Got(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*(3-2*s))}function jot(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*s*(s*(s*6-15)+10))}function Hot(s,e){return s+Math.floor(Math.random()*(e-s+1))}function $ot(s,e){return s+Math.random()*(e-s)}function Wot(s){return s*(.5-Math.random())}function qot(s){s!==void 0&&(ebe=s);let e=ebe+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function DF(s){return s*KC}function OCe(s){return s*kF}function Xot(s){return(s&s-1)===0&&s!==0}function Yot(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Kot(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function Zot(s,e,t,n,r){const i=Math.cos,o=Math.sin,l=i(t/2),c=o(t/2),h=i((e+n)/2),m=o((e+n)/2),y=i((e-n)/2),b=o((e-n)/2),w=i((n-e)/2),A=o((n-e)/2);switch(r){case"XYX":s.set(l*m,c*y,c*b,l*h);break;case"YZY":s.set(c*b,l*m,c*y,l*h);break;case"ZXZ":s.set(c*y,c*b,l*m,l*h);break;case"XZX":s.set(l*m,c*A,c*w,l*h);break;case"YXY":s.set(c*w,l*m,c*A,l*h);break;case"ZYZ":s.set(c*A,c*w,l*m,l*h);break;default:bi("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function lm(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function js(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const Qot={DEG2RAD:KC,RAD2DEG:kF,generateUUID:Z3,clamp:Xi,euclideanModulo:eJ,mapLinear:D6,inverseLerp:Uot,lerp:c5,damp:zot,pingpong:Vot,smoothstep:Got,smootherstep:jot,randInt:Hot,randFloat:$ot,randFloatSpread:Wot,seededRandom:qot,degToRad:DF,radToDeg:OCe,isPowerOfTwo:Xot,ceilPowerOfTwo:Yot,floorPowerOfTwo:Kot,setQuaternionFromProperEuler:Zot,normalize:js,denormalize:lm};/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const ra={LEFT:1,RIGHT:2,MIDDLE:4},Rt=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),L_={NONE:0,IN:1,OUT:-1};function w6(s){return s.isPerspectiveCamera}function Gy(s){return s.isOrthographicCamera}const F_=Math.PI*2,tbe=Math.PI/2,LCe=1e-5,oC=Math.PI/180;function Jf(s,e,t){return Math.max(e,Math.min(t,s))}function fo(s,e=LCe){return Math.abs(s)<e}function Rs(s,e,t=LCe){return fo(s-e,t)}function nbe(s,e){return Math.round(s/e)*e}function aC(s){return isFinite(s)?s:s<0?-Number.MAX_VALUE:Number.MAX_VALUE}function lC(s){return Math.abs(s)<Number.MAX_VALUE?s:s*(1/0)}function rL(s,e,t,n,r=1/0,i){n=Math.max(1e-4,n);const o=2/n,l=o*i,c=1/(1+l+.48*l*l+.235*l*l*l);let h=s-e;const m=e,y=r*n;h=Jf(h,-y,y),e=s-h;const b=(t.value+o*h)*i;t.value=(t.value-o*b)*c;let w=e+(h+b)*c;return m-s>0==w>m&&(w=m,t.value=(w-m)/i),w}function rbe(s,e,t,n,r=1/0,i,o){n=Math.max(1e-4,n);const l=2/n,c=l*i,h=1/(1+c+.48*c*c+.235*c*c*c);let m=e.x,y=e.y,b=e.z,w=s.x-m,A=s.y-y,I=s.z-b;const D=m,P=y,U=b,j=r*n,C=j*j,Z=w*w+A*A+I*I;if(Z>C){const Ie=Math.sqrt(Z);w=w/Ie*j,A=A/Ie*j,I=I/Ie*j}m=s.x-w,y=s.y-A,b=s.z-I;const ie=(t.x+l*w)*i,se=(t.y+l*A)*i,z=(t.z+l*I)*i;t.x=(t.x-l*ie)*h,t.y=(t.y-l*se)*h,t.z=(t.z-l*z)*h,o.x=m+(w+ie)*h,o.y=y+(A+se)*h,o.z=b+(I+z)*h;const re=D-s.x,ye=P-s.y,H=U-s.z,Me=o.x-D,Oe=o.y-P,Ue=o.z-U;return re*Me+ye*Oe+H*Ue>0&&(o.x=D,o.y=P,o.z=U,t.x=(o.x-D)/i,t.y=(o.y-P)/i,t.z=(o.z-U)/i),o}function TX(s,e){e.set(0,0),s.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=s.length,e.y/=s.length}function EX(s,e){return Gy(s)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}let Jot=class{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners[e];if(r!==void 0){const i=r.indexOf(t);i!==-1&&r.splice(i,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let i=0,o=r.length;i<o;i++)r[i].call(this,e)}}};var MX;const eat="2.10.1",iL=1/8,tat=/Mac/.test((MX=globalThis==null?void 0:globalThis.navigator)===null||MX===void 0?void 0:MX.platform);let oi,ibe,sL,CX,ld,wi,ys,B_,cC,tg,ng,T6,sbe,obe,gp,uC,U_,abe,AX,lbe,NX,PX,oL;class ug extends Jot{static install(e){oi=e.THREE,ibe=Object.freeze(new oi.Vector3(0,0,0)),sL=Object.freeze(new oi.Vector3(0,1,0)),CX=Object.freeze(new oi.Vector3(0,0,1)),ld=new oi.Vector2,wi=new oi.Vector3,ys=new oi.Vector3,B_=new oi.Vector3,cC=new oi.Vector3,tg=new oi.Vector3,ng=new oi.Vector3,T6=new oi.Vector3,sbe=new oi.Vector3,obe=new oi.Vector3,gp=new oi.Spherical,uC=new oi.Spherical,U_=new oi.Box3,abe=new oi.Box3,AX=new oi.Sphere,lbe=new oi.Quaternion,NX=new oi.Quaternion,PX=new oi.Matrix4,oL=new oi.Raycaster}static get ACTION(){return Rt}set verticalDragToForward(e){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=Rt.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=L_.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new oi.Vector3,this._focalOffsetVelocity=new oi.Vector3,this._zoomVelocity={value:0},this._truckInternal=(P,U,j,C)=>{let Z,ie;if(w6(this._camera)){const se=wi.copy(this._camera.position).sub(this._target),z=this._camera.getEffectiveFOV()*oC,re=se.length()*Math.tan(z*.5);Z=this.truckSpeed*P*re/this._elementRect.height,ie=this.truckSpeed*U*re/this._elementRect.height}else if(Gy(this._camera)){const se=this._camera;Z=this.truckSpeed*P*(se.right-se.left)/se.zoom/this._elementRect.width,ie=this.truckSpeed*U*(se.top-se.bottom)/se.zoom/this._elementRect.height}else return;C?(j?this.setFocalOffset(this._focalOffsetEnd.x+Z,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(Z,0,!0),this.forward(-ie,!0)):j?this.setFocalOffset(this._focalOffsetEnd.x+Z,this._focalOffsetEnd.y+ie,this._focalOffsetEnd.z,!0):this.truck(Z,ie,!0)},this._rotateInternal=(P,U)=>{const j=F_*this.azimuthRotateSpeed*P/this._elementRect.height,C=F_*this.polarRotateSpeed*U/this._elementRect.height;this.rotate(j,C,!0)},this._dollyInternal=(P,U,j)=>{const C=Math.pow(.95,-P*this.dollySpeed),Z=this._sphericalEnd.radius,ie=this._sphericalEnd.radius*C,se=Jf(ie,this.minDistance,this.maxDistance),z=se-ie;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(ie,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(z,!0),this._dollyToNoClamp(se,!0)):this._dollyToNoClamp(se,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?ie:se)-Z,this._dollyControlCoord.set(U,j)),this._lastDollyDirection=Math.sign(-P)},this._zoomInternal=(P,U,j)=>{const C=Math.pow(.95,P*this.dollySpeed),Z=this._zoom,ie=this._zoom*C;this.zoomTo(ie,!0),this.dollyToCursor&&(this._changedZoom+=ie-Z,this._dollyControlCoord.set(U,j))},typeof oi>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new oi.Quaternion().setFromUnitVectors(this._camera.up,sL),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=Rt.NONE,this._target=new oi.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new oi.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new oi.Spherical().setFromVector3(wi.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new oi.Vector3,new oi.Vector3,new oi.Vector3,new oi.Vector3],this._updateNearPlaneCorners(),this._boundary=new oi.Box3(new oi.Vector3(-1/0,-1/0,-1/0),new oi.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new oi.Vector2,this.mouseButtons={left:Rt.ROTATE,middle:Rt.DOLLY,right:Rt.TRUCK,wheel:w6(this._camera)?Rt.DOLLY:Gy(this._camera)?Rt.ZOOM:Rt.NONE},this.touches={one:Rt.TOUCH_ROTATE,two:w6(this._camera)?Rt.TOUCH_DOLLY_TRUCK:Gy(this._camera)?Rt.TOUCH_ZOOM_TRUCK:Rt.NONE,three:Rt.TOUCH_TRUCK};const n=new oi.Vector2,r=new oi.Vector2,i=new oi.Vector2,o=P=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const C=this._domElement.getBoundingClientRect(),Z=P.clientX/C.width,ie=P.clientY/C.height;if(Z<this._interactiveArea.left||Z>this._interactiveArea.right||ie<this._interactiveArea.top||ie>this._interactiveArea.bottom)return}const U=P.pointerType!=="mouse"?null:(P.buttons&ra.LEFT)===ra.LEFT?ra.LEFT:(P.buttons&ra.MIDDLE)===ra.MIDDLE?ra.MIDDLE:(P.buttons&ra.RIGHT)===ra.RIGHT?ra.RIGHT:null;if(U!==null){const C=this._findPointerByMouseButton(U);C&&this._disposePointer(C)}if((P.buttons&ra.LEFT)===ra.LEFT&&this._lockedPointer)return;const j={pointerId:P.pointerId,clientX:P.clientX,clientY:P.clientY,deltaX:0,deltaY:0,mouseButton:U};this._activePointers.push(j),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,b(P)},l=P=>{P.cancelable&&P.preventDefault();const U=P.pointerId,j=this._lockedPointer||this._findPointerById(U);if(j){if(j.clientX=P.clientX,j.clientY=P.clientY,j.deltaX=P.movementX,j.deltaY=P.movementY,this._state=0,P.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(P.buttons&ra.LEFT)===ra.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(P.buttons&ra.MIDDLE)===ra.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(P.buttons&ra.RIGHT)===ra.RIGHT&&(this._state=this._state|this.mouseButtons.right);w()}},c=P=>{const U=this._findPointerById(P.pointerId);if(!(U&&U===this._lockedPointer)){if(U&&this._disposePointer(U),P.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=Rt.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=Rt.NONE;A()}};let h=-1;const m=P=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===Rt.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const ie=this._domElement.getBoundingClientRect(),se=P.clientX/ie.width,z=P.clientY/ie.height;if(se<this._interactiveArea.left||se>this._interactiveArea.right||z<this._interactiveArea.top||z>this._interactiveArea.bottom)return}if(P.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===Rt.ROTATE||this.mouseButtons.wheel===Rt.TRUCK){const ie=performance.now();h-ie<1e3&&this._getClientRect(this._elementRect),h=ie}const U=tat?-1:-3,j=P.deltaMode===1||P.ctrlKey?P.deltaY/U:P.deltaY/(U*10),C=this.dollyToCursor?(P.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,Z=this.dollyToCursor?(P.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case Rt.ROTATE:{this._rotateInternal(P.deltaX,P.deltaY),this._isUserControllingRotate=!0;break}case Rt.TRUCK:{this._truckInternal(P.deltaX,P.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case Rt.SCREEN_PAN:{this._truckInternal(P.deltaX,P.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case Rt.OFFSET:{this._truckInternal(P.deltaX,P.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case Rt.DOLLY:{this._dollyInternal(-j,C,Z),this._isUserControllingDolly=!0;break}case Rt.ZOOM:{this._zoomInternal(-j,C,Z),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},y=P=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===ug.ACTION.NONE){const U=P instanceof PointerEvent?P.pointerId:0,j=this._findPointerById(U);j&&this._disposePointer(j),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c);return}P.preventDefault()}},b=P=>{if(!this._enabled)return;if(TX(this._activePointers,ld),this._getClientRect(this._elementRect),n.copy(ld),r.copy(ld),this._activePointers.length>=2){const j=ld.x-this._activePointers[1].clientX,C=ld.y-this._activePointers[1].clientY,Z=Math.sqrt(j*j+C*C);i.set(0,Z);const ie=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,se=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;r.set(ie,se)}if(this._state=0,!P)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in P&&P.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(P.buttons&ra.LEFT)===ra.LEFT&&(this._state=this._state|this.mouseButtons.left),(P.buttons&ra.MIDDLE)===ra.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(P.buttons&ra.RIGHT)===ra.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&Rt.ROTATE)===Rt.ROTATE||(this._state&Rt.TOUCH_ROTATE)===Rt.TOUCH_ROTATE||(this._state&Rt.TOUCH_DOLLY_ROTATE)===Rt.TOUCH_DOLLY_ROTATE||(this._state&Rt.TOUCH_ZOOM_ROTATE)===Rt.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&Rt.TRUCK)===Rt.TRUCK||(this._state&Rt.SCREEN_PAN)===Rt.SCREEN_PAN||(this._state&Rt.TOUCH_TRUCK)===Rt.TOUCH_TRUCK||(this._state&Rt.TOUCH_SCREEN_PAN)===Rt.TOUCH_SCREEN_PAN||(this._state&Rt.TOUCH_DOLLY_TRUCK)===Rt.TOUCH_DOLLY_TRUCK||(this._state&Rt.TOUCH_DOLLY_SCREEN_PAN)===Rt.TOUCH_DOLLY_SCREEN_PAN||(this._state&Rt.TOUCH_ZOOM_TRUCK)===Rt.TOUCH_ZOOM_TRUCK||(this._state&Rt.TOUCH_ZOOM_SCREEN_PAN)===Rt.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&Rt.DOLLY)===Rt.DOLLY||(this._state&Rt.TOUCH_DOLLY)===Rt.TOUCH_DOLLY||(this._state&Rt.TOUCH_DOLLY_TRUCK)===Rt.TOUCH_DOLLY_TRUCK||(this._state&Rt.TOUCH_DOLLY_SCREEN_PAN)===Rt.TOUCH_DOLLY_SCREEN_PAN||(this._state&Rt.TOUCH_DOLLY_OFFSET)===Rt.TOUCH_DOLLY_OFFSET||(this._state&Rt.TOUCH_DOLLY_ROTATE)===Rt.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&Rt.ZOOM)===Rt.ZOOM||(this._state&Rt.TOUCH_ZOOM)===Rt.TOUCH_ZOOM||(this._state&Rt.TOUCH_ZOOM_TRUCK)===Rt.TOUCH_ZOOM_TRUCK||(this._state&Rt.TOUCH_ZOOM_SCREEN_PAN)===Rt.TOUCH_ZOOM_SCREEN_PAN||(this._state&Rt.TOUCH_ZOOM_OFFSET)===Rt.TOUCH_ZOOM_OFFSET||(this._state&Rt.TOUCH_ZOOM_ROTATE)===Rt.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&Rt.OFFSET)===Rt.OFFSET||(this._state&Rt.TOUCH_OFFSET)===Rt.TOUCH_OFFSET||(this._state&Rt.TOUCH_DOLLY_OFFSET)===Rt.TOUCH_DOLLY_OFFSET||(this._state&Rt.TOUCH_ZOOM_OFFSET)===Rt.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},w=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,TX(this._activePointers,ld);const U=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,j=U?-U.deltaX:r.x-ld.x,C=U?-U.deltaY:r.y-ld.y;if(r.copy(ld),((this._state&Rt.ROTATE)===Rt.ROTATE||(this._state&Rt.TOUCH_ROTATE)===Rt.TOUCH_ROTATE||(this._state&Rt.TOUCH_DOLLY_ROTATE)===Rt.TOUCH_DOLLY_ROTATE||(this._state&Rt.TOUCH_ZOOM_ROTATE)===Rt.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(j,C),this._isUserControllingRotate=!0),(this._state&Rt.DOLLY)===Rt.DOLLY||(this._state&Rt.ZOOM)===Rt.ZOOM){const Z=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,ie=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0,se=this.dollyDragInverted?-1:1;(this._state&Rt.DOLLY)===Rt.DOLLY?(this._dollyInternal(se*C*iL,Z,ie),this._isUserControllingDolly=!0):(this._zoomInternal(se*C*iL,Z,ie),this._isUserControllingZoom=!0)}if((this._state&Rt.TOUCH_DOLLY)===Rt.TOUCH_DOLLY||(this._state&Rt.TOUCH_ZOOM)===Rt.TOUCH_ZOOM||(this._state&Rt.TOUCH_DOLLY_TRUCK)===Rt.TOUCH_DOLLY_TRUCK||(this._state&Rt.TOUCH_ZOOM_TRUCK)===Rt.TOUCH_ZOOM_TRUCK||(this._state&Rt.TOUCH_DOLLY_SCREEN_PAN)===Rt.TOUCH_DOLLY_SCREEN_PAN||(this._state&Rt.TOUCH_ZOOM_SCREEN_PAN)===Rt.TOUCH_ZOOM_SCREEN_PAN||(this._state&Rt.TOUCH_DOLLY_OFFSET)===Rt.TOUCH_DOLLY_OFFSET||(this._state&Rt.TOUCH_ZOOM_OFFSET)===Rt.TOUCH_ZOOM_OFFSET||(this._state&Rt.TOUCH_DOLLY_ROTATE)===Rt.TOUCH_DOLLY_ROTATE||(this._state&Rt.TOUCH_ZOOM_ROTATE)===Rt.TOUCH_ZOOM_ROTATE){const Z=ld.x-this._activePointers[1].clientX,ie=ld.y-this._activePointers[1].clientY,se=Math.sqrt(Z*Z+ie*ie),z=i.y-se;i.set(0,se);const re=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,ye=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&Rt.TOUCH_DOLLY)===Rt.TOUCH_DOLLY||(this._state&Rt.TOUCH_DOLLY_ROTATE)===Rt.TOUCH_DOLLY_ROTATE||(this._state&Rt.TOUCH_DOLLY_TRUCK)===Rt.TOUCH_DOLLY_TRUCK||(this._state&Rt.TOUCH_DOLLY_SCREEN_PAN)===Rt.TOUCH_DOLLY_SCREEN_PAN||(this._state&Rt.TOUCH_DOLLY_OFFSET)===Rt.TOUCH_DOLLY_OFFSET?(this._dollyInternal(z*iL,re,ye),this._isUserControllingDolly=!0):(this._zoomInternal(z*iL,re,ye),this._isUserControllingZoom=!0)}((this._state&Rt.TRUCK)===Rt.TRUCK||(this._state&Rt.TOUCH_TRUCK)===Rt.TOUCH_TRUCK||(this._state&Rt.TOUCH_DOLLY_TRUCK)===Rt.TOUCH_DOLLY_TRUCK||(this._state&Rt.TOUCH_ZOOM_TRUCK)===Rt.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(j,C,!1,!1),this._isUserControllingTruck=!0),((this._state&Rt.SCREEN_PAN)===Rt.SCREEN_PAN||(this._state&Rt.TOUCH_SCREEN_PAN)===Rt.TOUCH_SCREEN_PAN||(this._state&Rt.TOUCH_DOLLY_SCREEN_PAN)===Rt.TOUCH_DOLLY_SCREEN_PAN||(this._state&Rt.TOUCH_ZOOM_SCREEN_PAN)===Rt.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(j,C,!1,!0),this._isUserControllingTruck=!0),((this._state&Rt.OFFSET)===Rt.OFFSET||(this._state&Rt.TOUCH_OFFSET)===Rt.TOUCH_OFFSET||(this._state&Rt.TOUCH_DOLLY_OFFSET)===Rt.TOUCH_DOLLY_OFFSET||(this._state&Rt.TOUCH_ZOOM_OFFSET)===Rt.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(j,C,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},A=()=>{TX(this._activePointers,ld),r.copy(ld),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",I),this._domElement.ownerDocument.addEventListener("pointerlockerror",D),this._domElement.ownerDocument.addEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),b())},this.unlockPointer=()=>{var P,U,j;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(P=this._domElement)===null||P===void 0||P.ownerDocument.exitPointerLock(),(U=this._domElement)===null||U===void 0||U.ownerDocument.removeEventListener("pointerlockchange",I),(j=this._domElement)===null||j===void 0||j.ownerDocument.removeEventListener("pointerlockerror",D),this.cancel()};const I=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},D=()=>{this.unlockPointer()};this._addAllEventListeners=P=>{this._domElement=P,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",m,{passive:!1}),this._domElement.addEventListener("contextmenu",y)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",m,{passive:!1}),this._domElement.removeEventListener("contextmenu",y),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("pointerlockchange",I),this._domElement.ownerDocument.removeEventListener("pointerlockerror",D))},this.cancel=()=>{this._state!==Rt.NONE&&(this._state=Rt.NONE,this._activePointers.length=0,A())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=Jf(e.width,0,1),this._interactiveArea.height=Jf(e.height,0,1),this._interactiveArea.x=Jf(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Jf(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,n=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,n)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,n=!1){this._isUserControllingRotate=!1;const r=Jf(e,this.minAzimuthAngle,this.maxAzimuthAngle),i=Jf(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=i,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!n||Rs(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Rs(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=L_.NONE,this._changedDolly=0,this._dollyToNoClamp(Jf(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const n=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),l=Rs(o,this._spherical.radius);if(!(n>e)&&l)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,o)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const i=!t||Rs(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(cC).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const n=!t||Rs(this._target.x,this._targetEnd.x,this.restThreshold)&&Rs(this._target.y,this._targetEnd.y,this.restThreshold)&&Rs(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=Jf(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const n=!t||Rs(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(e,t,n=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,n)}truck(e,t,n=!1){this._camera.updateMatrix(),tg.setFromMatrixColumn(this._camera.matrix,0),ng.setFromMatrixColumn(this._camera.matrix,1),tg.multiplyScalar(e),ng.multiplyScalar(-t);const r=wi.copy(tg).add(ng),i=ys.copy(this._targetEnd).add(r);return this.moveTo(i.x,i.y,i.z,n)}forward(e,t=!1){wi.setFromMatrixColumn(this._camera.matrix,0),wi.crossVectors(this._camera.up,wi),wi.multiplyScalar(e);const n=ys.copy(this._targetEnd).add(wi);return this.moveTo(n.x,n.y,n.z,t)}elevate(e,t=!1){return wi.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+wi.x,this._targetEnd.y+wi.y,this._targetEnd.z+wi.z,t)}moveTo(e,t,n,r=!1){this._isUserControllingTruck=!1;const i=wi.set(e,t,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,i,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);const o=!r||Rs(this._target.x,this._targetEnd.x,this.restThreshold)&&Rs(this._target.y,this._targetEnd.y,this.restThreshold)&&Rs(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,t,n,r=!1){const l=wi.set(e,t,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(l.x,l.y,l.z,r)}fitToBox(e,t,{cover:n=!1,paddingLeft:r=0,paddingRight:i=0,paddingBottom:o=0,paddingTop:l=0}={}){const c=[],h=e.isBox3?U_.copy(e):U_.setFromObject(e);h.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const m=nbe(this._sphericalEnd.theta,tbe),y=nbe(this._sphericalEnd.phi,tbe);c.push(this.rotateTo(m,y,t));const b=wi.setFromSpherical(this._sphericalEnd).normalize(),w=lbe.setFromUnitVectors(b,CX),A=Rs(Math.abs(b.y),1);A&&w.multiply(NX.setFromAxisAngle(sL,m)),w.multiply(this._yAxisUpSpaceInverse);const I=abe.makeEmpty();ys.copy(h.min).applyQuaternion(w),I.expandByPoint(ys),ys.copy(h.min).setX(h.max.x).applyQuaternion(w),I.expandByPoint(ys),ys.copy(h.min).setY(h.max.y).applyQuaternion(w),I.expandByPoint(ys),ys.copy(h.max).setZ(h.min.z).applyQuaternion(w),I.expandByPoint(ys),ys.copy(h.min).setZ(h.max.z).applyQuaternion(w),I.expandByPoint(ys),ys.copy(h.max).setY(h.min.y).applyQuaternion(w),I.expandByPoint(ys),ys.copy(h.max).setX(h.min.x).applyQuaternion(w),I.expandByPoint(ys),ys.copy(h.max).applyQuaternion(w),I.expandByPoint(ys),I.min.x-=r,I.min.y-=o,I.max.x+=i,I.max.y+=l,w.setFromUnitVectors(CX,b),A&&w.premultiply(NX.invert()),w.premultiply(this._yAxisUpSpace);const D=I.getSize(wi),P=I.getCenter(ys).applyQuaternion(w);if(w6(this._camera)){const U=this.getDistanceToFitBox(D.x,D.y,D.z,n);c.push(this.moveTo(P.x,P.y,P.z,t)),c.push(this.dollyTo(U,t)),c.push(this.setFocalOffset(0,0,0,t))}else if(Gy(this._camera)){const U=this._camera,j=U.right-U.left,C=U.top-U.bottom,Z=n?Math.max(j/D.x,C/D.y):Math.min(j/D.x,C/D.y);c.push(this.moveTo(P.x,P.y,P.z,t)),c.push(this.zoomTo(Z,t)),c.push(this.setFocalOffset(0,0,0,t))}return Promise.all(c)}fitToSphere(e,t){const n=[],i="isObject3D"in e?ug.createBoundingSphere(e,AX):AX.copy(e);if(n.push(this.moveTo(i.center.x,i.center.y,i.center.z,t)),w6(this._camera)){const o=this.getDistanceToFitSphere(i.radius);n.push(this.dollyTo(o,t))}else if(Gy(this._camera)){const o=this._camera.right-this._camera.left,l=this._camera.top-this._camera.bottom,c=2*i.radius,h=Math.min(o/c,l/c);n.push(this.zoomTo(h,t))}return n.push(this.setFocalOffset(0,0,0,t)),Promise.all(n)}setLookAt(e,t,n,r,i,o,l=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=L_.NONE,this._changedDolly=0;const c=ys.set(r,i,o),h=wi.set(e,t,n);this._targetEnd.copy(c),this._sphericalEnd.setFromVector3(h.sub(c).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,l||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const m=!l||Rs(this._target.x,this._targetEnd.x,this.restThreshold)&&Rs(this._target.y,this._targetEnd.y,this.restThreshold)&&Rs(this._target.z,this._targetEnd.z,this.restThreshold)&&Rs(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Rs(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Rs(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(m)}lerpLookAt(e,t,n,r,i,o,l,c,h,m,y,b,w,A=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=L_.NONE,this._changedDolly=0;const I=wi.set(r,i,o),D=ys.set(e,t,n);gp.setFromVector3(D.sub(I).applyQuaternion(this._yAxisUpSpace));const P=B_.set(m,y,b),U=ys.set(l,c,h);uC.setFromVector3(U.sub(P).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(I.lerp(P,w));const j=uC.theta-gp.theta,C=uC.phi-gp.phi,Z=uC.radius-gp.radius;this._sphericalEnd.set(gp.radius+Z*w,gp.phi+C*w,gp.theta+j*w),this.normalizeRotations(),this._needsUpdate=!0,A||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const ie=!A||Rs(this._target.x,this._targetEnd.x,this.restThreshold)&&Rs(this._target.y,this._targetEnd.y,this.restThreshold)&&Rs(this._target.z,this._targetEnd.z,this.restThreshold)&&Rs(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Rs(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Rs(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(ie)}setPosition(e,t,n,r=!1){return this.setLookAt(e,t,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(e,t,n,r=!1){const i=this.getPosition(wi),o=this.setLookAt(i.x,i.y,i.z,e,t,n,r);return this._sphericalEnd.phi=Jf(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,t,n,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,n),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);const i=!r||Rs(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Rs(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Rs(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}setOrbitPoint(e,t,n){this._camera.updateMatrixWorld(),tg.setFromMatrixColumn(this._camera.matrixWorldInverse,0),ng.setFromMatrixColumn(this._camera.matrixWorldInverse,1),T6.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const r=wi.set(e,t,n),i=r.distanceTo(this._camera.position),o=r.sub(this._camera.position);tg.multiplyScalar(o.x),ng.multiplyScalar(o.y),T6.multiplyScalar(o.z),wi.copy(tg).add(ng).add(T6),wi.z=wi.z+i,this.dollyTo(i,!1),this.setFocalOffset(-wi.x,wi.y,-wi.z,!1),this.moveTo(e,t,n,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,n,r){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new oi.Vector4,typeof e=="number"?this._viewport.set(e,t,n,r):this._viewport.copy(e)}getDistanceToFitBox(e,t,n,r=!1){if(EX(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const i=e/t,o=this._camera.getEffectiveFOV()*oC,l=this._camera.aspect;return((r?i>l:i<l)?t:e/l)*.5/Math.tan(o*.5)+n*.5}getDistanceToFitSphere(e){if(EX(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*oC,n=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,r=1<this._camera.aspect?t:n;return e/Math.sin(r*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new oi.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new oi.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new oi.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new oi.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%F_,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=F_),this._spherical.theta+=F_*Math.round((this._sphericalEnd.theta-this._spherical.theta)/F_)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!Rs(this._camera.up.x,this._cameraUp0.x)||!Rs(this._camera.up.y,this._cameraUp0.y)||!Rs(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const n=this.getPosition(wi);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,sL),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=wi.subVectors(this._target,this._camera.position).normalize(),t=ys.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const n=this.getPosition(wi);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,i=sbe.subVectors(this._targetEnd,this._target),o=obe.subVectors(this._focalOffsetEnd,this._focalOffset),l=this._zoomEnd-this._zoom;if(fo(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const y=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=rL(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,y,1/0,e),this._needsUpdate=!0}if(fo(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const y=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=rL(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,y,1/0,e),this._needsUpdate=!0}if(fo(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const y=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=rL(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,y,this.maxSpeed,e),this._needsUpdate=!0}if(fo(i.x)&&fo(i.y)&&fo(i.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const y=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;rbe(this._target,this._targetEnd,this._targetVelocity,y,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(fo(o.x)&&fo(o.y)&&fo(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const y=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;rbe(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,y,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(fo(l))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const y=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=rL(this._zoom,this._zoomEnd,this._zoomVelocity,y,1/0,e)}if(this.dollyToCursor){if(w6(this._camera)&&this._changedDolly!==0){const y=this._spherical.radius-this._lastDistance,b=this._camera,w=this._getCameraDirection(cC),A=wi.copy(w).cross(b.up).normalize();A.lengthSq()===0&&(A.x=1);const I=ys.crossVectors(A,w),D=this._sphericalEnd.radius*Math.tan(b.getEffectiveFOV()*oC*.5),U=(this._sphericalEnd.radius-y-this._sphericalEnd.radius)/this._sphericalEnd.radius,j=B_.copy(this._targetEnd).add(A.multiplyScalar(this._dollyControlCoord.x*D*b.aspect)).add(I.multiplyScalar(this._dollyControlCoord.y*D)),C=wi.copy(this._targetEnd).lerp(j,U),Z=this._lastDollyDirection===L_.IN&&this._spherical.radius<=this.minDistance,ie=this._lastDollyDirection===L_.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(Z||ie)){this._sphericalEnd.radius-=y,this._spherical.radius-=y;const z=ys.copy(w).multiplyScalar(-y);C.add(z)}this._boundary.clampPoint(C,C);const se=ys.subVectors(C,this._targetEnd);this._targetEnd.copy(C),this._target.add(se),this._changedDolly-=y,fo(this._changedDolly)&&(this._changedDolly=0)}else if(Gy(this._camera)&&this._changedZoom!==0){const y=this._zoom-this._lastZoom,b=this._camera,w=wi.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(b.near+b.far)/(b.near-b.far)).unproject(b),A=ys.set(0,0,-1).applyQuaternion(b.quaternion),I=B_.copy(w).add(A.multiplyScalar(-w.dot(b.up))),P=-(this._zoom-y-this._zoom)/this._zoom,U=this._getCameraDirection(cC),j=this._targetEnd.dot(U),C=wi.copy(this._targetEnd).lerp(I,P),Z=C.dot(U),ie=U.multiplyScalar(Z-j);C.sub(ie),this._boundary.clampPoint(C,C);const se=ys.subVectors(C,this._targetEnd);this._targetEnd.copy(C),this._target.add(se),this._changedZoom-=y,fo(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const c=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,c),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!fo(this._focalOffset.x)||!fo(this._focalOffset.y)||!fo(this._focalOffset.z))&&(tg.setFromMatrixColumn(this._camera.matrix,0),ng.setFromMatrixColumn(this._camera.matrix,1),T6.setFromMatrixColumn(this._camera.matrix,2),tg.multiplyScalar(this._focalOffset.x),ng.multiplyScalar(-this._focalOffset.y),T6.multiplyScalar(this._focalOffset.z),wi.copy(tg).add(ng).add(T6),this._camera.position.add(wi),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),wi.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const m=this._needsUpdate;return m&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):m?(this.dispatchEvent({type:"update"}),fo(t,this.restThreshold)&&fo(n,this.restThreshold)&&fo(r,this.restThreshold)&&fo(i.x,this.restThreshold)&&fo(i.y,this.restThreshold)&&fo(i.z,this.restThreshold)&&fo(o.x,this.restThreshold)&&fo(o.y,this.restThreshold)&&fo(o.z,this.restThreshold)&&fo(l,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!m&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=m,this._needsUpdate=!1,m}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:aC(this.maxDistance),minZoom:this.minZoom,maxZoom:aC(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:aC(this.maxPolarAngle),minAzimuthAngle:aC(this.minAzimuthAngle),maxAzimuthAngle:aC(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:wi.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const n=JSON.parse(e);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=lC(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=lC(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=lC(n.maxPolarAngle),this.minAzimuthAngle=lC(n.minAzimuthAngle),this.maxAzimuthAngle=lC(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],t),gp.setFromVector3(wi.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(gp.theta,gp.phi,t),this.dollyTo(gp.radius,t),this.zoomTo(n.zoom,t),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",eat),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,n){const r=t.lengthSq();if(r===0)return e;const i=ys.copy(t).add(e),l=this._boundary.clampPoint(i,B_).sub(i),c=l.lengthSq();if(c===0)return e.add(t);if(c===r)return e;if(n===0)return e.add(t).add(l);{const h=1+n*c/t.dot(l);return e.add(ys.copy(t).multiplyScalar(h)).add(l.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(w6(this._camera)){const e=this._camera,t=e.near,n=e.getEffectiveFOV()*oC,r=Math.tan(n*.5)*t,i=r*e.aspect;this._nearPlaneCorners[0].set(-i,-r,0),this._nearPlaneCorners[1].set(i,-r,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(-i,r,0)}else if(Gy(this._camera)){const e=this._camera,t=1/e.zoom,n=e.left*t,r=e.right*t,i=e.top*t,o=e.bottom*t;this._nearPlaneCorners[0].set(n,i,0),this._nearPlaneCorners[1].set(r,i,0),this._nearPlaneCorners[2].set(r,o,0),this._nearPlaneCorners[3].set(n,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||EX(this._camera,"_collisionTest"))return e;const n=this._getTargetDirection(cC);PX.lookAt(ibe,n,this._camera.up);for(let r=0;r<4;r++){const i=ys.copy(this._nearPlaneCorners[r]);i.applyMatrix4(PX);const o=B_.addVectors(this._target,i);oL.set(o,n),oL.far=this._spherical.radius+1;const l=oL.intersectObjects(this.colliderMeshes);l.length!==0&&l[0].distance<e&&(e=l[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const n=()=>{this.removeEventListener("rest",n),t()};this.addEventListener("rest",n)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new oi.Sphere){const n=t,r=n.center;U_.makeEmpty(),e.traverseVisible(o=>{o.isMesh&&U_.expandByObject(o)}),U_.getCenter(r);let i=0;return e.traverseVisible(o=>{if(!o.isMesh)return;const l=o;if(!l.geometry)return;const c=l.geometry.clone();c.applyMatrix4(l.matrixWorld);const m=c.attributes.position;for(let y=0,b=m.count;y<b;y++)wi.fromBufferAttribute(m,y),i=Math.max(i,r.distanceToSquared(wi))}),n.radius=Math.sqrt(i),n}}const OF=s=>{const[e,t]=On.useState(s.options[s.index]),n=()=>{s.onToggle(!s.open)},r=o=>{o!==e&&(s.onSelect(o),t(o)),s.onToggle(!1)},i=s.open?`${s.options.length*31-1}px`:"0px";return ot.jsxs("div",{className:`dropdown ${s.up===!0?"up":""}`,children:[ot.jsx("div",{className:"dropdown-toggle",onClick:n,children:`${s.title}: ${e}`}),ot.jsx("ul",{className:"dropdown-menu",style:{height:i},children:s.options.map(o=>ot.jsx("li",{onClick:()=>r(o),children:o},o))})]})},E6=On.forwardRef(function(e,t){const n=["Renderer","Depth","Normals","UVs","Wireframe"],[r,i]=On.useState("Renderer"),[o,l]=On.useState(!1),[c,h]=On.useState(!1),[m,y]=On.useState(!1);return ot.jsxs("div",{className:`CameraWindow ${e.name}`,children:[ot.jsx("div",{ref:t,className:"clickable",onClick:()=>{m&&y(!1)}}),ot.jsxs("div",{className:"options",children:[e.camera!==null&&ot.jsx(OF,{title:"Camera",index:e.options.indexOf(e.camera.name),open:m,options:e.options,onSelect:e.onSelectCamera,onToggle:b=>{b&&c&&h(!1),y(b)},up:!0}),ot.jsx(OF,{title:"Mode",index:n.indexOf(r),open:c,options:n,onSelect:b=>{if(b===r)return;const w=b;e.onSelectRenderMode(w),i(w)},onToggle:b=>{b&&m&&y(!1),o&&l(!1),h(b)},up:!0})]})]})}),nat=`out vec3 worldPosition;
uniform float uDistance;

void main() {
  // Scale the plane by the drawing distance
  worldPosition = position.xzy * uDistance;
  worldPosition.xz += cameraPosition.xz;

  gl_Position = projectionMatrix * modelViewMatrix * vec4(worldPosition, 1.0);
}`,rat=`out vec4 fragColor;
in vec3 worldPosition;
uniform float uDivisions;
uniform float uScale;
uniform vec3 uColor;
uniform float uDistance;
uniform float uGridOpacity;
uniform float uSubgridOpacity;

#define minAlpha 0.00784313725490196

float getGrid(float gapSize) {
  vec2 worldPositionByDivision = worldPosition.xz / gapSize;

  // Inverted, 0 where line, >1 where there's no line
  // We use the worldPosition (which in this case we use similarly to UVs) differential to control the anti-aliasing
  // We need to do the -0.5)-0.5 trick because the result fades out from 0 to 1, and we want both
  // worldPositionByDivision == 0.3 and worldPositionByDivision == 0.7 to result in the same fade, i.e. 0.3,
  // otherwise only one side of the line will be anti-aliased
  vec2 grid = abs(fract(worldPositionByDivision-0.5)-0.5) / fwidth(worldPositionByDivision) / 2.0;
  float gridLine = min(grid.x, grid.y);

  // Uninvert and clamp
  return 1.0 - min(gridLine, 1.0);
}

void main() {
  float cameraDistanceToGridPlane = max(200.0, distance(cameraPosition.y, worldPosition.y));
  float cameraDistanceToFragmentOnGridPlane = distance(cameraPosition.xyz, worldPosition.xyz);

  // The size of the grid and subgrid are powers of each other and they are determined based on camera distance.
  // The current grid will become the next subgrid when it becomes too small, and its next power becomes the new grid.
  float subGridPower = pow(uDivisions, floor(log(cameraDistanceToGridPlane) / log(uDivisions)));
  float gridPower = subGridPower * uDivisions;

  // If we want to fade both the grid and its subgrid, we need to displays 3 different opacities, with the next grid being the third
  float nextGridPower = gridPower * uDivisions;

  // 1 where grid, 0 where no grid
  float subgrid = getGrid(subGridPower * uScale);
  float grid = getGrid(gridPower * uScale);
  float nextGrid = getGrid(nextGridPower * uScale);

  // Where we are between the introduction of the current grid power and when we switch to the next grid power
  float stepPercentage = (cameraDistanceToGridPlane - subGridPower)/(gridPower - subGridPower);

  // The last x percentage of the current step over which we want to fade
  float fadeRange = 0.3;

  // We calculate the fade percentage from the step percentage and the fade range
  float fadePercentage = max(stepPercentage - 1.0 + fadeRange, 0.0) / fadeRange;

  // Set base opacity based on how close we are to the drawing distance, with a cubic falloff
  float baseOpacity = subgrid * pow(1.0 - min(cameraDistanceToFragmentOnGridPlane / uDistance, 1.0), 3.0);

  // Shade the subgrid
  fragColor = vec4(uColor.rgb, (baseOpacity - fadePercentage) * uSubgridOpacity);

  // Somewhat arbitrary additional fade coefficient to counter anti-aliasing popping when switching between grid powers
  float fadeCoefficient = 0.5;

  // Shade the grid
  fragColor.a = mix(fragColor.a, baseOpacity * uGridOpacity - fadePercentage * (uGridOpacity - uSubgridOpacity) * fadeCoefficient, grid);

  // Shade the next grid
  fragColor.a = mix(fragColor.a, baseOpacity * uGridOpacity, nextGrid);

  if (fragColor.a <= minAlpha) discard;
}`;class iat extends bh{constructor(e){super({extensions:{derivatives:!0},uniforms:{uScale:{value:(e==null?void 0:e.scale)!==void 0?e==null?void 0:e.scale:.1},uDivisions:{value:(e==null?void 0:e.divisions)!==void 0?e==null?void 0:e.divisions:10},uColor:{value:(e==null?void 0:e.color)!==void 0?e==null?void 0:e.color:new Tn(16777215)},uDistance:{value:(e==null?void 0:e.distance)!==void 0?e==null?void 0:e.distance:1e4},uSubgridOpacity:{value:(e==null?void 0:e.subgridOpacity)!==void 0?e==null?void 0:e.subgridOpacity:.15},uGridOpacity:{value:(e==null?void 0:e.gridOpacity)!==void 0?e==null?void 0:e.gridOpacity:.25}},glslVersion:AY,side:oa,transparent:!0,name:"InfiniteGrid",vertexShader:nat,fragmentShader:rat})}get color(){return this.uniforms.uColor.value}set color(e){this.uniforms.uColor.value=e}get gridOpacity(){return this.uniforms.uGridOpacity.value}set gridOpacity(e){this.uniforms.uGridOpacity.value=e}get subgridOpacity(){return this.uniforms.uSubgridOpacity.value}set subgridOpacity(e){this.uniforms.uSubgridOpacity.value=e}}class sat extends gn{constructor(t){const n=new iat(t);super(new Ng,n);qe(this,"gridMaterial");this.gridMaterial=n,this.frustumCulled=!1,this.name="InfiniteGridHelper"}get color(){return this.gridMaterial.color}set color(t){this.gridMaterial.color=t}get gridOpacity(){return this.gridMaterial.gridOpacity}set gridOpacity(t){this.gridMaterial.gridOpacity=t}get subgridOpacity(){return this.gridMaterial.subgridOpacity}set subgridOpacity(t){this.gridMaterial.subgridOpacity=t}}/**
 * @license
 * Copyright 2010-2026 Three.js Authors
 * SPDX-License-Identifier: MIT
 */Q.BRDF_GGX;Q.BRDF_Lambert;Q.BasicPointShadowFilter;Q.BasicShadowFilter;const cbe=Q.Break;Q.Const;const RX=Q.Continue;Q.DFGLUT;Q.D_GGX;const oat=Q.Discard;Q.EPSILON;Q.F_Schlick;const hd=Q.Fn;Q.INFINITY;const e0=Q.If,LF=Q.Loop;Q.NodeAccess;Q.NodeShaderStage;Q.NodeType;const aat=Q.NodeUpdateType;Q.PCFShadowFilter;Q.PCFSoftShadowFilter;Q.PI;Q.PI2;Q.TWO_PI;Q.HALF_PI;Q.PointShadowFilter;Q.Return;Q.Schlick_to_F0;Q.ShaderNode;Q.Stack;Q.Switch;Q.TBNViewMatrix;Q.VSMShadowFilter;Q.V_GGX_SmithCorrelated;Q.Var;Q.VarIntent;const hu=Q.abs;Q.acesFilmicToneMapping;Q.acos;Q.add;Q.addMethodChaining;Q.addNodeElement;Q.agxToneMapping;Q.all;Q.alphaT;Q.and;Q.anisotropy;Q.anisotropyB;Q.anisotropyT;Q.any;Q.append;Q.array;Q.arrayBuffer;Q.asin;Q.assign;Q.atan;Q.atomicAdd;Q.atomicAnd;Q.atomicFunc;Q.atomicLoad;Q.atomicMax;Q.atomicMin;Q.atomicOr;Q.atomicStore;Q.atomicSub;Q.atomicXor;Q.attenuationColor;Q.attenuationDistance;Q.attribute;Q.attributeArray;Q.backgroundBlurriness;Q.backgroundIntensity;Q.backgroundRotation;Q.batch;Q.bentNormalView;Q.billboarding;Q.bitAnd;Q.bitNot;Q.bitOr;Q.bitXor;Q.bitangentGeometry;Q.bitangentLocal;Q.bitangentView;Q.bitangentWorld;Q.bitcast;Q.blendBurn;Q.blendColor;Q.blendDodge;Q.blendOverlay;Q.blendScreen;Q.blur;const lat=Q.bool;Q.buffer;Q.bufferAttribute;Q.bumpMap;Q.builtin;Q.builtinAOContext;Q.builtinShadowContext;Q.bvec2;Q.bvec3;Q.bvec4;Q.bypass;Q.cache;Q.call;Q.cameraFar;Q.cameraIndex;Q.cameraNear;Q.cameraNormalMatrix;const aL=Q.cameraPosition,ube=Q.cameraProjectionMatrix;Q.cameraProjectionMatrixInverse;const dbe=Q.cameraViewMatrix;Q.cameraViewport;Q.cameraWorldMatrix;Q.cbrt;Q.cdl;Q.ceil;Q.checker;Q.cineonToneMapping;const cat=Q.clamp;Q.clearcoat;Q.clearcoatNormalView;Q.clearcoatRoughness;Q.clipSpace;Q.code;Q.color;Q.colorSpaceToWorking;Q.colorToDirection;Q.compute;Q.computeKernel;Q.computeSkinning;Q.context;Q.convert;Q.convertColorSpace;const uat=Q.convertToTexture;Q.countLeadingZeros;Q.countOneBits;Q.countTrailingZeros;const hbe=Q.cos;Q.cross;Q.cubeTexture;Q.cubeTextureBase;Q.dFdx;Q.dFdy;Q.dashSize;Q.debug;Q.decrement;Q.decrementBefore;Q.defaultBuildStages;Q.defaultShaderStages;Q.defined;Q.degrees;Q.deltaTime;Q.densityFog;Q.densityFogFactor;Q.depth;Q.depthPass;Q.determinant;Q.difference;Q.diffuseColor;Q.directPointLight;Q.directionToColor;Q.directionToFaceDirection;Q.dispersion;const dat=Q.distance;Q.div;const FCe=Q.dot;Q.drawIndex;Q.dynamicBufferAttribute;Q.element;Q.emissive;Q.equal;Q.equirectUV;Q.exp;Q.exp2;Q.exponentialHeightFogFactor;Q.expression;Q.faceDirection;Q.faceForward;Q.faceforward;const Ji=Q.float;Q.floatBitsToInt;Q.floatBitsToUint;const hat=Q.floor;Q.fog;const pat=Q.fract;Q.frameGroup;Q.frameId;Q.frontFacing;const fat=Q.fwidth;Q.gain;Q.gapSize;Q.getConstNodeType;Q.getCurrentStack;Q.getDirection;Q.getDistanceAttenuation;Q.getGeometryRoughness;Q.getNormalFromDepth;Q.interleavedGradientNoise;Q.vogelDiskSample;Q.getParallaxCorrectNormal;Q.getRoughness;Q.getScreenPosition;Q.getShIrradianceAt;Q.getShadowMaterial;Q.getShadowRenderObjectFunction;Q.getTextureIndex;Q.getViewPosition;Q.globalId;Q.glsl;Q.glslFn;Q.grayscale;Q.greaterThan;Q.greaterThanEqual;Q.hash;Q.highpModelNormalViewMatrix;Q.highpModelViewMatrix;Q.hue;Q.increment;Q.incrementBefore;Q.instance;const lh=Q.instanceIndex,lL=Q.instancedArray;Q.instancedBufferAttribute;Q.instancedDynamicBufferAttribute;Q.instancedMesh;const pbe=Q.int;Q.intBitsToFloat;Q.inverse;Q.inverseSqrt;Q.inversesqrt;Q.invocationLocalIndex;Q.invocationSubgroupIndex;Q.ior;Q.iridescence;Q.iridescenceIOR;Q.iridescenceThickness;Q.ivec2;Q.ivec3;Q.ivec4;Q.js;Q.label;const dC=Q.length;Q.lengthSq;Q.lessThan;const mat=Q.lessThanEqual;Q.lightPosition;Q.lightProjectionUV;Q.lightShadowMatrix;Q.lightTargetDirection;Q.lightTargetPosition;Q.lightViewPosition;Q.lightingContext;Q.lights;Q.linearDepth;Q.linearToneMapping;Q.localId;const fbe=Q.log;Q.log2;Q.logarithmicDepthToViewZ;Q.luminance;Q.mat2;const mbe=Q.mat3;Q.mat4;Q.matcapUV;Q.materialAO;Q.materialAlphaTest;Q.materialAnisotropy;Q.materialAnisotropyVector;Q.materialAttenuationColor;Q.materialAttenuationDistance;Q.materialClearcoat;Q.materialClearcoatNormal;Q.materialClearcoatRoughness;Q.materialColor;Q.materialDispersion;Q.materialEmissive;Q.materialEnvIntensity;Q.materialEnvRotation;Q.materialIOR;Q.materialIridescence;Q.materialIridescenceIOR;Q.materialIridescenceThickness;Q.materialLightMap;Q.materialLineDashOffset;Q.materialLineDashSize;Q.materialLineGapSize;Q.materialLineScale;Q.materialLineWidth;Q.materialMetalness;Q.materialNormal;Q.materialOpacity;Q.materialPointSize;Q.materialReference;Q.materialReflectivity;Q.materialRefractionRatio;Q.materialRotation;Q.materialRoughness;Q.materialSheen;Q.materialSheenRoughness;Q.materialShininess;Q.materialSpecular;Q.materialSpecularColor;Q.materialSpecularIntensity;Q.materialSpecularStrength;Q.materialThickness;Q.materialTransmission;const Y6=Q.max;Q.maxMipLevel;Q.mediumpModelViewMatrix;Q.metalness;const eF=Q.min,gbe=Q.mix;Q.mixElement;Q.mod;Q.modInt;Q.modelDirection;Q.modelNormalMatrix;Q.modelPosition;Q.modelRadius;Q.modelScale;Q.modelViewMatrix;Q.modelViewPosition;Q.modelViewProjection;const gat=Q.modelWorldMatrix;Q.modelWorldMatrixInverse;Q.morphReference;const tJ=Q.mrt;Q.mul;Q.mx_aastep;Q.mx_add;Q.mx_atan2;Q.mx_cell_noise_float;Q.mx_contrast;Q.mx_divide;Q.mx_fractal_noise_float;Q.mx_fractal_noise_vec2;Q.mx_fractal_noise_vec3;Q.mx_fractal_noise_vec4;Q.mx_frame;Q.mx_heighttonormal;Q.mx_hsvtorgb;Q.mx_ifequal;Q.mx_ifgreater;Q.mx_ifgreatereq;Q.mx_invert;Q.mx_modulo;Q.mx_multiply;Q.mx_noise_float;Q.mx_noise_vec3;Q.mx_noise_vec4;Q.mx_place2d;Q.mx_power;Q.mx_ramp4;Q.mx_ramplr;Q.mx_ramptb;Q.mx_rgbtohsv;Q.mx_rotate2d;Q.mx_rotate3d;Q.mx_safepower;Q.mx_separate;Q.mx_splitlr;Q.mx_splittb;Q.mx_srgb_texture_to_lin_rec709;Q.mx_subtract;Q.mx_timer;Q.mx_transform_uv;Q.mx_unifiednoise2d;Q.mx_unifiednoise3d;Q.mx_worley_noise_float;Q.mx_worley_noise_vec2;Q.mx_worley_noise_vec3;const IX=Q.negate;Q.neutralToneMapping;Q.nodeArray;Q.nodeImmutable;Q.nodeObject;Q.nodeObjectIntent;Q.nodeObjects;Q.nodeProxy;Q.nodeProxyIntent;Q.normalFlat;Q.normalGeometry;Q.normalLocal;Q.normalMap;Q.normalView;Q.normalViewGeometry;Q.normalWorld;Q.normalWorldGeometry;const M6=Q.normalize;Q.not;Q.notEqual;Q.numWorkgroups;Q.objectDirection;Q.objectGroup;Q.objectPosition;Q.objectRadius;Q.objectScale;Q.objectViewPosition;Q.objectWorldMatrix;Q.OnBeforeObjectUpdate;Q.OnBeforeMaterialUpdate;Q.OnObjectUpdate;const yat=Q.OnMaterialUpdate;Q.oneMinus;Q.or;Q.orthographicDepthToViewZ;Q.oscSawtooth;Q.oscSine;Q.oscSquare;Q.oscTriangle;const nJ=Q.output;Q.outputStruct;Q.overloadingFn;Q.packHalf2x16;Q.packSnorm2x16;Q.packUnorm2x16;Q.parabola;Q.parallaxDirection;Q.parallaxUV;Q.parameter;const BCe=Q.pass;Q.passTexture;Q.pcurve;Q.perspectiveDepthToViewZ;Q.pmremTexture;Q.pointShadow;Q.pointUV;Q.pointWidth;Q.positionGeometry;const tF=Q.positionLocal;Q.positionPrevious;Q.positionView;Q.positionViewDirection;Q.positionWorld;Q.positionWorldDirection;Q.posterize;const ybe=Q.pow;Q.pow2;Q.pow3;Q.pow4;Q.premultiplyAlpha;Q.property;Q.radians;Q.rand;Q.range;Q.rangeFog;Q.rangeFogFactor;Q.reciprocal;Q.reference;Q.referenceBuffer;Q.reflect;Q.reflectVector;Q.reflectView;Q.reflector;Q.refract;Q.refractVector;Q.refractView;Q.reinhardToneMapping;Q.remap;Q.remapClamp;Q.renderGroup;const vat=Q.renderOutput;Q.rendererReference;Q.replaceDefaultUV;Q.rotate;Q.rotateUV;Q.roughness;Q.round;Q.rtt;Q.sRGBTransferEOTF;Q.sRGBTransferOETF;Q.sample;Q.sampler;Q.samplerComparison;Q.saturate;Q.saturation;Q.screen;Q.screenCoordinate;Q.screenDPR;Q.screenSize;const xat=Q.screenUV,kX=Q.select;Q.setCurrentStack;Q.setName;Q.shaderStages;Q.shadow;Q.shadowPositionWorld;Q.shapeCircle;Q.sharedUniformGroup;Q.sheen;Q.sheenRoughness;Q.shiftLeft;Q.shiftRight;Q.shininess;Q.sign;const bat=Q.sin;Q.sinc;Q.skinning;const _at=Q.smoothstep;Q.smoothstepElement;Q.specularColor;Q.specularF90;Q.spherizeUV;Q.split;Q.spritesheetUV;const Sat=Q.sqrt;Q.stack;const cL=Q.step;Q.stepElement;Q.storage;Q.storageBarrier;Q.storageTexture;Q.string;Q.struct;Q.sub;Q.subgroupAdd;Q.subgroupAll;Q.subgroupAnd;Q.subgroupAny;Q.subgroupBallot;Q.subgroupBroadcast;Q.subgroupBroadcastFirst;Q.subBuild;Q.subgroupElect;Q.subgroupExclusiveAdd;Q.subgroupExclusiveMul;Q.subgroupInclusiveAdd;Q.subgroupInclusiveMul;Q.subgroupIndex;Q.subgroupMax;Q.subgroupMin;Q.subgroupMul;Q.subgroupOr;Q.subgroupShuffle;Q.subgroupShuffleDown;Q.subgroupShuffleUp;Q.subgroupShuffleXor;Q.subgroupSize;Q.subgroupXor;Q.tan;Q.tangentGeometry;Q.tangentLocal;Q.tangentView;Q.tangentWorld;Q.texture;Q.texture3D;Q.textureBarrier;Q.textureBicubic;Q.textureBicubicLevel;Q.textureCubeUV;Q.textureLoad;Q.textureSize;Q.textureLevel;Q.textureStore;Q.thickness;Q.time;Q.toneMapping;Q.toneMappingExposure;Q.toonOutlinePass;Q.transformDirection;Q.transformNormal;Q.transformNormalToView;Q.transformedClearcoatNormalView;Q.transformedNormalView;Q.transformedNormalWorld;Q.transmission;Q.transpose;Q.triNoise3D;Q.triplanarTexture;Q.triplanarTextures;Q.trunc;const vbe=Q.uint;Q.uintBitsToFloat;const _l=Q.uniform,wat=Q.uniformArray;Q.uniformCubeTexture;Q.uniformGroup;Q.uniformFlow;Q.uniformTexture;Q.unpackHalf2x16;Q.unpackSnorm2x16;Q.unpackUnorm2x16;Q.unpremultiplyAlpha;Q.userData;const UCe=Q.uv;Q.uvec2;Q.uvec3;Q.uvec4;Q.varying;const zCe=Q.varyingProperty,kC=Q.vec2,cw=Q.vec3,ZC=Q.vec4;Q.vectorComponents;const VCe=Q.velocity;Q.vertexColor;const xbe=Q.vertexIndex;Q.vertexStage;Q.vibrance;Q.viewZToLogarithmicDepth;Q.viewZToOrthographicDepth;Q.viewZToPerspectiveDepth;Q.viewZToReversedOrthographicDepth;Q.viewZToReversedPerspectiveDepth;Q.viewport;Q.viewportCoordinate;Q.viewportDepthTexture;Q.viewportLinearDepth;Q.viewportMipTexture;Q.viewportOpaqueMipTexture;Q.viewportResolution;Q.viewportSafeUV;Q.viewportSharedTexture;Q.viewportSize;Q.viewportTexture;Q.viewportUV;Q.wgsl;Q.wgslFn;Q.workgroupArray;Q.workgroupBarrier;Q.workgroupId;Q.workingToColorSpace;Q.xor;class Tat extends xo{constructor(t){super();qe(this,"uScale");qe(this,"uDivisions");qe(this,"uColor");qe(this,"uDistance");qe(this,"uSubgridOpacity");qe(this,"uGridOpacity");this.name="InfiniteGrid",this.side=oa,this.transparent=!0,this.uScale=_l((t==null?void 0:t.scale)??.1),this.uDivisions=_l((t==null?void 0:t.divisions)??10),this.uColor=_l((t==null?void 0:t.color)??new Tn(16777215)),this.uDistance=_l((t==null?void 0:t.distance)??1e4),this.uSubgridOpacity=_l((t==null?void 0:t.subgridOpacity)??.15),this.uGridOpacity=_l((t==null?void 0:t.gridOpacity)??.25);const{uScale:n,uDivisions:r,uColor:i,uDistance:o,uSubgridOpacity:l,uGridOpacity:c}=this,h=zCe("vec3","vWorldPosition");this.positionNode=hd(()=>{const y=tF.xzy.mul(o).add(cw(aL.x,Ji(0),aL.z));return h.assign(y),y})();const m=hd(([y])=>{const b=h.xz.div(y),w=fat(b),A=hu(pat(b.sub(.5)).sub(.5)).div(w).div(2),I=eF(A.x,A.y);return Ji(1).sub(eF(I,Ji(1)))});this.outputNode=hd(()=>{const y=h,b=Y6(Ji(200),hu(aL.y.sub(y.y))),w=Ji(dat(aL,y)),A=fbe(b).div(fbe(r)),I=ybe(r,hat(A)),D=I.mul(r),P=D.mul(r),U=m(I.mul(n)),j=m(D.mul(n)),C=m(P.mul(n)),Z=b.sub(I).div(D.sub(I)),ie=Ji(.3),se=Y6(Z.sub(Ji(1)).add(ie),Ji(0)).div(ie),z=U.mul(ybe(Ji(1).sub(eF(w.div(o),Ji(1))),Ji(3))),re=Ji(.5),ye=z.sub(se).mul(l),H=gbe(ye,z.mul(c).sub(se.mul(c.sub(l)).mul(re)),j),Me=Ji(gbe(H,z.mul(c),C));return e0(mat(Me,Ji(1/127)),()=>{oat()}),ZC(i,Me)})()}get color(){return this.uColor.value}set color(t){this.uColor.value=t}get gridOpacity(){return this.uGridOpacity.value}set gridOpacity(t){this.uGridOpacity.value=t}get subgridOpacity(){return this.uSubgridOpacity.value}set subgridOpacity(t){this.uSubgridOpacity.value=t}}class Eat extends gn{constructor(t){const n=new Tat(t);super(new Ng,n);qe(this,"gridMaterial");this.gridMaterial=n,this.frustumCulled=!1,this.name="InfiniteGridHelper"}get color(){return this.gridMaterial.color}set color(t){this.gridMaterial.color=t}get gridOpacity(){return this.gridMaterial.gridOpacity}set gridOpacity(t){this.gridMaterial.gridOpacity=t}get subgridOpacity(){return this.gridMaterial.subgridOpacity}set subgridOpacity(t){this.gridMaterial.subgridOpacity=t}}function QC(s){const[e,t]=On.useState(s.open!==void 0?s.open:!1),[n,r]=On.useState(s.visible!==void 0?s.visible:!1),i=!e||s.children===void 0,o=()=>{s.three.dispatchEvent({type:Ci.REMOVE_SCENE,value:s.scene})};return ot.jsxs("div",{className:`accordion ${i?"hide":""}`,children:[ot.jsxs("button",{className:"toggle",onClick:()=>{const l=!e;s.onToggle!==void 0&&s.onToggle(l),t(l)},children:[ot.jsx("p",{className:`status ${e?"open":""}`,children:"Toggle"}),ot.jsx("p",{className:"label",children:pF(s.label)})]}),s.onRefresh?ot.jsxs(ot.Fragment,{children:[ot.jsx("button",{className:"visibility",style:{opacity:n?1:.25},onClick:()=>{const c=s.three.getScene(s.scene.uuid);if(c){const h=!c.visible;c.visible=h,r(h)}}}),ot.jsx("button",{className:"refresh",onClick:s.onRefresh}),ot.jsx("button",{className:"remove",onClick:o})]}):null,s.button,ot.jsx("div",{className:e?"open":"",children:ot.jsx("div",{children:s.children})},Math.random())]})}function DC(s){const[e,t]=On.useState(s.defaultValue);return On.useEffect(()=>{var w,A;let n=!1,r=-1,i=0,o=s.defaultValue,l=!1;const c=I=>{l=I.ctrlKey},h=I=>{var D;n=!0,i=Number((D=s.input.current)==null?void 0:D.value),r=I.clientX,document.addEventListener("mouseup",y,!1),document.addEventListener("mousemove",m,!1),document.addEventListener("contextmenu",y,!1)},m=I=>{if(!n)return;const D=s.step!==void 0?s.step:1,P=(I.clientX-r)*D*(l?10:1);o=Number((i+P).toFixed(4)),s.min!==void 0&&(o=Math.max(o,s.min)),s.max!==void 0&&(o=Math.min(o,s.max)),s.onChange!==void 0&&s.onChange(o),t(o)},y=()=>{n=!1,document.removeEventListener("mouseup",y),document.removeEventListener("mousemove",m),document.removeEventListener("contextmenu",y)},b=I=>{const D=Number(I.target.value);s.onChange!==void 0&&s.onChange(D),t(D)};return(w=s.label.current)==null||w.addEventListener("mousedown",h,!1),s.sliderRef!==void 0&&((A=s.sliderRef.current)==null||A.addEventListener("input",b)),document.addEventListener("keydown",c,!1),document.addEventListener("keyup",c,!1),()=>{var I,D;(I=s.label.current)==null||I.removeEventListener("mousedown",h),s.sliderRef!==void 0&&((D=s.sliderRef.current)==null||D.removeEventListener("input",b)),document.removeEventListener("mouseup",y),document.removeEventListener("mousemove",m),document.removeEventListener("contextmenu",y),document.removeEventListener("keydown",c),document.addEventListener("keyup",c,!1)}},[]),e}function nx(s){const e=On.useRef(null),t=On.useRef(null),[n,r]=On.useState(s.value);return DC({label:s.labelRef,input:e,sliderRef:t,defaultValue:n,min:s.min,max:s.max,step:s.step,onChange:i=>{r(i),s.onChange!==void 0&&s.onChange(s.prop,i)}}),ot.jsxs(ot.Fragment,{children:[s.type==="number"&&ot.jsx("input",{alt:s.alt,className:s.className,ref:e,type:"number",value:n,min:s.min,max:s.max,step:s.step,disabled:s.disabled,name:O0(),onChange:i=>{if(r(i.target.value),i.target.value.length===0)return;const o=Number(i.target.value);isNaN(o)||s.onChange!==void 0&&s.onChange(s.prop,o)}}),s.type==="range"&&ot.jsxs(ot.Fragment,{children:[ot.jsx("input",{type:"text",value:n.toString(),disabled:s.disabled,ref:e,className:"min",name:O0(),onChange:i=>{if(i.target.value.length===0)return;const o=Number(i.target.value);isNaN(o)||(r(o),s.onChange!==void 0&&s.onChange(s.prop,o))}}),ot.jsx("input",{disabled:s.disabled,type:"range",value:n,min:s.min,max:s.max,step:s.step,ref:t,name:O0(),onChange:PSe})]})]})}function Mat(s){const e=On.useRef(null),t=On.useRef(null),n=On.useRef(null),r=On.useRef(null),i=On.useRef(null),o=On.useRef(null),l=On.useRef(null),c=On.useRef(null),h=On.useRef(null),m=On.useRef(null),[y,b]=On.useState(s.value.x),[w,A]=On.useState(s.value.y),[I,D]=On.useState({min:Math.min(s.min,Math.min(s.value.x,s.value.y)),max:Math.max(s.max,Math.max(s.value.x,s.value.y))}),[P,U]=On.useState(!1);DC({label:l,input:e,defaultValue:y,min:I.min,max:I.max,step:.01,onChange:re=>{b(re),s.onChange({target:{value:{x:re,y:w}}})}}),DC({label:c,input:t,defaultValue:w,min:I.min,max:I.max,step:.01,onChange:re=>{A(re),s.onChange({target:{value:{x:y,y:re}}})}}),DC({label:h,input:n,defaultValue:I.min,min:I.min-1,max:I.max+1,step:.01,onChange:re=>{D({min:re,max:I.max})}}),DC({label:m,input:r,defaultValue:I.max,min:I.min-1,max:I.max+1,step:.01,onChange:re=>{D({min:I.min,max:re})}});function j(){P||(window.addEventListener("mousemove",Z),window.addEventListener("mouseup",C),U(!0))}function C(){window.removeEventListener("mousemove",Z),window.removeEventListener("mouseup",C),U(!1)}function Z(re){const ye=i.current.getBoundingClientRect(),H=k6(0,99,re.clientX-ye.left)/99,Me=1-k6(0,99,re.clientY-ye.top)/99,Oe=om(mK(I.min,I.max,H),3),Ue=om(mK(I.min,I.max,Me),3);s.onChange({target:{value:{x:Oe,y:Ue}}}),b(Oe),A(Ue)}function ie(){const re=Number(n.current.value);D({min:re,max:I.max}),y<re&&b(k6(re,I.max,y)),w<re&&A(k6(re,I.max,w))}function se(){const re=Number(r.current.value);D({min:I.min,max:re}),y>re&&b(k6(I.min,re,y)),w>re&&A(k6(I.min,re,w))}On.useEffect(()=>{o.current.style.left=`${B7e(I.min,I.max,y)*100}%`,o.current.style.top=`${(1-B7e(I.min,I.max,w))*100}%`},[I,y,w]);const z=s.step!==void 0?s.step:.01;return ot.jsxs("div",{className:"vector2",children:[ot.jsxs("div",{className:"fields",children:[ot.jsxs("div",{children:[ot.jsx("span",{ref:l,children:"X"}),ot.jsx("input",{ref:e,type:"number",value:y,min:I.min,max:I.max,step:z,name:O0(),onChange:re=>{if(b(re.target.value),re.target.value.length===0)return;const ye=Number(re.target.value);isNaN(ye)||(s.onChange({target:{value:{x:ye,y:w}}}),ye<I.min&&D({min:ye,max:I.max}))}})]}),ot.jsxs("div",{children:[ot.jsx("span",{ref:c,children:"Y"}),ot.jsx("input",{ref:t,type:"number",value:w,min:I.min,max:I.max,step:z,name:O0(),onChange:re=>{if(A(re.target.value),re.target.value.length===0)return;const ye=Number(re.target.value);isNaN(ye)||(s.onChange({target:{value:{x:y,y:ye}}}),ye>I.max&&D({min:I.min,max:ye}))}})]}),ot.jsxs("div",{children:[ot.jsx("span",{ref:h,children:"Min"}),ot.jsx("input",{ref:n,type:"number",value:I.min,step:z,name:O0(),onChange:ie})]}),ot.jsxs("div",{children:[ot.jsx("span",{ref:m,children:"Max"}),ot.jsx("input",{ref:r,type:"number",value:I.max,step:z,name:O0(),onChange:se})]})]}),ot.jsxs("div",{className:"input",ref:i,onMouseDown:j,onMouseUp:C,children:[ot.jsx("div",{className:"x"}),ot.jsx("div",{className:"y"}),ot.jsx("div",{className:"pt",ref:o})]})]})}function bbe(s){const e=s.value.x!==void 0&&s.value.y!==void 0&&s.value.z!==void 0,t=s.value.isEuler!==void 0,n=s.value.elements!==void 0,r=s.step!==void 0?s.step:.01,i=[];if(t){const o=On.useMemo(()=>s.value,[]);["_x","_y","_z"].forEach(c=>{const h=On.useRef(null);i.push(ot.jsxs("div",{children:[ot.jsx("span",{ref:h,children:c.substring(1).toUpperCase()}),ot.jsx(nx,{value:OCe(o[c]),type:"number",prop:c,step:.1,labelRef:h,onChange:(m,y)=>{o[m]=DF(y),s.onChange({target:{value:o}})}})]},c))})}else if(e){const o=On.useMemo(()=>s.value,[]),l=(h,m)=>{o[h]=m,s.onChange({target:{value:o}})};["x","y","z"].forEach(h=>{const m=On.useRef(null);i.push(ot.jsxs("div",{children:[ot.jsx("label",{ref:m,children:h.toUpperCase()}),ot.jsx(nx,{value:o[h],type:"number",prop:h,step:r,labelRef:m,onChange:l})]},h))})}else if(n){const o=On.useMemo(()=>s.value,[]),l=(c,h)=>{const m=Number(c);o.elements[m]=h,s.onChange({target:{value:o}})};for(let c=0;c<9;c++){const h=On.useRef(null);i.push(ot.jsxs("div",{children:[ot.jsx("label",{ref:h,children:c+1}),ot.jsx(nx,{value:o.elements[c],type:"number",prop:c.toString(),step:r,labelRef:h,onChange:l})]},c.toString()))}}return ot.jsx("div",{className:"grid3",children:i},Math.random().toString())}function Cat(s){const e=s.value.x!==void 0,t=s.step!==void 0?s.step:.01,n=[];if(e){const r=On.useMemo(()=>s.value,[]),i=(l,c)=>{r[l]=c,s.onChange({target:{value:r}})};["x","y","z","w"].forEach(l=>{const c=On.useRef(null);n.push(ot.jsxs("div",{children:[ot.jsx("label",{ref:c,children:l.toUpperCase()}),ot.jsx(nx,{value:r[l],type:"number",prop:l,step:t,labelRef:c,onChange:i})]},l))})}else{const r=On.useMemo(()=>s.value,[]),i=(o,l)=>{const c=Number(o);r.elements[c]=l,s.onChange({target:{value:r}})};for(let o=0;o<16;o++){const l=On.useRef(null);n.push(ot.jsxs("div",{children:[ot.jsx("span",{ref:l,children:o+1}),ot.jsx(nx,{value:r.elements[o],type:"number",prop:o.toString(),step:t,labelRef:l,onChange:i})]},o.toString()))}}return ot.jsx("div",{className:"grid4",children:n})}function Aat(s){return!(s==="defaultAttributeValues"||s==="forceSinglePass"||s==="linecap"||s==="linejoin"||s==="linewidth"||s==="normalMapType"||s==="precision"||s==="shadowSide"||s==="uniformsGroups"||s==="uniformsNeedUpdate"||s==="userData"||s==="version"||s==="wireframeLinecap"||s==="wireframeLinejoin"||s==="wireframeLinewidth"||s.slice(0,4)==="clip"||s.slice(0,7)==="polygon"||s.slice(0,7)==="stencil"||s.slice(0,2)==="is")}function Nat(s){switch(s){case"Alpha Map":return"alphaMap";case"Anisotropy Map":return"anisotropyMap";case"AO Map":return"aoMap";case"Bump Map":return"bumpMap";case"Clearcoat Map":return"clearcoatMap";case"Clearcoat Normal Map":return"clearcoatNormalMap";case"Clearcoat Roughness Map":return"clearcoatRoughnessMap";case"Displacement Map":return"displacementMap";case"Emissive Map":return"emissiveMap";case"Gradient Map":return"gradientMap";case"Iridescence Map":return"iridescenceMap";case"Iridescence Thickness Map":return"iridescenceThicknessMap";case"Map":return"map";case"Matcap":return"matcap";case"Normal Map":return"normalMap";case"Roughness Map":return"roughnessMap";case"Sheen Color Map":return"sheenColorMap";case"Sheen Roughness Map":return"sheenRoughnessMap";case"Specular Color Map":return"specularColorMap";case"Specular Map Intensity":return"specularIntensityMap";case"Thickness Map":return"thicknessMap";case"Transmission Map":return"transmissionMap"}return s}function UB(s){switch(s){case"alphaHash":return"Alpha Hash";case"alphaMap":return"Alpha Map";case"alphaToCoverage":return"Alpha To Coverage";case"anisotropy":return"Anisotropy";case"anisotropyMap":return"Anisotropy Map";case"anisotropyRotation":return"Anisotropy Rotation";case"aoMap":return"AO Map";case"aoMapIntensity":return"AO Map Intensity";case"attenuationColor":return"Attenuation Color";case"attenuationDistance":return"Attenuation Distance";case"blendAlpha":return"Blend Alpha";case"blendColor":return"Blend Color";case"blendDst":return"Blend Dst";case"blendDstAlpha":return"Blend Dst Alha";case"blendEquation":return"Blend Equation";case"blendEquationAlpha":return"Blend Equation Alpha";case"blending":return"Blending";case"blendSrc":return"Blend Src";case"blendSrcAlpha":return"Blend Src Alpha";case"bumpMap":return"Bump Map";case"bumpScale":return"Bump Scale";case"clearcoat":return"Clearcoat";case"clearcoatMap":return"Clearcoat Map";case"clearcoatNormalMap":return"Clearcoat Normal Map";case"clearcoatNormalScale":return"Clearcoat Normal Scale";case"clearcoatRoughness":return"Clearcoat Roughness";case"clearcoatRoughnessMap":return"Clearcoat Roughness Map";case"color":return"Color";case"colorWrite":return"Color Write";case"defines":return"Defines";case"depthFunc":return"Depth Func";case"depthTest":return"Depth Test";case"depthWrite":return"Depth Write";case"dispersion":return"Dispersion";case"displacementBias":return"Displacement Bias";case"displacementMap":return"Displacement Map";case"displacementScale":return"Displacement Scale";case"dithering":return"Dithering";case"emissive":return"Emissive";case"emissiveMap":return"Emissive Map";case"emissiveIntensity":return"Emissive Intensity";case"envMap":return"Environment Map";case"envMapIntensity":return"Environment Map Intensity";case"envMapRotation":return"Environment Map Rotation";case"extensions":return"Extensions";case"flatShading":return"Flat Shading";case"fragmentShader":return"Fragment Shader";case"fog":return"Fog";case"glslVersion":return"GLSL Version";case"gradientMap":return"Gradient Map";case"ior":return"IOR";case"iridescence":return"Iridescence";case"iridescenceIOR":return"Iridescence IOR";case"iridescenceMap":return"Iridescence Map";case"iridescenceThicknessMap":return"Iridescence Thickness Map";case"iridescenceThicknessRange":return"Iridescence Thickness Range";case"lights":return"Lights";case"lightMap":return"Light Map";case"lightMapIntensity":return"Light Map Intensity";case"map":return"Map";case"matcap":return"Matcap";case"metalness":return"Metalness";case"metalnessMap":return"Metalness Map";case"name":return"Name";case"normalMap":return"Normal Map";case"normalScale":return"Normal Scale";case"premultipliedAlpha":return"Premultiplied Alpha";case"opacity":return"Opacity";case"reflectivity":return"Reflectivity";case"refractionRatio":return"Refraction Ratio";case"roughness":return"Roughness";case"roughnessMap":return"Roughness Map";case"sheen":return"Sheen";case"sheenColor":return"Sheen Color";case"sheenColorMap":return"Sheen Color Map";case"sheenRoughness":return"Sheen Roughness";case"sheenRoughnessMap":return"Sheen Roughness Map";case"shininess":return"Shininess";case"side":return"Side";case"size":return"Size";case"sizeAttenuation":return"Size Attenuation";case"specular":return"Specular";case"specularColor":return"Specular Color";case"specularColorMap":return"Specular Color Map";case"specularIntensity":return"Specular Intensity";case"specularIntensityMap":return"Specular Map Intensity";case"thickness":return"Thickness";case"thicknessMap":return"Thickness Map";case"toneMapped":return"Tone Mapped";case"transmission":return"Transmission";case"transmissionMap":return"Transmission Map";case"transparent":return"Transparent";case"type":return"Type";case"uuid":return"UUID";case"uniforms":return"Uniforms";case"vertexColors":return"Vertex Colors";case"vertexShader":return"Vertex Shader";case"visible":return"Visible";case"wireframe":return"Wireframe"}return s}function GCe(s){const e=s.toLowerCase();return e.search("intensity")>-1||e==="anisotropyrotation"||e==="blendalpha"||e==="bumpscale"||e==="clearcoatroughness"||e==="displacementbias"||e==="displacementscale"||e==="metalness"||e==="opacity"||e==="reflectivity"||e==="refractionratio"||e==="roughness"||e==="sheenroughness"}function Pat(){const s=document.createElement("input");return s.type="file",new Promise((e,t)=>{s.addEventListener("change",function(){if(s.files===null)t();else{const n=s.files[0],r=new FileReader;r.onload=function(i){e(i.target.result)},r.readAsDataURL(n)}}),s.click()})}const Rat=[{title:"Front",value:Mc},{title:"Back",value:bs},{title:"Double",value:oa}],Iat=[{title:"No Blending",value:El},{title:"Normal",value:L0},{title:"Additive",value:U3},{title:"Subtractive",value:z3},{title:"Multiply",value:V3},{title:"Custom",value:Jy}],kat=[{title:"Add",value:i0},{title:"Subtract",value:HF},{title:"Reverse Subtract",value:$F},{title:"Min",value:RK},{title:"Max",value:IK}],Dat=[{title:"Zero",value:im},{title:"One",value:UA},{title:"Src Color",value:zA},{title:"One Minus Src Color",value:VA},{title:"Src Alpha",value:h5},{title:"One Minus Src Alpha",value:p5},{title:"Dst Alpha",value:GA},{title:"One Minus Dst Alpha",value:jA},{title:"Dst Color",value:HA},{title:"One Minus Dst Color",value:$A},{title:"Src Alpha Saturate",value:WF},{title:"Constant Color",value:kK},{title:"One Minus Constant Color",value:DK},{title:"Constant Alpha",value:OK},{title:"One Minus Constant Alpha",value:LK}],Oat=[{title:"Zero",value:im},{title:"One",value:UA},{title:"Src Color",value:zA},{title:"One Minus Src Color",value:VA},{title:"Src Alpha",value:h5},{title:"One Minus Src Alpha",value:p5},{title:"Dst Alpha",value:GA},{title:"One Minus Dst Alpha",value:jA},{title:"Dst Color",value:HA},{title:"One Minus Dst Color",value:$A},{title:"Constant Color",value:kK},{title:"One Minus Constant Color",value:DK},{title:"Constant Alpha",value:OK},{title:"One Minus Constant Alpha",value:LK}];function hC(s,e){s.needsUpdate=!0,s.type="option",s.options=e}function Lat(s,e,t,n){return{type:"boolean",title:UB(s),prop:s,value:e,needsUpdate:!0,onChange:(r,i)=>{n.updateObject(t.uuid,`material.${s}`,i),n.updateObject(t.uuid,"material.needsUpdate",!0);const o=n.getScene(t.uuid);if(o!==null){const l=o.getObjectByProperty("uuid",t.uuid);za(l,`material.${s}`,i)}}}}function Fat(s,e,t,n){const r={type:"number",title:UB(s),prop:s,value:e,min:void 0,max:void 0,step:.01,needsUpdate:!0,onChange:(i,o)=>{n.updateObject(t.uuid,`material.${s}`,o),n.updateObject(t.uuid,"material.needsUpdate",!0);const l=n.getScene(t.uuid);if(l!==null){const c=l.getObjectByProperty("uuid",t.uuid);za(c,`material.${s}`,o)}}};switch(s){case"blending":hC(r,Iat);break;case"blendDst":hC(r,Oat);break;case"blendEquation":hC(r,kat);break;case"blendSrc":hC(r,Dat);break;case"side":hC(r,Rat);break}return GCe(s)&&(r.value=Number(e),r.type="range",r.min=Math.min(0,r.value),r.max=Math.max(1,r.value),r.step=.01),r}function Bat(s,e,t,n){const r={type:"string",title:UB(s),prop:s,value:e,needsUpdate:!0,onChange:(o,l)=>{n.updateObject(t.uuid,`material.${s}`,l),n.updateObject(t.uuid,"material.needsUpdate",!0);const c=n.getScene(t.uuid);if(c!==null){const h=c.getObjectByProperty("uuid",t.uuid);za(h,`material.${s}`,l)}},onKeyDown:o=>{}};return(s==="vertexShader"||s==="fragmentShader")&&(r.type="field",r.disabled=!1,r.latest=r.value,r.onChange=(o,l)=>{r.latest=l,n.updateObject(t.uuid,`material.${s}`,l);const c=n.getScene(t.uuid);if(c!==null){const h=c.getObjectByProperty("uuid",t.uuid);za(h,`material.${s}`,l)}},r.onKeyDown=o=>{if(o.key==="Enter"&&(o.altKey||o.metaKey)){n.updateObject(t.uuid,"material.needsUpdate",!0);const l=n.getScene(t.uuid);if(l!==null){const c=l.getObjectByProperty("uuid",t.uuid);za(c,"material.needsUpdate",!0)}}}),r}function Uat(s){return s.x!==void 0&&s.y!==void 0&&s.z===void 0}function zat(s){return s.x!==void 0&&s.y!==void 0&&s.z!==void 0&&s.w===void 0}function Vat(s){return s.x!==void 0&&s.y!==void 0&&s.z!==void 0&&s.w!==void 0}function bK(s){s.sort((e,t)=>e.title<t.title?-1:e.title>t.title?1:0)}function OC(s,e,t,n,r="",i=!1){const o=UB(s).split(".")[0].replaceAll("[","").replaceAll("]",""),l=r.length>0?`${r}.${s}`:s,c=typeof e;if(c==="boolean"||c==="string")return{title:o,prop:l,type:c,value:e,disabled:i,onChange:(h,m)=>{n.updateObject(t.uuid,`material.${l}`,m);const y=n.getScene(t.uuid);if(y!==null){const b=y.getObjectByProperty("uuid",t.uuid);za(b,`material.${l}`,m)}}};if(c==="number"){const h={title:o,prop:l,type:"number",value:e,step:.01,disabled:i,onChange:(m,y)=>{n.updateObject(t.uuid,`material.${l}`,y);const b=n.getScene(t.uuid);if(b!==null){const w=b.getObjectByProperty("uuid",t.uuid);za(w,`material.${l}`,y)}}};return GCe(o)&&(h.type="range",h.min=0,h.max=1),h}else{if(e.isColor)return{title:o,prop:l,type:"color",value:e,disabled:i,onChange:(h,m)=>{const y=new Tn(m);n.updateObject(t.uuid,`material.${l}`,y);const b=n.getScene(t.uuid);if(b!==null){const w=b.getObjectByProperty("uuid",t.uuid);za(w,`material.${l}`,y)}}};if(Array.isArray(e)){const h=[];for(const m in e){const y=e[m],b=`[${m.toString()}]`;if(y.value!==void 0){const w=OC(`${b}.value`,y.value,t,n,l,i);w!==void 0&&h.push(w)}else{const w=OC(b,y,t,n,l,i);w!==void 0&&h.push(w)}}if(h.length>0)return bK(h),{title:o,items:h}}else{if(Uat(e))return{title:o,prop:l,type:"vector2",value:e,disabled:i,onChange:(h,m)=>{n.updateObject(t.uuid,`material.${l}`,m);const y=n.getScene(t.uuid);if(y!==null){const b=y.getObjectByProperty("uuid",t.uuid);za(b,`material.${l}`,m)}}};if(zat(e))return{title:o,prop:l,type:"grid3",value:e,disabled:i,onChange:(h,m)=>{n.updateObject(t.uuid,`material.${l}`,m);const y=n.getScene(t.uuid);if(y!==null){const b=y.getObjectByProperty("uuid",t.uuid);za(b,`material.${l}`,m)}}};if(Vat(e))return{title:o,prop:l,type:"grid4",value:e,disabled:i,onChange:(h,m)=>{n.updateObject(t.uuid,`material.${l}`,m);const y=n.getScene(t.uuid);if(y!==null){const b=y.getObjectByProperty("uuid",t.uuid);za(b,`material.${l}`,m)}}};if(e.isEuler)return{title:o,prop:l,type:"euler",value:e,disabled:i,onChange:(h,m)=>{n.updateObject(t.uuid,`material.${l}`,m);const y=n.getScene(t.uuid);if(y!==null){const b=y.getObjectByProperty("uuid",t.uuid);za(b,`material.${l}`,m)}}};if(e.src!==void 0)return{title:o,type:"image",value:e,disabled:i,onChange:(h,m)=>{const y=Nat(s),b=r.length>0?`${r}.${y}`:y;n.createTexture(t.uuid,`material.${b}`,m);const w=n.getScene(t.uuid);if(w!==null){const A=w.getObjectByProperty("uuid",t.uuid);if(A!==void 0){const I=D=>{const P=A.material,U=b.split(".");switch(U.length){case 1:P[U[0]]=D;break;case 2:P[U[0]][U[1]]=D;break;case 3:P[U[0]][U[1]][U[2]]=D;break;case 4:P[U[0]][U[1]][U[2]][U[3]]=D;break;case 5:P[U[0]][U[1]][U[2]][U[3]][U[4]]=D;break}P.needsUpdate=!0};m.src.length>0?KQ(m.src).then(D=>{D.offset.set(m.offset[0],m.offset[1]),D.repeat.set(m.repeat[0],m.repeat[1]),I(D)}):I(null)}}}};if(e.elements!==void 0)return{title:o,prop:l,type:e.elements.length>9?"grid4":"grid3",value:e,disabled:i,onChange:(h,m)=>{n.updateObject(t.uuid,`material.${l}`,m);const y=n.getScene(t.uuid);if(y!==null){const b=y.getObjectByProperty("uuid",t.uuid);za(b,`material.${l}`,m)}}};{const h=[],m=s==="defines"||s==="extensions";try{for(const y in e){const b=e[y];if(b!==void 0)if(b.value!==void 0){const w=OC(`${y}.value`,b.value,t,n,l,m);w!==void 0&&h.push(w)}else{const w=OC(y,b,t,n,l,m);w!==void 0&&h.push(w)}}}catch{console.log("Hermes - Issue cycling through material object:",s,e)}if(h.length>0)return bK(h),{title:o,items:h}}}}}function _be(s,e,t){const n=[];for(const r in s){if(!Aat(r)||r.search("Node")>-1)continue;const i=typeof s[r],o=s[r];if(i==="boolean")n.push(Lat(r,o,e,t));else if(i==="number")n.push(Fat(r,o,e,t));else if(i==="string")n.push(Bat(r,o,e,t));else if(i==="object"){const l=OC(r,o,e,t);l!==void 0&&n.push(l)}else o!==void 0&&console.log("Hermes - Other Material Prop Type:",r,i,o)}return bK(n),n.push({title:"Update Material",type:"button",onChange:()=>{t.updateObject(e.uuid,"material.needsUpdate",!0);const r=t.getScene(e.uuid);if(r!==null){const i=r.getObjectByProperty("uuid",e.uuid);za(i,"material.needsUpdate",!0)}}}),n}function Gat(s,e){function t(){return`${e.name}_material`}const n=localStorage.getItem(t()),r=n!==null?n==="open":!1;function i(l){localStorage.setItem(t(),l?"open":"closed")}const o=s.material;if(Array.isArray(o)){const l=[],c=o.length;for(let h=0;h<c;h++)l.push(ot.jsx(Ip,{three:e,title:`Material ${h}`,items:_be(o[h],s,e)},`Material ${h}`));return ot.jsx(ot.Fragment,{children:l})}else return ot.jsx(Ip,{three:e,title:"Material",items:_be(o,s,e),expanded:r,onToggle:l=>{i(l)}})}const Sbe="data:image/gif;base64,R0lGODlhDgFkAIAAAP///wAAACH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDIgNzkuZGJhM2RhM2I1LCAyMDIzLzEyLzE1LTEwOjQyOjM3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjUuNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyMDk3M0NEODAxQjQxMUVGODVGNENDMkUyMUExNDk1NSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoyMDk3M0NEOTAxQjQxMUVGODVGNENDMkUyMUExNDk1NSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkE4ODc3Qzg5MDFCMzExRUY4NUY0Q0MyRTIxQTE0OTU1IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkE4ODc3QzhBMDFCMzExRUY4NUY0Q0MyRTIxQTE0OTU1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEAAAAAAAsAAAAAA4BZAAAAv+Mj6nL7Q+jnLTai7PevPsPhuJIluaJpurKtu4Lx/JM1/aN5/rO9/4PDAqHxKLxiEwql8ym8wmNSqfUqvWKzWq33K73Cw6Lx+Sy+YxOq9fstvsNj8vn9Lr9js/r9/y+/w8YKDhIWGh4iJiouMjY6PgIGSk5SVlpeYmZqTkJAGDQ+dnpuekmGgAKejpKuiZqmprKqoZKGyrbOlqrejub6xvLGyw8TFzcprurGuvqybxq7ETbrItsCz0l7Zpc+6p9/cS967w9/S2FTF0u/mzehK4Oqz3eTl9vf4+fr7/P3+//DzCgwIEECxo8iDChwoUMGzp8CDGixIkUK1q8iDGjxo0XHDt6/AgypMiRJEuaPIkypcqVLFt+KwAAOw==";function jat(s){const e=s.step!==void 0?s.step:.01,t=On.useRef(null),n=On.useRef(null),r=On.useRef(null),i=On.useRef(null),o=On.useRef(null),[l]=On.useState(s.value),[c,h]=On.useState(s.value.offset[0]),[m,y]=On.useState(s.value.offset[1]),[b,w]=On.useState(s.value.repeat[0]),[A,I]=On.useState(s.value.repeat[1]);function D(U,j,C,Z,ie){if(s.onChange!==void 0){const se=s.prop!==void 0?s.prop:s.title;s.onChange(se,{src:U,offset:[j,C],repeat:[Z,ie]})}}function P(U){const j=t.current.src,C=U.target.value;switch(U.target){case n.current:h(C),D(j,C,m,b,A);break;case r.current:y(C),D(j,c,C,b,A);break;case i.current:w(C),D(j,c,m,C,A);break;case o.current:I(C),D(j,c,m,b,C);break}}return ot.jsxs("div",{className:"imageField",children:[ot.jsx("img",{alt:s.title,ref:t,onClick:()=>{Pat().then(U=>{t.current.src=U,D(U,c,m,b,A)})},src:l.src.length>0?l.src:Sbe}),ot.jsxs("div",{className:"fields",children:[ot.jsxs("div",{children:[ot.jsx("span",{children:"Offset:"}),ot.jsx("input",{ref:n,type:"number",value:c,step:e,name:O0(),onChange:P}),ot.jsx("input",{ref:r,type:"number",value:m,step:e,name:O0(),onChange:P})]}),ot.jsxs("div",{children:[ot.jsx("span",{children:"Repeat:"}),ot.jsx("input",{ref:i,type:"number",value:b,step:e,name:O0(),onChange:P}),ot.jsx("input",{ref:o,type:"number",value:A,step:e,name:O0(),onChange:P})]}),ot.jsx("button",{onClick:()=>{D("",c,m,b,A),t.current.src=Sbe},children:"Clear"})]})]})}function nF(s){var h;let e=s.value;e!==void 0&&(e.isColor!==void 0?e=hxe(s.value):s.type==="color"&&(e=hxe(new Tn().setStyle(s.value,vd))));const[t,n]=On.useState(e),r=On.useRef(null),i=m=>{let y=m.target.value;if(s.type==="boolean")y=m.target.checked;else if(s.type==="option"&&(typeof s.value=="number"?y=Number(y):typeof s.value=="boolean"?y=!!y:typeof s.value=="object"&&(y=JSON.parse(y)),s.options!==void 0)){const b=s.options.length;for(let w=0;w<b&&s.options[w].value!==y;w++);}n(y),s.onChange!==void 0&&s.onChange(s.prop!==void 0?s.prop:s.title,y)},o={};s.disabled&&(o.opacity=.8);const l=s.type==="field"||s.type==="string"&&(t.length>100||t.search(`
`)>-1),c=l||s.type==="image"||s.type==="vector2";return ot.jsxs("div",{className:`field ${c?"block":""}`,style:o,children:[s.type!=="button"&&ot.jsx("span",{ref:r,children:pF(s.title)},"fieldLabel"),s.type==="string"&&!l&&ot.jsx("input",{type:"text",disabled:s.disabled,onChange:i,value:t,name:O0()}),(s.type==="field"||s.type==="string"&&l)&&ot.jsx("textarea",{cols:50,rows:10,disabled:s.disabled!==void 0?s.disabled:!0,onChange:i,onKeyDown:m=>{s.onKeyDown!==void 0&&s.onKeyDown(m)},value:t,name:O0()}),s.type==="boolean"&&ot.jsx("input",{type:"checkbox",disabled:s.disabled,onChange:i,checked:t,name:O0()}),s.type==="number"&&ot.jsx(nx,{value:t,type:s.type,prop:s.prop!==void 0?s.prop:s.title,min:s.min,max:s.max,step:s.step,disabled:s.disabled,labelRef:r,onChange:s.onChange}),s.type==="range"&&ot.jsx(nx,{value:t,type:s.type,prop:s.prop!==void 0?s.prop:s.title,min:s.min,max:s.max,step:s.step,disabled:s.disabled,labelRef:r,onChange:s.onChange}),s.type==="color"&&ot.jsxs(ot.Fragment,{children:[ot.jsx("input",{type:"text",value:t.toString(),onChange:i,disabled:s.disabled,className:"color",name:O0()}),ot.jsx("input",{type:"color",value:t,onChange:i,disabled:s.disabled,name:O0()})]}),s.type==="button"&&ot.jsx("button",{disabled:s.disabled,onClick:()=>{s.onChange!==void 0&&s.onChange(s.prop!==void 0?s.prop:s.title,!0)},children:s.title}),s.type==="image"&&ot.jsx(jat,{title:s.title,prop:s.prop,value:s.value,onChange:s.onChange}),s.type==="option"&&ot.jsx(ot.Fragment,{children:ot.jsx("select",{onChange:i,disabled:s.disabled,defaultValue:s.value,name:O0(),children:(h=s.options)==null?void 0:h.map((m,y)=>ot.jsx("option",{value:m.value,children:pF(m.title)},y))})}),s.type==="vector2"&&ot.jsx(Mat,{step:s.step,value:t,min:0,max:1,onChange:i}),s.type==="grid3"&&ot.jsx(bbe,{step:s.step,value:t,onChange:i}),s.type==="grid4"&&ot.jsx(Cat,{step:s.step,value:t,onChange:i}),s.type==="euler"&&ot.jsx(bbe,{step:s.step,value:t,onChange:i})]})}function Hat(s){return"items"in s}class Ip extends On.Component{constructor(t){super(t);qe(this,"subgroupNames",[]);qe(this,"subgroupElements",[]);qe(this,"valueOverrides",new Map);qe(this,"three");this.three=t.three,this.state={lastUpdated:Date.now()}}addGroup(t){const n=[];t.items.forEach(o=>{n.push({type:o.type,prop:o.prop,title:o.title!==void 0?o.title:o.prop,value:o.value,min:o.min,max:o.max,step:o.step,options:o.options,disabled:o.disabled,onChange:(l,c)=>{t.onUpdate(l,c)}})});const r=On.createRef(),i=ot.jsx(Ip,{three:this.props.three,ref:r,title:t.title,expanded:t.expanded,items:n},Math.random());return this.subgroupNames.push(t.title),this.subgroupElements.push(i),this.setState({lastUpdated:Date.now()}),r}removeGroup(t){const n=this.subgroupNames.length;for(let r=0;r<n;r++){const i=this.subgroupNames[r];if(t===i){this.subgroupNames.splice(r,1),this.subgroupElements.splice(r,1),this.setState({lastUpdated:Date.now()});return}}}setField(t,n){this.valueOverrides.set(t,n),this.setState({lastUpdated:Date.now()})}render(){const t=[];return this.props.items.forEach(n=>{if(Hat(n))t.push(ot.jsx(Ip,{three:this.props.three,title:pF(n.title),items:n.items},Math.random()));else{const r=this.valueOverrides.get(n.title),i=r!==void 0?r:n.value;t.push(ot.jsx(nF,{title:n.title,prop:n.prop,value:i,type:n.type,min:n.min,max:n.max,step:n.step,disabled:n.disabled,options:n.options,onChange:(o,l)=>{n.onChange!==void 0&&(this.valueOverrides.delete(n.title),n.onChange(o,l))},onKeyDown:o=>{n.onKeyDown!==void 0&&n.onKeyDown(o)}},Math.random()))}}),this.subgroupElements.forEach(n=>t.push(n)),ot.jsx(QC,{three:this.props.three,label:this.props.title,open:this.props.expanded===!0,onToggle:n=>{var r;this.props.onToggle&&((r=this.props)==null||r.onToggle(n))},children:t})}}const rs=class rs extends On.Component{constructor(t){super(t);qe(this,"addGroup",t=>{const n=JSON.parse(t.value),r=[];n.items.forEach(i=>{r.push({type:i.type,prop:i.prop,title:i.title!==void 0?i.title:i.prop,value:i.value,min:i.min,max:i.max,step:i.step,options:i.options,disabled:i.disabled,onChange:(o,l)=>{this.props.three.updateGroup(n.title,o,l)}})}),rs.groups.push(ot.jsx(Ip,{three:this.props.three,title:n.title,items:r},Math.random())),rs.groupTitles.push(n.title),this.setState({lastUpdate:Date.now()})});qe(this,"removeGroup",t=>{const n=t.value,r=rs.groupTitles.length;for(let i=0;i<r;i++)if(n===rs.groupTitles[i]){rs.groups.splice(i,1),rs.groupTitles.splice(i,1),this.setState({lastUpdate:Date.now()});return}});this.state={lastUpdate:Date.now()},rs.instance=this,rs.three=t.three,t.three.addEventListener(Ci.ADD_GROUP,this.addGroup),t.three.addEventListener(Ci.REMOVE_GROUP,this.removeGroup)}componentWillUnmount(){this.props.three.removeEventListener(Ci.ADD_GROUP,this.addGroup),this.props.three.removeEventListener(Ci.REMOVE_GROUP,this.removeGroup)}render(){return ot.jsx("div",{className:"customGroups",children:rs.groups},this.state.lastUpdate)}static addEditorGroup(t){const n=rs.groupTitles.length;for(let l=0;l<n;l++)if(rs.groupTitles[l]===t.title)return rs.groupsRefs[l];const r=[];t.items.forEach(l=>{r.push({type:l.type,prop:l.prop,title:l.title!==void 0?l.title:l.prop,value:l.value,min:l.min,max:l.max,step:l.step,options:l.options,disabled:l.disabled,onChange:(c,h)=>{t.onUpdate(c,h)}})}),t.subgroups&&t.subgroups.length>0&&t.subgroups.forEach(l=>{const c=[];l.items.forEach(h=>{c.push({type:h.type,prop:h.prop,title:h.title!==void 0?h.title:h.prop,value:h.value,min:h.min,max:h.max,step:h.step,options:h.options,disabled:h.disabled,onChange:(m,y)=>{l.onUpdate(m,y)}})}),r.push({three:rs.three,title:l.title,expanded:l.expanded,items:c})});const i=On.createRef(),o=ot.jsx(Ip,{three:rs.three,ref:i,title:t.title,expanded:t.expanded,items:r},Math.random());return rs.groups.push(o),rs.groupsRefs.push(i),rs.groupTitles.push(t.title),setTimeout(()=>{rs.instance.setState({lastUpdate:Date.now()})},0),i}static removeEditorGroup(t){const n=rs.groupTitles.length;for(let r=0;r<n;r++)if(t===rs.groupTitles[r]){rs.groups.splice(r,1),rs.groupTitles.splice(r,1),rs.instance.setState({lastUpdate:Date.now()});return}}static removeAllGroups(){for(let t=rs.groupTitles.length;t>0;t--)rs.groups.splice(t,1),rs.groupTitles.splice(t,1);rs.instance.setState({lastUpdate:Date.now()})}};qe(rs,"instance"),qe(rs,"groups",[]),qe(rs,"groupsRefs",[]),qe(rs,"groupTitles",[]),qe(rs,"three");let u5=rs;const GF=class GF extends On.Component{constructor(t){super(t);qe(this,"matrix",new Pn);qe(this,"position",new be);qe(this,"rotation",new Sa);qe(this,"scale",new be);qe(this,"open",!1);qe(this,"updateTransform",(t,n)=>{const r=t==="rotation"?{x:n._x,y:n._y,z:n._z}:n;this.props.three.updateObject(this.props.object.uuid,t,r);const i=this.props.three.getScene(this.props.object.uuid);if(i){const o=i.getObjectByProperty("uuid",this.props.object.uuid);za(o,t,r)}});const n=localStorage.getItem(this.expandedName),r=n!==null?n==="open":!1;this.open=r,this.saveExpanded(),this.state={lastUpdated:0,expanded:r},this.matrix.elements=t.object.matrix,t.object.uuid.length>0&&(this.position.setFromMatrixPosition(this.matrix),this.rotation.setFromRotationMatrix(this.matrix),this.scale.setFromMatrixScale(this.matrix)),GF.instance=this}update(){if(nl.instance){const t=nl.instance.selectedItem;if(t===void 0)return;this.position.x=om(t.position.x,3),this.position.y=om(t.position.y,3),this.position.z=om(t.position.z,3),this.rotation.copy(t.rotation),this.scale.x=om(t.scale.x,3),this.scale.y=om(t.scale.y,3),this.scale.z=om(t.scale.z,3),this.setState({lastUpdated:Date.now()})}}render(){return ot.jsx(Ip,{three:this.props.three,title:"Transform",expanded:this.open,items:[{title:"Position",prop:"position",type:"grid3",step:.1,value:this.position,onChange:this.updateTransform},{title:"Rotation",prop:"rotation",type:"euler",value:this.rotation,onChange:this.updateTransform},{title:"Scale",prop:"scale",type:"grid3",value:this.scale,onChange:this.updateTransform},{title:"Visible",prop:"visible",type:"boolean",value:this.props.object.visible,onChange:this.updateTransform}],onToggle:t=>{this.open=t,this.saveExpanded()}},this.state.lastUpdated)}saveExpanded(){localStorage.setItem(this.expandedName,this.open?"open":"closed")}get expandedName(){return`${this.props.three.name}_transform`}};qe(GF,"instance");let FF=GF;function DX(s){const[e,t]=On.useState(s.selected),n="toggle"+(e?" selected":"");return ot.jsx("button",{className:n,onClick:()=>{const r=!e;t(r),s.onClick(r)},style:{backgroundImage:`url(${s.icon})`,backgroundPositionX:"center",backgroundPositionY:s.top!==void 0?`${s.top}px`:"center",backgroundSize:`${s.width!==void 0?`${s.width}px`:"26px"} ${s.height}px`}},s.name)}class Bp{constructor(e,t,n,r,i,o,l,c,h){Bp.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,i,o,l,c,h)}set(e,t,n,r,i,o,l,c,h){const m=this.elements;return m[0]=e,m[1]=r,m[2]=l,m[3]=t,m[4]=i,m[5]=c,m[6]=n,m[7]=o,m[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],l=n[3],c=n[6],h=n[1],m=n[4],y=n[7],b=n[2],w=n[5],A=n[8],I=r[0],D=r[3],P=r[6],U=r[1],j=r[4],C=r[7],Z=r[2],ie=r[5],se=r[8];return i[0]=o*I+l*U+c*Z,i[3]=o*D+l*j+c*ie,i[6]=o*P+l*C+c*se,i[1]=h*I+m*U+y*Z,i[4]=h*D+m*j+y*ie,i[7]=h*P+m*C+y*se,i[2]=b*I+w*U+A*Z,i[5]=b*D+w*j+A*ie,i[8]=b*P+w*C+A*se,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],l=e[5],c=e[6],h=e[7],m=e[8];return t*o*m-t*l*h-n*i*m+n*l*c+r*i*h-r*o*c}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],l=e[5],c=e[6],h=e[7],m=e[8],y=m*o-l*h,b=l*c-m*i,w=h*i-o*c,A=t*y+n*b+r*w;if(A===0)return this.set(0,0,0,0,0,0,0,0,0);const I=1/A;return e[0]=y*I,e[1]=(r*h-m*n)*I,e[2]=(l*n-r*o)*I,e[3]=b*I,e[4]=(m*t-r*c)*I,e[5]=(r*i-l*t)*I,e[6]=w*I,e[7]=(n*c-h*t)*I,e[8]=(o*t-n*i)*I,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,o,l){const c=Math.cos(i),h=Math.sin(i);return this.set(n*c,n*h,-n*(c*o+h*l)+o+e,-r*h,r*c,-r*(-h*o+c*l)+l+t,0,0,1),this}scale(e,t){return this.premultiply(OX.makeScale(e,t)),this}rotate(e){return this.premultiply(OX.makeRotation(-e)),this}translate(e,t){return this.premultiply(OX.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const OX=new Bp,wbe=new Bp().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Tbe=new Bp().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function $at(){const s={enabled:!0,workingColorSpace:Y7e,spaces:{},convert:function(r,i,o){return this.enabled===!1||i===o||!i||!o||(this.spaces[i].transfer===YC&&(r.r=Q3(r.r),r.g=Q3(r.g),r.b=Q3(r.b)),this.spaces[i].primaries!==this.spaces[o].primaries&&(r.applyMatrix3(this.spaces[i].toXYZ),r.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===YC&&(r.r=wS(r.r),r.g=wS(r.g),r.b=wS(r.b))),r},workingToColorSpace:function(r,i){return this.convert(r,this.workingColorSpace,i)},colorSpaceToWorking:function(r,i){return this.convert(r,i,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===IF?K7e:this.spaces[r].transfer},getToneMappingMode:function(r){return this.spaces[r].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(r,i=this.workingColorSpace){return r.fromArray(this.spaces[i].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,i,o){return r.copy(this.spaces[i].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(r,i){return DA("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),s.workingToColorSpace(r,i)},toWorkingColorSpace:function(r,i){return DA("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),s.colorSpaceToWorking(r,i)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return s.define({[Y7e]:{primaries:e,whitePoint:n,transfer:K7e,toXYZ:wbe,fromXYZ:Tbe,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:rm},outputColorSpaceConfig:{drawingBufferColorSpace:rm}},[rm]:{primaries:e,whitePoint:n,transfer:YC,toXYZ:wbe,fromXYZ:Tbe,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:rm}}}),s}const bl=$at();function Q3(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function wS(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}const jCe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Iy={h:0,s:0,l:0},uL={h:0,s:0,l:0};function LX(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*6*(2/3-t):s}class cN{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=rm){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,bl.colorSpaceToWorking(this,t),this}setRGB(e,t,n,r=bl.workingColorSpace){return this.r=e,this.g=t,this.b=n,bl.colorSpaceToWorking(this,r),this}setHSL(e,t,n,r=bl.workingColorSpace){if(e=eJ(e,1),t=Xi(t,0,1),n=Xi(n,0,1),t===0)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,o=2*n-i;this.r=LX(o,i,e+1/3),this.g=LX(o,i,e),this.b=LX(o,i,e-1/3)}return bl.colorSpaceToWorking(this,r),this}setStyle(e,t=rm){function n(i){i!==void 0&&parseFloat(i)<1&&bi("Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const o=r[1],l=r[2];switch(o){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:bi("Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const i=r[1],o=i.length;if(o===3)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(i,16),t);bi("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=rm){const n=jCe[e.toLowerCase()];return n!==void 0?this.setHex(n,t):bi("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Q3(e.r),this.g=Q3(e.g),this.b=Q3(e.b),this}copyLinearToSRGB(e){return this.r=wS(e.r),this.g=wS(e.g),this.b=wS(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=rm){return bl.workingToColorSpace(xc.copy(this),e),Math.round(Xi(xc.r*255,0,255))*65536+Math.round(Xi(xc.g*255,0,255))*256+Math.round(Xi(xc.b*255,0,255))}getHexString(e=rm){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=bl.workingColorSpace){bl.workingToColorSpace(xc.copy(this),t);const n=xc.r,r=xc.g,i=xc.b,o=Math.max(n,r,i),l=Math.min(n,r,i);let c,h;const m=(l+o)/2;if(l===o)c=0,h=0;else{const y=o-l;switch(h=m<=.5?y/(o+l):y/(2-o-l),o){case n:c=(r-i)/y+(r<i?6:0);break;case r:c=(i-n)/y+2;break;case i:c=(n-r)/y+4;break}c/=6}return e.h=c,e.s=h,e.l=m,e}getRGB(e,t=bl.workingColorSpace){return bl.workingToColorSpace(xc.copy(this),t),e.r=xc.r,e.g=xc.g,e.b=xc.b,e}getStyle(e=rm){bl.workingToColorSpace(xc.copy(this),e);const t=xc.r,n=xc.g,r=xc.b;return e!==rm?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(Iy),this.setHSL(Iy.h+e,Iy.s+t,Iy.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Iy),e.getHSL(uL);const n=c5(Iy.h,uL.h,t),r=c5(Iy.s,uL.s,t),i=c5(Iy.l,uL.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const xc=new cN;cN.NAMES=jCe;class Pw{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const r=n[e];if(r!==void 0){const i=r.indexOf(t);i!==-1&&r.splice(i,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let i=0,o=r.length;i<o;i++)r[i].call(this,e);e.target=null}}}let Wat=0;class _K extends Pw{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Wat++}),this.uuid=Z3(),this.name="",this.type="Material",this.blending=V7e,this.side=gK,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=j7e,this.blendDst=H7e,this.blendEquation=G7e,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new cN(0,0,0),this.blendAlpha=0,this.depthFunc=$7e,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Z7e,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=O_,this.stencilZFail=O_,this.stencilZPass=O_,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){bi(`Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){bi(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==V7e&&(n.blending=this.blending),this.side!==gK&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==j7e&&(n.blendSrc=this.blendSrc),this.blendDst!==H7e&&(n.blendDst=this.blendDst),this.blendEquation!==G7e&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==$7e&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Z7e&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==O_&&(n.stencilFail=this.stencilFail),this.stencilZFail!==O_&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==O_&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.allowOverride===!1&&(n.allowOverride=!1),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(i){const o=[];for(const l in i){const c=i[l];delete c.metadata,o.push(c)}return o}if(t){const i=r(e.textures),o=r(e.images);i.length>0&&(n.textures=i),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class rJ{constructor(e,t,n,r){rJ.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,r){const i=this.elements;return i[0]=e,i[2]=t,i[1]=n,i[3]=r,this}}class Rw{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,o,l){let c=n[r+0],h=n[r+1],m=n[r+2],y=n[r+3],b=i[o+0],w=i[o+1],A=i[o+2],I=i[o+3];if(y!==I||c!==b||h!==w||m!==A){let D=c*b+h*w+m*A+y*I;D<0&&(b=-b,w=-w,A=-A,I=-I,D=-D);let P=1-l;if(D<.9995){const U=Math.acos(D),j=Math.sin(U);P=Math.sin(P*U)/j,l=Math.sin(l*U)/j,c=c*P+b*l,h=h*P+w*l,m=m*P+A*l,y=y*P+I*l}else{c=c*P+b*l,h=h*P+w*l,m=m*P+A*l,y=y*P+I*l;const U=1/Math.sqrt(c*c+h*h+m*m+y*y);c*=U,h*=U,m*=U,y*=U}}e[t]=c,e[t+1]=h,e[t+2]=m,e[t+3]=y}static multiplyQuaternionsFlat(e,t,n,r,i,o){const l=n[r],c=n[r+1],h=n[r+2],m=n[r+3],y=i[o],b=i[o+1],w=i[o+2],A=i[o+3];return e[t]=l*A+m*y+c*w-h*b,e[t+1]=c*A+m*b+h*y-l*w,e[t+2]=h*A+m*w+l*b-c*y,e[t+3]=m*A-l*y-c*b-h*w,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,i=e._z,o=e._order,l=Math.cos,c=Math.sin,h=l(n/2),m=l(r/2),y=l(i/2),b=c(n/2),w=c(r/2),A=c(i/2);switch(o){case"XYZ":this._x=b*m*y+h*w*A,this._y=h*w*y-b*m*A,this._z=h*m*A+b*w*y,this._w=h*m*y-b*w*A;break;case"YXZ":this._x=b*m*y+h*w*A,this._y=h*w*y-b*m*A,this._z=h*m*A-b*w*y,this._w=h*m*y+b*w*A;break;case"ZXY":this._x=b*m*y-h*w*A,this._y=h*w*y+b*m*A,this._z=h*m*A+b*w*y,this._w=h*m*y-b*w*A;break;case"ZYX":this._x=b*m*y-h*w*A,this._y=h*w*y+b*m*A,this._z=h*m*A-b*w*y,this._w=h*m*y+b*w*A;break;case"YZX":this._x=b*m*y+h*w*A,this._y=h*w*y+b*m*A,this._z=h*m*A-b*w*y,this._w=h*m*y-b*w*A;break;case"XZY":this._x=b*m*y-h*w*A,this._y=h*w*y-b*m*A,this._z=h*m*A+b*w*y,this._w=h*m*y+b*w*A;break;default:bi("Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],o=t[1],l=t[5],c=t[9],h=t[2],m=t[6],y=t[10],b=n+l+y;if(b>0){const w=.5/Math.sqrt(b+1);this._w=.25/w,this._x=(m-c)*w,this._y=(i-h)*w,this._z=(o-r)*w}else if(n>l&&n>y){const w=2*Math.sqrt(1+n-l-y);this._w=(m-c)/w,this._x=.25*w,this._y=(r+o)/w,this._z=(i+h)/w}else if(l>y){const w=2*Math.sqrt(1+l-n-y);this._w=(i-h)/w,this._x=(r+o)/w,this._y=.25*w,this._z=(c+m)/w}else{const w=2*Math.sqrt(1+y-n-l);this._w=(o-r)/w,this._x=(i+h)/w,this._y=(c+m)/w,this._z=.25*w}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Xi(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,o=e._w,l=t._x,c=t._y,h=t._z,m=t._w;return this._x=n*m+o*l+r*h-i*c,this._y=r*m+o*c+i*l-n*h,this._z=i*m+o*h+n*c-r*l,this._w=o*m-n*l-r*c-i*h,this._onChangeCallback(),this}slerp(e,t){let n=e._x,r=e._y,i=e._z,o=e._w,l=this.dot(e);l<0&&(n=-n,r=-r,i=-i,o=-o,l=-l);let c=1-t;if(l<.9995){const h=Math.acos(l),m=Math.sin(h);c=Math.sin(c*h)/m,t=Math.sin(t*h)/m,this._x=this._x*c+n*t,this._y=this._y*c+r*t,this._z=this._z*c+i*t,this._w=this._w*c+o*t,this._onChangeCallback()}else this._x=this._x*c+n*t,this._y=this._y*c+r*t,this._z=this._z*c+i*t,this._w=this._w*c+o*t,this.normalize();return this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),i*Math.sin(t),i*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Yt{constructor(e=0,t=0,n=0){Yt.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Ebe.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Ebe.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,l=e.z,c=e.w,h=2*(o*r-l*n),m=2*(l*t-i*r),y=2*(i*n-o*t);return this.x=t+c*h+o*y-l*m,this.y=n+c*m+l*h-i*y,this.z=r+c*y+i*m-o*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Xi(this.x,e.x,t.x),this.y=Xi(this.y,e.y,t.y),this.z=Xi(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Xi(this.x,e,t),this.y=Xi(this.y,e,t),this.z=Xi(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Xi(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,o=t.x,l=t.y,c=t.z;return this.x=r*c-i*l,this.y=i*o-n*c,this.z=n*l-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return FX.copy(this).projectOnVector(e),this.sub(FX)}reflect(e){return this.sub(FX.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Xi(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const FX=new Yt,Ebe=new Rw;class a0{constructor(e,t,n,r,i,o,l,c,h,m,y,b,w,A,I,D){a0.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,r,i,o,l,c,h,m,y,b,w,A,I,D)}set(e,t,n,r,i,o,l,c,h,m,y,b,w,A,I,D){const P=this.elements;return P[0]=e,P[4]=t,P[8]=n,P[12]=r,P[1]=i,P[5]=o,P[9]=l,P[13]=c,P[2]=h,P[6]=m,P[10]=y,P[14]=b,P[3]=w,P[7]=A,P[11]=I,P[15]=D,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new a0().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return this.determinant()===0?(e.set(1,0,0),t.set(0,1,0),n.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this)}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const t=this.elements,n=e.elements,r=1/z_.setFromMatrixColumn(e,0).length(),i=1/z_.setFromMatrixColumn(e,1).length(),o=1/z_.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r),m=Math.cos(i),y=Math.sin(i);if(e.order==="XYZ"){const b=o*m,w=o*y,A=l*m,I=l*y;t[0]=c*m,t[4]=-c*y,t[8]=h,t[1]=w+A*h,t[5]=b-I*h,t[9]=-l*c,t[2]=I-b*h,t[6]=A+w*h,t[10]=o*c}else if(e.order==="YXZ"){const b=c*m,w=c*y,A=h*m,I=h*y;t[0]=b+I*l,t[4]=A*l-w,t[8]=o*h,t[1]=o*y,t[5]=o*m,t[9]=-l,t[2]=w*l-A,t[6]=I+b*l,t[10]=o*c}else if(e.order==="ZXY"){const b=c*m,w=c*y,A=h*m,I=h*y;t[0]=b-I*l,t[4]=-o*y,t[8]=A+w*l,t[1]=w+A*l,t[5]=o*m,t[9]=I-b*l,t[2]=-o*h,t[6]=l,t[10]=o*c}else if(e.order==="ZYX"){const b=o*m,w=o*y,A=l*m,I=l*y;t[0]=c*m,t[4]=A*h-w,t[8]=b*h+I,t[1]=c*y,t[5]=I*h+b,t[9]=w*h-A,t[2]=-h,t[6]=l*c,t[10]=o*c}else if(e.order==="YZX"){const b=o*c,w=o*h,A=l*c,I=l*h;t[0]=c*m,t[4]=I-b*y,t[8]=A*y+w,t[1]=y,t[5]=o*m,t[9]=-l*m,t[2]=-h*m,t[6]=w*y+A,t[10]=b-I*y}else if(e.order==="XZY"){const b=o*c,w=o*h,A=l*c,I=l*h;t[0]=c*m,t[4]=-y,t[8]=h*m,t[1]=b*y+I,t[5]=o*m,t[9]=w*y-A,t[2]=A*y-w,t[6]=l*m,t[10]=I*y+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(qat,e,Xat)}lookAt(e,t,n){const r=this.elements;return ch.subVectors(e,t),ch.lengthSq()===0&&(ch.z=1),ch.normalize(),ky.crossVectors(n,ch),ky.lengthSq()===0&&(Math.abs(n.z)===1?ch.x+=1e-4:ch.z+=1e-4,ch.normalize(),ky.crossVectors(n,ch)),ky.normalize(),dL.crossVectors(ch,ky),r[0]=ky.x,r[4]=dL.x,r[8]=ch.x,r[1]=ky.y,r[5]=dL.y,r[9]=ch.y,r[2]=ky.z,r[6]=dL.z,r[10]=ch.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],l=n[4],c=n[8],h=n[12],m=n[1],y=n[5],b=n[9],w=n[13],A=n[2],I=n[6],D=n[10],P=n[14],U=n[3],j=n[7],C=n[11],Z=n[15],ie=r[0],se=r[4],z=r[8],re=r[12],ye=r[1],H=r[5],Me=r[9],Oe=r[13],Ue=r[2],Ie=r[6],ce=r[10],Ve=r[14],Pe=r[3],We=r[7],pt=r[11],Ne=r[15];return i[0]=o*ie+l*ye+c*Ue+h*Pe,i[4]=o*se+l*H+c*Ie+h*We,i[8]=o*z+l*Me+c*ce+h*pt,i[12]=o*re+l*Oe+c*Ve+h*Ne,i[1]=m*ie+y*ye+b*Ue+w*Pe,i[5]=m*se+y*H+b*Ie+w*We,i[9]=m*z+y*Me+b*ce+w*pt,i[13]=m*re+y*Oe+b*Ve+w*Ne,i[2]=A*ie+I*ye+D*Ue+P*Pe,i[6]=A*se+I*H+D*Ie+P*We,i[10]=A*z+I*Me+D*ce+P*pt,i[14]=A*re+I*Oe+D*Ve+P*Ne,i[3]=U*ie+j*ye+C*Ue+Z*Pe,i[7]=U*se+j*H+C*Ie+Z*We,i[11]=U*z+j*Me+C*ce+Z*pt,i[15]=U*re+j*Oe+C*Ve+Z*Ne,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],l=e[5],c=e[9],h=e[13],m=e[2],y=e[6],b=e[10],w=e[14],A=e[3],I=e[7],D=e[11],P=e[15],U=c*w-h*b,j=l*w-h*y,C=l*b-c*y,Z=o*w-h*m,ie=o*b-c*m,se=o*y-l*m;return t*(I*U-D*j+P*C)-n*(A*U-D*Z+P*ie)+r*(A*j-I*Z+P*se)-i*(A*C-I*ie+D*se)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],l=e[5],c=e[6],h=e[7],m=e[8],y=e[9],b=e[10],w=e[11],A=e[12],I=e[13],D=e[14],P=e[15],U=t*l-n*o,j=t*c-r*o,C=t*h-i*o,Z=n*c-r*l,ie=n*h-i*l,se=r*h-i*c,z=m*I-y*A,re=m*D-b*A,ye=m*P-w*A,H=y*D-b*I,Me=y*P-w*I,Oe=b*P-w*D,Ue=U*Oe-j*Me+C*H+Z*ye-ie*re+se*z;if(Ue===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ie=1/Ue;return e[0]=(l*Oe-c*Me+h*H)*Ie,e[1]=(r*Me-n*Oe-i*H)*Ie,e[2]=(I*se-D*ie+P*Z)*Ie,e[3]=(b*ie-y*se-w*Z)*Ie,e[4]=(c*ye-o*Oe-h*re)*Ie,e[5]=(t*Oe-r*ye+i*re)*Ie,e[6]=(D*C-A*se-P*j)*Ie,e[7]=(m*se-b*C+w*j)*Ie,e[8]=(o*Me-l*ye+h*z)*Ie,e[9]=(n*ye-t*Me-i*z)*Ie,e[10]=(A*ie-I*C+P*U)*Ie,e[11]=(y*C-m*ie-w*U)*Ie,e[12]=(l*re-o*H-c*z)*Ie,e[13]=(t*H-n*re+r*z)*Ie,e[14]=(I*j-A*Z-D*U)*Ie,e[15]=(m*Z-y*j+b*U)*Ie,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,l=e.y,c=e.z,h=i*o,m=i*l;return this.set(h*o+n,h*l-r*c,h*c+r*l,0,h*l+r*c,m*l+n,m*c-r*o,0,h*c-r*l,m*c+r*o,i*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,o){return this.set(1,n,i,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,o=t._y,l=t._z,c=t._w,h=i+i,m=o+o,y=l+l,b=i*h,w=i*m,A=i*y,I=o*m,D=o*y,P=l*y,U=c*h,j=c*m,C=c*y,Z=n.x,ie=n.y,se=n.z;return r[0]=(1-(I+P))*Z,r[1]=(w+C)*Z,r[2]=(A-j)*Z,r[3]=0,r[4]=(w-C)*ie,r[5]=(1-(b+P))*ie,r[6]=(D+U)*ie,r[7]=0,r[8]=(A+j)*se,r[9]=(D-U)*se,r[10]=(1-(b+I))*se,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;e.x=r[12],e.y=r[13],e.z=r[14];const i=this.determinant();if(i===0)return n.set(1,1,1),t.identity(),this;let o=z_.set(r[0],r[1],r[2]).length();const l=z_.set(r[4],r[5],r[6]).length(),c=z_.set(r[8],r[9],r[10]).length();i<0&&(o=-o),Yf.copy(this);const h=1/o,m=1/l,y=1/c;return Yf.elements[0]*=h,Yf.elements[1]*=h,Yf.elements[2]*=h,Yf.elements[4]*=m,Yf.elements[5]*=m,Yf.elements[6]*=m,Yf.elements[8]*=y,Yf.elements[9]*=y,Yf.elements[10]*=y,t.setFromRotationMatrix(Yf),n.x=o,n.y=l,n.z=c,this}makePerspective(e,t,n,r,i,o,l=W3,c=!1){const h=this.elements,m=2*i/(t-e),y=2*i/(n-r),b=(t+e)/(t-e),w=(n+r)/(n-r);let A,I;if(c)A=i/(o-i),I=o*i/(o-i);else if(l===W3)A=-(o+i)/(o-i),I=-2*o*i/(o-i);else if(l===lw)A=-o/(o-i),I=-o*i/(o-i);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return h[0]=m,h[4]=0,h[8]=b,h[12]=0,h[1]=0,h[5]=y,h[9]=w,h[13]=0,h[2]=0,h[6]=0,h[10]=A,h[14]=I,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(e,t,n,r,i,o,l=W3,c=!1){const h=this.elements,m=2/(t-e),y=2/(n-r),b=-(t+e)/(t-e),w=-(n+r)/(n-r);let A,I;if(c)A=1/(o-i),I=o/(o-i);else if(l===W3)A=-2/(o-i),I=-(o+i)/(o-i);else if(l===lw)A=-1/(o-i),I=-i/(o-i);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return h[0]=m,h[4]=0,h[8]=0,h[12]=b,h[1]=0,h[5]=y,h[9]=0,h[13]=w,h[2]=0,h[6]=0,h[10]=A,h[14]=I,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const z_=new Yt,Yf=new a0,qat=new Yt(0,0,0),Xat=new Yt(1,1,1),ky=new Yt,dL=new Yt,ch=new Yt;class il{constructor(e=0,t=0){il.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Xi(this.x,e.x,t.x),this.y=Xi(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Xi(this.x,e,t),this.y=Xi(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Xi(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Xi(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Eu{constructor(e=0,t=0,n=0,r=1){Eu.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const c=e.elements,h=c[0],m=c[4],y=c[8],b=c[1],w=c[5],A=c[9],I=c[2],D=c[6],P=c[10];if(Math.abs(m-b)<.01&&Math.abs(y-I)<.01&&Math.abs(A-D)<.01){if(Math.abs(m+b)<.1&&Math.abs(y+I)<.1&&Math.abs(A+D)<.1&&Math.abs(h+w+P-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const j=(h+1)/2,C=(w+1)/2,Z=(P+1)/2,ie=(m+b)/4,se=(y+I)/4,z=(A+D)/4;return j>C&&j>Z?j<.01?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(j),r=ie/n,i=se/n):C>Z?C<.01?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(C),n=ie/r,i=z/r):Z<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(Z),n=se/i,r=z/i),this.set(n,r,i,t),this}let U=Math.sqrt((D-A)*(D-A)+(y-I)*(y-I)+(b-m)*(b-m));return Math.abs(U)<.001&&(U=1),this.x=(D-A)/U,this.y=(y-I)/U,this.z=(b-m)/U,this.w=Math.acos((h+w+P-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Xi(this.x,e.x,t.x),this.y=Xi(this.y,e.y,t.y),this.z=Xi(this.z,e.z,t.z),this.w=Xi(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Xi(this.x,e,t),this.y=Xi(this.y,e,t),this.z=Xi(this.z,e,t),this.w=Xi(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Xi(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}const Yat=[/^StackTrace\.js$/,/^TSLCore\.js$/,/^.*Node\.js$/,/^three\.webgpu.*\.js$/];function Kat(s){const e=/(?:at\s+(.+?)\s+\()?(?:(.+?)@)?([^@\s()]+):(\d+):(\d+)/;return s.split(`
`).map(t=>{const n=t.match(e);if(!n)return null;const r=n[1]||n[2]||"",i=n[3].split("?")[0],o=parseInt(n[4],10),l=parseInt(n[5],10),c=i.split("/").pop();return{fn:r,file:c,line:o,column:l}}).filter(t=>t&&!Yat.some(n=>n.test(t.file)))}class kp{constructor(e=null){this.isStackTrace=!0,this.stack=Kat(e||new Error().stack)}getLocation(){if(this.stack.length===0)return"[Unknown location]";const e=this.stack[0],t=e.fn;return`${t?`"${t}()" at `:""}"${e.file}:${e.line}"`}getError(e){if(this.stack.length===0)return e;const t=this.stack.map(n=>{const r=`${n.file}:${n.line}:${n.column}`;return n.fn?`    at ${n.fn} (${r})`:`    at ${r}`}).join(`
`);return`${e}
${t}`}}function iJ(s,e=0){let t=3735928559^e,n=1103547991^e;if(s instanceof Array)for(let r=0,i;r<s.length;r++)i=s[r],t=Math.imul(t^i,2654435761),n=Math.imul(n^i,1597334677);else for(let r=0,i;r<s.length;r++)i=s.charCodeAt(r),t=Math.imul(t^i,2654435761),n=Math.imul(n^i,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&n)+(t>>>0)}const sJ=s=>iJ(s),HCe=s=>iJ(s),$Ce=(...s)=>iJ(s),Zat=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]);function Qat(s){return Zat.get(s)}function BF(s){if(s==null)return null;const e=typeof s;return s.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":s.isVector2===!0?"vec2":s.isVector3===!0?"vec3":s.isVector4===!0?"vec4":s.isMatrix2===!0?"mat2":s.isMatrix3===!0?"mat3":s.isMatrix4===!0?"mat4":s.isColor===!0?"color":s instanceof ArrayBuffer?"ArrayBuffer":null}function oJ(s,...e){const t=s?s.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),s==="color"?new cN(...e):t==="vec2"?new il(...e):t==="vec3"?new Yt(...e):t==="vec4"?new Eu(...e):t==="mat2"?new rJ(...e):t==="mat3"?new Bp(...e):t==="mat4"?new a0(...e):s==="bool"?e[0]||!1:s==="float"||s==="int"||s==="uint"?e[0]||0:s==="string"?e[0]||"":s==="ArrayBuffer"?elt(e[0]):null}function Jat(s){let e="";const t=new Uint8Array(s);for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function elt(s){return Uint8Array.from(atob(s),e=>e.charCodeAt(0)).buffer}const hL={VERTEX:"vertex"},Qs={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Mbe={READ_ONLY:"readOnly",READ_WRITE:"readWrite"},uN=["x","y","z","w"],tlt={analyze:"setup",generate:"analyze"};let nlt=0,Lr=class WCe extends Pw{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Qs.NONE,this.updateBeforeType=Qs.NONE,this.updateAfterType=Qs.NONE,this.uuid=Qot.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:nlt++}),this.stackTrace=null,WCe.captureStackTrace===!0&&(this.stackTrace=new kp)}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,Qs.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Qs.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Qs.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const n of Object.getOwnPropertyNames(this)){const r=this[n];if(!(n.startsWith("_")===!0||e.has(r))){if(Array.isArray(r)===!0)for(let i=0;i<r.length;i++){const o=r[i];o&&o.isNode===!0&&t.push({property:n,index:i,childNode:o})}else if(r&&r.isNode===!0)t.push({property:n,childNode:r});else if(r&&Object.getPrototypeOf(r)===Object.prototype)for(const i in r){if(i.startsWith("_")===!0)continue;const o=r[i];o&&o.isNode===!0&&t.push({property:n,index:i,childNode:o})}}}return t}getCacheKey(e=!1,t=null){if(e=e||this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);const n=[];for(const{property:r,childNode:i}of this._getChildren(t))n.push(sJ(r.slice(0,-4)),i.getCacheKey(e,t));this._cacheKey=$Ce(HCe(n),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let n=0;for(const r of this.getChildren())t["node"+n++]=r;return t.outputNode||null}analyze(e,t=null){const n=e.increaseUsage(this);if(this.parents===!0){const r=e.getDataFromNode(this,"any");r.stages=r.stages||{},r.stages[e.shaderStage]=r.stages[e.shaderStage]||[],r.stages[e.shaderStage].push(t)}if(n===1){const r=e.getNodeProperties(this);for(const i of Object.values(r))i&&i.isNode===!0&&i.build(e,this)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(e,t)}updateBefore(){bi("Abstract function.")}updateAfter(){bi("Abstract function.")}update(){bi("Abstract function.")}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const n=this.getShared(e);if(this!==n)return n.build(e,t);if(this._beforeNodes!==null){const c=this._beforeNodes;this._beforeNodes=null;for(const h of c)h.build(e,t);this._beforeNodes=c}const r=e.getDataFromNode(this);r.buildStages=r.buildStages||{},r.buildStages[e.buildStage]=!0;const i=tlt[e.buildStage];if(i&&r.buildStages[i]!==!0){const c=e.getBuildStage();e.setBuildStage(i),this.build(e),e.setBuildStage(c)}e.addChain(this);let o=null;const l=e.getBuildStage();if(l==="setup"){e.addNode(this),this.updateReference(e);const c=e.getNodeProperties(this);if(c.initialized!==!0){c.initialized=!0,c.outputNode=this.setup(e)||c.outputNode||null;for(const h of Object.values(c))if(h&&h.isNode===!0){if(h.parents===!0){const m=e.getNodeProperties(h);m.parents=m.parents||[],m.parents.push(this)}h.build(e)}e.addSequentialNode(this)}o=c.outputNode}else if(l==="analyze")this.analyze(e,t);else if(l==="generate"){if(this.generate.length<2){const h=this.getNodeType(e),m=e.getDataFromNode(this);o=m.snippet,o===void 0?m.generated===void 0?(m.generated=!0,o=this.generate(e)||"",m.snippet=o):(bi("Node: Recursion detected.",this),o="/* Recursion detected. */"):m.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,h,t)}else o=this.generate(e,t)||"";o===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(Js(`TSL: Invalid generated code, expected a "${t}".`),o=e.generateConst(t))}return e.removeChain(this),o}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:r,index:i,childNode:o}of t)i!==void 0?(n[r]===void 0&&(n[r]=Number.isInteger(i)?[]:{}),n[r][i]=o.toJSON(e.meta).uuid):n[r]=o.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const r=[];for(const i of e.inputNodes[n])r.push(t[i]);this[n]=r}else if(typeof e.inputNodes[n]=="object"){const r={};for(const i in e.inputNodes[n]){const o=e.inputNodes[n][i];r[i]=t[o]}this[n]=r}else{const r=e.inputNodes[n];this[n]=t[r]}}}toJSON(e){const{uuid:t,type:n}=this,r=e===void 0||typeof e=="string";r&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];i===void 0&&(i={uuid:t,type:n,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},r!==!0&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta);function o(l){const c=[];for(const h in l){const m=l[h];delete m.metadata,c.push(m)}return c}if(r){const l=o(e.textures),c=o(e.images),h=o(e.nodes);l.length>0&&(i.textures=l),c.length>0&&(i.images=c),h.length>0&&(i.nodes=h)}return i}};Lr.captureStackTrace=!1;class Iw extends Lr{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}generate(e){const t=this.indexNode.getNodeType(e),n=this.node.build(e),r=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${n}[ ${r} ]`}}class qCe extends Lr{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const r of this.convertTo.split("|"))(n===null||e.getTypeLength(t)===e.getTypeLength(r))&&(n=r);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,r=this.getNodeType(e),i=n.build(e,r);return e.format(i,r,t)}}class c0 extends Lr{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const r=e.getVectorType(this.getNodeType(e,t)),i=e.getDataFromNode(this);if(i.propertyName!==void 0)return e.format(i.propertyName,r,t);if(r!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,r),l=e.getVarFromNode(this,null,r),c=e.getPropertyName(l);return e.addLineFlowCode(`${c} = ${o}`,this),i.snippet=o,i.propertyName=c,e.format(i.propertyName,r,t)}}return super.build(e,t)}}class rlt extends c0{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),r=e.getTypeLength(n),i=this.nodes,o=e.getComponentType(n),l=[];let c=0;for(const m of i){if(c>=r){Js(`TSL: Length of parameters exceeds maximum length of function '${n}()' type.`,this.stackTrace);break}let y=m.getNodeType(e),b=e.getTypeLength(y),w;if(c+b>r&&(Js(`TSL: Length of '${n}()' data exceeds maximum length of output type.`,this.stackTrace),b=r-c,y=e.getTypeFromLength(b)),c+=b,w=m.build(e,y),e.getComponentType(y)!==o){const I=e.getTypeFromLength(b,o);w=e.format(w,y,I)}l.push(w)}const h=`${e.getType(n)}( ${l.join(", ")} )`;return e.format(h,n,t)}}const ilt=uN.join("");class slt extends Lr{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(uN.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const n=this.node,r=e.getTypeLength(n.getNodeType(e));let i=null;if(r>1){let o=null;this.getVectorLength()>=r&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=n.build(e,o);this.components.length===r&&this.components===ilt.slice(0,this.components.length)?i=e.format(c,o,t):i=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else i=n.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class olt extends c0{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:r}=this,i=this.getNodeType(e),o=e.getComponentType(r.getNodeType(e)),l=e.getTypeFromLength(n.length,o),c=r.build(e,l),h=t.build(e,i),m=e.getTypeLength(i),y=[];for(let b=0;b<m;b++){const w=uN[b];w===n[0]?(y.push(c),b+=n.length-1):y.push(h+"."+w)}return`${e.getType(i)}( ${y.join(", ")} )`}}class alt extends c0{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,r=this.getNodeType(e),i=n.build(e),o=e.getVarFromNode(this),l=e.getPropertyName(o);e.addLineFlowCode(l+" = "+i,this);const c=e.getTypeLength(r),h=[];let m=0;for(let y=0;y<c;y++){const b=uN[y];b===t[m]?(h.push("1.0 - "+(l+"."+b)),m++):h.push(l+"."+b)}return`${e.getType(r)}( ${h.join(", ")} )`}}class aJ extends Lr{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?BF(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=BF(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=Jat(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?oJ(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){bi("Abstract function.")}}const Cbe=/float|u?int/;class Rg extends aJ{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return Cbe.test(n)&&Cbe.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}}class llt extends Lr{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){bi(`TSL: Member "${this.property}" does not exist in struct.`,this.stackTrace);const n=this.getNodeType(e);return e.generateConst(n)}return this.structNode.build(e)+"."+this.property}}let clt=null;const SK=new Map;function Gt(s,e){if(SK.has(s)){bi(`TSL: Redefinition of method chaining '${s}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${s} is not a function`);SK.set(s,e),s!=="assign"&&(Lr.prototype[s]=function(...t){return this.isStackNode?this.addToStack(e(...t)):e(this,...t)},Lr.prototype[s+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const ult=s=>s.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),Abe=s=>ult(s).split("").sort().join("");Lr.prototype.assign=function(...s){if(this.isStackNode!==!0)return Js("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn().",new kp),this;{const e=SK.get("assign");return this.addToStack(e(...s))}};Lr.prototype.toVarIntent=function(){return this};Lr.prototype.get=function(s){return new llt(this,s)};const JC={};function pL(s,e,t){JC[s]=JC[e]=JC[t]={get(){this._cache=this._cache||{};let o=this._cache[s];return o===void 0&&(o=new slt(this,s),this._cache[s]=o),o},set(o){this[s].assign(Nr(o))}};const n=s.toUpperCase(),r=e.toUpperCase(),i=t.toUpperCase();Lr.prototype["set"+n]=Lr.prototype["set"+r]=Lr.prototype["set"+i]=function(o){const l=Abe(s);return new olt(this,l,Nr(o))},Lr.prototype["flip"+n]=Lr.prototype["flip"+r]=Lr.prototype["flip"+i]=function(){const o=Abe(s);return new alt(this,o)}}const rg=["x","y","z","w"],ig=["r","g","b","a"],sg=["s","t","p","q"];for(let s=0;s<4;s++){let e=rg[s],t=ig[s],n=sg[s];pL(e,t,n);for(let r=0;r<4;r++){e=rg[s]+rg[r],t=ig[s]+ig[r],n=sg[s]+sg[r],pL(e,t,n);for(let i=0;i<4;i++){e=rg[s]+rg[r]+rg[i],t=ig[s]+ig[r]+ig[i],n=sg[s]+sg[r]+sg[i],pL(e,t,n);for(let o=0;o<4;o++)e=rg[s]+rg[r]+rg[i]+rg[o],t=ig[s]+ig[r]+ig[i]+ig[o],n=sg[s]+sg[r]+sg[i]+sg[o],pL(e,t,n)}}}for(let s=0;s<32;s++)JC[s]={get(){this._cache=this._cache||{};let e=this._cache[s];return e===void 0&&(e=new Iw(this,new Rg(s,"uint")),this._cache[s]=e),e},set(e){this[s].assign(Nr(e))}};Object.defineProperties(Lr.prototype,JC);const Nbe=new WeakMap,dlt=function(s,e=null){const t=BF(s);return t==="node"?s:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?Nr(wK(s,e)):t==="shader"?s.isFn?s:Tr(s):s},hlt=function(s,e=null){for(const t in s)s[t]=Nr(s[t],e);return s},plt=function(s,e=null){const t=s.length;for(let n=0;n<t;n++)s[n]=Nr(s[n],e);return s},XCe=function(s,e=null,t=null,n=null){function r(m){return n!==null?(m=Nr(Object.assign(m,n)),n.intent===!0&&(m=m.toVarIntent())):m=Nr(m),m}let i,o=e,l,c;function h(m){let y;return o?y=/[a-z]/i.test(o)?o+"()":o:y=s.type,l!==void 0&&m.length<l?(Js(`TSL: "${y}" parameter length is less than minimum required.`,new kp),m.concat(new Array(l-m.length).fill(0))):c!==void 0&&m.length>c?(Js(`TSL: "${y}" parameter length exceeds limit.`,new kp),m.slice(0,c)):m}return e===null?i=(...m)=>r(new s(...TS(h(m)))):t!==null?(t=Nr(t),i=(...m)=>r(new s(e,...TS(h(m)),t))):i=(...m)=>r(new s(e,...TS(h(m)))),i.setParameterLength=(...m)=>(m.length===1?l=c=m[0]:m.length===2&&([l,c]=m),i),i.setName=m=>(o=m,i),i},flt=function(s,...e){return new s(...TS(e))};class mlt extends Lr{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:n}=this,r=e.getNodeProperties(t),i=e.getClosestSubBuild(t.subBuilds)||"",o=i||"default";if(r[o])return r[o];const l=e.subBuildFn,c=e.fnCall;e.subBuildFn=i,e.fnCall=this;let h=null;if(t.layout){let m=Nbe.get(e.constructor);m===void 0&&(m=new WeakMap,Nbe.set(e.constructor,m));let y=m.get(t);y===void 0&&(y=Nr(e.buildFunctionNode(t)),m.set(t,y)),e.addInclude(y);const b=n?glt(n):null;h=Nr(y.call(b))}else{const m=new Proxy(e,{get:(I,D,P)=>{let U;return Symbol.iterator===D?U=function*(){yield void 0}:U=Reflect.get(I,D,P),U}}),y=n?ylt(n):null,b=Array.isArray(n)?n.length>0:n!==null,w=t.jsFunc,A=b||w.length>1?w(y,m):w(m);h=Nr(A)}return e.subBuildFn=l,e.fnCall=c,t.once&&(r[o]=h),h}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),n=e.getSubBuildOutput(this);return t[n]=t[n]||this.setupOutput(e),t[n].subBuild=e.getClosestSubBuild(this),t[n]}build(e,t=null){let n=null;const r=e.getBuildStage(),i=e.getNodeProperties(this),o=e.getSubBuildOutput(this),l=this.getOutputNode(e),c=e.fnCall;if(e.fnCall=this,r==="setup"){const h=e.getSubBuildProperty("initialized",this);if(i[h]!==!0&&(i[h]=!0,i[o]=this.getOutputNode(e),i[o].build(e),this.shaderNode.subBuilds))for(const m of e.chaining){const y=e.getDataFromNode(m,"any");y.subBuilds=y.subBuilds||new Set;for(const b of this.shaderNode.subBuilds)y.subBuilds.add(b)}n=i[o]}else r==="analyze"?l.build(e,t):r==="generate"&&(n=l.build(e,t)||"");return e.fnCall=c,n}}function glt(s){let e;return dJ(s),s[0]&&(s[0].isNode||Object.getPrototypeOf(s[0])!==Object.prototype)?e=[...s]:e=s[0],e}function ylt(s){let e=0;return dJ(s),new Proxy(s,{get:(t,n,r)=>{let i;if(n==="length")return i=s.length,i;if(Symbol.iterator===n)i=function*(){for(const o of s)yield Nr(o)};else{if(s.length>0)if(Object.getPrototypeOf(s[0])===Object.prototype){const o=s[0];o[n]===void 0?i=o[e++]:i=Reflect.get(o,n,r)}else s[0]instanceof Lr&&(s[n]===void 0?i=s[e++]:i=Reflect.get(s,n,r));else i=Reflect.get(t,n,r);i=Nr(i)}return i}})}class vlt extends Lr{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new mlt(this,e)}setup(){return this.call()}}const xlt=[!1,!0],blt=[0,1,2,3],_lt=[-1,-2],YCe=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],lJ=new Map;for(const s of xlt)lJ.set(s,new Rg(s));const cJ=new Map;for(const s of blt)cJ.set(s,new Rg(s,"uint"));const uJ=new Map([...cJ].map(s=>new Rg(s.value,"int")));for(const s of _lt)uJ.set(s,new Rg(s,"int"));const zB=new Map([...uJ].map(s=>new Rg(s.value)));for(const s of YCe)zB.set(s,new Rg(s));for(const s of YCe)zB.set(-s,new Rg(-s));const VB={bool:lJ,uint:cJ,ints:uJ,float:zB},Pbe=new Map([...lJ,...zB]),wK=(s,e)=>Pbe.has(s)?Pbe.get(s):s.isNode===!0?s:new Rg(s,e),ll=function(s,e=null){return(...t)=>{for(const r of t)if(r===void 0)return Js(`TSL: Invalid parameter for the type "${s}".`,new kp),new Rg(0,s);if((t.length===0||!["bool","float","int","uint"].includes(s)&&t.every(r=>{const i=typeof r;return i!=="object"&&i!=="function"}))&&(t=[oJ(s,...t)]),t.length===1&&e!==null&&e.has(t[0]))return fL(e.get(t[0]));if(t.length===1){const r=wK(t[0],s);return r.nodeType===s?fL(r):fL(new qCe(r,s))}const n=t.map(r=>wK(r));return fL(new rlt(n,s))}},Slt=s=>s!=null?s.nodeType||s.convertTo||(typeof s=="string"?s:null):null;function wlt(s,e){return new vlt(s,e)}const Nr=(s,e=null)=>dlt(s,e),fL=(s,e=null)=>Nr(s,e).toVarIntent(),dJ=(s,e=null)=>new hlt(s,e),TS=(s,e=null)=>new plt(s,e),so=(s,e=null,t=null,n=null)=>new XCe(s,e,t,n),Ma=(s,...e)=>new flt(s,...e),ir=(s,e=null,t=null,n={})=>new XCe(s,e,t,{...n,intent:!0});let Tlt=0;class Elt extends Lr{constructor(e,t=null){super();let n=null;t!==null&&(typeof t=="object"?n=t.return:(typeof t=="string"?n=t:Js("TSL: Invalid layout type.",new kp),t=null)),this.shaderNode=new wlt(e,n),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const n={name:"fn"+Tlt++,type:t,inputs:[]};for(const r in e)r!=="return"&&n.inputs.push({name:r,type:e[r]});e=n}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return Js('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".',this.stackTrace),e.generateConst(t)}}function Tr(s,e=null){const t=new Elt(s,e);return new Proxy(()=>{},{apply(n,r,i){return t.call(...i)},get(n,r,i){return Reflect.get(t,r,i)},set(n,r,i,o){return Reflect.set(t,r,i,o)}})}const Hy=(...s)=>clt.If(...s);function Mlt(s){return s}Gt("toStack",Mlt);const Clt=new ll("color"),xs=new ll("float",VB.float),Sl=new ll("int",VB.ints),I0=new ll("uint",VB.uint),hJ=new ll("bool",VB.bool),vm=new ll("vec2"),pg=new ll("ivec2"),KCe=new ll("uvec2"),Alt=new ll("bvec2"),ai=new ll("vec3"),ZCe=new ll("ivec3"),QCe=new ll("uvec3"),Nlt=new ll("bvec3"),Tl=new ll("vec4"),JCe=new ll("ivec4"),eAe=new ll("uvec4"),Plt=new ll("bvec4"),tAe=new ll("mat2"),N5=new ll("mat3"),GB=new ll("mat4");Gt("toColor",Clt);Gt("toFloat",xs);Gt("toInt",Sl);Gt("toUint",I0);Gt("toBool",hJ);Gt("toVec2",vm);Gt("toIVec2",pg);Gt("toUVec2",KCe);Gt("toBVec2",Alt);Gt("toVec3",ai);Gt("toIVec3",ZCe);Gt("toUVec3",QCe);Gt("toBVec3",Nlt);Gt("toVec4",Tl);Gt("toIVec4",JCe);Gt("toUVec4",eAe);Gt("toBVec4",Plt);Gt("toMat2",tAe);Gt("toMat3",N5);Gt("toMat4",GB);const Rlt=so(Iw).setParameterLength(2),Ilt=(s,e)=>new qCe(Nr(s),e);Gt("element",Rlt);Gt("convert",Ilt);Gt("append",s=>(bi("TSL: .append() has been renamed to .toStack().",new kp),s));class dN extends Lr{static get type(){return"PropertyNode"}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return sJ(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const klt=(s,e)=>new dN(s,e),UF=(s,e)=>new dN(s,e,!0),bc=Ma(dN,"vec4","DiffuseColor"),Rbe=Ma(dN,"vec3","EmissiveColor"),eA=Ma(dN,"vec4","Output");class nAe extends Lr{static get type(){return"UniformGroupNode"}constructor(e,t=!1,n=1){super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const Dlt=s=>new nAe(s),rAe=(s,e=0)=>new nAe(s,!0,e),pd=rAe("render"),Olt=Dlt("object");class hN extends aJ{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=Olt}setName(e){return this.name=e,this}label(e){return bi('TSL: "label()" has been deprecated. Use "setName()" instead.',new kp),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(n=>{const r=e(n,this);r!==void 0&&(this.value=r)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const n=this.getNodeType(e),r=this.getUniformHash(e);let i=e.getNodeFromHash(r);i===void 0&&(e.setHashNode(this,r),i=this);const o=i.getInputType(e),l=e.getUniformFromNode(i,o,e.shaderStage,this.name||e.context.nodeName),c=e.getPropertyName(l);e.context.nodeName!==void 0&&delete e.context.nodeName;let h=c;if(n==="bool"){const m=e.getDataFromNode(this);let y=m.propertyName;if(y===void 0){const b=e.getVarFromNode(this,null,"bool");y=e.getPropertyName(b),m.propertyName=y,h=e.format(c,o,n),e.addLineFlowCode(`${y} = ${h}`,this)}h=y}return e.format(h,n,t)}}const sl=(s,e)=>{const t=Slt(e||s);if(t===s&&(s=oJ(t)),s&&s.isNode===!0){let n=s.value;s.traverse(r=>{r.isConstNode===!0&&(n=r.value)}),s=n}return new hN(s,t)};class Ibe extends c0{static get type(){return"ArrayNode"}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null?this.values[0].getNodeType(e):this.nodeType}getElementType(e){return this.getNodeType(e)}getMemberType(e,t){return this.nodeType===null?this.values[0].getMemberType(e,t):super.getMemberType(e,t)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const Llt=(...s)=>{let e;if(s.length===1){const t=s[0];e=new Ibe(null,t.length,t)}else{const t=s[0],n=s[1];e=new Ibe(t,n)}return Nr(e)};Gt("toArray",(s,e)=>Llt(Array(e).fill(s)));class Flt extends c0{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return uN.join("").slice(0,n)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:n}=this,r=t.getScope(),i=e.getDataFromNode(r);i.assign=!0;const o=e.getNodeProperties(this);o.sourceNode=n,o.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:n,sourceNode:r}=e.getNodeProperties(this),i=this.needsSplitAssign(e),o=n.build(e),l=n.getNodeType(e),c=r.build(e,l),h=r.getNodeType(e),m=e.getDataFromNode(this);let y;if(m.initialized===!0)t!=="void"&&(y=o);else if(i){const b=e.getVarFromNode(this,null,l),w=e.getPropertyName(b);e.addLineFlowCode(`${w} = ${c}`,this);const A=n.node,D=A.node.context({assign:!0}).build(e);for(let P=0;P<A.components.length;P++){const U=A.components[P];e.addLineFlowCode(`${D}.${U} = ${w}[ ${P} ]`,this)}t!=="void"&&(y=o)}else y=`${o} = ${c}`,(t==="void"||h==="void")&&(e.addLineFlowCode(y,this),t!=="void"&&(y=o));return m.initialized=!0,e.format(y,l,t)}}const Blt=so(Flt).setParameterLength(2);Gt("assign",Blt);class Ult extends c0{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],n=this.functionNode,r=n.getInputs(e),i=this.parameters,o=(c,h)=>{const m=h.type,y=m==="pointer";let b;return y?b="&"+c.build(e):b=c.build(e,m),b};if(Array.isArray(i)){if(i.length>r.length)Js("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),i.length=r.length;else if(i.length<r.length)for(Js("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");i.length<r.length;)i.push(xs(0));for(let c=0;c<i.length;c++)t.push(o(i[c],r[c]))}else for(const c of r){const h=i[c.name];h!==void 0?t.push(o(h,c)):(Js(`TSL: Input '${c.name}' not found in 'Fn()'.`),t.push(o(xs(0),c)))}return`${n.build(e,"property")}( ${t.join(", ")} )`}}const zlt=(s,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?TS(e):dJ(e[0]),new Ult(Nr(s),e));Gt("call",zlt);const Vlt={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class jo extends c0{static get type(){return"OperatorNode"}constructor(e,t,n,...r){if(super(),r.length>0){let i=new jo(e,t,n);for(let o=0;o<r.length-1;o++)i=new jo(e,i,r[o]);t=i,n=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(Vlt[this.op],t)}getNodeType(e,t=null){const n=this.op,r=this.aNode,i=this.bNode,o=r.getNodeType(e),l=i?i.getNodeType(e):null;if(o==="void"||l==="void")return t||"void";if(n==="%")return o;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return e.getIntegerType(o);if(n==="!"||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">="){const c=Math.max(e.getTypeLength(o),e.getTypeLength(l));return c>1?`bvec${c}`:"bool"}else{if(e.isMatrix(o)){if(l==="float")return o;if(e.isVector(l))return e.getVectorFromMatrix(o);if(e.isMatrix(l))return o}else if(e.isMatrix(l)){if(o==="float")return l;if(e.isVector(o))return e.getVectorFromMatrix(l)}return e.getTypeLength(l)>e.getTypeLength(o)?l:o}}generate(e,t){const n=this.op,{aNode:r,bNode:i}=this,o=this.getNodeType(e,t);let l=null,c=null;o!=="void"?(l=r.getNodeType(e),c=i?i.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="||n==="!="?e.isVector(l)?c=l:e.isVector(c)?l=c:l!==c&&(l=c="float"):n===">>"||n==="<<"?(l=o,c=e.changeComponentType(c,"uint")):n==="%"?(l=o,c=e.isInteger(l)&&e.isInteger(c)?c:l):e.isMatrix(l)?c==="float"?c="float":e.isVector(c)?c=e.getVectorFromMatrix(l):e.isMatrix(c)||(l=c=o):e.isMatrix(c)?l==="float"?l="float":e.isVector(l)?l=e.getVectorFromMatrix(c):l=c=o:l=c=o):l=c=o;const h=r.build(e,l),m=i?i.build(e,c):null,y=e.getFunctionOperator(n);if(t!=="void"){const b=e.renderer.coordinateSystem===W3;if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">=")return b?e.isVector(l)?e.format(`${this.getOperatorMethod(e,t)}( ${h}, ${m} )`,o,t):e.format(`( ${h} ${n} ${m} )`,o,t):e.format(`( ${h} ${n} ${m} )`,o,t);if(n==="%")return e.isInteger(c)?e.format(`( ${h} % ${m} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${h}, ${m} )`,o,t);if(n==="!"||n==="~")return e.format(`(${n}${h})`,l,t);if(y)return e.format(`${y}( ${h}, ${m} )`,o,t);if(e.isMatrix(l)&&c==="float")return e.format(`( ${m} ${n} ${h} )`,o,t);if(l==="float"&&e.isMatrix(c))return e.format(`${h} ${n} ${m}`,o,t);{let w=`( ${h} ${n} ${m} )`;return!b&&o==="bool"&&e.isVector(l)&&e.isVector(c)&&(w=`all${w}`),e.format(w,o,t)}}else if(l!=="void")return y?e.format(`${y}( ${h}, ${m} )`,o,t):e.isMatrix(l)&&c==="float"?e.format(`${m} ${n} ${h}`,o,t):e.format(`${h} ${n} ${m}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const OA=ir(jo,"+").setParameterLength(2,1/0).setName("add"),O3=ir(jo,"-").setParameterLength(2,1/0).setName("sub"),xu=ir(jo,"*").setParameterLength(2,1/0).setName("mul"),iAe=ir(jo,"/").setParameterLength(2,1/0).setName("div"),pJ=ir(jo,"%").setParameterLength(2).setName("mod"),Glt=ir(jo,"==").setParameterLength(2).setName("equal"),jlt=ir(jo,"!=").setParameterLength(2).setName("notEqual"),Hlt=ir(jo,"<").setParameterLength(2).setName("lessThan"),$lt=ir(jo,">").setParameterLength(2).setName("greaterThan"),Wlt=ir(jo,"<=").setParameterLength(2).setName("lessThanEqual"),qlt=ir(jo,">=").setParameterLength(2).setName("greaterThanEqual"),Xlt=ir(jo,"&&").setParameterLength(2,1/0).setName("and"),Ylt=ir(jo,"||").setParameterLength(2,1/0).setName("or"),Klt=ir(jo,"!").setParameterLength(1).setName("not"),Zlt=ir(jo,"^^").setParameterLength(2).setName("xor"),Qlt=ir(jo,"&").setParameterLength(2).setName("bitAnd"),Jlt=ir(jo,"~").setParameterLength(1).setName("bitNot"),e0t=ir(jo,"|").setParameterLength(2).setName("bitOr"),t0t=ir(jo,"^").setParameterLength(2).setName("bitXor"),n0t=ir(jo,"<<").setParameterLength(2).setName("shiftLeft"),r0t=ir(jo,">>").setParameterLength(2).setName("shiftRight"),i0t=Tr(([s])=>(s.addAssign(1),s)),s0t=Tr(([s])=>(s.subAssign(1),s)),o0t=Tr(([s])=>{const e=Sl(s).toConst();return s.addAssign(1),e}),a0t=Tr(([s])=>{const e=Sl(s).toConst();return s.subAssign(1),e});Gt("add",OA);Gt("sub",O3);Gt("mul",xu);Gt("div",iAe);Gt("mod",pJ);Gt("equal",Glt);Gt("notEqual",jlt);Gt("lessThan",Hlt);Gt("greaterThan",$lt);Gt("lessThanEqual",Wlt);Gt("greaterThanEqual",qlt);Gt("and",Xlt);Gt("or",Ylt);Gt("not",Klt);Gt("xor",Zlt);Gt("bitAnd",Qlt);Gt("bitNot",Jlt);Gt("bitOr",e0t);Gt("bitXor",t0t);Gt("shiftLeft",n0t);Gt("shiftRight",r0t);Gt("incrementBefore",i0t);Gt("decrementBefore",s0t);Gt("increment",o0t);Gt("decrement",a0t);const l0t=(s,e)=>(bi('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.',new kp),pJ(Sl(s),Sl(e)));Gt("modInt",l0t);class yt extends c0{static get type(){return"MathNode"}constructor(e,t,n=null,r=null){if(super(),(e===yt.MAX||e===yt.MIN)&&arguments.length>3){let i=new yt(e,t,n);for(let o=2;o<arguments.length-1;o++)i=new yt(e,i,arguments[o]);t=i,n=arguments[arguments.length-1],r=null}this.method=e,this.aNode=t,this.bNode=n,this.cNode=r,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(n)?0:e.getTypeLength(n),l=e.isMatrix(r)?0:e.getTypeLength(r);return i>o&&i>l?t:o>l?n:l>i?r:t}getNodeType(e){const t=this.method;return t===yt.LENGTH||t===yt.DISTANCE||t===yt.DOT?"float":t===yt.CROSS?"vec3":t===yt.ALL||t===yt.ANY?"bool":t===yt.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:n,method:r}=this;let i=null;if(r===yt.ONE_MINUS)i=O3(1,t);else if(r===yt.RECIPROCAL)i=iAe(1,t);else if(r===yt.DIFFERENCE)i=jB(O3(t,n));else if(r===yt.TRANSFORM_DIRECTION){let o=t,l=n;e.isMatrix(o.getNodeType(e))?l=Tl(ai(l),0):o=Tl(ai(o),0);const c=xu(o,l).xyz;i=oAe(c)}return i!==null?i:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let r=this.method;const i=this.getNodeType(e),o=this.getInputType(e),l=this.aNode,c=this.bNode,h=this.cNode,m=e.renderer.coordinateSystem;if(r===yt.NEGATE)return e.format("( - "+l.build(e,o)+" )",i,t);{const y=[];return r===yt.CROSS?y.push(l.build(e,i),c.build(e,i)):m===W3&&r===yt.STEP?y.push(l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":o),c.build(e,o)):m===W3&&(r===yt.MIN||r===yt.MAX)?y.push(l.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):r===yt.REFRACT?y.push(l.build(e,o),c.build(e,o),h.build(e,"float")):r===yt.MIX?y.push(l.build(e,o),c.build(e,o),h.build(e,e.getTypeLength(h.getNodeType(e))===1?"float":o)):(m===lw&&r===yt.ATAN&&c!==null&&(r="atan2"),e.shaderStage!=="fragment"&&(r===yt.DFDX||r===yt.DFDY)&&(bi(`TSL: '${r}' is not supported in the ${e.shaderStage} stage.`,this.stackTrace),r="/*"+r+"*/"),y.push(l.build(e,o)),c!==null&&y.push(c.build(e,o)),h!==null&&y.push(h.build(e,o))),e.format(`${e.getMethod(r,i)}( ${y.join(", ")} )`,i,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}yt.ALL="all";yt.ANY="any";yt.RADIANS="radians";yt.DEGREES="degrees";yt.EXP="exp";yt.EXP2="exp2";yt.LOG="log";yt.LOG2="log2";yt.SQRT="sqrt";yt.INVERSE_SQRT="inversesqrt";yt.FLOOR="floor";yt.CEIL="ceil";yt.NORMALIZE="normalize";yt.FRACT="fract";yt.SIN="sin";yt.COS="cos";yt.TAN="tan";yt.ASIN="asin";yt.ACOS="acos";yt.ATAN="atan";yt.ABS="abs";yt.SIGN="sign";yt.LENGTH="length";yt.NEGATE="negate";yt.ONE_MINUS="oneMinus";yt.DFDX="dFdx";yt.DFDY="dFdy";yt.ROUND="round";yt.RECIPROCAL="reciprocal";yt.TRUNC="trunc";yt.FWIDTH="fwidth";yt.TRANSPOSE="transpose";yt.DETERMINANT="determinant";yt.INVERSE="inverse";yt.EQUALS="equals";yt.MIN="min";yt.MAX="max";yt.STEP="step";yt.REFLECT="reflect";yt.DISTANCE="distance";yt.DIFFERENCE="difference";yt.DOT="dot";yt.CROSS="cross";yt.POW="pow";yt.TRANSFORM_DIRECTION="transformDirection";yt.MIX="mix";yt.CLAMP="clamp";yt.REFRACT="refract";yt.SMOOTHSTEP="smoothstep";yt.FACEFORWARD="faceforward";const c0t=xs(Math.PI),u0t=ir(yt,yt.ALL).setParameterLength(1),d0t=ir(yt,yt.ANY).setParameterLength(1),h0t=ir(yt,yt.RADIANS).setParameterLength(1),p0t=ir(yt,yt.DEGREES).setParameterLength(1),f0t=ir(yt,yt.EXP).setParameterLength(1),TK=ir(yt,yt.EXP2).setParameterLength(1),m0t=ir(yt,yt.LOG).setParameterLength(1),ES=ir(yt,yt.LOG2).setParameterLength(1),fJ=ir(yt,yt.SQRT).setParameterLength(1),g0t=ir(yt,yt.INVERSE_SQRT).setParameterLength(1),rF=ir(yt,yt.FLOOR).setParameterLength(1),sAe=ir(yt,yt.CEIL).setParameterLength(1),oAe=ir(yt,yt.NORMALIZE).setParameterLength(1),uw=ir(yt,yt.FRACT).setParameterLength(1),LA=ir(yt,yt.SIN).setParameterLength(1),aAe=ir(yt,yt.COS).setParameterLength(1),y0t=ir(yt,yt.TAN).setParameterLength(1),v0t=ir(yt,yt.ASIN).setParameterLength(1),x0t=ir(yt,yt.ACOS).setParameterLength(1),b0t=ir(yt,yt.ATAN).setParameterLength(1,2),jB=ir(yt,yt.ABS).setParameterLength(1),lAe=ir(yt,yt.SIGN).setParameterLength(1),EK=ir(yt,yt.LENGTH).setParameterLength(1),cAe=ir(yt,yt.NEGATE).setParameterLength(1),_0t=ir(yt,yt.ONE_MINUS).setParameterLength(1),uAe=ir(yt,yt.DFDX).setParameterLength(1),dAe=ir(yt,yt.DFDY).setParameterLength(1),S0t=ir(yt,yt.ROUND).setParameterLength(1),w0t=ir(yt,yt.RECIPROCAL).setParameterLength(1),T0t=ir(yt,yt.TRUNC).setParameterLength(1),hAe=ir(yt,yt.FWIDTH).setParameterLength(1),E0t=ir(yt,yt.TRANSPOSE).setParameterLength(1),M0t=ir(yt,yt.DETERMINANT).setParameterLength(1),C0t=ir(yt,yt.INVERSE).setParameterLength(1),pAe=ir(yt,yt.MIN).setParameterLength(2,1/0),fAe=ir(yt,yt.MAX).setParameterLength(2,1/0),mAe=ir(yt,yt.STEP).setParameterLength(2),A0t=ir(yt,yt.REFLECT).setParameterLength(2),N0t=ir(yt,yt.DISTANCE).setParameterLength(2),P0t=ir(yt,yt.DIFFERENCE).setParameterLength(2),pN=ir(yt,yt.DOT).setParameterLength(2),R0t=ir(yt,yt.CROSS).setParameterLength(2),gAe=ir(yt,yt.POW).setParameterLength(2),I0t=s=>xu(s,s),k0t=s=>xu(s,s,s),D0t=s=>xu(s,s,s,s),O0t=ir(yt,yt.TRANSFORM_DIRECTION).setParameterLength(2),L0t=s=>xu(lAe(s),gAe(jB(s),1/3)),yAe=s=>pN(s,s),dw=ir(yt,yt.MIX).setParameterLength(3),mJ=(s,e=0,t=1)=>new yt(yt.CLAMP,Nr(s),Nr(e),Nr(t)),vAe=s=>mJ(s),F0t=ir(yt,yt.REFRACT).setParameterLength(3),hw=ir(yt,yt.SMOOTHSTEP).setParameterLength(3),B0t=ir(yt,yt.FACEFORWARD).setParameterLength(3),U0t=Tr(([s])=>{const n=43758.5453,r=pN(s.xy,vm(12.9898,78.233)),i=pJ(r,c0t);return uw(LA(i).mul(n))}),z0t=(s,e,t)=>dw(e,t,s),V0t=(s,e,t)=>hw(e,t,s),G0t=(s,e)=>mAe(e,s);Gt("all",u0t);Gt("any",d0t);Gt("radians",h0t);Gt("degrees",p0t);Gt("exp",f0t);Gt("exp2",TK);Gt("log",m0t);Gt("log2",ES);Gt("sqrt",fJ);Gt("inverseSqrt",g0t);Gt("floor",rF);Gt("ceil",sAe);Gt("normalize",oAe);Gt("fract",uw);Gt("sin",LA);Gt("cos",aAe);Gt("tan",y0t);Gt("asin",v0t);Gt("acos",x0t);Gt("atan",b0t);Gt("abs",jB);Gt("sign",lAe);Gt("length",EK);Gt("lengthSq",yAe);Gt("negate",cAe);Gt("oneMinus",_0t);Gt("dFdx",uAe);Gt("dFdy",dAe);Gt("round",S0t);Gt("reciprocal",w0t);Gt("trunc",T0t);Gt("fwidth",hAe);Gt("min",pAe);Gt("max",fAe);Gt("step",G0t);Gt("reflect",A0t);Gt("distance",N0t);Gt("dot",pN);Gt("cross",R0t);Gt("pow",gAe);Gt("pow2",I0t);Gt("pow3",k0t);Gt("pow4",D0t);Gt("transformDirection",O0t);Gt("mix",z0t);Gt("clamp",mJ);Gt("refract",F0t);Gt("smoothstep",V0t);Gt("faceForward",B0t);Gt("difference",P0t);Gt("saturate",vAe);Gt("cbrt",L0t);Gt("transpose",E0t);Gt("determinant",M0t);Gt("inverse",C0t);Gt("rand",U0t);class j0t extends Lr{static get type(){return"ConditionalNode"}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const r=t.getNodeType(e);if(n!==null){const i=n.getNodeType(e);if(e.getTypeLength(i)>e.getTypeLength(r))return i}return r}setup(e){const t=this.condNode,n=this.ifNode.isolate(),r=this.elseNode?this.elseNode.isolate():null,i=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=i,r!==null&&(e.getDataFromNode(r).parentNodeBlock=i);const o=e.context.uniformFlow,l=e.getNodeProperties(this);l.condNode=t,l.ifNode=o?n:n.context({nodeBlock:n}),l.elseNode=r?o?r:r.context({nodeBlock:r}):null}generate(e,t){const n=this.getNodeType(e),r=e.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;const{condNode:i,ifNode:o,elseNode:l}=e.getNodeProperties(this),c=e.currentFunctionNode,h=t!=="void",m=h?klt(n).build(e):"";r.nodeProperty=m;const y=i.build(e,"bool");if(e.context.uniformFlow&&l!==null){const A=o.build(e,n),I=l.build(e,n),D=e.getTernary(y,A,I);return e.format(D,n,t)}e.addFlowCode(`
${e.tab}if ( ${y} ) {

`).addFlowTab();let w=o.build(e,n);if(w&&(h?w=m+" = "+w+";":(w="return "+w+";",c===null&&(bi("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values.",this.stackTrace),w="// "+w))),e.removeFlowTab().addFlowCode(e.tab+"	"+w+`

`+e.tab+"}"),l!==null){e.addFlowCode(` else {

`).addFlowTab();let A=l.build(e,n);A&&(h?A=m+" = "+A+";":(A="return "+A+";",c===null&&(bi("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values.",this.stackTrace),A="// "+A))),e.removeFlowTab().addFlowCode(e.tab+"	"+A+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(m,n,t)}}const gJ=so(j0t).setParameterLength(2,3);Gt("select",gJ);class xAe extends Lr{static get type(){return"ContextNode"}constructor(e=null,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getFlowContextData(){const e=[];return this.traverse(t=>{t.isContextNode===!0&&e.push(t.value)}),Object.assign({},...e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const n=e.addContext(this.value),r=this.node.build(e,t);return e.setContext(n),r}}const kw=(s=null,e={})=>{let t=s;return(t===null||t.isNode!==!0)&&(e=t||e,t=null),new xAe(t,e)},H0t=s=>kw(s,{uniformFlow:!0}),bAe=(s,e)=>kw(s,{nodeName:e});function $0t(s,e,t=null){return kw(t,{getShadow:({light:n,shadowColorNode:r})=>e===n?r.mul(s):r})}function W0t(s,e=null){return kw(e,{getAO:(t,{material:n})=>n.transparent===!0?t:t!==null?t.mul(s):s})}function q0t(s,e){return bi('TSL: "label()" has been deprecated. Use "setName()" instead.'),bAe(s,e)}Gt("context",kw);Gt("label",q0t);Gt("uniformFlow",H0t);Gt("setName",bAe);Gt("builtinShadowContext",(s,e,t)=>$0t(e,t,s));Gt("builtinAOContext",(s,e)=>W0t(e,s));class X0t extends Lr{static get type(){return"VarNode"}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}isIntent(e){return e.getDataFromNode(this).forceDeclaration===!0?!1:this.intent}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){return e.getDataFromNode(this).assign}build(...e){const t=e[0];if(this._hasStack(t)===!1&&t.buildStage==="setup"&&(t.context.nodeLoop||t.context.nodeBlock)){let n=!1;if(this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&t.fnCall&&t.fnCall.shaderNode&&t.getDataFromNode(this.node.shaderNode).hasLoop){const o=t.getDataFromNode(this);o.forceDeclaration=!0,n=!0}const r=t.getBaseStack();n?r.addToStackBefore(this):r.addToStack(this)}return this.isIntent(t)&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:n,readOnly:r}=this,{renderer:i}=e,o=i.backend.isWebGPUBackend===!0;let l=!1,c=!1;r&&(l=e.isDeterministic(t),c=o?r:l);const h=this.getNodeType(e);if(h=="void")return this.isIntent(e)!==!0&&Js('TSL: ".toVar()" can not be used with void type.',this.stackTrace),t.build(e);const m=e.getVectorType(h),y=t.build(e,m),b=e.getVarFromNode(this,n,m,void 0,c),w=e.getPropertyName(b);let A=w;if(c)if(o)A=l?`const ${w}`:`let ${w}`;else{const I=t.getArrayCount(e);A=`const ${e.getVar(b.type,w,I)}`}return e.addLineFlowCode(`${A} = ${y}`,this),w}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}}const yJ=so(X0t),Y0t=(s,e=null)=>yJ(s,e).toStack(),K0t=(s,e=null)=>yJ(s,e,!0).toStack(),Z0t=s=>yJ(s).setIntent(!0).toStack();Gt("toVar",Y0t);Gt("toConst",K0t);Gt("toVarIntent",Z0t);class Q0t extends Lr{static get type(){return"SubBuild"}constructor(e,t,n=null){super(n),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const n=this.node.build(e,...t);return e.removeSubBuild(),n}}const tA=(s,e,t=null)=>new Q0t(Nr(s),e,t);class J0t extends Lr{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=tA(e,"VERTEX"),this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(n===void 0){const r=this.name,i=this.getNodeType(e),o=this.interpolationType,l=this.interpolationSampling;t.varying=n=e.getVaryingFromNode(this,r,i,o,l),t.node=tA(this.node,"VERTEX")}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(hL.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(hL.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),n=e.getNodeProperties(this),r=this.setupVarying(e);if(n[t]===void 0){const i=this.getNodeType(e),o=e.getPropertyName(r,hL.VERTEX);e.flowNodeFromShaderStage(hL.VERTEX,n.node,i,o),n[t]=o}return e.getPropertyName(r)}}const Dw=so(J0t).setParameterLength(1,2),ect=s=>Dw(s);Gt("toVarying",Dw);Gt("toVertexStage",ect);const tct=Tr(([s])=>{const e=s.mul(.9478672986).add(.0521327014).pow(2.4),t=s.mul(.0773993808),n=s.lessThanEqual(.04045);return dw(e,t,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),nct=Tr(([s])=>{const e=s.pow(.41666).mul(1.055).sub(.055),t=s.mul(12.92),n=s.lessThanEqual(.0031308);return dw(e,t,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),vJ="WorkingColorSpace",rct="OutputColorSpace";class _Ae extends c0{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===vJ?bl.workingColorSpace:t===rct?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let i=t;return bl.enabled===!1||n===r||!n||!r||(bl.getTransfer(n)===YC&&(i=Tl(tct(i.rgb),i.a)),bl.getPrimaries(n)!==bl.getPrimaries(r)&&(i=Tl(N5(bl._getMatrix(new Bp,n,r)).mul(i.rgb),i.a)),bl.getTransfer(r)===YC&&(i=Tl(nct(i.rgb),i.a))),i}}const ict=(s,e)=>new _Ae(Nr(s),vJ,e),SAe=(s,e)=>new _Ae(Nr(s),e,vJ);Gt("workingToColorSpace",ict);Gt("colorSpaceToWorking",SAe);let sct=class extends Iw{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}};class oct extends Lr{static get type(){return"ReferenceBaseNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=Qs.OBJECT}setGroup(e){return this.group=e,this}element(e){return new sct(this,Nr(e))}setNodeType(e){const t=sl(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}class act extends oct{static get type(){return"RendererReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(pd)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const lct=(s,e,t=null)=>new act(s,e,t);class cct extends c0{static get type(){return"ToneMappingNode"}constructor(e,t=dct,n=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return $Ce(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,n=this._toneMapping;if(n===yK)return t;let r=null;const i=e.renderer.library.getToneMappingFunction(n);return i!==null?r=Tl(i(t.rgb,this.exposureNode),t.a):(Js("ToneMappingNode: Unsupported Tone Mapping configuration.",n),r=t),r}}const uct=(s,e,t)=>new cct(s,Nr(e),Nr(t)),dct=lct("toneMappingExposure","float");Gt("toneMapping",(s,e,t)=>uct(e,t,s));const el=new Yt,mL=new il;let hct=0;class d5{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:hct++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=aw,this.updateRanges=[],this.gpuType=ICe,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)mL.fromBufferAttribute(this,t),mL.applyMatrix3(e),this.setXY(t,mL.x,mL.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)el.fromBufferAttribute(this,t),el.applyMatrix3(e),this.setXYZ(t,el.x,el.y,el.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)el.fromBufferAttribute(this,t),el.applyMatrix4(e),this.setXYZ(t,el.x,el.y,el.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)el.fromBufferAttribute(this,t),el.applyNormalMatrix(e),this.setXYZ(t,el.x,el.y,el.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)el.fromBufferAttribute(this,t),el.transformDirection(e),this.setXYZ(t,el.x,el.y,el.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=lm(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=js(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=lm(t,this.array)),t}setX(e,t){return this.normalized&&(t=js(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=lm(t,this.array)),t}setY(e,t){return this.normalized&&(t=js(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=lm(t,this.array)),t}setZ(e,t){return this.normalized&&(t=js(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=lm(t,this.array)),t}setW(e,t){return this.normalized&&(t=js(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=js(t,this.array),n=js(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=js(t,this.array),n=js(n,this.array),r=js(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=js(t,this.array),n=js(n,this.array),r=js(r,this.array),i=js(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==aw&&(e.usage=this.usage),e}}class pct extends d5{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class fct extends d5{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class iF extends d5{constructor(e,t,n){super(new Float32Array(e),t,n)}}const cu=new Yt;class xJ{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)cu.fromBufferAttribute(this,t),cu.applyMatrix4(e),this.setXYZ(t,cu.x,cu.y,cu.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)cu.fromBufferAttribute(this,t),cu.applyNormalMatrix(e),this.setXYZ(t,cu.x,cu.y,cu.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)cu.fromBufferAttribute(this,t),cu.transformDirection(e),this.setXYZ(t,cu.x,cu.y,cu.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=lm(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=js(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=js(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=js(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=js(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=js(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=lm(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=lm(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=lm(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=lm(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=js(t,this.array),n=js(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=js(t,this.array),n=js(n,this.array),r=js(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=js(t,this.array),n=js(n,this.array),r=js(r,this.array),i=js(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(e===void 0){xK("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)t.push(this.data.array[r+i])}return new d5(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new xJ(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){xK("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)t.push(this.data.array[r+i])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class wAe{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=aw,this.updateRanges=[],this.version=0,this.uuid=Z3()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Z3()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Z3()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const kbe=new WeakMap;function Dbe(s,e){let t=kbe.get(s);return t===void 0&&(t=new wAe(s,e),kbe.set(s,t)),t}class Dy extends aJ{static get type(){return"BufferAttributeNode"}constructor(e,t=null,n=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=r,this.usage=aw,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&e.itemSize<=4&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),n=e.getTypeLength(t),r=this.value,i=this.bufferStride||n,o=this.bufferOffset;let l;r.isInterleavedBuffer===!0?l=r:r.isBufferAttribute===!0?l=Dbe(r.array,i):l=Dbe(r,i);const c=new xJ(l,n,o);l.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(n);let i=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=r,i=r):i=Dw(this).build(e,t),i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}function bJ(s,e=null,t=0,n=0,r=aw,i=!1){return e==="mat3"||e===null&&s.itemSize===9?N5(new Dy(s,"vec3",9,0).setUsage(r).setInstanced(i),new Dy(s,"vec3",9,3).setUsage(r).setInstanced(i),new Dy(s,"vec3",9,6).setUsage(r).setInstanced(i)):e==="mat4"||e===null&&s.itemSize===16?GB(new Dy(s,"vec4",16,0).setUsage(r).setInstanced(i),new Dy(s,"vec4",16,4).setUsage(r).setInstanced(i),new Dy(s,"vec4",16,8).setUsage(r).setInstanced(i),new Dy(s,"vec4",16,12).setUsage(r).setInstanced(i)):new Dy(s,e,t,n).setUsage(r)}const TAe=(s,e=null,t=0,n=0)=>bJ(s,e,t,n),Obe=(s,e=null,t=0,n=0)=>bJ(s,e,t,n,aw,!0),Lbe=(s,e=null,t=0,n=0)=>bJ(s,e,t,n,vK,!0);Gt("toAttribute",s=>TAe(s.value));class mct extends Lr{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=Qs.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return bi('TSL: "label()" has been deprecated. Use "setName()" instead.',new kp),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const n=e.getNodeProperties(this);n.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:n}=e;if(n==="compute"){const r=this.computeNode.build(e,"void");r!==""&&e.addLineFlowCode(r,this)}else{const i=e.getNodeProperties(this).outputComputeNode;if(i)return i.build(e,t)}}}const EAe=(s,e=[64])=>{(e.length===0||e.length>3)&&Js("TSL: compute() workgroupSize must have 1, 2, or 3 elements",new kp);for(let t=0;t<e.length;t++){const n=e[t];(typeof n!="number"||n<=0||!Number.isInteger(n))&&Js(`TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`,new kp)}for(;e.length<3;)e.push(1);return new mct(Nr(s),e)},gct=(s,e,t)=>EAe(s,t).setCount(e);Gt("compute",gct);Gt("computeKernel",EAe);class yct extends Lr{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){const n=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const i=this.node.build(e,...t);return e.setCache(n),i}setParent(e){return this.parent=e,this}getParent(){return this.parent}}const MAe=s=>new yct(Nr(s));function vct(s,e=!0){return bi('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),MAe(s).setParent(e)}Gt("cache",vct);Gt("isolate",MAe);class xct extends Lr{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const bct=so(xct).setParameterLength(2);Gt("bypass",bct);class CAe extends Lr{static get type(){return"RemapNode"}constructor(e,t,n,r=xs(0),i=xs(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=r,this.outHighNode=i,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:r,outHighNode:i,doClamp:o}=this;let l=e.sub(t).div(n.sub(t));return o===!0&&(l=l.clamp()),l.mul(i.sub(r)).add(r)}}const _ct=so(CAe,null,null,{doClamp:!1}).setParameterLength(3,5),AAe=so(CAe).setParameterLength(3,5);Gt("remap",_ct);Gt("remapClamp",AAe);class Sct extends Lr{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const n=this.getNodeType(e),r=this.snippet;if(n==="void")e.addLineFlowCode(r,this);else return e.format(r,n,t)}}const rx=so(Sct).setParameterLength(1,2),wct=s=>(s?gJ(s,rx("discard")):rx("discard")).toStack();Gt("discard",wct);class Tct extends c0{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const n=(this._toneMapping!==null?this._toneMapping:e.toneMapping)||yK,r=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||IF;return n!==yK&&(t=t.toneMapping(n)),r!==IF&&r!==bl.workingColorSpace&&(t=t.workingToColorSpace(r)),t}}const Ect=(s,e=null,t=null)=>new Tct(Nr(s),e,t);Gt("renderOutput",Ect);class Mct extends c0{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,n=this.node.build(e);if(t!==null)t(e,n);else{const r="--- TSL debug - "+e.shaderStage+" shader ---",i="-".repeat(r.length);let o="";o+="// #"+r+`#
`,o+=e.flow.code.replace(/^\t/mg,"")+`
`,o+="/* ... */ "+n+` /* ... */
`,o+="// #"+i+`#
`,xK(o)}return n}}const Cct=(s,e=null)=>new Mct(Nr(s),e).toStack();Gt("debug",Cct);class Act{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class Nct extends Lr{static get type(){return"InspectorNode"}constructor(e,t="",n=null){super(),this.node=e,this.name=t,this.callback=n,this.updateType=Qs.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==Act&&DA('TSL: ".toInspector()" is only available with WebGPU.'),t}}function Pct(s,e="",t=null){return s=Nr(s),s.before(new Nct(s,e,t))}Gt("toInspector",Pct);class NAe extends Lr{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const r=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const i=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(i),l=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(l.name,o,n):Dw(this).build(e,n)}else return bi(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const pw=(s,e=null)=>new NAe(s,e),fN=(s=0)=>pw("uv"+(s>0?s:""),"vec2");class Rct extends Lr{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),r=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${r} )`,this.getNodeType(e),t)}}const nA=so(Rct).setParameterLength(1,2);class Ict extends hN{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Qs.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&n.width!==void 0){const{width:r,height:i}=n;this.value=Math.log2(Math.max(r,i))}}}const kct=so(Ict).setParameterLength(1);let V_;class Dct{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{V_===void 0&&(V_=Q7e("canvas")),V_.width=e.width,V_.height=e.height;const r=V_.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=V_}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Q7e("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let o=0;o<i.length;o++)i[o]=Q3(i[o]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Q3(t[n]/255)*255):t[n]=Q3(t[n]);return{data:t,width:e.width,height:e.height}}else return bi("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Oct=0;class _J{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Oct++}),this.uuid=Z3(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):typeof VideoFrame<"u"&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let i;if(Array.isArray(r)){i=[];for(let o=0,l=r.length;o<l;o++)r[o].isDataTexture?i.push(BX(r[o].image)):i.push(BX(r[o]))}else i=BX(r);n.url=i}return t||(e.images[this.uuid]=n),n}}function BX(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?Dct.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(bi("Texture: Unable to serialize Texture."),{})}let Lct=0;const UX=new Yt;class yh extends Pw{constructor(e=yh.DEFAULT_IMAGE,t=yh.DEFAULT_MAPPING,n=IC,r=IC,i=RF,o=JQ,l=Not,c=Mot,h=yh.DEFAULT_ANISOTROPY,m=IF){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Lct++}),this.uuid=Z3(),this.name="",this.source=new _J(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=h,this.format=l,this.internalFormat=null,this.type=c,this.offset=new il(0,0),this.repeat=new il(1,1),this.center=new il(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Bp,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=m,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(UX).x}get height(){return this.source.getSize(UX).y}get depth(){return this.source.getSize(UX).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){bi(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){bi(`Texture.setValues(): property '${t}' does not exist.`);continue}r&&n&&r.isVector2&&n.isVector2||r&&n&&r.isVector3&&n.isVector3||r&&n&&r.isMatrix3&&n.isMatrix3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==CCe)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case W7e:e.x=e.x-Math.floor(e.x);break;case IC:e.x=e.x<0?0:1;break;case q7e:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case W7e:e.y=e.y-Math.floor(e.y);break;case IC:e.y=e.y<0?0:1;break;case q7e:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}yh.DEFAULT_IMAGE=null;yh.DEFAULT_MAPPING=CCe;yh.DEFAULT_ANISOTROPY=1;class Fct extends Error{constructor(e,t=null){super(e),this.name="NodeError",this.stackTrace=t}}const PAe=new yh;class HB extends hN{static get type(){return"TextureNode"}constructor(e=PAe,t=null,n=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Qs.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===RCe?"uvec4":this.value.type===Cot?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return fN(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=sl(this.value.matrix)),this._matrixUniform.mul(ai(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=sl(!1)),t=t.toVar(),this.sampler?t=this._flipYUniform.select(t.flipY(),t):t=this._flipYUniform.select(t.setY(Sl(nA(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new Fct("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().",this.stackTrace);const r=Tr(()=>{let c=this.uvNode;return(c===null||e.context.forceUVContext===!0)&&e.context.getUV&&(c=e.context.getUV(this,e)),c||(c=this.getDefaultUV()),this.updateMatrix===!0&&(c=this.getTransformedUV(c)),c=this.setupUV(e,c),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?Qs.OBJECT:Qs.NONE,c})();let i=this.levelNode;i===null&&e.context.getTextureLevel&&(i=e.context.getTextureLevel(this));let o=null,l=null;this.compareNode!==null&&(e.renderer.hasCompatibility(Fot.TEXTURE_COMPARE)?o=this.compareNode:this.value.compareFunction===null||this.value.compareFunction===Lot?l=this.compareNode:(o=this.compareNode,DA('TSL: Only "LessCompare" is supported for depth texture comparison fallback.'))),t.uvNode=r,t.levelNode=i,t.biasNode=this.biasNode,t.compareNode=o,t.compareStepNode=l,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,n,r,i,o,l,c,h){const m=this.value;let y;return i?y=e.generateTextureBias(m,t,n,i,o,h):c?y=e.generateTextureGrad(m,t,n,c,o,h):l?y=e.generateTextureCompare(m,t,n,l,o,h):this.sampler===!1?y=e.generateTextureLoad(m,t,n,r,o,h):r?y=e.generateTextureLevel(m,t,n,r,o,h):y=e.generateTexture(m,t,n,o,h),y}generate(e,t){const n=this.value,r=e.getNodeProperties(this),i=super.generate(e,"property");if(/^sampler/.test(t))return i+"_sampler";if(e.isReference(t))return i;{const o=e.getDataFromNode(this),l=this.getNodeType(e);let c=o.propertyName;if(c===void 0){const{uvNode:m,levelNode:y,biasNode:b,compareNode:w,compareStepNode:A,depthNode:I,gradNode:D,offsetNode:P}=r,U=this.generateUV(e,m),j=y?y.build(e,"float"):null,C=b?b.build(e,"float"):null,Z=I?I.build(e,"int"):null,ie=w?w.build(e,"float"):null,se=A?A.build(e,"float"):null,z=D?[D[0].build(e,"vec2"),D[1].build(e,"vec2")]:null,re=P?this.generateOffset(e,P):null,ye=e.getVarFromNode(this);c=e.getPropertyName(ye);let H=this.generateSnippet(e,i,U,j,C,Z,ie,z,re);se!==null&&(H=mAe(rx(se,"float"),rx(H,l)).build(e,l)),e.addLineFlowCode(`${c} = ${H}`,this),o.snippet=H,o.propertyName=c}let h=c;return e.needsToWorkingColorSpace(n)&&(h=SAe(rx(h,l),n.colorSpace).setup(e).build(e,l)),e.format(h,l,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}sample(e){const t=this.clone();return t.uvNode=Nr(e),t.referenceNode=this.getBase(),Nr(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=Nr(e).mul(kct(t)),t.referenceNode=this.getBase();const n=t.value;return t.generateMipmaps===!1&&(n&&n.generateMipmaps===!1||n.minFilter===_5||n.magFilter===_5)&&(bi("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),Nr(t)}level(e){const t=this.clone();return t.levelNode=Nr(e),t.referenceNode=this.getBase(),Nr(t)}size(e){return nA(this,e)}bias(e){const t=this.clone();return t.biasNode=Nr(e),t.referenceNode=this.getBase(),Nr(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=Nr(e),t.referenceNode=this.getBase(),Nr(t)}grad(e,t){const n=this.clone();return n.gradNode=[Nr(e),Nr(t)],n.referenceNode=this.getBase(),Nr(n)}depth(e){const t=this.clone();return t.depthNode=Nr(e),t.referenceNode=this.getBase(),Nr(t)}offset(e){const t=this.clone();return t.offsetNode=Nr(e),t.referenceNode=this.getBase(),Nr(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();const n=this._flipYUniform;n!==null&&(n.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}const Bct=so(HB).setParameterLength(1,4).setName("texture"),SJ=(s=PAe,e=null,t=null,n=null)=>{let r;return s&&s.isTextureNode===!0?(r=Nr(s.clone()),r.referenceNode=s.getBase(),e!==null&&(r.uvNode=Nr(e)),t!==null&&(r.levelNode=Nr(t)),n!==null&&(r.biasNode=Nr(n))):r=Bct(s,e,t,n),r},em=(...s)=>SJ(...s).setSampler(!1);class wJ extends hN{static get type(){return"BufferNode"}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n,this.updateRanges=[]}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const RAe=(s,e,t)=>new wJ(s,e,t);class Uct extends Iw{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,n)}}class zct extends wJ{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?BF(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Qs.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let r=0;r<e.length;r++){const i=r*4;t[i]=e[r]}else if(n==="color")for(let r=0;r<e.length;r++){const i=r*4,o=e[r];t[i]=o.r,t[i+1]=o.g,t[i+2]=o.b||0}else if(n==="mat2")for(let r=0;r<e.length;r++){const i=r*4,o=e[r];t[i]=o.elements[0],t[i+1]=o.elements[1],t[i+2]=o.elements[2],t[i+3]=o.elements[3]}else if(n==="mat3")for(let r=0;r<e.length;r++){const i=r*16,o=e[r];t[i]=o.elements[0],t[i+1]=o.elements[1],t[i+2]=o.elements[2],t[i+4]=o.elements[3],t[i+5]=o.elements[4],t[i+6]=o.elements[5],t[i+8]=o.elements[6],t[i+9]=o.elements[7],t[i+10]=o.elements[8],t[i+15]=1}else if(n==="mat4")for(let r=0;r<e.length;r++){const i=r*16,o=e[r];for(let l=0;l<o.elements.length;l++)t[i+l]=o.elements[l]}else for(let r=0;r<e.length;r++){const i=r*4,o=e[r];t[i]=o.x,t[i+1]=o.y,t[i+2]=o.z||0,t[i+3]=o.w||0}}setup(e){const t=this.array.length,n=this.elementType;let r=Float32Array;const i=this.paddedType,o=e.getTypeLength(i);return n.charAt(0)==="i"&&(r=Int32Array),n.charAt(0)==="u"&&(r=Uint32Array),this.value=new r(t*o),this.bufferCount=t,this.bufferType=i,this.update(),super.setup(e)}element(e){return new Uct(this,Nr(e))}}const B3=(s,e)=>new zct(s,e);class Vct extends Lr{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const $B=so(Vct).setParameterLength(1);let pC,fC;class No extends Lr{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===No.DPR?"float":this.scope===No.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Qs.NONE;return(this.scope===No.SIZE||this.scope===No.VIEWPORT||this.scope===No.DPR)&&(e=Qs.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===No.VIEWPORT?t!==null?fC.copy(t.viewport):(e.getViewport(fC),fC.multiplyScalar(e.getPixelRatio())):this.scope===No.DPR?this._output.value=e.getPixelRatio():t!==null?(pC.width=t.width,pC.height=t.height):e.getDrawingBufferSize(pC)}setup(){const e=this.scope;let t=null;return e===No.SIZE?t=sl(pC||(pC=new il)):e===No.VIEWPORT?t=sl(fC||(fC=new Eu)):e===No.DPR?t=sl(1):t=vm(IAe.div(Fbe)),this._output=t,t}generate(e){if(this.scope===No.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(Fbe).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}}No.COORDINATE="coordinate";No.VIEWPORT="viewport";No.SIZE="size";No.UV="uv";No.DPR="dpr";const TJ=Ma(No,No.UV),Fbe=Ma(No,No.SIZE),IAe=Ma(No,No.COORDINATE),kAe=Ma(No,No.VIEWPORT);kAe.zw;kAe.xy;let zX=null,gL=null,VX=null,yL=null,GX=null,vL=null;const EJ=sl(0,"uint").setName("u_cameraIndex").setGroup(rAe("cameraIndex")).toVarying("v_cameraIndex"),z6=sl("float").setName("cameraNear").setGroup(pd).onRenderUpdate(({camera:s})=>s.near),V6=sl("float").setName("cameraFar").setGroup(pd).onRenderUpdate(({camera:s})=>s.far),Gct=Tr(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const n of s.cameras)t.push(n.projectionMatrix);gL===null?gL=B3(t).setGroup(pd).setName("cameraProjectionMatrices"):gL.array=t,e=gL.element(s.isMultiViewCamera?$B("gl_ViewID_OVR"):EJ).toConst("cameraProjectionMatrix")}else zX===null&&(zX=sl(s.projectionMatrix).setName("cameraProjectionMatrix").setGroup(pd).onRenderUpdate(({camera:t})=>t.projectionMatrix)),e=zX;return e}).once()(),jct=Tr(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const n of s.cameras)t.push(n.projectionMatrixInverse);yL===null?yL=B3(t).setGroup(pd).setName("cameraProjectionMatricesInverse"):yL.array=t,e=yL.element(s.isMultiViewCamera?$B("gl_ViewID_OVR"):EJ).toConst("cameraProjectionMatrixInverse")}else VX===null&&(VX=sl(s.projectionMatrixInverse).setName("cameraProjectionMatrixInverse").setGroup(pd).onRenderUpdate(({camera:t})=>t.projectionMatrixInverse)),e=VX;return e}).once()(),mN=Tr(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const n of s.cameras)t.push(n.matrixWorldInverse);vL===null?vL=B3(t).setGroup(pd).setName("cameraViewMatrices"):vL.array=t,e=vL.element(s.isMultiViewCamera?$B("gl_ViewID_OVR"):EJ).toConst("cameraViewMatrix")}else GX===null&&(GX=sl(s.matrixWorldInverse).setName("cameraViewMatrix").setGroup(pd).onRenderUpdate(({camera:t})=>t.matrixWorldInverse)),e=GX;return e}).once()();class gN{constructor(e=new Yt(1/0,1/0,1/0),t=new Yt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Kf.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Kf.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Kf.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const i=n.getAttribute("position");if(t===!0&&i!==void 0&&e.isInstancedMesh!==!0)for(let o=0,l=i.count;o<l;o++)e.isMesh===!0?e.getVertexPosition(o,Kf):Kf.fromBufferAttribute(i,o),Kf.applyMatrix4(e.matrixWorld),this.expandByPoint(Kf);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),xL.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),xL.copy(n.boundingBox)),xL.applyMatrix4(e.matrixWorld),this.union(xL)}const r=e.children;for(let i=0,o=r.length;i<o;i++)this.expandByObject(r[i],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Kf),Kf.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(mC),bL.subVectors(this.max,mC),G_.subVectors(e.a,mC),j_.subVectors(e.b,mC),H_.subVectors(e.c,mC),Oy.subVectors(j_,G_),Ly.subVectors(H_,j_),C6.subVectors(G_,H_);let t=[0,-Oy.z,Oy.y,0,-Ly.z,Ly.y,0,-C6.z,C6.y,Oy.z,0,-Oy.x,Ly.z,0,-Ly.x,C6.z,0,-C6.x,-Oy.y,Oy.x,0,-Ly.y,Ly.x,0,-C6.y,C6.x,0];return!jX(t,G_,j_,H_,bL)||(t=[1,0,0,0,1,0,0,0,1],!jX(t,G_,j_,H_,bL))?!1:(_L.crossVectors(Oy,Ly),t=[_L.x,_L.y,_L.z],jX(t,G_,j_,H_,bL))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Kf).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Kf).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(A3[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),A3[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),A3[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),A3[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),A3[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),A3[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),A3[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),A3[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(A3),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const A3=[new Yt,new Yt,new Yt,new Yt,new Yt,new Yt,new Yt,new Yt],Kf=new Yt,xL=new gN,G_=new Yt,j_=new Yt,H_=new Yt,Oy=new Yt,Ly=new Yt,C6=new Yt,mC=new Yt,bL=new Yt,_L=new Yt,A6=new Yt;function jX(s,e,t,n,r){for(let i=0,o=s.length-3;i<=o;i+=3){A6.fromArray(s,i);const l=r.x*Math.abs(A6.x)+r.y*Math.abs(A6.y)+r.z*Math.abs(A6.z),c=e.dot(A6),h=t.dot(A6),m=n.dot(A6);if(Math.max(-Math.max(c,h,m),Math.min(c,h,m))>l)return!1}return!0}const Hct=new gN,gC=new Yt,HX=new Yt;class MJ{constructor(e=new Yt,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):Hct.setFromPoints(e).getCenter(n);let r=0;for(let i=0,o=e.length;i<o;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;gC.subVectors(e,this.center);const t=gC.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.addScaledVector(gC,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(HX.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(gC.copy(e.center).add(HX)),this.expandByPoint(gC.copy(e.center).sub(HX))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const Bbe=new MJ;class mo extends Lr{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Qs.OBJECT,this.uniformNode=new hN(null)}getNodeType(){const e=this.scope;if(e===mo.WORLD_MATRIX)return"mat4";if(e===mo.POSITION||e===mo.VIEW_POSITION||e===mo.DIRECTION||e===mo.SCALE)return"vec3";if(e===mo.RADIUS)return"float"}update(e){const t=this.object3d,n=this.uniformNode,r=this.scope;if(r===mo.WORLD_MATRIX)n.value=t.matrixWorld;else if(r===mo.POSITION)n.value=n.value||new Yt,n.value.setFromMatrixPosition(t.matrixWorld);else if(r===mo.SCALE)n.value=n.value||new Yt,n.value.setFromMatrixScale(t.matrixWorld);else if(r===mo.DIRECTION)n.value=n.value||new Yt,t.getWorldDirection(n.value);else if(r===mo.VIEW_POSITION){const i=e.camera;n.value=n.value||new Yt,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(i.matrixWorldInverse)}else if(r===mo.RADIUS){const i=e.object.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),Bbe.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),n.value=Bbe.radius}}generate(e){const t=this.scope;return t===mo.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===mo.POSITION||t===mo.VIEW_POSITION||t===mo.DIRECTION||t===mo.SCALE?this.uniformNode.nodeType="vec3":t===mo.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}mo.WORLD_MATRIX="worldMatrix";mo.POSITION="position";mo.SCALE="scale";mo.VIEW_POSITION="viewPosition";mo.DIRECTION="direction";mo.RADIUS="radius";class Ube extends mo{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const WB=Ma(Ube,Ube.WORLD_MATRIX),$ct=sl(new Bp).onObjectUpdate(({object:s},e)=>e.value.getNormalMatrix(s.matrixWorld)),DAe=Tr(s=>s.context.modelViewMatrix||Wct).once()().toVar("modelViewMatrix"),Wct=mN.mul(WB),qct=Tr(s=>s.shaderStage!=="fragment"?(DA("TSL: `clipSpace` is only available in fragment stage."),Tl()):s.context.clipSpace.toVarying("v_clipSpace")).once()(),OAe=pw("position","vec3"),bu=OAe.toVarying("positionLocal"),zF=OAe.toVarying("positionPrevious"),Xct=Tr(s=>WB.mul(bu).xyz.toVarying(s.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),LAe=Tr(()=>bu.transformDirection(WB).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),s0=Tr(s=>{if(s.shaderStage==="fragment"&&s.material.vertexNode){const e=jct.mul(qct);return e.xyz.div(e.w).toVar("positionView")}return s.context.setupPositionView().toVarying("v_positionView")},"vec3").once(["POSITION","VERTEX"])(),FAe=Tr(s=>{let e;return s.camera.isOrthographicCamera?e=ai(0,0,1):e=s0.negate().toVarying("v_positionViewDirection").normalize(),e.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class Yct extends Lr{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===BB?"false":e.getFrontFacing()}}const Kct=Ma(Yct),BAe=xs(Kct).mul(2).sub(1),yN=Tr(([s],{material:e})=>{const t=e.side;return t===BB?s=s.mul(-1):t===Sot&&(s=s.mul(BAe)),s}),Zct=pw("normal","vec3"),Ag=Tr(s=>s.geometry.hasAttribute("normal")===!1?(bi('TSL: Vertex attribute "normal" not found on geometry.'),ai(0,1,0)):Zct,"vec3").once()().toVar("normalLocal"),Qct=s0.dFdx().cross(s0.dFdy()).normalize().toVar("normalFlat"),UAe=Tr(s=>{let e;return s.isFlatShading()?e=Qct:e=zAe(Ag).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),Dp=Tr(s=>{let e;return s.subBuildFn==="NORMAL"||s.subBuildFn==="VERTEX"?(e=UAe,s.isFlatShading()!==!0&&(e=yN(e))):e=s.context.setupNormal().context({getUV:null,getTextureLevel:null}),e},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),Jct=Dp.transformDirection(mN).toVar("normalWorld"),eut=Tr(({subBuildFn:s,context:e})=>{let t;return s==="NORMAL"||s==="VERTEX"?t=Dp:t=e.setupClearcoatNormal().context({getUV:null,getTextureLevel:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),tut=Tr(([s,e=WB])=>{const t=N5(e),n=s.div(ai(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(n).xyz}),zAe=Tr(([s],e)=>{const t=e.context.modelNormalViewMatrix;if(t)return t.transformDirection(s);const n=$ct.mul(s);return mN.transformDirection(n)});Tr(()=>(bi('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),Dp)).once(["NORMAL","VERTEX"])();Tr(()=>(bi('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),Jct)).once(["NORMAL","VERTEX"])();Tr(()=>(bi('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),eut)).once(["NORMAL","VERTEX"])();const zbe=new a0,Vbe=new Rw;class S5{constructor(e=0,t=0,n=0,r=S5.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,i=r[0],o=r[4],l=r[8],c=r[1],h=r[5],m=r[9],y=r[2],b=r[6],w=r[10];switch(t){case"XYZ":this._y=Math.asin(Xi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-m,w),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(b,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Xi(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(l,w),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-y,i),this._z=0);break;case"ZXY":this._x=Math.asin(Xi(b,-1,1)),Math.abs(b)<.9999999?(this._y=Math.atan2(-y,w),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(c,i));break;case"ZYX":this._y=Math.asin(-Xi(y,-1,1)),Math.abs(y)<.9999999?(this._x=Math.atan2(b,w),this._z=Math.atan2(c,i)):(this._x=0,this._z=Math.atan2(-o,h));break;case"YZX":this._z=Math.asin(Xi(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-m,h),this._y=Math.atan2(-y,i)):(this._x=0,this._y=Math.atan2(l,w));break;case"XZY":this._z=Math.asin(-Xi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(b,h),this._y=Math.atan2(l,i)):(this._x=Math.atan2(-m,w),this._y=0);break;default:bi("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return zbe.makeRotationFromQuaternion(e),this.setFromRotationMatrix(zbe,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Vbe.setFromEuler(this),this.setFromQuaternion(Vbe,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}S5.DEFAULT_ORDER="XYZ";const Gbe=new S5,$X=new a0,nut=sl(0).onReference(({material:s})=>s).onObjectUpdate(({material:s})=>s.refractionRatio),rut=sl(new a0).onReference(function(s){return s.material}).onObjectUpdate(function({material:s,scene:e}){const t=e.environment!==null&&s.envMap===null?e.environmentRotation:s.envMapRotation;return t?(Gbe.copy(t),$X.makeRotationFromEuler(Gbe)):$X.identity(),$X}),iut=FAe.negate().reflect(Dp),sut=FAe.negate().refract(Dp,nut),out=iut.transformDirection(mN).toVar("reflectVector"),aut=sut.transformDirection(mN).toVar("reflectVector");class CJ extends yh{constructor(e=[],t=QQ,n,r,i,o,l,c,h,m){super(e,t,n,r,i,o,l,c,h,m),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}const lut=new CJ;class cut extends HB{static get type(){return"CubeTextureNode"}constructor(e,t=null,n=null,r=null){super(e,t,n,r),this.isCubeTextureNode=!0}getInputType(){return this.value.isDepthTexture===!0?"cubeDepthTexture":"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===QQ?out:e.mapping===ACe?aut:(Js('CubeTextureNode: Mapping "%s" not supported.',e.mapping),ai(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return n.isDepthTexture===!0?e.renderer.coordinateSystem===lw?ai(t.x,t.y.negate(),t.z):t:((e.renderer.coordinateSystem===lw||!n.isRenderTargetTexture)&&(t=ai(t.x.negate(),t.yz)),rut.mul(t))}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}}const uut=so(cut).setParameterLength(1,4).setName("cubeTexture"),VAe=(s=lut,e=null,t=null,n=null)=>{let r;return s&&s.isCubeTextureNode===!0?(r=Nr(s.clone()),r.referenceNode=s,e!==null&&(r.uvNode=Nr(e)),t!==null&&(r.levelNode=Nr(t)),n!==null&&(r.biasNode=Nr(n))):r=uut(s,e,t,n),r};class dut extends Iw{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}}class AJ extends Lr{static get type(){return"ReferenceNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=Qs.OBJECT}element(e){return new dut(this,Nr(e))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return bi('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=RAe(null,e,this.count):Array.isArray(this.getValueFromReference())?t=B3(null,e):e==="texture"?t=SJ(null):e==="cubeTexture"?t=VAe(null):t=sl(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const FA=(s,e,t)=>new AJ(s,e,t),jbe=(s,e,t,n)=>new AJ(s,e,n,t);class hut extends AJ{static get type(){return"MaterialReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const sS=(s,e,t=null)=>new hut(s,e,t),GAe=fN(),put=s0.dFdx(),fut=s0.dFdy(),jAe=GAe.dFdx(),HAe=GAe.dFdy(),$Ae=Dp,WAe=fut.cross($Ae),qAe=$Ae.cross(put),MK=WAe.mul(jAe.x).add(qAe.mul(HAe.x)),CK=WAe.mul(jAe.y).add(qAe.mul(HAe.y)),Hbe=MK.dot(MK).max(CK.dot(CK)),XAe=Hbe.equal(0).select(0,Hbe.inverseSqrt()),mut=MK.mul(XAe).toVar("tangentViewFrame"),gut=CK.mul(XAe).toVar("bitangentViewFrame"),YAe=pw("tangent","vec4"),VF=YAe.xyz.toVar("tangentLocal"),KAe=Tr(s=>{let e;return s.subBuildFn==="VERTEX"||s.geometry.hasAttribute("tangent")?e=DAe.mul(Tl(VF,0)).xyz.toVarying("v_tangentView").normalize():e=mut,s.isFlatShading()!==!0&&(e=yN(e)),e},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),yut=Tr(([s,e],t)=>{let n=s.mul(YAe.w).xyz;return t.subBuildFn==="NORMAL"&&t.isFlatShading()!==!0&&(n=n.toVarying(e)),n}).once(["NORMAL"]),vut=Tr(s=>{let e;return s.subBuildFn==="VERTEX"||s.geometry.hasAttribute("tangent")?e=yut(Dp.cross(KAe),"v_bitangentView").normalize():e=gut,s.isFlatShading()!==!0&&(e=yN(e)),e},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),xut=N5(KAe,vut,Dp).toVar("TBNViewMatrix"),$be=s=>ai(s,fJ(vAe(xs(1).sub(pN(s,s)))));class but extends c0{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=SX,this.unpackNormalMode=wX}setup(e){const{normalMapType:t,scaleNode:n,unpackNormalMode:r}=this;let i=this.node.mul(2).sub(1);if(t===SX?r===kCe?i=$be(i.xy):r===Oot?i=$be(i.yw):r!==wX&&console.error(`THREE.NodeMaterial: Unexpected unpack normal mode: ${r}`):r!==wX&&console.error(`THREE.NodeMaterial: Normal map type '${t}' is not compatible with unpack normal mode '${r}'`),n!==null){let l=n;e.isFlatShading()===!0&&(l=yN(l)),i=ai(i.xy.mul(l),i.z)}let o=null;return t===Dot?o=zAe(i):t===SX?o=xut.mul(i).normalize():(Js(`NodeMaterial: Unsupported normal map type: ${t}`),o=Dp),o}}const Wbe=so(but).setParameterLength(1,2),_ut=Tr(({textureNode:s,bumpScale:e})=>{const t=r=>s.isolate().context({getUV:i=>r(i.uvNode||fN()),forceUVContext:!0}),n=xs(t(r=>r));return vm(xs(t(r=>r.add(r.dFdx()))).sub(n),xs(t(r=>r.add(r.dFdy()))).sub(n)).mul(e)}),Sut=Tr(s=>{const{surf_pos:e,surf_norm:t,dHdxy:n}=s,r=e.dFdx().normalize(),i=e.dFdy().normalize(),o=t,l=i.cross(o),c=o.cross(r),h=r.dot(l).mul(BAe),m=h.sign().mul(n.x.mul(l).add(n.y.mul(c)));return h.abs().mul(t).sub(m).normalize()});class wut extends c0{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=_ut({textureNode:this.textureNode,bumpScale:e});return Sut({surf_pos:s0,surf_norm:Dp,dHdxy:t})}}const Tut=so(wut).setParameterLength(1,2),qbe=new Map;class zn extends Lr{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=qbe.get(e);return n===void 0&&(n=sS(e,t),qbe.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let r=null;if(n===zn.COLOR){const i=t.color!==void 0?this.getColor(n):ai();t.map&&t.map.isTexture===!0?r=i.mul(this.getTexture("map")):r=i}else if(n===zn.OPACITY){const i=this.getFloat(n);t.alphaMap&&t.alphaMap.isTexture===!0?r=i.mul(this.getTexture("alpha")):r=i}else if(n===zn.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?r=this.getTexture("specular").r:r=xs(1);else if(n===zn.SPECULAR_INTENSITY){const i=this.getFloat(n);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?r=i.mul(this.getTexture(n).a):r=i}else if(n===zn.SPECULAR_COLOR){const i=this.getColor(n);t.specularColorMap&&t.specularColorMap.isTexture===!0?r=i.mul(this.getTexture(n).rgb):r=i}else if(n===zn.ROUGHNESS){const i=this.getFloat(n);t.roughnessMap&&t.roughnessMap.isTexture===!0?r=i.mul(this.getTexture(n).g):r=i}else if(n===zn.METALNESS){const i=this.getFloat(n);t.metalnessMap&&t.metalnessMap.isTexture===!0?r=i.mul(this.getTexture(n).b):r=i}else if(n===zn.EMISSIVE){const i=this.getFloat("emissiveIntensity"),o=this.getColor(n).mul(i);t.emissiveMap&&t.emissiveMap.isTexture===!0?r=o.mul(this.getTexture(n)):r=o}else if(n===zn.NORMAL)t.normalMap?(r=Wbe(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType,(t.normalMap.format==Rot||t.normalMap.format==kot||t.normalMap.format==Iot)&&(r.unpackNormalMode=kCe)):t.bumpMap?r=Tut(this.getTexture("bump").r,this.getFloat("bumpScale")):r=Dp;else if(n===zn.CLEARCOAT){const i=this.getFloat(n);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?r=i.mul(this.getTexture(n).r):r=i}else if(n===zn.CLEARCOAT_ROUGHNESS){const i=this.getFloat(n);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?r=i.mul(this.getTexture(n).r):r=i}else if(n===zn.CLEARCOAT_NORMAL)t.clearcoatNormalMap?r=Wbe(this.getTexture(n),this.getCache(n+"Scale","vec2")):r=Dp;else if(n===zn.SHEEN){const i=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?r=i.mul(this.getTexture("sheenColor").rgb):r=i}else if(n===zn.SHEEN_ROUGHNESS){const i=this.getFloat(n);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?r=i.mul(this.getTexture(n).a):r=i,r=r.clamp(1e-4,1)}else if(n===zn.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const i=this.getTexture(n);r=tAe(yC.x,yC.y,yC.y.negate(),yC.x).mul(i.rg.mul(2).sub(vm(1)).normalize().mul(i.b))}else r=yC;else if(n===zn.IRIDESCENCE_THICKNESS){const i=FA("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=FA("0","float",t.iridescenceThicknessRange);r=i.sub(o).mul(this.getTexture(n).g).add(o)}else r=i}else if(n===zn.TRANSMISSION){const i=this.getFloat(n);t.transmissionMap?r=i.mul(this.getTexture(n).r):r=i}else if(n===zn.THICKNESS){const i=this.getFloat(n);t.thicknessMap?r=i.mul(this.getTexture(n).g):r=i}else if(n===zn.IOR)r=this.getFloat(n);else if(n===zn.LIGHT_MAP)r=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===zn.AO)r=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(n===zn.LINE_DASH_OFFSET)r=t.dashOffset?this.getFloat(n):xs(0);else{const i=this.getNodeType(e);r=this.getCache(n,i)}return r}}zn.ALPHA_TEST="alphaTest";zn.COLOR="color";zn.OPACITY="opacity";zn.SHININESS="shininess";zn.SPECULAR="specular";zn.SPECULAR_STRENGTH="specularStrength";zn.SPECULAR_INTENSITY="specularIntensity";zn.SPECULAR_COLOR="specularColor";zn.REFLECTIVITY="reflectivity";zn.ROUGHNESS="roughness";zn.METALNESS="metalness";zn.NORMAL="normal";zn.CLEARCOAT="clearcoat";zn.CLEARCOAT_ROUGHNESS="clearcoatRoughness";zn.CLEARCOAT_NORMAL="clearcoatNormal";zn.EMISSIVE="emissive";zn.ROTATION="rotation";zn.SHEEN="sheen";zn.SHEEN_ROUGHNESS="sheenRoughness";zn.ANISOTROPY="anisotropy";zn.IRIDESCENCE="iridescence";zn.IRIDESCENCE_IOR="iridescenceIOR";zn.IRIDESCENCE_THICKNESS="iridescenceThickness";zn.IOR="ior";zn.TRANSMISSION="transmission";zn.THICKNESS="thickness";zn.ATTENUATION_DISTANCE="attenuationDistance";zn.ATTENUATION_COLOR="attenuationColor";zn.LINE_SCALE="scale";zn.LINE_DASH_SIZE="dashSize";zn.LINE_GAP_SIZE="gapSize";zn.LINE_WIDTH="linewidth";zn.LINE_DASH_OFFSET="dashOffset";zn.POINT_SIZE="size";zn.DISPERSION="dispersion";zn.LIGHT_MAP="light";zn.AO="ao";const Eut=Ma(zn,zn.ALPHA_TEST),Mut=Ma(zn,zn.COLOR),Cut=Ma(zn,zn.EMISSIVE),Aut=Ma(zn,zn.OPACITY),WX=Ma(zn,zn.SPECULAR_STRENGTH),qX=Ma(zn,zn.REFLECTIVITY),Nut=Ma(zn,zn.NORMAL),ZAe=Ma(zn,zn.LIGHT_MAP),Put=Ma(zn,zn.AO),yC=sl(new il).onReference(function(s){return s.material}).onRenderUpdate(function({material:s}){this.value.set(s.anisotropy*Math.cos(s.anisotropyRotation),s.anisotropy*Math.sin(s.anisotropyRotation))}),Rut=Tr(s=>s.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class Iut extends Iw{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const n=this.storageBufferNode.structTypeNode;return n?n.getMemberType(e,t):"void"}setup(e){return e.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let n;const r=e.context.assign;if(e.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&r!==!0&&(this.node.value.isInstancedBufferAttribute||e.shaderStage!=="compute")?n=e.generatePBO(this):n=this.node.build(e):n=super.generate(e),r!==!0){const i=this.getNodeType(e);n=e.format(n,i,t)}return n}}const kut=so(Iut).setParameterLength(2);class Dut extends wJ{static get type(){return"StorageBufferNode"}constructor(e,t=null,n=0){let r,i=null;t&&t.isStruct?(r="struct",i=t.layout,(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(n=e.count)):t===null&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(r=Qat(e.itemSize),n=e.count):r=t,super(e,r,n),this.isStorageBufferNode=!0,this.structTypeNode=i,this.access=Mbe.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return kut(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(Mbe.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=TAe(this.value),this._varying=Dw(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}getMemberType(e,t){return this.structTypeNode!==null?this.structTypeNode.getMemberType(e,t):"void"}generate(e){if(this.structTypeNode!==null&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:n}=this.getAttributeData(),r=n.build(e);return e.registerTransform(r,t),r}}const Xbe=(s,e=null,t=0)=>new Dut(s,e,t);class wl extends Lr{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let r;if(n===wl.VERTEX)r=e.getVertexIndex();else if(n===wl.INSTANCE)r=e.getInstanceIndex();else if(n===wl.DRAW)r=e.getDrawIndex();else if(n===wl.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(n===wl.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else if(n===wl.SUBGROUP)r=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let i;return e.shaderStage==="vertex"||e.shaderStage==="compute"?i=r:i=Dw(this).build(e,t),i}}wl.VERTEX="vertex";wl.INSTANCE="instance";wl.SUBGROUP="subgroup";wl.INVOCATION_LOCAL="invocationLocal";wl.INVOCATION_SUBGROUP="invocationSubgroup";wl.DRAW="draw";const Out=Ma(wl,wl.VERTEX),rA=Ma(wl,wl.INSTANCE),Lut=Ma(wl,wl.DRAW);class Fut extends wAe{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class But extends d5{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}class Uut extends Lr{static get type(){return"InstanceNode"}constructor(e,t,n=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Qs.FRAME,this.buffer=null,this.bufferColor=null,this.previousInstanceMatrixNode=null}get isStorageMatrix(){const{instanceMatrix:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}get isStorageColor(){const{instanceColor:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}setup(e){let{instanceMatrixNode:t,instanceColorNode:n}=this;t===null&&(t=this._createInstanceMatrixNode(!0,e),this.instanceMatrixNode=t);const{instanceColor:r,isStorageColor:i}=this;if(r&&n===null){if(i)n=Xbe(r,"vec3",Math.max(r.count,1)).element(rA);else{const l=new But(r.array,3),c=r.usage===vK?Lbe:Obe;this.bufferColor=l,n=ai(c(l,"vec3",3,0))}this.instanceColorNode=n}const o=t.mul(bu).xyz;if(bu.assign(o),e.needsPreviousData()&&zF.assign(this.getPreviousInstancedPosition(e)),e.hasGeometryAttribute("normal")){const l=tut(Ag,t);Ag.assign(l)}this.instanceColorNode!==null&&UF("vec3","vInstanceColor").assign(this.instanceColorNode)}update(e){this.buffer!==null&&this.isStorageMatrix!==!0&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&this.isStorageColor!==!0&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)),this.previousInstanceMatrixNode!==null&&e.object.previousInstanceMatrix.array.set(this.instanceMatrix.array)}getPreviousInstancedPosition(e){const t=e.object;return this.previousInstanceMatrixNode===null&&(t.previousInstanceMatrix=this.instanceMatrix.clone(),this.previousInstanceMatrixNode=this._createInstanceMatrixNode(!1,e)),this.previousInstanceMatrixNode.mul(zF).xyz}_createInstanceMatrixNode(e,t){let n;const{instanceMatrix:r}=this,{count:i}=r;if(this.isStorageMatrix)n=Xbe(r,"mat4",Math.max(i,1)).element(rA);else if(i*16*4<=t.getUniformBufferLimit())n=RAe(r.array,"mat4",Math.max(i,1)).element(rA);else{const l=new Fut(r.array,16,1);e===!0&&(this.buffer=l);const c=r.usage===vK?Lbe:Obe,h=[c(l,"vec4",16,0),c(l,"vec4",16,4),c(l,"vec4",16,8),c(l,"vec4",16,12)];n=GB(...h)}return n}}class zut extends Uut{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:r}=e;super(t,n,r),this.instancedMesh=e}}const Vut=so(zut).setParameterLength(1);class Gut extends Lr{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=rA:this.batchingIdNode=Lut);const n=Tr(([A])=>{const I=Sl(nA(em(this.batchMesh._indirectTexture),0).x).toConst(),D=Sl(A).mod(I).toConst(),P=Sl(A).div(I).toConst();return em(this.batchMesh._indirectTexture,pg(D,P)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(Sl(this.batchingIdNode)),r=this.batchMesh._matricesTexture,i=Sl(nA(em(r),0).x).toConst(),o=xs(n).mul(4).toInt().toConst(),l=o.mod(i).toConst(),c=o.div(i).toConst(),h=GB(em(r,pg(l,c)),em(r,pg(l.add(1),c)),em(r,pg(l.add(2),c)),em(r,pg(l.add(3),c))),m=this.batchMesh._colorsTexture;if(m!==null){const I=Tr(([D])=>{const P=Sl(nA(em(m),0).x).toConst(),U=D,j=U.mod(P).toConst(),C=U.div(P).toConst();return em(m,pg(j,C)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(n);UF("vec3","vBatchColor").assign(I)}const y=N5(h);bu.assign(h.mul(bu));const b=Ag.div(ai(y[0].dot(y[0]),y[1].dot(y[1]),y[2].dot(y[2]))),w=y.mul(b).xyz;Ag.assign(w),e.hasGeometryAttribute("tangent")&&VF.mulAssign(y)}}const jut=so(Gut).setParameterLength(1),Ybe=new WeakMap;class Hut extends Lr{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Qs.OBJECT,this.skinIndexNode=pw("skinIndex","uvec4"),this.skinWeightNode=pw("skinWeight","vec4"),this.bindMatrixNode=FA("bindMatrix","mat4"),this.bindMatrixInverseNode=FA("bindMatrixInverse","mat4"),this.boneMatricesNode=jbe("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=bu,this.toPositionNode=bu,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:o}=this,l=e.element(n.x),c=e.element(n.y),h=e.element(n.z),m=e.element(n.w),y=i.mul(t),b=OA(l.mul(r.x).mul(y),c.mul(r.y).mul(y),h.mul(r.z).mul(y),m.mul(r.w).mul(y));return o.mul(b).xyz}getSkinnedNormalAndTangent(e=this.boneMatricesNode,t=Ag,n=VF){const{skinIndexNode:r,skinWeightNode:i,bindMatrixNode:o,bindMatrixInverseNode:l}=this,c=e.element(r.x),h=e.element(r.y),m=e.element(r.z),y=e.element(r.w);let b=OA(i.x.mul(c),i.y.mul(h),i.z.mul(m),i.w.mul(y));b=l.mul(b).mul(o);const w=b.transformDirection(t).xyz,A=b.transformDirection(n).xyz;return{skinNormal:w,skinTangent:A}}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=jbe("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,zF)}setup(e){e.needsPreviousData()&&zF.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const{skinNormal:n,skinTangent:r}=this.getSkinnedNormalAndTangent();Ag.assign(n),e.hasGeometryAttribute("tangent")&&VF.assign(r)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;Ybe.get(t)!==e.frameId&&(Ybe.set(t,e.frameId),this.previousBoneMatricesNode!==null&&(t.previousBoneMatrices===null&&(t.previousBoneMatrices=new Float32Array(t.boneMatrices)),t.previousBoneMatrices.set(t.boneMatrices)),t.update())}}const $ut=s=>new Hut(s);class Wut extends Lr{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const n={};for(let l=0,c=this.params.length-1;l<c;l++){const h=this.params[l],m=h.isNode!==!0&&h.name||this.getVarName(l),y=h.isNode!==!0&&h.type||"int";n[m]=rx(m,y)}const r=e.addStack(),i=this.params[this.params.length-1](n);t.returnsNode=i.context({nodeLoop:i}),t.stackNode=r;const o=this.params[0];if(o.isNode!==!0&&typeof o.update=="function"){const l=Tr(this.params[0].update)(n);t.updateNode=l.context({nodeLoop:l})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){const t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){const t=this.getProperties(e),n=this.params,r=t.stackNode;for(let o=0,l=n.length-1;o<l;o++){const c=n[o];let h=!1,m=null,y=null,b=null,w=null,A=null,I=null;c.isNode?c.getNodeType(e)==="bool"?(h=!0,w="bool",y=c.build(e,w)):(w="int",b=this.getVarName(o),m="0",y=c.build(e,w),A="<"):(w=c.type||"int",b=c.name||this.getVarName(o),m=c.start,y=c.end,A=c.condition,I=c.update,typeof m=="number"?m=e.generateConst(w,m):m&&m.isNode&&(m=m.build(e,w)),typeof y=="number"?y=e.generateConst(w,y):y&&y.isNode&&(y=y.build(e,w)),m!==void 0&&y===void 0?(m=m+" - 1",y="0",A=">="):y!==void 0&&m===void 0&&(m="0",A="<"),A===void 0&&(Number(m)>Number(y)?A=">=":A="<"));let D;if(h)D=`while ( ${y} )`;else{const P={start:m,end:y},U=P.start,j=P.end;let C;const Z=()=>A.includes("<")?"+=":"-=";if(I!=null)switch(typeof I){case"function":C=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":C=b+" "+Z()+" "+e.generateConst(w,I);break;case"string":C=b+" "+I;break;default:I.isNode?C=b+" "+Z()+" "+I.build(e):(Js("TSL: 'Loop( { update: ... } )' is not a function, string or number.",this.stackTrace),C="break /* invalid update */")}else w==="int"||w==="uint"?I=A.includes("<")?"++":"--":I=Z()+" 1.",C=b+" "+I;const ie=e.getVar(w,b)+" = "+U,se=b+" "+A+" "+j;D=`for ( ${ie}; ${se}; ${C} )`}e.addFlowCode((o===0?`
`:"")+e.tab+D+` {

`).addFlowTab()}const i=r.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode(`
`+e.tab+i);for(let o=0,l=this.params.length-1;o<l;o++)e.addFlowCode((o===0?"":e.tab)+`}

`).removeFlowTab();e.addFlowTab()}}const oS=(...s)=>new Wut(TS(s,"int")).toStack();class qut extends yh{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=_5,this.minFilter=_5,this.wrapR=IC,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}const XX=new WeakMap,uh=new Eu,Kbe=Tr(({bufferMap:s,influence:e,stride:t,width:n,depth:r,offset:i})=>{const o=Sl(Out).mul(t).add(i),l=o.div(n),c=o.sub(l.mul(n));return em(s,pg(c,l)).depth(r).xyz.mul(e)});function Xut(s){const e=s.morphAttributes.position!==void 0,t=s.morphAttributes.normal!==void 0,n=s.morphAttributes.color!==void 0,r=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,i=r!==void 0?r.length:0;let o=XX.get(s);if(o===void 0||o.count!==i){let U=function(){D.dispose(),XX.delete(s),s.removeEventListener("dispose",U)};var l=U;o!==void 0&&o.texture.dispose();const c=s.morphAttributes.position||[],h=s.morphAttributes.normal||[],m=s.morphAttributes.color||[];let y=0;e===!0&&(y=1),t===!0&&(y=2),n===!0&&(y=3);let b=s.attributes.position.count*y,w=1;const A=4096;b>A&&(w=Math.ceil(b/A),b=A);const I=new Float32Array(b*w*4*i),D=new qut(I,b,w,i);D.type=ICe,D.needsUpdate=!0;const P=y*4;for(let j=0;j<i;j++){const C=c[j],Z=h[j],ie=m[j],se=b*w*4*j;for(let z=0;z<C.count;z++){const re=z*P;e===!0&&(uh.fromBufferAttribute(C,z),I[se+re+0]=uh.x,I[se+re+1]=uh.y,I[se+re+2]=uh.z,I[se+re+3]=0),t===!0&&(uh.fromBufferAttribute(Z,z),I[se+re+4]=uh.x,I[se+re+5]=uh.y,I[se+re+6]=uh.z,I[se+re+7]=0),n===!0&&(uh.fromBufferAttribute(ie,z),I[se+re+8]=uh.x,I[se+re+9]=uh.y,I[se+re+10]=uh.z,I[se+re+11]=ie.itemSize===4?uh.w:1)}}o={count:i,texture:D,stride:y,size:new il(b,w)},XX.set(s,o),s.addEventListener("dispose",U)}return o}class Yut extends Lr{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=sl(1),this.updateType=Qs.OBJECT}setup(e){const{geometry:t}=e,n=t.morphAttributes.position!==void 0,r=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=i!==void 0?i.length:0,{texture:l,stride:c,size:h}=Xut(t);n===!0&&bu.mulAssign(this.morphBaseInfluence),r===!0&&Ag.mulAssign(this.morphBaseInfluence);const m=Sl(h.width);oS(o,({i:y})=>{const b=xs(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?b.assign(em(this.mesh.morphTexture,pg(Sl(y).add(1),Sl(rA))).r):b.assign(FA("morphTargetInfluences","float").element(y).toVar()),Hy(b.notEqual(0),()=>{n===!0&&bu.addAssign(Kbe({bufferMap:l,influence:b,stride:c,width:m,depth:y,offset:Sl(0)})),r===!0&&Ag.addAssign(Kbe({bufferMap:l,influence:b,stride:c,width:m,depth:y,offset:Sl(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,n)=>t+n,0)}}const Kut=so(Yut).setParameterLength(1);class qB extends Lr{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class Zut extends qB{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class Qut extends xAe{static get type(){return"LightingContextNode"}constructor(e,t=null,n=null,r=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n=ai().toVar("directDiffuse"),r=ai().toVar("directSpecular"),i=ai().toVar("indirectDiffuse"),o=ai().toVar("indirectSpecular"),l={directDiffuse:n,directSpecular:r,indirectDiffuse:i,indirectSpecular:o};return{radiance:ai().toVar("radiance"),irradiance:ai().toVar("irradiance"),iblIrradiance:ai().toVar("iblIrradiance"),ambientOcclusion:xs(1).toVar("ambientOcclusion"),reflectedLight:l,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const Jut=so(Qut);class edt extends qB{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}class tdt extends yh{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=_5,this.minFilter=_5,this.generateMipmaps=!1,this.needsUpdate=!0}}const $_=new il;class ndt extends HB{static get type(){return"ViewportTextureNode"}constructor(e=TJ,t=null,n=null){let r=null;n===null?(r=new tdt,r.minFilter=JQ,n=r):r=n,super(n,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=r,this.isOutputTextureNode=!0,this.updateBeforeType=Qs.RENDER,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,n;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,n=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,n=this._cacheTextures),e===null)return t;if(n.has(e)===!1){const r=t.clone();n.set(e,r)}return n.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,n=t.getRenderTarget();n===null?t.getDrawingBufferSize($_):$_.set(n.width,n.height);const r=this.getTextureForReference(n);(r.image.width!==$_.width||r.image.height!==$_.height)&&(r.image.width=$_.width,r.image.height=$_.height,r.needsUpdate=!0);const i=r.generateMipmaps;r.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(r),r.generateMipmaps=i}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}class NJ extends yh{constructor(e,t,n=RCe,r,i,o,l=_5,c=_5,h,m=X7e,y=1){if(m!==X7e&&m!==Pot)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const b={width:e,height:t,depth:y};super(b,r,i,o,l,c,m,n,h),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new _J(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}let SL=null;class rdt extends ndt{static get type(){return"ViewportDepthTextureNode"}constructor(e=TJ,t=null){SL===null&&(SL=new NJ),super(e,t,SL)}getTextureForReference(){return SL}}const idt=so(rdt).setParameterLength(0,2);class gd extends Lr{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===gd.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,n=this.valueNode;let r=null;if(t===gd.DEPTH_BASE)n!==null&&(r=JAe().assign(n));else if(t===gd.DEPTH)e.isPerspectiveCamera?r=sdt(s0.z,z6,V6):r=iA(s0.z,z6,V6);else if(t===gd.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const i=QAe(n,z6,V6);r=iA(i,z6,V6)}else r=n;else r=iA(s0.z,z6,V6);return r}}gd.DEPTH_BASE="depthBase";gd.DEPTH="depth";gd.LINEAR_DEPTH="linearDepth";const iA=(s,e,t)=>s.add(e).div(e.sub(t)),sdt=(s,e,t)=>e.add(s).mul(t).div(t.sub(e).mul(s)),QAe=Tr(([s,e,t],n)=>n.renderer.reversedDepthBuffer===!0?e.mul(t).div(e.sub(t).mul(s).sub(e)):e.mul(t).div(t.sub(e).mul(s).sub(t))),odt=(s,e,t)=>{e=e.max(1e-6).toVar();const n=ES(s.negate().div(e)),r=ES(t.div(e));return n.div(r)},JAe=so(gd,gd.DEPTH_BASE),eNe=Ma(gd,gd.DEPTH),tNe=so(gd,gd.LINEAR_DEPTH).setParameterLength(0,1);idt();eNe.assign=s=>JAe(s);class Mp extends Lr{static get type(){return"ClippingNode"}constructor(e=Mp.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===Mp.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,r):this.scope===Mp.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(n,r)}setupAlphaToCoverage(e,t){return Tr(()=>{const n=xs().toVar("distanceToPlane"),r=xs().toVar("distanceToGradient"),i=xs(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const c=B3(t).setGroup(pd);oS(o,({i:h})=>{const m=c.element(h);n.assign(s0.dot(m.xyz).negate().add(m.w)),r.assign(n.fwidth().div(2)),i.mulAssign(hw(r.negate(),r,n))})}const l=e.length;if(l>0){const c=B3(e).setGroup(pd),h=xs(1).toVar("intersectionClipOpacity");oS(l,({i:m})=>{const y=c.element(m);n.assign(s0.dot(y.xyz).negate().add(y.w)),r.assign(n.fwidth().div(2)),h.mulAssign(hw(r.negate(),r,n).oneMinus())}),i.mulAssign(h.oneMinus())}bc.a.mulAssign(i),bc.a.equal(0).discard()})()}setupDefault(e,t){return Tr(()=>{const n=t.length;if(this.hardwareClipping===!1&&n>0){const i=B3(t).setGroup(pd);oS(n,({i:o})=>{const l=i.element(o);s0.dot(l.xyz).greaterThan(l.w).discard()})}const r=e.length;if(r>0){const i=B3(e).setGroup(pd),o=hJ(!0).toVar("clipped");oS(r,({i:l})=>{const c=i.element(l);o.assign(s0.dot(c.xyz).greaterThan(c.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),Tr(()=>{const r=B3(e).setGroup(pd),i=$B(t.getClipDistance());oS(n,({i:o})=>{const l=r.element(o),c=s0.dot(l.xyz).sub(l.w).negate();i.element(o).assign(c)})})()}}Mp.ALPHA_TO_COVERAGE="alphaToCoverage";Mp.DEFAULT="default";Mp.HARDWARE="hardware";const adt=()=>new Mp,ldt=()=>new Mp(Mp.ALPHA_TO_COVERAGE),cdt=()=>new Mp(Mp.HARDWARE),udt=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],YX=new WeakMap;class ddt{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=udt,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:n,material:r,object:i}=e;if(t={material:this.getMaterialData(r),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexId:n.index?n.index.id:null,indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:i.matrixWorld.clone()},i.center&&(t.center=i.center.clone()),i.morphTargetInfluences&&(t.morphTargetInfluences=i.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:l}=e.context;t.bufferWidth=o,t.bufferHeight=l}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const r=e[n];t[n]={id:r.id,version:r.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return!!(e.context.modelViewMatrix||e.context.modelNormalViewMatrix||e.context.getAO||e.context.getShadow)}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const r=e[n];r!=null&&(typeof r=="object"&&r.clone!==void 0?r.isTexture===!0?t[n]={id:r.id,version:r.version}:t[n]=r.clone():t[n]=r)}return t}equals(e,t){const{object:n,material:r,geometry:i}=e,o=this.getRenderObjectData(e);if(o.worldMatrix.equals(n.matrixWorld)!==!0)return o.worldMatrix.copy(n.matrixWorld),!1;const l=o.material;for(const U in l){const j=l[U],C=r[U];if(j.equals!==void 0){if(j.equals(C)===!1)return j.copy(C),!1}else if(C.isTexture===!0){if(j.id!==C.id||j.version!==C.version)return j.id=C.id,j.version=C.version,!1}else if(j!==C)return l[U]=C,!1}if(l.transmission>0){const{width:U,height:j}=e.context;if(o.bufferWidth!==U||o.bufferHeight!==j)return o.bufferWidth=U,o.bufferHeight=j,!1}const c=o.geometry,h=i.attributes,m=c.attributes,y=Object.keys(m),b=Object.keys(h);if(c.id!==i.id)return c.id=i.id,!1;if(y.length!==b.length)return o.geometry.attributes=this.getAttributesData(h),!1;for(const U of y){const j=m[U],C=h[U];if(C===void 0)return delete m[U],!1;if(j.id!==C.id||j.version!==C.version)return j.id=C.id,j.version=C.version,!1}const w=i.index,A=c.indexId,I=c.indexVersion,D=w?w.id:null,P=w?w.version:null;if(A!==D||I!==P)return c.indexId=D,c.indexVersion=P,!1;if(c.drawRange.start!==i.drawRange.start||c.drawRange.count!==i.drawRange.count)return c.drawRange.start=i.drawRange.start,c.drawRange.count=i.drawRange.count,!1;if(o.morphTargetInfluences){let U=!1;for(let j=0;j<o.morphTargetInfluences.length;j++)o.morphTargetInfluences[j]!==n.morphTargetInfluences[j]&&(o.morphTargetInfluences[j]=n.morphTargetInfluences[j],U=!0);if(U)return!1}if(o.lights){for(let U=0;U<t.length;U++)if(o.lights[U].map!==t[U].map)return!1}return o.center&&o.center.equals(n.center)===!1?(o.center.copy(n.center),!0):(e.bundle!==null&&(o.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const n of e)n.isSpotLight===!0&&n.map!==null&&t.push({map:n.map.version});return t}getLights(e,t){if(YX.has(e)){const r=YX.get(e);if(r.renderId===t)return r.lightsData}const n=this.getLightsData(e.getLights());return YX.set(e,{renderId:t,lightsData:n}),n}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const r=e.object.static===!0,i=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(r||i)return!1;const o=this.getLights(e.lightsNode,n);return this.equals(e,o)!==!0}}const hdt=.05,Zbe=Tr(([s])=>uw(xu(1e4,LA(xu(17,s.x).add(xu(.1,s.y)))).mul(OA(.1,jB(LA(xu(13,s.y).add(s.x))))))),Qbe=Tr(([s])=>Zbe(vm(Zbe(s.xy),s.z))),pdt=Tr(([s])=>{const e=fAe(EK(uAe(s.xyz)),EK(dAe(s.xyz))),t=xs(1).div(xs(hdt).mul(e)).toVar("pixScale"),n=vm(TK(rF(ES(t))),TK(sAe(ES(t)))),r=vm(Qbe(rF(n.x.mul(s.xyz))),Qbe(rF(n.y.mul(s.xyz)))),i=uw(ES(t)),o=OA(xu(i.oneMinus(),r.x),xu(i,r.y)),l=pAe(i,i.oneMinus()),c=ai(o.mul(o).div(xu(2,l).mul(O3(1,l))),o.sub(xu(.5,l)).div(O3(1,l)),O3(1,O3(1,o).mul(O3(1,o)).div(xu(2,l).mul(O3(1,l))))),h=o.lessThan(l.oneMinus()).select(o.lessThan(l).select(c.x,c.y),c.z);return mJ(h,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class fdt extends NAe{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),n=e.hasGeometryAttribute(t);let r;return n===!0?r=super.generate(e):r=e.generateConst(this.nodeType,new Eu(1,1,1,1)),r}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const mdt=(s=0)=>new fdt(s),gdt=Tr(([s])=>Tl(s.rgb.mul(s.a),s.a),{color:"vec4",return:"vec4"});class nNe extends _K{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.maskShadowNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,this.contextNode=null}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(t.startsWith("_")===!0)continue;const n=this[t];n&&n.isNode===!0&&e.push({property:t,childNode:n})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:n}of this._getNodeChildren())e.push(sJ(t.slice(0,-4)),n.getCacheKey());return this.type+HCe(e)}build(e){this.setup(e)}setupObserver(e){return new ddt(e)}setup(e){e.context.setupNormal=()=>tA(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();t.contextNode.isContextNode===!0?e.context={...e.context,...t.contextNode.getFlowContextData()}:Js('NodeMaterial: "renderer.contextNode" must be an instance of `context()`.'),this.contextNode!==null&&(this.contextNode.isContextNode===!0?e.context={...e.context,...this.contextNode.getFlowContextData()}:Js('NodeMaterial: "material.contextNode" must be an instance of `context()`.')),e.addStack();const r=this.setupVertex(e),i=tA(this.vertexNode||r,"VERTEX");e.context.clipSpace=i,e.stack.outputNode=i,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let o;const l=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(n!==null?n.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const c=this.setupLighting(e);l!==null&&e.stack.addToStack(l);const h=Tl(c,bc.a).max(0);o=this.setupOutput(e,h),eA.assign(o);const m=this.outputNode!==null;if(m&&(o=this.outputNode),e.context.getOutput&&(o=e.context.getOutput(o,e)),n!==null){const y=t.getMRT(),b=this.mrtNode;y!==null?(m&&eA.assign(o),o=y,b!==null&&(o=y.merge(b))):b!==null&&(o=b)}}else{let c=this.fragmentNode;c.isOutputStructNode!==!0&&(c=Tl(c)),o=this.setupOutput(e,c)}e.stack.outputNode=o,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let r=null;if(t.length>0||n.length>0){const i=e.renderer.currentSamples;this.alphaToCoverage&&i>1?r=ldt():e.stack.addToStack(adt())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(cdt()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let r=this.depthNode;if(r===null){const i=t.getMRT();i&&i.has("depth")?r=i.get("depth"):t.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?r=odt(s0.z,z6,V6):r=iA(s0.z,z6,V6))}r!==null&&eNe.assign(r).toStack()}setupPositionView(){return DAe.mul(bu).xyz}setupModelViewProjection(){return Gct.mul(s0)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.position=e.removeStack(),Rut}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&Kut(t).toStack(),t.isSkinnedMesh===!0&&$ut(t).toStack(),this.displacementMap){const r=sS("displacementMap","texture"),i=sS("displacementScale","float"),o=sS("displacementBias","float");bu.addAssign(Ag.normalize().mul(r.x.mul(i).add(o)))}return t.isBatchedMesh&&jut(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&Vut(t).toStack(),this.positionNode!==null&&bu.assign(tA(this.positionNode,"POSITION","vec3")),bu}setupDiffuseColor(e){const{object:t,geometry:n}=e;this.maskNode!==null&&hJ(this.maskNode).not().discard();let r=this.colorNode?Tl(this.colorNode):Mut;this.vertexColors===!0&&n.hasAttribute("color")&&(r=r.mul(mdt())),t.instanceColor&&(r=UF("vec3","vInstanceColor").mul(r)),t.isBatchedMesh&&t._colorsTexture&&(r=UF("vec3","vBatchColor").mul(r)),bc.assign(r);const i=this.opacityNode?xs(this.opacityNode):Aut;bc.a.assign(bc.a.mul(i));let o=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(o=this.alphaTestNode!==null?xs(this.alphaTestNode):Eut,this.alphaToCoverage===!0?(bc.a=hw(o,o.add(hAe(bc.a)),bc.a),bc.a.lessThanEqual(0).discard()):bc.a.lessThanEqual(o).discard()),this.alphaHash===!0&&bc.a.lessThan(pdt(bu)).discard(),e.isOpaque()&&bc.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?ai(0):bc.rgb}setupNormal(){return this.normalNode?ai(this.normalNode):Nut}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?sS("envMap","cubeTexture"):sS("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new edt(ZAe)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const r=this.setupLightMap(e);r&&r.isLightingNode&&t.push(r);let i=this.aoNode;i===null&&e.material.aoMap&&(i=Put),e.context.getAO&&(i=e.context.getAO(i,e)),i&&t.push(new Zut(i));let o=this.lightsNode||e.lightsNode;return t.length>0&&(o=e.renderer.lighting.createNode([...o.getLights(),...t])),o}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:r,emissiveNode:i}=this,l=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=this.setupOutgoingLight(e);if(l&&l.getScope().hasLights){const h=this.setupLightingModel(e)||null;c=Jut(l,h,n,r)}else n!==null&&(c=ai(r!==null?dw(c,n,r):n));return(i&&i.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(Rbe.assign(ai(i||Cut)),c=c.add(Rbe)),c}setupFog(e,t){const n=e.fogNode;return n&&(eA.assign(t),t=Tl(n.toVar())),t}setupPremultipliedAlpha(e,t){return gdt(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const n in e){const r=e[n];this[n]===void 0&&(this[n]=r,r&&r.clone&&(this[n]=r.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&t[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const n=_K.prototype.toJSON.call(this,e);n.inputNodes={};for(const{property:i,childNode:o}of this._getNodeChildren())n.inputNodes[i]=o.toJSON(e).uuid;function r(i){const o=[];for(const l in i){const c=i[l];delete c.metadata,o.push(c)}return o}if(t){const i=r(e.textures),o=r(e.images),l=r(e.nodes);i.length>0&&(n.textures=i),o.length>0&&(n.images=o),l.length>0&&(n.nodes=l)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.maskShadowNode=e.maskShadowNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,this.contextNode=e.contextNode,super.copy(e)}}const ydt=Tr(([s=LAe])=>{const e=s.z.atan(s.x).mul(1/(Math.PI*2)).add(.5),t=s.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return vm(e,t)});class PJ extends Pw{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:RF,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new Eu(0,0,e,t),this.scissorTest=!1,this.viewport=new Eu(0,0,e,t),this.textures=[];const r={width:e,height:t,depth:n.depth},i=new yh(r),o=n.count;for(let l=0;l<o;l++)this.textures[l]=i.clone(),this.textures[l].isRenderTargetTexture=!0,this.textures[l].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:RF,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n,this.textures[r].isData3DTexture!==!0&&(this.textures[r].isArrayTexture=this.textures[r].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const r=Object.assign({},e.textures[t].image);this.textures[t].source=new _J(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class vdt{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let xdt=0;const Jbe=new Yt,W_=new Rw,N3=new a0,wL=new Yt,vC=new Yt,bdt=new Yt,_dt=new Rw,e_e=new Yt(1,0,0),t_e=new Yt(0,1,0),n_e=new Yt(0,0,1),r_e={type:"added"},Sdt={type:"removed"},q_={type:"childadded",child:null},KX={type:"childremoved",child:null};class Cp extends Pw{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:xdt++}),this.uuid=Z3(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Cp.DEFAULT_UP.clone();const e=new Yt,t=new S5,n=new Rw,r=new Yt(1,1,1);function i(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(i),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new a0},normalMatrix:{value:new Bp}}),this.matrix=new a0,this.matrixWorld=new a0,this.matrixAutoUpdate=Cp.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Cp.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new vdt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.static=!1,this.userData={},this.pivot=null}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return W_.setFromAxisAngle(e,t),this.quaternion.multiply(W_),this}rotateOnWorldAxis(e,t){return W_.setFromAxisAngle(e,t),this.quaternion.premultiply(W_),this}rotateX(e){return this.rotateOnAxis(e_e,e)}rotateY(e){return this.rotateOnAxis(t_e,e)}rotateZ(e){return this.rotateOnAxis(n_e,e)}translateOnAxis(e,t){return Jbe.copy(e).applyQuaternion(this.quaternion),this.position.add(Jbe.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(e_e,e)}translateY(e){return this.translateOnAxis(t_e,e)}translateZ(e){return this.translateOnAxis(n_e,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(N3.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?wL.copy(e):wL.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),vC.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?N3.lookAt(vC,wL,this.up):N3.lookAt(wL,vC,this.up),this.quaternion.setFromRotationMatrix(N3),r&&(N3.extractRotation(r.matrixWorld),W_.setFromRotationMatrix(N3),this.quaternion.premultiply(W_.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(Js("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(r_e),q_.child=e,this.dispatchEvent(q_),q_.child=null):Js("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Sdt),KX.child=e,this.dispatchEvent(KX),KX.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),N3.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),N3.multiply(e.parent.matrixWorld)),e.applyMatrix4(N3),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(r_e),q_.child=e,this.dispatchEvent(q_),q_.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let i=0,o=r.length;i<o;i++)r[i].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vC,e,bdt),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vC,_dt,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);const e=this.pivot;if(e!==null){const t=e.x,n=e.y,r=e.z,i=this.matrix.elements;i[12]+=t-i[0]*t-i[4]*n-i[8]*r,i[13]+=n-i[1]*t-i[5]*n-i[9]*r,i[14]+=r-i[2]*t-i[6]*n-i[10]*r}this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let i=0,o=r.length;i<o;i++)r[i].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),this.static!==!1&&(r.static=this.static),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.pivot!==null&&(r.pivot=this.pivot.toArray()),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.morphTargetDictionary!==void 0&&(r.morphTargetDictionary=Object.assign({},this.morphTargetDictionary)),this.morphTargetInfluences!==void 0&&(r.morphTargetInfluences=this.morphTargetInfluences.slice()),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(l=>({...l,boundingBox:l.boundingBox?l.boundingBox.toJSON():void 0,boundingSphere:l.boundingSphere?l.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(l=>({...l})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(r.boundingBox=this.boundingBox.toJSON()));function i(l,c){return l[c.uuid]===void 0&&(l[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const c=l.shapes;if(Array.isArray(c))for(let h=0,m=c.length;h<m;h++){const y=c[h];i(e.shapes,y)}else i(e.shapes,c)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let c=0,h=this.material.length;c<h;c++)l.push(i(e.materials,this.material[c]));r.material=l}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let l=0;l<this.children.length;l++)r.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let l=0;l<this.animations.length;l++){const c=this.animations[l];r.animations.push(i(e.animations,c))}}if(t){const l=o(e.geometries),c=o(e.materials),h=o(e.textures),m=o(e.images),y=o(e.shapes),b=o(e.skeletons),w=o(e.animations),A=o(e.nodes);l.length>0&&(n.geometries=l),c.length>0&&(n.materials=c),h.length>0&&(n.textures=h),m.length>0&&(n.images=m),y.length>0&&(n.shapes=y),b.length>0&&(n.skeletons=b),w.length>0&&(n.animations=w),A.length>0&&(n.nodes=A)}return n.object=r,n;function o(l){const c=[];for(const h in l){const m=l[h];delete m.metadata,c.push(m)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),e.pivot!==null&&(this.pivot=e.pivot.clone()),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.static=e.static,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}}Cp.DEFAULT_UP=new Yt(0,1,0);Cp.DEFAULT_MATRIX_AUTO_UPDATE=!0;Cp.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class wdt extends Cp{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new S5,this.environmentIntensity=1,this.environmentRotation=new S5,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}const TL=new Yt,EL=new Rw,og=new Yt;class Tdt extends Cp{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new a0,this.projectionMatrix=new a0,this.projectionMatrixInverse=new a0,this.coordinateSystem=W3,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorld.decompose(TL,EL,og),og.x===1&&og.y===1&&og.z===1?this.matrixWorldInverse.copy(this.matrixWorld).invert():this.matrixWorldInverse.compose(TL,EL,og.set(1,1,1)).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorld.decompose(TL,EL,og),og.x===1&&og.y===1&&og.z===1?this.matrixWorldInverse.copy(this.matrixWorld).invert():this.matrixWorldInverse.compose(TL,EL,og.set(1,1,1)).invert()}clone(){return new this.constructor().copy(this)}}const Fy=new Yt,i_e=new il,s_e=new il;class X_ extends Tdt{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=kF*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(KC*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return kF*2*Math.atan(Math.tan(KC*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Fy.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Fy.x,Fy.y).multiplyScalar(-e/Fy.z),Fy.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Fy.x,Fy.y).multiplyScalar(-e/Fy.z)}getViewSize(e,t){return this.getViewBounds(e,i_e,s_e),t.subVectors(s_e,i_e)}setViewOffset(e,t,n,r,i,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(KC*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,h=o.fullHeight;i+=o.offsetX*r/c,t-=o.offsetY*n/h,r*=o.width/c,n*=o.height/h}const l=this.filmOffset;l!==0&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Y_=-90,K_=1;class Edt extends Cp{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new X_(Y_,K_,e,t);r.layers=this.layers,this.add(r);const i=new X_(Y_,K_,e,t);i.layers=this.layers,this.add(i);const o=new X_(Y_,K_,e,t);o.layers=this.layers,this.add(o);const l=new X_(Y_,K_,e,t);l.layers=this.layers,this.add(l);const c=new X_(Y_,K_,e,t);c.layers=this.layers,this.add(c);const h=new X_(Y_,K_,e,t);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,i,o,l,c]=t;for(const h of t)this.remove(h);if(e===W3)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===lw)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const h of t)this.add(h),h.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,o,l,c,h,m]=this.children,y=e.getRenderTarget(),b=e.getActiveCubeFace(),w=e.getActiveMipmapLevel(),A=e.xr.enabled;e.xr.enabled=!1;const I=n.texture.generateMipmaps;n.texture.generateMipmaps=!1;let D=!1;e.isWebGLRenderer===!0?D=e.state.buffers.depth.getReversed():D=e.reversedDepthBuffer,e.setRenderTarget(n,0,r),D&&e.autoClear===!1&&e.clearDepth(),e.render(t,i),e.setRenderTarget(n,1,r),D&&e.autoClear===!1&&e.clearDepth(),e.render(t,o),e.setRenderTarget(n,2,r),D&&e.autoClear===!1&&e.clearDepth(),e.render(t,l),e.setRenderTarget(n,3,r),D&&e.autoClear===!1&&e.clearDepth(),e.render(t,c),e.setRenderTarget(n,4,r),D&&e.autoClear===!1&&e.clearDepth(),e.render(t,h),n.texture.generateMipmaps=I,e.setRenderTarget(n,5,r),D&&e.autoClear===!1&&e.clearDepth(),e.render(t,m),e.setRenderTarget(y,b,w),e.xr.enabled=A,n.texture.needsPMREMUpdate=!0}}let Mdt=0;const yp=new a0,ZX=new Cp,Z_=new Yt,dh=new gN,xC=new gN,Ql=new Yt;class XB extends Pw{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Mdt++}),this.uuid=Z3(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Bot(e)?fct:pct)(e,1):this.index=e,this}setIndirect(e,t=0){return this.indirect=e,this.indirectOffset=t,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const i=new Bp().getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return yp.makeRotationFromQuaternion(e),this.applyMatrix4(yp),this}rotateX(e){return yp.makeRotationX(e),this.applyMatrix4(yp),this}rotateY(e){return yp.makeRotationY(e),this.applyMatrix4(yp),this}rotateZ(e){return yp.makeRotationZ(e),this.applyMatrix4(yp),this}translate(e,t,n){return yp.makeTranslation(e,t,n),this.applyMatrix4(yp),this}scale(e,t,n){return yp.makeScale(e,t,n),this.applyMatrix4(yp),this}lookAt(e){return ZX.lookAt(e),ZX.updateMatrix(),this.applyMatrix4(ZX.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Z_).negate(),this.translate(Z_.x,Z_.y,Z_.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let r=0,i=e.length;r<i;r++){const o=e[r];n.push(o.x,o.y,o.z||0)}this.setAttribute("position",new iF(n,3))}else{const n=Math.min(e.length,t.count);for(let r=0;r<n;r++){const i=e[r];t.setXYZ(r,i.x,i.y,i.z||0)}e.length>t.count&&bi("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new gN);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Js("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Yt(-1/0,-1/0,-1/0),new Yt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const i=t[n];dh.setFromBufferAttribute(i),this.morphTargetsRelative?(Ql.addVectors(this.boundingBox.min,dh.min),this.boundingBox.expandByPoint(Ql),Ql.addVectors(this.boundingBox.max,dh.max),this.boundingBox.expandByPoint(Ql)):(this.boundingBox.expandByPoint(dh.min),this.boundingBox.expandByPoint(dh.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Js('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new MJ);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Js("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Yt,1/0);return}if(e){const n=this.boundingSphere.center;if(dh.setFromBufferAttribute(e),t)for(let i=0,o=t.length;i<o;i++){const l=t[i];xC.setFromBufferAttribute(l),this.morphTargetsRelative?(Ql.addVectors(dh.min,xC.min),dh.expandByPoint(Ql),Ql.addVectors(dh.max,xC.max),dh.expandByPoint(Ql)):(dh.expandByPoint(xC.min),dh.expandByPoint(xC.max))}dh.getCenter(n);let r=0;for(let i=0,o=e.count;i<o;i++)Ql.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(Ql));if(t)for(let i=0,o=t.length;i<o;i++){const l=t[i],c=this.morphTargetsRelative;for(let h=0,m=l.count;h<m;h++)Ql.fromBufferAttribute(l,h),c&&(Z_.fromBufferAttribute(e,h),Ql.add(Z_)),r=Math.max(r,n.distanceToSquared(Ql))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&Js('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){Js("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,r=t.normal,i=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new d5(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),l=[],c=[];for(let z=0;z<n.count;z++)l[z]=new Yt,c[z]=new Yt;const h=new Yt,m=new Yt,y=new Yt,b=new il,w=new il,A=new il,I=new Yt,D=new Yt;function P(z,re,ye){h.fromBufferAttribute(n,z),m.fromBufferAttribute(n,re),y.fromBufferAttribute(n,ye),b.fromBufferAttribute(i,z),w.fromBufferAttribute(i,re),A.fromBufferAttribute(i,ye),m.sub(h),y.sub(h),w.sub(b),A.sub(b);const H=1/(w.x*A.y-A.x*w.y);isFinite(H)&&(I.copy(m).multiplyScalar(A.y).addScaledVector(y,-w.y).multiplyScalar(H),D.copy(y).multiplyScalar(w.x).addScaledVector(m,-A.x).multiplyScalar(H),l[z].add(I),l[re].add(I),l[ye].add(I),c[z].add(D),c[re].add(D),c[ye].add(D))}let U=this.groups;U.length===0&&(U=[{start:0,count:e.count}]);for(let z=0,re=U.length;z<re;++z){const ye=U[z],H=ye.start,Me=ye.count;for(let Oe=H,Ue=H+Me;Oe<Ue;Oe+=3)P(e.getX(Oe+0),e.getX(Oe+1),e.getX(Oe+2))}const j=new Yt,C=new Yt,Z=new Yt,ie=new Yt;function se(z){Z.fromBufferAttribute(r,z),ie.copy(Z);const re=l[z];j.copy(re),j.sub(Z.multiplyScalar(Z.dot(re))).normalize(),C.crossVectors(ie,re);const H=C.dot(c[z])<0?-1:1;o.setXYZW(z,j.x,j.y,j.z,H)}for(let z=0,re=U.length;z<re;++z){const ye=U[z],H=ye.start,Me=ye.count;for(let Oe=H,Ue=H+Me;Oe<Ue;Oe+=3)se(e.getX(Oe+0)),se(e.getX(Oe+1)),se(e.getX(Oe+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new d5(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let b=0,w=n.count;b<w;b++)n.setXYZ(b,0,0,0);const r=new Yt,i=new Yt,o=new Yt,l=new Yt,c=new Yt,h=new Yt,m=new Yt,y=new Yt;if(e)for(let b=0,w=e.count;b<w;b+=3){const A=e.getX(b+0),I=e.getX(b+1),D=e.getX(b+2);r.fromBufferAttribute(t,A),i.fromBufferAttribute(t,I),o.fromBufferAttribute(t,D),m.subVectors(o,i),y.subVectors(r,i),m.cross(y),l.fromBufferAttribute(n,A),c.fromBufferAttribute(n,I),h.fromBufferAttribute(n,D),l.add(m),c.add(m),h.add(m),n.setXYZ(A,l.x,l.y,l.z),n.setXYZ(I,c.x,c.y,c.z),n.setXYZ(D,h.x,h.y,h.z)}else for(let b=0,w=t.count;b<w;b+=3)r.fromBufferAttribute(t,b+0),i.fromBufferAttribute(t,b+1),o.fromBufferAttribute(t,b+2),m.subVectors(o,i),y.subVectors(r,i),m.cross(y),n.setXYZ(b+0,m.x,m.y,m.z),n.setXYZ(b+1,m.x,m.y,m.z),n.setXYZ(b+2,m.x,m.y,m.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ql.fromBufferAttribute(e,t),Ql.normalize(),e.setXYZ(t,Ql.x,Ql.y,Ql.z)}toNonIndexed(){function e(l,c){const h=l.array,m=l.itemSize,y=l.normalized,b=new h.constructor(c.length*m);let w=0,A=0;for(let I=0,D=c.length;I<D;I++){l.isInterleavedBufferAttribute?w=c[I]*l.data.stride+l.offset:w=c[I]*m;for(let P=0;P<m;P++)b[A++]=h[w++]}return new d5(b,m,y)}if(this.index===null)return bi("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new XB,n=this.index.array,r=this.attributes;for(const l in r){const c=r[l],h=e(c,n);t.setAttribute(l,h)}const i=this.morphAttributes;for(const l in i){const c=[],h=i[l];for(let m=0,y=h.length;m<y;m++){const b=h[m],w=e(b,n);c.push(w)}t.morphAttributes[l]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let l=0,c=o.length;l<c;l++){const h=o[l];t.addGroup(h.start,h.count,h.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const c in n){const h=n[c];e.data.attributes[c]=h.toJSON(e.data)}const r={};let i=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],m=[];for(let y=0,b=h.length;y<b;y++){const w=h[y];m.push(w.toJSON(e.data))}m.length>0&&(r[c]=m,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere=l.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const r=e.attributes;for(const h in r){const m=r[h];this.setAttribute(h,m.clone(t))}const i=e.morphAttributes;for(const h in i){const m=[],y=i[h];for(let b=0,w=y.length;b<w;b++)m.push(y[b].clone(t));this.morphAttributes[h]=m}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let h=0,m=o.length;h<m;h++){const y=o[h];this.addGroup(y.start,y.count,y.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}class RJ extends XB{constructor(e=1,t=1,n=1,r=1,i=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const l=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const c=[],h=[],m=[],y=[];let b=0,w=0;A("z","y","x",-1,-1,n,t,e,o,i,0),A("z","y","x",1,-1,n,t,-e,o,i,1),A("x","z","y",1,1,e,n,t,r,o,2),A("x","z","y",1,-1,e,n,-t,r,o,3),A("x","y","z",1,-1,e,t,n,r,i,4),A("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(c),this.setAttribute("position",new iF(h,3)),this.setAttribute("normal",new iF(m,3)),this.setAttribute("uv",new iF(y,2));function A(I,D,P,U,j,C,Z,ie,se,z,re){const ye=C/se,H=Z/z,Me=C/2,Oe=Z/2,Ue=ie/2,Ie=se+1,ce=z+1;let Ve=0,Pe=0;const We=new Yt;for(let pt=0;pt<ce;pt++){const Ne=pt*H-Oe;for(let st=0;st<Ie;st++){const Pt=st*ye-Me;We[I]=Pt*U,We[D]=Ne*j,We[P]=Ue,h.push(We.x,We.y,We.z),We[I]=0,We[D]=0,We[P]=ie>0?1:-1,m.push(We.x,We.y,We.z),y.push(st/se),y.push(1-pt/z),Ve+=1}}for(let pt=0;pt<z;pt++)for(let Ne=0;Ne<se;Ne++){const st=b+Ne+Ie*pt,Pt=b+Ne+Ie*(pt+1),yn=b+(Ne+1)+Ie*(pt+1),bn=b+(Ne+1)+Ie*pt;c.push(st,Pt,bn),c.push(Pt,yn,bn),Pe+=6}l.addGroup(w,Pe,re),w+=Pe,b+=Ve}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new RJ(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}const P3=new Yt,QX=new Yt,ML=new Yt,By=new Yt,JX=new Yt,CL=new Yt,eY=new Yt;class Cdt{constructor(e=new Yt,t=new Yt(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,P3)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=P3.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(P3.copy(this.origin).addScaledVector(this.direction,t),P3.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){QX.copy(e).add(t).multiplyScalar(.5),ML.copy(t).sub(e).normalize(),By.copy(this.origin).sub(QX);const i=e.distanceTo(t)*.5,o=-this.direction.dot(ML),l=By.dot(this.direction),c=-By.dot(ML),h=By.lengthSq(),m=Math.abs(1-o*o);let y,b,w,A;if(m>0)if(y=o*c-l,b=o*l-c,A=i*m,y>=0)if(b>=-A)if(b<=A){const I=1/m;y*=I,b*=I,w=y*(y+o*b+2*l)+b*(o*y+b+2*c)+h}else b=i,y=Math.max(0,-(o*b+l)),w=-y*y+b*(b+2*c)+h;else b=-i,y=Math.max(0,-(o*b+l)),w=-y*y+b*(b+2*c)+h;else b<=-A?(y=Math.max(0,-(-o*i+l)),b=y>0?-i:Math.min(Math.max(-i,-c),i),w=-y*y+b*(b+2*c)+h):b<=A?(y=0,b=Math.min(Math.max(-i,-c),i),w=b*(b+2*c)+h):(y=Math.max(0,-(o*i+l)),b=y>0?i:Math.min(Math.max(-i,-c),i),w=-y*y+b*(b+2*c)+h);else b=o>0?-i:i,y=Math.max(0,-(o*b+l)),w=-y*y+b*(b+2*c)+h;return n&&n.copy(this.origin).addScaledVector(this.direction,y),r&&r.copy(QX).addScaledVector(ML,b),w}intersectSphere(e,t){P3.subVectors(e.center,this.origin);const n=P3.dot(this.direction),r=P3.dot(P3)-n*n,i=e.radius*e.radius;if(r>i)return null;const o=Math.sqrt(i-r),l=n-o,c=n+o;return c<0?null:l<0?this.at(c,t):this.at(l,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,o,l,c;const h=1/this.direction.x,m=1/this.direction.y,y=1/this.direction.z,b=this.origin;return h>=0?(n=(e.min.x-b.x)*h,r=(e.max.x-b.x)*h):(n=(e.max.x-b.x)*h,r=(e.min.x-b.x)*h),m>=0?(i=(e.min.y-b.y)*m,o=(e.max.y-b.y)*m):(i=(e.max.y-b.y)*m,o=(e.min.y-b.y)*m),n>o||i>r||((i>n||isNaN(n))&&(n=i),(o<r||isNaN(r))&&(r=o),y>=0?(l=(e.min.z-b.z)*y,c=(e.max.z-b.z)*y):(l=(e.max.z-b.z)*y,c=(e.min.z-b.z)*y),n>c||l>r)||((l>n||n!==n)&&(n=l),(c<r||r!==r)&&(r=c),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,P3)!==null}intersectTriangle(e,t,n,r,i){JX.subVectors(t,e),CL.subVectors(n,e),eY.crossVectors(JX,CL);let o=this.direction.dot(eY),l;if(o>0){if(r)return null;l=1}else if(o<0)l=-1,o=-o;else return null;By.subVectors(this.origin,e);const c=l*this.direction.dot(CL.crossVectors(By,CL));if(c<0)return null;const h=l*this.direction.dot(JX.cross(By));if(h<0||c+h>o)return null;const m=-l*By.dot(eY);return m<0?null:this.at(m/o,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}const Zf=new Yt,R3=new Yt,tY=new Yt,I3=new Yt,Q_=new Yt,J_=new Yt,o_e=new Yt,nY=new Yt,rY=new Yt,iY=new Yt,sY=new Eu,oY=new Eu,aY=new Eu;class cm{constructor(e=new Yt,t=new Yt,n=new Yt){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Zf.subVectors(e,t),r.cross(Zf);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Zf.subVectors(r,t),R3.subVectors(n,t),tY.subVectors(e,t);const o=Zf.dot(Zf),l=Zf.dot(R3),c=Zf.dot(tY),h=R3.dot(R3),m=R3.dot(tY),y=o*h-l*l;if(y===0)return i.set(0,0,0),null;const b=1/y,w=(h*c-l*m)*b,A=(o*m-l*c)*b;return i.set(1-w-A,A,w)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,I3)===null?!1:I3.x>=0&&I3.y>=0&&I3.x+I3.y<=1}static getInterpolation(e,t,n,r,i,o,l,c){return this.getBarycoord(e,t,n,r,I3)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(i,I3.x),c.addScaledVector(o,I3.y),c.addScaledVector(l,I3.z),c)}static getInterpolatedAttribute(e,t,n,r,i,o){return sY.setScalar(0),oY.setScalar(0),aY.setScalar(0),sY.fromBufferAttribute(e,t),oY.fromBufferAttribute(e,n),aY.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(sY,i.x),o.addScaledVector(oY,i.y),o.addScaledVector(aY,i.z),o}static isFrontFacing(e,t,n,r){return Zf.subVectors(n,t),R3.subVectors(e,t),Zf.cross(R3).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Zf.subVectors(this.c,this.b),R3.subVectors(this.a,this.b),Zf.cross(R3).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return cm.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return cm.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,i){return cm.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return cm.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return cm.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let o,l;Q_.subVectors(r,n),J_.subVectors(i,n),nY.subVectors(e,n);const c=Q_.dot(nY),h=J_.dot(nY);if(c<=0&&h<=0)return t.copy(n);rY.subVectors(e,r);const m=Q_.dot(rY),y=J_.dot(rY);if(m>=0&&y<=m)return t.copy(r);const b=c*y-m*h;if(b<=0&&c>=0&&m<=0)return o=c/(c-m),t.copy(n).addScaledVector(Q_,o);iY.subVectors(e,i);const w=Q_.dot(iY),A=J_.dot(iY);if(A>=0&&w<=A)return t.copy(i);const I=w*h-c*A;if(I<=0&&h>=0&&A<=0)return l=h/(h-A),t.copy(n).addScaledVector(J_,l);const D=m*A-w*y;if(D<=0&&y-m>=0&&w-A>=0)return o_e.subVectors(i,r),l=(y-m)/(y-m+(w-A)),t.copy(r).addScaledVector(o_e,l);const P=1/(D+I+b);return o=I*P,l=b*P,t.copy(n).addScaledVector(Q_,o).addScaledVector(J_,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}class rNe extends _K{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new cN(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new S5,this.combine=MCe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const a_e=new a0,N6=new Cdt,AL=new MJ,l_e=new Yt,NL=new Yt,PL=new Yt,RL=new Yt,lY=new Yt,IL=new Yt,c_e=new Yt,kL=new Yt;class Adt extends Cp{constructor(e=new XB,t=new rNe){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,o=r.length;i<o;i++){const l=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=i}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const l=this.morphTargetInfluences;if(i&&l){IL.set(0,0,0);for(let c=0,h=i.length;c<h;c++){const m=l[c],y=i[c];m!==0&&(lY.fromBufferAttribute(y,e),o?IL.addScaledVector(lY,m):IL.addScaledVector(lY.sub(t),m))}t.add(IL)}return t}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),AL.copy(n.boundingSphere),AL.applyMatrix4(i),N6.copy(e.ray).recast(e.near),!(AL.containsPoint(N6.origin)===!1&&(N6.intersectSphere(AL,l_e)===null||N6.origin.distanceToSquared(l_e)>(e.far-e.near)**2))&&(a_e.copy(i).invert(),N6.copy(e.ray).applyMatrix4(a_e),!(n.boundingBox!==null&&N6.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,N6)))}_computeIntersections(e,t,n){let r;const i=this.geometry,o=this.material,l=i.index,c=i.attributes.position,h=i.attributes.uv,m=i.attributes.uv1,y=i.attributes.normal,b=i.groups,w=i.drawRange;if(l!==null)if(Array.isArray(o))for(let A=0,I=b.length;A<I;A++){const D=b[A],P=o[D.materialIndex],U=Math.max(D.start,w.start),j=Math.min(l.count,Math.min(D.start+D.count,w.start+w.count));for(let C=U,Z=j;C<Z;C+=3){const ie=l.getX(C),se=l.getX(C+1),z=l.getX(C+2);r=DL(this,P,e,n,h,m,y,ie,se,z),r&&(r.faceIndex=Math.floor(C/3),r.face.materialIndex=D.materialIndex,t.push(r))}}else{const A=Math.max(0,w.start),I=Math.min(l.count,w.start+w.count);for(let D=A,P=I;D<P;D+=3){const U=l.getX(D),j=l.getX(D+1),C=l.getX(D+2);r=DL(this,o,e,n,h,m,y,U,j,C),r&&(r.faceIndex=Math.floor(D/3),t.push(r))}}else if(c!==void 0)if(Array.isArray(o))for(let A=0,I=b.length;A<I;A++){const D=b[A],P=o[D.materialIndex],U=Math.max(D.start,w.start),j=Math.min(c.count,Math.min(D.start+D.count,w.start+w.count));for(let C=U,Z=j;C<Z;C+=3){const ie=C,se=C+1,z=C+2;r=DL(this,P,e,n,h,m,y,ie,se,z),r&&(r.faceIndex=Math.floor(C/3),r.face.materialIndex=D.materialIndex,t.push(r))}}else{const A=Math.max(0,w.start),I=Math.min(c.count,w.start+w.count);for(let D=A,P=I;D<P;D+=3){const U=D,j=D+1,C=D+2;r=DL(this,o,e,n,h,m,y,U,j,C),r&&(r.faceIndex=Math.floor(D/3),t.push(r))}}}}function Ndt(s,e,t,n,r,i,o,l){let c;if(e.side===BB?c=n.intersectTriangle(o,i,r,!0,l):c=n.intersectTriangle(r,i,o,e.side===gK,l),c===null)return null;kL.copy(l),kL.applyMatrix4(s.matrixWorld);const h=t.ray.origin.distanceTo(kL);return h<t.near||h>t.far?null:{distance:h,point:kL.clone(),object:s}}function DL(s,e,t,n,r,i,o,l,c,h){s.getVertexPosition(l,NL),s.getVertexPosition(c,PL),s.getVertexPosition(h,RL);const m=Ndt(s,e,t,n,NL,PL,RL,c_e);if(m){const y=new Yt;cm.getBarycoord(c_e,NL,PL,RL,y),r&&(m.uv=cm.getInterpolatedAttribute(r,l,c,h,y,new il)),i&&(m.uv1=cm.getInterpolatedAttribute(i,l,c,h,y,new il)),o&&(m.normal=cm.getInterpolatedAttribute(o,l,c,h,y,new Yt),m.normal.dot(n.direction)>0&&m.normal.multiplyScalar(-1));const b={a:l,b:c,c:h,normal:new Yt,materialIndex:0};cm.getNormal(NL,PL,RL,b.normal),m.face=b,m.barycoord=y}return m}class Pdt extends PJ{constructor(e=1,t={}){super(e,e,t),this.isCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new CJ(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i=new RJ(5,5,5),o=ydt(LAe),l=new nNe;l.colorNode=SJ(t,o,0),l.side=BB,l.blending=wot;const c=new Adt(i,l),h=new wdt;h.add(c),t.minFilter===JQ&&(t.minFilter=RF);const m=new Edt(1,10,this),y=e.getMRT();return e.setMRT(null),m.update(e,h),e.setMRT(y),t.minFilter=n,t.currentGenerateMipmaps=r,c.geometry.dispose(),c.material.dispose(),this}clear(e,t=!0,n=!0,r=!0){const i=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(i)}}const sA=new WeakMap;class Rdt extends c0{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=VAe(null);const t=new CJ;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Qs.RENDER}updateBefore(e){const{renderer:t,material:n}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const i=r.isTextureNode?r.value:n[r.property];if(i&&i.isTexture){const o=i.mapping;if(o===NCe||o===PCe){if(sA.has(i)){const l=sA.get(i);u_e(l,i.mapping),this._cubeTexture=l}else{const l=i.image;if(Idt(l)){const c=new Pdt(l.height);c.fromEquirectangularTexture(t,i),u_e(c.texture,i.mapping),this._cubeTexture=c.texture,sA.set(i,c.texture),i.addEventListener("dispose",iNe)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function Idt(s){return s==null?!1:s.height>0}function iNe(s){const e=s.target;e.removeEventListener("dispose",iNe);const t=sA.get(e);t!==void 0&&(sA.delete(e),t.dispose())}function u_e(s,e){e===NCe?s.mapping=QQ:e===PCe&&(s.mapping=ACe)}const kdt=so(Rdt).setParameterLength(1);class Ddt extends qB{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=kdt(this.envNode)}}class Odt extends qB{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=xs(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Ldt{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class Fdt extends Ldt{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,n=e.reflectedLight,r=e.irradianceLightMap;n.indirectDiffuse.assign(Tl(0)),r?n.indirectDiffuse.addAssign(r):n.indirectDiffuse.addAssign(Tl(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(bc.rgb)}finish(e){const{material:t,context:n}=e,r=n.outgoingLight,i=e.context.environment;if(i)switch(t.combine){case MCe:r.rgb.assign(dw(r.rgb,r.rgb.mul(i.rgb),WX.mul(qX)));break;case Tot:r.rgb.assign(dw(r.rgb,i.rgb,WX.mul(qX)));break;case Eot:r.rgb.addAssign(i.rgb.mul(WX.mul(qX)));break;default:bi("BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const Bdt=new rNe;class sNe extends nNe{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Bdt),this.setValues(e)}setupNormal(){return yN(UAe)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new Ddt(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Odt(ZAe)),t}setupOutgoingLight(){return bc.rgb}setupLightingModel(){return new Fdt}}class oNe extends c0{static get type(){return"BitcastNode"}constructor(e,t,n=null){super(),this.valueNode=e,this.conversionType=t,this.inputType=n,this.isBitcastNode=!0}getNodeType(e){if(this.inputType!==null){const t=this.valueNode.getNodeType(e),n=e.getTypeLength(t);return e.getTypeFromLength(n,this.conversionType)}return this.conversionType}generate(e){const t=this.getNodeType(e);let n="";if(this.inputType!==null){const r=this.valueNode.getNodeType(e);n=e.getTypeLength(r)===1?this.inputType:e.changeComponentType(r,this.inputType)}else n=this.valueNode.getNodeType(e);return`${e.getBitcastMethod(t,n)}( ${this.valueNode.build(e,n)} )`}}const Udt=ir(oNe).setParameterLength(2),zdt=s=>new oNe(s,"uint","float"),OL={};class ix extends yt{static get type(){return"BitcountNode"}constructor(e,t){super(e,t),this.isBitcountNode=!0}_resolveElementType(e,t,n){n==="int"?t.assign(Udt(e,"uint")):t.assign(e)}_returnDataNode(e){switch(e){case"uint":return I0;case"int":return Sl;case"uvec2":return KCe;case"uvec3":return QCe;case"uvec4":return eAe;case"ivec2":return pg;case"ivec3":return ZCe;case"ivec4":return JCe}}_createTrailingZerosBaseLayout(e,t){const n=this._returnDataNode(t);return Tr(([i])=>{const o=I0(0);this._resolveElementType(i,o,t);const l=xs(o.bitAnd(cAe(o))),h=zdt(l).shiftRight(23).sub(127);return n(h)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createLeadingZerosBaseLayout(e,t){const n=this._returnDataNode(t);return Tr(([i])=>{Hy(i.equal(I0(0)),()=>I0(32));const o=I0(0),l=I0(0);return this._resolveElementType(i,o,t),Hy(o.shiftRight(16).equal(0),()=>{l.addAssign(16),o.shiftLeftAssign(16)}),Hy(o.shiftRight(24).equal(0),()=>{l.addAssign(8),o.shiftLeftAssign(8)}),Hy(o.shiftRight(28).equal(0),()=>{l.addAssign(4),o.shiftLeftAssign(4)}),Hy(o.shiftRight(30).equal(0),()=>{l.addAssign(2),o.shiftLeftAssign(2)}),Hy(o.shiftRight(31).equal(0),()=>{l.addAssign(1)}),n(l)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createOneBitsBaseLayout(e,t){const n=this._returnDataNode(t);return Tr(([i])=>{const o=I0(0);this._resolveElementType(i,o,t),o.assign(o.sub(o.shiftRight(I0(1)).bitAnd(I0(1431655765)))),o.assign(o.bitAnd(I0(858993459)).add(o.shiftRight(I0(2)).bitAnd(I0(858993459))));const l=o.add(o.shiftRight(I0(4))).bitAnd(I0(252645135)).mul(I0(16843009)).shiftRight(I0(24));return n(l)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createMainLayout(e,t,n,r){const i=this._returnDataNode(t);return Tr(([l])=>{if(n===1)return i(r(l));{const c=i(0),h=["x","y","z","w"];for(let m=0;m<n;m++){const y=h[m];c[y].assign(r(l[y]))}return c}}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}setup(e){const{method:t,aNode:n}=this,{renderer:r}=e;if(r.backend.isWebGPUBackend)return super.setup(e);const i=this.getInputType(e),o=e.getElementType(i),l=e.getTypeLength(i),c=`${t}_base_${o}`,h=`${t}_${i}`;let m=OL[c];if(m===void 0){switch(t){case ix.COUNT_LEADING_ZEROS:{m=this._createLeadingZerosBaseLayout(c,o);break}case ix.COUNT_TRAILING_ZEROS:{m=this._createTrailingZerosBaseLayout(c,o);break}case ix.COUNT_ONE_BITS:{m=this._createOneBitsBaseLayout(c,o);break}}OL[c]=m}let y=OL[h];return y===void 0&&(y=this._createMainLayout(h,i,l,m),OL[h]=y),Tr(()=>y(n))()}}ix.COUNT_TRAILING_ZEROS="countTrailingZeros";ix.COUNT_LEADING_ZEROS="countLeadingZeros";ix.COUNT_ONE_BITS="countOneBits";const cY=new Yt,Vdt=new Yt,Gdt=new Bp;class jdt{constructor(e=new Yt(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=cY.subVectors(n,t).cross(Vdt.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(cY),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Gdt.getNormalMatrix(e),r=this.coplanarPoint(cY).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}new jdt;new Yt;new Yt;new Yt;new a0;new Yt(0,0,-1);new Eu;new Yt;new Yt;new Eu;new il;const Hdt=new PJ;TJ.flipX();Hdt.depthTexture=new NJ(1,1);Tr(([s])=>uw(xs(52.9829189).mul(uw(pN(s,vm(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]});Tr(([s,e,t])=>{const n=xs(2.399963229728653),r=fJ(xs(s).add(.5).div(xs(e))),i=xs(s).mul(n).add(t);return vm(aAe(i),LA(i)).mul(r)}).setLayout({name:"vogelDiskSample",type:"vec2",inputs:[{name:"sampleIndex",type:"int"},{name:"samplesCount",type:"int"},{name:"phi",type:"float"}]});class q3 extends Lr{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===q3.OBJECT?this.updateType=Qs.OBJECT:e===q3.MATERIAL?this.updateType=Qs.RENDER:e===q3.BEFORE_OBJECT?this.updateBeforeType=Qs.OBJECT:e===q3.BEFORE_MATERIAL&&(this.updateBeforeType=Qs.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}}q3.OBJECT="object";q3.MATERIAL="material";q3.BEFORE_OBJECT="beforeObject";q3.BEFORE_MATERIAL="beforeMaterial";Tr(({texture:s,uv:e})=>{const n=ai().toVar();return Hy(e.x.lessThan(1e-4),()=>{n.assign(ai(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{n.assign(ai(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{n.assign(ai(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{n.assign(ai(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{n.assign(ai(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{n.assign(ai(0,0,-1))}).Else(()=>{const i=s.sample(e.add(ai(-.01,0,0))).r.sub(s.sample(e.add(ai(.01,0,0))).r),o=s.sample(e.add(ai(0,-.01,0))).r.sub(s.sample(e.add(ai(0,.01,0))).r),l=s.sample(e.add(ai(0,0,-.01))).r.sub(s.sample(e.add(ai(0,0,.01))).r);n.assign(ai(i,o,l))}),n.normalize()});Tr(([s,e])=>s.mul(e).floor().div(e));const LL=new il;class $dt extends HB{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.isPassTextureNode=!0,this.setUpdateMatrix(!1)}setup(e){const t=e.getNodeProperties(this);return t.passNode=this.passNode,super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class d_e extends $dt{static get type(){return"PassMultipleTextureNode"}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n,this.isPassMultipleTextureNode=!0}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}class YB extends c0{static get type(){return"PassNode"}constructor(e,t,n,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const i=new NJ;i.isRenderTargetTexture=!0,i.name="depth";const o=new PJ(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Aot,...r});o.texture.name="output",o.depthTexture=i,this.renderTarget=o,this.overrideMaterial=null,this.transparent=!0,this.opaque=!0,this.contextNode=null,this._contextNodeCache=null,this._textures={output:o.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=sl(0),this._cameraFar=sl(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=Qs.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return bi("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return bi("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const n=this._textures[e],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=new d_e(this,e),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=new d_e(this,e,!0),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const n=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=QAe(this.getTextureNode(e),n,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const n=this._cameraNear,r=this._cameraFar,i=this.getViewZNode(e);this._linearDepthNodes[e]=t=iA(i,n,r)}return t}async compileAsync(e){const t=e.getRenderTarget(),n=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(n)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getOutputBufferType(),this.scope===YB.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let r,i;const o=t.getOutputRenderTarget();o&&o.isXRRenderTarget===!0?(i=1,r=t.xr.getCamera(),t.xr.updateCamera(r),LL.set(o.width,o.height)):(r=this.camera,i=t.getPixelRatio(),t.getSize(LL)),this._pixelRatio=i,this.setSize(LL.width,LL.height);const l=t.getRenderTarget(),c=t.getMRT(),h=t.autoClear,m=t.transparent,y=t.opaque,b=r.layers.mask,w=t.contextNode,A=n.overrideMaterial;this._cameraNear.value=r.near,this._cameraFar.value=r.far,this._layers!==null&&(r.layers.mask=this._layers.mask);for(const D in this._previousTextures)this.toggleTexture(D);this.overrideMaterial!==null&&(n.overrideMaterial=this.overrideMaterial),t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0,t.transparent=this.transparent,t.opaque=this.opaque,this.contextNode!==null&&((this._contextNodeCache===null||this._contextNodeCache.version!==this.version)&&(this._contextNodeCache={version:this.version,context:kw({...t.contextNode.getFlowContextData(),...this.contextNode.getFlowContextData()})}),t.contextNode=this._contextNodeCache.context);const I=n.name;n.name=this.name?this.name:n.name,t.render(n,r),n.name=I,n.overrideMaterial=A,t.setRenderTarget(l),t.setMRT(c),t.autoClear=h,t.transparent=m,t.opaque=y,t.contextNode=w,r.layers.mask=b}setSize(e,t){this._width=e,this._height=t;const n=Math.floor(this._width*this._pixelRatio*this._resolutionScale),r=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(n,r),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,n,r){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new Eu),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,n,r),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,n,r){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new Eu),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,n,r),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}YB.COLOR="color";YB.DEPTH="depth";ai(1.6605,-.1246,-.0182),ai(-.5876,1.1329,-.1006),ai(-.0728,-.0083,1.1187);ai(.6274,.0691,.0164),ai(.3293,.9195,.088),ai(.0433,.0113,.8956);function IJ(s){let e;const t=s.context.getViewZ;return t!==void 0&&(e=t(this)),(e||s0.z).negate()}Tr(([s,e],t)=>{const n=IJ(t);return hw(s,e,n)});Tr(([s],e)=>{const t=IJ(e);return s.mul(s,t,t).negate().exp().oneMinus()});Tr(([s,e],t)=>{const n=IJ(t),i=e.sub(Xct.y).max(0).toConst().mul(n).toConst();return s.mul(s,i,i).negate().exp().oneMinus()});Tr(([s,e])=>Tl(e.toFloat().mix(eA.rgb,s.toVec3()),eA.a));class Wdt extends Lr{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}so(Wdt);class Ig extends Lr{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),n=t.parents,r=this.method,i=this.getNodeType(e),o=this.getInputType(e),l=this.pointerNode,c=this.valueNode,h=[];h.push(`&${l.build(e,o)}`),c!==null&&h.push(c.build(e,o));const m=`${e.getMethod(r,i)}( ${h.join(", ")} )`;if(n?n.length===1&&n[0].isStackNode===!0:!1)e.addLineFlowCode(m,this);else return t.constNode===void 0&&(t.constNode=rx(m,i).toConst()),t.constNode.build(e)}}Ig.ATOMIC_LOAD="atomicLoad";Ig.ATOMIC_STORE="atomicStore";Ig.ATOMIC_ADD="atomicAdd";Ig.ATOMIC_SUB="atomicSub";Ig.ATOMIC_MAX="atomicMax";Ig.ATOMIC_MIN="atomicMin";Ig.ATOMIC_AND="atomicAnd";Ig.ATOMIC_OR="atomicOr";Ig.ATOMIC_XOR="atomicXor";so(Ig);class is extends c0{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,n=null){super(),this.method=e,this.aNode=t,this.bNode=n}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,n=this.bNode?this.bNode.getNodeType(e):null,r=e.isMatrix(t)?0:e.getTypeLength(t),i=e.isMatrix(n)?0:e.getTypeLength(n);return r>i?t:n}getNodeType(e){const t=this.method;return t===is.SUBGROUP_ELECT?"bool":t===is.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const n=this.method,r=this.getNodeType(e),i=this.getInputType(e),o=this.aNode,l=this.bNode,c=[];if(n===is.SUBGROUP_BROADCAST||n===is.SUBGROUP_SHUFFLE||n===is.QUAD_BROADCAST){const m=l.getNodeType(e);c.push(o.build(e,r),l.build(e,m==="float"?"int":r))}else n===is.SUBGROUP_SHUFFLE_XOR||n===is.SUBGROUP_SHUFFLE_DOWN||n===is.SUBGROUP_SHUFFLE_UP?c.push(o.build(e,r),l.build(e,"uint")):(o!==null&&c.push(o.build(e,i)),l!==null&&c.push(l.build(e,i)));const h=c.length===0?"()":`( ${c.join(", ")} )`;return e.format(`${e.getMethod(n,r)}${h}`,r,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}is.SUBGROUP_ELECT="subgroupElect";is.SUBGROUP_BALLOT="subgroupBallot";is.SUBGROUP_ADD="subgroupAdd";is.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";is.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";is.SUBGROUP_MUL="subgroupMul";is.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";is.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";is.SUBGROUP_AND="subgroupAnd";is.SUBGROUP_OR="subgroupOr";is.SUBGROUP_XOR="subgroupXor";is.SUBGROUP_MIN="subgroupMin";is.SUBGROUP_MAX="subgroupMax";is.SUBGROUP_ALL="subgroupAll";is.SUBGROUP_ANY="subgroupAny";is.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";is.QUAD_SWAP_X="quadSwapX";is.QUAD_SWAP_Y="quadSwapY";is.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";is.SUBGROUP_BROADCAST="subgroupBroadcast";is.SUBGROUP_SHUFFLE="subgroupShuffle";is.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";is.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";is.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";is.QUAD_BROADCAST="quadBroadcast";Tr(([s=fN()],{renderer:e,material:t})=>{const n=yAe(s.mul(2).sub(1));let r;if(t.alphaToCoverage&&e.currentSamples>0){const i=xs(n.fwidth()).toVar();r=hw(i.oneMinus(),i.add(1),n).oneMinus()}else r=gJ(n.greaterThan(1),0,1);return r});class qdt extends sNe{constructor(){super();const e=AAe(tNe(),.1,.5,0,1).oneMinus();this.colorNode=Tl(e,e,e,1)}}const Xdt=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {
  #include <uv_vertex>
  #include <color_vertex>
  #include <morphcolor_vertex>
  #include <batching_vertex>

  #if defined ( USE_SKINNING )
    #include <beginnormal_vertex>
    #include <morphnormal_vertex>
    #include <skinbase_vertex>
    #include <skinnormal_vertex>
    #include <defaultnormal_vertex>
  #endif

  #include <begin_vertex>
  #include <morphtarget_vertex>
  #include <skinning_vertex>
  #include <project_vertex>
  #include <logdepthbuf_vertex>
  #include <clipping_planes_vertex>
  #include <worldpos_vertex>
}`,Ydt=`
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
  #include <clipping_planes_fragment>
  if (opacity < 0.015) discard;
  gl_FragColor = vec4(vec3(vUv, 0.0), opacity);
}`;class Kdt extends bh{constructor(){super({defines:{USE_UV:""},uniforms:{opacity:{value:1}},vertexShader:Xdt,fragmentShader:Ydt,transparent:!0})}}class Zdt extends sNe{constructor(){super(),this.colorNode=Tl(fN(),0,1)}}const P6=new AA,_c=new be,Uy=new be,Uo=new vs,h_e={X:new be(1,0,0),Y:new be(0,1,0),Z:new be(0,0,1)},uY={type:"change"},p_e={type:"mouseDown",mode:null},f_e={type:"mouseUp",mode:null},m_e={type:"objectChange"};class Qdt extends _Se{constructor(e,t=null){super(void 0,t);const n=new iht(this);this._root=n;const r=new sht;this._gizmo=r,n.add(r);const i=new oht;this._plane=i,n.add(i);const o=this;function l(j,C){let Z=C;Object.defineProperty(o,j,{get:function(){return Z!==void 0?Z:C},set:function(ie){Z!==ie&&(Z=ie,i[j]=ie,r[j]=ie,o.dispatchEvent({type:j+"-changed",value:ie}),o.dispatchEvent(uY))}}),o[j]=C,i[j]=C,r[j]=C}l("camera",e),l("object",void 0),l("enabled",!0),l("axis",null),l("mode","translate"),l("translationSnap",null),l("rotationSnap",null),l("scaleSnap",null),l("space","world"),l("size",1),l("dragging",!1),l("showX",!0),l("showY",!0),l("showZ",!0),l("minX",-1/0),l("maxX",1/0),l("minY",-1/0),l("maxY",1/0),l("minZ",-1/0),l("maxZ",1/0);const c=new be,h=new be,m=new vs,y=new vs,b=new be,w=new vs,A=new be,I=new be,D=new be,P=0,U=new be;l("worldPosition",c),l("worldPositionStart",h),l("worldQuaternion",m),l("worldQuaternionStart",y),l("cameraPosition",b),l("cameraQuaternion",w),l("pointStart",A),l("pointEnd",I),l("rotationAxis",D),l("rotationAngle",P),l("eye",U),this._offset=new be,this._startNorm=new be,this._endNorm=new be,this._cameraScale=new be,this._parentPosition=new be,this._parentQuaternion=new vs,this._parentQuaternionInv=new vs,this._parentScale=new be,this._worldScaleStart=new be,this._worldQuaternionInv=new vs,this._worldScale=new be,this._positionStart=new be,this._quaternionStart=new vs,this._scaleStart=new be,this._getPointer=Jdt.bind(this),this._onPointerDown=tht.bind(this),this._onPointerHover=eht.bind(this),this._onPointerMove=nht.bind(this),this._onPointerUp=rht.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&P6.setFromCamera(e,this.camera);const t=dY(this._gizmo.picker[this.mode],P6);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&P6.setFromCamera(e,this.camera);const t=dY(this._plane,P6,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,p_e.mode=this.mode,this.dispatchEvent(p_e)}}pointerMove(e){const t=this.axis,n=this.mode,r=this.object;let i=this.space;if(n==="scale"?i="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(i="world"),r===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&P6.setFromCamera(e,this.camera);const o=dY(this._plane,P6,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),i==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),i==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),r.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(i==="local"&&(r.position.applyQuaternion(Uo.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this._quaternionStart)),i==="world"&&(r.parent&&r.position.add(_c.setFromMatrixPosition(r.parent.matrixWorld)),t.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(_c.setFromMatrixPosition(r.parent.matrixWorld)))),r.position.x=Math.max(this.minX,Math.min(this.maxX,r.position.x)),r.position.y=Math.max(this.minY,Math.min(this.maxY,r.position.y)),r.position.z=Math.max(this.minZ,Math.min(this.maxZ,r.position.z));else if(n==="scale"){if(t.search("XYZ")!==-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),Uy.set(l,l,l)}else _c.copy(this.pointStart),Uy.copy(this.pointEnd),_c.applyQuaternion(this._worldQuaternionInv),Uy.applyQuaternion(this._worldQuaternionInv),Uy.divide(_c),t.search("X")===-1&&(Uy.x=1),t.search("Y")===-1&&(Uy.y=1),t.search("Z")===-1&&(Uy.z=1);r.scale.copy(this._scaleStart).multiply(Uy),this.scaleSnap&&(t.search("X")!==-1&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=20/this.worldPosition.distanceTo(_c.setFromMatrixPosition(this.camera.matrixWorld));let c=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(_c.copy(this.rotationAxis).cross(this.eye))*l):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(h_e[t]),_c.copy(h_e[t]),i==="local"&&_c.applyQuaternion(this.worldQuaternion),_c.cross(this.eye),_c.length()===0?c=!0:this.rotationAngle=this._offset.dot(_c.normalize())*l),(t==="E"||c)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),i==="local"&&t!=="E"&&t!=="XYZE"?(r.quaternion.copy(this._quaternionStart),r.quaternion.multiply(Uo.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),r.quaternion.copy(Uo.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(uY),this.dispatchEvent(m_e)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(f_e.mode=this.mode,this.dispatchEvent(f_e)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(uY),this.dispatchEvent(m_e),this.pointStart.copy(this.pointEnd))}getRaycaster(){return P6}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}setColors(e,t,n,r){const i=this._gizmo.materialLib;i.xAxis.color.set(e),i.yAxis.color.set(t),i.zAxis.color.set(n),i.active.color.set(r),i.xAxisTransparent.color.set(e),i.yAxisTransparent.color.set(t),i.zAxisTransparent.color.set(n),i.activeTransparent.color.set(r),i.xAxis._color&&i.xAxis._color.set(e),i.yAxis._color&&i.yAxis._color.set(t),i.zAxis._color&&i.zAxis._color.set(n),i.active._color&&i.active._color.set(r),i.xAxisTransparent._color&&i.xAxisTransparent._color.set(e),i.yAxisTransparent._color&&i.yAxisTransparent._color.set(t),i.zAxisTransparent._color&&i.zAxisTransparent._color.set(n),i.activeTransparent._color&&i.activeTransparent._color.set(r)}}function Jdt(s){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:s.button};{const e=this.domElement.getBoundingClientRect();return{x:(s.clientX-e.left)/e.width*2-1,y:-(s.clientY-e.top)/e.height*2+1,button:s.button}}}function eht(s){if(this.enabled)switch(s.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(s));break}}function tht(s){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(s)),this.pointerDown(this._getPointer(s)))}function nht(s){this.enabled&&this.pointerMove(this._getPointer(s))}function rht(s){this.enabled&&(this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(s)))}function dY(s,e,t){const n=e.intersectObject(s,!0);for(let r=0;r<n.length;r++)if(n[r].object.visible||t)return n[r];return!1}const FL=new Sa,no=new be(0,1,0),g_e=new be(0,0,0),y_e=new Pn,BL=new vs,sF=new vs,ag=new be,v_e=new Pn,LC=new be(1,0,0),O6=new be(0,1,0),FC=new be(0,0,1),UL=new be,bC=new be,_C=new be;class iht extends Bi{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const t=this.controls;t.object!==void 0&&(t.object.updateMatrixWorld(),t.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):t.object.parent.matrixWorld.decompose(t._parentPosition,t._parentQuaternion,t._parentScale),t.object.matrixWorld.decompose(t.worldPosition,t.worldQuaternion,t._worldScale),t._parentQuaternionInv.copy(t._parentQuaternion).invert(),t._worldQuaternionInv.copy(t.worldQuaternion).invert()),t.camera.updateMatrixWorld(),t.camera.matrixWorld.decompose(t.cameraPosition,t.cameraQuaternion,t._cameraScale),t.camera.isOrthographicCamera?t.camera.getWorldDirection(t.eye).negate():t.eye.copy(t.cameraPosition).sub(t.worldPosition).normalize(),super.updateMatrixWorld(e)}dispose(){this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}}class sht extends Bi{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new rl({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Sh({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const r=t.clone();r.opacity=.5;const i=e.clone();i.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const l=e.clone();l.color.setHex(255);const c=e.clone();c.color.setHex(16711680),c.opacity=.5;const h=e.clone();h.color.setHex(65280),h.opacity=.5;const m=e.clone();m.color.setHex(255),m.opacity=.5;const y=e.clone();y.opacity=.25;const b=e.clone();b.color.setHex(16776960),b.opacity=.25;const w=e.clone();w.color.setHex(16776960);const A=e.clone();A.color.setHex(7895160),this.materialLib={xAxis:i,yAxis:o,zAxis:l,active:w,xAxisTransparent:c,yAxisTransparent:h,zAxisTransparent:m,activeTransparent:b};const I=new k0(0,.04,.1,12);I.translate(0,.05,0);const D=new _a(.08,.08,.08);D.translate(0,.04,0);const P=new Ki;P.setAttribute("position",new Fr([0,0,0,1,0,0],3));const U=new k0(.0075,.0075,.5,3);U.translate(0,.25,0);function j(Ie,ce){const Ve=new L6(Ie,.0075,3,64,ce*Math.PI*2);return Ve.rotateY(Math.PI/2),Ve.rotateX(Math.PI/2),Ve}function C(){const Ie=new Ki;return Ie.setAttribute("position",new Fr([0,0,0,1,1,1],3)),Ie}const Z={X:[[new gn(I,i),[.5,0,0],[0,0,-Math.PI/2]],[new gn(I,i),[-.5,0,0],[0,0,Math.PI/2]],[new gn(U,i),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new gn(I,o),[0,.5,0]],[new gn(I,o),[0,-.5,0],[Math.PI,0,0]],[new gn(U,o)]],Z:[[new gn(I,l),[0,0,.5],[Math.PI/2,0,0]],[new gn(I,l),[0,0,-.5],[-Math.PI/2,0,0]],[new gn(U,l),null,[Math.PI/2,0,0]]],XYZ:[[new gn(new H6(.1,0),y),[0,0,0]]],XY:[[new gn(new _a(.15,.15,.01),m),[.15,.15,0]]],YZ:[[new gn(new _a(.15,.15,.01),c),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new gn(new _a(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]]},ie={X:[[new gn(new k0(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new gn(new k0(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new gn(new k0(.2,0,.6,4),n),[0,.3,0]],[new gn(new k0(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new gn(new k0(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new gn(new k0(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new gn(new H6(.2,0),n)]],XY:[[new gn(new _a(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new gn(new _a(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new gn(new _a(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},se={START:[[new gn(new H6(.01,2),r),null,null,null,"helper"]],END:[[new gn(new H6(.01,2),r),null,null,null,"helper"]],DELTA:[[new dd(C(),r),null,null,null,"helper"]],X:[[new dd(P,r),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new dd(P,r),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new dd(P,r),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},z={XYZE:[[new gn(j(.5,1),A),null,[0,Math.PI/2,0]]],X:[[new gn(j(.5,.5),i)]],Y:[[new gn(j(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new gn(j(.5,.5),l),null,[0,Math.PI/2,0]]],E:[[new gn(j(.75,1),b),null,[0,Math.PI/2,0]]]},re={AXIS:[[new dd(P,r),[-1e3,0,0],null,[1e6,1,1],"helper"]]},ye={XYZE:[[new gn(new Mg(.25,10,8),n)]],X:[[new gn(new L6(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new gn(new L6(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new gn(new L6(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new gn(new L6(.75,.1,2,24),n)]]},H={X:[[new gn(D,i),[.5,0,0],[0,0,-Math.PI/2]],[new gn(U,i),[0,0,0],[0,0,-Math.PI/2]],[new gn(D,i),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new gn(D,o),[0,.5,0]],[new gn(U,o)],[new gn(D,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new gn(D,l),[0,0,.5],[Math.PI/2,0,0]],[new gn(U,l),[0,0,0],[Math.PI/2,0,0]],[new gn(D,l),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new gn(new _a(.15,.15,.01),m),[.15,.15,0]]],YZ:[[new gn(new _a(.15,.15,.01),c),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new gn(new _a(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new gn(new _a(.1,.1,.1),y)]]},Me={X:[[new gn(new k0(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new gn(new k0(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new gn(new k0(.2,0,.6,4),n),[0,.3,0]],[new gn(new k0(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new gn(new k0(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new gn(new k0(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new gn(new _a(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new gn(new _a(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new gn(new _a(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new gn(new _a(.2,.2,.2),n),[0,0,0]]]},Oe={X:[[new dd(P,r),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new dd(P,r),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new dd(P,r),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function Ue(Ie){const ce=new Bi;for(const Ve in Ie)for(let Pe=Ie[Ve].length;Pe--;){const We=Ie[Ve][Pe][0].clone(),pt=Ie[Ve][Pe][1],Ne=Ie[Ve][Pe][2],st=Ie[Ve][Pe][3],Pt=Ie[Ve][Pe][4];We.name=Ve,We.tag=Pt,pt&&We.position.set(pt[0],pt[1],pt[2]),Ne&&We.rotation.set(Ne[0],Ne[1],Ne[2]),st&&We.scale.set(st[0],st[1],st[2]),We.updateMatrix();const yn=We.geometry.clone();yn.applyMatrix4(We.matrix),We.geometry=yn,We.renderOrder=1/0,We.position.set(0,0,0),We.rotation.set(0,0,0),We.scale.set(1,1,1),ce.add(We)}return ce}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Ue(Z)),this.add(this.gizmo.rotate=Ue(z)),this.add(this.gizmo.scale=Ue(H)),this.add(this.picker.translate=Ue(ie)),this.add(this.picker.rotate=Ue(ye)),this.add(this.picker.scale=Ue(Me)),this.add(this.helper.translate=Ue(se)),this.add(this.helper.rotate=Ue(re)),this.add(this.helper.scale=Ue(Oe)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const n=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:sF;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let r=[];r=r.concat(this.picker[this.mode].children),r=r.concat(this.gizmo[this.mode].children),r=r.concat(this.helper[this.mode].children);for(let i=0;i<r.length;i++){const o=r[i];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let l;if(this.camera.isOrthographicCamera?l=(this.camera.top-this.camera.bottom)/this.camera.zoom:l=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(l*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(Uo.setFromEuler(FL.set(0,0,0)),o.quaternion.copy(n).multiply(Uo),Math.abs(no.copy(LC).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(Uo.setFromEuler(FL.set(0,0,Math.PI/2)),o.quaternion.copy(n).multiply(Uo),Math.abs(no.copy(O6).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(Uo.setFromEuler(FL.set(0,Math.PI/2,0)),o.quaternion.copy(n).multiply(Uo),Math.abs(no.copy(FC).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(Uo.setFromEuler(FL.set(0,Math.PI/2,0)),no.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(y_e.lookAt(g_e,no,O6)),o.quaternion.multiply(Uo),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),_c.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),_c.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(_c),o.visible=this.dragging):(o.quaternion.copy(n),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(n),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(no.copy(LC).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(no.copy(O6).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(no.copy(FC).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(no.copy(FC).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(no.copy(LC).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(no.copy(O6).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(BL.copy(n),no.copy(this.eye).applyQuaternion(Uo.copy(n).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(y_e.lookAt(this.eye,g_e,O6)),o.name==="X"&&(Uo.setFromAxisAngle(LC,Math.atan2(-no.y,no.z)),Uo.multiplyQuaternions(BL,Uo),o.quaternion.copy(Uo)),o.name==="Y"&&(Uo.setFromAxisAngle(O6,Math.atan2(no.x,no.z)),Uo.multiplyQuaternions(BL,Uo),o.quaternion.copy(Uo)),o.name==="Z"&&(Uo.setFromAxisAngle(FC,Math.atan2(no.y,no.x)),Uo.multiplyQuaternions(BL,Uo),o.quaternion.copy(Uo))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis?(o.material.color.copy(this.materialLib.active.color),o.material.opacity=1):this.axis.split("").some(function(c){return o.name===c})&&(o.material.color.copy(this.materialLib.active.color),o.material.opacity=1))}super.updateMatrixWorld(e)}}class oht extends gn{constructor(){super(new Ng(1e5,1e5,2,2),new rl({visible:!1,wireframe:!0,side:oa,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),UL.copy(LC).applyQuaternion(t==="local"?this.worldQuaternion:sF),bC.copy(O6).applyQuaternion(t==="local"?this.worldQuaternion:sF),_C.copy(FC).applyQuaternion(t==="local"?this.worldQuaternion:sF),no.copy(bC),this.mode){case"translate":case"scale":switch(this.axis){case"X":no.copy(this.eye).cross(UL),ag.copy(UL).cross(no);break;case"Y":no.copy(this.eye).cross(bC),ag.copy(bC).cross(no);break;case"Z":no.copy(this.eye).cross(_C),ag.copy(_C).cross(no);break;case"XY":ag.copy(_C);break;case"YZ":ag.copy(UL);break;case"XZ":no.copy(_C),ag.copy(bC);break;case"XYZ":case"E":ag.set(0,0,0);break}break;case"rotate":default:ag.set(0,0,0)}ag.length()===0?this.quaternion.copy(this.cameraQuaternion):(v_e.lookAt(_c.set(0,0,0),ag,no),this.quaternion.setFromRotationMatrix(v_e)),super.updateMatrixWorld(e)}}const tm=class tm extends _d{constructor(){super(...arguments);qe(this,"three");qe(this,"activeCamera");qe(this,"controls",new Map);qe(this,"visibility",new Map);qe(this,"setScene",()=>{this.clear()})}setApp(t){this.three=t,this.three.addEventListener(Ci.SET_SCENE,this.setScene)}clear(){for(const t of this.controls.values()){t.detach(),t.disconnect();const n=t.getHelper();Rp(n)}this.controls=new Map,this.visibility=new Map}add(t){let n=this.controls.get(t);if(n===void 0){const r=document.querySelector(".clickable");n=new Qdt(this.activeCamera,r),n.getHelper().name=t,n.setSize(.5),n.setSpace("local"),this.controls.set(t,n),this.visibility.set(t,!0),n.addEventListener("mouseDown",()=>{this.dispatchEvent({type:tm.DRAG_START})}),n.addEventListener("mouseUp",()=>{this.dispatchEvent({type:tm.DRAG_END})}),n.addEventListener("dragging-changed",i=>{var o;(o=nl.instance)==null||o.toggleOrbitControls(i.value)})}return n}get(t){return this.controls.get(t)}remove(t){const n=this.get(t);return n===void 0?!1:(n.detach(),n.disconnect(),Rp(n.getHelper()),this.controls.delete(t),!0)}enabled(t){this.controls.forEach(n=>{n.enabled=t})}updateCamera(t,n){this.activeCamera=t,this.controls.forEach(r=>{r.camera!==t&&(r.camera=t,t.getWorldPosition(r.cameraPosition),t.getWorldQuaternion(r.cameraQuaternion)),r.domElement!==n&&(r.disconnect(),r.domElement=n,r.connect(n))})}show(){this.controls.forEach(t=>{const n=t.getHelper(),r=this.visibility.get(n.name);r!==void 0&&(n.visible=r)})}hide(){this.controls.forEach(t=>{const n=t.getHelper();this.visibility.set(n.name,n.visible),n.visible=!1})}static get instance(){return tm._instance||(tm._instance=new tm),tm._instance}};qe(tm,"DRAG_START","Transform::dragStart"),qe(tm,"DRAG_END","Transform::dragEnd"),qe(tm,"_instance");let fh=tm;const aht=new _a,hY=new Ln;class pY extends Bi{constructor(t,n){const r=new Tn(c5(.5,1,Math.random()),c5(.5,1,Math.random()),c5(.5,1,Math.random()));super();qe(this,"curve",new w6e);qe(this,"line");qe(this,"draggable");qe(this,"curvePos");qe(this,"tension",.5);qe(this,"closed",!1);qe(this,"subdivide",50);qe(this,"curveType");qe(this,"offset",1);qe(this,"lineMaterial");qe(this,"_camera");qe(this,"_curvePercentage",0);qe(this,"_draggableScale",10);qe(this,"_transform");qe(this,"raycaster");qe(this,"draggedMat",new rl);qe(this,"parentGroup");qe(this,"group");qe(this,"dispose",()=>{this._transform&&(this._transform.removeEventListener("objectChange",this.updateSpline),fh.instance.remove(this.name)),this.disable(),this.parentGroup.removeGroup(this.name)});qe(this,"hideTransform",()=>{var t;(t=this._transform)==null||t.detach()});qe(this,"exportSpline",()=>{const t=[];this.draggable.children.forEach(n=>{t.push([om(n.position.x,3),om(n.position.y,3),om(n.position.z,3)])}),kXe({name:this.name,points:t,tension:this.tension,closed:this.closed,subdivide:this.subdivide,type:this.curveType}),console.log("Spline copied!")});qe(this,"showPoints",(t=!0)=>{this.draggable.visible=t});qe(this,"addPoints",(t=[])=>{if(t.length>0){const n=t.length-1;for(let r=0;r<n;r++)this.addPoint(t[r],!1);this.addPoint(t[n])}});qe(this,"addPoint",(t,n=!0)=>{var l;const r=this.draggable.children.length,i=new gn(aht,this.draggedMat);i.name=`point_${r}`,i.position.copy(t),i.scale.setScalar(this._draggableScale),this.draggable.add(i),(l=this._transform)==null||l.attach(i);const o=this.points.length>1;return o&&n&&this.updateSpline(),this.line.visible=o,this.updateCurrentPoint(),i});qe(this,"addNextPt",()=>{const t=this.draggable.children.length,n=t>1?this.draggable.children[t-1].position.clone():new be,r=this.addPoint(n);this.updateField(r.position)});qe(this,"removePoint",t=>{var n,r,i;if(((n=this._transform)==null?void 0:n.object)===t){(r=this._transform)==null||r.detach();const o=this.draggable.children[this.draggable.children.length-1];(i=this._transform)==null||i.attach(o),this.updateField(o.position)}Rp(t),this.updateSpline()});qe(this,"removePointAt",t=>{const n=this.draggable.children[t];this.removePoint(n)});qe(this,"removeSelectedPt",()=>{var t,n;((t=this._transform)==null?void 0:t.object)!==void 0&&this.removePoint((n=this._transform)==null?void 0:n.object)});qe(this,"updateSpline",()=>{this.points.length<2||(this.curve=new w6e(this.points,this.closed,this.curveType,this.tension),this.line.geometry.dispose(),this.line.geometry=new Ki().setFromPoints(this.curve.getPoints(this.subdivide)),this.curvePos.position.copy(this.getPointAt(this._curvePercentage)))});qe(this,"onMouseClick",t=>{var o,l;if(!nl.instance||!nl.instance.currentWindow||this._transform&&!this._transform.getHelper().visible)return;const r=nl.instance.currentWindow.current.getBoundingClientRect();hY.x=(t.clientX-r.x)/r.width*2-1,hY.y=-((t.clientY-r.y)/r.height)*2+1,this.raycaster.setFromCamera(hY,this.camera);const i=this.raycaster.intersectObjects(this.draggable.children,!1);if(i.length>0){const c=i[0].object;c!==((o=this._transform)==null?void 0:o.object)&&((l=this._transform)==null||l.attach(c),this.updateField(c.position))}});qe(this,"onUpdateTransform",()=>{this.updateCurrentPoint(),this.updateSpline()});qe(this,"debugPoint",t=>{t.name,t.visible=this.draggable.visible});this.name=t,this.lineMaterial=new Sh({color:r}),this.line=new dd(new Ki,this.lineMaterial),this.line.name="line",this.line.visible=!1,this.add(this.line),this._camera=n,this.curveType="catmullrom",this.draggedMat.color=r,this.draggable=new Bi,this.draggable.name="draggablePoints",this.add(this.draggable),this.curvePos=new gn(new Mg(1.5),new rl({color:r})),this.curvePos.name="curvePos",this.curvePos.scale.setScalar(this._draggableScale),this.curvePos.visible=!1,this.add(this.curvePos),this.raycaster=new AA,this.raycaster.params.Line.threshold=3,this.enable()}enable(){document.addEventListener("pointerdown",this.onMouseClick)}disable(){document.removeEventListener("pointerdown",this.onMouseClick)}updateLastPoint(t){const n=this.draggable.children.length;n>0&&(this.draggable.children[n-1].position.copy(t),this.updateSpline())}updateField(t){var n;(n=this.group.current)==null||n.setField("Current Point",t)}getPointAt(t){return this.curve.points.length>1?this.curve.getPointAt(t):this.curve.points.length===1?this.curve.points[0]:new be}getTangentAt(t){return this.curve.getTangentAt(t)}get points(){const t=[];return this.draggable.children.forEach(n=>{t.push(n.position)}),t}get total(){return this.draggable.children.length}get draggableScale(){return this._draggableScale}set draggableScale(t){this._draggableScale=t,this.draggable.children.forEach(n=>n.scale.setScalar(t)),this.curvePos.scale.setScalar(t)}get camera(){return this._camera}set camera(t){this._camera=t,this._transform!==void 0&&(this._transform.camera=t)}get curvePercentage(){return this._curvePercentage}set curvePercentage(t){this._curvePercentage=t,this.curvePos.position.copy(this.getPointAt(t))}updateCurrentPoint(){var t,n;if((t=this._transform)!=null&&t.object&&this.group){const r=(n=this._transform)==null?void 0:n.object;r.name.search("point")>-1&&this.updateField(r.position)}}initDebug(t,n){var o;const r=this.draggable.children;this.visible=n,this.parentGroup=t,this._transform=fh.instance.add(this.name),this._transform.camera=this._camera,this._transform.addEventListener("objectChange",this.onUpdateTransform),r.length>0&&this._transform.attach(r[r.length-1]),(o=nl.instance)==null||o.helpersContainer.add(this._transform.getHelper());const i=r.length>0?r[r.length-1].position:{x:0,y:0,z:0};this.group=t.addGroup({title:this.name,expanded:n,items:[{prop:"Closed",type:"boolean",value:this.closed},{prop:"Visible",type:"boolean",value:this.visible},{prop:"Show Position",type:"boolean",value:this.curvePos.visible},{prop:"Show Points",type:"boolean",value:this.draggable.visible},{prop:"Color",type:"color",value:`#${this.draggedMat.color.getHexString()}`},{prop:"Curve",type:"option",options:[{title:"Catmullrom",value:"catmullrom"},{title:"Centripetal",value:"centripetal"},{title:"Chordal",value:"chordal"}]},{prop:"Draggable Scale",type:"range",min:.01,max:100,step:.01,value:this._draggableScale},{prop:"Subdivide",type:"range",min:1,max:1e3,step:1,value:this.subdivide},{prop:"Tension",type:"range",min:0,max:1,step:.01,value:this.tension},{prop:"New Pt Offset",type:"range",min:0,max:10,value:this.offset},{prop:"Curve At",type:"range",min:0,max:1,step:.01,value:0},{prop:"Toggle Transform",type:"button"},{prop:"Add Point",type:"button"},{prop:"Remove Point",type:"button"},{prop:"Export",type:"button"},{prop:"Delete",type:"button"},{prop:"Current Point",type:"grid3",value:i}],onUpdate:(l,c)=>{var h,m;switch(l){case"Closed":this.closed=c,this.updateSpline();break;case"Visible":this.visible=c;break;case"Color":this.lineMaterial.color.setStyle(c),this.draggedMat.color.setStyle(c);break;case"Curve":this.curveType=c,this.updateSpline();break;case"Draggable Scale":this.draggableScale=c;break;case"Subdivide":this.subdivide=c,this.updateSpline();break;case"Tension":this.tension=c,this.updateSpline();break;case"New Pt Offset":this.offset=c;break;case"Curve At":this.curvePos.position.copy(this.getPointAt(c));break;case"Show Position":this.curvePos.visible=c;break;case"Show Points":this.draggable.visible=c;break;case"Toggle Transform":this._transform&&(this._transform.getHelper().visible=!this._transform.getHelper().visible);break;case"Add Point":this.addNextPt();break;case"Remove Point":this.removeSelectedPt();break;case"Export":this.exportSpline();break;case"Delete":this.parent.currentSpline=null,Rp(this);break;case"Current Point":if(this.group.current&&((h=this._transform)!=null&&h.object)){const y=(m=this._transform)==null?void 0:m.object;y.name.search("point")>-1&&(y.position.copy(c),this.updateSpline())}break}}}),this.draggable.children.forEach(l=>{this.debugPoint(l)})}}let zL=0;class lht extends Bi{constructor(t,n){super();qe(this,"defaultScale",10);qe(this,"currentSpline",null);qe(this,"_camera");qe(this,"group",null);qe(this,"three");qe(this,"splineDataText","");qe(this,"createSpline",(t=[])=>{const n=`Spline ${zL+1}`,r=new pY(n,this._camera);return r.addPoints(t),this.addSpline(r,!0),zL++,r});qe(this,"createSplineFromArray",t=>{const n=[];return t.forEach(r=>{n.push(new be(r[0],r[1],r[2]))}),this.createSpline(n)});qe(this,"createSplineFromCatmullRom",t=>this.createSpline(t.points));qe(this,"createSplineFromJSON",t=>{const n=[];t.points.forEach(i=>{n.push(new be(i[0],i[1],i[2]))});const r=new pY(t.name,this._camera);return r.closed=t.closed,r.subdivide=t.subdivide,r.tension=t.tension,r.type=t.type,r.addPoints(n),r.updateSpline(),this.addSpline(r,!1),r});qe(this,"showPoints",(t=!0)=>{this.children.forEach(n=>{n.showPoints(t)})});qe(this,"onAddSpline",t=>{const n=JSON.parse(t.value),r=n.name!==void 0?n.name:`Spline ${zL+1}`,i=new pY(r,this.camera);n.tension!==void 0&&(i.tension=n.tension),n.closed!==void 0&&(i.closed=n.closed),n.subdivide!==void 0&&(i.subdivide=n.subdivide),n.type!==void 0&&(i.curveType=n.type);const o=[];n.points.forEach(l=>{o.push(new be(l[0],l[1],l[2]))}),i.addPoints(o),this.addSpline(i,!1),zL++});qe(this,"isMouseDown",!1);qe(this,"onClickCanvas",t=>{var c;if(t.button!==0)return;if(this._camera.type!=="OrthographicCamera"){console.warn("Spline Editor - 3D Camera not supported in Draw Mode");return}const r=t.target.getBoundingClientRect(),i=(t.clientX-r.left)/r.width*2-1,o=-((t.clientY-r.top)/r.height)*2+1;if(nl.instance){const h=new AA;h.setFromCamera(new Ln(i,o),this._camera);const m=h.intersectObjects(nl.instance.helpersContainer.children,!0);for(let y=0;y<m.length;y++){const b=m[y];if(!(b.object.isLine||b.object.isTransformControlsPlane)&&b.object.isObject3D)return}}this.currentSpline===null&&(this.currentSpline=this.createSpline());const l=this.mouseToSplinePos(i,o,r.width,r.height);(c=this.currentSpline)==null||c.addPoint(l),this.isMouseDown=!0});qe(this,"onMouseMove",t=>{var c,h;if(!this.isMouseDown)return;const r=t.target.getBoundingClientRect(),i=(t.clientX-r.left)/r.width*2-1,o=-((t.clientY-r.top)/r.height)*2+1,l=this.mouseToSplinePos(i,o,r.width,r.height);(c=this.currentSpline)==null||c.updateLastPoint(l),(h=this.currentSpline)==null||h.updateField(l)});qe(this,"onMouseUp",()=>{this.isMouseDown=!1});this.name="Spline Editor",this._camera=t,this.three=n,this.three.addEventListener(Ci.ADD_SPLINE,this.onAddSpline)}initDebug(){this.group=u5.addEditorGroup({title:this.name,items:[{type:"field",prop:"Spline Data",value:"",disabled:!1},{type:"button",prop:"Import Spline"},{type:"button",prop:"New Spline"},{type:"boolean",prop:"Show Points",value:!0},{type:"boolean",prop:"Draw Mode",value:!1},{type:"boolean",prop:"Visible",value:this.visible},{type:"range",prop:"Default Scale",min:0,max:50,step:.01,value:this.defaultScale}],onUpdate:(t,n)=>{switch(t){case"New Spline":this.createSpline();break;case"Spline Data":this.splineDataText=n;break;case"Import Spline":this.createSplineFromJSON(JSON.parse(this.splineDataText));break;case"Show Points":this.showPoints(n);break;case"Visible":this.visible=n;break;case"Default Scale":this.defaultScale=n;break;case"Draw Mode":n?this.enableClickToDraw():this.disableClickToDraw();break}}})}dispose(){this.three.removeEventListener(Ci.ADD_SPLINE,this.onAddSpline),u5.removeEditorGroup(this.name)}addSpline(t,n){var r;t.draggableScale=this.defaultScale,t.hideTransform(),((r=this.group)==null?void 0:r.current)!==null&&t.initDebug(this.group.current,n),this.add(t),this.currentSpline=t}enableClickToDraw(){document.querySelectorAll(".clickable").forEach(t=>{t.addEventListener("mousedown",this.onClickCanvas),t.addEventListener("mousemove",this.onMouseMove),t.addEventListener("mouseup",this.onMouseUp)})}disableClickToDraw(){document.querySelectorAll(".clickable").forEach(t=>{t.removeEventListener("mousedown",this.onClickCanvas),t.removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("mouseup",this.onMouseUp)})}mouseToSplinePos(t,n,r,i){const o=new be,l=Math.PI/2,c=this._camera,h=c.zoom,m=c.rotation.x===-6123233995736766e-32&&c.rotation.y===0&&c.rotation.z===0,y=c.rotation.x===-Math.PI&&c.rotation.y===12246467991473532e-32&&c.rotation.z===Math.PI,b=c.rotation.x===-6162975822039155e-48&&c.rotation.y===-l&&c.rotation.z===0,w=c.rotation.x===-6162975822039155e-48&&c.rotation.y===l&&c.rotation.z===0,A=c.rotation.x===-1.5707953264174506&&c.rotation.y===0&&c.rotation.z===0,I=c.rotation.x===1.5707953264174506&&c.rotation.y===0&&c.rotation.z===0;let D=t,P=n;y||w?D*=-1:A&&(P*=-1);const U=r/2/h,j=i/2/h;if(this.currentSpline===null&&(this.currentSpline=this.createSpline()),m||y){const C=D*U+c.position.x,Z=P*j+c.position.y;o.set(C,Z,0)}else if(b||w){const C=D*U+c.position.z,Z=P*j+c.position.y;o.set(0,Z,C)}else if(A||I){const C=D*U+c.position.x,Z=P*j+c.position.z;o.set(C,0,Z)}return o}get camera(){return this._camera}set camera(t){this._camera=t,this.children.forEach(n=>{const r=n;r.camera=t})}}const x_e=["Single","Side by Side","Stacked","Quad"],cht="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC60lEQVRYhe2YT4hNcRTHP48xpmYaNAvRyEQxEhnKQljYsRm9/EmSyJiMFAsMZWNhJYoNIUVJ2VGiyb9ZzIpMpkQSahbGv9GMYWrM+1rc2zjvzvvdd+99rzdvMd+6de75nd+5387vnN/v/G5KEuWMKRNNIB8mCRaKiiL5qQb2ApuBuUAV0Ad0AJeB3sSeJRX6LJbULTf6JTUn9Z+KWMUpPyp/Avoa4CNQZ3Sj/lNpdL/xottR7AjOkHRUUpekN5I6JbVLavDH75lIfZN0UFKTpCWS0pJem/HeJBEMG6yV1ONYtgFJbZJ+GF1jDh+zJb03NuliEuwMkMo4yErS2RA/LcbuYVyCrm1mA7Dal/8Cu4FG4JD/HsTTkCy6a+SVMTPQuc1sBKb78nHghi+/A+YBxwL2lbhRY+ThuARdEVxu5JdGFvACr0otdoZ8Y4+Rn0Sn5sFFsMvI6YB9MzA1YJ8mN8k1wAHzfj4uQVdyrpI0aJL7oqTtkq4FiqPLyCOSbktqlbRL0jlJQ2b8QdwCUZ4qvhRStZL0XFK1pMd57CRvq5mfhKBriRfiFUMY6oD7eOdwPlQAN4G10dfWg+uouwXsiOssAj4AC+JMcEWwvnAuOTEr7gTXPmg34zagOwkbIIOXAo9CbDYBrcBXYN+4UUdy2sRflyS5zVNlfPX7ugpJW5V9nI7mmh+lYU0lCZ2B3TOnAVuAk0BTwC5nuhWro46KauBOQJch5OpRaoIW34GreGf+YZdRqS9NAj4Bp4ClQDvwOWxCqSM4ADQEdKE5XvbXzlITrAVe4TW+M6NMKDXBFLAMuAD0ACfIc7pMZBXXA2cY3/xmodQRHAL2A2+NLtj8ZiEKwUL/z2WMPAJcAVYALWSf8dZuDFGWeBHwKxm3sWYhiGG8Tfo6sA2vSfiSy4GrH3wGrDcfKSSKKf6v1E9yF0XK9Q1XBPuMXMw8HXTonQFwETwNzMFr64v1jzgFHIk9ybHEZYPJo65QlD3Bf2/Q/eaHPiSWAAAAAElFTkSuQmCC",uht="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAETklEQVRYhe2YXYhVVRTHf3d0/JhyUrMpFbImM+whSa3Mynww+4AeIgiKoozooQ+KyMyXIAujF6OXqHyI6iEKKYgIP/owsjSFqCkprdDUTEcjbWZ0HHV+Pex1ucfb9Z57Z9REXHA4Z++99l7/s/ZZ/7X2KaiczNLwfwPIk9MA+yunNMAG4DHgV+BvoB3YFff2TPstYEyfrajVroI6Sr1GvahsbJC63HzZq04pmztSvU5tVRuqYRiYg78JeBR4HPg5ntdmxovz9wJfA3uAxuibDLQCA+IqynnAQuBuYCnwMLC1rx48U12U8cZqdWqMDcx4cI16qTpYbVKHqa+ovWUeHKsujn7VL9ULq2HI+wY7gVeBJdGeFu3J4ZUiy/cAXeHRRuAQsC/GC0B3eG4BcH/0tUV7czUAeVsMsBF4Kha9HZgCvAncAuwPnXHA0wFuGLANuDrGuoGDwFxgTqzzQ7RX5FrP2eLsdb76vnogtme6+nE8H1YPlQXHwbi3q9eqn0e7Tb25VrsF68vFY0lb1AGcDTwItGQ8tQM4AIwGmqP/EPAu8A0wElgJfFGzxTo8mKWXu9Rd4ZF96jvqjSbauEC9Sn1O3R463epLaku99voCsFXdkAH3kNpcQW+IiT/bQne3eufxBtioPqP2mKhioXpWzpxb1T8C5Ifh4ZptVoriRmAIKdrI3Lujf3bobAPeJpF0NVkKrAFuI9HTOBIxnxFrF4OgQKKr/dnJlQA+AcwABgOHA4zAamA5cE7orQL+zAEHiWI+A2bFC7aSguheYCgpqAphZz3wSB7AecCICv2TgH8oFRib4gVqka0k0h8CXAxMBW6ooDejFoCvA9OBQUAvKWM0kDz4XUZvNKXtyZMWUl7vBbaQXq457PeEziDgx/KJlQAuIPFdMcEXv5OdYWBP9M8k8VpnDQCvB4aTSrCNJB5cSdrW3tBpIJVnR0qdUTxAfdGUOVTnmwqEanNmqltC/9OgqePKg5eom8PgdvW+oJ9Kupera0O3U50TL3lcAaI+oHaF4R3qa6Z822wq0Saq89T1lmSxOrxeW/Xm4uGkiqQDmECKuKHxHW0HdpMiewSpvGqKeR8Ay0iBsYIjg6261PE2o9Q3Yqv+MqWxO9R1Hl12qs+q49Vlppy82pSr+5xJKsko4AXgHlJ0t5NIeg3wLXAlqZhtIUV8J6nmWwX8QiLjdhL5TwMWkY4R6/rrwYKlMr1Y321QZ/vfwBijPqm+rF4Wc7PjE9QllurGVeoV5gRNHsAm9fnMom3qrKPoTjKdMXaYyrFygEWQ72XWW24qhPu8xcUc2UU6O8wFPjmK7jhgPHAuMJGUGQ6U6WwE5sfzTXGvei7KA9hFOiR9D/wOfFVFt4dS2tpfRe83Ur7/CPiJakfOGgBCypubatArl2r8VfOax/LfzABKtePAzHO/5FgC7KBEzB2kOrDfUm8mOeFySv9+OyFyGmB/5aQH+C9BVKmVCNuMZgAAAABJRU5ErkJggg==",dht="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAQ0lEQVQ4jWP8////fwYqAxYozUhFM/8zkaKYWIWkGEq0b0ZdSjQY5i79TyWagRGaTUdzFEEw6lLqGzqwLoVVJ1StpwA9sBwbUqAh5gAAAABJRU5ErkJggg==",jF=class jF extends On.Component{constructor(t){super(t);qe(this,"scene");qe(this,"renderer");qe(this,"currentScene");qe(this,"scenes",new Map);qe(this,"cameras",new Map);qe(this,"controls",new Map);qe(this,"currentCamera");qe(this,"currentWindow");qe(this,"helpersContainer",new j6);qe(this,"grid");qe(this,"cameraHelpers",new Map);qe(this,"lightHelpers",new Map);qe(this,"interactionHelper",new Pje(25));qe(this,"currentTransform");qe(this,"splineEditor");qe(this,"depthMaterial");qe(this,"normalsMaterial");qe(this,"uvMaterial");qe(this,"wireframeMaterial",new rl({opacity:.33,transparent:!0,wireframe:!0}));qe(this,"playing",!1);qe(this,"rafID",-1);qe(this,"cameraControlsRafID",-1);qe(this,"width",0);qe(this,"height",0);qe(this,"tlCam",null);qe(this,"trCam",null);qe(this,"blCam",null);qe(this,"brCam",null);qe(this,"tlRender","Renderer");qe(this,"trRender","Renderer");qe(this,"blRender","Renderer");qe(this,"brRender","Renderer");qe(this,"cameraVisibility",!0);qe(this,"lightVisibility",!0);qe(this,"gridVisibility",!0);qe(this,"rendererReady",!1);qe(this,"selectedItem");qe(this,"debugCamera");qe(this,"raycaster",new AA);qe(this,"pointer",new Ln);qe(this,"cameraControls");qe(this,"canvasRef");qe(this,"containerRef");qe(this,"tlWindow");qe(this,"trWindow");qe(this,"blWindow");qe(this,"brWindow");qe(this,"editorCameras",["Top","Bottom","Left","Right","Front","Back","Orthographic","UI","Debug"]);qe(this,"setupRenderer",t=>{const n=t.value;if(this.renderer){if(this.renderer instanceof VC&&n.type==="WebGLRenderer"||this.renderer instanceof hS&&n.type==="WebGPURenderer")return;this.renderer.dispose()}this.rendererReady=!1;const r=this.canvasRef.current;this.props.three.canvas=r,n.type==="WebGLRenderer"?(this.renderer=new VC({canvas:r,stencil:!1}),this.depthMaterial=new oSe,this.normalsMaterial=new lZ,this.uvMaterial=new Kdt,this.grid=new sat,this.scene.add(this.grid),this.rendererReady=!0):n.type==="WebGPURenderer"&&(this.renderer=new hS({canvas:r,stencil:!1}),this.grid=new Eat,this.scene.add(this.grid)),this.renderer&&(this.renderer.autoClear=!1,this.renderer.shadowMap.enabled=!0,this.renderer.setClearColor(0),this.renderer.setPixelRatio(devicePixelRatio),this.renderer.setScissorTest(!0),this.resize(),this.props.three.renderer=this.renderer,this.depthMaterial=new qdt,this.normalsMaterial=new OEe,this.uvMaterial=new Zdt,n.type==="WebGPURenderer"?this.renderer.init().then(()=>{this.rendererReady=!0,this.props.three.requestScene()}):this.props.three.requestScene())});qe(this,"onUpdate",()=>{this.playing&&(this.update(),this.draw(),this.rafID=requestAnimationFrame(this.onUpdate))});qe(this,"resize",()=>{var l;this.width=window.innerWidth-300,this.height=window.innerHeight,(l=this.renderer)==null||l.setSize(this.width,this.height);const t=Math.floor(this.width/2),n=Math.floor(this.height/2);this.props.three.resize(this.width,this.height),this.props.onSceneResize!==void 0&&this.currentScene!==void 0&&this.props.onSceneResize(this.currentScene,this.width,this.height);let r=this.width,i=this.height;switch(this.state.mode){case"Side by Side":r=t,i=this.height;break;case"Stacked":r=this.width,i=n;break;case"Quad":r=t,i=n;break}const o=r/i;this.cameras.forEach(c=>{var h;c instanceof J3?(c.left=r/-2,c.right=r/2,c.top=i/2,c.bottom=i/-2,c.name==="UI"&&(c.position.x=this.width/2,c.position.y=this.height/-2,c.position.z=100),c.updateProjectionMatrix()):c instanceof Va&&(c.aspect=o,c.updateProjectionMatrix()),(h=this.cameraHelpers.get(c.name))==null||h.update()})});qe(this,"addScene",t=>{const n=this.props.scenes.get(t.value.name);if(n!==void 0){const r=new n;r.visible=!1,this.props.onSceneAdd!==void 0&&this.props.onSceneAdd(r),this.props.three.scene=r,this.scenes.set(t.value.name,r),this.scene.add(r)}else console.log("Hermes - Scene not found:",t.value.name,this.props.scenes)});qe(this,"sceneUpdate",t=>{this.currentScene!==void 0&&(this.currentScene.visible=!1,this.clearLightHelpers());const n=this.scene.getObjectByName(t.value.name);n!==void 0&&(this.currentScene=n,this.currentScene.visible=!0,this.addLightHelpers(this.currentScene))});qe(this,"removeScene",t=>{const n=t.value.name;this.scenes.delete(n);const r=this.scene.getObjectByName(n);r&&setTimeout(()=>{Rp(r)},100),this.clearLightHelpers()});qe(this,"addCamera",t=>{var o;const n=t.value,r=n.uuid,i=(o=this.props.three.scene)==null?void 0:o.getObjectByProperty("uuid",n.uuid);if(i!==void 0){const l=i;this.cameras.set(r,l);const c=new Nje(l);c.visible=this.cameraVisibility,this.cameraHelpers.set(r,c),this.helpersContainer.add(c),this.setState({lastUpdate:Date.now()})}});qe(this,"removeCamera",t=>{const r=t.value.uuid,i=this.cameraHelpers.get(r);i!==void 0&&(this.helpersContainer.remove(i),i.dispose()),this.cameras.delete(r),this.setState({lastUpdate:Date.now()})});qe(this,"onMouseMove",t=>{var y;const n=new Ln;(y=this.renderer)==null||y.getSize(n);const r=Math.min(t.clientX,n.x),i=Math.min(t.clientY,n.y);this.pointer.x=D6(r,0,n.x,-1,1),this.pointer.y=D6(i,0,n.y,1,-1);const o=n.x/2,l=n.y/2,c=()=>{r<o?this.pointer.x=D6(r,0,o,-1,1):this.pointer.x=D6(r,o,n.x,-1,1)},h=()=>{i<l?this.pointer.y=D6(i,0,l,1,-1):this.pointer.y=D6(i,l,n.y,1,-1)};switch(this.state.mode){case"Quad":c(),h();break;case"Side by Side":c();break;case"Stacked":h(),h();break}if(this.updateCamera(r,i,o,l),this.state.interactionMode==="Orbit"||this.currentScene===void 0)return;const m=this.raycaster.intersectObjects(this.currentScene.children);m.length>0&&this.interactionHelper.position.copy(m[0].point)});qe(this,"onClick",t=>{if(this.state.interactionMode==="Orbit"||this.currentScene===void 0)return;const n=new Ln;if(this.renderer.getSize(n),t.clientX>=n.x)return;this.onMouseMove(t);const r=this.raycaster.intersectObjects(this.currentScene.children);r.length>0&&(this.props.three.getObject(r[0].object.uuid),this.interactionHelper.visible=!1,this.setState({interactionMode:"Orbit",lastUpdate:Date.now()}))});qe(this,"onKey",t=>{if(this.selectedItem!==void 0){if(t.ctrlKey){if(this.currentCamera.name==="UI")return;const n=this.controls.get(this.currentCamera.name);t.key==="0"?(t.preventDefault(),this.clearControls(),this.cameraControls=new ug(this.currentCamera,this.currentWindow.current),this.selectedItem instanceof gn||this.selectedItem instanceof QK?(this.selectedItem.geometry.computeBoundingBox(),this.cameraControls.fitToBox(this.selectedItem.geometry.boundingBox,!0)):this.cameraControls.fitToSphere(this.selectedItem,!0),this.updateCameraControls(n,!0)):t.key==="1"?(t.preventDefault(),this.clearControls(),this.cameraControls=new ug(this.currentCamera,this.currentWindow.current),this.cameraControls.rotateTo(0,Math.PI*.5,!0),this.cameraControls.moveTo(this.selectedItem.position.x,this.selectedItem.position.y,0,!0),this.updateCameraControls(n)):t.key==="2"?(t.preventDefault(),this.clearControls(),this.cameraControls=new ug(this.currentCamera,this.currentWindow.current),this.cameraControls.rotateTo(0,0,!0),this.cameraControls.moveTo(this.selectedItem.position.x,0,this.selectedItem.position.z,!0),this.updateCameraControls(n)):t.key==="3"?(t.preventDefault(),this.clearControls(),this.cameraControls=new ug(this.currentCamera,this.currentWindow.current),this.cameraControls.rotateTo(Math.PI/2,Math.PI/2,!0),this.cameraControls.moveTo(0,this.selectedItem.position.y,this.selectedItem.position.z,!0),this.updateCameraControls(n)):t.key==="4"?(t.preventDefault(),this.clearControls(),this.cameraControls=new ug(this.currentCamera,this.currentWindow.current),this.cameraControls.rotateTo(Math.PI,Math.PI/2,!0),this.cameraControls.moveTo(this.selectedItem.position.x,this.selectedItem.position.y,0,!0),this.updateCameraControls(n)):t.key==="5"&&(t.preventDefault(),this.clearControls(),this.cameraControls=new ug(this.currentCamera,this.currentWindow.current),this.cameraControls.rotateTo(DF(45),DF(45),!0),this.updateCameraControls(n))}else if(this.currentTransform!==void 0)switch(t.key){case"r":this.currentTransform.setMode("rotate");break;case"s":this.currentTransform.setMode("scale");break;case"t":this.currentTransform.setMode("translate");break;case"q":this.currentTransform.setSpace(this.currentTransform.space==="local"?"world":"local");break}}});qe(this,"onSetSelectedItem",t=>{this.selectedItem!==void 0&&this.updateSelectedItemHelper(!1),this.selectedItem=void 0;const n=t.value.uuid;if(this.scenes.forEach(r=>{n.search(r.uuid)>-1&&(this.selectedItem=r.getObjectByProperty("uuid",n))}),this.selectedItem===void 0){console.log(`Hermes - Can't find selected item: ${t.value.uuid}, ${t.value.name}`);return}this.currentTransform!==void 0&&(this.currentTransform.removeEventListener("objectChange",this.onUpdateTransform),fh.instance.remove(this.currentTransform.getHelper().name)),this.currentTransform=fh.instance.add(t.value.name),this.currentTransform&&(this.currentTransform.attach(this.selectedItem),this.helpersContainer.add(this.currentTransform.getHelper()),this.currentTransform.addEventListener("objectChange",this.onUpdateTransform)),this.updateSelectedItemHelper(!0)});qe(this,"onUpdateTransform",()=>{this.selectedItem!==void 0&&(this.props.three.updateObject(this.selectedItem.uuid,"position",this.selectedItem.position),this.props.three.updateObject(this.selectedItem.uuid,"rotation",{x:this.selectedItem.rotation.x,y:this.selectedItem.rotation.y,z:this.selectedItem.rotation.z}),this.props.three.updateObject(this.selectedItem.uuid,"scale",this.selectedItem.scale),FF.instance.update())});qe(this,"clearLightHelpers",()=>{this.lightHelpers.forEach(t=>{this.helpersContainer.remove(t),t.dispose()}),this.lightHelpers.clear()});qe(this,"addLightHelpers",t=>{t.traverse(n=>{if(n.type.search("Light")>-1){let r;switch(n.type){case"DirectionalLight":r=new Aje(n,100),r.name=`${n.name}Helper`,r.visible=this.lightVisibility,this.lightHelpers.set(n.name,r),this.helpersContainer.add(r);break;case"HemisphereLight":r=new Cje(n,250),r.name=`${n.name}Helper`,r.visible=this.lightVisibility,this.lightHelpers.set(n.name,r),this.helpersContainer.add(r);break;case"RectAreaLight":r=new lot(n),r.name=`${n.name}Helper`,r.visible=this.lightVisibility,this.lightHelpers.set(n.name,r),this.helpersContainer.add(r);break;case"PointLight":r=new bSe(n,100),r.name=`${n.name}Helper`,r.visible=this.lightVisibility,this.lightHelpers.set(n.name,r),this.helpersContainer.add(r);break;case"SpotLight":r=new Tje(n),r.name=`${n.name}Helper`,r.visible=this.lightVisibility,this.lightHelpers.set(n.name,r),this.helpersContainer.add(r);break}}})});qe(this,"updateCamera",(t,n,r,i)=>{switch(this.state.mode){case"Quad":n<i?t<r?this.currentCamera=this.tlCam:this.currentCamera=this.trCam:t<r?this.currentCamera=this.blCam:this.currentCamera=this.brCam;break;case"Side by Side":t<r?this.currentCamera=this.tlCam:this.currentCamera=this.trCam;break;case"Single":this.currentCamera=this.tlCam;break;case"Stacked":n<i?this.currentCamera=this.tlCam:this.currentCamera=this.trCam;break}this.splineEditor.camera=this.currentCamera,this.raycaster.setFromCamera(this.pointer,this.currentCamera),this.currentCamera===this.tlCam?this.currentWindow=this.tlWindow:this.currentCamera===this.trCam?this.currentWindow=this.trWindow:this.currentCamera===this.blCam?this.currentWindow=this.blWindow:this.currentCamera===this.brCam&&(this.currentWindow=this.brWindow),fh.instance.updateCamera(this.currentCamera,this.currentWindow.current)});qe(this,"updateCameraControls",(t,n=!1)=>{if(this.selectedItem===void 0)return;cancelAnimationFrame(this.cameraControlsRafID),this.cameraControlsRafID=-1,this.cameraControls&&(this.cameraControls.smoothTime=.1);const r=.15,i=new wje;i.start(),this.selectedItem.getWorldPosition(t.target0);const o=()=>{const l=i.getDelta();this.cameraControls&&this.cameraControls.update(l),n&&(t.target.lerp(t.target0,r),t.object.position.lerp(t.position0,r),t.object.zoom=mK(t.object.zoom,t.zoom0,r),t.object.updateProjectionMatrix(),t.dispatchEvent({type:"change"})),i.getElapsedTime()>=.5?(cancelAnimationFrame(this.cameraControlsRafID),this.cameraControlsRafID=-1,this.clearControls()):this.cameraControlsRafID=requestAnimationFrame(o)};o()});qe(this,"clearControls",()=>{this.cameraControls!==void 0&&(this.cameraControls.disconnect(),this.cameraControls.dispose(),this.cameraControls=void 0)});qe(this,"drawDouble",()=>{const t=this.getSceneOverride(this.tlRender),n=this.getSceneOverride(this.trRender),r=Math.floor(this.width/2),i=Math.floor(this.height/2),o=this.renderer instanceof hS;if(this.state.mode==="Side by Side")this.drawTo(0,0,r,this.height,this.tlCam,t),this.drawTo(r,0,r,this.height,this.trCam,n);else{const l=this.height-i;o?(this.drawTo(0,0,this.width,i,this.tlCam,t),this.drawTo(0,l,this.width,i,this.trCam,n)):(this.drawTo(0,l,this.width,i,this.tlCam,t),this.drawTo(0,0,this.width,i,this.trCam,n))}});qe(this,"drawQuad",()=>{const t=this.renderer instanceof hS,n=this.getSceneOverride(this.tlRender),r=this.getSceneOverride(this.trRender),i=this.getSceneOverride(this.blRender),o=this.getSceneOverride(this.brRender),l=Math.floor(this.width/2),c=Math.floor(this.height/2),h=this.height-c;let m=0,y=t?0:this.height-c;m=0,this.drawTo(m,y,l,c,this.tlCam,n),m=l,this.drawTo(m,y,l,c,this.trCam,r),y=t?h:0,m=0,this.scene.overrideMaterial=i,this.drawTo(m,y,l,c,this.blCam,i),m=l,this.drawTo(m,y,l,c,this.brCam,o)});this.props.three.addEventListener(Ci.ADD_RENDERER,this.setupRenderer),this.scene=new XA,this.scene.name=this.scene.uuid="",this.canvasRef=On.createRef(),this.containerRef=On.createRef(),this.tlWindow=On.createRef(),this.trWindow=On.createRef(),this.blWindow=On.createRef(),this.brWindow=On.createRef();const n=t.three.name,r=localStorage,i=r.getItem(`${n}_mode`);this.state={mode:i!==null?i:"Single",modeOpen:!1,renderModeOpen:!1,interactionMode:"Orbit",interactionModeOpen:!1,lastUpdate:Date.now()},r.setItem(`${n}_mode`,this.state.mode),r.setItem(`${n}_tlCam`,r.getItem(`${n}_tlCam`)!==null?r.getItem(`${n}_tlCam`):"Debug"),r.setItem(`${n}_trCam`,r.getItem(`${n}_trCam`)!==null?r.getItem(`${n}_trCam`):"Orthographic"),r.setItem(`${n}_blCam`,r.getItem(`${n}_blCam`)!==null?r.getItem(`${n}_blCam`):"Front"),r.setItem(`${n}_brCam`,r.getItem(`${n}_brCam`)!==null?r.getItem(`${n}_brCam`):"Top"),r.setItem(`${n}_tlRender`,r.getItem(`${n}_tlRender`)!==null?r.getItem(`${n}_tlRender`):"Renderer"),r.setItem(`${n}_trRender`,r.getItem(`${n}_trRender`)!==null?r.getItem(`${n}_trRender`):"Renderer"),r.setItem(`${n}_blRender`,r.getItem(`${n}_blRender`)!==null?r.getItem(`${n}_blRender`):"Renderer"),r.setItem(`${n}_brRender`,r.getItem(`${n}_brRender`)!==null?r.getItem(`${n}_brRender`):"Renderer");const o={Vector2:Ln,Vector3:be,Vector4:zr,Quaternion:vs,Matrix4:Pn,Spherical:LY,Box3:i9,Sphere:xm,Raycaster:AA};ug.install({THREE:o}),this.setupScene(),this.setupTools();const l=localStorage.getItem(this.expandedCameraVisibility);l!==null&&(this.cameraVisibility=l==="open"),this.saveExpandedCameraVisibility();const c=localStorage.getItem(this.expandedLightVisibility);c!==null&&(this.lightVisibility=c==="open"),this.saveExpandedLightVisibility();const h=localStorage.getItem(this.expandedGridVisibility);h!==null&&(this.gridVisibility=h==="open"),this.grid&&(this.grid.visible=this.gridVisibility),this.saveExpandedGridVisibility(),jF.instance=this}componentDidMount(){this.enable(),this.assignControls(),this.resize(),this.play(),fh.instance.setApp(this.props.three),fh.instance.activeCamera=this.debugCamera,this.props.three.requestRenderer()}componentDidUpdate(t,n,r){n.mode!==this.state.mode&&(this.assignControls(),this.resize())}componentWillUnmount(){this.disable(),this.clear(),u5.removeEditorGroup("View Settings")}render(){const t=[];return this.cameras.forEach((n,r)=>{t.push(r)}),ot.jsxs("div",{className:"multiview",children:[ot.jsx("canvas",{ref:this.canvasRef}),ot.jsxs("div",{className:`cameras ${this.state.mode==="Single"||this.state.mode==="Stacked"?"single":""}`,ref:this.containerRef,children:[this.state.mode==="Single"&&ot.jsx(ot.Fragment,{children:ot.jsx(E6,{name:"tl",camera:this.tlCam,options:t,ref:this.tlWindow,onSelectCamera:n=>{var i;(i=this.controls.get(this.tlCam.name))==null||i.dispose();const r=this.cameras.get(n);r!==void 0&&(this.clearCamera(this.tlCam),this.tlCam=r,localStorage.setItem(`${this.appID}_tlCam`,r.name),this.createControls(r,this.tlWindow.current))},onSelectRenderMode:n=>{this.tlRender=n,localStorage.setItem(`${this.appID}_tlRender`,n)}})}),(this.state.mode==="Side by Side"||this.state.mode==="Stacked")&&ot.jsxs(ot.Fragment,{children:[ot.jsx(E6,{name:"tl",camera:this.tlCam,options:t,ref:this.tlWindow,onSelectCamera:n=>{var i;(i=this.controls.get(this.tlCam.name))==null||i.dispose();const r=this.cameras.get(n);r!==void 0&&(this.clearCamera(this.tlCam),this.tlCam=r,localStorage.setItem(`${this.appID}_tlCam`,r.name),this.createControls(r,this.tlWindow.current))},onSelectRenderMode:n=>{this.tlRender=n,localStorage.setItem(`${this.appID}_tlRender`,n)}}),ot.jsx(E6,{name:"tr",camera:this.trCam,options:t,ref:this.trWindow,onSelectCamera:n=>{var i;(i=this.controls.get(this.trCam.name))==null||i.dispose();const r=this.cameras.get(n);r!==void 0&&(this.clearCamera(this.trCam),this.trCam=r,localStorage.setItem(`${this.appID}_trCam`,r.name),this.createControls(r,this.trWindow.current))},onSelectRenderMode:n=>{this.trRender=n,localStorage.setItem(`${this.appID}_trRender`,n)}})]}),this.state.mode==="Quad"&&ot.jsxs(ot.Fragment,{children:[ot.jsx(E6,{name:"tl",camera:this.tlCam,options:t,ref:this.tlWindow,onSelectCamera:n=>{var i;(i=this.controls.get(this.tlCam.name))==null||i.dispose();const r=this.cameras.get(n);r!==void 0&&(this.clearCamera(this.tlCam),this.tlCam=r,localStorage.setItem(`${this.appID}_tlCam`,r.name),this.createControls(r,this.tlWindow.current))},onSelectRenderMode:n=>{this.tlRender=n,localStorage.setItem(`${this.appID}_tlRender`,n)}}),ot.jsx(E6,{name:"tr",camera:this.trCam,options:t,ref:this.trWindow,onSelectCamera:n=>{var i;(i=this.controls.get(this.trCam.name))==null||i.dispose();const r=this.cameras.get(n);r!==void 0&&(this.clearCamera(this.trCam),this.trCam=r,localStorage.setItem(`${this.appID}_trCam`,r.name),this.createControls(r,this.trWindow.current))},onSelectRenderMode:n=>{this.trRender=n,localStorage.setItem(`${this.appID}_trRender`,n)}}),ot.jsx(E6,{name:"bl",camera:this.blCam,options:t,ref:this.blWindow,onSelectCamera:n=>{var i;(i=this.controls.get(this.blCam.name))==null||i.dispose();const r=this.cameras.get(n);r!==void 0&&(this.clearCamera(this.blCam),this.blCam=r,localStorage.setItem(`${this.appID}_blCam`,r.name),this.createControls(r,this.blWindow.current))},onSelectRenderMode:n=>{this.blRender=n,localStorage.setItem(`${this.appID}_blRender`,n)}}),ot.jsx(E6,{name:"br",camera:this.brCam,options:t,ref:this.brWindow,onSelectCamera:n=>{var i;(i=this.controls.get(this.brCam.name))==null||i.dispose();const r=this.cameras.get(n);r!==void 0&&(this.clearCamera(this.brCam),this.brCam=r,localStorage.setItem(`${this.appID}_brCam`,r.name),this.createControls(r,this.brWindow.current))},onSelectRenderMode:n=>{this.brRender=n,localStorage.setItem(`${this.appID}_brRender`,n)}})]})]}),ot.jsxs("div",{className:"settings",children:[ot.jsx(OF,{title:"View",index:x_e.indexOf(this.state.mode),options:x_e,onSelect:n=>{n!==this.state.mode&&(this.killControls(),this.setState({mode:n}),localStorage.setItem(`${this.appID}_mode`,n))},open:this.state.modeOpen,onToggle:n=>{this.setState({modeOpen:n,renderModeOpen:!1,interactionModeOpen:!1})}}),ot.jsx(OF,{title:"Interact",index:this.state.interactionMode==="Orbit"?0:1,options:["Orbit Mode","Selection Mode"],onSelect:n=>{this.interactionHelper.visible=n==="Selection Mode",this.setState({interactionMode:this.interactionHelper.visible?"Selection":"Orbit"})},open:this.state.interactionModeOpen,onToggle:n=>{this.setState({modeOpen:!1,renderModeOpen:!1,interactionModeOpen:n})}}),ot.jsx(DX,{name:"cameraHelper",icon:cht,selected:this.cameraVisibility,height:24,top:2,onClick:n=>{if(this.cameraVisibility=n,this.saveExpandedCameraVisibility(),this.cameraHelpers.forEach(r=>{r.visible=n}),this.selectedItem!==void 0&&!n){const r=this.cameraHelpers.get(this.selectedItem.name);r!==void 0&&(r.visible=!0)}}}),ot.jsx(DX,{name:"lightHelper",icon:uht,selected:this.lightVisibility,height:24,top:4,onClick:n=>{if(this.lightVisibility=n,this.saveExpandedLightVisibility(),this.lightHelpers.forEach(r=>{r.visible=n}),this.selectedItem!==void 0&&!n&&this.selectedItem.isLight===!0){const r=this.lightHelpers.get(this.selectedItem.name);r!==void 0&&(r.visible=!0)}}}),ot.jsx(DX,{name:"gridHelper",icon:dht,selected:this.gridVisibility,height:21,width:21,onClick:n=>{this.setGridVisibility(n)}})]},this.state.lastUpdate)]})}setupScene(){this.helpersContainer.name="helpers",this.scene.add(this.helpersContainer),this.interactionHelper.name="interactionHelper",this.interactionHelper.visible=!1,this.helpersContainer.add(this.interactionHelper);const t=(o,l)=>{const c=new J3(-100,100,100,-100,0,3e3);return c.name=o,c.position.copy(l),c.lookAt(0,0,0),this.cameras.set(o,c),c},n=1e3;t("Top",new be(0,n,0)),t("Bottom",new be(0,-n,0)),t("Left",new be(-n,0,0)),t("Right",new be(n,0,0)),t("Front",new be(0,0,n)),t("Back",new be(0,0,-n)),t("Orthographic",new be(n,n,n)),t("UI",new be),this.debugCamera=new Va(60,1,.01,3e3),this.debugCamera.name="Debug",this.debugCamera.position.set(300,300,300),this.debugCamera.lookAt(0,0,0),this.cameras.set("Debug",this.debugCamera),this.currentCamera=this.debugCamera;const r=localStorage,i=this.props.three.name;this.tlCam=this.cameras.get(r.getItem(`${i}_tlCam`)),this.trCam=this.cameras.get(r.getItem(`${i}_trCam`)),this.blCam=this.cameras.get(r.getItem(`${i}_blCam`)),this.brCam=this.cameras.get(r.getItem(`${i}_brCam`)),this.tlCam===void 0&&(this.tlCam=this.cameras.get("Debug")),this.trCam===void 0&&(this.trCam=this.cameras.get("Orthographic")),this.blCam===void 0&&(this.blCam=this.cameras.get("Front")),this.brCam===void 0&&(this.brCam=this.cameras.get("Top")),u5.addEditorGroup({title:"Editor",items:[{type:"button",prop:"Hide All Transforms"},{type:"button",prop:"Resize"}],onUpdate:(o,l)=>{switch(o){case"Hide All Transforms":fh.instance.hide();break;case"Resize":this.resize();break}},subgroups:[{title:"Debug Camera",items:[{type:"range",prop:"Near",step:1e-4,min:.001,max:1e3,value:this.debugCamera.near},{type:"range",prop:"Far",step:.001,min:.001,max:1e4,value:this.debugCamera.far}],onUpdate:(o,l)=>{switch(o){case"Near":this.debugCamera.near=l,this.debugCamera.updateProjectionMatrix();break;case"Far":this.debugCamera.far=l,this.debugCamera.updateProjectionMatrix();break}}},{title:"Grid",items:[{type:"number",prop:"Position",value:0},{type:"color",prop:"Color",value:"#FFFFFF"},{type:"range",prop:"Grid Opacity",value:.25,min:0,max:1,step:.01},{type:"range",prop:"Subgrid Opacity",value:.15,min:0,max:1,step:.01}],onUpdate:(o,l)=>{switch(o){case"Position":this.grid&&(this.grid.position.y=l);break;case"Color":this.grid&&this.grid.color.setStyle(l);break;case"Grid Opacity":this.grid&&(this.grid.gridOpacity=l);break;case"Subgrid Opacity":this.grid&&(this.grid.subgridOpacity=l);break}}}]})}setupTools(){this.splineEditor=new lht(this.currentCamera,this.three),this.splineEditor.initDebug(),this.helpersContainer.add(this.splineEditor)}play(){this.playing=!0,this.onUpdate()}pause(){this.playing=!1,cancelAnimationFrame(this.rafID),this.rafID=-1}toggleOrbitControls(t){this.controls.forEach(n=>{n.enabled=!t})}clear(){this.three.dispatchEvent({type:Ci.CLEAR_OBJECT}),u5.removeAllGroups(),this.clearLightHelpers(),this.clearControls(),this.currentTransform!==void 0&&(this.currentTransform.removeEventListener("objectChange",this.onUpdateTransform),fh.instance.remove(this.currentTransform.getHelper().name)),this.currentTransform=void 0,fh.instance.clear(),this.cameras.forEach(t=>{this.editorCameras.indexOf(t.name)<0&&this.three.dispatchEvent({type:Ci.REMOVE_CAMERA,value:t})}),this.currentCamera=this.debugCamera,this.currentScene=void 0,this.scenes.forEach(t=>{this.three.dispatchEvent({type:Ci.REMOVE_SCENE,value:t})}),this.scenes.clear()}setGridVisibility(t){this.gridVisibility=t,this.saveExpandedGridVisibility(),this.grid&&(this.grid.visible=t)}update(){var t;this.renderer&&this.rendererReady&&((t=this.renderer)==null||t.clear()),this.controls.forEach(n=>n.update()),this.cameraHelpers.forEach(n=>n.update()),this.lightHelpers.forEach(n=>{n.update!==void 0&&n.update()}),this.props.onSceneUpdate!==void 0&&this.currentScene!==void 0&&this.props.onSceneUpdate(this.currentScene)}draw(){var t;if(this.rendererReady)switch(this.renderer&&((t=this.renderer)==null||t.clear()),this.state.mode){case"Single":this.drawSingle();break;case"Side by Side":case"Stacked":this.drawDouble();break;case"Quad":this.drawQuad();break}}enable(){const t=this.containerRef.current;t.addEventListener("mousemove",this.onMouseMove),t.addEventListener("click",this.onClick),window.addEventListener("keydown",this.onKey),window.addEventListener("resize",this.resize),this.three.addEventListener(Ci.ADD_SCENE,this.addScene),this.three.addEventListener(Ci.SET_SCENE,this.sceneUpdate),this.three.addEventListener(Ci.REMOVE_SCENE,this.removeScene),this.three.addEventListener(Ci.ADD_CAMERA,this.addCamera),this.three.addEventListener(Ci.REMOVE_CAMERA,this.removeCamera),this.three.addEventListener(Ci.SET_OBJECT,this.onSetSelectedItem)}disable(){const t=this.containerRef.current;t.removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("click",this.onClick),window.removeEventListener("keydown",this.onKey),window.removeEventListener("resize",this.resize),this.three.removeEventListener(Ci.ADD_SCENE,this.addScene),this.three.removeEventListener(Ci.SET_SCENE,this.sceneUpdate),this.three.removeEventListener(Ci.ADD_CAMERA,this.addCamera),this.three.removeEventListener(Ci.REMOVE_CAMERA,this.removeCamera),this.three.removeEventListener(Ci.SET_OBJECT,this.onSetSelectedItem)}updateSelectedItemHelper(t){if(this.selectedItem!==void 0)if(this.cameraVisibility){if(this.selectedItem.isLight===!0&&!this.lightVisibility){const n=this.lightHelpers.get(this.selectedItem.name);n!==void 0&&(n.visible=t)}}else{const n=this.cameraHelpers.get(this.selectedItem.name);n!==void 0&&(n.visible=t)}}createControls(t,n){const r=this.controls.get(t.name);if(r!==void 0&&r.dispose(),this.controls.delete(t.name),t.name==="UI")return;const i=new ECe(t,n);switch(i.enableDamping=!0,i.dampingFactor=.1,t.name){case"Top":case"Bottom":case"Left":case"Right":case"Front":case"Back":i.enableRotate=!1;break}this.controls.set(t.name,i)}clearCamera(t){const n=this.cameraHelpers.get(t.name);n!==void 0&&(this.helpersContainer.remove(n),n.dispose(),this.cameraHelpers.delete(t.name));const r=this.controls.get(t.name);r!==void 0&&(r.dispose(),this.controls.delete(t.name))}killControls(){this.controls.forEach((t,n)=>{t.dispose();const r=this.cameraHelpers.get(n);r!==void 0&&(this.helpersContainer.remove(r),r.dispose()),this.cameraHelpers.delete(n),this.controls.delete(n)}),this.controls.clear(),this.cameraHelpers.clear()}assignControls(){switch(this.state.mode){case"Single":this.createControls(this.tlCam,this.tlWindow.current);break;case"Side by Side":case"Stacked":this.createControls(this.tlCam,this.tlWindow.current),this.createControls(this.trCam,this.trWindow.current);break;case"Quad":this.createControls(this.tlCam,this.tlWindow.current),this.createControls(this.trCam,this.trWindow.current),this.createControls(this.blCam,this.blWindow.current),this.createControls(this.brCam,this.brWindow.current);break}}saveExpandedCameraVisibility(){localStorage.setItem(this.expandedCameraVisibility,this.cameraVisibility?"open":"closed")}saveExpandedLightVisibility(){localStorage.setItem(this.expandedLightVisibility,this.lightVisibility?"open":"closed")}saveExpandedGridVisibility(){localStorage.setItem(this.expandedGridVisibility,this.gridVisibility?"open":"closed")}getSceneOverride(t){switch(t){case"Depth":return this.depthMaterial;case"Normals":return this.normalsMaterial;case"Renderer":return null;case"UVs":return this.uvMaterial;case"Wireframe":return this.wireframeMaterial}return null}drawTo(t,n,r,i,o,l){var c,h,m;switch(o.name){case"Left":case"Right":this.grid&&(this.grid.rotation.z=Math.PI/2);break;case"Front":case"Back":this.grid&&(this.grid.rotation.x=Math.PI/2);break}this.scene.overrideMaterial=l,this.renderer&&((c=this.renderer)==null||c.setScissor(t,n,r,i),(h=this.renderer)==null||h.setViewport(t,n,r,i),(m=this.renderer)==null||m.render(this.scene,o)),this.grid&&this.grid.rotation.set(0,0,0)}drawSingle(){const t=this.getSceneOverride(this.tlRender);this.drawTo(0,0,this.width,this.height,this.tlCam,t)}get appID(){return this.props.three.name}get mode(){return this.state.mode}get three(){return this.props.three}get expandedCameraVisibility(){return`${this.appID}_multiviewCameraVisibility`}get expandedLightVisibility(){return`${this.appID}_multiviewLightVisibility`}get expandedGridVisibility(){return`${this.appID}_multiviewGridVisibility`}};qe(jF,"instance",null);let nl=jF;function aNe(s){if(s.child===void 0)return console.log("Hermes - No child attached"),null;const e=On.useRef(null),[t,n]=On.useState(!1),r=s.child.children.length>0,i=[];return s.child.children.length>0&&s.child.children.map((o,l)=>{i.push(ot.jsx(aNe,{child:o,three:s.three},l))}),On.useEffect(()=>{if(s.child){const o=s.child.uuid.split(".")[0],l=s.three.getScene(o);if(l!==null)try{const c=l.getObjectByProperty("uuid",s.child.uuid);c!==void 0?e.current.style.opacity=c.visible?"1":"0.25":console.log(`Hermes - Can't find child: ${s.child.uuid}`)}catch(c){console.log("Error looking for child:",c),console.log(s.child),console.log(s.three.scenes),console.log(l)}else console.log(`Hermes (ChildObject) - Can't find Scene: ${o} with child UUID: ${s.child.uuid}`,s.three.scenes,s.three.scene,l)}},[t]),ot.jsxs("div",{className:"childObject",children:[ot.jsxs("div",{className:"child",children:[r?ot.jsx("button",{className:"status",style:{backgroundPositionX:t?"-14px":"2px"},onClick:()=>{n(!t)}}):null,ot.jsx("button",{className:"name",style:{left:r?"20px":"5px"},onClick:()=>{s.child!==void 0?(s.three.getObject(s.child.uuid),!t&&r&&n(!0)):console.log("Hermes - No child attached...")},children:s.child.name.length>0?`${s.child.name} (${s.child.type})`:`${s.child.type}::${s.child.uuid}`}),ot.jsx("button",{className:"visibility",ref:e,onClick:()=>{if(s.child){const o=s.three.getScene(s.child.uuid);if(o!==null){const l=o.getObjectByProperty("uuid",s.child.uuid);if(l!==void 0){const c="visible",h=!l.visible;e.current.style.opacity=h?"1":"0.25",s.three.updateObject(s.child.uuid,c,h),za(l,c,h)}else console.log(`Hermes - Couldn't find object: ${s.child.uuid}`,o)}else console.log(`Hermes - Couldn't find object in scene: ${s.child.uuid}, ${s.child.name}`)}}}),ot.jsx("div",{className:`icon ${eot(s.child)}`})]}),ot.jsx("div",{className:t?"open":"",children:ot.jsx("div",{className:"container",children:i})})]},Math.random())}function fY(s){var t;const e=[];return(t=s.child)==null||t.children.map((n,r)=>{e.push(ot.jsx(aNe,{child:n,scene:s.scene,three:s.three},r))}),ot.jsx("div",{className:`scene ${s.class!==void 0?s.class:""}`,children:e})}function b_e(s){switch(s){case"fov":return"FOV";case"zoom":return"Zoom";case"near":return"Near";case"far":return"Far";case"focus":return"Focus";case"aspect":return"Aspect";case"filmGauge":return"Film Gauge";case"filmOffset":return"Film Offset";case"left":return"Left";case"right":return"Right";case"top":return"Top";case"bottom":return"Bottom"}return s}function hht(s,e){function t(){return`${e.name}_camera`}const n=localStorage.getItem(t()),r=n!==null?n==="open":!1;function i(l){localStorage.setItem(t(),l?"open":"closed")}const o=[];if(s.perspectiveCameraInfo!==void 0)for(const l in s.perspectiveCameraInfo)o.push({title:b_e(l),prop:l,type:"number",step:.01,value:s.perspectiveCameraInfo[l],onChange:(c,h)=>{e.updateObject(s.uuid,c,h),e.requestMethod(s.uuid,"updateProjectionMatrix");const m=e.getScene(s.uuid);if(m!==null){const y=m.getObjectByProperty("uuid",s.uuid);y!==void 0&&(za(y,c,h),y.updateProjectionMatrix())}}});else if(s.orthographicCameraInfo!==void 0)for(const l in s.orthographicCameraInfo)o.push({title:b_e(l),prop:l,type:"number",step:.01,value:s.orthographicCameraInfo[l],onChange:(c,h)=>{e.updateObject(s.uuid,c,h),e.requestMethod(s.uuid,"updateProjectionMatrix");const m=e.getScene(s.uuid);if(m!==null){const y=m.getObjectByProperty("uuid",s.uuid);y!==void 0&&(za(y,c,h),y.updateProjectionMatrix())}}});return ot.jsx(Ip,{three:e,title:"Camera",items:o,expanded:r,onToggle:l=>{i(l)}})}function __e(s){switch(s){case"color":return"Color";case"intensity":return"Intensity";case"decay":return"Decay";case"distance":return"Distance";case"angle":return"Angle";case"penumbra":return"Penumbra";case"groundColor":return"Ground Color";case"width":return"Width";case"height":return"Height"}return s}function pht(s,e){function t(){return`${e.name}_light`}const n=localStorage.getItem(t()),r=n!==null?n==="open":!1;function i(l){localStorage.setItem(t(),l?"open":"closed")}const o=[];if(s.lightInfo!==void 0)for(const l in s.lightInfo){const c=s.lightInfo[l];c!==void 0&&(c.isColor!==void 0?o.push({title:__e(l),prop:l,type:"color",value:c,onChange:(h,m)=>{const y=new Tn(m);e.updateObject(s.uuid,h,y);const b=e.getScene(s.uuid);if(b!==null){const w=b.getObjectByProperty("uuid",s.uuid);za(w,h,y)}}}):o.push({title:__e(l),prop:l,type:typeof c,value:c,step:typeof c=="number"?.01:void 0,onChange:(h,m)=>{e.updateObject(s.uuid,h,m);const y=e.getScene(s.uuid);if(y!==null){const b=y.getObjectByProperty("uuid",s.uuid);za(b,h,m)}}}))}return ot.jsx(Ip,{three:e,title:"Light",items:o,expanded:r,onToggle:l=>{i(l)}})}function fht(s){var b;const e=s.object,t=s.three;function n(){return`${t.name}_animation`}const r=localStorage.getItem(n()),i=r!==null?r==="open":!1;function o(w){localStorage.setItem(n(),w?"open":"closed")}const l=[],c=[];let h=0;e.animations.forEach(w=>{h=Math.max(h,w.duration),w.duration>0&&c.push({title:w.name,items:[{title:"Duration",type:"number",value:w.duration,disabled:!0},{title:"Blend Mode",type:"option",disabled:!0,options:[{title:"Normal",value:2500},{title:"Additive",value:2501}]}]})}),l.push({title:"Animations",items:c});let m;const y=t.getScene(e.uuid);if(y!==null){const w=y.getObjectByProperty("uuid",e.uuid);if(w!==void 0){const A=w.mixer;if(A!==void 0){const D=[{title:"Time Scale",type:"range",value:A.timeScale,step:.01,min:-1,max:2,onChange:(P,U)=>{A.timeScale=U,t.updateObject(e.uuid,"mixer.timeScale",U)}}];D.push({title:"Stop All",type:"button",onChange:()=>{A.stopAllAction(),t.requestMethod(e.uuid,"stopAllAction",void 0,"mixer")}}),l.push({title:"Mixer",items:D}),m=new Eje(w),(b=nl.instance)==null||b.scene.add(m)}}}return On.useEffect(()=>()=>{m!==void 0&&Rp(m)},[]),ot.jsx(Ip,{three:s.three,title:"Animation",items:l,expanded:i,onToggle:w=>{o(w)}})}const mY={name:"",uuid:"",type:"",visible:!1,matrix:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],animations:[],material:void 0,perspectiveCameraInfo:void 0,orthographicCameraInfo:void 0,lightInfo:void 0,children:[]};function mht(s){const[e,t]=On.useState(mY);On.useEffect(()=>{function o(c){t(c.value)}function l(){t(mY)}return s.three.addEventListener(Ci.CLEAR_OBJECT,l),s.three.addEventListener(Ci.SET_SCENE,l),s.three.addEventListener(Ci.SET_OBJECT,o),()=>{s.three.removeEventListener(Ci.CLEAR_OBJECT,l),s.three.removeEventListener(Ci.SET_SCENE,l),s.three.removeEventListener(Ci.SET_OBJECT,o)}},[]);const n=e.type.toLowerCase(),r=e.animations.length>0||e.mixer!==void 0,i=n.search("mesh")>-1||n.search("line")>-1||n.search("points")>-1;return ot.jsx(QC,{three:s.three,label:"Inspector",button:e.uuid.length>0?ot.jsx("button",{className:"remove",onClick:()=>{fh.instance.remove(e.name),t(mY)}}):void 0,children:ot.jsx("div",{id:"Inspector",className:s.class,children:e.uuid.length>0&&ot.jsxs(ot.Fragment,{children:[ot.jsxs(ot.Fragment,{children:[ot.jsx(nF,{type:"string",title:"Name",prop:"name",value:e.name,disabled:!0}),ot.jsx(nF,{type:"string",title:"Type",prop:"type",value:e.type,disabled:!0}),ot.jsx(nF,{type:"string",title:"UUID",prop:"uuid",value:e.uuid,disabled:!0})]}),ot.jsxs(ot.Fragment,{children:[ot.jsx(FF,{object:e,three:s.three}),r?ot.jsx(fht,{object:e,three:s.three}):null,n.search("camera")>-1?hht(e,s.three):null,n.search("light")>-1?pht(e,s.three):null,i?Gat(e,s.three):null]})]})})},"Inspector")}class ght extends On.Component{constructor(t){super(t);qe(this,"autoClear",!0);qe(this,"autoClearColor",!0);qe(this,"autoClearDepth",!0);qe(this,"autoClearStencil",!0);qe(this,"outputColorSpace",Is);qe(this,"localClippingEnabled",!1);qe(this,"clearColor",new Tn(0));qe(this,"clearAlpha",1);qe(this,"toneMapping",Ta);qe(this,"toneMappingExposure",1);qe(this,"type","");qe(this,"onAddRenderer",t=>{const n=t.value;if(this.autoClear=n.autoClear,this.autoClearColor=n.autoClearColor,this.autoClearDepth=n.autoClearDepth,this.autoClearStencil=n.autoClearStencil,this.outputColorSpace=n.outputColorSpace,this.localClippingEnabled=n.localClippingEnabled,this.clearAlpha=n.clearAlpha,this.type=n.type,this.toneMapping=n.toneMapping,this.toneMappingExposure=n.toneMappingExposure,this.clearColor.setStyle(n.clearColor,vd),Zn.enabled=n.colorManagement,nl.instance){const r=nl.instance.renderer;r&&(r.autoClearColor=this.autoClearColor,r.outputColorSpace=this.outputColorSpace,r instanceof VC&&(r.localClippingEnabled=this.localClippingEnabled),r.toneMapping=this.toneMapping,r.toneMappingExposure=this.toneMappingExposure,r.setClearColor(n.clearColor,this.clearAlpha))}this.setState({lastUpdated:Date.now()})});const n=localStorage.getItem(this.expandedName),r=n!==null?n==="open":!1;if(this.state={expanded:r,lastUpdated:Date.now()},this.saveExpanded(r),nl.instance){const i=nl.instance.renderer;i&&(this.autoClear=i.autoClear,this.autoClearColor=i.autoClearColor,this.autoClearDepth=i.autoClearDepth,this.autoClearStencil=i.autoClearStencil,this.clearAlpha=i.getClearAlpha(),this.toneMapping=i.toneMapping,this.toneMappingExposure=i.toneMappingExposure,i instanceof VC&&(this.localClippingEnabled=i.localClippingEnabled,i.getClearColor(this.clearColor)))}this.props.three.addEventListener(Ci.ADD_RENDERER,this.onAddRenderer)}componentwillunmount(){this.props.three.removeEventListener(Ci.ADD_RENDERER,this.onAddRenderer)}render(){const t=()=>{if(nl.instance){const n=nl.instance.renderer;n&&(n.autoClearColor=this.autoClearColor,n.outputColorSpace=this.outputColorSpace,n instanceof VC&&(n.localClippingEnabled=this.localClippingEnabled),n.toneMapping=this.toneMapping,n.toneMappingExposure=this.toneMappingExposure,n.setClearColor(this.clearColor.getStyle(),this.clearAlpha),this.props.three.updateRenderer({autoClear:this.autoClear,autoClearColor:this.autoClearColor,autoClearDepth:this.autoClearDepth,autoClearStencil:this.autoClearStencil,outputColorSpace:this.outputColorSpace,localClippingEnabled:this.localClippingEnabled,clearAlpha:this.clearAlpha,clearColor:this.clearColor.getStyle(),colorManagement:Zn.enabled,toneMapping:this.toneMapping,toneMappingExposure:this.toneMappingExposure}))}};return ot.jsx(Ip,{three:this.props.three,title:"Renderer",expanded:this.state.expanded,items:[{type:"boolean",title:"Auto Clear",value:this.autoClear,onChange:(n,r)=>{this.autoClear=r}},{type:"boolean",title:"Auto Clear Color",value:this.autoClearColor,onChange:(n,r)=>{this.autoClearColor=r,t()}},{type:"boolean",title:"Auto Clear Depth",value:this.autoClearDepth,onChange:(n,r)=>{this.autoClearDepth=r,t()}},{type:"boolean",title:"Auto Clear Stencil",value:this.autoClearStencil,onChange:(n,r)=>{this.autoClearStencil=r,t()}},{type:"boolean",title:"Local Clipping",value:this.localClippingEnabled,onChange:(n,r)=>{this.localClippingEnabled=r,t()}},{type:"color",title:"Clear Color",value:`#${this.clearColor.getHexString()}`,onChange:(n,r)=>{this.clearColor.setStyle(r),t()}},{type:"range",title:"Clear Alpha",min:0,max:1,step:.01,value:this.clearAlpha,onChange:(n,r)=>{this.clearAlpha=r,t()}},{type:"boolean",title:"Color Management",value:Zn.enabled,onChange:(n,r)=>{Zn.enabled=r,t()}},{type:"option",title:"Color Space",value:this.outputColorSpace,options:[{title:"No Color Space",value:gu},{title:"SRB Color Space",value:Is},{title:"Linear SRB Color Space",value:vd}],onChange:(n,r)=>{this.outputColorSpace=r,t()}},{type:"option",title:"Tone Mapping",value:this.toneMapping,options:[{title:"None ",value:Ta},{title:"Linear ",value:qF},{title:"Reinhard",value:XF},{title:"Cineon ",value:YF},{title:"ACES Filmic",value:KF},{title:"AgX",value:ZF},{title:"Neutral",value:QF},{title:"Custom",value:FK}],onChange:(n,r)=>{this.toneMapping=r,t()}},{type:"range",title:"Tone Mapping Exposure",value:this.toneMappingExposure,min:0,max:2,step:.01,onChange:(n,r)=>{this.toneMappingExposure=r,t()}},{type:"string",title:"Type",value:this.type,disabled:!0},{type:"button",title:"Resize Scenes from Source",onChange:()=>{this.props.three.requestSize()}}],onToggle:n=>{this.setState({expanded:n}),this.saveExpanded(n)}},Math.random())}saveExpanded(t){localStorage.setItem(this.expandedName,t?"open":"closed")}get expandedName(){return`${this.props.three.name}_renderer`}}function yht(s){const[e]=On.useState([]),[t]=On.useState([]),[n,r]=On.useState(0),i=h=>{const m=h.value;e.push(m),t.push(ot.jsx(QC,{three:s.three,label:`Scene: ${m.name}`,scene:m,open:!1,visible:!1,onRefresh:()=>{s.three.refreshScene(m.name)},children:ot.jsx(fY,{child:m,scene:m,three:s.three})},m.name)),r(Date.now())},o=h=>{const m=h.value;for(let y=0;y<e.length;y++)if(m.uuid===e[y].uuid){e[y]=m,t[y]=ot.jsx(QC,{three:s.three,label:`Scene: ${m.name}`,scene:m,open:t[y].props.open,visible:t[y].props.visible,onRefresh:()=>{s.three.refreshScene(m.name)},children:ot.jsx(fY,{child:m,scene:m,three:s.three})},m.name),r(Date.now());return}},l=h=>{const m=h.value;for(let y=0;y<e.length;y++)if(m.uuid===e[y].uuid){e.splice(y,1),t.splice(y,1),r(Date.now());return}},c=h=>{const m=h.value.name;for(let y=0;y<e.length;y++){const b=e[y],w=b.name===m;t[y]=ot.jsx(QC,{three:s.three,label:`Scene: ${b.name}`,scene:b,open:w,visible:w,onRefresh:()=>{s.three.refreshScene(b.name)},children:ot.jsx(fY,{child:b,scene:b,three:s.three})},b.name)}r(Date.now())};return On.useEffect(()=>(s.three.addEventListener(Ci.ADD_SCENE,i),s.three.addEventListener(Ci.SET_SCENE,c),s.three.addEventListener(Ci.REFRESH_SCENE,o),s.three.addEventListener(Ci.REMOVE_SCENE,l),()=>{s.three.removeEventListener(Ci.ADD_SCENE,i),s.three.removeEventListener(Ci.SET_SCENE,c),s.three.removeEventListener(Ci.REFRESH_SCENE,o),s.three.removeEventListener(Ci.REMOVE_SCENE,l)}),[]),ot.jsxs("div",{id:"SidePanel",children:[ot.jsx("div",{className:"scenes",children:t},n),ot.jsx(mht,{three:s.three}),ot.jsx(ght,{three:s.three}),ot.jsx(u5,{three:s.three})]})}function vht(s){return ot.jsx(aot,{children:ot.jsxs(ot.Fragment,{children:[ot.jsx(nl,{three:s.three,scenes:s.scenes,onSceneAdd:s.onSceneAdd,onSceneResize:s.onSceneResize,onSceneUpdate:s.onSceneUpdate}),ot.jsx(yht,{three:s.three})]})})}async function xht(){var n;for(;!document.getElementById("theatrejs-studio-root");)await new Promise(r=>setTimeout(r,100));const s=document.getElementById("theatrejs-studio-root");if(s===null||s.shadowRoot===null)return;const e=s.shadowRoot.getElementById("pointer-root");if(e===null)return;const t=e.children[0];if(t!==null){try{const i=t.children[1].children[1];(n=i.parentElement)==null||n.removeChild(i)}catch{}try{const r=t.children[3];r.style.top="0",r.style.right="300px"}catch{}}}const bht=`varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,_ht=`struct Light {
  float intensity;
  vec3 position;
  vec3 color;
};

uniform float time;
uniform float opacity;
uniform vec2 resolution;
uniform vec3 diffuse;
uniform vec3 mouse;
uniform sampler2D map;
uniform Light light;
uniform Light lights[3];
varying vec2 vUv;

#define MIN_ALPHA 2.0 / 255.0

void main() {
  if (opacity < MIN_ALPHA) discard;
  vec2 imageUV = vUv * 10.0;
  vec3 image = texture2D(map, imageUV).rgb;
  vec3 col = image * diffuse;
  col += (sin(time * 0.1) * 0.5 + 0.5) * 0.2;
  col += vec3(resolution, 0.0);
  col += mouse;
  gl_FragColor = vec4(col, opacity);
}`,Sht="data:image/png;base64,R0lGODlhCAAIAIAAAP///wAAACH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDEgNzkuMTQ2Mjg5OTc3NywgMjAyMy8wNi8yNS0yMzo1NzoxNCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI1LjIgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NjVENjQyODM4QTYzMTFFRUJFQTBFOTJFNjA1OTQ5N0YiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NjVENjQyODQ4QTYzMTFFRUJFQTBFOTJFNjA1OTQ5N0YiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo2NUQ2NDI4MThBNjMxMUVFQkVBMEU5MkU2MDU5NDk3RiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo2NUQ2NDI4MjhBNjMxMUVFQkVBMEU5MkU2MDU5NDk3RiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACH5BAAAAAAALAAAAAAIAAgAAAIOjH8AprzRkHyspqSoNAUAOw==";class wht extends bh{constructor(){super({vertexShader:bht,fragmentShader:_ht,name:"ExampleScene/SimpleShader",transparent:!0,uniforms:{diffuse:{value:new Tn(16777215)},opacity:{value:1},time:{value:0},map:{value:null},resolution:{value:new Ln},mouse:{value:new be},v4:{value:new zr},euler:{value:new Sa},testM3:{value:new ci},testM4:{value:new Pn},light:{value:{position:new Ln(5,10),intensity:1,color:new Tn(16711935)}},lights:{value:[{position:new Ln(1,1),intensity:1,color:new Tn(16711680)},{position:new Ln(2,2),intensity:2,color:new Tn(65280)},{position:new Ln(3,3),intensity:3,color:new Tn(255)}]}}}),KQ(Sht).then(e=>{this.uniforms.map.value=e})}update(e){this.uniforms.opacity.value=this.opacity,this.uniforms.time.value+=e}}function Tht(s){const e=new Map,t=new Map,n=s.clone();return lNe(s,n,function(r,i){e.set(i,r),t.set(r,i)}),n.traverse(function(r){if(!r.isSkinnedMesh)return;const i=r,o=e.get(r),l=o.skeleton.bones;i.skeleton=o.skeleton.clone(),i.bindMatrix.copy(o.bindMatrix),i.skeleton.bones=l.map(function(c){return t.get(c)}),i.bind(i.skeleton,i.bindMatrix)}),n}function lNe(s,e,t){t(s,e);for(let n=0;n<s.children.length;n++)lNe(s.children[n],e.children[n],t)}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var Sp=Uint8Array,pS=Uint16Array,Eht=Int32Array,cNe=new Sp([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),uNe=new Sp([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Mht=new Sp([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dNe=function(s,e){for(var t=new pS(31),n=0;n<31;++n)t[n]=e+=1<<s[n-1];for(var r=new Eht(t[30]),n=1;n<30;++n)for(var i=t[n];i<t[n+1];++i)r[i]=i-t[n]<<5|n;return{b:t,r}},hNe=dNe(cNe,2),pNe=hNe.b,Cht=hNe.r;pNe[28]=258,Cht[258]=28;var Aht=dNe(uNe,0),Nht=Aht.b,AK=new pS(32768);for(var Po=0;Po<32768;++Po){var zy=(Po&43690)>>1|(Po&21845)<<1;zy=(zy&52428)>>2|(zy&13107)<<2,zy=(zy&61680)>>4|(zy&3855)<<4,AK[Po]=((zy&65280)>>8|(zy&255)<<8)>>1}var oA=function(s,e,t){for(var n=s.length,r=0,i=new pS(e);r<n;++r)s[r]&&++i[s[r]-1];var o=new pS(e);for(r=1;r<e;++r)o[r]=o[r-1]+i[r-1]<<1;var l;if(t){l=new pS(1<<e);var c=15-e;for(r=0;r<n;++r)if(s[r])for(var h=r<<4|s[r],m=e-s[r],y=o[s[r]-1]++<<m,b=y|(1<<m)-1;y<=b;++y)l[AK[y]>>c]=h}else for(l=new pS(n),r=0;r<n;++r)s[r]&&(l[r]=AK[o[s[r]-1]++]>>15-s[r]);return l},vN=new Sp(288);for(var Po=0;Po<144;++Po)vN[Po]=8;for(var Po=144;Po<256;++Po)vN[Po]=9;for(var Po=256;Po<280;++Po)vN[Po]=7;for(var Po=280;Po<288;++Po)vN[Po]=8;var fNe=new Sp(32);for(var Po=0;Po<32;++Po)fNe[Po]=5;var Pht=oA(vN,9,1),Rht=oA(fNe,5,1),gY=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},Qf=function(s,e,t){var n=e/8|0;return(s[n]|s[n+1]<<8)>>(e&7)&t},yY=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(e&7)},Iht=function(s){return(s+7)/8|0},kht=function(s,e,t){return(t==null||t>s.length)&&(t=s.length),new Sp(s.subarray(e,t))},Dht=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],nm=function(s,e,t){var n=new Error(e||Dht[s]);if(n.code=s,Error.captureStackTrace&&Error.captureStackTrace(n,nm),!t)throw n;return n},Oht=function(s,e,t,n){var r=s.length,i=0;if(!r||e.f&&!e.l)return t||new Sp(0);var o=!t,l=o||e.i!=2,c=e.i;o&&(t=new Sp(r*3));var h=function(or){var ns=t.length;if(or>ns){var Xr=new Sp(Math.max(ns*2,or));Xr.set(t),t=Xr}},m=e.f||0,y=e.p||0,b=e.b||0,w=e.l,A=e.d,I=e.m,D=e.n,P=r*8;do{if(!w){m=Qf(s,y,1);var U=Qf(s,y+1,3);if(y+=3,U)if(U==1)w=Pht,A=Rht,I=9,D=5;else if(U==2){var ie=Qf(s,y,31)+257,se=Qf(s,y+10,15)+4,z=ie+Qf(s,y+5,31)+1;y+=14;for(var re=new Sp(z),ye=new Sp(19),H=0;H<se;++H)ye[Mht[H]]=Qf(s,y+H*3,7);y+=se*3;for(var Me=gY(ye),Oe=(1<<Me)-1,Ue=oA(ye,Me,1),H=0;H<z;){var Ie=Ue[Qf(s,y,Oe)];y+=Ie&15;var j=Ie>>4;if(j<16)re[H++]=j;else{var ce=0,Ve=0;for(j==16?(Ve=3+Qf(s,y,3),y+=2,ce=re[H-1]):j==17?(Ve=3+Qf(s,y,7),y+=3):j==18&&(Ve=11+Qf(s,y,127),y+=7);Ve--;)re[H++]=ce}}var Pe=re.subarray(0,ie),We=re.subarray(ie);I=gY(Pe),D=gY(We),w=oA(Pe,I,1),A=oA(We,D,1)}else nm(1);else{var j=Iht(y)+4,C=s[j-4]|s[j-3]<<8,Z=j+C;if(Z>r){c&&nm(0);break}l&&h(b+C),t.set(s.subarray(j,Z),b),e.b=b+=C,e.p=y=Z*8,e.f=m;continue}if(y>P){c&&nm(0);break}}l&&h(b+131072);for(var pt=(1<<I)-1,Ne=(1<<D)-1,st=y;;st=y){var ce=w[yY(s,y)&pt],Pt=ce>>4;if(y+=ce&15,y>P){c&&nm(0);break}if(ce||nm(2),Pt<256)t[b++]=Pt;else if(Pt==256){st=y,w=null;break}else{var yn=Pt-254;if(Pt>264){var H=Pt-257,bn=cNe[H];yn=Qf(s,y,(1<<bn)-1)+pNe[H],y+=bn}var St=A[yY(s,y)&Ne],Ut=St>>4;St||nm(3),y+=St&15;var We=Nht[Ut];if(Ut>3){var bn=uNe[Ut];We+=yY(s,y)&(1<<bn)-1,y+=bn}if(y>P){c&&nm(0);break}l&&h(b+131072);var Wt=b+yn;if(b<We){var kn=i-We,Dn=Math.min(We,Wt);for(kn+b<0&&nm(3);b<Dn;++b)t[b]=n[kn+b]}for(;b<Wt;++b)t[b]=t[b-We]}}e.l=w,e.p=st,e.b=b,e.f=m,w&&(m=1,e.m=I,e.d=A,e.n=D)}while(!m);return b!=t.length&&o?kht(t,0,b):t.subarray(0,b)},Lht=new Sp(0),Fht=function(s,e){return((s[0]&15)!=8||s[0]>>4>7||(s[0]<<8|s[1])%31)&&nm(6,"invalid zlib data"),(s[1]>>5&1)==1&&nm(6,"invalid zlib data: "+(s[1]&32?"need":"unexpected")+" dictionary"),(s[1]>>3&4)+2};function Bht(s,e){return Oht(s.subarray(Fht(s),-4),{i:2},e,e)}var Uht=typeof TextDecoder<"u"&&new TextDecoder,zht=0;try{Uht.decode(Lht,{stream:!0}),zht=1}catch{}function mNe(s,e,t){const n=t.length-s-1;if(e>=t[n])return n-1;if(e<=t[s])return s;let r=s,i=n,o=Math.floor((r+i)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?i=o:r=o,o=Math.floor((r+i)/2);return o}function Vht(s,e,t,n){const r=[],i=[],o=[];r[0]=1;for(let l=1;l<=t;++l){i[l]=e-n[s+1-l],o[l]=n[s+l]-e;let c=0;for(let h=0;h<l;++h){const m=o[h+1],y=i[l-h],b=r[h]/(m+y);r[h]=c+m*b,c=y*b}r[l]=c}return r}function Ght(s,e,t,n){const r=mNe(s,n,e),i=Vht(r,n,s,e),o=new zr(0,0,0,0);for(let l=0;l<=s;++l){const c=t[r-s+l],h=i[l],m=c.w*h;o.x+=c.x*m,o.y+=c.y*m,o.z+=c.z*m,o.w+=c.w*h}return o}function jht(s,e,t,n,r){const i=[];for(let y=0;y<=t;++y)i[y]=0;const o=[];for(let y=0;y<=n;++y)o[y]=i.slice(0);const l=[];for(let y=0;y<=t;++y)l[y]=i.slice(0);l[0][0]=1;const c=i.slice(0),h=i.slice(0);for(let y=1;y<=t;++y){c[y]=e-r[s+1-y],h[y]=r[s+y]-e;let b=0;for(let w=0;w<y;++w){const A=h[w+1],I=c[y-w];l[y][w]=A+I;const D=l[w][y-1]/l[y][w];l[w][y]=b+A*D,b=I*D}l[y][y]=b}for(let y=0;y<=t;++y)o[0][y]=l[y][t];for(let y=0;y<=t;++y){let b=0,w=1;const A=[];for(let I=0;I<=t;++I)A[I]=i.slice(0);A[0][0]=1;for(let I=1;I<=n;++I){let D=0;const P=y-I,U=t-I;y>=I&&(A[w][0]=A[b][0]/l[U+1][P],D=A[w][0]*l[P][U]);const j=P>=-1?1:-P,C=y-1<=U?I-1:t-y;for(let ie=j;ie<=C;++ie)A[w][ie]=(A[b][ie]-A[b][ie-1])/l[U+1][P+ie],D+=A[w][ie]*l[P+ie][U];y<=U&&(A[w][I]=-A[b][I-1]/l[U+1][y],D+=A[w][I]*l[y][U]),o[I][y]=D;const Z=b;b=w,w=Z}}let m=t;for(let y=1;y<=n;++y){for(let b=0;b<=t;++b)o[y][b]*=m;m*=t-y}return o}function Hht(s,e,t,n,r){const i=r<s?r:s,o=[],l=mNe(s,n,e),c=jht(l,n,s,i,e),h=[];for(let m=0;m<t.length;++m){const y=t[m].clone(),b=y.w;y.x*=b,y.y*=b,y.z*=b,h[m]=y}for(let m=0;m<=i;++m){const y=h[l-s].clone().multiplyScalar(c[m][0]);for(let b=1;b<=s;++b)y.add(h[l-s+b].clone().multiplyScalar(c[m][b]));o[m]=y}for(let m=i+1;m<=r+1;++m)o[m]=new zr(0,0,0);return o}function $ht(s,e){let t=1;for(let r=2;r<=s;++r)t*=r;let n=1;for(let r=2;r<=e;++r)n*=r;for(let r=2;r<=s-e;++r)n*=r;return t/n}function Wht(s){const e=s.length,t=[],n=[];for(let i=0;i<e;++i){const o=s[i];t[i]=new be(o.x,o.y,o.z),n[i]=o.w}const r=[];for(let i=0;i<e;++i){const o=t[i].clone();for(let l=1;l<=i;++l)o.sub(r[i-l].clone().multiplyScalar($ht(i,l)*n[l]));r[i]=o.divideScalar(n[0])}return r}function qht(s,e,t,n,r){const i=Hht(s,e,t,n,r);return Wht(i)}class Xht extends J_e{constructor(e,t,n,r,i){super();const o=t?t.length-1:0,l=n?n.length:0;this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=i||o;for(let c=0;c<l;++c){const h=n[c];this.controlPoints[c]=new zr(h.x,h.y,h.z,h.w)}}getPoint(e,t=new be){const n=t,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=Ght(this.degree,this.knots,this.controlPoints,r);return i.w!==1&&i.divideScalar(i.w),n.set(i.x,i.y,i.z)}getTangent(e,t=new be){const n=t,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=qht(this.degree,this.knots,this.controlPoints,r,1);return n.copy(i[1]).normalize(),n}toJSON(){const e=super.toJSON();return e.degree=this.degree,e.knots=[...this.knots],e.controlPoints=this.controlPoints.map(t=>t.toArray()),e.startKnot=this.startKnot,e.endKnot=this.endKnot,e}fromJSON(e){return super.fromJSON(e),this.degree=e.degree,this.knots=[...e.knots],this.controlPoints=e.controlPoints.map(t=>new zr(t[0],t[1],t[2],t[3])),this.startKnot=e.startKnot,this.endKnot=e.endKnot,this}}let Ii,Ua,pu;class Yht extends m5{constructor(e){super(e)}load(e,t,n,r){const i=this,o=i.path===""?oje.extractUrlBase(e):i.path,l=new JGe(this.manager);l.setPath(i.path),l.setResponseType("arraybuffer"),l.setRequestHeader(i.requestHeader),l.setWithCredentials(i.withCredentials),l.load(e,function(c){try{t(i.parse(c,o))}catch(h){r?r(h):console.error(h),i.manager.itemError(e)}},n,r)}parse(e,t){if(tpt(e))Ii=new ept().parse(e);else{const r=vNe(e);if(!npt(r))throw new Error("THREE.FBXLoader: Unknown format.");if(w_e(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+w_e(r));Ii=new Jht().parse(r)}const n=new dSe(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Kht(n,this.manager).parse(Ii)}}class Kht{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Ua=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),i=new Zht().parse(r);return this.parseScene(r,i,n),pu}parseConnections(){const e=new Map;return"Connections"in Ii&&Ii.Connections.connections.forEach(function(n){const r=n[0],i=n[1],o=n[2];e.has(r)||e.set(r,{parents:[],children:[]});const l={ID:i,relationship:o};e.get(r).parents.push(l),e.has(i)||e.set(i,{parents:[],children:[]});const c={ID:r,relationship:o};e.get(i).children.push(c)}),e}parseImages(){const e={},t={};if("Video"in Ii.Objects){const n=Ii.Objects.Video;for(const r in n){const i=n[r],o=parseInt(r);if(e[o]=i.RelativeFilename||i.Filename,"Content"in i){const l=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,c=typeof i.Content=="string"&&i.Content!=="";if(l||c){const h=this.parseImage(n[r]);t[i.RelativeFilename||i.Filename]=h}}}}for(const n in e){const r=e[n];t[r]!==void 0?e[n]=t[r]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let i;switch(r){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),i="image/tga";break;case"webp":i="image/webp";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof t=="string")return"data:"+i+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:i}))}}parseTextures(e){const t=new Map;if("Texture"in Ii.Objects){const n=Ii.Objects.Texture;for(const r in n){const i=this.parseTexture(n[r],e);t.set(parseInt(r),i)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const r=e.WrapModeU,i=e.WrapModeV,o=r!==void 0?r.value:0,l=i!==void 0?i.value:0;if(n.wrapS=o===0?vh:zo,n.wrapT=l===0?vh:zo,"Scaling"in e){const c=e.Scaling.value;n.repeat.x=c[0],n.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;n.offset.x=c[0],n.offset.y=c[1]}return n}loadTexture(e,t){const n=e.FileName.split(".").pop().toLowerCase();let r=this.manager.getHandler(`.${n}`);r===null&&(r=this.textureLoader);const i=r.path;i||r.setPath(this.textureLoader.path);const o=Ua.get(e.id).children;let l;if(o!==void 0&&o.length>0&&t[o[0].ID]!==void 0&&(l=t[o[0].ID],(l.indexOf("blob:")===0||l.indexOf("data:")===0)&&r.setPath(void 0)),l===void 0)return console.warn("FBXLoader: Undefined filename, creating placeholder texture."),new ol;const c=r.load(l);return r.setPath(i),c}parseMaterials(e){const t=new Map;if("Material"in Ii.Objects){const n=Ii.Objects.Material;for(const r in n){const i=this.parseMaterial(n[r],e);i!==null&&t.set(parseInt(r),i)}}return t}parseMaterial(e,t){const n=e.id,r=e.attrName;let i=e.ShadingModel;if(typeof i=="object"&&(i=i.value),!Ua.has(n))return null;const o=this.parseParameters(e,t,n);let l;switch(i.toLowerCase()){case"phong":l=new $6;break;case"lambert":l=new sSe;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',i),l=new $6;break}return l.setValues(o),l.name=r,l}parseParameters(e,t,n){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=Zn.colorSpaceToWorking(new Tn().fromArray(e.Diffuse.value),Is):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(r.color=Zn.colorSpaceToWorking(new Tn().fromArray(e.DiffuseColor.value),Is)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=Zn.colorSpaceToWorking(new Tn().fromArray(e.Emissive.value),Is):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(r.emissive=Zn.colorSpaceToWorking(new Tn().fromArray(e.EmissiveColor.value),Is)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),r.opacity=1-(e.TransparencyFactor?parseFloat(e.TransparencyFactor.value):0),(r.opacity===1||r.opacity===0)&&(r.opacity=e.Opacity?parseFloat(e.Opacity.value):null,r.opacity===null&&(r.opacity=1-(e.TransparentColor?parseFloat(e.TransparentColor.value[0]):0))),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=Zn.colorSpaceToWorking(new Tn().fromArray(e.Specular.value),Is):e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=Zn.colorSpaceToWorking(new Tn().fromArray(e.SpecularColor.value),Is));const i=this;return Ua.get(n).children.forEach(function(o){const l=o.relationship;switch(l){case"Bump":r.bumpMap=i.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":r.aoMap=i.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=i.getTexture(t,o.ID),r.map!==void 0&&(r.map.colorSpace=Is);break;case"DisplacementColor":r.displacementMap=i.getTexture(t,o.ID);break;case"EmissiveColor":r.emissiveMap=i.getTexture(t,o.ID),r.emissiveMap!==void 0&&(r.emissiveMap.colorSpace=Is);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=i.getTexture(t,o.ID);break;case"ReflectionColor":r.envMap=i.getTexture(t,o.ID),r.envMap!==void 0&&(r.envMap.mapping=K6,r.envMap.colorSpace=Is);break;case"SpecularColor":r.specularMap=i.getTexture(t,o.ID),r.specularMap!==void 0&&(r.specularMap.colorSpace=Is);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=i.getTexture(t,o.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",l);break}}),r}getTexture(e,t){return"LayeredTexture"in Ii.Objects&&t in Ii.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Ua.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Ii.Objects){const n=Ii.Objects.Deformer;for(const r in n){const i=n[r],o=Ua.get(parseInt(r));if(i.attrType==="Skin"){const l=this.parseSkeleton(o,n);l.ID=r,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=o.parents[0].ID,e[r]=l}else if(i.attrType==="BlendShape"){const l={id:r};l.rawTargets=this.parseMorphTargets(o,n),l.id=r,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=l}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(r){const i=t[r.ID];if(i.attrType!=="Cluster")return;const o={ID:r.ID,indices:[],weights:[],transformLink:new Pn().fromArray(i.TransformLink.a)};"Indexes"in i&&(o.indices=i.Indexes.a,o.weights=i.Weights.a),n.push(o)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let r=0;r<e.children.length;r++){const i=e.children[r],o=t[i.ID],l={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;l.geoID=Ua.get(parseInt(i.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,n.push(l)}return n}parseScene(e,t,n){pu=new j6;const r=this.parseModels(e.skeletons,t,n),i=Ii.Objects.Model,o=this;r.forEach(function(c){const h=i[c.ID];o.setLookAtProperties(c,h),Ua.get(c.ID).parents.forEach(function(y){const b=r.get(y.ID);b!==void 0&&b.add(c)}),c.parent===null&&pu.add(c)}),this.bindSkeleton(e.skeletons,t,r),this.addGlobalSceneSettings(),pu.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const h=yNe(c.userData.transformData);c.applyMatrix4(h),c.updateWorldMatrix()}});const l=new Qht().parse();pu.children.length===1&&pu.children[0].isGroup&&(pu.children[0].animations=l,pu=pu.children[0]),pu.animations=l}parseModels(e,t,n){const r=new Map,i=Ii.Objects.Model;for(const o in i){const l=parseInt(o),c=i[o],h=Ua.get(l);let m=this.buildSkeleton(h,e,l,c.attrName);if(!m){switch(c.attrType){case"Camera":m=this.createCamera(h);break;case"Light":m=this.createLight(h);break;case"Mesh":m=this.createMesh(h,t,n);break;case"NurbsCurve":m=this.createCurve(h,t);break;case"LimbNode":case"Root":m=new PY;break;case"Null":default:m=new j6;break}m.name=c.attrName?us.sanitizeNodeName(c.attrName):"",m.userData.originalName=c.attrName,m.ID=l}this.getTransformData(m,c),r.set(l,m)}return r}buildSkeleton(e,t,n,r){let i=null;return e.parents.forEach(function(o){for(const l in t){const c=t[l];c.rawBones.forEach(function(h,m){if(h.ID===o.ID){const y=i;i=new PY,i.matrixWorld.copy(h.transformLink),i.name=r?us.sanitizeNodeName(r):"",i.userData.originalName=r,i.ID=n,c.bones[m]=i,y!==null&&i.add(y)}})}}),i}createCamera(e){let t,n;if(e.children.forEach(function(r){const i=Ii.Objects.NodeAttribute[r.ID];i!==void 0&&(n=i)}),n===void 0)t=new Bi;else{let r=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(r=1);let i=1;n.NearPlane!==void 0&&(i=n.NearPlane.value/1e3);let o=1e3;n.FarPlane!==void 0&&(o=n.FarPlane.value/1e3);let l=window.innerWidth,c=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(l=n.AspectWidth.value,c=n.AspectHeight.value);const h=l/c;let m=45;n.FieldOfView!==void 0&&(m=n.FieldOfView.value);const y=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new Va(m,h,i,o),y!==null&&t.setFocalLength(y);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),t=new Bi;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new Bi;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(r){const i=Ii.Objects.NodeAttribute[r.ID];i!==void 0&&(n=i)}),n===void 0)t=new Bi;else{let r;n.LightType===void 0?r=0:r=n.LightType.value;let i=16777215;n.Color!==void 0&&(i=Zn.colorSpaceToWorking(new Tn().fromArray(n.Color.value),Is));let o=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(o=0);let l=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?l=0:l=n.FarAttenuationEnd.value);const c=1;switch(r){case 0:t=new dF(i,o,l,c);break;case 1:t=new QA(i,o);break;case 2:let h=Math.PI/3;n.InnerAngle!==void 0&&(h=t0.degToRad(n.InnerAngle.value));let m=0;n.OuterAngle!==void 0&&(m=t0.degToRad(n.OuterAngle.value),m=Math.max(m,1)),t=new Sw(i,o,l,h,m,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new dF(i,o);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let r,i=null,o=null;const l=[];if(e.children.forEach(function(c){t.has(c.ID)&&(i=t.get(c.ID)),n.has(c.ID)&&l.push(n.get(c.ID))}),l.length>1?o=l:l.length>0?o=l[0]:(o=new $6({name:m5.DEFAULT_MATERIAL_NAME,color:13421772}),l.push(o)),"color"in i.attributes&&l.forEach(function(c){c.vertexColors=!0}),i.groups.length>0){let c=!1;for(let h=0,m=i.groups.length;h<m;h++){const y=i.groups[h];(y.materialIndex<0||y.materialIndex>=l.length)&&(y.materialIndex=l.length,c=!0)}if(c){const h=new $6;l.push(h)}}return i.FBX_Deformer?(r=new QK(i,o),r.normalizeSkinWeights()):r=new gn(i,o),r}createCurve(e,t){const n=e.children.reduce(function(i,o){return t.has(o.ID)&&(i=t.get(o.ID)),i},null),r=new Sh({name:m5.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new dd(n,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=BA(t.RotationOrder.value):n.eulerOrder=BA(0),"Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&Ua.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const i=Ii.Objects.Model[r.ID];if("Lcl_Translation"in i){const o=i.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),pu.add(e.target)):e.lookAt(new be().fromArray(o))}}})}bindSkeleton(e,t,n){const r=this.parsePoseNodes();for(const i in e){const o=e[i];Ua.get(parseInt(o.ID)).parents.forEach(function(c){if(t.has(c.ID)){const h=c.ID;Ua.get(h).parents.forEach(function(y){n.has(y.ID)&&n.get(y.ID).bind(new JK(o.bones),r[y.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Ii.Objects){const t=Ii.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const r=t[n].PoseNode;Array.isArray(r)?r.forEach(function(i){e[i.Node]=new Pn().fromArray(i.Matrix.a)}):e[r.Node]=new Pn().fromArray(r.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in Ii){if("AmbientColor"in Ii.GlobalSettings){const e=Ii.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(t!==0||n!==0||r!==0){const i=new Tn().setRGB(t,n,r,Is);pu.add(new pSe(i,1))}}"UnitScaleFactor"in Ii.GlobalSettings&&(pu.userData.unitScaleFactor=Ii.GlobalSettings.UnitScaleFactor.value)}}}class Zht{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in Ii.Objects){const n=Ii.Objects.Geometry;for(const r in n){const i=Ua.get(parseInt(r)),o=this.parseGeometry(i,n[r],e);t.set(parseInt(r),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const r=n.skeletons,i=[],o=e.parents.map(function(y){return Ii.Objects.Model[y.ID]});if(o.length===0)return;const l=e.children.reduce(function(y,b){return r[b.ID]!==void 0&&(y=r[b.ID]),y},null);e.children.forEach(function(y){n.morphTargets[y.ID]!==void 0&&i.push(n.morphTargets[y.ID])});const c=o[0],h={};"RotationOrder"in c&&(h.eulerOrder=BA(c.RotationOrder.value)),"InheritType"in c&&(h.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(h.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(h.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(h.scale=c.GeometricScaling.value);const m=yNe(h);return this.genGeometry(t,l,i,m)}genGeometry(e,t,n,r){const i=new Ki;e.attrName&&(i.name=e.attrName);const o=this.parseGeoNode(e,t),l=this.genBuffers(o),c=new Fr(l.vertex,3);if(c.applyMatrix4(r),i.setAttribute("position",c),l.colors.length>0&&i.setAttribute("color",new Fr(l.colors,3)),t&&(i.setAttribute("skinIndex",new iB(l.weightsIndices,4)),i.setAttribute("skinWeight",new Fr(l.vertexWeights,4)),i.FBX_Deformer=t),l.normal.length>0){const h=new ci().getNormalMatrix(r),m=new Fr(l.normal,3);m.applyNormalMatrix(h),i.setAttribute("normal",m)}if(l.uvs.forEach(function(h,m){const y=m===0?"uv":`uv${m}`;i.setAttribute(y,new Fr(l.uvs[m],2))}),o.material&&o.material.mappingType!=="AllSame"){let h=l.materialIndex[0],m=0;if(l.materialIndex.forEach(function(y,b){y!==h&&(i.addGroup(m,b-m,h),h=y,m=b)}),i.groups.length>0){const y=i.groups[i.groups.length-1],b=y.start+y.count;b!==l.materialIndex.length&&i.addGroup(b,l.materialIndex.length-b,h)}i.groups.length===0&&i.addGroup(0,l.materialIndex.length,l.materialIndex[0])}return this.addMorphTargets(i,e,n,r),i}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&e.LayerElementColor[0].Colors&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(r,i){r.indices.forEach(function(o,l){n.weightTable[o]===void 0&&(n.weightTable[o]=[]),n.weightTable[o].push({id:i,weight:r.weights[l]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,i=!1,o=[],l=[],c=[],h=[],m=[],y=[];const b=this;return e.vertexIndices.forEach(function(w,A){let I,D=!1;w<0&&(w=w^-1,D=!0);let P=[],U=[];if(o.push(w*3,w*3+1,w*3+2),e.color){const j=VL(A,n,w,e.color);c.push(j[0],j[1],j[2])}if(e.skeleton){if(e.weightTable[w]!==void 0&&e.weightTable[w].forEach(function(j){U.push(j.weight),P.push(j.id)}),U.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);const j=[0,0,0,0],C=[0,0,0,0];U.forEach(function(Z,ie){let se=Z,z=P[ie];C.forEach(function(re,ye,H){if(se>re){H[ye]=se,se=re;const Me=j[ye];j[ye]=z,z=Me}})}),P=j,U=C}for(;U.length<4;)U.push(0),P.push(0);for(let j=0;j<4;++j)m.push(U[j]),y.push(P[j])}if(e.normal){const j=VL(A,n,w,e.normal);l.push(j[0],j[1],j[2])}e.material&&e.material.mappingType!=="AllSame"&&(I=VL(A,n,w,e.material)[0],I<0&&(b.negativeMaterialIndices=!0,I=0)),e.uv&&e.uv.forEach(function(j,C){const Z=VL(A,n,w,j);h[C]===void 0&&(h[C]=[]),h[C].push(Z[0]),h[C].push(Z[1])}),r++,D&&(b.genFace(t,e,o,I,l,c,h,m,y,r),n++,r=0,o=[],l=[],c=[],h=[],m=[],y=[])}),t}getNormalNewell(e){const t=new be(0,0,0);for(let n=0;n<e.length;n++){const r=e[n],i=e[(n+1)%e.length];t.x+=(r.y-i.y)*(r.z+i.z),t.y+=(r.z-i.z)*(r.x+i.x),t.z+=(r.x-i.x)*(r.y+i.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),r=(Math.abs(t.z)>.5?new be(0,1,0):new be(0,0,1)).cross(t).normalize(),i=t.clone().cross(r).normalize();return{normal:t,tangent:r,bitangent:i}}flattenVertex(e,t,n){return new Ln(e.dot(t),e.dot(n))}genFace(e,t,n,r,i,o,l,c,h,m){let y;if(m>3){const b=[],w=t.baseVertexPositions||t.vertexPositions;for(let P=0;P<n.length;P+=3)b.push(new be(w[n[P]],w[n[P+1]],w[n[P+2]]));const{tangent:A,bitangent:I}=this.getNormalTangentAndBitangent(b),D=[];for(const P of b)D.push(this.flattenVertex(P,A,I));y=sZ.triangulateShape(D,[])}else y=[[0,1,2]];for(const[b,w,A]of y)e.vertex.push(t.vertexPositions[n[b*3]]),e.vertex.push(t.vertexPositions[n[b*3+1]]),e.vertex.push(t.vertexPositions[n[b*3+2]]),e.vertex.push(t.vertexPositions[n[w*3]]),e.vertex.push(t.vertexPositions[n[w*3+1]]),e.vertex.push(t.vertexPositions[n[w*3+2]]),e.vertex.push(t.vertexPositions[n[A*3]]),e.vertex.push(t.vertexPositions[n[A*3+1]]),e.vertex.push(t.vertexPositions[n[A*3+2]]),t.skeleton&&(e.vertexWeights.push(c[b*4]),e.vertexWeights.push(c[b*4+1]),e.vertexWeights.push(c[b*4+2]),e.vertexWeights.push(c[b*4+3]),e.vertexWeights.push(c[w*4]),e.vertexWeights.push(c[w*4+1]),e.vertexWeights.push(c[w*4+2]),e.vertexWeights.push(c[w*4+3]),e.vertexWeights.push(c[A*4]),e.vertexWeights.push(c[A*4+1]),e.vertexWeights.push(c[A*4+2]),e.vertexWeights.push(c[A*4+3]),e.weightsIndices.push(h[b*4]),e.weightsIndices.push(h[b*4+1]),e.weightsIndices.push(h[b*4+2]),e.weightsIndices.push(h[b*4+3]),e.weightsIndices.push(h[w*4]),e.weightsIndices.push(h[w*4+1]),e.weightsIndices.push(h[w*4+2]),e.weightsIndices.push(h[w*4+3]),e.weightsIndices.push(h[A*4]),e.weightsIndices.push(h[A*4+1]),e.weightsIndices.push(h[A*4+2]),e.weightsIndices.push(h[A*4+3])),t.color&&(e.colors.push(o[b*3]),e.colors.push(o[b*3+1]),e.colors.push(o[b*3+2]),e.colors.push(o[w*3]),e.colors.push(o[w*3+1]),e.colors.push(o[w*3+2]),e.colors.push(o[A*3]),e.colors.push(o[A*3+1]),e.colors.push(o[A*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(i[b*3]),e.normal.push(i[b*3+1]),e.normal.push(i[b*3+2]),e.normal.push(i[w*3]),e.normal.push(i[w*3+1]),e.normal.push(i[w*3+2]),e.normal.push(i[A*3]),e.normal.push(i[A*3+1]),e.normal.push(i[A*3+2])),t.uv&&t.uv.forEach(function(I,D){e.uvs[D]===void 0&&(e.uvs[D]=[]),e.uvs[D].push(l[D][b*2]),e.uvs[D].push(l[D][b*2+1]),e.uvs[D].push(l[D][w*2]),e.uvs[D].push(l[D][w*2+1]),e.uvs[D].push(l[D][A*2]),e.uvs[D].push(l[D][A*2+1])})}addMorphTargets(e,t,n,r){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const i=this;n.forEach(function(o){o.rawTargets.forEach(function(l){const c=Ii.Objects.Geometry[l.geoID];c!==void 0&&i.genMorphGeometry(e,t,c,r,l.name)})})}genMorphGeometry(e,t,n,r,i){const o=t.Vertices!==void 0?t.Vertices.a:[],l=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],c=n.Vertices!==void 0?n.Vertices.a:[],h=n.Indexes!==void 0?n.Indexes.a:[],m=e.attributes.position.count*3,y=new Float32Array(m);for(let I=0;I<h.length;I++){const D=h[I]*3;y[D]=c[I*3],y[D+1]=c[I*3+1],y[D+2]=c[I*3+2]}const b={vertexIndices:l,vertexPositions:y,baseVertexPositions:o},w=this.genBuffers(b),A=new Fr(w.vertex,3);A.name=i||n.attrName,A.applyMatrix4(r),e.morphAttributes.position.push(A)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let i=[];return n==="IndexToDirect"&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let i=[];return n==="IndexToDirect"&&(i=e.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let i=[];n==="IndexToDirect"&&(i=e.ColorIndex.a);for(let o=0,l=new Tn;o<r.length;o+=4)l.fromArray(r,o),Zn.colorSpaceToWorking(l,Is),l.toArray(r,o);return{dataSize:4,buffer:r,indices:i,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,i=[];for(let o=0;o<r.length;++o)i.push(o);return{dataSize:1,buffer:r,indices:i,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Ki;const n=t-1,r=e.KnotVector.a,i=[],o=e.Points.a;for(let y=0,b=o.length;y<b;y+=4)i.push(new zr().fromArray(o,y));let l,c;if(e.Form==="Closed")i.push(i[0]);else if(e.Form==="Periodic"){l=n,c=r.length-1-l;for(let y=0;y<n;++y)i.push(i[y])}const m=new Xht(n,r,i,l,c).getPoints(i.length*12);return new Ki().setFromPoints(m)}}class Qht{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const r=t[n],i=this.addClip(r);e.push(i)}return e}parseClips(){if(Ii.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Ii.Objects.AnimationCurveNode,t=new Map;for(const n in e){const r=e[n];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const i={id:r.id,attr:r.attrName,curves:{}};t.set(i.id,i)}}return t}parseAnimationCurves(e){const t=Ii.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map(rpt),values:t[n].KeyValueFloat.a},i=Ua.get(r.id);if(i!==void 0){const o=i.parents[0].ID,l=i.parents[0].relationship;l.match(/X/)?e.get(o).curves.x=r:l.match(/Y/)?e.get(o).curves.y=r:l.match(/Z/)?e.get(o).curves.z=r:l.match(/DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=r)}}}parseAnimationLayers(e){const t=Ii.Objects.AnimationLayer,n=new Map;for(const r in t){const i=[],o=Ua.get(parseInt(r));o!==void 0&&(o.children.forEach(function(c,h){if(e.has(c.ID)){const m=e.get(c.ID);if(m.curves.x!==void 0||m.curves.y!==void 0||m.curves.z!==void 0){if(i[h]===void 0){const y=Ua.get(c.ID).parents.filter(function(b){return b.relationship!==void 0})[0].ID;if(y!==void 0){const b=Ii.Objects.Model[y.toString()];if(b===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const w={modelName:b.attrName?us.sanitizeNodeName(b.attrName):"",ID:b.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};pu.traverse(function(A){A.ID===b.id&&(w.transform=A.matrix,A.userData.transformData&&(w.eulerOrder=A.userData.transformData.eulerOrder))}),w.transform||(w.transform=new Pn),"PreRotation"in b&&(w.preRotation=b.PreRotation.value),"PostRotation"in b&&(w.postRotation=b.PostRotation.value),i[h]=w}}i[h]&&(i[h][m.attr]=m)}else if(m.curves.morph!==void 0){if(i[h]===void 0){const y=Ua.get(c.ID).parents.filter(function(P){return P.relationship!==void 0})[0].ID,b=Ua.get(y).parents[0].ID,w=Ua.get(b).parents[0].ID,A=Ua.get(w).parents[0].ID,I=Ii.Objects.Model[A],D={modelName:I.attrName?us.sanitizeNodeName(I.attrName):"",morphName:Ii.Objects.Deformer[y].attrName};i[h]=D}i[h][m.attr]=m}}}),n.set(parseInt(r),i))}return n}parseAnimStacks(e){const t=Ii.Objects.AnimationStack,n={};for(const r in t){const i=Ua.get(parseInt(r)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(i[0].ID);n[r]={name:t[r].attrName,layer:o}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(r){t=t.concat(n.generateTracks(r))}),new DY(e.name,-1,t)}generateTracks(e){const t=[];let n=new be,r=new be;if(e.transform&&e.transform.decompose(n,new vs,r),n=n.toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");i!==void 0&&t.push(i)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const i=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);i!==void 0&&t.push(i)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");i!==void 0&&t.push(i)}if(e.DeformPercent!==void 0){const i=this.generateMorphTrack(e);i!==void 0&&t.push(i)}return t}generateVectorTrack(e,t,n,r){const i=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(i,t,n);return new CA(e+"."+r,i,o)}generateRotationTrack(e,t,n,r,i){let o,l;if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const b=this.interpolateRotations(t.x,t.y,t.z,i);o=b[0],l=b[1]}const c=BA(0);n!==void 0&&(n=n.map(t0.degToRad),n.push(c),n=new Sa().fromArray(n),n=new vs().setFromEuler(n)),r!==void 0&&(r=r.map(t0.degToRad),r.push(c),r=new Sa().fromArray(r),r=new vs().setFromEuler(r).invert());const h=new vs,m=new Sa,y=[];if(!l||!o)return new ew(e+".quaternion",[0],[0]);for(let b=0;b<l.length;b+=3)m.set(l[b],l[b+1],l[b+2],i),h.setFromEuler(m),n!==void 0&&h.premultiply(n),r!==void 0&&h.multiply(r),b>2&&new vs().fromArray(y,(b-3)/3*4).dot(h)<0&&h.set(-h.x,-h.y,-h.z,-h.w),h.toArray(y,b/3*4);return new ew(e+".quaternion",o,y)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(i){return i/100}),r=pu.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new MA(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,r){return n-r}),t.length>1){let n=1,r=t[0];for(let i=1;i<t.length;i++){const o=t[i];o!==r&&(t[n]=o,r=o,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const r=n,i=[];let o=-1,l=-1,c=-1;return e.forEach(function(h){if(t.x&&(o=t.x.times.indexOf(h)),t.y&&(l=t.y.times.indexOf(h)),t.z&&(c=t.z.times.indexOf(h)),o!==-1){const m=t.x.values[o];i.push(m),r[0]=m}else i.push(r[0]);if(l!==-1){const m=t.y.values[l];i.push(m),r[1]=m}else i.push(r[1]);if(c!==-1){const m=t.z.values[c];i.push(m),r[2]=m}else i.push(r[2])}),i}interpolateRotations(e,t,n,r){const i=[],o=[];i.push(e.times[0]),o.push(t0.degToRad(e.values[0])),o.push(t0.degToRad(t.values[0])),o.push(t0.degToRad(n.values[0]));for(let l=1;l<e.values.length;l++){const c=[e.values[l-1],t.values[l-1],n.values[l-1]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const h=c.map(t0.degToRad),m=[e.values[l],t.values[l],n.values[l]];if(isNaN(m[0])||isNaN(m[1])||isNaN(m[2]))continue;const y=m.map(t0.degToRad),b=[m[0]-c[0],m[1]-c[1],m[2]-c[2]],w=[Math.abs(b[0]),Math.abs(b[1]),Math.abs(b[2])];if(w[0]>=180||w[1]>=180||w[2]>=180){const I=Math.max(...w)/180,D=new Sa(...h,r),P=new Sa(...y,r),U=new vs().setFromEuler(D),j=new vs().setFromEuler(P);U.dot(j)&&j.set(-j.x,-j.y,-j.z,-j.w);const C=e.times[l-1],Z=e.times[l]-C,ie=new vs,se=new Sa;for(let z=0;z<1;z+=1/I)ie.copy(U.clone().slerp(j.clone(),z)),i.push(C+z*Z),se.setFromQuaternion(ie,r),o.push(se.x),o.push(se.y),o.push(se.z)}else i.push(e.times[l]),o.push(t0.degToRad(e.values[l])),o.push(t0.degToRad(t.values[l])),o.push(t0.degToRad(n.values[l]))}return[i,o]}}class Jht{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new gNe,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(r,i){const o=r.match(/^[\s\t]*;/),l=r.match(/^[\s\t]*$/);if(o||l)return;const c=r.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),h=r.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),m=r.match("^\\t{"+(t.currentIndent-1)+"}}");c?t.parseNodeBegin(r,c):h?t.parseNodeProperty(r,h,n[++i]):m?t.popStack():r.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:n},o=this.parseNodeAttr(r),l=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,i):n in l?(n==="PoseNode"?l.PoseNode.push(i):l[n].id!==void 0&&(l[n]={},l[n][l[n].id]=l[n]),o.id!==""&&(l[n][o.id]=i)):typeof o.id=="number"?(l[n]={},l[n][o.id]=i):n!=="Properties70"&&(n==="PoseNode"?l[n]=[i]:l[n]=i),typeof o.id=="number"&&(i.id=o.id),o.name!==""&&(i.attrName=o.name),o.type!==""&&(i.attrType=o.type),this.pushStack(i)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&i===","&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,r,i);return}if(r==="C"){const c=i.split(",").slice(1),h=parseInt(c[0]),m=parseInt(c[1]);let y=i.split(",").slice(3);y=y.map(function(b){return b.trim().replace(/^"/,"")}),r="connections",i=[h,m],spt(i,y),o[r]===void 0&&(o[r]=[])}r==="Node"&&(o.id=i),r in o&&Array.isArray(o[r])?o[r].push(i):r!=="a"?o[r]=i:o.a=i,this.setCurrentProp(o,r),r==="a"&&i.slice(-1)!==","&&(o.a=xY(i))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=xY(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map(function(m){return m.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=r[0],o=r[1],l=r[2],c=r[3];let h=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=xY(h);break}this.getPrevNode()[i]={type:o,type2:l,flag:c,value:h},this.setCurrentProp(this.getPrevNode(),i)}}class ept{parse(e){const t=new S_e(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new gNe;for(;!this.endOfContent(t);){const i=this.parseNode(t,n);i!==null&&r.add(i.name,i)}return r}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),l=e.getString(o);if(r===0)return null;const c=[];for(let b=0;b<i;b++)c.push(this.parseProperty(e));const h=c.length>0?c[0]:"",m=c.length>1?c[1]:"",y=c.length>2?c[2]:"";for(n.singleProperty=i===1&&e.getOffset()===r;r>e.getOffset();){const b=this.parseNode(e,t);b!==null&&this.parseSubNode(l,n,b)}return n.propertyList=c,typeof h=="number"&&(n.id=h),m!==""&&(n.attrName=m),y!==""&&(n.attrType=y),l!==""&&(n.name=l),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if(e==="Connections"&&n.name==="C"){const r=[];n.propertyList.forEach(function(i,o){o!==0&&r.push(i)}),t.connections===void 0&&(t.connections=[]),t.connections.push(r)}else if(n.name==="Properties70")Object.keys(n).forEach(function(i){t[i]=n[i]});else if(e==="Properties70"&&n.name==="P"){let r=n.propertyList[0],i=n.propertyList[1];const o=n.propertyList[2],l=n.propertyList[3];let c;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),i==="Color"||i==="ColorRGB"||i==="Vector"||i==="Vector3D"||i.indexOf("Lcl_")===0?c=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:c=n.propertyList[4],t[r]={type:i,type2:o,flag:l,value:c}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),i=e.getUint32(),o=e.getUint32();if(i===0)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const l=Bht(new Uint8Array(e.getArrayBuffer(o))),c=new S_e(l.buffer);switch(t){case"b":case"c":return c.getBooleanArray(r);case"d":return c.getFloat64Array(r);case"f":return c.getFloat32Array(r);case"i":return c.getInt32Array(r);case"l":return c.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class S_e{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const r=n.indexOf(0);return r>=0&&(n=new Uint8Array(this.dv.buffer,t,r)),this._textDecoder.decode(n)}}class gNe{add(e,t){this[e]=t}}function tpt(s){const e="Kaydara FBX Binary  \0";return s.byteLength>=e.length&&e===vNe(s,0,e.length)}function npt(s){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(r){const i=s[r-1];return s=s.slice(t+r),t++,i}for(let r=0;r<e.length;++r)if(n(1)===e[r])return!1;return!0}function w_e(s){const e=/FBXVersion: (\d+)/,t=s.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function rpt(s){return s/46186158e3}const ipt=[];function VL(s,e,t,n){let r;switch(n.mappingType){case"ByPolygonVertex":r=s;break;case"ByPolygon":r=e;break;case"ByVertice":r=t;break;case"AllSame":r=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(r=n.indices[r]);const i=r*n.dataSize,o=i+n.dataSize;return opt(ipt,n.buffer,i,o)}const vY=new Sa,eS=new be;function yNe(s){const e=new Pn,t=new Pn,n=new Pn,r=new Pn,i=new Pn,o=new Pn,l=new Pn,c=new Pn,h=new Pn,m=new Pn,y=new Pn,b=new Pn,w=s.inheritType?s.inheritType:0;s.translation&&e.setPosition(eS.fromArray(s.translation));const A=BA(0);if(s.preRotation){const H=s.preRotation.map(t0.degToRad);H.push(A),t.makeRotationFromEuler(vY.fromArray(H))}if(s.rotation){const H=s.rotation.map(t0.degToRad);H.push(s.eulerOrder||A),n.makeRotationFromEuler(vY.fromArray(H))}if(s.postRotation){const H=s.postRotation.map(t0.degToRad);H.push(A),r.makeRotationFromEuler(vY.fromArray(H)),r.invert()}s.scale&&i.scale(eS.fromArray(s.scale)),s.scalingOffset&&l.setPosition(eS.fromArray(s.scalingOffset)),s.scalingPivot&&o.setPosition(eS.fromArray(s.scalingPivot)),s.rotationOffset&&c.setPosition(eS.fromArray(s.rotationOffset)),s.rotationPivot&&h.setPosition(eS.fromArray(s.rotationPivot)),s.parentMatrixWorld&&(y.copy(s.parentMatrix),m.copy(s.parentMatrixWorld));const I=t.clone().multiply(n).multiply(r),D=new Pn;D.extractRotation(m);const P=new Pn;P.copyPosition(m);const U=P.clone().invert().multiply(m),j=D.clone().invert().multiply(U),C=i,Z=new Pn;if(w===0)Z.copy(D).multiply(I).multiply(j).multiply(C);else if(w===1)Z.copy(D).multiply(j).multiply(I).multiply(C);else{const Me=new Pn().scale(new be().setFromMatrixScale(y)).clone().invert(),Oe=j.clone().multiply(Me);Z.copy(D).multiply(I).multiply(Oe).multiply(C)}const ie=h.clone().invert(),se=o.clone().invert();let z=e.clone().multiply(c).multiply(h).multiply(t).multiply(n).multiply(r).multiply(ie).multiply(l).multiply(o).multiply(i).multiply(se);const re=new Pn().copyPosition(z),ye=m.clone().multiply(re);return b.copyPosition(ye),z=b.clone().multiply(Z),z.premultiply(m.invert()),z}function BA(s){s=s||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return s===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[s]}function xY(s){return s.split(",").map(function(t){return parseFloat(t)})}function vNe(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=s.byteLength),new TextDecoder().decode(new Uint8Array(s,e,t))}function spt(s,e){for(let t=0,n=s.length,r=e.length;t<r;t++,n++)s[n]=e[t]}function opt(s,e,t,n){for(let r=t,i=0;r<n;r++,i++)s[i]=e[r];return s}const xN=new Map,xNe=new Map,bNe=new Map,KB=new Map;function apt(s,e){return new Promise((t,n)=>{new eje().setPath("images/milkyWay/").load(e,r=>{xN.set(s,r),t(r)},void 0,()=>{n()})})}function lpt(s,e){return new Promise((t,n)=>{new Yht().setPath("./models/").loadAsync(e).then(r=>{r.traverse(i=>{i.isMesh&&(i.castShadow=!0,i.receiveShadow=!0)}),bNe.set(s,r),t(r)}).catch(r=>{console.log("Couldn't load:",e),console.log(r),n()})})}function cpt(s,e){return new Promise((t,n)=>{new dSe().load(e,r=>{r.wrapS=vh,r.wrapT=vh,r.needsUpdate=!0,KB.set(s,r),t(r)},void 0,()=>{n()})})}function upt(s,e){return new Promise((t,n)=>{fetch(e).then(r=>{if(!r.ok)throw new Error(`Network response was not ok: ${r.status}`);return r.json()}).then(r=>{xNe.set(s,r),t(r)}).catch(()=>{console.log(`Couldn't load: ${e}`),n()})})}function dpt(s){return new Promise((e,t)=>{const n=[()=>apt("environment",["dark-s_px.jpg","dark-s_nx.jpg","dark-s_py.jpg","dark-s_ny.jpg","dark-s_pz.jpg","dark-s_nz.jpg"]),()=>cpt("uv_grid","images/uv_grid_opengl.jpg"),()=>lpt("Flair","Flair.fbx"),()=>upt("animation","json/animation.json")];Promise.all(n.map(r=>r())).then(()=>{const r=s.components.get("theatre"),i=xNe.get("animation");r.loadProject("RemoteApp",i).then(()=>{zY.dispatchEvent({type:hF.LOAD_COMPLETE}),e()})}).catch(r=>{console.log(r),t()})})}class _Ne extends Bi{constructor(t){super();qe(this,"mixer");this.name=t,this.scale.setScalar(.5);const n=bNe.get(t),r=Tht(n);this.add(r),this.mixer=new _je(r),r.mixer=this.mixer,this.mixer.clipAction(r.animations[0]).play()}update(t){this.mixer.update(t)}get timeScale(){return this.mixer.timeScale}set timeScale(t){this.mixer.timeScale=t}}class ZB extends XA{constructor(){super();qe(this,"app");qe(this,"camera");qe(this,"renderer");qe(this,"clock");this.clock=new aje,this.clock.connect(document);const t=new Bi;t.name="cameras",this.add(t),this.camera=new Va(90,1,10,1e3),this.camera.name="SceneCamera",this.camera.position.set(0,100,125),this.camera.lookAt(0,50,0),t.add(this.camera)}setup(t,n){this.app=t,this.renderer=n}init(){}dispose(){this.app.components.get("theatre").clearSheetObjects(this.name),this.clock.disconnect()}resize(t,n){this.camera.aspect=t/n,this.camera.updateProjectionMatrix()}update(){}draw(){this.renderer.render(this,this.camera)}}class SNe extends ZB{constructor(){super();qe(this,"dance");qe(this,"customMat");this.name="Scene1"}init(){const t=xN.get("environment");this.background=t,this.camera.position.set(0,50,50),this.camera.lookAt(0,50,0),this.createLights(),this.createWorld(),this.createAnimation(),$3(this);const n=this.app.components.get("three");n.addScene(this),n.setScene(this),n.addCamera(this.camera)}dispose(){this.app.components.get("three").removeCamera(this.camera),super.dispose()}createLights(){const t=new Bi;t.name="lights",this.add(t);const n=new QA(16777215,.25);n.name="sun",n.castShadow=!0,n.position.set(0,50,50);const r=1024;n.shadow.camera.top=r,n.shadow.camera.bottom=-r,n.shadow.camera.left=-r,n.shadow.camera.right=r,n.shadow.mapSize.width=1024,n.shadow.mapSize.height=1024,n.shadow.camera.near=10,n.shadow.camera.far=1e3,n.shadow.bias=-.001,t.add(n);const i=new hSe(7320802,12872999,.5);i.name="hemi",t.add(i);const o=new Sw(16777215,3);o.angle=5.8,o.decay=0,o.distance=1e3,o.penumbra=Math.PI,o.name="spotlight",o.castShadow=!0,o.shadow.mapSize.width=1024,o.shadow.mapSize.height=1024,o.shadow.camera.near=10,o.shadow.camera.far=1e3,o.shadow.bias=-.001,o.position.set(-50,200,200),o.lookAt(0,50,0),t.add(o)}createWorld(){const t=new Bi;t.name="world",this.add(t);const n=KB.get("uv_grid");n.repeat.setScalar(10),n.needsUpdate=!0;const r=new $6({map:n}),i=new gn(new sB(500,36),r);i.name="floor",i.receiveShadow=!0,i.rotateX(-Math.PI/2),t.add(i),this.dance=new _Ne("Flair"),this.dance.position.set(0,0,0),t.add(this.dance),this.createTestMaterials(t)}createTestMaterials(t){const n=new Mg(20),r=[],i=new gn(n,new rl({name:"BasicMaterial",transparent:!0}));i.name="Basic",t.add(i),r.push(i);const o=new gn(n,new cZ({transparent:!0}));o.name="Matcap",t.add(o),r.push(o);const l=new gn(n,new $6({name:"PhongMaterial",transparent:!0}));l.name="Phong",t.add(l),r.push(l);const c=new gn(n,new EA({name:"PhysicalMaterial",transparent:!0}));if(c.name="Physical",t.add(c),r.push(c),this.app.components.get("three").renderer.isWebGLRenderer){this.customMat=new wht;const w=new gn(n,this.customMat);w.name="Shader",t.add(w),r.push(w)}const m=50,y=r.length,b=(y-1)/2*m;for(let w=0;w<y;w++){const A=w*m-b;r[w].position.set(A,100,-150),r[w].castShadow=!0}}createAnimation(){const t=this.app.components.get("theatre");t.sheet(this.name),t.sheetObject(this.name,"Camera",{position:{x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z},rotation:{x:this.camera.rotation.x,y:this.camera.rotation.y,z:this.camera.rotation.z}},n=>{this.camera.position.set(n.position.x,n.position.y,n.position.z),this.camera.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z)}),t.sheetObject(this.name,"Break Dancer",{position:{x:this.dance.position.x,y:this.dance.position.y,z:this.dance.position.z},rotation:{x:this.dance.rotation.x,y:this.dance.rotation.y,z:this.dance.rotation.z}},n=>{this.dance.position.set(n.position.x,n.position.y,n.position.z),this.dance.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z)}),t.playSheet(this.name,{iterationCount:1/0})}update(){var n;this.clock.update();const t=this.clock.getDelta();(n=this.customMat)==null||n.update(t),this.dance.update(t)}}class fw{static init(){const e=[1,0,0,2e-5,1,0,0,503905e-9,1,0,0,.00201562,1,0,0,.00453516,1,0,0,.00806253,1,0,0,.0125978,1,0,0,.018141,1,0,0,.0246924,1,0,0,.0322525,1,0,0,.0408213,1,0,0,.0503999,1,0,0,.0609894,1,0,0,.0725906,1,0,0,.0852058,1,0,0,.0988363,1,0,0,.113484,1,0,0,.129153,1,0,0,.145839,1,0,0,.163548,1,0,0,.182266,1,0,0,.201942,1,0,0,.222314,1,0,0,.241906,1,0,0,.262314,1,0,0,.285754,1,0,0,.310159,1,0,0,.335426,1,0,0,.361341,1,0,0,.387445,1,0,0,.412784,1,0,0,.438197,1,0,0,.466966,1,0,0,.49559,1,0,0,.523448,1,0,0,.549938,1,0,0,.57979,1,0,0,.608746,1,0,0,.636185,1,0,0,.664748,1,0,0,.69313,1,0,0,.71966,1,0,0,.747662,1,0,0,.774023,1,0,0,.799775,1,0,0,.825274,1,0,0,.849156,1,0,0,.873248,1,0,0,.89532,1,0,0,.917565,1,0,0,.937863,1,0,0,.958139,1,0,0,.976563,1,0,0,.994658,1,0,0,1.0112,1,0,0,1.02712,1,0,0,1.04189,1,0,0,1.05568,1,0,0,1.06877,1,0,0,1.08058,1,0,0,1.09194,1,0,0,1.10191,1,0,0,1.11161,1,0,0,1.1199,1,0,0,1.12813,.999547,-448815e-12,.0224417,199902e-10,.999495,-113079e-10,.0224406,503651e-9,.999496,-452317e-10,.0224406,.00201461,.999496,-101772e-9,.0224406,.00453287,.999495,-180928e-9,.0224406,.00805845,.999497,-282702e-9,.0224406,.0125914,.999496,-407096e-9,.0224406,.0181319,.999498,-554114e-9,.0224406,.02468,.999499,-723768e-9,.0224406,.0322363,.999495,-916058e-9,.0224405,.0408009,.999499,-.00113101,.0224408,.050375,.999494,-.00136863,.0224405,.0609586,.999489,-.00162896,.0224401,.0725537,.999489,-.00191201,.0224414,.0851619,.999498,-.00221787,.0224413,.0987867,.999492,-.00254642,.0224409,.113426,.999507,-.00289779,.0224417,.129088,.999494,-.0032716,.0224386,.145767,.999546,-.0036673,.0224424,.163472,.999543,-.00408166,.0224387,.182182,.999499,-.00450056,.0224338,.201843,.999503,-.00483661,.0224203,.222198,.999546,-.00452928,.022315,.241714,.999508,-.00587403,.0224329,.262184,.999509,-.00638806,.0224271,.285609,.999501,-.00691028,.0224166,.309998,.999539,-.00741979,.0223989,.335262,.999454,-.00786282,.0223675,.361154,.999529,-.00811928,.0222828,.387224,.999503,-.00799941,.0221063,.41252,.999561,-.00952753,.0223057,.438006,.999557,-.0099134,.0222065,.466735,.999541,-.0100935,.0220402,.495332,.999562,-.00996821,.0218067,.523197,.999556,-.0105031,.0217096,.550223,.999561,-.0114191,.0217215,.579498,.999588,-.0111818,.0213357,.608416,.999633,-.0107725,.0208689,.635965,.999527,-.0121671,.0210149,.664476,.999508,-.0116005,.020431,.692786,.999568,-.0115604,.0199791,.719709,.999671,-.0121117,.0197415,.74737,.999688,-.0110769,.0188846,.773692,.99962,-.0122368,.0188452,.799534,.999823,-.0110325,.0178001,.825046,.999599,-.0114923,.0174221,.849075,.999619,-.0105923,.0164345,.872999,.999613,-.0105988,.0158227,.895371,.99964,-.00979861,.0148131,.917364,.99977,-.00967238,.0140721,.938002,.999726,-.00869175,.0129543,.957917,.99973,-.00866872,.0122329,.976557,.999773,-.00731956,.0108958,.994459,.999811,-.00756027,.0102715,1.01118,.999862,-.00583732,.00878781,1.02701,.999835,-.00631438,.00827529,1.04186,.999871,-.00450785,.00674583,1.05569,.999867,-.00486079,.00621041,1.06861,.999939,-.00322072,.00478301,1.08064,.999918,-.00318199,.00406395,1.09181,1.00003,-.00193348,.00280682,1.10207,.999928,-.00153729,.00198741,1.11152,.999933,-623666e-9,917714e-9,1.12009,1,-102387e-11,907581e-12,1.12813,.997866,-896716e-12,.0448334,199584e-10,.997987,-225945e-10,.0448389,502891e-9,.997987,-903781e-10,.0448388,.00201156,.997985,-203351e-9,.0448388,.00452602,.997986,-361514e-9,.0448388,.00804629,.997987,-56487e-8,.0448389,.0125724,.997988,-813423e-9,.0448389,.0181045,.997984,-.00110718,.0448387,.0246427,.997985,-.00144616,.0448388,.0321875,.997987,-.00183038,.044839,.0407392,.997983,-.00225987,.0448387,.0502986,.997991,-.00273467,.0448389,.0608667,.997984,-.00325481,.0448384,.0724444,.998002,-.00382043,.044839,.0850348,.997997,-.00443145,.0448396,.0986372,.998007,-.00508796,.0448397,.113255,.998008,-.00578985,.04484,.128891,.998003,-.00653683,.0448384,.145548,.997983,-.00732713,.0448358,.163221,.997985,-.00815454,.0448358,.181899,.998005,-.00898985,.0448286,.201533,.998026,-.00964404,.0447934,.221821,.998055,-.00922677,.044611,.241282,.99804,-.0117361,.0448245,.261791,.998048,-.0127628,.0448159,.285181,.998088,-.0138055,.0447996,.30954,.998058,-.0148206,.0447669,.334751,.998099,-.0156998,.044697,.36061,.998116,-.0161976,.0445122,.386603,.998195,-.015945,.0441711,.411844,.998168,-.0183947,.0444255,.43773,.998184,-.0197913,.0443809,.466009,.998251,-.0201426,.0440689,.494574,.998305,-.0198847,.0435632,.522405,.998273,-.0210577,.043414,.549967,.998254,-.0227901,.0433943,.578655,.998349,-.0223108,.0426529,.60758,.99843,-.0223088,.042,.635524,.998373,-.0241141,.0418987,.663621,.998425,-.0231446,.0408118,.691906,.998504,-.0233684,.0400565,.719339,.998443,-.0241652,.0394634,.74643,.99848,-.0228715,.0380002,.773086,.998569,-.023519,.0372322,.798988,.998619,-.0223108,.0356468,.824249,.998594,-.0223105,.034523,.848808,.998622,-.0213426,.0328887,.87227,.998669,-.0207912,.0314374,.895157,.998705,-.0198416,.0296925,.916769,.998786,-.0189168,.0279634,.937773,.998888,-.0178811,.0261597,.957431,.99906,-.0166845,.0242159,.976495,.999038,-.0155464,.0222638,.994169,.999237,-.0141349,.0201967,1.01112,.999378,-.0129324,.0181744,1.02692,.999433,-.0113192,.0159898,1.04174,.999439,-.0101244,.0140385,1.05559,.999614,-.00837456,.0117826,1.06852,.999722,-.00721769,.00983745,1.08069,.999817,-.00554067,.00769002,1.09176,.99983,-.00426961,.005782,1.10211,.999964,-.00273904,.00374503,1.11152,1.00001,-.00136739,.00187176,1.12031,.999946,393227e-10,-28919e-9,1.12804,.995847,-13435e-10,.0671785,19916e-9,.995464,-338387e-10,.0671527,501622e-9,.99547,-135355e-9,.0671531,.00200649,.995471,-30455e-8,.0671532,.00451461,.99547,-541423e-9,.0671531,.008026,.995471,-84598e-8,.0671531,.0125407,.99547,-.00121823,.0671531,.0180589,.99547,-.00165817,.0671531,.0245806,.995463,-.00216583,.0671526,.0321062,.995468,-.00274127,.0671527,.0406366,.995474,-.00338447,.0671534,.0501717,.995473,-.00409554,.0671533,.0607131,.995478,-.00487451,.0671531,.0722618,.995476,-.00572148,.0671532,.0848191,.995477,-.00663658,.0671539,.0983882,.995498,-.00761986,.0671541,.112972,.995509,-.00867094,.0671542,.128568,.995509,-.00978951,.0671531,.145183,.995503,-.0109725,.0671491,.162808,.995501,-.012211,.0671465,.181441,.99553,-.0134565,.0671371,.201015,.99555,-.014391,.0670831,.221206,.99558,-.014351,.0668883,.240813,.995577,-.0173997,.0671055,.261257,.995602,-.0191111,.0671178,.284467,.995623,-.0206705,.0670946,.308765,.995658,-.022184,.0670472,.333905,.995705,-.0234832,.0669417,.359677,.995719,-.0241933,.0666714,.385554,.995786,-.0243539,.066266,.410951,.995887,-.0271866,.0664367,.437163,.995944,-.0296012,.0664931,.464842,.996004,-.0301045,.0660105,.49332,.996128,-.0298311,.0652694,.521131,.996253,-.0316426,.0650739,.549167,.996244,-.0339043,.0649433,.57737,.996309,-.033329,.0638926,.606073,.996417,-.0338935,.0630849,.634527,.996372,-.0353104,.0625083,.66256,.996542,-.0348942,.0611986,.690516,.996568,-.0351614,.060069,.718317,.996711,-.0354317,.0588522,.74528,.996671,-.0349513,.0571902,.772061,.996865,-.0345622,.0555321,.798089,.996802,-.0342566,.0537816,.823178,.996992,-.0330862,.0516095,.847949,.996944,-.0324666,.0495537,.871431,.997146,-.0309544,.0470302,.894357,.997189,-.0299372,.0446043,.916142,.997471,-.0281389,.0418812,.937193,.997515,-.0268702,.0391823,.957,.997812,-.0247166,.0361338,.975936,.998027,-.0233525,.0333945,.99391,.998233,-.0209839,.0301917,1.01075,.998481,-.0194309,.027271,1.02669,.998859,-.0169728,.0240162,1.04173,.99894,-.0152322,.0210517,1.05551,.999132,-.0127497,.0178632,1.06856,.999369,-.0108282,.014787,1.08054,.999549,-.00845886,.0116185,1.09185,.999805,-.0063937,.00867209,1.10207,.99985,-.00414582,.00566823,1.1117,.999912,-.00207443,.00277562,1.12022,1.00001,870226e-10,-53766e-9,1.12832,.991943,-178672e-11,.0893382,198384e-10,.991952,-450183e-10,.089339,499849e-9,.991956,-180074e-9,.0893394,.0019994,.991955,-405167e-9,.0893393,.00449867,.991953,-720298e-9,.0893391,.00799764,.991955,-.00112548,.0893393,.0124964,.991957,-.0016207,.0893395,.0179951,.991958,-.00220601,.0893396,.0244939,.991947,-.00288137,.0893385,.0319929,.991962,-.00364693,.0893399,.0404933,.991965,-.00450264,.0893399,.049995,.99198,-.00544862,.0893411,.0604995,.99197,-.00648491,.0893397,.0720074,.991976,-.00761164,.089341,.0845207,.99198,-.00882891,.0893405,.0980413,.991982,-.0101367,.0893396,.112571,.992008,-.011535,.0893415,.128115,.992026,-.0130228,.0893414,.144672,.992064,-.0145966,.0893418,.162241,.992041,-.0162421,.0893359,.180801,.992086,-.0178888,.0893214,.200302,.992157,-.0190368,.0892401,.220332,.992181,-.0195584,.0890525,.240144,.992175,-.0227257,.0892153,.260728,.99221,-.0254195,.089304,.283473,.99222,-.0274883,.0892703,.307673,.992317,-.0294905,.0892027,.332729,.992374,-.0311861,.0890577,.358387,.992505,-.0320656,.0886994,.384102,.992568,-.0329715,.0883198,.409767,.992675,-.036006,.0883602,.436145,.992746,-.0392897,.0884591,.463217,.992873,-.0399337,.0878287,.491557,.992934,-.040231,.0870108,.519516,.993091,-.0422013,.0865857,.547741,.993259,-.0443503,.0861937,.575792,.993455,-.0446368,.0851187,.604233,.993497,-.0454299,.0840576,.632925,.993694,-.0463296,.0829671,.660985,.993718,-.0470619,.0817185,.688714,.993973,-.0468838,.0800294,.716743,.994207,-.046705,.0781286,.74377,.994168,-.0469698,.0763337,.77042,.9945,-.0456816,.0738184,.796659,.994356,-.0455518,.0715545,.821868,.994747,-.0439488,.0686085,.846572,.994937,-.0430056,.065869,.870435,.995142,-.0413414,.0626446,.893272,.995451,-.0396521,.05929,.915376,.995445,-.0378453,.0558503,.936196,.995967,-.0355219,.0520949,.956376,.996094,-.0335146,.048377,.975327,.996622,-.030682,.0442575,.993471,.996938,-.0285504,.0404693,1.01052,.997383,-.0253399,.0360903,1.02637,.997714,-.0231651,.0322176,1.04139,.998249,-.0198138,.0278433,1.05542,.998596,-.0174337,.0238759,1.06846,.998946,-.0141349,.0195944,1.08056,.99928,-.0115603,.0156279,1.09181,.999507,-.00839065,.0114607,1.10213,.999697,-.005666,.00763325,1.11169,.999869,-.00269902,.00364946,1.12042,1.00001,623836e-10,-319288e-10,1.12832,.987221,-222675e-11,.111332,197456e-10,.98739,-561116e-10,.111351,497563e-9,.987448,-224453e-9,.111357,.00199031,.987441,-505019e-9,.111357,.0044782,.987442,-897816e-9,.111357,.00796129,.987442,-.00140284,.111357,.0124396,.987444,-.00202012,.111357,.0179132,.987442,-.00274964,.111357,.0243824,.987446,-.00359147,.111357,.0318474,.987435,-.00454562,.111356,.0403086,.987461,-.00561225,.111358,.0497678,.987458,-.00679125,.111358,.0602239,.987443,-.0080828,.111356,.0716792,.987476,-.0094872,.111358,.0841364,.98749,-.0110044,.111361,.097597,.987508,-.0126344,.111362,.112062,.987494,-.0143767,.111357,.127533,.987526,-.0162307,.111359,.144015,.987558,-.0181912,.111361,.161502,.987602,-.0202393,.111355,.179979,.987692,-.022273,.111346,.199386,.987702,-.0235306,.111215,.219183,.987789,-.0247628,.111061,.239202,.987776,-.0280668,.111171,.259957,.987856,-.0316751,.111327,.282198,.987912,-.0342468,.111282,.306294,.988,-.0367205,.111198,.331219,.988055,-.0387766,.110994,.356708,.988241,-.0397722,.110547,.382234,.988399,-.0416076,.110198,.408227,.988539,-.0448192,.110137,.434662,.988661,-.0483793,.110143,.461442,.988967,-.0495895,.109453,.489318,.989073,-.0506797,.108628,.517516,.989274,-.0526953,.108003,.545844,.989528,-.054578,.107255,.573823,.989709,-.0561503,.106294,.601944,.989991,-.056866,.104896,.630855,.990392,-.0572914,.103336,.658925,.990374,-.0586224,.10189,.686661,.990747,-.0584764,.099783,.714548,.991041,-.0582662,.0974309,.74186,.991236,-.0584118,.0951678,.768422,.991585,-.0573055,.0921581,.794817,.991984,-.0564241,.0891167,.820336,.9921,-.0553608,.085805,.84493,.992749,-.0533816,.0820354,.868961,.99288,-.0518661,.0782181,.891931,.993511,-.0492492,.0738935,.914186,.993617,-.0471956,.0696402,.93532,.99411,-.044216,.0649659,.95543,.994595,-.0416654,.0603177,.974685,.994976,-.0384314,.0553493,.992807,.995579,-.0353491,.0503942,1.00996,.996069,-.0319787,.0452123,1.02606,.996718,-.028472,.0400112,1.04114,.997173,-.0250789,.0349456,1.05517,.997818,-.0213326,.029653,1.0683,.998318,-.0178509,.024549,1.0805,.998853,-.0141118,.0194197,1.09177,.999218,-.0105914,.0143869,1.1022,.999594,-.00693474,.00943517,1.11175,.99975,-.00340478,.00464051,1.12056,1.00001,109172e-9,-112821e-9,1.12853,.983383,-266524e-11,.133358,196534e-10,.981942,-671009e-10,.133162,494804e-9,.981946,-268405e-9,.133163,.00197923,.981944,-603912e-9,.133163,.00445326,.981941,-.00107362,.133162,.00791693,.981946,-.00167755,.133163,.0123703,.981944,-.00241569,.133162,.0178135,.981945,-.00328807,.133163,.0242466,.981945,-.00429472,.133162,.03167,.981955,-.00543573,.133164,.0400846,.981951,-.00671105,.133163,.0494901,.981968,-.00812092,.133165,.0598886,.981979,-.00966541,.133166,.0712811,.981996,-.0113446,.133168,.083669,.982014,-.0131585,.133169,.0970533,.982011,-.0151073,.133167,.111438,.982062,-.0171906,.133172,.126826,.9821,-.0194067,.133175,.143215,.982149,-.0217502,.133176,.160609,.982163,-.0241945,.133173,.178981,.982247,-.0265907,.133148,.198249,.982291,-.027916,.132974,.217795,.982396,-.0299663,.132868,.238042,.982456,-.0334544,.132934,.258901,.982499,-.0378636,.133137,.280639,.982617,-.0409274,.133085,.304604,.98274,-.0438523,.132985,.329376,.982944,-.0462288,.132728,.354697,.98308,-.0475995,.132228,.380102,.983391,-.0501901,.131924,.406256,.983514,-.0535899,.131737,.432735,.98373,-.0571858,.131567,.459359,.984056,-.0592353,.130932,.486637,.984234,-.0610488,.130092,.51509,.984748,-.0630758,.12923,.543461,.985073,-.0647398,.128174,.571376,.985195,-.0671941,.127133,.599414,.985734,-.0681345,.125576,.628134,.986241,-.0686089,.123639,.656399,.986356,-.0698511,.121834,.684258,.986894,-.0700931,.119454,.711818,.987382,-.0698321,.116718,.739511,.988109,-.0693975,.113699,.766267,.988363,-.0689584,.110454,.792456,.989112,-.0672353,.106602,.81813,.989241,-.0662034,.10267,.842889,.990333,-.0638938,.0981381,.867204,.990591,-.0618534,.0935388,.89038,.991106,-.0593117,.088553,.912576,.991919,-.0562676,.0832187,.934118,.992111,-.0534085,.0778302,.954254,.992997,-.0495459,.0720453,.973722,.993317,-.0463707,.0663458,.991949,.994133,-.0421245,.0601883,1.00936,.994705,-.0384977,.0542501,1.02559,.995495,-.0340956,.0479862,1.04083,.996206,-.030105,.041887,1.05497,.996971,-.0256095,.0355355,1.06824,.997796,-.0213932,.0293655,1.08056,.998272,-.0169612,.0232926,1.09182,.998857,-.0126756,.0172786,1.10219,.99939,-.00832486,.0113156,1.11192,.999752,-.00410826,.00557892,1.12075,1,150957e-9,-119101e-9,1.12885,.975169,-309397e-11,.154669,195073e-10,.975439,-779608e-10,.154712,491534e-9,.975464,-311847e-9,.154716,.00196617,.975464,-701656e-9,.154716,.00442387,.975462,-.0012474,.154715,.0078647,.975461,-.00194906,.154715,.0122886,.975464,-.00280667,.154715,.0176959,.975468,-.00382025,.154716,.0240867,.975471,-.00498985,.154716,.0314612,.975472,-.00631541,.154717,.0398199,.975486,-.00779719,.154718,.0491639,.975489,-.00943505,.154718,.0594932,.975509,-.0112295,.154721,.0708113,.97554,-.0131802,.154724,.0831176,.975557,-.0152876,.154726,.096415,.975585,-.0175512,.154728,.110705,.975605,-.0199713,.154729,.125992,.975645,-.0225447,.154729,.142272,.975711,-.0252649,.154735,.159549,.975788,-.0280986,.154736,.177805,.975872,-.0308232,.154704,.196911,.975968,-.0324841,.154525,.216324,.976063,-.0351281,.154432,.236628,.976157,-.0388618,.15446,.257539,.976204,-.0437704,.154665,.278975,.976358,-.047514,.154652,.302606,.976571,-.0508638,.154535,.327204,.976725,-.0534995,.154221,.352276,.977013,-.0555547,.153737,.377696,.977294,-.0586728,.153403,.403855,.977602,-.0622715,.15312,.430333,.977932,-.0658166,.152755,.456855,.978241,-.0689877,.152233,.483668,.978602,-.0712805,.15132,.512097,.979234,-.0732775,.150235,.540455,.97977,-.075163,.148978,.568486,.979995,-.0778026,.147755,.596524,.98078,-.0791854,.146019,.624825,.981628,-.0799666,.143906,.653403,.982067,-.0808532,.141561,.681445,.98271,-.0816024,.139025,.708918,.983734,-.0812511,.135764,.736594,.98431,-.0806201,.132152,.763576,.985071,-.0801605,.12846,.789797,.98618,-.0784208,.124084,.815804,.986886,-.0766643,.1193,.840869,.987485,-.0747744,.114236,.864952,.988431,-.0716701,.108654,.888431,.988886,-.0691609,.102994,.910963,.990024,-.0654048,.0967278,.932629,.990401,-.0619765,.090384,.95313,.991093,-.0579296,.0837885,.972587,.992018,-.0536576,.0770171,.991184,.992536,-.0493719,.0701486,1.00863,.993421,-.0444813,.062953,1.02494,.993928,-.040008,.0560455,1.04017,.994994,-.0347982,.04856,1.05463,.995866,-.0301017,.0416152,1.06807,.996916,-.0248225,.0342597,1.08039,.997766,-.0199229,.0271668,1.09177,.998479,-.0147422,.0201387,1.10235,.99921,-.00980173,.0131944,1.11206,.999652,-.0047426,.00640712,1.12104,.999998,891673e-10,-10379e-8,1.12906,.967868,-351885e-11,.175947,193569e-10,.968001,-886733e-10,.175972,487782e-9,.96801,-354697e-9,.175973,.00195115,.968012,-798063e-9,.175974,.00439006,.968011,-.00141879,.175973,.00780461,.968011,-.00221686,.175973,.0121948,.968016,-.00319231,.175974,.0175607,.968019,-.00434515,.175974,.0239027,.968018,-.00567538,.175974,.0312208,.968033,-.00718308,.175977,.0395158,.968049,-.00886836,.175979,.0487885,.968047,-.0107312,.175978,.0590394,.968072,-.0127719,.175981,.0702705,.968108,-.0149905,.175986,.0824836,.968112,-.0173866,.175985,.0956783,.968173,-.0199611,.175993,.109862,.96827,-.0227128,.176008,.125033,.968292,-.025639,.17601,.141193,.968339,-.0287299,.176007,.158336,.968389,-.0319399,.176001,.176441,.968501,-.034941,.175962,.195359,.968646,-.0370812,.175793,.214686,.968789,-.0402329,.175708,.234973,.96886,-.0442601,.1757,.255871,.969013,-.049398,.175876,.277238,.969242,-.0539932,.17594,.300326,.969419,-.0577299,.175781,.324702,.969763,-.0605643,.175432,.349527,.970093,-.0634488,.174992,.374976,.970361,-.0670589,.174611,.401097,.970825,-.0708246,.174226,.427496,.971214,-.0742871,.173684,.453858,.971622,-.0782608,.173186,.480637,.972175,-.0813151,.172288,.508655,.972944,-.0832678,.170979,.536973,.973595,-.0855964,.169573,.565138,.974345,-.0882163,.168152,.593222,.975233,-.0901671,.166314,.621201,.976239,-.0912111,.163931,.649919,.977289,-.0916959,.161106,.678011,.978076,-.0927061,.158272,.705717,.979533,-.0925562,.15475,.733228,.980335,-.0918159,.150638,.760454,.981808,-.0908508,.146201,.786918,.983061,-.0896172,.141386,.812953,.984148,-.0871588,.135837,.838281,.985047,-.0850624,.130135,.862594,.986219,-.0818541,.123882,.88633,.987043,-.0784523,.117126,.908952,.988107,-.0749601,.110341,.930744,.988955,-.0703548,.102885,.951728,.989426,-.0662798,.0954167,.971166,.990421,-.0610834,.0876331,.989984,.991032,-.0562936,.0797785,1.00765,.992041,-.0508154,.0718166,1.02434,.992794,-.0454045,.0637125,1.03976,.993691,-.0398194,.0555338,1.05418,.994778,-.0341482,.0473388,1.06772,.995915,-.028428,.0391016,1.08028,.997109,-.022642,.0309953,1.09185,.998095,-.0168738,.0230288,1.10247,.998985,-.0111274,.0150722,1.11229,.999581,-.00543881,.00740605,1.12131,1.00003,162239e-9,-105549e-9,1.12946,.959505,-393734e-11,.196876,191893e-10,.959599,-992157e-10,.196895,483544e-9,.959641,-396868e-9,.196903,.0019342,.959599,-892948e-9,.196895,.00435193,.959603,-.00158747,.196896,.0077368,.959604,-.00248042,.196896,.0120888,.959605,-.00357184,.196896,.0174082,.959605,-.00486169,.196896,.0236949,.959613,-.00635008,.196897,.0309497,.959619,-.00803696,.196898,.0391725,.959636,-.00992255,.196901,.0483649,.959634,-.0120067,.1969,.0585266,.959675,-.0142898,.196906,.0696609,.959712,-.0167717,.196911,.0817678,.959752,-.0194524,.196918,.0948494,.959807,-.0223321,.196925,.10891,.959828,-.0254091,.196924,.123947,.959906,-.0286815,.196934,.139968,.960005,-.0321371,.196944,.156968,.960071,-.0357114,.196936,.17491,.960237,-.0389064,.196882,.193597,.960367,-.041623,.196731,.21285,.960562,-.0452655,.196654,.233075,.960735,-.0496207,.196643,.253941,.960913,-.0549379,.196774,.275278,.961121,-.0603414,.196893,.297733,.96139,-.0644244,.196717,.321877,.961818,-.067556,.196314,.346476,.962175,-.0712709,.195917,.371907,.96255,-.0752848,.1955,.397916,.963164,-.0792073,.195026,.424229,.963782,-.0828225,.194424,.450637,.964306,-.0873119,.193831,.477288,.964923,-.0911051,.192973,.504716,.966048,-.093251,.19151,.533053,.967024,-.0958983,.190013,.561366,.968038,-.09835,.188253,.589464,.969152,-.100754,.186257,.617433,.970557,-.102239,.183775,.645801,.972104,-.102767,.180645,.674278,.973203,-.103492,.177242,.702004,.975123,-.103793,.17345,.729529,.97641,-.102839,.168886,.756712,.978313,-.101687,.163892,.783801,.980036,-.100314,.158439,.809671,.981339,-.097836,.152211,.835402,.982794,-.0950006,.145679,.860081,.984123,-.0920994,.138949,.883757,.984918,-.0878641,.131283,.90685,.985999,-.083939,.123464,.928786,.987151,-.0791234,.115324,.94983,.987827,-.0739332,.106854,.96962,.988806,-.0688088,.0982691,.98861,.989588,-.0628962,.0893456,1.00667,.990438,-.0573146,.0805392,1.02344,.991506,-.0509433,.0713725,1.03933,.992492,-.0448724,.0623732,1.05378,.993663,-.0383497,.0530838,1.06747,.994956,-.0319593,.0439512,1.08007,.99634,-.025401,.0347803,1.09182,.99761,-.0189687,.0257954,1.1025,.99863,-.0124441,.0169893,1.11247,.99947,-.00614003,.00829498,1.12151,1.00008,216624e-9,-146107e-9,1.12993,.950129,-434955e-11,.217413,190081e-10,.950264,-10957e-8,.217444,47884e-8,.9503,-438299e-9,.217451,.00191543,.950246,-986124e-9,.21744,.00430951,.950246,-.00175311,.21744,.00766137,.950245,-.00273923,.21744,.011971,.950253,-.00394453,.217441,.0172385,.950258,-.00536897,.217442,.0234641,.950267,-.00701262,.217444,.030648,.950277,-.00887551,.217446,.038791,.950284,-.0109576,.217446,.0478931,.950312,-.0132591,.217451,.0579568,.950334,-.01578,.217454,.0689821,.950378,-.0185204,.217462,.0809714,.950417,-.0214803,.217467,.0939265,.950488,-.0246594,.217479,.10785,.950534,-.0280565,.217483,.122743,.950633,-.0316685,.217498,.138611,.950698,-.0354787,.217499,.155442,.950844,-.0394003,.217507,.173208,.950999,-.0426812,.217419,.191605,.951221,-.0461302,.217317,.21084,.951412,-.0502131,.217238,.230945,.951623,-.0549183,.21722,.251745,.951867,-.0604493,.217306,.273001,.952069,-.0665189,.217466,.294874,.952459,-.0709179,.217266,.318732,.952996,-.0746112,.216891,.34318,.953425,-.0789252,.216503,.36849,.953885,-.0833293,.216042,.394373,.954617,-.087371,.215469,.420505,.955429,-.0914054,.214802,.446907,.956068,-.0961671,.214146,.473522,.957094,-.10048,.213286,.50052,.958372,-.103248,.211796,.528715,.959654,-.106033,.21016,.557065,.961305,-.108384,.208149,.585286,.962785,-.111122,.206024,.613334,.964848,-.112981,.203442,.641334,.966498,-.113717,.19996,.669955,.968678,-.114121,.196105,.698094,.970489,-.114524,.191906,.725643,.972903,-.113792,.186963,.752856,.974701,-.112406,.181343,.780013,.976718,-.110685,.175185,.806268,.978905,-.108468,.168535,.832073,.980267,-.105061,.161106,.857149,.981967,-.101675,.153387,.881145,.983063,-.0974492,.145199,.904255,.984432,-.0925815,.136527,.926686,.985734,-.0877983,.127584,.947901,.986228,-.081884,.118125,.968111,.98719,-.0761208,.108594,.98719,.988228,-.0698196,.0989996,1.00559,.989046,-.0632739,.0890074,1.02246,.990242,-.056522,.0790832,1.03841,.991252,-.0495272,.0689182,1.05347,.992542,-.0425373,.0588592,1.06724,.994096,-.0353198,.0486833,1.08009,.995593,-.028235,.0385977,1.09177,.99711,-.0209511,.0286457,1.10274,.998263,-.0139289,.0188497,1.11262,.999254,-.0067359,.009208,1.12191,.999967,141846e-9,-657764e-10,1.13024,.935608,-474692e-11,.236466,187817e-10,.93996,-11971e-8,.237568,473646e-9,.939959,-478845e-9,.237567,.0018946,.939954,-.0010774,.237566,.00426284,.939956,-.00191538,.237566,.00757842,.939954,-.00299277,.237566,.0118413,.93996,-.00430961,.237567,.0170518,.939969,-.00586589,.237569,.02321,.939982,-.00766166,.237572,.0303164,.939987,-.00969686,.237572,.0383711,.939997,-.0119715,.237574,.0473751,.940031,-.0144858,.237581,.0573298,.940073,-.0172399,.237589,.0682366,.94012,-.0202335,.237598,.080097,.940162,-.0234663,.237604,.0929116,.940237,-.0269387,.237615,.106686,.940328,-.0306489,.237632,.121421,.940419,-.0345917,.237645,.137115,.940522,-.0387481,.237654,.153766,.940702,-.0429906,.237661,.17133,.940871,-.0465089,.237561,.189502,.941103,-.050531,.23748,.208616,.941369,-.0550657,.237423,.228595,.941641,-.0601337,.237399,.249287,.941903,-.0658804,.237443,.270467,.942224,-.0722674,.237597,.292024,.942633,-.0771788,.237419,.315272,.943172,-.0815623,.237068,.339579,.943691,-.0863973,.236682,.364717,.944382,-.0911536,.236213,.390435,.945392,-.0952967,.235562,.416425,.946185,-.0998948,.234832,.442772,.947212,-.104796,.234114,.469347,.948778,-.10928,.233222,.496162,.950149,-.113081,.231845,.523978,.951989,-.115893,.230005,.552295,.953921,-.11846,.227862,.580569,.955624,-.12115,.225439,.608698,.958234,-.123373,.222635,.636696,.960593,-.124519,.219093,.665208,.963201,-.124736,.214749,.693557,.965642,-.125012,.210059,.721334,.968765,-.124661,.204935,.748613,.971753,-.122996,.198661,.776224,.973751,-.120998,.191823,.802461,.976709,-.118583,.184359,.828399,.977956,-.115102,.176437,.853693,.979672,-.111077,.167681,.877962,.981816,-.10688,.158872,.901564,.98238,-.101469,.149398,.924057,.983964,-.0960013,.139436,.945751,.984933,-.0899626,.12943,.966272,.985694,-.0832973,.11894,.985741,.986822,-.0767082,.108349,1.00407,.987725,-.0693614,.0976026,1.02154,.98877,-.06211,.086652,1.03757,.990129,-.0544143,.0756182,1.05296,.991337,-.046744,.0645753,1.06683,.992978,-.0387931,.0534683,1.0798,.994676,-.030973,.0424137,1.09181,.99645,-.0230311,.0314035,1.10286,.997967,-.0152065,.0206869,1.11291,.99922,-.00744837,.010155,1.12237,1.00002,240209e-9,-752767e-10,1.13089,.922948,-515351e-11,.255626,186069e-10,.928785,-129623e-9,.257244,468009e-9,.928761,-51849e-8,.257237,.00187202,.928751,-.0011666,.257235,.00421204,.928751,-.00207395,.257234,.0074881,.928754,-.00324055,.257235,.0117002,.92876,-.00466639,.257236,.0168486,.928763,-.00635149,.257237,.0229334,.928774,-.00829584,.257239,.029955,.928791,-.0104995,.257243,.0379139,.928804,-.0129623,.257245,.0468108,.928847,-.0156846,.257255,.0566473,.92889,-.0186661,.257263,.0674246,.928924,-.0219067,.257268,.0791433,.928989,-.0254066,.257282,.0918076,.92909,-.0291651,.257301,.105419,.92918,-.0331801,.257316,.119978,.92929,-.0374469,.257332,.135491,.929453,-.041939,.257357,.151948,.929586,-.0464612,.257347,.169275,.929858,-.0503426,.257269,.187257,.930125,-.0548409,.257199,.206204,.930403,-.0598063,.257149,.22601,.930726,-.0652437,.257122,.246561,.931098,-.0712376,.257153,.267618,.931396,-.0777506,.257237,.288993,.931947,-.0832374,.257124,.311527,.932579,-.0883955,.25683,.335697,.933194,-.0937037,.256444,.360634,.934013,-.0987292,.255939,.386126,.935307,-.103215,.255282,.412018,.936374,-.108234,.254538,.438292,.93776,-.113234,.253728,.464805,.939599,-.118013,.25275,.491464,.941036,-.122661,.251404,.518751,.94337,-.125477,.249435,.547133,.945318,-.128374,.247113,.575456,.947995,-.130996,.244441,.60372,.950818,-.133438,.241352,.63174,.954378,-.135004,.237849,.659971,.957151,-.135313,.233188,.688478,.960743,-.13521,.228001,.716767,.964352,-.135007,.222249,.744349,.967273,-.133523,.21542,.771786,.969767,-.131155,.208039,.798639,.973195,-.128492,.200076,.824774,.975557,-.125094,.191451,.850222,.977692,-.120578,.18184,.874761,.98026,-.115882,.172102,.898497,.981394,-.110372,.161859,.921636,.982386,-.10415,.15108,.943467,.983783,-.0978128,.140407,.964045,.98422,-.0906171,.129058,.98398,.985447,-.0832921,.117614,1.00276,.986682,-.0754412,.10585,1.02047,.987326,-.0673885,.0940943,1.03678,.988707,-.0592565,.0822093,1.05218,.990185,-.050717,.070192,1.06652,.991866,-.0423486,.0582081,1.07965,.993897,-.0336118,.0460985,1.09188,.995841,-.0252178,.0342737,1.10307,.997605,-.0164893,.0224829,1.11324,.999037,-.00817112,.0110647,1.12262,1.00003,291686e-9,-168673e-9,1.13139,.915304,-552675e-11,.275999,183285e-10,.91668,-139285e-9,.276414,461914e-9,.916664,-55713e-8,.276409,.00184763,.916653,-.00125354,.276406,.00415715,.916651,-.00222851,.276405,.00739053,.916655,-.00348205,.276406,.0115478,.916653,-.00501414,.276405,.0166291,.916667,-.00682478,.276409,.0226346,.91668,-.00891398,.276412,.0295648,.91669,-.0112817,.276413,.0374199,.916727,-.013928,.276422,.0462016,.916759,-.0168528,.276429,.0559101,.916793,-.0200558,.276436,.0665466,.916849,-.0235373,.276448,.0781139,.916964,-.0272973,.276474,.0906156,.917047,-.0313344,.276491,.104051,.917152,-.0356465,.276511,.118424,.917286,-.0402271,.276533,.133736,.917469,-.0450408,.276564,.149978,.917686,-.0497872,.276563,.167057,.917953,-.0540937,.276493,.184846,.918228,-.0590709,.276437,.203614,.918572,-.0644277,.276398,.223212,.918918,-.0702326,.276362,.243584,.919356,-.076484,.276383,.264465,.919842,-.0830808,.276434,.285701,.920451,-.0892972,.276407,.307559,.921113,-.095016,.276128,.331501,.921881,-.100771,.275754,.356207,.923027,-.106029,.275254,.381477,.924364,-.111029,.274595,.40722,.925818,-.116345,.273841,.433385,.92746,-.121424,.272913,.459848,.929167,-.12657,.271837,.486493,.931426,-.131581,.270575,.513432,.934001,-.135038,.268512,.541502,.936296,-.138039,.266135,.569658,.939985,-.140687,.263271,.598375,.943516,-.143247,.260058,.626563,.94782,-.145135,.256138,.654711,.951023,-.145733,.251154,.683285,.955338,-.145554,.245562,.711831,.959629,-.145008,.239265,.739573,.963123,-.144003,.232064,.767027,.966742,-.141289,.224036,.794359,.969991,-.138247,.215305,.820361,.973403,-.134786,.206051,.846548,.975317,-.129966,.195914,.871541,.977647,-.12471,.185184,.895313,.980137,-.119086,.174161,.918398,.981031,-.112297,.162792,.940679,.982037,-.105372,.150952,.961991,.983164,-.097821,.138921,.981913,.983757,-.0897245,.126611,1.00109,.985036,-.0815974,.114228,1.01902,.986289,-.0727725,.101389,1.03604,.987329,-.0639323,.0886476,1.05149,.989193,-.0548109,.0756837,1.06619,.990716,-.045687,.0627581,1.07948,.992769,-.0364315,.0498337,1.09172,.99524,-.0271761,.0370305,1.1033,.997154,-.0179609,.0243959,1.11353,.998845,-.00878063,.0119567,1.12319,1.00002,259038e-9,-108146e-9,1.13177,.903945,-591681e-11,.295126,181226e-10,.903668,-148672e-9,.295037,455367e-9,.903677,-594683e-9,.29504,.00182145,.903673,-.00133805,.295039,.00409831,.903666,-.00237872,.295036,.00728584,.903668,-.00371676,.295037,.0113842,.903679,-.00535212,.29504,.0163936,.903684,-.00728479,.295041,.0223141,.903698,-.00951473,.295044,.0291462,.903718,-.0120419,.295049,.0368904,.903754,-.0148664,.295058,.0455477,.903801,-.017988,.29507,.0551194,.903851,-.0214064,.295082,.0656058,.903921,-.0251219,.295097,.0770109,.904002,-.0291337,.295116,.0893354,.904111,-.033441,.29514,.102583,.904246,-.0380415,.295169,.116755,.904408,-.0429258,.295202,.131853,.904637,-.0480468,.295245,.147869,.904821,-.0529208,.295214,.164658,.905163,-.0577748,.295185,.182274,.905469,-.0631763,.295143,.200828,.905851,-.068917,.295112,.2202,.906322,-.0750861,.295104,.240372,.906761,-.0815855,.295086,.261082,.90735,-.0882138,.295095,.282123,.908087,-.095082,.295139,.303563,.908826,-.101488,.29492,.327028,.909832,-.107577,.294577,.351464,.911393,-.113033,.294115,.376497,.912804,-.118629,.293446,.402115,.914081,-.124232,.292581,.428111,.91637,-.129399,.29166,.454442,.91814,-.134892,.290422,.481024,.921179,-.140069,.289194,.507924,.924544,-.144431,.287421,.535557,.927995,-.147498,.284867,.563984,.931556,-.150197,.281722,.5923,.935777,-.152711,.278207,.620832,.940869,-.154836,.274148,.649069,.945994,-.155912,.269057,.677746,.949634,-.155641,.262799,.706293,.955032,-.154809,.256097,.734278,.95917,-.153678,.248618,.761751,.962931,-.151253,.239794,.789032,.966045,-.147625,.230281,.815422,.96971,-.143964,.220382,.841787,.972747,-.139464,.209846,.867446,.975545,-.133459,.198189,.892004,.978381,-.127424,.186362,.915458,.979935,-.120506,.173964,.937948,.980948,-.11282,.161429,.959732,.982234,-.104941,.148557,.980118,.982767,-.0962905,.135508,.999463,.983544,-.0873625,.122338,1.01756,.984965,-.0783447,.108669,1.03492,.986233,-.0684798,.0949911,1.05087,.987796,-.0590867,.0811386,1.0656,.989885,-.0489145,.0673099,1.0794,.991821,-.0391,.0535665,1.09174,.99448,-.029087,.0397529,1.10341,.996769,-.019114,.0261463,1.11383,.998641,-.00947007,.0128731,1.1237,.999978,446316e-9,-169093e-9,1.13253,.888362,-627064e-11,.312578,178215e-10,.889988,-157791e-9,.313148,448451e-9,.889825,-631076e-9,.313092,.00179356,.88984,-.00141994,.313097,.00403554,.889828,-.0025243,.313092,.00717429,.889831,-.00394421,.313093,.0112099,.889831,-.00567962,.313093,.0161425,.889844,-.00773051,.313096,.0219724,.889858,-.0100968,.3131,.0286999,.889882,-.0127786,.313106,.0363256,.889918,-.0157757,.313116,.0448509,.889967,-.0190878,.313129,.0542758,.89003,-.022715,.313145,.0646032,.890108,-.0266566,.313165,.0758339,.890218,-.0309131,.313193,.0879729,.890351,-.0354819,.313226,.101019,.89051,-.0403613,.313263,.114979,.890672,-.0455385,.313294,.129848,.890882,-.0509444,.313333,.145616,.891189,-.0559657,.313324,.162122,.891457,-.0613123,.313281,.179524,.891856,-.0671488,.313281,.197855,.892312,-.0732732,.313268,.216991,.892819,-.0797865,.313263,.236924,.893369,-.0865269,.313247,.257433,.894045,-.0931592,.313205,.278215,.894884,-.100532,.313276,.299467,.895832,-.107716,.313205,.322276,.897043,-.114099,.312873,.34642,.898515,-.119941,.312331,.371187,.900191,-.126044,.311731,.396656,.90188,-.131808,.310859,.422488,.904359,-.137289,.309857,.448744,.906923,-.142991,.308714,.475239,.910634,-.148253,.307465,.501983,.914502,-.153332,.305774,.529254,.919046,-.156646,.303156,.557709,.923194,-.159612,.299928,.586267,.928858,-.162027,.296245,.614925,.934464,-.164203,.291832,.643187,.939824,-.165602,.286565,.671601,.944582,-.165383,.280073,.700213,.949257,-.164439,.272891,.728432,.954389,-.162953,.264771,.756082,.958595,-.161007,.255927,.78369,.962138,-.157243,.245769,.810769,.966979,-.152872,.235127,.836999,.969566,-.148209,.22347,.862684,.972372,-.142211,.211147,.887847,.975916,-.135458,.198606,.911843,.978026,-.128398,.185498,.934795,.979686,-.120313,.17171,.956787,.980748,-.11166,.158159,.978046,.981622,-.103035,.144399,.997693,.982356,-.0930328,.13001,1.01642,.983308,-.0834627,.115778,1.03366,.985037,-.0732249,.101327,1.05014,.986493,-.0628145,.086554,1.06507,.988484,-.0526556,.0720413,1.07907,.991051,-.0415744,.0571151,1.09189,.993523,-.0314275,.0426643,1.10369,.99628,-.0203603,.0279325,1.11423,.998344,-.0102446,.0138182,1.12421,.999997,42612e-8,-193628e-9,1.1333,.871555,-660007e-11,.329176,174749e-10,.875255,-166579e-9,.330571,441051e-9,.875644,-666394e-9,.330718,.00176441,.875159,-.00149903,.330536,.00396899,.87516,-.00266493,.330536,.007056,.875158,-.00416393,.330535,.0110251,.87516,-.00599598,.330535,.0158764,.875163,-.00816108,.330536,.0216101,.875174,-.0106591,.330538,.0282266,.875199,-.0134899,.330545,.0357266,.875257,-.0166538,.330563,.0441117,.875304,-.0201501,.330575,.0533821,.875373,-.0239785,.330595,.0635395,.875464,-.0281389,.330619,.0745872,.875565,-.0326301,.330645,.0865255,.875691,-.0374516,.330676,.0993599,.875897,-.0425993,.330733,.113093,.876091,-.0480576,.330776,.127722,.876353,-.0537216,.330826,.143227,.876649,-.0589807,.330809,.159462,.877034,-.0647865,.330819,.176642,.877443,-.0709789,.330817,.194702,.877956,-.0774782,.330832,.213577,.878499,-.0843175,.330822,.233246,.879144,-.0912714,.330804,.253512,.879982,-.0980824,.330766,.274137,.88097,-.105823,.330864,.295209,.882051,-.113671,.330896,.317226,.883397,-.120303,.330545,.341068,.884987,-.12667,.330068,.365613,.886789,-.133118,.329418,.390807,.889311,-.139024,.328683,.416494,.891995,-.144971,.327729,.442618,.895106,-.150747,.326521,.469131,.899527,-.156283,.325229,.495921,.90504,-.161707,.32378,.523162,.909875,-.165661,.32122,.55092,.91561,-.168755,.317942,.579928,.921225,-.171193,.313983,.608539,.927308,-.17319,.309636,.636854,.933077,-.174819,.304262,.66523,.938766,-.175002,.297563,.693609,.943667,-.173946,.289613,.722157,.949033,-.172221,.281227,.750021,.953765,-.169869,.271545,.777466,.95804,-.166578,.261034,.804853,.962302,-.161761,.249434,.831569,.966544,-.156636,.237484,.857779,.969372,-.150784,.224395,.883051,.972486,-.143672,.210786,.907864,.975853,-.135772,.196556,.931223,.977975,-.127942,.182307,.954061,.979122,-.118347,.167607,.97531,.980719,-.109112,.152739,.995666,.981223,-.0991789,.137932,1.01475,.98216,-.0883553,.122692,1.03253,.983379,-.0780825,.107493,1.04917,.985434,-.0665646,.0917791,1.06464,.987332,-.0557714,.0764949,1.07896,.990004,-.0442805,.060721,1.09199,.992975,-.0331676,.0452284,1.10393,.995811,-.0219547,.0297934,1.11476,.9982,-.0107613,.0146415,1.12484,1.00002,248678e-9,-14555e-8,1.13413,.859519,-693595e-11,.347264,171673e-10,.859843,-17503e-8,.347394,433219e-9,.859656,-700076e-9,.347319,.00173277,.859671,-.00157517,.347325,.00389875,.859669,-.00280028,.347324,.00693112,.85967,-.0043754,.347324,.01083,.859665,-.00630049,.347321,.0155954,.859685,-.0085755,.347328,.0212278,.859694,-.0112003,.347329,.0277273,.859718,-.0141747,.347336,.0350946,.85976,-.0174988,.347348,.0433314,.85982,-.0211722,.347366,.0524384,.859892,-.0251941,.347387,.0624168,.860006,-.0295649,.347422,.0732708,.860122,-.0342825,.347453,.0849999,.860282,-.0393462,.347499,.0976102,.860482,-.0447513,.347554,.111104,.860719,-.0504775,.347614,.125479,.860998,-.0563577,.347666,.140703,.861322,-.0619473,.347662,.156681,.861724,-.0681277,.347684,.173597,.862198,-.0746567,.347709,.191371,.862733,-.0815234,.347727,.209976,.863371,-.0886643,.347744,.229351,.86414,-.0957908,.347734,.24934,.865138,-.102912,.34772,.269797,.866182,-.110924,.3478,.290654,.867436,-.119223,.347911,.312074,.869087,-.126197,.347649,.335438,.870859,-.133145,.347222,.359732,.872997,-.139869,.346645,.38467,.875939,-.146089,.345935,.41019,.879012,-.152334,.345012,.436218,.883353,-.15821,.343924,.462641,.888362,-.164097,.342636,.489449,.895026,-.169528,.341351,.516629,.900753,-.174408,.339115,.544109,.906814,-.17751,.335809,.572857,.912855,-.180101,.331597,.601554,.919438,-.182116,.32698,.630198,.925962,-.183494,.321449,.658404,.931734,-.184159,.314595,.686625,.93762,-.18304,.306462,.71531,.943858,-.181323,.297514,.744272,.948662,-.178683,.287447,.771462,.953299,-.175379,.276166,.798593,.957346,-.170395,.263758,.8256,.962565,-.165042,.251019,.852575,.966075,-.158655,.237011,.878316,.969048,-.151707,.222518,.90329,.972423,-.143271,.207848,.927745,.975833,-.134824,.192463,.950859,.977629,-.125444,.1768,.972947,.978995,-.114949,.161033,.993263,.980533,-.104936,.145523,1.01337,.980745,-.0935577,.129799,1.03128,.981814,-.0822956,.113486,1.04825,.983943,-.0710082,.0972925,1.06405,.986141,-.0587931,.0808138,1.0785,.988878,-.0472755,.0644915,1.09204,.992132,-.0349128,.0478128,1.10413,.9953,-.0232407,.031621,1.11527,.998117,-.0112713,.0154935,1.12551,1.00003,339743e-9,-195763e-9,1.13504,.845441,-729126e-11,.364305,169208e-10,.843588,-183164e-9,.363506,425067e-9,.843412,-73253e-8,.36343,.00169999,.843401,-.00164818,.363426,.00382495,.843399,-.00293008,.363425,.00679993,.843401,-.00457822,.363425,.010625,.843394,-.00659249,.363421,.0153002,.843398,-.00897282,.363421,.0208258,.843415,-.0117191,.363426,.0272024,.843438,-.0148312,.363432,.0344305,.843483,-.018309,.363447,.0425116,.84356,-.0221521,.363472,.0514471,.843646,-.0263597,.363499,.061238,.843743,-.0309315,.363527,.0718873,.84388,-.0358658,.363569,.0833969,.844079,-.0411624,.363631,.0957742,.844279,-.0468128,.363688,.109015,.844549,-.0527923,.363761,.123124,.844858,-.0588204,.363817,.138044,.84522,-.0647573,.36383,.153755,.845669,-.0713181,.363879,.170394,.846155,-.0781697,.363908,.187861,.846789,-.0853913,.363969,.206176,.847502,-.0928086,.363999,.225244,.8484,-.10005,.363997,.244926,.849461,-.107615,.364008,.265188,.850562,-.115814,.364055,.28587,.851962,-.124334,.364179,.306926,.854326,-.131995,.364233,.329605,.856295,-.139338,.363856,.35359,.858857,-.146346,.363347,.37831,.862428,-.152994,.362807,.403722,.866203,-.159463,.361963,.429537,.871629,-.165623,.36112,.456,.877365,-.171649,.359917,.482773,.883744,-.177151,.35848,.509705,.890693,-.182381,.356523,.537215,.897278,-.186076,.3533,.565493,.903958,-.188602,.349095,.594293,.910908,-.190755,.344215,.623165,.918117,-.192063,.338606,.651573,.924644,-.192758,.331544,.679869,.931054,-.192238,.323163,.708668,.937303,-.190035,.313529,.737201,.943387,-.187162,.303152,.764977,.948494,-.183876,.29146,.792683,.952546,-.178901,.277917,.819228,.958077,-.173173,.264753,.846559,.962462,-.16645,.25002,.872962,.966569,-.159452,.234873,.898729,.969108,-.15074,.218752,.923126,.973072,-.141523,.202673,.947278,.975452,-.132075,.186326,.969938,.977784,-.121257,.169396,.991325,.97899,-.110182,.153044,1.01123,.979777,-.0989634,.136485,1.0299,.980865,-.0865894,.119343,1.04727,.982432,-.0746115,.102452,1.06341,.984935,-.0621822,.0852423,1.07834,.987776,-.0495694,.0678546,1.092,.99103,-.0372386,.0506917,1.1043,.99474,-.0244353,.0333316,1.11576,.997768,-.0121448,.0164348,1.12617,1.00003,31774e-8,-169504e-9,1.13598,.825551,-756799e-11,.378425,165099e-10,.82664,-190922e-9,.378923,416504e-9,.826323,-763495e-9,.378779,.0016656,.826359,-.00171789,.378795,.00374768,.82636,-.00305402,.378795,.00666259,.826368,-.00477185,.378798,.0104104,.826364,-.00687131,.378795,.0149912,.826368,-.00935232,.378795,.0204054,.826376,-.0122146,.378797,.0266532,.826399,-.0154581,.378803,.0337355,.82646,-.0190825,.378824,.0416537,.826525,-.0230873,.378846,.0504091,.826614,-.0274719,.378876,.0600032,.82674,-.0322355,.378917,.0704393,.826888,-.0373766,.378964,.0817195,.827078,-.0428936,.379024,.0938492,.827318,-.0487778,.379099,.106828,.82764,-.0549935,.379199,.120659,.827926,-.0611058,.379227,.13526,.828325,-.0675054,.379275,.150713,.828801,-.0743455,.379332,.167034,.8294,-.0815523,.379415,.184209,.830094,-.0890779,.379495,.202203,.8309,-.096736,.379555,.220945,.831943,-.104135,.379577,.240306,.833037,-.112106,.379604,.260317,.834278,-.120554,.379668,.2808,.836192,-.129128,.3799,.301654,.838671,-.137541,.380109,.323502,.840939,-.14523,.379809,.347176,.844575,-.15248,.379593,.371706,.848379,-.159607,.37909,.39688,.853616,-.166267,.378617,.422702,.858921,-.172698,.377746,.448919,.865324,-.178823,.376749,.475661,.872207,-.184542,.375363,.502599,.880018,-.189836,.373657,.529914,.88694,-.194294,.370673,.557683,.894779,-.197022,.36662,.586848,.902242,-.199108,.36138,.615831,.909914,-.200398,.355434,.644478,.917088,-.20094,.348173,.672905,.923888,-.200671,.339482,.701327,.930495,-.198773,.32956,.730101,.937247,-.195394,.318363,.758383,.943108,-.191956,.306323,.786539,.948296,-.187227,.292576,.813637,.953472,-.181165,.278234,.840793,.958485,-.174119,.263054,.867712,.962714,-.166564,.246756,.893635,.966185,-.158181,.229945,.919028,.970146,-.148275,.212633,.943413,.973491,-.138157,.195229,.966627,.975741,-.127574,.178048,.988817,.977238,-.11554,.160312,1.00924,.978411,-.10364,.142857,1.02845,.979811,-.0913122,.125317,1.04648,.98116,-.0782558,.107627,1.06284,.983543,-.0655957,.0895862,1.07798,.986789,-.0520411,.0713756,1.092,.990292,-.0389727,.053228,1.10484,.994187,-.025808,.0351945,1.11642,.997499,-.0126071,.0173198,1.12703,.999999,275604e-9,-148602e-9,1.13674,.81075,-78735e-10,.394456,161829e-10,.808692,-198293e-9,.393453,407564e-9,.80846,-792877e-9,.39334,.00162965,.808595,-.00178416,.393407,.00366711,.808597,-.00317182,.393408,.00651934,.808598,-.00495589,.393408,.0101866,.808591,-.00713627,.393403,.0146689,.808592,-.00971285,.393402,.0199667,.80861,-.0126855,.393407,.0260803,.808633,-.0160538,.393413,.0330107,.80868,-.0198175,.393429,.0407589,.808748,-.0239758,.393453,.0493264,.808854,-.0285286,.39349,.0587161,.808992,-.0334748,.39354,.0689304,.809141,-.0388116,.393588,.0799707,.809352,-.0445375,.39366,.0918432,.809608,-.0506427,.393742,.104549,.809915,-.0570708,.393834,.118085,.810253,-.0633526,.393885,.132377,.810687,-.0700966,.393953,.147537,.811233,-.0772274,.394047,.163543,.811865,-.0847629,.394148,.180394,.812648,-.0925663,.394265,.198051,.813583,-.100416,.394363,.216443,.814683,-.108119,.394402,.235502,.815948,-.11644,.394489,.255242,.817278,-.125036,.394542,.275441,.819605,-.133655,.39486,.296094,.822256,-.142682,.395248,.317309,.825349,-.150756,.395241,.340516,.829605,-.158392,.395285,.364819,.83391,-.165801,.394922,.389736,.839808,-.172677,.394691,.415409,.845708,-.179448,.394006,.441546,.853025,-.185746,.393279,.46832,.859666,-.191684,.391655,.495302,.86789,-.197146,.390068,.52262,.875845,-.201904,.38727,.550336,.882634,-.205023,.382688,.578825,.891076,-.207098,.377543,.608103,.900589,-.208474,.371752,.63723,.90791,-.209068,.364016,.665769,.915971,-.208655,.355593,.694428,.923455,-.20729,.345439,.723224,.931514,-.203821,.334099,.751925,.937885,-.19986,.321069,.780249,.943136,-.194993,.306571,.8077,.948818,-.189132,.291556,.83497,.954433,-.181617,.275745,.86188,.959078,-.173595,.258695,.888562,.962705,-.164855,.240825,.914008,.966753,-.155129,.22268,.939145,.970704,-.144241,.204542,.963393,.973367,-.133188,.185927,.985983,.975984,-.121146,.167743,1.00704,.976994,-.108366,.149218,1.02715,.978485,-.0956746,.13131,1.0455,.980074,-.0820733,.112513,1.06221,.98225,-.0684061,.0938323,1.07782,.98553,-.0549503,.0749508,1.09199,.989529,-.0407857,.055848,1.10508,.993536,-.0271978,.0368581,1.11684,.997247,-.0132716,.0181845,1.12789,1,431817e-9,-198809e-9,1.13792,.785886,-812608e-11,.405036,157669e-10,.790388,-205278e-9,.407355,398297e-9,.790145,-820824e-9,.407231,.00159263,.790135,-.00184681,.407226,.00358336,.790119,-.00328316,.407218,.00637039,.790126,-.00512988,.40722,.0099539,.79013,-.00738684,.407221,.0143339,.790135,-.0100538,.407221,.0195107,.790134,-.0131306,.407217,.0254848,.79016,-.0166169,.407224,.0322572,.790197,-.020512,.407236,.0398284,.790273,-.0248157,.407263,.0482014,.790381,-.029527,.407304,.0573777,.790521,-.0346446,.407355,.0673602,.790704,-.0401665,.40742,.0781522,.790925,-.0460896,.407499,.0897582,.791195,-.0524017,.407589,.10218,.791522,-.0590121,.407691,.11541,.791878,-.0654876,.407748,.12939,.792361,-.0725207,.407849,.144237,.792942,-.0799844,.407963,.159924,.79362,-.0877896,.408087,.176425,.794529,-.0958451,.408259,.193733,.795521,-.103827,.408362,.211756,.796778,-.111937,.408482,.230524,.798027,-.120521,.408547,.249967,.799813,-.129242,.408721,.269926,.802387,-.138048,.409148,.290338,.805279,-.147301,.409641,.311193,.809251,-.155895,.410154,.333611,.813733,-.163942,.410297,.357615,.819081,-.171666,.410373,.382339,.825427,-.178905,.410348,.407828,.83172,-.185812,.409486,.434034,.83877,-.192318,.408776,.460493,.845817,-.198249,.407176,.487346,.854664,-.204034,.405719,.514832,.863495,-.208908,.403282,.542401,.871883,-.212765,.399293,.570683,.88065,-.214911,.393803,.599947,.89004,-.216214,.387536,.62932,.898476,-.216745,.379846,.658319,.906738,-.216387,.370625,.687138,.914844,-.215053,.360139,.71601,.923877,-.212007,.348849,.745124,.931925,-.207481,.335639,.773366,.938054,-.202418,.320798,.801636,.943895,-.196507,.304772,.829055,.949468,-.189009,.288033,.856097,.955152,-.180539,.270532,.88301,.959403,-.171437,.251639,.909296,.963309,-.161661,.232563,.934868,.967399,-.150425,.213231,.959662,.972009,-.138659,.194247,.98302,.97433,-.126595,.174718,1.00517,.975823,-.113205,.155518,1.02566,.976371,-.0996096,.136709,1.04418,.978705,-.0860754,.117571,1.06146,.981477,-.0714438,.0980046,1.07777,.984263,-.0572304,.0782181,1.09214,.988423,-.0428875,.0584052,1.10553,.993,-.0282442,.038522,1.11758,.99704,-.0140183,.0190148,1.12864,.999913,369494e-9,-145203e-9,1.13901,.777662,-84153e-10,.423844,154403e-10,.770458,-211714e-9,.419915,38845e-8,.770716,-846888e-9,.420055,.00155386,.770982,-.00190567,.420202,.00349653,.770981,-.00338782,.420201,.00621606,.77098,-.00529338,.4202,.00971274,.770983,-.00762223,.4202,.0139867,.770985,-.0103741,.420198,.0190381,.770996,-.0135489,.4202,.0248677,.771029,-.0171461,.420212,.0314764,.771052,-.0211647,.420215,.0388648,.771131,-.0256048,.420245,.047036,.771235,-.0304647,.420284,.0559911,.771383,-.0357436,.420341,.0657346,.771591,-.0414392,.420423,.0762694,.771819,-.0475462,.420506,.0875984,.772123,-.0540506,.420617,.099727,.772464,-.060797,.42072,.112637,.772855,-.0675393,.420799,.126313,.773317,-.0748323,.420893,.140824,.773981,-.0825681,.421058,.15617,.774746,-.0906307,.421226,.172322,.77566,-.0988982,.421397,.189253,.776837,-.106994,.421569,.206912,.778097,-.115528,.421704,.225359,.779588,-.124317,.421849,.24447,.781574,-.133139,.422097,.264156,.784451,-.142179,.422615,.284318,.787682,-.15165,.423269,.304902,.792433,-.160771,.424396,.3265,.797359,-.169166,.424772,.35014,.803986,-.177149,.425475,.374768,.809504,-.184745,.424996,.399928,.815885,-.19173,.424247,.425796,.823513,-.198525,.423515,.452287,.832549,-.204709,.422787,.479321,.841653,-.210447,.421187,.506718,.850401,-.215501,.418519,.53432,.859854,-.219752,.414715,.56242,.869364,-.222305,.409462,.591558,.878837,-.223744,.402926,.621074,.888636,-.224065,.395043,.650538,.898132,-.223742,.38564,.679538,.907181,-.222308,.375378,.708674,.915621,-.219837,.363212,.737714,.9239,-.215233,.349313,.767014,.931644,-.209592,.334162,.795133,.938887,-.203644,.317943,.823228,.945282,-.196349,.300581,.850822,.950758,-.18742,.282195,.877594,.956146,-.177879,.262481,.904564,.960355,-.167643,.242487,.930741,.965256,-.156671,.222668,.955868,.968029,-.144123,.201907,.979869,.97251,-.131305,.18202,1.00291,.974925,-.118335,.161909,1.02392,.975402,-.103714,.142129,1.0433,.976987,-.089415,.122447,1.06089,.979677,-.0748858,.102248,1.07713,.983184,-.0596086,.0814851,1.09218,.987466,-.0447671,.0609484,1.10585,.992348,-.0295217,.0401835,1.11829,.996674,-.0143917,.0198163,1.12966,1.00003,321364e-9,-149983e-9,1.1402,.757901,-869074e-11,.436176,151011e-10,.751195,-217848e-9,.432317,378533e-9,.751178,-871373e-9,.432307,.0015141,.751195,-.00196061,.432317,.0034068,.751198,-.00348552,.432318,.00605659,.751195,-.00544599,.432315,.00946353,.751207,-.00784203,.43232,.013628,.751213,-.0106732,.43232,.0185499,.751221,-.0139393,.432319,.0242302,.751244,-.0176398,.432325,.0306694,.7513,-.0217743,.432348,.0378698,.751358,-.0263412,.432367,.0458321,.751458,-.0313396,.432404,.0545587,.751608,-.0367682,.432464,.0640543,.7518,-.0426246,.43254,.0743222,.752065,-.0489031,.432645,.0853668,.752376,-.0555828,.432762,.0971911,.752715,-.0623861,.432859,.109768,.753137,-.069415,.432958,.123126,.753676,-.0770039,.433099,.137308,.754345,-.084971,.433272,.15229,.755235,-.0932681,.433504,.168075,.756186,-.10171,.433693,.184625,.757363,-.110019,.433857,.201897,.75884,-.11887,.434102,.220014,.760467,-.127881,.434306,.238778,.762969,-.136766,.434751,.258172,.765823,-.14612,.43529,.278062,.769676,-.15566,.436236,.298437,.774909,-.165177,.437754,.319532,.77994,-.17402,.438343,.342505,.785757,-.182201,.438609,.366693,.792487,-.190104,.438762,.391668,.80038,-.197438,.438795,.417494,.808494,-.204365,.438226,.443933,.817695,-.210714,.437283,.470929,.828111,-.216651,.436087,.498569,.837901,-.221804,.433717,.526165,.847813,-.226318,.430133,.554155,.858314,-.229297,.425213,.582822,.868891,-.230999,.418576,.612847,.878941,-.231155,.410405,.642445,.888809,-.230935,.400544,.672024,.898089,-.229343,.389613,.701366,.908081,-.226886,.377197,.730763,.916819,-.222676,.363397,.759642,.924968,-.216835,.347437,.788775,.932906,-.210245,.32995,.817135,.940025,-.202992,.312262,.844912,.946101,-.19436,.293313,.872164,.952835,-.184125,.273638,.899443,.957347,-.173657,.252385,.926389,.961434,-.162204,.231038,.951947,.965522,-.14979,.209834,.976751,.969412,-.136307,.188821,1.00022,.973902,-.122527,.168013,1.02229,.974045,-.108213,.147634,1.04199,.975775,-.0927397,.12705,1.06019,.978383,-.0778212,.106309,1.07711,.98211,-.0621216,.0849279,1.09245,.986517,-.0463847,.0633519,1.10651,.991696,-.0309353,.0419698,1.11903,.996349,-.0150914,.0206272,1.13073,1.00003,442449e-9,-231396e-9,1.14146,.727498,-885074e-11,.441528,145832e-10,.730897,-223525e-9,.443589,368298e-9,.730796,-893996e-9,.443528,.00147303,.730805,-.00201149,.443533,.00331433,.730814,-.00357596,.443538,.00589222,.730815,-.00558734,.443538,.00920678,.730822,-.00804544,.44354,.0132582,.730836,-.0109501,.443545,.0180468,.730848,-.0143008,.443546,.0235732,.730871,-.0180969,.443552,.0298382,.730915,-.022338,.443567,.0368438,.730982,-.0270225,.443591,.044591,.731076,-.0321491,.443627,.0530831,.731245,-.0377166,.443699,.0623243,.73144,-.0437216,.443777,.0723181,.7317,-.0501576,.443881,.0830691,.732034,-.0569942,.444014,.0945809,.732388,-.0638756,.444113,.106825,.732853,-.071203,.444247,.119859,.733473,-.0790076,.444442,.13369,.734195,-.0871937,.444645,.148304,.735069,-.095696,.444877,.163702,.736169,-.10426,.445133,.179861,.73747,-.112853,.44537,.196778,.738991,-.12199,.445651,.214496,.740865,-.131153,.445958,.232913,.743637,-.140245,.446548,.251977,.746797,-.149722,.447246,.271551,.751517,-.159341,.448656,.291774,.756156,-.169106,.449866,.312455,.761519,-.178436,.450919,.334552,.768295,-.186904,.451776,.358491,.776613,-.195117,.452832,.383446,.783966,-.202695,.45249,.408945,.793542,-.20985,.452587,.435364,.803192,-.216403,.451852,.462336,.813892,-.22251,.450708,.48987,.824968,-.227676,.4486,.517697,.835859,-.232443,.445156,.545975,.846825,-.235775,.440351,.574483,.858085,-.237897,.433641,.604246,.868825,-.238074,.425354,.634101,.879638,-.237661,.415383,.664201,.889966,-.236186,.404136,.693918,.899479,-.233599,.390917,.723481,.908769,-.229737,.376352,.75258,.917966,-.223836,.360372,.781764,.926304,-.217067,.342551,.811139,.934626,-.209309,.324238,.839585,.941841,-.20071,.304484,.867044,.94789,-.190602,.283607,.894579,.954196,-.179253,.262205,.921743,.958383,-.167646,.239847,.948026,.963119,-.155073,.218078,.973296,.966941,-.141426,.195899,.998135,.970836,-.126849,.174121,1.02021,.973301,-.112296,.153052,1.04085,.97448,-.0964965,.131733,1.05946,.977045,-.080489,.10997,1.07693,.980751,-.064844,.0881657,1.09254,.985475,-.0481938,.0657987,1.10697,.991089,-.0319185,.0435215,1.12004,.996122,-.0158088,.0214779,1.13173,1.00001,372455e-9,-200295e-9,1.14291,.708622,-907597e-11,.45304,141962e-10,.711162,-228911e-9,.454662,358052e-9,.709812,-914446e-9,.453797,.00143034,.709865,-.00205819,.453834,.00321935,.709864,-.00365894,.453833,.00572331,.709855,-.00571692,.453826,.00894278,.709862,-.00823201,.453828,.012878,.709875,-.011204,.453832,.0175295,.709896,-.0146323,.453839,.0228978,.709925,-.0185163,.453847,.0289839,.709974,-.0228551,.453866,.0357894,.710045,-.0276473,.453892,.0433161,.710133,-.032891,.453924,.0515665,.710292,-.0385851,.453992,.0605458,.710485,-.0447254,.45407,.0702574,.710769,-.0513051,.454192,.0807077,.711106,-.0582733,.454329,.091896,.711516,-.0652866,.45446,.103814,.712071,-.0728426,.454653,.116508,.712676,-.0808307,.45484,.129968,.713476,-.0892216,.455096,.144206,.714377,-.0979047,.455346,.159212,.715579,-.106531,.455647,.174973,.716977,-.115492,.455961,.191504,.71862,-.124821,.456315,.208835,.72084,-.134079,.4568,.226869,.723786,-.143427,.457521,.245582,.727464,-.153061,.458475,.264957,.732771,-.162768,.460239,.284948,.736515,-.172627,.460899,.30522,.743519,-.182487,.463225,.326717,.750041,-.191295,.464027,.350113,.758589,-.199746,.465227,.374782,.767703,-.207584,.465877,.400226,.777484,-.214973,.465996,.426442,.788792,-.221796,.466019,.453688,.800194,-.228038,.465083,.481246,.811234,-.233346,.462506,.509086,.822859,-.238073,.459257,.537338,.835082,-.241764,.454863,.566108,.846332,-.244241,.448163,.595126,.858355,-.244736,.439709,.625574,.87034,-.244278,.429837,.65617,.881027,-.24255,.418002,.686029,.891007,-.239912,.404325,.716039,.900874,-.236133,.389222,.745518,.911072,-.230672,.373269,.775026,.920359,-.22356,.355083,.804521,.928604,-.215591,.335533,.834045,.937175,-.206503,.315278,.861612,.942825,-.196684,.293653,.889131,.949805,-.185116,.271503,.916853,.955535,-.172703,.248821,.943541,.959843,-.159978,.225591,.970132,.964393,-.146375,.202719,.994709,.968008,-.131269,.179928,1.0186,.971013,-.11569,.158007,1.03928,.973334,-.1003,.13624,1.05887,.975775,-.0833352,.1138,1.07652,.979579,-.0668981,.0913141,1.09297,.984323,-.0500902,.0683051,1.10734,.990351,-.0332377,.0451771,1.12084,.995823,-.0161491,.0221705,1.13296,1.0001,234083e-9,-108712e-9,1.14441,.683895,-924677e-11,.46015,137429e-10,.68833,-233383e-9,.463134,346865e-9,.688368,-933547e-9,.463159,.00138748,.688367,-.00210049,.463159,.00312187,.688369,-.00373415,.463159,.00555004,.688377,-.00583449,.463163,.00867216,.688386,-.00840128,.463166,.0124884,.688398,-.0114343,.463169,.0169993,.688418,-.0149329,.463175,.0222054,.688453,-.0188964,.463188,.028108,.688515,-.0233239,.463214,.0347085,.68857,-.0282136,.463231,.0420091,.688679,-.033564,.463276,.0500132,.688854,-.0393733,.463356,.0587255,.689038,-.0456354,.46343,.0681476,.689321,-.0523433,.463553,.0782897,.689662,-.059412,.463693,.0891501,.690188,-.0665736,.4639,.100735,.690755,-.0743106,.464107,.113074,.691405,-.0824722,.464329,.126161,.692198,-.0910484,.464585,.140007,.693196,-.0998778,.464893,.154612,.69454,-.108651,.465285,.169984,.695921,-.117855,.465596,.186106,.697749,-.12734,.466056,.203034,.700375,-.136714,.466771,.220703,.703395,-.146386,.467579,.239062,.707904,-.156096,.469067,.258188,.711673,-.165904,.469851,.277759,.717489,-.175812,.471815,.297935,.724051,-.185931,.47389,.318916,.731965,-.195238,.47587,.341591,.741151,-.204021,.477523,.366062,.751416,-.212113,.478881,.391396,.761848,-.21979,.479226,.417599,.771886,-.2267,.478495,.444401,.783998,-.232991,.477622,.472084,.796523,-.238645,.475833,.500193,.808851,-.243396,.472568,.52865,.821191,-.247226,.467857,.557362,.834261,-.250102,.461871,.586768,.846762,-.251056,.453543,.617085,.859867,-.250604,.443494,.647659,.871948,-.248783,.431711,.678119,.882967,-.245855,.417911,.708399,.892826,-.242168,.401993,.738256,.90332,-.237062,.385371,.767999,.913633,-.22997,.366837,.798191,.922774,-.221687,.346372,.827756,.931371,-.212345,.325682,.856425,.938929,-.20206,.303665,.884299,.944821,-.190981,.280786,.912023,.951792,-.178065,.2573,.939669,.957712,-.164634,.233448,.96655,.961912,-.150863,.209504,.992366,.966382,-.13577,.18597,1.01633,.969588,-.119593,.162905,1.03843,.971777,-.103203,.14053,1.05841,.97433,-.0865888,.117909,1.07632,.978686,-.0690829,.0944101,1.09326,.983281,-.0516568,.0705671,1.10796,.989562,-.034558,.0468592,1.12182,.995465,-.0167808,.0229846,1.1342,.999991,373016e-9,-235606e-9,1.1459,.662251,-939016e-11,.468575,132714e-10,.666634,-237624e-9,.471675,335842e-9,.666411,-950385e-9,.471516,.00134321,.666399,-.00213833,.471509,.00302221,.666386,-.0038014,.471499,.00537283,.666405,-.00593958,.471511,.00839533,.666406,-.00855253,.471508,.0120898,.666428,-.0116401,.471519,.0164569,.666444,-.0152015,.471522,.0214971,.66649,-.0192362,.471543,.027212,.666537,-.0237428,.471558,.033603,.666617,-.0287198,.471591,.0406728,.666718,-.0341647,.471631,.0484238,.666889,-.0400759,.47171,.0568621,.667104,-.0464479,.471805,.0659915,.667374,-.0532677,.471923,.0758178,.667772,-.0603805,.472098,.0863425,.668371,-.0677392,.472363,.0975917,.668971,-.0756028,.472596,.109567,.669696,-.0839293,.472869,.122272,.670481,-.0926683,.473126,.135718,.6715,-.1016,.473442,.149914,.672911,-.110566,.47389,.164882,.674512,-.119984,.474354,.180602,.67651,-.129574,.474922,.19711,.679292,-.139106,.475764,.214371,.682798,-.148993,.476886,.232405,.686955,-.158737,.478179,.251153,.691406,-.168754,.479432,.270436,.697438,-.178703,.481481,.290374,.704761,-.188955,.484143,.311044,.713599,-.198814,.487007,.333003,.723194,-.207869,.488962,.357144,.732601,-.216189,.489815,.382169,.744193,-.22398,.490888,.408227,.754907,-.231156,.490355,.434928,.767403,-.23747,.489548,.462599,.78107,-.243503,.488274,.490908,.793893,-.248114,.484843,.519421,.807296,-.25222,.4803,.548561,.820529,-.255265,.474097,.577772,.833716,-.256741,.466041,.607782,.848403,-.25637,.456547,.638807,.860755,-.254804,.443946,.670058,.874012,-.251834,.430852,.700749,.885619,-.247867,.414903,.731446,.896069,-.242634,.397276,.761191,.906266,-.236093,.378535,.791053,.916759,-.227543,.358038,.821298,.92523,-.21783,.335705,.850747,.93436,-.207534,.313797,.879258,.941631,-.195983,.289671,.907734,.947564,-.183567,.265319,.935206,.953681,-.169345,.240815,.962739,.960008,-.154909,.216119,.989227,.964145,-.140161,.192096,1.01465,.968171,-.123411,.167855,1.03737,.969859,-.106525,.144817,1.05767,.972666,-.0891023,.12149,1.0761,.977055,-.0718094,.0975306,1.09336,.982527,-.0534213,.0730217,1.10878,.989001,-.0355579,.0483366,1.12285,.99512,-.0176383,.023938,1.13548,1.00007,368831e-9,-211581e-9,1.14744,.651047,-960845e-11,.484101,12922e-9,.644145,-241347e-9,.478968,324578e-9,.64396,-965142e-9,.478831,.00129798,.64396,-.00217154,.47883,.00292046,.643968,-.00386049,.478835,.00519202,.643974,-.00603186,.478838,.0081128,.643977,-.0086854,.478836,.011683,.643982,-.0118207,.478834,.0159031,.644024,-.0154374,.478856,.0207743,.644059,-.0195343,.478868,.0262975,.644122,-.0241103,.478896,.0324747,.644207,-.0291638,.478933,.039309,.64432,-.0346919,.478981,.0468029,.644481,-.0406919,.479053,.0549614,.644722,-.047159,.479169,.0637909,.645013,-.0540748,.479302,.0732974,.645503,-.0612001,.479541,.0834898,.646117,-.0687303,.479829,.0943873,.646707,-.0767846,.480061,.105991,.647431,-.0852465,.480343,.11831,.64831,-.0940719,.48066,.131348,.649486,-.103056,.481083,.14514,.650864,-.112261,.481528,.159676,.652604,-.121852,.482102,.174979,.654825,-.131505,.482813,.191079,.657876,-.141189,.483876,.207927,.661339,-.151239,.48499,.225586,.665463,-.161091,.486279,.243947,.670542,-.171235,.487968,.262957,.677361,-.181347,.49053,.282781,.685672,-.191679,.493862,.303311,.694551,-.201781,.49699,.324607,.703753,-.211164,.498884,.347916,.713703,-.219675,.500086,.372628,.725911,-.227836,.501554,.398694,.73862,-.23533,.502193,.425529,.752118,-.241786,.501811,.453209,.76579,-.247865,.500185,.481381,.779568,-.252696,.497159,.51011,.793991,-.256802,.492765,.539322,.808182,-.259942,.486827,.569078,.821698,-.261703,.478386,.598818,.836009,-.262006,.468772,.629762,.849824,-.260333,.456352,.661366,.863888,-.257398,.442533,.69295,.876585,-.253264,.426573,.723608,.888665,-.248026,.408964,.754378,.899537,-.241487,.389677,.784761,.9094,-.233463,.368516,.814688,.920166,-.223397,.346624,.845009,.928899,-.21255,.322717,.874431,.937156,-.200869,.298698,.902922,.943861,-.188387,.273491,.931356,.949557,-.174341,.247866,.958854,.955862,-.158994,.222496,.986098,.961721,-.143664,.197522,1.01229,.965976,-.127412,.17302,1.03571,.968652,-.109798,.148954,1.05699,.971084,-.0916787,.125044,1.07587,.975584,-.0739634,.100577,1.09372,.98122,-.055322,.0753666,1.10948,.988253,-.0366825,.0498899,1.12394,.99482,-.0180389,.024611,1.13694,1.00001,229839e-9,-188283e-9,1.14919,.613867,-964198e-11,.479449,123452e-10,.621485,-244534e-9,.485399,313091e-9,.621429,-978202e-9,.485353,.00125245,.62112,-.00220004,.485114,.00281687,.621119,-.0039111,.485112,.00500783,.621122,-.00611091,.485112,.00782498,.621133,-.00879922,.485117,.0112687,.621152,-.0119756,.485125,.0153394,.621183,-.0156396,.485139,.0200382,.621227,-.0197898,.485158,.0253663,.621298,-.0244253,.485192,.0313261,.621388,-.0295441,.485233,.0379204,.621507,-.0351432,.485286,.0451523,.621693,-.0412198,.485378,.0530277,.621933,-.0477673,.485495,.0615522,.622232,-.0547574,.485635,.0707316,.622809,-.0619417,.485943,.0805883,.623407,-.069625,.486232,.0911267,.62406,-.077796,.486516,.102354,.624835,-.0863731,.486838,.114279,.625758,-.095251,.487188,.126902,.627043,-.104299,.487695,.140285,.628438,-.113724,.488163,.154397,.630325,-.123417,.488858,.169267,.632801,-.133137,.489754,.184941,.635784,-.143052,.490815,.20136,.639406,-.153132,.492048,.218643,.643872,-.163143,.49363,.236615,.6499,-.17333,.496009,.255449,.657201,-.183622,.498994,.275006,.666221,-.194019,.502888,.295354,.674419,-.204192,.505459,.316244,.683729,-.21406,.507771,.33849,.695584,-.222854,.510245,.363166,.708583,-.231315,.512293,.389071,.721233,-.238911,.512747,.415737,.735134,-.245657,.512482,.443331,.750179,-.251879,.511526,.471891,.765073,-.256911,.508935,.500892,.779794,-.261144,.504341,.530294,.794801,-.264316,.498515,.560144,.810339,-.266276,.491015,.590213,.824818,-.266981,.481126,.620865,.839375,-.265778,.468685,.652687,.853043,-.262748,.453925,.684759,.867335,-.258474,.437912,.716209,.88037,-.253187,.419648,.747508,.891711,-.246476,.39982,.77797,.902896,-.238735,.37879,.808586,.913601,-.22885,.355891,.838843,.923019,-.217656,.331773,.869014,.933432,-.205539,.307356,.898512,.939691,-.192595,.281321,.9269,.946938,-.178945,.255441,.955297,.952372,-.163587,.229013,.983231,.95909,-.147214,.203179,1.00971,.963675,-.13064,.17792,1.03438,.968247,-.113121,.152898,1.05625,.97001,-.0945824,.128712,1.07598,.974458,-.0755648,.103349,1.094,.980168,-.0571998,.0776731,1.1104,.987295,-.0377994,.0514445,1.12491,.994432,-.0186417,.025429,1.13851,.999975,542714e-9,-282356e-9,1.15108,.592656,-980249e-11,.486018,119532e-10,.598467,-247275e-9,.490781,301531e-9,.597934,-988317e-9,.490343,.00120517,.597903,-.00222366,.490319,.0027116,.597913,-.00395315,.490327,.00482077,.597919,-.00617653,.490329,.00753264,.597936,-.00889375,.490339,.0108478,.597956,-.0121043,.490347,.0147668,.597992,-.0158073,.490365,.0192905,.598032,-.0200017,.490382,.0244204,.598109,-.0246865,.49042,.0301593,.598215,-.0298594,.490474,.03651,.59833,-.0355167,.490524,.0434757,.598525,-.0416559,.490624,.0510629,.598778,-.0482692,.490753,.0592781,.599135,-.0553114,.49094,.0681304,.599802,-.062542,.491328,.0776467,.600361,-.0703638,.491598,.0878184,.60101,-.0786256,.491882,.0986573,.601811,-.0872962,.492232,.11018,.602861,-.0962284,.492684,.1224,.604167,-.10538,.493213,.135354,.605693,-.114896,.493799,.149034,.607682,-.124654,.494576,.163469,.610672,-.13456,.4959,.178747,.613313,-.144581,.496713,.194723,.617603,-.154703,.498499,.211617,.622174,-.16489,.500188,.229183,.628855,-.175164,.503072,.247786,.636963,-.185565,.506798,.267116,.644866,-.195911,.509719,.28702,.653741,-.206104,.512776,.307763,.664942,-.216447,.516812,.329631,.67633,-.22552,.519181,.353515,.690012,-.234316,.521681,.379226,.704243,-.242032,.523129,.405901,.719396,-.249172,.523768,.433585,.734471,-.255543,.522541,.462085,.750539,-.260697,.520217,.491233,.766365,-.26501,.516293,.521094,.781677,-.268409,.509708,.551014,.797132,-.270399,.501944,.581463,.812655,-.271247,.492025,.612402,.828592,-.270708,.480424,.643798,.844044,-.268085,.465955,.67682,.857305,-.263459,.448425,.708496,.87114,-.258151,.430243,.74046,.884936,-.251171,.410578,.771583,.895772,-.243305,.38862,.802234,.906961,-.234037,.365214,.833179,.917775,-.222714,.34116,.86353,.927883,-.210175,.31572,.893557,.936617,-.196925,.289159,.922976,.943384,-.182788,.261996,.951606,.949713,-.167965,.235324,.979958,.955818,-.151109,.208408,1.00765,.961344,-.133834,.182591,1.03329,.965469,-.115987,.156958,1.0557,.968693,-.09746,.132239,1.07583,.973165,-.0778514,.106195,1.09451,.979387,-.0585067,.0797669,1.11137,.98671,-.0390409,.0530263,1.12643,.994093,-.019408,.0263163,1.14016,1.00002,540029e-9,-194487e-9,1.15299,.574483,-989066e-11,.494533,114896e-10,.574478,-249127e-9,.494528,289403e-9,.574607,-996811e-9,.494637,.00115797,.574396,-.00224241,.494458,.00260498,.574377,-.00398632,.49444,.00463102,.574386,-.00622836,.494445,.00723623,.574401,-.0089683,.494453,.010421,.574419,-.0122056,.49446,.0141859,.574459,-.0159396,.494481,.0185322,.574525,-.0201692,.49452,.0234617,.574587,-.0248924,.494547,.0289762,.574697,-.0301074,.494604,.0350797,.574853,-.0358114,.494688,.0417767,.575027,-.041999,.494772,.0490718,.575294,-.0486618,.494915,.0569728,.575733,-.0557148,.495173,.0654955,.576356,-.0630489,.495537,.0746612,.576944,-.0709285,.495836,.0844615,.57765,-.0792723,.496177,.0949142,.578491,-.0880167,.496563,.10603,.579639,-.0969462,.497096,.117841,.580989,-.10622,.497684,.130367,.582587,-.115861,.498337,.143609,.584951,-.125605,.499414,.157625,.587602,-.135608,.500518,.172413,.59076,-.145742,.501767,.187999,.594992,-.155934,.503542,.20445,.600656,-.166303,.506135,.221764,.607816,-.176681,.509542,.24002,.61522,-.187071,.51263,.258992,.623702,-.197465,.516021,.278773,.634192,-.207816,.520422,.299377,.644936,-.218183,.524073,.320802,.657888,-.2278,.528049,.34384,.670666,-.236747,.52986,.36916,.685626,-.24484,.531892,.395867,.701304,-.252071,.532727,.423488,.717727,-.258714,.532146,.452201,.733914,-.264211,.529883,.481579,.750529,-.26859,.5259,.511558,.76747,-.272046,.51999,.542042,.785189,-.274225,.513083,.572799,.800954,-.275189,.502936,.603816,.816962,-.274946,.490921,.635461,.83336,-.272695,.47684,.6676,.848143,-.268223,.459405,.70051,.861818,-.262768,.440319,.732902,.876828,-.255872,.420123,.765084,.889312,-.247703,.398379,.796391,.900412,-.238381,.374496,.827333,.912251,-.227783,.349874,.858385,.921792,-.214832,.323181,.888652,.931273,-.200949,.296624,.917763,.940295,-.186537,.269211,.947878,.946812,-.171538,.241447,.977016,.953588,-.155254,.213829,1.00501,.958841,-.137156,.186807,1.03179,.963746,-.118699,.160706,1.05502,.966468,-.0998358,.135504,1.07568,.971178,-.0805186,.109131,1.09479,.97831,-.0599348,.0818293,1.1123,.985886,-.0399661,.0545872,1.12771,.994021,-.0198682,.0269405,1.14186,1.00009,271022e-9,-12989e-8,1.15514,.538716,-990918e-11,.486732,109675e-10,.550656,-250642e-9,.497518,277412e-9,.55057,-.00100265,.497441,.00110974,.550903,-.00225672,.497733,.00249779,.550568,-.00401046,.497438,.00443906,.550574,-.00626613,.49744,.00693637,.550591,-.0090226,.497449,.00998921,.550623,-.0122795,.497469,.0135984,.550667,-.0160361,.497495,.0177654,.550724,-.0202908,.497526,.0224915,.550792,-.0250421,.497557,.0277795,.550918,-.0302878,.49763,.0336334,.551058,-.0360241,.497701,.0400573,.551276,-.0422473,.497824,.0470585,.551551,-.0489441,.497977,.0546433,.552074,-.0559596,.498312,.0628367,.552681,-.0633978,.498679,.071646,.553324,-.0713176,.499031,.0810746,.554011,-.0797268,.499365,.091129,.55488,-.0885238,.499779,.101837,.556171,-.0974417,.500444,.113239,.557498,-.106841,.501025,.125316,.559299,-.116533,.501864,.138128,.561647,-.126298,.502967,.151695,.564347,-.136388,.504129,.16604,.567863,-.146576,.505713,.181207,.572569,-.156832,.507953,.197259,.578919,-.167323,.511186,.214258,.585387,-.177712,.514042,.232038,.593134,-.188184,.517484,.250733,.603295,-.198717,.522345,.270454,.613854,-.209177,.526751,.290807,.626092,-.219644,.531595,.312202,.637868,-.229494,.534721,.334435,.652458,-.238718,.538304,.359184,.666985,-.247061,.539875,.385637,.683301,-.254652,.541042,.41328,.69998,-.261376,.540735,.441903,.717824,-.267085,.539139,.471609,.734617,-.271465,.534958,.501446,.753663,-.27528,.53032,.532571,.770512,-.277617,.522134,.563641,.787356,-.278525,.51206,.595067,.806252,-.278512,.50119,.627226,.822061,-.277023,.486791,.659402,.838959,-.273175,.470467,.692874,.85379,-.267238,.450688,.725702,.868268,-.260327,.429741,.75832,.881994,-.251946,.407223,.790189,.893885,-.242432,.383214,.821625,.905118,-.231904,.357297,.853011,.916045,-.219545,.330733,.883773,.927614,-.205378,.303916,.914435,.936005,-.190388,.275941,.944502,.944533,-.1749,.247493,.974439,.950758,-.158588,.218996,1.00286,.957078,-.141027,.191559,1.0304,.962448,-.121507,.164457,1.05466,.964993,-.102068,.138636,1.0761,.970017,-.0822598,.111861,1.09541,.97661,-.062033,.0843438,1.11317,.985073,-.0409832,.0558496,1.12911,.993515,-.020146,.0275331,1.1438,1.00006,27329e-8,-107883e-9,1.15736,.525324,-999341e-11,.498153,105385e-10,.526513,-251605e-9,.499277,265329e-9,.526517,-.00100641,.499282,.0010613,.526588,-.00226466,.499337,.00238823,.526539,-.0040255,.499302,.00424535,.526547,-.00628954,.499306,.00663364,.526561,-.00905628,.499313,.00955337,.526593,-.0123253,.499334,.0130054,.526642,-.0160957,.499365,.0169911,.5267,-.0203661,.499396,.0215122,.526792,-.0251347,.499451,.0265718,.526904,-.0303985,.499511,.0321732,.527079,-.0361554,.499617,.0383231,.527285,-.0423982,.499731,.045026,.527602,-.0491121,.499924,.0522936,.528166,-.0561127,.500306,.0601528,.52879,-.0635988,.5007,.0686059,.529421,-.071581,.501048,.0776518,.530144,-.0799854,.501421,.0873148,.531062,-.0888032,.501884,.0976084,.532374,-.0977643,.50259,.108588,.533828,-.107197,.50329,.120234,.53581,-.116887,.504312,.132602,.538063,-.126755,.505365,.145721,.5409,-.136819,.506668,.159617,.544882,-.147117,.508731,.174369,.550238,-.157446,.511601,.190028,.556038,-.167988,.514431,.206587,.563031,-.178364,.517808,.224046,.571543,-.189007,.521937,.242503,.582255,-.199546,.527415,.261977,.59272,-.210084,.531682,.282162,.605648,-.220448,.537123,.303426,.61785,-.230593,.540664,.325323,.632223,-.240238,.544467,.348993,.648819,-.24887,.547594,.375462,.665825,-.256657,.54912,.403024,.683389,-.263711,.549294,.431773,.701495,-.269666,.547649,.461494,.719197,-.274169,.543786,.491623,.737906,-.278124,.538644,.522994,.756652,-.280632,.531057,.554775,.775279,-.281741,.521972,.586441,.792688,-.281652,.509613,.618596,.811894,-.280345,.496497,.651462,.827938,-.277128,.47968,.684023,.844837,-.271646,.460688,.718024,.859239,-.264397,.438872,.751207,.874088,-.256144,.41577,.784232,.887693,-.246311,.391369,.816191,.899402,-.235497,.365872,.847828,.910973,-.223631,.338618,.87934,.92204,-.209874,.310803,.910325,.930987,-.194265,.281802,.940695,.94,-.178125,.252836,.970958,.948018,-.161479,.224239,1.00078,.955141,-.144038,.195857,1.0288,.960513,-.124915,.168487,1.05371,.963964,-.104284,.141495,1.07596,.968713,-.0838732,.114437,1.09628,.975524,-.0635579,.0863105,1.11448,.98431,-.042291,.0574774,1.13069,.992916,-.0209131,.0284343,1.14568,.999926,743097e-9,-379265e-9,1.15955,.501042,-998428e-11,.498726,100306e-10,.502992,-252112e-9,.500665,253283e-9,.502417,-.00100791,.500092,.00101259,.502965,-.00226919,.500621,.00227978,.502318,-.00403109,.499994,.00405011,.502333,-.00629832,.500005,.00632868,.502362,-.00906907,.500027,.00911446,.502369,-.0123423,.500023,.0124078,.50243,-.0161178,.500066,.016211,.502493,-.0203937,.500103,.0205256,.502592,-.0251684,.500166,.0253548,.502707,-.0304389,.50023,.0307029,.502881,-.0362015,.500335,.0365753,.503124,-.0424507,.500488,.0429798,.503443,-.0491582,.500686,.0499268,.504083,-.0561476,.501155,.0574541,.504668,-.0636846,.501524,.0655408,.505319,-.0716834,.501904,.0742072,.50609,-.0800925,.502321,.0834699,.507122,-.0888425,.502896,.0933603,.508414,-.097855,.503603,.10391,.509955,-.107304,.504416,.115113,.512061,-.116921,.505565,.127054,.514419,-.12689,.506732,.139709,.517529,-.136934,.508338,.153173,.522085,-.147327,.510987,.167528,.526986,-.157612,.513527,.182708,.533122,-.168213,.516717,.198881,.540807,-.178688,.520832,.215986,.550687,-.189511,.52632,.234335,.560567,-.199998,.531009,.253375,.571698,-.210652,.535839,.273499,.584364,-.220917,.541091,.294355,.599066,-.23137,.546875,.316525,.614148,-.241206,.551306,.339671,.631157,-.250379,.555187,.36531,.647919,-.258397,.556595,.392767,.666112,-.265528,.556949,.421397,.686158,-.271827,.556617,.451433,.704838,-.27674,.552975,.482131,.723957,-.280733,.547814,.513458,.74262,-.283359,.53997,.545446,.762009,-.284541,.530422,.57775,.781314,-.284507,.518546,.610434,.799116,-.283309,.504178,.643178,.817604,-.280378,.48843,.676248,.83459,-.275619,.469457,.709698,.850974,-.26856,.447698,.744245,.866747,-.260094,.424791,.777695,.881412,-.249929,.399913,.810392,.8936,-.239137,.37308,.842872,.905943,-.226818,.345705,.874677,.916408,-.213699,.31706,.906257,.927215,-.198428,.288444,.936881,.935625,-.181643,.258329,.96795,.944076,-.164386,.228488,.998216,.951229,-.146339,.199763,1.02689,.958793,-.127709,.172153,1.0535,.963219,-.107244,.144989,1.07646,.967562,-.0857764,.11685,1.09675,.974866,-.0645377,.0880571,1.11576,.983353,-.0431732,.0587352,1.13227,.992503,-.0218356,.0294181,1.1478,1.00003,605203e-9,-231013e-9,1.16207,.482935,-101177e-10,.504695,968142e-11,.477554,-251521e-9,.499071,240676e-9,.477904,-.00100683,.499436,96342e-8,.478368,-.00226636,.499899,.0021687,.477977,-.00402719,.499513,.00385384,.477993,-.00629226,.499525,.0060221,.478011,-.00906011,.499536,.00867289,.478051,-.0123305,.499566,.0118074,.478089,-.016102,.499587,.0154269,.478171,-.0203736,.499645,.0195341,.478254,-.025143,.499692,.0241318,.47839,-.0304071,.499779,.0292247,.478588,-.0361631,.499911,.0348196,.478812,-.0424023,.500046,.0409231,.479208,-.0490724,.500326,.047552,.479841,-.0560722,.500805,.0547377,.480392,-.0636125,.501152,.0624607,.481068,-.0716134,.501561,.0707473,.481898,-.0800062,.502054,.0796118,.483022,-.0886568,.502728,.0890974,.484332,-.0977553,.503479,.0992099,.486126,-.107173,.504546,.10999,.488066,-.11677,.50557,.121476,.490521,-.126725,.506849,.133672,.494232,-.136793,.50911,.146731,.498302,-.147116,.511345,.160577,.503565,-.157446,.514344,.175335,.510902,-.168121,.518824,.191207,.519263,-.178799,.523666,.208058,.528204,-.189407,.528296,.225875,.538854,-.200145,.533724,.244782,.551278,-.210701,.539833,.264753,.565222,-.221303,.546131,.285745,.579403,-.231688,.551496,.307592,.595469,-.241718,.556809,.330582,.610929,-.250992,.559641,.354995,.629433,-.259602,.562379,.382471,.648504,-.267038,.563676,.411126,.66756,-.273388,.562092,.440924,.689143,-.278788,.560807,.472118,.709056,-.282783,.555701,.503774,.729855,-.285836,.548698,.536364,.748954,-.287078,.538544,.56895,.768373,-.287133,.526711,.601991,.78827,-.285839,.512511,.635403,.807465,-.283238,.496323,.668797,.825194,-.27906,.477638,.702584,.842203,-.272286,.456253,.736393,.857749,-.263854,.432412,.77096,.874799,-.253943,.407806,.80489,.887497,-.24237,.38033,.83771,.89966,-.230278,.352446,.870376,.911753,-.21646,.323268,.902256,.923011,-.202071,.294314,.933306,.932375,-.185519,.264104,.965177,.940537,-.167604,.234035,.996303,.948904,-.149068,.20412,1.0261,.955263,-.129539,.175431,1.05304,.960303,-.109932,.148116,1.07617,.965512,-.0880572,.119693,1.09742,.973466,-.0660548,.0901619,1.11721,.98284,-.0439228,.0599875,1.13436,.992216,-.0219588,.0298975,1.15006,.999946,119402e-9,-208547e-10,1.16471,.447827,-100414e-10,.491543,914833e-11,.454778,-251257e-9,.499172,22891e-8,.453519,-.00100342,.497787,914184e-9,.45357,-.00225776,.497847,.00205701,.453578,-.00401371,.497855,.00365705,.45357,-.00627107,.497841,.00571453,.453598,-.00902968,.497864,.00823019,.453627,-.0122888,.497882,.0112049,.453684,-.0160475,.497923,.0146405,.453764,-.0203044,.49798,.0185394,.453866,-.0250576,.498049,.0229054,.453996,-.0303028,.49813,.0277424,.454196,-.0360379,.498267,.0330587,.454457,-.0422521,.498445,.0388613,.454926,-.0488393,.498812,.0451767,.455525,-.0558653,.499272,.0520153,.456074,-.0633772,.499625,.0593754,.456752,-.0713606,.500049,.0672751,.457648,-.07971,.500615,.0757447,.458849,-.0883032,.501399,.0848231,.46029,-.0974095,.502293,.0945135,.462,-.106729,.503301,.104848,.464121,-.116354,.504533,.115884,.466889,-.126214,.506172,.127652,.470744,-.136324,.508667,.14024,.47488,-.146595,.510995,.153673,.480845,-.157027,.514832,.168053,.488262,-.167658,.519506,.183508,.496547,-.178343,.524347,.199948,.506254,-.188916,.52983,.217503,.517961,-.199975,.536357,.236272,.531484,-.210624,.543641,.256096,.545496,-.221227,.550048,.277085,.559497,-.231568,.555076,.298615,.575752,-.241698,.560541,.321547,.591999,-.251172,.564156,.345602,.610654,-.260178,.567607,.371851,.630484,-.268094,.56923,.40076,.651807,-.274661,.569779,.430801,.67239,-.280331,.566791,.461939,.693024,-.284501,.562007,.493854,.715473,-.287852,.555791,.526992,.736323,-.28929,.546345,.560102,.755771,-.289405,.534,.593543,.775424,-.2881,.519114,.627256,.795447,-.285562,.502543,.661464,.815319,-.281416,.484773,.695206,.831769,-.275523,.463445,.729044,.849464,-.267516,.440269,.764069,.866775,-.257584,.415049,.799089,.881252,-.245817,.388049,.831948,.894209,-.233127,.35889,.865526,.906922,-.219579,.329915,.89818,.919686,-.204491,.300441,.930013,.929044,-.188962,.269445,.962061,.938393,-.171079,.238402,.994214,.94661,-.15199,.208204,1.02533,.953095,-.131953,.178653,1.0529,.958644,-.111233,.150684,1.0771,.963925,-.0903098,.122359,1.09855,.971995,-.0680505,.0923342,1.11874,.981658,-.0448512,.0614195,1.13635,.991649,-.0221931,.0303582,1.15238,.999985,393403e-9,-111086e-9,1.16772,.396806,-971563e-11,.457671,842355e-11,.429186,-249421e-9,.495017,21625e-8,.429324,-998052e-9,.495173,865322e-9,.429175,-.00224487,.494999,.00194637,.429129,-.00399041,.494952,.00346004,.429153,-.00623476,.494974,.00540684,.429168,-.0089773,.494983,.00778714,.429207,-.0122175,.495012,.0106022,.429257,-.0159542,.495047,.0138535,.429338,-.0201864,.495106,.0175443,.429431,-.0249104,.495165,.0216774,.429587,-.0301252,.495279,.0262594,.429796,-.0358249,.495432,.0312968,.430065,-.0419972,.495621,.0367985,.430588,-.0485144,.496061,.042798,.43113,-.0555028,.496472,.0492914,.431743,-.0629852,.496904,.0562907,.432448,-.0709256,.497369,.0638056,.433414,-.0791942,.498032,.071885,.434638,-.0877346,.498854,.0805517,.43611,-.0968056,.499812,.0898047,.437859,-.106002,.500891,.0997142,.440017,-.115648,.502198,.110289,.443236,-.125427,.504389,.121644,.44697,-.135492,.506809,.133769,.451689,-.145746,.509858,.146787,.45811,-.156219,.514247,.160793,.465305,-.166834,.518816,.175791,.474085,-.177546,.524331,.191906,.484808,-.188262,.53104,.209199,.49732,-.199346,.538511,.227825,.509693,-.209951,.544554,.247269,.524367,-.220533,.551616,.267978,.539228,-.231082,.557368,.289672,.55644,-.241342,.563782,.31268,.574204,-.250964,.568851,.33651,.593388,-.260306,.57312,.362219,.613358,-.268667,.574916,.390322,.634512,-.275591,.575053,.420478,.65563,-.281328,.572404,.451614,.678265,-.285948,.568893,.484112,.70011,-.289408,.561878,.517348,.723005,-.291328,.55359,.551355,.743744,-.291418,.541099,.585109,.763949,-.290252,.526489,.619487,.784186,-.287648,.509496,.65404,.804304,-.283782,.491484,.688649,.823629,-.278067,.470517,.723133,.84094,-.270588,.44705,.757163,.857852,-.261188,.421252,.792816,.874934,-.249313,.394191,.827248,.888709,-.236492,.365359,.861074,.902589,-.222185,.336016,.894417,.914201,-.207314,.30527,.926825,.925978,-.191146,.274532,.9595,.93512,-.174135,.243393,.991583,.943656,-.155231,.212414,1.02356,.951719,-.134403,.182005,1.05239,.957164,-.113023,.153043,1.07754,.962656,-.0914493,.124186,1.09984,.970695,-.0694179,.0941654,1.12,.980749,-.0466199,.0629671,1.13849,.991205,-.0227032,.0311146,1.15494,.999884,632388e-9,-254483e-9,1.1706,.379821,-957289e-11,.460637,789337e-11,.405188,-247483e-9,.491396,204064e-9,.404796,-989434e-9,.490914,815853e-9,.40483,-.00222607,.490949,.00183559,.40473,-.00395723,.49084,.00326332,.404731,-.00618287,.490836,.00509945,.404768,-.00890258,.490871,.00734463,.404791,-.0121156,.490883,.00999992,.404857,-.0158214,.490938,.0130676,.404943,-.0200178,.491004,.0165503,.405059,-.0247027,.491093,.0204521,.405213,-.0298729,.491205,.0247788,.405399,-.0355226,.491333,.0295373,.405731,-.0416352,.491604,.034741,.406303,-.0480807,.492116,.0404255,.406814,-.0550458,.492506,.0465732,.407404,-.0624652,.492926,.0532058,.408149,-.0702958,.493442,.0603442,.409128,-.0784623,.494136,.0680297,.410408,-.087007,.495054,.0762786,.411813,-.0959639,.495962,.0851046,.413735,-.105075,.497257,.0945878,.416137,-.114646,.498882,.104725,.41934,-.124394,.501132,.11563,.423326,-.134328,.503883,.127325,.428419,-.14458,.50747,.139911,.43484,-.154979,.511964,.153481,.442641,-.165628,.517328,.168114,.452511,-.176365,.524258,.183995,.463473,-.187298,.531248,.200953,.475564,-.198244,.538367,.219176,.488664,-.208938,.545175,.238514,.504073,-.219599,.553227,.259129,.520832,-.230378,.560653,.280997,.538455,-.240703,.567523,.303821,.55709,-.250548,.573287,.327948,.576646,-.259964,.577795,.353362,.596705,-.268721,.580077,.380336,.618053,-.276054,.58018,.4101,.640303,-.282176,.578747,.44161,.662365,-.286931,.574294,.474106,.684542,-.290521,.567035,.507549,.707984,-.292672,.558687,.541853,.730913,-.293189,.547606,.576581,.752948,-.292199,.533471,.61172,.773452,-.289508,.516395,.646339,.794715,-.285716,.497873,.682131,.814251,-.280051,.476845,.716396,.833057,-.272873,.453449,.751503,.84959,-.263982,.427857,.786085,.867022,-.252745,.400335,.821355,.882277,-.239655,.371304,.85646,.895375,-.225386,.340397,.890828,.909347,-.209587,.310005,.923532,.921885,-.193433,.2796,.956419,.932127,-.176135,.247276,.989445,.941869,-.157872,.216186,1.02221,.949735,-.137577,.185602,1.05195,.956617,-.115285,.155767,1.07822,.961974,-.0928418,.126103,1.10149,.96972,-.0700592,.0956758,1.12207,.98012,-.0474671,.0643269,1.1408,.990825,-.0238113,.0320863,1.1577,.999876,381574e-9,-812203e-10,1.17403,.367636,-961342e-11,.469176,753287e-11,.380377,-244772e-9,.485434,191797e-9,.380416,-978857e-9,.485475,767015e-9,.380376,-.00220165,.485435,.00172522,.380419,-.00391408,.485487,.00306734,.380438,-.00611549,.485505,.00479332,.380462,-.00880558,.485525,.00690391,.380496,-.0119837,.485551,.00940039,.38056,-.0156487,.485605,.0122848,.38064,-.0197988,.485666,.0155601,.380767,-.0244324,.48577,.0192313,.380909,-.0295444,.485871,.0233032,.381142,-.0351321,.48606,.0277861,.381472,-.0411535,.486336,.0326939,.382015,-.0475408,.486833,.0380565,.382523,-.0544395,.487231,.0438615,.383129,-.061784,.487683,.0501332,.383952,-.0695085,.488313,.0568996,.38498,-.0775819,.489077,.0641952,.386331,-.0860443,.490113,.0720324,.387788,-.0948406,.491099,.0804379,.389808,-.103899,.492566,.0894899,.39252,-.113313,.494601,.0992098,.395493,-.123007,.496619,.109641,.399826,-.132859,.499912,.120919,.405341,-.143077,.504061,.133107,.411932,-.153465,.508905,.146263,.420591,-.164108,.515482,.160544,.43101,-.174893,.523191,.176123,.441881,-.185839,.53026,.192757,.453919,-.196633,.537295,.210535,.468715,-.207611,.546156,.229886,.485182,-.218517,.555173,.250543,.501926,-.229249,.562728,.27221,.51785,-.239481,.567494,.294892,.536947,-.249395,.573889,.318987,.557115,-.259,.578831,.344348,.577966,-.268075,.582055,.371223,.599489,-.276115,.583307,.399834,.62479,-.282523,.583902,.431415,.647504,-.287663,.57953,.464301,.670601,-.291538,.573103,.498123,.693539,-.293842,.563731,.532662,.717385,-.294681,.553169,.567925,.741533,-.293717,.539908,.603502,.762142,-.291156,.521902,.639074,.783014,-.28719,.502815,.674439,.805158,-.281773,.482598,.710497,.823646,-.274682,.458949,.7456,.841879,-.266184,.433129,.781085,.859515,-.255682,.406064,.816,.875335,-.242849,.376509,.851074,.890147,-.228329,.345502,.886473,.903144,-.212491,.31428,.920751,.916618,-.195695,.282994,.954606,.927953,-.178267,.251091,.988402,.937414,-.159549,.219107,1.02141,.946823,-.140022,.18896,1.05167,.954651,-.118154,.158667,1.07819,.959955,-.0946636,.128808,1.1025,.96858,-.0711792,.0973787,1.12391,.97938,-.0475046,.0650965,1.14322,.990498,-.024059,.0326267,1.16077,.999844,-512408e-10,112444e-9,1.17727,.316912,-934977e-11,.425996,695559e-11,.356423,-241372e-9,.479108,179562e-9,.356272,-965292e-9,.478897,71811e-8,.356262,-.00217182,.478894,.00161574,.356265,-.00386092,.478895,.00287261,.356278,-.0060324,.478905,.00448907,.356293,-.00868565,.478914,.00646572,.356346,-.0118207,.478965,.00880438,.356395,-.0154355,.479001,.0115066,.356484,-.019529,.479075,.0145762,.356609,-.0240991,.47918,.018018,.356766,-.0291413,.479305,.0218379,.357009,-.0346498,.479512,.0260454,.357424,-.0405462,.479909,.0306657,.357899,-.0468825,.480337,.0357054,.358424,-.0536887,.480771,.0411728,.359041,-.0609416,.481242,.0470841,.359903,-.0685239,.481943,.0534831,.360932,-.0764883,.482741,.0603795,.362196,-.0848364,.483688,.0678028,.363847,-.0935002,.484947,.0758086,.365972,-.102471,.486588,.0844173,.368741,-.111751,.488787,.0937199,.372146,-.121334,.491405,.103732,.377114,-.131147,.495604,.114608,.38226,-.141213,.499436,.126345,.389609,-.151632,.505334,.139116,.397925,-.162073,.51168,.152995,.407824,-.172819,.518876,.168071,.420014,-.183929,.527639,.184495,.434266,-.195032,.537588,.20232,.447352,-.205792,.544379,.221189,.463726,-.216704,.553422,.241616,.481406,-.227531,.562074,.263298,.498707,-.238017,.568227,.286116,.518039,-.247936,.574473,.3101,.538277,-.257437,.579191,.335401,.561166,-.266829,.584807,.362246,.583189,-.275329,.586476,.390609,.606024,-.28234,.585578,.420998,.632419,-.287924,.584496,.454357,.656128,-.291972,.577766,.488233,.679953,-.29456,.56875,.523248,.704654,-.295816,.558388,.559168,.729016,-.295157,.544826,.595326,.752062,-.292779,.528273,.631864,.773138,-.288681,.508482,.667793,.794869,-.283358,.487341,.704035,.815101,-.27608,.46354,.739925,.834212,-.26767,.438672,.775539,.852368,-.257397,.411239,.810895,.870207,-.245689,.3829,.846472,.884063,-.231452,.351496,.881788,.898284,-.215561,.31895,.917438,.912964,-.198208,.287367,.952422,.924666,-.180426,.254487,.987551,.934429,-.161525,.222226,1.02142,.943485,-.141197,.191143,1.05218,.9521,-.120085,.161112,1.07937,.957876,-.0975881,.130982,1.10403,.966943,-.0726842,.0990553,1.12616,.978313,-.0483705,.0662818,1.14619,.990048,-.0239072,.0329243,1.16413,.999984,461885e-9,-772859e-10,1.18099,.321287,-935049e-11,.455413,659662e-11,.332595,-237513e-9,.471437,167562e-9,.332729,-949964e-9,.471618,670192e-9,.332305,-.00213618,.471028,.00150712,.332326,-.00379765,.471055,.00267959,.332344,-.00593353,.471072,.00418751,.332356,-.00854349,.471077,.00603172,.332403,-.0116268,.471121,.00821362,.332461,-.0151824,.47117,.0107357,.332552,-.0192088,.471251,.0136014,.332657,-.0237024,.47133,.0168152,.332835,-.0286615,.471487,.0203853,.333083,-.0340765,.471708,.0243212,.333547,-.0398563,.47219,.0286518,.333989,-.0460916,.472587,.0333763,.334532,-.0527897,.473054,.0385084,.335167,-.0599284,.473568,.0440638,.33608,-.0673514,.474362,.0500962,.337146,-.0752237,.475231,.0566022,.338462,-.083418,.476282,.0636272,.34014,-.0919382,.477615,.0712153,.342341,-.100741,.479404,.079417,.345088,-.109905,.481618,.0882631,.349049,-.119369,.485081,.0978851,.353939,-.129033,.489317,.108336,.359893,-.139038,.494309,.119698,.366945,-.149411,.499983,.132024,.375814,-.159843,.507185,.145558,.387112,-.170664,.516392,.160433,.40023,-.181897,.526519,.176648,.412555,-.192785,.53423,.193922,.427023,-.203663,.542741,.212662,.443685,-.214695,.552066,.232944,.461499,-.225561,.560762,.254495,.480975,-.236257,.569421,.277531,.501,-.24639,.576101,.301724,.521691,-.256101,.581493,.327112,.543478,-.265289,.585221,.353917,.566094,-.273938,.587614,.381941,.589578,-.281679,.587991,.41172,.614583,-.287655,.585928,.444148,.641813,-.292228,.582092,.478617,.666189,-.295172,.57398,.51397,.690475,-.29648,.561676,.550118,.715543,-.296203,.548758,.586933,.740405,-.293999,.532792,.62384,.762183,-.28998,.512735,.660723,.786069,-.28478,.492402,.69807,.806812,-.277568,.469058,.734422,.826987,-.268951,.443017,.770946,.844588,-.259049,.415501,.80699,.863725,-.2471,.387328,.842107,.879137,-.234157,.356108,.878078,.894634,-.218719,.324315,.914058,.909162,-.201293,.291813,.949922,.92072,-.18267,.258474,.985337,.93158,-.163212,.225593,1.0205,.941238,-.142771,.193986,1.05273,.949293,-.120956,.163392,1.08075,.956226,-.0985743,.132934,1.10559,.96546,-.075118,.101255,1.12823,.977403,-.0497921,.0675441,1.149,.989648,-.0241574,.0334681,1.16765,1.00001,5762e-7,-184807e-9,1.18519,.303474,-916603e-11,.4542,61243e-10,.308894,-232869e-9,.462306,155592e-9,.309426,-931661e-9,.463093,622499e-9,.308643,-.0020949,.461933,.00139979,.308651,-.0037242,.461941,.00248874,.308662,-.00581873,.46195,.00388933,.308687,-.00837818,.461974,.00560247,.308728,-.0114016,.462011,.00762948,.308789,-.0148884,.462067,.00997326,.308882,-.0188369,.462151,.0126375,.309007,-.0232436,.462263,.0156271,.30918,-.0281054,.462417,.0189498,.309442,-.0334065,.462667,.0226167,.309901,-.0390589,.463162,.0266614,.310331,-.0452042,.463555,.0310715,.310858,-.0517735,.464019,.0358698,.311576,-.0587359,.464669,.0410848,.312436,-.0660383,.465406,.0467453,.313526,-.0737266,.466339,.0528718,.314903,-.0817574,.467504,.0595039,.316814,-.090167,.469226,.0666888,.318965,-.0987555,.470981,.0744658,.322077,-.107792,.473814,.082912,.325947,-.117098,.477241,.0920846,.331008,-.126602,.48184,.102137,.337893,-.136619,.488334,.113135,.345106,-.146838,.494415,.12511,.355111,-.157357,.503275,.138356,.365095,-.167955,.510966,.152686,.378344,-.179157,.521508,.16856,.391599,-.190143,.530455,.18561,.407786,-.20123,.541275,.204308,.425294,-.212456,.551784,.224623,.444021,-.223568,.561493,.246172,.463418,-.234154,.569886,.268979,.484077,-.244546,.577116,.293411,.505513,-.254301,.582914,.318936,.527672,-.263564,.587208,.345856,.550565,-.272332,.589277,.374054,.573656,-.280011,.588426,.403276,.59827,-.286924,.587504,.43474,.624731,-.291994,.583401,.468767,.652396,-.295159,.576997,.504411,.67732,-.296954,.565863,.54114,.703147,-.296877,.552316,.57816,.728715,-.295147,.536773,.616124,.752448,-.291275,.51771,.653885,.775169,-.285905,.496087,.691537,.799307,-.279064,.474232,.729251,.819482,-.270294,.447676,.766267,.837659,-.260032,.419656,.802616,.856903,-.248497,.391328,.838583,.873325,-.235252,.360285,.874711,.889788,-.221126,.329215,.91077,.904486,-.204304,.296392,.94653,.917711,-.185562,.262159,.983828,.928969,-.165635,.229142,1.01955,.939707,-.14442,.19673,1.05317,.948167,-.122147,.165095,1.0823,.955222,-.099098,.13451,1.10791,.964401,-.0755332,.102476,1.1312,.976605,-.0513817,.0689667,1.15218,.989085,-.0258499,.034506,1.17129,.999908,617773e-9,-271268e-9,1.18961,.285803,-905752e-11,.452348,572272e-11,.284689,-22732e-8,.450581,143626e-9,.285263,-910214e-9,.451482,575099e-9,.285302,-.00204784,.451553,.00129395,.285318,-.00364057,.451574,.0023006,.28533,-.00568813,.451585,.00359547,.285361,-.00819001,.451618,.00517934,.285397,-.0111458,.45165,.007054,.285447,-.0145536,.451688,.00922167,.285527,-.0184127,.451758,.0116869,.285688,-.0227207,.451929,.0144555,.28584,-.0274712,.452055,.0175341,.286136,-.0326278,.452369,.0209406,.286574,-.0381792,.452853,.0246965,.287012,-.0441879,.453272,.0287996,.287542,-.0506096,.453752,.033268,.288299,-.0573634,.454488,.0381504,.289186,-.0645458,.455294,.0434447,.290302,-.0720405,.456301,.0491973,.291776,-.0799046,.457648,.0554453,.29372,-.088117,.459483,.0622311,.296052,-.0965328,.461571,.0695992,.299563,-.105409,.465085,.077658,.30335,-.114553,.468506,.0864176,.309167,-.123917,.474423,.0961078,.31529,-.13381,.47995,.106643,.324163,-.144021,.488592,.118322,.333272,-.154382,.496461,.131133,.344224,-.165015,.50562,.145208,.357733,-.176168,.516719,.16073,.373046,-.187468,.528513,.177807,.38788,-.198488,.537713,.196072,.405133,-.209545,.547999,.21605,.423845,-.220724,.55759,.237484,.443777,-.231518,.566246,.26039,.464824,-.242035,.574326,.284835,.486635,-.251898,.58037,.310518,.51012,-.261304,.58568,.337678,.535301,-.270384,.590197,.366242,.559193,-.27841,.590569,.395873,.583544,-.285325,.588161,.426857,.608834,-.291113,.584249,.459477,.635753,-.294882,.57763,.494734,.664367,-.297088,.569479,.532023,.689688,-.297364,.555064,.569629,.715732,-.295949,.539522,.608124,.741307,-.292259,.521613,.646231,.764949,-.287063,.49969,.684938,.788599,-.28012,.476747,.723548,.81048,-.27153,.45116,.761135,.831372,-.261289,.424101,.798916,.850092,-.249559,.39443,.835952,.867777,-.236348,.363849,.871606,.884632,-.221569,.332477,.907843,.90047,-.20618,.300667,.944187,.914524,-.188771,.266552,.981371,.926892,-.168362,.232349,1.01841,.937951,-.146761,.199359,1.05308,.947236,-.123813,.1675,1.0839,.954367,-.099984,.136166,1.11047,.963907,-.0759278,.103808,1.13414,.976218,-.0511367,.0697061,1.15575,.988772,-.0267415,.0352529,1.17531,.999888,-520778e-9,289926e-9,1.19389,.263546,-883274e-11,.441896,526783e-11,.262352,-221849e-9,.439889,132311e-9,.262325,-886683e-9,.439848,528824e-9,.26228,-.00199476,.439765,.00118975,.262372,-.00354671,.439922,.00211568,.26239,-.00554141,.439941,.00330652,.262412,-.00797888,.439961,.00476346,.262453,-.0108584,.440002,.00648818,.262528,-.0141788,.440085,.0084835,.262615,-.017938,.440166,.0107533,.262744,-.0221346,.440291,.0133044,.262939,-.026762,.440493,.0161445,.263277,-.0317573,.440889,.0192974,.26368,-.0371832,.441338,.0227699,.264106,-.0430371,.441753,.0265698,.264624,-.0493035,.442227,.0307178,.265378,-.0558669,.442985,.0352616,.266253,-.0628718,.443795,.0401968,.267478,-.0701569,.445008,.04559,.269062,-.077845,.446599,.0514539,.270926,-.0857941,.448349,.0578382,.273693,-.0940773,.451221,.0648363,.276746,-.102704,.454097,.0724389,.281693,-.111735,.459517,.0808744,.287335,-.121004,.46531,.0901551,.29448,-.130734,.472605,.100371,.30257,-.140777,.480251,.111644,.312465,-.15111,.489444,.124111,.324856,-.16189,.500919,.137979,.33774,-.172946,.511317,.153163,.35255,-.184152,.522684,.169817,.367786,-.19522,.53248,.187886,.385474,-.20632,.543326,.207634,.404976,-.217744,.554109,.229165,.425203,-.228691,.563395,.252068,.446704,-.239299,.571565,.276471,.468951,-.249348,.577935,.302323,.493487,-.258933,.584309,.329882,.517861,-.268009,.58773,.358525,.543309,-.276238,.589612,.388585,.569704,-.28356,.589294,.419787,.594871,-.289497,.585137,.452114,.622555,-.294452,.580356,.486466,.651167,-.296918,.57185,.523079,.677332,-.297647,.558428,.5611,.703718,-.296321,.542232,.599592,.730262,-.293339,.524541,.639138,.754304,-.288036,.502691,.677978,.778051,-.281018,.479212,.716537,.801557,-.272414,.454071,.75586,.822559,-.262419,.425952,.794477,.843051,-.250702,.397313,.832664,.86232,-.237264,.366534,.869876,.879044,-.222716,.334816,.906973,.896362,-.206827,.303143,.943558,.910342,-.189659,.269699,.979759,.924119,-.171108,.236411,1.01718,.935374,-.149579,.202224,1.05289,.944295,-.126295,.16989,1.08496,.952227,-.101511,.138089,1.11256,.962041,-.0766392,.105053,1.1375,.97528,-.0511967,.070329,1.15983,.988476,-.025463,.0351268,1.17987,.999962,286808e-10,145564e-10,1.19901,.227089,-841413e-11,.404216,472707e-11,.239725,-215083e-9,.426708,120833e-9,.239904,-860718e-9,.427028,483555e-9,.239911,-.00193661,.427039,.00108806,.239914,-.00344276,.42704,.00193457,.239933,-.00537907,.427064,.00302363,.239944,-.00774482,.427065,.00435604,.239993,-.01054,.427122,.00593398,.240052,-.0137626,.427179,.00775987,.240148,-.0174115,.427279,.00983854,.240278,-.021484,.42741,.0121763,.240472,-.0259729,.427618,.0147827,.240839,-.0308131,.428086,.0176837,.241201,-.0360893,.428482,.0208775,.241626,-.0417723,.428907,.0243821,.242207,-.0478337,.42952,.0282228,.24298,-.0542199,.430332,.0324333,.243881,-.0610015,.431222,.0370252,.245123,-.0680874,.432512,.0420535,.24667,-.0755482,.434088,.0475414,.248779,-.0832873,.436323,.0535542,.251665,-.0913546,.439509,.0601716,.255305,-.0998489,.443478,.0674282,.260049,-.108576,.448713,.0754673,.266192,-.117754,.455524,.084339,.273158,-.127294,.4627,.0941683,.282131,-.137311,.472068,.10515,.293332,-.147736,.483565,.117402,.304667,-.158357,.493702,.130824,.317785,-.169274,.504708,.145724,.333245,-.180595,.517107,.16215,.349843,-.191892,.528849,.180149,.367944,-.203168,.540301,.199746,.387579,-.214443,.551514,.221047,.408247,-.225624,.560906,.243981,.43014,-.236422,.56959,.268513,.452669,-.24654,.576098,.294409,.476196,-.256157,.580925,.322002,.501157,-.265289,.584839,.351052,.527632,-.273671,.587614,.3812,.555754,-.281254,.589119,.412994,.581682,-.287448,.585204,.445498,.608196,-.292614,.579006,.479505,.635661,-.296068,.571297,.514643,.664999,-.297395,.560855,.552213,.691039,-.296645,.544525,.591365,.7179,-.293785,.526535,.630883,.744059,-.289089,.50545,.670932,.76863,-.282239,.482514,.710904,.793273,-.273688,.457246,.750259,.814731,-.26328,.428872,.78948,.835603,-.251526,.399384,.828597,.85489,-.238339,.368811,.866892,.872828,-.223607,.336617,.90563,.889462,-.207538,.303997,.943538,.904929,-.190297,.270812,.980591,.919101,-.172034,.237453,1.01935,.930536,-.152058,.204431,1.05498,.941223,-.129515,.172495,1.08717,.94982,-.104263,.140175,1.11551,.960592,-.0781944,.106465,1.14098,.974629,-.051688,.0711592,1.16418,.98811,-.0253929,.0354432,1.18465,1.00004,804378e-9,-330876e-9,1.20462,.214668,-821282e-11,.406619,433582e-11,.218053,-208144e-9,.413025,109887e-9,.217987,-832212e-9,.412901,439362e-9,.217971,-.00187246,.412876,988623e-9,.217968,-.00332855,.41286,.00175772,.217985,-.00520055,.412882,.00274729,.218014,-.00748814,.412916,.00395842,.218054,-.0101901,.412957,.00539274,.218106,-.0133057,.413005,.00705348,.218217,-.0168342,.413139,.00894581,.218338,-.0207707,.413258,.0110754,.21855,-.0251001,.413509,.0134551,.218913,-.0297861,.413992,.0161081,.219265,-.0348956,.414383,.0190307,.219696,-.0403909,.414839,.0222458,.220329,-.0462003,.415567,.025792,.220989,-.0524208,.41621,.0296637,.222027,-.058948,.417385,.0339323,.223301,-.0658208,.418779,.0386055,.224988,-.0730347,.420665,.0437355,.227211,-.0805274,.423198,.0493844,.230131,-.088395,.426566,.0556135,.233908,-.0966208,.43091,.0624829,.239092,-.105223,.437148,.0701636,.245315,-.11424,.444302,.0786949,.253166,-.12368,.453262,.0882382,.262374,-.133569,.463211,.0988682,.273145,-.143836,.474271,.110727,.285512,-.154577,.4863,.123945,.299512,-.165501,.498817,.138581,.314287,-.176698,.510341,.154676,.331083,-.188066,.522583,.172459,.349615,-.199597,.534879,.191979,.369318,-.210843,.546083,.21309,.390377,-.222068,.5562,.235998,.412411,-.233059,.564704,.260518,.435715,-.24357,.572314,.286795,.461196,-.253356,.579395,.314559,.485587,-.262362,.581985,.343581,.511908,-.270895,.584347,.374367,.539798,-.278452,.58505,.406015,.567974,-.284877,.583344,.439168,.594303,-.290124,.577348,.473005,.622951,-.294183,.570751,.508534,.652404,-.296389,.561541,.544764,.679291,-.296605,.546426,.582927,.706437,-.294095,.528599,.622681,.734485,-.28978,.508676,.663567,.758841,-.283363,.484768,.704092,.78537,-.275015,.460434,.745101,.807315,-.264689,.432166,.784712,.8271,-.252597,.401807,.824241,.849191,-.239154,.371458,.863803,.867046,-.224451,.338873,.903063,.8852,-.208342,.306175,.942763,.901771,-.190684,.272759,.981559,.915958,-.172105,.239306,1.02048,.928046,-.152214,.206071,1.05765,.939961,-.130247,.17367,1.08999,.948711,-.10672,.142201,1.11829,.959305,-.0808688,.108454,1.14467,.973009,-.0539145,.0728109,1.16839,.987631,-.0262947,.0360625,1.19004,.999978,.00132758,-559424e-9,1.21058,.193925,-793421e-11,.391974,392537e-11,.196746,-200315e-9,.397675,991033e-10,.19667,-801099e-9,.397521,396342e-9,.196633,-.00180246,.397445,891829e-9,.196654,-.00320443,.397482,.00158582,.196659,-.00500647,.39748,.00247867,.196683,-.0072086,.397506,.00357167,.196728,-.00981001,.397562,.00486675,.196792,-.0128096,.397633,.00636707,.19689,-.0162055,.397746,.00807752,.197017,-.0199943,.397884,.0100052,.19729,-.024139,.39827,.0121691,.197583,-.0286671,.398639,.0145755,.197927,-.0335858,.399034,.0172355,.198383,-.0388806,.399554,.0201718,.199002,-.0444736,.400289,.0234194,.199739,-.0504583,.401111,.026984,.200784,-.056729,.402349,.0309217,.202075,-.0633643,.403841,.0352496,.203898,-.0703247,.406076,.0400313,.206199,-.0775565,.408841,.0453282,.209252,-.085184,.41259,.0511794,.213638,-.0931994,.418288,.0577459,.21881,-.101617,.424681,.0650508,.225642,-.11052,.433429,.0732759,.233717,-.119772,.442897,.0824683,.242823,-.129505,.452888,.0927484,.254772,-.139906,.466407,.104417,.266603,-.150402,.477413,.117211,.28073,-.161395,.490519,.131598,.295399,-.172465,.50201,.147407,.312705,-.183982,.515311,.165031,.331335,-.195532,.52786,.184336,.351037,-.206971,.5392,.205361,.372175,-.218117,.54941,.228043,.394548,-.229327,.558642,.25267,.419598,-.240052,.567861,.279071,.443922,-.249937,.573332,.306882,.471495,-.259407,.58013,.33661,.496769,-.267749,.580564,.367328,.524951,-.275524,.581696,.399753,.55318,-.282148,.579885,.433134,.581577,-.287533,.575471,.467534,.609231,-.291612,.567445,.502943,.637478,-.293911,.557657,.53871,.667795,-.295096,.546535,.576568,.694272,-.294073,.529561,.614929,.722937,-.290386,.510561,.655909,.749682,-.284481,.487846,.697663,.774754,-.276188,.462487,.738515,.799301,-.266215,.43481,.779802,.820762,-.254116,.404879,.820045,.843231,-.240393,.374559,.860294,.861857,-.225503,.341582,.900965,.880815,-.209382,.308778,.941727,.89766,-.19155,.275232,.980916,.912926,-.172346,.240938,1.02162,.926391,-.151799,.207223,1.0597,.938429,-.129968,.17484,1.09291,.947834,-.10651,.142984,1.12248,.958432,-.0824098,.109902,1.149,.972402,-.0565242,.0744454,1.1733,.987191,-.028427,.0373794,1.19538,.999975,385685e-10,-4203e-8,1.21676,.178114,-766075e-11,.385418,354027e-11,.176074,-191966e-9,.381002,887135e-10,.17601,-767549e-9,.380861,354715e-9,.17598,-.00172696,.380798,798168e-9,.175994,-.00307012,.380824,.00141928,.176017,-.00479684,.380858,.00221859,.176019,-.00690648,.380839,.00319714,.176072,-.00939888,.380913,.0043572,.176131,-.0122726,.380979,.005702,.176239,-.0155264,.38112,.00723689,.176371,-.0191551,.381272,.00896907,.176638,-.023117,.381669,.0109194,.176912,-.0274633,.382015,.0130903,.177279,-.032173,.382476,.0154949,.17774,-.0372219,.383041,.0181669,.178344,-.0426132,.38378,.0211209,.179153,-.0483309,.384773,.0243899,.180197,-.0543447,.386076,.0280062,.181581,-.0607122,.387809,.032004,.18344,-.0673855,.390205,.036453,.186139,-.0743989,.393944,.0414162,.189432,-.0817731,.39832,.0469394,.193795,-.0895464,.404188,.0531442,.199641,-.0978264,.4121,.0601374,.206679,-.106499,.421425,.0680078,.214865,-.115654,.431504,.076919,.224406,-.125268,.442526,.0868835,.235876,-.135475,.455465,.0981875,.248335,-.146023,.4681,.110759,.262868,-.157016,.482069,.124885,.278962,-.168245,.496182,.140645,.295082,-.17958,.507401,.157838,.313738,-.191227,.520252,.17695,.333573,-.202718,.531708,.197817,.356433,-.214424,.544509,.220785,.378853,-.225492,.55373,.245306,.402717,-.236236,.561348,.271593,.428375,-.246568,.568538,.299776,.454724,-.255941,.573462,.329433,.482291,-.264511,.576356,.360598,.509706,-.272129,.576446,.393204,.538805,-.278979,.575298,.427227,.568919,-.284528,.572154,.462157,.596804,-.288801,.564691,.497997,.625987,-.291334,.555134,.534467,.656414,-.292722,.545051,.571736,.683916,-.292185,.528813,.610158,.711809,-.290043,.51106,.649061,.739547,-.285246,.490103,.690081,.766914,-.277647,.465523,.732554,.791375,-.267603,.437718,.773982,.814772,-.256109,.40882,.81609,.836691,-.242281,.377823,.856849,.856984,-.227155,.34496,.898363,.876332,-.210395,.311335,.939471,.894988,-.192612,.277703,.980799,.911113,-.173236,.243019,1.02215,.924092,-.152258,.209037,1.06139,.936828,-.129575,.175909,1.09635,.946869,-.10594,.143852,1.12707,.958284,-.081318,.110289,1.15419,.972325,-.0556133,.0747232,1.17909,.986878,-.0297899,.0383149,1.20163,.999936,-.00197169,912402e-9,1.22338,.151174,-720365e-11,.351531,309789e-11,.155594,-18279e-8,.361806,78608e-9,.156099,-731569e-9,.362982,314615e-9,.156053,-.00164578,.362869,707845e-9,.156093,-.0029261,.362961,.00125884,.156099,-.00457155,.362959,.00196783,.15612,-.00658224,.362982,.00283622,.156168,-.00895774,.363048,.00386625,.156221,-.0116962,.363101,.00506109,.156324,-.0147973,.363241,.00642675,.156476,-.0182503,.363448,.00797175,.156731,-.0220266,.36384,.00971484,.156994,-.026176,.364179,.0116575,.157341,-.0306701,.36462,.0138207,.157867,-.0354591,.365364,.0162356,.15846,-.0406141,.366111,.0189092,.159308,-.0460519,.367248,.021885,.160426,-.0518096,.368767,.0252004,.161877,-.0578906,.370745,.0288825,.163995,-.0642812,.373831,.0330139,.16655,-.0710067,.377366,.0376283,.170237,-.0781522,.382799,.0428493,.175096,-.0857172,.389915,.0487324,.181069,-.0938025,.398487,.0554214,.188487,-.102363,.408799,.0630189,.197029,-.111343,.419991,.071634,.206684,-.120812,.431455,.0812797,.218698,-.131033,.445746,.0923651,.230726,-.141373,.457471,.104545,.245516,-.152387,.472388,.118449,.261551,-.163628,.486671,.133923,.277437,-.174814,.49762,.150849,.296662,-.186713,.51162,.169924,.31795,-.198513,.525435,.190848,.339422,-.210119,.536267,.213504,.362143,-.221354,.545982,.237947,.387198,-.23224,.555364,.264427,.412349,-.24257,.561489,.292519,.439274,-.252284,.566903,.322561,.466779,-.261023,.569614,.353952,.496011,-.26899,.571589,.387278,.524964,-.275498,.570325,.421356,.556518,-.281449,.568792,.457314,.584363,-.285526,.560268,.493199,.614214,-.28844,.55205,.530276,.645684,-.289777,.541906,.56855,.673446,-.289722,.526464,.606927,.701924,-.287792,.509872,.645945,.73037,-.284315,.490649,.685564,.757405,-.278804,.467964,.726511,.784025,-.269543,.441468,.768601,.808255,-.258117,.41216,.811321,.830739,-.244728,.380606,.853496,.851914,-.229428,.348111,.895374,.872586,-.212508,.314732,.937674,.891581,-.194025,.280338,.979869,.907641,-.174711,.245203,1.02253,.922233,-.153509,.21077,1.06371,.935878,-.130418,.177399,1.09972,.946338,-.105558,.144507,1.13124,.957265,-.080059,.110508,1.15973,.971668,-.0539766,.0742311,1.18515,.9866,-.0277101,.0375224,1.20858,1.00021,-515531e-9,135226e-9,1.23135,.137468,-686011e-11,.345041,273315e-11,.13703,-173378e-9,.343936,690761e-10,.136986,-693048e-9,.34383,276126e-9,.136964,-.00155931,.343761,621337e-9,.137003,-.00277211,.343863,.00110494,.137012,-.00433103,.343868,.00172744,.137043,-.00623606,.343916,.00249022,.13709,-.0084868,.343986,.00339559,.137145,-.0110814,.344045,.00444687,.137242,-.0140187,.344177,.00565007,.137431,-.0172713,.344491,.00701868,.137644,-.0208605,.344805,.00856042,.13791,-.024792,.345172,.0102863,.138295,-.0290461,.345734,.0122185,.138764,-.0335957,.346371,.0143771,.139415,-.038467,.347298,.0167894,.140272,-.0436176,.348527,.0194895,.141457,-.0491016,.350276,.0225043,.14303,-.0548764,.352646,.0258962,.145289,-.0610096,.356206,.0297168,.148502,-.0674777,.361488,.0340562,.152188,-.074345,.367103,.0389534,.157359,-.0817442,.375247,.0445541,.16379,-.0896334,.385064,.0509535,.171376,-.098005,.396082,.0582611,.179901,-.106817,.407418,.06654,.189892,-.116239,.420031,.075994,.201838,-.12627,.434321,.0867239,.214311,-.136701,.447631,.0987517,.228902,-.147616,.462046,.112353,.245107,-.158871,.476942,.127605,.262292,-.170261,.490285,.144469,.281215,-.182017,.503783,.163282,.301058,-.193729,.515505,.183873,.322752,-.205512,.52682,.206466,.347547,-.217214,.539473,.231194,.370969,-.227966,.546625,.257288,.397533,-.238555,.55472,.285789,.42398,-.248278,.559468,.315746,.452928,-.257422,.564095,.347724,.482121,-.265306,.565426,.380922,.510438,-.272043,.563205,.415639,.541188,-.277614,.561087,.451702,.571667,-.281927,.554922,.48845,.602432,-.285015,.546838,.526442,.634126,-.286512,.537415,.564896,.662816,-.286388,.522906,.604037,.692411,-.284734,.507003,.643795,.720946,-.281297,.488398,.68298,.748293,-.276262,.466353,.723466,.776931,-.269978,.443573,.764565,.801065,-.260305,.415279,.805838,.825843,-.247426,.384773,.849985,.84807,-.232437,.352555,.893174,.869122,-.215806,.318642,.936564,.888963,-.197307,.28381,.980253,.905547,-.177203,.247888,1.02463,.918554,-.155542,.212904,1.06714,.931395,-.131948,.1787,1.10451,.941749,-.106723,.145902,1.13694,.954551,-.0804939,.111193,1.1666,.970279,-.0534239,.0744697,1.19249,.986117,-.0257452,.0368788,1.21665,.999938,.00190634,-.0010291,1.23981,.118493,-647439e-11,.32272,23772e-10,.118765,-163023e-9,.323456,598573e-10,.118772,-65212e-8,.323477,239447e-9,.118843,-.00146741,.323657,538881e-9,.118804,-.00260846,.323553,95826e-8,.118826,-.00407576,.323595,.00149845,.118846,-.00586826,.323617,.00216047,.118886,-.00798578,.32367,.00294679,.118947,-.0104273,.323753,.00386124,.119055,-.0131909,.323922,.00490999,.119241,-.0162444,.324251,.00610804,.11944,-.0196339,.324544,.00745805,.119739,-.0233378,.325026,.00897805,.12011,-.0273179,.325586,.0106895,.120571,-.0316143,.326231,.0126073,.12124,-.0361939,.327264,.0147654,.122162,-.0410511,.328733,.0172001,.123378,-.0462233,.330659,.0199375,.125183,-.0517109,.333754,.0230498,.127832,-.0575652,.338507,.026597,.130909,-.0637441,.343666,.0306345,.135221,-.0704302,.351063,.035273,.14082,-.0776364,.360604,.0406137,.146781,-.0852293,.369638,.0466788,.155121,-.0935351,.3827,.0537628,.16398,-.102234,.39522,.0617985,.173926,-.111465,.40793,.07097,.185137,-.121296,.42105,.0813426,.19826,-.13169,.435735,.0931596,.212938,-.142614,.450932,.106547,.229046,-.153884,.465726,.121575,.246246,-.165382,.479461,.138286,.264637,-.176806,.492106,.15666,.284959,-.188793,.504774,.17728,.308157,-.200763,.518805,.19988,.330951,-.21239,.528231,.224293,.3549,-.223521,.536376,.250541,.381502,-.234169,.544846,.278902,.409529,-.244077,.551717,.309227,.437523,-.253363,.55517,.341426,.467624,-.261659,.557772,.37518,.497268,-.268498,.556442,.41007,.528294,-.274018,.553915,.446445,.559053,-.278169,.549153,.483779,.589329,-.281229,.539878,.522249,.622503,-.282902,.53162,.561754,.652382,-.282815,.518119,.601544,.681847,-.281247,.502187,.641574,.712285,-.277986,.484824,.682633,.740094,-.273017,.463483,.723426,.768478,-.266692,.441299,.763747,.794556,-.258358,.415238,.805565,.819408,-.248807,.386912,.847254,.843411,-.236214,.356165,.891091,.862397,-.219794,.320562,.936174,.883113,-.201768,.285322,.982562,.90023,-.181672,.249713,1.02862,.915192,-.159279,.214546,1.07163,.928458,-.134725,.180285,1.10995,.94069,-.10913,.147119,1.14354,.953409,-.0821315,.112492,1.17372,.969537,-.0542677,.0752014,1.20043,.985612,-.0259096,.0370361,1.22528,.999835,.00298198,-.00151801,1.24959,.10097,-602574e-11,.300277,202619e-11,.101577,-152164e-9,.302077,511662e-10,.101572,-608889e-9,.302066,204751e-9,.101566,-.00136997,.302047,460753e-9,.101592,-.00243557,.302114,819497e-9,.101608,-.0038053,.30214,.00128154,.101627,-.00547906,.30216,.0018483,.101669,-.00745647,.302224,.00252223,.101732,-.00973615,.302318,.00330716,.101844,-.0123097,.302513,.00421061,.102025,-.0151681,.30285,.00524481,.102224,-.0183334,.303166,.0064154,.102515,-.0217819,.303654,.00774063,.102886,-.0255067,.304243,.0092398,.103395,-.029514,.305089,.0109339,.104109,-.0337912,.306301,.0128561,.105074,-.0383565,.30798,.0150338,.10654,-.0432132,.310726,.0175228,.108478,-.0484244,.314351,.0203648,.111015,-.0539339,.319032,.0236325,.114682,-.0598885,.32605,.0274188,.11911,-.0663375,.334109,.0317905,.124736,-.0733011,.344013,.0368502,.131479,-.0807744,.355358,.0427104,.139283,-.0888204,.367614,.0494788,.148054,-.0973394,.380072,.0572367,.159037,-.10665,.395678,.0662704,.169794,-.116221,.40795,.0763192,.18314,-.126632,.423546,.087956,.197515,-.137383,.438213,.101042,.213514,-.148641,.453248,.115827,.23065,-.160117,.46688,.132283,.249148,-.171807,.479962,.150644,.270219,-.183695,.494618,.171073,.292338,-.195574,.506937,.193378,.314999,-.207205,.516463,.217585,.340991,-.218955,.528123,.24428,.367982,-.229917,.537025,.272784,.39432,-.239737,.541627,.302742,.423364,-.249048,.546466,.335112,.453751,-.257329,.549466,.369032,.48416,-.264623,.549503,.404577,.515262,-.270411,.547008,.441337,.547036,-.274581,.542249,.479162,.576614,-.277266,.533015,.517904,.611143,-.279144,.525512,.558508,.640989,-.279001,.51154,.598995,.671182,-.277324,.495641,.639935,.700848,-.273908,.477526,.681017,.729862,-.269063,.457955,.722764,.758273,-.262282,.434846,.764349,.784121,-.254281,.409203,.806206,.809798,-.24505,.382694,.848617,.834953,-.233861,.354034,.892445,.856817,-.221308,.321764,.936263,.877609,-.205996,.288118,.982401,.897489,-.186702,.253277,1.02975,.913792,-.164618,.217963,1.07488,.92785,-.140023,.183221,1.11487,.940378,-.11328,.149385,1.14947,.95273,-.0853958,.114152,1.1807,.969059,-.0568698,.0769845,1.20912,.985574,-.0276502,.0381186,1.23498,.999943,.00239052,-.00126861,1.25987,.0852715,-560067e-11,.279021,171162e-11,.0854143,-140871e-9,.279483,430516e-10,.0854191,-563385e-9,.2795,172184e-9,.0854188,-.00126753,.279493,387464e-9,.0854229,-.00225337,.279501,68918e-8,.0854443,-.00352086,.279549,.00107803,.0854697,-.00506962,.279591,.00155536,.0855093,-.00689873,.279652,.00212354,.0855724,-.00900821,.279752,.00278703,.0856991,-.0113799,.280011,.0035551,.085855,-.0140314,.280297,.00443449,.0860682,-.016963,.280682,.00543636,.086344,-.0201438,.281159,.0065788,.0867426,-.0235999,.281886,.00787977,.087239,-.0273069,.282745,.0093606,.0879815,-.031269,.284139,.011056,.0891258,-.035531,.28647,.0130065,.0906909,-.0400947,.289708,.0152495,.0927624,-.0449638,.293904,.0178454,.0958376,-.0502427,.300471,.0208915,.0995827,-.0559514,.30806,.0244247,.104526,-.0622152,.317874,.0285721,.110532,-.0690046,.329332,.0334227,.117385,-.0763068,.341217,.0390466,.12522,-.084184,.353968,.0455786,.134037,-.0925248,.366797,.0530773,.144014,-.101487,.380209,.0617424,.156013,-.111273,.395956,.071777,.168872,-.121431,.41053,.0830905,.183089,-.132105,.425073,.0959341,.198763,-.143286,.439833,.110448,.216159,-.154841,.454507,.126769,.234859,-.166588,.468368,.14495,.255879,-.178626,.482846,.165233,.27677,-.190218,.493489,.187217,.301184,-.202227,.506549,.211659,.325852,-.213764,.5158,.237922,.352824,-.22487,.525442,.26632,.380882,-.235246,.532487,.296691,.410137,-.244847,.537703,.329179,.439787,-.253122,.540361,.363135,.472291,-.260517,.542734,.399222,.501856,-.266519,.538826,.436352,.534816,-.270905,.535152,.474505,.565069,-.273826,.525979,.513988,.597154,-.275333,.516394,.554852,.630473,-.275314,.506206,.596592,.660574,-.273323,.489769,.638117,.692015,-.270008,.472578,.680457,.720647,-.265001,.452134,.723008,.750528,-.258311,.430344,.765954,.777568,-.250046,.405624,.809012,.80387,-.240114,.378339,.852425,.828439,-.228737,.349877,.895346,.851472,-.216632,.318968,.940695,.873906,-.202782,.287489,.987235,.89467,-.187059,.254394,1.03348,.912281,-.168818,.221294,1.07812,.927358,-.146494,.18675,1.11928,.940385,-.120009,.152322,1.15609,.952672,-.0917183,.117514,1.18875,.968496,-.0620321,.0797405,1.21821,.985236,-.0314945,.0402383,1.24523,.99998,-575153e-9,110644e-9,1.27133,.0702429,-512222e-11,.255273,140947e-11,.0702981,-128826e-9,.255469,354488e-10,.0703691,-515562e-9,.255727,141874e-9,.0703805,-.00116,.255754,31929e-8,.0703961,-.00206224,.255813,567999e-9,.0704102,-.00322223,.255839,88871e-8,.0704298,-.00463928,.255863,.00128272,.0704759,-.00631375,.255953,.00175283,.0705434,-.00824317,.256079,.00230342,.0706693,-.010412,.25636,.0029443,.0708189,-.0128439,.256647,.00368031,.0710364,-.0155177,.257084,.00452614,.0713223,-.0184374,.257637,.00549706,.0717182,-.0216002,.258416,.00661246,.072321,-.0249966,.259699,.00790147,.0731446,-.0286566,.261475,.0093884,.0743352,-.0325888,.264132,.0111186,.0760676,-.036843,.26815,.013145,.078454,-.0414292,.273636,.0155251,.0818618,-.0464634,.281653,.0183525,.0857382,-.0519478,.289992,.0216642,.0908131,-.0579836,.30066,.0255956,.0967512,-.0645124,.312204,.0301954,.103717,-.0716505,.325001,.0356017,.111596,-.0793232,.338129,.041896,.120933,-.087645,.352853,.0492447,.130787,-.096492,.366192,.0576749,.142311,-.105973,.380864,.0673969,.155344,-.116182,.396575,.0785899,.169535,-.126815,.411443,.0912377,.185173,-.138015,.426256,.105607,.201755,-.149325,.439607,.121551,.221334,-.161207,.455467,.139608,.241461,-.173162,.469096,.159591,.26294,-.18504,.481014,.18156,.286776,-.196881,.493291,.205781,.311596,-.208311,.503556,.231819,.338667,-.219671,.513268,.260274,.366021,-.230451,.519414,.290862,.395875,-.240131,.526766,.323196,.425564,-.248566,.52905,.357071,.457094,-.256195,.530796,.393262,.488286,-.262331,.528703,.430797,.522291,-.267141,.52727,.470231,.554172,-.270411,.519848,.510477,.586427,-.271986,.510307,.551594,.619638,-.27192,.499158,.593849,.650656,-.269817,.483852,.636314,.68284,-.266267,.467515,.679679,.714356,-.26113,.44931,.723884,.742717,-.254067,.425789,.767245,.770894,-.245652,.401144,.811819,.797358,-.235554,.374224,.856315,.823377,-.223896,.346167,.901077,.847456,-.210865,.316056,.946502,.870697,-.196574,.284503,.993711,.891068,-.180814,.251628,1.04134,.909267,-.163314,.219065,1.08609,.925653,-.143304,.186446,1.12702,.940017,-.121322,.153416,1.16371,.952398,-.0973872,.120334,1.19712,.967568,-.0698785,.08352,1.22791,.984772,-.0390031,.0439209,1.25672,1.00026,-.0070087,.00315668,1.28428,.0556653,-459654e-11,.227325,112556e-11,.0565238,-116382e-9,.230826,284985e-10,.0565717,-465666e-9,.231026,114036e-9,.0565859,-.00104773,.231079,256656e-9,.0565761,-.00186255,.231025,45663e-8,.0565913,-.00291002,.231058,714664e-9,.0566108,-.00418998,.231085,.00103224,.0566532,-.00570206,.231169,.00141202,.0567473,-.00743666,.231417,.00186018,.0568567,-.00940298,.231661,.00238264,.0569859,-.0115991,.231895,.00298699,.0572221,-.0140096,.232456,.00368957,.057519,-.0166508,.233096,.00450303,.0579534,-.01951,.234094,.00544945,.0585922,-.0225991,.235629,.00655564,.0595647,-.0259416,.238106,.00785724,.0609109,-.0295661,.241557,.00939127,.0628751,-.0335126,.246652,.0112198,.0656908,-.0378604,.254091,.0134168,.0691347,-.0426543,.262666,.0160374,.0732165,-.0478967,.272029,.0191514,.0782863,-.0536716,.283007,.0228597,.0843973,-.0600683,.295732,.0272829,.0913598,-.0670095,.308779,.032484,.0994407,-.0745516,.322886,.0385886,.108189,-.082712,.336408,.0457133,.118574,-.0914927,.351692,.0539832,.129989,-.100854,.366502,.0635162,.142722,-.110837,.381675,.0744386,.156654,-.121353,.3963,.0868483,.172151,-.132414,.411477,.100963,.188712,-.143809,.42508,.116795,.208093,-.155765,.441328,.134715,.227936,-.167608,.454328,.154396,.249495,-.179579,.467235,.176179,.27362,-.191488,.480248,.200193,.296371,-.202618,.487886,.225775,.324234,-.214133,.499632,.25441,.353049,-.225212,.509532,.285077,.381785,-.234875,.514265,.317047,.414038,-.244205,.521282,.351874,.445251,-.252145,.522931,.388279,.476819,-.258433,.520947,.425825,.509209,-.263411,.517669,.465104,.542759,-.266732,.512841,.505741,.574822,-.268263,.503317,.547611,.609324,-.268489,.493035,.590953,.641772,-.266941,.478816,.63488,.674049,-.263297,.462863,.679072,.705071,-.257618,.442931,.723487,.734709,-.250625,.421299,.768708,.763704,-.24179,.397085,.814375,.791818,-.231115,.370577,.859907,.817439,-.21922,.34232,.906715,.843202,-.205658,.312627,.953943,.866639,-.190563,.280933,1.00185,.888129,-.173978,.248393,1.05105,.907239,-.155485,.216007,1.09704,.923893,-.134782,.183233,1.13857,.938882,-.11249,.150376,1.17539,.952464,-.0890706,.117177,1.20924,.968529,-.0646523,.0813095,1.24055,.984763,-.038606,.0439378,1.27018,1.00053,-.01238,.00598668,1.29873,.0437928,-409594e-11,.204012,879224e-12,.0440166,-103395e-9,.205049,221946e-10,.0440529,-413633e-9,.205225,887981e-10,.0440493,-930594e-9,.2052,199858e-9,.0439884,-.00165352,.204901,355495e-9,.0440716,-.0025849,.205255,556983e-9,.0440968,-.00372222,.205311,805326e-9,.0441359,-.00506478,.205391,.00110333,.0442231,-.00660384,.205638,.00145768,.0443254,-.00835246,.205877,.00187275,.0444832,-.0102992,.20627,.00235938,.0447001,-.0124449,.206796,.0029299,.0450168,-.0147935,.207593,.0036005,.0454816,-.017336,.208819,.00439246,.0462446,-.0201156,.211036,.00533864,.0473694,-.0231568,.214388,.00646984,.0490191,-.0264941,.219357,.00783856,.0512776,-.030184,.226061,.00950182,.0541279,-.0342661,.234094,.0115156,.0578989,-.0388539,.244297,.0139687,.0620835,-.0438735,.254457,.0169015,.0673497,-.04951,.266706,.0204554,.0731759,-.0556263,.278753,.0246606,.0803937,-.0624585,.29309,.0297126,.0879287,-.0697556,.305856,.0355868,.0970669,-.0778795,.321059,.0425768,.106508,-.0863541,.333873,.05056,.11776,-.0955935,.349008,.0598972,.130081,-.105438,.363776,.0706314,.144454,-.115899,.380112,.0828822,.1596,-.126827,.394843,.0967611,.176097,-.138161,.409033,.112381,.194726,-.149904,.424257,.129952,.213944,-.161675,.436945,.149333,.235516,-.173659,.450176,.170892,.260564,-.185963,.466305,.194984,.285183,-.197582,.477328,.220805,.311095,-.208697,.486566,.248694,.338924,-.219519,.494811,.279015,.369757,-.229766,.504065,.311725,.3996,-.238879,.507909,.345844,.430484,-.246802,.509805,.381749,.46413,-.253924,.511436,.420251,.497077,-.259319,.508787,.459957,.530434,-.263297,.50394,.501356,.565725,-.265619,.49804,.544252,.599254,-.265842,.487346,.587856,.631251,-.263978,.472975,.631969,.663972,-.26043,.457135,.677471,.697724,-.255358,.439844,.723744,.727725,-.248308,.417872,.770653,.756417,-.239181,.39273,.817357,.785419,-.22814,.367839,.864221,.81266,-.215681,.339449,.912701,.839391,-.201623,.309279,.962419,.86366,-.185624,.278029,1.0122,.885028,-.16797,.245294,1.06186,.904639,-.148336,.212689,1.10934,.922048,-.12637,.179616,1.15063,.936952,-.102928,.146749,1.18885,.951895,-.0785268,.112733,1.22352,.967198,-.0530153,.0760056,1.25681,.984405,-.02649,.0383183,1.28762,1.00021,70019e-8,-20039e-8,1.31656,.0325964,-355447e-11,.176706,655682e-12,.0329333,-899174e-10,.178527,165869e-10,.0329181,-359637e-9,.178453,663498e-10,.0329085,-808991e-9,.178383,149332e-9,.0329181,-.00143826,.178394,265873e-9,.0329425,-.00224678,.178517,416597e-9,.0329511,-.00323575,.17849,603299e-9,.033011,-.00439875,.178695,829422e-9,.0330733,-.00574059,.178843,.00109908,.0331857,-.00725896,.179176,.00141933,.0333445,-.00895289,.179618,.0017999,.0335674,-.0108219,.180238,.00225316,.033939,-.0128687,.181417,.00279765,.0345239,-.015114,.183395,.0034564,.0354458,-.017596,.186616,.00425864,.0368313,-.0203524,.191547,.00524936,.0386115,-.0234105,.197508,.00647033,.0410303,-.0268509,.205395,.00798121,.0442245,-.0307481,.215365,.0098557,.0478659,-.0350863,.225595,.0121417,.0522416,-.0399506,.236946,.0149385,.0574513,-.045357,.249442,.0183189,.0631208,-.0512863,.261222,.0223644,.0701124,-.0579273,.275418,.0272418,.0777331,-.0650652,.288989,.0329458,.0862709,-.0728813,.302546,.0396819,.096103,-.081363,.317164,.04757,.106976,-.0904463,.331733,.0567012,.119175,-.100105,.34661,.067202,.132919,-.110375,.362249,.0792588,.147727,-.121115,.376978,.0928672,.163618,-.132299,.390681,.108228,.182234,-.143887,.406571,.125502,.201809,-.155827,.42042,.144836,.225041,-.168357,.438411,.166706,.247621,-.18004,.450368,.189909,.27097,-.191536,.460083,.215251,.296658,-.203024,.469765,.243164,.325892,-.214056,.481837,.273388,.35406,-.224104,.487474,.305344,.384372,-.233489,.492773,.339741,.41749,-.241874,.498451,.376287,.45013,-.248834,.499632,.414195,.481285,-.254658,.495233,.454077,.519183,-.259367,.496401,.496352,.551544,-.261818,.487686,.538798,.587349,-.262964,.479453,.583626,.621679,-.262128,.467709,.629451,.654991,-.258998,.452123,.67566,.686873,-.254119,.433495,.723248,.719801,-.246946,.413657,.771156,.750355,-.237709,.390366,.81989,.780033,-.226549,.364947,.868601,.809254,-.214186,.337256,.920034,.836576,-.199639,.307395,.971706,.861774,-.183169,.275431,1.02479,.885707,-.165111,.243431,1.07837,.904742,-.144363,.210921,1.12783,.915604,-.121305,.17647,1.17254,.930959,-.0962119,.143106,1.21012,.948404,-.069969,.108112,1.24474,.967012,-.0427586,.0708478,1.27718,.984183,-.0147043,.032335,1.3083,.999577,.0142165,-.00726867,1.3382,.0229227,-299799e-11,.148623,462391e-12,.0232194,-758796e-10,.15054,117033e-10,.0232315,-303636e-9,.15063,468397e-10,.0232354,-683189e-9,.150624,105472e-9,.0232092,-.0012136,.150445,187744e-9,.0232523,-.00189765,.150679,294847e-9,.0232828,-.00273247,.150789,428013e-9,.0233371,-.00371287,.150995,591134e-9,.0234015,-.00484794,.15118,787642e-9,.023514,-.00612877,.151562,.00102547,.023679,-.00756125,.152116,.00131351,.0239559,-.00914651,.153162,.00166594,.0244334,-.010904,.155133,.00210182,.025139,-.0128615,.158035,.00264406,.0262598,-.0150628,.162751,.00332923,.0277875,-.0175532,.168944,.00419773,.0298472,-.0203981,.176835,.00530034,.0325444,-.023655,.186686,.00669777,.0355581,-.0272982,.196248,.00842661,.0392841,-.0314457,.207352,.0105854,.0436815,-.0361157,.219279,.0132458,.0485272,-.0412932,.230728,.0164736,.0541574,-.0470337,.242994,.0203715,.0609479,-.0535002,.257042,.0250953,.0685228,-.0605409,.27102,.0306856,.0768042,-.0680553,.28406,.037193,.0864844,-.0765011,.299186,.0449795,.0969415,-.0852674,.3132,.0538316,.108478,-.0947333,.327138,.0641149,.121705,-.10481,.342345,.0759185,.136743,-.115474,.358472,.0894116,.152986,-.126536,.374067,.104562,.170397,-.138061,.388267,.121632,.191392,-.150203,.406467,.140996,.211566,-.161751,.418641,.161696,.233567,-.173407,.430418,.184557,.257769,-.185397,.44277,.210092,.28531,-.197048,.457191,.237827,.311726,-.20784,.464712,.267253,.340537,-.218345,.472539,.299332,.372921,-.228306,.482331,.333988,.402924,-.236665,.484378,.369722,.434475,-.244097,.484717,.407836,.469736,-.250547,.487093,.448465,.505045,-.25511,.485575,.490263,.540262,-.258444,.481225,.534495,.576347,-.259903,.473481,.579451,.608656,-.259572,.4603,.625604,.646679,-.257908,.450341,.674511,.679902,-.253663,.431561,.723269,.714159,-.247419,.412684,.773263,.745345,-.239122,.389388,.824182,.778248,-.228837,.365361,.876634,.807208,-.216197,.337667,.92945,.835019,-.201772,.307197,.985261,.860261,-.185291,.274205,1.04299,.877601,-.165809,.240178,1.09816,.898211,-.143897,.207571,1.14694,.915789,-.119513,.174904,1.19008,.931831,-.0932919,.141423,1.2297,.949244,-.0656528,.105603,1.26553,.967527,-.0370262,.0679551,1.29986,.984139,-.00730117,.0283133,1.33252,.999713,.0234648,-.0121785,1.36397,.0152135,-245447e-11,.122795,304092e-12,.0151652,-615778e-10,.122399,76292e-10,.0151181,-245948e-9,.122023,304802e-10,.0151203,-553394e-9,.12203,686634e-10,.015125,-983841e-9,.122037,122463e-9,.0151427,-.00153774,.12214,192706e-9,.0151708,-.0022103,.122237,281219e-9,.0152115,-.00300741,.12238,390804e-9,.0152877,-.00392494,.1227,526317e-9,.015412,-.00496597,.123244,69443e-8,.0156201,-.00613314,.124228,90547e-8,.0159658,-.00744113,.125945,.0011732,.0165674,-.00892546,.129098,.00151888,.017487,-.010627,.133865,.00197007,.018839,-.0126043,.140682,.0025637,.020554,-.0148814,.148534,.00333637,.0226727,-.0175123,.157381,.00433738,.0251879,-.0205266,.166685,.00561664,.0283635,-.0240319,.177796,.00725563,.0318694,-.0279432,.188251,.00928811,.0361044,-.0324313,.200038,.011835,.0406656,-.0373527,.210685,.0149146,.0463846,-.0430132,.224182,.0187254,.0525696,-.0491013,.23634,.0232283,.0598083,-.0559175,.250013,.0286521,.0679437,-.0633657,.263981,.0350634,.0771181,-.0714602,.278072,.0425882,.0881273,-.0803502,.29511,.0514487,.0996628,-.0896903,.309976,.0615766,.112702,-.099644,.325611,.0732139,.126488,-.109829,.339321,.0862324,.142625,-.120859,.35574,.101275,.15953,-.131956,.369845,.117892,.176991,-.143145,.38146,.136205,.199715,-.155292,.40052,.157252,.220787,-.167066,.412055,.179966,.243697,-.178396,.423133,.204418,.272106,-.190433,.439524,.232141,.297637,-.201265,.447041,.261109,.325273,-.211834,.454488,.292627,.357219,-.221889,.465004,.326669,.387362,-.230729,.468527,.362426,.423131,-.23924,.475836,.401533,.45543,-.246067,.475017,.441902,.493393,-.251557,.478017,.484239,.526253,-.255571,.4709,.528586,.560554,-.257752,.463167,.574346,.599306,-.258076,.456452,.621655,.634541,-.256471,.443725,.670492,.668907,-.253283,.428719,.721943,.705619,-.247562,.411348,.772477,.739034,-.240626,.388939,.8264,.771408,-.231493,.36425,.881702,.803312,-.220125,.337321,.9385,.828457,-.206645,.305364,.997437,.854819,-.190664,.273715,1.05693,.878666,-.171429,.242218,1.11251,.898404,-.149235,.209556,1.16398,.917416,-.12435,.176863,1.21014,.933133,-.0972703,.142775,1.25178,.95066,-.0683607,.106735,1.29028,.968589,-.0378724,.0681609,1.32703,.984776,-.00605712,.0273966,1.36158,.99994,.0263276,-.0138124,1.3943,.00867437,-186005e-11,.0928979,173682e-12,.00864003,-466389e-10,.0925237,435505e-11,.00864593,-186594e-9,.0925806,174322e-10,.00864095,-419639e-9,.0924903,392862e-10,.00863851,-746272e-9,.0924589,702598e-10,.00868531,-.00116456,.0929,111188e-9,.00869667,-.00167711,.0928529,163867e-9,.00874332,-.00228051,.0930914,23104e-8,.00882709,-.00297864,.0935679,31741e-8,.00898874,-.00377557,.0946165,430186e-9,.00929346,-.00469247,.0967406,580383e-9,.00978271,-.00575491,.100084,783529e-9,.0105746,-.00701514,.105447,.00106304,.0116949,-.00851797,.112494,.00144685,.0130419,-.0102757,.119876,.00196439,.0148375,-.012381,.129034,.00266433,.0168725,-.01482,.137812,.00358364,.0193689,-.0176563,.147696,.00478132,.0222691,-.0209211,.157795,.00631721,.0256891,-.0246655,.168431,.00826346,.0294686,-.0288597,.178587,.0106714,.0340412,-.0336441,.190251,.0136629,.0393918,-.039033,.202999,.0173272,.0453947,-.0450087,.215655,.0217448,.0521936,-.0515461,.228686,.0269941,.0600279,-.058817,.242838,.033272,.0692398,-.0667228,.258145,.0406457,.0793832,-.0752401,.273565,.0492239,.0902297,-.0841851,.287735,.0590105,.102014,-.0936479,.301161,.0702021,.116054,-.103967,.317438,.0832001,.13191,-.114622,.334166,.0977951,.148239,-.125452,.348192,.113985,.165809,-.136453,.361094,.131928,.184616,-.147648,.373534,.151811,.207491,-.159607,.39101,.174476,.230106,-.171119,.402504,.198798,.257036,-.182906,.418032,.225796,.281172,-.193605,.425468,.254027,.312034,-.204771,.440379,.285713,.340402,-.214988,.445406,.319196,.370231,-.224711,.44968,.35537,.407105,-.233516,.460747,.393838,.439037,-.240801,.460624,.433747,.47781,-.24762,.465957,.477234,.510655,-.251823,.460054,.52044,.550584,-.255552,.459172,.567853,.585872,-.257036,.450311,.615943,.620466,-.257535,.437763,.667693,.660496,-.255248,.426639,.718988,.695578,-.251141,.409185,.772503,.732176,-.244718,.39015,.827023,.760782,-.236782,.362594,.885651,.79422,-.225923,.33711,.943756,.824521,-.213855,.308272,1.00874,.854964,-.197723,.278529,1.06764,.878065,-.179209,.246208,1.12836,.899834,-.157569,.21329,1.18318,.918815,-.133206,.181038,1.23161,.934934,-.106545,.146993,1.27644,.952115,-.0780574,.111175,1.31842,.96906,-.0478279,.0728553,1.35839,.985178,-.0160014,.032579,1.39697,1.00039,.0173126,-.0095256,1.43312,.00384146,-124311e-11,.0613583,778271e-13,.00390023,-314043e-10,.0622919,196626e-11,.00389971,-125622e-9,.0622632,787379e-11,.00389491,-282352e-9,.0620659,1778e-8,.00391618,-502512e-9,.0624687,320918e-10,.00392662,-784458e-9,.0625113,515573e-10,.00396053,-.00112907,.0628175,778668e-10,.00401911,-.00153821,.0633286,113811e-9,.00414994,-.0020208,.0646443,16445e-8,.00441223,-.00260007,.0673886,237734e-9,.00484427,-.0033097,.0716528,345929e-9,.00549109,-.00418966,.0774998,505987e-9,.00636293,-.00527331,.0844758,739208e-9,.00746566,-.00660428,.0921325,.00107347,.00876625,-.00818826,.0997067,.00153691,.0103125,-.0100811,.107433,.00217153,.0123309,-.0123643,.117088,.00303427,.0146274,-.0150007,.126438,.00416018,.0172295,-.0180531,.135672,.00561513,.0204248,-.0215962,.146244,.007478,.0241597,-.0256234,.157481,.00981046,.0284693,-.0302209,.169125,.0127148,.033445,-.0353333,.181659,.0162453,.0391251,-.0410845,.1944,.0205417,.0454721,-.0473451,.207082,.0256333,.0530983,-.0542858,.221656,.0317036,.0615356,-.0618384,.236036,.0388319,.0703363,-.0697631,.248398,.046974,.0810391,-.0784757,.263611,.0565246,.0920144,-.0873488,.275857,.0671724,.105584,-.0973652,.292555,.0798105,.119506,-.107271,.306333,.0935945,.134434,-.117608,.318888,.109106,.153399,-.128938,.337552,.127074,.171258,-.139944,.349955,.14643,.191059,-.151288,.361545,.168,.215069,-.163018,.378421,.192082,.237838,-.174226,.38879,.217838,.266965,-.186063,.405857,.246931,.292827,-.196909,.414146,.277505,.324352,-.207473,.426955,.310711,.354427,-.217713,.433429,.346794,.389854,-.227183,.443966,.385237,.420749,-.235131,.44471,.424955,.459597,-.242786,.451729,.468446,.495316,-.248767,.45072,.513422,.534903,-.253351,.450924,.560618,.572369,-.256277,.445266,.609677,.612383,-.2576,.438798,.660995,.644037,-.256931,.421693,.713807,.686749,-.254036,.4109,.767616,.719814,-.249785,.390151,.82533,.754719,-.244283,.367847,.888311,.792022,-.235076,.345013,.948177,.822404,-.225061,.316193,1.01661,.853084,-.211113,.287013,1.08075,.879871,-.19449,.255424,1.14501,.901655,-.174023,.222879,1.20203,.919957,-.1509,.18989,1.25698,.938412,-.124923,.15606,1.30588,.953471,-.0968139,.120512,1.3529,.970451,-.066734,.0828515,1.3986,.985522,-.034734,.0424458,1.44148,1.00099,-.00102222,678929e-9,1.48398,965494e-9,-627338e-12,.0306409,197672e-13,99168e-8,-158573e-10,.0314638,499803e-12,991068e-9,-634012e-10,.031363,200682e-11,974567e-9,-14144e-8,.03036,457312e-11,998079e-9,-252812e-9,.031496,860131e-11,.00102243,-396506e-9,.0319955,148288e-10,.00107877,-577593e-9,.0331376,249141e-10,.00121622,-816816e-9,.0359396,423011e-10,.0014455,-.00113761,.0399652,724613e-10,.00178791,-.00156959,.0450556,123929e-9,.00225668,-.00214064,.0508025,208531e-9,.00285627,-.00287655,.0568443,341969e-9,.0035991,-.00380271,.0630892,544158e-9,.00455524,-.00496264,.0702204,842423e-9,.00569143,-.0063793,.0773426,.00126704,.00716928,-.00813531,.0860839,.00186642,.00885307,-.0101946,.0944079,.00267014,.0109316,-.0126386,.103951,.00374033,.0133704,-.0154876,.113786,.0051304,.0161525,-.0187317,.123477,.00688858,.0194267,-.0224652,.133986,.00910557,.0230967,-.0265976,.143979,.0118074,.0273627,-.0312848,.154645,.0151266,.0323898,-.0365949,.166765,.0191791,.0379225,-.0422914,.177932,.0239236,.0447501,-.0487469,.19167,.0296568,.0519391,-.0556398,.203224,.0362924,.0599464,-.0631646,.215652,.0440585,.0702427,-.0714308,.232089,.0531619,.0806902,-.0800605,.245258,.0634564,.0923194,-.0892815,.258609,.0752481,.106938,-.09931,.276654,.0888914,.121238,-.109575,.289847,.104055,.138817,-.120461,.307566,.121266,.15595,-.131209,.320117,.139944,.178418,-.143049,.339677,.161591,.197875,-.154074,.349886,.184303,.224368,-.166307,.369352,.210669,.252213,-.178051,.386242,.238895,.277321,-.189335,.395294,.269182,.310332,-.200683,.412148,.302508,.338809,-.210856,.418266,.337264,.372678,-.220655,.428723,.374881,.405632,-.230053,.433887,.415656,.442293,-.237993,.439911,.457982,.477256,-.244897,.440175,.502831,.515592,-.250657,.441079,.550277,.550969,-.255459,.435219,.601102,.592883,-.257696,.432882,.651785,.629092,-.259894,.421054,.708961,.672033,-.258592,.41177,.763806,.709147,-.256525,.395267,.824249,.745367,-.254677,.375013,.8951,.784715,-.247892,.353906,.959317,.818107,-.240162,.327801,1.03153,.847895,-.229741,.298821,1.10601,.879603,-.213084,.269115,1.164,.902605,-.195242,.236606,1.22854,.922788,-.174505,.203442,1.29017,.944831,-.150169,.169594,1.34157,.959656,-.124099,.135909,1.3956,.972399,-.0960626,.0990563,1.45128,.986549,-.0657097,.0602348,1.50312,1.00013,-.0333558,.0186694,1.55364,619747e-11,-1e-7,.00778326,796756e-16,237499e-13,-999999e-13,282592e-10,114596e-15,100292e-11,-166369e-11,250354e-9,677492e-14,350752e-11,-637769e-11,357289e-9,631655e-13,826445e-11,-174689e-10,516179e-9,31851e-11,242481e-10,-450868e-10,.0010223,130577e-11,455631e-10,-89044e-9,.00144302,374587e-11,971222e-10,-178311e-9,.00241912,102584e-10,171403e-9,-313976e-9,.00354938,236481e-10,292747e-9,-520026e-9,.00513765,496014e-10,789827e-9,-.00118187,.0238621,139056e-9,.00114093,-.00171827,.0286691,244093e-9,.00176119,-.00249667,.0368565,420623e-9,.0022233,-.00333742,.0400469,65673e-8,.00343382,-.00481976,.0535751,.00109323,.00427602,-.00600755,.057099,.00155268,.00461435,-.00737637,.0551084,.00215031,.00695698,-.00971401,.0715767,.00316529,.00867619,-.0120943,.0793314,.00436995,.0106694,-.0148202,.0869391,.0058959,.0140351,-.0183501,.101572,.00798757,.0168939,-.022006,.11018,.0104233,.020197,-.0261568,.119041,.0134167,.0254702,-.0312778,.135404,.0173009,.0298384,-.0362469,.1437,.0215428,.035159,-.042237,.15512,.0268882,.0427685,-.0488711,.17128,.033235,.0494848,-.0557997,.181813,.0404443,.0592394,-.0635578,.198745,.0490043,.0681463,-.071838,.210497,.0588239,.0804753,-.0809297,.228864,.0702835,.0942205,-.0906488,.247008,.0834012,.106777,-.100216,.258812,.0975952,.124471,-.110827,.278617,.114162,.138389,-.121193,.287049,.131983,.159543,-.13253,.307151,.152541,.176432,-.143611,.31564,.174673,.201723,-.15548,.33538,.199842,.229721,-.167166,.355256,.227097,.250206,-.178238,.360047,.256014,.282118,-.189905,.378761,.28855,.312821,-.201033,.39181,.323348,.341482,-.211584,.397716,.360564,.377368,-.221314,.410141,.400004,.418229,-.230474,.423485,.442371,.444881,-.239443,.418874,.488796,.488899,-.245987,.427545,.535012,.520317,-.253948,.422147,.589678,.568566,-.256616,.42719,.637683,.599607,-.26376,.415114,.703363,.64222,-.268687,.408715,.771363,.685698,-.2694,.399722,.83574,.732327,-.266642,.388651,.897764,.769873,-.267712,.369198,.983312,.806733,-.263479,.346802,1.06222,.843466,-.254575,.321368,1.13477,.873008,-.242749,.29211,1.20712,.908438,-.22725,.262143,1.27465,.936321,-.207621,.228876,1.33203,.950353,-.187932,.19484,1.40439,.96442,-.165154,.163178,1.4732,.979856,-.139302,.127531,1.53574,.982561,-.11134,.0903457,1.59982,.996389,-.0808124,.0489007,1.6577],t=[1,0,0,0,1,791421e-36,0,0,1,104392e-29,0,0,1,349405e-26,0,0,1,109923e-23,0,0,1,947414e-22,0,0,1,359627e-20,0,0,1,772053e-19,0,0,1,108799e-17,0,0,1,110655e-16,0,0,1,865818e-16,0,0,.999998,545037e-15,0,0,.999994,285095e-14,0,0,.999989,126931e-13,0,0,.999973,489938e-13,0,0,.999947,166347e-12,0,0,.999894,502694e-12,0,0,.999798,136532e-11,0,0,.999617,335898e-11,0,0,.999234,752126e-11,0,0,.998258,152586e-10,0,0,.99504,266207e-10,0,0,.980816,236802e-10,0,0,.967553,207684e-11,0,0,.966877,403733e-11,0,0,.965752,741174e-11,0,0,.96382,127746e-10,0,0,.960306,202792e-10,0,0,.953619,280232e-10,0,0,.941103,278816e-10,0,0,.926619,160221e-10,0,0,.920983,235164e-10,0,0,.912293,311924e-10,0,.0158731,.899277,348118e-10,0,.0476191,.880884,26041e-9,0,.0793651,.870399,338726e-10,0,.111111,.856138,392906e-10,0,.142857,.837436,372874e-10,0,.174603,.820973,392558e-10,0,.206349,.803583,434658e-10,0,.238095,.782168,40256e-9,0,.269841,.764107,448159e-10,0,.301587,.743092,457627e-10,0,.333333,.721626,455314e-10,0,.365079,.700375,477335e-10,0,.396825,.677334,461072e-10,0,.428571,.655702,484393e-10,0,.460317,.632059,464583e-10,0,.492064,.610125,483923e-10,0,.52381,.58653,464342e-10,0,.555556,.564508,477033e-10,0,.587302,.541405,459263e-10,0,.619048,.519556,46412e-9,0,.650794,.497292,448913e-10,0,.68254,.475898,445789e-10,0,.714286,.454722,433496e-10,0,.746032,.434042,423054e-10,0,.777778,.414126,413737e-10,0,.809524,.394387,397265e-10,0,.84127,.375841,390709e-10,0,.873016,.357219,369938e-10,0,.904762,.340084,365618e-10,0,.936508,.322714,342533e-10,0,.968254,.306974,339596e-10,0,1,1,101524e-23,0,0,1,10292e-22,0,0,1,130908e-23,0,0,1,473331e-23,0,0,1,625319e-22,0,0,1,107932e-20,0,0,1,163779e-19,0,0,1,203198e-18,0,0,1,204717e-17,0,0,.999999,168995e-16,0,0,.999998,115855e-15,0,0,.999996,66947e-14,0,0,.999991,330863e-14,0,0,.999983,141737e-13,0,0,.999968,532626e-13,0,0,.99994,177431e-12,0,0,.999891,528835e-12,0,0,.999797,142169e-11,0,0,.999617,347057e-11,0,0,.999227,77231e-10,0,0,.998239,155753e-10,0,0,.994937,268495e-10,0,0,.980225,213742e-10,0,0,.967549,21631e-10,0,0,.966865,417989e-11,0,0,.965739,763341e-11,0,0,.963794,130892e-10,0,0,.960244,206456e-10,0,0,.953495,282016e-10,0,148105e-9,.940876,271581e-10,0,.002454,.926569,164159e-10,0,.00867491,.920905,239521e-10,0,.01956,.912169,315127e-10,0,.035433,.899095,346626e-10,0,.056294,.882209,290223e-10,0,.0818191,.870272,342992e-10,0,.111259,.855977,394164e-10,0,.142857,.837431,372343e-10,0,.174603,.820826,396691e-10,0,.206349,.803408,435395e-10,0,.238095,.782838,419579e-10,0,.269841,.763941,450953e-10,0,.301587,.742904,455847e-10,0,.333333,.721463,458833e-10,0,.365079,.700197,477159e-10,0,.396825,.677501,470641e-10,0,.428571,.655527,484732e-10,0,.460317,.6324,476834e-10,0,.492064,.609964,484213e-10,0,.52381,.586839,475541e-10,0,.555556,.564353,476951e-10,0,.587302,.541589,467611e-10,0,.619048,.519413,463493e-10,0,.650794,.497337,453994e-10,0,.68254,.475797,445308e-10,0,.714286,.454659,435787e-10,0,.746032,.434065,424839e-10,0,.777778,.414018,41436e-9,0,.809524,.39455,401902e-10,0,.84127,.375742,390813e-10,0,.873016,.357501,377116e-10,0,.904762,.339996,36535e-9,0,.936508,.323069,351265e-10,0,.968254,.306897,339112e-10,0,1,1,10396e-19,0,0,1,104326e-20,0,0,1,110153e-20,0,0,1,144668e-20,0,0,1,34528e-19,0,0,1,175958e-19,0,0,1,12627e-17,0,0,1,936074e-18,0,0,1,645742e-17,0,0,.999998,401228e-16,0,0,.999997,222338e-15,0,0,.999995,10967e-13,0,0,.999991,482132e-14,0,0,.999981,189434e-13,0,0,.999967,667716e-13,0,0,.999938,212066e-12,0,0,.999886,60977e-11,0,0,.999792,159504e-11,0,0,.999608,381191e-11,0,0,.999209,833727e-11,0,0,.998179,165288e-10,0,0,.994605,274387e-10,0,0,.979468,167316e-10,0,0,.967529,242877e-11,0,0,.966836,461696e-11,0,0,.96569,830977e-11,0,0,.963706,140427e-10,0,244659e-11,.960063,217353e-10,0,760774e-9,.953113,286606e-10,0,.00367261,.940192,247691e-10,0,.00940263,.927731,195814e-10,0,.018333,.920669,252531e-10,0,.0306825,.911799,324277e-10,0,.0465556,.89857,340982e-10,0,.0659521,.883283,319622e-10,0,.0887677,.86989,35548e-9,0,.114784,.855483,397143e-10,0,.143618,.837987,391665e-10,0,.174606,.820546,411306e-10,0,.206349,.802878,436753e-10,0,.238095,.783402,444e-7,0,.269841,.763439,458726e-10,0,.301587,.742925,467097e-10,0,.333333,.721633,478887e-10,0,.365079,.69985,481251e-10,0,.396825,.67783,491811e-10,0,.428571,.655126,488199e-10,0,.460318,.632697,496025e-10,0,.492064,.609613,48829e-9,0,.52381,.587098,492754e-10,0,.555556,.564119,482625e-10,0,.587302,.541813,482807e-10,0,.619048,.519342,471552e-10,0,.650794,.497514,466765e-10,0,.68254,.475879,455582e-10,0,.714286,.454789,446007e-10,0,.746032,.434217,435382e-10,0,.777778,.414086,421753e-10,0,.809524,.394744,412093e-10,0,.84127,.375782,396634e-10,0,.873016,.357707,386419e-10,0,.904762,.340038,370345e-10,0,.936508,.323284,359725e-10,0,.968254,.306954,3436e-8,0,1,1,599567e-19,0,0,1,600497e-19,0,0,1,614839e-19,0,0,1,686641e-19,0,0,1,972658e-19,0,0,1,221271e-18,0,0,1,833195e-18,0,0,1,403601e-17,0,0,.999999,206001e-16,0,0,.999998,101739e-15,0,0,.999997,470132e-15,0,0,.999993,200436e-14,0,0,.999988,783682e-14,0,0,.999979,280338e-13,0,0,.999962,917033e-13,0,0,.999933,274514e-12,0,0,.999881,753201e-12,0,0,.999783,189826e-11,0,0,.999594,440279e-11,0,0,.999178,93898e-10,0,0,.998073,181265e-10,0,0,.993993,280487e-10,0,0,.979982,149422e-10,0,0,.968145,378481e-11,0,0,.966786,53771e-10,0,0,.965611,947508e-11,0,388934e-10,.963557,156616e-10,0,9693e-7,.959752,235144e-10,0,.00370329,.952461,291568e-10,0,.00868428,.940193,240102e-10,0,.0161889,.929042,231235e-10,0,.0263948,.920266,273968e-10,0,.0394088,.911178,337915e-10,0,.0552818,.897873,333629e-10,0,.0740138,.884053,351405e-10,0,.0955539,.869455,378034e-10,0,.119795,.854655,399378e-10,0,.14656,.838347,419108e-10,0,.175573,.820693,440831e-10,0,.206388,.802277,445599e-10,0,.238095,.783634,472691e-10,0,.269841,.763159,476984e-10,0,.301587,.742914,491487e-10,0,.333333,.721662,502312e-10,0,.365079,.699668,502817e-10,0,.396825,.677839,51406e-9,0,.428571,.655091,511095e-10,0,.460317,.632665,516067e-10,0,.492064,.609734,512255e-10,0,.52381,.587043,510263e-10,0,.555556,.564298,50565e-9,0,.587302,.541769,497951e-10,0,.619048,.519529,492698e-10,0,.650794,.497574,482066e-10,0,.68254,.476028,473689e-10,0,.714286,.454961,461941e-10,0,.746032,.434341,450618e-10,0,.777778,.414364,438355e-10,0,.809524,.394832,424196e-10,0,.84127,.376109,412563e-10,0,.873016,.35779,396226e-10,0,.904762,.340379,384886e-10,0,.936508,.323385,368214e-10,0,.968254,.307295,356636e-10,0,1,1,106465e-17,0,0,1,106555e-17,0,0,1,107966e-17,0,0,1,114601e-17,0,0,1,137123e-17,0,0,1,21243e-16,0,0,.999999,489653e-17,0,0,.999999,160283e-16,0,0,.999998,62269e-15,0,0,.999997,251859e-15,0,0,.999996,996192e-15,0,0,.999992,374531e-14,0,0,.999986,132022e-13,0,0,.999975,433315e-13,0,0,.999959,131956e-12,0,0,.999927,372249e-12,0,0,.999871,972461e-12,0,0,.999771,235343e-11,0,0,.999572,52768e-10,0,0,.999133,109237e-10,0,0,.997912,203675e-10,0,0,.993008,279396e-10,0,0,.980645,139604e-10,0,0,.970057,646596e-11,0,0,.966717,65089e-10,0,474145e-10,.965497,111863e-10,0,89544e-8,.96334,179857e-10,0,.0032647,.959294,259045e-10,0,.0075144,.951519,292327e-10,0,.0138734,.940517,249769e-10,0,.0224952,.93014,26803e-9,0,.0334828,.91972,303656e-10,0,.0468973,.910294,353323e-10,0,.0627703,.897701,351002e-10,0,.0811019,.884522,388104e-10,0,.10186,.869489,412932e-10,0,.124985,.853983,415781e-10,0,.150372,.838425,454066e-10,0,.177868,.820656,471624e-10,0,.207245,.801875,475243e-10,0,.238143,.783521,505621e-10,0,.269841,.763131,50721e-9,0,.301587,.74261,523293e-10,0,.333333,.72148,528699e-10,0,.365079,.699696,538677e-10,0,.396825,.677592,539255e-10,0,.428571,.65525,546367e-10,0,.460317,.632452,541348e-10,0,.492064,.609903,544976e-10,0,.52381,.586928,536201e-10,0,.555556,.564464,535185e-10,0,.587302,.541801,524949e-10,0,.619048,.519681,51812e-9,0,.650794,.497685,507687e-10,0,.68254,.47622,496243e-10,0,.714286,.455135,485714e-10,0,.746032,.4346,471847e-10,0,.777778,.414564,459294e-10,0,.809524,.395165,444705e-10,0,.84127,.376333,430772e-10,0,.873016,.358197,416229e-10,0,.904762,.34064,401019e-10,0,.936508,.323816,386623e-10,0,.968254,.307581,370933e-10,0,1,1,991541e-17,0,0,1,992077e-17,0,0,1,100041e-16,0,0,1,10385e-15,0,0,1,115777e-16,0,0,1,150215e-16,0,0,.999999,254738e-16,0,0,.999999,598822e-16,0,0,.999998,179597e-15,0,0,.999997,602367e-15,0,0,.999994,206835e-14,0,0,.99999,694952e-14,0,0,.999984,223363e-13,0,0,.999972,678578e-13,0,0,.999952,193571e-12,0,0,.999919,516594e-12,0,0,.99986,128739e-11,0,0,.999753,299298e-11,0,0,.999546,648258e-11,0,0,.999074,129985e-10,0,0,.997671,232176e-10,0,0,.991504,256701e-10,0,0,.981148,131141e-10,0,0,.971965,869048e-11,0,280182e-10,.966624,808301e-11,0,695475e-9,.965344,135235e-10,0,.00265522,.963048,210592e-10,0,.00622975,.958673,287473e-10,0,.0116234,.950262,281379e-10,0,.018976,.940836,271089e-10,0,.0283844,.930996,30926e-9,0,.0399151,.919848,348359e-10,0,.0536063,.909136,366092e-10,0,.0694793,.897554,384162e-10,0,.0875342,.884691,430971e-10,0,.107749,.869414,447803e-10,0,.130087,.853462,452858e-10,0,.154481,.838187,495769e-10,0,.180833,.820381,502709e-10,0,.209005,.801844,522713e-10,0,.238791,.783061,541505e-10,0,.269869,.763205,553712e-10,0,.301587,.742362,564909e-10,0,.333333,.721393,572646e-10,0,.365079,.699676,581012e-10,0,.396825,.677395,58096e-9,0,.428571,.655208,585766e-10,0,.460317,.632451,583602e-10,0,.492064,.609839,580234e-10,0,.52381,.587093,577161e-10,0,.555556,.564467,568447e-10,0,.587302,.542043,563166e-10,0,.619048,.519826,55156e-9,0,.650794,.497952,541682e-10,0,.68254,.476477,528971e-10,0,.714286,.455412,514952e-10,0,.746032,.434926,502222e-10,0,.777778,.4149,485779e-10,0,.809524,.395552,472242e-10,0,.84127,.376712,454891e-10,0,.873016,.358622,440924e-10,0,.904762,.341048,422984e-10,0,.936508,.324262,408582e-10,0,.968254,.308013,390839e-10,0,1,1,613913e-16,0,0,1,614145e-16,0,0,1,617708e-16,0,0,1,633717e-16,0,0,1,681648e-16,0,0,1,808291e-16,0,0,1,114608e-15,0,0,.999998,210507e-15,0,0,.999997,499595e-15,0,0,.999995,139897e-14,0,0,.999994,419818e-14,0,0,.999988,127042e-13,0,0,.999979,375153e-13,0,0,.999965,106206e-12,0,0,.999945,285381e-12,0,0,.999908,723611e-12,0,0,.999846,17255e-10,0,0,.999733,386104e-11,0,0,.999511,808493e-11,0,0,.998993,156884e-10,0,0,.997326,265538e-10,0,0,.989706,206466e-10,0,0,.981713,130756e-10,0,70005e-10,.973636,106473e-10,0,464797e-9,.966509,10194e-9,0,.00201743,.965149,165881e-10,0,.00497549,.962669,249147e-10,0,.00953262,.95786,317449e-10,0,.0158211,.949334,281045e-10,0,.0239343,.941041,303263e-10,0,.0339372,.931575,356754e-10,0,.0458738,.920102,397075e-10,0,.059772,.908002,384886e-10,0,.075645,.897269,43027e-9,0,.0934929,.884559,479925e-10,0,.113302,.869161,48246e-9,0,.135045,.853342,509505e-10,0,.158678,.837633,542846e-10,0,.184136,.820252,554139e-10,0,.211325,.801872,581412e-10,0,.240113,.782418,585535e-10,0,.270306,.7631,610923e-10,0,.301594,.742183,613678e-10,0,.333333,.721098,627275e-10,0,.365079,.699512,629413e-10,0,.396825,.677372,636351e-10,0,.428571,.655059,633555e-10,0,.460317,.632567,636513e-10,0,.492064,.609784,628965e-10,0,.52381,.587237,625546e-10,0,.555556,.564525,615825e-10,0,.587302,.542181,605048e-10,0,.619048,.520017,596329e-10,0,.650794,.498204,581516e-10,0,.68254,.476742,569186e-10,0,.714286,.455803,553833e-10,0,.746032,.435251,537807e-10,0,.777778,.415374,522025e-10,0,.809524,.395921,503421e-10,0,.84127,.377253,488211e-10,0,.873016,.359021,468234e-10,0,.904762,.341637,453269e-10,0,.936508,.3247,433014e-10,0,.968254,.308625,418007e-10,0,1,1,286798e-15,0,0,1,286877e-15,0,0,1,288094e-15,0,0,1,293506e-15,0,0,1,309262e-15,0,0,.999999,348593e-15,0,0,.999999,444582e-15,0,0,.999998,688591e-15,0,0,.999996,134391e-14,0,0,.999993,317438e-14,0,0,.999989,835609e-14,0,0,.999983,228677e-13,0,0,.999974,623361e-13,0,0,.999959,165225e-12,0,0,.999936,419983e-12,0,0,.999896,101546e-11,0,0,.99983,232376e-11,0,0,.999709,50156e-10,0,0,.999469,10167e-9,0,0,.998886,190775e-10,0,0,.996819,300511e-10,0,0,.988837,185092e-10,0,168222e-12,.982178,134622e-10,0,259622e-9,.975017,125961e-10,0,.00142595,.967101,13507e-9,0,.00382273,.964905,205003e-10,0,.00764164,.96218,29546e-9,0,.0130121,.956821,343738e-10,0,.0200253,.948829,305063e-10,0,.0287452,.941092,346487e-10,0,.039218,.931883,412061e-10,0,.0514748,.920211,444651e-10,0,.0655351,.907307,431252e-10,0,.0814082,.89684,490382e-10,0,.0990939,.884119,53334e-9,0,.118583,.869148,54114e-9,0,.139856,.853377,578536e-10,0,.162882,.836753,592285e-10,0,.187615,.820063,622787e-10,0,.213991,.801694,645492e-10,0,.241918,.782116,65353e-9,0,.271267,.762673,674344e-10,0,.301847,.742133,682788e-10,0,.333333,.720779,691959e-10,0,.365079,.699386,696817e-10,0,.396826,.67732,699583e-10,0,.428572,.654888,698447e-10,0,.460318,.632499,694063e-10,0,.492064,.609825,691612e-10,0,.52381,.587287,681576e-10,0,.555556,.564743,674138e-10,0,.587302,.542409,661617e-10,0,.619048,.520282,647785e-10,0,.650794,.498506,633836e-10,0,.68254,.477102,615905e-10,0,.714286,.456167,601013e-10,0,.746032,.435728,581457e-10,0,.777778,.415809,564215e-10,0,.809524,.396517,544997e-10,0,.84127,.377737,525061e-10,0,.873016,.359698,506831e-10,0,.904762,.342164,48568e-9,0,.936508,.325417,467826e-10,0,.968254,.309186,446736e-10,0,1,1,109018e-14,0,0,1,10904e-13,0,0,1,109393e-14,0,0,1,11095e-13,0,0,1,1154e-12,0,0,1,126089e-14,0,0,.999999,15059e-13,0,0,.999997,207899e-14,0,0,.999994,348164e-14,0,0,.999993,705728e-14,0,0,.999987,163692e-13,0,0,.999981,406033e-13,0,0,.999969,10245e-11,0,0,.999953,255023e-12,0,0,.999925,61511e-11,0,0,.999881,142218e-11,0,0,.99981,313086e-11,0,0,.99968,653119e-11,0,0,.999418,12832e-9,0,0,.998748,232497e-10,0,0,.996066,329522e-10,0,0,.988379,179613e-10,0,108799e-9,.982567,143715e-10,0,921302e-9,.976097,148096e-10,0,.00280738,.968475,178905e-10,0,.00596622,.964606,253921e-10,0,.0105284,.961564,348623e-10,0,.0165848,.955517,357612e-10,0,.0242,.948381,343493e-10,0,.03342,.941095,405849e-10,0,.0442777,.931923,475394e-10,0,.0567958,.91996,484328e-10,0,.0709879,.907419,502146e-10,0,.086861,.89618,561654e-10,0,.104415,.88337,587612e-10,0,.123643,.869046,618057e-10,0,.144531,.853278,657392e-10,0,.167057,.836091,66303e-9,0,.191188,.819644,704445e-10,0,.216878,.801246,714071e-10,0,.244062,.782031,740093e-10,0,.272649,.762066,74685e-9,0,.302509,.741964,766647e-10,0,.333442,.720554,766328e-10,0,.365079,.699098,777857e-10,0,.396826,.677189,774633e-10,0,.428572,.65484,776235e-10,0,.460318,.632496,770316e-10,0,.492064,.609908,762669e-10,0,.52381,.587312,753972e-10,0,.555556,.564938,739994e-10,0,.587302,.542577,728382e-10,0,.619048,.52062,71112e-9,0,.650794,.498819,694004e-10,0,.68254,.477555,675575e-10,0,.714286,.456568,653449e-10,0,.746032,.436278,636068e-10,0,.777778,.41637,613466e-10,0,.809524,.397144,594177e-10,0,.84127,.378412,570987e-10,0,.873016,.360376,550419e-10,0,.904762,.342906,527422e-10,0,.936508,.326136,506544e-10,0,.968254,.30997,484307e-10,0,1,1,354014e-14,0,0,1,354073e-14,0,0,1,354972e-14,0,0,1,358929e-14,0,0,1,370093e-14,0,0,.999999,396194e-14,0,0,.999998,453352e-14,0,0,.999997,578828e-14,0,0,.999994,863812e-14,0,0,.999991,153622e-13,0,0,.999985,316356e-13,0,0,.999977,712781e-13,0,0,.999964,166725e-12,0,0,.999945,390501e-12,0,0,.999912,895622e-12,0,0,.999866,198428e-11,0,0,.999786,421038e-11,0,0,.999647,850239e-11,0,0,.999356,162059e-10,0,0,.998563,282652e-10,0,0,.994928,336309e-10,0,244244e-10,.987999,178458e-10,0,523891e-9,.982893,159162e-10,0,.00194729,.977044,178056e-10,0,.00451099,.969972,230624e-10,0,.00835132,.964237,313922e-10,0,.013561,.960791,406145e-10,0,.0202056,.954292,372796e-10,0,.0283321,.948052,403199e-10,0,.0379739,.940938,479537e-10,0,.0491551,.931689,545292e-10,0,.0618918,.91987,54038e-9,0,.0761941,.907665,589909e-10,0,.0920672,.895281,642651e-10,0,.109511,.882621,659707e-10,0,.12852,.86873,709973e-10,0,.149085,.853008,742221e-10,0,.171189,.835944,761754e-10,0,.194809,.818949,797052e-10,0,.21991,.800951,812434e-10,0,.246447,.781847,838075e-10,0,.274352,.761649,84501e-9,0,.303535,.74152,860258e-10,0,.333857,.720495,866233e-10,0,.365104,.698742,868326e-10,0,.396826,.677096,87133e-9,0,.428572,.654782,863497e-10,0,.460318,.632335,860206e-10,0,.492064,.610031,849337e-10,0,.52381,.587457,838279e-10,0,.555556,.56513,82309e-9,0,.587302,.542877,803542e-10,0,.619048,.5209,786928e-10,0,.650794,.499291,765171e-10,0,.68254,.477971,744753e-10,0,.714286,.457221,72209e-9,0,.746032,.436803,697448e-10,0,.777778,.417083,675333e-10,0,.809524,.397749,648058e-10,0,.84127,.379177,625759e-10,0,.873016,.361061,598584e-10,0,.904762,.343713,575797e-10,0,.936508,.326894,549999e-10,0,.968254,.310816,527482e-10,0,1,1,10153e-12,0,0,1,101544e-13,0,0,1,101751e-13,0,0,1,102662e-13,0,0,1,10521e-12,0,0,.999999,111049e-13,0,0,.999999,123408e-13,0,0,.999996,14924e-12,0,0,.999992,204471e-13,0,0,.999989,326539e-13,0,0,.99998,603559e-13,0,0,.999971,123936e-12,0,0,.999955,269058e-12,0,0,.999933,593604e-12,0,0,.999901,129633e-11,0,0,.999847,275621e-11,0,0,.999761,564494e-11,0,0,.999607,110485e-10,0,0,.999282,204388e-10,0,0,.99831,341084e-10,0,22038e-11,.993288,294949e-10,0,242388e-9,.987855,192736e-10,0,.0012503,.983167,182383e-10,0,.0032745,.977908,218633e-10,0,.00646321,.971194,290662e-10,0,.0109133,.963867,386401e-10,0,.0166927,.95982,462827e-10,0,.0238494,.953497,420705e-10,0,.0324178,.947621,477743e-10,0,.0424225,.940611,568258e-10,0,.0538808,.931174,618061e-10,0,.0668047,.919919,627098e-10,0,.0812014,.907856,694714e-10,0,.0970745,.894509,735008e-10,0,.114424,.881954,763369e-10,0,.133246,.868309,821896e-10,0,.153534,.852511,83769e-9,0,.175275,.835821,881615e-10,0,.198453,.817981,896368e-10,0,.223042,.800504,930906e-10,0,.249009,.78141,945056e-10,0,.276304,.761427,963605e-10,0,.304862,.74094,968088e-10,0,.334584,.720233,981481e-10,0,.365322,.698592,979122e-10,0,.396826,.676763,981057e-10,0,.428571,.654808,973956e-10,0,.460318,.632326,962619e-10,0,.492064,.610049,952996e-10,0,.52381,.58763,933334e-10,0,.555556,.565261,917573e-10,0,.587302,.543244,896636e-10,0,.619048,.521273,873304e-10,0,.650794,.499818,852648e-10,0,.68254,.478536,823961e-10,0,.714286,.457826,79939e-9,0,.746032,.437549,77126e-9,0,.777778,.41776,743043e-10,0,.809524,.39863,716426e-10,0,.84127,.379954,686456e-10,0,.873016,.362025,660514e-10,0,.904762,.344581,630755e-10,0,.936508,.327909,605439e-10,0,.968254,.311736,576345e-10,0,1,1,263344e-13,0,0,1,263373e-13,0,0,1,263815e-13,0,0,1,265753e-13,0,0,1,271132e-13,0,0,.999999,283279e-13,0,0,.999997,30833e-12,0,0,.999995,358711e-13,0,0,.999992,461266e-13,0,0,.999985,67574e-12,0,0,.999977,11358e-11,0,0,.999966,213657e-12,0,0,.999948,431151e-12,0,0,.999923,896656e-12,0,0,.999884,186603e-11,0,0,.999826,381115e-11,0,0,.999732,754184e-11,0,0,.999561,143192e-10,0,0,.999191,257061e-10,0,0,.997955,405724e-10,0,744132e-10,.992228,276537e-10,0,716477e-9,.987638,208885e-10,0,.0022524,.983395,215226e-10,0,.00484816,.978614,270795e-10,0,.00860962,.972389,365282e-10,0,.0136083,.964392,474747e-10,0,.0198941,.95861,509141e-10,0,.0275023,.952806,48963e-9,0,.0364584,.94712,571119e-10,0,.04678,.940104,671704e-10,0,.0584799,.930398,687586e-10,0,.0715665,.919866,738161e-10,0,.086045,.907853,813235e-10,0,.101918,.894078,834582e-10,0,.119186,.881177,892093e-10,0,.137845,.867575,944548e-10,0,.157891,.852107,969607e-10,0,.179316,.835502,101456e-9,0,.202106,.81756,103256e-9,0,.226243,.79984,106954e-9,0,.251704,.780998,108066e-9,0,.278451,.761132,110111e-9,0,.306436,.740429,110459e-9,0,.335586,.719836,111219e-9,0,.365796,.698467,11145e-8,0,.3969,.676446,110393e-9,0,.428571,.654635,110035e-9,0,.460318,.632411,108548e-9,0,.492064,.609986,106963e-9,0,.52381,.587872,105238e-9,0,.555556,.565528,102665e-9,0,.587302,.543563,100543e-9,0,.619048,.52176,976182e-10,0,.650794,.500188,947099e-10,0,.68254,.479204,919929e-10,0,.714286,.458413,886139e-10,0,.746032,.438314,857839e-10,0,.777778,.418573,82411e-9,0,.809524,.39947,792211e-10,0,.84127,.380892,759546e-10,0,.873016,.362953,727571e-10,0,.904762,.345601,695738e-10,0,.936508,.328895,664907e-10,0,.968254,.312808,634277e-10,0,1,1,628647e-13,0,0,1,628705e-13,0,0,1,629587e-13,0,0,1,633441e-13,0,0,.999999,644087e-13,0,0,.999998,667856e-13,0,0,.999997,715889e-13,0,0,.999995,809577e-13,0,0,.999989,992764e-13,0,0,.999983,135834e-12,0,0,.999974,210482e-12,0,0,.999959,365215e-12,0,0,.999939,686693e-12,0,0,.999911,13472e-10,0,0,.999868,26731e-10,0,0,.999804,524756e-11,0,0,.9997,100403e-10,0,0,.99951,185019e-10,0,0,.999078,322036e-10,0,620676e-11,.997428,470002e-10,0,341552e-9,.99162,287123e-10,0,.00143727,.987479,234706e-10,0,.00349201,.983582,260083e-10,0,.0066242,.979186,337927e-10,0,.0109113,.97325,454689e-10,0,.0164064,.965221,573759e-10,0,.0231463,.957262,544114e-10,0,.0311571,.952211,587006e-10,0,.0404572,.946631,692256e-10,0,.0510592,.939391,787819e-10,0,.0629723,.929795,792368e-10,0,.0762025,.91965,875075e-10,0,.090753,.907737,950903e-10,0,.106626,.893899,972963e-10,0,.123822,.880239,10459e-8,0,.142337,.866562,107689e-9,0,.16217,.85164,113081e-9,0,.183314,.835021,116636e-9,0,.20576,.817311,120074e-9,0,.229496,.798845,121921e-9,0,.254502,.780479,12475e-8,0,.280753,.760694,125255e-9,0,.308212,.740142,126719e-9,0,.336825,.719248,12636e-8,0,.366517,.698209,126712e-9,0,.397167,.676398,125769e-9,0,.428578,.654378,124432e-9,0,.460318,.632484,123272e-9,0,.492064,.610113,12085e-8,0,.52381,.587931,118411e-9,0,.555556,.565872,11569e-8,0,.587302,.543814,112521e-9,0,.619048,.522265,109737e-9,0,.650794,.500835,106228e-9,0,.68254,.479818,102591e-9,0,.714286,.459258,991288e-10,0,.746032,.439061,952325e-10,0,.777778,.419552,91895e-9,0,.809524,.400399,879051e-10,0,.84127,.381976,844775e-10,0,.873016,.364009,806316e-10,0,.904762,.346761,771848e-10,0,.936508,.330049,735429e-10,0,.968254,.314018,702103e-10,0,1,1,139968e-12,0,0,1,139979e-12,0,0,1,140145e-12,0,0,1,14087e-11,0,0,.999999,142865e-12,0,0,.999998,147279e-12,0,0,.999997,156057e-12,0,0,.999992,17276e-11,0,0,.999989,204352e-12,0,0,.99998,26494e-11,0,0,.999969,383435e-12,0,0,.999953,618641e-12,0,0,.999929,108755e-11,0,0,.999898,201497e-11,0,0,.999849,381346e-11,0,0,.999778,719815e-11,0,0,.999661,133215e-10,0,0,.999451,238313e-10,0,0,.998936,401343e-10,0,113724e-9,.99662,517346e-10,0,820171e-9,.991094,304323e-10,0,.00238143,.987487,281757e-10,0,.00493527,.983731,320048e-10,0,.00856859,.979647,423905e-10,0,.0133393,.973837,562935e-10,0,.0192863,.96584,677442e-10,0,.0264369,.956309,623073e-10,0,.03481,.951523,704131e-10,0,.0444184,.946003,836594e-10,0,.0552713,.938454,911736e-10,0,.0673749,.929279,938264e-10,0,.0807329,.919239,103754e-9,0,.0953479,.907293,109928e-9,0,.111221,.893936,115257e-9,0,.128352,.879674,122265e-9,0,.14674,.865668,125733e-9,0,.166382,.850998,132305e-9,0,.187276,.834498,134844e-9,0,.209413,.816903,139276e-9,0,.232786,.798235,140984e-9,0,.257382,.779724,14378e-8,0,.283181,.760251,144623e-9,0,.310156,.739808,145228e-9,0,.338269,.718762,14539e-8,0,.367461,.697815,144432e-9,0,.397646,.67631,143893e-9,0,.428685,.654278,141846e-9,0,.460318,.632347,13935e-8,0,.492064,.610296,137138e-9,0,.52381,.588039,133806e-9,0,.555556,.566218,130755e-9,0,.587302,.544346,127128e-9,0,.619048,.522701,123002e-9,0,.650794,.501542,119443e-9,0,.68254,.480508,115055e-9,0,.714286,.460092,111032e-9,0,.746032,.440021,106635e-9,0,.777778,.420446,102162e-9,0,.809524,.401512,98184e-9,0,.84127,.38299,936497e-10,0,.873016,.365232,89813e-9,0,.904762,.347865,853073e-10,0,.936508,.331342,817068e-10,0,.968254,.315202,773818e-10,0,1,1,29368e-11,0,0,1,2937e-10,0,0,1,293998e-12,0,0,1,295298e-12,0,0,.999999,298865e-12,0,0,.999998,3067e-10,0,0,.999995,322082e-12,0,0,.999992,350767e-12,0,0,.999986,403538e-12,0,0,.999976,501372e-12,0,0,.999964,68562e-11,0,0,.999945,10374e-10,0,0,.999919,171269e-11,0,0,.999882,300175e-11,0,0,.999829,542144e-11,0,0,.999749,984182e-11,0,0,.99962,176213e-10,0,0,.999382,305995e-10,0,138418e-10,.998751,496686e-10,0,389844e-9,.995344,510733e-10,0,.00150343,.990768,345829e-10,0,.00352451,.987464,342841e-10,0,.00655379,.983846,399072e-10,0,.0106554,.980007,533219e-10,0,.0158723,.974494,696992e-10,0,.0222333,.96622,776754e-10,0,.029758,.956273,747718e-10,0,.0384596,.950952,864611e-10,0,.0483473,.945215,100464e-9,0,.0594266,.937287,103729e-9,0,.0717019,.928649,111665e-9,0,.0851752,.918791,12353e-8,0,.0998479,.906685,127115e-9,0,.115721,.893706,13628e-8,0,.132794,.879248,142427e-9,0,.151067,.864685,148091e-9,0,.170538,.850032,153517e-9,0,.191204,.833853,157322e-9,0,.213063,.816353,161086e-9,0,.236107,.797834,164111e-9,0,.260329,.778831,165446e-9,0,.285714,.759756,167492e-9,0,.312243,.739419,166928e-9,0,.339887,.718491,167e-6,0,.368604,.697392,165674e-9,0,.398329,.676102,163815e-9,0,.428961,.654243,162003e-9,0,.460331,.632176,158831e-9,0,.492064,.610407,155463e-9,0,.52381,.588394,152062e-9,0,.555556,.56645,147665e-9,0,.587302,.5449,14375e-8,0,.619048,.523276,138905e-9,0,.650794,.502179,134189e-9,0,.68254,.481359,129392e-9,0,.714286,.46092,124556e-9,0,.746032,.441084,11957e-8,0,.777778,.421517,114652e-9,0,.809524,.402721,109688e-9,0,.84127,.384222,104667e-9,0,.873016,.366534,999633e-10,0,.904762,.349205,950177e-10,0,.936508,.332702,907301e-10,0,.968254,.316599,859769e-10,0,1,1,585473e-12,0,0,1,585507e-12,0,0,1,58602e-11,0,0,.999999,588259e-12,0,0,.999999,594381e-12,0,0,.999998,607754e-12,0,0,.999995,633729e-12,0,0,.99999,68137e-11,0,0,.999984,767003e-12,0,0,.999973,921212e-12,0,0,.999959,120218e-11,0,0,.999936,172024e-11,0,0,.999907,268088e-11,0,0,.999866,445512e-11,0,0,.999806,768481e-11,0,0,.999716,1342e-8,0,0,.999576,232473e-10,0,0,.9993,391694e-10,0,129917e-9,.998498,608429e-10,0,845035e-9,.994132,489743e-10,0,.00237616,.99031,384644e-10,0,.00484456,.987409,421768e-10,0,.00832472,.983981,504854e-10,0,.0128643,.980268,671028e-10,0,.0184947,.974875,852749e-10,0,.025237,.966063,85531e-9,0,.0331046,.956779,900588e-10,0,.0421067,.950259,10577e-8,0,.0522487,.944239,119458e-9,0,.0635343,.936341,122164e-9,0,.0759654,.928047,134929e-9,0,.0895434,.918065,145544e-9,0,.104269,.906267,150531e-9,0,.120142,.893419,161652e-9,0,.137163,.878758,16593e-8,0,.15533,.863699,174014e-9,0,.174645,.848876,177877e-9,0,.195106,.833032,184049e-9,0,.21671,.815557,186088e-9,0,.239454,.797323,19054e-8,0,.263332,.778124,191765e-9,0,.288336,.758929,192535e-9,0,.314451,.738979,192688e-9,0,.341658,.718213,191522e-9,0,.369924,.696947,190491e-9,0,.399202,.675807,187913e-9,0,.429416,.654147,184451e-9,0,.460447,.63229,181442e-9,0,.492064,.610499,177139e-9,0,.523809,.588747,172596e-9,0,.555555,.566783,167457e-9,0,.587301,.545359,162518e-9,0,.619048,.523984,156818e-9,0,.650794,.502917,151884e-9,0,.68254,.482294,145514e-9,0,.714286,.461945,140199e-9,0,.746032,.442133,134101e-9,0,.777778,.422705,128374e-9,0,.809524,.403916,122996e-9,0,.84127,.38554,116808e-9,0,.873016,.367909,111973e-9,0,.904762,.350651,105938e-9,0,.936508,.334208,101355e-9,0,.968254,.318123,957629e-10,0,1,1,111633e-11,0,0,1,111639e-11,0,0,1,111725e-11,0,0,1,112096e-11,0,0,.999999,11311e-10,0,0,.999997,115315e-11,0,0,.999995,11956e-10,0,0,.999989,127239e-11,0,0,.999981,140772e-11,0,0,.999969,164541e-11,0,0,.999952,206607e-11,0,0,.999928,281783e-11,0,0,.999895,416835e-11,0,0,.999848,658728e-11,0,0,.999781,108648e-10,0,0,.999682,182579e-10,0,0,.999523,306003e-10,0,159122e-10,.999205,499862e-10,0,391184e-9,.998131,73306e-9,0,.00147534,.993334,513229e-10,0,.0034227,.99016,467783e-10,0,.00632232,.987321,523413e-10,0,.0102295,.984099,64267e-9,0,.0151794,.980432,843042e-10,0,.0211947,.974976,102819e-9,0,.0282899,.966429,996234e-10,0,.0364739,.957633,111074e-9,0,.0457522,.949422,128644e-9,0,.0561278,.943045,140076e-9,0,.0676023,.935448,146349e-9,0,.0801762,.927225,161854e-9,0,.0938499,.917033,169135e-9,0,.108623,.905762,179987e-9,0,.124496,.892879,189832e-9,0,.141469,.878435,195881e-9,0,.159541,.863114,20466e-8,0,.178713,.84776,209473e-9,0,.198985,.832084,214861e-9,0,.220355,.814915,217695e-9,0,.242823,.796711,220313e-9,0,.266385,.777603,22313e-8,0,.291036,.757991,222471e-9,0,.316767,.738371,222869e-9,0,.343563,.717872,221243e-9,0,.371402,.696619,218089e-9,0,.400248,.675379,21562e-8,0,.430047,.65411,21169e-8,0,.460709,.63241,206947e-9,0,.492079,.61046,201709e-9,0,.52381,.58903,196753e-9,0,.555556,.567267,189637e-9,0,.587302,.545886,184735e-9,0,.619048,.524714,177257e-9,0,.650794,.503789,171424e-9,0,.68254,.483204,164688e-9,0,.714286,.462976,157172e-9,0,.746032,.443294,151341e-9,0,.777778,.423988,143737e-9,0,.809524,.405325,138098e-9,0,.84127,.386981,130698e-9,0,.873016,.369436,125276e-9,0,.904762,.35219,118349e-9,0,.936508,.335804,11312e-8,0,.968254,.319749,106687e-9,0,1,1,204685e-11,0,0,1,204694e-11,0,0,1,204831e-11,0,0,.999999,205428e-11,0,0,.999999,207056e-11,0,0,.999997,210581e-11,0,0,.999993,21732e-10,0,0,.999987,229365e-11,0,0,.999979,250243e-11,0,0,.999965,286127e-11,0,0,.999947,348028e-11,0,0,.999918,455588e-11,0,0,.999881,643303e-11,0,0,.999828,970064e-11,0,0,.999753,153233e-10,0,0,.999642,24793e-9,0,0,.999464,402032e-10,0,122947e-9,.999089,635852e-10,0,807414e-9,.997567,857026e-10,0,.00227206,.992903,594912e-10,0,.00462812,.990011,578515e-10,0,.00794162,.987192,65399e-9,0,.0122534,.98418,819675e-10,0,.0175888,.980491,105514e-9,0,.0239635,.974779,121532e-9,0,.031387,.96675,119144e-9,0,.0398644,.958248,136125e-9,0,.0493982,.948884,155408e-9,0,.0599896,.941673,162281e-9,0,.0716382,.934521,176754e-9,0,.0843437,.926205,192873e-9,0,.0981056,.916089,200038e-9,0,.112923,.904963,213624e-9,0,.128796,.892089,221834e-9,0,.145725,.878028,232619e-9,0,.163709,.86249,238632e-9,0,.182749,.846587,247002e-9,0,.202847,.830988,250702e-9,0,.224001,.814165,255562e-9,0,.246214,.796135,257505e-9,0,.269482,.777052,258625e-9,0,.293805,.757201,258398e-9,0,.319176,.737655,256714e-9,0,.345587,.717477,255187e-9,0,.373021,.696433,251792e-9,0,.401454,.675084,247223e-9,0,.430844,.653907,242213e-9,0,.461125,.632561,237397e-9,0,.492187,.610658,229313e-9,0,.52381,.589322,224402e-9,0,.555556,.567857,216116e-9,0,.587302,.54652,209124e-9,0,.619048,.525433,201601e-9,0,.650794,.504679,192957e-9,0,.68254,.484203,186052e-9,0,.714286,.464203,177672e-9,0,.746032,.444549,170005e-9,0,.777778,.425346,162401e-9,0,.809524,.406706,1544e-7,0,.84127,.388576,147437e-9,0,.873016,.37094,139493e-9,0,.904762,.353996,133219e-9,0,.936508,.337391,125573e-9,0,.968254,.321648,119867e-9,0,1,1,362511e-11,0,0,1,362525e-11,0,0,1,362739e-11,0,0,.999999,363673e-11,0,0,.999998,366214e-11,0,0,.999996,371698e-11,0,0,.999992,382116e-11,0,0,.999986,400554e-11,0,0,.999976,432058e-11,0,0,.999961,485194e-11,0,0,.999938,574808e-11,0,0,.999908,726643e-11,0,0,.999865,984707e-11,0,0,.999807,142217e-10,0,0,.999723,215581e-10,0,0,.999602,336114e-10,0,119113e-10,.999398,527353e-10,0,355813e-9,.998946,805809e-10,0,.00137768,.996647,942908e-10,0,.00322469,.992298,668733e-10,0,.00597897,.989802,716564e-10,0,.00968903,.987019,821355e-10,0,.0143845,.984219,104555e-9,0,.0200831,.980425,131245e-9,0,.0267948,.974241,139613e-9,0,.034525,.967006,145931e-9,0,.0432757,.95893,167153e-9,0,.0530471,.949157,188146e-9,0,.0638386,.94062,194625e-9,0,.0756487,.933509,213721e-9,0,.0884762,.925088,229616e-9,0,.10232,.915178,239638e-9,0,.117178,.904093,254814e-9,0,.133051,.891337,263685e-9,0,.149939,.877326,274789e-9,0,.167841,.861794,280534e-9,0,.18676,.845758,289534e-9,0,.206696,.829792,294446e-9,0,.22765,.813037,296877e-9,0,.249625,.795285,300217e-9,0,.27262,.776323,299826e-9,0,.296636,.756673,299787e-9,0,.321671,.736856,297867e-9,0,.347718,.716883,294052e-9,0,.374768,.696089,289462e-9,0,.402804,.67505,285212e-9,0,.431796,.653509,27653e-8,0,.461695,.63258,271759e-9,0,.49242,.61104,262811e-9,0,.523822,.589567,255151e-9,0,.555556,.568322,246434e-9,0,.587302,.547235,237061e-9,0,.619048,.52616,228343e-9,0,.650794,.505716,219236e-9,0,.68254,.485274,209595e-9,0,.714286,.465411,201011e-9,0,.746032,.445854,19109e-8,0,.777778,.426911,182897e-9,0,.809524,.408222,173569e-9,0,.84127,.390307,165496e-9,0,.873016,.372624,156799e-9,0,.904762,.355804,14917e-8,0,.936508,.33924,140907e-9,0,.968254,.323534,134062e-9,0,1,1,622487e-11,0,0,1,62251e-10,0,0,1,622837e-11,0,0,.999999,624259e-11,0,0,.999998,628127e-11,0,0,.999996,636451e-11,0,0,.999991,65218e-10,0,0,.999984,679782e-11,0,0,.999973,726361e-11,0,0,.999955,803644e-11,0,0,.999931,931397e-11,0,0,.999896,114299e-10,0,0,.999847,149402e-10,0,0,.999784,207461e-10,0,0,.999692,302493e-10,0,0,.999554,454957e-10,0,997275e-10,.999326,690762e-10,0,724813e-9,.998757,101605e-9,0,.0020972,.995367,958745e-10,0,.00432324,.99209,832808e-10,0,.00746347,.989517,887601e-10,0,.0115534,.987008,10564e-8,0,.0166134,.98421,133179e-9,0,.0226552,.98021,161746e-9,0,.0296838,.973676,161821e-9,0,.0377016,.967052,178635e-9,0,.0467079,.959385,206765e-9,0,.0567013,.949461,22476e-8,0,.0676796,.939578,23574e-8,0,.0796403,.932416,25893e-8,0,.0925812,.923759,271228e-9,0,.106501,.914223,289165e-9,0,.121397,.902942,301156e-9,0,.13727,.890419,313852e-9,0,.15412,.876639,324408e-9,0,.171946,.861316,33249e-8,0,.190751,.84496,338497e-9,0,.210537,.828427,345861e-9,0,.231305,.811871,347863e-9,0,.253057,.794397,350225e-9,0,.275797,.775726,349915e-9,0,.299525,.75617,347297e-9,0,.324242,.736091,344232e-9,0,.349947,.716213,340835e-9,0,.376633,.695736,332369e-9,0,.404289,.674961,327943e-9,0,.432895,.653518,318533e-9,0,.462415,.632574,310391e-9,0,.492788,.61134,300755e-9,0,.523909,.590017,290506e-9,0,.555556,.568752,280446e-9,0,.587302,.548061,269902e-9,0,.619048,.52711,258815e-9,0,.650794,.506682,248481e-9,0,.68254,.486524,237141e-9,0,.714286,.466812,226872e-9,0,.746032,.44732,216037e-9,0,.777778,.428473,205629e-9,0,.809524,.409921,195691e-9,0,.84127,.392028,185457e-9,0,.873016,.374606,176436e-9,0,.904762,.357601,166508e-9,0,.936508,.341348,158385e-9,0,.968254,.32542,149203e-9,0,1,1,103967e-10,0,0,1,10397e-9,0,0,1,104019e-10,0,0,.999999,104231e-10,0,0,.999998,104806e-10,0,0,.999995,106042e-10,0,0,.999991,108366e-10,0,0,.999982,112415e-10,0,0,.999968,119174e-10,0,0,.99995,130227e-10,0,0,.999922,148176e-10,0,0,.999884,177303e-10,0,0,.99983,224564e-10,0,0,.999758,300966e-10,0,0,.999654,423193e-10,0,549083e-11,.999503,614848e-10,0,296087e-9,.999237,903576e-10,0,.00123144,.998491,1271e-7,0,.00295954,.994594,107754e-9,0,.00555829,.99178,103025e-9,0,.00907209,.989265,11154e-8,0,.0135257,.986998,136296e-9,0,.0189327,.984137,169154e-9,0,.0252993,.979798,196671e-9,0,.0326272,.97337,196678e-9,0,.0409157,.967239,223121e-9,0,.0501623,.959543,253809e-9,0,.0603638,.949466,265972e-9,0,.0715171,.939074,288372e-9,0,.0836187,.931118,310983e-9,0,.0966657,.922525,325561e-9,0,.110656,.912983,345725e-9,0,.125588,.901617,3556e-7,0,.141461,.889487,374012e-9,0,.158275,.875787,383445e-9,0,.176031,.860654,393972e-9,0,.19473,.844417,400311e-9,0,.214374,.82741,405004e-9,0,.234967,.810545,407378e-9,0,.256512,.793312,407351e-9,0,.279011,.774847,406563e-9,0,.302468,.755621,404903e-9,0,.326887,.735511,397486e-9,0,.352266,.715435,39357e-8,0,.378605,.695403,384739e-9,0,.405897,.674681,376108e-9,0,.43413,.65359,365997e-9,0,.463277,.632471,354957e-9,0,.493295,.61151,343593e-9,0,.524106,.59064,331841e-9,0,.555561,.569386,318891e-9,0,.587302,.548785,3072e-7,0,.619048,.528146,29361e-8,0,.650794,.507872,281709e-9,0,.68254,.487805,268627e-9,0,.714286,.468196,255887e-9,0,.746032,.448922,243997e-9,0,.777778,.430093,231662e-9,0,.809524,.411845,220339e-9,0,.84127,.393808,208694e-9,0,.873016,.376615,198045e-9,0,.904762,.359655,187375e-9,0,.936508,.343452,177371e-9,0,.968254,.32765,167525e-9,0,1,1,169351e-10,0,0,1,169356e-10,0,0,1,169427e-10,0,0,.999999,169736e-10,0,0,.999998,170575e-10,0,0,.999995,172372e-10,0,0,.99999,175739e-10,0,0,.999979,181568e-10,0,0,.999966,191206e-10,0,0,.999944,20677e-9,0,0,.999912,231644e-10,0,0,.999869,271268e-10,0,0,.999811,334272e-10,0,0,.99973,433979e-10,0,0,.999617,590083e-10,0,680315e-10,.999445,829497e-10,0,612796e-9,.999138,118019e-9,0,.00187408,.998095,156712e-9,0,.00395791,.993919,125054e-9,0,.00692144,.991333,126091e-9,0,.0107962,.989226,144912e-9,0,.0155986,.986954,175737e-9,0,.0213364,.983982,213883e-9,0,.0280114,.979128,234526e-9,0,.0356226,.973327,243725e-9,0,.0441668,.967416,2773e-7,0,.0536399,.959729,308799e-9,0,.0640376,.949758,322447e-9,0,.0753554,.939173,350021e-9,0,.0875893,.9296,370089e-9,0,.100736,.921181,391365e-9,0,.114793,.91164,413636e-9,0,.129759,.900435,427068e-9,0,.145632,.888183,441046e-9,0,.162412,.874772,454968e-9,0,.180101,.859566,461882e-9,0,.1987,.843579,471556e-9,0,.218213,.826453,474335e-9,0,.238641,.809164,477078e-9,0,.259989,.792179,47755e-8,0,.282262,.773866,472573e-9,0,.305464,.754944,469765e-9,0,.329599,.735133,462371e-9,0,.35467,.714858,453674e-9,0,.380678,.694829,443888e-9,0,.407622,.674453,432052e-9,0,.435493,.653685,420315e-9,0,.464275,.632666,406829e-9,0,.493938,.611676,392234e-9,0,.524422,.591193,379208e-9,0,.555624,.570145,36319e-8,0,.587302,.549566,349111e-9,0,.619048,.529278,334166e-9,0,.650794,.509026,318456e-9,0,.68254,.489186,30449e-8,0,.714286,.469662,289051e-9,0,.746032,.450691,275494e-9,0,.777778,.431841,261437e-9,0,.809524,.413752,247846e-9,0,.84127,.395951,235085e-9,0,.873016,.378633,222245e-9,0,.904762,.36194,210533e-9,0,.936508,.345599,198494e-9,0,.968254,.329999,188133e-9,0,1,1,269663e-10,0,0,1,26967e-9,0,0,1,269772e-10,0,0,.999999,270214e-10,0,0,.999998,271415e-10,0,0,.999994,27398e-9,0,0,.999988,278771e-10,0,0,.999977,287019e-10,0,0,.999961,300544e-10,0,0,.999937,322138e-10,0,0,.999904,356163e-10,0,0,.999854,409465e-10,0,0,.99979,492651e-10,0,0,.999699,621722e-10,0,88288e-11,.999572,819715e-10,0,223369e-9,.999381,111689e-9,0,.00105414,.999016,153862e-9,0,.0026493,.997437,187667e-9,0,.00508608,.993545,155672e-9,0,.00840554,.991135,161455e-9,0,.012629,.989157,188241e-9,0,.0177661,.986874,226229e-9,0,.0238198,.983714,268668e-9,0,.0307887,.978301,277109e-9,0,.0386688,.973227,303446e-9,0,.0474554,.967317,341851e-9,0,.0571428,.959477,370885e-9,0,.0677256,.950012,392753e-9,0,.0791988,.939484,42781e-8,0,.0915576,.928135,443866e-9,0,.104798,.919819,472959e-9,0,.118918,.910049,491551e-9,0,.133915,.899181,512616e-9,0,.149788,.886881,523563e-9,0,.166537,.87359,540183e-9,0,.184164,.858613,547386e-9,0,.202669,.842809,554809e-9,0,.222056,.825727,558316e-9,0,.242329,.808086,557824e-9,0,.263492,.790728,556346e-9,0,.285551,.772987,552672e-9,0,.30851,.7541,543738e-9,0,.332376,.734669,536107e-9,0,.357153,.714411,523342e-9,0,.382845,.694196,512238e-9,0,.409454,.674252,497465e-9,0,.436977,.65357,481096e-9,0,.465404,.632999,467054e-9,0,.494713,.611994,448771e-9,0,.524864,.591604,431889e-9,0,.555779,.571134,415238e-9,0,.587302,.550528,396369e-9,0,.619048,.530292,379477e-9,0,.650794,.510364,361488e-9,0,.68254,.490749,343787e-9,0,.714286,.471266,327822e-9,0,.746032,.452462,310626e-9,0,.777778,.433907,295352e-9,0,.809524,.415659,279179e-9,0,.84127,.398138,264685e-9,0,.873016,.380833,249905e-9,0,.904762,.364247,236282e-9,0,.936508,.348041,222905e-9,0,.968254,.332389,210522e-9,0,1,1,420604e-10,0,0,1,420614e-10,0,0,1,420757e-10,0,0,.999999,42138e-9,0,0,.999997,423067e-10,0,0,.999993,426668e-10,0,0,.999986,433372e-10,0,0,.999974,444857e-10,0,0,.999956,463554e-10,0,0,.99993,493105e-10,0,0,.999892,539077e-10,0,0,.999838,610005e-10,0,0,.999767,718822e-10,0,0,.999666,884581e-10,0,365471e-10,.999525,113398e-9,0,485623e-9,.999311,150043e-9,0,.00162096,.998865,200063e-9,0,.00355319,.996278,211014e-9,0,.00633818,.992956,189672e-9,0,.0100043,.991017,210262e-9,0,.0145648,.989055,244292e-9,0,.0200237,.986741,290481e-9,0,.0263798,.983288,334303e-9,0,.033629,.977784,340307e-9,0,.0417652,.973037,377864e-9,0,.0507821,.967181,4239e-7,0,.060673,.958971,443854e-9,0,.0714314,.950093,483039e-9,0,.0830518,.939552,517934e-9,0,.0955288,.927678,539449e-9,0,.108859,.918278,568604e-9,0,.123038,.908449,588505e-9,0,.138065,.897713,612473e-9,0,.153938,.885533,625575e-9,0,.170657,.872131,63854e-8,0,.188224,.857517,647034e-9,0,.20664,.841796,65209e-8,0,.225909,.824726,6544e-7,0,.246035,.807297,655744e-9,0,.267022,.789058,646716e-9,0,.288878,.77189,643898e-9,0,.311607,.753082,629973e-9,0,.335216,.7341,621564e-9,0,.359713,.714094,605171e-9,0,.385103,.693839,588752e-9,0,.41139,.673891,573294e-9,0,.438576,.653565,552682e-9,0,.466656,.633326,533446e-9,0,.495617,.612582,514635e-9,0,.525431,.59205,49303e-8,0,.556041,.571918,471842e-9,0,.587338,.551572,451713e-9,0,.619048,.531553,430049e-9,0,.650794,.51175,410445e-9,0,.68254,.49238,390098e-9,0,.714286,.473143,370033e-9,0,.746032,.45423,351205e-9,0,.777778,.435963,332049e-9,0,.809524,.41787,315021e-9,0,.84127,.400387,297315e-9,0,.873016,.383332,281385e-9,0,.904762,.366665,265397e-9,0,.936508,.350633,250601e-9,0,.968254,.334964,23589e-8,0,1,1,643736e-10,0,0,1,64375e-9,0,0,1,643947e-10,0,0,.999999,64481e-9,0,0,.999997,647143e-10,0,0,.999994,652119e-10,0,0,.999985,661359e-10,0,0,.999972,677116e-10,0,0,.999952,702599e-10,0,0,.999922,742517e-10,0,0,.99988,803906e-10,0,0,.99982,897315e-10,0,0,.999741,103838e-9,0,0,.999629,12496e-8,0,149024e-9,.999474,156161e-9,0,861027e-9,.999229,201034e-9,0,.00231198,.998662,259069e-9,0,.00458147,.995299,245439e-9,0,.00770895,.992732,24498e-8,0,.0117126,.990847,273211e-9,0,.0165989,.988911,316492e-9,0,.0223674,.98654,37161e-8,0,.0290135,.982636,410352e-9,0,.0365309,.977346,421756e-9,0,.0449117,.972909,475578e-9,0,.0541481,.966821,522482e-9,0,.0642326,.958686,545008e-9,0,.075158,.949754,589286e-9,0,.0869181,.939184,619995e-9,0,.0995074,.927505,654266e-9,0,.112922,.916606,682362e-9,0,.127157,.906707,704286e-9,0,.142212,.895937,725909e-9,0,.158085,.883913,743939e-9,0,.174776,.870642,755157e-9,0,.192287,.856241,764387e-9,0,.210619,.84069,771032e-9,0,.229775,.823728,765906e-9,0,.249761,.806481,767604e-9,0,.270582,.787924,754385e-9,0,.292243,.770588,749668e-9,0,.314753,.751991,731613e-9,0,.338118,.733407,717655e-9,0,.362347,.713688,700604e-9,0,.387447,.693595,678765e-9,0,.413424,.673426,657042e-9,0,.440284,.65359,635892e-9,0,.468027,.633576,611569e-9,0,.496645,.613144,586011e-9,0,.526122,.592711,563111e-9,0,.556417,.572722,537699e-9,0,.587451,.552762,512556e-9,0,.619048,.532985,489757e-9,0,.650794,.513219,464139e-9,0,.68254,.493992,442193e-9,0,.714286,.47509,418629e-9,0,.746032,.456287,397045e-9,0,.777778,.438152,375504e-9,0,.809524,.420294,35492e-8,0,.84127,.402749,335327e-9,0,.873016,.385879,316422e-9,0,.904762,.369352,298333e-9,0,.936508,.353301,281417e-9,0,.968254,.337781,265203e-9,0,1,1,968267e-10,0,0,1,968284e-10,0,0,1,968556e-10,0,0,.999999,969733e-10,0,0,.999997,972913e-10,0,0,.999993,979688e-10,0,0,.999984,992239e-10,0,0,.999969,101356e-9,0,0,.999946,104784e-9,0,0,.999913,110111e-9,0,0,.999868,118217e-9,0,0,.999801,130396e-9,0,0,.999712,148523e-9,0,124907e-10,.999589,175233e-9,0,355405e-9,.999416,213999e-9,0,.0013528,.999136,268529e-9,0,.00312557,.998367,333088e-9,0,.00573045,.994701,304757e-9,0,.00919397,.992497,318031e-9,0,.0135261,.990608,353863e-9,0,.0187278,.988715,409044e-9,0,.0247947,.986241,472967e-9,0,.0317196,.981696,495104e-9,0,.039494,.977097,532873e-9,0,.0481087,.972583,594447e-9,0,.0575549,.966142,636867e-9,0,.0678242,.95823,669899e-9,0,.0789089,.949677,719499e-9,0,.0908023,.939226,750584e-9,0,.103499,.927501,793183e-9,0,.116993,.915199,81995e-8,0,.131282,.90498,847654e-9,0,.146364,.894243,868929e-9,0,.162237,.882154,884278e-9,0,.178902,.869161,898108e-9,0,.196358,.854751,901254e-9,0,.21461,.839368,90679e-8,0,.23366,.822874,901541e-9,0,.253512,.805514,897297e-9,0,.274174,.78716,881856e-9,0,.29565,.769061,870032e-9,0,.31795,.751,851719e-9,0,.341081,.732614,830671e-9,0,.365053,.713171,806569e-9,0,.389874,.693472,78338e-8,0,.415553,.673528,756404e-9,0,.442098,.653397,726872e-9,0,.469512,.633781,700494e-9,0,.497794,.613877,67105e-8,0,.526935,.593506,640361e-9,0,.556908,.573667,613502e-9,0,.587657,.553932,583177e-9,0,.61906,.534345,554375e-9,0,.650794,.515042,527811e-9,0,.68254,.495674,499367e-9,0,.714286,.477132,47429e-8,0,.746032,.458609,447726e-9,0,.777778,.440354,424205e-9,0,.809524,.422765,399549e-9,0,.84127,.405472,378315e-9,0,.873016,.388482,355327e-9,0,.904762,.372191,336122e-9,0,.936508,.356099,315247e-9,0,.968254,.340737,29794e-8,0,1,1,143327e-9,0,0,1,14333e-8,0,0,1,143366e-9,0,0,.999999,143524e-9,0,0,.999996,143952e-9,0,0,.999991,144862e-9,0,0,.999981,146544e-9,0,0,.999966,149391e-9,0,0,.999941,153946e-9,0,0,.999905,160971e-9,0,0,.999852,171562e-9,0,0,.99978,18729e-8,0,0,.999681,210386e-9,0,826239e-10,.999546,243906e-9,0,664807e-9,.999352,291739e-9,0,.00196192,.999027,357419e-9,0,.00405941,.997886,422349e-9,0,.00699664,.99419,385008e-9,0,.0107896,.99214,409775e-9,0,.0154415,.990274,456418e-9,0,.0209488,.988455,527008e-9,0,.0273037,.985804,597685e-9,0,.0344969,.98103,613124e-9,0,.0425183,.976674,668321e-9,0,.0513575,.972021,736985e-9,0,.0610046,.965274,773789e-9,0,.0714508,.958046,830852e-9,0,.0826877,.949333,875766e-9,0,.0947085,.939135,917088e-9,0,.107507,.927119,952244e-9,0,.121078,.91469,990626e-9,0,.135419,.903006,.00101304,0,.150526,.892368,.00103834,0,.166399,.880231,.00105002,0,.183038,.867432,.00106331,0,.200443,.853208,.00106783,0,.218618,.837956,.00106458,0,.237566,.821772,.00105945,0,.257291,.804328,.00104685,0,.2778,.786465,.00103178,0,.2991,.768004,.00101077,0,.321199,.74972,985504e-9,0,.344106,.731682,962893e-9,0,.36783,.712813,932146e-9,0,.392383,.693139,89871e-8,0,.417774,.673566,869678e-9,0,.444013,.653483,835525e-9,0,.471107,.633891,799853e-9,0,.49906,.614433,766838e-9,0,.527869,.594586,732227e-9,0,.557517,.574769,696442e-9,0,.587966,.555149,663935e-9,0,.61913,.535898,629826e-9,0,.650794,.516753,596486e-9,0,.68254,.497816,567078e-9,0,.714286,.479034,534399e-9,0,.746032,.460975,507013e-9,0,.777778,.442935,477421e-9,0,.809524,.425263,451101e-9,0,.84127,.408248,424964e-9,0,.873016,.391339,39993e-8,0,.904762,.37513,377619e-9,0,.936508,.359172,354418e-9,0,.968254,.343876,334823e-9,0,1,1,209042e-9,0,0,1,209045e-9,0,0,1,209093e-9,0,0,.999999,209304e-9,0,0,.999996,209871e-9,0,0,.999991,211078e-9,0,0,.999979,213304e-9,0,0,.999963,217061e-9,0,0,.999933,223042e-9,0,0,.999894,232206e-9,0,0,.999837,245901e-9,0,0,.999756,266023e-9,0,102927e-11,.999648,295204e-9,0,233468e-9,.999499,336958e-9,0,.00108237,.999283,395563e-9,0,.00268832,.998896,473785e-9,0,.00511138,.997006,520008e-9,0,.00837705,.993819,497261e-9,0,.0124928,.991632,523722e-9,0,.0174561,.989875,587258e-9,0,.0232596,.988109,676329e-9,0,.0298932,.985155,747701e-9,0,.0373453,.980479,768803e-9,0,.0456045,.976271,841054e-9,0,.0546593,.971347,911469e-9,0,.0644994,.964528,953057e-9,0,.0751152,.957632,.00102221,0,.0864981,.948681,.00106122,0,.0986407,.938716,.00111857,0,.111537,.926629,.00114762,0,.125182,.914025,.00118995,0,.139571,.901026,.00121228,0,.154703,.890358,.00123946,0,.170576,.878283,.0012527,0,.18719,.865459,.00125536,0,.204547,.851407,.00126134,0,.222648,.836276,.00124759,0,.241498,.820436,.00124443,0,.261101,.803253,.00122071,0,.281465,.785562,.00120107,0,.302595,.76718,.00117762,0,.324501,.748551,.00114289,0,.347192,.730564,.00110872,0,.370679,.712253,.00107636,0,.394973,.692867,.00103646,0,.420085,.673695,996793e-9,0,.446027,.653912,95675e-8,0,.47281,.634129,916739e-9,0,.500441,.615004,874401e-9,0,.528921,.595587,833411e-9,0,.558244,.575965,794556e-9,0,.588384,.5566,75196e-8,0,.619281,.537428,716381e-9,0,.650795,.518623,676558e-9,0,.68254,.499964,64074e-8,0,.714286,.481356,605984e-9,0,.746032,.463279,570256e-9,0,.777778,.445673,540138e-9,0,.809524,.428032,507299e-9,0,.84127,.411112,479553e-9,0,.873016,.394444,450737e-9,0,.904762,.378247,424269e-9,0,.936508,.362415,399111e-9,0,.968254,.347103,375274e-9,0,1,1,300729e-9,0,0,1,300733e-9,0,0,1,300797e-9,0,0,.999998,301072e-9,0,0,.999996,301817e-9,0,0,.999989,303398e-9,0,0,.999977,306309e-9,0,0,.999958,311209e-9,0,0,.999927,318975e-9,0,0,.999884,330804e-9,0,0,.99982,34834e-8,0,0,.999733,373854e-9,0,326995e-10,.999613,410424e-9,0,477174e-9,.999447,462047e-9,0,.00161099,.999204,533322e-9,0,.00353153,.998725,624964e-9,0,.00627965,.995871,631786e-9,0,.0098693,.993194,632017e-9,0,.0143011,.991541,68923e-8,0,.019568,.989773,766892e-9,0,.0256593,.987647,863668e-9,0,.0325625,.984193,922089e-9,0,.0402647,.980016,970749e-9,0,.0487532,.975859,.00106027,0,.058016,.970514,.00112239,0,.0680419,.963625,.00117212,0,.0788208,.956959,.00125211,0,.0903439,.947956,.00129411,0,.102604,.93809,.00135879,0,.115594,.92659,.00139309,0,.129309,.913829,.00143253,0,.143745,.90005,.00145809,0,.158901,.888129,.0014748,0,.174774,.87607,.00148756,0,.191365,.863461,.00148714,0,.208674,.849594,.00148892,0,.226705,.834531,.00146496,0,.245461,.81903,.0014579,0,.264947,.802122,.00143039,0,.28517,.78445,.00139717,0,.306137,.766434,.00136312,0,.327857,.747816,.00132597,0,.350341,.729519,.00128323,0,.373598,.711454,.00123803,0,.397642,.692699,.00119097,0,.422485,.673723,.00114565,0,.448139,.654386,.00109552,0,.474619,.634673,.00104553,0,.501933,.615554,99985e-8,0,.530089,.596462,948207e-9,0,.559087,.577385,902299e-9,0,.588913,.558257,856448e-9,0,.619525,.5392,810395e-9,0,.650826,.520543,768558e-9,0,.68254,.502206,7239e-7,0,.714286,.48402,685794e-9,0,.746032,.465779,64471e-8,0,.777778,.448455,609583e-9,0,.809524,.431091,57227e-8,0,.84127,.414147,54042e-8,0,.873016,.39765,506545e-9,0,.904762,.381576,477635e-9,0,.936508,.365881,448446e-9,0,.968254,.350582,421424e-9,0,1,1,427144e-9,0,0,1,427151e-9,0,0,1,427232e-9,0,0,.999998,42759e-8,0,0,.999995,428555e-9,0,0,.999988,430603e-9,0,0,.999976,434368e-9,0,0,.999952,440688e-9,0,0,.999919,450667e-9,0,0,.999871,46578e-8,0,0,.999801,488024e-9,0,0,.999704,520092e-9,0,129791e-9,.999572,565553e-9,0,821056e-9,.999389,628906e-9,0,.00225241,.999114,714911e-9,0,.00449109,.998488,819218e-9,0,.00756249,.995234,80415e-8,0,.0114716,.993021,830181e-9,0,.0162131,.991407,902645e-9,0,.021776,.989625,996934e-9,0,.0281471,.987064,.00109707,0,.0353118,.983265,.00114353,0,.0432562,.979535,.0012272,0,.0519665,.975224,.00132642,0,.0614298,.969574,.00138092,0,.0716348,.963021,.00145896,0,.0825709,.956046,.00152834,0,.094229,.947136,.00158217,0,.106602,.937313,.0016347,0,.119682,.926073,.00168383,0,.133465,.913121,.00171627,0,.147947,.899165,.00174229,0,.163125,.885891,.00176137,0,.178998,.873783,.00176406,0,.195566,.861331,.00176156,0,.21283,.847569,.00175346,0,.230793,.832785,.00172753,0,.249459,.817442,.00170204,0,.268832,.800613,.00166576,0,.28892,.783597,.00162909,0,.30973,.76571,.0015826,0,.331271,.747021,.00153106,0,.353554,.728593,.00148036,0,.37659,.710661,.00142808,0,.400391,.692426,.00136906,0,.424973,.673623,.00131066,0,.450347,.65494,.00125569,0,.476531,.635448,.00119517,0,.503535,.616221,.00113828,0,.531372,.597531,.0010816,0,.560047,.578795,.00102673,0,.589554,.559892,970985e-9,0,.619869,.541307,919773e-9,0,.650923,.522608,868479e-9,0,.68254,.504484,82137e-8,0,.714286,.486603,772916e-9,0,.746032,.468802,730353e-9,0,.777778,.451172,684955e-9,0,.809524,.434348,647565e-9,0,.84127,.417445,605863e-9,0,.873016,.401077,571885e-9,0,.904762,.385039,536034e-9,0,.936508,.369483,504227e-9,0,.968254,.354272,473165e-9,0,1,1,599525e-9,0,0,1,599533e-9,0,0,1,599639e-9,0,0,.999998,600097e-9,0,0,.999994,601336e-9,0,0,.999987,603958e-9,0,0,.999972,608775e-9,0,0,.999949,616842e-9,0,0,.999912,629534e-9,0,0,.999857,648658e-9,0,0,.999781,676615e-9,0,538873e-11,.999674,716574e-9,0,308602e-9,.999528,772641e-9,0,.00127003,.999326,849806e-9,0,.00300783,.999009,952682e-9,0,.00556637,.998112,.00106394,0,.00895889,.994496,.00102228,0,.0131827,.992806,.00108586,0,.0182277,.991211,.0011759,0,.0240795,.989415,.00128955,0,.030723,.986499,.00139038,0,.0381418,.982679,.00144539,0,.046321,.978839,.00153954,0,.0552459,.974295,.00164417,0,.0649034,.968784,.00171517,0,.0752814,.962324,.00180282,0,.0863693,.954956,.00186387,0,.0981578,.94624,.00193817,0,.110639,.936517,.00198156,0,.123806,.925186,.00203042,0,.137655,.91252,.0020664,0,.15218,.898441,.00207822,0,.16738,.884394,.0020992,0,.183253,.871273,.00208748,0,.199799,.859057,.00208686,0,.21702,.845243,.00205519,0,.234918,.830723,.00202868,0,.253496,.815801,.00199501,0,.272761,.79914,.00194193,0,.292719,.782372,.00188824,0,.313377,.76482,.00183695,0,.334745,.746586,.00177418,0,.356833,.7281,.00170628,0,.379654,.709842,.00164063,0,.403221,.692019,.00157355,0,.427548,.67364,.00150262,0,.452651,.655277,.00143473,0,.478545,.636438,.00136371,0,.505246,.617364,.00129911,0,.532768,.598603,.00123014,0,.561122,.580195,.00116587,0,.590309,.561786,.00110398,0,.620318,.543377,.00104148,0,.651102,.525093,983984e-9,0,.682545,.506791,92667e-8,0,.714286,.489291,874326e-9,0,.746032,.471811,821734e-9,0,.777778,.454435,774698e-9,0,.809524,.437493,727302e-9,0,.84127,.420977,684039e-9,0,.873016,.404729,64373e-8,0,.904762,.388756,60285e-8,0,.936508,.373344,56765e-8,0,.968254,.358191,531929e-9,0,1,1,832169e-9,0,0,1,832178e-9,0,0,1,83231e-8,0,0,.999998,832893e-9,0,0,.999995,834465e-9,0,0,.999985,837791e-9,0,0,.999969,843893e-9,0,0,.999944,854086e-9,0,0,.999903,870071e-9,0,0,.999843,894042e-9,0,0,.999759,928865e-9,0,531805e-10,.999643,978242e-9,0,579365e-9,.99948,.00104684,0,.00182774,.999255,.00114012,0,.00387804,.998885,.00126188,0,.00675709,.997405,.00135888,0,.010468,.99424,.00133626,0,.0150018,.992458,.00140905,0,.0203443,.990929,.00152305,0,.0264786,.989116,.00165882,0,.0333875,.985624,.00174128,0,.0410536,.982003,.00182108,0,.0494609,.978336,.00194498,0,.0585941,.973184,.00202708,0,.0684396,.9678,.00212166,0,.0789851,.961348,.00221366,0,.0902199,.953841,.00228219,0,.102134,.94534,.00235662,0,.114721,.935552,.00240572,0,.127972,.924064,.00244405,0,.141884,.911827,.00247557,0,.156451,.897731,.00248374,0,.171672,.883409,.00249863,0,.187545,.868625,.00246688,0,.20407,.856529,.00246523,0,.221249,.842999,.00242368,0,.239083,.828505,.00237354,0,.257578,.813825,.00232588,0,.276738,.797813,.00226731,0,.296569,.781097,.00219704,0,.31708,.764038,.00212394,0,.338281,.746067,.00204786,0,.360181,.727687,.00196728,0,.382794,.709571,.00188779,0,.406133,.691503,.00180532,0,.430213,.673673,.00171849,0,.45505,.655732,.00164147,0,.480662,.637399,.00155858,0,.507065,.618616,.00147641,0,.534278,.60005,.00140125,0,.562313,.581713,.00132441,0,.59118,.563546,.00125014,0,.620875,.545605,.00118249,0,.651373,.527559,.0011116,0,.682593,.509764,.00104979,0,.714286,.49193,985977e-9,0,.746032,.475011,928592e-9,0,.777778,.457878,873466e-9,0,.809524,.440979,819585e-9,0,.84127,.424613,772365e-9,0,.873016,.408549,722195e-9,0,.904762,.392771,680014e-9,0,.936508,.377317,636797e-9,0,.968254,.362352,598318e-9,0,1,1,.00114313,0,0,1,.00114314,0,0,.999999,.00114331,0,0,.999998,.00114404,0,0,.999994,.00114601,0,0,.999984,.00115019,0,0,.999967,.00115784,0,0,.999937,.0011706,0,0,.999894,.00119054,0,0,.999828,.00122031,0,0,.999735,.00126331,0,169263e-9,.999606,.00132382,0,949167e-9,.999426,.0014071,0,.00249668,.999173,.00151895,0,.00486392,.99873,.00166102,0,.00806323,.996243,.0017023,0,.0120895,.993779,.00172782,0,.0169288,.9919,.0018108,0,.0225633,.990524,.00196028,0,.028974,.98868,.00212014,0,.036142,.984663,.00217598,0,.044049,.981457,.00230563,0,.0526781,.977608,.00243966,0,.0620137,.972215,.00251336,0,.0720418,.966798,.0026285,0,.0827499,.960241,.00271409,0,.0941271,.952489,.00278381,0,.106164,.944127,.00285399,0,.118852,.934282,.00290994,0,.132185,.923271,.00294558,0,.146157,.910803,.00296269,0,.160766,.896705,.00296803,0,.176007,.88238,.00296637,0,.19188,.867116,.00293163,0,.208385,.853636,.00289418,0,.225523,.840469,.00284663,0,.243296,.82639,.00278594,0,.261709,.811759,.00271618,0,.280767,.796113,.00263187,0,.300476,.779518,.00254589,0,.320845,.763142,.00246003,0,.341883,.745464,.00236529,0,.363601,.727491,.00226536,0,.386011,.709414,.00216375,0,.409128,.691396,.00207127,0,.432967,.67368,.00197106,0,.457545,.656049,.00187022,0,.482881,.638188,.00177605,0,.508992,.620177,.00168482,0,.535899,.601506,.00158909,0,.563619,.58362,.00150583,0,.592165,.565496,.00141791,0,.621544,.54789,.00133693,0,.651743,.530323,.00126038,0,.682709,.512795,.00118556,0,.714286,.495199,.00111527,0,.746032,.478101,.0010489,0,.777778,.461511,984264e-9,0,.809524,.444879,92591e-8,0,.84127,.428424,866582e-9,0,.873016,.412495,814463e-9,0,.904762,.396975,764498e-9,0,.936508,.381614,715967e-9,0,.968254,.366732,672483e-9,0,1,1,.00155501,0,0,1,.00155503,0,0,1,.00155524,0,0,.999998,.00155615,0,0,.999994,.0015586,0,0,.999983,.00156379,0,0,.999963,.0015733,0,0,.999932,.00158911,0,0,.999882,.00161376,0,0,.99981,.00165041,0,100875e-10,.999708,.00170304,0,367658e-9,.999565,.00177658,0,.0014234,.999368,.00187688,0,.00327939,.999081,.00200989,0,.00596629,.99852,.00217177,0,.0094852,.99549,.0021745,0,.013824,.993252,.00222357,0,.0189642,.991727,.00235022,0,.0248856,.989951,.00250561,0,.0315669,.988029,.00268829,0,.0389882,.984029,.0027496,0,.0471302,.980683,.00289793,0,.0559754,.976554,.00303315,0,.0655081,.97139,.00313257,0,.0757138,.965544,.00323656,0,.08658,.95912,.00333432,0,.0980954,.951183,.0034039,0,.110251,.942974,.00347515,0,.123038,.932642,.00350381,0,.13645,.922158,.00354519,0,.150482,.909404,.00353851,0,.165129,.896071,.0035435,0,.18039,.881206,.00349936,0,.196263,.866077,.00347256,0,.212748,.85093,.003415,0,.229847,.837703,.00333367,0,.247561,.823878,.003249,0,.265895,.809449,.00316347,0,.284854,.794379,.00306351,0,.304445,.778138,.0029499,0,.324675,.761997,.00284099,0,.345555,.744938,.00272104,0,.367095,.727212,.00260715,0,.389309,.709549,.00248855,0,.41221,.691704,.00236783,0,.435814,.673689,.00225178,0,.460138,.656453,.00213765,0,.485203,.639128,.00202178,0,.511028,.621512,.00191443,0,.537634,.603598,.00180977,0,.565041,.58559,.00170456,0,.593268,.567852,.00160927,0,.622327,.5503,.00151395,0,.652217,.533033,.00142499,0,.682907,.515942,.00133955,0,.714296,.498814,.0012602,0,.746032,.481595,.00118188,0,.777778,.465117,.00111171,0,.809524,.448865,.00104091,0,.84127,.432711,976618e-9,0,.873016,.416822,91859e-8,0,.904762,.401272,857704e-9,0,.936508,.386226,807172e-9,0,.968254,.371321,75464e-8,0,1,1,.00209596,0,0,1,.00209598,0,0,1,.00209624,0,0,.999997,.00209736,0,0,.999991,.00210039,0,0,.999979,.00210678,0,0,.999959,.00211847,0,0,.999925,.0021379,0,0,.99987,.00216809,0,0,.999791,.00221281,0,681487e-10,.999677,.00227669,0,658161e-9,.999521,.00236533,0,.00200635,.999301,.00248514,0,.0041779,.998977,.00264185,0,.00718648,.998191,.00281695,0,.0110239,.994801,.00278518,0,.015672,.993091,.00288774,0,.0211091,.991571,.00303931,0,.0273123,.9897,.00321643,0,.034259,.987023,.00337332,0,.0419282,.983289,.00346146,0,.0502998,.979892,.00363704,0,.0593562,.975111,.00373601,0,.069081,.970351,.0038842,0,.0794598,.964131,.00397053,0,.0904798,.957747,.00408078,0,.10213,.949536,.00413533,0,.1144,.941372,.00420305,0,.127284,.931049,.00422815,0,.140772,.920647,.00425048,0,.154862,.908033,.0042281,0,.169548,.895028,.00422026,0,.184828,.879968,.00415042,0,.200701,.864875,.00408821,0,.217167,.84918,.00400909,0,.234227,.834934,.00391178,0,.251884,.821397,.00380066,0,.270141,.807135,.00367974,0,.289004,.792363,.00355172,0,.308479,.776661,.003411,0,.328575,.760705,.00328123,0,.349301,.744408,.00314003,0,.370668,.726994,.0029906,0,.392689,.709598,.00285034,0,.415379,.692112,.00271179,0,.438754,.674435,.00257185,0,.46283,.65676,.00243425,0,.48763,.639982,.00230351,0,.513173,.622983,.0021777,0,.539482,.605471,.00204991,0,.566579,.58796,.00193759,0,.594488,.570463,.00181976,0,.623226,.553058,.00171497,0,.6528,.535894,.00161109,0,.683198,.519089,.00151394,0,.714354,.502454,.00142122,0,.746032,.485681,.00133488,0,.777778,.468935,.00124975,0,.809524,.452951,.00117309,0,.84127,.437139,.00110155,0,.873016,.421446,.00103124,0,.904762,.405951,966387e-9,0,.936508,.391003,908119e-9,0,.968254,.376198,848057e-9,0,1,1,.00280076,0,0,1,.00280078,0,0,.999999,.00280109,0,0,.999997,.00280246,0,0,.999992,.00280616,0,0,.999979,.00281396,0,0,.999956,.00282822,0,0,.999916,.00285186,0,0,.999857,.0028885,0,0,.999768,.00294259,0,196026e-9,.999645,.00301946,0,.00104842,.99947,.00312541,0,.00270199,.999229,.00326733,0,.00519449,.998852,.00344992,0,.00852602,.997558,.00361052,0,.0126804,.994417,.0035898,0,.017635,.992824,.00372393,0,.023365,.991344,.00390695,0,.0298456,.989337,.00410392,0,.0370529,.985811,.00420987,0,.0449651,.982772,.00437488,0,.0535615,.979001,.00455069,0,.0628243,.974102,.00464462,0,.0727368,.969197,.00480577,0,.0832844,.962759,.00487818,0,.0944545,.956207,.00498176,0,.106236,.947909,.00503392,0,.118619,.939596,.00507474,0,.131595,.929642,.00509798,0,.145159,.918807,.00508476,0,.159305,.906921,.00505634,0,.174028,.893312,.00498845,0,.189327,.878933,.0049133,0,.2052,.863986,.0048259,0,.221647,.847936,.00470848,0,.23867,.832253,.00456889,0,.25627,.818619,.00442726,0,.274453,.804788,.00427677,0,.293222,.790241,.00411906,0,.312585,.775162,.00394833,0,.33255,.759463,.00377366,0,.353126,.743598,.00361026,0,.374324,.72697,.00343627,0,.396158,.709646,.00326422,0,.418641,.69277,.00309717,0,.44179,.675371,.0029356,0,.465624,.657863,.00277712,0,.490163,.640772,.00261738,0,.515429,.624441,.0024737,0,.541445,.607497,.00233125,0,.568236,.590438,.00218994,0,.595828,.573224,.0020664,0,.624242,.556168,.00193526,0,.653496,.539232,.00182463,0,.683588,.522352,.00170735,0,.714482,.506172,.00160555,0,.746032,.489842,.00150451,0,.777778,.473463,.00140938,0,.809524,.457266,.00132568,0,.84127,.441609,.0012376,0,.873016,.426348,.00116265,0,.904762,.411002,.00108935,0,.936508,.396045,.00101946,0,.968254,.381448,955665e-9,0,1,1,.0037121,0,0,1,.00371213,0,0,1,.00371251,0,0,.999997,.00371417,0,0,.99999,.00371863,0,0,.999977,.00372807,0,0,.99995,.00374529,0,0,.999908,.0037738,0,0,.999843,.00381789,0,123596e-10,.999745,.00388273,0,407442e-9,.999608,.00397443,0,.0015447,.999415,.00409998,0,.00351385,.999143,.00426662,0,.0063316,.9987,.00447625,0,.00998679,.996363,.00455323,0,.0144569,.994021,.00461052,0,.0197151,.992372,.00476359,0,.0257344,.991007,.00499101,0,.0324882,.988767,.0051972,0,.0399517,.984872,.00528407,0,.0481022,.982004,.00548926,0,.0569191,.977714,.00564385,0,.0663839,.973076,.0057693,0,.0764801,.967565,.0058924,0,.0871928,.961384,.00599629,0,.0985095,.954435,.00605998,0,.110419,.946303,.0061133,0,.122912,.937662,.00612028,0,.13598,.927867,.00612209,0,.149617,.916475,.00604813,0,.163817,.90541,.00603088,0,.178577,.891591,.00592218,0,.193894,.877573,.00578854,0,.209767,.862511,.00566648,0,.226196,.846861,.00551481,0,.243182,.83068,.00533754,0,.260728,.815725,.00515487,0,.278837,.802321,.0049655,0,.297515,.787826,.00475421,0,.316768,.773454,.00456002,0,.336605,.758224,.00434727,0,.357034,.74265,.00414444,0,.378067,.726729,.00393738,0,.399717,.710155,.00373575,0,.421998,.693312,.00353736,0,.444928,.67653,.00334368,0,.468523,.659444,.00315981,0,.492806,.642051,.00297809,0,.517798,.625758,.00280592,0,.543525,.609615,.00264254,0,.570012,.592919,.00248459,0,.597288,.576298,.00233327,0,.625379,.559489,.00219519,0,.654307,.542891,.00205441,0,.684084,.526255,.00193385,0,.714693,.509853,.00180745,0,.746044,.494131,.00169817,0,.777778,.478114,.0015913,0,.809524,.462274,.00148981,0,.84127,.446412,.00139537,0,.873016,.431274,.00130984,0,.904762,.41635,.00122403,0,.936508,.401476,.00114809,0,.968254,.386993,.00107563,0,1,1,.00488216,0,0,1,.0048822,0,0,1,.00488265,0,0,.999997,.00488463,0,0,.999988,.00488999,0,0,.999974,.00490129,0,0,.999946,.00492191,0,0,.999897,.00495598,0,0,.999825,.00500855,0,744791e-10,.999718,.00508559,0,712744e-9,.999565,.005194,0,.00215249,.999352,.00534147,0,.00444576,.999046,.00553523,0,.00759218,.998492,.00577016,0,.0115714,.995564,.00578487,0,.0163557,.993339,.00586414,0,.021915,.991834,.00606002,0,.0282201,.990496,.00633312,0,.0352433,.987826,.00651941,0,.042959,.98383,.00660842,0,.0513439,.98109,.00685523,0,.0603772,.976131,.00695778,0,.0700402,.971922,.00714236,0,.0803163,.965901,.00721437,0,.0911908,.959606,.00732017,0,.102651,.952504,.00735788,0,.114686,.944365,.00738493,0,.127286,.935652,.00737969,0,.140443,.925813,.00733612,0,.154151,.914397,.00723094,0,.168405,.903257,.00714002,0,.183201,.890015,.00700149,0,.198536,.876014,.00682813,0,.214409,.861436,.00665567,0,.23082,.845752,.00644526,0,.24777,.829169,.00621635,0,.265263,.813435,.00597789,0,.283301,.799701,.00575694,0,.301889,.785726,.00549866,0,.321035,.77152,.0052503,0,.340746,.75683,.00499619,0,.361032,.741951,.0047543,0,.381904,.726367,.0045084,0,.403374,.710537,.00426784,0,.425457,.693965,.00403487,0,.448169,.677724,.0038075,0,.47153,.66117,.00359431,0,.495561,.644274,.00338354,0,.520284,.627449,.00318163,0,.545725,.611645,.00299672,0,.571911,.595614,.00281016,0,.598873,.579426,.00264252,0,.62664,.563016,.00247509,0,.655239,.546728,.00232647,0,.684692,.530539,.00217803,0,.714999,.514164,.00204216,0,.746106,.498344,.00191403,0,.777778,.482957,.00179203,0,.809524,.467336,.00167695,0,.84127,.451994,.00157567,0,.873016,.436514,.00147113,0,.904762,.42178,.00138034,0,.936508,.407271,.00129219,0,.968254,.392822,.0012098,0,1,1,.00637427,0,0,1,.00637431,0,0,.999999,.00637485,0,0,.999996,.00637721,0,0,.999987,.00638357,0,0,.999971,.006397,0,0,.999939,.00642142,0,0,.999888,.00646177,0,0,.999807,.00652387,0,207916e-9,.999689,.00661454,0,.00112051,.99952,.00674155,0,.00287719,.999283,.00691313,0,.00550145,.998936,.00713598,0,.00897928,.998165,.00738501,0,.0132829,.994847,.00734388,0,.01838,.993182,.00749991,0,.0242381,.991665,.0077246,0,.030826,.989708,.00797579,0,.0381152,.986663,.00813011,0,.0460794,.983288,.00830365,0,.0546951,.980104,.00853496,0,.0639411,.974855,.00861045,0,.0737988,.97045,.00879133,0,.0842516,.964509,.00886377,0,.0952848,.957594,.00890346,0,.106886,.950546,.00893289,0,.119044,.942225,.00890074,0,.131749,.933365,.00886826,0,.144994,.923202,.0087316,0,.158772,.912605,.00863082,0,.173078,.901099,.00847403,0,.187908,.888177,.00825838,0,.203261,.873955,.00801834,0,.219134,.860091,.00779026,0,.235527,.84434,.00752478,0,.252443,.828517,.00724074,0,.269883,.81239,.00693769,0,.287851,.79721,.00664817,0,.306352,.783489,.00634763,0,.325393,.769514,.00604221,0,.344981,.755419,.00573568,0,.365126,.741083,.00544359,0,.385839,.726059,.00515515,0,.407132,.710809,.00487139,0,.42902,.695052,.00459846,0,.45152,.678886,.00433412,0,.474651,.663042,.00407981,0,.498433,.646634,.00384264,0,.52289,.630117,.00360897,0,.548048,.613804,.00338863,0,.573936,.598338,.00318486,0,.600584,.582687,.00298377,0,.628027,.566809,.00280082,0,.656295,.550817,.00262255,0,.685417,.534937,.00245835,0,.715406,.519151,.00230574,0,.74624,.503118,.0021549,0,.777778,.487723,.00202008,0,.809524,.472725,.00189355,0,.84127,.457599,.00177108,0,.873016,.442558,.00165843,0,.904762,.427624,.00155494,0,.936508,.413171,.00145273,0,.968254,.399122,.00136454,0,1,1,.00826496,0,0,1,.00826499,0,0,1,.00826564,0,0,.999996,.00826842,0,0,.999987,.00827589,0,0,.999967,.00829167,0,0,.999933,.00832037,0,0,.999876,.00836768,0,109338e-10,.999786,.00844031,0,427145e-9,.999655,.00854603,0,.0016384,.999468,.00869337,0,.00372392,.999203,.008891,0,.00668513,.998803,.00914387,0,.0104968,.99748,.00935838,0,.015125,.994446,.00933309,0,.0205338,.99292,.00953084,0,.0266884,.991414,.0097893,0,.0335565,.989049,.0100228,0,.0411086,.98582,.0101664,0,.0493181,.982441,.0103582,0,.0581613,.978595,.0105292,0,.0676169,.973495,.0106274,0,.0776661,.968405,.0107261,0,.0882926,.962717,.0108234,0,.0994817,.955478,.0108102,0,.111221,.948275,.0107914,0,.123499,.940006,.0107161,0,.136308,.930831,.0106309,0,.149639,.920648,.0104083,0,.163485,.910205,.0102312,0,.177843,.898445,.0100051,0,.192707,.885986,.00971928,0,.208077,.872204,.00940747,0,.22395,.858436,.0091085,0,.240326,.843454,.00876595,0,.257208,.827437,.00839794,0,.274596,.811488,.00803692,0,.292496,.796039,.00767352,0,.310911,.781083,.0073097,0,.329849,.767642,.00694032,0,.349316,.753901,.00657476,0,.369323,.740131,.00622699,0,.38988,.725845,.0058838,0,.410999,.710991,.00555586,0,.432696,.696002,.00523089,0,.454987,.680461,.00492494,0,.47789,.664875,.00463464,0,.501426,.649273,.00435422,0,.52562,.63302,.0040875,0,.550498,.61705,.00384075,0,.576089,.601154,.00359557,0,.602427,.586008,.00337636,0,.629544,.570699,.00316019,0,.657479,.555166,.00296033,0,.686264,.539645,.00277552,0,.715924,.524159,.00259499,0,.746459,.508682,.00243257,0,.777789,.493163,.00227851,0,.809524,.478004,.00213083,0,.84127,.46347,.00199502,0,.873016,.448778,.00186967,0,.904762,.434105,.00174732,0,.936508,.419576,.00163861,0,.968254,.405541,.00153341,0,1,1,.0106462,0,0,1,.0106462,0,0,.999999,.010647,0,0,.999995,.0106502,0,0,.999985,.0106589,0,0,.999964,.0106773,0,0,.999925,.0107106,0,0,.999861,.0107655,0,712986e-10,.999763,.0108497,0,743959e-9,.999616,.0109716,0,.00227361,.999408,.0111408,0,.0046983,.999112,.0113659,0,.00800158,.998637,.0116475,0,.0121493,.996223,.0117231,0,.0171023,.994006,.0118064,0,.0228218,.992444,.0120254,0,.0292711,.991028,.0123314,0,.036417,.98803,.0124954,0,.0442295,.984816,.0126538,0,.0526815,.981399,.0128537,0,.0617492,.977085,.0129694,0,.0714114,.972154,.013091,0,.0816495,.966617,.0131166,0,.0924472,.960628,.0131583,0,.10379,.953295,.0131094,0,.115665,.94575,.0129966,0,.128062,.937654,.0128796,0,.140972,.927716,.0126477,0,.154387,.917932,.0123889,0,.168301,.907719,.012131,0,.182709,.89584,.0118013,0,.197608,.883526,.0114145,0,.212994,.870301,.0110075,0,.228867,.856272,.0106019,0,.245227,.842251,.0101938,0,.262074,.826466,.00973254,0,.279412,.810859,.0092846,0,.297244,.795051,.00883304,0,.315575,.780053,.00840272,0,.334412,.76575,.00796438,0,.35376,.752298,.00752526,0,.373631,.739153,.00711486,0,.394034,.725514,.00670361,0,.414983,.711473,.00632656,0,.436491,.696936,.00595206,0,.458575,.682126,.00559191,0,.481253,.667027,.00525362,0,.504547,.651875,.00493805,0,.528481,.636463,.00462848,0,.553081,.620641,.00433936,0,.578377,.604931,.00407,0,.604404,.589549,.00380864,0,.631197,.574712,.00357049,0,.658795,.559775,.00334466,0,.687238,.544514,.00312505,0,.716559,.529555,.00293199,0,.746776,.514402,.00274204,0,.777849,.499302,.00256647,0,.809524,.484114,.00239901,0,.84127,.469308,.00225148,0,.873016,.455133,.00210178,0,.904762,.440939,.0019727,0,.936508,.426627,.00184382,0,.968254,.412509,.00172548,0,1,1,.013628,0,0,1,.0136281,0,0,.999999,.0136289,0,0,.999995,.0136327,0,0,.999983,.0136427,0,0,.99996,.0136638,0,0,.999917,.0137022,0,0,.999846,.0137652,0,204597e-9,.999736,.0138615,0,.00116837,.999573,.0140007,0,.00303325,.99934,.0141927,0,.00580613,.999004,.0144457,0,.00945626,.998407,.0147489,0,.0139421,.995464,.014731,0,.0192202,.993328,.0148283,0,.0252495,.991799,.0150797,0,.0319921,.990397,.0154316,0,.0394138,.986835,.0155005,0,.0474843,.983938,.0157308,0,.0561763,.980154,.0158753,0,.0654661,.975659,.0159581,0,.0753326,.970171,.0159832,0,.0857571,.964803,.0160084,0,.0967236,.958366,.0159484,0,.108218,.950613,.0158001,0,.120227,.942874,.0155845,0,.132741,.935005,.0154292,0,.145751,.924991,.0150742,0,.159249,.914814,.0146757,0,.17323,.904743,.0143097,0,.187687,.893216,.0138695,0,.202619,.880769,.0133706,0,.218021,.868136,.0128606,0,.233894,.85469,.0123403,0,.250238,.840593,.0118091,0,.267052,.825808,.011253,0,.284341,.81009,.0107099,0,.302106,.79504,.0101636,0,.320354,.779757,.00964041,0,.33909,.764697,.00911896,0,.358322,.750913,.00859533,0,.378059,.738175,.00811592,0,.398311,.725242,.00764504,0,.41909,.711864,.00718885,0,.440412,.698009,.00675843,0,.462292,.683841,.00634984,0,.484748,.669391,.00595502,0,.507802,.654731,.00558671,0,.531477,.639805,.00523578,0,.555802,.624789,.00490834,0,.580805,.609325,.00459448,0,.606522,.593975,.00430342,0,.63299,.578983,.00403019,0,.66025,.564442,.0037707,0,.688346,.549835,.0035316,0,.717319,.535039,.00330255,0,.7472,.520403,.00308932,0,.777982,.505687,.00289335,0,.809524,.490939,.00270818,0,.84127,.476233,.0025343,0,.873016,.461624,.00237097,0,.904762,.447833,.00222065,0,.936508,.433992,.00207561,0,.968254,.420147,.00194955,0,1,1,.0173415,0,0,1,.0173416,0,0,.999999,.0173426,0,0,.999995,.0173468,0,0,.999983,.0173582,0,0,.999954,.0173822,0,0,.999908,.0174258,0,669501e-11,.999828,.0174973,0,427399e-9,.999705,.0176063,0,.00171019,.999524,.0177631,0,.0039248,.999263,.0179781,0,.00705382,.998878,.018258,0,.0110552,.998012,.0185551,0,.0158812,.994614,.0184264,0,.0214852,.993132,.0186385,0,.0278239,.991563,.0189067,0,.0348585,.989298,.0191577,0,.0425544,.986036,.0192522,0,.050881,.982558,.0194063,0,.059811,.978531,.019486,0,.0693209,.974198,.0195847,0,.0793895,.968148,.0194749,0,.0899984,.962565,.0194277,0,.101132,.956041,.0192991,0,.112775,.947749,.0189893,0,.124917,.94018,.018704,0,.137547,.93165,.0183458,0,.150655,.921798,.0178775,0,.164236,.911573,.0173618,0,.178281,.901569,.0168482,0,.192788,.890341,.016265,0,.207752,.877835,.0156199,0,.223171,.865472,.0149516,0,.239044,.852905,.0143274,0,.255371,.838906,.0136643,0,.272153,.824888,.0129903,0,.289393,.809977,.0123218,0,.307093,.794697,.0116572,0,.325259,.780028,.0110307,0,.343896,.765124,.0104236,0,.363012,.750411,.0098219,0,.382617,.737264,.00924397,0,.402719,.724799,.00868719,0,.423332,.712253,.00816476,0,.444469,.699267,.00767262,0,.466146,.685618,.00719746,0,.488383,.671736,.00673916,0,.511199,.657777,.00631937,0,.534618,.643497,.00592411,0,.558668,.62889,.00553928,0,.58338,.614299,.0051934,0,.608787,.599197,.00485985,0,.634929,.584175,.00454357,0,.661849,.569541,.00425787,0,.689594,.555193,.00397905,0,.718211,.540947,.00372364,0,.747742,.526593,.00348599,0,.778205,.512335,.00326103,0,.80953,.498017,.00305137,0,.84127,.483609,.00285485,0,.873016,.469368,.00267472,0,.904762,.455037,.00249945,0,.936508,.441493,.00234792,0,.968254,.428147,.00219936,0,1,1,.0219422,0,0,1,.0219423,0,0,.999998,.0219434,0,0,.999993,.0219481,0,0,.999981,.021961,0,0,.999949,.0219879,0,0,.999896,.0220367,0,593194e-10,.999808,.0221167,0,75364e-8,.99967,.0222383,0,.00237884,.999466,.0224125,0,.00495612,.999174,.0226495,0,.00844887,.998725,.0229525,0,.0128058,.996979,.0231123,0,.0179742,.994317,.0230742,0,.0239047,.992781,.0232895,0,.0305526,.991191,.0235734,0,.0378786,.987787,.0236152,0,.0458475,.985092,.0237994,0,.0544287,.981121,.0238553,0,.0635952,.976924,.0238706,0,.0733233,.97218,.0238704,0,.0835922,.965956,.0236598,0,.0943839,.959998,.0234735,0,.105682,.953245,.0232277,0,.117474,.944445,.0226973,0,.129747,.937087,.0223527,0,.142491,.928341,.0218144,0,.155697,.9184,.0211516,0,.169358,.907959,.0204553,0,.183469,.89808,.0197673,0,.198024,.887047,.0189915,0,.21302,.875221,.0182082,0,.228455,.86269,.0173584,0,.244329,.850735,.0165718,0,.260639,.837545,.0157524,0,.277389,.823639,.0149482,0,.29458,.809699,.0141431,0,.312216,.794797,.0133527,0,.3303,.780578,.0126193,0,.34884,.766019,.0118914,0,.367842,.751447,.0111839,0,.387315,.737275,.010514,0,.40727,.724545,.00987277,0,.427717,.712644,.00926569,0,.448671,.700432,.00869029,0,.470149,.687664,.00814691,0,.492167,.674288,.00763012,0,.514746,.660966,.00714437,0,.537911,.647264,.00668457,0,.561688,.633431,.00626581,0,.586108,.619133,.00585593,0,.611206,.604935,.00548188,0,.637022,.590236,.00513288,0,.663599,.575473,.0047906,0,.690989,.561228,.00448895,0,.719242,.547054,.00420233,0,.748411,.533175,.00392869,0,.778531,.519163,.00367445,0,.809583,.505328,.00344097,0,.84127,.491446,.00322003,0,.873016,.477356,.00301283,0,.904762,.46356,.00282592,0,.936508,.449623,.00264956,0,.968254,.436068,.00246956,0,1,1,.0276135,0,0,1,.0276136,0,0,.999998,.0276148,0,0,.999993,.0276201,0,0,.999976,.0276342,0,0,.999945,.027664,0,0,.999884,.0277179,0,18679e-8,.999784,.027806,0,.00119607,.99963,.0279394,0,.00318407,.999401,.0281295,0,.00613601,.999066,.0283858,0,.00999963,.998524,.0287027,0,.0147164,.995702,.0286256,0,.0202295,.993593,.0286733,0,.0264876,.992067,.0288989,0,.0334452,.990548,.0292135,0,.0410621,.986775,.0291296,0,.0493032,.984054,.0293099,0,.0581381,.979481,.0291881,0,.0675397,.975297,.0291598,0,.0774848,.96981,.028954,0,.0879528,.963524,.028628,0,.0989258,.957398,.0283135,0,.110388,.950088,.0278469,0,.122327,.941538,.0271798,0,.134729,.933332,.0265388,0,.147587,.924392,.0257776,0,.160889,.914581,.024916,0,.174631,.904347,.0240242,0,.188806,.894324,.0231229,0,.203409,.883724,.022153,0,.218437,.872207,.0211355,0,.233888,.859927,.0201048,0,.249761,.848373,.0191263,0,.266056,.836023,.0181306,0,.282774,.82289,.0171718,0,.299917,.809324,.0162196,0,.317488,.795361,.0152622,0,.335493,.781253,.01439,0,.353936,.767338,.013533,0,.372825,.753156,.0127244,0,.392168,.739122,.0119454,0,.411976,.725358,.0112054,0,.432259,.712949,.010487,0,.453032,.701621,.00984032,0,.47431,.689703,.00921495,0,.496111,.677216,.00862492,0,.518456,.664217,.00806882,0,.541367,.65137,.00755922,0,.564872,.638,.00705705,0,.589001,.62453,.00661266,0,.613789,.610601,.00618432,0,.639277,.59676,.00578033,0,.66551,.582433,.00540927,0,.692539,.568026,.00506104,0,.720422,.55414,.0047353,0,.749216,.540178,.00442889,0,.778974,.526513,.00414363,0,.809711,.512954,.00388237,0,.84127,.499403,.00362875,0,.873016,.486026,.00340827,0,.904762,.472345,.00318598,0,.936508,.458828,.00297635,0,.968254,.445379,.00279447,0,1,1,.0345716,0,0,1,.0345717,0,0,.999999,.034573,0,0,.999991,.0345787,0,0,.999974,.0345941,0,0,.999937,.0346263,0,188589e-11,.999869,.0346847,0,409238e-9,.999757,.0347798,0,.0017674,.999582,.0349233,0,.00413658,.999322,.0351265,0,.00747408,.998939,.0353967,0,.0117157,.998219,.0357018,0,.0167966,.994974,.0354726,0,.0226572,.993201,.0355621,0,.0292445,.991573,.0357641,0,.0365123,.989301,.0359252,0,.0444203,.985712,.0358017,0,.0529334,.982411,.0358353,0,.0620214,.977827,.035617,0,.0716574,.973278,.0354398,0,.0818186,.967397,.0350483,0,.0924846,.960696,.0344795,0,.103638,.954349,.0339861,0,.115263,.946066,.0331323,0,.127348,.938012,.032359,0,.13988,.929413,.0314413,0,.152849,.920355,.0304103,0,.166248,.910586,.0292785,0,.18007,.900609,.0281391,0,.194308,.890093,.0269103,0,.208958,.880013,.0257269,0,.224018,.869001,.0244671,0,.239485,.85751,.0232252,0,.255359,.84582,.0220117,0,.271638,.834383,.0208274,0,.288324,.822158,.0196628,0,.305419,.809056,.0185306,0,.322927,.795832,.0174174,0,.340851,.782547,.0163758,0,.359199,.7689,.015391,0,.377975,.755526,.0144488,0,.397189,.741681,.0135372,0,.416851,.728178,.0126957,0,.436971,.714642,.0118812,0,.457564,.702756,.0111165,0,.478644,.69175,.0104145,0,.500229,.680159,.00974439,0,.522339,.668073,.00911926,0,.544997,.655405,.00851393,0,.56823,.642921,.00797637,0,.592068,.629993,.00745119,0,.616546,.616828,.00696972,0,.641705,.603305,.00652425,0,.66759,.589833,.00610188,0,.694255,.575945,.00570834,0,.72176,.561745,.00533384,0,.750168,.548277,.00500001,0,.779545,.534467,.00467582,0,.809933,.521032,.00438092,0,.841272,.507877,.00410348,0,.873016,.494654,.00383618,0,.904762,.481592,.00358699,0,.936508,.468509,.00337281,0,.968254,.455293,.00316196,0,1,1,.0430698,0,0,1,.0430699,0,0,.999998,.0430713,0,0,.999991,.0430773,0,0,.99997,.0430936,0,0,.999928,.0431277,0,406396e-10,.999852,.0431893,0,744376e-9,.999724,.0432895,0,.0024806,.999527,.0434397,0,.00524779,.99923,.0436507,0,.00898164,.998783,.0439255,0,.0136083,.997507,.0441104,0,.0190582,.994418,.0438225,0,.0252694,.992864,.0439396,0,.0321879,.991127,.0440962,0,.039767,.987331,.0438408,0,.0479667,.984819,.0438991,0,.056752,.980384,.0435906,0,.0660929,.975846,.0432543,0,.075963,.970748,.0428293,0,.0863398,.964303,.042153,0,.0972035,.95772,.0414111,0,.108537,.950747,.0405893,0,.120325,.942533,.0394887,0,.132554,.934045,.0383544,0,.145215,.924942,.037057,0,.158296,.915811,.0356993,0,.17179,.90612,.0342401,0,.185691,.896434,.0328078,0,.199993,.886021,.031288,0,.214691,.876081,.0297776,0,.229782,.865608,.0282334,0,.245265,.854924,.026749,0,.261138,.843607,.02526,0,.277401,.832456,.0238214,0,.294056,.821342,.0224682,0,.311104,.809303,.0211297,0,.328548,.796468,.0198387,0,.346394,.784046,.0186227,0,.364645,.771262,.0174561,0,.38331,.758118,.0163806,0,.402396,.745075,.0153287,0,.421912,.731926,.0143647,0,.44187,.71863,.0134363,0,.462283,.705414,.0125603,0,.483165,.693792,.0117508,0,.504535,.683108,.0110016,0,.52641,.67183,.0102757,0,.548816,.66015,.00962044,0,.571776,.647907,.00898031,0,.595323,.635734,.00840811,0,.619489,.623208,.00786211,0,.644317,.610438,.00734953,0,.669852,.597345,.00687688,0,.696148,.584138,.00643469,0,.723267,.5707,.00602236,0,.75128,.556966,.0056324,0,.780258,.543607,.00528277,0,.810268,.530213,.00493999,0,.841311,.516912,.00462265,0,.873016,.503916,.0043307,0,.904762,.491146,.00406858,0,.936508,.478439,.00381436,0,.968254,.465834,.00358003,0,1,1,.0534039,0,0,1,.053404,0,0,.999998,.0534055,0,0,.999989,.0534116,0,0,.999968,.0534283,0,0,.999918,.0534633,0,155895e-9,.99983,.0535262,0,.00120914,.999685,.0536281,0,.00334944,.999461,.0537799,0,.00653077,.999119,.0539902,0,.0106718,.998582,.0542524,0,.0156907,.995919,.0540318,0,.0215147,.993735,.0538914,0,.0280801,.992126,.0539557,0,.0353323,.990266,.0540401,0,.0432247,.986317,.0536064,0,.0517172,.983213,.0534425,0,.0607754,.978303,.0528622,0,.0703698,.973665,.0523363,0,.0804742,.968091,.0516165,0,.0910667,.961026,.0505434,0,.102128,.954333,.049523,0,.113641,.946372,.0481698,0,.125591,.938254,.0467674,0,.137965,.929516,.0452341,0,.150754,.920106,.0435083,0,.163947,.910899,.0417399,0,.177537,.901532,.0399389,0,.191516,.891919,.0380901,0,.205881,.882006,.0362341,0,.220626,.871965,.0343444,0,.235749,.862145,.0324832,0,.251248,.852058,.0306681,0,.267121,.84161,.0289097,0,.283368,.830806,.0272079,0,.299992,.820476,.0256089,0,.316992,.809514,.0240394,0,.334374,.797865,.0225379,0,.35214,.785621,.0211235,0,.370296,.773765,.0197908,0,.388849,.761629,.0185235,0,.407807,.748891,.0173358,0,.427178,.736437,.0162305,0,.446974,.723707,.0151778,0,.467207,.710606,.0141791,0,.487892,.698019,.0132592,0,.509046,.686203,.0123887,0,.530687,.675692,.0115976,0,.552839,.664826,.0108325,0,.575527,.65349,.0101348,0,.59878,.641774,.00947756,0,.622634,.629794,.00886058,0,.647128,.617647,.00828526,0,.672308,.60534,.00775312,0,.698231,.592718,.00726033,0,.724958,.579746,.00679731,0,.752563,.566763,.00636111,0,.781127,.553515,.00595228,0,.810733,.540118,.00556876,0,.841426,.527325,.00523051,0,.873016,.514265,.00490712,0,.904762,.501406,.00460297,0,.936508,.488922,.00431247,0,.968254,.476541,.0040472,0,1,1,.0659184,0,0,1,.0659185,0,0,.999998,.06592,0,0,.999988,.0659259,0,0,.999963,.0659423,0,0,.999907,.0659764,0,374198e-9,.999806,.0660376,0,.00182071,.999639,.0661361,0,.0043894,.999378,.0662814,0,.00800055,.998985,.0664779,0,.0125594,.998285,.0666914,0,.0179786,.995071,.0661989,0,.0241822,.993172,.0660454,0,.031106,.991438,.0660105,0,.0386952,.988428,.0656875,0,.0469032,.985218,.0652913,0,.0556905,.981128,.0647107,0,.065023,.976015,.0638491,0,.0748717,.97097,.062993,0,.0852112,.964582,.0617927,0,.0960199,.957383,.0603626,0,.107279,.949969,.0588128,0,.118971,.941843,.0570274,0,.131084,.933624,.0551885,0,.143604,.924543,.053122,0,.156521,.914919,.0508897,0,.169825,.905773,.0486418,0,.18351,.896434,.0463364,0,.197569,.887195,.0440623,0,.211997,.877706,.0417799,0,.226789,.867719,.03945,0,.241944,.858587,.037243,0,.257458,.849317,.0350956,0,.273331,.839585,.0329852,0,.289563,.829856,.0310028,0,.306154,.819589,.0290953,0,.323108,.809714,.0272738,0,.340426,.79934,.0255631,0,.358113,.788224,.0239175,0,.376175,.776619,.0223831,0,.394616,.76521,.0209298,0,.413445,.753716,.0195786,0,.432671,.741564,.0183001,0,.452305,.729413,.0171259,0,.472358,.717146,.0159933,0,.492845,.70436,.0149495,0,.513783,.69219,.0139681,0,.535189,.680289,.0130577,0,.557087,.669611,.0122198,0,.5795,.659113,.0114174,0,.602459,.648148,.0106729,0,.625997,.636905,.00998997,0,.650154,.625154,.00934313,0,.674976,.613481,.00874839,0,.700518,.60154,.00818265,0,.726845,.58943,.00766889,0,.754032,.576828,.00717153,0,.782167,.564194,.00672696,0,.811344,.551501,.00630863,0,.841644,.538635,.00592177,0,.873016,.525724,.00554888,0,.904762,.513209,.00520225,0,.936508,.500457,.00488231,0,.968254,.48799,.00457153,0,1,1,.0810131,0,0,1,.0810133,0,0,.999997,.0810145,0,0,.999985,.08102,0,0,.999956,.0810347,0,195026e-10,.999893,.0810656,0,719316e-9,.999777,.0811205,0,.00259774,.999583,.081208,0,.00561807,.999281,.0813343,0,.00967472,.998813,.0814969,0,.0146627,.997597,.0815217,0,.0204902,.994379,.0808502,0,.0270802,.992744,.0806792,0,.0343674,.990745,.0804589,0,.0422974,.986646,.0796107,0,.0508242,.983611,.0790913,0,.0599087,.978869,.0780746,0,.0695175,.973475,.0768218,0,.0796223,.967845,.0754926,0,.0901983,.960778,.0737063,0,.101224,.953333,.0718052,0,.112682,.945274,.0695946,0,.124555,.936955,.0672492,0,.136831,.928319,.0647732,0,.149496,.919075,.0620947,0,.162542,.909114,.0591816,0,.175958,.900137,.0563917,0,.189739,.891069,.0535392,0,.203877,.882262,.0507642,0,.218368,.873232,.0479793,0,.233208,.864042,.045226,0,.248393,.855002,.0425413,0,.263923,.846569,.0400126,0,.279796,.837714,.0375269,0,.296012,.828918,.0352027,0,.312573,.819783,.0330011,0,.329479,.810129,.0308908,0,.346734,.800866,.0289112,0,.364342,.79093,.0270255,0,.382307,.780593,.0252758,0,.400637,.769511,.0236178,0,.419337,.758558,.0220652,0,.438418,.747632,.0206289,0,.457889,.736146,.0192873,0,.477761,.724093,.0180333,0,.49805,.71234,.0168264,0,.51877,.700201,.015746,0,.53994,.687949,.0147027,0,.561581,.676163,.0137512,0,.583718,.665001,.0128655,0,.60638,.65472,.0120366,0,.629599,.644213,.0112604,0,.653415,.633382,.0105413,0,.677874,.62212,.00986498,0,.70303,.610631,.00923308,0,.728948,.599078,.00864206,0,.755706,.587519,.00811784,0,.783396,.575505,.00761237,0,.812121,.563148,.00713949,0,.841989,.550828,.00668379,0,.873035,.538458,.00627715,0,.904762,.525905,.00588336,0,.936508,.513517,.00552687,0,.968254,.501395,.00519681,0,1,1,.0991506,0,0,1,.0991504,0,0,.999996,.0991515,0,0,.999984,.0991558,0,0,.999947,.0991672,0,114389e-9,.999874,.0991912,0,.00121503,.999739,.0992331,0,.00356108,.999514,.0992983,0,.00705578,.999159,.0993877,0,.011574,.998586,.0994837,0,.017003,.995731,.0988425,0,.0232484,.993384,.098276,0,.0302318,.991615,.0979269,0,.0378884,.989029,.0973432,0,.0461641,.985373,.0963539,0,.0550136,.981278,.0952306,0,.0643988,.975777,.0936233,0,.0742868,.970526,.0920219,0,.0846501,.963755,.0898912,0,.0954644,.956676,.0876064,0,.106709,.948099,.0847751,0,.118367,.939718,.0818638,0,.130423,.931305,.078857,0,.142862,.922342,.0756127,0,.155674,.912842,.0721473,0,.168849,.903304,.0686195,0,.182378,.89411,.0650589,0,.196255,.885512,.0616022,0,.210473,.877193,.0582434,0,.225027,.86877,.0548979,0,.239915,.860267,.0516095,0,.255132,.851915,.048468,0,.270678,.843912,.0454447,0,.286551,.83604,.0425612,0,.302751,.828245,.0398752,0,.31928,.820159,.0373198,0,.336138,.81167,.034916,0,.35333,.802659,.0326402,0,.370858,.793921,.0304901,0,.388728,.784713,.0284857,0,.406944,.774946,.0266186,0,.425515,.76448,.0248593,0,.444449,.753793,.0232114,0,.463756,.743506,.0217039,0,.483447,.732555,.0202841,0,.503535,.720965,.0189648,0,.524036,.709422,.0177189,0,.544968,.697756,.0165626,0,.56635,.685565,.015483,0,.588208,.673987,.0144892,0,.610569,.66244,.0135607,0,.633466,.651675,.0126956,0,.656936,.641598,.0118788,0,.681025,.63121,.0111261,0,.705788,.620514,.010437,0,.731289,.609366,.00978747,0,.757606,.598137,.00917257,0,.784834,.586966,.00859778,0,.813085,.575549,.00806803,0,.842485,.563797,.00757294,0,.87313,.551758,.00710592,0,.904762,.539894,.0066841,0,.936508,.527901,.00627901,0,.968254,.515819,.00590506,0,1,1,.120864,0,0,1,.120864,0,0,.999996,.120864,0,0,.99998,.120867,0,0,.99994,.120872,0,323781e-9,.999852,.120884,0,.00188693,.999693,.120903,0,.00473489,.999426,.120929,0,.00872704,.999002,.120955,0,.0137237,.998235,.120918,0,.0196068,.994608,.119764,0,.0262803,.992997,.119265,0,.0336657,.990968,.11863,0,.0416987,.987002,.117261,0,.0503261,.983524,.116009,0,.0595035,.97875,.114252,0,.0691935,.972652,.11193,0,.0793645,.966613,.109555,0,.0899894,.959275,.106612,0,.101045,.951272,.103375,0,.112512,.942323,.0996594,0,.124372,.933679,.0958841,0,.136611,.924822,.0919265,0,.149216,.915742,.0878061,0,.162176,.906348,.0834894,0,.175482,.896883,.079085,0,.189125,.88774,.0746745,0,.203098,.87986,.0705773,0,.217396,.871998,.0665005,0,.232015,.864325,.0625413,0,.24695,.856685,.0586781,0,.2622,.84925,.0550063,0,.277761,.841719,.0514727,0,.293634,.834755,.0481398,0,.309819,.827853,.0450172,0,.326315,.820888,.0420969,0,.343126,.813616,.0393702,0,.360254,.805767,.0367771,0,.377701,.797338,.0343274,0,.395474,.789122,.0320529,0,.413577,.780601,.0299485,0,.432018,.771424,.0279812,0,.450804,.761502,.0261054,0,.469944,.751166,.0243942,0,.489451,.741276,.0228087,0,.509337,.730898,.0213265,0,.529617,.719878,.0199307,0,.550307,.708379,.0186574,0,.571428,.697165,.0174446,0,.593003,.685554,.0163144,0,.615059,.673631,.015276,0,.637628,.662385,.0143003,0,.660746,.651059,.0134112,0,.68446,.640451,.0125794,0,.70882,.630536,.011793,0,.733893,.620316,.0110547,0,.759756,.609722,.0103668,0,.786505,.598804,.00973009,0,.814259,.587871,.00912812,0,.843157,.577121,.00858916,0,.87334,.566019,.00807333,0,.904762,.554664,.00759687,0,.936508,.543101,.00714759,0,.968254,.531558,.00673418,0,1,1,.146767,0,0,1,.146767,0,0,.999997,.146767,0,0,.999977,.146765,0,320658e-11,.999929,.146762,0,682576e-9,.999823,.146753,0,.00276402,.999633,.146735,0,.00614771,.999314,.146699,0,.0106613,.998796,.14662,0,.0161546,.997124,.146107,0,.0225063,.994062,.144857,0,.0296198,.992154,.144011,0,.037417,.989186,.142712,0,.0458348,.985279,.140926,0,.0548211,.980826,.13885,0,.0643326,.975056,.136168,0,.074333,.969005,.133217,0,.0847917,.961554,.12959,0,.0956828,.954206,.125886,0,.106984,.945046,.121335,0,.118675,.935678,.116492,0,.130741,.926748,.111635,0,.143166,.917764,.106625,0,.155939,.908358,.101325,0,.169049,.899219,.0960249,0,.182487,.890089,.0906527,0,.196245,.881488,.0853905,0,.210317,.874031,.0804177,0,.224697,.866932,.0756005,0,.23938,.859976,.0709019,0,.254364,.853375,.0664391,0,.269646,.846971,.0622012,0,.285223,.840483,.058129,0,.301096,.833969,.0542762,0,.317265,.82806,.0507042,0,.333729,.822128,.047368,0,.350491,.815989,.044272,0,.367554,.809336,.0413444,0,.38492,.802177,.038601,0,.402594,.79441,.0360227,0,.420582,.786573,.0336383,0,.438891,.778619,.0314321,0,.457527,.77,.029362,0,.476499,.760698,.0274102,0,.49582,.750932,.0256146,0,.5155,.740993,.023974,0,.535555,.731159,.0224182,0,.556,.720836,.0209889,0,.576855,.709913,.0196411,0,.598143,.698415,.0183824,0,.619888,.68745,.0172222,0,.642123,.676154,.0161509,0,.664883,.664383,.0151397,0,.688211,.6533,.0141873,0,.71216,.642072,.0133105,0,.736792,.631412,.0124932,0,.762186,.621622,.0117408,0,.788439,.611681,.0110358,0,.815672,.60142,.0103775,0,.844034,.59083,.00975623,0,.873699,.580254,.00918084,0,.904765,.569841,.00864721,0,.936508,.559224,.00815731,0,.968254,.548315,.00767924,0,1,1,.177563,0,0,1,.177563,0,0,.999994,.177562,0,0,.999972,.177555,0,664171e-10,.999914,.177536,0,.0012276,.999787,.177496,0,.00388025,.999556,.17742,0,.00783463,.999165,.177285,0,.0128953,.9985,.177037,0,.0189053,.995388,.175634,0,.025742,.993102,.174375,0,.033309,.990992,.173121,0,.0415298,.986932,.170896,0,.0503425,.982786,.16847,0,.0596964,.977592,.165455,0,.0695498,.971075,.161676,0,.0798676,.963967,.157458,0,.0906201,.956397,.152836,0,.101783,.947489,.147467,0,.113333,.937564,.14145,0,.125254,.928182,.135383,0,.137529,.919027,.129212,0,.150144,.909618,.12276,0,.163088,.900492,.116273,0,.176351,.891671,.1098,0,.189924,.883146,.103362,0,.203799,.875151,.0970799,0,.21797,.868338,.0911732,0,.232433,.862033,.0854966,0,.247182,.856107,.0800691,0,.262216,.850644,.0749618,0,.27753,.845261,.070079,0,.293124,.839885,.0654321,0,.308997,.834609,.0610975,0,.325149,.829083,.0569741,0,.341581,.82404,.0531736,0,.358294,.818968,.049665,0,.37529,.813496,.0463856,0,.392573,.807533,.0433217,0,.410148,.80099,.0404402,0,.428019,.793891,.0377578,0,.446192,.786281,.0352616,0,.464676,.778773,.0329577,0,.483478,.770737,.030808,0,.502608,.762094,.0287964,0,.522079,.752898,.0269254,0,.541905,.743306,.0251926,0,.5621,.733416,.023595,0,.582684,.723742,.0221155,0,.603677,.713542,.0207435,0,.625106,.702755,.019434,0,.646998,.691484,.0182046,0,.66939,.680531,.0170771,0,.692324,.66953,.0160339,0,.715849,.658126,.0150677,0,.740028,.646933,.0141551,0,.764937,.636107,.0133179,0,.790673,.625271,.0125284,0,.817358,.615225,.0117937,0,.84515,.605678,.0111181,0,.874244,.59583,.0104759,0,.904828,.585704,.00986672,0,.936508,.575413,.00929712,0,.968254,.565373,.00876713,0,1,1,.214058,0,0,.999999,.214058,0,0,.999994,.214055,0,0,.999966,.214039,0,259642e-9,.999893,.213998,0,.00200075,.999737,.21391,0,.00527775,.999449,.213745,0,.00983959,.99896,.213458,0,.0154755,.9979,.212855,0,.0220249,.994278,.210779,0,.0293654,.992254,.20926,0,.0374021,.98881,.206908,0,.0460604,.984715,.204009,0,.0552802,.979738,.200471,0,.0650127,.972884,.195813,0,.0752175,.965996,.190856,0,.0858612,.957974,.185077,0,.0969155,.949155,.17868,0,.108356,.939288,.171513,0,.120163,.928996,.163838,0,.132319,.919563,.156246,0,.144808,.910004,.148359,0,.157618,.900791,.140417,0,.170737,.892135,.132569,0,.184155,.883803,.124741,0,.197866,.876034,.117091,0,.211861,.869219,.109835,0,.226134,.863062,.102859,0,.240682,.857795,.0962928,0,.255499,.853009,.0900725,0,.270583,.848603,.0842101,0,.285931,.844335,.0786527,0,.301542,.840208,.0734397,0,.317415,.836035,.0685334,0,.33355,.83172,.0639275,0,.349948,.827135,.0595909,0,.36661,.822797,.0556204,0,.383539,.818387,.0519394,0,.400738,.813565,.0485317,0,.41821,.808142,.0453138,0,.435961,.802212,.0423354,0,.453997,.79573,.0395553,0,.472324,.788741,.036988,0,.490951,.781093,.0345688,0,.509887,.773597,.0323297,0,.529144,.765622,.0302719,0,.548735,.757083,.0283477,0,.568674,.747992,.0265562,0,.588979,.738591,.0248844,0,.609671,.728719,.0233342,0,.630773,.719146,.0219081,0,.652314,.709165,.0205711,0,.674328,.69875,.0193248,0,.696854,.687884,.0181582,0,.719942,.676818,.0170746,0,.743651,.666247,.0160718,0,.768057,.655284,.0151262,0,.793253,.64401,.0142561,0,.819363,.633353,.0134327,0,.846547,.622674,.012653,0,.875017,.612265,.0119354,0,.905021,.602455,.0112533,0,.936508,.593147,.0106234,0,.968254,.583592,.0100213,0,1,1,.25717,0,0,1,.25717,0,0,.999992,.257164,0,0,.999958,.257135,0,641715e-9,.999864,.25706,0,.00305314,.999666,.256897,0,.00700975,.999302,.256596,0,.0122194,.998663,.25607,0,.0184622,.995607,.254123,0,.0255773,.993094,.252081,0,.0334439,.9907,.249867,0,.0419696,.98594,.246118,0,.0510823,.981214,.242049,0,.0607242,.974966,.236869,0,.0708486,.967589,.230724,0,.081417,.95915,.223635,0,.0923974,.950257,.21596,0,.103763,.940165,.207296,0,.115491,.929396,.197901,0,.127562,.919288,.188437,0,.13996,.909428,.178762,0,.15267,.900105,.169072,0,.165679,.891418,.159478,0,.178979,.883347,.15002,0,.192558,.875992,.140813,0,.20641,.869466,.13196,0,.220529,.863699,.123501,0,.234907,.858553,.115436,0,.249542,.854379,.107901,0,.264428,.850894,.10088,0,.279564,.847632,.0942296,0,.294947,.844571,.0879861,0,.310575,.84163,.0821534,0,.326448,.838542,.0766409,0,.342566,.835412,.0715322,0,.358929,.831899,.0666883,0,.37554,.828177,.0622175,0,.392399,.82416,.0580452,0,.409511,.820393,.054267,0,.426878,.816068,.0507172,0,.444506,.811201,.0474041,0,.4624,.805785,.0443174,0,.480566,.799878,.0414562,0,.499013,.793469,.0388147,0,.517749,.786473,.0363453,0,.536785,.778874,.0340225,0,.556134,.771277,.0318599,0,.575809,.763426,.0298859,0,.595827,.755044,.0280357,0,.616207,.746161,.0262979,0,.636973,.737124,.0247295,0,.65815,.72761,.0232514,0,.679772,.717822,.0218755,0,.701876,.708279,.0205942,0,.724509,.698333,.0193947,0,.74773,.68802,.0182717,0,.771609,.677321,.0172044,0,.79624,.666504,.0162122,0,.821743,.656184,.0152924,0,.84828,.64556,.0144326,0,.876069,.634636,.0136157,0,.905404,.624124,.0128612,0,.936508,.613914,.0121435,0,.968254,.603589,.0114887,0,1,1,.307946,0,0,.999999,.307945,0,0,.999988,.307934,0,204479e-10,.999944,.307886,0,.00127833,.999824,.307756,0,.00445047,.999565,.30748,0,.00914673,.999085,.306966,0,.0150498,.998103,.306004,0,.0219367,.994249,.303028,0,.0296485,.991807,.300435,0,.038068,.987773,.296554,0,.0471062,.982673,.2916,0,.0566942,.976623,.285641,0,.0667768,.968757,.27815,0,.0773099,.959849,.269529,0,.088257,.950663,.260248,0,.0995879,.940129,.249704,0,.111277,.92895,.238291,0,.123304,.917996,.226501,0,.13565,.907813,.214669,0,.148299,.898305,.202835,0,.161237,.889626,.191158,0,.174455,.88175,.179695,0,.187941,.874715,.168548,0,.201687,.868746,.15792,0,.215687,.863703,.147807,0,.229933,.859315,.138149,0,.24442,.855538,.128993,0,.259145,.852428,.120414,0,.274103,.850168,.112498,0,.289293,.848132,.105054,0,.304711,.846291,.0981087,0,.320357,.844431,.0915942,0,.33623,.842493,.0855056,0,.35233,.840368,.0798204,0,.368658,.83798,.0745097,0,.385214,.83523,.0695424,0,.402002,.832091,.0649092,0,.419023,.828667,.0606291,0,.436282,.824805,.0566523,0,.453782,.820988,.0530229,0,.471529,.816635,.0496364,0,.489528,.811725,.0464658,0,.507788,.806316,.0435082,0,.526317,.800469,.0407873,0,.545124,.794107,.038255,0,.564221,.787218,.0358825,0,.583621,.779872,.0336785,0,.603341,.772097,.0316379,0,.623397,.764484,.0297379,0,.643812,.756428,.0279581,0,.664611,.748022,.0263153,0,.685824,.739268,.0247799,0,.707488,.73024,.0233385,0,.729646,.720893,.0220035,0,.752354,.71119,.0207555,0,.77568,.701791,.0195843,0,.799715,.692184,.0184891,0,.824574,.682258,.0174541,0,.850417,.67206,.0164873,0,.877466,.661717,.0155959,0,.90604,.651462,.0147519,0,.936528,.641467,.0139727,0,.968254,.631229,.0132363,0,1,1,.367573,0,0,.999999,.367571,0,0,.999984,.367553,0,183382e-9,.999925,.367473,0,.00225254,.999759,.367259,0,.00628165,.99941,.366801,0,.0117858,.998739,.365946,0,.0184359,.995529,.363191,0,.0260114,.992875,.360171,0,.0343581,.989135,.355981,0,.0433637,.984166,.350401,0,.0529438,.977871,.343348,0,.0630334,.96951,.334341,0,.0735805,.959964,.323862,0,.0845437,.950162,.312521,0,.095889,.938882,.299577,0,.107588,.926992,.285573,0,.119617,.915589,.271212,0,.131957,.904791,.256611,0,.144591,.895177,.242224,0,.157503,.886403,.227952,0,.170682,.878957,.214192,0,.184117,.872418,.200795,0,.197799,.867029,.188015,0,.21172,.862835,.175975,0,.225873,.859411,.164526,0,.240253,.856655,.153693,0,.254854,.854519,.14352,0,.269673,.852828,.13397,0,.284707,.851412,.124984,0,.299953,.850609,.116748,0,.315408,.849855,.10905,0,.331073,.849017,.101839,0,.346946,.848079,.0951359,0,.363028,.846911,.0888774,0,.379318,.845445,.0830375,0,.395818,.84362,.0775844,0,.41253,.841411,.0725054,0,.429457,.838768,.0677691,0,.446602,.835801,.0634016,0,.463968,.832341,.0593095,0,.481561,.828424,.0555121,0,.499386,.824312,.052024,0,.51745,.819918,.0487865,0,.535761,.815072,.0457801,0,.554328,.809863,.0430184,0,.573162,.804164,.0404245,0,.592275,.798034,.0380146,0,.611681,.791436,.0357436,0,.631398,.784498,.0336475,0,.651445,.777125,.0316666,0,.671845,.769365,.0298122,0,.692628,.761579,.0281001,0,.713827,.753746,.0265049,0,.735484,.745573,.0250067,0,.75765,.737083,.0236026,0,.78039,.728545,.0223302,0,.803789,.719691,.0211243,0,.82796,.710569,.0199983,0,.853056,.701216,.0189569,0,.879298,.692094,.0179702,0,.907014,.682909,.0170418,0,.936691,.673509,.0161732,0,.968254,.663863,.0153406,0,1,1,.437395,0,0,.999998,.437394,0,0,.99998,.437363,0,616704e-9,.999891,.437232,0,.00367925,.999656,.436877,0,.00867446,.999148,.436121,0,.0150679,.997959,.434564,0,.022531,.993464,.430134,0,.0308507,.990606,.426077,0,.0398805,.985027,.419397,0,.0495148,.978491,.41118,0,.0596749,.969643,.40048,0,.0703001,.959189,.38769,0,.0813427,.948223,.373575,0,.0927641,.935955,.357622,0,.104533,.923237,.34043,0,.116624,.911074,.322735,0,.129015,.899724,.30479,0,.141687,.890189,.287392,0,.154626,.881796,.270248,0,.167818,.874781,.253659,0,.181252,.869166,.237786,0,.194918,.864725,.222618,0,.208807,.861565,.208356,0,.222913,.859284,.194867,0,.237229,.857677,.18212,0,.25175,.856714,.17018,0,.266473,.856155,.158969,0,.281392,.8558,.148413,0,.296505,.855672,.138578,0,.311811,.855538,.129345,0,.327306,.855689,.120861,0,.342991,.855767,.112969,0,.358864,.855618,.105593,0,.374925,.85525,.0987451,0,.391176,.854583,.0923727,0,.407616,.853534,.0864143,0,.424249,.852061,.0808338,0,.441076,.850253,.0756771,0,.4581,.848004,.0708612,0,.475324,.845333,.0663784,0,.492754,.842376,.0622631,0,.510394,.838956,.0584112,0,.528251,.835121,.0548328,0,.546331,.830842,.0514838,0,.564644,.826212,.048355,0,.583198,.821522,.0454714,0,.602005,.816551,.0428263,0,.621078,.811211,.0403612,0,.640434,.805479,.038039,0,.660089,.799409,.0358739,0,.680066,.79306,.0338727,0,.70039,.786395,.0319985,0,.721094,.779416,.030241,0,.742215,.77214,.0285951,0,.7638,.764636,.0270747,0,.785912,.756836,.0256354,0,.808628,.749315,.0243027,0,.832055,.741561,.0230497,0,.856338,.733589,.0218801,0,.88169,.725479,.020784,0,.908441,.717255,.0197702,0,.937125,.708829,.0188168,0,.968254,.700191,.0179113,0,1,1,.518937,0,0,.999998,.518933,0,0,.999967,.518883,0,.00147741,.999832,.51866,0,.00573221,.999466,.518057,0,.011826,.998644,.516752,0,.0192116,.994458,.512347,0,.027573,.991223,.507675,0,.0367099,.985515,.500188,0,.046487,.978308,.490408,0,.0568071,.968359,.477357,0,.0675984,.95682,.461752,0,.0788059,.943929,.443796,0,.090386,.930224,.423893,0,.102304,.916514,.402682,0,.114532,.903653,.380914,0,.127047,.892315,.359212,0,.139828,.882942,.338102,0,.152861,.875438,.31773,0,.16613,.869642,.298186,0,.179624,.865304,.279491,0,.193332,.862382,.261804,0,.207247,.860666,.245146,0,.22136,.859788,.229406,0,.235666,.859608,.214605,0,.250158,.859912,.200691,0,.264832,.86053,.187623,0,.279684,.861368,.17539,0,.294711,.862237,.163901,0,.309911,.863127,.153175,0,.32528,.863923,.143147,0,.340819,.864567,.133781,0,.356524,.865013,.125042,0,.372397,.86539,.116952,0,.388438,.865591,.109476,0,.404645,.865517,.102542,0,.421022,.865084,.0960688,0,.437569,.864309,.0900499,0,.454287,.863151,.0844328,0,.471181,.861649,.0792218,0,.488253,.859742,.0743482,0,.505507,.857446,.0697963,0,.522947,.854757,.0655364,0,.54058,.851783,.061608,0,.558412,.848516,.0579701,0,.576449,.844897,.0545742,0,.594701,.840956,.0514167,0,.613178,.836676,.0484598,0,.631892,.832075,.0456934,0,.650856,.827191,.0431178,0,.670088,.822295,.0407718,0,.689606,.817294,.0386032,0,.709434,.812013,.0365675,0,.7296,.806465,.0346547,0,.750138,.800691,.0328717,0,.771093,.794709,.031211,0,.792519,.788493,.0296504,0,.814488,.782049,.0281782,0,.837097,.775403,.0267965,0,.860481,.76857,.0255002,0,.884842,.761536,.0242759,0,.910494,.754303,.0231142,0,.937985,.74692,.0220305,0,.968254,.739745,.0210192,0,1,1,.613914,0,0,.999996,.613907,0,963597e-10,.999942,.613814,0,.00301247,.999704,.613407,0,.00870385,.999046,.612302,0,.0160714,.995516,.608266,0,.0245899,.991726,.602863,0,.0339681,.985157,.593956,0,.0440254,.97642,.581748,0,.0546409,.964404,.565183,0,.0657284,.950601,.545273,0,.0772246,.935158,.522129,0,.0890812,.919364,.496782,0,.10126,.904754,.470571,0,.113731,.89176,.444037,0,.126469,.881492,.418322,0,.139454,.873656,.393522,0,.15267,.868053,.369795,0,.166101,.864336,.347171,0,.179736,.862259,.325737,0,.193565,.861556,.305532,0,.207578,.861776,.286416,0,.221769,.862661,.268355,0,.23613,.864015,.251334,0,.250656,.865711,.235352,0,.265343,.867519,.220302,0,.280187,.869351,.206161,0,.295183,.871144,.192908,0,.31033,.872839,.180505,0,.325624,.874307,.168848,0,.341065,.875667,.158021,0,.35665,.876758,.147877,0,.37238,.87764,.138441,0,.388253,.878237,.129627,0,.404269,.878563,.121415,0,.42043,.878572,.113741,0,.436735,.87842,.106652,0,.453187,.878057,.100097,0,.469786,.877413,.0940128,0,.486536,.87646,.0883462,0,.503439,.875233,.0830924,0,.520498,.8737,.0781975,0,.537717,.871873,.07364,0,.555102,.86978,.0694103,0,.572657,.867405,.0654696,0,.59039,.864751,.0617914,0,.608307,.861818,.0583491,0,.626419,.858645,.0551443,0,.644733,.855307,.0521894,0,.663264,.851736,.0494334,0,.682025,.847927,.0468504,0,.701032,.843888,.0444261,0,.720308,.839629,.0421497,0,.739875,.835158,.0400082,0,.759764,.830509,.0380076,0,.780014,.825714,.0361488,0,.800673,.820729,.0343956,0,.821803,.815751,.0327781,0,.843492,.810752,.031275,0,.86586,.805587,.0298542,0,.889087,.800317,.0285397,0,.913466,.79489,.0272948,0,.93952,.789314,.0261139,0,.96835,.783593,.0249938,0,1,1,.724258,0,0,.999992,.724243,0,726889e-9,.99987,.724044,0,.00569574,.999336,.72317,0,.0131702,.996271,.719432,0,.0220738,.991159,.712576,0,.0319405,.982465,.700927,0,.0425202,.97049,.684297,0,.0536599,.953973,.661244,0,.065258,.935546,.633804,0,.0772427,.916596,.603071,0,.0895616,.899353,.57105,0,.102175,.885216,.539206,0,.11505,.875076,.508714,0,.128164,.868334,.479571,0,.141495,.864414,.451796,0,.155026,.862678,.425328,0,.168745,.862835,.400352,0,.182639,.864067,.376532,0,.196699,.866086,.35391,0,.210915,.868557,.332424,0,.225282,.871271,.312053,0,.239792,.874058,.292764,0,.25444,.8768,.27453,0,.269223,.87939,.257297,0,.284135,.8819,.24114,0,.299174,.884187,.225934,0,.314337,.886262,.211669,0,.329622,.888119,.198311,0,.345026,.889709,.185783,0,.360549,.891054,.174063,0,.376189,.892196,.163143,0,.391946,.893101,.152952,0,.407819,.893803,.143475,0,.423808,.894277,.134647,0,.439914,.894532,.126434,0,.456137,.894576,.1188,0,.472479,.894393,.111694,0,.48894,.893976,.105069,0,.505523,.893346,.0989077,0,.52223,.892502,.0931724,0,.539064,.891441,.0878276,0,.556028,.890276,.082903,0,.573125,.888972,.0783505,0,.590361,.887469,.0741083,0,.607741,.885785,.0701633,0,.62527,.883914,.0664835,0,.642957,.881872,.0630567,0,.660809,.879651,.0598527,0,.678836,.877267,.0568615,0,.69705,.874717,.05406,0,.715465,.872012,.0514378,0,.734098,.869157,.0489805,0,.752968,.866155,.0466727,0,.772101,.863014,.0445056,0,.791529,.859748,.0424733,0,.81129,.856416,.0405957,0,.831438,.852958,.0388273,0,.852044,.849382,.0371619,0,.87321,.845694,.0355959,0,.89509,.841893,.0341155,0,.917932,.837981,.0327141,0,.942204,.833963,.0313856,0,.968981,.829847,.0301275,0,1,1,.85214,0,0,.999969,.852095,0,.00279627,.999483,.851408,0,.0107635,.994545,.84579,0,.0206454,.986188,.835231,0,.0315756,.969847,.814687,0,.0432021,.945951,.783735,0,.0553396,.91917,.746074,0,.0678766,.895488,.706938,0,.0807395,.878232,.669534,0,.0938767,.868252,.635168,0,.10725,.863873,.603069,0,.120832,.863369,.572514,0,.134598,.86545,.543169,0,.148533,.868803,.514578,0,.16262,.872794,.486762,0,.176849,.87702,.459811,0,.19121,.881054,.433654,0,.205694,.884974,.408574,0,.220294,.888587,.384525,0,.235005,.891877,.36156,0,.24982,.894793,.339661,0,.264737,.89743,.318913,0,.279751,.899796,.299302,0,.294859,.901943,.280843,0,.310058,.903858,.263481,0,.325346,.905574,.247197,0,.340721,.907069,.231915,0,.356181,.908379,.217614,0,.371725,.90952,.20425,0,.387353,.910483,.191758,0,.403063,.91128,.180092,0,.418854,.911936,.169222,0,.434727,.912454,.159098,0,.450682,.912835,.149668,0,.466718,.913078,.140884,0,.482837,.913192,.132709,0,.499038,.913175,.125095,0,.515324,.91304,.118012,0,.531695,.912781,.111417,0,.548153,.91241,.105281,0,.5647,.911924,.0995691,0,.581338,.911331,.0942531,0,.59807,.910637,.0893076,0,.6149,.90984,.0846998,0,.63183,.908941,.0804044,0,.648865,.907944,.0763984,0,.666011,.906857,.0726638,0,.683273,.90568,.0691783,0,.700659,.904416,.0659222,0,.718176,.903067,.0628782,0,.735834,.901637,.0600307,0,.753646,.900128,.0573647,0,.771625,.898544,.0548668,0,.78979,.89689,.052527,0,.808162,.895165,.0503306,0,.826771,.893371,.0482668,0,.845654,.891572,.0463605,0,.864863,.889763,.0445998,0,.884472,.887894,.0429451,0,.904592,.885967,.0413884,0,.925407,.883984,.0399225,0,.947271,.881945,.0385405,0,.97105,.879854,.0372362,0,1,.999804,.995833,0,0,.938155,.933611,0,.0158731,.864755,.854311,0,.0317461,.888594,.865264,0,.0476191,.905575,.863922,0,.0634921,.915125,.850558,0,.0793651,.920665,.829254,0,.0952381,.924073,.802578,0,.111111,.926304,.772211,0,.126984,.927829,.739366,0,.142857,.928924,.705033,0,.15873,.92973,.670019,0,.174603,.930339,.634993,0,.190476,.930811,.600485,0,.206349,.931191,.566897,0,.222222,.93149,.534485,0,.238095,.931737,.503429,0,.253968,.931939,.473811,0,.269841,.932108,.445668,0,.285714,.93225,.418993,0,.301587,.932371,.393762,0,.31746,.932474,.369939,0,.333333,.932562,.347479,0,.349206,.932638,.326336,0,.365079,.932703,.306462,0,.380952,.93276,.287805,0,.396825,.932809,.270313,0,.412698,.932851,.253933,0,.428571,.932887,.23861,0,.444444,.932917,.224289,0,.460317,.932943,.210917,0,.47619,.932965,.19844,0,.492063,.932982,.186807,0,.507937,.932995,.175966,0,.52381,.933005,.165869,0,.539683,.933011,.156468,0,.555556,.933013,.147719,0,.571429,.933013,.139579,0,.587302,.93301,.132007,0,.603175,.933004,.124965,0,.619048,.932994,.118416,0,.634921,.932982,.112326,0,.650794,.932968,.106663,0,.666667,.93295,.101397,0,.68254,.932931,.0964993,0,.698413,.932908,.0919438,0,.714286,.932883,.0877057,0,.730159,.932856,.0837623,0,.746032,.932827,.0800921,0,.761905,.932796,.0766754,0,.777778,.932762,.0734936,0,.793651,.932727,.0705296,0,.809524,.932689,.0677676,0,.825397,.93265,.0651929,0,.84127,.932609,.0627917,0,.857143,.932565,.0605515,0,.873016,.932521,.0584606,0,.888889,.932474,.0565082,0,.904762,.932427,.0546841,0,.920635,.932377,.0529793,0,.936508,.932326,.0513851,0,.952381,.932274,.0498936,0,.968254,.93222,.0484975,0,.984127,.932164,.0471899,0,1],n=new Float32Array(e),r=new Float32Array(t),i=new j3(n,64,64,io,vo,G6,zo,zo,ds,Yi,1),o=new j3(r,64,64,io,vo,G6,zo,zo,ds,Yi,1);i.needsUpdate=!0,o.needsUpdate=!0;const l=new Uint16Array(e.length);e.forEach(function(y,b){l[b]=s6e.toHalfFloat(y)});const c=new Uint16Array(t.length);t.forEach(function(y,b){c[b]=s6e.toHalfFloat(y)});const h=new j3(l,64,64,io,ro,G6,zo,zo,ds,Yi,1),m=new j3(c,64,64,io,ro,G6,zo,zo,ds,Yi,1);return h.needsUpdate=!0,m.needsUpdate=!0,this.LTC_HALF_1=h,this.LTC_HALF_2=m,this.LTC_FLOAT_1=i,this.LTC_FLOAT_2=o,this}}fw.LTC_HALF_1=null;fw.LTC_HALF_2=null;fw.LTC_FLOAT_1=null;fw.LTC_FLOAT_2=null;class hpt{static init(){fw.init();const{LTC_FLOAT_1:e,LTC_FLOAT_2:t,LTC_HALF_1:n,LTC_HALF_2:r}=fw;Fn.LTC_FLOAT_1=e,Fn.LTC_FLOAT_2=t,Fn.LTC_HALF_1=n,Fn.LTC_HALF_2=r}}const wNe=hd(([s,e,t=pbe(16)])=>{const n=l=>s.sample(l),r=UCe(),i=n(r).toVar(),o=Ji(t);return LF({start:pbe(1),end:t,type:"int",condition:"<="},({i:l})=>{const c=e.mul(Ji(l).div(o.sub(1)).sub(.5));i.addAssign(n(r.add(c)))}),i.divAssign(o),i}),T_e=new be;class TNe extends ZB{constructor(){super();qe(this,"renderTarget");qe(this,"mesh");this.name="RTTScene",this.camera.position.set(0,0,100),this.camera.lookAt(T_e)}init(){const t=xN.get("environment").clone();this.background=t;const n=new QA(new Tn(16777215),1);n.name="sun",this.add(n),this.mesh=new gn(new oZ(10,3,100,6),new EA({envMap:t,envMapIntensity:10})),this.mesh.name="normalMesh",this.add(this.mesh);const r=new gn(new Mg(10),new lZ);r.name="ball",r.position.set(25,25,0),this.add(r);const i=new gn(new Ng(200,200),new EA({envMap:t}));i.name="floor",i.rotation.x=-Math.PI/2,i.position.set(0,-20,0),this.add(i),this.renderTarget=new Op(512,512),$3(this);const o=this.app.components.get("three");o.addScene(this),o.addCamera(this.camera)}dispose(){const t=this.app.components.get("three");t.removeCamera(this.camera),t.removeScene(this),super.dispose()}draw(){this.clock.update();const t=this.clock.getElapsed(),n=100,r=t*.05*Math.PI*2,i=Math.cos(r)*n,o=Math.sin(r)*n;this.camera.position.set(i,0,o),this.camera.lookAt(T_e),this.renderer&&(this.renderer.setRenderTarget(this.renderTarget),this.renderer.clear(),this.renderer.render(this,this.camera),this.renderer.setRenderTarget(null))}}const E_e="Custom Group";class ENe extends ZB{constructor(){super();qe(this,"dance");qe(this,"rttScene");qe(this,"speed",1);qe(this,"renderPipeline");this.name="Scene2",this.rttScene=new TNe}setup(t,n){super.setup(t,n),this.rttScene.setup(t,n)}init(){this.rttScene.init();const t=this.app.components.get("three");this.camera.position.set(0,50,75),this.camera.lookAt(0,50,0),this.createLights(),this.createWorld(),this.createAnimation(),$3(this);const n=_l(1),r=BCe(this,this.camera);r.setMRT(tJ({output:nJ,velocity:VCe}));const i=r.getTextureNode().toInspector("Color"),o=r.getTextureNode("velocity").toInspector("Velocity").mul(n),l=wNe(i,o);this.renderPipeline=new SCe(t.renderer),this.renderPipeline.outputNode=l,this.app.isApp&&t.renderer.inspector.createParameters("Motion Blur Settings").add(n,"value",0,3).name("blur amount"),t.addScene(this),t.addCamera(this.camera),t.setScene(this),t.renderer&&(this.renderer=t.renderer)}dispose(){const t=this.app.components.get("three");t.removeCamera(this.camera),t.removeGroup(E_e),Rp(this.rttScene),super.dispose()}createLights(){const t=this.app.components.get("three"),n=new Bi;n.name="lights",this.add(n);const r=new Sw(16777215,3);if(r.angle=5.8,r.decay=0,r.distance=1e3,r.penumbra=Math.PI,r.name="spotlight",r.position.set(-250,200,200),r.lookAt(0,50,0),n.add(r),t.renderer!==void 0&&t.renderer.isWebGLRenderer){hpt.init();const i=new fSe(16711680,1,300,100);i.name="rectLight",i.position.set(250,100,100),i.lookAt(0,50,0),n.add(i)}}createWorld(){const t=this.app.components.get("three"),n=xN.get("environment").clone();this.background=n;const r=new Bi;r.name="world",this.add(r);const i=KB.get("uv_grid");i.repeat.setScalar(10),i.needsUpdate=!0;const o=new EA({map:i,envMap:n}),l=new gn(new sB(250,36),o);l.name="floor",l.receiveShadow=!0,l.position.y=-2,l.rotateX(-Math.PI/2),r.add(l);const c=new mGe(new Mg(50),new tZ({size:.5}));c.name="points",c.position.set(-100,50,0),r.add(c);const h=new KA(new Mg(50),new Sh);h.name="lines",h.position.set(100,50,0),r.add(h);const m=new rl;m.map=this.rttScene.renderTarget.texture;const y=new gn(new Ng(100,100),m);y.name="rttExample",y.position.set(-75,50,-125),r.add(y),t.renderer.isWebGLRenderer||(y.scale.y=-1),this.dance=new _Ne("Flair"),this.dance.name="flair",this.dance.traverse(b=>{if(b instanceof QK){const w=b;w.material=new cZ}}),r.add(this.dance),t.addGroup({title:E_e,items:[{title:"Speed",prop:"speed",value:1,min:0,max:2,step:.01,type:"range"},{title:"Name",prop:"name",value:"Hello World!",type:"string"},{title:"Color",prop:"color",value:new Tn(16711680),type:"color"}],onUpdate:(b,w)=>{switch(console.log(b,w),b){case"speed":this.speed=w;break}}})}createAnimation(){const t=this.app.components.get("theatre");t.sheet(this.name),t.sheetObject(this.name,"Camera",{position:{x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z},rotation:{x:this.camera.rotation.x,y:this.camera.rotation.y,z:this.camera.rotation.z}},n=>{this.camera.position.set(n.position.x,n.position.y,n.position.z),this.camera.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z)}),t.sheetObject(this.name,"Dancer",{position:{x:this.dance.position.x,y:this.dance.position.y,z:this.dance.position.z},rotation:{x:this.dance.rotation.x,y:this.dance.rotation.y,z:this.dance.rotation.z}},n=>{this.dance.position.set(n.position.x,n.position.y,n.position.z),this.dance.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z)})}update(){this.clock.update();const t=this.clock.getDelta();this.dance.update(t*this.speed),this.rttScene.update(),this.rttScene.draw()}draw(){this.renderPipeline.render()}resize(t,n){super.resize(t,n),this.rttScene.resize(t,n)}}class ppt extends Ho{static get type(){return"FXAANode"}constructor(e){super("vec4"),this.textureNode=e,this.updateBeforeType=aat.FRAME,this._invSize=_l(new Ln)}updateBefore(){const e=this.textureNode.value;this._invSize.value.set(1/e.image.width,1/e.image.height)}setup(){const e=this.textureNode.bias(-100),t=e.uvNode||UCe(),n=Ji(6),r=Ji(8),i=wat([1,1.5,2,2,2,4]),o=Ji(.0312),l=Ji(.063),c=Ji(1),h=hd(([C])=>e.sample(C)),m=hd(([C])=>FCe(h(C).rgb,cw(.3,.59,.11))),y=hd(([C,Z,ie,se])=>{const z=Z.add(C.mul(kC(ie,se)));return m(z)}),b=C=>{const Z=Y6(o,l.mul(C.highest));return C.contrast.lessThan(Z)},w=(C,Z)=>{const ie=m(Z),se=y(C,Z,0,-1),z=y(C,Z,1,0),re=y(C,Z,0,1),ye=y(C,Z,-1,0),H=y(C,Z,1,-1),Me=y(C,Z,-1,-1),Oe=y(C,Z,1,1),Ue=y(C,Z,-1,1),Ie=Y6(re,z,se,ye,ie),ce=eF(re,z,se,ye,ie),Ve=Ie.sub(ce);return{m:ie,n:se,e:z,s:re,w:ye,ne:H,nw:Me,se:Oe,sw:Ue,highest:Ie,lowest:ce,contrast:Ve}},A=C=>{let Z=Ji(2).mul(C.s.add(C.e).add(C.n).add(C.w));Z=Z.add(C.se.add(C.sw).add(C.ne).add(C.nw)),Z=Z.mul(1/12),Z=hu(Z.sub(C.m)),Z=cat(Z.div(Y6(C.contrast,0)),0,1);const ie=_at(0,1,Z);return ie.mul(ie).mul(c)},I=(C,Z)=>{const ie=hu(Z.s.add(Z.n).sub(Z.m.mul(2))).mul(2).add(hu(Z.se.add(Z.ne).sub(Z.e.mul(2))).add(hu(Z.sw.add(Z.nw).sub(Z.w.mul(2))))),se=hu(Z.e.add(Z.w).sub(Z.m.mul(2))).mul(2).add(hu(Z.se.add(Z.sw).sub(Z.s.mul(2))).add(hu(Z.ne.add(Z.nw).sub(Z.n.mul(2))))),z=ie.greaterThanEqual(se),re=kX(z,Z.s,Z.e),ye=kX(z,Z.n,Z.w),H=hu(re.sub(Z.m)),Me=hu(ye.sub(Z.m)),Oe=kX(z,C.y,C.x).toVar(),Ue=Ji().toVar(),Ie=Ji().toVar();return e0(H.lessThan(Me),()=>{Oe.assign(Oe.negate()),Ue.assign(ye),Ie.assign(Me)}).Else(()=>{Ue.assign(re),Ie.assign(H)}),{isHorizontal:z,pixelStep:Oe,oppositeLuminance:Ue,gradient:Ie}},D=(C,Z,ie,se)=>{const z=se.toVar(),re=kC().toVar();e0(ie.isHorizontal,()=>{z.y.addAssign(ie.pixelStep.mul(.5)),re.assign(kC(C.x,0))}).Else(()=>{z.x.addAssign(ie.pixelStep.mul(.5)),re.assign(kC(0,C.y))});const ye=Z.m.add(ie.oppositeLuminance).mul(.5),H=ie.gradient.mul(.25),Me=z.add(re.mul(i.element(0))).toVar(),Oe=m(Me).sub(ye).toVar(),Ue=hu(Oe).greaterThanEqual(H).toVar();LF({start:1,end:n},({i:Pt})=>{e0(Ue,()=>{cbe()}),Me.addAssign(re.mul(i.element(Pt))),Oe.assign(m(Me).sub(ye)),Ue.assign(hu(Oe).greaterThanEqual(H))}),e0(Ue.not(),()=>{Me.addAssign(re.mul(r))});const Ie=z.sub(re.mul(i.element(0))).toVar(),ce=m(Ie).sub(ye).toVar(),Ve=hu(ce).greaterThanEqual(H).toVar();LF({start:1,end:n},({i:Pt})=>{e0(Ve,()=>{cbe()}),Ie.subAssign(re.mul(i.element(Pt))),ce.assign(m(Ie).sub(ye)),Ve.assign(hu(ce).greaterThanEqual(H))}),e0(Ve.not(),()=>{Ie.subAssign(re.mul(r))});const Pe=Ji().toVar(),We=Ji().toVar();e0(ie.isHorizontal,()=>{Pe.assign(Me.x.sub(se.x)),We.assign(se.x.sub(Ie.x))}).Else(()=>{Pe.assign(Me.y.sub(se.y)),We.assign(se.y.sub(Ie.y))});const pt=Ji().toVar(),Ne=lat().toVar();e0(Pe.lessThanEqual(We),()=>{pt.assign(Pe),Ne.assign(Oe.greaterThanEqual(0))}).Else(()=>{pt.assign(We),Ne.assign(ce.greaterThanEqual(0))});const st=Ji().toVar();return e0(Ne.equal(Z.m.sub(ye).greaterThanEqual(0)),()=>{st.assign(0)}).Else(()=>{st.assign(Ji(.5).sub(pt.div(Pe.add(We))))}),st},P=hd(([C,Z])=>{const ie=w(Z,C);e0(b(ie),()=>h(C));const se=A(ie),z=I(Z,ie),re=D(Z,ie,z,C),ye=Y6(se,re),H=C.toVar();return e0(z.isHorizontal,()=>{H.y.addAssign(z.pixelStep.mul(ye))}).Else(()=>{H.x.addAssign(z.pixelStep.mul(ye))}),h(H)}).setLayout({name:"FxaaPixelShader",type:"vec4",inputs:[{name:"uv",type:"vec2"},{name:"texSize",type:"vec2"}]});return hd(()=>P(t,this._invSize))()}}const fpt=s=>new ppt(uat(s));class mpt extends Ki{constructor(){super();const e=3*3,t=new ja(new Float32Array(e*3),3),n=new ja(new Float32Array(e*3),3),r=new ja(new Float32Array(e*2),2);this.setAttribute("position",t),this.setAttribute("normal",n),this.setAttribute("uv",r);let i=0,o=0,l=0;function c(w){for(let A=0;A<w.length;A++)t.array[i++]=w[A]}function h(w,A,I){for(let D=0;D<3;D++)n.array[o++]=w,n.array[o++]=A,n.array[o++]=I}function m(w){for(let A=0;A<w.length;A++)r.array[l++]=w[A]}function y(w,A,I,D,P,U,j,C,Z){const ie=D-w,se=P-A,z=U-I,re=j-w,ye=C-A,H=Z-I,Me=se*H-z*ye,Oe=z*re-ie*H,Ue=ie*ye-se*re,Ie=Math.sqrt(Me*Me+Oe*Oe+Ue*Ue);return[Me/Ie,Oe/Ie,Ue/Ie]}const b=20;c([0,0,-20,0,-8,10,0,0,30]),h(...y(0,0,-20,0,-8,10,0,0,30)),m([.5,0,0,1,1,1]),c([0,0,-15,-b,0,5,0,0,15]),h(...y(0,0,-15,-b,0,5,0,0,15)),m([.5,0,0,1,1,1]),c([0,0,15,b,0,5,0,0,-15]),h(...y(0,0,15,b,0,5,0,0,-15)),m([.5,0,0,1,1,1]),this.scale(.2,.2,.2)}}const gpt=9,oF=800,bY=oF/2;class ypt extends CQ{constructor(t){super();qe(this,"computeVelocity");qe(this,"computePosition");qe(this,"computeCopyPositions");qe(this,"prevVPMatrix",_l(new Pn).setName("prevVPMatrix"));qe(this,"_velocityMRTNode");qe(this,"effectController",{separation:_l(15).setName("separation"),alignment:_l(20).setName("alignment"),cohesion:_l(20).setName("cohesion"),freedom:_l(.75).setName("freedom"),now:_l(0),deltaTime:_l(0).setName("deltaTime"),rayOrigin:_l(new be).setName("rayOrigin"),rayDirection:_l(new be).setName("rayDirection")});const n=new Float32Array(t*3),r=new Float32Array(t*3),i=new Float32Array(t);for(let I=0;I<t;I++){const D=Math.random()*oF-bY,P=Math.random()*oF-bY,U=Math.random()*oF-bY;n[I*3+0]=D,n[I*3+1]=P,n[I*3+2]=U;const j=Math.random()-.5,C=Math.random()-.5,Z=Math.random()-.5;r[I*3+0]=j*10,r[I*3+1]=C*10,r[I*3+2]=Z*10,i[I]=1}const o=lL(n,"vec3").setName("positionStorage"),l=lL(r,"vec3").setName("velocityStorage"),c=lL(i,"float").setName("phaseStorage");o.setPBO(!0),l.setPBO(!0),c.setPBO(!0);const h=lL(new Float32Array(n),"vec3").setName("previousPositionStorage");h.setPBO(!0);const m=zCe("vec4","birdVelocity"),y=hd(()=>{const I=c.element(lh),D=M6(l.element(lh)),U=xbe.equal(4).or(xbe.equal(7)).select(bat(I).mul(5),Ji(0)),j=cw(tF.x,tF.y.add(U),tF.z),C=cw(D.x,D.y,IX(D.z)),Z=dC(C.xz),ie=C.x.div(Z),se=C.z.div(Z),z=Sat(C.y.mul(C.y).oneMinus()),re=C.y,ye=mbe(ie,0,IX(se),0,1,0,se,0,ie),H=mbe(z,re,0,IX(re),z,0,0,0,1),Me=gat.mul(j),Oe=ye.mul(H).mul(Me).add(o.element(lh)),Ue=o.element(lh),Ie=h.element(lh),ce=ube.mul(dbe).mul(ZC(Ue,1)),Ve=this.prevVPMatrix.mul(ZC(Ie,1)),Pe=ce.xy.div(ce.w).sub(Ve.xy.div(Ve.w)).mul(.5);return m.assign(ZC(Pe,0,0)),ube.mul(dbe).mul(Oe)},"vec4");this.vertexNode=y(),this._velocityMRTNode=tJ({output:nJ,velocity:m}),this.mrtNode=this._velocityMRTNode,this.side=oa;const b=hd(()=>{const D=Ji(3.141592653589793).mul(2),P=Ji(gpt).toVar("limit"),{alignment:U,separation:j,cohesion:C,deltaTime:Z,rayOrigin:ie,rayDirection:se}=this.effectController,z=j.add(U).add(C).toConst(),re=j.div(z).toConst(),ye=j.add(U).div(z).toConst(),H=z.mul(z).toConst(),Me=lh.toConst("birdIndex"),Oe=o.element(Me).toVar(),Ue=l.element(Me).toVar(),Ie=ie.sub(Oe).toConst(),ce=FCe(Ie,se).toConst(),Pe=ie.sub(se.mul(ce)).toConst().sub(Oe).toConst(),We=dC(Pe).toConst(),pt=We.mul(We).toConst(),Ne=Ji(150).toConst(),st=Ne.mul(Ne).toConst();e0(pt.lessThan(st),()=>{const yn=pt.div(st).sub(1).mul(Z).mul(100);Ue.addAssign(M6(Pe).mul(yn)),P.addAssign(5)});const Pt=Oe.toVar();Pt.y.mulAssign(2.5),Ue.subAssign(M6(Pt).mul(Z).mul(5)),LF({start:vbe(0),end:vbe(t),type:"uint",condition:"<"},({i:yn})=>{e0(yn.equal(Me),()=>{RX()});const St=o.element(yn).sub(Oe),Ut=dC(St);e0(Ut.lessThan(1e-4),()=>{RX()});const Wt=Ut.mul(Ut);e0(Wt.greaterThan(H),()=>{RX()});const kn=Wt.div(H);e0(kn.lessThan(re),()=>{const Dn=re.div(kn).sub(1).mul(Z);Ue.subAssign(M6(St).mul(Dn))}).ElseIf(kn.lessThan(ye),()=>{const Dn=ye.sub(re),or=kn.sub(re).div(Dn),ns=l.element(yn),Xr=hbe(or.mul(D)),Kr=Ji(.5).sub(Xr.mul(.5)).add(.5).mul(Z);Ue.addAssign(M6(ns).mul(Kr))}).Else(()=>{const Dn=ye.oneMinus(),or=Dn.equal(0).select(1,kn.sub(ye).div(Dn)),Vr=hbe(or.mul(D)).mul(-.5).add(.5),Yr=Ji(.5).sub(Vr).mul(Z);Ue.addAssign(M6(St).mul(Yr))})}),e0(dC(Ue).greaterThan(P),()=>{Ue.assign(M6(Ue).mul(P))}),l.element(Me).assign(Ue)});this.computeVelocity=b().compute(t);const w=hd(()=>{const{deltaTime:I}=this.effectController;o.element(lh).addAssign(l.element(lh).mul(I).mul(15));const D=l.element(lh),U=c.element(lh).add(I).add(dC(D.xz).mul(I).mul(3)).add(Y6(D.y,0).mul(I).mul(6));c.element(lh).assign(U.mod(62.83))});this.computePosition=w().compute(t);const A=hd(()=>{h.element(lh).assign(o.element(lh))},"void");this.computeCopyPositions=A().compute(t)}get alignment(){return this.effectController.alignment.value}set alignment(t){this.effectController.alignment.value=t}get cohesion(){return this.effectController.cohesion.value}set cohesion(t){this.effectController.cohesion.value=t}get freedom(){return this.effectController.freedom.value}set freedom(t){this.effectController.freedom.value=t}get separation(){return this.effectController.separation.value}set separation(t){this.effectController.separation.value=t}set rayOrigin(t){this.effectController.rayOrigin.value=t}set rayDirection(t){this.effectController.rayDirection.value=t}set delta(t){this.effectController.deltaTime.value=t}set now(t){this.effectController.now.value=t}get useMRT(){return this.mrtNode!==null}set useMRT(t){this.mrtNode=t?this._velocityMRTNode:null,this.needsUpdate=!0}}class vpt extends dGe{constructor(t=8192){const n=new ypt(t);super(new mpt,n,t);qe(this,"birdMaterial");this.name="birds",this.birdMaterial=n,this.rotation.y=Math.PI/2,this.matrixAutoUpdate=!1,this.frustumCulled=!1,this.updateMatrix()}savePrevCamera(t){this.birdMaterial.prevVPMatrix.value.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse)}update(t,n,r){this.birdMaterial.delta=t,this.birdMaterial.now=n,r.computeAsync(this.birdMaterial.computeCopyPositions),r.computeAsync(this.birdMaterial.computeVelocity),r.computeAsync(this.birdMaterial.computePosition)}get alignment(){return this.birdMaterial.alignment}set alignment(t){this.birdMaterial.alignment=t}get cohesion(){return this.birdMaterial.cohesion}set cohesion(t){this.birdMaterial.cohesion=t}get freedom(){return this.birdMaterial.freedom}set freedom(t){this.birdMaterial.freedom=t}get separation(){return this.birdMaterial.separation}set separation(t){this.birdMaterial.separation=t}set rayOrigin(t){this.birdMaterial.rayOrigin=t}set rayDirection(t){this.birdMaterial.rayDirection=t}get useMRT(){return this.birdMaterial.useMRT}set useMRT(t){this.birdMaterial.useMRT=t}}class MNe extends ZB{constructor(){super();qe(this,"birds");qe(this,"controls");qe(this,"renderPipeline");qe(this,"fpo");this.name="Scene3",this.camera.position.set(0,100,500),this.camera.rotation.set(0,0,0)}init(){const t=this.app.components.get("three"),n=xN.get("environment").clone();this.background=n;const r=new QA("#ffffff",.15);r.position.set(1,4,2),r.name="sunLight",this.add(r),this.birds=new vpt,this.birds.useMRT=this.app.isApp,this.add(this.birds);const i=KB.get("uv_grid").clone();i.needsUpdate=!0,this.fpo=new gn(new _a(50,50,50),new aZ({map:i})),this.fpo.name="box",this.add(this.fpo);const o=500;["#FF0000","#00FF00","#0000FF"].forEach((w,A)=>{const I=A/3,D=Math.PI*2*I,P=new dF(w,5,1e3,.05);P.name=`pointLight${A}`,P.position.x=Math.cos(D)*o,P.position.z=Math.sin(D)*o,this.add(P);const U=new bSe(P,100);this.add(U)});const l=_l(1),c=BCe(this,this.camera);c.setMRT(tJ({output:nJ,velocity:VCe}));const h=c.getTextureNode().toInspector("Color"),m=c.getTextureNode("velocity").toInspector("Velocity").mul(l),y=wNe(h,m),b=fpt(y);this.renderPipeline=new SCe(t.renderer),this.renderPipeline.outputNode=b,this.controls=new ECe(this.camera,t.canvas),this.controls.enableDamping=!0,this.controls.autoRotate=!0,this.controls.autoRotateSpeed=.5,this.app.isApp&&t.renderer.inspector.createParameters("Motion Blur Settings").add(l,"value",0,3).name("blur amount"),$3(this),t.addScene(this),t.addCamera(this.camera),t.setScene(this)}update(){var i,o,l;const n=this.app.components.get("three").renderer;this.clock.update();const r=this.clock.getElapsed();(i=this.birds)==null||i.savePrevCamera(this.camera),(o=this.controls)==null||o.update(),this.fpo.position.y=Math.sin(r*6)*25,this.fpo.rotation.y=r*Math.PI,(l=this.birds)==null||l.update(this.clock.getDelta(),r,n)}draw(){this.renderPipeline.render()}}function xpt(s){On.useEffect(()=>{xht()},[]);const e=s.app.components.get("three"),t=new Map;return t.set("Scene1",SNe),t.set("Scene2",ENe),t.set("Scene3",MNe),t.set("RTTScene",TNe),ot.jsx(vht,{three:e,scenes:t,onSceneAdd:n=>{var r;n.setup(s.app,(r=nl.instance)==null?void 0:r.renderer),n.init()},onSceneUpdate:n=>{n.update()}})}class CNe{constructor(e,t,n){this.id=0,this.name=e,this.fg=t,this.bg=n,this.gradient=null,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.width="90px",this.canvas.style.height="48px",this.canvas.style.position="absolute",this.canvas.style.cssText="width:90px;height:48px;background-color: transparent !important;",this.context=this.canvas.getContext("2d"),this.initializeCanvas()}createGradient(){if(!this.context)throw new Error("No context");const e=this.context.createLinearGradient(0,this.GRAPH_Y,0,this.GRAPH_Y+this.GRAPH_HEIGHT);let t;const n=this.fg;switch(this.fg.toLowerCase()){case"#0ff":t="#006666";break;case"#0f0":t="#006600";break;case"#ff0":t="#666600";break;case"#e1e1e1":t="#666666";break;default:t=this.bg;break}return e.addColorStop(0,t),e.addColorStop(1,n),e}initializeCanvas(){this.context&&(this.context.imageSmoothingEnabled=!1,this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.gradient=this.createGradient(),this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(e,t,n=0){if(!this.context||!this.gradient)return;const r=Math.min(1/0,e),i=Math.max(t,e);this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(`${e.toFixed(n)} ${this.name} (${r.toFixed(n)}-${parseFloat(i.toFixed(n))})`,this.TEXT_X,this.TEXT_Y)}updateGraph(e,t){if(!this.context||!this.gradient)return;e===0&&t===0&&(t=1),t=Math.max(t,e,.1),e=Math.max(e,0);const n=Math.round(this.GRAPH_X),r=Math.round(this.GRAPH_Y),i=Math.round(this.GRAPH_WIDTH),o=Math.round(this.GRAPH_HEIGHT),l=Math.round(this.PR);this.context.drawImage(this.canvas,n+l,r,i-l,o,n,r,i-l,o),this.context.fillStyle=this.bg,this.context.fillRect(n+i-l,r,l,o);const c=Math.min(o,Math.round(e/t*o));c>0&&(this.context.globalAlpha=.9,this.context.fillStyle=this.gradient,this.context.fillRect(n+i-l,r+(o-c),l,c)),this.context.globalAlpha=1}}class bpt extends CNe{constructor(e,t,n){super(e,t,n),this.vsyncValue=0,this.SMALL_HEIGHT=9*this.PR,this.HEIGHT=this.SMALL_HEIGHT,this.WIDTH=35*this.PR,this.TEXT_Y=0*this.PR,this.canvas.height=this.HEIGHT,this.canvas.width=this.WIDTH,this.canvas.style.height="9px",this.canvas.style.width="35px",this.canvas.style.cssText=`
            width: 35px;
            height: 9px;
            position: absolute;
            top: 0;
            left: 0;
            background-color: transparent !important;
            pointer-events: none;
        `,this.initializeCanvas()}initializeCanvas(){this.context&&(this.context.imageSmoothingEnabled=!1,this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.globalAlpha=1)}update(e,t,n=0){this.context&&(this.vsyncValue=e,this.context.clearRect(0,0,this.WIDTH,this.HEIGHT),this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillText(`${e.toFixed(0)}Hz`,this.TEXT_X,this.TEXT_Y))}updateGraph(e,t){}setOffset(e,t){this.canvas.style.transform=`translate(${e}px, ${t}px)`}}const ANe=class aS{constructor({trackGPU:e=!1,trackCPT:t=!1,trackHz:n=!1,logsPerSecond:r=4,graphsPerSecond:i=30,samplesLog:o=40,samplesGraph:l=10,precision:c=2,minimal:h=!1,horizontal:m=!0,mode:y=0}={}){this.gl=null,this.ext=null,this.activeQuery=null,this.gpuQueries=[],this.threeRendererPatched=!1,this.frameTimes=[],this.renderCount=0,this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.gpuPanel=null,this.gpuPanelCompute=null,this.vsyncPanel=null,this.averageFps={logs:[],graph:[]},this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.updateCounter=0,this.lastMin={},this.lastMax={},this.lastValue={},this.VSYNC_RATES=[{refreshRate:60,frameTime:16.67},{refreshRate:75,frameTime:13.33},{refreshRate:90,frameTime:11.11},{refreshRate:120,frameTime:8.33},{refreshRate:144,frameTime:6.94},{refreshRate:165,frameTime:6.06},{refreshRate:240,frameTime:4.17}],this.detectedVSync=null,this.frameTimeHistory=[],this.HISTORY_SIZE=120,this.VSYNC_THRESHOLD=.05,this.lastFrameTime=0,this.handleClick=w=>{w.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},this.handleResize=()=>{this.resizePanel(this.fpsPanel),this.resizePanel(this.msPanel),this.gpuPanel&&this.resizePanel(this.gpuPanel),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute)},this.mode=y,this.horizontal=m,this.minimal=h,this.trackGPU=e,this.trackCPT=t,this.trackHz=n,this.samplesLog=o,this.samplesGraph=l,this.precision=c,this.logsPerSecond=r,this.graphsPerSecond=i;const b=performance.now();this.prevGraphTime=b,this.dom=document.createElement("div"),this.initializeDOM(),this.beginTime=performance.now(),this.prevTextTime=this.beginTime,this.prevCpuTime=this.beginTime,this._panelId=0,this.fpsPanel=this.addPanel(new aS.Panel("FPS","#0ff","#002")),this.msPanel=this.addPanel(new aS.Panel("CPU","#0f0","#020")),this.trackHz===!0&&(this.vsyncPanel=new bpt("","#f0f","#202"),this.dom.appendChild(this.vsyncPanel.canvas),this.vsyncPanel.setOffset(56,35)),this.setupEventListeners()}initializeDOM(){this.dom.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      opacity: 0.9;
      z-index: 10000;
      ${this.minimal?"cursor: pointer;":""}
    `}setupEventListeners(){this.minimal?(this.dom.addEventListener("click",this.handleClick),this.showPanel(this.mode)):window.addEventListener("resize",this.handleResize)}async init(e){if(!e){console.error('Stats: The "canvas" parameter is undefined.');return}if(!this.handleThreeRenderer(e)&&!await this.handleWebGPURenderer(e))if(this.initializeWebGL(e)){this.trackGPU&&this.initializeGPUTracking();return}else console.error("Stats-gl: Failed to initialize WebGL context")}handleThreeRenderer(e){return e.isWebGLRenderer&&!this.threeRendererPatched?(this.patchThreeRenderer(e),this.gl=e.getContext(),this.trackGPU&&this.initializeGPUTracking(),!0):!1}async handleWebGPURenderer(e){return e.isWebGPURenderer?((this.trackGPU||this.trackCPT)&&(e.backend.trackTimestamp=!0,await e.hasFeatureAsync("timestamp-query")&&this.initializeWebGPUPanels()),this.info=e.info,this.patchThreeWebGPU(e),!0):!1}initializeWebGPUPanels(){this.trackGPU&&(this.gpuPanel=this.addPanel(new aS.Panel("GPU","#ff0","#220"))),this.trackCPT&&(this.gpuPanelCompute=this.addPanel(new aS.Panel("CPT","#e1e1e1","#212121")))}initializeWebGL(e){if(e instanceof WebGL2RenderingContext)this.gl=e;else if(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas){if(this.gl=e.getContext("webgl2"),!this.gl)return console.error("Stats: Unable to obtain WebGL2 context."),!1}else return console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas."),!1;return!0}initializeGPUTracking(){this.gl&&(this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new aS.Panel("GPU","#ff0","#220"))))}begin(){this.beginProfiling("cpu-started"),!(!this.gl||!this.ext)&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null),this.endProfiling("cpu-started","cpu-finished","cpu-duration")}update(){this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.info?this.processWebGPUTimestamps():this.processGpuQueries(),this.updateAverages(),this.resetCounters()}processWebGPUTimestamps(){this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp}resetCounters(){this.renderCount=0,this.totalCpuDuration=0,this.beginTime=this.endInternal()}resizePanel(e){e.canvas.style.position="absolute",this.minimal?e.canvas.style.display="none":(e.canvas.style.display="block",this.horizontal?(e.canvas.style.top="0px",e.canvas.style.left=e.id*e.WIDTH/e.PR+"px"):(e.canvas.style.left="0px",e.canvas.style.top=e.id*e.HEIGHT/e.PR+"px"))}addPanel(e){return e.canvas&&(this.dom.appendChild(e.canvas),e.id=this._panelId,this.resizePanel(e),this._panelId++),e}showPanel(e){for(let t=0;t<this.dom.children.length;t++){const n=this.dom.children[t];n.style.display=t===e?"block":"none"}this.mode=e}processGpuQueries(){!this.gl||!this.ext||(this.totalGpuDuration=0,this.gpuQueries.forEach((e,t)=>{if(this.gl){const n=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE),r=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(n&&!r){const o=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT)*1e-6;this.totalGpuDuration+=o,this.gl.deleteQuery(e.query),this.gpuQueries.splice(t,1)}}}))}detectVSync(e){if(this.lastFrameTime===0){this.lastFrameTime=e;return}const t=e-this.lastFrameTime;if(this.lastFrameTime=e,this.frameTimeHistory.push(t),this.frameTimeHistory.length>this.HISTORY_SIZE&&this.frameTimeHistory.shift(),this.frameTimeHistory.length<60)return;const n=this.frameTimeHistory.reduce((c,h)=>c+h)/this.frameTimeHistory.length,r=this.frameTimeHistory.reduce((c,h)=>c+Math.pow(h-n,2),0)/this.frameTimeHistory.length;if(Math.sqrt(r)>2){this.detectedVSync=null;return}let o=null,l=1/0;for(const c of this.VSYNC_RATES){const h=Math.abs(n-c.frameTime);h<l&&(l=h,o=c)}o&&l/o.frameTime<=this.VSYNC_THRESHOLD?this.detectedVSync=o:this.detectedVSync=null}endInternal(){var e;const t=performance.now();for(this.frameTimes.push(t);this.frameTimes.length>0&&this.frameTimes[0]<=t-1e3;)this.frameTimes.shift();const n=Math.round(this.frameTimes.length);this.addToAverage(n,this.averageFps);const r=t>=this.prevTextTime+1e3/this.logsPerSecond,i=t>=this.prevGraphTime+1e3/this.graphsPerSecond;if(this.updatePanelComponents(this.fpsPanel,this.averageFps,0,r,i),this.updatePanelComponents(this.msPanel,this.averageCpu,this.precision,r,i),this.gpuPanel&&this.updatePanelComponents(this.gpuPanel,this.averageGpu,this.precision,r,i),this.trackCPT&&this.gpuPanelCompute&&this.updatePanelComponents(this.gpuPanelCompute,this.averageGpuCompute,this.precision,r,i),r&&(this.prevTextTime=t),i&&(this.prevGraphTime=t),this.vsyncPanel!==null){this.detectVSync(t);const o=((e=this.detectedVSync)==null?void 0:e.refreshRate)||0;r&&o>0&&this.vsyncPanel.update(o,o)}return t}updatePanelComponents(e,t,n,r,i){if(!e||t.logs.length===0)return;e.name in this.lastMin||(this.lastMin[e.name]=1/0,this.lastMax[e.name]=0,this.lastValue[e.name]=0);const o=t.logs[t.logs.length-1];this.lastMax[e.name]=Math.max(...t.logs),this.lastMin[e.name]=Math.min(this.lastMin[e.name],o),this.lastValue[e.name]=this.lastValue[e.name]*.7+o*.3;const l=Math.max(Math.max(...t.logs),...t.graph.slice(-this.samplesGraph));this.updateCounter++,r&&e.update(this.lastValue[e.name],this.lastMax[e.name],n),i&&e.updateGraph(o,l)}beginProfiling(e){if(window.performance)try{window.performance.clearMarks(e),window.performance.mark(e)}catch(t){console.debug("Stats: Performance marking failed:",t)}}endProfiling(e,t,n){if(!(!window.performance||!t||!e))try{window.performance.getEntriesByName(e,"mark").length===0&&this.beginProfiling(e),window.performance.clearMarks(t),window.performance.mark(t),window.performance.clearMeasures(n);const i=performance.measure(n,e,t);this.totalCpuDuration+=i.duration,window.performance.clearMarks(e),window.performance.clearMarks(t),window.performance.clearMeasures(n)}catch(r){console.debug("Stats: Performance measurement failed:",r)}}updatePanel(e,t,n=2){if(!e||t.logs.length===0)return;const r=performance.now();e.name in this.lastMin||(this.lastMin[e.name]=1/0,this.lastMax[e.name]=0,this.lastValue[e.name]=0);const i=t.logs[t.logs.length-1],o=Math.max(...t.logs.slice(-30));this.lastMin[e.name]=Math.min(this.lastMin[e.name],i),this.lastMax[e.name]=Math.max(this.lastMax[e.name],i),this.lastValue[e.name]=this.lastValue[e.name]*.7+i*.3;const l=Math.max(o,...t.graph.slice(-this.samplesGraph));this.updateCounter++,this.updateCounter%(this.logsPerSecond*2)===0&&(this.lastMax[e.name]=o,this.lastMin[e.name]=i),e.update&&(r>=this.prevCpuTime+1e3/this.logsPerSecond&&e.update(this.lastValue[e.name],i,this.lastMax[e.name],l,n),r>=this.prevGraphTime+1e3/this.graphsPerSecond&&(e.updateGraph(i,l),this.prevGraphTime=r))}updateAverages(){this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu),this.info&&this.totalGpuDurationCompute!==void 0&&this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)}addToAverage(e,t){t.logs.push(e),t.logs.length>this.samplesLog&&(t.logs=t.logs.slice(-this.samplesLog)),t.graph.push(e),t.graph.length>this.samplesGraph&&(t.graph=t.graph.slice(-this.samplesGraph))}get domElement(){return this.dom}patchThreeWebGPU(e){const t=e.info.reset,n=this;e.info.reset=function(){n.beginProfiling("cpu-started"),t.call(this)}}patchThreeRenderer(e){const t=e.render,n=this;e.render=function(r,i){n.begin(),t.call(this,r,i),n.end()},this.threeRendererPatched=!0}};ANe.Panel=CNe;let _pt=ANe,M_e=[];function Spt(s){M_e.forEach(e=>{s.removeGroup(e)}),M_e=[]}class NNe{constructor(e,t){this.uid=e,this.cid=e.match(/^(.*):f(\d+)$/)[1],this.name=t,this.timestamp=0,this.cpu=0,this.gpu=0,this.fps=0,this.children=[],this.parent=null}}class wpt extends NNe{constructor(e,t,n,r){let i=t.name;i===""&&(t.isScene?i="Scene":t.isQuadMesh&&(i="QuadMesh")),super(e,i),this.scene=t,this.camera=n,this.renderTarget=r,this.isRenderStats=!0}}class Tpt extends NNe{constructor(e,t){super(e,t.name),this.computeNode=t,this.isComputeStats=!0}}class Ept extends tQ{constructor(){super(),this.currentFrame=null,this.currentRender=null,this.currentNodes=null,this.lastFrame=null,this.frames=[],this.framesLib={},this.maxFrames=512,this._lastFinishTime=0,this._resolveTimestampPromise=null,this.isRendererInspector=!0}getParent(){return this.currentRender||this.getFrame()}begin(){this.currentFrame=this._createFrame(),this.currentRender=this.currentFrame,this.currentNodes=[]}finish(){const e=performance.now(),t=this.currentFrame;t.finishTime=e,t.deltaTime=e-(this._lastFinishTime>0?this._lastFinishTime:e),this.addFrame(t),this.fps=this._getFPS(),this.lastFrame=t,this.currentFrame=null,this.currentRender=null,this.currentNodes=null,this._lastFinishTime=e}_getFPS(){let e=0,t=0;for(let n=this.frames.length-1;n>=0;n--){const r=this.frames[n];if(e++,t+=r.deltaTime,t>=1e3)break}return e*1e3/t}_createFrame(){return{frameId:this.nodeFrame.frameId,resolvedCompute:!1,resolvedRender:!1,deltaTime:0,startTime:performance.now(),finishTime:0,miscellaneous:0,children:[],renders:[],computes:[]}}getFrame(){return this.currentFrame||this.lastFrame}getFrameById(e){return this.framesLib[e]||null}resolveViewer(){}resolveFrame(){}async resolveTimestamp(){return this._resolveTimestampPromise!==null?this._resolveTimestampPromise:(this._resolveTimestampPromise=new Promise(e=>{requestAnimationFrame(async()=>{const t=this.getRenderer();await t.resolveTimestampsAsync(md.COMPUTE),await t.resolveTimestampsAsync(md.RENDER);const n=t.backend.getTimestampFrames(md.COMPUTE),r=t.backend.getTimestampFrames(md.RENDER),i=[...new Set([...n,...r])];for(const o of i){const l=this.getFrameById(o);if(l!==null){if(l.resolvedCompute===!1)if(l.computes.length>0){if(n.includes(o)){for(const c of l.computes)t.backend.hasTimestamp(c.uid)?c.gpu=t.backend.getTimestamp(c.uid):(c.gpu=0,c.gpuNotAvailable=!0);l.resolvedCompute=!0}}else l.resolvedCompute=!0;if(l.resolvedRender===!1)if(l.renders.length>0){if(r.includes(o)){for(const c of l.renders)t.backend.hasTimestamp(c.uid)?c.gpu=t.backend.getTimestamp(c.uid):(c.gpu=0,c.gpuNotAvailable=!0);l.resolvedRender=!0}}else l.resolvedRender=!0;l.resolvedCompute===!0&&l.resolvedRender===!0&&this.resolveFrame(l)}}this._resolveTimestampPromise=null,e()})}),this._resolveTimestampPromise)}get isAvailable(){return this.getRenderer()!==null}addFrame(e){if(this.frames.length>=this.maxFrames){const t=this.frames.shift();delete this.framesLib[t.frameId]}this.frames.push(e),this.framesLib[e.frameId]=e,this.isAvailable&&(this.resolveViewer(),this.resolveTimestamp())}inspect(e){const t=this.currentNodes;t!==null?t.push(e):es('RendererInspector: Unable to inspect node outside of frame scope. Use "renderer.setAnimationLoop()".')}beginCompute(e,t){const n=this.getFrame();if(!n)return;const r=new Tpt(e,t);r.timestamp=performance.now(),r.parent=this.currentCompute||this.getParent(),n.computes.push(r),this.currentRender!==null?this.currentRender.children.push(r):n.children.push(r),this.currentCompute=r}finishCompute(){if(!this.getFrame())return;const t=this.currentCompute;t.cpu=performance.now()-t.timestamp,this.currentCompute=t.parent.isComputeStats?t.parent:null}beginRender(e,t,n,r){const i=this.getFrame();if(!i)return;const o=new wpt(e,t,n,r);o.timestamp=performance.now(),o.parent=this.getParent(),i.renders.push(o),this.currentRender!==null?this.currentRender.children.push(o):i.children.push(o),this.currentRender=o}finishRender(){if(!this.getFrame())return;const t=this.currentRender;t.cpu=performance.now()-t.timestamp,this.currentRender=t.parent}}class Mpt{static init(){if(document.getElementById("profiler-styles"))return;const e=`
:root {
	--profiler-bg: #1e1e24f5;
	--profiler-header-bg: #2a2a33aa;
	--profiler-header: #2a2a33;
	--profiler-border: #4a4a5a;
	--text-primary: #e0e0e0;
	--text-secondary: #9a9aab;
	--accent-color: #00aaff;
	--color-green: #4caf50;
	--color-yellow: #ffc107;
	--color-red: #f44336;
	--font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
	--font-mono: 'Fira Code', 'Courier New', Courier, monospace;
}

@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Fira+Code&display=swap');

#profiler-panel *, #profiler-toggle * {
	text-transform: initial;
	line-height: normal;
	box-sizing: border-box;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}

#profiler-toggle {
	position: fixed;
	top: 15px;
	right: 15px;
	background-color: rgba(30, 30, 36, 0.85);
	border: 1px solid #4a4a5a54;
	border-radius: 12px 6px 6px 12px;
	color: var(--text-primary);
	cursor: pointer;
	z-index: 1001;
	transition: all 0.2s ease-in-out;
	/*font-size: 14px;*/
	font-size: 15px;
	backdrop-filter: blur(8px);
	box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
	display: flex;
	align-items: stretch;
	padding: 0;
	overflow: hidden;
	font-family: var(--font-family);
}

#profiler-toggle:hover {
	border-color: var(--accent-color);
}

#profiler-toggle.hidden {
	opacity: 0;
	pointer-events: none;
}

#toggle-icon {
	display: flex;
	align-items: center;
	justify-content: center;
	width: 40px;
	font-size: 20px;
	transition: background-color 0.2s;
}

#profiler-toggle:hover #toggle-icon {
	background-color: rgba(255, 255, 255, 0.05);
}

.toggle-separator {
	width: 1px;
	background-color: var(--profiler-border);
}

#toggle-text {
	display: flex;
	align-items: baseline;
	padding: 8px 14px;
	min-width: 80px;
	justify-content: right;
}

#toggle-text .fps-label {
	font-size: 0.7em;
	margin-left: 10px;
    color: #999;
}

#builtin-tabs-container {
	display: flex;
	align-items: stretch;
	gap: 0;
	border-right: 1px solid #262636;
	order: -1;
}

.builtin-tab-btn {
	background: transparent;
	border: none;
	color: var(--text-secondary);
	cursor: pointer;
	padding: 8px 14px;
	font-family: var(--font-family);
	font-size: 13px;
	font-weight: 600;
	transition: all 0.2s;
	display: flex;
	align-items: center;
	justify-content: center;
	min-width: 32px;
	position: relative;
}

.builtin-tab-btn svg {
	width: 20px;
	height: 20px;
	stroke: currentColor;
}

.builtin-tab-btn:hover {
	background-color: rgba(255, 255, 255, 0.08);
	color: var(--accent-color);
}

.builtin-tab-btn:active {
	background-color: rgba(255, 255, 255, 0.12);
}

.builtin-tab-btn.active {
	background-color: rgba(0, 170, 255, 0.2);
	color: var(--accent-color);
}

.builtin-tab-btn.active:hover {
	background-color: rgba(0, 170, 255, 0.3);
}

#profiler-mini-panel {
	position: fixed;
	top: 60px;
	right: 15px;
	background-color: rgba(30, 30, 36, 0.85);
	border: 1px solid #4a4a5a54;
	border-radius: 8px;
	color: var(--text-primary);
	z-index: 9999;
	backdrop-filter: blur(8px);
	box-shadow: 0 6px 24px rgba(0, 0, 0, 0.5);
	font-family: var(--font-family);
	font-size: 11px;
	width: 350px;
	max-height: calc(100vh - 100px);
	overflow-y: auto;
	overflow-x: hidden;
	display: none;
	opacity: 0;
	transform: translateY(-10px) scale(0.98);
	transition: opacity 0.25s cubic-bezier(0.4, 0, 0.2, 1), 
	            transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
}

#profiler-mini-panel.visible {
	display: block;
	opacity: 1;
	transform: translateY(0) scale(1);
}

#profiler-mini-panel::-webkit-scrollbar {
	width: 6px;
}

#profiler-mini-panel::-webkit-scrollbar-track {
	background: transparent;
}

#profiler-mini-panel::-webkit-scrollbar-thumb {
	background: rgba(255, 255, 255, 0.15);
	border-radius: 3px;
	transition: background 0.2s;
}

#profiler-mini-panel::-webkit-scrollbar-thumb:hover {
	background: rgba(255, 255, 255, 0.25);
}

.mini-panel-content {
	padding: 0;
	font-size: 11px;
	line-height: 1.5;
	font-family: var(--font-mono);
	letter-spacing: 0.3px;
	user-select: none;
	-webkit-user-select: none;
}

.mini-panel-content .profiler-content {
	display: block !important;
	background: transparent;
}

.mini-panel-content .list-scroll-wrapper {
	max-height: calc(100vh - 120px);
	overflow-y: auto;
	overflow-x: hidden;
}

.mini-panel-content .list-scroll-wrapper::-webkit-scrollbar {
	width: 4px;
}

.mini-panel-content .list-scroll-wrapper::-webkit-scrollbar-track {
	background: transparent;
}

.mini-panel-content .list-scroll-wrapper::-webkit-scrollbar-thumb {
	background: rgba(255, 255, 255, 0.1);
	border-radius: 2px;
}

.mini-panel-content .list-scroll-wrapper::-webkit-scrollbar-thumb:hover {
	background: rgba(255, 255, 255, 0.2);
}

.mini-panel-content .parameters {
	background: transparent;
	border: none;
	box-shadow: none;
	padding: 4px;
}

.mini-panel-content .list-container.parameters {
	padding: 2px 6px 0px 6px !important;
}

.mini-panel-content .list-header {
	display: none;
	padding: 2px 4px;
	font-size: 11px;
	font-weight: 600;
	text-transform: uppercase;
	letter-spacing: 0.5px;
}

.mini-panel-content .list-item {
	border-bottom: 1px solid rgba(74, 74, 90, 0.2);
	transition: background-color 0.15s;
}

.mini-panel-content .list-item:last-child {
	border-bottom: none;
}

.mini-panel-content .list-item:hover {
	background-color: rgba(255, 255, 255, 0.04);
}

.mini-panel-content .list-item.actionable:hover {
	background-color: rgba(255, 255, 255, 0.06);
	cursor: pointer;
}

/* Style adjustments for lil-gui look */
.mini-panel-content .item-row {
	padding: 3px 8px;
	min-height: 24px;
}

.mini-panel-content .list-item-row {
	padding: 1px 4px;
	gap: 8px;
	min-height: 21px;
	align-items: center;
}

.mini-panel-content input[type="checkbox"] {
	width: 12px;
	height: 12px;
}

.mini-panel-content input[type="range"] {
	height: 18px;
}

.mini-panel-content .value-number input,
.mini-panel-content .value-slider input {
	background-color: rgba(0, 0, 0, 0.3);
	border: 1px solid rgba(74, 74, 90, 0.5);
	font-size: 10px;
}

.mini-panel-content .value-number input:focus,
.mini-panel-content .value-slider input:focus {
	border-color: var(--accent-color);
}

.mini-panel-content .value-slider {
	gap: 6px;
}

/* Compact nested items */
.mini-panel-content .list-item .list-item {
	margin-left: 8px;
}

.mini-panel-content .list-item .list-item .item-row,
.mini-panel-content .list-item .list-item .list-item-row {
	padding: 2px 6px;
	min-height: 22px;
}

/* Compact collapsible headers */
.mini-panel-content .collapsible .item-row,
.mini-panel-content .list-item-row.collapsible {
	padding: 2px 8px;
	font-weight: 600;
	min-height: 16px;
	display: flex;
	align-items: center;
}

.mini-panel-content .collapsible-icon {
	font-size: 10px;
	width: 14px;
	height: 14px;
}

.mini-panel-content .param-control input[type="range"] {
	height: 12px;
	margin-top: 1px;
	padding-top: 5px;
	user-select: none;
	-webkit-user-select: none;
	outline: none;
}

.mini-panel-content .param-control input[type="range"]::-webkit-slider-thumb {
	width: 14px;
	height: 14px;
	margin-top: -5px;
	user-select: none;
	-webkit-user-select: none;
}

.mini-panel-content .param-control input[type="range"]::-moz-range-thumb {
	width: 14px;
	height: 14px;
	user-select: none;
	-moz-user-select: none;
}

.mini-panel-content .list-children-container {
	padding-left: 0;
}

.mini-panel-content .param-control input[type="number"] {
	flex-basis: 60px !important;
}

.mini-panel-content .param-control {
	align-items: center;
}

.mini-panel-content .param-control select {
	font-size: 11px;
}

.mini-panel-content .list-item-wrapper {
	margin-top: 0;
	margin-bottom: 0;
}

#profiler-panel {
	position: fixed;
	z-index: 1001 !important;
	bottom: 0;
	left: 0;
	right: 0;
	height: 350px;
	background-color: var(--profiler-bg);
	backdrop-filter: blur(8px);
	border-top: 2px solid var(--profiler-border);
	color: var(--text-primary);
	display: flex;
	flex-direction: column;
	z-index: 1000;
	/*box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.5);*/
	transform: translateY(100%);
	transition: transform 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94), height 0.3s ease-out, width 0.3s ease-out;
	font-family: var(--font-mono);
}

#profiler-panel.resizing,
#profiler-panel.dragging {
	transition: none;
}

#profiler-panel.visible {
	transform: translateY(0);
}

#profiler-panel.maximized {
	height: 100vh;
}

/* Position-specific styles */
#profiler-panel.position-top {
	bottom: auto;
	top: 0;
	border-top: none;
	border-bottom: 2px solid var(--profiler-border);
	transform: translateY(-100%);
}

#profiler-panel.position-top.visible {
	transform: translateY(0);
}

#profiler-panel.position-bottom {
	/* Default position - already defined above */
}

#profiler-panel.position-left {
	top: 0;
	bottom: 0;
	left: 0;
	right: auto;
	width: 350px;
	height: 100%;
	border-top: none;
	border-right: 2px solid var(--profiler-border);
	transform: translateX(-100%);
}

#profiler-panel.position-left.visible {
	transform: translateX(0);
}

#profiler-panel.position-right {
	top: 0;
	bottom: 0;
	left: auto;
	right: 0;
	width: 350px;
	height: 100%;
	border-top: none;
	border-left: 2px solid var(--profiler-border);
	transform: translateX(100%);
}

#profiler-panel.position-right.visible {
	transform: translateX(0);
}

#profiler-panel.position-floating {
	border: 2px solid var(--profiler-border);
	border-radius: 8px;
	box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
	transform: none !important;
	overflow: hidden;
}

#profiler-panel.position-floating.visible {
	transform: none !important;
}

#profiler-panel.position-floating .profiler-header {
	border-radius: 6px 6px 0 0;
}

#profiler-panel.position-floating .panel-resizer {
	bottom: 0;
	right: 0;
	top: auto;
	left: auto;
	width: 16px;
	height: 16px;
	cursor: nwse-resize;
	border-radius: 0 0 6px 0;
}

#profiler-panel.position-floating .panel-resizer::after {
	content: '';
	position: absolute;
	right: 2px;
	bottom: 2px;
	width: 10px;
	height: 10px;
	background: linear-gradient(135deg, transparent 0%, transparent 45%, var(--profiler-border) 45%, var(--profiler-border) 55%, transparent 55%);
}


.panel-resizer {
	position: absolute;
	top: -2px;
	left: 0;
	width: 100%;
	height: 5px;
	cursor: ns-resize;
	z-index: 1001;
	touch-action: none;
}

#profiler-panel.position-top .panel-resizer {
	top: auto;
	bottom: -2px;
}

#profiler-panel.position-left .panel-resizer {
	top: 0;
	left: auto;
	right: -2px;
	width: 5px;
	height: 100%;
	cursor: ew-resize;
}

#profiler-panel.position-right .panel-resizer {
	top: 0;
	left: -2px;
	right: auto;
	width: 5px;
	height: 100%;
	cursor: ew-resize;
}

.profiler-header {
	display: flex;
	background-color: var(--profiler-header-bg);
	border-bottom: 1px solid var(--profiler-border);
	flex-shrink: 0;
	justify-content: space-between;
	align-items: stretch;

	overflow-x: auto;
	overflow-y: hidden;
	width: calc(100% - 134px);
	height: 38px;
	user-select: none;
	-webkit-user-select: none;
}

/* Adjust header width based on panel position */
#profiler-panel.position-right .profiler-header,
#profiler-panel.position-left .profiler-header {
	width: calc(100% - 134px);
}

#profiler-panel.position-bottom .profiler-header,
#profiler-panel.position-top .profiler-header {
	width: calc(100% - 134px);
}

/* Adjust header width when position toggle button is hidden (mobile) */
#profiler-panel.hide-position-toggle .profiler-header {
	width: calc(100% - 90px);
}

/* ===== RULES FOR WHEN THERE ARE NO TABS ===== */

/* Horizontal mode (bottom/top) without tabs */
#profiler-panel.position-bottom.no-tabs:not(.maximized),
#profiler-panel.position-top.no-tabs:not(.maximized) {
	height: 38px !important;
	min-height: 38px !important;
}

#profiler-panel.position-bottom.no-tabs .profiler-header,
#profiler-panel.position-top.no-tabs .profiler-header {
	width: 100%;
	height: 38px;
	border-bottom: none;
}

#profiler-panel.position-bottom.no-tabs .profiler-content-wrapper,
#profiler-panel.position-top.no-tabs .profiler-content-wrapper {
	display: none;
}

#profiler-panel.position-bottom.no-tabs .panel-resizer,
#profiler-panel.position-top.no-tabs .panel-resizer {
	display: none;
}

/* Vertical mode (right/left) without tabs */
#profiler-panel.position-right.no-tabs:not(.maximized),
#profiler-panel.position-left.no-tabs:not(.maximized) {
	width: 45px !important;
	min-width: 45px !important;
}

/* Vertical layout for header when no tabs */
#profiler-panel.position-right.no-tabs .profiler-header,
#profiler-panel.position-left.no-tabs .profiler-header {
	width: 100%;
	flex-direction: column;
	height: 100%;
	border-bottom: none;
}

/* Vertical layout for controls when no tabs */
#profiler-panel.position-right.no-tabs .profiler-controls,
#profiler-panel.position-left.no-tabs .profiler-controls {
	position: static;
	flex-direction: column-reverse;
	justify-content: flex-end;
	width: 100%;
	height: 100%;
	border-bottom: none;
	border-left: none;
	background: transparent;
}

#profiler-panel.position-right.no-tabs .profiler-controls button,
#profiler-panel.position-left.no-tabs .profiler-controls button {
	width: 100%;
	height: 45px;
	border-left: none;
	border-top: none;
	border-bottom: 1px solid var(--profiler-border);
}

#profiler-panel.position-right.no-tabs .profiler-content-wrapper,
#profiler-panel.position-left.no-tabs .profiler-content-wrapper {
	display: none;
}

#profiler-panel.position-right.no-tabs .profiler-tabs,
#profiler-panel.position-left.no-tabs .profiler-tabs {
	display: none;
}

#profiler-panel.position-right.no-tabs .panel-resizer,
#profiler-panel.position-left.no-tabs .panel-resizer {
	display: none;
}

/* Hide position toggle on mobile without tabs */
#profiler-panel.hide-position-toggle.position-right.no-tabs:not(.maximized),
#profiler-panel.hide-position-toggle.position-left.no-tabs:not(.maximized) {
	width: 45px !important;
	min-width: 45px !important;
}

/* Hide drag indicator on mobile devices */
#profiler-panel.hide-position-toggle .tab-btn.active::before {
	display: none;
}

.profiler-header::-webkit-scrollbar {
	width: 8px;
	height: 8px;
}

.profiler-header::-webkit-scrollbar-track {
	background: transparent;
}

.profiler-header::-webkit-scrollbar-thumb {
	background-color: rgba(0, 0, 0, 0.25);
	border-radius: 10px;
	transition: background 0.3s ease;
}

.profiler-header::-webkit-scrollbar-thumb:hover {
	background-color: rgba(0, 0, 0, 0.4);
}

.profiler-header::-webkit-scrollbar-corner {
	background: transparent;
}

#profiler-panel.dragging .profiler-header {
	cursor: grabbing !important;
}

#profiler-panel.dragging {
	opacity: 0.8;
}

.profiler-tabs {
	display: flex;
	cursor: grab;
	position: relative;
}

.profiler-tabs:active {
	cursor: grabbing;
}

.profiler-tabs::-webkit-scrollbar {
	width: 8px;
	height: 8px;
}

.profiler-tabs::-webkit-scrollbar-track {
	background: transparent;
}

.profiler-tabs::-webkit-scrollbar-thumb {
	background-color: rgba(0, 0, 0, 0.25);
	border-radius: 10px;
	transition: background 0.3s ease;
}

.profiler-tabs::-webkit-scrollbar-thumb:hover {
	background-color: rgba(0, 0, 0, 0.4);
}

.profiler-tabs::-webkit-scrollbar-corner {
	background: transparent;
}

.profiler-controls {
	display: flex;
	position: absolute;
	right: 0;
	top: 0;
	height: 38px;
	background: var(--profiler-header-bg);
	border-bottom: 1px solid var(--profiler-border);
}

.tab-btn {
	position: relative;
	background: transparent;
	border: none;
	/*border-right: 1px solid var(--profiler-border);*/
	color: var(--text-secondary);
	padding: 8px 18px;
	cursor: default;
	display: flex;
	align-items: center;
	font-family: var(--font-family);
	font-weight: 600;
	font-size: 14px;
	user-select: none;
	transition: opacity 0.2s, transform 0.2s;
	touch-action: none;
}

.tab-btn.active {
	border-bottom: 2px solid var(--accent-color);
	color: white;
}

.tab-btn.active::before {
	content: '';
	position: absolute;
	left: 3px;
	top: calc(50% - 2px);
	transform: translateY(-50%);
	color: var(--profiler-border);
	font-size: 18px;
	letter-spacing: -2px;
	opacity: 0.6;
}

.tab-btn.no-detach.active::before {
	display: none;
}

#floating-btn,
#maximize-btn,
#hide-panel-btn {
	background: transparent;
	border: none;
	border-left: 1px solid var(--profiler-border);
	color: var(--text-secondary);
	width: 45px;
	height: 100%;
	cursor: pointer;
	transition: all 0.2s;
	display: flex;
	align-items: center;
	justify-content: center;
	flex-shrink: 0;
}

/* Disable transitions in vertical mode to avoid broken animations */
#profiler-panel.position-right #floating-btn,
#profiler-panel.position-right #maximize-btn,
#profiler-panel.position-right #hide-panel-btn,
#profiler-panel.position-left #floating-btn,
#profiler-panel.position-left #maximize-btn,
#profiler-panel.position-left #hide-panel-btn {
	transition: background-color 0.2s, color 0.2s;
}

#floating-btn:hover,
#maximize-btn:hover,
#hide-panel-btn:hover {
	background-color: rgba(255, 255, 255, 0.1);
	color: var(--text-primary);
}

/* Hide maximize button when there are no tabs */
#profiler-panel.position-right.no-tabs #maximize-btn,
#profiler-panel.position-left.no-tabs #maximize-btn,
#profiler-panel.position-bottom.no-tabs #maximize-btn,
#profiler-panel.position-top.no-tabs #maximize-btn {
	display: none !important;
}

.profiler-content-wrapper {
	flex-grow: 1;
	overflow: hidden;
	position: relative;
}

.profiler-content {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	overflow-y: auto;
	font-size: 13px;
	visibility: hidden;
	opacity: 0;
	transition: opacity 0.2s, visibility 0.2s;
	box-sizing: border-box;
	display: flex;
	flex-direction: column;
	user-select: none;
	-webkit-user-select: none;
}

.profiler-content.active {
	visibility: visible;
	opacity: 1;
}

.profiler-content {
	overflow: auto; /* make sure scrollbars can appear */
}

.profiler-content::-webkit-scrollbar {
	width: 8px;
	height: 8px;
}

.profiler-content::-webkit-scrollbar-track {
	background: transparent;
}

.profiler-content::-webkit-scrollbar-thumb {
	background-color: rgba(0, 0, 0, 0.25);
	border-radius: 10px;
	transition: background 0.3s ease;
}

.profiler-content::-webkit-scrollbar-thumb:hover {
	background-color: rgba(0, 0, 0, 0.4);
}

.profiler-content::-webkit-scrollbar-corner {
	background: transparent;
}

.profiler-content {
	scrollbar-width: thin; /* "auto" | "thin" */
	scrollbar-color: rgba(0, 0, 0, 0.25) transparent;
}

.list-item-row {
	display: grid;
	align-items: center;
	padding: 4px 8px;
	border-radius: 3px;
	transition: background-color 0.2s;
	gap: 10px;
	border-bottom: none;
	user-select: none;
	-webkit-user-select: none;
}

.parameters .list-item-row {
	min-height: 31px;
}

.mini-panel-content .parameters .list-item-row {
	min-height: 21px;
}

.list-item-wrapper {
	margin-top: 2px;
	margin-bottom: 2px;
	user-select: none;
	-webkit-user-select: none;
}

.list-item-wrapper:first-child {
	/*margin-top: 0;*/
}

.list-item-wrapper:not(.header-wrapper):nth-child(odd) > .list-item-row {
	background-color: rgba(0,0,0,0.1);
}

.list-item-wrapper.header-wrapper>.list-item-row {
	color: var(--accent-color);
	background-color: rgba(0, 170, 255, 0.1);
}

.list-item-wrapper.header-wrapper>.list-item-row>.list-item-cell:first-child {
	font-weight: 600;
	line-height: 1;
}

.list-item-row.collapsible,
.list-item-row.actionable {
	cursor: pointer;
}

.list-item-row.collapsible {
	background-color: rgba(0, 170, 255, 0.15) !important;
	min-height: 23px;
}

.list-item-row.collapsible.alert,
.list-item-row.alert {
	background-color: rgba(244, 67, 54, 0.1) !important;
}

@media (hover: hover) {

	.list-item-row:hover:not(.collapsible):not(.no-hover),
	.list-item-row:hover:not(.no-hover),
	.list-item-row.actionable:hover,
	.list-item-row.collapsible.actionable:hover {
		background-color: rgba(255, 255, 255, 0.05) !important;
	}

	.list-item-row.collapsible:hover {
		background-color: rgba(0, 170, 255, 0.25) !important;
	}

}

.list-item-cell {
	white-space: pre;
	display: flex;
	align-items: center;
	user-select: none;
	-webkit-user-select: none;
}

.list-item-cell:not(:first-child) {
	justify-content: flex-end;
	font-weight: 600;
}

.list-header {
	display: grid;
	align-items: center;
	padding: 4px 8px;
	font-weight: 600;
	color: var(--text-secondary);
	padding-bottom: 6px;
	border-bottom: 1px solid var(--profiler-border);
	margin-bottom: 5px;
	gap: 10px;
	user-select: none;
	-webkit-user-select: none;
}

.list-item-wrapper.section-start {
	margin-top: 5px;
	margin-bottom: 5px;
}

.list-header .list-header-cell:not(:first-child) {
	text-align: right;
}

.list-children-container {
	padding-left: 1.5em;
	overflow: hidden;
	transition: max-height 0.1s ease-out;
	margin-top: 2px;
}

.list-children-container.closed {
	max-height: 0;
}

.item-toggler {
	display: inline-block;
	margin-right: 0.8em;
	text-align: left;
}

.list-item-row.open .item-toggler::before {
	content: '-';
}

.list-item-row:not(.open) .item-toggler::before {
	content: '+';
}

.list-item-cell .value.good {
	color: var(--color-green);
}

.list-item-cell .value.warn {
	color: var(--color-yellow);
}

.list-item-cell .value.bad {
	color: var(--color-red);
}

.list-scroll-wrapper {
	overflow-x: auto;
	width: 100%;
	user-select: none;
	-webkit-user-select: none;
}

.list-container.parameters .list-item-row:not(.collapsible) {
}

.graph-container {
	width: 100%;
	box-sizing: border-box;
	padding: 8px 0;
	position: relative;
}

.graph-svg {
	width: 100%;
	height: 80px;
	background-color: var(--profiler-header);
	border: 1px solid var(--profiler-border);
	border-radius: 4px;
}

.graph-path {
	stroke-width: 2;
	fill-opacity: 0.4;
}

.console-header {
	padding: 10px;
	border-bottom: 1px solid var(--profiler-border);
	display: flex;
	gap: 20px;
	flex-shrink: 0;
	align-items: center;
	justify-content: space-between;
}

.console-buttons-group {
	display: flex;
	gap: 20px;
}

.console-filter-input {
	background-color: var(--profiler-bg);
	border: 1px solid var(--profiler-border);
	color: var(--text-primary);
	border-radius: 4px;
	padding: 4px 8px;
	font-family: var(--font-mono);
	flex-grow: 1;
	max-width: 300px;
	border-radius: 15px;
}

.console-copy-button {
	background: transparent;
	border: none;
	color: var(--text-secondary);
	cursor: pointer;
	padding: 4px;
	display: flex;
	align-items: center;
	justify-content: center;
	border-radius: 4px;
	transition: color 0.2s, background-color 0.2s;
}

.console-copy-button:hover {
	color: var(--text-primary);
	background-color: var(--profiler-hover);
}

.console-copy-button.copied {
	color: var(--color-green);
}

#console-log {
	display: flex;
	flex-direction: column;
	gap: 4px;
	padding: 10px;
	overflow-y: auto;
	flex-grow: 1;
	user-select: text;
	-webkit-user-select: text;
}

.log-message {
	padding: 2px 5px;
	white-space: pre-wrap;
	word-break: break-all;
	border-radius: 3px;
	line-height: 1.5 !important;
}

.log-message.hidden {
	display: none;
}

.log-message.info {
	color: var(--text-primary);
}

.log-message.warn {
	color: var(--color-yellow);
}

.log-message.error {
	color: #f9dedc;
	background-color: rgba(244, 67, 54, 0.1);
}

.log-prefix {
	color: var(--text-secondary);
	margin-right: 8px;
}

.log-code {
	background-color: rgba(255, 255, 255, 0.1);
	border-radius: 3px;
	padding: 1px 4px;
}

.thumbnail-container {
	display: flex;
	align-items: center;
}

.thumbnail-svg {
	width: 40px;
	height: 22.5px;
	flex-shrink: 0;
	margin-right: 8px;
}

.param-control {
	display: flex;
	align-items: center;
	justify-content: flex-end;
	gap: 10px;
	width: 100%;
}

.param-control input,
.param-control select,
.param-control button {
	background-color: var(--profiler-bg);
	border: 1px solid var(--profiler-border);
	color: var(--text-primary);
	border-radius: 4px;
	padding: 4px 6px;
	padding-bottom: 2px;
	font-family: var(--font-mono);
	width: 100%;
	box-sizing: border-box;
}

.param-control select {
	padding-top: 3px;
	padding-bottom: 1px;
}

.param-control input[type="number"] {
	cursor: ns-resize;
}

.param-control input[type="color"] {
	padding: 2px;
}

.param-control button {
	cursor: pointer;
	transition: background-color 0.2s;
}

.param-control button:hover {
	background-color: var(--profiler-header);
}

.param-control-vector {
	display: flex;
	gap: 5px;
}

.custom-checkbox {
	display: inline-flex;
	align-items: center;
	cursor: pointer;
	gap: 8px;
	will-change: transform;
}

.custom-checkbox input {
	display: none;
}

.custom-checkbox .checkmark {
	width: 14px;
	height: 14px;
	border: 1px solid var(--accent-color);
	border-radius: 3px;
	display: inline-flex;
	justify-content: center;
	align-items: center;
	transition: background-color 0.2s, border-color 0.2s;
}

.custom-checkbox .checkmark::after {
	content: '';
	width: 6px;
	height: 6px;
	background-color: var(--accent-color);
	border-radius: 1px;
	display: block;
	transform: scale(0);
	transition: transform 0.2s;
}

.custom-checkbox input:checked+.checkmark {
	border-color: var(--accent-color);
}

.custom-checkbox input:checked+.checkmark::after {
	transform: scale(1);
}

.param-control input[type="range"] {
	-webkit-appearance: none;
	appearance: none;
	width: 100%;
	height: 16px;
	background: var(--profiler-header);
	border-radius: 5px;
	border: 1px solid var(--profiler-border);
	outline: none;
	padding: 0px;
	padding-top: 8px;
}

.param-control input[type="range"]::-webkit-slider-thumb {
	-webkit-appearance: none;
	appearance: none;
	width: 18px;
	height: 18px;
	background: var(--profiler-bg);
	border: 1px solid var(--accent-color);
	border-radius: 3px;
	cursor: pointer;
	margin-top: -8px;
}

.param-control input[type="range"]::-moz-range-thumb {
	width: 18px;
	height: 18px;
	background: var(--profiler-bg);
	border: 2px solid var(--accent-color);
	border-radius: 3px;
	cursor: pointer;
}

.param-control input[type="range"]::-moz-range-track {
	width: 100%;
	height: 16px;
	background: var(--profiler-header);
	border-radius: 5px;
	border: 1px solid var(--profiler-border);
}

/* Override .param-control styles for mini-panel-content */
.mini-panel-content input,
.mini-panel-content select,
.mini-panel-content button {
	padding: 2px 4px;
	height: 21px;
	line-height: 1.4;
	padding-top: 4px;
}

.mini-panel-content .param-control input,
.mini-panel-content .param-control select,
.mini-panel-content .param-control button {
	background-color: #1e1e24c2;
	line-height: 1.0;
}

.mini-panel-content .param-control select {
	padding: 2px 2px;
	padding-top: 3px;
}

.mini-panel-content .param-control input[type="number"]::-webkit-outer-spin-button,
.mini-panel-content .param-control input[type="number"]::-webkit-inner-spin-button {
	-webkit-appearance: none;
	margin: 0;
}

.mini-panel-content .param-control input[type="number"] {
	-moz-appearance: textfield;
}

.mini-panel-content .list-item-cell span {
	position: relative;
	top: 1px;
	margin-left: 2px;
}

.mini-panel-content .custom-checkbox .checkmark {
	width: 12px;
	height: 12px;
	margin-bottom: 2px;
	will-change: transform;
}

.mini-panel-content .list-container.parameters .list-item-row:not(.collapsible) {
	margin-bottom: 2px;
}

@media screen and (max-width: 450px) and (orientation: portrait) {

	.console-filter-input {
		max-width: 100px;
	}

}

/* Touch device optimizations */
@media (hover: none) and (pointer: coarse) {

	.panel-resizer {
		top: -10px !important;
		height: 20px !important;
	}

	#profiler-panel.position-top .panel-resizer {
		top: auto !important;
		bottom: -10px !important;
		height: 20px !important;
	}

	#profiler-panel.position-left .panel-resizer {
		right: -10px !important;
		width: 20px !important;
		height: 100% !important;
	}

	#profiler-panel.position-right .panel-resizer {
		left: -10px !important;
		width: 20px !important;
		height: 100% !important;
	}

	.detached-tab-resizer-top,
	.detached-tab-resizer-bottom {
		height: 10px !important;
	}

	.detached-tab-resizer-left,
	.detached-tab-resizer-right {
		width: 10px !important;
	}

}

.drag-preview-indicator {
	position: fixed;
	background-color: rgba(0, 170, 255, 0.2);
	border: 2px dashed var(--accent-color);
	z-index: 999;
	pointer-events: none;
	transition: all 0.2s ease-out;
}

/* Detached Tab Windows */
.detached-tab-panel {
	position: fixed;
	width: 500px;
	height: 400px;
	background: var(--profiler-bg);
	border: 1px solid var(--profiler-border);
	border-radius: 8px;
	box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
	z-index: 1002;
	display: flex;
	flex-direction: column;
	backdrop-filter: blur(10px);
	overflow: hidden;
	opacity: 1;
	visibility: visible;
	transition: opacity 0.2s, visibility 0.2s;
}

#profiler-panel:not(.visible) ~ * .detached-tab-panel,
body:has(#profiler-panel:not(.visible)) .detached-tab-panel {
	opacity: 0;
	visibility: hidden;
	pointer-events: none;
}

.detached-tab-header {
	background: var(--profiler-header-bg);
	padding: 0 7px 0 15px;
	font-family: var(--font-family);
	font-size: 14px;
	color: var(--text-primary);
	font-weight: 600;
	display: flex;
	justify-content: space-between;
	align-items: center;
	border-bottom: 1px solid var(--profiler-border);
	cursor: grab;
	user-select: none;
	height: 38px;
	flex-shrink: 0;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
	touch-action: none;
}

.detached-tab-header:active {
	cursor: grabbing;
}

.detached-header-controls {
	display: flex;
	gap: 5px;
}

.detached-reattach-btn {
	background: transparent;
	border: none;
	color: var(--text-secondary);
	font-family: var(--font-family);
	font-size: 18px;
	line-height: 1;
	cursor: pointer;
	padding: 4px 8px;
	border-radius: 4px;
	transition: all 0.2s;
	display: flex;
	align-items: center;
	justify-content: center;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}

.detached-reattach-btn:hover {
	background: rgba(0, 170, 255, 0.2);
	color: var(--accent-color);
}

.detached-tab-content {
	flex: 1;
	overflow: auto;
	position: relative;
	background: var(--profiler-bg);
}

.detached-tab-content::-webkit-scrollbar {
	width: 8px;
	height: 8px;
}

.detached-tab-content::-webkit-scrollbar-track {
	background: transparent;
}

.detached-tab-content::-webkit-scrollbar-thumb {
	background-color: rgba(0, 0, 0, 0.25);
	border-radius: 10px;
	transition: background 0.3s ease;
}

.detached-tab-content::-webkit-scrollbar-thumb:hover {
	background-color: rgba(0, 0, 0, 0.4);
}

.detached-tab-content::-webkit-scrollbar-corner {
	background: transparent;
}

.detached-tab-content .profiler-content {
	display: block !important;
	height: 100%;
	visibility: visible !important;
	opacity: 1 !important;
	position: relative !important;
}

.detached-tab-content .profiler-content > * {
	font-family: var(--font-mono);
	color: var(--text-primary);
}

.detached-tab-resizer {
	position: absolute;
	bottom: 0;
	right: 0;
	width: 20px;
	height: 20px;
	cursor: nwse-resize;
	z-index: 10;
	touch-action: none;
}

.detached-tab-resizer::after {
	content: '';
	position: absolute;
	bottom: 2px;
	right: 2px;
	width: 12px;
	height: 12px;
	border-right: 2px solid var(--profiler-border);
	border-bottom: 2px solid var(--profiler-border);
	border-bottom-right-radius: 6px;
	opacity: 0.5;
}

.detached-tab-resizer:hover::after {
	opacity: 1;
	border-color: var(--accent-color);
}

/* Edge resizers */
.detached-tab-resizer-top {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	height: 5px;
	cursor: ns-resize;
	z-index: 10;
	touch-action: none;
}

.detached-tab-resizer-right {
	position: absolute;
	top: 0;
	right: 0;
	bottom: 0;
	width: 5px;
	cursor: ew-resize;
	z-index: 10;
	touch-action: none;
}

.detached-tab-resizer-bottom {
	position: absolute;
	bottom: 0;
	left: 0;
	right: 0;
	height: 5px;
	cursor: ns-resize;
	z-index: 10;
	touch-action: none;
}

.detached-tab-resizer-left {
	position: absolute;
	top: 0;
	left: 0;
	bottom: 0;
	width: 5px;
	cursor: ew-resize;
	z-index: 10;
	touch-action: none;
}

/* Input number spin buttons - hide arrows */
/* Chrome, Safari, Edge, Opera */
#profiler-panel input[type="number"]::-webkit-outer-spin-button,
#profiler-panel input[type="number"]::-webkit-inner-spin-button,
.detached-tab-content input[type="number"]::-webkit-outer-spin-button,
.detached-tab-content input[type="number"]::-webkit-inner-spin-button {
	-webkit-appearance: none;
	margin: 0;
}

/* Firefox */
#profiler-panel input[type="number"],
.detached-tab-content input[type="number"] {
	-moz-appearance: textfield;
}
`,t=document.createElement("style");t.id="profiler-styles",t.textContent=e,document.head.appendChild(t)}}class Cpt{constructor(){this.tabs={},this.activeTabId=null,this.isResizing=!1,this.lastHeightBottom=350,this.lastWidthRight=450,this.position="bottom",this.detachedWindows=[],this.isMobile=this.detectMobile(),this.maxZIndex=1002,this.nextTabOriginalIndex=0,Mpt.init(),this.setupShell(),this.setupResizing(),this.isMobile&&this.setupOrientationListener(),this.setupWindowResizeListener()}detectMobile(){const e=navigator.userAgent||navigator.vendor||window.opera,t=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e),n="ontouchstart"in window||navigator.maxTouchPoints>0,r=window.innerWidth<=768;return t||n&&r}setupOrientationListener(){const e=()=>{const n=window.innerWidth>window.innerHeight?"right":"bottom";this.position!==n&&this.setPosition(n)};e(),window.addEventListener("orientationchange",e),window.addEventListener("resize",e)}setupWindowResizeListener(){const e=()=>{this.detachedWindows.forEach(n=>{this.constrainWindowToBounds(n.panel)})},t=()=>{if(this.panel.classList.contains("maximized"))return;const n=window.innerWidth,r=window.innerHeight;if(this.position==="bottom"){const i=this.panel.offsetHeight,o=r-50;i>o&&(this.panel.style.height=`${o}px`,this.lastHeightBottom=o)}else if(this.position==="right"){const i=this.panel.offsetWidth,o=n-50;i>o&&(this.panel.style.width=`${o}px`,this.lastWidthRight=o)}};window.addEventListener("resize",()=>{e(),t()})}constrainWindowToBounds(e){const t=window.innerWidth,n=window.innerHeight,r=e.offsetWidth,i=e.offsetHeight;let o=parseFloat(e.style.left)||e.offsetLeft||0,l=parseFloat(e.style.top)||e.offsetTop||0;const c=r/2,h=i/2;o+r>t+c&&(o=t+c-r),o<-c&&(o=-c),l+i>n+h&&(l=n+h-i),l<-h&&(l=-h),e.style.left=`${o}px`,e.style.top=`${l}px`}setupShell(){this.domElement=document.createElement("div"),this.domElement.id="profiler-shell",this.toggleButton=document.createElement("button"),this.toggleButton.id="profiler-toggle",this.toggleButton.innerHTML=`
<span id="builtin-tabs-container"></span>
<span id="toggle-text">
	<span id="fps-counter">-</span>
	<span class="fps-label">FPS</span>
</span>
<span id="toggle-icon">
	<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-device-ipad-horizontal-search"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11.5 20h-6.5a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v5.5" /><path d="M9 17h2" /><path d="M18 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M20.2 20.2l1.8 1.8" /></svg>
</span>
`,this.toggleButton.onclick=()=>this.togglePanel(),this.builtinTabsContainer=this.toggleButton.querySelector("#builtin-tabs-container"),this.miniPanel=document.createElement("div"),this.miniPanel.id="profiler-mini-panel",this.miniPanel.className="profiler-mini-panel",this.panel=document.createElement("div"),this.panel.id="profiler-panel";const e=document.createElement("div");e.className="profiler-header",this.tabsContainer=document.createElement("div"),this.tabsContainer.className="profiler-tabs";const t=document.createElement("div");t.className="profiler-controls",this.floatingBtn=document.createElement("button"),this.floatingBtn.id="floating-btn",this.floatingBtn.title="Switch to Right Side",this.floatingBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="15" y1="3" x2="15" y2="21"></line></svg>',this.floatingBtn.onclick=()=>this.togglePosition(),this.isMobile&&(this.floatingBtn.style.display="none",this.panel.classList.add("hide-position-toggle")),this.maximizeBtn=document.createElement("button"),this.maximizeBtn.id="maximize-btn",this.maximizeBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>',this.maximizeBtn.onclick=()=>this.toggleMaximize();const n=document.createElement("button");n.id="hide-panel-btn",n.textContent="-",n.onclick=()=>this.togglePanel(),t.append(this.floatingBtn,this.maximizeBtn,n),e.append(this.tabsContainer,t),this.contentWrapper=document.createElement("div"),this.contentWrapper.className="profiler-content-wrapper";const r=document.createElement("div");r.className="panel-resizer",this.panel.append(r,e,this.contentWrapper),this.domElement.append(this.toggleButton,this.miniPanel,this.panel),this.panel.classList.add(`position-${this.position}`)}setupResizing(){const e=this.panel.querySelector(".panel-resizer"),t=n=>{this.isResizing=!0,this.panel.classList.add("resizing"),e.setPointerCapture(n.pointerId);const r=n.clientX,i=n.clientY,o=this.panel.offsetHeight,l=this.panel.offsetWidth,c=m=>{if(!this.isResizing)return;m.preventDefault();const y=m.clientX,b=m.clientY;if(this.position==="bottom"){const w=o-(b-i);w>100&&w<window.innerHeight-50&&(this.panel.style.height=`${w}px`)}else if(this.position==="right"){const w=l-(y-r);w>200&&w<window.innerWidth-50&&(this.panel.style.width=`${w}px`)}},h=()=>{this.isResizing=!1,this.panel.classList.remove("resizing"),e.removeEventListener("pointermove",c),e.removeEventListener("pointerup",h),e.removeEventListener("pointercancel",h),this.panel.classList.contains("maximized")||(this.position==="bottom"?this.lastHeightBottom=this.panel.offsetHeight:this.position==="right"&&(this.lastWidthRight=this.panel.offsetWidth),this.saveLayout())};e.addEventListener("pointermove",c),e.addEventListener("pointerup",h),e.addEventListener("pointercancel",h)};e.addEventListener("pointerdown",t)}toggleMaximize(){this.panel.classList.contains("maximized")?(this.panel.classList.remove("maximized"),this.position==="bottom"?(this.panel.style.height=`${this.lastHeightBottom}px`,this.panel.style.width="100%"):this.position==="right"&&(this.panel.style.height="100%",this.panel.style.width=`${this.lastWidthRight}px`),this.maximizeBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>'):(this.position==="bottom"?this.lastHeightBottom=this.panel.offsetHeight:this.position==="right"&&(this.lastWidthRight=this.panel.offsetWidth),this.panel.classList.add("maximized"),this.position==="bottom"?(this.panel.style.height="100vh",this.panel.style.width="100%"):this.position==="right"&&(this.panel.style.height="100%",this.panel.style.width="100vw"),this.maximizeBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="8" y="8" width="12" height="12" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg>')}addTab(e){this.tabs[e.id]=e,e.originalIndex=this.nextTabOriginalIndex++,e.allowDetach===!1&&e.button.classList.add("no-detach"),e.onVisibilityChange=()=>this.updatePanelSize(),this.setupTabDragAndDrop(e),this.tabsContainer.appendChild(e.button),this.contentWrapper.appendChild(e.content),e.isVisible||(e.button.style.display="none",e.content.style.display="none"),e.builtin&&this.addBuiltinTab(e),this.updatePanelSize()}addBuiltinTab(e){const t=document.createElement("button");t.className="builtin-tab-btn",e.icon?t.innerHTML=e.icon:t.textContent=e.button.textContent.charAt(0).toUpperCase(),t.title=e.button.textContent;const n=document.createElement("div");n.className="mini-panel-content",n.style.display="none",e.builtinButton=t,e.miniContent=n,this.miniPanel.appendChild(n),t.onclick=r=>{if(r.stopPropagation(),this.panel.classList.contains("visible"))e.isVisible||e.show(),e.isDetached?e.detachedWindow&&this.bringWindowToFront(e.detachedWindow.panel):this.setActiveTab(e.id);else{const o=n.style.display!=="none"&&n.children.length>0;if(this.miniPanel.querySelectorAll(".mini-panel-content").forEach(l=>{l.style.display="none"}),this.builtinTabsContainer.querySelectorAll(".builtin-tab-btn").forEach(l=>{l.classList.remove("active")}),o)this.miniPanel.classList.remove("visible"),n.style.display="none",n.firstChild&&e.content.appendChild(n.firstChild);else{if(t.classList.add("active"),!n.firstChild){const l=e.content.querySelector(".list-scroll-wrapper")||e.content.firstElementChild;l&&n.appendChild(l)}n.style.display="block",this.miniPanel.classList.add("visible")}}},this.builtinTabsContainer.appendChild(t),e.builtinButton=t,e.miniContent=n,e.profiler=this,e.isVisible||(t.style.display="none",n.style.display="none",Array.from(this.builtinTabsContainer.querySelectorAll(".builtin-tab-btn")).some(i=>i.style.display!=="none")||(this.builtinTabsContainer.style.display="none"))}updatePanelSize(){Object.values(this.tabs).some(t=>!t.isDetached&&t.isVisible)?(this.panel.classList.remove("no-tabs"),Object.keys(this.tabs).length>0&&(this.position==="bottom"?parseInt(this.panel.style.height)===38&&(this.panel.style.height=`${this.lastHeightBottom}px`):this.position==="right"&&parseInt(this.panel.style.width)===45&&(this.panel.style.width=`${this.lastWidthRight}px`))):(this.panel.classList.add("no-tabs"),this.panel.classList.contains("maximized")&&(this.panel.classList.remove("maximized"),this.maximizeBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>'),this.position==="bottom"?this.panel.style.height="38px":this.position==="right"&&(this.panel.style.width="45px"))}setupTabDragAndDrop(e){if(this.isMobile){e.button.addEventListener("click",()=>{this.setActiveTab(e.id)});return}if(e.allowDetach===!1){e.button.addEventListener("click",()=>{this.setActiveTab(e.id)}),e.button.style.cursor="default";return}let t=!1,n,r,i=!1,o=null;const l=10,c=y=>{n=y.clientX,r=y.clientY,t=!1,i=!1,e.button.setPointerCapture(y.pointerId)},h=y=>{const b=y.clientX,w=y.clientY,A=Math.abs(b-n),I=Math.abs(w-r);!t&&(A>l||I>l)&&(t=!0,e.button.style.cursor="grabbing",e.button.style.opacity="0.5",e.button.style.transform="scale(1.05)",o=this.createPreviewWindow(e,b,w),o.style.opacity="0.8"),t&&o&&(i=!0,y.preventDefault(),o.style.left=`${b-200}px`,o.style.top=`${w-20}px`)},m=()=>{if(t&&i&&o){o.parentNode&&o.parentNode.removeChild(o);const y=parseInt(o.style.left)+200,b=parseInt(o.style.top)+20;this.detachTab(e,y,b)}else i||this.setActiveTab(e.id),o&&o.parentNode&&o.parentNode.removeChild(o);e.button.style.opacity="",e.button.style.transform="",e.button.style.cursor="",t=!1,i=!1,o=null,e.button.removeEventListener("pointermove",h),e.button.removeEventListener("pointerup",m),e.button.removeEventListener("pointercancel",m)};e.button.addEventListener("pointerdown",y=>{c(y),e.button.addEventListener("pointermove",h),e.button.addEventListener("pointerup",m),e.button.addEventListener("pointercancel",m)}),e.button.style.cursor="grab"}createPreviewWindow(e,t,n){const r=document.createElement("div");r.className="detached-tab-panel",r.style.left=`${t-200}px`,r.style.top=`${n-20}px`,r.style.pointerEvents="none",this.maxZIndex++,r.style.setProperty("z-index",this.maxZIndex,"important");const i=document.createElement("div");i.className="detached-tab-header";const o=document.createElement("span");o.textContent=e.button.textContent.replace("","").trim(),i.appendChild(o);const l=document.createElement("div");l.className="detached-header-controls";const c=document.createElement("button");c.className="detached-reattach-btn",c.innerHTML="",l.appendChild(c),i.appendChild(l);const h=document.createElement("div");h.className="detached-tab-content";const m=document.createElement("div");return m.className="detached-tab-resizer",r.appendChild(m),r.appendChild(i),r.appendChild(h),document.body.appendChild(r),r}detachTab(e,t,n){if(e.isDetached||e.allowDetach===!1)return;const i=Array.from(this.tabsContainer.children).map(h=>Object.keys(this.tabs).find(m=>this.tabs[m].button===h)).filter(h=>h!==void 0),o=i.indexOf(e.id);let l=null;if(this.activeTabId===e.id){e.setActive(!1);const h=i.filter(m=>m!==e.id&&!this.tabs[m].isDetached&&this.tabs[m].isVisible);if(h.length>0){for(let m=o-1;m>=0;m--)if(h.includes(i[m])){l=i[m];break}if(!l){for(let m=o+1;m<i.length;m++)if(h.includes(i[m])){l=i[m];break}}l||(l=h[0])}}e.button.parentNode&&e.button.parentNode.removeChild(e.button),e.content.parentNode&&e.content.parentNode.removeChild(e.content);const c=this.createDetachedWindow(e,t,n);this.detachedWindows.push(c),e.isDetached=!0,e.detachedWindow=c,l?this.setActiveTab(l):this.activeTabId===e.id&&(this.activeTabId=null),this.updatePanelSize(),this.saveLayout()}createDetachedWindow(e,t,n){const r=window.innerWidth,i=window.innerHeight,o=400,l=300;let c=t-200,h=n-20;c+o>r&&(c=r-o),c<0&&(c=0),h+l>i&&(h=i-l),h<0&&(h=0);const m=document.createElement("div");m.className="detached-tab-panel",m.style.left=`${c}px`,m.style.top=`${h}px`,this.panel.classList.contains("visible")||(m.style.opacity="0",m.style.visibility="hidden",m.style.pointerEvents="none"),e.isVisible||(m.style.display="none");const y=document.createElement("div");y.className="detached-tab-header";const b=document.createElement("span");b.textContent=e.button.textContent.replace("","").trim(),y.appendChild(b);const w=document.createElement("div");w.className="detached-header-controls";const A=document.createElement("button");A.className="detached-reattach-btn",A.innerHTML="",A.title="Reattach to main panel",A.onclick=()=>this.reattachTab(e),w.appendChild(A),y.appendChild(w);const I=document.createElement("div");I.className="detached-tab-content",I.appendChild(e.content),e.content.style.display="block",e.content.classList.add("active");const D=document.createElement("div");D.className="detached-tab-resizer-top";const P=document.createElement("div");P.className="detached-tab-resizer-right";const U=document.createElement("div");U.className="detached-tab-resizer-bottom";const j=document.createElement("div");j.className="detached-tab-resizer-left";const C=document.createElement("div");return C.className="detached-tab-resizer",m.appendChild(D),m.appendChild(P),m.appendChild(U),m.appendChild(j),m.appendChild(C),m.appendChild(y),m.appendChild(I),document.body.appendChild(m),this.setupDetachedWindowDrag(m,y,e),this.setupDetachedWindowResize(m,D,P,U,j,C),m.style.setProperty("z-index",this.maxZIndex,"important"),{panel:m,tab:e}}bringWindowToFront(e){this.maxZIndex++,e.style.setProperty("z-index",this.maxZIndex,"important")}setupDetachedWindowDrag(e,t,n){let r=!1,i,o,l,c;e.addEventListener("pointerdown",()=>{this.bringWindowToFront(e)});const h=b=>{if(b.target.classList.contains("detached-reattach-btn"))return;this.bringWindowToFront(e),r=!0,t.style.cursor="grabbing",t.setPointerCapture(b.pointerId),i=b.clientX,o=b.clientY;const w=e.getBoundingClientRect();l=w.left,c=w.top},m=b=>{if(!r)return;b.preventDefault();const w=b.clientX,A=b.clientY,I=w-i,D=A-o;let P=l+I,U=c+D;const j=window.innerWidth,C=window.innerHeight,Z=e.offsetWidth,ie=e.offsetHeight,se=Z/2,z=ie/2;P+Z>j+se&&(P=j+se-Z),P<-se&&(P=-se),U+ie>C+z&&(U=C+z-ie),U<-z&&(U=-z),e.style.left=`${P}px`,e.style.top=`${U}px`;const re=this.panel.getBoundingClientRect();w>=re.left&&w<=re.right&&A>=re.top&&A<=re.bottom?(e.style.opacity="0.5",this.panel.style.outline="2px solid var(--accent-color)"):(e.style.opacity="",this.panel.style.outline="")},y=b=>{if(!r)return;r=!1,t.style.cursor="",e.style.opacity="",this.panel.style.outline="";const w=b.clientX,A=b.clientY;if(w!==void 0&&A!==void 0){const I=this.panel.getBoundingClientRect();w>=I.left&&w<=I.right&&A>=I.top&&A<=I.bottom&&n?this.reattachTab(n):this.saveLayout()}t.removeEventListener("pointermove",m),t.removeEventListener("pointerup",y),t.removeEventListener("pointercancel",y)};t.addEventListener("pointerdown",b=>{h(b),t.addEventListener("pointermove",m),t.addEventListener("pointerup",y),t.addEventListener("pointercancel",y)}),t.style.cursor="grab"}setupDetachedWindowResize(e,t,n,r,i,o){const h=(m,y)=>{let b=!1,w,A,I,D,P,U;const j=ie=>{ie.preventDefault(),ie.stopPropagation(),b=!0,this.bringWindowToFront(e),m.setPointerCapture(ie.pointerId),w=ie.clientX,A=ie.clientY,I=e.offsetWidth,D=e.offsetHeight,P=e.offsetLeft,U=e.offsetTop},C=ie=>{if(!b)return;ie.preventDefault();const se=ie.clientX,z=ie.clientY,re=se-w,ye=z-A,H=window.innerWidth,Me=window.innerHeight;if(y==="right"||y==="corner"){const Oe=I+re,Ue=H-P;Oe>=250&&Oe<=Ue&&(e.style.width=`${Oe}px`)}if(y==="bottom"||y==="corner"){const Oe=D+ye,Ue=Me-U;Oe>=150&&Oe<=Ue&&(e.style.height=`${Oe}px`)}if(y==="left"){const Oe=I-re,Ue=P+I-250;if(Oe>=250){const Ie=P+re;Ie>=0&&Ie<=Ue&&(e.style.width=`${Oe}px`,e.style.left=`${Ie}px`)}}if(y==="top"){const Oe=D-ye,Ue=U+D-150;if(Oe>=150){const Ie=U+ye;Ie>=0&&Ie<=Ue&&(e.style.height=`${Oe}px`,e.style.top=`${Ie}px`)}}},Z=()=>{b=!1,m.removeEventListener("pointermove",C),m.removeEventListener("pointerup",Z),m.removeEventListener("pointercancel",Z),this.saveLayout()};m.addEventListener("pointerdown",ie=>{j(ie),m.addEventListener("pointermove",C),m.addEventListener("pointerup",Z),m.addEventListener("pointercancel",Z)})};h(t,"top"),h(n,"right"),h(r,"bottom"),h(i,"left"),h(o,"corner")}reattachTab(e){if(!e.isDetached)return;if(e.detachedWindow){const o=this.detachedWindows.indexOf(e.detachedWindow);o>-1&&this.detachedWindows.splice(o,1),e.detachedWindow.panel.parentNode&&e.detachedWindow.panel.parentNode.removeChild(e.detachedWindow.panel),e.detachedWindow=null}e.isDetached=!1;const n=Object.values(this.tabs).filter(o=>o.originalIndex!==void 0&&o.isVisible).sort((o,l)=>o.originalIndex-l.originalIndex),r=Array.from(this.tabsContainer.children);let i=0;for(const o of n){if(o.id===e.id)break;o.isDetached||i++}i>=r.length||r.length===0?this.tabsContainer.appendChild(e.button):this.tabsContainer.insertBefore(e.button,r[i]),this.contentWrapper.appendChild(e.content),this.setActiveTab(e.id),this.updatePanelSize(),this.saveLayout()}setActiveTab(e){this.activeTabId&&this.tabs[this.activeTabId]&&!this.tabs[this.activeTabId].isDetached&&this.tabs[this.activeTabId].setActive(!1),this.activeTabId=e,this.tabs[e]&&this.tabs[e].setActive(!0)}togglePanel(){this.panel.classList.toggle("visible"),this.toggleButton.classList.toggle("hidden");const e=this.panel.classList.contains("visible");if(e)this.savedMiniPanelState={isVisible:this.miniPanel.classList.contains("visible"),activeTabId:null,contentMap:{}},this.miniPanel.querySelectorAll(".mini-panel-content").forEach(t=>{t.style.display!=="none"&&t.firstChild&&Object.values(this.tabs).forEach(n=>{n.miniContent===t&&(this.savedMiniPanelState.activeTabId=n.id,n.content.appendChild(t.firstChild))})}),this.miniPanel.classList.remove("visible"),this.miniPanel.querySelectorAll(".mini-panel-content").forEach(t=>{t.style.display="none"}),this.builtinTabsContainer.querySelectorAll(".builtin-tab-btn").forEach(t=>{t.classList.remove("active")});else if(this.savedMiniPanelState&&this.savedMiniPanelState.isVisible&&this.savedMiniPanelState.activeTabId){const t=this.tabs[this.savedMiniPanelState.activeTabId];if(t&&t.miniContent&&t.builtinButton){this.miniPanel.classList.add("visible"),t.miniContent.style.display="block",t.builtinButton.classList.add("active");const n=t.content.querySelector(".list-scroll-wrapper, .profiler-content > *");n&&t.miniContent.appendChild(n)}}this.detachedWindows.forEach(t=>{e?(t.panel.style.opacity="",t.panel.style.visibility="",t.panel.style.pointerEvents=""):(t.panel.style.opacity="0",t.panel.style.visibility="hidden",t.panel.style.pointerEvents="none")})}togglePosition(){const e=this.position==="bottom"?"right":"bottom";this.setPosition(e)}setPosition(e){if(this.position===e)return;this.panel.style.transition="none";const t=this.panel.classList.contains("maximized");e==="right"?(this.position="right",this.floatingBtn.classList.add("active"),this.floatingBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><path d="M3 15h18"></path></svg>',this.floatingBtn.title="Switch to Bottom",this.panel.classList.remove("position-bottom"),this.panel.classList.add("position-right"),this.panel.style.bottom="",this.panel.style.top="0",this.panel.style.right="0",this.panel.style.left="",t?(this.panel.style.width="100vw",this.panel.style.height="100%"):(this.panel.style.width=`${this.lastWidthRight}px`,this.panel.style.height="100%")):(this.position="bottom",this.floatingBtn.classList.remove("active"),this.floatingBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="15" y1="3" x2="15" y2="21"></line></svg>',this.floatingBtn.title="Switch to Right Side",this.panel.classList.remove("position-right"),this.panel.classList.add("position-bottom"),this.panel.style.top="",this.panel.style.right="",this.panel.style.bottom="0",this.panel.style.left="0",t?(this.panel.style.width="100%",this.panel.style.height="100vh"):(this.panel.style.width="100%",this.panel.style.height=`${this.lastHeightBottom}px`)),setTimeout(()=>{this.panel.style.transition=""},50),this.updatePanelSize(),this.saveLayout()}saveLayout(){const e={position:this.position,lastHeightBottom:this.lastHeightBottom,lastWidthRight:this.lastWidthRight,activeTabId:this.activeTabId,detachedTabs:[]};this.detachedWindows.forEach(t=>{const n=t.tab,r=t.panel,i=parseFloat(r.style.left)||r.offsetLeft||0,o=parseFloat(r.style.top)||r.offsetTop||0,l=r.offsetWidth,c=r.offsetHeight;e.detachedTabs.push({tabId:n.id,originalIndex:n.originalIndex!==void 0?n.originalIndex:0,left:i,top:o,width:l,height:c})});try{localStorage.setItem("profiler-layout",JSON.stringify(e))}catch(t){console.warn("Failed to save profiler layout:",t)}}loadLayout(){try{const e=localStorage.getItem("profiler-layout");if(!e)return;const t=JSON.parse(e);if(t.detachedTabs&&t.detachedTabs.length>0){const i=window.innerWidth,o=window.innerHeight;t.detachedTabs=t.detachedTabs.map(l=>{let{left:c,top:h,width:m,height:y}=l;m>i&&(m=i-100),y>o&&(y=o-100);const b=m/2,w=y/2;return c+m>i+b&&(c=i+b-m),c<-b&&(c=-b),h+y>o+w&&(h=o+w-y),h<-w&&(h=-w),{...l,left:c,top:h,width:m,height:y}})}t.position&&(this.position=t.position),t.lastHeightBottom&&(this.lastHeightBottom=t.lastHeightBottom),t.lastWidthRight&&(this.lastWidthRight=t.lastWidthRight);const n=window.innerWidth,r=window.innerHeight;this.lastHeightBottom>r-50&&(this.lastHeightBottom=r-50),this.lastWidthRight>n-50&&(this.lastWidthRight=n-50),this.position==="right"?(this.floatingBtn.classList.add("active"),this.floatingBtn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><path d="M3 15h18"></path></svg>',this.floatingBtn.title="Switch to Bottom",this.panel.classList.remove("position-bottom"),this.panel.classList.add("position-right"),this.panel.style.bottom="",this.panel.style.top="0",this.panel.style.right="0",this.panel.style.left="",this.panel.style.width=`${this.lastWidthRight}px`,this.panel.style.height="100%"):this.panel.style.height=`${this.lastHeightBottom}px`,t.activeTabId&&t.detachedTabs&&t.detachedTabs.some(o=>o.tabId===t.activeTabId)&&this.setActiveTab(t.activeTabId),t.detachedTabs&&t.detachedTabs.length>0&&(this.pendingDetachedTabs=t.detachedTabs,this.restoreDetachedTabs()),this.updatePanelSize()}catch(e){console.warn("Failed to load profiler layout:",e)}}restoreDetachedTabs(){if(!this.pendingDetachedTabs||this.pendingDetachedTabs.length===0)return;if(this.pendingDetachedTabs.forEach(t=>{const n=this.tabs[t.tabId];if(!n||n.isDetached)return;t.originalIndex!==void 0&&(n.originalIndex=t.originalIndex),n.button.parentNode&&n.button.parentNode.removeChild(n.button),n.content.parentNode&&n.content.parentNode.removeChild(n.content);const r=this.createDetachedWindow(n,0,0);r.panel.style.left=`${t.left}px`,r.panel.style.top=`${t.top}px`,r.panel.style.width=`${t.width}px`,r.panel.style.height=`${t.height}px`,this.constrainWindowToBounds(r.panel),this.detachedWindows.push(r),n.isDetached=!0,n.detachedWindow=r}),this.pendingDetachedTabs=null,this.detachedWindows.forEach(t=>{const n=parseInt(getComputedStyle(t.panel).zIndex)||0;n>this.maxZIndex&&(this.maxZIndex=n)}),!this.activeTabId||!this.tabs[this.activeTabId]||this.tabs[this.activeTabId].isDetached||!this.tabs[this.activeTabId].isVisible){const n=Object.keys(this.tabs).filter(r=>!this.tabs[r].isDetached&&this.tabs[r].isVisible);if(n.length>0){const i=Array.from(this.tabsContainer.children).map(o=>Object.keys(this.tabs).find(l=>this.tabs[l].button===o)).filter(o=>o!==void 0&&!this.tabs[o].isDetached&&this.tabs[o].isVisible);this.setActiveTab(i[0]||n[0])}else this.activeTabId=null}this.updatePanelSize()}}class QB{constructor(e,t={}){this.id=e.toLowerCase(),this.button=document.createElement("button"),this.button.className="tab-btn",this.button.textContent=e,this.content=document.createElement("div"),this.content.id=`${this.id}-content`,this.content.className="profiler-content",this.isActive=!1,this.isVisible=!0,this.isDetached=!1,this.detachedWindow=null,this.allowDetach=t.allowDetach!==void 0?t.allowDetach:!0,this.builtin=t.builtin!==void 0?t.builtin:!1,this.icon=t.icon||null,this.builtinButton=null,this.miniContent=null,this.profiler=null,this.onVisibilityChange=null}setActive(e){this.button.classList.toggle("active",e),this.content.classList.toggle("active",e),this.isActive=e}show(){this.content.style.display="",this.button.style.display="",this.isVisible=!0,this.isDetached&&this.detachedWindow&&(this.detachedWindow.panel.style.display=""),this.onVisibilityChange&&this.onVisibilityChange(),this.showBuiltin()}hide(){this.content.style.display="none",this.button.style.display="none",this.isVisible=!1,this.isDetached&&this.detachedWindow&&(this.detachedWindow.panel.style.display="none"),this.onVisibilityChange&&this.onVisibilityChange(),this.hideBuiltin()}showBuiltin(){if(this.builtin&&(this.profiler&&this.profiler.builtinTabsContainer&&(this.profiler.builtinTabsContainer.style.display=""),this.builtinButton&&(this.builtinButton.style.display=""),this.miniContent&&this.profiler)){if(this.profiler.miniPanel.querySelectorAll(".mini-panel-content").forEach(e=>{e.style.display="none"}),this.profiler.builtinTabsContainer.querySelectorAll(".builtin-tab-btn").forEach(e=>{e.classList.remove("active")}),this.builtinButton&&this.builtinButton.classList.add("active"),!this.miniContent.firstChild){const e=this.content.querySelector(".list-scroll-wrapper")||this.content.firstElementChild;e&&this.miniContent.appendChild(e)}this.miniContent.style.display="block",this.profiler.miniPanel.classList.add("visible")}}hideBuiltin(){this.builtin&&(this.builtinButton&&(this.builtinButton.style.display="none"),this.miniContent&&(this.miniContent.style.display="none",this.miniContent.firstChild&&this.content.appendChild(this.miniContent.firstChild)),this.builtinButton&&this.builtinButton.classList.remove("active"),this.profiler&&(Array.from(this.profiler.miniPanel.querySelectorAll(".mini-panel-content")).some(n=>n.style.display!=="none")||this.profiler.miniPanel.classList.remove("visible"),Array.from(this.profiler.builtinTabsContainer.querySelectorAll(".builtin-tab-btn")).some(n=>n.style.display!=="none")||(this.profiler.builtinTabsContainer.style.display="none")))}}class kJ{constructor(...e){this.headers=e,this.children=[],this.domElement=document.createElement("div"),this.domElement.className="list-container",this.domElement.style.padding="10px",this.id=`list-${Math.random().toString(36).substr(2,9)}`,this.domElement.dataset.listId=this.id,this.gridStyleElement=document.createElement("style"),this.domElement.appendChild(this.gridStyleElement);const t=document.createElement("div");t.className="list-header",this.headers.forEach(n=>{const r=document.createElement("div");r.className="list-header-cell",r.textContent=n,t.appendChild(r)}),this.domElement.appendChild(t)}setGridStyle(e){this.gridStyleElement.textContent=`
[data-list-id="${this.id}"] > .list-header,
[data-list-id="${this.id}"] .list-item-row {
	grid-template-columns: ${e};
}
`}add(e){e.parent!==null&&e.parent.remove(e),e.domElement.classList.add("header-wrapper","section-start"),e.parent=this,this.children.push(e),this.domElement.appendChild(e.domElement)}remove(e){const t=this.children.indexOf(e);return t!==-1&&(this.children.splice(t,1),this.domElement.removeChild(e.domElement),e.parent=null),this}}class Apt{constructor(e=512){this.maxPoints=e,this.lines={},this.limit=0,this.limitIndex=0,this.domElement=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.domElement.setAttribute("class","graph-svg")}addLine(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("class","graph-path"),n.style.stroke=`var(${t})`,n.style.fill=`var(${t})`,this.domElement.appendChild(n),this.lines[e]={path:n,color:t,points:[]}}addPoint(e,t){const n=this.lines[e];n&&(n.points.push(t),n.points.length>this.maxPoints&&n.points.shift(),t>this.limit&&(this.limit=t,this.limitIndex=0))}resetLimit(){this.limit=0,this.limitIndex=0}update(){const e=this.domElement.clientWidth,t=this.domElement.clientHeight;if(e===0)return;const n=e/(this.maxPoints-1);for(const r in this.lines){const i=this.lines[r];let o=`M 0,${t}`;for(let c=0;c<i.points.length;c++){const h=c*n,m=t-i.points[c]/this.limit*t;o+=` L ${h},${m}`}o+=` L ${(i.points.length-1)*n},${t} Z`;const l=e-(i.points.length-1)*n;i.path.setAttribute("transform",`translate(${l}, 0)`),i.path.setAttribute("d",o)}this.limitIndex++>this.maxPoints&&this.resetLimit()}}class fu{constructor(...e){this.children=[],this.isOpen=!0,this.childrenContainer=null,this.parent=null,this.domElement=document.createElement("div"),this.domElement.className="list-item-wrapper",this.itemRow=document.createElement("div"),this.itemRow.className="list-item-row",this.userData={},this.data=e,this.data.forEach(t=>{const n=document.createElement("div");n.className="list-item-cell",t instanceof HTMLElement?n.appendChild(t):n.append(String(t)),this.itemRow.appendChild(n)}),this.domElement.appendChild(this.itemRow),this.onItemClick=this.onItemClick.bind(this)}onItemClick(e){e.target.closest("button, a, input, label")||this.toggle()}add(e,t=this.children.length){return e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.splice(t,0,e),this.itemRow.classList.add("collapsible"),this.childrenContainer||(this.childrenContainer=document.createElement("div"),this.childrenContainer.className="list-children-container",this.childrenContainer.classList.toggle("closed",!this.isOpen),this.domElement.appendChild(this.childrenContainer),this.itemRow.addEventListener("click",this.onItemClick)),this.childrenContainer.insertBefore(e.domElement,this.childrenContainer.children[t]||null),this.updateToggler(),this}remove(e){const t=this.children.indexOf(e);return t!==-1&&(this.children.splice(t,1),this.childrenContainer.removeChild(e.domElement),e.parent=null,this.children.length===0&&(this.itemRow.classList.remove("collapsible"),this.itemRow.removeEventListener("click",this.onItemClick),this.childrenContainer.remove(),this.childrenContainer=null),this.updateToggler()),this}updateToggler(){const e=this.itemRow.querySelector(".list-item-cell:first-child");let t=this.itemRow.querySelector(".item-toggler");this.children.length>0?(t||(t=document.createElement("span"),t.className="item-toggler",e.prepend(t)),this.isOpen&&this.itemRow.classList.add("open")):t&&t.remove()}toggle(){return this.isOpen=!this.isOpen,this.itemRow.classList.toggle("open",this.isOpen),this.childrenContainer&&this.childrenContainer.classList.toggle("closed",!this.isOpen),this}close(){return this.isOpen&&this.toggle(),this}}function Jl(s=null){const e=document.createElement("span");return e.className="value",s!==null&&(e.id=s),e}function hh(s,e){const t=s instanceof HTMLElement?s:document.getElementById(s);t&&t.textContent!==e&&(t.textContent=e)}function Npt(s){const e=s.lastIndexOf("/");if(e===-1)return{path:"",name:s.trim()};const t=s.substring(0,e).trim(),n=s.substring(e+1).trim();return{path:t,name:n}}function Ppt(s){return s.replace(/([a-z0-9])([A-Z])/g,"$1 $2").trim()}class Rpt extends QB{constructor(e={}){super("Performance",e);const t=new kJ("Name","CPU","GPU","Total");t.setGridStyle("minmax(200px, 2fr) 80px 80px 80px"),t.domElement.style.minWidth="600px";const n=document.createElement("div");n.className="list-scroll-wrapper",n.appendChild(t.domElement),this.content.appendChild(n);const r=document.createElement("div");r.className="graph-container";const i=new Apt;i.addLine("fps","--accent-color"),r.append(i.domElement);const o=new fu("Graph Stats",Jl(),Jl(),Jl("graph-fps-counter"));t.add(o);const l=new fu(r);l.itemRow.childNodes[0].style.gridColumn="1 / -1",o.add(l);const c=new fu("Frame Stats",Jl(),Jl(),Jl());t.add(c);const h=new fu("Miscellaneous & Idle",Jl(),Jl(),Jl());h.domElement.firstChild.style.backgroundColor="#00ff0b1a",h.domElement.firstChild.classList.add("no-hover"),c.add(h),this.notInUse=new Map,this.frameStats=c,this.graphStats=o,this.graph=i,this.miscellaneous=h,this.currentRender=null,this.currentItem=null,this.frameItems=new Map}resolveStats(e,t){const n=e.getStatsData(t.cid);let r=n.item;if(r===void 0)r=new fu(Jl(),Jl(),Jl(),Jl()),t.name?t.isComputeStats===!0&&(t.name=`${t.name} [ Compute ]`):t.name=`Unnamed ${t.cid}`,r.userData.name=t.name,this.currentItem.add(r),n.item=r;else{r.userData.name=t.name,this.notInUse.has(t.cid)&&(r.domElement.firstElementChild.classList.remove("alert"),this.notInUse.delete(t.cid));const l=t.parent.children.indexOf(t);(r.parent===null||r.parent.children.indexOf(r)!==l)&&this.currentItem.add(r,l)}let i=r.userData.name;t.isComputeStats&&(i+=" [ Compute ]"),hh(r.data[0],i),hh(r.data[1],n.cpu.toFixed(2)),hh(r.data[2],t.gpuNotAvailable===!0?"-":n.gpu.toFixed(2)),hh(r.data[3],n.total.toFixed(2));const o=this.currentItem;this.currentItem=r;for(const l of t.children)this.resolveStats(e,l);this.currentItem=o,this.frameItems.set(t.cid,r)}updateGraph(e){this.graph.addPoint("fps",e.fps),this.graph.update()}addNotInUse(e,t){t.domElement.firstElementChild.classList.add("alert"),this.notInUse.set(e,{item:t,time:performance.now()}),this.updateNotInUse(e)}updateNotInUse(e){const{item:t,time:n}=this.notInUse.get(e),r=performance.now(),o=5-Math.floor((r-n)/1e3);if(o>=0){const l="*".repeat(Math.max(0,o)),c=t.domElement.querySelector(".list-item-cell .value");hh(c,t.userData.name+" (not in use) "+l)}else t.domElement.firstElementChild.classList.remove("alert"),t.parent.remove(t),this.notInUse.delete(e)}updateText(e,t){const n=new Map(this.frameItems);this.frameItems.clear(),this.currentItem=this.frameStats;for(const r of t.children)this.resolveStats(e,r);for(const[r,i]of n)this.frameItems.has(r)||(this.addNotInUse(r,i),n.delete(r));for(const r of this.notInUse.keys())this.updateNotInUse(r);hh("graph-fps-counter",e.fps.toFixed()+" FPS"),hh(this.frameStats.data[1],t.cpu.toFixed(2)),hh(this.frameStats.data[2],t.gpu.toFixed(2)),hh(this.frameStats.data[3],t.total.toFixed(2)),hh(this.miscellaneous.data[1],t.miscellaneous.toFixed(2)),hh(this.miscellaneous.data[2],"-"),hh(this.miscellaneous.data[3],t.miscellaneous.toFixed(2)),this.currentItem=null}}class Ipt extends QB{constructor(e={}){super("Console",e),this.filters={info:!0,warn:!0,error:!0},this.filterText="",this.buildHeader(),this.logContainer=document.createElement("div"),this.logContainer.id="console-log",this.content.appendChild(this.logContainer)}buildHeader(){const e=document.createElement("div");e.className="console-header";const t=document.createElement("input");t.type="text",t.className="console-filter-input",t.placeholder="Filter...",t.addEventListener("input",i=>{this.filterText=i.target.value.toLowerCase(),this.applyFilters()});const n=document.createElement("button");n.className="console-copy-button",n.title="Copy all",n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>',n.addEventListener("click",()=>this.copyAll(n));const r=document.createElement("div");r.className="console-buttons-group",Object.keys(this.filters).forEach(i=>{const o=document.createElement("label");o.className="custom-checkbox",o.style.color=`var(--${i==="info"?"text-primary":"color-"+(i==="warn"?"yellow":"red")})`;const l=document.createElement("input");l.type="checkbox",l.checked=this.filters[i],l.dataset.type=i;const c=document.createElement("span");c.className="checkmark",o.appendChild(l),o.appendChild(c),o.append(i.charAt(0).toUpperCase()+i.slice(1)),r.appendChild(o)}),r.addEventListener("change",i=>{const o=i.target.dataset.type;o in this.filters&&(this.filters[o]=i.target.checked,this.applyFilters())}),r.appendChild(n),e.appendChild(t),e.appendChild(r),this.content.appendChild(e)}applyFilters(){this.logContainer.querySelectorAll(".log-message").forEach(t=>{const n=t.dataset.type,r=t.dataset.rawText.toLowerCase(),i=this.filters[n],o=r.includes(this.filterText);t.classList.toggle("hidden",!(i&&o))})}copyAll(e){const n=this.logContainer.ownerDocument.defaultView.getSelection(),r=n.toString(),i=r&&this.logContainer.contains(n.anchorNode);let o;if(i)o=r;else{const l=this.logContainer.querySelectorAll(".log-message:not(.hidden)");o=Array.from(l).map(c=>c.dataset.rawText).join(`
`)}navigator.clipboard.writeText(o),e.classList.add("copied"),setTimeout(()=>e.classList.remove("copied"),350)}_getIcon(e,t){let n;return t==="tip"?n="":t==="tsl"?n="":t==="webgpurenderer"?n="":e==="warn"?n="":e==="error"?n="":e==="info"&&(n=""),n}_formatMessage(e,t){const n=document.createDocumentFragment(),r=t.match(/^([\w\.]+:\s)/);let i=t;if(r){const l=r[0],c=l.slice(0,-2).split("."),h=(c.length>1?c[c.length-1]:c[0])+":",m=this._getIcon(e,h.split(":")[0].toLowerCase());n.appendChild(document.createTextNode(m+" "));const y=document.createElement("span");y.className="log-prefix",y.textContent=h,n.appendChild(y),i=t.substring(l.length)}const o=i.split(/(".*?"|'.*?'|`.*?`)/g).map(l=>l.trim()).filter(Boolean);return o.forEach((l,c)=>{if(/^("|'|`)/.test(l)){const h=document.createElement("span");h.className="log-code",h.textContent=l.slice(1,-1),n.appendChild(h)}else c>0&&(l=" "+l),c<o.length-1&&(l+=" "),n.appendChild(document.createTextNode(l))}),n}addMessage(e,t){const n=document.createElement("div");n.className=`log-message ${e}`,n.dataset.type=e,n.dataset.rawText=t,n.appendChild(this._formatMessage(e,t));const r=this.filters[e],i=t.toLowerCase().includes(this.filterText);n.classList.toggle("hidden",!(r&&i)),this.logContainer.appendChild(n),this.logContainer.scrollTop=this.logContainer.scrollHeight,this.logContainer.children.length>200&&this.logContainer.removeChild(this.logContainer.firstChild)}}class Ow extends _d{constructor(){super(),this.domElement=document.createElement("div"),this.domElement.className="param-control",this._onChangeFunction=null,this.addEventListener("change",e=>{requestAnimationFrame(()=>{this._onChangeFunction&&this._onChangeFunction(e.value)})})}setValue(){return this.dispatchChange(),this}getValue(){return null}dispatchChange(){this.dispatchEvent({type:"change",value:this.getValue()})}onChange(e){return this._onChangeFunction=e,this}}class PNe extends Ow{constructor({value:e=0,step:t=.1,min:n=-1/0,max:r=1/0}){super(),this.input=document.createElement("input"),this.input.type="number",this.input.value=e,this.input.step=t,this.input.min=n,this.input.max=r,this.input.addEventListener("change",this._onChangeValue.bind(this)),this.domElement.appendChild(this.input),this.addDragHandler()}_onChangeValue(){const e=parseFloat(this.input.value),t=parseFloat(this.input.min),n=parseFloat(this.input.max);e>n?this.input.value=n:e<t?this.input.value=t:isNaN(e)&&(this.input.value=t),this.dispatchChange()}addDragHandler(){let e=!1,t,n;this.input.addEventListener("mousedown",r=>{e=!0,t=r.clientY,n=parseFloat(this.input.value),document.body.style.cursor="ns-resize"}),document.addEventListener("mousemove",r=>{if(e){const i=t-r.clientY,o=parseFloat(this.input.step)||1,l=parseFloat(this.input.min),c=parseFloat(this.input.max);let h=o;!isNaN(c)&&isFinite(l)&&(h=(c-l)/100);const m=i*h;let y=n+m;y=Math.max(l,Math.min(y,c));const b=(String(o).split(".")[1]||[]).length;this.input.value=y.toFixed(b),this.input.dispatchEvent(new Event("input")),this.dispatchChange()}}),document.addEventListener("mouseup",()=>{e&&(e=!1,document.body.style.cursor="default")})}setValue(e){return this.input.value=e,super.setValue(e)}getValue(){return parseFloat(this.input.value)}}class kpt extends Ow{constructor({value:e=!1}){super();const t=document.createElement("label");t.className="custom-checkbox";const n=document.createElement("input");n.type="checkbox",n.checked=e,this.checkbox=n;const r=document.createElement("span");r.className="checkmark",t.appendChild(n),t.appendChild(r),this.domElement.appendChild(t),n.addEventListener("change",()=>{this.dispatchChange()})}setValue(e){return this.checkbox.value=e,super.setValue(e)}getValue(){return this.checkbox.checked}}class Dpt extends Ow{constructor({value:e=0,min:t=0,max:n=1,step:r=.01}){super(),this.slider=document.createElement("input"),this.slider.type="range",this.slider.min=t,this.slider.max=n,this.slider.step=r;const i=new PNe({value:e,min:t,max:n,step:r});this.numberInput=i.input,this.numberInput.style.flexBasis="80px",this.numberInput.style.flexShrink="0",this.slider.value=e,this.domElement.append(this.slider,this.numberInput),this.slider.addEventListener("input",()=>{this.numberInput.value=this.slider.value,this.dispatchChange()}),i.addEventListener("change",()=>{this.slider.value=parseFloat(this.numberInput.value),this.dispatchChange()})}setValue(e){return this.slider.value=e,this.numberInput.value=e,super.setValue(e)}getValue(){return parseFloat(this.slider.value)}step(e){return this.slider.step=e,this.numberInput.step=e,this}}class Opt extends Ow{constructor({options:e=[],value:t=""}){super();const n=document.createElement("select"),r=(i,o)=>{const l=document.createElement("option");return l.value=i,l.textContent=i,o==t&&(l.selected=!0),n.appendChild(l),l};Array.isArray(e)?e.forEach(i=>r(i,i)):Object.entries(e).forEach(([i,o])=>r(i,o)),this.domElement.appendChild(n),n.addEventListener("change",()=>{this.dispatchChange()}),this.options=e,this.select=n}getValue(){const e=this.options;return Array.isArray(e)?e[this.select.selectedIndex]:e[this.select.value]}}class Lpt extends Ow{constructor({value:e="#ffffff"}){super();const t=document.createElement("input");t.type="color",t.value=this._getColorHex(e),this.colorInput=t,this._value=e,t.addEventListener("input",()=>{const n=t.value;this._value.isColor?this._value.setHex(parseInt(n.slice(1),16)):this._value=n,this.dispatchChange()}),this.domElement.appendChild(t)}_getColorHex(e){return e.isColor&&(e=e.getHex()),typeof e=="number"?e=`#${e.toString(16)}`:e[0]!=="#"&&(e="#"+e),e}getValue(){let e=this._value;return typeof e=="string"&&(e=parseInt(e.slice(1),16)),e}}class Fpt extends Ow{constructor({text:e="Button",value:t=()=>{}}){super();const n=document.createElement("button");n.textContent=e,n.onclick=t,this.domElement.appendChild(n)}}class DJ{constructor(e,t){this.parameters=e,this.name=t,this.paramList=new fu(t),this.objects=[]}close(){return this.paramList.close(),this}add(e,t,...n){const i=typeof e[t];let o=null;return typeof n[0]=="object"?o=this.addSelect(e,t,n[0]):i==="number"?n.length>=2?o=this.addSlider(e,t,...n):o=this.addNumber(e,t,...n):i==="boolean"?o=this.addBoolean(e,t):i==="function"&&(o=this.addButton(e,t,...n)),o}_addParameter(e,t,n,r){n.name=i=>(r.data[0].textContent=i,n),n.listen=()=>{const i=()=>{const o=n.getValue(),l=e[t];o!==l&&n.setValue(l),requestAnimationFrame(i)};return requestAnimationFrame(i),n},this._registerParameter(e,t,n,r)}_registerParameter(e,t,n,r){this.objects.push({object:e,key:t,editor:n,subItem:r})}addFolder(e){const t=new DJ(this.parameters,e);return this.paramList.add(t.paramList),t}addBoolean(e,t){const n=e[t],r=new kpt({value:n});r.addEventListener("change",({value:c})=>{e[t]=c});const i=Jl();i.textContent=t;const o=new fu(i,r.domElement);this.paramList.add(o);const l=o.domElement.firstChild;return l.classList.add("actionable"),l.addEventListener("click",c=>{if(c.target.closest("label"))return;const h=l.querySelector('input[type="checkbox"]');h&&(h.checked=!h.checked,h.dispatchEvent(new Event("change")))}),this._addParameter(e,t,r,o),r}addSelect(e,t,n){const r=e[t],i=new Opt({options:n,value:r});i.addEventListener("change",({value:h})=>{e[t]=h});const o=Jl();o.textContent=t;const l=new fu(o,i.domElement);return this.paramList.add(l),l.domElement.firstChild.classList.add("actionable"),this._addParameter(e,t,i,l),i}addColor(e,t){const n=e[t],r=new Lpt({value:n});r.addEventListener("change",({value:c})=>{e[t]=c});const i=Jl();i.textContent=t;const o=new fu(i,r.domElement);return this.paramList.add(o),o.domElement.firstChild.classList.add("actionable"),this._addParameter(e,t,r,o),r}addSlider(e,t,n=0,r=1,i=.01){const o=e[t],l=new Dpt({value:o,min:n,max:r,step:i});l.addEventListener("change",({value:y})=>{e[t]=y});const c=Jl();c.textContent=t;const h=new fu(c,l.domElement);return this.paramList.add(h),h.domElement.firstChild.classList.add("actionable"),this._addParameter(e,t,l,h),l}addNumber(e,t,...n){const r=e[t],[i,o]=n,l=new PNe({value:r,min:i,max:o});l.addEventListener("change",({value:y})=>{e[t]=y});const c=Jl();c.textContent=t;const h=new fu(c,l.domElement);return this.paramList.add(h),h.domElement.firstChild.classList.add("actionable"),this._addParameter(e,t,l,h),l}addButton(e,t){const n=e[t],r=new Fpt({text:t,value:n});r.addEventListener("change",({value:l})=>{e[t]=l});const i=new fu(r.domElement);return i.itemRow.childNodes[0].style.gridColumn="1 / -1",this.paramList.add(i),i.domElement.firstChild.classList.add("actionable"),r.name=l=>(r.domElement.childNodes[0].textContent=l,r),this._registerParameter(e,t,r,i),r}}class Bpt extends QB{constructor(e={}){super("Parameters",e);const t=new kJ("Property","Value");t.domElement.classList.add("parameters"),t.setGridStyle(".5fr 1fr"),t.domElement.style.minWidth="300px";const n=document.createElement("div");n.className="list-scroll-wrapper",n.appendChild(t.domElement),this.content.appendChild(n),this.paramList=t,this.groups=[]}createGroup(e){const t=new DJ(this,e);return this.paramList.add(t.paramList),this.groups.push(t),t}}class Upt extends QB{constructor(e={}){super("Viewer",e);const t=new kJ("Viewer","Name");t.setGridStyle("150px minmax(200px, 2fr)"),t.domElement.style.minWidth="400px";const n=document.createElement("div");n.className="list-scroll-wrapper",n.appendChild(t.domElement),this.content.appendChild(n);const r=new fu("Nodes");t.add(r),this.itemLibrary=new Map,this.folderLibrary=new Map,this.currentDataList=[],this.nodeList=t,this.nodes=r}getFolder(e){let t=this.folderLibrary.get(e);return t===void 0&&(t=new fu(e),this.folderLibrary.set(e,t),this.nodeList.add(t)),t}addNodeItem(e){let t=this.itemLibrary.get(e.id);if(t===void 0){const n=e.name,r=e.canvasTarget.domElement;t=new fu(r,n),t.itemRow.children[1].style["justify-content"]="flex-start",this.itemLibrary.set(e.id,t)}return t}update(e,t){if(!this.isActive&&!this.isDetached)return;const n=[...this.currentDataList];for(const i of n)if(this.itemLibrary.has(i.id)&&t.indexOf(i)===-1){const o=this.itemLibrary.get(i.id),l=o.parent;l.remove(o),this.folderLibrary.has(l.data[0])&&l.children.length===0&&(l.parent.remove(l),this.folderLibrary.delete(l.data[0])),this.itemLibrary.delete(i.id)}const r={};for(const i of t){const o=this.addNodeItem(i),l=e.getCanvasTarget(),c=i.path;if(c){const m=this.getFolder(c);r[c]===void 0&&(r[c]=0),(m.parent===null||o.parent!==m||m.children.indexOf(o)!==r[c])&&m.add(o),r[c]++}else o.parent||this.nodes.add(o);this.currentDataList=t;const h=i7e.resetRendererState(e);e.toneMapping=Ta,e.outputColorSpace=vd,e.setCanvasTarget(i.canvasTarget),i.quad.render(e),e.setCanvasTarget(l),i7e.restoreRendererState(e,h)}}}const zpt=hd(([s,e])=>{const t=_l(0);yat(()=>{const{width:l,height:c}=e.value;t.value=l/c});const n=s.sub(.5),i=kC(n.x.div(t),n.y).add(.5),o=cL(0,i.x).mul(cL(i.x,1)).mul(cL(0,i.y)).mul(cL(i.y,1));return cw(i,o)});class Vpt extends Ept{constructor(){super();const e=new Cpt,t=new Bpt({builtin:!0,icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M4 6l8 0" /><path d="M16 6l4 0" /><path d="M8 12m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M4 12l2 0" /><path d="M10 12l10 0" /><path d="M17 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M4 18l11 0" /><path d="M19 18l1 0" /></svg>'});t.hide(),e.addTab(t);const n=new Upt;n.hide(),e.addTab(n);const r=new Rpt;e.addTab(r);const i=new Ipt;e.addTab(i),e.loadLayout(),e.activeTabId||e.setActiveTab(r.id),this.statsData=new Map,this.canvasNodes=new Map,this.profiler=e,this.performance=r,this.console=i,this.parameters=t,this.viewer=n,this.once={},this.displayCycle={text:{needsUpdate:!1,duration:.25,time:0},graph:{needsUpdate:!1,duration:.02,time:0}}}get domElement(){return this.profiler.domElement}resolveConsoleOnce(e,t){const n=e+t;this.once[n]!==!0&&(this.resolveConsole(e,t),this.once[n]=!0)}resolveConsole(e,t,n=null){switch(e){case"log":this.console.addMessage("info",t),console.log(t);break;case"warn":this.console.addMessage("warn",t),n&&n.isStackTrace?console.warn(n.getError(t)):console.warn(t);break;case"error":this.console.addMessage("error",t),n&&n.isStackTrace?console.error(n.getError(t)):console.error(t);break}}init(){const e=this.getRenderer();let t=`THREE.WebGPURenderer: ${fx} [ "`;e.backend.isWebGPUBackend?t+="WebGPU":e.backend.isWebGLBackend&&(t+="WebGL2"),t+='" ]',this.console.addMessage("info",t),e.inspector.domElement.parentElement===null&&e.domElement.parentElement!==null&&e.domElement.parentElement.appendChild(e.inspector.domElement)}setRenderer(e){return super.setRenderer(e),e!==null&&(TVe(this.resolveConsole.bind(this)),this.isAvailable&&e.init().then(()=>{e.backend.trackTimestamp=!0,e.hasFeature("timestamp-query")!==!0&&this.console.addMessage("error","THREE.Inspector: GPU Timestamp Queries not available.")})),this}createParameters(e){return this.parameters.isVisible===!1&&(this.parameters.show(),this.parameters.isDetached===!1&&this.profiler.setActiveTab(this.parameters.id)),this.parameters.createGroup(e)}getStatsData(e){let t=this.statsData.get(e);return t===void 0&&(t={},this.statsData.set(e,t)),t}resolveStats(e){const t=this.getStatsData(e.cid);t.initialized!==!0&&(t.cpu=e.cpu,t.gpu=e.gpu,t.stats=[],t.initialized=!0),t.stats.length>this.maxFrames&&t.stats.shift(),t.stats.push(e),t.cpu=this.getAverageDeltaTime(t,"cpu"),t.gpu=this.getAverageDeltaTime(t,"gpu"),t.total=t.cpu+t.gpu;for(const n of e.children){this.resolveStats(n);const r=this.getStatsData(n.cid);t.cpu+=r.cpu,t.gpu+=r.gpu,t.total+=r.total}}getCanvasDataByNode(e){let t=this.canvasNodes.get(e);if(t===void 0){const n=this.getRenderer(),r=document.createElement("canvas"),i=new uCe(r);i.setPixelRatio(window.devicePixelRatio),i.setSize(140,140);const o=e.id,{path:l,name:c}=Npt(Ppt(e.getName()||"(unnamed)")),h=e.context({getUV:w=>{const A=zpt(xat,w),I=A.xy,D=A.z;return I.mul(D)}});let m=ZC(cw(h),1);m=vat(m,Ta,n.outputColorSpace),m=m.context({inspector:!0});const y=new xo;y.outputNode=m;const b=new Aw(y);b.name="Viewer - "+c,t={id:o,name:c,path:l,node:e,quad:b,canvasTarget:i,material:y},this.canvasNodes.set(e,t)}return t}resolveViewer(){const e=this.currentNodes,t=this.getRenderer();if(e.length===0)return;if(!t.backend.isWebGPUBackend){this.resolveConsoleOnce("warn","Inspector: Viewer is only available with WebGPU.");return}this.viewer.isVisible||this.viewer.show();const n=e.map(r=>this.getCanvasDataByNode(r));this.viewer.update(t,n)}getAverageDeltaTime(e,t,n=this.fps){const r=e.stats;let i=0,o=0;for(let l=r.length-1;l>=0&&o<n;l--){const h=r[l][t];h>0&&(i+=h,o++)}return o>0?i/o:0}resolveFrame(e){const t=this.getFrameById(e.frameId+1);if(t){e.cpu=0,e.gpu=0,e.total=0;for(const n of e.children){this.resolveStats(n);const r=this.getStatsData(n.cid);e.cpu+=r.cpu,e.gpu+=r.gpu,e.total+=r.total}e.deltaTime=t.startTime-e.startTime,e.miscellaneous=e.deltaTime-e.total,e.miscellaneous<0&&(e.miscellaneous=0),this.updateCycle(this.displayCycle.text),this.updateCycle(this.displayCycle.graph),this.displayCycle.text.needsUpdate&&(hh("fps-counter",this.fps.toFixed()),this.performance.updateText(this,e)),this.displayCycle.graph.needsUpdate&&this.performance.updateGraph(this,e),this.displayCycle.text.needsUpdate=!1,this.displayCycle.graph.needsUpdate=!1}}updateCycle(e){e.time+=this.nodeFrame.deltaTime,e.time>=e.duration&&(e.needsUpdate=!0,e.time=0)}}let vp,Bo,tS="",C_e=!1;function Gpt(s){const e=s.app,t=On.useRef(null),n=s.app.components.get("three");console.log("Settings",e.settings),e.isApp&&On.useEffect(()=>{const l=t.current,c={canvas:l,stencil:!1};vp=new hS(c),vp.inspector=new Vpt,vp.shadowMap.enabled=!0,vp.setPixelRatio(Math.min(1.5,devicePixelRatio)),vp.setClearColor(0),n.setRenderer(vp,l),vp.init().then(()=>{C_e=!0});const h=new _pt;h.init(vp),document.body.appendChild(h.dom);const m=()=>{const b=window.innerWidth,w=window.innerHeight;Bo==null||Bo.resize(b,w),vp.setSize(b,w)},y=()=>{C_e&&(Bo==null||Bo.update(),Bo==null||Bo.draw()),h.update()};return vp.setAnimationLoop(y),window.addEventListener("resize",m),m(),()=>{Bo!==void 0&&(n.removeCamera(Bo.camera),n.removeScene(Bo),Rp(Bo)),window.removeEventListener("resize",m),vp.dispose()}},[]);const r=()=>{Bo!==void 0&&(Bo.camera!==void 0&&n.removeCamera(Bo.camera),n.removeScene(Bo),Rp(Bo),Spt(n)),tS==="scene1"?Bo=new SNe:tS==="scene2"?Bo=new ENe:Bo=new MNe,Bo.setup(e,vp),Bo.init(),Bo.resize(window.innerWidth,window.innerHeight)},i=()=>{tS!=="scene2"&&(tS="scene2",r())},o=()=>{tS!=="scene3"&&(tS="scene3",r())};return ot.jsx(ot.Fragment,{children:e.isApp&&ot.jsxs(ot.Fragment,{children:[ot.jsx("canvas",{ref:t}),ot.jsxs("div",{style:{position:"absolute",bottom:"20px",left:"20px"},children:[!1,ot.jsx("button",{onClick:i,children:"WebGPU 1"}),ot.jsx("button",{onClick:o,children:"WebGPU 2"})]})]})})}function jpt(s){const[e,t]=On.useState(!1);return On.useEffect(()=>{const n=()=>{zY.removeEventListener(hF.LOAD_COMPLETE,n),t(!0)};zY.addEventListener(hF.LOAD_COMPLETE,n),dpt(s.app)},[t]),ot.jsxs(ot.Fragment,{children:[!e&&ot.jsx("p",{children:"Loading..."}),e&&s.app.isApp&&ot.jsx(Gpt,{app:s.app})]})}function Hpt(){const[s,e]=On.useState(null);return On.useEffect(()=>{const t=new RXe;t.detectSettings(Iq,kq).then(()=>{t.addComponent("theatre",new FXe(Iq,kq));const n=new sot("Hermes Example",Iq,kq);t.addComponent("three",n),e(t)})},[]),ot.jsx(ot.Fragment,{children:s!==null&&ot.jsxs(ot.Fragment,{children:[s.debugEnabled&&ot.jsx(oot,{app:s}),s.editor&&ot.jsx(xpt,{app:s}),ot.jsx(jpt,{app:s})]})})}P_e.initialize();Kze.createRoot(document.getElementById("root")).render(ot.jsx(ot.Fragment,{children:ot.jsx(ot.Fragment,{children:ot.jsx(Hpt,{})})}));
