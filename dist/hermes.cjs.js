"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const h=require("three"),Sn=require("tweakpane"),xn=require("@tweakpane/plugin-essentials"),b=require("react"),sn=require("framer-motion");function Cn(e){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const a in e)if(a!=="default"){const t=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(n,a,t.get?t:{enumerable:!0,get:()=>e[a]})}}return n.default=e,Object.freeze(n)}const wn=Cn(xn),Ot=()=>{},Mn=()=>{};function dt(e){return e.substring(0,1).toUpperCase()+e.substring(1)}function Ve(e,n,a){return Math.min(n,Math.max(e,a))}function jt(e,n,a){return(a-e)/(n-e)}function Nt(e,n,a){return e*(1-a)+n*a}function On(e,n){const a=e-n;return Math.sqrt(a*a)}function on(){return Math.round(Math.random()*1e6).toString()}function cn(e){return e.r!==void 0&&e.g!==void 0&&e.b!==void 0}function ln(e){const n=Math.round(e.r*255),a=Math.round(e.g*255),t=Math.round(e.b*255),i=f=>{const d=f.toString(16);return d.length===1?"0"+d:d},o=i(n),l=i(a),s=i(t);return"#"+o+l+s}function Lt(e,n=1){return Number(e.toFixed(n))}exports.totalThreeObjects=0;const Ft=()=>{exports.totalThreeObjects=0},wt=e=>{if(!e)return;let n=e.name.replaceAll(" ","").replaceAll("/",".");if(n.length===0&&(n=`obj_${exports.totalThreeObjects}`,exports.totalThreeObjects++),e.parent!==null&&e.parent.uuid.length>0&&(n=`${e.parent.uuid}.${n}`),e.uuid=n,e.isMesh!==void 0){const a=e;if(Array.isArray(a.material))a.material.forEach((t,i)=>{t.uuid=`${n}.material.${i}`});else{const t=a.material;t.uuid=`${n}.material`}}e.children.forEach(a=>wt(a))},Rn=e=>{e?.dispose()},un=e=>{e&&(Array.isArray(e)?e.forEach(n=>n.dispose()):e.dispose())},ht=e=>{if(e){for(;e.children.length>0;){const n=e.children[0];n.type==="Audio"?(n.pause(),n.parent&&n.parent.remove(n)):ht(n)}if(e.parent&&e.parent.remove(e),e.isMesh){const n=e;n.geometry?.dispose(),un(n.material)}e.dispose!==void 0&&e.dispose()}};class ut{static renderer;static canvas;static context=null;static scene=null;static camera=null;static material=null;static inited=!1;static width=100;static height=100;static init(){this.inited||(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.inited=!0)}static renderToBlob(n){this.init();const a=n.repeat.clone(),t=n.offset.clone();if(n.repeat.set(1,1),n.offset.set(0,0),this.context!==null){this.context.clearRect(0,0,this.width,this.height);const i=n.image;if(i!=null&&i.width>0){this.canvas.title=n.sourceFile;const o=this.canvas.width/i.width,l=this.renderToCanvas(n);this.context.drawImage(l,0,0,i.width*o,i.height*o)}}return n.repeat.copy(a),n.offset.copy(t),this.canvas.toDataURL("image/png")}static renderToCanvas(n){if(this.material===null){this.camera=new h.OrthographicCamera(-.5,.5,.5,-.5,0,100),this.scene=new h.Scene,this.material=new h.MeshBasicMaterial;const a=new h.BufferGeometry;a.setAttribute("position",new h.Float32BufferAttribute([-.5,-.5,0,1.5,-.5,0,-.5,1.5,0],3)),a.setAttribute("normal",new h.Float32BufferAttribute([0,0,1,0,0,1],3)),a.setAttribute("uv",new h.Float32BufferAttribute([0,0,2,0,0,2],2));const t=new h.Mesh(a,this.material);this.scene.add(t)}if(n.isRenderTargetTexture)this.material.map=n,this.renderer.render(this.scene,this.camera);else{const a=this.renderer.outputColorSpace,t=n.colorSpace;this.renderer.outputColorSpace=h.LinearSRGBColorSpace,n.colorSpace=h.LinearSRGBColorSpace,this.material.map=n,this.renderer.render(this.scene,this.camera),this.renderer.outputColorSpace=a,n.colorSpace=t}return this.renderer.domElement}}class Tn{components=new Map;listen;_appID="";_debugEnabled;_broadcastChannel=void 0;_webSocket=void 0;_mode="app";_connected=!1;_useBC=!1;constructor(n,a,t=!0){this._appID=n,this._debugEnabled=a,a&&(this._useBC=t,t?(this._broadcastChannel=new BroadcastChannel(n),this._broadcastChannel.addEventListener("message",this.messageHandler)):(this._webSocket=new WebSocket(n),this._webSocket.addEventListener("open",this.openHandler),this._webSocket.addEventListener("close",this.closeHandler),this._webSocket.addEventListener("message",this.messageHandler)))}addComponent(n,a){this.components.set(n,a)}dispose(){this._broadcastChannel!==void 0&&this._broadcastChannel.removeEventListener("message",this.messageHandler),this._webSocket!==void 0&&(this._webSocket.removeEventListener("open",this.openHandler),this._webSocket.removeEventListener("close",this.closeHandler),this._webSocket.removeEventListener("message",this.messageHandler)),this.components.forEach(n=>{n.dispose()}),this.components.clear()}send(n){this._mode!==n.target&&(this._useBC?this._broadcastChannel?.postMessage(n):this._connected&&this._webSocket?.send(JSON.stringify(n)))}messageHandler=n=>{this.listen!==void 0&&(this._useBC?this.listen(n.data):this.listen(JSON.parse(n.data)))};openHandler=()=>{this._connected=!0};closeHandler=()=>{this._connected=!1};get appID(){return this._appID}get connected(){return this._connected}get debugEnabled(){return this._debugEnabled}get mode(){return this._mode}get isApp(){return this._mode==="app"}get editor(){return this._mode==="editor"}set editor(n){n&&(this._mode="editor")}}const D=new h.EventDispatcher,A={CUSTOM:"ToolEvents::custom",SELECT_DROPDOWN:"ToolEvents::selectDropdown",DRAG_UPDATE:"ToolEvents::dragUpdate",ADD_SCENE:"ToolEvents::addScene",REFRESH_SCENE:"ToolEvents::refreshScene",REMOVE_SCENE:"ToolEvents::removeScene",SET_SCENE:"ToolEvents::setScene",GET_OBJECT:"ToolEvents::getObject",SET_OBJECT:"ToolEvents::setObject",UPDATE_OBJECT:"ToolEvents::updateObject",CREATE_TEXTURE:"ToolEvents::createTexture",REQUEST_METHOD:"ToolEvents::requestMethod",ADD_CAMERA:"ToolEvents::addCamera",REMOVE_CAMERA:"ToolEvents::removeCamera"};class mt{app;constructor(n){this.app=n}dispose(){}handleApp(n,a,t){}handleEditor(n,a,t){}}class _n extends mt{selectDropdown(n,a){this.app.send({event:"selectComponent",target:"app",data:{dropdown:n,value:a}})}updateDropdown(n,a){this.app.send({event:"draggableListUpdate",target:"app",data:{dropdown:n,value:a}})}handleApp(n,a,t){switch(t.event){case"selectComponent":D.dispatchEvent({type:A.SELECT_DROPDOWN,value:t.data});break;case"draggableListUpdate":D.dispatchEvent({type:A.DRAG_UPDATE,value:t.data});break}}}class Rt extends mt{project;sheets=new Map;sheetObjects=new Map;sheetObjectCBs=new Map;sheetObjectUnsubscribe=new Map;activeSheet;studio=void 0;static rafDriver=void 0;dispose(){this.project=void 0,this.sheets=new Map,this.sheetObjects=new Map,this.sheetObjectCBs=new Map,this.sheetObjectUnsubscribe=new Map}getSheetInstance(n,a){return a!==void 0?`${n}-${a}`:n}sheet(n,a){if(this.project===void 0){console.error("Theatre Project hasn't been created yet.");return}const t=this.getSheetInstance(n,a);let i=this.sheets.get(t);return i!==void 0||(i=this.project?.sheet(n,a),this.sheets.set(t,i)),i}playSheet(n,a,t){this.sheet(n,t)?.sequence.play(a),this.app.send({event:"playSheet",target:"editor",data:{sheet:n,instance:t,value:a}})}pauseSheet(n,a){this.sheet(n)?.sequence.pause(),this.app.send({event:"pauseSheet",target:"editor",data:{sheet:n,instance:a}})}clearSheetObjects(n){this.sheetObjects.forEach((a,t)=>{t.search(`${n}_`)>-1&&this.unsubscribe(a)})}sheetObject(n,a,t,i,o){if(this.project===void 0){console.error("Theatre Project hasn't been created yet.");return}const l=this.sheet(n,o);if(l===void 0)return;const f=`${this.getSheetInstance(n,o)}_${a}`;let d=this.sheetObjects.get(f);d!==void 0?d=l.object(a,{...t,...d.value},{reconfigure:!0}):d=l.object(a,t),this.sheetObjects.set(f,d),this.sheetObjectCBs.set(f,i!==void 0?i:Ot);const m=d.onValuesChange(y=>{if(this.app.editor){for(const C in y){const I=y[C];typeof I=="object"&&cn(I)&&(y[C]={r:I.r,g:I.g,b:I.b,a:I.a})}this.app.send({event:"updateSheetObject",target:"app",data:{sheet:n,sheetObject:f,values:y}})}const E=this.sheetObjectCBs.get(f);E!==void 0&&E(y)});return this.sheetObjectUnsubscribe.set(f,m),d}unsubscribe(n){if(this.project===void 0){console.error("Theatre Project hasn't been created yet.");return}const a=n.address.sheetId,t=n.address.objectKey;this.sheets.get(a)?.detachObject(t);const o=`${a}_${t}`,l=this.sheetObjectUnsubscribe.get(o);l!==void 0&&(this.sheetObjects.delete(o),this.sheetObjectCBs.delete(o),this.sheetObjectUnsubscribe.delete(o),l())}handleApp(n,a,t){const i=a;let o;switch(t.event){case"setSheet":o=i.sheets.get(t.data.sheet),o!==void 0&&(i.activeSheet=o,this.studio?.setSelection([o]));break;case"setSheetObject":o=i.sheetObjects.get(`${t.data.sheet}_${t.data.key}`),o!==void 0&&this.studio?.setSelection([o]);break;case"updateSheetObject":o=i.sheets.get(t.data.sheet),o!==void 0&&o.sequence.pause(),o=i.sheetObjectCBs.get(t.data.sheetObject),o!==void 0&&o(t.data.values);break;case"updateTimeline":o=i.sheets.get(t.data.sheet),i.activeSheet!==void 0&&(i.activeSheet.sequence.position=t.data.position);break}}handleEditor(n,a,t){if(n.editor){const i=a;switch(t.event){case"playSheet":i.sheet(t.data.sheet,t.data.instance)?.sequence.play(t.data.value);break;case"pauseSheet":i.sheet(t.data.sheet,t.data.instance)?.sequence.pause();break}}}handleEditorApp(n,a){if(n.editor){this.studio?.ui.restore(),this.studio?.onSelectionChange(l=>{l.length<1||l.forEach(s=>{let f=s.address.sheetId,d="setSheet",m={};switch(s.type){case"Theatre_Sheet_PublicAPI":d="setSheet",m={sheet:s.address.sheetId},a.activeSheet=a.sheets.get(s.address.sheetId);break;case"Theatre_SheetObject_PublicAPI":d="setSheetObject",f+=`_${s.address.objectKey}`,m={id:f,sheet:s.address.sheetId,key:s.address.objectKey},a.activeSheet=a.sheets.get(s.address.sheetId);break}n.send({event:d,target:"app",data:m})})});let t=-1;const i=()=>{if(Rt.rafDriver?.tick(performance.now()),a.activeSheet!==void 0&&t!==a.activeSheet.sequence.position){t=a.activeSheet.sequence.position;const l=a.activeSheet;n.send({event:"updateTimeline",target:"app",data:{position:t,sheet:l.address.sheetId}})}},o=()=>{i(),requestAnimationFrame(o)};i(),o()}else this.studio?.ui.hide()}}function kn(e,n,a){if(e.editor){a.ui.restore(),a.onSelectionChange(l=>{l.length<1||l.forEach(s=>{let f=s.address.sheetId,d="setSheet",m={};switch(s.type){case"Theatre_Sheet_PublicAPI":d="setSheet",m={sheet:s.address.sheetId},n.activeSheet=n.sheets.get(s.address.sheetId);break;case"Theatre_SheetObject_PublicAPI":d="setSheetObject",f+=`_${s.address.objectKey}`,m={id:f,sheet:s.address.sheetId,key:s.address.objectKey},n.activeSheet=n.sheets.get(s.address.sheetId);break}e.send({event:d,target:"app",data:m})})});let t=-1;const i=()=>{if(Rt.rafDriver?.tick(performance.now()),n.activeSheet!==void 0&&t!==n.activeSheet.sequence.position){t=n.activeSheet.sequence.position;const l=n.activeSheet;e.send({event:"updateTimeline",target:"app",data:{position:t,sheet:l.address.sheetId}})}},o=()=>{i(),requestAnimationFrame(o)};i(),o()}else a.ui.hide()}function Dn(e){if(e.name==="cameras")return"camera";if(e.name==="interactive")return"interactive";if(e.name==="lights")return"light";if(e.name==="ui")return"ui";if(e.name==="utils")return"utils";const n=e.type;return n.search("Helper")>-1?"icon_utils":n.search("Camera")>-1?"camera":n.search("Light")>-1?"light":"obj3D"}function et(e){const n={name:e.name,type:e.type,uuid:e.uuid,children:[]};return e.children.forEach(a=>{n.children.push(et(a))}),n}function An(e){const n={};for(const a in e){const t=e[a].value;n[a]={value:t},t===null?n[a].value={src:"",offset:[0,0],repeat:[1,1]}:t!==void 0&&t.isTexture&&(n[a].value={src:t.image.src,offset:[t.offset.x,t.offset.y],repeat:[t.repeat.x,t.repeat.y]})}return n}function Pn(e){switch(e){case"blendSrcAlpha":case"blendDstAlpha":case"blendEquationAlpha":case"clippingPlanes":case"shadowSide":case"precision":return!0}return!1}function Ze(e){const n={};for(const a in e){if(a.substring(0,1)==="_"||a.substring(0,2)==="is"||Pn(a))continue;const t=typeof e[a],i=e[a];switch(t){case"boolean":case"number":case"string":n[a]=i;break;case"object":i!==null?(n[a]=i,i.isTexture?n[a]={src:ut.renderToBlob(i),offset:[i.offset.x,i.offset.y],repeat:[i.repeat.x,i.repeat.y]}:a==="uniforms"&&(n[a]=An(n[a]))):n[a]={src:"",offset:[0,0],repeat:[1,1]};break}}return n}function At(e){e.updateMatrix();const n={name:e.name,type:e.type,uuid:e.uuid,visible:e.visible,matrix:e.matrix.elements,animations:[],material:void 0,perspectiveCameraInfo:void 0,orthographicCameraInfo:void 0,lightInfo:void 0,children:[]};e.animations.forEach(t=>{n.animations.push({name:t.name,duration:t.duration,blendMode:t.blendMode})});const a=e.type.toLowerCase();if(a.search("mesh")>-1){const t=e;if(Array.isArray(t.material)){const i=[];t.material.forEach(o=>{i.push(Ze(o))}),n.material=i}else n.material=Ze(t.material)}else if(a.search("points")>-1){const t=e;if(Array.isArray(t.material)){const i=[];t.material.forEach(o=>{i.push(Ze(o))}),n.material=i}else n.material=Ze(t.material)}else if(a.search("line")>-1){const t=e;if(Array.isArray(t.material)){const i=[];t.material.forEach(o=>{i.push(Ze(o))}),n.material=i}else n.material=Ze(t.material)}else a.search("camera")>-1?e.type==="PerspectiveCamera"?n.perspectiveCameraInfo={fov:e.fov,zoom:e.zoom,near:e.near,far:e.far,focus:e.focus,aspect:e.aspect,filmGauge:e.filmGauge,filmOffset:e.filmOffset}:e.type==="OrthographicCamera"&&(n.orthographicCameraInfo={zoom:e.zoom,near:e.near,far:e.far,left:e.left,right:e.right,top:e.top,bottom:e.bottom}):a.search("light")>-1&&(n.lightInfo={color:e.color,intensity:e.intensity,decay:e.decay,distance:e.distance,angle:e.angle,penumbra:e.penumbra,groundColor:e.groundColor,width:e.width,height:e.height});return n}function In(e,n){const a=n.split(".");switch(a.length){case 1:return e[a[0]];case 2:return e[a[0]][a[1]];case 3:return e[a[0]][a[1]][a[2]];case 4:return e[a[0]][a[1]][a[2]][a[3]];case 5:return e[a[0]][a[1]][a[2]][a[3]][a[4]];case 6:return e[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]]}}function jn(e,n){for(const a in n)e[a]=n[a]}function Q(e,n,a){if(e===void 0)return;const t=n.split("."),i=t.length;if(typeof a!="object")switch(i){case 1:e[t[0]]=a;break;case 2:e[t[0]][t[1]]=a;break;case 3:e[t[0]][t[1]][t[2]]=a;break;case 4:e[t[0]][t[1]][t[2]][t[3]]=a;break;case 5:e[t[0]][t[1]][t[2]][t[3]][t[4]]=a;break}else{let l;switch(i){case 1:l=e[t[0]];break;case 2:l=e[t[0]][t[1]];break;case 3:l=e[t[0]][t[1]][t[2]];break;case 4:l=e[t[0]][t[1]][t[2]][t[3]];break;case 5:l=e[t[0]][t[1]][t[2]][t[3]][t[4]];break}l!=null&&jn(l,a)}}function dn(e){return new Promise((n,a)=>{const t=new Image;t.onload=()=>{const i=new h.Texture(t);i.wrapS=h.RepeatWrapping,i.wrapT=h.RepeatWrapping,i.needsUpdate=!0,n(i)},t.onerror=a,t.src=e})}class Nn extends mt{scene=void 0;scenes=new Map;renderer=void 0;renderTargets=new Map;dispose(){this.scenes.forEach(n=>{ht(n)}),this.scenes.clear(),this.scene&&ht(this.scene),this.renderTargets.forEach(n=>{n.dispose()}),this.renderTargets.clear(),this.renderer?.dispose()}getObject(n){this.app.debugEnabled&&(this.renderer!==void 0&&(ut.renderer=this.renderer),this.app.send({event:"getObject",target:"app",data:n}))}setObject(n){this.renderer!==void 0&&(ut.renderer=this.renderer);const a=At(n);this.app.send({event:"setObject",target:"editor",data:a})}requestMethod(n,a,t,i){this.app.send({event:"requestMethod",target:"app",data:{uuid:n,key:a,value:t,subitem:i}})}updateObject(n,a,t){this.app.send({event:"updateObject",target:"app",data:{uuid:n,key:a,value:t}})}createTexture(n,a,t){this.app.send({event:"createTexture",target:"app",data:{uuid:n,key:a,value:t}})}addScene(n){if(n===void 0||(this.scenes.set(n.name,n),!this.app.debugEnabled))return;Ft(),wt(n);const a=et(n);this.app.send({event:"addScene",target:"editor",data:a})}refreshScene(n){if(!this.app.debugEnabled)return;const a=this.scenes.get(n);if(a!==void 0){const t=et(a);this.app.send({event:"refreshScene",target:"app",data:t})}}removeScene(n){if(n===void 0||(this.scenes.delete(n.name),!this.app.debugEnabled))return;const a=et(n);this.app.send({event:"removeScene",target:"editor",data:a})}removeAllScenes(){this.scenes.forEach(n=>this.removeScene(n))}getScene(n){let a=null;return this.scenes.forEach((t,i)=>{n.search(i)>-1&&(a=t)}),a}setScene(n){if(n===void 0||(this.scene=n,!this.app.debugEnabled))return;this.renderer!==void 0&&(ut.renderer=this.renderer),Ft(),wt(n);const a=et(n);this.app.send({event:"setScene",target:"editor",data:a})}addCamera(n){if(!this.app.debugEnabled)return;const a=At(n);this.app.send({event:"addCamera",target:"editor",data:a})}removeCamera(n){if(!this.app.debugEnabled)return;const a=At(n);this.app.send({event:"removeCamera",target:"editor",data:a})}handleApp(n,a,t){switch(t.event){case"getObject":D.dispatchEvent({type:A.GET_OBJECT,value:t.data});break;case"updateObject":D.dispatchEvent({type:A.UPDATE_OBJECT,value:t.data});break;case"createTexture":D.dispatchEvent({type:A.CREATE_TEXTURE,value:t.data});break;case"requestMethod":D.dispatchEvent({type:A.REQUEST_METHOD,value:t.data});break;case"refreshScene":n.send({event:"refreshScene",target:"editor",data:et(a.scenes.get(t.data.name))});break}}handleEditor(n,a,t){switch(t.event){case"setObject":D.dispatchEvent({type:A.SET_OBJECT,value:t.data});break;case"addScene":D.dispatchEvent({type:A.ADD_SCENE,value:t.data});break;case"refreshScene":D.dispatchEvent({type:A.REFRESH_SCENE,value:t.data});break;case"removeScene":D.dispatchEvent({type:A.REMOVE_SCENE,value:t.data});break;case"setScene":D.dispatchEvent({type:A.SET_SCENE,value:t.data});break;case"addCamera":D.dispatchEvent({type:A.ADD_CAMERA,value:t.data});break;case"removeCamera":D.dispatchEvent({type:A.REMOVE_CAMERA,value:t.data});break}}rendererWidth=300;rendererHeight=150;addRT(n,a){const t=new h.WebGLRenderTarget(32,32,a);t.texture.name=n,this.renderTargets.set(n,t)}resize(n,a){const t=this.dpr;this.rendererWidth=n,this.rendererHeight=a,this.renderTargets.forEach(i=>{i.setSize(n*t,a*t)}),this.renderer?.setSize(n,a)}set dpr(n){this.renderer?.setPixelRatio(Ve(1,2,n))}get dpr(){return this.renderer!==void 0?this.renderer?.getPixelRatio():1}get width(){return this.rendererWidth}get height(){return this.rendererHeight}get canvas(){return this.renderer!==void 0?this.renderer?.domElement:null}}class Ln extends mt{bindCBs;buttonCBs;pane=void 0;appCallbacks=0;editorCallbacks=0;inspectorFolder=void 0;constructor(n){super(n),this.bindCBs=new Map,this.buttonCBs=new Map,n.editor&&this.createGUI()}createGUI(){this.pane=new Sn.Pane({title:"GUI"}),this.pane.registerPlugin(wn)}dispose(){this.bindCBs.clear(),this.buttonCBs.clear(),this.appCallbacks=0,this.editorCallbacks=0,this.app.editor&&(this.pane?.dispose(),this.pane=void 0)}addFolder(n,a=void 0,t=void 0){if(this.app.editor)return this.pane===void 0&&this.createGUI(),(t!==void 0?t:this.pane).addFolder({title:n,...a});this.app.send({event:"addFolder",target:"app",data:{name:n,params:a,parent:t}})}get bindID(){return`debug_${Math.max(this.appCallbacks,this.editorCallbacks)}`}bind(n,a,t,i=void 0){const o=this.bindID,l=t.onChange!==void 0?t.onChange:Ot;this.bindCBs.set(o,l),this.app.editor?(this.pane===void 0&&this.createGUI(),(i!==void 0?i:this.pane).addBinding(n,a,t).on("change",f=>{this.app.send({event:"updateBind",target:"app",data:{id:o,value:f.value}})}),this.editorCallbacks++):(this.app.send({event:"bindObject",target:"app",data:{id:o,name:a,params:t,parent:i}}),this.appCallbacks++)}triggerBind(n,a){const t=this.bindCBs.get(n);t!==void 0?t(a):console.warn(`No callback for: ${n}`,a)}button(n,a,t=void 0){const i=this.bindID;this.buttonCBs.set(i,a),this.app.editor?(this.pane===void 0&&this.createGUI(),(t!==void 0?t:this.pane).addButton({title:n}).on("click",()=>{this.app.send({event:"clickButton",target:"app",data:{id:i}})}),this.editorCallbacks++):(this.app.send({event:"addButton",target:"app",data:{id:i,name:n,callback:a,parent:t}}),this.appCallbacks++)}triggerButton(n){const a=this.buttonCBs.get(n);a!==void 0&&a()}createInspector(){this.inspectorFolder=this.addFolder("Inspector",this.pane)}clearInspector(){const n=this.inspectorFolder.children.length-1;for(let a=n;a>-1;--a)this.inspectorFolder.remove(this.inspectorFolder.children[a])}handleApp(n,a,t){const i=a;switch(t.event){case"addFolder":i.addFolder(t.data.name,t.data.params,t.data.parent);break;case"bindObject":i.bind(t.data.name,t.data.params,t.data.parent);break;case"updateBind":i.triggerBind(t.data.id,t.data.value);break;case"addButton":i.button(t.data.name,t.data.callback,t.data.parent);break;case"clickButton":i.triggerButton(t.data.id);break}}}var Bt={exports:{}},st={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yt;function Fn(){if(Yt)return st;Yt=1;var e=b,n=Symbol.for("react.element"),a=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,i=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function l(s,f,d){var m,y={},E=null,C=null;d!==void 0&&(E=""+d),f.key!==void 0&&(E=""+f.key),f.ref!==void 0&&(C=f.ref);for(m in f)t.call(f,m)&&!o.hasOwnProperty(m)&&(y[m]=f[m]);if(s&&s.defaultProps)for(m in f=s.defaultProps,f)y[m]===void 0&&(y[m]=f[m]);return{$$typeof:n,type:s,key:E,ref:C,props:y,_owner:i.current}}return st.Fragment=a,st.jsx=l,st.jsxs=l,st}var ot={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qt;function Bn(){return qt||(qt=1,process.env.NODE_ENV!=="production"&&function(){var e=b,n=Symbol.for("react.element"),a=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),s=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),m=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),E=Symbol.for("react.lazy"),C=Symbol.for("react.offscreen"),I=Symbol.iterator,K="@@iterator";function z(r){if(r===null||typeof r!="object")return null;var g=I&&r[I]||r[K];return typeof g=="function"?g:null}var H=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function O(r){{for(var g=arguments.length,S=new Array(g>1?g-1:0),_=1;_<g;_++)S[_-1]=arguments[_];V("error",r,S)}}function V(r,g,S){{var _=H.ReactDebugCurrentFrame,G=_.getStackAddendum();G!==""&&(g+="%s",S=S.concat([G]));var q=S.map(function(B){return String(B)});q.unshift("Warning: "+g),Function.prototype.apply.call(console[r],console,q)}}var k=!1,Z=!1,se=!1,w=!1,ge=!1,Y;Y=Symbol.for("react.module.reference");function tt(r){return!!(typeof r=="string"||typeof r=="function"||r===t||r===o||ge||r===i||r===d||r===m||w||r===C||k||Z||se||typeof r=="object"&&r!==null&&(r.$$typeof===E||r.$$typeof===y||r.$$typeof===l||r.$$typeof===s||r.$$typeof===f||r.$$typeof===Y||r.getModuleId!==void 0))}function P(r,g,S){var _=r.displayName;if(_)return _;var G=g.displayName||g.name||"";return G!==""?S+"("+G+")":S}function _e(r){return r.displayName||"Context"}function oe(r){if(r==null)return null;if(typeof r.tag=="number"&&O("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case t:return"Fragment";case a:return"Portal";case o:return"Profiler";case i:return"StrictMode";case d:return"Suspense";case m:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case s:var g=r;return _e(g)+".Consumer";case l:var S=r;return _e(S._context)+".Provider";case f:return P(r,r.render,"ForwardRef");case y:var _=r.displayName||null;return _!==null?_:oe(r.type)||"Memo";case E:{var G=r,q=G._payload,B=G._init;try{return oe(B(q))}catch{return null}}}return null}var ve=Object.assign,we=0,be,Me,Ne,Pe,Ie,ze,Le;function ee(){}ee.__reactDisabledLog=!0;function Oe(){{if(we===0){be=console.log,Me=console.info,Ne=console.warn,Pe=console.error,Ie=console.group,ze=console.groupCollapsed,Le=console.groupEnd;var r={configurable:!0,enumerable:!0,value:ee,writable:!0};Object.defineProperties(console,{info:r,log:r,warn:r,error:r,group:r,groupCollapsed:r,groupEnd:r})}we++}}function nt(){{if(we--,we===0){var r={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:ve({},r,{value:be}),info:ve({},r,{value:Me}),warn:ve({},r,{value:Ne}),error:ve({},r,{value:Pe}),group:ve({},r,{value:Ie}),groupCollapsed:ve({},r,{value:ze}),groupEnd:ve({},r,{value:Le})})}we<0&&O("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var $e=H.ReactCurrentDispatcher,fe;function p(r,g,S){{if(fe===void 0)try{throw Error()}catch(G){var _=G.stack.trim().match(/\n( *(at )?)/);fe=_&&_[1]||""}return`
`+fe+r}}var v=!1,T;{var L=typeof WeakMap=="function"?WeakMap:Map;T=new L}function me(r,g){if(!r||v)return"";{var S=T.get(r);if(S!==void 0)return S}var _;v=!0;var G=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var q;q=$e.current,$e.current=null,Oe();try{if(g){var B=function(){throw Error()};if(Object.defineProperty(B.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(B,[])}catch(je){_=je}Reflect.construct(r,[],B)}else{try{B.call()}catch(je){_=je}r.call(B.prototype)}}else{try{throw Error()}catch(je){_=je}r()}}catch(je){if(je&&_&&typeof je.stack=="string"){for(var N=je.stack.split(`
`),he=_.stack.split(`
`),J=N.length-1,ne=he.length-1;J>=1&&ne>=0&&N[J]!==he[ne];)ne--;for(;J>=1&&ne>=0;J--,ne--)if(N[J]!==he[ne]){if(J!==1||ne!==1)do if(J--,ne--,ne<0||N[J]!==he[ne]){var Ce=`
`+N[J].replace(" at new "," at ");return r.displayName&&Ce.includes("<anonymous>")&&(Ce=Ce.replace("<anonymous>",r.displayName)),typeof r=="function"&&T.set(r,Ce),Ce}while(J>=1&&ne>=0);break}}}finally{v=!1,$e.current=q,nt(),Error.prepareStackTrace=G}var Xe=r?r.displayName||r.name:"",Wt=Xe?p(Xe):"";return typeof r=="function"&&T.set(r,Wt),Wt}function le(r,g,S){return me(r,!1)}function R(r){var g=r.prototype;return!!(g&&g.isReactComponent)}function M(r,g,S){if(r==null)return"";if(typeof r=="function")return me(r,R(r));if(typeof r=="string")return p(r);switch(r){case d:return p("Suspense");case m:return p("SuspenseList")}if(typeof r=="object")switch(r.$$typeof){case f:return le(r.render);case y:return M(r.type,g,S);case E:{var _=r,G=_._payload,q=_._init;try{return M(q(G),g,S)}catch{}}}return""}var W=Object.prototype.hasOwnProperty,ae={},ye=H.ReactDebugCurrentFrame;function F(r){if(r){var g=r._owner,S=M(r.type,r._source,g?g.type:null);ye.setExtraStackFrame(S)}else ye.setExtraStackFrame(null)}function te(r,g,S,_,G){{var q=Function.call.bind(W);for(var B in r)if(q(r,B)){var N=void 0;try{if(typeof r[B]!="function"){var he=Error((_||"React class")+": "+S+" type `"+B+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof r[B]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw he.name="Invariant Violation",he}N=r[B](g,B,_,S,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(J){N=J}N&&!(N instanceof Error)&&(F(G),O("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",_||"React class",S,B,typeof N),F(null)),N instanceof Error&&!(N.message in ae)&&(ae[N.message]=!0,F(G),O("Failed %s type: %s",S,N.message),F(null))}}}var $=Array.isArray;function ke(r){return $(r)}function ce(r){{var g=typeof Symbol=="function"&&Symbol.toStringTag,S=g&&r[Symbol.toStringTag]||r.constructor.name||"Object";return S}}function ue(r){try{return pt(r),!1}catch{return!0}}function pt(r){return""+r}function at(r){if(ue(r))return O("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",ce(r)),pt(r)}var Fe=H.ReactCurrentOwner,it={key:!0,ref:!0,__self:!0,__source:!0},rt,gt,qe;qe={};function _t(r){if(W.call(r,"ref")){var g=Object.getOwnPropertyDescriptor(r,"ref").get;if(g&&g.isReactWarning)return!1}return r.ref!==void 0}function kt(r){if(W.call(r,"key")){var g=Object.getOwnPropertyDescriptor(r,"key").get;if(g&&g.isReactWarning)return!1}return r.key!==void 0}function Dt(r,g){if(typeof r.ref=="string"&&Fe.current&&g&&Fe.current.stateNode!==g){var S=oe(Fe.current.type);qe[S]||(O('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',oe(Fe.current.type),r.ref),qe[S]=!0)}}function vt(r,g){{var S=function(){rt||(rt=!0,O("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",g))};S.isReactWarning=!0,Object.defineProperty(r,"key",{get:S,configurable:!0})}}function Be(r,g){{var S=function(){gt||(gt=!0,O("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",g))};S.isReactWarning=!0,Object.defineProperty(r,"ref",{get:S,configurable:!0})}}var Gt=function(r,g,S,_,G,q,B){var N={$$typeof:n,type:r,key:g,ref:S,props:B,_owner:q};return N._store={},Object.defineProperty(N._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(N,"_self",{configurable:!1,enumerable:!1,writable:!1,value:_}),Object.defineProperty(N,"_source",{configurable:!1,enumerable:!1,writable:!1,value:G}),Object.freeze&&(Object.freeze(N.props),Object.freeze(N)),N};function c(r,g,S,_,G){{var q,B={},N=null,he=null;S!==void 0&&(at(S),N=""+S),kt(g)&&(at(g.key),N=""+g.key),_t(g)&&(he=g.ref,Dt(g,G));for(q in g)W.call(g,q)&&!it.hasOwnProperty(q)&&(B[q]=g[q]);if(r&&r.defaultProps){var J=r.defaultProps;for(q in J)B[q]===void 0&&(B[q]=J[q])}if(N||he){var ne=typeof r=="function"?r.displayName||r.name||"Unknown":r;N&&vt(B,ne),he&&Be(B,ne)}return Gt(r,N,he,G,_,Fe.current,B)}}var x=H.ReactCurrentOwner,j=H.ReactDebugCurrentFrame;function U(r){if(r){var g=r._owner,S=M(r.type,r._source,g?g.type:null);j.setExtraStackFrame(S)}else j.setExtraStackFrame(null)}var ie;ie=!1;function Ee(r){return typeof r=="object"&&r!==null&&r.$$typeof===n}function de(){{if(x.current){var r=oe(x.current.type);if(r)return`

Check the render method of \``+r+"`."}return""}}function Ht(r){{if(r!==void 0){var g=r.fileName.replace(/^.*[\\\/]/,""),S=r.lineNumber;return`

Check your code at `+g+":"+S+"."}return""}}var bt={};function yt(r){{var g=de();if(!g){var S=typeof r=="string"?r:r.displayName||r.name;S&&(g=`

Check the top-level render call using <`+S+">.")}return g}}function Se(r,g){{if(!r._store||r._store.validated||r.key!=null)return;r._store.validated=!0;var S=yt(g);if(bt[S])return;bt[S]=!0;var _="";r&&r._owner&&r._owner!==x.current&&(_=" It was passed a child from "+oe(r._owner.type)+"."),U(r),O('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',S,_),U(null)}}function xe(r,g){{if(typeof r!="object")return;if(ke(r))for(var S=0;S<r.length;S++){var _=r[S];Ee(_)&&Se(_,g)}else if(Ee(r))r._store&&(r._store.validated=!0);else if(r){var G=z(r);if(typeof G=="function"&&G!==r.entries)for(var q=G.call(r),B;!(B=q.next()).done;)Ee(B.value)&&Se(B.value,g)}}}function Ge(r){{var g=r.type;if(g==null||typeof g=="string")return;var S;if(typeof g=="function")S=g.propTypes;else if(typeof g=="object"&&(g.$$typeof===f||g.$$typeof===y))S=g.propTypes;else return;if(S){var _=oe(g);te(S,r.props,"prop",_,r)}else if(g.PropTypes!==void 0&&!ie){ie=!0;var G=oe(g);O("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",G||"Unknown")}typeof g.getDefaultProps=="function"&&!g.getDefaultProps.isReactClassApproved&&O("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Re(r){{for(var g=Object.keys(r.props),S=0;S<g.length;S++){var _=g[S];if(_!=="children"&&_!=="key"){U(r),O("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",_),U(null);break}}r.ref!==null&&(U(r),O("Invalid attribute `ref` supplied to `React.Fragment`."),U(null))}}function Ue(r,g,S,_,G,q){{var B=tt(r);if(!B){var N="";(r===void 0||typeof r=="object"&&r!==null&&Object.keys(r).length===0)&&(N+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var he=Ht(G);he?N+=he:N+=de();var J;r===null?J="null":ke(r)?J="array":r!==void 0&&r.$$typeof===n?(J="<"+(oe(r.type)||"Unknown")+" />",N=" Did you accidentally export a JSX literal instead of a component?"):J=typeof r,O("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",J,N)}var ne=c(r,g,S,G,q);if(ne==null)return ne;if(B){var Ce=g.children;if(Ce!==void 0)if(_)if(ke(Ce)){for(var Xe=0;Xe<Ce.length;Xe++)xe(Ce[Xe],r);Object.freeze&&Object.freeze(Ce)}else O("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else xe(Ce,r)}return r===t?Re(ne):Ge(ne),ne}}function Ke(r,g,S){return Ue(r,g,S,!0)}function Et(r,g,S){return Ue(r,g,S,!1)}var yn=Et,En=Ke;ot.Fragment=t,ot.jsx=yn,ot.jsxs=En}()),ot}process.env.NODE_ENV==="production"?Bt.exports=Fn():Bt.exports=Bn();var u=Bt.exports;function zt(e){return e.title.search("<")>-1?u.jsx("button",{className:"svg",dangerouslySetInnerHTML:{__html:e.title}}):u.jsx("button",{children:e.title})}const Un=u.jsxs("svg",{className:"closeIcon",width:"14",height:"14",fill:"none",stroke:"#666666",strokeMiterlimit:"10",children:[u.jsx("circle",{cx:"7",cy:"7",r:"6"}),u.jsx("line",{x1:"4",y1:"4",x2:"10",y2:"10"}),u.jsx("line",{x1:"4",y1:"10",x2:"10",y2:"4"})]}),Vn=u.jsx("svg",{className:"dragIcon",width:"14",height:"14",fill:"#666666",stroke:"none",children:u.jsx("path",{d:`M10.43,4H3.57C3.26,4,3,4.22,3,4.5v1C3,5.78,3.26,6,3.57,6h6.86C10.74,6,11,5.78,11,5.5v-1
C11,4.22,10.74,4,10.43,4z M10.43,8H3.57C3.26,8,3,8.22,3,8.5v1C3,9.78,3.26,10,3.57,10h6.86C10.74,10,11,9.78,11,9.5v-1
C11,8.22,10.74,8,10.43,8z`})});function hn(e){return u.jsx(sn.Reorder.Item,{value:e.title,children:u.jsxs("div",{children:[Vn,u.jsx("span",{children:e.title}),u.jsx("button",{className:"closeIcon",onClick:()=>{e.onDelete(e.index)},children:Un})]})},e.title)}function fn(e){const[n,a]=b.useState(!1),[t,i]=b.useState(e.options),o=d=>{e.onDragComplete(d),i(d)},l=d=>{const m=[...t];m.splice(d,1),o(m)},s=[];t.forEach((d,m)=>{s.push(u.jsx(hn,{index:m,title:d,onDelete:l},d))});let f="dropdown draggable";return e.subdropdown&&(f+=" subdropdown"),u.jsxs("div",{className:f,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[u.jsx(zt,{title:e.title}),u.jsx(sn.Reorder.Group,{axis:"y",values:t,onReorder:o,style:{visibility:n?"visible":"hidden"},children:s})]})}function mn(e){const[n,a]=b.useState(!1),t=[];e.options.map((o,l)=>{e.onSelect!==void 0&&(o.onSelect=e.onSelect),t.push(u.jsx(pn,{option:o},l))});let i="dropdown";return e.subdropdown&&(i+=" subdropdown"),u.jsxs("div",{className:i,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[u.jsx(zt,{title:e.title}),u.jsx("ul",{style:{visibility:n?"visible":"hidden"},children:t})]})}function pn(e){const{option:n}=e,[a,t]=b.useState("");let i;switch(n.type){case"draggable":i=u.jsx(fn,{title:n.title,options:n.value,onDragComplete:o=>{n.onDragComplete!==void 0&&n.onDragComplete(o)},subdropdown:!0});break;case"dropdown":i=u.jsx(mn,{title:n.title,options:n.value,onSelect:n.onSelect,subdropdown:!0});break;case"option":i=u.jsx("button",{onClick:()=>{n.onSelect!==void 0&&n.onSelect(n.value),n.selectable&&(a!==n.title?t(n.title):t(""))},children:n.title});break}return u.jsx("li",{className:a===n.title?"selected":"",children:i},on())}function zn(e,n,a){function t(o){switch(n.forEach(l=>{l.callback(e,l.remote,o)}),o.event){case"custom":D.dispatchEvent({type:A.CUSTOM,value:o.data});break}}function i(o){switch(a.forEach(l=>{l.callback(e,l.remote,o)}),o.event){case"custom":D.dispatchEvent({type:A.CUSTOM,value:o.data});break}}e.listen=o=>{o.target==="editor"?i(o):t(o)}}function ft(e){const[n,a]=b.useState(e.open!==void 0?e.open:!0),t=!n||e.children===void 0,i=()=>{D.dispatchEvent({type:A.REMOVE_SCENE,value:e.scene})};return u.jsxs("div",{className:`accordion ${t?"hide":""}`,children:[u.jsxs("button",{className:"toggle",onClick:()=>{const o=!n;e.onToggle!==void 0&&e.onToggle(o),a(o)},children:[u.jsx("p",{className:`status ${n?"open":""}`,children:"Toggle"}),u.jsx("p",{className:"label",children:dt(e.label)})]}),e.onRefresh?u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"refresh",onClick:e.onRefresh}),u.jsx("button",{className:"remove",onClick:i})]}):null,e.button,u.jsx("div",{className:n?"open":"",children:u.jsx("div",{children:e.children})},Math.random())]})}function $t(e){const n=b.useRef(null),[a,t]=b.useState(!1),i=e.child!==void 0&&e.child.children.length>0,o=[];return e.child!==void 0&&e.child.children.length>0&&e.child.children.map((l,s)=>{o.push(u.jsx($t,{child:l,three:e.three},s))}),b.useEffect(()=>{if(e.child){const l=e.three.getScene(e.child.uuid);if(l!==null){const s=l.getObjectByProperty("uuid",e.child.uuid);s!==void 0&&(n.current.style.opacity=s.visible?"1":"0.25")}}},[a]),u.jsx(u.Fragment,{children:e.child!==void 0&&u.jsxs("div",{className:"childObject",children:[u.jsxs("div",{className:"child",children:[i?u.jsx("button",{className:"status",style:{backgroundPositionX:a?"-14px":"2px"},onClick:()=>{t(!a)}}):null,u.jsx("button",{className:"name",style:{left:i?"20px":"5px"},onClick:()=>{e.child!==void 0&&(e.three.getObject(e.child.uuid),a||t(!0))},children:e.child.name.length>0?`${e.child.name} (${e.child.type})`:`${e.child.type}::${e.child.uuid}`}),u.jsx("button",{className:"visibility",ref:n,onClick:()=>{if(e.child){const l=e.three.getScene(e.child.uuid);if(l!==null){const s=l.getObjectByProperty("uuid",e.child.uuid);if(s!==void 0){const f="visible",d=!s.visible;n.current.style.opacity=d?"1":"0.25",e.three.updateObject(e.child.uuid,f,d),Q(s,f,d)}}}}}),u.jsx("div",{className:`icon ${Dn(e.child)}`})]}),u.jsx("div",{className:a?"open":"",children:u.jsx("div",{className:"container",children:o})})]},Math.random())})}function Ut(e){const n=[];return e.child?.children.map((a,t)=>{n.push(u.jsx($t,{child:a,scene:e.scene,three:e.three},t))}),u.jsx("div",{className:`scene ${e.class!==void 0?e.class:""}`,children:n})}function $n(e){const[n,a]=b.useState(e.defaultValue);return b.useEffect(()=>{let t=!1,i=-1,o=0,l=e.defaultValue;const s=E=>{t=!0,o=Number(e.input.current?.value),i=E.clientX,document.addEventListener("mouseup",d,!1),document.addEventListener("mousemove",f,!1),document.addEventListener("contextmenu",d,!1)},f=E=>{if(!t)return;const C=e.step!==void 0?e.step:1,I=(E.clientX-i)*C;l=Number((o+I).toFixed(4)),e.min!==void 0&&(l=Math.max(l,e.min)),e.max!==void 0&&(l=Math.min(l,e.max)),e.onChange!==void 0&&e.onChange(l),a(l)},d=()=>{t=!1,document.removeEventListener("mouseup",d),document.removeEventListener("mousemove",f),document.removeEventListener("contextmenu",d)},m=E=>{const C=Number(E.target.value);a(C)},y=E=>{const C=Number(E.target.value);e.onChange!==void 0&&e.onChange(C),a(C)};return e.input.current?.addEventListener("input",m),e.label.current?.addEventListener("mousedown",s,!1),e.sliderRef!==void 0&&e.sliderRef.current?.addEventListener("input",y),()=>{e.input.current?.removeEventListener("input",m),e.label.current?.removeEventListener("mousedown",s),e.sliderRef!==void 0&&e.sliderRef.current?.removeEventListener("input",y),document.removeEventListener("mouseup",d),document.removeEventListener("mousemove",f),document.removeEventListener("contextmenu",d)}},[]),n}function We(e){const n=b.useRef(null),a=b.useRef(null),t=$n({label:e.labelRef,input:n,sliderRef:a,defaultValue:e.value,min:e.min,max:e.max,step:e.step,onChange:i=>{e.onChange!==void 0&&e.onChange(e.prop,i)}});return u.jsxs(u.Fragment,{children:[e.type==="number"&&u.jsx("input",{alt:e.alt,className:e.className,ref:n,type:"number",value:t,min:e.min,max:e.max,step:e.step,disabled:e.disabled,onChange:i=>{const o=Number(i.target.value);e.onChange!==void 0&&e.onChange(e.prop,o)}}),e.type==="range"&&u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",value:t.toString(),disabled:e.disabled,ref:n,className:"min",onChange:i=>{const o=Number(i.target.value);e.onChange!==void 0&&e.onChange(e.prop,o)}}),u.jsx("input",{disabled:e.disabled,type:"range",value:t,min:e.min,max:e.max,step:e.step,ref:a,onChange:Ot})]})]})}function Gn(e){const n=b.useRef(null),a=b.useRef(null),t=b.useRef(null),i=b.useRef(null),o=b.useRef(null),l=b.useRef(null),[s,f]=b.useState(e.value),[d,m]=b.useState({min:Math.min(e.min,Math.min(e.value.x,e.value.y)),max:Math.max(e.max,Math.max(e.value.x,e.value.y))}),[y,E]=b.useState(!1);function C(){y||(window.addEventListener("mousemove",K),window.addEventListener("mouseup",I),window.addEventListener("mouseup",I),E(!0))}function I(){window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",I),E(!1)}function K(k){const Z=o.current.getBoundingClientRect(),se=Ve(0,99,k.clientX-Z.left)/99,w=Ve(0,99,k.clientY-Z.top)/99,ge=Lt(Nt(d.min,d.max,se),3),Y=Lt(Nt(d.min,d.max,w),3);e.onChange({target:{value:{x:ge,y:Y}}}),f({x:ge,y:Y})}function z(k){let Z=s.x,se=s.y;k.target===n.current?Z=Number(k.target.value):se=Number(k.target.value),f({x:Z,y:se})}function H(){const k=Number(t.current.value);m({min:k,max:d.max}),(s.x<k||s.y<k)&&f({x:Ve(k,d.max,s.x),y:Ve(k,d.max,s.y)})}function O(){const k=Number(i.current.value);m({min:d.min,max:k}),(s.x>k||s.y>k)&&f({x:Ve(d.min,k,s.x),y:Ve(d.min,k,s.y)})}b.useEffect(()=>{const k=jt(d.min,d.max,s.x),Z=jt(d.min,d.max,s.y);l.current.style.left=`${k*100}%`,l.current.style.top=`${Z*100}%`},[d,s]);const V=e.step!==void 0?e.step:.01;return u.jsxs("div",{className:"vector2",children:[u.jsxs("div",{className:"fields",children:[u.jsxs("div",{children:[u.jsx("label",{children:"X:"}),u.jsx("input",{ref:n,type:"number",value:s.x,min:d.min,max:d.max,step:V,onChange:z})]}),u.jsxs("div",{children:[u.jsx("label",{children:"Y:"}),u.jsx("input",{ref:a,type:"number",value:s.y,min:d.min,max:d.max,step:V,onChange:z})]}),u.jsxs("div",{children:[u.jsx("label",{children:"Min:"}),u.jsx("input",{ref:t,type:"number",value:d.min,step:V,onChange:H})]}),u.jsxs("div",{children:[u.jsx("label",{children:"Max:"}),u.jsx("input",{ref:i,type:"number",value:d.max,step:V,onChange:O})]})]}),u.jsxs("div",{className:"input",ref:o,onMouseDown:C,onMouseUp:I,children:[u.jsx("div",{className:"x"}),u.jsx("div",{className:"y"}),u.jsx("div",{className:"pt",ref:l})]})]})}function Kt(e){const n=e.value.isVector3!==void 0,a=e.value.isEuler!==void 0,t=e.value.elements!==void 0,i=e.step!==void 0?e.step:.01,o=[];if(n){const l=b.useMemo(()=>e.value,[]),s=(d,m)=>{l[d]=m,e.onChange({target:{value:l}})};["x","y","z"].forEach(d=>{const m=b.useRef(null);o.push(u.jsxs("div",{children:[u.jsx("label",{ref:m,children:d.toUpperCase()}),u.jsx(We,{value:l[d],type:"number",prop:d,step:i,labelRef:m,onChange:s})]},d))})}else if(a){const l=b.useMemo(()=>e.value,[]),s=(d,m)=>{l[d]=m,e.onChange({target:{value:l}})};["_x","_y","_z"].forEach(d=>{const m=b.useRef(null);o.push(u.jsxs("div",{children:[u.jsx("label",{ref:m,children:d.substring(1).toUpperCase()}),u.jsx(We,{value:l[d],type:"number",prop:d,step:i,labelRef:m,onChange:s})]},d))})}else if(t){const l=b.useMemo(()=>e.value,[]),s=(f,d)=>{const m=Number(f);l.elements[m]=d,e.onChange({target:{value:l}})};for(let f=0;f<9;f++){const d=b.useRef(null);o.push(u.jsxs("div",{children:[u.jsx("label",{ref:d,children:f+1}),u.jsx(We,{value:l.elements[f],type:"number",prop:f.toString(),step:i,labelRef:d,onChange:s})]},f.toString()))}}return u.jsx("div",{className:"grid3",children:o},Math.random().toString())}function Hn(e){const n=e.value.x!==void 0,a=e.step!==void 0?e.step:.01,t=[];if(n){const i=b.useMemo(()=>e.value,[]),o=(s,f)=>{i[s]=f,e.onChange({target:{value:i}})};["x","y","z","w"].forEach(s=>{const f=b.useRef(null);t.push(u.jsxs("div",{children:[u.jsx("label",{ref:f,children:s.toUpperCase()}),u.jsx(We,{value:i.x,type:"number",prop:s,step:a,labelRef:f,onChange:o})]},s))})}else{const i=b.useMemo(()=>e.value,[]),o=(l,s)=>{const f=Number(l);i.elements[f]=s,e.onChange({target:{value:i}})};for(let l=0;l<16;l++){const s=b.useRef(null);t.push(u.jsxs("div",{children:[u.jsx("label",{ref:s,children:l+1}),u.jsx(We,{value:i.elements[l],type:"number",prop:l.toString(),step:a,labelRef:s,onChange:o})]},l.toString()))}}return u.jsx("div",{className:"grid4",children:t})}function Wn(e){return"items"in e}function Ye(e){const n=[];return e.items.forEach(a=>{Wn(a)?n.push(u.jsx(Ye,{title:dt(a.title),items:a.items},Math.random())):n.push(u.jsx(Ct,{title:a.title,prop:a.prop,value:a.value,type:a.type,min:a.min,max:a.max,step:a.step,disabled:a.disabled,options:a.options,onChange:(t,i)=>{a.onChange!==void 0&&a.onChange(t,i)},onKeyDown:t=>{a.onKeyDown!==void 0&&a.onKeyDown(t)}},Math.random()))}),u.jsx(ft,{label:e.title,open:e.expanded===!0,children:n})}function Yn(e){return!(e==="alphaHash"||e==="alphaToCoverage"||e==="blendAlpha"||e==="blendColor"||e==="blendDstAlpha"||e==="colorWrite"||e==="combine"||e==="defaultAttributeValues"||e==="depthFunc"||e==="forceSinglePass"||e==="glslVersion"||e==="linecap"||e==="linejoin"||e==="linewidth"||e==="normalMapType"||e==="precision"||e==="premultipliedAlpha"||e==="shadowSide"||e==="toneMapped"||e==="uniformsGroups"||e==="uniformsNeedUpdate"||e==="userData"||e==="vertexColors"||e==="version"||e==="wireframeLinecap"||e==="wireframeLinejoin"||e==="wireframeLinewidth"||e.slice(0,4)==="clip"||e.slice(0,7)==="polygon"||e.slice(0,7)==="stencil"||e.slice(0,2)==="is")}function qn(e){switch(e){case"Alpha Map":return"alphaMap";case"Anisotropy Map":return"anisotropyMap";case"AO Map":return"aoMap";case"Bump Map":return"bumpMap";case"Clearcoat Map":return"clearcoatMap";case"Clearcoat Normal Map":return"clearcoatNormalMap";case"Clearcoat Roughness Map":return"clearcoatRoughnessMap";case"Displacement Map":return"displacementMap";case"Emissive Map":return"emissiveMap";case"Gradient Map":return"gradientMap";case"Iridescence Map":return"iridescenceMap";case"Iridescence Thickness Map":return"iridescenceThicknessMap";case"Map":return"map";case"Matcap":return"matcap";case"Normal Map":return"normalMap";case"Roughness Map":return"roughnessMap";case"Sheen Color Map":return"sheenColorMap";case"Sheen Roughness Map":return"sheenRoughnessMap";case"Specular Color Map":return"specularColorMap";case"Specular Map Intensity":return"specularIntensityMap";case"Thickness Map":return"thicknessMap";case"Transmission Map":return"transmissionMap"}return e}function Tt(e){switch(e){case"alphaMap":return"Alpha Map";case"anisotropy":return"Anisotropy";case"anisotropyMap":return"Anisotropy Map";case"anisotropyRotation":return"Anisotropy Rotation";case"aoMap":return"AO Map";case"aoMapIntensity":return"AO Map Intensity";case"attenuationColor":return"Attenuation Color";case"attenuationDistance":return"Attenuation Distance";case"blendAlpha":return"Blend Alpha";case"blendColor":return"Blend Color";case"blendDst":return"Blend Dst";case"blendDstAlpha":return"Blend Dst Alha";case"blendEquation":return"Blend Equation";case"blendEquationAlpha":return"Blend Equation Alpha";case"blending":return"Blending";case"blendSrc":return"Blend Src";case"blendSrcAlpha":return"Blend Src Alpha";case"bumpMap":return"Bump Map";case"bumpScale":return"Bump Scale";case"clearcoat":return"Clearcoat";case"clearcoatMap":return"Clearcoat Map";case"clearcoatNormalMap":return"Clearcoat Normal Map";case"clearcoatNormalScale":return"Clearcoat Normal Scale";case"clearcoatRoughness":return"Clearcoat Roughness";case"clearcoatRoughnessMap":return"Clearcoat Roughness Map";case"color":return"Color";case"defines":return"Defines";case"depthTest":return"Depth Test";case"depthWrite":return"Depth Write";case"dispersion":return"Dispersion";case"displacementBias":return"Displacement Bias";case"displacementMap":return"Displacement Map";case"displacementScale":return"Displacement Scale";case"dithering":return"Dithering";case"emissive":return"Emissive";case"emissiveMap":return"Emissive Map";case"emissiveIntensity":return"Emissive Intensity";case"envMap":return"Environment Map";case"envMapIntensity":return"Environment Map Intensity";case"envMapRotation":return"Environment Map Rotation";case"extensions":return"Extensions";case"flatShading":return"Flat Shading";case"fragmentShader":return"Fragment Shader";case"fog":return"Fog";case"gradientMap":return"Gradient Map";case"ior":return"IOR";case"iridescence":return"Iridescence";case"iridescenceIOR":return"Iridescence IOR";case"iridescenceMap":return"Iridescence Map";case"iridescenceThicknessMap":return"Iridescence Thickness Map";case"iridescenceThicknessRange":return"Iridescence Thickness Range";case"lights":return"Lights";case"lightMap":return"Light Map";case"lightMapIntensity":return"Light Map Intensity";case"map":return"Map";case"matcap":return"Matcap";case"metalness":return"Metalness";case"metalnessMap":return"Metalness Map";case"name":return"Name";case"normalMap":return"Normal Map";case"normalScale":return"Normal Scale";case"opacity":return"Opacity";case"reflectivity":return"Reflectivity";case"refractionRatio":return"Refraction Ratio";case"roughness":return"Roughness";case"roughnessMap":return"Roughness Map";case"sheen":return"Sheen";case"sheenColor":return"Sheen Color";case"sheenColorMap":return"Sheen Color Map";case"sheenRoughness":return"Sheen Roughness";case"sheenRoughnessMap":return"Sheen Roughness Map";case"shininess":return"Shininess";case"side":return"Side";case"size":return"Size";case"sizeAttenuation":return"Size Attenuation";case"specular":return"Specular";case"specularColor":return"Specular Color";case"specularColorMap":return"Specular Color Map";case"specularIntensity":return"Specular Intensity";case"specularIntensityMap":return"Specular Map Intensity";case"thickness":return"Thickness";case"thicknessMap":return"Thickness Map";case"transmission":return"Transmission";case"transmissionMap":return"Transmission Map";case"transparent":return"Transparent";case"type":return"Type";case"uuid":return"UUID";case"uniforms":return"Uniforms";case"vertexShader":return"Vertex Shader";case"visible":return"Visible";case"wireframe":return"Wireframe"}return e}function gn(e){const n=e.toLowerCase();return n.search("intensity")>-1||n==="anisotropyrotation"||n==="blendalpha"||n==="bumpscale"||n==="clearcoatroughness"||n==="displacementbias"||n==="displacementscale"||n==="metalness"||n==="opacity"||n==="reflectivity"||n==="refractionratio"||n==="roughness"||n==="sheenroughness"||n==="thickness"}function Kn(){const e=document.createElement("input");return e.type="file",new Promise((n,a)=>{e.addEventListener("change",function(){if(e.files===null)a();else{const t=e.files[0],i=new FileReader;i.onload=function(o){n(o.target.result)},i.readAsDataURL(t)}}),e.click()})}const Xn=[{title:"Front",value:h.FrontSide},{title:"Back",value:h.BackSide},{title:"Double",value:h.DoubleSide}],Zn=[{title:"No Blending",value:h.NoBlending},{title:"Normal",value:h.NormalBlending},{title:"Additive",value:h.AdditiveBlending},{title:"Subtractive",value:h.SubtractiveBlending},{title:"Multiply",value:h.MultiplyBlending},{title:"Custom",value:h.CustomBlending}],Jn=[{title:"Add",value:h.AddEquation},{title:"Subtract",value:h.SubtractEquation},{title:"Reverse Subtract",value:h.ReverseSubtractEquation},{title:"Min",value:h.MinEquation},{title:"Max",value:h.MaxEquation}],Qn=[{title:"Zero",valye:h.ZeroFactor},{title:"One",valye:h.OneFactor},{title:"Src Color",valye:h.SrcColorFactor},{title:"One Minus Src Color",valye:h.OneMinusSrcColorFactor},{title:"Src Alpha",valye:h.SrcAlphaFactor},{title:"One Minus Src Alpha",valye:h.OneMinusSrcAlphaFactor},{title:"Dst Alpha",valye:h.DstAlphaFactor},{title:"One Minus Dst Alpha",valye:h.OneMinusDstAlphaFactor},{title:"Dst Color",valye:h.DstColorFactor},{title:"One Minus Dst Color",valye:h.OneMinusDstColorFactor},{title:"Src Alpha Saturate",valye:h.SrcAlphaSaturateFactor},{title:"Constant Color",valye:h.ConstantColorFactor},{title:"One Minus Constant Color",valye:h.OneMinusConstantColorFactor},{title:"Constant Alpha",valye:h.ConstantAlphaFactor},{title:"One Minus Constant Alpha",valye:h.OneMinusConstantAlphaFactor}],ea=[{title:"Zero",valye:h.ZeroFactor},{title:"One",valye:h.OneFactor},{title:"Src Color",valye:h.SrcColorFactor},{title:"One Minus Src Color",valye:h.OneMinusSrcColorFactor},{title:"Src Alpha",valye:h.SrcAlphaFactor},{title:"One Minus Src Alpha",valye:h.OneMinusSrcAlphaFactor},{title:"Dst Alpha",valye:h.DstAlphaFactor},{title:"One Minus Dst Alpha",valye:h.OneMinusDstAlphaFactor},{title:"Dst Color",valye:h.DstColorFactor},{title:"One Minus Dst Color",valye:h.OneMinusDstColorFactor},{title:"Constant Color",valye:h.ConstantColorFactor},{title:"One Minus Constant Color",valye:h.OneMinusConstantColorFactor},{title:"Constant Alpha",valye:h.ConstantAlphaFactor},{title:"One Minus Constant Alpha",valye:h.OneMinusConstantAlphaFactor}];function ct(e,n){e.needsUpdate=!0,e.type="option",e.options=n}function ta(e,n,a,t){return{type:"boolean",title:Tt(e),prop:e,value:n,needsUpdate:!0,onChange:(i,o)=>{t.updateObject(a.uuid,`material.${e}`,o),t.updateObject(a.uuid,"material.needsUpdate",!0);const l=t.getScene(a.uuid);if(l!==null){const s=l.getObjectByProperty("uuid",a.uuid);Q(s,`material.${e}`,o)}}}}function na(e,n,a,t){const i={type:"number",title:Tt(e),prop:e,value:n,min:void 0,max:void 0,step:.01,needsUpdate:!0,onChange:(o,l)=>{t.updateObject(a.uuid,`material.${e}`,l),t.updateObject(a.uuid,"material.needsUpdate",!0);const s=t.getScene(a.uuid);if(s!==null){const f=s.getObjectByProperty("uuid",a.uuid);Q(f,`material.${e}`,l)}}};switch(e){case"blending":ct(i,Zn);break;case"blendDst":ct(i,ea);break;case"blendEquation":ct(i,Jn);break;case"blendSrc":ct(i,Qn);break;case"side":ct(i,Xn);break}return gn(e)&&(i.value=Number(n),i.type="range",i.min=Math.min(0,i.value),i.max=Math.max(1,i.value),i.step=.01),i}function aa(e,n,a,t){const i={type:"string",title:Tt(e),prop:e,value:n,needsUpdate:!0,onChange:(l,s)=>{t.updateObject(a.uuid,`material.${e}`,s),t.updateObject(a.uuid,"material.needsUpdate",!0);const f=t.getScene(a.uuid);if(f!==null){const d=f.getObjectByProperty("uuid",a.uuid);Q(d,`material.${e}`,s)}},onKeyDown:l=>{}};return(e==="vertexShader"||e==="fragmentShader")&&(i.disabled=!1,i.latest=i.value,i.onChange=(l,s)=>{i.latest=s,t.updateObject(a.uuid,`material.${e}`,s);const f=t.getScene(a.uuid);if(f!==null){const d=f.getObjectByProperty("uuid",a.uuid);Q(d,`material.${e}`,s)}},i.onKeyDown=l=>{if(l.key==="Enter"&&(l.altKey||l.metaKey)){t.updateObject(a.uuid,"material.needsUpdate",!0);const s=t.getScene(a.uuid);if(s!==null){const f=s.getObjectByProperty("uuid",a.uuid);Q(f,"material.needsUpdate",!0)}}}),i}function ia(e){return e.x!==void 0&&e.y!==void 0&&e.z===void 0}function ra(e){return e.x!==void 0&&e.y!==void 0&&e.z!==void 0&&e.w===void 0}function sa(e){return e.x!==void 0&&e.y!==void 0&&e.z!==void 0&&e.w!==void 0}function Vt(e){e.sort((n,a)=>n.title<a.title?-1:n.title>a.title?1:0)}function lt(e,n,a,t,i="",o=!1){const l=Tt(e).split(".")[0].replaceAll("[","").replaceAll("]",""),s=i.length>0?`${i}.${e}`:e,f=typeof n;if(f==="boolean"||f==="string")return{title:l,prop:s,type:f,value:n,disabled:o,onChange:(d,m)=>{t.updateObject(a.uuid,`material.${s}`,m);const y=t.getScene(a.uuid);if(y!==null){const E=y.getObjectByProperty("uuid",a.uuid);Q(E,`material.${s}`,m)}}};if(f==="number"){const d={title:l,prop:s,type:"number",value:n,step:.01,disabled:o,onChange:(m,y)=>{t.updateObject(a.uuid,`material.${s}`,y);const E=t.getScene(a.uuid);if(E!==null){const C=E.getObjectByProperty("uuid",a.uuid);Q(C,`material.${s}`,y)}}};return gn(l)&&(d.type="range",d.min=0,d.max=1),d}else{if(n.isColor)return{title:l,prop:s,type:"color",value:n,disabled:o,onChange:(d,m)=>{const y=new h.Color(m);t.updateObject(a.uuid,`material.${s}`,y);const E=t.getScene(a.uuid);if(E!==null){const C=E.getObjectByProperty("uuid",a.uuid);Q(C,`material.${s}`,y)}}};if(Array.isArray(n)){const d=[];for(const m in n){const y=n[m],E=`[${m.toString()}]`;if(y.value!==void 0){const C=lt(`${E}.value`,y.value,a,t,s,o);C!==void 0&&d.push(C)}else{const C=lt(E,y,a,t,s,o);C!==void 0&&d.push(C)}}if(d.length>0)return Vt(d),{title:l,items:d}}else{if(ia(n))return{title:l,prop:s,type:"vector2",value:n,disabled:o,onChange:(d,m)=>{t.updateObject(a.uuid,`material.${s}`,m);const y=t.getScene(a.uuid);if(y!==null){const E=y.getObjectByProperty("uuid",a.uuid);Q(E,`material.${s}`,m)}}};if(ra(n))return{title:l,prop:s,type:"grid3",value:n,disabled:o,onChange:(d,m)=>{t.updateObject(a.uuid,`material.${s}`,m);const y=t.getScene(a.uuid);if(y!==null){const E=y.getObjectByProperty("uuid",a.uuid);Q(E,`material.${s}`,m)}}};if(sa(n))return{title:l,prop:s,type:"grid4",value:n,disabled:o,onChange:(d,m)=>{t.updateObject(a.uuid,`material.${s}`,m);const y=t.getScene(a.uuid);if(y!==null){const E=y.getObjectByProperty("uuid",a.uuid);Q(E,`material.${s}`,m)}}};if(n.isEuler)return{title:l,prop:s,type:"euler",value:n,disabled:o,onChange:(d,m)=>{t.updateObject(a.uuid,`material.${s}`,m);const y=t.getScene(a.uuid);if(y!==null){const E=y.getObjectByProperty("uuid",a.uuid);Q(E,`material.${s}`,m)}}};if(n.src!==void 0)return{title:l,type:"image",value:n,disabled:o,onChange:(d,m)=>{const y=qn(e),E=i.length>0?`${i}.${y}`:y;t.createTexture(a.uuid,`material.${E}`,m);const C=t.getScene(a.uuid);if(C!==null){const I=C.getObjectByProperty("uuid",a.uuid);if(I!==void 0){const K=z=>{const H=I.material,O=E.split(".");switch(O.length){case 1:H[O[0]]=z;break;case 2:H[O[0]][O[1]]=z;break;case 3:H[O[0]][O[1]][O[2]]=z;break;case 4:H[O[0]][O[1]][O[2]][O[3]]=z;break;case 5:H[O[0]][O[1]][O[2]][O[3]][O[4]]=z;break}H.needsUpdate=!0};m.src.length>0?dn(m.src).then(z=>{z.offset.set(m.offset[0],m.offset[1]),z.repeat.set(m.repeat[0],m.repeat[1]),K(z)}):K(null)}}}};if(n.elements!==void 0)return{title:l,prop:s,type:n.elements.length>9?"grid4":"grid3",value:n,disabled:o,onChange:(d,m)=>{t.updateObject(a.uuid,`material.${s}`,m);const y=t.getScene(a.uuid);if(y!==null){const E=y.getObjectByProperty("uuid",a.uuid);Q(E,`material.${s}`,m)}}};{const d=[],m=e==="defines"||e==="extensions";try{for(const y in n){const E=n[y];if(E!==void 0)if(E.value!==void 0){const C=lt(`${y}.value`,E.value,a,t,s,m);C!==void 0&&d.push(C)}else{const C=lt(y,E,a,t,s,m);C!==void 0&&d.push(C)}}}catch{console.log("Issue cycling through material object:",e,n)}if(d.length>0)return Vt(d),{title:l,items:d}}}}}function Xt(e,n,a){const t=[];for(const i in e){if(!Yn(i))continue;const o=typeof e[i],l=e[i];if(o==="boolean")t.push(ta(i,l,n,a));else if(o==="number")t.push(na(i,l,n,a));else if(o==="string")t.push(aa(i,l,n,a));else if(o==="object"){const s=lt(i,l,n,a);s!==void 0&&t.push(s)}else l!==void 0&&console.log("other:",i,o,l)}return Vt(t),t.push({title:"Update Material",type:"button",onChange:()=>{a.updateObject(n.uuid,"material.needsUpdate",!0);const i=a.getScene(n.uuid);if(i!==null){const o=i.getObjectByProperty("uuid",n.uuid);Q(o,"material.needsUpdate",!0)}}}),t}function oa(e,n){const a=e.material;if(Array.isArray(a)){const t=[],i=a.length;for(let o=0;o<i;o++)t.push(u.jsx(Ye,{title:`Material ${o}`,items:Xt(a[o],e,n)},`Material ${o}`));return u.jsx(u.Fragment,{children:t})}else return u.jsx(Ye,{title:"Material",items:Xt(a,e,n)})}const Zt="data:image/gif;base64,R0lGODlhDgFkAIAAAP///wAAACH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDIgNzkuZGJhM2RhM2I1LCAyMDIzLzEyLzE1LTEwOjQyOjM3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjUuNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyMDk3M0NEODAxQjQxMUVGODVGNENDMkUyMUExNDk1NSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoyMDk3M0NEOTAxQjQxMUVGODVGNENDMkUyMUExNDk1NSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkE4ODc3Qzg5MDFCMzExRUY4NUY0Q0MyRTIxQTE0OTU1IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkE4ODc3QzhBMDFCMzExRUY4NUY0Q0MyRTIxQTE0OTU1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEAAAAAAAsAAAAAA4BZAAAAv+Mj6nL7Q+jnLTai7PevPsPhuJIluaJpurKtu4Lx/JM1/aN5/rO9/4PDAqHxKLxiEwql8ym8wmNSqfUqvWKzWq33K73Cw6Lx+Sy+YxOq9fstvsNj8vn9Lr9js/r9/y+/w8YKDhIWGh4iJiouMjY6PgIGSk5SVlpeYmZqTkJAGDQ+dnpuekmGgAKejpKuiZqmprKqoZKGyrbOlqrejub6xvLGyw8TFzcprurGuvqybxq7ETbrItsCz0l7Zpc+6p9/cS967w9/S2FTF0u/mzehK4Oqz3eTl9vf4+fr7/P3+//DzCgwIEECxo8iDChwoUMGzp8CDGixIkUK1q8iDGjxo0XHDt6/AgypMiRJEuaPIkypcqVLFt+KwAAOw==";function ca(e){const n=e.step!==void 0?e.step:.01,a=b.useRef(null),t=b.useRef(null),i=b.useRef(null),o=b.useRef(null),l=b.useRef(null),[s]=b.useState(e.value),[f,d]=b.useState(e.value.offset[0]),[m,y]=b.useState(e.value.offset[1]),[E,C]=b.useState(e.value.repeat[0]),[I,K]=b.useState(e.value.repeat[1]);function z(O,V,k,Z,se){if(e.onChange!==void 0){const w=e.prop!==void 0?e.prop:e.title;e.onChange(w,{src:O,offset:[V,k],repeat:[Z,se]})}}function H(O){const V=a.current.src,k=O.target.value;switch(O.target){case t.current:d(k),z(V,k,m,E,I);break;case i.current:y(k),z(V,f,k,E,I);break;case o.current:C(k),z(V,f,m,k,I);break;case l.current:K(k),z(V,f,m,E,k);break}}return u.jsxs("div",{className:"imageField",children:[u.jsx("img",{alt:e.title,ref:a,onClick:()=>{Kn().then(O=>{a.current.src=O,z(O,f,m,E,I)})},src:s.src.length>0?s.src:Zt}),u.jsxs("div",{className:"fields",children:[u.jsxs("div",{children:[u.jsx("label",{children:"Offset:"}),u.jsx("input",{ref:t,type:"number",value:f,step:n,onChange:H}),u.jsx("input",{ref:i,type:"number",value:m,step:n,onChange:H})]}),u.jsxs("div",{children:[u.jsx("label",{children:"Repeat:"}),u.jsx("input",{ref:o,type:"number",value:E,step:n,onChange:H}),u.jsx("input",{ref:l,type:"number",value:I,step:n,onChange:H})]}),u.jsx("button",{onClick:()=>{z("",f,m,E,I),a.current.src=Zt},children:"Clear"})]})]})}function Ct(e){let n=e.value;n!==void 0&&n.isColor!==void 0&&(n=ln(e.value));const[a,t]=b.useState(n),i=b.useRef(null),o=d=>{let m=d.target.value;e.type==="boolean"?m=d.target.checked:e.type==="option"&&(m=e.options[m].value),t(m),e.onChange!==void 0&&e.onChange(e.prop!==void 0?e.prop:e.title,m)},l={};e.disabled&&(l.opacity=.8);const s=e.type==="string"&&(a.length>100||a.search(`
`)>-1),f=s||e.type==="image"||e.type==="vector2";return u.jsxs("div",{className:`field ${f?"block":""}`,style:l,children:[e.type!=="button"&&u.jsx("label",{ref:i,children:dt(e.title)},"fieldLabel"),e.type==="string"&&!s&&u.jsx("input",{type:"text",disabled:e.disabled,onChange:o,value:a}),e.type==="string"&&s&&u.jsx("textarea",{cols:50,rows:10,disabled:e.disabled!==void 0?e.disabled:!0,onChange:o,onKeyDown:d=>{e.onKeyDown!==void 0&&e.onKeyDown(d)},value:a}),e.type==="boolean"&&u.jsx("input",{type:"checkbox",disabled:e.disabled,onChange:o,checked:a}),e.type==="number"&&u.jsx(We,{value:a,type:e.type,prop:e.prop!==void 0?e.prop:e.title,min:e.min,max:e.max,step:e.step,disabled:e.disabled,labelRef:i,onChange:e.onChange}),e.type==="range"&&u.jsx(We,{value:a,type:e.type,prop:e.prop!==void 0?e.prop:e.title,min:e.min,max:e.max,step:e.step,disabled:e.disabled,labelRef:i,onChange:e.onChange}),e.type==="color"&&u.jsxs(u.Fragment,{children:[u.jsx("input",{type:"text",value:a.toString(),onChange:o,disabled:e.disabled,className:"color"}),u.jsx("input",{type:"color",value:a,onChange:o,disabled:e.disabled})]}),e.type==="button"&&u.jsx("button",{disabled:e.disabled,onClick:()=>{e.onChange!==void 0&&e.onChange(e.prop!==void 0?e.prop:e.title,!0)},children:e.title}),e.type==="image"&&u.jsx(ca,{title:e.title,prop:e.prop,value:e.value,onChange:e.onChange}),e.type==="option"&&u.jsx(u.Fragment,{children:u.jsx("select",{onChange:o,disabled:e.disabled,defaultValue:e.value,children:e.options?.map((d,m)=>u.jsx("option",{value:d.value,children:dt(d.title)},m))})}),e.type==="vector2"&&u.jsx(Gn,{step:e.step,value:a,min:0,max:1,onChange:o}),e.type==="grid3"&&u.jsx(Kt,{step:e.step,value:a,onChange:o}),e.type==="grid4"&&u.jsx(Hn,{step:e.step,value:a,onChange:o}),e.type==="euler"&&u.jsx(Kt,{step:e.step,value:a,onChange:o})]})}function Jt(e){switch(e){case"fov":return"FOV";case"zoom":return"Zoom";case"near":return"Near";case"far":return"Far";case"focus":return"Focus";case"aspect":return"Aspect";case"filmGauge":return"Film Gauge";case"filmOffset":return"Film Offset";case"left":return"Left";case"right":return"Right";case"top":return"Top";case"bottom":return"Bottom"}return e}function la(e,n){const a=[];if(e.perspectiveCameraInfo!==void 0)for(const t in e.perspectiveCameraInfo)a.push({title:Jt(t),prop:t,type:"number",step:.01,value:e.perspectiveCameraInfo[t],onChange:(i,o)=>{n.updateObject(e.uuid,i,o),n.requestMethod(e.uuid,"updateProjectionMatrix");const l=n.getScene(e.uuid);if(l!==null){const s=l.getObjectByProperty("uuid",e.uuid);s!==void 0&&(Q(s,i,o),s.updateProjectionMatrix())}}});else if(e.orthographicCameraInfo!==void 0)for(const t in e.orthographicCameraInfo)a.push({title:Jt(t),prop:t,type:"number",step:.01,value:e.perspectiveCameraInfo[t],onChange:(i,o)=>{n.updateObject(e.uuid,i,o),n.requestMethod(e.uuid,"updateProjectionMatrix");const l=n.getScene(e.uuid);if(l!==null){const s=l.getObjectByProperty("uuid",e.uuid);s!==void 0&&(Q(s,i,o),s.updateProjectionMatrix())}}});return u.jsx(Ye,{title:"Camera",items:a})}function ua(e,n){const a=new h.Matrix4;a.elements=e.matrix;const t=new h.Vector3,i=new h.Euler,o=new h.Vector3;e.uuid.length>0&&(t.setFromMatrixPosition(a),i.setFromRotationMatrix(a),o.setFromMatrixScale(a));const l=(s,f)=>{const d=s==="rotation"?{x:f._x,y:f._y,z:f._z}:f;n.updateObject(e.uuid,s,d);const m=n.getScene(e.uuid);if(m!==null){const y=m.getObjectByProperty("uuid",e.uuid);Q(y,s,d)}};return u.jsx(Ye,{title:"Transform",items:[{title:"Position",prop:"position",type:"grid3",step:.1,value:t,onChange:l},{title:"Rotation",prop:"rotation",type:"grid3",value:i,onChange:l},{title:"Scale",prop:"scale",type:"grid3",value:o,onChange:l}]})}function Qt(e){switch(e){case"color":return"Color";case"intensity":return"Intensity";case"decay":return"Decay";case"distance":return"Distance";case"angle":return"Angle";case"penumbra":return"Penumbra";case"groundColor":return"Ground Color";case"width":return"Width";case"height":return"Height"}return e}function da(e,n){const a=[];if(e.lightInfo!==void 0)for(const t in e.lightInfo){const i=e.lightInfo[t];i!==void 0&&(i.isColor!==void 0?a.push({title:Qt(t),prop:t,type:"color",value:i,onChange:(o,l)=>{const s=new h.Color(l);n.updateObject(e.uuid,o,s);const f=n.getScene(e.uuid);if(f!==null){const d=f.getObjectByProperty("uuid",e.uuid);Q(d,o,s)}}}):a.push({title:Qt(t),prop:t,type:typeof i,value:i,step:typeof i=="number"?.01:void 0,onChange:(o,l)=>{n.updateObject(e.uuid,o,l);const s=n.getScene(e.uuid);if(s!==null){const f=s.getObjectByProperty("uuid",e.uuid);Q(f,o,l)}}}))}return u.jsx(Ye,{title:"Light",items:a})}function ha(e,n){const a=[],t=[];let i=0;e.animations.forEach(l=>{i=Math.max(i,l.duration),l.duration>0&&t.push({title:l.name,items:[{title:"Duration",type:"number",value:l.duration,disabled:!0},{title:"Blend Mode",type:"option",disabled:!0,options:[{title:"Normal",value:2500},{title:"Additive",value:2501}]}]})}),a.push({title:"Animations",items:t});const o=n.getScene(e.uuid);if(o!==null){const l=o.getObjectByProperty("uuid",e.uuid);let s=!1;if(l!==void 0){const f=l.mixer;if(s=f!==void 0,s){const d=[{title:"Time Scale",type:"range",value:f.timeScale,step:.01,min:-1,max:2,onChange:(m,y)=>{f.timeScale=y,n.updateObject(e.uuid,"mixer.timeScale",y)}}];d.push({title:"Stop All",type:"button",onChange:()=>{f.stopAllAction(),n.requestMethod(e.uuid,"stopAllAction",void 0,"mixer")}}),a.push({title:"Mixer",items:d})}}}return u.jsx(Ye,{title:"Animation",items:a})}const vn={name:"",uuid:"",type:"",visible:!1,matrix:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],animations:[],material:void 0,perspectiveCameraInfo:void 0,orthographicCameraInfo:void 0,lightInfo:void 0,children:[]};let pe={...vn};function bn(e){const[n,a]=b.useState(-1);b.useEffect(()=>{function l(f){pe={...f.value},a(Date.now())}function s(){pe={...vn},a(Date.now())}return D.addEventListener(A.SET_SCENE,s),D.addEventListener(A.SET_OBJECT,l),()=>{D.removeEventListener(A.SET_SCENE,s),D.removeEventListener(A.SET_OBJECT,l)}},[]);const t=pe.type.toLowerCase(),i=pe.animations.length>0||pe.mixer!==void 0,o=t.search("mesh")>-1||t.search("line")>-1||t.search("points")>-1;return u.jsx(ft,{label:"Inspector",children:u.jsx("div",{id:"Inspector",className:e.class,children:pe.uuid.length>0&&u.jsxs(u.Fragment,{children:[u.jsxs(u.Fragment,{children:[u.jsx(Ct,{type:"string",title:"Name",prop:"name",value:pe.name,disabled:!0}),u.jsx(Ct,{type:"string",title:"Type",prop:"type",value:pe.type,disabled:!0}),u.jsx(Ct,{type:"string",title:"UUID",prop:"uuid",value:pe.uuid,disabled:!0})]}),u.jsxs(u.Fragment,{children:[ua(pe,e.three),i?ha(pe,e.three):null,t.search("camera")>-1?la(pe,e.three):null,t.search("light")>-1?da(pe,e.three):null,o?oa(pe,e.three):null]})]})},n)},"Inspector")}function fa(e){const[n]=b.useState([]),[a]=b.useState([]),[t,i]=b.useState(0),o=f=>{const d=f.value;n.push(d),a.push(u.jsx(ft,{label:`Scene: ${d.name}`,scene:d,open:!0,onRefresh:()=>{e.three.refreshScene(d.name)},children:u.jsx(Ut,{child:d,scene:d,three:e.three})},Math.random())),i(Date.now())},l=f=>{const d=f.value;for(let m=0;m<n.length;m++)if(d.uuid===n[m].uuid){n[m]=d,a[m]=u.jsx(ft,{label:`Scene: ${d.name}`,scene:d,open:!0,onRefresh:()=>{e.three.refreshScene(d.name)},children:u.jsx(Ut,{child:d,scene:d,three:e.three})},Math.random()),i(Date.now());return}},s=f=>{const d=f.value;for(let m=0;m<n.length;m++)if(d.uuid===n[m].uuid){n.splice(m,1),a.splice(m,1),i(Date.now());return}};return b.useEffect(()=>(D.addEventListener(A.ADD_SCENE,o),D.addEventListener(A.REFRESH_SCENE,l),D.addEventListener(A.REMOVE_SCENE,s),()=>{D.removeEventListener(A.ADD_SCENE,o),D.removeEventListener(A.REFRESH_SCENE,l),D.removeEventListener(A.REMOVE_SCENE,s)}),[]),u.jsxs("div",{id:"SidePanel",children:[u.jsx("div",{children:a},t),u.jsx(bn,{three:e.three})]})}function ma(e){return b.useEffect(()=>{function n(s){let f=null;return e.three.scenes.forEach(d=>{s.search(d.uuid)>-1&&(f=d)}),f}const a=s=>{const f=s.value,m=n(f)?.getObjectByProperty("uuid",f);m!==void 0&&e.three.setObject(m)},t=(s,f,d)=>{const y=n(s)?.getObjectByProperty("uuid",s);y!==void 0&&Q(y,f,d)},i=s=>{const f=s.value,{key:d,value:m,uuid:y}=f;t(y,d,m)},o=s=>{const f=s.value,m=n(f.uuid)?.getObjectByProperty("uuid",f.uuid);if(m!==void 0){const y=E=>{const C=f.key.split(".");switch(C.length){case 1:m[C[0]]=E;break;case 2:m[C[0]][C[1]]=E;break;case 3:m[C[0]][C[1]][C[2]]=E;break;case 4:m[C[0]][C[1]][C[2]][C[3]]=E;break;case 5:m[C[0]][C[1]][C[2]][C[3]][C[4]]=E;break}m.material.needsUpdate=!0};f.value.src.length>0?dn(f.value.src).then(E=>{E.offset.set(f.value.offset[0],f.value.offset[1]),E.repeat.set(f.value.repeat[0],f.value.repeat[1]),y(E)}):y(null)}},l=s=>{const{key:f,uuid:d,value:m,subitem:y}=s.value,C=n(d)?.getObjectByProperty("uuid",d);if(C!==void 0)try{y!==void 0?In(C,y)[f](m):C[f](m)}catch(I){console.log("Error requesting method:"),console.log(I),console.log(f),console.log(m)}};return D.addEventListener(A.GET_OBJECT,a),D.addEventListener(A.UPDATE_OBJECT,i),D.addEventListener(A.CREATE_TEXTURE,o),D.addEventListener(A.REQUEST_METHOD,l),()=>{D.removeEventListener(A.GET_OBJECT,a),D.removeEventListener(A.UPDATE_OBJECT,i),D.removeEventListener(A.CREATE_TEXTURE,o),D.removeEventListener(A.REQUEST_METHOD,l)}},[]),null}class pa extends h.Line{constructor(n,a){const t=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],i=new h.BufferGeometry;i.setAttribute("position",new h.Float32BufferAttribute(t,3)),i.computeBoundingSphere();const o=new h.LineBasicMaterial({fog:!1});super(i,o),this.light=n,this.color=a,this.type="RectAreaLightHelper";const l=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],s=new h.BufferGeometry;s.setAttribute("position",new h.Float32BufferAttribute(l,3)),s.computeBoundingSphere(),this.add(new h.Mesh(s,new h.MeshBasicMaterial({side:h.BackSide,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),this.color!==void 0)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const n=this.material.color,a=Math.max(n.r,n.g,n.b);a>1&&n.multiplyScalar(1/a),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const en={type:"change"},Pt={type:"start"},tn={type:"end"},St=new h.Ray,nn=new h.Plane,ga=Math.cos(70*h.MathUtils.DEG2RAD);class va extends h.EventDispatcher{constructor(n,a){super(),this.object=n,this.domElement=a,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new h.Vector3,this.cursor=new h.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:h.MOUSE.ROTATE,MIDDLE:h.MOUSE.DOLLY,RIGHT:h.MOUSE.PAN},this.touches={ONE:h.TOUCH.ROTATE,TWO:h.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return s.phi},this.getAzimuthalAngle=function(){return s.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(c){c.addEventListener("keydown",it),this._domElementKeyEvents=c},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",it),this._domElementKeyEvents=null},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(en),t.update(),o=i.NONE},this.update=function(){const c=new h.Vector3,x=new h.Quaternion().setFromUnitVectors(n.up,new h.Vector3(0,1,0)),j=x.clone().invert(),U=new h.Vector3,ie=new h.Quaternion,Ee=new h.Vector3,de=2*Math.PI;return function(bt=null){const yt=t.object.position;c.copy(yt).sub(t.target),c.applyQuaternion(x),s.setFromVector3(c),t.autoRotate&&o===i.NONE&&_e(tt(bt)),t.enableDamping?(s.theta+=f.theta*t.dampingFactor,s.phi+=f.phi*t.dampingFactor):(s.theta+=f.theta,s.phi+=f.phi);let Se=t.minAzimuthAngle,xe=t.maxAzimuthAngle;isFinite(Se)&&isFinite(xe)&&(Se<-Math.PI?Se+=de:Se>Math.PI&&(Se-=de),xe<-Math.PI?xe+=de:xe>Math.PI&&(xe-=de),Se<=xe?s.theta=Math.max(Se,Math.min(xe,s.theta)):s.theta=s.theta>(Se+xe)/2?Math.max(Se,s.theta):Math.min(xe,s.theta)),s.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,s.phi)),s.makeSafe(),t.enableDamping===!0?t.target.addScaledVector(m,t.dampingFactor):t.target.add(m),t.target.sub(t.cursor),t.target.clampLength(t.minTargetRadius,t.maxTargetRadius),t.target.add(t.cursor);let Ge=!1;if(t.zoomToCursor&&se||t.object.isOrthographicCamera)s.radius=Ie(s.radius);else{const Re=s.radius;s.radius=Ie(s.radius*d),Ge=Re!=s.radius}if(c.setFromSpherical(s),c.applyQuaternion(j),yt.copy(t.target).add(c),t.object.lookAt(t.target),t.enableDamping===!0?(f.theta*=1-t.dampingFactor,f.phi*=1-t.dampingFactor,m.multiplyScalar(1-t.dampingFactor)):(f.set(0,0,0),m.set(0,0,0)),t.zoomToCursor&&se){let Re=null;if(t.object.isPerspectiveCamera){const Ue=c.length();Re=Ie(Ue*d);const Ke=Ue-Re;t.object.position.addScaledVector(k,Ke),t.object.updateMatrixWorld(),Ge=!!Ke}else if(t.object.isOrthographicCamera){const Ue=new h.Vector3(Z.x,Z.y,0);Ue.unproject(t.object);const Ke=t.object.zoom;t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/d)),t.object.updateProjectionMatrix(),Ge=Ke!==t.object.zoom;const Et=new h.Vector3(Z.x,Z.y,0);Et.unproject(t.object),t.object.position.sub(Et).add(Ue),t.object.updateMatrixWorld(),Re=c.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),t.zoomToCursor=!1;Re!==null&&(this.screenSpacePanning?t.target.set(0,0,-1).transformDirection(t.object.matrix).multiplyScalar(Re).add(t.object.position):(St.origin.copy(t.object.position),St.direction.set(0,0,-1).transformDirection(t.object.matrix),Math.abs(t.object.up.dot(St.direction))<ga?n.lookAt(t.target):(nn.setFromNormalAndCoplanarPoint(t.object.up,t.target),St.intersectPlane(nn,t.target))))}else if(t.object.isOrthographicCamera){const Re=t.object.zoom;t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/d)),Re!==t.object.zoom&&(t.object.updateProjectionMatrix(),Ge=!0)}return d=1,se=!1,Ge||U.distanceToSquared(t.object.position)>l||8*(1-ie.dot(t.object.quaternion))>l||Ee.distanceToSquared(t.target)>l?(t.dispatchEvent(en),U.copy(t.object.position),ie.copy(t.object.quaternion),Ee.copy(t.target),!0):!1}}(),this.dispose=function(){t.domElement.removeEventListener("contextmenu",qe),t.domElement.removeEventListener("pointerdown",F),t.domElement.removeEventListener("pointercancel",$),t.domElement.removeEventListener("wheel",ue),t.domElement.removeEventListener("pointermove",te),t.domElement.removeEventListener("pointerup",$),t.domElement.getRootNode().removeEventListener("keydown",at,{capture:!0}),t._domElementKeyEvents!==null&&(t._domElementKeyEvents.removeEventListener("keydown",it),t._domElementKeyEvents=null)};const t=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=i.NONE;const l=1e-6,s=new h.Spherical,f=new h.Spherical;let d=1;const m=new h.Vector3,y=new h.Vector2,E=new h.Vector2,C=new h.Vector2,I=new h.Vector2,K=new h.Vector2,z=new h.Vector2,H=new h.Vector2,O=new h.Vector2,V=new h.Vector2,k=new h.Vector3,Z=new h.Vector2;let se=!1;const w=[],ge={};let Y=!1;function tt(c){return c!==null?2*Math.PI/60*t.autoRotateSpeed*c:2*Math.PI/60/60*t.autoRotateSpeed}function P(c){const x=Math.abs(c*.01);return Math.pow(.95,t.zoomSpeed*x)}function _e(c){f.theta-=c}function oe(c){f.phi-=c}const ve=function(){const c=new h.Vector3;return function(j,U){c.setFromMatrixColumn(U,0),c.multiplyScalar(-j),m.add(c)}}(),we=function(){const c=new h.Vector3;return function(j,U){t.screenSpacePanning===!0?c.setFromMatrixColumn(U,1):(c.setFromMatrixColumn(U,0),c.crossVectors(t.object.up,c)),c.multiplyScalar(j),m.add(c)}}(),be=function(){const c=new h.Vector3;return function(j,U){const ie=t.domElement;if(t.object.isPerspectiveCamera){const Ee=t.object.position;c.copy(Ee).sub(t.target);let de=c.length();de*=Math.tan(t.object.fov/2*Math.PI/180),ve(2*j*de/ie.clientHeight,t.object.matrix),we(2*U*de/ie.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(ve(j*(t.object.right-t.object.left)/t.object.zoom/ie.clientWidth,t.object.matrix),we(U*(t.object.top-t.object.bottom)/t.object.zoom/ie.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}}();function Me(c){t.object.isPerspectiveCamera||t.object.isOrthographicCamera?d/=c:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function Ne(c){t.object.isPerspectiveCamera||t.object.isOrthographicCamera?d*=c:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function Pe(c,x){if(!t.zoomToCursor)return;se=!0;const j=t.domElement.getBoundingClientRect(),U=c-j.left,ie=x-j.top,Ee=j.width,de=j.height;Z.x=U/Ee*2-1,Z.y=-(ie/de)*2+1,k.set(Z.x,Z.y,1).unproject(t.object).sub(t.object.position).normalize()}function Ie(c){return Math.max(t.minDistance,Math.min(t.maxDistance,c))}function ze(c){y.set(c.clientX,c.clientY)}function Le(c){Pe(c.clientX,c.clientX),H.set(c.clientX,c.clientY)}function ee(c){I.set(c.clientX,c.clientY)}function Oe(c){E.set(c.clientX,c.clientY),C.subVectors(E,y).multiplyScalar(t.rotateSpeed);const x=t.domElement;_e(2*Math.PI*C.x/x.clientHeight),oe(2*Math.PI*C.y/x.clientHeight),y.copy(E),t.update()}function nt(c){O.set(c.clientX,c.clientY),V.subVectors(O,H),V.y>0?Me(P(V.y)):V.y<0&&Ne(P(V.y)),H.copy(O),t.update()}function $e(c){K.set(c.clientX,c.clientY),z.subVectors(K,I).multiplyScalar(t.panSpeed),be(z.x,z.y),I.copy(K),t.update()}function fe(c){Pe(c.clientX,c.clientY),c.deltaY<0?Ne(P(c.deltaY)):c.deltaY>0&&Me(P(c.deltaY)),t.update()}function p(c){let x=!1;switch(c.code){case t.keys.UP:c.ctrlKey||c.metaKey||c.shiftKey?oe(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):be(0,t.keyPanSpeed),x=!0;break;case t.keys.BOTTOM:c.ctrlKey||c.metaKey||c.shiftKey?oe(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):be(0,-t.keyPanSpeed),x=!0;break;case t.keys.LEFT:c.ctrlKey||c.metaKey||c.shiftKey?_e(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):be(t.keyPanSpeed,0),x=!0;break;case t.keys.RIGHT:c.ctrlKey||c.metaKey||c.shiftKey?_e(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):be(-t.keyPanSpeed,0),x=!0;break}x&&(c.preventDefault(),t.update())}function v(c){if(w.length===1)y.set(c.pageX,c.pageY);else{const x=Be(c),j=.5*(c.pageX+x.x),U=.5*(c.pageY+x.y);y.set(j,U)}}function T(c){if(w.length===1)I.set(c.pageX,c.pageY);else{const x=Be(c),j=.5*(c.pageX+x.x),U=.5*(c.pageY+x.y);I.set(j,U)}}function L(c){const x=Be(c),j=c.pageX-x.x,U=c.pageY-x.y,ie=Math.sqrt(j*j+U*U);H.set(0,ie)}function me(c){t.enableZoom&&L(c),t.enablePan&&T(c)}function le(c){t.enableZoom&&L(c),t.enableRotate&&v(c)}function R(c){if(w.length==1)E.set(c.pageX,c.pageY);else{const j=Be(c),U=.5*(c.pageX+j.x),ie=.5*(c.pageY+j.y);E.set(U,ie)}C.subVectors(E,y).multiplyScalar(t.rotateSpeed);const x=t.domElement;_e(2*Math.PI*C.x/x.clientHeight),oe(2*Math.PI*C.y/x.clientHeight),y.copy(E)}function M(c){if(w.length===1)K.set(c.pageX,c.pageY);else{const x=Be(c),j=.5*(c.pageX+x.x),U=.5*(c.pageY+x.y);K.set(j,U)}z.subVectors(K,I).multiplyScalar(t.panSpeed),be(z.x,z.y),I.copy(K)}function W(c){const x=Be(c),j=c.pageX-x.x,U=c.pageY-x.y,ie=Math.sqrt(j*j+U*U);O.set(0,ie),V.set(0,Math.pow(O.y/H.y,t.zoomSpeed)),Me(V.y),H.copy(O);const Ee=(c.pageX+x.x)*.5,de=(c.pageY+x.y)*.5;Pe(Ee,de)}function ae(c){t.enableZoom&&W(c),t.enablePan&&M(c)}function ye(c){t.enableZoom&&W(c),t.enableRotate&&R(c)}function F(c){t.enabled!==!1&&(w.length===0&&(t.domElement.setPointerCapture(c.pointerId),t.domElement.addEventListener("pointermove",te),t.domElement.addEventListener("pointerup",$)),!Dt(c)&&(_t(c),c.pointerType==="touch"?rt(c):ke(c)))}function te(c){t.enabled!==!1&&(c.pointerType==="touch"?gt(c):ce(c))}function $(c){switch(kt(c),w.length){case 0:t.domElement.releasePointerCapture(c.pointerId),t.domElement.removeEventListener("pointermove",te),t.domElement.removeEventListener("pointerup",$),t.dispatchEvent(tn),o=i.NONE;break;case 1:const x=w[0],j=ge[x];rt({pointerId:x,pageX:j.x,pageY:j.y});break}}function ke(c){let x;switch(c.button){case 0:x=t.mouseButtons.LEFT;break;case 1:x=t.mouseButtons.MIDDLE;break;case 2:x=t.mouseButtons.RIGHT;break;default:x=-1}switch(x){case h.MOUSE.DOLLY:if(t.enableZoom===!1)return;Le(c),o=i.DOLLY;break;case h.MOUSE.ROTATE:if(c.ctrlKey||c.metaKey||c.shiftKey){if(t.enablePan===!1)return;ee(c),o=i.PAN}else{if(t.enableRotate===!1)return;ze(c),o=i.ROTATE}break;case h.MOUSE.PAN:if(c.ctrlKey||c.metaKey||c.shiftKey){if(t.enableRotate===!1)return;ze(c),o=i.ROTATE}else{if(t.enablePan===!1)return;ee(c),o=i.PAN}break;default:o=i.NONE}o!==i.NONE&&t.dispatchEvent(Pt)}function ce(c){switch(o){case i.ROTATE:if(t.enableRotate===!1)return;Oe(c);break;case i.DOLLY:if(t.enableZoom===!1)return;nt(c);break;case i.PAN:if(t.enablePan===!1)return;$e(c);break}}function ue(c){t.enabled===!1||t.enableZoom===!1||o!==i.NONE||(c.preventDefault(),t.dispatchEvent(Pt),fe(pt(c)),t.dispatchEvent(tn))}function pt(c){const x=c.deltaMode,j={clientX:c.clientX,clientY:c.clientY,deltaY:c.deltaY};switch(x){case 1:j.deltaY*=16;break;case 2:j.deltaY*=100;break}return c.ctrlKey&&!Y&&(j.deltaY*=10),j}function at(c){c.key==="Control"&&(Y=!0,t.domElement.getRootNode().addEventListener("keyup",Fe,{passive:!0,capture:!0}))}function Fe(c){c.key==="Control"&&(Y=!1,t.domElement.getRootNode().removeEventListener("keyup",Fe,{passive:!0,capture:!0}))}function it(c){t.enabled===!1||t.enablePan===!1||p(c)}function rt(c){switch(vt(c),w.length){case 1:switch(t.touches.ONE){case h.TOUCH.ROTATE:if(t.enableRotate===!1)return;v(c),o=i.TOUCH_ROTATE;break;case h.TOUCH.PAN:if(t.enablePan===!1)return;T(c),o=i.TOUCH_PAN;break;default:o=i.NONE}break;case 2:switch(t.touches.TWO){case h.TOUCH.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;me(c),o=i.TOUCH_DOLLY_PAN;break;case h.TOUCH.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;le(c),o=i.TOUCH_DOLLY_ROTATE;break;default:o=i.NONE}break;default:o=i.NONE}o!==i.NONE&&t.dispatchEvent(Pt)}function gt(c){switch(vt(c),o){case i.TOUCH_ROTATE:if(t.enableRotate===!1)return;R(c),t.update();break;case i.TOUCH_PAN:if(t.enablePan===!1)return;M(c),t.update();break;case i.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;ae(c),t.update();break;case i.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;ye(c),t.update();break;default:o=i.NONE}}function qe(c){t.enabled!==!1&&c.preventDefault()}function _t(c){w.push(c.pointerId)}function kt(c){delete ge[c.pointerId];for(let x=0;x<w.length;x++)if(w[x]==c.pointerId){w.splice(x,1);return}}function Dt(c){for(let x=0;x<w.length;x++)if(w[x]==c.pointerId)return!0;return!1}function vt(c){let x=ge[c.pointerId];x===void 0&&(x=new h.Vector2,ge[c.pointerId]=x),x.set(c.pageX,c.pageY)}function Be(c){const x=c.pointerId===w[0]?w[1]:w[0];return ge[x]}t.domElement.addEventListener("contextmenu",qe),t.domElement.addEventListener("pointerdown",F),t.domElement.addEventListener("pointercancel",$),t.domElement.addEventListener("wheel",ue,{passive:!1}),t.domElement.getRootNode().addEventListener("keydown",at,{passive:!0,capture:!0}),this.update()}}function Je(e,n,a,t,i){return t+(e-n)*(i-t)/(a-n)}const Mt=e=>{const[n,a]=b.useState(e.options[e.index]),t=()=>{e.onToggle(!e.open)},i=o=>{o!==n&&(e.onSelect(o),a(o)),e.onToggle(!1)};return u.jsxs("div",{className:`dropdown ${e.up===!0?"up":""}`,children:[u.jsx("div",{className:"dropdown-toggle",onClick:t,children:n}),e.open&&u.jsx("ul",{className:"dropdown-menu",children:e.options.map(o=>u.jsx("li",{onClick:()=>i(o),children:o},o))})]})},He=b.forwardRef(function(n,a){const t=["Renderer","Depth","Normals","UVs","Wireframe"],[i,o]=b.useState("Renderer"),[l,s]=b.useState(!1),[f,d]=b.useState(!1),[m,y]=b.useState(!1);return u.jsxs("div",{className:"CameraWindow",children:[u.jsx("div",{ref:a,className:"clickable",onClick:()=>{m&&y(!1)}}),u.jsx(Mt,{index:t.indexOf(i),open:f,options:t,onSelect:E=>{if(E===i)return;const C=E;n.onSelectRenderMode(C),o(C)},onToggle:E=>{l&&s(!1),d(E)},up:!0}),u.jsx(Mt,{index:n.options.indexOf(n.camera.name),open:m,options:n.options,onSelect:n.onSelectCamera,onToggle:E=>{y(E)},up:!0})]})});class ba extends h.ShaderMaterial{constructor(n){super({extensions:{derivatives:!0},glslVersion:h.GLSL3,side:h.DoubleSide,transparent:!0,uniforms:{uScale:{value:n?.scale!==void 0?n?.scale:.1},uDivisions:{value:n?.divisions!==void 0?n?.divisions:10},uColor:{value:n?.color!==void 0?n?.color:new h.Color(16777215)},uDistance:{value:n?.distance!==void 0?n?.distance:1e4},uSubgridOpacity:{value:n?.subgridOpacity!==void 0?n?.subgridOpacity:.15},uGridOpacity:{value:n?.gridOpacity!==void 0?n?.gridOpacity:.25}},vertexShader:`out vec3 worldPosition;
      uniform float uDistance;
      
      void main() {
        // Scale the plane by the drawing distance
        worldPosition = position.xzy * uDistance;
        worldPosition.xz += cameraPosition.xz;
      
        gl_Position = projectionMatrix * modelViewMatrix * vec4(worldPosition, 1.0);
      }`,fragmentShader:`out vec4 fragColor;
      in vec3 worldPosition;
      
      uniform float uDivisions;
      uniform float uScale;
      uniform vec3 uColor;
      uniform float uDistance;
      uniform float uSubgridOpacity;
      uniform float uGridOpacity;
      
      float getGrid(float gapSize) {
        vec2 worldPositionByDivision = worldPosition.xz / gapSize;
      
        // Inverted, 0 where line, >1 where there's no line
        // We use the worldPosition (which in this case we use similarly to UVs) differential to control the anti-aliasing
        // We need to do the -0.5)-0.5 trick because the result fades out from 0 to 1, and we want both
        // worldPositionByDivision == 0.3 and worldPositionByDivision == 0.7 to result in the same fade, i.e. 0.3,
        // otherwise only one side of the line will be anti-aliased
        vec2 grid = abs(fract(worldPositionByDivision-0.5)-0.5) / fwidth(worldPositionByDivision) / 2.0;
        float gridLine = min(grid.x, grid.y);
      
        // Uninvert and clamp
        return 1.0 - min(gridLine, 1.0);
      }
      
      void main() {
        float cameraDistanceToGridPlane = distance(cameraPosition.y, worldPosition.y);
        float cameraDistanceToFragmentOnGridPlane = distance(cameraPosition.xz, worldPosition.xz);
      
        // The size of the grid and subgrid are powers of each other and they are determined based on camera distance.
        // The current grid will become the next subgrid when it becomes too small, and its next power becomes the new grid.
        float subGridPower = pow(uDivisions, floor(log(cameraDistanceToGridPlane) / log(uDivisions)));
        float gridPower = subGridPower * uDivisions;
      
        // If we want to fade both the grid and its subgrid, we need to displays 3 different opacities, with the next grid being the third
        float nextGridPower = gridPower * uDivisions;
      
        // 1 where grid, 0 where no grid
        float subgrid = getGrid(subGridPower * uScale);
        float grid = getGrid(gridPower * uScale);
        float nextGrid = getGrid(nextGridPower * uScale);
      
        // Where we are between the introduction of the current grid power and when we switch to the next grid power
        float stepPercentage = (cameraDistanceToGridPlane - subGridPower)/(gridPower - subGridPower);
      
        // The last x percentage of the current step over which we want to fade
        float fadeRange = 0.3;
      
        // We calculate the fade percentage from the step percentage and the fade range
        float fadePercentage = max(stepPercentage - 1.0 + fadeRange, 0.0) / fadeRange;
      
        // Set base opacity based on how close we are to the drawing distance, with a cubic falloff
        float baseOpacity = subgrid * pow(1.0 - min(cameraDistanceToFragmentOnGridPlane / uDistance, 1.0), 3.0);
      
        // Shade the subgrid
        fragColor = vec4(uColor.rgb, (baseOpacity - fadePercentage) * uSubgridOpacity);
      
        // Somewhat arbitrary additional fade coefficient to counter anti-aliasing popping when switching between grid powers
        float fadeCoefficient = 0.5;
      
        // Shade the grid
        fragColor.a = mix(fragColor.a, baseOpacity * uGridOpacity - fadePercentage * (uGridOpacity - uSubgridOpacity) * fadeCoefficient, grid);
      
        // Shade the next grid
        fragColor.a = mix(fragColor.a, baseOpacity * uGridOpacity, nextGrid);
      
        if (fragColor.a <= 0.0) discard;
      }`,name:"InfiniteGrid",depthWrite:!1})}}class ya extends h.Mesh{gridMaterial;constructor(){const n=new ba;super(new h.PlaneGeometry(2,2),n),this.gridMaterial=n,this.frustumCulled=!1,this.name="InfiniteGridHelper",this.position.y=.1}update(){this.gridMaterial.needsUpdate=!0}}const Ea=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>

	#if defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
}`,Sa=`
#include <common>
#include <uv_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
	#include <clipping_planes_fragment>
	gl_FragColor = vec4(vec3(vUv, 0.0), 1.0);
}`;class xa extends h.ShaderMaterial{constructor(){super({defines:{USE_UV:""},vertexShader:Ea,fragmentShader:Sa})}}let Te,It=!1,X=null,re=null,De=null,Ae=null,Qe="Renderer",xt="Renderer",an="Renderer",rn="Renderer";function Ca(e){const n=e.three.app.appID,a=b.useMemo(()=>new Map,[]),t=b.useMemo(()=>new Map,[]),i=b.useMemo(()=>new Map,[]),o=b.useMemo(()=>new Map,[]),l=b.useMemo(()=>new h.Scene,[]),s=b.useMemo(()=>new h.Group,[]),f=b.useMemo(()=>new ya,[]),d=b.useMemo(()=>new h.AxesHelper(500),[]),m=b.useMemo(()=>new h.AxesHelper(100),[]),y=b.useMemo(()=>new h.MeshDepthMaterial,[]),E=b.useMemo(()=>new h.MeshNormalMaterial,[]),C=b.useMemo(()=>new xa,[]),I=b.useMemo(()=>new h.MeshBasicMaterial({opacity:.33,transparent:!0,wireframe:!0}),[]);function K(p,v){const T=new h.OrthographicCamera(-100,100,100,-100,50,5e3);return T.name=p,T.position.copy(v),T.lookAt(0,0,0),a.set(p,T),T}const z=["Single","Side by Side","Stacked","Quad"],H=b.useRef(null),O=b.useRef(null),V=b.useRef(null),k=b.useRef(null),Z=b.useRef(null),se=b.useRef(null),w=localStorage,ge=w.getItem(`${n}_mode`),[Y,tt]=b.useState(ge!==null?ge:"Single"),[P,_e]=b.useState(null),[oe,ve]=b.useState(!1),[we,be]=b.useState(!1),[Me,Ne]=b.useState("Orbit"),[Pe,Ie]=b.useState(!1),[ze,Le]=b.useState(Date.now());w.setItem(`${n}_mode`,Y),w.setItem(`${n}_tlCam`,w.getItem(`${n}_tlCam`)!==null?w.getItem(`${n}_tlCam`):"Debug"),w.setItem(`${n}_trCam`,w.getItem(`${n}_trCam`)!==null?w.getItem(`${n}_trCam`):"Orthographic"),w.setItem(`${n}_blCam`,w.getItem(`${n}_blCam`)!==null?w.getItem(`${n}_blCam`):"Front"),w.setItem(`${n}_brCam`,w.getItem(`${n}_brCam`)!==null?w.getItem(`${n}_brCam`):"Top"),w.setItem(`${n}_tlRender`,w.getItem(`${n}_tlRender`)!==null?w.getItem(`${n}_tlRender`):"Renderer"),w.setItem(`${n}_trRender`,w.getItem(`${n}_trRender`)!==null?w.getItem(`${n}_trRender`):"Renderer"),w.setItem(`${n}_blRender`,w.getItem(`${n}_blRender`)!==null?w.getItem(`${n}_blRender`):"Renderer"),w.setItem(`${n}_brRender`,w.getItem(`${n}_brRender`)!==null?w.getItem(`${n}_brRender`):"Renderer");const ee=(p,v)=>{const T=t.get(p.name);if(T!==void 0&&T.dispose(),t.delete(p.name),p.name==="UI")return;const L=new va(p,v);switch(L.enableDamping=!0,L.dampingFactor=.05,p.name){case"Top":case"Bottom":case"Left":case"Right":case"Front":case"Back":L.enableRotate=!1;break}t.set(p.name,L)},Oe=p=>{const v=i.get(p.name);v!==void 0&&(l.remove(v),v.dispose(),i.delete(p.name));const T=t.get(p.name);T!==void 0&&(T.dispose(),t.delete(p.name))},nt=()=>{t.forEach((p,v)=>{p.dispose();const T=i.get(v);T!==void 0&&(l.remove(T),T.dispose()),i.delete(v),t.delete(v)}),t.clear(),i.clear()},$e=()=>{switch(Y){case"Single":ee(X,V.current);break;case"Side by Side":case"Stacked":ee(X,V.current),ee(re,k.current);break;case"Quad":ee(X,V.current),ee(re,k.current),ee(De,Z.current),ee(Ae,se.current);break}};b.useEffect(()=>{const p=new h.WebGLRenderer({canvas:H.current,stencil:!1});p.autoClear=!1,p.shadowMap.enabled=!0,p.setPixelRatio(devicePixelRatio),p.setClearColor(0),e.three.renderer=p,_e(p)},[]),b.useEffect(()=>{l.name="Debug Scene",l.uuid="",s.name="helpers",l.add(s),s.add(f),d.name="axisHelper",s.add(d),m.name="interactionHelper",s.add(m),m.visible=!1,K("Top",new h.Vector3(0,1e3,0)),K("Bottom",new h.Vector3(0,-1e3,0)),K("Left",new h.Vector3(-1e3,0,0)),K("Right",new h.Vector3(1e3,0,0)),K("Front",new h.Vector3(0,0,1e3)),K("Back",new h.Vector3(0,0,-1e3)),K("Orthographic",new h.Vector3(1e3,1e3,1e3)),K("UI",new h.Vector3);const p=new h.PerspectiveCamera(60,1,50,5e3);p.name="Debug",p.position.set(500,500,500),p.lookAt(0,0,0),a.set("Debug",p),X=a.get(w.getItem(`${n}_tlCam`)),re=a.get(w.getItem(`${n}_trCam`)),De=a.get(w.getItem(`${n}_blCam`)),Ae=a.get(w.getItem(`${n}_brCam`)),X===void 0&&(X=a.get("Debug")),re===void 0&&(re=a.get("Orthographic")),De===void 0&&(De=a.get("Front")),Ae===void 0&&(Ae=a.get("Top"))},[]),b.useEffect(()=>{const p=()=>{o.forEach(R=>{s.remove(R),R.dispose()}),o.clear()},v=()=>{Te.traverse(R=>{if(R.type.search("Light")>-1){let M;switch(R.type){case"DirectionalLight":M=new h.DirectionalLightHelper(R,100),M.name=`${R.name}Helper`,o.set(R.name,M),s.add(M);break;case"HemisphereLight":M=new h.HemisphereLightHelper(R,250),M.name=`${R.name}Helper`,o.set(R.name,M),s.add(M);break;case"RectAreaLight":M=new pa(R),M.name=`${R.name}Helper`,o.set(R.name,M),s.add(M);break;case"PointLight":M=new h.PointLightHelper(R,100),M.name=`${R.name}Helper`,o.set(R.name,M),s.add(M);break;case"SpotLight":M=new h.SpotLightHelper(R),M.name=`${R.name}Helper`,o.set(R.name,M),s.add(M);break}}})},T=R=>{s.add(d),p(),ht(Te),l.remove(Te);const M=e.scenes.get(R.value.name);if(M!==void 0){const W=new M;e.onSceneSet!==void 0&&e.onSceneSet(W),Te=W,e.three.scene=Te,l.add(Te),It=!0,v()}},L=R=>{const M=R.value,W=e.three.scene?.getObjectByProperty("uuid",M.uuid);if(W!==void 0&&a.set(M.name,W),W instanceof h.PerspectiveCamera){const ae=new h.CameraHelper(W);i.set(W.name,ae),l.add(ae)}Le(Date.now())},me=R=>{const M=i.get(R.value.name);M!==void 0&&(l.remove(M),M.dispose()),a.delete(R.value.name),Le(Date.now())},le=R=>{const M=Te.getObjectByProperty("uuid",R.value.uuid);M&&M.add(d)};return D.addEventListener(A.SET_SCENE,T),D.addEventListener(A.ADD_CAMERA,L),D.addEventListener(A.REMOVE_CAMERA,me),D.addEventListener(A.SET_OBJECT,le),()=>{D.removeEventListener(A.SET_SCENE,T),D.removeEventListener(A.ADD_CAMERA,L),D.removeEventListener(A.REMOVE_CAMERA,me),D.removeEventListener(A.SET_OBJECT,le)}},[]),b.useEffect(()=>{if(P===null)return;let p=window.innerWidth,v=window.innerHeight,T=Math.floor(p/2),L=Math.floor(v/2),me=-1;const le=()=>{p=window.innerWidth-300,v=window.innerHeight,T=Math.floor(p/2),L=Math.floor(v/2),e.three.resize(p,v),e.onSceneResize!==void 0&&It&&e.onSceneResize(Te,p,v);let F=p,te=v;switch(Y){case"Side by Side":F=T,te=v;break;case"Stacked":F=p,te=L;break;case"Quad":F=T,te=L;break}a.forEach($=>{$ instanceof h.OrthographicCamera?($.left=F/-2,$.right=F/2,$.top=te/2,$.bottom=te/-2,$.name==="UI"&&($.position.x=p/2,$.position.y=v/-2,$.position.z=100),$.updateProjectionMatrix()):$ instanceof h.PerspectiveCamera&&($.aspect=F/te,$.updateProjectionMatrix(),i.get($.name)?.update())})};function R(F){switch(F){case"Depth":return y;case"Normals":return E;case"Renderer":return null;case"UVs":return C;case"Wireframe":return I}return null}const M=()=>{const F=R(Qe);l.overrideMaterial=F,P.setViewport(0,0,p,v),P.setScissor(0,0,p,v),P.render(l,X)},W=()=>{const F=R(Qe),te=R(xt);if(l.overrideMaterial=F,Y==="Side by Side")P.setViewport(0,0,T,v),P.setScissor(0,0,T,v),P.render(l,X),l.overrideMaterial=te,P.setViewport(T,0,T,v),P.setScissor(T,0,T,v),P.render(l,re);else{const $=v-L;P.setViewport(0,$,p,L),P.setScissor(0,$,p,L),P.render(l,X),l.overrideMaterial=te,P.setViewport(0,0,p,L),P.setScissor(0,0,p,L),P.render(l,re)}},ae=()=>{const F=R(Qe),te=R(xt),$=R(an),ke=R(rn);let ce=0,ue=0;ue=v-L,ce=0,l.overrideMaterial=F,P.setViewport(ce,ue,T,L),P.setScissor(ce,ue,T,L),P.render(l,X),ce=T,l.overrideMaterial=te,P.setViewport(ce,ue,T,L),P.setScissor(ce,ue,T,L),P.render(l,re),ue=0,ce=0,l.overrideMaterial=$,P.setViewport(ce,ue,T,L),P.setScissor(ce,ue,T,L),P.render(l,De),ce=T,l.overrideMaterial=ke,P.setViewport(ce,ue,T,L),P.setScissor(ce,ue,T,L),P.render(l,Ae)},ye=()=>{switch(t.forEach(F=>{F.update()}),i.forEach(F=>{F.update()}),o.forEach(F=>{F.update!==void 0&&F.update()}),e.onSceneUpdate!==void 0&&It&&e.onSceneUpdate(Te),P.clear(),Y){case"Single":M();break;case"Side by Side":case"Stacked":W();break;case"Quad":ae();break}me=requestAnimationFrame(ye)};return $e(),window.addEventListener("resize",le),le(),ye(),()=>{window.removeEventListener("resize",le),cancelAnimationFrame(me),me=-1}},[Y,P]),b.useEffect(()=>{if(P!==null){const p=new h.Raycaster,v=new h.Vector2,T=(R,M,W,ae)=>{switch(Y){case"Quad":R<W?M<ae?p.setFromCamera(v,X):p.setFromCamera(v,De):M<ae?p.setFromCamera(v,re):p.setFromCamera(v,Ae);break;case"Side by Side":R<W?p.setFromCamera(v,X):p.setFromCamera(v,re);break;case"Single":p.setFromCamera(v,X);break;case"Stacked":M<ae?p.setFromCamera(v,X):p.setFromCamera(v,re);break}},L=R=>{if(Me==="Orbit")return;const M=new h.Vector2;P.getSize(M);const W=Math.min(R.clientX,M.x),ae=Math.min(R.clientY,M.y);v.x=Je(W,0,M.x,-1,1),v.y=Je(ae,0,M.y,1,-1);const ye=M.x/2,F=M.y/2,te=()=>{W<ye?v.x=Je(W,0,ye,-1,1):v.x=Je(W,ye,M.x,-1,1)},$=()=>{ae<F?v.y=Je(ae,0,F,1,-1):v.y=Je(ae,F,M.y,1,-1)};switch(Y){case"Quad":te(),$();break;case"Side by Side":te();break;case"Stacked":$(),$();break}T(W,ae,ye,F);const ke=p.intersectObjects(Te.children);ke.length>0&&m.position.copy(ke[0].point)},me=R=>{if(Me==="Orbit")return;const M=new h.Vector2;if(P.getSize(M),R.clientX>=M.x)return;L(R);const W=p.intersectObjects(Te.children);W.length>0&&(e.three.getObject(W[0].object.uuid),m.visible=!1,Ne("Orbit"),Le(Date.now()))},le=O.current;return le.addEventListener("mousemove",L,!1),le.addEventListener("click",me,!1),()=>{le.removeEventListener("mousemove",L),le.removeEventListener("click",me)}}},[Y,P,Me]);const fe=[];return a.forEach((p,v)=>{fe.push(v)}),u.jsxs("div",{className:"multiview",children:[u.jsx("canvas",{ref:H}),P!==null&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:`cameras ${Y==="Single"||Y==="Stacked"?"single":""}`,ref:O,children:[Y==="Single"&&u.jsx(u.Fragment,{children:u.jsx(He,{camera:X,options:fe,ref:V,onSelectCamera:p=>{t.get(X.name)?.dispose();const v=a.get(p);v!==void 0&&(Oe(X),X=v,w.setItem(`${n}_tlCam`,v.name),ee(v,V.current))},onSelectRenderMode:p=>{Qe=p,w.setItem(`${n}_tlRender`,p)}})}),(Y==="Side by Side"||Y==="Stacked")&&u.jsxs(u.Fragment,{children:[u.jsx(He,{camera:X,options:fe,ref:V,onSelectCamera:p=>{t.get(X.name)?.dispose();const v=a.get(p);v!==void 0&&(Oe(X),X=v,w.setItem(`${n}_tlCam`,v.name),ee(v,V.current))},onSelectRenderMode:p=>{Qe=p,w.setItem(`${n}_tlRender`,p)}}),u.jsx(He,{camera:re,options:fe,ref:k,onSelectCamera:p=>{t.get(re.name)?.dispose();const v=a.get(p);v!==void 0&&(Oe(re),re=v,w.setItem(`${n}_trCam`,v.name),ee(v,k.current))},onSelectRenderMode:p=>{xt=p,w.setItem(`${n}_trRender`,p)}})]}),Y==="Quad"&&u.jsxs(u.Fragment,{children:[u.jsx(He,{camera:X,options:fe,ref:V,onSelectCamera:p=>{t.get(X.name)?.dispose();const v=a.get(p);v!==void 0&&(Oe(X),X=v,w.setItem(`${n}_tlCam`,v.name),ee(v,V.current))},onSelectRenderMode:p=>{Qe=p,w.setItem(`${n}_tlRender`,p)}}),u.jsx(He,{camera:re,options:fe,ref:k,onSelectCamera:p=>{t.get(re.name)?.dispose();const v=a.get(p);v!==void 0&&(Oe(re),re=v,w.setItem(`${n}_trCam`,v.name),ee(v,k.current))},onSelectRenderMode:p=>{xt=p,w.setItem(`${n}_trRender`,p)}}),u.jsx(He,{camera:De,options:fe,ref:Z,onSelectCamera:p=>{t.get(De.name)?.dispose();const v=a.get(p);v!==void 0&&(Oe(De),De=v,w.setItem(`${n}_blCam`,v.name),ee(v,Z.current))},onSelectRenderMode:p=>{an=p,w.setItem(`${n}_blRender`,p)}}),u.jsx(He,{camera:Ae,options:fe,ref:se,onSelectCamera:p=>{t.get(Ae.name)?.dispose();const v=a.get(p);v!==void 0&&(Oe(Ae),Ae=v,w.setItem(`${n}_brCam`,v.name),ee(v,se.current))},onSelectRenderMode:p=>{rn=p,w.setItem(`${n}_brRender`,p)}})]})]}),u.jsxs("div",{className:"settings",children:[u.jsx(Mt,{index:z.indexOf(Y),options:z,onSelect:p=>{p!==Y&&(nt(),tt(p))},open:oe,onToggle:p=>{ve(p),we&&be(!1),Pe&&Ie(!1)}}),u.jsx(Mt,{index:Me==="Orbit"?0:1,options:["Orbit Mode","Selection Mode"],onSelect:p=>{m.visible=p==="Selection Mode",Ne(m.visible?"Selection":"Orbit")},open:Pe,onToggle:p=>{oe&&ve(!1),we&&be(!1),Ie(p)}})]},ze)]})]})}function wa(e){return u.jsxs("div",{className:"editor",ref:e.ref,style:e.style,children:[u.jsx("div",{className:"header",children:e.header}),e.children,u.jsx("div",{className:"footer",children:e.footer})]})}exports.Accordion=ft;exports.Application=Tn;exports.BaseRemote=mt;exports.ChildObject=$t;exports.ContainerObject=Ut;exports.Draggable=fn;exports.DraggableItem=hn;exports.Dropdown=mn;exports.DropdownItem=pn;exports.Editor=wa;exports.ExportTexture=ut;exports.Inspector=bn;exports.MultiView=Ca;exports.NavButton=zt;exports.RemoteComponents=_n;exports.RemoteController=zn;exports.RemoteTheatre=Rt;exports.RemoteThree=Nn;exports.RemoteTweakpane=Ln;exports.SceneInspector=ma;exports.SidePanel=fa;exports.ToolEvents=A;exports.capitalize=dt;exports.clamp=Ve;exports.colorToHex=ln;exports.debugDispatcher=D;exports.defaultTheatreCallback=Mn;exports.dispose=ht;exports.disposeMaterial=un;exports.disposeTexture=Rn;exports.distance=On;exports.hierarchyUUID=wt;exports.isColor=cn;exports.mix=Nt;exports.noop=Ot;exports.normalize=jt;exports.randomID=on;exports.resetThreeObjects=Ft;exports.round=Lt;exports.theatreEditorApp=kn;
