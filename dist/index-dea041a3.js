var hHe=Object.defineProperty;var dHe=(i,e,t)=>e in i?hHe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var qe=(i,e,t)=>(dHe(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();var lo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fHe(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var CEe={exports:{}},_U={},AEe={exports:{}},xi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jM=Symbol.for("react.element"),pHe=Symbol.for("react.portal"),mHe=Symbol.for("react.fragment"),gHe=Symbol.for("react.strict_mode"),yHe=Symbol.for("react.profiler"),vHe=Symbol.for("react.provider"),_He=Symbol.for("react.context"),xHe=Symbol.for("react.forward_ref"),bHe=Symbol.for("react.suspense"),SHe=Symbol.for("react.memo"),wHe=Symbol.for("react.lazy"),A_e=Symbol.iterator;function THe(i){return i===null||typeof i!="object"?null:(i=A_e&&i[A_e]||i["@@iterator"],typeof i=="function"?i:null)}var REe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},PEe=Object.assign,NEe={};function ux(i,e,t){this.props=i,this.context=e,this.refs=NEe,this.updater=t||REe}ux.prototype.isReactComponent={};ux.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,e,"setState")};ux.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function IEe(){}IEe.prototype=ux.prototype;function $te(i,e,t){this.props=i,this.context=e,this.refs=NEe,this.updater=t||REe}var Hte=$te.prototype=new IEe;Hte.constructor=$te;PEe(Hte,ux.prototype);Hte.isPureReactComponent=!0;var R_e=Array.isArray,kEe=Object.prototype.hasOwnProperty,jte={current:null},DEe={key:!0,ref:!0,__self:!0,__source:!0};function FEe(i,e,t){var n,r={},s=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)kEe.call(e,n)&&!DEe.hasOwnProperty(n)&&(r[n]=e[n]);var a=arguments.length-2;if(a===1)r.children=t;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];r.children=c}if(i&&i.defaultProps)for(n in a=i.defaultProps,a)r[n]===void 0&&(r[n]=a[n]);return{$$typeof:jM,type:i,key:s,ref:o,props:r,_owner:jte.current}}function EHe(i,e){return{$$typeof:jM,type:i.type,key:e,ref:i.ref,props:i.props,_owner:i._owner}}function Wte(i){return typeof i=="object"&&i!==null&&i.$$typeof===jM}function MHe(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(t){return e[t]})}var P_e=/\/+/g;function oK(i,e){return typeof i=="object"&&i!==null&&i.key!=null?MHe(""+i.key):e.toString(36)}function TB(i,e,t,n,r){var s=typeof i;(s==="undefined"||s==="boolean")&&(i=null);var o=!1;if(i===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(i.$$typeof){case jM:case pHe:o=!0}}if(o)return o=i,r=r(o),i=n===""?"."+oK(o,0):n,R_e(r)?(t="",i!=null&&(t=i.replace(P_e,"$&/")+"/"),TB(r,e,t,"",function(u){return u})):r!=null&&(Wte(r)&&(r=EHe(r,t+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(P_e,"$&/")+"/")+i)),e.push(r)),1;if(o=0,n=n===""?".":n+":",R_e(i))for(var a=0;a<i.length;a++){s=i[a];var c=n+oK(s,a);o+=TB(s,e,t,c,r)}else if(c=THe(i),typeof c=="function")for(i=c.call(i),a=0;!(s=i.next()).done;)s=s.value,c=n+oK(s,a++),o+=TB(s,e,t,c,r);else if(s==="object")throw e=String(i),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function bF(i,e,t){if(i==null)return i;var n=[],r=0;return TB(i,n,"","",function(s){return e.call(t,s,r++)}),n}function CHe(i){if(i._status===-1){var e=i._result;e=e(),e.then(function(t){(i._status===0||i._status===-1)&&(i._status=1,i._result=t)},function(t){(i._status===0||i._status===-1)&&(i._status=2,i._result=t)}),i._status===-1&&(i._status=0,i._result=e)}if(i._status===1)return i._result.default;throw i._result}var U0={current:null},EB={transition:null},AHe={ReactCurrentDispatcher:U0,ReactCurrentBatchConfig:EB,ReactCurrentOwner:jte};xi.Children={map:bF,forEach:function(i,e,t){bF(i,function(){e.apply(this,arguments)},t)},count:function(i){var e=0;return bF(i,function(){e++}),e},toArray:function(i){return bF(i,function(e){return e})||[]},only:function(i){if(!Wte(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};xi.Component=ux;xi.Fragment=mHe;xi.Profiler=yHe;xi.PureComponent=$te;xi.StrictMode=gHe;xi.Suspense=bHe;xi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=AHe;xi.cloneElement=function(i,e,t){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var n=PEe({},i.props),r=i.key,s=i.ref,o=i._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=jte.current),e.key!==void 0&&(r=""+e.key),i.type&&i.type.defaultProps)var a=i.type.defaultProps;for(c in e)kEe.call(e,c)&&!DEe.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=t;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];n.children=a}return{$$typeof:jM,type:i.type,key:r,ref:s,props:n,_owner:o}};xi.createContext=function(i){return i={$$typeof:_He,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:vHe,_context:i},i.Consumer=i};xi.createElement=FEe;xi.createFactory=function(i){var e=FEe.bind(null,i);return e.type=i,e};xi.createRef=function(){return{current:null}};xi.forwardRef=function(i){return{$$typeof:xHe,render:i}};xi.isValidElement=Wte;xi.lazy=function(i){return{$$typeof:wHe,_payload:{_status:-1,_result:i},_init:CHe}};xi.memo=function(i,e){return{$$typeof:SHe,type:i,compare:e===void 0?null:e}};xi.startTransition=function(i){var e=EB.transition;EB.transition={};try{i()}finally{EB.transition=e}};xi.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};xi.useCallback=function(i,e){return U0.current.useCallback(i,e)};xi.useContext=function(i){return U0.current.useContext(i)};xi.useDebugValue=function(){};xi.useDeferredValue=function(i){return U0.current.useDeferredValue(i)};xi.useEffect=function(i,e){return U0.current.useEffect(i,e)};xi.useId=function(){return U0.current.useId()};xi.useImperativeHandle=function(i,e,t){return U0.current.useImperativeHandle(i,e,t)};xi.useInsertionEffect=function(i,e){return U0.current.useInsertionEffect(i,e)};xi.useLayoutEffect=function(i,e){return U0.current.useLayoutEffect(i,e)};xi.useMemo=function(i,e){return U0.current.useMemo(i,e)};xi.useReducer=function(i,e,t){return U0.current.useReducer(i,e,t)};xi.useRef=function(i){return U0.current.useRef(i)};xi.useState=function(i){return U0.current.useState(i)};xi.useSyncExternalStore=function(i,e,t){return U0.current.useSyncExternalStore(i,e,t)};xi.useTransition=function(){return U0.current.useTransition()};xi.version="18.2.0";AEe.exports=xi;var _n=AEe.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RHe=_n,PHe=Symbol.for("react.element"),NHe=Symbol.for("react.fragment"),IHe=Object.prototype.hasOwnProperty,kHe=RHe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,DHe={key:!0,ref:!0,__self:!0,__source:!0};function OEe(i,e,t){var n,r={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)IHe.call(e,n)&&!DHe.hasOwnProperty(n)&&(r[n]=e[n]);if(i&&i.defaultProps)for(n in e=i.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:PHe,type:i,key:s,ref:o,props:r,_owner:kHe.current}}_U.Fragment=NHe;_U.jsx=OEe;_U.jsxs=OEe;CEe.exports=_U;var We=CEe.exports,NJ={},BEe={exports:{}},ru={},LEe={exports:{}},UEe={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(Ne,tt){var mt=Ne.length;Ne.push(tt);e:for(;0<mt;){var Ht=mt-1>>>1,pn=Ne[Ht];if(0<r(pn,tt))Ne[Ht]=tt,Ne[mt]=pn,mt=Ht;else break e}}function t(Ne){return Ne.length===0?null:Ne[0]}function n(Ne){if(Ne.length===0)return null;var tt=Ne[0],mt=Ne.pop();if(mt!==tt){Ne[0]=mt;e:for(var Ht=0,pn=Ne.length,In=pn>>>1;Ht<In;){var vt=2*(Ht+1)-1,Ut=Ne[vt],Sn=vt+1,ln=Ne[Sn];if(0>r(Ut,mt))Sn<pn&&0>r(ln,Ut)?(Ne[Ht]=ln,Ne[Sn]=mt,Ht=Sn):(Ne[Ht]=Ut,Ne[vt]=mt,Ht=vt);else if(Sn<pn&&0>r(ln,mt))Ne[Ht]=ln,Ne[Sn]=mt,Ht=Sn;else break e}}return tt}function r(Ne,tt){var mt=Ne.sortIndex-tt.sortIndex;return mt!==0?mt:Ne.id-tt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();i.unstable_now=function(){return o.now()-a}}var c=[],u=[],f=1,m=null,v=3,x=!1,T=!1,P=!1,R=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(Ne){for(var tt=t(u);tt!==null;){if(tt.callback===null)n(u);else if(tt.startTime<=Ne)n(u),tt.sortIndex=tt.expirationTime,e(c,tt);else break;tt=t(u)}}function L(Ne){if(P=!1,C(Ne),!T)if(t(c)!==null)T=!0,Xe(Y);else{var tt=t(u);tt!==null&&Fe(L,tt.startTime-Ne)}}function Y(Ne,tt){T=!1,P&&(P=!1,M(ne),ne=-1),x=!0;var mt=v;try{for(C(tt),m=t(c);m!==null&&(!(m.expirationTime>tt)||Ne&&!he());){var Ht=m.callback;if(typeof Ht=="function"){m.callback=null,v=m.priorityLevel;var pn=Ht(m.expirationTime<=tt);tt=i.unstable_now(),typeof pn=="function"?m.callback=pn:m===t(c)&&n(c),C(tt)}else n(c);m=t(c)}if(m!==null)var In=!0;else{var vt=t(u);vt!==null&&Fe(L,vt.startTime-tt),In=!1}return In}finally{m=null,v=mt,x=!1}}var J=!1,z=null,ne=-1,K=5,$=-1;function he(){return!(i.unstable_now()-$<K)}function Ce(){if(z!==null){var Ne=i.unstable_now();$=Ne;var tt=!0;try{tt=z(!0,Ne)}finally{tt?Pe():(J=!1,z=null)}}else J=!1}var Pe;if(typeof O=="function")Pe=function(){O(Ce)};else if(typeof MessageChannel<"u"){var je=new MessageChannel,ge=je.port2;je.port1.onmessage=Ce,Pe=function(){ge.postMessage(null)}}else Pe=function(){R(Ce,0)};function Xe(Ne){z=Ne,J||(J=!0,Pe())}function Fe(Ne,tt){ne=R(function(){Ne(i.unstable_now())},tt)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(Ne){Ne.callback=null},i.unstable_continueExecution=function(){T||x||(T=!0,Xe(Y))},i.unstable_forceFrameRate=function(Ne){0>Ne||125<Ne?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):K=0<Ne?Math.floor(1e3/Ne):5},i.unstable_getCurrentPriorityLevel=function(){return v},i.unstable_getFirstCallbackNode=function(){return t(c)},i.unstable_next=function(Ne){switch(v){case 1:case 2:case 3:var tt=3;break;default:tt=v}var mt=v;v=tt;try{return Ne()}finally{v=mt}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(Ne,tt){switch(Ne){case 1:case 2:case 3:case 4:case 5:break;default:Ne=3}var mt=v;v=Ne;try{return tt()}finally{v=mt}},i.unstable_scheduleCallback=function(Ne,tt,mt){var Ht=i.unstable_now();switch(typeof mt=="object"&&mt!==null?(mt=mt.delay,mt=typeof mt=="number"&&0<mt?Ht+mt:Ht):mt=Ht,Ne){case 1:var pn=-1;break;case 2:pn=250;break;case 5:pn=1073741823;break;case 4:pn=1e4;break;default:pn=5e3}return pn=mt+pn,Ne={id:f++,callback:tt,priorityLevel:Ne,startTime:mt,expirationTime:pn,sortIndex:-1},mt>Ht?(Ne.sortIndex=mt,e(u,Ne),t(c)===null&&Ne===t(u)&&(P?(M(ne),ne=-1):P=!0,Fe(L,mt-Ht))):(Ne.sortIndex=pn,e(c,Ne),T||x||(T=!0,Xe(Y))),Ne},i.unstable_shouldYield=he,i.unstable_wrapCallback=function(Ne){var tt=v;return function(){var mt=v;v=tt;try{return Ne.apply(this,arguments)}finally{v=mt}}}})(UEe);LEe.exports=UEe;var FHe=LEe.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zEe=_n,eu=FHe;function gn(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var VEe=new Set,WE={};function C4(i,e){__(i,e),__(i+"Capture",e)}function __(i,e){for(WE[i]=e,i=0;i<e.length;i++)VEe.add(e[i])}var V1=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),IJ=Object.prototype.hasOwnProperty,OHe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,N_e={},I_e={};function BHe(i){return IJ.call(I_e,i)?!0:IJ.call(N_e,i)?!1:OHe.test(i)?I_e[i]=!0:(N_e[i]=!0,!1)}function LHe(i,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function UHe(i,e,t,n){if(e===null||typeof e>"u"||LHe(i,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function z0(i,e,t,n,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=i,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var xl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){xl[i]=new z0(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var e=i[0];xl[e]=new z0(e,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){xl[i]=new z0(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){xl[i]=new z0(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){xl[i]=new z0(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){xl[i]=new z0(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){xl[i]=new z0(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){xl[i]=new z0(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){xl[i]=new z0(i,5,!1,i.toLowerCase(),null,!1,!1)});var qte=/[\-:]([a-z])/g;function Xte(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var e=i.replace(qte,Xte);xl[e]=new z0(e,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var e=i.replace(qte,Xte);xl[e]=new z0(e,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var e=i.replace(qte,Xte);xl[e]=new z0(e,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){xl[i]=new z0(i,1,!1,i.toLowerCase(),null,!1,!1)});xl.xlinkHref=new z0("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){xl[i]=new z0(i,1,!1,i.toLowerCase(),null,!0,!0)});function Yte(i,e,t,n){var r=xl.hasOwnProperty(e)?xl[e]:null;(r!==null?r.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(UHe(e,t,r,n)&&(t=null),n||r===null?BHe(e)&&(t===null?i.removeAttribute(e):i.setAttribute(e,""+t)):r.mustUseProperty?i[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,n=r.attributeNamespace,t===null?i.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,n?i.setAttributeNS(n,e,t):i.setAttribute(e,t))))}var tm=zEe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,SF=Symbol.for("react.element"),b6=Symbol.for("react.portal"),S6=Symbol.for("react.fragment"),Kte=Symbol.for("react.strict_mode"),kJ=Symbol.for("react.profiler"),GEe=Symbol.for("react.provider"),$Ee=Symbol.for("react.context"),Zte=Symbol.for("react.forward_ref"),DJ=Symbol.for("react.suspense"),FJ=Symbol.for("react.suspense_list"),Qte=Symbol.for("react.memo"),u2=Symbol.for("react.lazy"),HEe=Symbol.for("react.offscreen"),k_e=Symbol.iterator;function Kw(i){return i===null||typeof i!="object"?null:(i=k_e&&i[k_e]||i["@@iterator"],typeof i=="function"?i:null)}var yo=Object.assign,aK;function QT(i){if(aK===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);aK=e&&e[1]||""}return`
`+aK+i}var lK=!1;function cK(i,e){if(!i||lK)return"";lK=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var n=u}Reflect.construct(i,[],e)}else{try{e.call()}catch(u){n=u}i.call(e.prototype)}else{try{throw Error()}catch(u){n=u}i()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),s=n.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var c=`
`+r[o].replace(" at new "," at ");return i.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",i.displayName)),c}while(1<=o&&0<=a);break}}}finally{lK=!1,Error.prepareStackTrace=t}return(i=i?i.displayName||i.name:"")?QT(i):""}function zHe(i){switch(i.tag){case 5:return QT(i.type);case 16:return QT("Lazy");case 13:return QT("Suspense");case 19:return QT("SuspenseList");case 0:case 2:case 15:return i=cK(i.type,!1),i;case 11:return i=cK(i.type.render,!1),i;case 1:return i=cK(i.type,!0),i;default:return""}}function OJ(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case S6:return"Fragment";case b6:return"Portal";case kJ:return"Profiler";case Kte:return"StrictMode";case DJ:return"Suspense";case FJ:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case $Ee:return(i.displayName||"Context")+".Consumer";case GEe:return(i._context.displayName||"Context")+".Provider";case Zte:var e=i.render;return i=i.displayName,i||(i=e.displayName||e.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Qte:return e=i.displayName||null,e!==null?e:OJ(i.type)||"Memo";case u2:e=i._payload,i=i._init;try{return OJ(i(e))}catch{}}return null}function VHe(i){var e=i.type;switch(i.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=e.render,i=i.displayName||i.name||"",e.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return OJ(e);case 8:return e===Kte?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function L2(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function jEe(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function GHe(i){var e=jEe(i)?"checked":"value",t=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),n=""+i[e];if(!i.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){n=""+o,s.call(this,o)}}),Object.defineProperty(i,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function wF(i){i._valueTracker||(i._valueTracker=GHe(i))}function WEe(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return i&&(n=jEe(i)?i.checked?"true":"false":i.value),i=n,i!==t?(e.setValue(i),!0):!1}function sL(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function BJ(i,e){var t=e.checked;return yo({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??i._wrapperState.initialChecked})}function D_e(i,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=L2(e.value!=null?e.value:t),i._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function qEe(i,e){e=e.checked,e!=null&&Yte(i,"checked",e,!1)}function LJ(i,e){qEe(i,e);var t=L2(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&i.value===""||i.value!=t)&&(i.value=""+t):i.value!==""+t&&(i.value=""+t);else if(n==="submit"||n==="reset"){i.removeAttribute("value");return}e.hasOwnProperty("value")?UJ(i,e.type,t):e.hasOwnProperty("defaultValue")&&UJ(i,e.type,L2(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(i.defaultChecked=!!e.defaultChecked)}function F_e(i,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+i._wrapperState.initialValue,t||e===i.value||(i.value=e),i.defaultValue=e}t=i.name,t!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,t!==""&&(i.name=t)}function UJ(i,e,t){(e!=="number"||sL(i.ownerDocument)!==i)&&(t==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+t&&(i.defaultValue=""+t))}var JT=Array.isArray;function K6(i,e,t,n){if(i=i.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<i.length;t++)r=e.hasOwnProperty("$"+i[t].value),i[t].selected!==r&&(i[t].selected=r),r&&n&&(i[t].defaultSelected=!0)}else{for(t=""+L2(t),e=null,r=0;r<i.length;r++){if(i[r].value===t){i[r].selected=!0,n&&(i[r].defaultSelected=!0);return}e!==null||i[r].disabled||(e=i[r])}e!==null&&(e.selected=!0)}}function zJ(i,e){if(e.dangerouslySetInnerHTML!=null)throw Error(gn(91));return yo({},e,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function O_e(i,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(gn(92));if(JT(t)){if(1<t.length)throw Error(gn(93));t=t[0]}e=t}e==null&&(e=""),t=e}i._wrapperState={initialValue:L2(t)}}function XEe(i,e){var t=L2(e.value),n=L2(e.defaultValue);t!=null&&(t=""+t,t!==i.value&&(i.value=t),e.defaultValue==null&&i.defaultValue!==t&&(i.defaultValue=t)),n!=null&&(i.defaultValue=""+n)}function B_e(i){var e=i.textContent;e===i._wrapperState.initialValue&&e!==""&&e!==null&&(i.value=e)}function YEe(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function VJ(i,e){return i==null||i==="http://www.w3.org/1999/xhtml"?YEe(e):i==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var TF,KEe=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return i(e,t,n,r)})}:i}(function(i,e){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=e;else{for(TF=TF||document.createElement("div"),TF.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=TF.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;e.firstChild;)i.appendChild(e.firstChild)}});function qE(i,e){if(e){var t=i.firstChild;if(t&&t===i.lastChild&&t.nodeType===3){t.nodeValue=e;return}}i.textContent=e}var bE={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$He=["Webkit","ms","Moz","O"];Object.keys(bE).forEach(function(i){$He.forEach(function(e){e=e+i.charAt(0).toUpperCase()+i.substring(1),bE[e]=bE[i]})});function ZEe(i,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||bE.hasOwnProperty(i)&&bE[i]?(""+e).trim():e+"px"}function QEe(i,e){i=i.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,r=ZEe(t,e[t],n);t==="float"&&(t="cssFloat"),n?i.setProperty(t,r):i[t]=r}}var HHe=yo({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function GJ(i,e){if(e){if(HHe[i]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(gn(137,i));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(gn(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(gn(61))}if(e.style!=null&&typeof e.style!="object")throw Error(gn(62))}}function $J(i,e){if(i.indexOf("-")===-1)return typeof e.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var HJ=null;function Jte(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var jJ=null,Z6=null,Q6=null;function L_e(i){if(i=XM(i)){if(typeof jJ!="function")throw Error(gn(280));var e=i.stateNode;e&&(e=TU(e),jJ(i.stateNode,i.type,e))}}function JEe(i){Z6?Q6?Q6.push(i):Q6=[i]:Z6=i}function eMe(){if(Z6){var i=Z6,e=Q6;if(Q6=Z6=null,L_e(i),e)for(i=0;i<e.length;i++)L_e(e[i])}}function tMe(i,e){return i(e)}function nMe(){}var uK=!1;function rMe(i,e,t){if(uK)return i(e,t);uK=!0;try{return tMe(i,e,t)}finally{uK=!1,(Z6!==null||Q6!==null)&&(nMe(),eMe())}}function XE(i,e){var t=i.stateNode;if(t===null)return null;var n=TU(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(i=i.type,n=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!n;break e;default:i=!1}if(i)return null;if(t&&typeof t!="function")throw Error(gn(231,e,typeof t));return t}var WJ=!1;if(V1)try{var Zw={};Object.defineProperty(Zw,"passive",{get:function(){WJ=!0}}),window.addEventListener("test",Zw,Zw),window.removeEventListener("test",Zw,Zw)}catch{WJ=!1}function jHe(i,e,t,n,r,s,o,a,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(f){this.onError(f)}}var SE=!1,oL=null,aL=!1,qJ=null,WHe={onError:function(i){SE=!0,oL=i}};function qHe(i,e,t,n,r,s,o,a,c){SE=!1,oL=null,jHe.apply(WHe,arguments)}function XHe(i,e,t,n,r,s,o,a,c){if(qHe.apply(this,arguments),SE){if(SE){var u=oL;SE=!1,oL=null}else throw Error(gn(198));aL||(aL=!0,qJ=u)}}function A4(i){var e=i,t=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,e.flags&4098&&(t=e.return),i=e.return;while(i)}return e.tag===3?t:null}function iMe(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function U_e(i){if(A4(i)!==i)throw Error(gn(188))}function YHe(i){var e=i.alternate;if(!e){if(e=A4(i),e===null)throw Error(gn(188));return e!==i?null:i}for(var t=i,n=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(n=r.return,n!==null){t=n;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return U_e(r),i;if(s===n)return U_e(r),e;s=s.sibling}throw Error(gn(188))}if(t.return!==n.return)t=r,n=s;else{for(var o=!1,a=r.child;a;){if(a===t){o=!0,t=r,n=s;break}if(a===n){o=!0,n=r,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,n=r;break}if(a===n){o=!0,n=s,t=r;break}a=a.sibling}if(!o)throw Error(gn(189))}}if(t.alternate!==n)throw Error(gn(190))}if(t.tag!==3)throw Error(gn(188));return t.stateNode.current===t?i:e}function sMe(i){return i=YHe(i),i!==null?oMe(i):null}function oMe(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var e=oMe(i);if(e!==null)return e;i=i.sibling}return null}var aMe=eu.unstable_scheduleCallback,z_e=eu.unstable_cancelCallback,KHe=eu.unstable_shouldYield,ZHe=eu.unstable_requestPaint,zo=eu.unstable_now,QHe=eu.unstable_getCurrentPriorityLevel,ene=eu.unstable_ImmediatePriority,lMe=eu.unstable_UserBlockingPriority,lL=eu.unstable_NormalPriority,JHe=eu.unstable_LowPriority,cMe=eu.unstable_IdlePriority,xU=null,Gf=null;function eje(i){if(Gf&&typeof Gf.onCommitFiberRoot=="function")try{Gf.onCommitFiberRoot(xU,i,void 0,(i.current.flags&128)===128)}catch{}}var xd=Math.clz32?Math.clz32:rje,tje=Math.log,nje=Math.LN2;function rje(i){return i>>>=0,i===0?32:31-(tje(i)/nje|0)|0}var EF=64,MF=4194304;function eE(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function cL(i,e){var t=i.pendingLanes;if(t===0)return 0;var n=0,r=i.suspendedLanes,s=i.pingedLanes,o=t&268435455;if(o!==0){var a=o&~r;a!==0?n=eE(a):(s&=o,s!==0&&(n=eE(s)))}else o=t&~r,o!==0?n=eE(o):s!==0&&(n=eE(s));if(n===0)return 0;if(e!==0&&e!==n&&!(e&r)&&(r=n&-n,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(n&4&&(n|=t&16),e=i.entangledLanes,e!==0)for(i=i.entanglements,e&=n;0<e;)t=31-xd(e),r=1<<t,n|=i[t],e&=~r;return n}function ije(i,e){switch(i){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sje(i,e){for(var t=i.suspendedLanes,n=i.pingedLanes,r=i.expirationTimes,s=i.pendingLanes;0<s;){var o=31-xd(s),a=1<<o,c=r[o];c===-1?(!(a&t)||a&n)&&(r[o]=ije(a,e)):c<=e&&(i.expiredLanes|=a),s&=~a}}function XJ(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function uMe(){var i=EF;return EF<<=1,!(EF&4194240)&&(EF=64),i}function hK(i){for(var e=[],t=0;31>t;t++)e.push(i);return e}function WM(i,e,t){i.pendingLanes|=e,e!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,e=31-xd(e),i[e]=t}function oje(i,e){var t=i.pendingLanes&~e;i.pendingLanes=e,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=e,i.mutableReadLanes&=e,i.entangledLanes&=e,e=i.entanglements;var n=i.eventTimes;for(i=i.expirationTimes;0<t;){var r=31-xd(t),s=1<<r;e[r]=0,n[r]=-1,i[r]=-1,t&=~s}}function tne(i,e){var t=i.entangledLanes|=e;for(i=i.entanglements;t;){var n=31-xd(t),r=1<<n;r&e|i[n]&e&&(i[n]|=e),t&=~r}}var as=0;function hMe(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var dMe,nne,fMe,pMe,mMe,YJ=!1,CF=[],M2=null,C2=null,A2=null,YE=new Map,KE=new Map,g2=[],aje="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function V_e(i,e){switch(i){case"focusin":case"focusout":M2=null;break;case"dragenter":case"dragleave":C2=null;break;case"mouseover":case"mouseout":A2=null;break;case"pointerover":case"pointerout":YE.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":KE.delete(e.pointerId)}}function Qw(i,e,t,n,r,s){return i===null||i.nativeEvent!==s?(i={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:s,targetContainers:[r]},e!==null&&(e=XM(e),e!==null&&nne(e)),i):(i.eventSystemFlags|=n,e=i.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),i)}function lje(i,e,t,n,r){switch(e){case"focusin":return M2=Qw(M2,i,e,t,n,r),!0;case"dragenter":return C2=Qw(C2,i,e,t,n,r),!0;case"mouseover":return A2=Qw(A2,i,e,t,n,r),!0;case"pointerover":var s=r.pointerId;return YE.set(s,Qw(YE.get(s)||null,i,e,t,n,r)),!0;case"gotpointercapture":return s=r.pointerId,KE.set(s,Qw(KE.get(s)||null,i,e,t,n,r)),!0}return!1}function gMe(i){var e=$y(i.target);if(e!==null){var t=A4(e);if(t!==null){if(e=t.tag,e===13){if(e=iMe(t),e!==null){i.blockedOn=e,mMe(i.priority,function(){fMe(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){i.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}i.blockedOn=null}function MB(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var t=KJ(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(t===null){t=i.nativeEvent;var n=new t.constructor(t.type,t);HJ=n,t.target.dispatchEvent(n),HJ=null}else return e=XM(t),e!==null&&nne(e),i.blockedOn=t,!1;e.shift()}return!0}function G_e(i,e,t){MB(i)&&t.delete(e)}function cje(){YJ=!1,M2!==null&&MB(M2)&&(M2=null),C2!==null&&MB(C2)&&(C2=null),A2!==null&&MB(A2)&&(A2=null),YE.forEach(G_e),KE.forEach(G_e)}function Jw(i,e){i.blockedOn===e&&(i.blockedOn=null,YJ||(YJ=!0,eu.unstable_scheduleCallback(eu.unstable_NormalPriority,cje)))}function ZE(i){function e(r){return Jw(r,i)}if(0<CF.length){Jw(CF[0],i);for(var t=1;t<CF.length;t++){var n=CF[t];n.blockedOn===i&&(n.blockedOn=null)}}for(M2!==null&&Jw(M2,i),C2!==null&&Jw(C2,i),A2!==null&&Jw(A2,i),YE.forEach(e),KE.forEach(e),t=0;t<g2.length;t++)n=g2[t],n.blockedOn===i&&(n.blockedOn=null);for(;0<g2.length&&(t=g2[0],t.blockedOn===null);)gMe(t),t.blockedOn===null&&g2.shift()}var J6=tm.ReactCurrentBatchConfig,uL=!0;function uje(i,e,t,n){var r=as,s=J6.transition;J6.transition=null;try{as=1,rne(i,e,t,n)}finally{as=r,J6.transition=s}}function hje(i,e,t,n){var r=as,s=J6.transition;J6.transition=null;try{as=4,rne(i,e,t,n)}finally{as=r,J6.transition=s}}function rne(i,e,t,n){if(uL){var r=KJ(i,e,t,n);if(r===null)bK(i,e,n,hL,t),V_e(i,n);else if(lje(r,i,e,t,n))n.stopPropagation();else if(V_e(i,n),e&4&&-1<aje.indexOf(i)){for(;r!==null;){var s=XM(r);if(s!==null&&dMe(s),s=KJ(i,e,t,n),s===null&&bK(i,e,n,hL,t),s===r)break;r=s}r!==null&&n.stopPropagation()}else bK(i,e,n,null,t)}}var hL=null;function KJ(i,e,t,n){if(hL=null,i=Jte(n),i=$y(i),i!==null)if(e=A4(i),e===null)i=null;else if(t=e.tag,t===13){if(i=iMe(e),i!==null)return i;i=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;i=null}else e!==i&&(i=null);return hL=i,null}function yMe(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(QHe()){case ene:return 1;case lMe:return 4;case lL:case JHe:return 16;case cMe:return 536870912;default:return 16}default:return 16}}var w2=null,ine=null,CB=null;function vMe(){if(CB)return CB;var i,e=ine,t=e.length,n,r="value"in w2?w2.value:w2.textContent,s=r.length;for(i=0;i<t&&e[i]===r[i];i++);var o=t-i;for(n=1;n<=o&&e[t-n]===r[s-n];n++);return CB=r.slice(i,1<n?1-n:void 0)}function AB(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function AF(){return!0}function $_e(){return!1}function iu(i){function e(t,n,r,s,o){this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in i)i.hasOwnProperty(a)&&(t=i[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?AF:$_e,this.isPropagationStopped=$_e,this}return yo(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=AF)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=AF)},persist:function(){},isPersistent:AF}),e}var hx={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},sne=iu(hx),qM=yo({},hx,{view:0,detail:0}),dje=iu(qM),dK,fK,eT,bU=yo({},qM,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:one,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==eT&&(eT&&i.type==="mousemove"?(dK=i.screenX-eT.screenX,fK=i.screenY-eT.screenY):fK=dK=0,eT=i),dK)},movementY:function(i){return"movementY"in i?i.movementY:fK}}),H_e=iu(bU),fje=yo({},bU,{dataTransfer:0}),pje=iu(fje),mje=yo({},qM,{relatedTarget:0}),pK=iu(mje),gje=yo({},hx,{animationName:0,elapsedTime:0,pseudoElement:0}),yje=iu(gje),vje=yo({},hx,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),_je=iu(vje),xje=yo({},hx,{data:0}),j_e=iu(xje),bje={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sje={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wje={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tje(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=wje[i])?!!e[i]:!1}function one(){return Tje}var Eje=yo({},qM,{key:function(i){if(i.key){var e=bje[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=AB(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Sje[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:one,charCode:function(i){return i.type==="keypress"?AB(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?AB(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Mje=iu(Eje),Cje=yo({},bU,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),W_e=iu(Cje),Aje=yo({},qM,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:one}),Rje=iu(Aje),Pje=yo({},hx,{propertyName:0,elapsedTime:0,pseudoElement:0}),Nje=iu(Pje),Ije=yo({},bU,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),kje=iu(Ije),Dje=[9,13,27,32],ane=V1&&"CompositionEvent"in window,wE=null;V1&&"documentMode"in document&&(wE=document.documentMode);var Fje=V1&&"TextEvent"in window&&!wE,_Me=V1&&(!ane||wE&&8<wE&&11>=wE),q_e=String.fromCharCode(32),X_e=!1;function xMe(i,e){switch(i){case"keyup":return Dje.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function bMe(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var w6=!1;function Oje(i,e){switch(i){case"compositionend":return bMe(e);case"keypress":return e.which!==32?null:(X_e=!0,q_e);case"textInput":return i=e.data,i===q_e&&X_e?null:i;default:return null}}function Bje(i,e){if(w6)return i==="compositionend"||!ane&&xMe(i,e)?(i=vMe(),CB=ine=w2=null,w6=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return _Me&&e.locale!=="ko"?null:e.data;default:return null}}var Lje={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Y_e(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!Lje[i.type]:e==="textarea"}function SMe(i,e,t,n){JEe(n),e=dL(e,"onChange"),0<e.length&&(t=new sne("onChange","change",null,t,n),i.push({event:t,listeners:e}))}var TE=null,QE=null;function Uje(i){kMe(i,0)}function SU(i){var e=M6(i);if(WEe(e))return i}function zje(i,e){if(i==="change")return e}var wMe=!1;if(V1){var mK;if(V1){var gK="oninput"in document;if(!gK){var K_e=document.createElement("div");K_e.setAttribute("oninput","return;"),gK=typeof K_e.oninput=="function"}mK=gK}else mK=!1;wMe=mK&&(!document.documentMode||9<document.documentMode)}function Z_e(){TE&&(TE.detachEvent("onpropertychange",TMe),QE=TE=null)}function TMe(i){if(i.propertyName==="value"&&SU(QE)){var e=[];SMe(e,QE,i,Jte(i)),rMe(Uje,e)}}function Vje(i,e,t){i==="focusin"?(Z_e(),TE=e,QE=t,TE.attachEvent("onpropertychange",TMe)):i==="focusout"&&Z_e()}function Gje(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return SU(QE)}function $je(i,e){if(i==="click")return SU(e)}function Hje(i,e){if(i==="input"||i==="change")return SU(e)}function jje(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var wd=typeof Object.is=="function"?Object.is:jje;function JE(i,e){if(wd(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var t=Object.keys(i),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var r=t[n];if(!IJ.call(e,r)||!wd(i[r],e[r]))return!1}return!0}function Q_e(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function J_e(i,e){var t=Q_e(i);i=0;for(var n;t;){if(t.nodeType===3){if(n=i+t.textContent.length,i<=e&&n>=e)return{node:t,offset:e-i};i=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Q_e(t)}}function EMe(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?EMe(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function MMe(){for(var i=window,e=sL();e instanceof i.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)i=e.contentWindow;else break;e=sL(i.document)}return e}function lne(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}function Wje(i){var e=MMe(),t=i.focusedElem,n=i.selectionRange;if(e!==t&&t&&t.ownerDocument&&EMe(t.ownerDocument.documentElement,t)){if(n!==null&&lne(t)){if(e=n.start,i=n.end,i===void 0&&(i=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(i,t.value.length);else if(i=(e=t.ownerDocument||document)&&e.defaultView||window,i.getSelection){i=i.getSelection();var r=t.textContent.length,s=Math.min(n.start,r);n=n.end===void 0?s:Math.min(n.end,r),!i.extend&&s>n&&(r=n,n=s,s=r),r=J_e(t,s);var o=J_e(t,n);r&&o&&(i.rangeCount!==1||i.anchorNode!==r.node||i.anchorOffset!==r.offset||i.focusNode!==o.node||i.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),i.removeAllRanges(),s>n?(i.addRange(e),i.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),i.addRange(e)))}}for(e=[],i=t;i=i.parentNode;)i.nodeType===1&&e.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)i=e[t],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var qje=V1&&"documentMode"in document&&11>=document.documentMode,T6=null,ZJ=null,EE=null,QJ=!1;function exe(i,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;QJ||T6==null||T6!==sL(n)||(n=T6,"selectionStart"in n&&lne(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),EE&&JE(EE,n)||(EE=n,n=dL(ZJ,"onSelect"),0<n.length&&(e=new sne("onSelect","select",null,e,t),i.push({event:e,listeners:n}),e.target=T6)))}function RF(i,e){var t={};return t[i.toLowerCase()]=e.toLowerCase(),t["Webkit"+i]="webkit"+e,t["Moz"+i]="moz"+e,t}var E6={animationend:RF("Animation","AnimationEnd"),animationiteration:RF("Animation","AnimationIteration"),animationstart:RF("Animation","AnimationStart"),transitionend:RF("Transition","TransitionEnd")},yK={},CMe={};V1&&(CMe=document.createElement("div").style,"AnimationEvent"in window||(delete E6.animationend.animation,delete E6.animationiteration.animation,delete E6.animationstart.animation),"TransitionEvent"in window||delete E6.transitionend.transition);function wU(i){if(yK[i])return yK[i];if(!E6[i])return i;var e=E6[i],t;for(t in e)if(e.hasOwnProperty(t)&&t in CMe)return yK[i]=e[t];return i}var AMe=wU("animationend"),RMe=wU("animationiteration"),PMe=wU("animationstart"),NMe=wU("transitionend"),IMe=new Map,txe="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Q2(i,e){IMe.set(i,e),C4(e,[i])}for(var vK=0;vK<txe.length;vK++){var _K=txe[vK],Xje=_K.toLowerCase(),Yje=_K[0].toUpperCase()+_K.slice(1);Q2(Xje,"on"+Yje)}Q2(AMe,"onAnimationEnd");Q2(RMe,"onAnimationIteration");Q2(PMe,"onAnimationStart");Q2("dblclick","onDoubleClick");Q2("focusin","onFocus");Q2("focusout","onBlur");Q2(NMe,"onTransitionEnd");__("onMouseEnter",["mouseout","mouseover"]);__("onMouseLeave",["mouseout","mouseover"]);__("onPointerEnter",["pointerout","pointerover"]);__("onPointerLeave",["pointerout","pointerover"]);C4("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));C4("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));C4("onBeforeInput",["compositionend","keypress","textInput","paste"]);C4("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));C4("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));C4("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var tE="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Kje=new Set("cancel close invalid load scroll toggle".split(" ").concat(tE));function nxe(i,e,t){var n=i.type||"unknown-event";i.currentTarget=t,XHe(n,e,void 0,i),i.currentTarget=null}function kMe(i,e){e=(e&4)!==0;for(var t=0;t<i.length;t++){var n=i[t],r=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],c=a.instance,u=a.currentTarget;if(a=a.listener,c!==s&&r.isPropagationStopped())break e;nxe(r,a,u),s=c}else for(o=0;o<n.length;o++){if(a=n[o],c=a.instance,u=a.currentTarget,a=a.listener,c!==s&&r.isPropagationStopped())break e;nxe(r,a,u),s=c}}}if(aL)throw i=qJ,aL=!1,qJ=null,i}function Ls(i,e){var t=e[ree];t===void 0&&(t=e[ree]=new Set);var n=i+"__bubble";t.has(n)||(DMe(e,i,2,!1),t.add(n))}function xK(i,e,t){var n=0;e&&(n|=4),DMe(t,i,n,e)}var PF="_reactListening"+Math.random().toString(36).slice(2);function eM(i){if(!i[PF]){i[PF]=!0,VEe.forEach(function(t){t!=="selectionchange"&&(Kje.has(t)||xK(t,!1,i),xK(t,!0,i))});var e=i.nodeType===9?i:i.ownerDocument;e===null||e[PF]||(e[PF]=!0,xK("selectionchange",!1,e))}}function DMe(i,e,t,n){switch(yMe(e)){case 1:var r=uje;break;case 4:r=hje;break;default:r=rne}t=r.bind(null,e,t,i),r=void 0,!WJ||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),n?r!==void 0?i.addEventListener(e,t,{capture:!0,passive:r}):i.addEventListener(e,t,!0):r!==void 0?i.addEventListener(e,t,{passive:r}):i.addEventListener(e,t,!1)}function bK(i,e,t,n,r){var s=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=n.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;a!==null;){if(o=$y(a),o===null)return;if(c=o.tag,c===5||c===6){n=s=o;continue e}a=a.parentNode}}n=n.return}rMe(function(){var u=s,f=Jte(t),m=[];e:{var v=IMe.get(i);if(v!==void 0){var x=sne,T=i;switch(i){case"keypress":if(AB(t)===0)break e;case"keydown":case"keyup":x=Mje;break;case"focusin":T="focus",x=pK;break;case"focusout":T="blur",x=pK;break;case"beforeblur":case"afterblur":x=pK;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=H_e;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=pje;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=Rje;break;case AMe:case RMe:case PMe:x=yje;break;case NMe:x=Nje;break;case"scroll":x=dje;break;case"wheel":x=kje;break;case"copy":case"cut":case"paste":x=_je;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=W_e}var P=(e&4)!==0,R=!P&&i==="scroll",M=P?v!==null?v+"Capture":null:v;P=[];for(var O=u,C;O!==null;){C=O;var L=C.stateNode;if(C.tag===5&&L!==null&&(C=L,M!==null&&(L=XE(O,M),L!=null&&P.push(tM(O,L,C)))),R)break;O=O.return}0<P.length&&(v=new x(v,T,null,t,f),m.push({event:v,listeners:P}))}}if(!(e&7)){e:{if(v=i==="mouseover"||i==="pointerover",x=i==="mouseout"||i==="pointerout",v&&t!==HJ&&(T=t.relatedTarget||t.fromElement)&&($y(T)||T[G1]))break e;if((x||v)&&(v=f.window===f?f:(v=f.ownerDocument)?v.defaultView||v.parentWindow:window,x?(T=t.relatedTarget||t.toElement,x=u,T=T?$y(T):null,T!==null&&(R=A4(T),T!==R||T.tag!==5&&T.tag!==6)&&(T=null)):(x=null,T=u),x!==T)){if(P=H_e,L="onMouseLeave",M="onMouseEnter",O="mouse",(i==="pointerout"||i==="pointerover")&&(P=W_e,L="onPointerLeave",M="onPointerEnter",O="pointer"),R=x==null?v:M6(x),C=T==null?v:M6(T),v=new P(L,O+"leave",x,t,f),v.target=R,v.relatedTarget=C,L=null,$y(f)===u&&(P=new P(M,O+"enter",T,t,f),P.target=C,P.relatedTarget=R,L=P),R=L,x&&T)t:{for(P=x,M=T,O=0,C=P;C;C=P8(C))O++;for(C=0,L=M;L;L=P8(L))C++;for(;0<O-C;)P=P8(P),O--;for(;0<C-O;)M=P8(M),C--;for(;O--;){if(P===M||M!==null&&P===M.alternate)break t;P=P8(P),M=P8(M)}P=null}else P=null;x!==null&&rxe(m,v,x,P,!1),T!==null&&R!==null&&rxe(m,R,T,P,!0)}}e:{if(v=u?M6(u):window,x=v.nodeName&&v.nodeName.toLowerCase(),x==="select"||x==="input"&&v.type==="file")var Y=zje;else if(Y_e(v))if(wMe)Y=Hje;else{Y=Gje;var J=Vje}else(x=v.nodeName)&&x.toLowerCase()==="input"&&(v.type==="checkbox"||v.type==="radio")&&(Y=$je);if(Y&&(Y=Y(i,u))){SMe(m,Y,t,f);break e}J&&J(i,v,u),i==="focusout"&&(J=v._wrapperState)&&J.controlled&&v.type==="number"&&UJ(v,"number",v.value)}switch(J=u?M6(u):window,i){case"focusin":(Y_e(J)||J.contentEditable==="true")&&(T6=J,ZJ=u,EE=null);break;case"focusout":EE=ZJ=T6=null;break;case"mousedown":QJ=!0;break;case"contextmenu":case"mouseup":case"dragend":QJ=!1,exe(m,t,f);break;case"selectionchange":if(qje)break;case"keydown":case"keyup":exe(m,t,f)}var z;if(ane)e:{switch(i){case"compositionstart":var ne="onCompositionStart";break e;case"compositionend":ne="onCompositionEnd";break e;case"compositionupdate":ne="onCompositionUpdate";break e}ne=void 0}else w6?xMe(i,t)&&(ne="onCompositionEnd"):i==="keydown"&&t.keyCode===229&&(ne="onCompositionStart");ne&&(_Me&&t.locale!=="ko"&&(w6||ne!=="onCompositionStart"?ne==="onCompositionEnd"&&w6&&(z=vMe()):(w2=f,ine="value"in w2?w2.value:w2.textContent,w6=!0)),J=dL(u,ne),0<J.length&&(ne=new j_e(ne,i,null,t,f),m.push({event:ne,listeners:J}),z?ne.data=z:(z=bMe(t),z!==null&&(ne.data=z)))),(z=Fje?Oje(i,t):Bje(i,t))&&(u=dL(u,"onBeforeInput"),0<u.length&&(f=new j_e("onBeforeInput","beforeinput",null,t,f),m.push({event:f,listeners:u}),f.data=z))}kMe(m,e)})}function tM(i,e,t){return{instance:i,listener:e,currentTarget:t}}function dL(i,e){for(var t=e+"Capture",n=[];i!==null;){var r=i,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=XE(i,t),s!=null&&n.unshift(tM(i,s,r)),s=XE(i,e),s!=null&&n.push(tM(i,s,r))),i=i.return}return n}function P8(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function rxe(i,e,t,n,r){for(var s=e._reactName,o=[];t!==null&&t!==n;){var a=t,c=a.alternate,u=a.stateNode;if(c!==null&&c===n)break;a.tag===5&&u!==null&&(a=u,r?(c=XE(t,s),c!=null&&o.unshift(tM(t,c,a))):r||(c=XE(t,s),c!=null&&o.push(tM(t,c,a)))),t=t.return}o.length!==0&&i.push({event:e,listeners:o})}var Zje=/\r\n?/g,Qje=/\u0000|\uFFFD/g;function ixe(i){return(typeof i=="string"?i:""+i).replace(Zje,`
`).replace(Qje,"")}function NF(i,e,t){if(e=ixe(e),ixe(i)!==e&&t)throw Error(gn(425))}function fL(){}var JJ=null,eee=null;function tee(i,e){return i==="textarea"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var nee=typeof setTimeout=="function"?setTimeout:void 0,Jje=typeof clearTimeout=="function"?clearTimeout:void 0,sxe=typeof Promise=="function"?Promise:void 0,eWe=typeof queueMicrotask=="function"?queueMicrotask:typeof sxe<"u"?function(i){return sxe.resolve(null).then(i).catch(tWe)}:nee;function tWe(i){setTimeout(function(){throw i})}function SK(i,e){var t=e,n=0;do{var r=t.nextSibling;if(i.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(n===0){i.removeChild(r),ZE(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=r}while(t);ZE(e)}function R2(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break;if(e===8){if(e=i.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return i}function oxe(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return i;e--}else t==="/$"&&e++}i=i.previousSibling}return null}var dx=Math.random().toString(36).slice(2),Lf="__reactFiber$"+dx,nM="__reactProps$"+dx,G1="__reactContainer$"+dx,ree="__reactEvents$"+dx,nWe="__reactListeners$"+dx,rWe="__reactHandles$"+dx;function $y(i){var e=i[Lf];if(e)return e;for(var t=i.parentNode;t;){if(e=t[G1]||t[Lf]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(i=oxe(i);i!==null;){if(t=i[Lf])return t;i=oxe(i)}return e}i=t,t=i.parentNode}return null}function XM(i){return i=i[Lf]||i[G1],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function M6(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(gn(33))}function TU(i){return i[nM]||null}var iee=[],C6=-1;function J2(i){return{current:i}}function $s(i){0>C6||(i.current=iee[C6],iee[C6]=null,C6--)}function Is(i,e){C6++,iee[C6]=i.current,i.current=e}var U2={},Zl=J2(U2),uc=J2(!1),l4=U2;function x_(i,e){var t=i.type.contextTypes;if(!t)return U2;var n=i.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=e,i.__reactInternalMemoizedMaskedChildContext=r),r}function hc(i){return i=i.childContextTypes,i!=null}function pL(){$s(uc),$s(Zl)}function axe(i,e,t){if(Zl.current!==U2)throw Error(gn(168));Is(Zl,e),Is(uc,t)}function FMe(i,e,t){var n=i.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var r in n)if(!(r in e))throw Error(gn(108,VHe(i)||"Unknown",r));return yo({},t,n)}function mL(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||U2,l4=Zl.current,Is(Zl,i),Is(uc,uc.current),!0}function lxe(i,e,t){var n=i.stateNode;if(!n)throw Error(gn(169));t?(i=FMe(i,e,l4),n.__reactInternalMemoizedMergedChildContext=i,$s(uc),$s(Zl),Is(Zl,i)):$s(uc),Is(uc,t)}var m1=null,EU=!1,wK=!1;function OMe(i){m1===null?m1=[i]:m1.push(i)}function iWe(i){EU=!0,OMe(i)}function e3(){if(!wK&&m1!==null){wK=!0;var i=0,e=as;try{var t=m1;for(as=1;i<t.length;i++){var n=t[i];do n=n(!0);while(n!==null)}m1=null,EU=!1}catch(r){throw m1!==null&&(m1=m1.slice(i+1)),aMe(ene,e3),r}finally{as=e,wK=!1}}return null}var A6=[],R6=0,gL=null,yL=0,Vu=[],Gu=0,c4=null,S1=1,w1="";function xy(i,e){A6[R6++]=yL,A6[R6++]=gL,gL=i,yL=e}function BMe(i,e,t){Vu[Gu++]=S1,Vu[Gu++]=w1,Vu[Gu++]=c4,c4=i;var n=S1;i=w1;var r=32-xd(n)-1;n&=~(1<<r),t+=1;var s=32-xd(e)+r;if(30<s){var o=r-r%5;s=(n&(1<<o)-1).toString(32),n>>=o,r-=o,S1=1<<32-xd(e)+r|t<<r|n,w1=s+i}else S1=1<<s|t<<r|n,w1=i}function cne(i){i.return!==null&&(xy(i,1),BMe(i,1,0))}function une(i){for(;i===gL;)gL=A6[--R6],A6[R6]=null,yL=A6[--R6],A6[R6]=null;for(;i===c4;)c4=Vu[--Gu],Vu[Gu]=null,w1=Vu[--Gu],Vu[Gu]=null,S1=Vu[--Gu],Vu[Gu]=null}var Kc=null,Yc=null,Xs=!1,cd=null;function LMe(i,e){var t=Wu(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=i,e=i.deletions,e===null?(i.deletions=[t],i.flags|=16):e.push(t)}function cxe(i,e){switch(i.tag){case 5:var t=i.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(i.stateNode=e,Kc=i,Yc=R2(e.firstChild),!0):!1;case 6:return e=i.pendingProps===""||e.nodeType!==3?null:e,e!==null?(i.stateNode=e,Kc=i,Yc=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=c4!==null?{id:S1,overflow:w1}:null,i.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Wu(18,null,null,0),t.stateNode=e,t.return=i,i.child=t,Kc=i,Yc=null,!0):!1;default:return!1}}function see(i){return(i.mode&1)!==0&&(i.flags&128)===0}function oee(i){if(Xs){var e=Yc;if(e){var t=e;if(!cxe(i,e)){if(see(i))throw Error(gn(418));e=R2(t.nextSibling);var n=Kc;e&&cxe(i,e)?LMe(n,t):(i.flags=i.flags&-4097|2,Xs=!1,Kc=i)}}else{if(see(i))throw Error(gn(418));i.flags=i.flags&-4097|2,Xs=!1,Kc=i}}}function uxe(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Kc=i}function IF(i){if(i!==Kc)return!1;if(!Xs)return uxe(i),Xs=!0,!1;var e;if((e=i.tag!==3)&&!(e=i.tag!==5)&&(e=i.type,e=e!=="head"&&e!=="body"&&!tee(i.type,i.memoizedProps)),e&&(e=Yc)){if(see(i))throw UMe(),Error(gn(418));for(;e;)LMe(i,e),e=R2(e.nextSibling)}if(uxe(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(gn(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="/$"){if(e===0){Yc=R2(i.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}i=i.nextSibling}Yc=null}}else Yc=Kc?R2(i.stateNode.nextSibling):null;return!0}function UMe(){for(var i=Yc;i;)i=R2(i.nextSibling)}function b_(){Yc=Kc=null,Xs=!1}function hne(i){cd===null?cd=[i]:cd.push(i)}var sWe=tm.ReactCurrentBatchConfig;function od(i,e){if(i&&i.defaultProps){e=yo({},e),i=i.defaultProps;for(var t in i)e[t]===void 0&&(e[t]=i[t]);return e}return e}var vL=J2(null),_L=null,P6=null,dne=null;function fne(){dne=P6=_L=null}function pne(i){var e=vL.current;$s(vL),i._currentValue=e}function aee(i,e,t){for(;i!==null;){var n=i.alternate;if((i.childLanes&e)!==e?(i.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),i===t)break;i=i.return}}function e_(i,e){_L=i,dne=P6=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&e&&(sc=!0),i.firstContext=null)}function eh(i){var e=i._currentValue;if(dne!==i)if(i={context:i,memoizedValue:e,next:null},P6===null){if(_L===null)throw Error(gn(308));P6=i,_L.dependencies={lanes:0,firstContext:i}}else P6=P6.next=i;return e}var Hy=null;function mne(i){Hy===null?Hy=[i]:Hy.push(i)}function zMe(i,e,t,n){var r=e.interleaved;return r===null?(t.next=t,mne(e)):(t.next=r.next,r.next=t),e.interleaved=t,$1(i,n)}function $1(i,e){i.lanes|=e;var t=i.alternate;for(t!==null&&(t.lanes|=e),t=i,i=i.return;i!==null;)i.childLanes|=e,t=i.alternate,t!==null&&(t.childLanes|=e),t=i,i=i.return;return t.tag===3?t.stateNode:null}var h2=!1;function gne(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function VMe(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function R1(i,e){return{eventTime:i,lane:e,tag:0,payload:null,callback:null,next:null}}function P2(i,e,t){var n=i.updateQueue;if(n===null)return null;if(n=n.shared,Ni&2){var r=n.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),n.pending=e,$1(i,t)}return r=n.interleaved,r===null?(e.next=e,mne(n)):(e.next=r.next,r.next=e),n.interleaved=e,$1(i,t)}function RB(i,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,tne(i,t)}}function hxe(i,e){var t=i.updateQueue,n=i.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:n.shared,effects:n.effects},i.updateQueue=t;return}i=t.lastBaseUpdate,i===null?t.firstBaseUpdate=e:i.next=e,t.lastBaseUpdate=e}function xL(i,e,t,n){var r=i.updateQueue;h2=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,u=c.next;c.next=null,o===null?s=u:o.next=u,o=c;var f=i.alternate;f!==null&&(f=f.updateQueue,a=f.lastBaseUpdate,a!==o&&(a===null?f.firstBaseUpdate=u:a.next=u,f.lastBaseUpdate=c))}if(s!==null){var m=r.baseState;o=0,f=u=c=null,a=s;do{var v=a.lane,x=a.eventTime;if((n&v)===v){f!==null&&(f=f.next={eventTime:x,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var T=i,P=a;switch(v=e,x=t,P.tag){case 1:if(T=P.payload,typeof T=="function"){m=T.call(x,m,v);break e}m=T;break e;case 3:T.flags=T.flags&-65537|128;case 0:if(T=P.payload,v=typeof T=="function"?T.call(x,m,v):T,v==null)break e;m=yo({},m,v);break e;case 2:h2=!0}}a.callback!==null&&a.lane!==0&&(i.flags|=64,v=r.effects,v===null?r.effects=[a]:v.push(a))}else x={eventTime:x,lane:v,tag:a.tag,payload:a.payload,callback:a.callback,next:null},f===null?(u=f=x,c=m):f=f.next=x,o|=v;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;v=a,a=v.next,v.next=null,r.lastBaseUpdate=v,r.shared.pending=null}}while(1);if(f===null&&(c=m),r.baseState=c,r.firstBaseUpdate=u,r.lastBaseUpdate=f,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);h4|=o,i.lanes=o,i.memoizedState=m}}function dxe(i,e,t){if(i=e.effects,e.effects=null,i!==null)for(e=0;e<i.length;e++){var n=i[e],r=n.callback;if(r!==null){if(n.callback=null,n=t,typeof r!="function")throw Error(gn(191,r));r.call(n)}}}var GMe=new zEe.Component().refs;function lee(i,e,t,n){e=i.memoizedState,t=t(n,e),t=t==null?e:yo({},e,t),i.memoizedState=t,i.lanes===0&&(i.updateQueue.baseState=t)}var MU={isMounted:function(i){return(i=i._reactInternals)?A4(i)===i:!1},enqueueSetState:function(i,e,t){i=i._reactInternals;var n=I0(),r=I2(i),s=R1(n,r);s.payload=e,t!=null&&(s.callback=t),e=P2(i,s,r),e!==null&&(bd(e,i,r,n),RB(e,i,r))},enqueueReplaceState:function(i,e,t){i=i._reactInternals;var n=I0(),r=I2(i),s=R1(n,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=P2(i,s,r),e!==null&&(bd(e,i,r,n),RB(e,i,r))},enqueueForceUpdate:function(i,e){i=i._reactInternals;var t=I0(),n=I2(i),r=R1(t,n);r.tag=2,e!=null&&(r.callback=e),e=P2(i,r,n),e!==null&&(bd(e,i,n,t),RB(e,i,n))}};function fxe(i,e,t,n,r,s,o){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(n,s,o):e.prototype&&e.prototype.isPureReactComponent?!JE(t,n)||!JE(r,s):!0}function $Me(i,e,t){var n=!1,r=U2,s=e.contextType;return typeof s=="object"&&s!==null?s=eh(s):(r=hc(e)?l4:Zl.current,n=e.contextTypes,s=(n=n!=null)?x_(i,r):U2),e=new e(t,s),i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=MU,i.stateNode=e,e._reactInternals=i,n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=r,i.__reactInternalMemoizedMaskedChildContext=s),e}function pxe(i,e,t,n){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==i&&MU.enqueueReplaceState(e,e.state,null)}function cee(i,e,t,n){var r=i.stateNode;r.props=t,r.state=i.memoizedState,r.refs=GMe,gne(i);var s=e.contextType;typeof s=="object"&&s!==null?r.context=eh(s):(s=hc(e)?l4:Zl.current,r.context=x_(i,s)),r.state=i.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(lee(i,e,s,t),r.state=i.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&MU.enqueueReplaceState(r,r.state,null),xL(i,t,r,n),r.state=i.memoizedState),typeof r.componentDidMount=="function"&&(i.flags|=4194308)}function tT(i,e,t){if(i=t.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(gn(309));var n=t.stateNode}if(!n)throw Error(gn(147,i));var r=n,s=""+i;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;a===GMe&&(a=r.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof i!="string")throw Error(gn(284));if(!t._owner)throw Error(gn(290,i))}return i}function kF(i,e){throw i=Object.prototype.toString.call(e),Error(gn(31,i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i))}function mxe(i){var e=i._init;return e(i._payload)}function HMe(i){function e(M,O){if(i){var C=M.deletions;C===null?(M.deletions=[O],M.flags|=16):C.push(O)}}function t(M,O){if(!i)return null;for(;O!==null;)e(M,O),O=O.sibling;return null}function n(M,O){for(M=new Map;O!==null;)O.key!==null?M.set(O.key,O):M.set(O.index,O),O=O.sibling;return M}function r(M,O){return M=k2(M,O),M.index=0,M.sibling=null,M}function s(M,O,C){return M.index=C,i?(C=M.alternate,C!==null?(C=C.index,C<O?(M.flags|=2,O):C):(M.flags|=2,O)):(M.flags|=1048576,O)}function o(M){return i&&M.alternate===null&&(M.flags|=2),M}function a(M,O,C,L){return O===null||O.tag!==6?(O=PK(C,M.mode,L),O.return=M,O):(O=r(O,C),O.return=M,O)}function c(M,O,C,L){var Y=C.type;return Y===S6?f(M,O,C.props.children,L,C.key):O!==null&&(O.elementType===Y||typeof Y=="object"&&Y!==null&&Y.$$typeof===u2&&mxe(Y)===O.type)?(L=r(O,C.props),L.ref=tT(M,O,C),L.return=M,L):(L=FB(C.type,C.key,C.props,null,M.mode,L),L.ref=tT(M,O,C),L.return=M,L)}function u(M,O,C,L){return O===null||O.tag!==4||O.stateNode.containerInfo!==C.containerInfo||O.stateNode.implementation!==C.implementation?(O=NK(C,M.mode,L),O.return=M,O):(O=r(O,C.children||[]),O.return=M,O)}function f(M,O,C,L,Y){return O===null||O.tag!==7?(O=Qy(C,M.mode,L,Y),O.return=M,O):(O=r(O,C),O.return=M,O)}function m(M,O,C){if(typeof O=="string"&&O!==""||typeof O=="number")return O=PK(""+O,M.mode,C),O.return=M,O;if(typeof O=="object"&&O!==null){switch(O.$$typeof){case SF:return C=FB(O.type,O.key,O.props,null,M.mode,C),C.ref=tT(M,null,O),C.return=M,C;case b6:return O=NK(O,M.mode,C),O.return=M,O;case u2:var L=O._init;return m(M,L(O._payload),C)}if(JT(O)||Kw(O))return O=Qy(O,M.mode,C,null),O.return=M,O;kF(M,O)}return null}function v(M,O,C,L){var Y=O!==null?O.key:null;if(typeof C=="string"&&C!==""||typeof C=="number")return Y!==null?null:a(M,O,""+C,L);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case SF:return C.key===Y?c(M,O,C,L):null;case b6:return C.key===Y?u(M,O,C,L):null;case u2:return Y=C._init,v(M,O,Y(C._payload),L)}if(JT(C)||Kw(C))return Y!==null?null:f(M,O,C,L,null);kF(M,C)}return null}function x(M,O,C,L,Y){if(typeof L=="string"&&L!==""||typeof L=="number")return M=M.get(C)||null,a(O,M,""+L,Y);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case SF:return M=M.get(L.key===null?C:L.key)||null,c(O,M,L,Y);case b6:return M=M.get(L.key===null?C:L.key)||null,u(O,M,L,Y);case u2:var J=L._init;return x(M,O,C,J(L._payload),Y)}if(JT(L)||Kw(L))return M=M.get(C)||null,f(O,M,L,Y,null);kF(O,L)}return null}function T(M,O,C,L){for(var Y=null,J=null,z=O,ne=O=0,K=null;z!==null&&ne<C.length;ne++){z.index>ne?(K=z,z=null):K=z.sibling;var $=v(M,z,C[ne],L);if($===null){z===null&&(z=K);break}i&&z&&$.alternate===null&&e(M,z),O=s($,O,ne),J===null?Y=$:J.sibling=$,J=$,z=K}if(ne===C.length)return t(M,z),Xs&&xy(M,ne),Y;if(z===null){for(;ne<C.length;ne++)z=m(M,C[ne],L),z!==null&&(O=s(z,O,ne),J===null?Y=z:J.sibling=z,J=z);return Xs&&xy(M,ne),Y}for(z=n(M,z);ne<C.length;ne++)K=x(z,M,ne,C[ne],L),K!==null&&(i&&K.alternate!==null&&z.delete(K.key===null?ne:K.key),O=s(K,O,ne),J===null?Y=K:J.sibling=K,J=K);return i&&z.forEach(function(he){return e(M,he)}),Xs&&xy(M,ne),Y}function P(M,O,C,L){var Y=Kw(C);if(typeof Y!="function")throw Error(gn(150));if(C=Y.call(C),C==null)throw Error(gn(151));for(var J=Y=null,z=O,ne=O=0,K=null,$=C.next();z!==null&&!$.done;ne++,$=C.next()){z.index>ne?(K=z,z=null):K=z.sibling;var he=v(M,z,$.value,L);if(he===null){z===null&&(z=K);break}i&&z&&he.alternate===null&&e(M,z),O=s(he,O,ne),J===null?Y=he:J.sibling=he,J=he,z=K}if($.done)return t(M,z),Xs&&xy(M,ne),Y;if(z===null){for(;!$.done;ne++,$=C.next())$=m(M,$.value,L),$!==null&&(O=s($,O,ne),J===null?Y=$:J.sibling=$,J=$);return Xs&&xy(M,ne),Y}for(z=n(M,z);!$.done;ne++,$=C.next())$=x(z,M,ne,$.value,L),$!==null&&(i&&$.alternate!==null&&z.delete($.key===null?ne:$.key),O=s($,O,ne),J===null?Y=$:J.sibling=$,J=$);return i&&z.forEach(function(Ce){return e(M,Ce)}),Xs&&xy(M,ne),Y}function R(M,O,C,L){if(typeof C=="object"&&C!==null&&C.type===S6&&C.key===null&&(C=C.props.children),typeof C=="object"&&C!==null){switch(C.$$typeof){case SF:e:{for(var Y=C.key,J=O;J!==null;){if(J.key===Y){if(Y=C.type,Y===S6){if(J.tag===7){t(M,J.sibling),O=r(J,C.props.children),O.return=M,M=O;break e}}else if(J.elementType===Y||typeof Y=="object"&&Y!==null&&Y.$$typeof===u2&&mxe(Y)===J.type){t(M,J.sibling),O=r(J,C.props),O.ref=tT(M,J,C),O.return=M,M=O;break e}t(M,J);break}else e(M,J);J=J.sibling}C.type===S6?(O=Qy(C.props.children,M.mode,L,C.key),O.return=M,M=O):(L=FB(C.type,C.key,C.props,null,M.mode,L),L.ref=tT(M,O,C),L.return=M,M=L)}return o(M);case b6:e:{for(J=C.key;O!==null;){if(O.key===J)if(O.tag===4&&O.stateNode.containerInfo===C.containerInfo&&O.stateNode.implementation===C.implementation){t(M,O.sibling),O=r(O,C.children||[]),O.return=M,M=O;break e}else{t(M,O);break}else e(M,O);O=O.sibling}O=NK(C,M.mode,L),O.return=M,M=O}return o(M);case u2:return J=C._init,R(M,O,J(C._payload),L)}if(JT(C))return T(M,O,C,L);if(Kw(C))return P(M,O,C,L);kF(M,C)}return typeof C=="string"&&C!==""||typeof C=="number"?(C=""+C,O!==null&&O.tag===6?(t(M,O.sibling),O=r(O,C),O.return=M,M=O):(t(M,O),O=PK(C,M.mode,L),O.return=M,M=O),o(M)):t(M,O)}return R}var S_=HMe(!0),jMe=HMe(!1),YM={},$f=J2(YM),rM=J2(YM),iM=J2(YM);function jy(i){if(i===YM)throw Error(gn(174));return i}function yne(i,e){switch(Is(iM,e),Is(rM,i),Is($f,YM),i=e.nodeType,i){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:VJ(null,"");break;default:i=i===8?e.parentNode:e,e=i.namespaceURI||null,i=i.tagName,e=VJ(e,i)}$s($f),Is($f,e)}function w_(){$s($f),$s(rM),$s(iM)}function WMe(i){jy(iM.current);var e=jy($f.current),t=VJ(e,i.type);e!==t&&(Is(rM,i),Is($f,t))}function vne(i){rM.current===i&&($s($f),$s(rM))}var co=J2(0);function bL(i){for(var e=i;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var TK=[];function _ne(){for(var i=0;i<TK.length;i++)TK[i]._workInProgressVersionPrimary=null;TK.length=0}var PB=tm.ReactCurrentDispatcher,EK=tm.ReactCurrentBatchConfig,u4=0,go=null,Ta=null,Ha=null,SL=!1,ME=!1,sM=0,oWe=0;function Dl(){throw Error(gn(321))}function xne(i,e){if(e===null)return!1;for(var t=0;t<e.length&&t<i.length;t++)if(!wd(i[t],e[t]))return!1;return!0}function bne(i,e,t,n,r,s){if(u4=s,go=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,PB.current=i===null||i.memoizedState===null?uWe:hWe,i=t(n,r),ME){s=0;do{if(ME=!1,sM=0,25<=s)throw Error(gn(301));s+=1,Ha=Ta=null,e.updateQueue=null,PB.current=dWe,i=t(n,r)}while(ME)}if(PB.current=wL,e=Ta!==null&&Ta.next!==null,u4=0,Ha=Ta=go=null,SL=!1,e)throw Error(gn(300));return i}function Sne(){var i=sM!==0;return sM=0,i}function kf(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ha===null?go.memoizedState=Ha=i:Ha=Ha.next=i,Ha}function th(){if(Ta===null){var i=go.alternate;i=i!==null?i.memoizedState:null}else i=Ta.next;var e=Ha===null?go.memoizedState:Ha.next;if(e!==null)Ha=e,Ta=i;else{if(i===null)throw Error(gn(310));Ta=i,i={memoizedState:Ta.memoizedState,baseState:Ta.baseState,baseQueue:Ta.baseQueue,queue:Ta.queue,next:null},Ha===null?go.memoizedState=Ha=i:Ha=Ha.next=i}return Ha}function oM(i,e){return typeof e=="function"?e(i):e}function MK(i){var e=th(),t=e.queue;if(t===null)throw Error(gn(311));t.lastRenderedReducer=i;var n=Ta,r=n.baseQueue,s=t.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}n.baseQueue=r=s,t.pending=null}if(r!==null){s=r.next,n=n.baseState;var a=o=null,c=null,u=s;do{var f=u.lane;if((u4&f)===f)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:i(n,u.action);else{var m={lane:f,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(a=c=m,o=n):c=c.next=m,go.lanes|=f,h4|=f}u=u.next}while(u!==null&&u!==s);c===null?o=n:c.next=a,wd(n,e.memoizedState)||(sc=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=c,t.lastRenderedState=n}if(i=t.interleaved,i!==null){r=i;do s=r.lane,go.lanes|=s,h4|=s,r=r.next;while(r!==i)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function CK(i){var e=th(),t=e.queue;if(t===null)throw Error(gn(311));t.lastRenderedReducer=i;var n=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var o=r=r.next;do s=i(s,o.action),o=o.next;while(o!==r);wd(s,e.memoizedState)||(sc=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,n]}function qMe(){}function XMe(i,e){var t=go,n=th(),r=e(),s=!wd(n.memoizedState,r);if(s&&(n.memoizedState=r,sc=!0),n=n.queue,wne(ZMe.bind(null,t,n,i),[i]),n.getSnapshot!==e||s||Ha!==null&&Ha.memoizedState.tag&1){if(t.flags|=2048,aM(9,KMe.bind(null,t,n,r,e),void 0,null),Ya===null)throw Error(gn(349));u4&30||YMe(t,e,r)}return r}function YMe(i,e,t){i.flags|=16384,i={getSnapshot:e,value:t},e=go.updateQueue,e===null?(e={lastEffect:null,stores:null},go.updateQueue=e,e.stores=[i]):(t=e.stores,t===null?e.stores=[i]:t.push(i))}function KMe(i,e,t,n){e.value=t,e.getSnapshot=n,QMe(e)&&JMe(i)}function ZMe(i,e,t){return t(function(){QMe(e)&&JMe(i)})}function QMe(i){var e=i.getSnapshot;i=i.value;try{var t=e();return!wd(i,t)}catch{return!0}}function JMe(i){var e=$1(i,1);e!==null&&bd(e,i,1,-1)}function gxe(i){var e=kf();return typeof i=="function"&&(i=i()),e.memoizedState=e.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:oM,lastRenderedState:i},e.queue=i,i=i.dispatch=cWe.bind(null,go,i),[e.memoizedState,i]}function aM(i,e,t,n){return i={tag:i,create:e,destroy:t,deps:n,next:null},e=go.updateQueue,e===null?(e={lastEffect:null,stores:null},go.updateQueue=e,e.lastEffect=i.next=i):(t=e.lastEffect,t===null?e.lastEffect=i.next=i:(n=t.next,t.next=i,i.next=n,e.lastEffect=i)),i}function eCe(){return th().memoizedState}function NB(i,e,t,n){var r=kf();go.flags|=i,r.memoizedState=aM(1|e,t,void 0,n===void 0?null:n)}function CU(i,e,t,n){var r=th();n=n===void 0?null:n;var s=void 0;if(Ta!==null){var o=Ta.memoizedState;if(s=o.destroy,n!==null&&xne(n,o.deps)){r.memoizedState=aM(e,t,s,n);return}}go.flags|=i,r.memoizedState=aM(1|e,t,s,n)}function yxe(i,e){return NB(8390656,8,i,e)}function wne(i,e){return CU(2048,8,i,e)}function tCe(i,e){return CU(4,2,i,e)}function nCe(i,e){return CU(4,4,i,e)}function rCe(i,e){if(typeof e=="function")return i=i(),e(i),function(){e(null)};if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function iCe(i,e,t){return t=t!=null?t.concat([i]):null,CU(4,4,rCe.bind(null,e,i),t)}function Tne(){}function sCe(i,e){var t=th();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&xne(e,n[1])?n[0]:(t.memoizedState=[i,e],i)}function oCe(i,e){var t=th();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&xne(e,n[1])?n[0]:(i=i(),t.memoizedState=[i,e],i)}function aCe(i,e,t){return u4&21?(wd(t,e)||(t=uMe(),go.lanes|=t,h4|=t,i.baseState=!0),e):(i.baseState&&(i.baseState=!1,sc=!0),i.memoizedState=t)}function aWe(i,e){var t=as;as=t!==0&&4>t?t:4,i(!0);var n=EK.transition;EK.transition={};try{i(!1),e()}finally{as=t,EK.transition=n}}function lCe(){return th().memoizedState}function lWe(i,e,t){var n=I2(i);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},cCe(i))uCe(e,t);else if(t=zMe(i,e,t,n),t!==null){var r=I0();bd(t,i,n,r),hCe(t,e,n)}}function cWe(i,e,t){var n=I2(i),r={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(cCe(i))uCe(e,r);else{var s=i.alternate;if(i.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(r.hasEagerState=!0,r.eagerState=a,wd(a,o)){var c=e.interleaved;c===null?(r.next=r,mne(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}t=zMe(i,e,r,n),t!==null&&(r=I0(),bd(t,i,n,r),hCe(t,e,n))}}function cCe(i){var e=i.alternate;return i===go||e!==null&&e===go}function uCe(i,e){ME=SL=!0;var t=i.pending;t===null?e.next=e:(e.next=t.next,t.next=e),i.pending=e}function hCe(i,e,t){if(t&4194240){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,tne(i,t)}}var wL={readContext:eh,useCallback:Dl,useContext:Dl,useEffect:Dl,useImperativeHandle:Dl,useInsertionEffect:Dl,useLayoutEffect:Dl,useMemo:Dl,useReducer:Dl,useRef:Dl,useState:Dl,useDebugValue:Dl,useDeferredValue:Dl,useTransition:Dl,useMutableSource:Dl,useSyncExternalStore:Dl,useId:Dl,unstable_isNewReconciler:!1},uWe={readContext:eh,useCallback:function(i,e){return kf().memoizedState=[i,e===void 0?null:e],i},useContext:eh,useEffect:yxe,useImperativeHandle:function(i,e,t){return t=t!=null?t.concat([i]):null,NB(4194308,4,rCe.bind(null,e,i),t)},useLayoutEffect:function(i,e){return NB(4194308,4,i,e)},useInsertionEffect:function(i,e){return NB(4,2,i,e)},useMemo:function(i,e){var t=kf();return e=e===void 0?null:e,i=i(),t.memoizedState=[i,e],i},useReducer:function(i,e,t){var n=kf();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:e},n.queue=i,i=i.dispatch=lWe.bind(null,go,i),[n.memoizedState,i]},useRef:function(i){var e=kf();return i={current:i},e.memoizedState=i},useState:gxe,useDebugValue:Tne,useDeferredValue:function(i){return kf().memoizedState=i},useTransition:function(){var i=gxe(!1),e=i[0];return i=aWe.bind(null,i[1]),kf().memoizedState=i,[e,i]},useMutableSource:function(){},useSyncExternalStore:function(i,e,t){var n=go,r=kf();if(Xs){if(t===void 0)throw Error(gn(407));t=t()}else{if(t=e(),Ya===null)throw Error(gn(349));u4&30||YMe(n,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,yxe(ZMe.bind(null,n,s,i),[i]),n.flags|=2048,aM(9,KMe.bind(null,n,s,t,e),void 0,null),t},useId:function(){var i=kf(),e=Ya.identifierPrefix;if(Xs){var t=w1,n=S1;t=(n&~(1<<32-xd(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=sM++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=oWe++,e=":"+e+"r"+t.toString(32)+":";return i.memoizedState=e},unstable_isNewReconciler:!1},hWe={readContext:eh,useCallback:sCe,useContext:eh,useEffect:wne,useImperativeHandle:iCe,useInsertionEffect:tCe,useLayoutEffect:nCe,useMemo:oCe,useReducer:MK,useRef:eCe,useState:function(){return MK(oM)},useDebugValue:Tne,useDeferredValue:function(i){var e=th();return aCe(e,Ta.memoizedState,i)},useTransition:function(){var i=MK(oM)[0],e=th().memoizedState;return[i,e]},useMutableSource:qMe,useSyncExternalStore:XMe,useId:lCe,unstable_isNewReconciler:!1},dWe={readContext:eh,useCallback:sCe,useContext:eh,useEffect:wne,useImperativeHandle:iCe,useInsertionEffect:tCe,useLayoutEffect:nCe,useMemo:oCe,useReducer:CK,useRef:eCe,useState:function(){return CK(oM)},useDebugValue:Tne,useDeferredValue:function(i){var e=th();return Ta===null?e.memoizedState=i:aCe(e,Ta.memoizedState,i)},useTransition:function(){var i=CK(oM)[0],e=th().memoizedState;return[i,e]},useMutableSource:qMe,useSyncExternalStore:XMe,useId:lCe,unstable_isNewReconciler:!1};function T_(i,e){try{var t="",n=e;do t+=zHe(n),n=n.return;while(n);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:i,source:e,stack:r,digest:null}}function AK(i,e,t){return{value:i,source:null,stack:t??null,digest:e??null}}function uee(i,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var fWe=typeof WeakMap=="function"?WeakMap:Map;function dCe(i,e,t){t=R1(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){EL||(EL=!0,xee=n),uee(i,e)},t}function fCe(i,e,t){t=R1(-1,t),t.tag=3;var n=i.type.getDerivedStateFromError;if(typeof n=="function"){var r=e.value;t.payload=function(){return n(r)},t.callback=function(){uee(i,e)}}var s=i.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){uee(i,e),typeof n!="function"&&(N2===null?N2=new Set([this]):N2.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function vxe(i,e,t){var n=i.pingCache;if(n===null){n=i.pingCache=new fWe;var r=new Set;n.set(e,r)}else r=n.get(e),r===void 0&&(r=new Set,n.set(e,r));r.has(t)||(r.add(t),i=CWe.bind(null,i,e,t),e.then(i,i))}function _xe(i){do{var e;if((e=i.tag===13)&&(e=i.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return i;i=i.return}while(i!==null);return null}function xxe(i,e,t,n,r){return i.mode&1?(i.flags|=65536,i.lanes=r,i):(i===e?i.flags|=65536:(i.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=R1(-1,1),e.tag=2,P2(t,e,1))),t.lanes|=1),i)}var pWe=tm.ReactCurrentOwner,sc=!1;function E0(i,e,t,n){e.child=i===null?jMe(e,null,t,n):S_(e,i.child,t,n)}function bxe(i,e,t,n,r){t=t.render;var s=e.ref;return e_(e,r),n=bne(i,e,t,n,s,r),t=Sne(),i!==null&&!sc?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~r,H1(i,e,r)):(Xs&&t&&cne(e),e.flags|=1,E0(i,e,n,r),e.child)}function Sxe(i,e,t,n,r){if(i===null){var s=t.type;return typeof s=="function"&&!Ine(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,pCe(i,e,s,n,r)):(i=FB(t.type,null,n,e,e.mode,r),i.ref=e.ref,i.return=e,e.child=i)}if(s=i.child,!(i.lanes&r)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:JE,t(o,n)&&i.ref===e.ref)return H1(i,e,r)}return e.flags|=1,i=k2(s,n),i.ref=e.ref,i.return=e,e.child=i}function pCe(i,e,t,n,r){if(i!==null){var s=i.memoizedProps;if(JE(s,n)&&i.ref===e.ref)if(sc=!1,e.pendingProps=n=s,(i.lanes&r)!==0)i.flags&131072&&(sc=!0);else return e.lanes=i.lanes,H1(i,e,r)}return hee(i,e,t,n,r)}function mCe(i,e,t){var n=e.pendingProps,r=n.children,s=i!==null?i.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Is(I6,Hc),Hc|=t;else{if(!(t&1073741824))return i=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:i,cachePool:null,transitions:null},e.updateQueue=null,Is(I6,Hc),Hc|=i,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:t,Is(I6,Hc),Hc|=n}else s!==null?(n=s.baseLanes|t,e.memoizedState=null):n=t,Is(I6,Hc),Hc|=n;return E0(i,e,r,t),e.child}function gCe(i,e){var t=e.ref;(i===null&&t!==null||i!==null&&i.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function hee(i,e,t,n,r){var s=hc(t)?l4:Zl.current;return s=x_(e,s),e_(e,r),t=bne(i,e,t,n,s,r),n=Sne(),i!==null&&!sc?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~r,H1(i,e,r)):(Xs&&n&&cne(e),e.flags|=1,E0(i,e,t,r),e.child)}function wxe(i,e,t,n,r){if(hc(t)){var s=!0;mL(e)}else s=!1;if(e_(e,r),e.stateNode===null)IB(i,e),$Me(e,t,n),cee(e,t,n,r),n=!0;else if(i===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=eh(u):(u=hc(t)?l4:Zl.current,u=x_(e,u));var f=t.getDerivedStateFromProps,m=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function";m||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||c!==u)&&pxe(e,o,n,u),h2=!1;var v=e.memoizedState;o.state=v,xL(e,n,o,r),c=e.memoizedState,a!==n||v!==c||uc.current||h2?(typeof f=="function"&&(lee(e,t,f,n),c=e.memoizedState),(a=h2||fxe(e,t,a,n,v,c,u))?(m||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),o.props=n,o.state=c,o.context=u,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,VMe(i,e),a=e.memoizedProps,u=e.type===e.elementType?a:od(e.type,a),o.props=u,m=e.pendingProps,v=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=eh(c):(c=hc(t)?l4:Zl.current,c=x_(e,c));var x=t.getDerivedStateFromProps;(f=typeof x=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==m||v!==c)&&pxe(e,o,n,c),h2=!1,v=e.memoizedState,o.state=v,xL(e,n,o,r);var T=e.memoizedState;a!==m||v!==T||uc.current||h2?(typeof x=="function"&&(lee(e,t,x,n),T=e.memoizedState),(u=h2||fxe(e,t,u,n,v,T,c)||!1)?(f||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,T,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,T,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===i.memoizedProps&&v===i.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&v===i.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=T),o.props=n,o.state=T,o.context=c,n=u):(typeof o.componentDidUpdate!="function"||a===i.memoizedProps&&v===i.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&v===i.memoizedState||(e.flags|=1024),n=!1)}return dee(i,e,t,n,s,r)}function dee(i,e,t,n,r,s){gCe(i,e);var o=(e.flags&128)!==0;if(!n&&!o)return r&&lxe(e,t,!1),H1(i,e,s);n=e.stateNode,pWe.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,i!==null&&o?(e.child=S_(e,i.child,null,s),e.child=S_(e,null,a,s)):E0(i,e,a,s),e.memoizedState=n.state,r&&lxe(e,t,!0),e.child}function yCe(i){var e=i.stateNode;e.pendingContext?axe(i,e.pendingContext,e.pendingContext!==e.context):e.context&&axe(i,e.context,!1),yne(i,e.containerInfo)}function Txe(i,e,t,n,r){return b_(),hne(r),e.flags|=256,E0(i,e,t,n),e.child}var fee={dehydrated:null,treeContext:null,retryLane:0};function pee(i){return{baseLanes:i,cachePool:null,transitions:null}}function vCe(i,e,t){var n=e.pendingProps,r=co.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=i!==null&&i.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(i===null||i.memoizedState!==null)&&(r|=1),Is(co,r&1),i===null)return oee(e),i=e.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(e.mode&1?i.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,i=n.fallback,s?(n=e.mode,s=e.child,o={mode:"hidden",children:o},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=PU(o,n,0,null),i=Qy(i,n,t,null),s.return=e,i.return=e,s.sibling=i,e.child=s,e.child.memoizedState=pee(t),e.memoizedState=fee,i):Ene(e,o));if(r=i.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return mWe(i,e,o,n,a,r,t);if(s){s=n.fallback,o=e.mode,r=i.child,a=r.sibling;var c={mode:"hidden",children:n.children};return!(o&1)&&e.child!==r?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=k2(r,c),n.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=k2(a,s):(s=Qy(s,o,t,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,o=i.child.memoizedState,o=o===null?pee(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=i.childLanes&~t,e.memoizedState=fee,n}return s=i.child,i=s.sibling,n=k2(s,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,i!==null&&(t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)),e.child=n,e.memoizedState=null,n}function Ene(i,e){return e=PU({mode:"visible",children:e},i.mode,0,null),e.return=i,i.child=e}function DF(i,e,t,n){return n!==null&&hne(n),S_(e,i.child,null,t),i=Ene(e,e.pendingProps.children),i.flags|=2,e.memoizedState=null,i}function mWe(i,e,t,n,r,s,o){if(t)return e.flags&256?(e.flags&=-257,n=AK(Error(gn(422))),DF(i,e,o,n)):e.memoizedState!==null?(e.child=i.child,e.flags|=128,null):(s=n.fallback,r=e.mode,n=PU({mode:"visible",children:n.children},r,0,null),s=Qy(s,r,o,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,e.mode&1&&S_(e,i.child,null,o),e.child.memoizedState=pee(o),e.memoizedState=fee,s);if(!(e.mode&1))return DF(i,e,o,null);if(r.data==="$!"){if(n=r.nextSibling&&r.nextSibling.dataset,n)var a=n.dgst;return n=a,s=Error(gn(419)),n=AK(s,n,void 0),DF(i,e,o,n)}if(a=(o&i.childLanes)!==0,sc||a){if(n=Ya,n!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(n.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,$1(i,r),bd(n,i,r,-1))}return Nne(),n=AK(Error(gn(421))),DF(i,e,o,n)}return r.data==="$?"?(e.flags|=128,e.child=i.child,e=AWe.bind(null,i),r._reactRetry=e,null):(i=s.treeContext,Yc=R2(r.nextSibling),Kc=e,Xs=!0,cd=null,i!==null&&(Vu[Gu++]=S1,Vu[Gu++]=w1,Vu[Gu++]=c4,S1=i.id,w1=i.overflow,c4=e),e=Ene(e,n.children),e.flags|=4096,e)}function Exe(i,e,t){i.lanes|=e;var n=i.alternate;n!==null&&(n.lanes|=e),aee(i.return,e,t)}function RK(i,e,t,n,r){var s=i.memoizedState;s===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=t,s.tailMode=r)}function _Ce(i,e,t){var n=e.pendingProps,r=n.revealOrder,s=n.tail;if(E0(i,e,n.children,t),n=co.current,n&2)n=n&1|2,e.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Exe(i,t,e);else if(i.tag===19)Exe(i,t,e);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}n&=1}if(Is(co,n),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)i=t.alternate,i!==null&&bL(i)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),RK(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(i=r.alternate,i!==null&&bL(i)===null){e.child=r;break}i=r.sibling,r.sibling=t,t=r,r=i}RK(e,!0,t,null,s);break;case"together":RK(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function IB(i,e){!(e.mode&1)&&i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2)}function H1(i,e,t){if(i!==null&&(e.dependencies=i.dependencies),h4|=e.lanes,!(t&e.childLanes))return null;if(i!==null&&e.child!==i.child)throw Error(gn(153));if(e.child!==null){for(i=e.child,t=k2(i,i.pendingProps),e.child=t,t.return=e;i.sibling!==null;)i=i.sibling,t=t.sibling=k2(i,i.pendingProps),t.return=e;t.sibling=null}return e.child}function gWe(i,e,t){switch(e.tag){case 3:yCe(e),b_();break;case 5:WMe(e);break;case 1:hc(e.type)&&mL(e);break;case 4:yne(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,r=e.memoizedProps.value;Is(vL,n._currentValue),n._currentValue=r;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(Is(co,co.current&1),e.flags|=128,null):t&e.child.childLanes?vCe(i,e,t):(Is(co,co.current&1),i=H1(i,e,t),i!==null?i.sibling:null);Is(co,co.current&1);break;case 19:if(n=(t&e.childLanes)!==0,i.flags&128){if(n)return _Ce(i,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Is(co,co.current),n)break;return null;case 22:case 23:return e.lanes=0,mCe(i,e,t)}return H1(i,e,t)}var xCe,mee,bCe,SCe;xCe=function(i,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)i.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};mee=function(){};bCe=function(i,e,t,n){var r=i.memoizedProps;if(r!==n){i=e.stateNode,jy($f.current);var s=null;switch(t){case"input":r=BJ(i,r),n=BJ(i,n),s=[];break;case"select":r=yo({},r,{value:void 0}),n=yo({},n,{value:void 0}),s=[];break;case"textarea":r=zJ(i,r),n=zJ(i,n),s=[];break;default:typeof r.onClick!="function"&&typeof n.onClick=="function"&&(i.onclick=fL)}GJ(t,n);var o;t=null;for(u in r)if(!n.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var a=r[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(WE.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in n){var c=n[u];if(a=r!=null?r[u]:void 0,n.hasOwnProperty(u)&&c!==a&&(c!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(s||(s=[]),s.push(u,t)),t=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(WE.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&Ls("scroll",i),s||a===c||(s=[])):(s=s||[]).push(u,c))}t&&(s=s||[]).push("style",t);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};SCe=function(i,e,t,n){t!==n&&(e.flags|=4)};function nT(i,e){if(!Xs)switch(i.tailMode){case"hidden":e=i.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?i.tail=null:t.sibling=null;break;case"collapsed":t=i.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:n.sibling=null}}function Fl(i){var e=i.alternate!==null&&i.alternate.child===i.child,t=0,n=0;if(e)for(var r=i.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags&14680064,n|=r.flags&14680064,r.return=i,r=r.sibling;else for(r=i.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=i,r=r.sibling;return i.subtreeFlags|=n,i.childLanes=t,e}function yWe(i,e,t){var n=e.pendingProps;switch(une(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fl(e),null;case 1:return hc(e.type)&&pL(),Fl(e),null;case 3:return n=e.stateNode,w_(),$s(uc),$s(Zl),_ne(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(i===null||i.child===null)&&(IF(e)?e.flags|=4:i===null||i.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,cd!==null&&(wee(cd),cd=null))),mee(i,e),Fl(e),null;case 5:vne(e);var r=jy(iM.current);if(t=e.type,i!==null&&e.stateNode!=null)bCe(i,e,t,n,r),i.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(gn(166));return Fl(e),null}if(i=jy($f.current),IF(e)){n=e.stateNode,t=e.type;var s=e.memoizedProps;switch(n[Lf]=e,n[nM]=s,i=(e.mode&1)!==0,t){case"dialog":Ls("cancel",n),Ls("close",n);break;case"iframe":case"object":case"embed":Ls("load",n);break;case"video":case"audio":for(r=0;r<tE.length;r++)Ls(tE[r],n);break;case"source":Ls("error",n);break;case"img":case"image":case"link":Ls("error",n),Ls("load",n);break;case"details":Ls("toggle",n);break;case"input":D_e(n,s),Ls("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},Ls("invalid",n);break;case"textarea":O_e(n,s),Ls("invalid",n)}GJ(t,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?n.textContent!==a&&(s.suppressHydrationWarning!==!0&&NF(n.textContent,a,i),r=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&NF(n.textContent,a,i),r=["children",""+a]):WE.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Ls("scroll",n)}switch(t){case"input":wF(n),F_e(n,s,!0);break;case"textarea":wF(n),B_e(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=fL)}n=r,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=YEe(t)),i==="http://www.w3.org/1999/xhtml"?t==="script"?(i=o.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof n.is=="string"?i=o.createElement(t,{is:n.is}):(i=o.createElement(t),t==="select"&&(o=i,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):i=o.createElementNS(i,t),i[Lf]=e,i[nM]=n,xCe(i,e,!1,!1),e.stateNode=i;e:{switch(o=$J(t,n),t){case"dialog":Ls("cancel",i),Ls("close",i),r=n;break;case"iframe":case"object":case"embed":Ls("load",i),r=n;break;case"video":case"audio":for(r=0;r<tE.length;r++)Ls(tE[r],i);r=n;break;case"source":Ls("error",i),r=n;break;case"img":case"image":case"link":Ls("error",i),Ls("load",i),r=n;break;case"details":Ls("toggle",i),r=n;break;case"input":D_e(i,n),r=BJ(i,n),Ls("invalid",i);break;case"option":r=n;break;case"select":i._wrapperState={wasMultiple:!!n.multiple},r=yo({},n,{value:void 0}),Ls("invalid",i);break;case"textarea":O_e(i,n),r=zJ(i,n),Ls("invalid",i);break;default:r=n}GJ(t,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?QEe(i,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&KEe(i,c)):s==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&qE(i,c):typeof c=="number"&&qE(i,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(WE.hasOwnProperty(s)?c!=null&&s==="onScroll"&&Ls("scroll",i):c!=null&&Yte(i,s,c,o))}switch(t){case"input":wF(i),F_e(i,n,!1);break;case"textarea":wF(i),B_e(i);break;case"option":n.value!=null&&i.setAttribute("value",""+L2(n.value));break;case"select":i.multiple=!!n.multiple,s=n.value,s!=null?K6(i,!!n.multiple,s,!1):n.defaultValue!=null&&K6(i,!!n.multiple,n.defaultValue,!0);break;default:typeof r.onClick=="function"&&(i.onclick=fL)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Fl(e),null;case 6:if(i&&e.stateNode!=null)SCe(i,e,i.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(gn(166));if(t=jy(iM.current),jy($f.current),IF(e)){if(n=e.stateNode,t=e.memoizedProps,n[Lf]=e,(s=n.nodeValue!==t)&&(i=Kc,i!==null))switch(i.tag){case 3:NF(n.nodeValue,t,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&NF(n.nodeValue,t,(i.mode&1)!==0)}s&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[Lf]=e,e.stateNode=n}return Fl(e),null;case 13:if($s(co),n=e.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(Xs&&Yc!==null&&e.mode&1&&!(e.flags&128))UMe(),b_(),e.flags|=98560,s=!1;else if(s=IF(e),n!==null&&n.dehydrated!==null){if(i===null){if(!s)throw Error(gn(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(gn(317));s[Lf]=e}else b_(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Fl(e),s=!1}else cd!==null&&(wee(cd),cd=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(i!==null&&i.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(i===null||co.current&1?Ca===0&&(Ca=3):Nne())),e.updateQueue!==null&&(e.flags|=4),Fl(e),null);case 4:return w_(),mee(i,e),i===null&&eM(e.stateNode.containerInfo),Fl(e),null;case 10:return pne(e.type._context),Fl(e),null;case 17:return hc(e.type)&&pL(),Fl(e),null;case 19:if($s(co),s=e.memoizedState,s===null)return Fl(e),null;if(n=(e.flags&128)!==0,o=s.rendering,o===null)if(n)nT(s,!1);else{if(Ca!==0||i!==null&&i.flags&128)for(i=e.child;i!==null;){if(o=bL(i),o!==null){for(e.flags|=128,nT(s,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)s=t,i=n,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,i=o.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),t=t.sibling;return Is(co,co.current&1|2),e.child}i=i.sibling}s.tail!==null&&zo()>E_&&(e.flags|=128,n=!0,nT(s,!1),e.lanes=4194304)}else{if(!n)if(i=bL(o),i!==null){if(e.flags|=128,n=!0,t=i.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),nT(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Xs)return Fl(e),null}else 2*zo()-s.renderingStartTime>E_&&t!==1073741824&&(e.flags|=128,n=!0,nT(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=zo(),e.sibling=null,t=co.current,Is(co,n?t&1|2:t&1),e):(Fl(e),null);case 22:case 23:return Pne(),n=e.memoizedState!==null,i!==null&&i.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Hc&1073741824&&(Fl(e),e.subtreeFlags&6&&(e.flags|=8192)):Fl(e),null;case 24:return null;case 25:return null}throw Error(gn(156,e.tag))}function vWe(i,e){switch(une(e),e.tag){case 1:return hc(e.type)&&pL(),i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 3:return w_(),$s(uc),$s(Zl),_ne(),i=e.flags,i&65536&&!(i&128)?(e.flags=i&-65537|128,e):null;case 5:return vne(e),null;case 13:if($s(co),i=e.memoizedState,i!==null&&i.dehydrated!==null){if(e.alternate===null)throw Error(gn(340));b_()}return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 19:return $s(co),null;case 4:return w_(),null;case 10:return pne(e.type._context),null;case 22:case 23:return Pne(),null;case 24:return null;default:return null}}var FF=!1,Vl=!1,_We=typeof WeakSet=="function"?WeakSet:Set,qn=null;function N6(i,e){var t=i.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){Eo(i,e,n)}else t.current=null}function gee(i,e,t){try{t()}catch(n){Eo(i,e,n)}}var Mxe=!1;function xWe(i,e){if(JJ=uL,i=MMe(),lne(i)){if("selectionStart"in i)var t={start:i.selectionStart,end:i.selectionEnd};else e:{t=(t=i.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var r=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,c=-1,u=0,f=0,m=i,v=null;t:for(;;){for(var x;m!==t||r!==0&&m.nodeType!==3||(a=o+r),m!==s||n!==0&&m.nodeType!==3||(c=o+n),m.nodeType===3&&(o+=m.nodeValue.length),(x=m.firstChild)!==null;)v=m,m=x;for(;;){if(m===i)break t;if(v===t&&++u===r&&(a=o),v===s&&++f===n&&(c=o),(x=m.nextSibling)!==null)break;m=v,v=m.parentNode}m=x}t=a===-1||c===-1?null:{start:a,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(eee={focusedElem:i,selectionRange:t},uL=!1,qn=e;qn!==null;)if(e=qn,i=e.child,(e.subtreeFlags&1028)!==0&&i!==null)i.return=e,qn=i;else for(;qn!==null;){e=qn;try{var T=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(T!==null){var P=T.memoizedProps,R=T.memoizedState,M=e.stateNode,O=M.getSnapshotBeforeUpdate(e.elementType===e.type?P:od(e.type,P),R);M.__reactInternalSnapshotBeforeUpdate=O}break;case 3:var C=e.stateNode.containerInfo;C.nodeType===1?C.textContent="":C.nodeType===9&&C.documentElement&&C.removeChild(C.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(gn(163))}}catch(L){Eo(e,e.return,L)}if(i=e.sibling,i!==null){i.return=e.return,qn=i;break}qn=e.return}return T=Mxe,Mxe=!1,T}function CE(i,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do{if((r.tag&i)===i){var s=r.destroy;r.destroy=void 0,s!==void 0&&gee(e,t,s)}r=r.next}while(r!==n)}}function AU(i,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&i)===i){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function yee(i){var e=i.ref;if(e!==null){var t=i.stateNode;switch(i.tag){case 5:i=t;break;default:i=t}typeof e=="function"?e(i):e.current=i}}function wCe(i){var e=i.alternate;e!==null&&(i.alternate=null,wCe(e)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(e=i.stateNode,e!==null&&(delete e[Lf],delete e[nM],delete e[ree],delete e[nWe],delete e[rWe])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function TCe(i){return i.tag===5||i.tag===3||i.tag===4}function Cxe(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||TCe(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function vee(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(i,e):t.insertBefore(i,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(i,t)):(e=t,e.appendChild(i)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=fL));else if(n!==4&&(i=i.child,i!==null))for(vee(i,e,t),i=i.sibling;i!==null;)vee(i,e,t),i=i.sibling}function _ee(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.insertBefore(i,e):t.appendChild(i);else if(n!==4&&(i=i.child,i!==null))for(_ee(i,e,t),i=i.sibling;i!==null;)_ee(i,e,t),i=i.sibling}var pl=null,ld=!1;function Vg(i,e,t){for(t=t.child;t!==null;)ECe(i,e,t),t=t.sibling}function ECe(i,e,t){if(Gf&&typeof Gf.onCommitFiberUnmount=="function")try{Gf.onCommitFiberUnmount(xU,t)}catch{}switch(t.tag){case 5:Vl||N6(t,e);case 6:var n=pl,r=ld;pl=null,Vg(i,e,t),pl=n,ld=r,pl!==null&&(ld?(i=pl,t=t.stateNode,i.nodeType===8?i.parentNode.removeChild(t):i.removeChild(t)):pl.removeChild(t.stateNode));break;case 18:pl!==null&&(ld?(i=pl,t=t.stateNode,i.nodeType===8?SK(i.parentNode,t):i.nodeType===1&&SK(i,t),ZE(i)):SK(pl,t.stateNode));break;case 4:n=pl,r=ld,pl=t.stateNode.containerInfo,ld=!0,Vg(i,e,t),pl=n,ld=r;break;case 0:case 11:case 14:case 15:if(!Vl&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){r=n=n.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&gee(t,e,o),r=r.next}while(r!==n)}Vg(i,e,t);break;case 1:if(!Vl&&(N6(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(a){Eo(t,e,a)}Vg(i,e,t);break;case 21:Vg(i,e,t);break;case 22:t.mode&1?(Vl=(n=Vl)||t.memoizedState!==null,Vg(i,e,t),Vl=n):Vg(i,e,t);break;default:Vg(i,e,t)}}function Axe(i){var e=i.updateQueue;if(e!==null){i.updateQueue=null;var t=i.stateNode;t===null&&(t=i.stateNode=new _We),e.forEach(function(n){var r=RWe.bind(null,i,n);t.has(n)||(t.add(n),n.then(r,r))})}}function Wh(i,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var r=t[n];try{var s=i,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:pl=a.stateNode,ld=!1;break e;case 3:pl=a.stateNode.containerInfo,ld=!0;break e;case 4:pl=a.stateNode.containerInfo,ld=!0;break e}a=a.return}if(pl===null)throw Error(gn(160));ECe(s,o,r),pl=null,ld=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(u){Eo(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)MCe(e,i),e=e.sibling}function MCe(i,e){var t=i.alternate,n=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Wh(e,i),bf(i),n&4){try{CE(3,i,i.return),AU(3,i)}catch(P){Eo(i,i.return,P)}try{CE(5,i,i.return)}catch(P){Eo(i,i.return,P)}}break;case 1:Wh(e,i),bf(i),n&512&&t!==null&&N6(t,t.return);break;case 5:if(Wh(e,i),bf(i),n&512&&t!==null&&N6(t,t.return),i.flags&32){var r=i.stateNode;try{qE(r,"")}catch(P){Eo(i,i.return,P)}}if(n&4&&(r=i.stateNode,r!=null)){var s=i.memoizedProps,o=t!==null?t.memoizedProps:s,a=i.type,c=i.updateQueue;if(i.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&qEe(r,s),$J(a,o);var u=$J(a,s);for(o=0;o<c.length;o+=2){var f=c[o],m=c[o+1];f==="style"?QEe(r,m):f==="dangerouslySetInnerHTML"?KEe(r,m):f==="children"?qE(r,m):Yte(r,f,m,u)}switch(a){case"input":LJ(r,s);break;case"textarea":XEe(r,s);break;case"select":var v=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var x=s.value;x!=null?K6(r,!!s.multiple,x,!1):v!==!!s.multiple&&(s.defaultValue!=null?K6(r,!!s.multiple,s.defaultValue,!0):K6(r,!!s.multiple,s.multiple?[]:"",!1))}r[nM]=s}catch(P){Eo(i,i.return,P)}}break;case 6:if(Wh(e,i),bf(i),n&4){if(i.stateNode===null)throw Error(gn(162));r=i.stateNode,s=i.memoizedProps;try{r.nodeValue=s}catch(P){Eo(i,i.return,P)}}break;case 3:if(Wh(e,i),bf(i),n&4&&t!==null&&t.memoizedState.isDehydrated)try{ZE(e.containerInfo)}catch(P){Eo(i,i.return,P)}break;case 4:Wh(e,i),bf(i);break;case 13:Wh(e,i),bf(i),r=i.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(Ane=zo())),n&4&&Axe(i);break;case 22:if(f=t!==null&&t.memoizedState!==null,i.mode&1?(Vl=(u=Vl)||f,Wh(e,i),Vl=u):Wh(e,i),bf(i),n&8192){if(u=i.memoizedState!==null,(i.stateNode.isHidden=u)&&!f&&i.mode&1)for(qn=i,f=i.child;f!==null;){for(m=qn=f;qn!==null;){switch(v=qn,x=v.child,v.tag){case 0:case 11:case 14:case 15:CE(4,v,v.return);break;case 1:N6(v,v.return);var T=v.stateNode;if(typeof T.componentWillUnmount=="function"){n=v,t=v.return;try{e=n,T.props=e.memoizedProps,T.state=e.memoizedState,T.componentWillUnmount()}catch(P){Eo(n,t,P)}}break;case 5:N6(v,v.return);break;case 22:if(v.memoizedState!==null){Pxe(m);continue}}x!==null?(x.return=v,qn=x):Pxe(m)}f=f.sibling}e:for(f=null,m=i;;){if(m.tag===5){if(f===null){f=m;try{r=m.stateNode,u?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=m.stateNode,c=m.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=ZEe("display",o))}catch(P){Eo(i,i.return,P)}}}else if(m.tag===6){if(f===null)try{m.stateNode.nodeValue=u?"":m.memoizedProps}catch(P){Eo(i,i.return,P)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===i)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===i)break e;for(;m.sibling===null;){if(m.return===null||m.return===i)break e;f===m&&(f=null),m=m.return}f===m&&(f=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:Wh(e,i),bf(i),n&4&&Axe(i);break;case 21:break;default:Wh(e,i),bf(i)}}function bf(i){var e=i.flags;if(e&2){try{e:{for(var t=i.return;t!==null;){if(TCe(t)){var n=t;break e}t=t.return}throw Error(gn(160))}switch(n.tag){case 5:var r=n.stateNode;n.flags&32&&(qE(r,""),n.flags&=-33);var s=Cxe(i);_ee(i,s,r);break;case 3:case 4:var o=n.stateNode.containerInfo,a=Cxe(i);vee(i,a,o);break;default:throw Error(gn(161))}}catch(c){Eo(i,i.return,c)}i.flags&=-3}e&4096&&(i.flags&=-4097)}function bWe(i,e,t){qn=i,CCe(i)}function CCe(i,e,t){for(var n=(i.mode&1)!==0;qn!==null;){var r=qn,s=r.child;if(r.tag===22&&n){var o=r.memoizedState!==null||FF;if(!o){var a=r.alternate,c=a!==null&&a.memoizedState!==null||Vl;a=FF;var u=Vl;if(FF=o,(Vl=c)&&!u)for(qn=r;qn!==null;)o=qn,c=o.child,o.tag===22&&o.memoizedState!==null?Nxe(r):c!==null?(c.return=o,qn=c):Nxe(r);for(;s!==null;)qn=s,CCe(s),s=s.sibling;qn=r,FF=a,Vl=u}Rxe(i)}else r.subtreeFlags&8772&&s!==null?(s.return=r,qn=s):Rxe(i)}}function Rxe(i){for(;qn!==null;){var e=qn;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Vl||AU(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Vl)if(t===null)n.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:od(e.type,t.memoizedProps);n.componentDidUpdate(r,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&dxe(e,s,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}dxe(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var f=u.memoizedState;if(f!==null){var m=f.dehydrated;m!==null&&ZE(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(gn(163))}Vl||e.flags&512&&yee(e)}catch(v){Eo(e,e.return,v)}}if(e===i){qn=null;break}if(t=e.sibling,t!==null){t.return=e.return,qn=t;break}qn=e.return}}function Pxe(i){for(;qn!==null;){var e=qn;if(e===i){qn=null;break}var t=e.sibling;if(t!==null){t.return=e.return,qn=t;break}qn=e.return}}function Nxe(i){for(;qn!==null;){var e=qn;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{AU(4,e)}catch(c){Eo(e,t,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var r=e.return;try{n.componentDidMount()}catch(c){Eo(e,r,c)}}var s=e.return;try{yee(e)}catch(c){Eo(e,s,c)}break;case 5:var o=e.return;try{yee(e)}catch(c){Eo(e,o,c)}}}catch(c){Eo(e,e.return,c)}if(e===i){qn=null;break}var a=e.sibling;if(a!==null){a.return=e.return,qn=a;break}qn=e.return}}var SWe=Math.ceil,TL=tm.ReactCurrentDispatcher,Mne=tm.ReactCurrentOwner,Zu=tm.ReactCurrentBatchConfig,Ni=0,Ya=null,sa=null,yl=0,Hc=0,I6=J2(0),Ca=0,lM=null,h4=0,RU=0,Cne=0,AE=null,ic=null,Ane=0,E_=1/0,p1=null,EL=!1,xee=null,N2=null,OF=!1,T2=null,ML=0,RE=0,bee=null,kB=-1,DB=0;function I0(){return Ni&6?zo():kB!==-1?kB:kB=zo()}function I2(i){return i.mode&1?Ni&2&&yl!==0?yl&-yl:sWe.transition!==null?(DB===0&&(DB=uMe()),DB):(i=as,i!==0||(i=window.event,i=i===void 0?16:yMe(i.type)),i):1}function bd(i,e,t,n){if(50<RE)throw RE=0,bee=null,Error(gn(185));WM(i,t,n),(!(Ni&2)||i!==Ya)&&(i===Ya&&(!(Ni&2)&&(RU|=t),Ca===4&&y2(i,yl)),dc(i,n),t===1&&Ni===0&&!(e.mode&1)&&(E_=zo()+500,EU&&e3()))}function dc(i,e){var t=i.callbackNode;sje(i,e);var n=cL(i,i===Ya?yl:0);if(n===0)t!==null&&z_e(t),i.callbackNode=null,i.callbackPriority=0;else if(e=n&-n,i.callbackPriority!==e){if(t!=null&&z_e(t),e===1)i.tag===0?iWe(Ixe.bind(null,i)):OMe(Ixe.bind(null,i)),eWe(function(){!(Ni&6)&&e3()}),t=null;else{switch(hMe(n)){case 1:t=ene;break;case 4:t=lMe;break;case 16:t=lL;break;case 536870912:t=cMe;break;default:t=lL}t=FCe(t,ACe.bind(null,i))}i.callbackPriority=e,i.callbackNode=t}}function ACe(i,e){if(kB=-1,DB=0,Ni&6)throw Error(gn(327));var t=i.callbackNode;if(t_()&&i.callbackNode!==t)return null;var n=cL(i,i===Ya?yl:0);if(n===0)return null;if(n&30||n&i.expiredLanes||e)e=CL(i,n);else{e=n;var r=Ni;Ni|=2;var s=PCe();(Ya!==i||yl!==e)&&(p1=null,E_=zo()+500,Zy(i,e));do try{EWe();break}catch(a){RCe(i,a)}while(1);fne(),TL.current=s,Ni=r,sa!==null?e=0:(Ya=null,yl=0,e=Ca)}if(e!==0){if(e===2&&(r=XJ(i),r!==0&&(n=r,e=See(i,r))),e===1)throw t=lM,Zy(i,0),y2(i,n),dc(i,zo()),t;if(e===6)y2(i,n);else{if(r=i.current.alternate,!(n&30)&&!wWe(r)&&(e=CL(i,n),e===2&&(s=XJ(i),s!==0&&(n=s,e=See(i,s))),e===1))throw t=lM,Zy(i,0),y2(i,n),dc(i,zo()),t;switch(i.finishedWork=r,i.finishedLanes=n,e){case 0:case 1:throw Error(gn(345));case 2:by(i,ic,p1);break;case 3:if(y2(i,n),(n&130023424)===n&&(e=Ane+500-zo(),10<e)){if(cL(i,0)!==0)break;if(r=i.suspendedLanes,(r&n)!==n){I0(),i.pingedLanes|=i.suspendedLanes&r;break}i.timeoutHandle=nee(by.bind(null,i,ic,p1),e);break}by(i,ic,p1);break;case 4:if(y2(i,n),(n&4194240)===n)break;for(e=i.eventTimes,r=-1;0<n;){var o=31-xd(n);s=1<<o,o=e[o],o>r&&(r=o),n&=~s}if(n=r,n=zo()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*SWe(n/1960))-n,10<n){i.timeoutHandle=nee(by.bind(null,i,ic,p1),n);break}by(i,ic,p1);break;case 5:by(i,ic,p1);break;default:throw Error(gn(329))}}}return dc(i,zo()),i.callbackNode===t?ACe.bind(null,i):null}function See(i,e){var t=AE;return i.current.memoizedState.isDehydrated&&(Zy(i,e).flags|=256),i=CL(i,e),i!==2&&(e=ic,ic=t,e!==null&&wee(e)),i}function wee(i){ic===null?ic=i:ic.push.apply(ic,i)}function wWe(i){for(var e=i;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var r=t[n],s=r.getSnapshot;r=r.value;try{if(!wd(s(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function y2(i,e){for(e&=~Cne,e&=~RU,i.suspendedLanes|=e,i.pingedLanes&=~e,i=i.expirationTimes;0<e;){var t=31-xd(e),n=1<<t;i[t]=-1,e&=~n}}function Ixe(i){if(Ni&6)throw Error(gn(327));t_();var e=cL(i,0);if(!(e&1))return dc(i,zo()),null;var t=CL(i,e);if(i.tag!==0&&t===2){var n=XJ(i);n!==0&&(e=n,t=See(i,n))}if(t===1)throw t=lM,Zy(i,0),y2(i,e),dc(i,zo()),t;if(t===6)throw Error(gn(345));return i.finishedWork=i.current.alternate,i.finishedLanes=e,by(i,ic,p1),dc(i,zo()),null}function Rne(i,e){var t=Ni;Ni|=1;try{return i(e)}finally{Ni=t,Ni===0&&(E_=zo()+500,EU&&e3())}}function d4(i){T2!==null&&T2.tag===0&&!(Ni&6)&&t_();var e=Ni;Ni|=1;var t=Zu.transition,n=as;try{if(Zu.transition=null,as=1,i)return i()}finally{as=n,Zu.transition=t,Ni=e,!(Ni&6)&&e3()}}function Pne(){Hc=I6.current,$s(I6)}function Zy(i,e){i.finishedWork=null,i.finishedLanes=0;var t=i.timeoutHandle;if(t!==-1&&(i.timeoutHandle=-1,Jje(t)),sa!==null)for(t=sa.return;t!==null;){var n=t;switch(une(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&pL();break;case 3:w_(),$s(uc),$s(Zl),_ne();break;case 5:vne(n);break;case 4:w_();break;case 13:$s(co);break;case 19:$s(co);break;case 10:pne(n.type._context);break;case 22:case 23:Pne()}t=t.return}if(Ya=i,sa=i=k2(i.current,null),yl=Hc=e,Ca=0,lM=null,Cne=RU=h4=0,ic=AE=null,Hy!==null){for(e=0;e<Hy.length;e++)if(t=Hy[e],n=t.interleaved,n!==null){t.interleaved=null;var r=n.next,s=t.pending;if(s!==null){var o=s.next;s.next=r,n.next=o}t.pending=n}Hy=null}return i}function RCe(i,e){do{var t=sa;try{if(fne(),PB.current=wL,SL){for(var n=go.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}SL=!1}if(u4=0,Ha=Ta=go=null,ME=!1,sM=0,Mne.current=null,t===null||t.return===null){Ca=1,lM=e,sa=null;break}e:{var s=i,o=t.return,a=t,c=e;if(e=yl,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,f=a,m=f.tag;if(!(f.mode&1)&&(m===0||m===11||m===15)){var v=f.alternate;v?(f.updateQueue=v.updateQueue,f.memoizedState=v.memoizedState,f.lanes=v.lanes):(f.updateQueue=null,f.memoizedState=null)}var x=_xe(o);if(x!==null){x.flags&=-257,xxe(x,o,a,s,e),x.mode&1&&vxe(s,u,e),e=x,c=u;var T=e.updateQueue;if(T===null){var P=new Set;P.add(c),e.updateQueue=P}else T.add(c);break e}else{if(!(e&1)){vxe(s,u,e),Nne();break e}c=Error(gn(426))}}else if(Xs&&a.mode&1){var R=_xe(o);if(R!==null){!(R.flags&65536)&&(R.flags|=256),xxe(R,o,a,s,e),hne(T_(c,a));break e}}s=c=T_(c,a),Ca!==4&&(Ca=2),AE===null?AE=[s]:AE.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var M=dCe(s,c,e);hxe(s,M);break e;case 1:a=c;var O=s.type,C=s.stateNode;if(!(s.flags&128)&&(typeof O.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(N2===null||!N2.has(C)))){s.flags|=65536,e&=-e,s.lanes|=e;var L=fCe(s,a,e);hxe(s,L);break e}}s=s.return}while(s!==null)}ICe(t)}catch(Y){e=Y,sa===t&&t!==null&&(sa=t=t.return);continue}break}while(1)}function PCe(){var i=TL.current;return TL.current=wL,i===null?wL:i}function Nne(){(Ca===0||Ca===3||Ca===2)&&(Ca=4),Ya===null||!(h4&268435455)&&!(RU&268435455)||y2(Ya,yl)}function CL(i,e){var t=Ni;Ni|=2;var n=PCe();(Ya!==i||yl!==e)&&(p1=null,Zy(i,e));do try{TWe();break}catch(r){RCe(i,r)}while(1);if(fne(),Ni=t,TL.current=n,sa!==null)throw Error(gn(261));return Ya=null,yl=0,Ca}function TWe(){for(;sa!==null;)NCe(sa)}function EWe(){for(;sa!==null&&!KHe();)NCe(sa)}function NCe(i){var e=DCe(i.alternate,i,Hc);i.memoizedProps=i.pendingProps,e===null?ICe(i):sa=e,Mne.current=null}function ICe(i){var e=i;do{var t=e.alternate;if(i=e.return,e.flags&32768){if(t=vWe(t,e),t!==null){t.flags&=32767,sa=t;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Ca=6,sa=null;return}}else if(t=yWe(t,e,Hc),t!==null){sa=t;return}if(e=e.sibling,e!==null){sa=e;return}sa=e=i}while(e!==null);Ca===0&&(Ca=5)}function by(i,e,t){var n=as,r=Zu.transition;try{Zu.transition=null,as=1,MWe(i,e,t,n)}finally{Zu.transition=r,as=n}return null}function MWe(i,e,t,n){do t_();while(T2!==null);if(Ni&6)throw Error(gn(327));t=i.finishedWork;var r=i.finishedLanes;if(t===null)return null;if(i.finishedWork=null,i.finishedLanes=0,t===i.current)throw Error(gn(177));i.callbackNode=null,i.callbackPriority=0;var s=t.lanes|t.childLanes;if(oje(i,s),i===Ya&&(sa=Ya=null,yl=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||OF||(OF=!0,FCe(lL,function(){return t_(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Zu.transition,Zu.transition=null;var o=as;as=1;var a=Ni;Ni|=4,Mne.current=null,xWe(i,t),MCe(t,i),Wje(eee),uL=!!JJ,eee=JJ=null,i.current=t,bWe(t),ZHe(),Ni=a,as=o,Zu.transition=s}else i.current=t;if(OF&&(OF=!1,T2=i,ML=r),s=i.pendingLanes,s===0&&(N2=null),eje(t.stateNode),dc(i,zo()),e!==null)for(n=i.onRecoverableError,t=0;t<e.length;t++)r=e[t],n(r.value,{componentStack:r.stack,digest:r.digest});if(EL)throw EL=!1,i=xee,xee=null,i;return ML&1&&i.tag!==0&&t_(),s=i.pendingLanes,s&1?i===bee?RE++:(RE=0,bee=i):RE=0,e3(),null}function t_(){if(T2!==null){var i=hMe(ML),e=Zu.transition,t=as;try{if(Zu.transition=null,as=16>i?16:i,T2===null)var n=!1;else{if(i=T2,T2=null,ML=0,Ni&6)throw Error(gn(331));var r=Ni;for(Ni|=4,qn=i.current;qn!==null;){var s=qn,o=s.child;if(qn.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var u=a[c];for(qn=u;qn!==null;){var f=qn;switch(f.tag){case 0:case 11:case 15:CE(8,f,s)}var m=f.child;if(m!==null)m.return=f,qn=m;else for(;qn!==null;){f=qn;var v=f.sibling,x=f.return;if(wCe(f),f===u){qn=null;break}if(v!==null){v.return=x,qn=v;break}qn=x}}}var T=s.alternate;if(T!==null){var P=T.child;if(P!==null){T.child=null;do{var R=P.sibling;P.sibling=null,P=R}while(P!==null)}}qn=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,qn=o;else e:for(;qn!==null;){if(s=qn,s.flags&2048)switch(s.tag){case 0:case 11:case 15:CE(9,s,s.return)}var M=s.sibling;if(M!==null){M.return=s.return,qn=M;break e}qn=s.return}}var O=i.current;for(qn=O;qn!==null;){o=qn;var C=o.child;if(o.subtreeFlags&2064&&C!==null)C.return=o,qn=C;else e:for(o=O;qn!==null;){if(a=qn,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:AU(9,a)}}catch(Y){Eo(a,a.return,Y)}if(a===o){qn=null;break e}var L=a.sibling;if(L!==null){L.return=a.return,qn=L;break e}qn=a.return}}if(Ni=r,e3(),Gf&&typeof Gf.onPostCommitFiberRoot=="function")try{Gf.onPostCommitFiberRoot(xU,i)}catch{}n=!0}return n}finally{as=t,Zu.transition=e}}return!1}function kxe(i,e,t){e=T_(t,e),e=dCe(i,e,1),i=P2(i,e,1),e=I0(),i!==null&&(WM(i,1,e),dc(i,e))}function Eo(i,e,t){if(i.tag===3)kxe(i,i,t);else for(;e!==null;){if(e.tag===3){kxe(e,i,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(N2===null||!N2.has(n))){i=T_(t,i),i=fCe(e,i,1),e=P2(e,i,1),i=I0(),e!==null&&(WM(e,1,i),dc(e,i));break}}e=e.return}}function CWe(i,e,t){var n=i.pingCache;n!==null&&n.delete(e),e=I0(),i.pingedLanes|=i.suspendedLanes&t,Ya===i&&(yl&t)===t&&(Ca===4||Ca===3&&(yl&130023424)===yl&&500>zo()-Ane?Zy(i,0):Cne|=t),dc(i,e)}function kCe(i,e){e===0&&(i.mode&1?(e=MF,MF<<=1,!(MF&130023424)&&(MF=4194304)):e=1);var t=I0();i=$1(i,e),i!==null&&(WM(i,e,t),dc(i,t))}function AWe(i){var e=i.memoizedState,t=0;e!==null&&(t=e.retryLane),kCe(i,t)}function RWe(i,e){var t=0;switch(i.tag){case 13:var n=i.stateNode,r=i.memoizedState;r!==null&&(t=r.retryLane);break;case 19:n=i.stateNode;break;default:throw Error(gn(314))}n!==null&&n.delete(e),kCe(i,t)}var DCe;DCe=function(i,e,t){if(i!==null)if(i.memoizedProps!==e.pendingProps||uc.current)sc=!0;else{if(!(i.lanes&t)&&!(e.flags&128))return sc=!1,gWe(i,e,t);sc=!!(i.flags&131072)}else sc=!1,Xs&&e.flags&1048576&&BMe(e,yL,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;IB(i,e),i=e.pendingProps;var r=x_(e,Zl.current);e_(e,t),r=bne(null,e,n,i,r,t);var s=Sne();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,hc(n)?(s=!0,mL(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,gne(e),r.updater=MU,e.stateNode=r,r._reactInternals=e,cee(e,n,i,t),e=dee(null,e,n,!0,s,t)):(e.tag=0,Xs&&s&&cne(e),E0(null,e,r,t),e=e.child),e;case 16:n=e.elementType;e:{switch(IB(i,e),i=e.pendingProps,r=n._init,n=r(n._payload),e.type=n,r=e.tag=NWe(n),i=od(n,i),r){case 0:e=hee(null,e,n,i,t);break e;case 1:e=wxe(null,e,n,i,t);break e;case 11:e=bxe(null,e,n,i,t);break e;case 14:e=Sxe(null,e,n,od(n.type,i),t);break e}throw Error(gn(306,n,""))}return e;case 0:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:od(n,r),hee(i,e,n,r,t);case 1:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:od(n,r),wxe(i,e,n,r,t);case 3:e:{if(yCe(e),i===null)throw Error(gn(387));n=e.pendingProps,s=e.memoizedState,r=s.element,VMe(i,e),xL(e,n,null,t);var o=e.memoizedState;if(n=o.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=T_(Error(gn(423)),e),e=Txe(i,e,n,t,r);break e}else if(n!==r){r=T_(Error(gn(424)),e),e=Txe(i,e,n,t,r);break e}else for(Yc=R2(e.stateNode.containerInfo.firstChild),Kc=e,Xs=!0,cd=null,t=jMe(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(b_(),n===r){e=H1(i,e,t);break e}E0(i,e,n,t)}e=e.child}return e;case 5:return WMe(e),i===null&&oee(e),n=e.type,r=e.pendingProps,s=i!==null?i.memoizedProps:null,o=r.children,tee(n,r)?o=null:s!==null&&tee(n,s)&&(e.flags|=32),gCe(i,e),E0(i,e,o,t),e.child;case 6:return i===null&&oee(e),null;case 13:return vCe(i,e,t);case 4:return yne(e,e.stateNode.containerInfo),n=e.pendingProps,i===null?e.child=S_(e,null,n,t):E0(i,e,n,t),e.child;case 11:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:od(n,r),bxe(i,e,n,r,t);case 7:return E0(i,e,e.pendingProps,t),e.child;case 8:return E0(i,e,e.pendingProps.children,t),e.child;case 12:return E0(i,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,Is(vL,n._currentValue),n._currentValue=o,s!==null)if(wd(s.value,o)){if(s.children===r.children&&!uc.current){e=H1(i,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===n){if(s.tag===1){c=R1(-1,t&-t),c.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var f=u.pending;f===null?c.next=c:(c.next=f.next,f.next=c),u.pending=c}}s.lanes|=t,c=s.alternate,c!==null&&(c.lanes|=t),aee(s.return,t,e),a.lanes|=t;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(gn(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),aee(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}E0(i,e,r.children,t),e=e.child}return e;case 9:return r=e.type,n=e.pendingProps.children,e_(e,t),r=eh(r),n=n(r),e.flags|=1,E0(i,e,n,t),e.child;case 14:return n=e.type,r=od(n,e.pendingProps),r=od(n.type,r),Sxe(i,e,n,r,t);case 15:return pCe(i,e,e.type,e.pendingProps,t);case 17:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:od(n,r),IB(i,e),e.tag=1,hc(n)?(i=!0,mL(e)):i=!1,e_(e,t),$Me(e,n,r),cee(e,n,r,t),dee(null,e,n,!0,i,t);case 19:return _Ce(i,e,t);case 22:return mCe(i,e,t)}throw Error(gn(156,e.tag))};function FCe(i,e){return aMe(i,e)}function PWe(i,e,t,n){this.tag=i,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wu(i,e,t,n){return new PWe(i,e,t,n)}function Ine(i){return i=i.prototype,!(!i||!i.isReactComponent)}function NWe(i){if(typeof i=="function")return Ine(i)?1:0;if(i!=null){if(i=i.$$typeof,i===Zte)return 11;if(i===Qte)return 14}return 2}function k2(i,e){var t=i.alternate;return t===null?(t=Wu(i.tag,e,i.key,i.mode),t.elementType=i.elementType,t.type=i.type,t.stateNode=i.stateNode,t.alternate=i,i.alternate=t):(t.pendingProps=e,t.type=i.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=i.flags&14680064,t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,e=i.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=i.sibling,t.index=i.index,t.ref=i.ref,t}function FB(i,e,t,n,r,s){var o=2;if(n=i,typeof i=="function")Ine(i)&&(o=1);else if(typeof i=="string")o=5;else e:switch(i){case S6:return Qy(t.children,r,s,e);case Kte:o=8,r|=8;break;case kJ:return i=Wu(12,t,e,r|2),i.elementType=kJ,i.lanes=s,i;case DJ:return i=Wu(13,t,e,r),i.elementType=DJ,i.lanes=s,i;case FJ:return i=Wu(19,t,e,r),i.elementType=FJ,i.lanes=s,i;case HEe:return PU(t,r,s,e);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case GEe:o=10;break e;case $Ee:o=9;break e;case Zte:o=11;break e;case Qte:o=14;break e;case u2:o=16,n=null;break e}throw Error(gn(130,i==null?i:typeof i,""))}return e=Wu(o,t,e,r),e.elementType=i,e.type=n,e.lanes=s,e}function Qy(i,e,t,n){return i=Wu(7,i,n,e),i.lanes=t,i}function PU(i,e,t,n){return i=Wu(22,i,n,e),i.elementType=HEe,i.lanes=t,i.stateNode={isHidden:!1},i}function PK(i,e,t){return i=Wu(6,i,null,e),i.lanes=t,i}function NK(i,e,t){return e=Wu(4,i.children!==null?i.children:[],i.key,e),e.lanes=t,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}function IWe(i,e,t,n,r){this.tag=e,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=hK(0),this.expirationTimes=hK(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=hK(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function kne(i,e,t,n,r,s,o,a,c){return i=new IWe(i,e,t,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Wu(3,null,null,e),i.current=s,s.stateNode=i,s.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},gne(s),i}function kWe(i,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:b6,key:n==null?null:""+n,children:i,containerInfo:e,implementation:t}}function OCe(i){if(!i)return U2;i=i._reactInternals;e:{if(A4(i)!==i||i.tag!==1)throw Error(gn(170));var e=i;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(hc(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(gn(171))}if(i.tag===1){var t=i.type;if(hc(t))return FMe(i,t,e)}return e}function BCe(i,e,t,n,r,s,o,a,c){return i=kne(t,n,!0,i,r,s,o,a,c),i.context=OCe(null),t=i.current,n=I0(),r=I2(t),s=R1(n,r),s.callback=e??null,P2(t,s,r),i.current.lanes=r,WM(i,r,n),dc(i,n),i}function NU(i,e,t,n){var r=e.current,s=I0(),o=I2(r);return t=OCe(t),e.context===null?e.context=t:e.pendingContext=t,e=R1(s,o),e.payload={element:i},n=n===void 0?null:n,n!==null&&(e.callback=n),i=P2(r,e,o),i!==null&&(bd(i,r,o,s),RB(i,r,o)),o}function AL(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function Dxe(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var t=i.retryLane;i.retryLane=t!==0&&t<e?t:e}}function Dne(i,e){Dxe(i,e),(i=i.alternate)&&Dxe(i,e)}function DWe(){return null}var LCe=typeof reportError=="function"?reportError:function(i){console.error(i)};function Fne(i){this._internalRoot=i}IU.prototype.render=Fne.prototype.render=function(i){var e=this._internalRoot;if(e===null)throw Error(gn(409));NU(i,e,null,null)};IU.prototype.unmount=Fne.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var e=i.containerInfo;d4(function(){NU(null,i,null,null)}),e[G1]=null}};function IU(i){this._internalRoot=i}IU.prototype.unstable_scheduleHydration=function(i){if(i){var e=pMe();i={blockedOn:null,target:i,priority:e};for(var t=0;t<g2.length&&e!==0&&e<g2[t].priority;t++);g2.splice(t,0,i),t===0&&gMe(i)}};function One(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function kU(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function Fxe(){}function FWe(i,e,t,n,r){if(r){if(typeof n=="function"){var s=n;n=function(){var u=AL(o);s.call(u)}}var o=BCe(e,n,i,0,null,!1,!1,"",Fxe);return i._reactRootContainer=o,i[G1]=o.current,eM(i.nodeType===8?i.parentNode:i),d4(),o}for(;r=i.lastChild;)i.removeChild(r);if(typeof n=="function"){var a=n;n=function(){var u=AL(c);a.call(u)}}var c=kne(i,0,!1,null,null,!1,!1,"",Fxe);return i._reactRootContainer=c,i[G1]=c.current,eM(i.nodeType===8?i.parentNode:i),d4(function(){NU(e,c,t,n)}),c}function DU(i,e,t,n,r){var s=t._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var c=AL(o);a.call(c)}}NU(e,o,i,r)}else o=FWe(t,e,i,r,n);return AL(o)}dMe=function(i){switch(i.tag){case 3:var e=i.stateNode;if(e.current.memoizedState.isDehydrated){var t=eE(e.pendingLanes);t!==0&&(tne(e,t|1),dc(e,zo()),!(Ni&6)&&(E_=zo()+500,e3()))}break;case 13:d4(function(){var n=$1(i,1);if(n!==null){var r=I0();bd(n,i,1,r)}}),Dne(i,1)}};nne=function(i){if(i.tag===13){var e=$1(i,134217728);if(e!==null){var t=I0();bd(e,i,134217728,t)}Dne(i,134217728)}};fMe=function(i){if(i.tag===13){var e=I2(i),t=$1(i,e);if(t!==null){var n=I0();bd(t,i,e,n)}Dne(i,e)}};pMe=function(){return as};mMe=function(i,e){var t=as;try{return as=i,e()}finally{as=t}};jJ=function(i,e,t){switch(e){case"input":if(LJ(i,t),e=t.name,t.type==="radio"&&e!=null){for(t=i;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==i&&n.form===i.form){var r=TU(n);if(!r)throw Error(gn(90));WEe(n),LJ(n,r)}}}break;case"textarea":XEe(i,t);break;case"select":e=t.value,e!=null&&K6(i,!!t.multiple,e,!1)}};tMe=Rne;nMe=d4;var OWe={usingClientEntryPoint:!1,Events:[XM,M6,TU,JEe,eMe,Rne]},rT={findFiberByHostInstance:$y,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},BWe={bundleType:rT.bundleType,version:rT.version,rendererPackageName:rT.rendererPackageName,rendererConfig:rT.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:tm.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=sMe(i),i===null?null:i.stateNode},findFiberByHostInstance:rT.findFiberByHostInstance||DWe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var BF=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!BF.isDisabled&&BF.supportsFiber)try{xU=BF.inject(BWe),Gf=BF}catch{}}ru.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=OWe;ru.createPortal=function(i,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!One(e))throw Error(gn(200));return kWe(i,e,null,t)};ru.createRoot=function(i,e){if(!One(i))throw Error(gn(299));var t=!1,n="",r=LCe;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=kne(i,1,!1,null,null,t,!1,n,r),i[G1]=e.current,eM(i.nodeType===8?i.parentNode:i),new Fne(e)};ru.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(gn(188)):(i=Object.keys(i).join(","),Error(gn(268,i)));return i=sMe(e),i=i===null?null:i.stateNode,i};ru.flushSync=function(i){return d4(i)};ru.hydrate=function(i,e,t){if(!kU(e))throw Error(gn(200));return DU(null,i,e,!0,t)};ru.hydrateRoot=function(i,e,t){if(!One(i))throw Error(gn(405));var n=t!=null&&t.hydratedSources||null,r=!1,s="",o=LCe;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=BCe(e,null,i,1,t??null,r,!1,s,o),i[G1]=e.current,eM(i),n)for(i=0;i<n.length;i++)t=n[i],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new IU(e)};ru.render=function(i,e,t){if(!kU(e))throw Error(gn(200));return DU(null,i,e,!1,t)};ru.unmountComponentAtNode=function(i){if(!kU(i))throw Error(gn(40));return i._reactRootContainer?(d4(function(){DU(null,null,i,!1,function(){i._reactRootContainer=null,i[G1]=null})}),!0):!1};ru.unstable_batchedUpdates=Rne;ru.unstable_renderSubtreeIntoContainer=function(i,e,t,n){if(!kU(t))throw Error(gn(200));if(i==null||i._reactInternals===void 0)throw Error(gn(38));return DU(i,e,t,!1,n)};ru.version="18.2.0-next-9e3b772b8-20220608";function UCe(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(UCe)}catch(i){console.error(i)}}UCe(),BEe.exports=ru;var LWe=BEe.exports,Oxe=LWe;NJ.createRoot=Oxe.createRoot,NJ.hydrateRoot=Oxe.hydrateRoot;function LF(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var RL={exports:{}},Jt={};(function(i){var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(se,Se,Ge)=>Se in se?e(se,Se,{enumerable:!0,configurable:!0,writable:!0,value:Ge}):se[Se]=Ge,c=(se,Se)=>{for(var Ge in Se||(Se={}))s.call(Se,Ge)&&a(se,Ge,Se[Ge]);if(r)for(var Ge of r(Se))o.call(Se,Ge)&&a(se,Ge,Se[Ge]);return se},u=(se,Se)=>t(se,n(Se)),f=se=>e(se,"__esModule",{value:!0}),m=(se,Se)=>{f(se);for(var Ge in Se)e(se,Ge,{get:Se[Ge],enumerable:!0})};m(i,{Atom:()=>l5,PointerProxy:()=>Sm,Ticker:()=>h5,getPointerParts:()=>sp,isPointer:()=>hu,isPrism:()=>ap,iterateAndCountTicks:()=>S3,iterateOver:()=>d5,pointer:()=>y3,pointerToPrism:()=>bm,prism:()=>fu,val:()=>b3});var v=Array.isArray,x=v,T=typeof lo=="object"&&lo&&lo.Object===Object&&lo,P=T,R=typeof self=="object"&&self&&self.Object===Object&&self,M=P||R||Function("return this")(),O=M,C=O.Symbol,L=C,Y=Object.prototype,J=Y.hasOwnProperty,z=Y.toString,ne=L?L.toStringTag:void 0;function K(se){var Se=J.call(se,ne),Ge=se[ne];try{se[ne]=void 0;var Tt=!0}catch{}var vr=z.call(se);return Tt&&(Se?se[ne]=Ge:delete se[ne]),vr}var $=K,he=Object.prototype,Ce=he.toString;function Pe(se){return Ce.call(se)}var je=Pe,ge="[object Null]",Xe="[object Undefined]",Fe=L?L.toStringTag:void 0;function Ne(se){return se==null?se===void 0?Xe:ge:Fe&&Fe in Object(se)?$(se):je(se)}var tt=Ne;function mt(se){return se!=null&&typeof se=="object"}var Ht=mt,pn="[object Symbol]";function In(se){return typeof se=="symbol"||Ht(se)&&tt(se)==pn}var vt=In,Ut=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Sn=/^\w*$/;function ln(se,Se){if(x(se))return!1;var Ge=typeof se;return Ge=="number"||Ge=="symbol"||Ge=="boolean"||se==null||vt(se)?!0:Sn.test(se)||!Ut.test(se)||Se!=null&&se in Object(Se)}var Xn=ln;function Yr(se){var Se=typeof se;return se!=null&&(Se=="object"||Se=="function")}var lr=Yr,Kr="[object AsyncFunction]",wi="[object Function]",Zr="[object GeneratorFunction]",Ue="[object Proxy]";function vo(se){if(!lr(se))return!1;var Se=tt(se);return Se==wi||Se==Zr||Se==Kr||Se==Ue}var ui=vo,qr=O["__core-js_shared__"],Dn=qr,ni=function(){var se=/[^.]+$/.exec(Dn&&Dn.keys&&Dn.keys.IE_PROTO||"");return se?"Symbol(src)_1."+se:""}();function $n(se){return!!ni&&ni in se}var Sr=$n,Vi=Function.prototype,Me=Vi.toString;function fe(se){if(se!=null){try{return Me.call(se)}catch{}try{return se+""}catch{}}return""}var ft=fe,Ft=/[\\^$.*+?()[\]{}|]/g,$t=/^\[object .+?Constructor\]$/,kt=Function.prototype,Jn=Object.prototype,An=kt.toString,Hn=Jn.hasOwnProperty,Zn=RegExp("^"+An.call(Hn).replace(Ft,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Vt(se){if(!lr(se)||Sr(se))return!1;var Se=ui(se)?Zn:$t;return Se.test(ft(se))}var Ln=Vt;function fr(se,Se){return se==null?void 0:se[Se]}var ur=fr;function Mn(se,Se){var Ge=ur(se,Se);return Ln(Ge)?Ge:void 0}var cr=Mn,He=cr(Object,"create"),Cn=He;function Wt(){this.__data__=Cn?Cn(null):{},this.size=0}var Fn=Wt;function cn(se){var Se=this.has(se)&&delete this.__data__[se];return this.size-=Se?1:0,Se}var zt=cn,On="__lodash_hash_undefined__",pr=Object.prototype,Gi=pr.hasOwnProperty;function kr(se){var Se=this.__data__;if(Cn){var Ge=Se[se];return Ge===On?void 0:Ge}return Gi.call(Se,se)?Se[se]:void 0}var pa=kr,bl=Object.prototype,Ho=bl.hasOwnProperty;function ka(se){var Se=this.__data__;return Cn?Se[se]!==void 0:Ho.call(Se,se)}var V0=ka,Pd="__lodash_hash_undefined__";function Nd(se,Se){var Ge=this.__data__;return this.size+=this.has(se)?0:1,Ge[se]=Cn&&Se===void 0?Pd:Se,this}var Id=Nd;function Sl(se){var Se=-1,Ge=se==null?0:se.length;for(this.clear();++Se<Ge;){var Tt=se[Se];this.set(Tt[0],Tt[1])}}Sl.prototype.clear=Fn,Sl.prototype.delete=zt,Sl.prototype.get=pa,Sl.prototype.has=V0,Sl.prototype.set=Id;var np=Sl;function kd(){this.__data__=[],this.size=0}var rp=kd;function t0(se,Se){return se===Se||se!==se&&Se!==Se}var l3=t0;function ah(se,Se){for(var Ge=se.length;Ge--;)if(l3(se[Ge][0],Se))return Ge;return-1}var lh=ah,cm=Array.prototype,c3=cm.splice;function u3(se){var Se=this.__data__,Ge=lh(Se,se);if(Ge<0)return!1;var Tt=Se.length-1;return Ge==Tt?Se.pop():c3.call(Se,Ge,1),--this.size,!0}var ye=u3;function Qe(se){var Se=this.__data__,Ge=lh(Se,se);return Ge<0?void 0:Se[Ge][1]}var bt=Qe;function St(se){return lh(this.__data__,se)>-1}var rt=St;function un(se,Se){var Ge=this.__data__,Tt=lh(Ge,se);return Tt<0?(++this.size,Ge.push([se,Se])):Ge[Tt][1]=Se,this}var Rn=un;function Bn(se){var Se=-1,Ge=se==null?0:se.length;for(this.clear();++Se<Ge;){var Tt=se[Se];this.set(Tt[0],Tt[1])}}Bn.prototype.clear=rp,Bn.prototype.delete=ye,Bn.prototype.get=bt,Bn.prototype.has=rt,Bn.prototype.set=Rn;var Pn=Bn,hr=cr(O,"Map"),yr=hr;function er(){this.size=0,this.__data__={hash:new np,map:new(yr||Pn),string:new np}}var Ar=er;function oi(se){var Se=typeof se;return Se=="string"||Se=="number"||Se=="symbol"||Se=="boolean"?se!=="__proto__":se===null}var Yi=oi;function ls(se,Se){var Ge=se.__data__;return Yi(Se)?Ge[typeof Se=="string"?"string":"hash"]:Ge.map}var Br=ls;function tr(se){var Se=Br(this,se).delete(se);return this.size-=Se?1:0,Se}var Zs=tr;function Xr(se){return Br(this,se).get(se)}var jo=Xr;function ou(se){return Br(this,se).has(se)}var Wo=ou;function au(se,Se){var Ge=Br(this,se),Tt=Ge.size;return Ge.set(se,Se),this.size+=Ge.size==Tt?0:1,this}var $i=au;function Hs(se){var Se=-1,Ge=se==null?0:se.length;for(this.clear();++Se<Ge;){var Tt=se[Se];this.set(Tt[0],Tt[1])}}Hs.prototype.clear=Ar,Hs.prototype.delete=Zs,Hs.prototype.get=jo,Hs.prototype.has=Wo,Hs.prototype.set=$i;var Ro=Hs,_o="Expected a function";function Qs(se,Se){if(typeof se!="function"||Se!=null&&typeof Se!="function")throw new TypeError(_o);var Ge=function(){var Tt=arguments,vr=Se?Se.apply(this,Tt):Tt[0],yi=Ge.cache;if(yi.has(vr))return yi.get(vr);var ma=se.apply(this,Tt);return Ge.cache=yi.set(vr,ma)||yi,ma};return Ge.cache=new(Qs.Cache||Ro),Ge}Qs.Cache=Ro;var lu=Qs,Da=500;function um(se){var Se=lu(se,function(Tt){return Ge.size===Da&&Ge.clear(),Tt}),Ge=Se.cache;return Se}var h3=um,Dd=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Nx=/\\(\\)?/g,Ix=h3(function(se){var Se=[];return se.charCodeAt(0)===46&&Se.push(""),se.replace(Dd,function(Ge,Tt,vr,yi){Se.push(vr?yi.replace(Nx,"$1"):Tt||Ge)}),Se}),O4=Ix;function B4(se,Se){for(var Ge=-1,Tt=se==null?0:se.length,vr=Array(Tt);++Ge<Tt;)vr[Ge]=Se(se[Ge],Ge,se);return vr}var cu=B4,ip=1/0,L4=L?L.prototype:void 0,d3=L4?L4.toString:void 0;function f3(se){if(typeof se=="string")return se;if(x(se))return cu(se,f3)+"";if(vt(se))return d3?d3.call(se):"";var Se=se+"";return Se=="0"&&1/se==-ip?"-0":Se}var U4=f3;function z4(se){return se==null?"":U4(se)}var V4=z4;function G4(se,Se){return x(se)?se:Xn(se,Se)?[se]:O4(V4(se))}var $4=G4,ch=1/0;function hm(se){if(typeof se=="string"||vt(se))return se;var Se=se+"";return Se=="0"&&1/se==-ch?"-0":Se}var kx=hm;function dm(se,Se){Se=$4(Se,se);for(var Ge=0,Tt=Se.length;se!=null&&Ge<Tt;)se=se[kx(Se[Ge++])];return Ge&&Ge==Tt?se:void 0}var Dx=dm;function Fx(se,Se,Ge){var Tt=se==null?void 0:Dx(se,Se);return Tt===void 0?Ge:Tt}var uu=Fx;function uh(se,Se){return function(Ge){return se(Se(Ge))}}var H4=uh,fm=H4(Object.getPrototypeOf,Object),Ox=fm,Bx="[object Object]",j4=Function.prototype,Lx=Object.prototype,W4=j4.toString,p3=Lx.hasOwnProperty,q4=W4.call(Object);function X4(se){if(!Ht(se)||tt(se)!=Bx)return!1;var Se=Ox(se);if(Se===null)return!0;var Ge=p3.call(Se,"constructor")&&Se.constructor;return typeof Ge=="function"&&Ge instanceof Ge&&W4.call(Ge)==q4}var m3=X4;function Ux(se){var Se=se==null?0:se.length;return Se?se[Se-1]:void 0}var Y4=Ux,pm=new WeakMap,Fd=new WeakMap,g3=Symbol("pointerMeta"),K4={get(se,Se){if(Se===g3)return pm.get(se);let Ge=Fd.get(se);Ge||(Ge=new Map,Fd.set(se,Ge));const Tt=Ge.get(Se);if(Tt!==void 0)return Tt;const vr=pm.get(se),yi=op({root:vr.root,path:[...vr.path,Se]});return Ge.set(Se,yi),yi}},xc=se=>se[g3],sp=se=>{const{root:Se,path:Ge}=xc(se);return{root:Se,path:Ge}};function op(se){var Se;const Ge={root:se.root,path:(Se=se.path)!=null?Se:[]},Tt={};return pm.set(Tt,Ge),new Proxy(Tt,K4)}var y3=op,hu=se=>se&&!!xc(se);function Od(se,Se,Ge){return Se.length===0?Ge(se):hh(se,Se,Ge)}var hh=(se,Se,Ge)=>{if(Se.length===0)return Ge(se);if(Array.isArray(se)){let[Tt,...vr]=Se;Tt=parseInt(String(Tt),10),isNaN(Tt)&&(Tt=0);const yi=se[Tt],ma=hh(yi,vr,Ge);if(yi===ma)return se;const G0=[...se];return G0.splice(Tt,1,ma),G0}else if(typeof se=="object"&&se!==null){const[Tt,...vr]=Se,yi=se[Tt],ma=hh(yi,vr,Ge);return yi===ma?se:u(c({},se),{[Tt]:ma})}else{const[Tt,...vr]=Se;return{[Tt]:hh(void 0,vr,Ge)}}},xo=class{constructor(){this._head=void 0}peek(){return this._head&&this._head.data}pop(){const se=this._head;if(se)return this._head=se.next,se.data}push(se){const Se={next:this._head,data:se};this._head=Se}};function ap(se){return!!(se&&se.isPrism&&se.isPrism===!0)}function v3(){const se=()=>{},Se=new xo,Ge=se;return{type:"Dataverse_discoveryMechanism",startIgnoringDependencies:()=>{Se.push(Ge)},stopIgnoringDependencies:()=>{Se.peek()!==Ge||Se.pop()},reportResolutionStart:dh=>{const dp=Se.peek();dp&&dp(dh),Se.push(Ge)},reportResolutionEnd:dh=>{Se.pop()},pushCollector:dh=>{Se.push(dh)},popCollector:dh=>{if(Se.peek()!==dh)throw new Error("Popped collector is not on top of the stack");Se.pop()}}}function Z4(){const se="__dataverse_discoveryMechanism_sharedStack",Se=typeof window<"u"?window:typeof lo<"u"?lo:{};if(Se){const Ge=Se[se];if(Ge&&typeof Ge=="object"&&Ge.type==="Dataverse_discoveryMechanism")return Ge;{const Tt=v3();return Se[se]=Tt,Tt}}else return v3()}var{startIgnoringDependencies:du,stopIgnoringDependencies:lp,reportResolutionEnd:zx,reportResolutionStart:mm,pushCollector:cp,popCollector:Vx}=Z4(),_3=()=>{},Gx=class{constructor(se,Se){this._fn=se,this._prismInstance=Se,this._didMarkDependentsAsStale=!1,this._isFresh=!1,this._cacheOfDendencyValues=new Map,this._dependents=new Set,this._dependencies=new Set,this._possiblyStaleDeps=new Set,this._scope=new J4(this),this._lastValue=void 0,this._forciblySetToStale=!1,this._reactToDependencyGoingStale=Ge=>{this._possiblyStaleDeps.add(Ge),this._markAsStale()};for(const Ge of this._dependencies)Ge._addDependent(this._reactToDependencyGoingStale);du(),this.getValue(),lp()}get hasDependents(){return this._dependents.size>0}removeDependent(se){this._dependents.delete(se)}addDependent(se){this._dependents.add(se)}destroy(){for(const se of this._dependencies)se._removeDependent(this._reactToDependencyGoingStale);e5(this._scope)}getValue(){if(!this._isFresh){const se=this._recalculate();this._lastValue=se,this._isFresh=!0,this._didMarkDependentsAsStale=!1,this._forciblySetToStale=!1}return this._lastValue}_recalculate(){let se;if(!this._forciblySetToStale&&this._possiblyStaleDeps.size>0){let Tt=!1;du();for(const vr of this._possiblyStaleDeps)if(this._cacheOfDendencyValues.get(vr)!==vr.getValue()){Tt=!0;break}if(lp(),this._possiblyStaleDeps.clear(),!Tt)return this._lastValue}const Se=new Set;this._cacheOfDendencyValues.clear();const Ge=Tt=>{Se.add(Tt),this._addDependency(Tt)};cp(Ge),Po.push(this._scope);try{se=this._fn()}catch(Tt){console.error(Tt)}finally{Po.pop()!==this._scope&&console.warn("The Prism hook stack has slipped. This is a bug.")}Vx(Ge);for(const Tt of this._dependencies)Se.has(Tt)||this._removeDependency(Tt);this._dependencies=Se,du();for(const Tt of Se)this._cacheOfDendencyValues.set(Tt,Tt.getValue());return lp(),se}forceStale(){this._forciblySetToStale=!0,this._markAsStale()}_markAsStale(){if(!this._didMarkDependentsAsStale){this._didMarkDependentsAsStale=!0,this._isFresh=!1;for(const se of this._dependents)se(this._prismInstance)}}_addDependency(se){this._dependencies.has(se)||(this._dependencies.add(se),se._addDependent(this._reactToDependencyGoingStale))}_removeDependency(se){this._dependencies.has(se)&&(this._dependencies.delete(se),se._removeDependent(this._reactToDependencyGoingStale))}},x3={},Q4=class{constructor(se){this._fn=se,this.isPrism=!0,this._state={hot:!1,handle:void 0}}get isHot(){return this._state.hot}onChange(se,Se,Ge=!1){const Tt=()=>{se.onThisOrNextTick(yi)};let vr=x3;const yi=()=>{const G0=this.getValue();G0!==vr&&(vr=G0,Se(G0))};return this._addDependent(Tt),Ge&&(vr=this.getValue(),Se(vr)),()=>{this._removeDependent(Tt),se.offThisOrNextTick(yi),se.offNextTick(yi)}}onStale(se){const Se=()=>{this._removeDependent(Ge)},Ge=()=>se();return this._addDependent(Ge),Se}keepHot(){return this.onStale(()=>{})}_addDependent(se){this._state.hot||this._goHot(),this._state.handle.addDependent(se)}_goHot(){const se=new Gx(this._fn,this);this._state={hot:!0,handle:se}}_removeDependent(se){const Se=this._state;if(!Se.hot)return;const Ge=Se.handle;Ge.removeDependent(se),Ge.hasDependents||(this._state={hot:!1,handle:void 0},Ge.destroy())}getValue(){mm(this);const se=this._state;let Se;return se.hot?Se=se.handle.getValue():Se=bc(this._fn),zx(this),Se}},J4=class{constructor(se){this._hotHandle=se,this._refs=new Map,this.isPrismScope=!0,this.subs={},this.effects=new Map,this.memos=new Map}ref(se,Se){let Ge=this._refs.get(se);if(Ge!==void 0)return Ge;{const Tt={current:Se};return this._refs.set(se,Tt),Tt}}effect(se,Se,Ge){let Tt=this.effects.get(se);Tt===void 0&&(Tt={cleanup:_3,deps:void 0},this.effects.set(se,Tt)),t5(Tt.deps,Ge)&&(Tt.cleanup(),du(),Tt.cleanup=Bd(Se,_3).value,lp(),Tt.deps=Ge)}memo(se,Se,Ge){let Tt=this.memos.get(se);return Tt===void 0&&(Tt={cachedValue:null,deps:void 0},this.memos.set(se,Tt)),t5(Tt.deps,Ge)&&(du(),Tt.cachedValue=Bd(Se,void 0).value,lp(),Tt.deps=Ge),Tt.cachedValue}state(se,Se){const{value:Ge,setValue:Tt}=this.memo("state/"+se,()=>{const vr={current:Se};return{value:vr,setValue:ma=>{vr.current=ma,this._hotHandle.forceStale()}}},[]);return[Ge.current,Tt]}sub(se){return this.subs[se]||(this.subs[se]=new J4(this._hotHandle)),this.subs[se]}cleanupEffects(){for(const se of this.effects.values())Bd(se.cleanup,void 0);this.effects.clear()}source(se,Se){const Ge="$$source/blah";return this.effect(Ge,()=>se(()=>{this._hotHandle.forceStale()}),[se]),Se()}};function e5(se){for(const Se of Object.values(se.subs))e5(Se);se.cleanupEffects()}function Bd(se,Se){try{return{value:se(),ok:!0}}catch(Ge){return setTimeout(function(){throw Ge}),{value:Se,ok:!1}}}var Po=new xo;function $x(se,Se){const Ge=Po.peek();if(!Ge)throw new Error("prism.ref() is called outside of a prism() call.");return Ge.ref(se,Se)}function gm(se,Se,Ge){const Tt=Po.peek();if(!Tt)throw new Error("prism.effect() is called outside of a prism() call.");return Tt.effect(se,Se,Ge)}function t5(se,Se){if(se===void 0||Se===void 0)return!0;const Ge=se.length;if(Ge!==Se.length)return!0;for(let Tt=0;Tt<Ge;Tt++)if(se[Tt]!==Se[Tt])return!0;return!1}function n5(se,Se,Ge){const Tt=Po.peek();if(!Tt)throw new Error("prism.memo() is called outside of a prism() call.");return Tt.memo(se,Se,Ge)}function Fa(se,Se){const Ge=Po.peek();if(!Ge)throw new Error("prism.state() is called outside of a prism() call.");return Ge.state(se,Se)}function r5(){if(!Po.peek())throw new Error("The parent function is called outside of a prism() call.")}function up(se,Se){const Ge=Po.peek();if(!Ge)throw new Error("prism.scope() is called outside of a prism() call.");const Tt=Ge.sub(se);Po.push(Tt);const vr=Bd(Se,void 0).value;return Po.pop(),vr}function ym(se,Se,Ge){return n5(se,()=>Js(Se),Ge).getValue()}function i5(){return!!Po.peek()}function vm(se,Se){const Ge=Po.peek();if(!Ge)throw new Error("prism.source() is called outside of a prism() call.");return Ge.source(se,Se)}var Js=se=>new Q4(se),hp=class{effect(se,Se,Ge){console.warn("prism.effect() does not run in cold prisms")}memo(se,Se,Ge){return Se()}state(se,Se){return[Se,()=>{}]}ref(se,Se){return{current:Se}}sub(se){return new hp}source(se,Se){return Se()}};function bc(se){const Se=new hp;Po.push(Se);let Ge;try{Ge=se()}catch(Tt){console.error(Tt)}finally{Po.pop()!==Se&&console.warn("The Prism hook stack has slipped. This is a bug.")}return Ge}Js.ref=$x,Js.effect=gm,Js.memo=n5,Js.ensurePrism=r5,Js.state=Fa,Js.scope=up,Js.sub=ym,Js.inPrism=i5,Js.source=vm;var fu=Js,s5;(function(se){se[se.Dict=0]="Dict",se[se.Array=1]="Array",se[se.Other=2]="Other"})(s5||(s5={}));var Ii=se=>Array.isArray(se)?1:m3(se)?0:2,_m=(se,Se,Ge=Ii(se))=>Ge===0&&typeof Se=="string"||Ge===1&&o5(Se)?se[Se]:void 0,o5=se=>{const Se=typeof se=="number"?se:parseInt(se,10);return!isNaN(Se)&&Se>=0&&Se<1/0&&(Se|0)===Se},a5=class{constructor(se,Se){this._parent=se,this._path=Se,this.children=new Map,this.identityChangeListeners=new Set}addIdentityChangeListener(se){this.identityChangeListeners.add(se)}removeIdentityChangeListener(se){this.identityChangeListeners.delete(se),this._checkForGC()}removeChild(se){this.children.delete(se),this._checkForGC()}getChild(se){return this.children.get(se)}getOrCreateChild(se){let Se=this.children.get(se);return Se||(Se=Se=new a5(this,this._path.concat([se])),this.children.set(se,Se)),Se}_checkForGC(){this.identityChangeListeners.size>0||this.children.size>0||this._parent&&this._parent.removeChild(Y4(this._path))}},l5=class{constructor(se){this.$$isPointerToPrismProvider=!0,this.pointer=y3({root:this,path:[]}),this.prism=this.pointerToPrism(this.pointer),this._onPointerValueChange=(Se,Ge)=>{const{path:Tt}=sp(Se),vr=this._getOrCreateScopeForPath(Tt);return vr.identityChangeListeners.add(Ge),()=>{vr.identityChangeListeners.delete(Ge)}},this._currentState=se,this._rootScope=new a5(void 0,[])}set(se){const Se=this._currentState;this._currentState=se,this._checkUpdates(this._rootScope,Se,se)}get(){return this._currentState}getByPointer(se){const Se=hu(se)?se:se(this.pointer),Ge=sp(Se).path;return this._getIn(Ge)}_getIn(se){return se.length===0?this.get():uu(this.get(),se)}reduce(se){this.set(se(this.get()))}reduceByPointer(se,Se){const Ge=hu(se)?se:se(this.pointer),Tt=sp(Ge).path,vr=Od(this.get(),Tt,Se);this.set(vr)}setByPointer(se,Se){this.reduceByPointer(se,()=>Se)}_checkUpdates(se,Se,Ge){if(Se===Ge)return;for(const yi of se.identityChangeListeners)yi(Ge);if(se.children.size===0)return;const Tt=Ii(Se),vr=Ii(Ge);if(!(Tt===2&&Tt===vr))for(const[yi,ma]of se.children){const G0=_m(Se,yi,Tt),w3=_m(Ge,yi,vr);this._checkUpdates(ma,G0,w3)}}_getOrCreateScopeForPath(se){let Se=this._rootScope;for(const Ge of se)Se=Se.getOrCreateChild(Ge);return Se}pointerToPrism(se){const{path:Se}=sp(se),Ge=vr=>this._onPointerValueChange(se,vr),Tt=()=>this._getIn(Se);return fu(()=>fu.source(Ge,Tt))}},xm=new WeakMap;function c5(se){return typeof se=="object"&&se!==null&&se.$$isPointerToPrismProvider===!0}var bm=se=>{const Se=xc(se);let Ge=xm.get(Se);if(!Ge){const Tt=Se.root;if(!c5(Tt))throw new Error("Cannot run pointerToPrism() on a pointer whose root is not an PointerToPrismProvider");Ge=Tt.pointerToPrism(se),xm.set(Se,Ge)}return Ge},b3=se=>hu(se)?bm(se).getValue():ap(se)?se.getValue():se;function*S3(se){let Se;if(hu(se))Se=bm(se);else if(ap(se))Se=se;else throw new Error("Only pointers and prisms are supported");let Ge=0;const Tt=Se.onStale(()=>{Ge++});try{for(;;){const vr=Ge;Ge=0,yield{value:Se.getValue(),ticks:vr}}}finally{Tt()}}var u5=60*3,h5=class{constructor(se){this._conf=se,this._ticking=!1,this._dormant=!0,this._numberOfDormantTicks=0,this.__ticks=0,this._scheduledForThisOrNextTick=new Set,this._scheduledForNextTick=new Set,this._timeAtCurrentTick=0}get dormant(){return this._dormant}onThisOrNextTick(se){this._scheduledForThisOrNextTick.add(se),this._dormant&&this._goActive()}onNextTick(se){this._scheduledForNextTick.add(se),this._dormant&&this._goActive()}offThisOrNextTick(se){this._scheduledForThisOrNextTick.delete(se)}offNextTick(se){this._scheduledForNextTick.delete(se)}get time(){return this._ticking?this._timeAtCurrentTick:performance.now()}_goActive(){var se,Se;this._dormant&&(this._dormant=!1,(Se=(se=this._conf)==null?void 0:se.onActive)==null||Se.call(se))}_goDormant(){var se,Se;this._dormant||(this._dormant=!0,this._numberOfDormantTicks=0,(Se=(se=this._conf)==null?void 0:se.onDormant)==null||Se.call(se))}tick(se=performance.now()){if(this.__ticks++,!this._dormant&&this._scheduledForNextTick.size===0&&this._scheduledForThisOrNextTick.size===0&&(this._numberOfDormantTicks++,this._numberOfDormantTicks>=u5)){this._goDormant();return}this._ticking=!0,this._timeAtCurrentTick=se;for(const Se of this._scheduledForNextTick)this._scheduledForThisOrNextTick.add(Se);this._scheduledForNextTick.clear(),this._tick(0),this._ticking=!1}_tick(se){const Se=this.time;if(se>10&&console.warn("_tick() recursing for 10 times"),se>100)throw new Error("Maximum recursion limit for _tick()");const Ge=this._scheduledForThisOrNextTick;this._scheduledForThisOrNextTick=new Set;for(const Tt of Ge)Tt(Se);if(this._scheduledForThisOrNextTick.size>0)return this._tick(se+1)}};function*d5(se){let Se;if(hu(se))Se=bm(se);else if(ap(se))Se=se;else throw new Error("Only pointers and prisms are supported");const Ge=new h5,Tt=Se.onChange(Ge,vr=>{});try{for(;;)Ge.tick(),yield Se.getValue()}finally{Tt()}}var Sm=class{constructor(se){this.$$isPointerToPrismProvider=!0,this._currentPointerBox=new l5(se),this.pointer=y3({root:this,path:[]})}setPointer(se){this._currentPointerBox.set(se)}pointerToPrism(se){const{path:Se}=xc(se);return fu(()=>{const Ge=this._currentPointerBox.prism.getValue(),Tt=Se.reduce((vr,yi)=>vr[yi],Ge);return b3(Tt)})}}})(Jt);RL.exports;(function(i,e){var t=Object.create,n=Object.freeze,r=Object.defineProperty,s=Object.defineProperties,o=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyDescriptors,c=Object.getOwnPropertyNames,u=Object.getOwnPropertySymbols,f=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,x=(l,h)=>{if(h=Symbol[l])return h;throw Error("Symbol."+l+" is not defined")},T=Math.pow,P=(l,h,d)=>h in l?r(l,h,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[h]=d,R=(l,h)=>{for(var d in h||(h={}))m.call(h,d)&&P(l,d,h[d]);if(u)for(var d of u(h))v.call(h,d)&&P(l,d,h[d]);return l},M=(l,h)=>s(l,a(h)),O=(l,h)=>{var d={};for(var g in l)m.call(l,g)&&h.indexOf(g)<0&&(d[g]=l[g]);if(l!=null&&u)for(var g of u(l))h.indexOf(g)<0&&v.call(l,g)&&(d[g]=l[g]);return d},C=(l,h)=>()=>(l&&(h=l(l=0)),h),L=(l,h)=>()=>(h||l((h={exports:{}}).exports,h),h.exports),Y=(l,h)=>{for(var d in h)r(l,d,{get:h[d],enumerable:!0})},J=(l,h,d,g)=>{if(h&&typeof h=="object"||typeof h=="function")for(let _ of c(h))!m.call(l,_)&&_!==d&&r(l,_,{get:()=>h[_],enumerable:!(g=o(h,_))||g.enumerable});return l},z=(l,h,d)=>(d=l!=null?t(f(l)):{},J(h||!l||!l.__esModule?r(d,"default",{value:l,enumerable:!0}):d,l)),ne=l=>J(r({},"__esModule",{value:!0}),l),K=(l,h,d)=>(P(l,typeof h!="symbol"?h+"":h,d),d),$=(l,h)=>n(r(l,"raw",{value:n(h||l.slice())})),he=(l,h,d)=>new Promise((g,_)=>{var b=N=>{try{E(d.next(N))}catch(I){_(I)}},S=N=>{try{E(d.throw(N))}catch(I){_(I)}},E=N=>N.done?g(N.value):Promise.resolve(N.value).then(b,S);E((d=d.apply(l,h)).next())}),Ce=function(l,h){this[0]=l,this[1]=h},Pe=l=>{var h=l[x("asyncIterator")],d=!1,g,_={};return h==null?(h=l[x("iterator")](),g=b=>_[b]=S=>h[b](S)):(h=h.call(l),g=b=>_[b]=S=>{if(d){if(d=!1,b==="throw")throw S;return S}return d=!0,{done:!1,value:new Ce(new Promise(E=>{var N=h[b](S);if(!(N instanceof Object))throw TypeError("Object expected");E(N)}),1)}}),_[x("iterator")]=()=>_,g("next"),"throw"in h?g("throw"):_.throw=b=>{throw b},"return"in h&&g("return"),_};function je(l){Xe=l}function ge(){return Xe}var Xe,Fe=C(()=>{});function Ne(l,h,d=[]){if(typeof l=="object"&&l){if(tt(l)||mt(l)){h(l,d);return}for(let[g,_]of Object.entries(l))Ne(_,h,[...d,g])}else{if(l==null)return;h(l,d)}}var tt,mt,Ht=C(()=>{tt=l=>typeof l=="object"&&l!==null&&Object.hasOwnProperty.call(l,"type")&&l.type==="image"&&Object.hasOwnProperty.call(l,"id")&&typeof l.id=="string"&&l.id!=="",mt=l=>typeof l=="object"&&l!==null&&Object.hasOwnProperty.call(l,"r")&&Object.hasOwnProperty.call(l,"g")&&Object.hasOwnProperty.call(l,"b")&&Object.hasOwnProperty.call(l,"a")&&typeof l.r=="number"&&typeof l.g=="number"&&typeof l.b=="number"&&typeof l.a=="number"});function pn(l){return h=>typeof h=="object"&&!!h&&h.type===l}var In,vt,Ut,Sn,ln,Xn,Yr,lr,Kr=C(()=>{In=pn("Theatre_Project"),vt=pn("Theatre_Sheet"),Ut=pn("Theatre_SheetTemplate"),Sn=pn("Theatre_SheetObject"),ln=pn("Theatre_Sequence"),Xn=pn("Theatre_SheetObjectTemplate"),Yr=pn("Theatre_Sheet_PublicAPI"),lr=pn("Theatre_SheetObject_PublicAPI")}),wi,Zr,Ue=C(()=>{wi=typeof lo=="object"&&lo&&lo.Object===Object&&lo,Zr=wi}),vo,ui,qr,Dn=C(()=>{Ue(),vo=typeof self=="object"&&self&&self.Object===Object&&self,ui=Zr||vo||Function("return this")(),qr=ui}),ni,$n,Sr=C(()=>{Dn(),ni=qr.Symbol,$n=ni});function Vi(l){var h=fe.call(l,Ft),d=l[Ft];try{l[Ft]=void 0;var g=!0}catch{}var _=ft.call(l);return g&&(h?l[Ft]=d:delete l[Ft]),_}var Me,fe,ft,Ft,$t,kt=C(()=>{Sr(),Me=Object.prototype,fe=Me.hasOwnProperty,ft=Me.toString,Ft=$n?$n.toStringTag:void 0,$t=Vi});function Jn(l){return Hn.call(l)}var An,Hn,Zn,Vt=C(()=>{An=Object.prototype,Hn=An.toString,Zn=Jn});function Ln(l){return l==null?l===void 0?ur:fr:Mn&&Mn in Object(l)?$t(l):Zn(l)}var fr,ur,Mn,cr,He=C(()=>{Sr(),kt(),Vt(),fr="[object Null]",ur="[object Undefined]",Mn=$n?$n.toStringTag:void 0,cr=Ln});function Cn(l){return l!=null&&typeof l=="object"}var Wt,Fn=C(()=>{Wt=Cn});function cn(l){return typeof l=="symbol"||Wt(l)&&cr(l)==zt}var zt,On,pr=C(()=>{He(),Fn(),zt="[object Symbol]",On=cn});function Gi(l,h){for(var d=-1,g=l==null?0:l.length,_=Array(g);++d<g;)_[d]=h(l[d],d,l);return _}var kr,pa=C(()=>{kr=Gi}),bl,Ho,ka=C(()=>{bl=Array.isArray,Ho=bl});function V0(l){if(typeof l=="string")return l;if(Ho(l))return kr(l,V0)+"";if(On(l))return Id?Id.call(l):"";var h=l+"";return h=="0"&&1/l==-Pd?"-0":h}var Pd,Nd,Id,Sl,np=C(()=>{Sr(),pa(),ka(),pr(),Pd=1/0,Nd=$n?$n.prototype:void 0,Id=Nd?Nd.toString:void 0,Sl=V0});function kd(l){for(var h=l.length;h--&&rp.test(l.charAt(h)););return h}var rp,t0,l3=C(()=>{rp=/\s/,t0=kd});function ah(l){return l&&l.slice(0,t0(l)+1).replace(lh,"")}var lh,cm,c3=C(()=>{l3(),lh=/^\s+/,cm=ah});function u3(l){var h=typeof l;return l!=null&&(h=="object"||h=="function")}var ye,Qe=C(()=>{ye=u3});function bt(l){if(typeof l=="number")return l;if(On(l))return St;if(ye(l)){var h=typeof l.valueOf=="function"?l.valueOf():l;l=ye(h)?h+"":h}if(typeof l!="string")return l===0?l:+l;l=cm(l);var d=un.test(l);return d||Rn.test(l)?Bn(l.slice(2),d?2:8):rt.test(l)?St:+l}var St,rt,un,Rn,Bn,Pn,hr=C(()=>{c3(),Qe(),pr(),St=0/0,rt=/^[-+]0x[0-9a-f]+$/i,un=/^0b[01]+$/i,Rn=/^0o[0-7]+$/i,Bn=parseInt,Pn=bt});function yr(l){if(!l)return l===0?l:0;if(l=Pn(l),l===er||l===-er){var h=l<0?-1:1;return h*Ar}return l===l?l:0}var er,Ar,oi,Yi=C(()=>{hr(),er=1/0,Ar=17976931348623157e292,oi=yr});function ls(l){var h=oi(l),d=h%1;return h===h?d?h-d:h:0}var Br,tr=C(()=>{Yi(),Br=ls});function Zs(l){return l}var Xr,jo=C(()=>{Xr=Zs});function ou(l){if(!ye(l))return!1;var h=cr(l);return h==au||h==$i||h==Wo||h==Hs}var Wo,au,$i,Hs,Ro,_o=C(()=>{He(),Qe(),Wo="[object AsyncFunction]",au="[object Function]",$i="[object GeneratorFunction]",Hs="[object Proxy]",Ro=ou}),Qs,lu,Da=C(()=>{Dn(),Qs=qr["__core-js_shared__"],lu=Qs});function um(l){return!!h3&&h3 in l}var h3,Dd,Nx=C(()=>{Da(),h3=function(){var l=/[^.]+$/.exec(lu&&lu.keys&&lu.keys.IE_PROTO||"");return l?"Symbol(src)_1."+l:""}(),Dd=um});function Ix(l){if(l!=null){try{return B4.call(l)}catch{}try{return l+""}catch{}}return""}var O4,B4,cu,ip=C(()=>{O4=Function.prototype,B4=O4.toString,cu=Ix});function L4(l){if(!ye(l)||Dd(l))return!1;var h=Ro(l)?$4:f3;return h.test(cu(l))}var d3,f3,U4,z4,V4,G4,$4,ch,hm=C(()=>{_o(),Nx(),Qe(),ip(),d3=/[\\^$.*+?()[\]{}|]/g,f3=/^\[object .+?Constructor\]$/,U4=Function.prototype,z4=Object.prototype,V4=U4.toString,G4=z4.hasOwnProperty,$4=RegExp("^"+V4.call(G4).replace(d3,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ch=L4});function kx(l,h){return l==null?void 0:l[h]}var dm,Dx=C(()=>{dm=kx});function Fx(l,h){var d=dm(l,h);return ch(d)?d:void 0}var uu,uh=C(()=>{hm(),Dx(),uu=Fx}),H4,fm,Ox=C(()=>{uh(),Dn(),H4=uu(qr,"WeakMap"),fm=H4});function Bx(l,h,d){switch(d.length){case 0:return l.call(h);case 1:return l.call(h,d[0]);case 2:return l.call(h,d[0],d[1]);case 3:return l.call(h,d[0],d[1],d[2])}return l.apply(h,d)}var j4,Lx=C(()=>{j4=Bx});function W4(){}var p3,q4=C(()=>{p3=W4});function X4(l,h){var d=-1,g=l.length;for(h||(h=Array(g));++d<g;)h[d]=l[d];return h}var m3,Ux=C(()=>{m3=X4});function Y4(l){var h=0,d=0;return function(){var g=g3(),_=Fd-(g-d);if(d=g,_>0){if(++h>=pm)return arguments[0]}else h=0;return l.apply(void 0,arguments)}}var pm,Fd,g3,K4,xc=C(()=>{pm=800,Fd=16,g3=Date.now,K4=Y4});function sp(l){return function(){return l}}var op,y3=C(()=>{op=sp}),hu,Od,hh=C(()=>{uh(),hu=function(){try{var l=uu(Object,"defineProperty");return l({},"",{}),l}catch{}}(),Od=hu}),xo,ap,v3=C(()=>{y3(),hh(),jo(),xo=Od?function(l,h){return Od(l,"toString",{configurable:!0,enumerable:!1,value:op(h),writable:!0})}:Xr,ap=xo}),Z4,du,lp=C(()=>{v3(),xc(),Z4=K4(ap),du=Z4});function zx(l,h,d,g){for(var _=l.length,b=d+(g?1:-1);g?b--:++b<_;)if(h(l[b],b,l))return b;return-1}var mm,cp=C(()=>{mm=zx});function Vx(l){return l!==l}var _3,Gx=C(()=>{_3=Vx});function x3(l,h,d){for(var g=d-1,_=l.length;++g<_;)if(l[g]===h)return g;return-1}var Q4,J4=C(()=>{Q4=x3});function e5(l,h,d){return h===h?Q4(l,h,d):mm(l,_3,d)}var Bd,Po=C(()=>{cp(),Gx(),J4(),Bd=e5});function $x(l,h){var d=l==null?0:l.length;return!!d&&Bd(l,h,0)>-1}var gm,t5=C(()=>{Po(),gm=$x});function n5(l,h){var d=typeof l;return h=h??Fa,!!h&&(d=="number"||d!="symbol"&&r5.test(l))&&l>-1&&l%1==0&&l<h}var Fa,r5,up,ym=C(()=>{Fa=9007199254740991,r5=/^(?:0|[1-9]\d*)$/,up=n5});function i5(l,h,d){h=="__proto__"&&Od?Od(l,h,{configurable:!0,enumerable:!0,value:d,writable:!0}):l[h]=d}var vm,Js=C(()=>{hh(),vm=i5});function hp(l,h){return l===h||l!==l&&h!==h}var bc,fu=C(()=>{bc=hp});function s5(l,h,d){var g=l[h];(!(_m.call(l,h)&&bc(g,d))||d===void 0&&!(h in l))&&vm(l,h,d)}var Ii,_m,o5,a5=C(()=>{Js(),fu(),Ii=Object.prototype,_m=Ii.hasOwnProperty,o5=s5});function l5(l,h,d){return h=xm(h===void 0?l.length-1:h,0),function(){for(var g=arguments,_=-1,b=xm(g.length-h,0),S=Array(b);++_<b;)S[_]=g[h+_];_=-1;for(var E=Array(h+1);++_<h;)E[_]=g[_];return E[h]=d(S),j4(l,this,E)}}var xm,c5,bm=C(()=>{Lx(),xm=Math.max,c5=l5});function b3(l,h){return du(c5(l,h,Xr),l+"")}var S3,u5=C(()=>{jo(),bm(),lp(),S3=b3});function h5(l){return typeof l=="number"&&l>-1&&l%1==0&&l<=d5}var d5,Sm,se=C(()=>{d5=9007199254740991,Sm=h5});function Se(l){return l!=null&&Sm(l.length)&&!Ro(l)}var Ge,Tt=C(()=>{_o(),se(),Ge=Se});function vr(l,h,d){if(!ye(d))return!1;var g=typeof h;return(g=="number"?Ge(d)&&up(h,d.length):g=="string"&&h in d)?bc(d[h],l):!1}var yi,ma=C(()=>{fu(),Tt(),ym(),Qe(),yi=vr});function G0(l){var h=l&&l.constructor,d=typeof h=="function"&&h.prototype||w3;return l===d}var w3,dh,dp=C(()=>{w3=Object.prototype,dh=G0});function bC(l,h){for(var d=-1,g=Array(l);++d<l;)g[d]=h(d);return g}var SC,Nz=C(()=>{SC=bC});function Iz(l){return Wt(l)&&cr(l)==wC}var wC,Hx,kz=C(()=>{He(),Fn(),wC="[object Arguments]",Hx=Iz}),jx,T3,TC,EC,wm,Wx=C(()=>{kz(),Fn(),jx=Object.prototype,T3=jx.hasOwnProperty,TC=jx.propertyIsEnumerable,EC=Hx(function(){return arguments}())?Hx:function(l){return Wt(l)&&T3.call(l,"callee")&&!TC.call(l,"callee")},wm=EC});function MC(){return!1}var CC,Dz=C(()=>{CC=MC}),E3,qx,AC,Xx,RC,Yx,M3,PC=C(()=>{Dn(),Dz(),E3=e&&!e.nodeType&&e,qx=E3&&!0&&i&&!i.nodeType&&i,AC=qx&&qx.exports===E3,Xx=AC?qr.Buffer:void 0,RC=Xx?Xx.isBuffer:void 0,Yx=RC||CC,M3=Yx});function Fz(l){return Wt(l)&&Sm(l.length)&&!!cs[cr(l)]}var NC,Kx,IC,kC,Zx,Qx,DC,Jx,FC,OC,C3,BC,LC,UC,zC,VC,GC,$C,HC,jC,WC,qC,XC,YC,cs,KC,Oz=C(()=>{He(),se(),Fn(),NC="[object Arguments]",Kx="[object Array]",IC="[object Boolean]",kC="[object Date]",Zx="[object Error]",Qx="[object Function]",DC="[object Map]",Jx="[object Number]",FC="[object Object]",OC="[object RegExp]",C3="[object Set]",BC="[object String]",LC="[object WeakMap]",UC="[object ArrayBuffer]",zC="[object DataView]",VC="[object Float32Array]",GC="[object Float64Array]",$C="[object Int8Array]",HC="[object Int16Array]",jC="[object Int32Array]",WC="[object Uint8Array]",qC="[object Uint8ClampedArray]",XC="[object Uint16Array]",YC="[object Uint32Array]",cs={},cs[VC]=cs[GC]=cs[$C]=cs[HC]=cs[jC]=cs[WC]=cs[qC]=cs[XC]=cs[YC]=!0,cs[NC]=cs[Kx]=cs[UC]=cs[IC]=cs[zC]=cs[kC]=cs[Zx]=cs[Qx]=cs[DC]=cs[Jx]=cs[FC]=cs[OC]=cs[C3]=cs[BC]=cs[LC]=!1,KC=Fz});function Bz(l){return function(h){return l(h)}}var f5,e7=C(()=>{f5=Bz}),t7,Tm,ZC,p5,QC,rs,Lz=C(()=>{Ue(),t7=e&&!e.nodeType&&e,Tm=t7&&!0&&i&&!i.nodeType&&i,ZC=Tm&&Tm.exports===t7,p5=ZC&&Zr.process,QC=function(){try{var l=Tm&&Tm.require&&Tm.require("util").types;return l||p5&&p5.binding&&p5.binding("util")}catch{}}(),rs=QC}),n7,JC,A3,r7=C(()=>{Oz(),e7(),Lz(),n7=rs&&rs.isTypedArray,JC=n7?f5(n7):KC,A3=JC});function R3(l,h){var d=Ho(l),g=!d&&wm(l),_=!d&&!g&&M3(l),b=!d&&!g&&!_&&A3(l),S=d||g||_||b,E=S?SC(l.length,String):[],N=E.length;for(var I in l)(h||m5.call(l,I))&&!(S&&(I=="length"||_&&(I=="offset"||I=="parent")||b&&(I=="buffer"||I=="byteLength"||I=="byteOffset")||up(I,N)))&&E.push(I);return E}var eA,m5,tA,Em=C(()=>{Nz(),Wx(),ka(),PC(),ym(),r7(),eA=Object.prototype,m5=eA.hasOwnProperty,tA=R3});function nA(l,h){return function(d){return l(h(d))}}var i7,s7=C(()=>{i7=nA}),rA,iA,Uz=C(()=>{s7(),rA=i7(Object.keys,Object),iA=rA});function sA(l){if(!dh(l))return iA(l);var h=[];for(var d in Object(l))o7.call(l,d)&&d!="constructor"&&h.push(d);return h}var oA,o7,aA,zz=C(()=>{dp(),Uz(),oA=Object.prototype,o7=oA.hasOwnProperty,aA=sA});function Vz(l){return Ge(l)?tA(l):aA(l)}var g5,a7=C(()=>{Em(),zz(),Tt(),g5=Vz});function Gz(l,h){if(Ho(l))return!1;var d=typeof l;return d=="number"||d=="symbol"||d=="boolean"||l==null||On(l)?!0:Mm.test(l)||!lA.test(l)||h!=null&&l in Object(h)}var lA,Mm,y5,l7=C(()=>{ka(),pr(),lA=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Mm=/^\w*$/,y5=Gz}),cA,Cm,v5=C(()=>{uh(),cA=uu(Object,"create"),Cm=cA});function $z(){this.__data__=Cm?Cm(null):{},this.size=0}var uA,c7=C(()=>{v5(),uA=$z});function Hz(l){var h=this.has(l)&&delete this.__data__[l];return this.size-=h?1:0,h}var u7,jz=C(()=>{u7=Hz});function h7(l){var h=this.__data__;if(Cm){var d=h[l];return d===hA?void 0:d}return fA.call(h,l)?h[l]:void 0}var hA,dA,fA,d7,Wz=C(()=>{v5(),hA="__lodash_hash_undefined__",dA=Object.prototype,fA=dA.hasOwnProperty,d7=h7});function qz(l){var h=this.__data__;return Cm?h[l]!==void 0:mA.call(h,l)}var pA,mA,gA,yA=C(()=>{v5(),pA=Object.prototype,mA=pA.hasOwnProperty,gA=qz});function Xz(l,h){var d=this.__data__;return this.size+=this.has(l)?0:1,d[l]=Cm&&h===void 0?vA:h,this}var vA,_A,Yz=C(()=>{v5(),vA="__lodash_hash_undefined__",_A=Xz});function Am(l){var h=-1,d=l==null?0:l.length;for(this.clear();++h<d;){var g=l[h];this.set(g[0],g[1])}}var f7,Kz=C(()=>{c7(),jz(),Wz(),yA(),Yz(),Am.prototype.clear=uA,Am.prototype.delete=u7,Am.prototype.get=d7,Am.prototype.has=gA,Am.prototype.set=_A,f7=Am});function Zz(){this.__data__=[],this.size=0}var xA,Qz=C(()=>{xA=Zz});function Jz(l,h){for(var d=l.length;d--;)if(bc(l[d][0],h))return d;return-1}var fp,_5=C(()=>{fu(),fp=Jz});function eV(l){var h=this.__data__,d=fp(h,l);if(d<0)return!1;var g=h.length-1;return d==g?h.pop():bA.call(h,d,1),--this.size,!0}var p7,bA,SA,tV=C(()=>{_5(),p7=Array.prototype,bA=p7.splice,SA=eV});function nV(l){var h=this.__data__,d=fp(h,l);return d<0?void 0:h[d][1]}var wA,rV=C(()=>{_5(),wA=nV});function m7(l){return fp(this.__data__,l)>-1}var x5,iV=C(()=>{_5(),x5=m7});function TA(l,h){var d=this.__data__,g=fp(d,l);return g<0?(++this.size,d.push([l,h])):d[g][1]=h,this}var g7,EA=C(()=>{_5(),g7=TA});function Rm(l){var h=-1,d=l==null?0:l.length;for(this.clear();++h<d;){var g=l[h];this.set(g[0],g[1])}}var Pm,P3=C(()=>{Qz(),tV(),rV(),iV(),EA(),Rm.prototype.clear=xA,Rm.prototype.delete=SA,Rm.prototype.get=wA,Rm.prototype.has=x5,Rm.prototype.set=g7,Pm=Rm}),MA,Nm,y7=C(()=>{uh(),Dn(),MA=uu(qr,"Map"),Nm=MA});function sV(){this.size=0,this.__data__={hash:new f7,map:new(Nm||Pm),string:new f7}}var CA,oV=C(()=>{Kz(),P3(),y7(),CA=sV});function aV(l){var h=typeof l;return h=="string"||h=="number"||h=="symbol"||h=="boolean"?l!=="__proto__":l===null}var AA,lV=C(()=>{AA=aV});function cV(l,h){var d=l.__data__;return AA(h)?d[typeof h=="string"?"string":"hash"]:d.map}var N3,I3=C(()=>{lV(),N3=cV});function uV(l){var h=N3(this,l).delete(l);return this.size-=h?1:0,h}var RA,hV=C(()=>{I3(),RA=uV});function dV(l){return N3(this,l).get(l)}var PA,fV=C(()=>{I3(),PA=dV});function pV(l){return N3(this,l).has(l)}var NA,mV=C(()=>{I3(),NA=pV});function gV(l,h){var d=N3(this,l),g=d.size;return d.set(l,h),this.size+=d.size==g?0:1,this}var IA,Im=C(()=>{I3(),IA=gV});function pu(l){var h=-1,d=l==null?0:l.length;for(this.clear();++h<d;){var g=l[h];this.set(g[0],g[1])}}var k3,v7=C(()=>{oV(),hV(),fV(),mV(),Im(),pu.prototype.clear=CA,pu.prototype.delete=RA,pu.prototype.get=PA,pu.prototype.has=NA,pu.prototype.set=IA,k3=pu});function _7(l,h){if(typeof l!="function"||h!=null&&typeof h!="function")throw new TypeError(kA);var d=function(){var g=arguments,_=h?h.apply(this,g):g[0],b=d.cache;if(b.has(_))return b.get(_);var S=l.apply(this,g);return d.cache=b.set(_,S)||b,S};return d.cache=new(_7.Cache||k3),d}var kA,b5,x7=C(()=>{v7(),kA="Expected a function",_7.Cache=k3,b5=_7});function yV(l){var h=b5(l,function(g){return d.size===b7&&d.clear(),g}),d=h.cache;return h}var b7,S7,vV=C(()=>{x7(),b7=500,S7=yV}),DA,FA,OA,BA,LA=C(()=>{vV(),DA=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,FA=/\\(\\)?/g,OA=S7(function(l){var h=[];return l.charCodeAt(0)===46&&h.push(""),l.replace(DA,function(d,g,_,b){h.push(_?b.replace(FA,"$1"):g||d)}),h}),BA=OA});function _V(l){return l==null?"":Sl(l)}var S5,w7=C(()=>{np(),S5=_V});function xV(l,h){return Ho(l)?l:y5(l,h)?[l]:BA(S5(l))}var km,T7=C(()=>{ka(),l7(),LA(),w7(),km=xV});function bV(l){if(typeof l=="string"||On(l))return l;var h=l+"";return h=="0"&&1/l==-UA?"-0":h}var UA,Dm,Fm=C(()=>{pr(),UA=1/0,Dm=bV});function SV(l,h){h=km(h,l);for(var d=0,g=h.length;l!=null&&d<g;)l=l[Dm(h[d++])];return d&&d==g?l:void 0}var w5,E7=C(()=>{T7(),Fm(),w5=SV});function zA(l,h,d){var g=l==null?void 0:w5(l,h);return g===void 0?d:g}var pp,mp=C(()=>{E7(),pp=zA});function wV(l,h){for(var d=-1,g=h.length,_=l.length;++d<g;)l[_+d]=h[d];return l}var M7,VA=C(()=>{M7=wV});function C7(l){return Ho(l)||wm(l)||!!(A7&&l&&l[A7])}var A7,T5,TV=C(()=>{Sr(),Wx(),ka(),A7=$n?$n.isConcatSpreadable:void 0,T5=C7});function E5(l,h,d,g,_){var b=-1,S=l.length;for(d||(d=T5),_||(_=[]);++b<S;){var E=l[b];h>0&&d(E)?h>1?E5(E,h-1,d,g,_):M7(_,E):g||(_[_.length]=E)}return _}var R7,EV=C(()=>{VA(),TV(),R7=E5}),P7,N7,GA=C(()=>{s7(),P7=i7(Object.getPrototypeOf,Object),N7=P7});function $A(l){if(!Wt(l)||cr(l)!=HA)return!1;var h=N7(l);if(h===null)return!0;var d=qA.call(h,"constructor")&&h.constructor;return typeof d=="function"&&d instanceof d&&I7.call(d)==Ld}var HA,jA,WA,I7,qA,Ld,Ud,XA=C(()=>{He(),GA(),Fn(),HA="[object Object]",jA=Function.prototype,WA=Object.prototype,I7=jA.toString,qA=WA.hasOwnProperty,Ld=I7.call(Object),Ud=$A});function MV(l){var h=Math[l];return function(d,g){if(d=Pn(d),g=g==null?0:KA(Br(g),292),g&&YA(d)){var _=(S5(d)+"e").split("e"),b=h(_[0]+"e"+(+_[1]+g));return _=(S5(b)+"e").split("e"),+(_[0]+"e"+(+_[1]-g))}return h(d)}}var YA,KA,ZA,M5=C(()=>{Dn(),tr(),hr(),w7(),YA=qr.isFinite,KA=Math.min,ZA=MV});function CV(l,h,d){return l===l&&(d!==void 0&&(l=l<=d?l:d),h!==void 0&&(l=l>=h?l:h)),l}var C5,AV=C(()=>{C5=CV});function RV(l,h,d){return d===void 0&&(d=h,h=void 0),d!==void 0&&(d=Pn(d),d=d===d?d:0),h!==void 0&&(h=Pn(h),h=h===h?h:0),C5(Pn(l),h,d)}var Ss,A5=C(()=>{AV(),hr(),Ss=RV});function PV(){this.__data__=new Pm,this.size=0}var k7,QA=C(()=>{P3(),k7=PV});function NV(l){var h=this.__data__,d=h.delete(l);return this.size=h.size,d}var JA,IV=C(()=>{JA=NV});function kV(l){return this.__data__.get(l)}var eR,DV=C(()=>{eR=kV});function FV(l){return this.__data__.has(l)}var tR,OV=C(()=>{tR=FV});function BV(l,h){var d=this.__data__;if(d instanceof Pm){var g=d.__data__;if(!Nm||g.length<nR-1)return g.push([l,h]),this.size=++d.size,this;d=this.__data__=new k3(g)}return d.set(l,h),this.size=d.size,this}var nR,rR,LV=C(()=>{P3(),y7(),v7(),nR=200,rR=BV});function Om(l){var h=this.__data__=new Pm(l);this.size=h.size}var D3,iR=C(()=>{P3(),QA(),IV(),DV(),OV(),LV(),Om.prototype.clear=k7,Om.prototype.delete=JA,Om.prototype.get=eR,Om.prototype.has=tR,Om.prototype.set=rR,D3=Om});function UV(l,h){for(var d=-1,g=l==null?0:l.length,_=0,b=[];++d<g;){var S=l[d];h(S,d,l)&&(b[_++]=S)}return b}var sR,zV=C(()=>{sR=UV});function VV(){return[]}var oR,GV=C(()=>{oR=VV}),aR,lR,D7,cR,uR,$V=C(()=>{zV(),GV(),aR=Object.prototype,lR=aR.propertyIsEnumerable,D7=Object.getOwnPropertySymbols,cR=D7?function(l){return l==null?[]:(l=Object(l),sR(D7(l),function(h){return lR.call(l,h)}))}:oR,uR=cR});function HV(l,h,d){var g=h(l);return Ho(l)?g:M7(g,d(l))}var hR,dR=C(()=>{VA(),ka(),hR=HV});function jV(l){return hR(l,g5,uR)}var F7,WV=C(()=>{dR(),$V(),a7(),F7=jV}),fR,R5,pR=C(()=>{uh(),Dn(),fR=uu(qr,"DataView"),R5=fR}),mR,P5,qV=C(()=>{uh(),Dn(),mR=uu(qr,"Promise"),P5=mR}),gR,gp,O7=C(()=>{uh(),Dn(),gR=uu(qr,"Set"),gp=gR}),B7,yR,L7,U7,N5,z7,vR,_R,V7,xR,bR,zd,G7,XV=C(()=>{pR(),y7(),qV(),O7(),Ox(),He(),ip(),B7="[object Map]",yR="[object Object]",L7="[object Promise]",U7="[object Set]",N5="[object WeakMap]",z7="[object DataView]",vR=cu(R5),_R=cu(Nm),V7=cu(P5),xR=cu(gp),bR=cu(fm),zd=cr,(R5&&zd(new R5(new ArrayBuffer(1)))!=z7||Nm&&zd(new Nm)!=B7||P5&&zd(P5.resolve())!=L7||gp&&zd(new gp)!=U7||fm&&zd(new fm)!=N5)&&(zd=function(l){var h=cr(l),d=h==yR?l.constructor:void 0,g=d?cu(d):"";if(g)switch(g){case vR:return z7;case _R:return B7;case V7:return L7;case xR:return U7;case bR:return N5}return h}),G7=zd}),SR,$7,YV=C(()=>{Dn(),SR=qr.Uint8Array,$7=SR});function KV(l){return this.__data__.set(l,wR),this}var wR,TR,ZV=C(()=>{wR="__lodash_hash_undefined__",TR=KV});function QV(l){return this.__data__.has(l)}var ER,JV=C(()=>{ER=QV});function I5(l){var h=-1,d=l==null?0:l.length;for(this.__data__=new k3;++h<d;)this.add(l[h])}var Ki,F3=C(()=>{v7(),ZV(),JV(),I5.prototype.add=I5.prototype.push=TR,I5.prototype.has=ER,Ki=I5});function eG(l,h){for(var d=-1,g=l==null?0:l.length;++d<g;)if(h(l[d],d,l))return!0;return!1}var MR,tG=C(()=>{MR=eG});function nG(l,h){return l.has(h)}var H7,CR=C(()=>{H7=nG});function rG(l,h,d,g,_,b){var S=d&AR,E=l.length,N=h.length;if(E!=N&&!(S&&N>E))return!1;var I=b.get(l),B=b.get(h);if(I&&B)return I==h&&B==l;var V=-1,U=!0,F=d&RR?new Ki:void 0;for(b.set(l,h),b.set(h,l);++V<E;){var H=l[V],G=h[V];if(g)var W=S?g(G,H,V,h,l,b):g(H,G,V,l,h,b);if(W!==void 0){if(W)continue;U=!1;break}if(F){if(!MR(h,function(X,Z){if(!H7(F,Z)&&(H===X||_(H,X,d,g,b)))return F.push(Z)})){U=!1;break}}else if(!(H===G||_(H,G,d,g,b))){U=!1;break}}return b.delete(l),b.delete(h),U}var AR,RR,j7,O3=C(()=>{F3(),tG(),CR(),AR=1,RR=2,j7=rG});function iG(l){var h=-1,d=Array(l.size);return l.forEach(function(g,_){d[++h]=[_,g]}),d}var PR,sG=C(()=>{PR=iG});function oG(l){var h=-1,d=Array(l.size);return l.forEach(function(g){d[++h]=g}),d}var k5,W7=C(()=>{k5=oG});function aG(l,h,d,g,_,b,S){switch(d){case GR:if(l.byteLength!=h.byteLength||l.byteOffset!=h.byteOffset)return!1;l=l.buffer,h=h.buffer;case VR:return!(l.byteLength!=h.byteLength||!b(new $7(l),new $7(h)));case IR:case kR:case OR:return bc(+l,+h);case DR:return l.name==h.name&&l.message==h.message;case BR:case UR:return l==h+"";case FR:var E=PR;case LR:var N=g&NR;if(E||(E=k5),l.size!=h.size&&!N)return!1;var I=S.get(l);if(I)return I==h;g|=q7,S.set(l,h);var B=j7(E(l),E(h),g,_,b,S);return S.delete(l),B;case zR:if(D5)return D5.call(l)==D5.call(h)}return!1}var NR,q7,IR,kR,DR,FR,OR,BR,LR,UR,zR,VR,GR,X7,D5,$R,lG=C(()=>{Sr(),YV(),fu(),O3(),sG(),W7(),NR=1,q7=2,IR="[object Boolean]",kR="[object Date]",DR="[object Error]",FR="[object Map]",OR="[object Number]",BR="[object RegExp]",LR="[object Set]",UR="[object String]",zR="[object Symbol]",VR="[object ArrayBuffer]",GR="[object DataView]",X7=$n?$n.prototype:void 0,D5=X7?X7.valueOf:void 0,$R=aG});function cG(l,h,d,g,_,b){var S=d&HR,E=F7(l),N=E.length,I=F7(h),B=I.length;if(N!=B&&!S)return!1;for(var V=N;V--;){var U=E[V];if(!(S?U in h:F5.call(h,U)))return!1}var F=b.get(l),H=b.get(h);if(F&&H)return F==h&&H==l;var G=!0;b.set(l,h),b.set(h,l);for(var W=S;++V<N;){U=E[V];var X=l[U],Z=h[U];if(g)var te=S?g(Z,X,U,h,l,b):g(X,Z,U,l,h,b);if(!(te===void 0?X===Z||_(X,Z,d,g,b):te)){G=!1;break}W||(W=U=="constructor")}if(G&&!W){var ae=l.constructor,oe=h.constructor;ae!=oe&&"constructor"in l&&"constructor"in h&&!(typeof ae=="function"&&ae instanceof ae&&typeof oe=="function"&&oe instanceof oe)&&(G=!1)}return b.delete(l),b.delete(h),G}var HR,Y7,F5,jR,uG=C(()=>{WV(),HR=1,Y7=Object.prototype,F5=Y7.hasOwnProperty,jR=cG});function hG(l,h,d,g,_,b){var S=Ho(l),E=Ho(h),N=S?Z7:G7(l),I=E?Z7:G7(h);N=N==K7?B3:N,I=I==K7?B3:I;var B=N==B3,V=I==B3,U=N==I;if(U&&M3(l)){if(!M3(h))return!1;S=!0,B=!1}if(U&&!B)return b||(b=new D3),S||A3(l)?j7(l,h,d,g,_,b):$R(l,h,N,d,g,_,b);if(!(d&WR)){var F=B&&O5.call(l,"__wrapped__"),H=V&&O5.call(h,"__wrapped__");if(F||H){var G=F?l.value():l,W=H?h.value():h;return b||(b=new D3),_(G,W,d,g,b)}}return U?(b||(b=new D3),jR(l,h,d,g,_,b)):!1}var WR,K7,Z7,B3,qR,O5,Q7,B5=C(()=>{iR(),O3(),lG(),uG(),XV(),ka(),PC(),r7(),WR=1,K7="[object Arguments]",Z7="[object Array]",B3="[object Object]",qR=Object.prototype,O5=qR.hasOwnProperty,Q7=hG});function XR(l,h,d,g,_){return l===h?!0:l==null||h==null||!Wt(l)&&!Wt(h)?l!==l&&h!==h:Q7(l,h,d,g,XR,_)}var L5,YR=C(()=>{B5(),Fn(),L5=XR});function dG(l,h,d,g){var _=d.length,b=_,S=!g;if(l==null)return!b;for(l=Object(l);_--;){var E=d[_];if(S&&E[2]?E[1]!==l[E[0]]:!(E[0]in l))return!1}for(;++_<b;){E=d[_];var N=E[0],I=l[N],B=E[1];if(S&&E[2]){if(I===void 0&&!(N in l))return!1}else{var V=new D3;if(g)var U=g(I,B,N,l,h,V);if(!(U===void 0?L5(B,I,J7|eb,g,V):U))return!1}}return!0}var J7,eb,KR,fG=C(()=>{iR(),YR(),J7=1,eb=2,KR=dG});function pG(l){return l===l&&!ye(l)}var tb,ZR=C(()=>{Qe(),tb=pG});function QR(l){for(var h=g5(l),d=h.length;d--;){var g=h[d],_=l[g];h[d]=[g,_,tb(_)]}return h}var JR,mG=C(()=>{ZR(),a7(),JR=QR});function gG(l,h){return function(d){return d==null?!1:d[l]===h&&(h!==void 0||l in Object(d))}}var U5,eP=C(()=>{U5=gG});function yG(l){var h=JR(l);return h.length==1&&h[0][2]?U5(h[0][0],h[0][1]):function(d){return d===l||KR(d,l,h)}}var tP,vG=C(()=>{fG(),mG(),eP(),tP=yG});function _G(l,h){return l!=null&&h in Object(l)}var nP,xG=C(()=>{nP=_G});function bG(l,h,d){h=km(h,l);for(var g=-1,_=h.length,b=!1;++g<_;){var S=Dm(h[g]);if(!(b=l!=null&&d(l,S)))break;l=l[S]}return b||++g!=_?b:(_=l==null?0:l.length,!!_&&Sm(_)&&up(S,_)&&(Ho(l)||wm(l)))}var rP,SG=C(()=>{T7(),Wx(),ka(),ym(),se(),Fm(),rP=bG});function wG(l,h){return l!=null&&rP(l,h,nP)}var iP,TG=C(()=>{xG(),SG(),iP=wG});function sP(l,h){return y5(l)&&tb(h)?U5(Dm(l),h):function(d){var g=pp(d,l);return g===void 0&&g===h?iP(d,l):L5(h,g,oP|aP)}}var oP,aP,lP,EG=C(()=>{YR(),mp(),TG(),l7(),ZR(),eP(),Fm(),oP=1,aP=2,lP=sP});function MG(l){return function(h){return h==null?void 0:h[l]}}var cP,CG=C(()=>{cP=MG});function AG(l){return function(h){return w5(h,l)}}var uP,RG=C(()=>{E7(),uP=AG});function PG(l){return y5(l)?cP(Dm(l)):uP(l)}var hP,NG=C(()=>{CG(),RG(),l7(),Fm(),hP=PG});function nb(l){return typeof l=="function"?l:l==null?Xr:typeof l=="object"?Ho(l)?lP(l[0],l[1]):tP(l):hP(l)}var Bm,L3=C(()=>{vG(),EG(),jo(),ka(),NG(),Bm=nb});function IG(l,h,d,g){for(var _=-1,b=l==null?0:l.length;++_<b;){var S=l[_];h(g,S,d(S),l)}return g}var dP,kG=C(()=>{dP=IG});function DG(l){return function(h,d,g){for(var _=-1,b=Object(h),S=g(h),E=S.length;E--;){var N=S[l?E:++_];if(d(b[N],N,b)===!1)break}return h}}var fP,FG=C(()=>{fP=DG}),pP,mP,OG=C(()=>{FG(),pP=fP(),mP=pP});function BG(l,h){return l&&mP(l,h,g5)}var rb,gP=C(()=>{OG(),a7(),rb=BG});function LG(l,h){return function(d,g){if(d==null)return d;if(!Ge(d))return l(d,g);for(var _=d.length,b=h?_:-1,S=Object(d);(h?b--:++b<_)&&g(S[b],b,S)!==!1;);return d}}var yP,UG=C(()=>{Tt(),yP=LG}),vP,z5,_P=C(()=>{gP(),UG(),vP=yP(rb),z5=vP});function zG(l,h,d,g){return z5(l,function(_,b,S){h(g,_,d(_),S)}),g}var ib,VG=C(()=>{_P(),ib=zG});function GG(l,h){return function(d,g){var _=Ho(d)?dP:ib,b=h?h():{};return _(d,l,Bm(g,2),b)}}var xP,$G=C(()=>{kG(),VG(),L3(),ka(),xP=GG}),bP,V5,sb=C(()=>{Dn(),bP=function(){return qr.Date.now()},V5=bP});function ob(l,h,d){var g,_,b,S,E,N,I=0,B=!1,V=!1,U=!0;if(typeof l!="function")throw new TypeError(SP);h=Pn(h)||0,ye(d)&&(B=!!d.leading,V="maxWait"in d,b=V?ab(Pn(d.maxWait)||0,h):b,U="trailing"in d?!!d.trailing:U);function F(ue){var Ee=g,Ie=_;return g=_=void 0,I=ue,S=l.apply(Ie,Ee),S}function H(ue){return I=ue,E=setTimeout(X,h),B?F(ue):S}function G(ue){var Ee=ue-N,Ie=ue-I,_e=h-Ee;return V?lb(_e,b-Ie):_e}function W(ue){var Ee=ue-N,Ie=ue-I;return N===void 0||Ee>=h||Ee<0||V&&Ie>=b}function X(){var ue=V5();if(W(ue))return Z(ue);E=setTimeout(X,G(ue))}function Z(ue){return E=void 0,U&&g?F(ue):(g=_=void 0,S)}function te(){E!==void 0&&clearTimeout(E),I=0,g=N=_=E=void 0}function ae(){return E===void 0?S:Z(V5())}function oe(){var ue=V5(),Ee=W(ue);if(g=arguments,_=this,N=ue,Ee){if(E===void 0)return H(N);if(V)return clearTimeout(E),E=setTimeout(X,h),F(N)}return E===void 0&&(E=setTimeout(X,h)),S}return oe.cancel=te,oe.flush=ae,oe}var SP,ab,lb,G5,wP=C(()=>{Qe(),sb(),hr(),SP="Expected a function",ab=Math.max,lb=Math.min,G5=ob});function TP(l,h,d){for(var g=-1,_=l==null?0:l.length;++g<_;)if(d(h,l[g]))return!0;return!1}var cb,HG=C(()=>{cb=TP});function jG(l){var h=l==null?0:l.length;return h?l[h-1]:void 0}var yp,U3=C(()=>{yp=jG});function WG(l,h,d){var g=l==null?0:l.length;if(!g)return-1;var _=d==null?0:Br(d);return _<0&&(_=EP(g+_,0)),mm(l,Bm(h,3),_)}var EP,ub,MP=C(()=>{cp(),L3(),tr(),EP=Math.max,ub=WG});function qG(l,h,d){var g=l==null?0:l.length;if(!g)return-1;var _=g-1;return d!==void 0&&(_=Br(d),_=d<0?CP(g+_,0):AP(_,g-1)),mm(l,Bm(h,3),_,!0)}var CP,AP,RP,z3=C(()=>{cp(),L3(),tr(),CP=Math.max,AP=Math.min,RP=qG});function XG(l,h){var d=-1,g=Ge(l)?Array(l.length):[];return z5(l,function(_,b,S){g[++d]=h(_,b,S)}),g}var hb,YG=C(()=>{_P(),Tt(),hb=XG});function KG(l,h,d){return l>=V3(h,d)&&l<PP(h,d)}var PP,V3,$5,ZG=C(()=>{PP=Math.max,V3=Math.min,$5=KG});function QG(l,h,d){return h=oi(h),d===void 0?(d=h,h=0):d=oi(d),l=Pn(l),$5(l,h,d)}var Zi,n0=C(()=>{ZG(),Yi(),hr(),Zi=QG});function r0(l){return typeof l=="number"&&l==Br(l)}var fh,is=C(()=>{tr(),fh=r0}),mu,Lm,JG=C(()=>{Js(),$G(),mu=xP(function(l,h,d){vm(l,d,h)}),Lm=mu});function e$(l,h){var d={};return h=Bm(h,3),rb(l,function(g,_,b){vm(d,_,h(g,_,b))}),d}var vp,NP=C(()=>{Js(),gP(),L3(),vp=e$});function t$(l,h,d,g){if(!ye(l))return l;h=km(h,l);for(var _=-1,b=h.length,S=b-1,E=l;E!=null&&++_<b;){var N=Dm(h[_]),I=d;if(N==="__proto__"||N==="constructor"||N==="prototype")return l;if(_!=S){var B=E[N];I=g?g(B,N,E):void 0,I===void 0&&(I=ye(B)?B:up(h[_+1])?[]:{})}o5(E,N,I),E=E[N]}return l}var db,IP=C(()=>{a5(),T7(),ym(),Qe(),Fm(),db=t$});function H5(l,h){var d=l.length;for(l.sort(h);d--;)l[d]=l[d].value;return l}var fb,n$=C(()=>{fb=H5});function kP(l,h){if(l!==h){var d=l!==void 0,g=l===null,_=l===l,b=On(l),S=h!==void 0,E=h===null,N=h===h,I=On(h);if(!E&&!I&&!b&&l>h||b&&S&&N&&!E&&!I||g&&S&&N||!d&&N||!_)return 1;if(!g&&!b&&!I&&l<h||I&&d&&_&&!g&&!b||E&&d&&_||!S&&_||!N)return-1}return 0}var pb,DP=C(()=>{pr(),pb=kP});function r$(l,h,d){for(var g=-1,_=l.criteria,b=h.criteria,S=_.length,E=d.length;++g<S;){var N=pb(_[g],b[g]);if(N){if(g>=E)return N;var I=d[g];return N*(I=="desc"?-1:1)}}return l.index-h.index}var FP,OP=C(()=>{DP(),FP=r$});function i$(l,h,d){h.length?h=kr(h,function(b){return Ho(b)?function(S){return w5(S,b.length===1?b[0]:b)}:b}):h=[Xr];var g=-1;h=kr(h,f5(Bm));var _=hb(l,function(b,S,E){var N=kr(h,function(I){return I(b)});return{criteria:N,index:++g,value:b}});return fb(_,function(b,S){return FP(b,S,d)})}var BP,G3=C(()=>{pa(),E7(),L3(),YG(),n$(),e7(),OP(),jo(),ka(),BP=i$});function LP(l,h,d,g){for(var _=d-1,b=l.length;++_<b;)if(g(l[_],h))return _;return-1}var UP,s$=C(()=>{UP=LP});function qo(l,h,d,g){var _=g?UP:Bd,b=-1,S=h.length,E=l;for(l===h&&(h=m3(h)),d&&(E=kr(l,f5(d)));++b<S;)for(var N=0,I=h[b],B=d?d(I):I;(N=_(E,B,N,g))>-1;)E!==l&&mb.call(E,N,1),mb.call(l,N,1);return l}var ph,mb,$3,o$=C(()=>{pa(),Po(),s$(),e7(),Ux(),ph=Array.prototype,mb=ph.splice,$3=qo});function a$(l,h){return l&&l.length&&h&&h.length?$3(l,h):l}var zP,l$=C(()=>{o$(),zP=a$}),j5,VP,W5=C(()=>{u5(),l$(),j5=S3(zP),VP=j5}),_p,GP,c$=C(()=>{M5(),_p=ZA("round"),GP=_p});function $P(l,h,d){return l==null?l:db(l,h,d)}var Vd,gb=C(()=>{IP(),Vd=$P}),H3,yb,HP=C(()=>{EV(),G3(),u5(),ma(),H3=S3(function(l,h){if(l==null)return[];var d=h.length;return d>1&&yi(l,h[0],h[1])?h=[]:d>2&&yi(h[0],h[1],h[2])&&(h=[h[0]]),BP(l,R7(h,1),[])}),yb=H3}),jP,WP,qP,u$=C(()=>{O7(),q4(),W7(),jP=1/0,WP=gp&&1/k5(new gp([,-0]))[1]==jP?function(l){return new gp(l)}:p3,qP=WP});function h$(l,h,d){var g=-1,_=gm,b=l.length,S=!0,E=[],N=E;if(d)S=!1,_=cb;else if(b>=XP){var I=h?null:qP(l);if(I)return k5(I);S=!1,_=H7,N=new Ki}else N=h?[]:E;e:for(;++g<b;){var B=l[g],V=h?h(B):B;if(B=d||B!==0?B:0,S&&V===V){for(var U=N.length;U--;)if(N[U]===V)continue e;h&&N.push(V),E.push(B)}else _(N,V,d)||(N!==E&&N.push(V),E.push(B))}return E}var XP,YP,xp=C(()=>{F3(),t5(),HG(),CR(),u$(),W7(),XP=200,YP=h$});function bp(l){return l&&l.length?YP(l):[]}var i0,vb=C(()=>{xp(),i0=bp}),bo=C(()=>{A5(),wP(),MP(),n0(),is(),XA(),U3(),NP(),x7(),c$(),vb()}),d$=L((l,h)=>{var d;h.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:lo):g=>(d||(d=Promise.resolve())).then(g).catch(_=>setTimeout(()=>{throw _},0))}),KP=L(l=>{var h=Symbol.for("react.element"),d=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),E=Symbol.for("react.context"),N=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),B=Symbol.for("react.memo"),V=Symbol.for("react.lazy"),U=Symbol.iterator;function F(pe){return pe===null||typeof pe!="object"?null:(pe=U&&pe[U]||pe["@@iterator"],typeof pe=="function"?pe:null)}var H={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},G=Object.assign,W={};function X(pe,xe,ct){this.props=pe,this.context=xe,this.refs=W,this.updater=ct||H}X.prototype.isReactComponent={},X.prototype.setState=function(pe,xe){if(typeof pe!="object"&&typeof pe!="function"&&pe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,pe,xe,"setState")},X.prototype.forceUpdate=function(pe){this.updater.enqueueForceUpdate(this,pe,"forceUpdate")};function Z(){}Z.prototype=X.prototype;function te(pe,xe,ct){this.props=pe,this.context=xe,this.refs=W,this.updater=ct||H}var ae=te.prototype=new Z;ae.constructor=te,G(ae,X.prototype),ae.isPureReactComponent=!0;var oe=Array.isArray,ue=Object.prototype.hasOwnProperty,Ee={current:null},Ie={key:!0,ref:!0,__self:!0,__source:!0};function _e(pe,xe,ct){var dt,gt={},Je=null,kn=null;if(xe!=null)for(dt in xe.ref!==void 0&&(kn=xe.ref),xe.key!==void 0&&(Je=""+xe.key),xe)ue.call(xe,dt)&&!Ie.hasOwnProperty(dt)&&(gt[dt]=xe[dt]);var Mt=arguments.length-2;if(Mt===1)gt.children=ct;else if(1<Mt){for(var En=Array(Mt),Yn=0;Yn<Mt;Yn++)En[Yn]=arguments[Yn+2];gt.children=En}if(pe&&pe.defaultProps)for(dt in Mt=pe.defaultProps,Mt)gt[dt]===void 0&&(gt[dt]=Mt[dt]);return{$$typeof:h,type:pe,key:Je,ref:kn,props:gt,_owner:Ee.current}}function Oe(pe,xe){return{$$typeof:h,type:pe.type,key:xe,ref:pe.ref,props:pe.props,_owner:pe._owner}}function ot(pe){return typeof pe=="object"&&pe!==null&&pe.$$typeof===h}function de(pe){var xe={"=":"=0",":":"=2"};return"$"+pe.replace(/[=:]/g,function(ct){return xe[ct]})}var Be=/\/+/g;function re(pe,xe){return typeof pe=="object"&&pe!==null&&pe.key!=null?de(""+pe.key):xe.toString(36)}function Ye(pe,xe,ct,dt,gt){var Je=typeof pe;(Je==="undefined"||Je==="boolean")&&(pe=null);var kn=!1;if(pe===null)kn=!0;else switch(Je){case"string":case"number":kn=!0;break;case"object":switch(pe.$$typeof){case h:case d:kn=!0}}if(kn)return kn=pe,gt=gt(kn),pe=dt===""?"."+re(kn,0):dt,oe(gt)?(ct="",pe!=null&&(ct=pe.replace(Be,"$&/")+"/"),Ye(gt,xe,ct,"",function(Yn){return Yn})):gt!=null&&(ot(gt)&&(gt=Oe(gt,ct+(!gt.key||kn&&kn.key===gt.key?"":(""+gt.key).replace(Be,"$&/")+"/")+pe)),xe.push(gt)),1;if(kn=0,dt=dt===""?".":dt+":",oe(pe))for(var Mt=0;Mt<pe.length;Mt++){Je=pe[Mt];var En=dt+re(Je,Mt);kn+=Ye(Je,xe,ct,En,gt)}else if(En=F(pe),typeof En=="function")for(pe=En.call(pe),Mt=0;!(Je=pe.next()).done;)Je=Je.value,En=dt+re(Je,Mt++),kn+=Ye(Je,xe,ct,En,gt);else if(Je==="object")throw xe=String(pe),Error("Objects are not valid as a React child (found: "+(xe==="[object Object]"?"object with keys {"+Object.keys(pe).join(", ")+"}":xe)+"). If you meant to render a collection of children, use an array instead.");return kn}function nn(pe,xe,ct){if(pe==null)return pe;var dt=[],gt=0;return Ye(pe,dt,"","",function(Je){return xe.call(ct,Je,gt++)}),dt}function ke(pe){if(pe._status===-1){var xe=pe._result;xe=xe(),xe.then(function(ct){(pe._status===0||pe._status===-1)&&(pe._status=1,pe._result=ct)},function(ct){(pe._status===0||pe._status===-1)&&(pe._status=2,pe._result=ct)}),pe._status===-1&&(pe._status=0,pe._result=xe)}if(pe._status===1)return pe._result.default;throw pe._result}var Re={current:null},Ze={transition:null},Pt={ReactCurrentDispatcher:Re,ReactCurrentBatchConfig:Ze,ReactCurrentOwner:Ee};l.Children={map:nn,forEach:function(pe,xe,ct){nn(pe,function(){xe.apply(this,arguments)},ct)},count:function(pe){var xe=0;return nn(pe,function(){xe++}),xe},toArray:function(pe){return nn(pe,function(xe){return xe})||[]},only:function(pe){if(!ot(pe))throw Error("React.Children.only expected to receive a single React element child.");return pe}},l.Component=X,l.Fragment=g,l.Profiler=b,l.PureComponent=te,l.StrictMode=_,l.Suspense=I,l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pt,l.cloneElement=function(pe,xe,ct){if(pe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+pe+".");var dt=G({},pe.props),gt=pe.key,Je=pe.ref,kn=pe._owner;if(xe!=null){if(xe.ref!==void 0&&(Je=xe.ref,kn=Ee.current),xe.key!==void 0&&(gt=""+xe.key),pe.type&&pe.type.defaultProps)var Mt=pe.type.defaultProps;for(En in xe)ue.call(xe,En)&&!Ie.hasOwnProperty(En)&&(dt[En]=xe[En]===void 0&&Mt!==void 0?Mt[En]:xe[En])}var En=arguments.length-2;if(En===1)dt.children=ct;else if(1<En){Mt=Array(En);for(var Yn=0;Yn<En;Yn++)Mt[Yn]=arguments[Yn+2];dt.children=Mt}return{$$typeof:h,type:pe.type,key:gt,ref:Je,props:dt,_owner:kn}},l.createContext=function(pe){return pe={$$typeof:E,_currentValue:pe,_currentValue2:pe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},pe.Provider={$$typeof:S,_context:pe},pe.Consumer=pe},l.createElement=_e,l.createFactory=function(pe){var xe=_e.bind(null,pe);return xe.type=pe,xe},l.createRef=function(){return{current:null}},l.forwardRef=function(pe){return{$$typeof:N,render:pe}},l.isValidElement=ot,l.lazy=function(pe){return{$$typeof:V,_payload:{_status:-1,_result:pe},_init:ke}},l.memo=function(pe,xe){return{$$typeof:B,type:pe,compare:xe===void 0?null:xe}},l.startTransition=function(pe){var xe=Ze.transition;Ze.transition={};try{pe()}finally{Ze.transition=xe}},l.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},l.useCallback=function(pe,xe){return Re.current.useCallback(pe,xe)},l.useContext=function(pe){return Re.current.useContext(pe)},l.useDebugValue=function(){},l.useDeferredValue=function(pe){return Re.current.useDeferredValue(pe)},l.useEffect=function(pe,xe){return Re.current.useEffect(pe,xe)},l.useId=function(){return Re.current.useId()},l.useImperativeHandle=function(pe,xe,ct){return Re.current.useImperativeHandle(pe,xe,ct)},l.useInsertionEffect=function(pe,xe){return Re.current.useInsertionEffect(pe,xe)},l.useLayoutEffect=function(pe,xe){return Re.current.useLayoutEffect(pe,xe)},l.useMemo=function(pe,xe){return Re.current.useMemo(pe,xe)},l.useReducer=function(pe,xe,ct){return Re.current.useReducer(pe,xe,ct)},l.useRef=function(pe){return Re.current.useRef(pe)},l.useState=function(pe){return Re.current.useState(pe)},l.useSyncExternalStore=function(pe,xe,ct){return Re.current.useSyncExternalStore(pe,xe,ct)},l.useTransition=function(){return Re.current.useTransition()},l.version="18.2.0"}),Le=L((l,h)=>{h.exports=KP()}),_b=L(l=>{function h(Re,Ze){var Pt=Re.length;Re.push(Ze);e:for(;0<Pt;){var pe=Pt-1>>>1,xe=Re[pe];if(0<_(xe,Ze))Re[pe]=Ze,Re[Pt]=xe,Pt=pe;else break e}}function d(Re){return Re.length===0?null:Re[0]}function g(Re){if(Re.length===0)return null;var Ze=Re[0],Pt=Re.pop();if(Pt!==Ze){Re[0]=Pt;e:for(var pe=0,xe=Re.length,ct=xe>>>1;pe<ct;){var dt=2*(pe+1)-1,gt=Re[dt],Je=dt+1,kn=Re[Je];if(0>_(gt,Pt))Je<xe&&0>_(kn,gt)?(Re[pe]=kn,Re[Je]=Pt,pe=Je):(Re[pe]=gt,Re[dt]=Pt,pe=dt);else if(Je<xe&&0>_(kn,Pt))Re[pe]=kn,Re[Je]=Pt,pe=Je;else break e}}return Ze}function _(Re,Ze){var Pt=Re.sortIndex-Ze.sortIndex;return Pt!==0?Pt:Re.id-Ze.id}typeof performance=="object"&&typeof performance.now=="function"?(b=performance,l.unstable_now=function(){return b.now()}):(S=Date,E=S.now(),l.unstable_now=function(){return S.now()-E});var b,S,E,N=[],I=[],B=1,V=null,U=3,F=!1,H=!1,G=!1,W=typeof setTimeout=="function"?setTimeout:null,X=typeof clearTimeout=="function"?clearTimeout:null,Z=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function te(Re){for(var Ze=d(I);Ze!==null;){if(Ze.callback===null)g(I);else if(Ze.startTime<=Re)g(I),Ze.sortIndex=Ze.expirationTime,h(N,Ze);else break;Ze=d(I)}}function ae(Re){if(G=!1,te(Re),!H)if(d(N)!==null)H=!0,nn(oe);else{var Ze=d(I);Ze!==null&&ke(ae,Ze.startTime-Re)}}function oe(Re,Ze){H=!1,G&&(G=!1,X(Ie),Ie=-1),F=!0;var Pt=U;try{for(te(Ze),V=d(N);V!==null&&(!(V.expirationTime>Ze)||Re&&!ot());){var pe=V.callback;if(typeof pe=="function"){V.callback=null,U=V.priorityLevel;var xe=pe(V.expirationTime<=Ze);Ze=l.unstable_now(),typeof xe=="function"?V.callback=xe:V===d(N)&&g(N),te(Ze)}else g(N);V=d(N)}if(V!==null)var ct=!0;else{var dt=d(I);dt!==null&&ke(ae,dt.startTime-Ze),ct=!1}return ct}finally{V=null,U=Pt,F=!1}}var ue=!1,Ee=null,Ie=-1,_e=5,Oe=-1;function ot(){return!(l.unstable_now()-Oe<_e)}function de(){if(Ee!==null){var Re=l.unstable_now();Oe=Re;var Ze=!0;try{Ze=Ee(!0,Re)}finally{Ze?Be():(ue=!1,Ee=null)}}else ue=!1}var Be;typeof Z=="function"?Be=function(){Z(de)}:typeof MessageChannel<"u"?(re=new MessageChannel,Ye=re.port2,re.port1.onmessage=de,Be=function(){Ye.postMessage(null)}):Be=function(){W(de,0)};var re,Ye;function nn(Re){Ee=Re,ue||(ue=!0,Be())}function ke(Re,Ze){Ie=W(function(){Re(l.unstable_now())},Ze)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(Re){Re.callback=null},l.unstable_continueExecution=function(){H||F||(H=!0,nn(oe))},l.unstable_forceFrameRate=function(Re){0>Re||125<Re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_e=0<Re?Math.floor(1e3/Re):5},l.unstable_getCurrentPriorityLevel=function(){return U},l.unstable_getFirstCallbackNode=function(){return d(N)},l.unstable_next=function(Re){switch(U){case 1:case 2:case 3:var Ze=3;break;default:Ze=U}var Pt=U;U=Ze;try{return Re()}finally{U=Pt}},l.unstable_pauseExecution=function(){},l.unstable_requestPaint=function(){},l.unstable_runWithPriority=function(Re,Ze){switch(Re){case 1:case 2:case 3:case 4:case 5:break;default:Re=3}var Pt=U;U=Re;try{return Ze()}finally{U=Pt}},l.unstable_scheduleCallback=function(Re,Ze,Pt){var pe=l.unstable_now();switch(typeof Pt=="object"&&Pt!==null?(Pt=Pt.delay,Pt=typeof Pt=="number"&&0<Pt?pe+Pt:pe):Pt=pe,Re){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=Pt+xe,Re={id:B++,callback:Ze,priorityLevel:Re,startTime:Pt,expirationTime:xe,sortIndex:-1},Pt>pe?(Re.sortIndex=Pt,h(I,Re),d(N)===null&&Re===d(I)&&(G?(X(Ie),Ie=-1):G=!0,ke(ae,Pt-pe))):(Re.sortIndex=xe,h(N,Re),H||F||(H=!0,nn(oe))),Re},l.unstable_shouldYield=ot,l.unstable_wrapCallback=function(Re){var Ze=U;return function(){var Pt=U;U=Ze;try{return Re.apply(this,arguments)}finally{U=Pt}}}}),f$=L((l,h)=>{h.exports=_b()}),p$=L(l=>{var h=Le(),d=f$();function g(p){for(var y="https://reactjs.org/docs/error-decoder.html?invariant="+p,A=1;A<arguments.length;A++)y+="&args[]="+encodeURIComponent(arguments[A]);return"Minified React error #"+p+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var _=new Set,b={};function S(p,y){E(p,y),E(p+"Capture",y)}function E(p,y){for(b[p]=y,p=0;p<y.length;p++)_.add(y[p])}var N=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),I=Object.prototype.hasOwnProperty,B=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,V={},U={};function F(p){return I.call(U,p)?!0:I.call(V,p)?!1:B.test(p)?U[p]=!0:(V[p]=!0,!1)}function H(p,y,A,D){if(A!==null&&A.type===0)return!1;switch(typeof y){case"function":case"symbol":return!0;case"boolean":return D?!1:A!==null?!A.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function G(p,y,A,D){if(y===null||typeof y>"u"||H(p,y,A,D))return!0;if(D)return!1;if(A!==null)switch(A.type){case 3:return!y;case 4:return y===!1;case 5:return isNaN(y);case 6:return isNaN(y)||1>y}return!1}function W(p,y,A,D,q,Q,ce){this.acceptsBooleans=y===2||y===3||y===4,this.attributeName=D,this.attributeNamespace=q,this.mustUseProperty=A,this.propertyName=p,this.type=y,this.sanitizeURL=Q,this.removeEmptyString=ce}var X={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){X[p]=new W(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var y=p[0];X[y]=new W(y,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){X[p]=new W(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){X[p]=new W(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){X[p]=new W(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){X[p]=new W(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){X[p]=new W(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){X[p]=new W(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){X[p]=new W(p,5,!1,p.toLowerCase(),null,!1,!1)});var Z=/[\-:]([a-z])/g;function te(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var y=p.replace(Z,te);X[y]=new W(y,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var y=p.replace(Z,te);X[y]=new W(y,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var y=p.replace(Z,te);X[y]=new W(y,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){X[p]=new W(p,1,!1,p.toLowerCase(),null,!1,!1)}),X.xlinkHref=new W("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){X[p]=new W(p,1,!1,p.toLowerCase(),null,!0,!0)});function ae(p,y,A,D){var q=X.hasOwnProperty(y)?X[y]:null;(q!==null?q.type!==0:D||!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(G(y,A,q,D)&&(A=null),D||q===null?F(y)&&(A===null?p.removeAttribute(y):p.setAttribute(y,""+A)):q.mustUseProperty?p[q.propertyName]=A===null?q.type===3?!1:"":A:(y=q.attributeName,D=q.attributeNamespace,A===null?p.removeAttribute(y):(q=q.type,A=q===3||q===4&&A===!0?"":""+A,D?p.setAttributeNS(D,y,A):p.setAttribute(y,A))))}var oe=h.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ue=Symbol.for("react.element"),Ee=Symbol.for("react.portal"),Ie=Symbol.for("react.fragment"),_e=Symbol.for("react.strict_mode"),Oe=Symbol.for("react.profiler"),ot=Symbol.for("react.provider"),de=Symbol.for("react.context"),Be=Symbol.for("react.forward_ref"),re=Symbol.for("react.suspense"),Ye=Symbol.for("react.suspense_list"),nn=Symbol.for("react.memo"),ke=Symbol.for("react.lazy"),Re=Symbol.for("react.offscreen"),Ze=Symbol.iterator;function Pt(p){return p===null||typeof p!="object"?null:(p=Ze&&p[Ze]||p["@@iterator"],typeof p=="function"?p:null)}var pe=Object.assign,xe;function ct(p){if(xe===void 0)try{throw Error()}catch(A){var y=A.stack.trim().match(/\n( *(at )?)/);xe=y&&y[1]||""}return`
`+xe+p}var dt=!1;function gt(p,y){if(!p||dt)return"";dt=!0;var A=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(y)if(y=function(){throw Error()},Object.defineProperty(y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(y,[])}catch(wt){var D=wt}Reflect.construct(p,[],y)}else{try{y.call()}catch(wt){D=wt}p.call(y.prototype)}else{try{throw Error()}catch(wt){D=wt}p()}}catch(wt){if(wt&&D&&typeof wt.stack=="string"){for(var q=wt.stack.split(`
`),Q=D.stack.split(`
`),ce=q.length-1,Ae=Q.length-1;1<=ce&&0<=Ae&&q[ce]!==Q[Ae];)Ae--;for(;1<=ce&&0<=Ae;ce--,Ae--)if(q[ce]!==Q[Ae]){if(ce!==1||Ae!==1)do if(ce--,Ae--,0>Ae||q[ce]!==Q[Ae]){var $e=`
`+q[ce].replace(" at new "," at ");return p.displayName&&$e.includes("<anonymous>")&&($e=$e.replace("<anonymous>",p.displayName)),$e}while(1<=ce&&0<=Ae);break}}}finally{dt=!1,Error.prepareStackTrace=A}return(p=p?p.displayName||p.name:"")?ct(p):""}function Je(p){switch(p.tag){case 5:return ct(p.type);case 16:return ct("Lazy");case 13:return ct("Suspense");case 19:return ct("SuspenseList");case 0:case 2:case 15:return p=gt(p.type,!1),p;case 11:return p=gt(p.type.render,!1),p;case 1:return p=gt(p.type,!0),p;default:return""}}function kn(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case Ie:return"Fragment";case Ee:return"Portal";case Oe:return"Profiler";case _e:return"StrictMode";case re:return"Suspense";case Ye:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case de:return(p.displayName||"Context")+".Consumer";case ot:return(p._context.displayName||"Context")+".Provider";case Be:var y=p.render;return p=p.displayName,p||(p=y.displayName||y.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case nn:return y=p.displayName||null,y!==null?y:kn(p.type)||"Memo";case ke:y=p._payload,p=p._init;try{return kn(p(y))}catch{}}return null}function Mt(p){var y=p.type;switch(p.tag){case 24:return"Cache";case 9:return(y.displayName||"Context")+".Consumer";case 10:return(y._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=y.render,p=p.displayName||p.name||"",y.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return y;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return kn(y);case 8:return y===_e?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof y=="function")return y.displayName||y.name||null;if(typeof y=="string")return y}return null}function En(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function Yn(p){var y=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(y==="checkbox"||y==="radio")}function gr(p){var y=Yn(p)?"checked":"value",A=Object.getOwnPropertyDescriptor(p.constructor.prototype,y),D=""+p[y];if(!p.hasOwnProperty(y)&&typeof A<"u"&&typeof A.get=="function"&&typeof A.set=="function"){var q=A.get,Q=A.set;return Object.defineProperty(p,y,{configurable:!0,get:function(){return q.call(this)},set:function(ce){D=""+ce,Q.call(this,ce)}}),Object.defineProperty(p,y,{enumerable:A.enumerable}),{getValue:function(){return D},setValue:function(ce){D=""+ce},stopTracking:function(){p._valueTracker=null,delete p[y]}}}}function dr(p){p._valueTracker||(p._valueTracker=gr(p))}function ki(p){if(!p)return!1;var y=p._valueTracker;if(!y)return!0;var A=y.getValue(),D="";return p&&(D=Yn(p)?p.checked?"true":"false":p.value),p=D,p!==A?(y.setValue(p),!0):!1}function ie(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function _t(p,y){var A=y.checked;return pe({},y,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:A??p._wrapperState.initialChecked})}function yt(p,y){var A=y.defaultValue==null?"":y.defaultValue,D=y.checked!=null?y.checked:y.defaultChecked;A=En(y.value!=null?y.value:A),p._wrapperState={initialChecked:D,initialValue:A,controlled:y.type==="checkbox"||y.type==="radio"?y.checked!=null:y.value!=null}}function Te(p,y){y=y.checked,y!=null&&ae(p,"checked",y,!1)}function we(p,y){Te(p,y);var A=En(y.value),D=y.type;if(A!=null)D==="number"?(A===0&&p.value===""||p.value!=A)&&(p.value=""+A):p.value!==""+A&&(p.value=""+A);else if(D==="submit"||D==="reset"){p.removeAttribute("value");return}y.hasOwnProperty("value")?Dt(p,y.type,A):y.hasOwnProperty("defaultValue")&&Dt(p,y.type,En(y.defaultValue)),y.checked==null&&y.defaultChecked!=null&&(p.defaultChecked=!!y.defaultChecked)}function et(p,y,A){if(y.hasOwnProperty("value")||y.hasOwnProperty("defaultValue")){var D=y.type;if(!(D!=="submit"&&D!=="reset"||y.value!==void 0&&y.value!==null))return;y=""+p._wrapperState.initialValue,A||y===p.value||(p.value=y),p.defaultValue=y}A=p.name,A!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,A!==""&&(p.name=A)}function Dt(p,y,A){(y!=="number"||ie(p.ownerDocument)!==p)&&(A==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+A&&(p.defaultValue=""+A))}var qt=Array.isArray;function ut(p,y,A,D){if(p=p.options,y){y={};for(var q=0;q<A.length;q++)y["$"+A[q]]=!0;for(A=0;A<p.length;A++)q=y.hasOwnProperty("$"+p[A].value),p[A].selected!==q&&(p[A].selected=q),q&&D&&(p[A].defaultSelected=!0)}else{for(A=""+En(A),y=null,q=0;q<p.length;q++){if(p[q].value===A){p[q].selected=!0,D&&(p[q].defaultSelected=!0);return}y!==null||p[q].disabled||(y=p[q])}y!==null&&(y.selected=!0)}}function rn(p,y){if(y.dangerouslySetInnerHTML!=null)throw Error(g(91));return pe({},y,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function Gt(p,y){var A=y.value;if(A==null){if(A=y.children,y=y.defaultValue,A!=null){if(y!=null)throw Error(g(92));if(qt(A)){if(1<A.length)throw Error(g(93));A=A[0]}y=A}y==null&&(y=""),A=y}p._wrapperState={initialValue:En(A)}}function Xt(p,y){var A=En(y.value),D=En(y.defaultValue);A!=null&&(A=""+A,A!==p.value&&(p.value=A),y.defaultValue==null&&p.defaultValue!==A&&(p.defaultValue=A)),D!=null&&(p.defaultValue=""+D)}function or(p){var y=p.textContent;y===p._wrapperState.initialValue&&y!==""&&y!==null&&(p.value=y)}function Mi(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Pr(p,y){return p==null||p==="http://www.w3.org/1999/xhtml"?Mi(y):p==="http://www.w3.org/2000/svg"&&y==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var ll,bg=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(y,A,D,q){MSApp.execUnsafeLocalFunction(function(){return p(y,A,D,q)})}:p}(function(p,y){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=y;else{for(ll=ll||document.createElement("div"),ll.innerHTML="<svg>"+y.valueOf().toString()+"</svg>",y=ll.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;y.firstChild;)p.appendChild(y.firstChild)}});function Rl(p,y){if(y){var A=p.firstChild;if(A&&A===p.lastChild&&A.nodeType===3){A.nodeValue=y;return}}p.textContent=y}var Oh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},no=["Webkit","ms","Moz","O"];Object.keys(Oh).forEach(function(p){no.forEach(function(y){y=y+p.charAt(0).toUpperCase()+p.substring(1),Oh[y]=Oh[p]})});function L9(p,y,A){return y==null||typeof y=="boolean"||y===""?"":A||typeof y!="number"||y===0||Oh.hasOwnProperty(p)&&Oh[p]?(""+y).trim():y+"px"}function i8(p,y){p=p.style;for(var A in y)if(y.hasOwnProperty(A)){var D=A.indexOf("--")===0,q=L9(A,y[A],D);A==="float"&&(A="cssFloat"),D?p.setProperty(A,q):p[A]=q}}var Bh=pe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function s8(p,y){if(y){if(Bh[p]&&(y.children!=null||y.dangerouslySetInnerHTML!=null))throw Error(g(137,p));if(y.dangerouslySetInnerHTML!=null){if(y.children!=null)throw Error(g(60));if(typeof y.dangerouslySetInnerHTML!="object"||!("__html"in y.dangerouslySetInnerHTML))throw Error(g(61))}if(y.style!=null&&typeof y.style!="object")throw Error(g(62))}}function hw(p,y){if(p.indexOf("-")===-1)return typeof y.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dw=null;function fw(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var o8=null,Ru=null,Lh=null;function Gve(p){if(p=Dw(p)){if(typeof o8!="function")throw Error(g(280));var y=p.stateNode;y&&(y=BD(y),o8(p.stateNode,p.type,y))}}function $ve(p){Ru?Lh?Lh.push(p):Lh=[p]:Ru=p}function Hve(){if(Ru){var p=Ru,y=Lh;if(Lh=Ru=null,Gve(p),y)for(p=0;p<y.length;p++)Gve(y[p])}}function jve(p,y){return p(y)}function Wve(){}var MX=!1;function qve(p,y,A){if(MX)return p(y,A);MX=!0;try{return jve(p,y,A)}finally{MX=!1,(Ru!==null||Lh!==null)&&(Wve(),Hve())}}function pw(p,y){var A=p.stateNode;if(A===null)return null;var D=BD(A);if(D===null)return null;A=D[y];e:switch(y){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(D=!D.disabled)||(p=p.type,D=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!D;break e;default:p=!1}if(p)return null;if(A&&typeof A!="function")throw Error(g(231,y,typeof A));return A}var CX=!1;if(N)try{a8={},Object.defineProperty(a8,"passive",{get:function(){CX=!0}}),window.addEventListener("test",a8,a8),window.removeEventListener("test",a8,a8)}catch{CX=!1}var a8;function _Ge(p,y,A,D,q,Q,ce,Ae,$e){var wt=Array.prototype.slice.call(arguments,3);try{y.apply(A,wt)}catch(an){this.onError(an)}}var mw=!1,dD=null,fD=!1,AX=null,xGe={onError:function(p){mw=!0,dD=p}};function bGe(p,y,A,D,q,Q,ce,Ae,$e){mw=!1,dD=null,_Ge.apply(xGe,arguments)}function SGe(p,y,A,D,q,Q,ce,Ae,$e){if(bGe.apply(this,arguments),mw){if(mw){var wt=dD;mw=!1,dD=null}else throw Error(g(198));fD||(fD=!0,AX=wt)}}function U9(p){var y=p,A=p;if(p.alternate)for(;y.return;)y=y.return;else{p=y;do y=p,y.flags&4098&&(A=y.return),p=y.return;while(p)}return y.tag===3?A:null}function Xve(p){if(p.tag===13){var y=p.memoizedState;if(y===null&&(p=p.alternate,p!==null&&(y=p.memoizedState)),y!==null)return y.dehydrated}return null}function Yve(p){if(U9(p)!==p)throw Error(g(188))}function wGe(p){var y=p.alternate;if(!y){if(y=U9(p),y===null)throw Error(g(188));return y!==p?null:p}for(var A=p,D=y;;){var q=A.return;if(q===null)break;var Q=q.alternate;if(Q===null){if(D=q.return,D!==null){A=D;continue}break}if(q.child===Q.child){for(Q=q.child;Q;){if(Q===A)return Yve(q),p;if(Q===D)return Yve(q),y;Q=Q.sibling}throw Error(g(188))}if(A.return!==D.return)A=q,D=Q;else{for(var ce=!1,Ae=q.child;Ae;){if(Ae===A){ce=!0,A=q,D=Q;break}if(Ae===D){ce=!0,D=q,A=Q;break}Ae=Ae.sibling}if(!ce){for(Ae=Q.child;Ae;){if(Ae===A){ce=!0,A=Q,D=q;break}if(Ae===D){ce=!0,D=Q,A=q;break}Ae=Ae.sibling}if(!ce)throw Error(g(189))}}if(A.alternate!==D)throw Error(g(190))}if(A.tag!==3)throw Error(g(188));return A.stateNode.current===A?p:y}function Kve(p){return p=wGe(p),p!==null?Zve(p):null}function Zve(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var y=Zve(p);if(y!==null)return y;p=p.sibling}return null}var Qve=d.unstable_scheduleCallback,Jve=d.unstable_cancelCallback,TGe=d.unstable_shouldYield,EGe=d.unstable_requestPaint,ko=d.unstable_now,MGe=d.unstable_getCurrentPriorityLevel,RX=d.unstable_ImmediatePriority,e8e=d.unstable_UserBlockingPriority,pD=d.unstable_NormalPriority,CGe=d.unstable_LowPriority,t8e=d.unstable_IdlePriority,mD=null,gf=null;function AGe(p){if(gf&&typeof gf.onCommitFiberRoot=="function")try{gf.onCommitFiberRoot(mD,p,void 0,(p.current.flags&128)===128)}catch{}}var Uh=Math.clz32?Math.clz32:NGe,RGe=Math.log,PGe=Math.LN2;function NGe(p){return p>>>=0,p===0?32:31-(RGe(p)/PGe|0)|0}var gD=64,yD=4194304;function gw(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function vD(p,y){var A=p.pendingLanes;if(A===0)return 0;var D=0,q=p.suspendedLanes,Q=p.pingedLanes,ce=A&268435455;if(ce!==0){var Ae=ce&~q;Ae!==0?D=gw(Ae):(Q&=ce,Q!==0&&(D=gw(Q)))}else ce=A&~q,ce!==0?D=gw(ce):Q!==0&&(D=gw(Q));if(D===0)return 0;if(y!==0&&y!==D&&!(y&q)&&(q=D&-D,Q=y&-y,q>=Q||q===16&&(Q&4194240)!==0))return y;if(D&4&&(D|=A&16),y=p.entangledLanes,y!==0)for(p=p.entanglements,y&=D;0<y;)A=31-Uh(y),q=1<<A,D|=p[A],y&=~q;return D}function IGe(p,y){switch(p){case 1:case 2:case 4:return y+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function kGe(p,y){for(var A=p.suspendedLanes,D=p.pingedLanes,q=p.expirationTimes,Q=p.pendingLanes;0<Q;){var ce=31-Uh(Q),Ae=1<<ce,$e=q[ce];$e===-1?(!(Ae&A)||Ae&D)&&(q[ce]=IGe(Ae,y)):$e<=y&&(p.expiredLanes|=Ae),Q&=~Ae}}function PX(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function n8e(){var p=gD;return gD<<=1,!(gD&4194240)&&(gD=64),p}function NX(p){for(var y=[],A=0;31>A;A++)y.push(p);return y}function yw(p,y,A){p.pendingLanes|=y,y!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,y=31-Uh(y),p[y]=A}function DGe(p,y){var A=p.pendingLanes&~y;p.pendingLanes=y,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=y,p.mutableReadLanes&=y,p.entangledLanes&=y,y=p.entanglements;var D=p.eventTimes;for(p=p.expirationTimes;0<A;){var q=31-Uh(A),Q=1<<q;y[q]=0,D[q]=-1,p[q]=-1,A&=~Q}}function IX(p,y){var A=p.entangledLanes|=y;for(p=p.entanglements;A;){var D=31-Uh(A),q=1<<D;q&y|p[D]&y&&(p[D]|=y),A&=~q}}var os=0;function r8e(p){return p&=-p,1<p?4<p?p&268435455?16:536870912:4:1}var i8e,kX,s8e,o8e,a8e,DX=!1,_D=[],Sg=null,wg=null,Tg=null,vw=new Map,_w=new Map,Eg=[],FGe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function l8e(p,y){switch(p){case"focusin":case"focusout":Sg=null;break;case"dragenter":case"dragleave":wg=null;break;case"mouseover":case"mouseout":Tg=null;break;case"pointerover":case"pointerout":vw.delete(y.pointerId);break;case"gotpointercapture":case"lostpointercapture":_w.delete(y.pointerId)}}function xw(p,y,A,D,q,Q){return p===null||p.nativeEvent!==Q?(p={blockedOn:y,domEventName:A,eventSystemFlags:D,nativeEvent:Q,targetContainers:[q]},y!==null&&(y=Dw(y),y!==null&&kX(y)),p):(p.eventSystemFlags|=D,y=p.targetContainers,q!==null&&y.indexOf(q)===-1&&y.push(q),p)}function OGe(p,y,A,D,q){switch(y){case"focusin":return Sg=xw(Sg,p,y,A,D,q),!0;case"dragenter":return wg=xw(wg,p,y,A,D,q),!0;case"mouseover":return Tg=xw(Tg,p,y,A,D,q),!0;case"pointerover":var Q=q.pointerId;return vw.set(Q,xw(vw.get(Q)||null,p,y,A,D,q)),!0;case"gotpointercapture":return Q=q.pointerId,_w.set(Q,xw(_w.get(Q)||null,p,y,A,D,q)),!0}return!1}function c8e(p){var y=z9(p.target);if(y!==null){var A=U9(y);if(A!==null){if(y=A.tag,y===13){if(y=Xve(A),y!==null){p.blockedOn=y,a8e(p.priority,function(){s8e(A)});return}}else if(y===3&&A.stateNode.current.memoizedState.isDehydrated){p.blockedOn=A.tag===3?A.stateNode.containerInfo:null;return}}}p.blockedOn=null}function xD(p){if(p.blockedOn!==null)return!1;for(var y=p.targetContainers;0<y.length;){var A=OX(p.domEventName,p.eventSystemFlags,y[0],p.nativeEvent);if(A===null){A=p.nativeEvent;var D=new A.constructor(A.type,A);dw=D,A.target.dispatchEvent(D),dw=null}else return y=Dw(A),y!==null&&kX(y),p.blockedOn=A,!1;y.shift()}return!0}function u8e(p,y,A){xD(p)&&A.delete(y)}function BGe(){DX=!1,Sg!==null&&xD(Sg)&&(Sg=null),wg!==null&&xD(wg)&&(wg=null),Tg!==null&&xD(Tg)&&(Tg=null),vw.forEach(u8e),_w.forEach(u8e)}function bw(p,y){p.blockedOn===y&&(p.blockedOn=null,DX||(DX=!0,d.unstable_scheduleCallback(d.unstable_NormalPriority,BGe)))}function Sw(p){function y(q){return bw(q,p)}if(0<_D.length){bw(_D[0],p);for(var A=1;A<_D.length;A++){var D=_D[A];D.blockedOn===p&&(D.blockedOn=null)}}for(Sg!==null&&bw(Sg,p),wg!==null&&bw(wg,p),Tg!==null&&bw(Tg,p),vw.forEach(y),_w.forEach(y),A=0;A<Eg.length;A++)D=Eg[A],D.blockedOn===p&&(D.blockedOn=null);for(;0<Eg.length&&(A=Eg[0],A.blockedOn===null);)c8e(A),A.blockedOn===null&&Eg.shift()}var l8=oe.ReactCurrentBatchConfig,bD=!0;function LGe(p,y,A,D){var q=os,Q=l8.transition;l8.transition=null;try{os=1,FX(p,y,A,D)}finally{os=q,l8.transition=Q}}function UGe(p,y,A,D){var q=os,Q=l8.transition;l8.transition=null;try{os=4,FX(p,y,A,D)}finally{os=q,l8.transition=Q}}function FX(p,y,A,D){if(bD){var q=OX(p,y,A,D);if(q===null)ZX(p,y,D,SD,A),l8e(p,D);else if(OGe(q,p,y,A,D))D.stopPropagation();else if(l8e(p,D),y&4&&-1<FGe.indexOf(p)){for(;q!==null;){var Q=Dw(q);if(Q!==null&&i8e(Q),Q=OX(p,y,A,D),Q===null&&ZX(p,y,D,SD,A),Q===q)break;q=Q}q!==null&&D.stopPropagation()}else ZX(p,y,D,null,A)}}var SD=null;function OX(p,y,A,D){if(SD=null,p=fw(D),p=z9(p),p!==null)if(y=U9(p),y===null)p=null;else if(A=y.tag,A===13){if(p=Xve(y),p!==null)return p;p=null}else if(A===3){if(y.stateNode.current.memoizedState.isDehydrated)return y.tag===3?y.stateNode.containerInfo:null;p=null}else y!==p&&(p=null);return SD=p,null}function h8e(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(MGe()){case RX:return 1;case e8e:return 4;case pD:case CGe:return 16;case t8e:return 536870912;default:return 16}default:return 16}}var Mg=null,BX=null,wD=null;function d8e(){if(wD)return wD;var p,y=BX,A=y.length,D,q="value"in Mg?Mg.value:Mg.textContent,Q=q.length;for(p=0;p<A&&y[p]===q[p];p++);var ce=A-p;for(D=1;D<=ce&&y[A-D]===q[Q-D];D++);return wD=q.slice(p,1<D?1-D:void 0)}function TD(p){var y=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&y===13&&(p=13)):p=y,p===10&&(p=13),32<=p||p===13?p:0}function ED(){return!0}function f8e(){return!1}function Pc(p){function y(A,D,q,Q,ce){this._reactName=A,this._targetInst=q,this.type=D,this.nativeEvent=Q,this.target=ce,this.currentTarget=null;for(var Ae in p)p.hasOwnProperty(Ae)&&(A=p[Ae],this[Ae]=A?A(Q):Q[Ae]);return this.isDefaultPrevented=(Q.defaultPrevented!=null?Q.defaultPrevented:Q.returnValue===!1)?ED:f8e,this.isPropagationStopped=f8e,this}return pe(y.prototype,{preventDefault:function(){this.defaultPrevented=!0;var A=this.nativeEvent;A&&(A.preventDefault?A.preventDefault():typeof A.returnValue!="unknown"&&(A.returnValue=!1),this.isDefaultPrevented=ED)},stopPropagation:function(){var A=this.nativeEvent;A&&(A.stopPropagation?A.stopPropagation():typeof A.cancelBubble!="unknown"&&(A.cancelBubble=!0),this.isPropagationStopped=ED)},persist:function(){},isPersistent:ED}),y}var c8={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},LX=Pc(c8),ww=pe({},c8,{view:0,detail:0}),zGe=Pc(ww),UX,zX,Tw,MD=pe({},ww,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:GX,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==Tw&&(Tw&&p.type==="mousemove"?(UX=p.screenX-Tw.screenX,zX=p.screenY-Tw.screenY):zX=UX=0,Tw=p),UX)},movementY:function(p){return"movementY"in p?p.movementY:zX}}),p8e=Pc(MD),VGe=pe({},MD,{dataTransfer:0}),GGe=Pc(VGe),$Ge=pe({},ww,{relatedTarget:0}),VX=Pc($Ge),HGe=pe({},c8,{animationName:0,elapsedTime:0,pseudoElement:0}),jGe=Pc(HGe),WGe=pe({},c8,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),qGe=Pc(WGe),XGe=pe({},c8,{data:0}),m8e=Pc(XGe),YGe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},KGe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ZGe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function QGe(p){var y=this.nativeEvent;return y.getModifierState?y.getModifierState(p):(p=ZGe[p])?!!y[p]:!1}function GX(){return QGe}var JGe=pe({},ww,{key:function(p){if(p.key){var y=YGe[p.key]||p.key;if(y!=="Unidentified")return y}return p.type==="keypress"?(p=TD(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?KGe[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:GX,charCode:function(p){return p.type==="keypress"?TD(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?TD(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),e$e=Pc(JGe),t$e=pe({},MD,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),g8e=Pc(t$e),n$e=pe({},ww,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:GX}),r$e=Pc(n$e),i$e=pe({},c8,{propertyName:0,elapsedTime:0,pseudoElement:0}),s$e=Pc(i$e),o$e=pe({},MD,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),a$e=Pc(o$e),l$e=[9,13,27,32],$X=N&&"CompositionEvent"in window,Ew=null;N&&"documentMode"in document&&(Ew=document.documentMode);var c$e=N&&"TextEvent"in window&&!Ew,y8e=N&&(!$X||Ew&&8<Ew&&11>=Ew),v8e=String.fromCharCode(32),_8e=!1;function x8e(p,y){switch(p){case"keyup":return l$e.indexOf(y.keyCode)!==-1;case"keydown":return y.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function b8e(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var u8=!1;function u$e(p,y){switch(p){case"compositionend":return b8e(y);case"keypress":return y.which!==32?null:(_8e=!0,v8e);case"textInput":return p=y.data,p===v8e&&_8e?null:p;default:return null}}function h$e(p,y){if(u8)return p==="compositionend"||!$X&&x8e(p,y)?(p=d8e(),wD=BX=Mg=null,u8=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(y.ctrlKey||y.altKey||y.metaKey)||y.ctrlKey&&y.altKey){if(y.char&&1<y.char.length)return y.char;if(y.which)return String.fromCharCode(y.which)}return null;case"compositionend":return y8e&&y.locale!=="ko"?null:y.data;default:return null}}var d$e={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function S8e(p){var y=p&&p.nodeName&&p.nodeName.toLowerCase();return y==="input"?!!d$e[p.type]:y==="textarea"}function w8e(p,y,A,D){$ve(D),y=DD(y,"onChange"),0<y.length&&(A=new LX("onChange","change",null,A,D),p.push({event:A,listeners:y}))}var Mw=null,Cw=null;function f$e(p){G8e(p,0)}function CD(p){var y=m8(p);if(ki(y))return p}function p$e(p,y){if(p==="change")return y}var T8e=!1;N&&(N?(AD="oninput"in document,AD||(jX=document.createElement("div"),jX.setAttribute("oninput","return;"),AD=typeof jX.oninput=="function"),HX=AD):HX=!1,T8e=HX&&(!document.documentMode||9<document.documentMode));var HX,AD,jX;function E8e(){Mw&&(Mw.detachEvent("onpropertychange",M8e),Cw=Mw=null)}function M8e(p){if(p.propertyName==="value"&&CD(Cw)){var y=[];w8e(y,Cw,p,fw(p)),qve(f$e,y)}}function m$e(p,y,A){p==="focusin"?(E8e(),Mw=y,Cw=A,Mw.attachEvent("onpropertychange",M8e)):p==="focusout"&&E8e()}function g$e(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return CD(Cw)}function y$e(p,y){if(p==="click")return CD(y)}function v$e(p,y){if(p==="input"||p==="change")return CD(y)}function _$e(p,y){return p===y&&(p!==0||1/p===1/y)||p!==p&&y!==y}var zh=typeof Object.is=="function"?Object.is:_$e;function Aw(p,y){if(zh(p,y))return!0;if(typeof p!="object"||p===null||typeof y!="object"||y===null)return!1;var A=Object.keys(p),D=Object.keys(y);if(A.length!==D.length)return!1;for(D=0;D<A.length;D++){var q=A[D];if(!I.call(y,q)||!zh(p[q],y[q]))return!1}return!0}function C8e(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function A8e(p,y){var A=C8e(p);p=0;for(var D;A;){if(A.nodeType===3){if(D=p+A.textContent.length,p<=y&&D>=y)return{node:A,offset:y-p};p=D}e:{for(;A;){if(A.nextSibling){A=A.nextSibling;break e}A=A.parentNode}A=void 0}A=C8e(A)}}function R8e(p,y){return p&&y?p===y?!0:p&&p.nodeType===3?!1:y&&y.nodeType===3?R8e(p,y.parentNode):"contains"in p?p.contains(y):p.compareDocumentPosition?!!(p.compareDocumentPosition(y)&16):!1:!1}function P8e(){for(var p=window,y=ie();y instanceof p.HTMLIFrameElement;){try{var A=typeof y.contentWindow.location.href=="string"}catch{A=!1}if(A)p=y.contentWindow;else break;y=ie(p.document)}return y}function WX(p){var y=p&&p.nodeName&&p.nodeName.toLowerCase();return y&&(y==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||y==="textarea"||p.contentEditable==="true")}function x$e(p){var y=P8e(),A=p.focusedElem,D=p.selectionRange;if(y!==A&&A&&A.ownerDocument&&R8e(A.ownerDocument.documentElement,A)){if(D!==null&&WX(A)){if(y=D.start,p=D.end,p===void 0&&(p=y),"selectionStart"in A)A.selectionStart=y,A.selectionEnd=Math.min(p,A.value.length);else if(p=(y=A.ownerDocument||document)&&y.defaultView||window,p.getSelection){p=p.getSelection();var q=A.textContent.length,Q=Math.min(D.start,q);D=D.end===void 0?Q:Math.min(D.end,q),!p.extend&&Q>D&&(q=D,D=Q,Q=q),q=A8e(A,Q);var ce=A8e(A,D);q&&ce&&(p.rangeCount!==1||p.anchorNode!==q.node||p.anchorOffset!==q.offset||p.focusNode!==ce.node||p.focusOffset!==ce.offset)&&(y=y.createRange(),y.setStart(q.node,q.offset),p.removeAllRanges(),Q>D?(p.addRange(y),p.extend(ce.node,ce.offset)):(y.setEnd(ce.node,ce.offset),p.addRange(y)))}}for(y=[],p=A;p=p.parentNode;)p.nodeType===1&&y.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof A.focus=="function"&&A.focus(),A=0;A<y.length;A++)p=y[A],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var b$e=N&&"documentMode"in document&&11>=document.documentMode,h8=null,qX=null,Rw=null,XX=!1;function N8e(p,y,A){var D=A.window===A?A.document:A.nodeType===9?A:A.ownerDocument;XX||h8==null||h8!==ie(D)||(D=h8,"selectionStart"in D&&WX(D)?D={start:D.selectionStart,end:D.selectionEnd}:(D=(D.ownerDocument&&D.ownerDocument.defaultView||window).getSelection(),D={anchorNode:D.anchorNode,anchorOffset:D.anchorOffset,focusNode:D.focusNode,focusOffset:D.focusOffset}),Rw&&Aw(Rw,D)||(Rw=D,D=DD(qX,"onSelect"),0<D.length&&(y=new LX("onSelect","select",null,y,A),p.push({event:y,listeners:D}),y.target=h8)))}function RD(p,y){var A={};return A[p.toLowerCase()]=y.toLowerCase(),A["Webkit"+p]="webkit"+y,A["Moz"+p]="moz"+y,A}var d8={animationend:RD("Animation","AnimationEnd"),animationiteration:RD("Animation","AnimationIteration"),animationstart:RD("Animation","AnimationStart"),transitionend:RD("Transition","TransitionEnd")},YX={},I8e={};N&&(I8e=document.createElement("div").style,"AnimationEvent"in window||(delete d8.animationend.animation,delete d8.animationiteration.animation,delete d8.animationstart.animation),"TransitionEvent"in window||delete d8.transitionend.transition);function PD(p){if(YX[p])return YX[p];if(!d8[p])return p;var y=d8[p],A;for(A in y)if(y.hasOwnProperty(A)&&A in I8e)return YX[p]=y[A];return p}var k8e=PD("animationend"),D8e=PD("animationiteration"),F8e=PD("animationstart"),O8e=PD("transitionend"),B8e=new Map,L8e="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cg(p,y){B8e.set(p,y),S(y,[p])}for(ID=0;ID<L8e.length;ID++)ND=L8e[ID],U8e=ND.toLowerCase(),z8e=ND[0].toUpperCase()+ND.slice(1),Cg(U8e,"on"+z8e);var ND,U8e,z8e,ID;Cg(k8e,"onAnimationEnd"),Cg(D8e,"onAnimationIteration"),Cg(F8e,"onAnimationStart"),Cg("dblclick","onDoubleClick"),Cg("focusin","onFocus"),Cg("focusout","onBlur"),Cg(O8e,"onTransitionEnd"),E("onMouseEnter",["mouseout","mouseover"]),E("onMouseLeave",["mouseout","mouseover"]),E("onPointerEnter",["pointerout","pointerover"]),E("onPointerLeave",["pointerout","pointerover"]),S("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),S("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),S("onBeforeInput",["compositionend","keypress","textInput","paste"]),S("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),S("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),S("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pw="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),S$e=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pw));function V8e(p,y,A){var D=p.type||"unknown-event";p.currentTarget=A,SGe(D,y,void 0,p),p.currentTarget=null}function G8e(p,y){y=(y&4)!==0;for(var A=0;A<p.length;A++){var D=p[A],q=D.event;D=D.listeners;e:{var Q=void 0;if(y)for(var ce=D.length-1;0<=ce;ce--){var Ae=D[ce],$e=Ae.instance,wt=Ae.currentTarget;if(Ae=Ae.listener,$e!==Q&&q.isPropagationStopped())break e;V8e(q,Ae,wt),Q=$e}else for(ce=0;ce<D.length;ce++){if(Ae=D[ce],$e=Ae.instance,wt=Ae.currentTarget,Ae=Ae.listener,$e!==Q&&q.isPropagationStopped())break e;V8e(q,Ae,wt),Q=$e}}}if(fD)throw p=AX,fD=!1,AX=null,p}function Os(p,y){var A=y[rY];A===void 0&&(A=y[rY]=new Set);var D=p+"__bubble";A.has(D)||($8e(y,p,2,!1),A.add(D))}function KX(p,y,A){var D=0;y&&(D|=4),$8e(A,p,D,y)}var kD="_reactListening"+Math.random().toString(36).slice(2);function Nw(p){if(!p[kD]){p[kD]=!0,_.forEach(function(A){A!=="selectionchange"&&(S$e.has(A)||KX(A,!1,p),KX(A,!0,p))});var y=p.nodeType===9?p:p.ownerDocument;y===null||y[kD]||(y[kD]=!0,KX("selectionchange",!1,y))}}function $8e(p,y,A,D){switch(h8e(y)){case 1:var q=LGe;break;case 4:q=UGe;break;default:q=FX}A=q.bind(null,y,A,p),q=void 0,!CX||y!=="touchstart"&&y!=="touchmove"&&y!=="wheel"||(q=!0),D?q!==void 0?p.addEventListener(y,A,{capture:!0,passive:q}):p.addEventListener(y,A,!0):q!==void 0?p.addEventListener(y,A,{passive:q}):p.addEventListener(y,A,!1)}function ZX(p,y,A,D,q){var Q=D;if(!(y&1)&&!(y&2)&&D!==null)e:for(;;){if(D===null)return;var ce=D.tag;if(ce===3||ce===4){var Ae=D.stateNode.containerInfo;if(Ae===q||Ae.nodeType===8&&Ae.parentNode===q)break;if(ce===4)for(ce=D.return;ce!==null;){var $e=ce.tag;if(($e===3||$e===4)&&($e=ce.stateNode.containerInfo,$e===q||$e.nodeType===8&&$e.parentNode===q))return;ce=ce.return}for(;Ae!==null;){if(ce=z9(Ae),ce===null)return;if($e=ce.tag,$e===5||$e===6){D=Q=ce;continue e}Ae=Ae.parentNode}}D=D.return}qve(function(){var wt=Q,an=fw(A),fn=[];e:{var sn=B8e.get(p);if(sn!==void 0){var Gn=LX,Kn=p;switch(p){case"keypress":if(TD(A)===0)break e;case"keydown":case"keyup":Gn=e$e;break;case"focusin":Kn="focus",Gn=VX;break;case"focusout":Kn="blur",Gn=VX;break;case"beforeblur":case"afterblur":Gn=VX;break;case"click":if(A.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Gn=p8e;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Gn=GGe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Gn=r$e;break;case k8e:case D8e:case F8e:Gn=jGe;break;case O8e:Gn=s$e;break;case"scroll":Gn=zGe;break;case"wheel":Gn=a$e;break;case"copy":case"cut":case"paste":Gn=qGe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Gn=g8e}var nr=(y&4)!==0,Do=!nr&&p==="scroll",ht=nr?sn!==null?sn+"Capture":null:sn;nr=[];for(var Ke=wt,pt;Ke!==null;){pt=Ke;var vn=pt.stateNode;if(pt.tag===5&&vn!==null&&(pt=vn,ht!==null&&(vn=pw(Ke,ht),vn!=null&&nr.push(Iw(Ke,vn,pt)))),Do)break;Ke=Ke.return}0<nr.length&&(sn=new Gn(sn,Kn,null,A,an),fn.push({event:sn,listeners:nr}))}}if(!(y&7)){e:{if(sn=p==="mouseover"||p==="pointerover",Gn=p==="mouseout"||p==="pointerout",sn&&A!==dw&&(Kn=A.relatedTarget||A.fromElement)&&(z9(Kn)||Kn[Xp]))break e;if((Gn||sn)&&(sn=an.window===an?an:(sn=an.ownerDocument)?sn.defaultView||sn.parentWindow:window,Gn?(Kn=A.relatedTarget||A.toElement,Gn=wt,Kn=Kn?z9(Kn):null,Kn!==null&&(Do=U9(Kn),Kn!==Do||Kn.tag!==5&&Kn.tag!==6)&&(Kn=null)):(Gn=null,Kn=wt),Gn!==Kn)){if(nr=p8e,vn="onMouseLeave",ht="onMouseEnter",Ke="mouse",(p==="pointerout"||p==="pointerover")&&(nr=g8e,vn="onPointerLeave",ht="onPointerEnter",Ke="pointer"),Do=Gn==null?sn:m8(Gn),pt=Kn==null?sn:m8(Kn),sn=new nr(vn,Ke+"leave",Gn,A,an),sn.target=Do,sn.relatedTarget=pt,vn=null,z9(an)===wt&&(nr=new nr(ht,Ke+"enter",Kn,A,an),nr.target=pt,nr.relatedTarget=Do,vn=nr),Do=vn,Gn&&Kn)t:{for(nr=Gn,ht=Kn,Ke=0,pt=nr;pt;pt=f8(pt))Ke++;for(pt=0,vn=ht;vn;vn=f8(vn))pt++;for(;0<Ke-pt;)nr=f8(nr),Ke--;for(;0<pt-Ke;)ht=f8(ht),pt--;for(;Ke--;){if(nr===ht||ht!==null&&nr===ht.alternate)break t;nr=f8(nr),ht=f8(ht)}nr=null}else nr=null;Gn!==null&&H8e(fn,sn,Gn,nr,!1),Kn!==null&&Do!==null&&H8e(fn,Do,Kn,nr,!0)}}e:{if(sn=wt?m8(wt):window,Gn=sn.nodeName&&sn.nodeName.toLowerCase(),Gn==="select"||Gn==="input"&&sn.type==="file")var sr=p$e;else if(S8e(sn))if(T8e)sr=v$e;else{sr=g$e;var _r=m$e}else(Gn=sn.nodeName)&&Gn.toLowerCase()==="input"&&(sn.type==="checkbox"||sn.type==="radio")&&(sr=y$e);if(sr&&(sr=sr(p,wt))){w8e(fn,sr,A,an);break e}_r&&_r(p,sn,wt),p==="focusout"&&(_r=sn._wrapperState)&&_r.controlled&&sn.type==="number"&&Dt(sn,"number",sn.value)}switch(_r=wt?m8(wt):window,p){case"focusin":(S8e(_r)||_r.contentEditable==="true")&&(h8=_r,qX=wt,Rw=null);break;case"focusout":Rw=qX=h8=null;break;case"mousedown":XX=!0;break;case"contextmenu":case"mouseup":case"dragend":XX=!1,N8e(fn,A,an);break;case"selectionchange":if(b$e)break;case"keydown":case"keyup":N8e(fn,A,an)}var xr;if($X)e:{switch(p){case"compositionstart":var Nr="onCompositionStart";break e;case"compositionend":Nr="onCompositionEnd";break e;case"compositionupdate":Nr="onCompositionUpdate";break e}Nr=void 0}else u8?x8e(p,A)&&(Nr="onCompositionEnd"):p==="keydown"&&A.keyCode===229&&(Nr="onCompositionStart");Nr&&(y8e&&A.locale!=="ko"&&(u8||Nr!=="onCompositionStart"?Nr==="onCompositionEnd"&&u8&&(xr=d8e()):(Mg=an,BX="value"in Mg?Mg.value:Mg.textContent,u8=!0)),_r=DD(wt,Nr),0<_r.length&&(Nr=new m8e(Nr,p,null,A,an),fn.push({event:Nr,listeners:_r}),xr?Nr.data=xr:(xr=b8e(A),xr!==null&&(Nr.data=xr)))),(xr=c$e?u$e(p,A):h$e(p,A))&&(wt=DD(wt,"onBeforeInput"),0<wt.length&&(an=new m8e("onBeforeInput","beforeinput",null,A,an),fn.push({event:an,listeners:wt}),an.data=xr))}G8e(fn,y)})}function Iw(p,y,A){return{instance:p,listener:y,currentTarget:A}}function DD(p,y){for(var A=y+"Capture",D=[];p!==null;){var q=p,Q=q.stateNode;q.tag===5&&Q!==null&&(q=Q,Q=pw(p,A),Q!=null&&D.unshift(Iw(p,Q,q)),Q=pw(p,y),Q!=null&&D.push(Iw(p,Q,q))),p=p.return}return D}function f8(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function H8e(p,y,A,D,q){for(var Q=y._reactName,ce=[];A!==null&&A!==D;){var Ae=A,$e=Ae.alternate,wt=Ae.stateNode;if($e!==null&&$e===D)break;Ae.tag===5&&wt!==null&&(Ae=wt,q?($e=pw(A,Q),$e!=null&&ce.unshift(Iw(A,$e,Ae))):q||($e=pw(A,Q),$e!=null&&ce.push(Iw(A,$e,Ae)))),A=A.return}ce.length!==0&&p.push({event:y,listeners:ce})}var w$e=/\r\n?/g,T$e=/\u0000|\uFFFD/g;function j8e(p){return(typeof p=="string"?p:""+p).replace(w$e,`
`).replace(T$e,"")}function FD(p,y,A){if(y=j8e(y),j8e(p)!==y&&A)throw Error(g(425))}function OD(){}var QX=null,JX=null;function eY(p,y){return p==="textarea"||p==="noscript"||typeof y.children=="string"||typeof y.children=="number"||typeof y.dangerouslySetInnerHTML=="object"&&y.dangerouslySetInnerHTML!==null&&y.dangerouslySetInnerHTML.__html!=null}var tY=typeof setTimeout=="function"?setTimeout:void 0,E$e=typeof clearTimeout=="function"?clearTimeout:void 0,W8e=typeof Promise=="function"?Promise:void 0,M$e=typeof queueMicrotask=="function"?queueMicrotask:typeof W8e<"u"?function(p){return W8e.resolve(null).then(p).catch(C$e)}:tY;function C$e(p){setTimeout(function(){throw p})}function nY(p,y){var A=y,D=0;do{var q=A.nextSibling;if(p.removeChild(A),q&&q.nodeType===8)if(A=q.data,A==="/$"){if(D===0){p.removeChild(q),Sw(y);return}D--}else A!=="$"&&A!=="$?"&&A!=="$!"||D++;A=q}while(A);Sw(y)}function Ag(p){for(;p!=null;p=p.nextSibling){var y=p.nodeType;if(y===1||y===3)break;if(y===8){if(y=p.data,y==="$"||y==="$!"||y==="$?")break;if(y==="/$")return null}}return p}function q8e(p){p=p.previousSibling;for(var y=0;p;){if(p.nodeType===8){var A=p.data;if(A==="$"||A==="$!"||A==="$?"){if(y===0)return p;y--}else A==="/$"&&y++}p=p.previousSibling}return null}var p8=Math.random().toString(36).slice(2),yf="__reactFiber$"+p8,kw="__reactProps$"+p8,Xp="__reactContainer$"+p8,rY="__reactEvents$"+p8,A$e="__reactListeners$"+p8,R$e="__reactHandles$"+p8;function z9(p){var y=p[yf];if(y)return y;for(var A=p.parentNode;A;){if(y=A[Xp]||A[yf]){if(A=y.alternate,y.child!==null||A!==null&&A.child!==null)for(p=q8e(p);p!==null;){if(A=p[yf])return A;p=q8e(p)}return y}p=A,A=p.parentNode}return null}function Dw(p){return p=p[yf]||p[Xp],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function m8(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(g(33))}function BD(p){return p[kw]||null}var iY=[],g8=-1;function Rg(p){return{current:p}}function Bs(p){0>g8||(p.current=iY[g8],iY[g8]=null,g8--)}function Ms(p,y){g8++,iY[g8]=p.current,p.current=y}var Pg={},Pl=Rg(Pg),Y0=Rg(!1),V9=Pg;function y8(p,y){var A=p.type.contextTypes;if(!A)return Pg;var D=p.stateNode;if(D&&D.__reactInternalMemoizedUnmaskedChildContext===y)return D.__reactInternalMemoizedMaskedChildContext;var q={},Q;for(Q in A)q[Q]=y[Q];return D&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=y,p.__reactInternalMemoizedMaskedChildContext=q),q}function K0(p){return p=p.childContextTypes,p!=null}function LD(){Bs(Y0),Bs(Pl)}function X8e(p,y,A){if(Pl.current!==Pg)throw Error(g(168));Ms(Pl,y),Ms(Y0,A)}function Y8e(p,y,A){var D=p.stateNode;if(y=y.childContextTypes,typeof D.getChildContext!="function")return A;D=D.getChildContext();for(var q in D)if(!(q in y))throw Error(g(108,Mt(p)||"Unknown",q));return pe({},A,D)}function UD(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Pg,V9=Pl.current,Ms(Pl,p),Ms(Y0,Y0.current),!0}function K8e(p,y,A){var D=p.stateNode;if(!D)throw Error(g(169));A?(p=Y8e(p,y,V9),D.__reactInternalMemoizedMergedChildContext=p,Bs(Y0),Bs(Pl),Ms(Pl,p)):Bs(Y0),Ms(Y0,A)}var Yp=null,zD=!1,sY=!1;function Z8e(p){Yp===null?Yp=[p]:Yp.push(p)}function P$e(p){zD=!0,Z8e(p)}function Ng(){if(!sY&&Yp!==null){sY=!0;var p=0,y=os;try{var A=Yp;for(os=1;p<A.length;p++){var D=A[p];do D=D(!0);while(D!==null)}Yp=null,zD=!1}catch(q){throw Yp!==null&&(Yp=Yp.slice(p+1)),Qve(RX,Ng),q}finally{os=y,sY=!1}}return null}var v8=[],_8=0,VD=null,GD=0,Pu=[],Nu=0,G9=null,Kp=1,Zp="";function $9(p,y){v8[_8++]=GD,v8[_8++]=VD,VD=p,GD=y}function Q8e(p,y,A){Pu[Nu++]=Kp,Pu[Nu++]=Zp,Pu[Nu++]=G9,G9=p;var D=Kp;p=Zp;var q=32-Uh(D)-1;D&=~(1<<q),A+=1;var Q=32-Uh(y)+q;if(30<Q){var ce=q-q%5;Q=(D&(1<<ce)-1).toString(32),D>>=ce,q-=ce,Kp=1<<32-Uh(y)+q|A<<q|D,Zp=Q+p}else Kp=1<<Q|A<<q|D,Zp=p}function oY(p){p.return!==null&&($9(p,1),Q8e(p,1,0))}function aY(p){for(;p===VD;)VD=v8[--_8],v8[_8]=null,GD=v8[--_8],v8[_8]=null;for(;p===G9;)G9=Pu[--Nu],Pu[Nu]=null,Zp=Pu[--Nu],Pu[Nu]=null,Kp=Pu[--Nu],Pu[Nu]=null}var Nc=null,Ic=null,Ws=!1,Vh=null;function J8e(p,y){var A=Fu(5,null,null,0);A.elementType="DELETED",A.stateNode=y,A.return=p,y=p.deletions,y===null?(p.deletions=[A],p.flags|=16):y.push(A)}function e6e(p,y){switch(p.tag){case 5:var A=p.type;return y=y.nodeType!==1||A.toLowerCase()!==y.nodeName.toLowerCase()?null:y,y!==null?(p.stateNode=y,Nc=p,Ic=Ag(y.firstChild),!0):!1;case 6:return y=p.pendingProps===""||y.nodeType!==3?null:y,y!==null?(p.stateNode=y,Nc=p,Ic=null,!0):!1;case 13:return y=y.nodeType!==8?null:y,y!==null?(A=G9!==null?{id:Kp,overflow:Zp}:null,p.memoizedState={dehydrated:y,treeContext:A,retryLane:1073741824},A=Fu(18,null,null,0),A.stateNode=y,A.return=p,p.child=A,Nc=p,Ic=null,!0):!1;default:return!1}}function lY(p){return(p.mode&1)!==0&&(p.flags&128)===0}function cY(p){if(Ws){var y=Ic;if(y){var A=y;if(!e6e(p,y)){if(lY(p))throw Error(g(418));y=Ag(A.nextSibling);var D=Nc;y&&e6e(p,y)?J8e(D,A):(p.flags=p.flags&-4097|2,Ws=!1,Nc=p)}}else{if(lY(p))throw Error(g(418));p.flags=p.flags&-4097|2,Ws=!1,Nc=p}}}function t6e(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;Nc=p}function $D(p){if(p!==Nc)return!1;if(!Ws)return t6e(p),Ws=!0,!1;var y;if((y=p.tag!==3)&&!(y=p.tag!==5)&&(y=p.type,y=y!=="head"&&y!=="body"&&!eY(p.type,p.memoizedProps)),y&&(y=Ic)){if(lY(p))throw n6e(),Error(g(418));for(;y;)J8e(p,y),y=Ag(y.nextSibling)}if(t6e(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(g(317));e:{for(p=p.nextSibling,y=0;p;){if(p.nodeType===8){var A=p.data;if(A==="/$"){if(y===0){Ic=Ag(p.nextSibling);break e}y--}else A!=="$"&&A!=="$!"&&A!=="$?"||y++}p=p.nextSibling}Ic=null}}else Ic=Nc?Ag(p.stateNode.nextSibling):null;return!0}function n6e(){for(var p=Ic;p;)p=Ag(p.nextSibling)}function x8(){Ic=Nc=null,Ws=!1}function uY(p){Vh===null?Vh=[p]:Vh.push(p)}var N$e=oe.ReactCurrentBatchConfig;function Gh(p,y){if(p&&p.defaultProps){y=pe({},y),p=p.defaultProps;for(var A in p)y[A]===void 0&&(y[A]=p[A]);return y}return y}var HD=Rg(null),jD=null,b8=null,hY=null;function dY(){hY=b8=jD=null}function fY(p){var y=HD.current;Bs(HD),p._currentValue=y}function pY(p,y,A){for(;p!==null;){var D=p.alternate;if((p.childLanes&y)!==y?(p.childLanes|=y,D!==null&&(D.childLanes|=y)):D!==null&&(D.childLanes&y)!==y&&(D.childLanes|=y),p===A)break;p=p.return}}function S8(p,y){jD=p,hY=b8=null,p=p.dependencies,p!==null&&p.firstContext!==null&&(p.lanes&y&&(Z0=!0),p.firstContext=null)}function Iu(p){var y=p._currentValue;if(hY!==p)if(p={context:p,memoizedValue:y,next:null},b8===null){if(jD===null)throw Error(g(308));b8=p,jD.dependencies={lanes:0,firstContext:p}}else b8=b8.next=p;return y}var H9=null;function mY(p){H9===null?H9=[p]:H9.push(p)}function r6e(p,y,A,D){var q=y.interleaved;return q===null?(A.next=A,mY(y)):(A.next=q.next,q.next=A),y.interleaved=A,Qp(p,D)}function Qp(p,y){p.lanes|=y;var A=p.alternate;for(A!==null&&(A.lanes|=y),A=p,p=p.return;p!==null;)p.childLanes|=y,A=p.alternate,A!==null&&(A.childLanes|=y),A=p,p=p.return;return A.tag===3?A.stateNode:null}var Ig=!1;function gY(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function i6e(p,y){p=p.updateQueue,y.updateQueue===p&&(y.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Jp(p,y){return{eventTime:p,lane:y,tag:0,payload:null,callback:null,next:null}}function kg(p,y,A){var D=p.updateQueue;if(D===null)return null;if(D=D.shared,Ci&2){var q=D.pending;return q===null?y.next=y:(y.next=q.next,q.next=y),D.pending=y,Qp(p,A)}return q=D.interleaved,q===null?(y.next=y,mY(D)):(y.next=q.next,q.next=y),D.interleaved=y,Qp(p,A)}function WD(p,y,A){if(y=y.updateQueue,y!==null&&(y=y.shared,(A&4194240)!==0)){var D=y.lanes;D&=p.pendingLanes,A|=D,y.lanes=A,IX(p,A)}}function s6e(p,y){var A=p.updateQueue,D=p.alternate;if(D!==null&&(D=D.updateQueue,A===D)){var q=null,Q=null;if(A=A.firstBaseUpdate,A!==null){do{var ce={eventTime:A.eventTime,lane:A.lane,tag:A.tag,payload:A.payload,callback:A.callback,next:null};Q===null?q=Q=ce:Q=Q.next=ce,A=A.next}while(A!==null);Q===null?q=Q=y:Q=Q.next=y}else q=Q=y;A={baseState:D.baseState,firstBaseUpdate:q,lastBaseUpdate:Q,shared:D.shared,effects:D.effects},p.updateQueue=A;return}p=A.lastBaseUpdate,p===null?A.firstBaseUpdate=y:p.next=y,A.lastBaseUpdate=y}function qD(p,y,A,D){var q=p.updateQueue;Ig=!1;var Q=q.firstBaseUpdate,ce=q.lastBaseUpdate,Ae=q.shared.pending;if(Ae!==null){q.shared.pending=null;var $e=Ae,wt=$e.next;$e.next=null,ce===null?Q=wt:ce.next=wt,ce=$e;var an=p.alternate;an!==null&&(an=an.updateQueue,Ae=an.lastBaseUpdate,Ae!==ce&&(Ae===null?an.firstBaseUpdate=wt:Ae.next=wt,an.lastBaseUpdate=$e))}if(Q!==null){var fn=q.baseState;ce=0,an=wt=$e=null,Ae=Q;do{var sn=Ae.lane,Gn=Ae.eventTime;if((D&sn)===sn){an!==null&&(an=an.next={eventTime:Gn,lane:0,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null});e:{var Kn=p,nr=Ae;switch(sn=y,Gn=A,nr.tag){case 1:if(Kn=nr.payload,typeof Kn=="function"){fn=Kn.call(Gn,fn,sn);break e}fn=Kn;break e;case 3:Kn.flags=Kn.flags&-65537|128;case 0:if(Kn=nr.payload,sn=typeof Kn=="function"?Kn.call(Gn,fn,sn):Kn,sn==null)break e;fn=pe({},fn,sn);break e;case 2:Ig=!0}}Ae.callback!==null&&Ae.lane!==0&&(p.flags|=64,sn=q.effects,sn===null?q.effects=[Ae]:sn.push(Ae))}else Gn={eventTime:Gn,lane:sn,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null},an===null?(wt=an=Gn,$e=fn):an=an.next=Gn,ce|=sn;if(Ae=Ae.next,Ae===null){if(Ae=q.shared.pending,Ae===null)break;sn=Ae,Ae=sn.next,sn.next=null,q.lastBaseUpdate=sn,q.shared.pending=null}}while(1);if(an===null&&($e=fn),q.baseState=$e,q.firstBaseUpdate=wt,q.lastBaseUpdate=an,y=q.shared.interleaved,y!==null){q=y;do ce|=q.lane,q=q.next;while(q!==y)}else Q===null&&(q.shared.lanes=0);q9|=ce,p.lanes=ce,p.memoizedState=fn}}function o6e(p,y,A){if(p=y.effects,y.effects=null,p!==null)for(y=0;y<p.length;y++){var D=p[y],q=D.callback;if(q!==null){if(D.callback=null,D=A,typeof q!="function")throw Error(g(191,q));q.call(D)}}}var a6e=new h.Component().refs;function yY(p,y,A,D){y=p.memoizedState,A=A(D,y),A=A==null?y:pe({},y,A),p.memoizedState=A,p.lanes===0&&(p.updateQueue.baseState=A)}var XD={isMounted:function(p){return(p=p._reactInternals)?U9(p)===p:!1},enqueueSetState:function(p,y,A){p=p._reactInternals;var D=y0(),q=Bg(p),Q=Jp(D,q);Q.payload=y,A!=null&&(Q.callback=A),y=kg(p,Q,q),y!==null&&(jh(y,p,q,D),WD(y,p,q))},enqueueReplaceState:function(p,y,A){p=p._reactInternals;var D=y0(),q=Bg(p),Q=Jp(D,q);Q.tag=1,Q.payload=y,A!=null&&(Q.callback=A),y=kg(p,Q,q),y!==null&&(jh(y,p,q,D),WD(y,p,q))},enqueueForceUpdate:function(p,y){p=p._reactInternals;var A=y0(),D=Bg(p),q=Jp(A,D);q.tag=2,y!=null&&(q.callback=y),y=kg(p,q,D),y!==null&&(jh(y,p,D,A),WD(y,p,D))}};function l6e(p,y,A,D,q,Q,ce){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(D,Q,ce):y.prototype&&y.prototype.isPureReactComponent?!Aw(A,D)||!Aw(q,Q):!0}function c6e(p,y,A){var D=!1,q=Pg,Q=y.contextType;return typeof Q=="object"&&Q!==null?Q=Iu(Q):(q=K0(y)?V9:Pl.current,D=y.contextTypes,Q=(D=D!=null)?y8(p,q):Pg),y=new y(A,Q),p.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=XD,p.stateNode=y,y._reactInternals=p,D&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=q,p.__reactInternalMemoizedMaskedChildContext=Q),y}function u6e(p,y,A,D){p=y.state,typeof y.componentWillReceiveProps=="function"&&y.componentWillReceiveProps(A,D),typeof y.UNSAFE_componentWillReceiveProps=="function"&&y.UNSAFE_componentWillReceiveProps(A,D),y.state!==p&&XD.enqueueReplaceState(y,y.state,null)}function vY(p,y,A,D){var q=p.stateNode;q.props=A,q.state=p.memoizedState,q.refs=a6e,gY(p);var Q=y.contextType;typeof Q=="object"&&Q!==null?q.context=Iu(Q):(Q=K0(y)?V9:Pl.current,q.context=y8(p,Q)),q.state=p.memoizedState,Q=y.getDerivedStateFromProps,typeof Q=="function"&&(yY(p,y,Q,A),q.state=p.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof q.getSnapshotBeforeUpdate=="function"||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(y=q.state,typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount(),y!==q.state&&XD.enqueueReplaceState(q,q.state,null),qD(p,A,q,D),q.state=p.memoizedState),typeof q.componentDidMount=="function"&&(p.flags|=4194308)}function Fw(p,y,A){if(p=A.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(A._owner){if(A=A._owner,A){if(A.tag!==1)throw Error(g(309));var D=A.stateNode}if(!D)throw Error(g(147,p));var q=D,Q=""+p;return y!==null&&y.ref!==null&&typeof y.ref=="function"&&y.ref._stringRef===Q?y.ref:(y=function(ce){var Ae=q.refs;Ae===a6e&&(Ae=q.refs={}),ce===null?delete Ae[Q]:Ae[Q]=ce},y._stringRef=Q,y)}if(typeof p!="string")throw Error(g(284));if(!A._owner)throw Error(g(290,p))}return p}function YD(p,y){throw p=Object.prototype.toString.call(y),Error(g(31,p==="[object Object]"?"object with keys {"+Object.keys(y).join(", ")+"}":p))}function h6e(p){var y=p._init;return y(p._payload)}function d6e(p){function y(ht,Ke){if(p){var pt=ht.deletions;pt===null?(ht.deletions=[Ke],ht.flags|=16):pt.push(Ke)}}function A(ht,Ke){if(!p)return null;for(;Ke!==null;)y(ht,Ke),Ke=Ke.sibling;return null}function D(ht,Ke){for(ht=new Map;Ke!==null;)Ke.key!==null?ht.set(Ke.key,Ke):ht.set(Ke.index,Ke),Ke=Ke.sibling;return ht}function q(ht,Ke){return ht=Ug(ht,Ke),ht.index=0,ht.sibling=null,ht}function Q(ht,Ke,pt){return ht.index=pt,p?(pt=ht.alternate,pt!==null?(pt=pt.index,pt<Ke?(ht.flags|=2,Ke):pt):(ht.flags|=2,Ke)):(ht.flags|=1048576,Ke)}function ce(ht){return p&&ht.alternate===null&&(ht.flags|=2),ht}function Ae(ht,Ke,pt,vn){return Ke===null||Ke.tag!==6?(Ke=eK(pt,ht.mode,vn),Ke.return=ht,Ke):(Ke=q(Ke,pt),Ke.return=ht,Ke)}function $e(ht,Ke,pt,vn){var sr=pt.type;return sr===Ie?an(ht,Ke,pt.props.children,vn,pt.key):Ke!==null&&(Ke.elementType===sr||typeof sr=="object"&&sr!==null&&sr.$$typeof===ke&&h6e(sr)===Ke.type)?(vn=q(Ke,pt.props),vn.ref=Fw(ht,Ke,pt),vn.return=ht,vn):(vn=pF(pt.type,pt.key,pt.props,null,ht.mode,vn),vn.ref=Fw(ht,Ke,pt),vn.return=ht,vn)}function wt(ht,Ke,pt,vn){return Ke===null||Ke.tag!==4||Ke.stateNode.containerInfo!==pt.containerInfo||Ke.stateNode.implementation!==pt.implementation?(Ke=tK(pt,ht.mode,vn),Ke.return=ht,Ke):(Ke=q(Ke,pt.children||[]),Ke.return=ht,Ke)}function an(ht,Ke,pt,vn,sr){return Ke===null||Ke.tag!==7?(Ke=Z9(pt,ht.mode,vn,sr),Ke.return=ht,Ke):(Ke=q(Ke,pt),Ke.return=ht,Ke)}function fn(ht,Ke,pt){if(typeof Ke=="string"&&Ke!==""||typeof Ke=="number")return Ke=eK(""+Ke,ht.mode,pt),Ke.return=ht,Ke;if(typeof Ke=="object"&&Ke!==null){switch(Ke.$$typeof){case ue:return pt=pF(Ke.type,Ke.key,Ke.props,null,ht.mode,pt),pt.ref=Fw(ht,null,Ke),pt.return=ht,pt;case Ee:return Ke=tK(Ke,ht.mode,pt),Ke.return=ht,Ke;case ke:var vn=Ke._init;return fn(ht,vn(Ke._payload),pt)}if(qt(Ke)||Pt(Ke))return Ke=Z9(Ke,ht.mode,pt,null),Ke.return=ht,Ke;YD(ht,Ke)}return null}function sn(ht,Ke,pt,vn){var sr=Ke!==null?Ke.key:null;if(typeof pt=="string"&&pt!==""||typeof pt=="number")return sr!==null?null:Ae(ht,Ke,""+pt,vn);if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case ue:return pt.key===sr?$e(ht,Ke,pt,vn):null;case Ee:return pt.key===sr?wt(ht,Ke,pt,vn):null;case ke:return sr=pt._init,sn(ht,Ke,sr(pt._payload),vn)}if(qt(pt)||Pt(pt))return sr!==null?null:an(ht,Ke,pt,vn,null);YD(ht,pt)}return null}function Gn(ht,Ke,pt,vn,sr){if(typeof vn=="string"&&vn!==""||typeof vn=="number")return ht=ht.get(pt)||null,Ae(Ke,ht,""+vn,sr);if(typeof vn=="object"&&vn!==null){switch(vn.$$typeof){case ue:return ht=ht.get(vn.key===null?pt:vn.key)||null,$e(Ke,ht,vn,sr);case Ee:return ht=ht.get(vn.key===null?pt:vn.key)||null,wt(Ke,ht,vn,sr);case ke:var _r=vn._init;return Gn(ht,Ke,pt,_r(vn._payload),sr)}if(qt(vn)||Pt(vn))return ht=ht.get(pt)||null,an(Ke,ht,vn,sr,null);YD(Ke,vn)}return null}function Kn(ht,Ke,pt,vn){for(var sr=null,_r=null,xr=Ke,Nr=Ke=0,Va=null;xr!==null&&Nr<pt.length;Nr++){xr.index>Nr?(Va=xr,xr=null):Va=xr.sibling;var Di=sn(ht,xr,pt[Nr],vn);if(Di===null){xr===null&&(xr=Va);break}p&&xr&&Di.alternate===null&&y(ht,xr),Ke=Q(Di,Ke,Nr),_r===null?sr=Di:_r.sibling=Di,_r=Di,xr=Va}if(Nr===pt.length)return A(ht,xr),Ws&&$9(ht,Nr),sr;if(xr===null){for(;Nr<pt.length;Nr++)xr=fn(ht,pt[Nr],vn),xr!==null&&(Ke=Q(xr,Ke,Nr),_r===null?sr=xr:_r.sibling=xr,_r=xr);return Ws&&$9(ht,Nr),sr}for(xr=D(ht,xr);Nr<pt.length;Nr++)Va=Gn(xr,ht,Nr,pt[Nr],vn),Va!==null&&(p&&Va.alternate!==null&&xr.delete(Va.key===null?Nr:Va.key),Ke=Q(Va,Ke,Nr),_r===null?sr=Va:_r.sibling=Va,_r=Va);return p&&xr.forEach(function(zg){return y(ht,zg)}),Ws&&$9(ht,Nr),sr}function nr(ht,Ke,pt,vn){var sr=Pt(pt);if(typeof sr!="function")throw Error(g(150));if(pt=sr.call(pt),pt==null)throw Error(g(151));for(var _r=sr=null,xr=Ke,Nr=Ke=0,Va=null,Di=pt.next();xr!==null&&!Di.done;Nr++,Di=pt.next()){xr.index>Nr?(Va=xr,xr=null):Va=xr.sibling;var zg=sn(ht,xr,Di.value,vn);if(zg===null){xr===null&&(xr=Va);break}p&&xr&&zg.alternate===null&&y(ht,xr),Ke=Q(zg,Ke,Nr),_r===null?sr=zg:_r.sibling=zg,_r=zg,xr=Va}if(Di.done)return A(ht,xr),Ws&&$9(ht,Nr),sr;if(xr===null){for(;!Di.done;Nr++,Di=pt.next())Di=fn(ht,Di.value,vn),Di!==null&&(Ke=Q(Di,Ke,Nr),_r===null?sr=Di:_r.sibling=Di,_r=Di);return Ws&&$9(ht,Nr),sr}for(xr=D(ht,xr);!Di.done;Nr++,Di=pt.next())Di=Gn(xr,ht,Nr,Di.value,vn),Di!==null&&(p&&Di.alternate!==null&&xr.delete(Di.key===null?Nr:Di.key),Ke=Q(Di,Ke,Nr),_r===null?sr=Di:_r.sibling=Di,_r=Di);return p&&xr.forEach(function(uHe){return y(ht,uHe)}),Ws&&$9(ht,Nr),sr}function Do(ht,Ke,pt,vn){if(typeof pt=="object"&&pt!==null&&pt.type===Ie&&pt.key===null&&(pt=pt.props.children),typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case ue:e:{for(var sr=pt.key,_r=Ke;_r!==null;){if(_r.key===sr){if(sr=pt.type,sr===Ie){if(_r.tag===7){A(ht,_r.sibling),Ke=q(_r,pt.props.children),Ke.return=ht,ht=Ke;break e}}else if(_r.elementType===sr||typeof sr=="object"&&sr!==null&&sr.$$typeof===ke&&h6e(sr)===_r.type){A(ht,_r.sibling),Ke=q(_r,pt.props),Ke.ref=Fw(ht,_r,pt),Ke.return=ht,ht=Ke;break e}A(ht,_r);break}else y(ht,_r);_r=_r.sibling}pt.type===Ie?(Ke=Z9(pt.props.children,ht.mode,vn,pt.key),Ke.return=ht,ht=Ke):(vn=pF(pt.type,pt.key,pt.props,null,ht.mode,vn),vn.ref=Fw(ht,Ke,pt),vn.return=ht,ht=vn)}return ce(ht);case Ee:e:{for(_r=pt.key;Ke!==null;){if(Ke.key===_r)if(Ke.tag===4&&Ke.stateNode.containerInfo===pt.containerInfo&&Ke.stateNode.implementation===pt.implementation){A(ht,Ke.sibling),Ke=q(Ke,pt.children||[]),Ke.return=ht,ht=Ke;break e}else{A(ht,Ke);break}else y(ht,Ke);Ke=Ke.sibling}Ke=tK(pt,ht.mode,vn),Ke.return=ht,ht=Ke}return ce(ht);case ke:return _r=pt._init,Do(ht,Ke,_r(pt._payload),vn)}if(qt(pt))return Kn(ht,Ke,pt,vn);if(Pt(pt))return nr(ht,Ke,pt,vn);YD(ht,pt)}return typeof pt=="string"&&pt!==""||typeof pt=="number"?(pt=""+pt,Ke!==null&&Ke.tag===6?(A(ht,Ke.sibling),Ke=q(Ke,pt),Ke.return=ht,ht=Ke):(A(ht,Ke),Ke=eK(pt,ht.mode,vn),Ke.return=ht,ht=Ke),ce(ht)):A(ht,Ke)}return Do}var w8=d6e(!0),f6e=d6e(!1),Ow={},vf=Rg(Ow),Bw=Rg(Ow),Lw=Rg(Ow);function j9(p){if(p===Ow)throw Error(g(174));return p}function _Y(p,y){switch(Ms(Lw,y),Ms(Bw,p),Ms(vf,Ow),p=y.nodeType,p){case 9:case 11:y=(y=y.documentElement)?y.namespaceURI:Pr(null,"");break;default:p=p===8?y.parentNode:y,y=p.namespaceURI||null,p=p.tagName,y=Pr(y,p)}Bs(vf),Ms(vf,y)}function T8(){Bs(vf),Bs(Bw),Bs(Lw)}function p6e(p){j9(Lw.current);var y=j9(vf.current),A=Pr(y,p.type);y!==A&&(Ms(Bw,p),Ms(vf,A))}function xY(p){Bw.current===p&&(Bs(vf),Bs(Bw))}var ro=Rg(0);function KD(p){for(var y=p;y!==null;){if(y.tag===13){var A=y.memoizedState;if(A!==null&&(A=A.dehydrated,A===null||A.data==="$?"||A.data==="$!"))return y}else if(y.tag===19&&y.memoizedProps.revealOrder!==void 0){if(y.flags&128)return y}else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===p)break;for(;y.sibling===null;){if(y.return===null||y.return===p)return null;y=y.return}y.sibling.return=y.return,y=y.sibling}return null}var bY=[];function SY(){for(var p=0;p<bY.length;p++)bY[p]._workInProgressVersionPrimary=null;bY.length=0}var ZD=oe.ReactCurrentDispatcher,wY=oe.ReactCurrentBatchConfig,W9=0,io=null,va=null,Ua=null,QD=!1,Uw=!1,zw=0,I$e=0;function Nl(){throw Error(g(321))}function TY(p,y){if(y===null)return!1;for(var A=0;A<y.length&&A<p.length;A++)if(!zh(p[A],y[A]))return!1;return!0}function EY(p,y,A,D,q,Q){if(W9=Q,io=y,y.memoizedState=null,y.updateQueue=null,y.lanes=0,ZD.current=p===null||p.memoizedState===null?O$e:B$e,p=A(D,q),Uw){Q=0;do{if(Uw=!1,zw=0,25<=Q)throw Error(g(301));Q+=1,Ua=va=null,y.updateQueue=null,ZD.current=L$e,p=A(D,q)}while(Uw)}if(ZD.current=tF,y=va!==null&&va.next!==null,W9=0,Ua=va=io=null,QD=!1,y)throw Error(g(300));return p}function MY(){var p=zw!==0;return zw=0,p}function _f(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ua===null?io.memoizedState=Ua=p:Ua=Ua.next=p,Ua}function ku(){if(va===null){var p=io.alternate;p=p!==null?p.memoizedState:null}else p=va.next;var y=Ua===null?io.memoizedState:Ua.next;if(y!==null)Ua=y,va=p;else{if(p===null)throw Error(g(310));va=p,p={memoizedState:va.memoizedState,baseState:va.baseState,baseQueue:va.baseQueue,queue:va.queue,next:null},Ua===null?io.memoizedState=Ua=p:Ua=Ua.next=p}return Ua}function Vw(p,y){return typeof y=="function"?y(p):y}function CY(p){var y=ku(),A=y.queue;if(A===null)throw Error(g(311));A.lastRenderedReducer=p;var D=va,q=D.baseQueue,Q=A.pending;if(Q!==null){if(q!==null){var ce=q.next;q.next=Q.next,Q.next=ce}D.baseQueue=q=Q,A.pending=null}if(q!==null){Q=q.next,D=D.baseState;var Ae=ce=null,$e=null,wt=Q;do{var an=wt.lane;if((W9&an)===an)$e!==null&&($e=$e.next={lane:0,action:wt.action,hasEagerState:wt.hasEagerState,eagerState:wt.eagerState,next:null}),D=wt.hasEagerState?wt.eagerState:p(D,wt.action);else{var fn={lane:an,action:wt.action,hasEagerState:wt.hasEagerState,eagerState:wt.eagerState,next:null};$e===null?(Ae=$e=fn,ce=D):$e=$e.next=fn,io.lanes|=an,q9|=an}wt=wt.next}while(wt!==null&&wt!==Q);$e===null?ce=D:$e.next=Ae,zh(D,y.memoizedState)||(Z0=!0),y.memoizedState=D,y.baseState=ce,y.baseQueue=$e,A.lastRenderedState=D}if(p=A.interleaved,p!==null){q=p;do Q=q.lane,io.lanes|=Q,q9|=Q,q=q.next;while(q!==p)}else q===null&&(A.lanes=0);return[y.memoizedState,A.dispatch]}function AY(p){var y=ku(),A=y.queue;if(A===null)throw Error(g(311));A.lastRenderedReducer=p;var D=A.dispatch,q=A.pending,Q=y.memoizedState;if(q!==null){A.pending=null;var ce=q=q.next;do Q=p(Q,ce.action),ce=ce.next;while(ce!==q);zh(Q,y.memoizedState)||(Z0=!0),y.memoizedState=Q,y.baseQueue===null&&(y.baseState=Q),A.lastRenderedState=Q}return[Q,D]}function m6e(){}function g6e(p,y){var A=io,D=ku(),q=y(),Q=!zh(D.memoizedState,q);if(Q&&(D.memoizedState=q,Z0=!0),D=D.queue,RY(_6e.bind(null,A,D,p),[p]),D.getSnapshot!==y||Q||Ua!==null&&Ua.memoizedState.tag&1){if(A.flags|=2048,Gw(9,v6e.bind(null,A,D,q,y),void 0,null),za===null)throw Error(g(349));W9&30||y6e(A,y,q)}return q}function y6e(p,y,A){p.flags|=16384,p={getSnapshot:y,value:A},y=io.updateQueue,y===null?(y={lastEffect:null,stores:null},io.updateQueue=y,y.stores=[p]):(A=y.stores,A===null?y.stores=[p]:A.push(p))}function v6e(p,y,A,D){y.value=A,y.getSnapshot=D,x6e(y)&&b6e(p)}function _6e(p,y,A){return A(function(){x6e(y)&&b6e(p)})}function x6e(p){var y=p.getSnapshot;p=p.value;try{var A=y();return!zh(p,A)}catch{return!0}}function b6e(p){var y=Qp(p,1);y!==null&&jh(y,p,1,-1)}function S6e(p){var y=_f();return typeof p=="function"&&(p=p()),y.memoizedState=y.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vw,lastRenderedState:p},y.queue=p,p=p.dispatch=F$e.bind(null,io,p),[y.memoizedState,p]}function Gw(p,y,A,D){return p={tag:p,create:y,destroy:A,deps:D,next:null},y=io.updateQueue,y===null?(y={lastEffect:null,stores:null},io.updateQueue=y,y.lastEffect=p.next=p):(A=y.lastEffect,A===null?y.lastEffect=p.next=p:(D=A.next,A.next=p,p.next=D,y.lastEffect=p)),p}function w6e(){return ku().memoizedState}function JD(p,y,A,D){var q=_f();io.flags|=p,q.memoizedState=Gw(1|y,A,void 0,D===void 0?null:D)}function eF(p,y,A,D){var q=ku();D=D===void 0?null:D;var Q=void 0;if(va!==null){var ce=va.memoizedState;if(Q=ce.destroy,D!==null&&TY(D,ce.deps)){q.memoizedState=Gw(y,A,Q,D);return}}io.flags|=p,q.memoizedState=Gw(1|y,A,Q,D)}function T6e(p,y){return JD(8390656,8,p,y)}function RY(p,y){return eF(2048,8,p,y)}function E6e(p,y){return eF(4,2,p,y)}function M6e(p,y){return eF(4,4,p,y)}function C6e(p,y){if(typeof y=="function")return p=p(),y(p),function(){y(null)};if(y!=null)return p=p(),y.current=p,function(){y.current=null}}function A6e(p,y,A){return A=A!=null?A.concat([p]):null,eF(4,4,C6e.bind(null,y,p),A)}function PY(){}function R6e(p,y){var A=ku();y=y===void 0?null:y;var D=A.memoizedState;return D!==null&&y!==null&&TY(y,D[1])?D[0]:(A.memoizedState=[p,y],p)}function P6e(p,y){var A=ku();y=y===void 0?null:y;var D=A.memoizedState;return D!==null&&y!==null&&TY(y,D[1])?D[0]:(p=p(),A.memoizedState=[p,y],p)}function N6e(p,y,A){return W9&21?(zh(A,y)||(A=n8e(),io.lanes|=A,q9|=A,p.baseState=!0),y):(p.baseState&&(p.baseState=!1,Z0=!0),p.memoizedState=A)}function k$e(p,y){var A=os;os=A!==0&&4>A?A:4,p(!0);var D=wY.transition;wY.transition={};try{p(!1),y()}finally{os=A,wY.transition=D}}function I6e(){return ku().memoizedState}function D$e(p,y,A){var D=Bg(p);if(A={lane:D,action:A,hasEagerState:!1,eagerState:null,next:null},k6e(p))D6e(y,A);else if(A=r6e(p,y,A,D),A!==null){var q=y0();jh(A,p,D,q),F6e(A,y,D)}}function F$e(p,y,A){var D=Bg(p),q={lane:D,action:A,hasEagerState:!1,eagerState:null,next:null};if(k6e(p))D6e(y,q);else{var Q=p.alternate;if(p.lanes===0&&(Q===null||Q.lanes===0)&&(Q=y.lastRenderedReducer,Q!==null))try{var ce=y.lastRenderedState,Ae=Q(ce,A);if(q.hasEagerState=!0,q.eagerState=Ae,zh(Ae,ce)){var $e=y.interleaved;$e===null?(q.next=q,mY(y)):(q.next=$e.next,$e.next=q),y.interleaved=q;return}}catch{}finally{}A=r6e(p,y,q,D),A!==null&&(q=y0(),jh(A,p,D,q),F6e(A,y,D))}}function k6e(p){var y=p.alternate;return p===io||y!==null&&y===io}function D6e(p,y){Uw=QD=!0;var A=p.pending;A===null?y.next=y:(y.next=A.next,A.next=y),p.pending=y}function F6e(p,y,A){if(A&4194240){var D=y.lanes;D&=p.pendingLanes,A|=D,y.lanes=A,IX(p,A)}}var tF={readContext:Iu,useCallback:Nl,useContext:Nl,useEffect:Nl,useImperativeHandle:Nl,useInsertionEffect:Nl,useLayoutEffect:Nl,useMemo:Nl,useReducer:Nl,useRef:Nl,useState:Nl,useDebugValue:Nl,useDeferredValue:Nl,useTransition:Nl,useMutableSource:Nl,useSyncExternalStore:Nl,useId:Nl,unstable_isNewReconciler:!1},O$e={readContext:Iu,useCallback:function(p,y){return _f().memoizedState=[p,y===void 0?null:y],p},useContext:Iu,useEffect:T6e,useImperativeHandle:function(p,y,A){return A=A!=null?A.concat([p]):null,JD(4194308,4,C6e.bind(null,y,p),A)},useLayoutEffect:function(p,y){return JD(4194308,4,p,y)},useInsertionEffect:function(p,y){return JD(4,2,p,y)},useMemo:function(p,y){var A=_f();return y=y===void 0?null:y,p=p(),A.memoizedState=[p,y],p},useReducer:function(p,y,A){var D=_f();return y=A!==void 0?A(y):y,D.memoizedState=D.baseState=y,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:y},D.queue=p,p=p.dispatch=D$e.bind(null,io,p),[D.memoizedState,p]},useRef:function(p){var y=_f();return p={current:p},y.memoizedState=p},useState:S6e,useDebugValue:PY,useDeferredValue:function(p){return _f().memoizedState=p},useTransition:function(){var p=S6e(!1),y=p[0];return p=k$e.bind(null,p[1]),_f().memoizedState=p,[y,p]},useMutableSource:function(){},useSyncExternalStore:function(p,y,A){var D=io,q=_f();if(Ws){if(A===void 0)throw Error(g(407));A=A()}else{if(A=y(),za===null)throw Error(g(349));W9&30||y6e(D,y,A)}q.memoizedState=A;var Q={value:A,getSnapshot:y};return q.queue=Q,T6e(_6e.bind(null,D,Q,p),[p]),D.flags|=2048,Gw(9,v6e.bind(null,D,Q,A,y),void 0,null),A},useId:function(){var p=_f(),y=za.identifierPrefix;if(Ws){var A=Zp,D=Kp;A=(D&~(1<<32-Uh(D)-1)).toString(32)+A,y=":"+y+"R"+A,A=zw++,0<A&&(y+="H"+A.toString(32)),y+=":"}else A=I$e++,y=":"+y+"r"+A.toString(32)+":";return p.memoizedState=y},unstable_isNewReconciler:!1},B$e={readContext:Iu,useCallback:R6e,useContext:Iu,useEffect:RY,useImperativeHandle:A6e,useInsertionEffect:E6e,useLayoutEffect:M6e,useMemo:P6e,useReducer:CY,useRef:w6e,useState:function(){return CY(Vw)},useDebugValue:PY,useDeferredValue:function(p){var y=ku();return N6e(y,va.memoizedState,p)},useTransition:function(){var p=CY(Vw)[0],y=ku().memoizedState;return[p,y]},useMutableSource:m6e,useSyncExternalStore:g6e,useId:I6e,unstable_isNewReconciler:!1},L$e={readContext:Iu,useCallback:R6e,useContext:Iu,useEffect:RY,useImperativeHandle:A6e,useInsertionEffect:E6e,useLayoutEffect:M6e,useMemo:P6e,useReducer:AY,useRef:w6e,useState:function(){return AY(Vw)},useDebugValue:PY,useDeferredValue:function(p){var y=ku();return va===null?y.memoizedState=p:N6e(y,va.memoizedState,p)},useTransition:function(){var p=AY(Vw)[0],y=ku().memoizedState;return[p,y]},useMutableSource:m6e,useSyncExternalStore:g6e,useId:I6e,unstable_isNewReconciler:!1};function E8(p,y){try{var A="",D=y;do A+=Je(D),D=D.return;while(D);var q=A}catch(Q){q=`
Error generating stack: `+Q.message+`
`+Q.stack}return{value:p,source:y,stack:q,digest:null}}function NY(p,y,A){return{value:p,source:null,stack:A??null,digest:y??null}}function IY(p,y){try{console.error(y.value)}catch(A){setTimeout(function(){throw A})}}var U$e=typeof WeakMap=="function"?WeakMap:Map;function O6e(p,y,A){A=Jp(-1,A),A.tag=3,A.payload={element:null};var D=y.value;return A.callback=function(){lF||(lF=!0,WY=D),IY(p,y)},A}function B6e(p,y,A){A=Jp(-1,A),A.tag=3;var D=p.type.getDerivedStateFromError;if(typeof D=="function"){var q=y.value;A.payload=function(){return D(q)},A.callback=function(){IY(p,y)}}var Q=p.stateNode;return Q!==null&&typeof Q.componentDidCatch=="function"&&(A.callback=function(){IY(p,y),typeof D!="function"&&(Fg===null?Fg=new Set([this]):Fg.add(this));var ce=y.stack;this.componentDidCatch(y.value,{componentStack:ce!==null?ce:""})}),A}function L6e(p,y,A){var D=p.pingCache;if(D===null){D=p.pingCache=new U$e;var q=new Set;D.set(y,q)}else q=D.get(y),q===void 0&&(q=new Set,D.set(y,q));q.has(A)||(q.add(A),p=J$e.bind(null,p,y,A),y.then(p,p))}function U6e(p){do{var y;if((y=p.tag===13)&&(y=p.memoizedState,y=y!==null?y.dehydrated!==null:!0),y)return p;p=p.return}while(p!==null);return null}function z6e(p,y,A,D,q){return p.mode&1?(p.flags|=65536,p.lanes=q,p):(p===y?p.flags|=65536:(p.flags|=128,A.flags|=131072,A.flags&=-52805,A.tag===1&&(A.alternate===null?A.tag=17:(y=Jp(-1,1),y.tag=2,kg(A,y,1))),A.lanes|=1),p)}var z$e=oe.ReactCurrentOwner,Z0=!1;function g0(p,y,A,D){y.child=p===null?f6e(y,null,A,D):w8(y,p.child,A,D)}function V6e(p,y,A,D,q){A=A.render;var Q=y.ref;return S8(y,q),D=EY(p,y,A,D,Q,q),A=MY(),p!==null&&!Z0?(y.updateQueue=p.updateQueue,y.flags&=-2053,p.lanes&=~q,e1(p,y,q)):(Ws&&A&&oY(y),y.flags|=1,g0(p,y,D,q),y.child)}function G6e(p,y,A,D,q){if(p===null){var Q=A.type;return typeof Q=="function"&&!JY(Q)&&Q.defaultProps===void 0&&A.compare===null&&A.defaultProps===void 0?(y.tag=15,y.type=Q,$6e(p,y,Q,D,q)):(p=pF(A.type,null,D,y,y.mode,q),p.ref=y.ref,p.return=y,y.child=p)}if(Q=p.child,!(p.lanes&q)){var ce=Q.memoizedProps;if(A=A.compare,A=A!==null?A:Aw,A(ce,D)&&p.ref===y.ref)return e1(p,y,q)}return y.flags|=1,p=Ug(Q,D),p.ref=y.ref,p.return=y,y.child=p}function $6e(p,y,A,D,q){if(p!==null){var Q=p.memoizedProps;if(Aw(Q,D)&&p.ref===y.ref)if(Z0=!1,y.pendingProps=D=Q,(p.lanes&q)!==0)p.flags&131072&&(Z0=!0);else return y.lanes=p.lanes,e1(p,y,q)}return kY(p,y,A,D,q)}function H6e(p,y,A){var D=y.pendingProps,q=D.children,Q=p!==null?p.memoizedState:null;if(D.mode==="hidden")if(!(y.mode&1))y.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ms(C8,kc),kc|=A;else{if(!(A&1073741824))return p=Q!==null?Q.baseLanes|A:A,y.lanes=y.childLanes=1073741824,y.memoizedState={baseLanes:p,cachePool:null,transitions:null},y.updateQueue=null,Ms(C8,kc),kc|=p,null;y.memoizedState={baseLanes:0,cachePool:null,transitions:null},D=Q!==null?Q.baseLanes:A,Ms(C8,kc),kc|=D}else Q!==null?(D=Q.baseLanes|A,y.memoizedState=null):D=A,Ms(C8,kc),kc|=D;return g0(p,y,q,A),y.child}function j6e(p,y){var A=y.ref;(p===null&&A!==null||p!==null&&p.ref!==A)&&(y.flags|=512,y.flags|=2097152)}function kY(p,y,A,D,q){var Q=K0(A)?V9:Pl.current;return Q=y8(y,Q),S8(y,q),A=EY(p,y,A,D,Q,q),D=MY(),p!==null&&!Z0?(y.updateQueue=p.updateQueue,y.flags&=-2053,p.lanes&=~q,e1(p,y,q)):(Ws&&D&&oY(y),y.flags|=1,g0(p,y,A,q),y.child)}function W6e(p,y,A,D,q){if(K0(A)){var Q=!0;UD(y)}else Q=!1;if(S8(y,q),y.stateNode===null)rF(p,y),c6e(y,A,D),vY(y,A,D,q),D=!0;else if(p===null){var ce=y.stateNode,Ae=y.memoizedProps;ce.props=Ae;var $e=ce.context,wt=A.contextType;typeof wt=="object"&&wt!==null?wt=Iu(wt):(wt=K0(A)?V9:Pl.current,wt=y8(y,wt));var an=A.getDerivedStateFromProps,fn=typeof an=="function"||typeof ce.getSnapshotBeforeUpdate=="function";fn||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Ae!==D||$e!==wt)&&u6e(y,ce,D,wt),Ig=!1;var sn=y.memoizedState;ce.state=sn,qD(y,D,ce,q),$e=y.memoizedState,Ae!==D||sn!==$e||Y0.current||Ig?(typeof an=="function"&&(yY(y,A,an,D),$e=y.memoizedState),(Ae=Ig||l6e(y,A,Ae,D,sn,$e,wt))?(fn||typeof ce.UNSAFE_componentWillMount!="function"&&typeof ce.componentWillMount!="function"||(typeof ce.componentWillMount=="function"&&ce.componentWillMount(),typeof ce.UNSAFE_componentWillMount=="function"&&ce.UNSAFE_componentWillMount()),typeof ce.componentDidMount=="function"&&(y.flags|=4194308)):(typeof ce.componentDidMount=="function"&&(y.flags|=4194308),y.memoizedProps=D,y.memoizedState=$e),ce.props=D,ce.state=$e,ce.context=wt,D=Ae):(typeof ce.componentDidMount=="function"&&(y.flags|=4194308),D=!1)}else{ce=y.stateNode,i6e(p,y),Ae=y.memoizedProps,wt=y.type===y.elementType?Ae:Gh(y.type,Ae),ce.props=wt,fn=y.pendingProps,sn=ce.context,$e=A.contextType,typeof $e=="object"&&$e!==null?$e=Iu($e):($e=K0(A)?V9:Pl.current,$e=y8(y,$e));var Gn=A.getDerivedStateFromProps;(an=typeof Gn=="function"||typeof ce.getSnapshotBeforeUpdate=="function")||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Ae!==fn||sn!==$e)&&u6e(y,ce,D,$e),Ig=!1,sn=y.memoizedState,ce.state=sn,qD(y,D,ce,q);var Kn=y.memoizedState;Ae!==fn||sn!==Kn||Y0.current||Ig?(typeof Gn=="function"&&(yY(y,A,Gn,D),Kn=y.memoizedState),(wt=Ig||l6e(y,A,wt,D,sn,Kn,$e)||!1)?(an||typeof ce.UNSAFE_componentWillUpdate!="function"&&typeof ce.componentWillUpdate!="function"||(typeof ce.componentWillUpdate=="function"&&ce.componentWillUpdate(D,Kn,$e),typeof ce.UNSAFE_componentWillUpdate=="function"&&ce.UNSAFE_componentWillUpdate(D,Kn,$e)),typeof ce.componentDidUpdate=="function"&&(y.flags|=4),typeof ce.getSnapshotBeforeUpdate=="function"&&(y.flags|=1024)):(typeof ce.componentDidUpdate!="function"||Ae===p.memoizedProps&&sn===p.memoizedState||(y.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Ae===p.memoizedProps&&sn===p.memoizedState||(y.flags|=1024),y.memoizedProps=D,y.memoizedState=Kn),ce.props=D,ce.state=Kn,ce.context=$e,D=wt):(typeof ce.componentDidUpdate!="function"||Ae===p.memoizedProps&&sn===p.memoizedState||(y.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Ae===p.memoizedProps&&sn===p.memoizedState||(y.flags|=1024),D=!1)}return DY(p,y,A,D,Q,q)}function DY(p,y,A,D,q,Q){j6e(p,y);var ce=(y.flags&128)!==0;if(!D&&!ce)return q&&K8e(y,A,!1),e1(p,y,Q);D=y.stateNode,z$e.current=y;var Ae=ce&&typeof A.getDerivedStateFromError!="function"?null:D.render();return y.flags|=1,p!==null&&ce?(y.child=w8(y,p.child,null,Q),y.child=w8(y,null,Ae,Q)):g0(p,y,Ae,Q),y.memoizedState=D.state,q&&K8e(y,A,!0),y.child}function q6e(p){var y=p.stateNode;y.pendingContext?X8e(p,y.pendingContext,y.pendingContext!==y.context):y.context&&X8e(p,y.context,!1),_Y(p,y.containerInfo)}function X6e(p,y,A,D,q){return x8(),uY(q),y.flags|=256,g0(p,y,A,D),y.child}var FY={dehydrated:null,treeContext:null,retryLane:0};function OY(p){return{baseLanes:p,cachePool:null,transitions:null}}function Y6e(p,y,A){var D=y.pendingProps,q=ro.current,Q=!1,ce=(y.flags&128)!==0,Ae;if((Ae=ce)||(Ae=p!==null&&p.memoizedState===null?!1:(q&2)!==0),Ae?(Q=!0,y.flags&=-129):(p===null||p.memoizedState!==null)&&(q|=1),Ms(ro,q&1),p===null)return cY(y),p=y.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?(y.mode&1?p.data==="$!"?y.lanes=8:y.lanes=1073741824:y.lanes=1,null):(ce=D.children,p=D.fallback,Q?(D=y.mode,Q=y.child,ce={mode:"hidden",children:ce},!(D&1)&&Q!==null?(Q.childLanes=0,Q.pendingProps=ce):Q=mF(ce,D,0,null),p=Z9(p,D,A,null),Q.return=y,p.return=y,Q.sibling=p,y.child=Q,y.child.memoizedState=OY(A),y.memoizedState=FY,p):BY(y,ce));if(q=p.memoizedState,q!==null&&(Ae=q.dehydrated,Ae!==null))return V$e(p,y,ce,D,Ae,q,A);if(Q){Q=D.fallback,ce=y.mode,q=p.child,Ae=q.sibling;var $e={mode:"hidden",children:D.children};return!(ce&1)&&y.child!==q?(D=y.child,D.childLanes=0,D.pendingProps=$e,y.deletions=null):(D=Ug(q,$e),D.subtreeFlags=q.subtreeFlags&14680064),Ae!==null?Q=Ug(Ae,Q):(Q=Z9(Q,ce,A,null),Q.flags|=2),Q.return=y,D.return=y,D.sibling=Q,y.child=D,D=Q,Q=y.child,ce=p.child.memoizedState,ce=ce===null?OY(A):{baseLanes:ce.baseLanes|A,cachePool:null,transitions:ce.transitions},Q.memoizedState=ce,Q.childLanes=p.childLanes&~A,y.memoizedState=FY,D}return Q=p.child,p=Q.sibling,D=Ug(Q,{mode:"visible",children:D.children}),!(y.mode&1)&&(D.lanes=A),D.return=y,D.sibling=null,p!==null&&(A=y.deletions,A===null?(y.deletions=[p],y.flags|=16):A.push(p)),y.child=D,y.memoizedState=null,D}function BY(p,y){return y=mF({mode:"visible",children:y},p.mode,0,null),y.return=p,p.child=y}function nF(p,y,A,D){return D!==null&&uY(D),w8(y,p.child,null,A),p=BY(y,y.pendingProps.children),p.flags|=2,y.memoizedState=null,p}function V$e(p,y,A,D,q,Q,ce){if(A)return y.flags&256?(y.flags&=-257,D=NY(Error(g(422))),nF(p,y,ce,D)):y.memoizedState!==null?(y.child=p.child,y.flags|=128,null):(Q=D.fallback,q=y.mode,D=mF({mode:"visible",children:D.children},q,0,null),Q=Z9(Q,q,ce,null),Q.flags|=2,D.return=y,Q.return=y,D.sibling=Q,y.child=D,y.mode&1&&w8(y,p.child,null,ce),y.child.memoizedState=OY(ce),y.memoizedState=FY,Q);if(!(y.mode&1))return nF(p,y,ce,null);if(q.data==="$!"){if(D=q.nextSibling&&q.nextSibling.dataset,D)var Ae=D.dgst;return D=Ae,Q=Error(g(419)),D=NY(Q,D,void 0),nF(p,y,ce,D)}if(Ae=(ce&p.childLanes)!==0,Z0||Ae){if(D=za,D!==null){switch(ce&-ce){case 4:q=2;break;case 16:q=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:q=32;break;case 536870912:q=268435456;break;default:q=0}q=q&(D.suspendedLanes|ce)?0:q,q!==0&&q!==Q.retryLane&&(Q.retryLane=q,Qp(p,q),jh(D,p,q,-1))}return QY(),D=NY(Error(g(421))),nF(p,y,ce,D)}return q.data==="$?"?(y.flags|=128,y.child=p.child,y=eHe.bind(null,p),q._reactRetry=y,null):(p=Q.treeContext,Ic=Ag(q.nextSibling),Nc=y,Ws=!0,Vh=null,p!==null&&(Pu[Nu++]=Kp,Pu[Nu++]=Zp,Pu[Nu++]=G9,Kp=p.id,Zp=p.overflow,G9=y),y=BY(y,D.children),y.flags|=4096,y)}function K6e(p,y,A){p.lanes|=y;var D=p.alternate;D!==null&&(D.lanes|=y),pY(p.return,y,A)}function LY(p,y,A,D,q){var Q=p.memoizedState;Q===null?p.memoizedState={isBackwards:y,rendering:null,renderingStartTime:0,last:D,tail:A,tailMode:q}:(Q.isBackwards=y,Q.rendering=null,Q.renderingStartTime=0,Q.last=D,Q.tail=A,Q.tailMode=q)}function Z6e(p,y,A){var D=y.pendingProps,q=D.revealOrder,Q=D.tail;if(g0(p,y,D.children,A),D=ro.current,D&2)D=D&1|2,y.flags|=128;else{if(p!==null&&p.flags&128)e:for(p=y.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&K6e(p,A,y);else if(p.tag===19)K6e(p,A,y);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===y)break e;for(;p.sibling===null;){if(p.return===null||p.return===y)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}D&=1}if(Ms(ro,D),!(y.mode&1))y.memoizedState=null;else switch(q){case"forwards":for(A=y.child,q=null;A!==null;)p=A.alternate,p!==null&&KD(p)===null&&(q=A),A=A.sibling;A=q,A===null?(q=y.child,y.child=null):(q=A.sibling,A.sibling=null),LY(y,!1,q,A,Q);break;case"backwards":for(A=null,q=y.child,y.child=null;q!==null;){if(p=q.alternate,p!==null&&KD(p)===null){y.child=q;break}p=q.sibling,q.sibling=A,A=q,q=p}LY(y,!0,A,null,Q);break;case"together":LY(y,!1,null,null,void 0);break;default:y.memoizedState=null}return y.child}function rF(p,y){!(y.mode&1)&&p!==null&&(p.alternate=null,y.alternate=null,y.flags|=2)}function e1(p,y,A){if(p!==null&&(y.dependencies=p.dependencies),q9|=y.lanes,!(A&y.childLanes))return null;if(p!==null&&y.child!==p.child)throw Error(g(153));if(y.child!==null){for(p=y.child,A=Ug(p,p.pendingProps),y.child=A,A.return=y;p.sibling!==null;)p=p.sibling,A=A.sibling=Ug(p,p.pendingProps),A.return=y;A.sibling=null}return y.child}function G$e(p,y,A){switch(y.tag){case 3:q6e(y),x8();break;case 5:p6e(y);break;case 1:K0(y.type)&&UD(y);break;case 4:_Y(y,y.stateNode.containerInfo);break;case 10:var D=y.type._context,q=y.memoizedProps.value;Ms(HD,D._currentValue),D._currentValue=q;break;case 13:if(D=y.memoizedState,D!==null)return D.dehydrated!==null?(Ms(ro,ro.current&1),y.flags|=128,null):A&y.child.childLanes?Y6e(p,y,A):(Ms(ro,ro.current&1),p=e1(p,y,A),p!==null?p.sibling:null);Ms(ro,ro.current&1);break;case 19:if(D=(A&y.childLanes)!==0,p.flags&128){if(D)return Z6e(p,y,A);y.flags|=128}if(q=y.memoizedState,q!==null&&(q.rendering=null,q.tail=null,q.lastEffect=null),Ms(ro,ro.current),D)break;return null;case 22:case 23:return y.lanes=0,H6e(p,y,A)}return e1(p,y,A)}var Q6e,UY,J6e,e_e;Q6e=function(p,y){for(var A=y.child;A!==null;){if(A.tag===5||A.tag===6)p.appendChild(A.stateNode);else if(A.tag!==4&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===y)break;for(;A.sibling===null;){if(A.return===null||A.return===y)return;A=A.return}A.sibling.return=A.return,A=A.sibling}},UY=function(){},J6e=function(p,y,A,D){var q=p.memoizedProps;if(q!==D){p=y.stateNode,j9(vf.current);var Q=null;switch(A){case"input":q=_t(p,q),D=_t(p,D),Q=[];break;case"select":q=pe({},q,{value:void 0}),D=pe({},D,{value:void 0}),Q=[];break;case"textarea":q=rn(p,q),D=rn(p,D),Q=[];break;default:typeof q.onClick!="function"&&typeof D.onClick=="function"&&(p.onclick=OD)}s8(A,D);var ce;A=null;for(wt in q)if(!D.hasOwnProperty(wt)&&q.hasOwnProperty(wt)&&q[wt]!=null)if(wt==="style"){var Ae=q[wt];for(ce in Ae)Ae.hasOwnProperty(ce)&&(A||(A={}),A[ce]="")}else wt!=="dangerouslySetInnerHTML"&&wt!=="children"&&wt!=="suppressContentEditableWarning"&&wt!=="suppressHydrationWarning"&&wt!=="autoFocus"&&(b.hasOwnProperty(wt)?Q||(Q=[]):(Q=Q||[]).push(wt,null));for(wt in D){var $e=D[wt];if(Ae=q!=null?q[wt]:void 0,D.hasOwnProperty(wt)&&$e!==Ae&&($e!=null||Ae!=null))if(wt==="style")if(Ae){for(ce in Ae)!Ae.hasOwnProperty(ce)||$e&&$e.hasOwnProperty(ce)||(A||(A={}),A[ce]="");for(ce in $e)$e.hasOwnProperty(ce)&&Ae[ce]!==$e[ce]&&(A||(A={}),A[ce]=$e[ce])}else A||(Q||(Q=[]),Q.push(wt,A)),A=$e;else wt==="dangerouslySetInnerHTML"?($e=$e?$e.__html:void 0,Ae=Ae?Ae.__html:void 0,$e!=null&&Ae!==$e&&(Q=Q||[]).push(wt,$e)):wt==="children"?typeof $e!="string"&&typeof $e!="number"||(Q=Q||[]).push(wt,""+$e):wt!=="suppressContentEditableWarning"&&wt!=="suppressHydrationWarning"&&(b.hasOwnProperty(wt)?($e!=null&&wt==="onScroll"&&Os("scroll",p),Q||Ae===$e||(Q=[])):(Q=Q||[]).push(wt,$e))}A&&(Q=Q||[]).push("style",A);var wt=Q;(y.updateQueue=wt)&&(y.flags|=4)}},e_e=function(p,y,A,D){A!==D&&(y.flags|=4)};function $w(p,y){if(!Ws)switch(p.tailMode){case"hidden":y=p.tail;for(var A=null;y!==null;)y.alternate!==null&&(A=y),y=y.sibling;A===null?p.tail=null:A.sibling=null;break;case"collapsed":A=p.tail;for(var D=null;A!==null;)A.alternate!==null&&(D=A),A=A.sibling;D===null?y||p.tail===null?p.tail=null:p.tail.sibling=null:D.sibling=null}}function Il(p){var y=p.alternate!==null&&p.alternate.child===p.child,A=0,D=0;if(y)for(var q=p.child;q!==null;)A|=q.lanes|q.childLanes,D|=q.subtreeFlags&14680064,D|=q.flags&14680064,q.return=p,q=q.sibling;else for(q=p.child;q!==null;)A|=q.lanes|q.childLanes,D|=q.subtreeFlags,D|=q.flags,q.return=p,q=q.sibling;return p.subtreeFlags|=D,p.childLanes=A,y}function $$e(p,y,A){var D=y.pendingProps;switch(aY(y),y.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Il(y),null;case 1:return K0(y.type)&&LD(),Il(y),null;case 3:return D=y.stateNode,T8(),Bs(Y0),Bs(Pl),SY(),D.pendingContext&&(D.context=D.pendingContext,D.pendingContext=null),(p===null||p.child===null)&&($D(y)?y.flags|=4:p===null||p.memoizedState.isDehydrated&&!(y.flags&256)||(y.flags|=1024,Vh!==null&&(YY(Vh),Vh=null))),UY(p,y),Il(y),null;case 5:xY(y);var q=j9(Lw.current);if(A=y.type,p!==null&&y.stateNode!=null)J6e(p,y,A,D,q),p.ref!==y.ref&&(y.flags|=512,y.flags|=2097152);else{if(!D){if(y.stateNode===null)throw Error(g(166));return Il(y),null}if(p=j9(vf.current),$D(y)){D=y.stateNode,A=y.type;var Q=y.memoizedProps;switch(D[yf]=y,D[kw]=Q,p=(y.mode&1)!==0,A){case"dialog":Os("cancel",D),Os("close",D);break;case"iframe":case"object":case"embed":Os("load",D);break;case"video":case"audio":for(q=0;q<Pw.length;q++)Os(Pw[q],D);break;case"source":Os("error",D);break;case"img":case"image":case"link":Os("error",D),Os("load",D);break;case"details":Os("toggle",D);break;case"input":yt(D,Q),Os("invalid",D);break;case"select":D._wrapperState={wasMultiple:!!Q.multiple},Os("invalid",D);break;case"textarea":Gt(D,Q),Os("invalid",D)}s8(A,Q),q=null;for(var ce in Q)if(Q.hasOwnProperty(ce)){var Ae=Q[ce];ce==="children"?typeof Ae=="string"?D.textContent!==Ae&&(Q.suppressHydrationWarning!==!0&&FD(D.textContent,Ae,p),q=["children",Ae]):typeof Ae=="number"&&D.textContent!==""+Ae&&(Q.suppressHydrationWarning!==!0&&FD(D.textContent,Ae,p),q=["children",""+Ae]):b.hasOwnProperty(ce)&&Ae!=null&&ce==="onScroll"&&Os("scroll",D)}switch(A){case"input":dr(D),et(D,Q,!0);break;case"textarea":dr(D),or(D);break;case"select":case"option":break;default:typeof Q.onClick=="function"&&(D.onclick=OD)}D=q,y.updateQueue=D,D!==null&&(y.flags|=4)}else{ce=q.nodeType===9?q:q.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=Mi(A)),p==="http://www.w3.org/1999/xhtml"?A==="script"?(p=ce.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof D.is=="string"?p=ce.createElement(A,{is:D.is}):(p=ce.createElement(A),A==="select"&&(ce=p,D.multiple?ce.multiple=!0:D.size&&(ce.size=D.size))):p=ce.createElementNS(p,A),p[yf]=y,p[kw]=D,Q6e(p,y,!1,!1),y.stateNode=p;e:{switch(ce=hw(A,D),A){case"dialog":Os("cancel",p),Os("close",p),q=D;break;case"iframe":case"object":case"embed":Os("load",p),q=D;break;case"video":case"audio":for(q=0;q<Pw.length;q++)Os(Pw[q],p);q=D;break;case"source":Os("error",p),q=D;break;case"img":case"image":case"link":Os("error",p),Os("load",p),q=D;break;case"details":Os("toggle",p),q=D;break;case"input":yt(p,D),q=_t(p,D),Os("invalid",p);break;case"option":q=D;break;case"select":p._wrapperState={wasMultiple:!!D.multiple},q=pe({},D,{value:void 0}),Os("invalid",p);break;case"textarea":Gt(p,D),q=rn(p,D),Os("invalid",p);break;default:q=D}s8(A,q),Ae=q;for(Q in Ae)if(Ae.hasOwnProperty(Q)){var $e=Ae[Q];Q==="style"?i8(p,$e):Q==="dangerouslySetInnerHTML"?($e=$e?$e.__html:void 0,$e!=null&&bg(p,$e)):Q==="children"?typeof $e=="string"?(A!=="textarea"||$e!=="")&&Rl(p,$e):typeof $e=="number"&&Rl(p,""+$e):Q!=="suppressContentEditableWarning"&&Q!=="suppressHydrationWarning"&&Q!=="autoFocus"&&(b.hasOwnProperty(Q)?$e!=null&&Q==="onScroll"&&Os("scroll",p):$e!=null&&ae(p,Q,$e,ce))}switch(A){case"input":dr(p),et(p,D,!1);break;case"textarea":dr(p),or(p);break;case"option":D.value!=null&&p.setAttribute("value",""+En(D.value));break;case"select":p.multiple=!!D.multiple,Q=D.value,Q!=null?ut(p,!!D.multiple,Q,!1):D.defaultValue!=null&&ut(p,!!D.multiple,D.defaultValue,!0);break;default:typeof q.onClick=="function"&&(p.onclick=OD)}switch(A){case"button":case"input":case"select":case"textarea":D=!!D.autoFocus;break e;case"img":D=!0;break e;default:D=!1}}D&&(y.flags|=4)}y.ref!==null&&(y.flags|=512,y.flags|=2097152)}return Il(y),null;case 6:if(p&&y.stateNode!=null)e_e(p,y,p.memoizedProps,D);else{if(typeof D!="string"&&y.stateNode===null)throw Error(g(166));if(A=j9(Lw.current),j9(vf.current),$D(y)){if(D=y.stateNode,A=y.memoizedProps,D[yf]=y,(Q=D.nodeValue!==A)&&(p=Nc,p!==null))switch(p.tag){case 3:FD(D.nodeValue,A,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&FD(D.nodeValue,A,(p.mode&1)!==0)}Q&&(y.flags|=4)}else D=(A.nodeType===9?A:A.ownerDocument).createTextNode(D),D[yf]=y,y.stateNode=D}return Il(y),null;case 13:if(Bs(ro),D=y.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(Ws&&Ic!==null&&y.mode&1&&!(y.flags&128))n6e(),x8(),y.flags|=98560,Q=!1;else if(Q=$D(y),D!==null&&D.dehydrated!==null){if(p===null){if(!Q)throw Error(g(318));if(Q=y.memoizedState,Q=Q!==null?Q.dehydrated:null,!Q)throw Error(g(317));Q[yf]=y}else x8(),!(y.flags&128)&&(y.memoizedState=null),y.flags|=4;Il(y),Q=!1}else Vh!==null&&(YY(Vh),Vh=null),Q=!0;if(!Q)return y.flags&65536?y:null}return y.flags&128?(y.lanes=A,y):(D=D!==null,D!==(p!==null&&p.memoizedState!==null)&&D&&(y.child.flags|=8192,y.mode&1&&(p===null||ro.current&1?_a===0&&(_a=3):QY())),y.updateQueue!==null&&(y.flags|=4),Il(y),null);case 4:return T8(),UY(p,y),p===null&&Nw(y.stateNode.containerInfo),Il(y),null;case 10:return fY(y.type._context),Il(y),null;case 17:return K0(y.type)&&LD(),Il(y),null;case 19:if(Bs(ro),Q=y.memoizedState,Q===null)return Il(y),null;if(D=(y.flags&128)!==0,ce=Q.rendering,ce===null)if(D)$w(Q,!1);else{if(_a!==0||p!==null&&p.flags&128)for(p=y.child;p!==null;){if(ce=KD(p),ce!==null){for(y.flags|=128,$w(Q,!1),D=ce.updateQueue,D!==null&&(y.updateQueue=D,y.flags|=4),y.subtreeFlags=0,D=A,A=y.child;A!==null;)Q=A,p=D,Q.flags&=14680066,ce=Q.alternate,ce===null?(Q.childLanes=0,Q.lanes=p,Q.child=null,Q.subtreeFlags=0,Q.memoizedProps=null,Q.memoizedState=null,Q.updateQueue=null,Q.dependencies=null,Q.stateNode=null):(Q.childLanes=ce.childLanes,Q.lanes=ce.lanes,Q.child=ce.child,Q.subtreeFlags=0,Q.deletions=null,Q.memoizedProps=ce.memoizedProps,Q.memoizedState=ce.memoizedState,Q.updateQueue=ce.updateQueue,Q.type=ce.type,p=ce.dependencies,Q.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),A=A.sibling;return Ms(ro,ro.current&1|2),y.child}p=p.sibling}Q.tail!==null&&ko()>A8&&(y.flags|=128,D=!0,$w(Q,!1),y.lanes=4194304)}else{if(!D)if(p=KD(ce),p!==null){if(y.flags|=128,D=!0,A=p.updateQueue,A!==null&&(y.updateQueue=A,y.flags|=4),$w(Q,!0),Q.tail===null&&Q.tailMode==="hidden"&&!ce.alternate&&!Ws)return Il(y),null}else 2*ko()-Q.renderingStartTime>A8&&A!==1073741824&&(y.flags|=128,D=!0,$w(Q,!1),y.lanes=4194304);Q.isBackwards?(ce.sibling=y.child,y.child=ce):(A=Q.last,A!==null?A.sibling=ce:y.child=ce,Q.last=ce)}return Q.tail!==null?(y=Q.tail,Q.rendering=y,Q.tail=y.sibling,Q.renderingStartTime=ko(),y.sibling=null,A=ro.current,Ms(ro,D?A&1|2:A&1),y):(Il(y),null);case 22:case 23:return ZY(),D=y.memoizedState!==null,p!==null&&p.memoizedState!==null!==D&&(y.flags|=8192),D&&y.mode&1?kc&1073741824&&(Il(y),y.subtreeFlags&6&&(y.flags|=8192)):Il(y),null;case 24:return null;case 25:return null}throw Error(g(156,y.tag))}function H$e(p,y){switch(aY(y),y.tag){case 1:return K0(y.type)&&LD(),p=y.flags,p&65536?(y.flags=p&-65537|128,y):null;case 3:return T8(),Bs(Y0),Bs(Pl),SY(),p=y.flags,p&65536&&!(p&128)?(y.flags=p&-65537|128,y):null;case 5:return xY(y),null;case 13:if(Bs(ro),p=y.memoizedState,p!==null&&p.dehydrated!==null){if(y.alternate===null)throw Error(g(340));x8()}return p=y.flags,p&65536?(y.flags=p&-65537|128,y):null;case 19:return Bs(ro),null;case 4:return T8(),null;case 10:return fY(y.type._context),null;case 22:case 23:return ZY(),null;case 24:return null;default:return null}}var iF=!1,kl=!1,j$e=typeof WeakSet=="function"?WeakSet:Set,Wn=null;function M8(p,y){var A=p.ref;if(A!==null)if(typeof A=="function")try{A(null)}catch(D){wo(p,y,D)}else A.current=null}function t_e(p,y,A){try{A()}catch(D){wo(p,y,D)}}var n_e=!1;function W$e(p,y){if(QX=bD,p=P8e(),WX(p)){if("selectionStart"in p)var A={start:p.selectionStart,end:p.selectionEnd};else e:{A=(A=p.ownerDocument)&&A.defaultView||window;var D=A.getSelection&&A.getSelection();if(D&&D.rangeCount!==0){A=D.anchorNode;var q=D.anchorOffset,Q=D.focusNode;D=D.focusOffset;try{A.nodeType,Q.nodeType}catch{A=null;break e}var ce=0,Ae=-1,$e=-1,wt=0,an=0,fn=p,sn=null;t:for(;;){for(var Gn;fn!==A||q!==0&&fn.nodeType!==3||(Ae=ce+q),fn!==Q||D!==0&&fn.nodeType!==3||($e=ce+D),fn.nodeType===3&&(ce+=fn.nodeValue.length),(Gn=fn.firstChild)!==null;)sn=fn,fn=Gn;for(;;){if(fn===p)break t;if(sn===A&&++wt===q&&(Ae=ce),sn===Q&&++an===D&&($e=ce),(Gn=fn.nextSibling)!==null)break;fn=sn,sn=fn.parentNode}fn=Gn}A=Ae===-1||$e===-1?null:{start:Ae,end:$e}}else A=null}A=A||{start:0,end:0}}else A=null;for(JX={focusedElem:p,selectionRange:A},bD=!1,Wn=y;Wn!==null;)if(y=Wn,p=y.child,(y.subtreeFlags&1028)!==0&&p!==null)p.return=y,Wn=p;else for(;Wn!==null;){y=Wn;try{var Kn=y.alternate;if(y.flags&1024)switch(y.tag){case 0:case 11:case 15:break;case 1:if(Kn!==null){var nr=Kn.memoizedProps,Do=Kn.memoizedState,ht=y.stateNode,Ke=ht.getSnapshotBeforeUpdate(y.elementType===y.type?nr:Gh(y.type,nr),Do);ht.__reactInternalSnapshotBeforeUpdate=Ke}break;case 3:var pt=y.stateNode.containerInfo;pt.nodeType===1?pt.textContent="":pt.nodeType===9&&pt.documentElement&&pt.removeChild(pt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(g(163))}}catch(vn){wo(y,y.return,vn)}if(p=y.sibling,p!==null){p.return=y.return,Wn=p;break}Wn=y.return}return Kn=n_e,n_e=!1,Kn}function Hw(p,y,A){var D=y.updateQueue;if(D=D!==null?D.lastEffect:null,D!==null){var q=D=D.next;do{if((q.tag&p)===p){var Q=q.destroy;q.destroy=void 0,Q!==void 0&&t_e(y,A,Q)}q=q.next}while(q!==D)}}function sF(p,y){if(y=y.updateQueue,y=y!==null?y.lastEffect:null,y!==null){var A=y=y.next;do{if((A.tag&p)===p){var D=A.create;A.destroy=D()}A=A.next}while(A!==y)}}function zY(p){var y=p.ref;if(y!==null){var A=p.stateNode;switch(p.tag){case 5:p=A;break;default:p=A}typeof y=="function"?y(p):y.current=p}}function r_e(p){var y=p.alternate;y!==null&&(p.alternate=null,r_e(y)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(y=p.stateNode,y!==null&&(delete y[yf],delete y[kw],delete y[rY],delete y[A$e],delete y[R$e])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function i_e(p){return p.tag===5||p.tag===3||p.tag===4}function s_e(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||i_e(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function VY(p,y,A){var D=p.tag;if(D===5||D===6)p=p.stateNode,y?A.nodeType===8?A.parentNode.insertBefore(p,y):A.insertBefore(p,y):(A.nodeType===8?(y=A.parentNode,y.insertBefore(p,A)):(y=A,y.appendChild(p)),A=A._reactRootContainer,A!=null||y.onclick!==null||(y.onclick=OD));else if(D!==4&&(p=p.child,p!==null))for(VY(p,y,A),p=p.sibling;p!==null;)VY(p,y,A),p=p.sibling}function GY(p,y,A){var D=p.tag;if(D===5||D===6)p=p.stateNode,y?A.insertBefore(p,y):A.appendChild(p);else if(D!==4&&(p=p.child,p!==null))for(GY(p,y,A),p=p.sibling;p!==null;)GY(p,y,A),p=p.sibling}var cl=null,$h=!1;function Dg(p,y,A){for(A=A.child;A!==null;)o_e(p,y,A),A=A.sibling}function o_e(p,y,A){if(gf&&typeof gf.onCommitFiberUnmount=="function")try{gf.onCommitFiberUnmount(mD,A)}catch{}switch(A.tag){case 5:kl||M8(A,y);case 6:var D=cl,q=$h;cl=null,Dg(p,y,A),cl=D,$h=q,cl!==null&&($h?(p=cl,A=A.stateNode,p.nodeType===8?p.parentNode.removeChild(A):p.removeChild(A)):cl.removeChild(A.stateNode));break;case 18:cl!==null&&($h?(p=cl,A=A.stateNode,p.nodeType===8?nY(p.parentNode,A):p.nodeType===1&&nY(p,A),Sw(p)):nY(cl,A.stateNode));break;case 4:D=cl,q=$h,cl=A.stateNode.containerInfo,$h=!0,Dg(p,y,A),cl=D,$h=q;break;case 0:case 11:case 14:case 15:if(!kl&&(D=A.updateQueue,D!==null&&(D=D.lastEffect,D!==null))){q=D=D.next;do{var Q=q,ce=Q.destroy;Q=Q.tag,ce!==void 0&&(Q&2||Q&4)&&t_e(A,y,ce),q=q.next}while(q!==D)}Dg(p,y,A);break;case 1:if(!kl&&(M8(A,y),D=A.stateNode,typeof D.componentWillUnmount=="function"))try{D.props=A.memoizedProps,D.state=A.memoizedState,D.componentWillUnmount()}catch(Ae){wo(A,y,Ae)}Dg(p,y,A);break;case 21:Dg(p,y,A);break;case 22:A.mode&1?(kl=(D=kl)||A.memoizedState!==null,Dg(p,y,A),kl=D):Dg(p,y,A);break;default:Dg(p,y,A)}}function a_e(p){var y=p.updateQueue;if(y!==null){p.updateQueue=null;var A=p.stateNode;A===null&&(A=p.stateNode=new j$e),y.forEach(function(D){var q=tHe.bind(null,p,D);A.has(D)||(A.add(D),D.then(q,q))})}}function Hh(p,y){var A=y.deletions;if(A!==null)for(var D=0;D<A.length;D++){var q=A[D];try{var Q=p,ce=y,Ae=ce;e:for(;Ae!==null;){switch(Ae.tag){case 5:cl=Ae.stateNode,$h=!1;break e;case 3:cl=Ae.stateNode.containerInfo,$h=!0;break e;case 4:cl=Ae.stateNode.containerInfo,$h=!0;break e}Ae=Ae.return}if(cl===null)throw Error(g(160));o_e(Q,ce,q),cl=null,$h=!1;var $e=q.alternate;$e!==null&&($e.return=null),q.return=null}catch(wt){wo(q,y,wt)}}if(y.subtreeFlags&12854)for(y=y.child;y!==null;)l_e(y,p),y=y.sibling}function l_e(p,y){var A=p.alternate,D=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Hh(y,p),xf(p),D&4){try{Hw(3,p,p.return),sF(3,p)}catch(nr){wo(p,p.return,nr)}try{Hw(5,p,p.return)}catch(nr){wo(p,p.return,nr)}}break;case 1:Hh(y,p),xf(p),D&512&&A!==null&&M8(A,A.return);break;case 5:if(Hh(y,p),xf(p),D&512&&A!==null&&M8(A,A.return),p.flags&32){var q=p.stateNode;try{Rl(q,"")}catch(nr){wo(p,p.return,nr)}}if(D&4&&(q=p.stateNode,q!=null)){var Q=p.memoizedProps,ce=A!==null?A.memoizedProps:Q,Ae=p.type,$e=p.updateQueue;if(p.updateQueue=null,$e!==null)try{Ae==="input"&&Q.type==="radio"&&Q.name!=null&&Te(q,Q),hw(Ae,ce);var wt=hw(Ae,Q);for(ce=0;ce<$e.length;ce+=2){var an=$e[ce],fn=$e[ce+1];an==="style"?i8(q,fn):an==="dangerouslySetInnerHTML"?bg(q,fn):an==="children"?Rl(q,fn):ae(q,an,fn,wt)}switch(Ae){case"input":we(q,Q);break;case"textarea":Xt(q,Q);break;case"select":var sn=q._wrapperState.wasMultiple;q._wrapperState.wasMultiple=!!Q.multiple;var Gn=Q.value;Gn!=null?ut(q,!!Q.multiple,Gn,!1):sn!==!!Q.multiple&&(Q.defaultValue!=null?ut(q,!!Q.multiple,Q.defaultValue,!0):ut(q,!!Q.multiple,Q.multiple?[]:"",!1))}q[kw]=Q}catch(nr){wo(p,p.return,nr)}}break;case 6:if(Hh(y,p),xf(p),D&4){if(p.stateNode===null)throw Error(g(162));q=p.stateNode,Q=p.memoizedProps;try{q.nodeValue=Q}catch(nr){wo(p,p.return,nr)}}break;case 3:if(Hh(y,p),xf(p),D&4&&A!==null&&A.memoizedState.isDehydrated)try{Sw(y.containerInfo)}catch(nr){wo(p,p.return,nr)}break;case 4:Hh(y,p),xf(p);break;case 13:Hh(y,p),xf(p),q=p.child,q.flags&8192&&(Q=q.memoizedState!==null,q.stateNode.isHidden=Q,!Q||q.alternate!==null&&q.alternate.memoizedState!==null||(jY=ko())),D&4&&a_e(p);break;case 22:if(an=A!==null&&A.memoizedState!==null,p.mode&1?(kl=(wt=kl)||an,Hh(y,p),kl=wt):Hh(y,p),xf(p),D&8192){if(wt=p.memoizedState!==null,(p.stateNode.isHidden=wt)&&!an&&p.mode&1)for(Wn=p,an=p.child;an!==null;){for(fn=Wn=an;Wn!==null;){switch(sn=Wn,Gn=sn.child,sn.tag){case 0:case 11:case 14:case 15:Hw(4,sn,sn.return);break;case 1:M8(sn,sn.return);var Kn=sn.stateNode;if(typeof Kn.componentWillUnmount=="function"){D=sn,A=sn.return;try{y=D,Kn.props=y.memoizedProps,Kn.state=y.memoizedState,Kn.componentWillUnmount()}catch(nr){wo(D,A,nr)}}break;case 5:M8(sn,sn.return);break;case 22:if(sn.memoizedState!==null){h_e(fn);continue}}Gn!==null?(Gn.return=sn,Wn=Gn):h_e(fn)}an=an.sibling}e:for(an=null,fn=p;;){if(fn.tag===5){if(an===null){an=fn;try{q=fn.stateNode,wt?(Q=q.style,typeof Q.setProperty=="function"?Q.setProperty("display","none","important"):Q.display="none"):(Ae=fn.stateNode,$e=fn.memoizedProps.style,ce=$e!=null&&$e.hasOwnProperty("display")?$e.display:null,Ae.style.display=L9("display",ce))}catch(nr){wo(p,p.return,nr)}}}else if(fn.tag===6){if(an===null)try{fn.stateNode.nodeValue=wt?"":fn.memoizedProps}catch(nr){wo(p,p.return,nr)}}else if((fn.tag!==22&&fn.tag!==23||fn.memoizedState===null||fn===p)&&fn.child!==null){fn.child.return=fn,fn=fn.child;continue}if(fn===p)break e;for(;fn.sibling===null;){if(fn.return===null||fn.return===p)break e;an===fn&&(an=null),fn=fn.return}an===fn&&(an=null),fn.sibling.return=fn.return,fn=fn.sibling}}break;case 19:Hh(y,p),xf(p),D&4&&a_e(p);break;case 21:break;default:Hh(y,p),xf(p)}}function xf(p){var y=p.flags;if(y&2){try{e:{for(var A=p.return;A!==null;){if(i_e(A)){var D=A;break e}A=A.return}throw Error(g(160))}switch(D.tag){case 5:var q=D.stateNode;D.flags&32&&(Rl(q,""),D.flags&=-33);var Q=s_e(p);GY(p,Q,q);break;case 3:case 4:var ce=D.stateNode.containerInfo,Ae=s_e(p);VY(p,Ae,ce);break;default:throw Error(g(161))}}catch($e){wo(p,p.return,$e)}p.flags&=-3}y&4096&&(p.flags&=-4097)}function q$e(p,y,A){Wn=p,c_e(p)}function c_e(p,y,A){for(var D=(p.mode&1)!==0;Wn!==null;){var q=Wn,Q=q.child;if(q.tag===22&&D){var ce=q.memoizedState!==null||iF;if(!ce){var Ae=q.alternate,$e=Ae!==null&&Ae.memoizedState!==null||kl;Ae=iF;var wt=kl;if(iF=ce,(kl=$e)&&!wt)for(Wn=q;Wn!==null;)ce=Wn,$e=ce.child,ce.tag===22&&ce.memoizedState!==null?d_e(q):$e!==null?($e.return=ce,Wn=$e):d_e(q);for(;Q!==null;)Wn=Q,c_e(Q),Q=Q.sibling;Wn=q,iF=Ae,kl=wt}u_e(p)}else q.subtreeFlags&8772&&Q!==null?(Q.return=q,Wn=Q):u_e(p)}}function u_e(p){for(;Wn!==null;){var y=Wn;if(y.flags&8772){var A=y.alternate;try{if(y.flags&8772)switch(y.tag){case 0:case 11:case 15:kl||sF(5,y);break;case 1:var D=y.stateNode;if(y.flags&4&&!kl)if(A===null)D.componentDidMount();else{var q=y.elementType===y.type?A.memoizedProps:Gh(y.type,A.memoizedProps);D.componentDidUpdate(q,A.memoizedState,D.__reactInternalSnapshotBeforeUpdate)}var Q=y.updateQueue;Q!==null&&o6e(y,Q,D);break;case 3:var ce=y.updateQueue;if(ce!==null){if(A=null,y.child!==null)switch(y.child.tag){case 5:A=y.child.stateNode;break;case 1:A=y.child.stateNode}o6e(y,ce,A)}break;case 5:var Ae=y.stateNode;if(A===null&&y.flags&4){A=Ae;var $e=y.memoizedProps;switch(y.type){case"button":case"input":case"select":case"textarea":$e.autoFocus&&A.focus();break;case"img":$e.src&&(A.src=$e.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(y.memoizedState===null){var wt=y.alternate;if(wt!==null){var an=wt.memoizedState;if(an!==null){var fn=an.dehydrated;fn!==null&&Sw(fn)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(g(163))}kl||y.flags&512&&zY(y)}catch(sn){wo(y,y.return,sn)}}if(y===p){Wn=null;break}if(A=y.sibling,A!==null){A.return=y.return,Wn=A;break}Wn=y.return}}function h_e(p){for(;Wn!==null;){var y=Wn;if(y===p){Wn=null;break}var A=y.sibling;if(A!==null){A.return=y.return,Wn=A;break}Wn=y.return}}function d_e(p){for(;Wn!==null;){var y=Wn;try{switch(y.tag){case 0:case 11:case 15:var A=y.return;try{sF(4,y)}catch($e){wo(y,A,$e)}break;case 1:var D=y.stateNode;if(typeof D.componentDidMount=="function"){var q=y.return;try{D.componentDidMount()}catch($e){wo(y,q,$e)}}var Q=y.return;try{zY(y)}catch($e){wo(y,Q,$e)}break;case 5:var ce=y.return;try{zY(y)}catch($e){wo(y,ce,$e)}}}catch($e){wo(y,y.return,$e)}if(y===p){Wn=null;break}var Ae=y.sibling;if(Ae!==null){Ae.return=y.return,Wn=Ae;break}Wn=y.return}}var X$e=Math.ceil,oF=oe.ReactCurrentDispatcher,$Y=oe.ReactCurrentOwner,Du=oe.ReactCurrentBatchConfig,Ci=0,za=null,Qo=null,ul=0,kc=0,C8=Rg(0),_a=0,jw=null,q9=0,aF=0,HY=0,Ww=null,Q0=null,jY=0,A8=1/0,t1=null,lF=!1,WY=null,Fg=null,cF=!1,Og=null,uF=0,qw=0,qY=null,hF=-1,dF=0;function y0(){return Ci&6?ko():hF!==-1?hF:hF=ko()}function Bg(p){return p.mode&1?Ci&2&&ul!==0?ul&-ul:N$e.transition!==null?(dF===0&&(dF=n8e()),dF):(p=os,p!==0||(p=window.event,p=p===void 0?16:h8e(p.type)),p):1}function jh(p,y,A,D){if(50<qw)throw qw=0,qY=null,Error(g(185));yw(p,A,D),(!(Ci&2)||p!==za)&&(p===za&&(!(Ci&2)&&(aF|=A),_a===4&&Lg(p,ul)),J0(p,D),A===1&&Ci===0&&!(y.mode&1)&&(A8=ko()+500,zD&&Ng()))}function J0(p,y){var A=p.callbackNode;kGe(p,y);var D=vD(p,p===za?ul:0);if(D===0)A!==null&&Jve(A),p.callbackNode=null,p.callbackPriority=0;else if(y=D&-D,p.callbackPriority!==y){if(A!=null&&Jve(A),y===1)p.tag===0?P$e(p_e.bind(null,p)):Z8e(p_e.bind(null,p)),M$e(function(){!(Ci&6)&&Ng()}),A=null;else{switch(r8e(D)){case 1:A=RX;break;case 4:A=e8e;break;case 16:A=pD;break;case 536870912:A=t8e;break;default:A=pD}A=S_e(A,f_e.bind(null,p))}p.callbackPriority=y,p.callbackNode=A}}function f_e(p,y){if(hF=-1,dF=0,Ci&6)throw Error(g(327));var A=p.callbackNode;if(R8()&&p.callbackNode!==A)return null;var D=vD(p,p===za?ul:0);if(D===0)return null;if(D&30||D&p.expiredLanes||y)y=fF(p,D);else{y=D;var q=Ci;Ci|=2;var Q=g_e();(za!==p||ul!==y)&&(t1=null,A8=ko()+500,Y9(p,y));do try{Z$e();break}catch(Ae){m_e(p,Ae)}while(1);dY(),oF.current=Q,Ci=q,Qo!==null?y=0:(za=null,ul=0,y=_a)}if(y!==0){if(y===2&&(q=PX(p),q!==0&&(D=q,y=XY(p,q))),y===1)throw A=jw,Y9(p,0),Lg(p,D),J0(p,ko()),A;if(y===6)Lg(p,D);else{if(q=p.current.alternate,!(D&30)&&!Y$e(q)&&(y=fF(p,D),y===2&&(Q=PX(p),Q!==0&&(D=Q,y=XY(p,Q))),y===1))throw A=jw,Y9(p,0),Lg(p,D),J0(p,ko()),A;switch(p.finishedWork=q,p.finishedLanes=D,y){case 0:case 1:throw Error(g(345));case 2:K9(p,Q0,t1);break;case 3:if(Lg(p,D),(D&130023424)===D&&(y=jY+500-ko(),10<y)){if(vD(p,0)!==0)break;if(q=p.suspendedLanes,(q&D)!==D){y0(),p.pingedLanes|=p.suspendedLanes&q;break}p.timeoutHandle=tY(K9.bind(null,p,Q0,t1),y);break}K9(p,Q0,t1);break;case 4:if(Lg(p,D),(D&4194240)===D)break;for(y=p.eventTimes,q=-1;0<D;){var ce=31-Uh(D);Q=1<<ce,ce=y[ce],ce>q&&(q=ce),D&=~Q}if(D=q,D=ko()-D,D=(120>D?120:480>D?480:1080>D?1080:1920>D?1920:3e3>D?3e3:4320>D?4320:1960*X$e(D/1960))-D,10<D){p.timeoutHandle=tY(K9.bind(null,p,Q0,t1),D);break}K9(p,Q0,t1);break;case 5:K9(p,Q0,t1);break;default:throw Error(g(329))}}}return J0(p,ko()),p.callbackNode===A?f_e.bind(null,p):null}function XY(p,y){var A=Ww;return p.current.memoizedState.isDehydrated&&(Y9(p,y).flags|=256),p=fF(p,y),p!==2&&(y=Q0,Q0=A,y!==null&&YY(y)),p}function YY(p){Q0===null?Q0=p:Q0.push.apply(Q0,p)}function Y$e(p){for(var y=p;;){if(y.flags&16384){var A=y.updateQueue;if(A!==null&&(A=A.stores,A!==null))for(var D=0;D<A.length;D++){var q=A[D],Q=q.getSnapshot;q=q.value;try{if(!zh(Q(),q))return!1}catch{return!1}}}if(A=y.child,y.subtreeFlags&16384&&A!==null)A.return=y,y=A;else{if(y===p)break;for(;y.sibling===null;){if(y.return===null||y.return===p)return!0;y=y.return}y.sibling.return=y.return,y=y.sibling}}return!0}function Lg(p,y){for(y&=~HY,y&=~aF,p.suspendedLanes|=y,p.pingedLanes&=~y,p=p.expirationTimes;0<y;){var A=31-Uh(y),D=1<<A;p[A]=-1,y&=~D}}function p_e(p){if(Ci&6)throw Error(g(327));R8();var y=vD(p,0);if(!(y&1))return J0(p,ko()),null;var A=fF(p,y);if(p.tag!==0&&A===2){var D=PX(p);D!==0&&(y=D,A=XY(p,D))}if(A===1)throw A=jw,Y9(p,0),Lg(p,y),J0(p,ko()),A;if(A===6)throw Error(g(345));return p.finishedWork=p.current.alternate,p.finishedLanes=y,K9(p,Q0,t1),J0(p,ko()),null}function KY(p,y){var A=Ci;Ci|=1;try{return p(y)}finally{Ci=A,Ci===0&&(A8=ko()+500,zD&&Ng())}}function X9(p){Og!==null&&Og.tag===0&&!(Ci&6)&&R8();var y=Ci;Ci|=1;var A=Du.transition,D=os;try{if(Du.transition=null,os=1,p)return p()}finally{os=D,Du.transition=A,Ci=y,!(Ci&6)&&Ng()}}function ZY(){kc=C8.current,Bs(C8)}function Y9(p,y){p.finishedWork=null,p.finishedLanes=0;var A=p.timeoutHandle;if(A!==-1&&(p.timeoutHandle=-1,E$e(A)),Qo!==null)for(A=Qo.return;A!==null;){var D=A;switch(aY(D),D.tag){case 1:D=D.type.childContextTypes,D!=null&&LD();break;case 3:T8(),Bs(Y0),Bs(Pl),SY();break;case 5:xY(D);break;case 4:T8();break;case 13:Bs(ro);break;case 19:Bs(ro);break;case 10:fY(D.type._context);break;case 22:case 23:ZY()}A=A.return}if(za=p,Qo=p=Ug(p.current,null),ul=kc=y,_a=0,jw=null,HY=aF=q9=0,Q0=Ww=null,H9!==null){for(y=0;y<H9.length;y++)if(A=H9[y],D=A.interleaved,D!==null){A.interleaved=null;var q=D.next,Q=A.pending;if(Q!==null){var ce=Q.next;Q.next=q,D.next=ce}A.pending=D}H9=null}return p}function m_e(p,y){do{var A=Qo;try{if(dY(),ZD.current=tF,QD){for(var D=io.memoizedState;D!==null;){var q=D.queue;q!==null&&(q.pending=null),D=D.next}QD=!1}if(W9=0,Ua=va=io=null,Uw=!1,zw=0,$Y.current=null,A===null||A.return===null){_a=1,jw=y,Qo=null;break}e:{var Q=p,ce=A.return,Ae=A,$e=y;if(y=ul,Ae.flags|=32768,$e!==null&&typeof $e=="object"&&typeof $e.then=="function"){var wt=$e,an=Ae,fn=an.tag;if(!(an.mode&1)&&(fn===0||fn===11||fn===15)){var sn=an.alternate;sn?(an.updateQueue=sn.updateQueue,an.memoizedState=sn.memoizedState,an.lanes=sn.lanes):(an.updateQueue=null,an.memoizedState=null)}var Gn=U6e(ce);if(Gn!==null){Gn.flags&=-257,z6e(Gn,ce,Ae,Q,y),Gn.mode&1&&L6e(Q,wt,y),y=Gn,$e=wt;var Kn=y.updateQueue;if(Kn===null){var nr=new Set;nr.add($e),y.updateQueue=nr}else Kn.add($e);break e}else{if(!(y&1)){L6e(Q,wt,y),QY();break e}$e=Error(g(426))}}else if(Ws&&Ae.mode&1){var Do=U6e(ce);if(Do!==null){!(Do.flags&65536)&&(Do.flags|=256),z6e(Do,ce,Ae,Q,y),uY(E8($e,Ae));break e}}Q=$e=E8($e,Ae),_a!==4&&(_a=2),Ww===null?Ww=[Q]:Ww.push(Q),Q=ce;do{switch(Q.tag){case 3:Q.flags|=65536,y&=-y,Q.lanes|=y;var ht=O6e(Q,$e,y);s6e(Q,ht);break e;case 1:Ae=$e;var Ke=Q.type,pt=Q.stateNode;if(!(Q.flags&128)&&(typeof Ke.getDerivedStateFromError=="function"||pt!==null&&typeof pt.componentDidCatch=="function"&&(Fg===null||!Fg.has(pt)))){Q.flags|=65536,y&=-y,Q.lanes|=y;var vn=B6e(Q,Ae,y);s6e(Q,vn);break e}}Q=Q.return}while(Q!==null)}v_e(A)}catch(sr){y=sr,Qo===A&&A!==null&&(Qo=A=A.return);continue}break}while(1)}function g_e(){var p=oF.current;return oF.current=tF,p===null?tF:p}function QY(){(_a===0||_a===3||_a===2)&&(_a=4),za===null||!(q9&268435455)&&!(aF&268435455)||Lg(za,ul)}function fF(p,y){var A=Ci;Ci|=2;var D=g_e();(za!==p||ul!==y)&&(t1=null,Y9(p,y));do try{K$e();break}catch(q){m_e(p,q)}while(1);if(dY(),Ci=A,oF.current=D,Qo!==null)throw Error(g(261));return za=null,ul=0,_a}function K$e(){for(;Qo!==null;)y_e(Qo)}function Z$e(){for(;Qo!==null&&!TGe();)y_e(Qo)}function y_e(p){var y=b_e(p.alternate,p,kc);p.memoizedProps=p.pendingProps,y===null?v_e(p):Qo=y,$Y.current=null}function v_e(p){var y=p;do{var A=y.alternate;if(p=y.return,y.flags&32768){if(A=H$e(A,y),A!==null){A.flags&=32767,Qo=A;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{_a=6,Qo=null;return}}else if(A=$$e(A,y,kc),A!==null){Qo=A;return}if(y=y.sibling,y!==null){Qo=y;return}Qo=y=p}while(y!==null);_a===0&&(_a=5)}function K9(p,y,A){var D=os,q=Du.transition;try{Du.transition=null,os=1,Q$e(p,y,A,D)}finally{Du.transition=q,os=D}return null}function Q$e(p,y,A,D){do R8();while(Og!==null);if(Ci&6)throw Error(g(327));A=p.finishedWork;var q=p.finishedLanes;if(A===null)return null;if(p.finishedWork=null,p.finishedLanes=0,A===p.current)throw Error(g(177));p.callbackNode=null,p.callbackPriority=0;var Q=A.lanes|A.childLanes;if(DGe(p,Q),p===za&&(Qo=za=null,ul=0),!(A.subtreeFlags&2064)&&!(A.flags&2064)||cF||(cF=!0,S_e(pD,function(){return R8(),null})),Q=(A.flags&15990)!==0,A.subtreeFlags&15990||Q){Q=Du.transition,Du.transition=null;var ce=os;os=1;var Ae=Ci;Ci|=4,$Y.current=null,W$e(p,A),l_e(A,p),x$e(JX),bD=!!QX,JX=QX=null,p.current=A,q$e(A),EGe(),Ci=Ae,os=ce,Du.transition=Q}else p.current=A;if(cF&&(cF=!1,Og=p,uF=q),Q=p.pendingLanes,Q===0&&(Fg=null),AGe(A.stateNode),J0(p,ko()),y!==null)for(D=p.onRecoverableError,A=0;A<y.length;A++)q=y[A],D(q.value,{componentStack:q.stack,digest:q.digest});if(lF)throw lF=!1,p=WY,WY=null,p;return uF&1&&p.tag!==0&&R8(),Q=p.pendingLanes,Q&1?p===qY?qw++:(qw=0,qY=p):qw=0,Ng(),null}function R8(){if(Og!==null){var p=r8e(uF),y=Du.transition,A=os;try{if(Du.transition=null,os=16>p?16:p,Og===null)var D=!1;else{if(p=Og,Og=null,uF=0,Ci&6)throw Error(g(331));var q=Ci;for(Ci|=4,Wn=p.current;Wn!==null;){var Q=Wn,ce=Q.child;if(Wn.flags&16){var Ae=Q.deletions;if(Ae!==null){for(var $e=0;$e<Ae.length;$e++){var wt=Ae[$e];for(Wn=wt;Wn!==null;){var an=Wn;switch(an.tag){case 0:case 11:case 15:Hw(8,an,Q)}var fn=an.child;if(fn!==null)fn.return=an,Wn=fn;else for(;Wn!==null;){an=Wn;var sn=an.sibling,Gn=an.return;if(r_e(an),an===wt){Wn=null;break}if(sn!==null){sn.return=Gn,Wn=sn;break}Wn=Gn}}}var Kn=Q.alternate;if(Kn!==null){var nr=Kn.child;if(nr!==null){Kn.child=null;do{var Do=nr.sibling;nr.sibling=null,nr=Do}while(nr!==null)}}Wn=Q}}if(Q.subtreeFlags&2064&&ce!==null)ce.return=Q,Wn=ce;else e:for(;Wn!==null;){if(Q=Wn,Q.flags&2048)switch(Q.tag){case 0:case 11:case 15:Hw(9,Q,Q.return)}var ht=Q.sibling;if(ht!==null){ht.return=Q.return,Wn=ht;break e}Wn=Q.return}}var Ke=p.current;for(Wn=Ke;Wn!==null;){ce=Wn;var pt=ce.child;if(ce.subtreeFlags&2064&&pt!==null)pt.return=ce,Wn=pt;else e:for(ce=Ke;Wn!==null;){if(Ae=Wn,Ae.flags&2048)try{switch(Ae.tag){case 0:case 11:case 15:sF(9,Ae)}}catch(sr){wo(Ae,Ae.return,sr)}if(Ae===ce){Wn=null;break e}var vn=Ae.sibling;if(vn!==null){vn.return=Ae.return,Wn=vn;break e}Wn=Ae.return}}if(Ci=q,Ng(),gf&&typeof gf.onPostCommitFiberRoot=="function")try{gf.onPostCommitFiberRoot(mD,p)}catch{}D=!0}return D}finally{os=A,Du.transition=y}}return!1}function __e(p,y,A){y=E8(A,y),y=O6e(p,y,1),p=kg(p,y,1),y=y0(),p!==null&&(yw(p,1,y),J0(p,y))}function wo(p,y,A){if(p.tag===3)__e(p,p,A);else for(;y!==null;){if(y.tag===3){__e(y,p,A);break}else if(y.tag===1){var D=y.stateNode;if(typeof y.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(Fg===null||!Fg.has(D))){p=E8(A,p),p=B6e(y,p,1),y=kg(y,p,1),p=y0(),y!==null&&(yw(y,1,p),J0(y,p));break}}y=y.return}}function J$e(p,y,A){var D=p.pingCache;D!==null&&D.delete(y),y=y0(),p.pingedLanes|=p.suspendedLanes&A,za===p&&(ul&A)===A&&(_a===4||_a===3&&(ul&130023424)===ul&&500>ko()-jY?Y9(p,0):HY|=A),J0(p,y)}function x_e(p,y){y===0&&(p.mode&1?(y=yD,yD<<=1,!(yD&130023424)&&(yD=4194304)):y=1);var A=y0();p=Qp(p,y),p!==null&&(yw(p,y,A),J0(p,A))}function eHe(p){var y=p.memoizedState,A=0;y!==null&&(A=y.retryLane),x_e(p,A)}function tHe(p,y){var A=0;switch(p.tag){case 13:var D=p.stateNode,q=p.memoizedState;q!==null&&(A=q.retryLane);break;case 19:D=p.stateNode;break;default:throw Error(g(314))}D!==null&&D.delete(y),x_e(p,A)}var b_e;b_e=function(p,y,A){if(p!==null)if(p.memoizedProps!==y.pendingProps||Y0.current)Z0=!0;else{if(!(p.lanes&A)&&!(y.flags&128))return Z0=!1,G$e(p,y,A);Z0=!!(p.flags&131072)}else Z0=!1,Ws&&y.flags&1048576&&Q8e(y,GD,y.index);switch(y.lanes=0,y.tag){case 2:var D=y.type;rF(p,y),p=y.pendingProps;var q=y8(y,Pl.current);S8(y,A),q=EY(null,y,D,p,q,A);var Q=MY();return y.flags|=1,typeof q=="object"&&q!==null&&typeof q.render=="function"&&q.$$typeof===void 0?(y.tag=1,y.memoizedState=null,y.updateQueue=null,K0(D)?(Q=!0,UD(y)):Q=!1,y.memoizedState=q.state!==null&&q.state!==void 0?q.state:null,gY(y),q.updater=XD,y.stateNode=q,q._reactInternals=y,vY(y,D,p,A),y=DY(null,y,D,!0,Q,A)):(y.tag=0,Ws&&Q&&oY(y),g0(null,y,q,A),y=y.child),y;case 16:D=y.elementType;e:{switch(rF(p,y),p=y.pendingProps,q=D._init,D=q(D._payload),y.type=D,q=y.tag=rHe(D),p=Gh(D,p),q){case 0:y=kY(null,y,D,p,A);break e;case 1:y=W6e(null,y,D,p,A);break e;case 11:y=V6e(null,y,D,p,A);break e;case 14:y=G6e(null,y,D,Gh(D.type,p),A);break e}throw Error(g(306,D,""))}return y;case 0:return D=y.type,q=y.pendingProps,q=y.elementType===D?q:Gh(D,q),kY(p,y,D,q,A);case 1:return D=y.type,q=y.pendingProps,q=y.elementType===D?q:Gh(D,q),W6e(p,y,D,q,A);case 3:e:{if(q6e(y),p===null)throw Error(g(387));D=y.pendingProps,Q=y.memoizedState,q=Q.element,i6e(p,y),qD(y,D,null,A);var ce=y.memoizedState;if(D=ce.element,Q.isDehydrated)if(Q={element:D,isDehydrated:!1,cache:ce.cache,pendingSuspenseBoundaries:ce.pendingSuspenseBoundaries,transitions:ce.transitions},y.updateQueue.baseState=Q,y.memoizedState=Q,y.flags&256){q=E8(Error(g(423)),y),y=X6e(p,y,D,A,q);break e}else if(D!==q){q=E8(Error(g(424)),y),y=X6e(p,y,D,A,q);break e}else for(Ic=Ag(y.stateNode.containerInfo.firstChild),Nc=y,Ws=!0,Vh=null,A=f6e(y,null,D,A),y.child=A;A;)A.flags=A.flags&-3|4096,A=A.sibling;else{if(x8(),D===q){y=e1(p,y,A);break e}g0(p,y,D,A)}y=y.child}return y;case 5:return p6e(y),p===null&&cY(y),D=y.type,q=y.pendingProps,Q=p!==null?p.memoizedProps:null,ce=q.children,eY(D,q)?ce=null:Q!==null&&eY(D,Q)&&(y.flags|=32),j6e(p,y),g0(p,y,ce,A),y.child;case 6:return p===null&&cY(y),null;case 13:return Y6e(p,y,A);case 4:return _Y(y,y.stateNode.containerInfo),D=y.pendingProps,p===null?y.child=w8(y,null,D,A):g0(p,y,D,A),y.child;case 11:return D=y.type,q=y.pendingProps,q=y.elementType===D?q:Gh(D,q),V6e(p,y,D,q,A);case 7:return g0(p,y,y.pendingProps,A),y.child;case 8:return g0(p,y,y.pendingProps.children,A),y.child;case 12:return g0(p,y,y.pendingProps.children,A),y.child;case 10:e:{if(D=y.type._context,q=y.pendingProps,Q=y.memoizedProps,ce=q.value,Ms(HD,D._currentValue),D._currentValue=ce,Q!==null)if(zh(Q.value,ce)){if(Q.children===q.children&&!Y0.current){y=e1(p,y,A);break e}}else for(Q=y.child,Q!==null&&(Q.return=y);Q!==null;){var Ae=Q.dependencies;if(Ae!==null){ce=Q.child;for(var $e=Ae.firstContext;$e!==null;){if($e.context===D){if(Q.tag===1){$e=Jp(-1,A&-A),$e.tag=2;var wt=Q.updateQueue;if(wt!==null){wt=wt.shared;var an=wt.pending;an===null?$e.next=$e:($e.next=an.next,an.next=$e),wt.pending=$e}}Q.lanes|=A,$e=Q.alternate,$e!==null&&($e.lanes|=A),pY(Q.return,A,y),Ae.lanes|=A;break}$e=$e.next}}else if(Q.tag===10)ce=Q.type===y.type?null:Q.child;else if(Q.tag===18){if(ce=Q.return,ce===null)throw Error(g(341));ce.lanes|=A,Ae=ce.alternate,Ae!==null&&(Ae.lanes|=A),pY(ce,A,y),ce=Q.sibling}else ce=Q.child;if(ce!==null)ce.return=Q;else for(ce=Q;ce!==null;){if(ce===y){ce=null;break}if(Q=ce.sibling,Q!==null){Q.return=ce.return,ce=Q;break}ce=ce.return}Q=ce}g0(p,y,q.children,A),y=y.child}return y;case 9:return q=y.type,D=y.pendingProps.children,S8(y,A),q=Iu(q),D=D(q),y.flags|=1,g0(p,y,D,A),y.child;case 14:return D=y.type,q=Gh(D,y.pendingProps),q=Gh(D.type,q),G6e(p,y,D,q,A);case 15:return $6e(p,y,y.type,y.pendingProps,A);case 17:return D=y.type,q=y.pendingProps,q=y.elementType===D?q:Gh(D,q),rF(p,y),y.tag=1,K0(D)?(p=!0,UD(y)):p=!1,S8(y,A),c6e(y,D,q),vY(y,D,q,A),DY(null,y,D,!0,p,A);case 19:return Z6e(p,y,A);case 22:return H6e(p,y,A)}throw Error(g(156,y.tag))};function S_e(p,y){return Qve(p,y)}function nHe(p,y,A,D){this.tag=p,this.key=A,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=y,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fu(p,y,A,D){return new nHe(p,y,A,D)}function JY(p){return p=p.prototype,!(!p||!p.isReactComponent)}function rHe(p){if(typeof p=="function")return JY(p)?1:0;if(p!=null){if(p=p.$$typeof,p===Be)return 11;if(p===nn)return 14}return 2}function Ug(p,y){var A=p.alternate;return A===null?(A=Fu(p.tag,y,p.key,p.mode),A.elementType=p.elementType,A.type=p.type,A.stateNode=p.stateNode,A.alternate=p,p.alternate=A):(A.pendingProps=y,A.type=p.type,A.flags=0,A.subtreeFlags=0,A.deletions=null),A.flags=p.flags&14680064,A.childLanes=p.childLanes,A.lanes=p.lanes,A.child=p.child,A.memoizedProps=p.memoizedProps,A.memoizedState=p.memoizedState,A.updateQueue=p.updateQueue,y=p.dependencies,A.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext},A.sibling=p.sibling,A.index=p.index,A.ref=p.ref,A}function pF(p,y,A,D,q,Q){var ce=2;if(D=p,typeof p=="function")JY(p)&&(ce=1);else if(typeof p=="string")ce=5;else e:switch(p){case Ie:return Z9(A.children,q,Q,y);case _e:ce=8,q|=8;break;case Oe:return p=Fu(12,A,y,q|2),p.elementType=Oe,p.lanes=Q,p;case re:return p=Fu(13,A,y,q),p.elementType=re,p.lanes=Q,p;case Ye:return p=Fu(19,A,y,q),p.elementType=Ye,p.lanes=Q,p;case Re:return mF(A,q,Q,y);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case ot:ce=10;break e;case de:ce=9;break e;case Be:ce=11;break e;case nn:ce=14;break e;case ke:ce=16,D=null;break e}throw Error(g(130,p==null?p:typeof p,""))}return y=Fu(ce,A,y,q),y.elementType=p,y.type=D,y.lanes=Q,y}function Z9(p,y,A,D){return p=Fu(7,p,D,y),p.lanes=A,p}function mF(p,y,A,D){return p=Fu(22,p,D,y),p.elementType=Re,p.lanes=A,p.stateNode={isHidden:!1},p}function eK(p,y,A){return p=Fu(6,p,null,y),p.lanes=A,p}function tK(p,y,A){return y=Fu(4,p.children!==null?p.children:[],p.key,y),y.lanes=A,y.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},y}function iHe(p,y,A,D,q){this.tag=y,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=NX(0),this.expirationTimes=NX(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=NX(0),this.identifierPrefix=D,this.onRecoverableError=q,this.mutableSourceEagerHydrationData=null}function nK(p,y,A,D,q,Q,ce,Ae,$e){return p=new iHe(p,y,A,Ae,$e),y===1?(y=1,Q===!0&&(y|=8)):y=0,Q=Fu(3,null,null,y),p.current=Q,Q.stateNode=p,Q.memoizedState={element:D,isDehydrated:A,cache:null,transitions:null,pendingSuspenseBoundaries:null},gY(Q),p}function sHe(p,y,A){var D=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ee,key:D==null?null:""+D,children:p,containerInfo:y,implementation:A}}function w_e(p){if(!p)return Pg;p=p._reactInternals;e:{if(U9(p)!==p||p.tag!==1)throw Error(g(170));var y=p;do{switch(y.tag){case 3:y=y.stateNode.context;break e;case 1:if(K0(y.type)){y=y.stateNode.__reactInternalMemoizedMergedChildContext;break e}}y=y.return}while(y!==null);throw Error(g(171))}if(p.tag===1){var A=p.type;if(K0(A))return Y8e(p,A,y)}return y}function T_e(p,y,A,D,q,Q,ce,Ae,$e){return p=nK(A,D,!0,p,q,Q,ce,Ae,$e),p.context=w_e(null),A=p.current,D=y0(),q=Bg(A),Q=Jp(D,q),Q.callback=y??null,kg(A,Q,q),p.current.lanes=q,yw(p,q,D),J0(p,D),p}function gF(p,y,A,D){var q=y.current,Q=y0(),ce=Bg(q);return A=w_e(A),y.context===null?y.context=A:y.pendingContext=A,y=Jp(Q,ce),y.payload={element:p},D=D===void 0?null:D,D!==null&&(y.callback=D),p=kg(q,y,ce),p!==null&&(jh(p,q,ce,Q),WD(p,q,ce)),ce}function yF(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function E_e(p,y){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var A=p.retryLane;p.retryLane=A!==0&&A<y?A:y}}function rK(p,y){E_e(p,y),(p=p.alternate)&&E_e(p,y)}function oHe(){return null}var M_e=typeof reportError=="function"?reportError:function(p){console.error(p)};function iK(p){this._internalRoot=p}vF.prototype.render=iK.prototype.render=function(p){var y=this._internalRoot;if(y===null)throw Error(g(409));gF(p,y,null,null)},vF.prototype.unmount=iK.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var y=p.containerInfo;X9(function(){gF(null,p,null,null)}),y[Xp]=null}};function vF(p){this._internalRoot=p}vF.prototype.unstable_scheduleHydration=function(p){if(p){var y=o8e();p={blockedOn:null,target:p,priority:y};for(var A=0;A<Eg.length&&y!==0&&y<Eg[A].priority;A++);Eg.splice(A,0,p),A===0&&c8e(p)}};function sK(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function _F(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function C_e(){}function aHe(p,y,A,D,q){if(q){if(typeof D=="function"){var Q=D;D=function(){var wt=yF(ce);Q.call(wt)}}var ce=T_e(y,D,p,0,null,!1,!1,"",C_e);return p._reactRootContainer=ce,p[Xp]=ce.current,Nw(p.nodeType===8?p.parentNode:p),X9(),ce}for(;q=p.lastChild;)p.removeChild(q);if(typeof D=="function"){var Ae=D;D=function(){var wt=yF($e);Ae.call(wt)}}var $e=nK(p,0,!1,null,null,!1,!1,"",C_e);return p._reactRootContainer=$e,p[Xp]=$e.current,Nw(p.nodeType===8?p.parentNode:p),X9(function(){gF(y,$e,A,D)}),$e}function xF(p,y,A,D,q){var Q=A._reactRootContainer;if(Q){var ce=Q;if(typeof q=="function"){var Ae=q;q=function(){var $e=yF(ce);Ae.call($e)}}gF(y,ce,p,q)}else ce=aHe(A,y,p,q,D);return yF(ce)}i8e=function(p){switch(p.tag){case 3:var y=p.stateNode;if(y.current.memoizedState.isDehydrated){var A=gw(y.pendingLanes);A!==0&&(IX(y,A|1),J0(y,ko()),!(Ci&6)&&(A8=ko()+500,Ng()))}break;case 13:X9(function(){var D=Qp(p,1);if(D!==null){var q=y0();jh(D,p,1,q)}}),rK(p,1)}},kX=function(p){if(p.tag===13){var y=Qp(p,134217728);if(y!==null){var A=y0();jh(y,p,134217728,A)}rK(p,134217728)}},s8e=function(p){if(p.tag===13){var y=Bg(p),A=Qp(p,y);if(A!==null){var D=y0();jh(A,p,y,D)}rK(p,y)}},o8e=function(){return os},a8e=function(p,y){var A=os;try{return os=p,y()}finally{os=A}},o8=function(p,y,A){switch(y){case"input":if(we(p,A),y=A.name,A.type==="radio"&&y!=null){for(A=p;A.parentNode;)A=A.parentNode;for(A=A.querySelectorAll("input[name="+JSON.stringify(""+y)+'][type="radio"]'),y=0;y<A.length;y++){var D=A[y];if(D!==p&&D.form===p.form){var q=BD(D);if(!q)throw Error(g(90));ki(D),we(D,q)}}}break;case"textarea":Xt(p,A);break;case"select":y=A.value,y!=null&&ut(p,!!A.multiple,y,!1)}},jve=KY,Wve=X9;var lHe={usingClientEntryPoint:!1,Events:[Dw,m8,BD,$ve,Hve,KY]},Xw={findFiberByHostInstance:z9,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},cHe={bundleType:Xw.bundleType,version:Xw.version,rendererPackageName:Xw.rendererPackageName,rendererConfig:Xw.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:oe.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=Kve(p),p===null?null:p.stateNode},findFiberByHostInstance:Xw.findFiberByHostInstance||oHe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&(Yw=__REACT_DEVTOOLS_GLOBAL_HOOK__,!Yw.isDisabled&&Yw.supportsFiber))try{mD=Yw.inject(cHe),gf=Yw}catch{}var Yw;l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lHe,l.createPortal=function(p,y){var A=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!sK(y))throw Error(g(200));return sHe(p,y,null,A)},l.createRoot=function(p,y){if(!sK(p))throw Error(g(299));var A=!1,D="",q=M_e;return y!=null&&(y.unstable_strictMode===!0&&(A=!0),y.identifierPrefix!==void 0&&(D=y.identifierPrefix),y.onRecoverableError!==void 0&&(q=y.onRecoverableError)),y=nK(p,1,!1,null,null,A,!1,D,q),p[Xp]=y.current,Nw(p.nodeType===8?p.parentNode:p),new iK(y)},l.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var y=p._reactInternals;if(y===void 0)throw typeof p.render=="function"?Error(g(188)):(p=Object.keys(p).join(","),Error(g(268,p)));return p=Kve(y),p=p===null?null:p.stateNode,p},l.flushSync=function(p){return X9(p)},l.hydrate=function(p,y,A){if(!_F(y))throw Error(g(200));return xF(null,p,y,!0,A)},l.hydrateRoot=function(p,y,A){if(!sK(p))throw Error(g(405));var D=A!=null&&A.hydratedSources||null,q=!1,Q="",ce=M_e;if(A!=null&&(A.unstable_strictMode===!0&&(q=!0),A.identifierPrefix!==void 0&&(Q=A.identifierPrefix),A.onRecoverableError!==void 0&&(ce=A.onRecoverableError)),y=T_e(y,null,p,1,A??null,q,!1,Q,ce),p[Xp]=y.current,Nw(p),D)for(p=0;p<D.length;p++)A=D[p],q=A._getVersion,q=q(A._source),y.mutableSourceEagerHydrationData==null?y.mutableSourceEagerHydrationData=[A,q]:y.mutableSourceEagerHydrationData.push(A,q);return new vF(y)},l.render=function(p,y,A){if(!_F(y))throw Error(g(200));return xF(null,p,y,!1,A)},l.unmountComponentAtNode=function(p){if(!_F(p))throw Error(g(40));return p._reactRootContainer?(X9(function(){xF(null,null,p,!1,function(){p._reactRootContainer=null,p[Xp]=null})}),!0):!1},l.unstable_batchedUpdates=KY,l.unstable_renderSubtreeIntoContainer=function(p,y,A,D){if(!_F(A))throw Error(g(200));if(p==null||p._reactInternals===void 0)throw Error(g(38));return xF(p,y,A,!1,D)},l.version="18.2.0-next-9e3b772b8-20220608"}),gu=L((l,h)=>{function d(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(d)}catch(g){console.error(g)}}d(),h.exports=p$()});function ZP(l){let[,h]=(0,yu.useState)(0);return(0,yu.useCallback)(()=>{h(d=>d+1)},[])}function Rr(l,h,d){let g=(0,yu.useCallback)(l,h),_=(0,yu.useRef)(null);_.current?_.current.set(g):_.current=new q5.Atom(g);let b=(0,yu.useRef)(null);return b.current||(b.current=(0,q5.prism)(()=>_.current.prism.getValue()())),j3(b.current,d)}function mh(){X5||(X5=!0,(0,QP.default)(()=>{(0,JP.unstable_batchedUpdates)(function(){for(var l,h;$0.length>0;){let d=$0.shift();Um.delete(d);let g;Sp&&((l=d.debug)==null||l.history.push("queue reached"));try{g=d.der.getValue()}catch(_){Sp&&((h=d.debug)==null||h.history.push("queue: der.getValue() errored")),console.error("A `der.getValue()` in `usePrismInstance(der)` threw an error. This may be a zombie child issue, so we're gonna try to get its value again in a normal react render phase.If you see the same error again, then you either have an error in your prism code, or the deps array in `usePrism(fn, deps)` is missing a dependency and causing the prism to read stale values."),console.error(_),d.runUpdate();continue}g!==d.lastValue&&(d.lastValue=g,d.runUpdate())}X5=!1},1)}))}function j3(l,h){var d;let g=ZP(),_=(0,yu.useRef)(void 0);_.current||(xb++,_.current={order:xb,runUpdate:()=>{_.current.unmounted||g()},der:l,lastValue:void 0,unmounted:!1,queueUpdate:()=>{var S;Sp&&((S=_.current.debug)==null||S.history.push("queueUpdate()")),eN(_.current)},untap:l.onStale(()=>{Sp&&_.current.debug.history.push("onStale(cb)"),_.current.queueUpdate()})},Sp&&(_.current.debug={label:h,traceOfFirstTimeRender:new Error,history:[]})),(0,yu.useLayoutEffect)(()=>function(){_.current.unmounted=!0,_.current.untap(),bb(_.current)},[]),bb(_.current);let b=_.current.der.getValue();return _.current.lastValue=b,Sp&&((d=_.current.debug)==null||d.history.push("rendered")),b}var q5,QP,yu,JP,Sp,Dr,xb,$0,Um,X5,eN,tN,bb,Qn=C(()=>{q5=Jt,bo(),QP=z(d$()),yu=z(Le()),JP=z(gu()),Sp=!1,Dr=(l,h)=>Rr(()=>(0,q5.val)(l),[l],h),xb=0,$0=[],Um=new Set,X5=!1,eN=l=>{tN(l),mh()},tN=l=>{if(!Um.has(l))if(Um.add(l),$0.length===0)$0.push(l);else{let h=ub($0,d=>d.order>=l.order);h===-1?$0.push(l):$0[h].order>l.order&&$0.splice(h,0,l)}},bb=l=>{if(!Um.has(l))return;Um.delete(l);let h=ub($0,d=>d===l);$0.splice(h,1)}}),nN=L(l=>{var h=60103,d=60106,g=60107,_=60108,b=60114,S=60109,E=60110,N=60112,I=60113,B=60120,V=60115,U=60116,F=60121,H=60122,G=60117,W=60129,X=60131;typeof Symbol=="function"&&Symbol.for&&(Z=Symbol.for,h=Z("react.element"),d=Z("react.portal"),g=Z("react.fragment"),_=Z("react.strict_mode"),b=Z("react.profiler"),S=Z("react.provider"),E=Z("react.context"),N=Z("react.forward_ref"),I=Z("react.suspense"),B=Z("react.suspense_list"),V=Z("react.memo"),U=Z("react.lazy"),F=Z("react.block"),H=Z("react.server.block"),G=Z("react.fundamental"),W=Z("react.debug_trace_mode"),X=Z("react.legacy_hidden"));var Z;function te(re){if(typeof re=="object"&&re!==null){var Ye=re.$$typeof;switch(Ye){case h:switch(re=re.type,re){case g:case b:case _:case I:case B:return re;default:switch(re=re&&re.$$typeof,re){case E:case N:case U:case V:case S:return re;default:return Ye}}case d:return Ye}}}var ae=S,oe=h,ue=N,Ee=g,Ie=U,_e=V,Oe=d,ot=b,de=_,Be=I;l.ContextConsumer=E,l.ContextProvider=ae,l.Element=oe,l.ForwardRef=ue,l.Fragment=Ee,l.Lazy=Ie,l.Memo=_e,l.Portal=Oe,l.Profiler=ot,l.StrictMode=de,l.Suspense=Be,l.isAsyncMode=function(){return!1},l.isConcurrentMode=function(){return!1},l.isContextConsumer=function(re){return te(re)===E},l.isContextProvider=function(re){return te(re)===S},l.isElement=function(re){return typeof re=="object"&&re!==null&&re.$$typeof===h},l.isForwardRef=function(re){return te(re)===N},l.isFragment=function(re){return te(re)===g},l.isLazy=function(re){return te(re)===U},l.isMemo=function(re){return te(re)===V},l.isPortal=function(re){return te(re)===d},l.isProfiler=function(re){return te(re)===b},l.isStrictMode=function(re){return te(re)===_},l.isSuspense=function(re){return te(re)===I},l.isValidElementType=function(re){return typeof re=="string"||typeof re=="function"||re===g||re===b||re===W||re===_||re===I||re===B||re===X||typeof re=="object"&&re!==null&&(re.$$typeof===U||re.$$typeof===V||re.$$typeof===S||re.$$typeof===E||re.$$typeof===N||re.$$typeof===G||re.$$typeof===F||re[0]===H)},l.typeOf=te}),m$=L((l,h)=>{h.exports=nN()}),zm=L((l,h)=>{h.exports=function(d,g,_,b){var S=_?_.call(b,d,g):void 0;if(S!==void 0)return!!S;if(d===g)return!0;if(typeof d!="object"||!d||typeof g!="object"||!g)return!1;var E=Object.keys(d),N=Object.keys(g);if(E.length!==N.length)return!1;for(var I=Object.prototype.hasOwnProperty.bind(g),B=0;B<E.length;B++){var V=E[B];if(!I(V))return!1;var U=d[V],F=g[V];if(S=_?_.call(b,U,F,V):void 0,S===!1||S===void 0&&U!==F)return!1}return!0}});function rN(l){function h(xe,ct,dt,gt,Je){for(var kn=0,Mt=0,En=0,Yn=0,gr,dr,ki=0,ie=0,_t,yt=_t=gr=0,Te=0,we=0,et=0,Dt=0,qt=dt.length,ut=qt-1,rn,Gt="",Xt="",or="",Mi="",Pr;Te<qt;){if(dr=dt.charCodeAt(Te),Te===ut&&Mt+Yn+En+kn!==0&&(Mt!==0&&(dr=Mt===47?10:47),Yn=En=kn=0,qt++,ut++),Mt+Yn+En+kn===0){if(Te===ut&&(0<we&&(Gt=Gt.replace(U,"")),0<Gt.trim().length)){switch(dr){case 32:case 9:case 59:case 13:case 10:break;default:Gt+=dt.charAt(Te)}dr=59}switch(dr){case 123:for(Gt=Gt.trim(),gr=Gt.charCodeAt(0),_t=1,Dt=++Te;Te<qt;){switch(dr=dt.charCodeAt(Te)){case 123:_t++;break;case 125:_t--;break;case 47:switch(dr=dt.charCodeAt(Te+1)){case 42:case 47:e:{for(yt=Te+1;yt<ut;++yt)switch(dt.charCodeAt(yt)){case 47:if(dr===42&&dt.charCodeAt(yt-1)===42&&Te+2!==yt){Te=yt+1;break e}break;case 10:if(dr===47){Te=yt+1;break e}}Te=yt}}break;case 91:dr++;case 40:dr++;case 34:case 39:for(;Te++<ut&&dt.charCodeAt(Te)!==dr;);}if(_t===0)break;Te++}switch(_t=dt.substring(Dt,Te),gr===0&&(gr=(Gt=Gt.replace(V,"").trim()).charCodeAt(0)),gr){case 64:switch(0<we&&(Gt=Gt.replace(U,"")),dr=Gt.charCodeAt(1),dr){case 100:case 109:case 115:case 45:we=ct;break;default:we=nn}if(_t=h(ct,we,_t,dr,Je+1),Dt=_t.length,0<Re&&(we=d(nn,Gt,et),Pr=E(3,_t,we,ct,Be,de,Dt,dr,Je,gt),Gt=we.join(""),Pr!==void 0&&(Dt=(_t=Pr.trim()).length)===0&&(dr=0,_t="")),0<Dt)switch(dr){case 115:Gt=Gt.replace(ue,S);case 100:case 109:case 45:_t=Gt+"{"+_t+"}";break;case 107:Gt=Gt.replace(Z,"$1 $2"),_t=Gt+"{"+_t+"}",_t=Ye===1||Ye===2&&b("@"+_t,3)?"@-webkit-"+_t+"@"+_t:"@"+_t;break;default:_t=Gt+_t,gt===112&&(_t=(Xt+=_t,""))}else _t="";break;default:_t=h(ct,d(ct,Gt,et),_t,gt,Je+1)}or+=_t,_t=et=we=yt=gr=0,Gt="",dr=dt.charCodeAt(++Te);break;case 125:case 59:if(Gt=(0<we?Gt.replace(U,""):Gt).trim(),1<(Dt=Gt.length))switch(yt===0&&(gr=Gt.charCodeAt(0),gr===45||96<gr&&123>gr)&&(Dt=(Gt=Gt.replace(" ",":")).length),0<Re&&(Pr=E(1,Gt,ct,xe,Be,de,Xt.length,gt,Je,gt))!==void 0&&(Dt=(Gt=Pr.trim()).length)===0&&(Gt="\0\0"),gr=Gt.charCodeAt(0),dr=Gt.charCodeAt(1),gr){case 0:break;case 64:if(dr===105||dr===99){Mi+=Gt+dt.charAt(Te);break}default:Gt.charCodeAt(Dt-1)!==58&&(Xt+=_(Gt,gr,dr,Gt.charCodeAt(2)))}et=we=yt=gr=0,Gt="",dr=dt.charCodeAt(++Te)}}switch(dr){case 13:case 10:Mt===47?Mt=0:1+gr===0&&gt!==107&&0<Gt.length&&(we=1,Gt+="\0"),0<Re*Pt&&E(0,Gt,ct,xe,Be,de,Xt.length,gt,Je,gt),de=1,Be++;break;case 59:case 125:if(Mt+Yn+En+kn===0){de++;break}default:switch(de++,rn=dt.charAt(Te),dr){case 9:case 32:if(Yn+kn+Mt===0)switch(ki){case 44:case 58:case 9:case 32:rn="";break;default:dr!==32&&(rn=" ")}break;case 0:rn="\\0";break;case 12:rn="\\f";break;case 11:rn="\\v";break;case 38:Yn+Mt+kn===0&&(we=et=1,rn="\f"+rn);break;case 108:if(Yn+Mt+kn+re===0&&0<yt)switch(Te-yt){case 2:ki===112&&dt.charCodeAt(Te-3)===58&&(re=ki);case 8:ie===111&&(re=ie)}break;case 58:Yn+Mt+kn===0&&(yt=Te);break;case 44:Mt+En+Yn+kn===0&&(we=1,rn+="\r");break;case 34:case 39:Mt===0&&(Yn=Yn===dr?0:Yn===0?dr:Yn);break;case 91:Yn+Mt+En===0&&kn++;break;case 93:Yn+Mt+En===0&&kn--;break;case 41:Yn+Mt+kn===0&&En--;break;case 40:if(Yn+Mt+kn===0){if(gr===0)switch(2*ki+3*ie){case 533:break;default:gr=1}En++}break;case 64:Mt+En+Yn+kn+yt+_t===0&&(_t=1);break;case 42:case 47:if(!(0<Yn+kn+En))switch(Mt){case 0:switch(2*dr+3*dt.charCodeAt(Te+1)){case 235:Mt=47;break;case 220:Dt=Te,Mt=42}break;case 42:dr===47&&ki===42&&Dt+2!==Te&&(dt.charCodeAt(Dt+2)===33&&(Xt+=dt.substring(Dt,Te+1)),rn="",Mt=0)}}Mt===0&&(Gt+=rn)}ie=ki,ki=dr,Te++}if(Dt=Xt.length,0<Dt){if(we=ct,0<Re&&(Pr=E(2,Xt,we,xe,Be,de,Dt,gt,Je,gt),Pr!==void 0&&(Xt=Pr).length===0))return Mi+Xt+or;if(Xt=we.join(",")+"{"+Xt+"}",Ye*re!==0){switch(Ye!==2||b(Xt,2)||(re=0),re){case 111:Xt=Xt.replace(ae,":-moz-$1")+Xt;break;case 112:Xt=Xt.replace(te,"::-webkit-input-$1")+Xt.replace(te,"::-moz-$1")+Xt.replace(te,":-ms-input-$1")+Xt}re=0}}return Mi+Xt+or}function d(xe,ct,dt){var gt=ct.trim().split(W);ct=gt;var Je=gt.length,kn=xe.length;switch(kn){case 0:case 1:var Mt=0;for(xe=kn===0?"":xe[0]+" ";Mt<Je;++Mt)ct[Mt]=g(xe,ct[Mt],dt).trim();break;default:var En=Mt=0;for(ct=[];Mt<Je;++Mt)for(var Yn=0;Yn<kn;++Yn)ct[En++]=g(xe[Yn]+" ",gt[Mt],dt).trim()}return ct}function g(xe,ct,dt){var gt=ct.charCodeAt(0);switch(33>gt&&(gt=(ct=ct.trim()).charCodeAt(0)),gt){case 38:return ct.replace(X,"$1"+xe.trim());case 58:return xe.trim()+ct.replace(X,"$1"+xe.trim());default:if(0<1*dt&&0<ct.indexOf("\f"))return ct.replace(X,(xe.charCodeAt(0)===58?"":"$1")+xe.trim())}return xe+ct}function _(xe,ct,dt,gt){var Je=xe+";",kn=2*ct+3*dt+4*gt;if(kn===944){xe=Je.indexOf(":",9)+1;var Mt=Je.substring(xe,Je.length-1).trim();return Mt=Je.substring(0,xe).trim()+Mt+";",Ye===1||Ye===2&&b(Mt,1)?"-webkit-"+Mt+Mt:Mt}if(Ye===0||Ye===2&&!b(Je,1))return Je;switch(kn){case 1015:return Je.charCodeAt(10)===97?"-webkit-"+Je+Je:Je;case 951:return Je.charCodeAt(3)===116?"-webkit-"+Je+Je:Je;case 963:return Je.charCodeAt(5)===110?"-webkit-"+Je+Je:Je;case 1009:if(Je.charCodeAt(4)!==100)break;case 969:case 942:return"-webkit-"+Je+Je;case 978:return"-webkit-"+Je+"-moz-"+Je+Je;case 1019:case 983:return"-webkit-"+Je+"-moz-"+Je+"-ms-"+Je+Je;case 883:if(Je.charCodeAt(8)===45)return"-webkit-"+Je+Je;if(0<Je.indexOf("image-set(",11))return Je.replace(ot,"$1-webkit-$2")+Je;break;case 932:if(Je.charCodeAt(4)===45)switch(Je.charCodeAt(5)){case 103:return"-webkit-box-"+Je.replace("-grow","")+"-webkit-"+Je+"-ms-"+Je.replace("grow","positive")+Je;case 115:return"-webkit-"+Je+"-ms-"+Je.replace("shrink","negative")+Je;case 98:return"-webkit-"+Je+"-ms-"+Je.replace("basis","preferred-size")+Je}return"-webkit-"+Je+"-ms-"+Je+Je;case 964:return"-webkit-"+Je+"-ms-flex-"+Je+Je;case 1023:if(Je.charCodeAt(8)!==99)break;return Mt=Je.substring(Je.indexOf(":",15)).replace("flex-","").replace("space-between","justify"),"-webkit-box-pack"+Mt+"-webkit-"+Je+"-ms-flex-pack"+Mt+Je;case 1005:return H.test(Je)?Je.replace(F,":-webkit-")+Je.replace(F,":-moz-")+Je:Je;case 1e3:switch(Mt=Je.substring(13).trim(),ct=Mt.indexOf("-")+1,Mt.charCodeAt(0)+Mt.charCodeAt(ct)){case 226:Mt=Je.replace(oe,"tb");break;case 232:Mt=Je.replace(oe,"tb-rl");break;case 220:Mt=Je.replace(oe,"lr");break;default:return Je}return"-webkit-"+Je+"-ms-"+Mt+Je;case 1017:if(Je.indexOf("sticky",9)===-1)break;case 975:switch(ct=(Je=xe).length-10,Mt=(Je.charCodeAt(ct)===33?Je.substring(0,ct):Je).substring(xe.indexOf(":",7)+1).trim(),kn=Mt.charCodeAt(0)+(Mt.charCodeAt(7)|0)){case 203:if(111>Mt.charCodeAt(8))break;case 115:Je=Je.replace(Mt,"-webkit-"+Mt)+";"+Je;break;case 207:case 102:Je=Je.replace(Mt,"-webkit-"+(102<kn?"inline-":"")+"box")+";"+Je.replace(Mt,"-webkit-"+Mt)+";"+Je.replace(Mt,"-ms-"+Mt+"box")+";"+Je}return Je+";";case 938:if(Je.charCodeAt(5)===45)switch(Je.charCodeAt(6)){case 105:return Mt=Je.replace("-items",""),"-webkit-"+Je+"-webkit-box-"+Mt+"-ms-flex-"+Mt+Je;case 115:return"-webkit-"+Je+"-ms-flex-item-"+Je.replace(Ie,"")+Je;default:return"-webkit-"+Je+"-ms-flex-line-pack"+Je.replace("align-content","").replace(Ie,"")+Je}break;case 973:case 989:if(Je.charCodeAt(3)!==45||Je.charCodeAt(4)===122)break;case 931:case 953:if(Oe.test(xe)===!0)return(Mt=xe.substring(xe.indexOf(":")+1)).charCodeAt(0)===115?_(xe.replace("stretch","fill-available"),ct,dt,gt).replace(":fill-available",":stretch"):Je.replace(Mt,"-webkit-"+Mt)+Je.replace(Mt,"-moz-"+Mt.replace("fill-",""))+Je;break;case 962:if(Je="-webkit-"+Je+(Je.charCodeAt(5)===102?"-ms-"+Je:"")+Je,dt+gt===211&&Je.charCodeAt(13)===105&&0<Je.indexOf("transform",10))return Je.substring(0,Je.indexOf(";",27)+1).replace(G,"$1-webkit-$2")+Je}return Je}function b(xe,ct){var dt=xe.indexOf(ct===1?":":"{"),gt=xe.substring(0,ct!==3?dt:10);return dt=xe.substring(dt+1,xe.length-1),Ze(ct!==2?gt:gt.replace(_e,"$1"),dt,ct)}function S(xe,ct){var dt=_(ct,ct.charCodeAt(0),ct.charCodeAt(1),ct.charCodeAt(2));return dt!==ct+";"?dt.replace(Ee," or ($1)").substring(4):"("+ct+")"}function E(xe,ct,dt,gt,Je,kn,Mt,En,Yn,gr){for(var dr=0,ki=ct,ie;dr<Re;++dr)switch(ie=ke[dr].call(B,xe,ki,dt,gt,Je,kn,Mt,En,Yn,gr)){case void 0:case!1:case!0:case null:break;default:ki=ie}if(ki!==ct)return ki}function N(xe){switch(xe){case void 0:case null:Re=ke.length=0;break;default:if(typeof xe=="function")ke[Re++]=xe;else if(typeof xe=="object")for(var ct=0,dt=xe.length;ct<dt;++ct)N(xe[ct]);else Pt=!!xe|0}return N}function I(xe){return xe=xe.prefix,xe!==void 0&&(Ze=null,xe?typeof xe!="function"?Ye=1:(Ye=2,Ze=xe):Ye=0),I}function B(xe,ct){var dt=xe;if(33>dt.charCodeAt(0)&&(dt=dt.trim()),pe=dt,dt=[pe],0<Re){var gt=E(-1,ct,dt,dt,Be,de,0,0,0,0);gt!==void 0&&typeof gt=="string"&&(ct=gt)}var Je=h(nn,dt,ct,0,0);return 0<Re&&(gt=E(-2,Je,dt,dt,Be,de,Je.length,0,0,0),gt!==void 0&&(Je=gt)),pe="",re=0,de=Be=1,Je}var V=/^\0+/g,U=/[\0\r\f]/g,F=/: */g,H=/zoo|gra/,G=/([,: ])(transform)/g,W=/,\r+?/g,X=/([\t\r\n ])*\f?&/g,Z=/@(k\w+)\s*(\S*)\s*/,te=/::(place)/g,ae=/:(read-only)/g,oe=/[svh]\w+-[tblr]{2}/,ue=/\(\s*(.*)\s*\)/g,Ee=/([\s\S]*?);/g,Ie=/-self|flex-/g,_e=/[^]*?(:[rp][el]a[\w-]+)[^]*/,Oe=/stretch|:\s*\w+\-(?:conte|avail)/,ot=/([^-])(image-set\()/,de=1,Be=1,re=0,Ye=1,nn=[],ke=[],Re=0,Ze=null,Pt=0,pe="";return B.use=N,B.set=I,l!==void 0&&I(l),B}var iN,g$=C(()=>{iN=rN}),sN,oN,Y5=C(()=>{sN={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},oN=sN});function y$(l){var h=Object.create(null);return function(d){return h[d]===void 0&&(h[d]=l(d)),h[d]}}var Vm,v$=C(()=>{Vm=y$}),aN,lN,Sb,wb=C(()=>{v$(),aN=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,lN=Vm(function(l){return aN.test(l)||l.charCodeAt(0)===111&&l.charCodeAt(1)===110&&l.charCodeAt(2)<91}),Sb=lN}),cN=L(l=>{var h=typeof Symbol=="function"&&Symbol.for,d=h?Symbol.for("react.element"):60103,g=h?Symbol.for("react.portal"):60106,_=h?Symbol.for("react.fragment"):60107,b=h?Symbol.for("react.strict_mode"):60108,S=h?Symbol.for("react.profiler"):60114,E=h?Symbol.for("react.provider"):60109,N=h?Symbol.for("react.context"):60110,I=h?Symbol.for("react.async_mode"):60111,B=h?Symbol.for("react.concurrent_mode"):60111,V=h?Symbol.for("react.forward_ref"):60112,U=h?Symbol.for("react.suspense"):60113,F=h?Symbol.for("react.suspense_list"):60120,H=h?Symbol.for("react.memo"):60115,G=h?Symbol.for("react.lazy"):60116,W=h?Symbol.for("react.block"):60121,X=h?Symbol.for("react.fundamental"):60117,Z=h?Symbol.for("react.responder"):60118,te=h?Symbol.for("react.scope"):60119;function ae(ue){if(typeof ue=="object"&&ue!==null){var Ee=ue.$$typeof;switch(Ee){case d:switch(ue=ue.type,ue){case I:case B:case _:case S:case b:case U:return ue;default:switch(ue=ue&&ue.$$typeof,ue){case N:case V:case G:case H:case E:return ue;default:return Ee}}case g:return Ee}}}function oe(ue){return ae(ue)===B}l.AsyncMode=I,l.ConcurrentMode=B,l.ContextConsumer=N,l.ContextProvider=E,l.Element=d,l.ForwardRef=V,l.Fragment=_,l.Lazy=G,l.Memo=H,l.Portal=g,l.Profiler=S,l.StrictMode=b,l.Suspense=U,l.isAsyncMode=function(ue){return oe(ue)||ae(ue)===I},l.isConcurrentMode=oe,l.isContextConsumer=function(ue){return ae(ue)===N},l.isContextProvider=function(ue){return ae(ue)===E},l.isElement=function(ue){return typeof ue=="object"&&ue!==null&&ue.$$typeof===d},l.isForwardRef=function(ue){return ae(ue)===V},l.isFragment=function(ue){return ae(ue)===_},l.isLazy=function(ue){return ae(ue)===G},l.isMemo=function(ue){return ae(ue)===H},l.isPortal=function(ue){return ae(ue)===g},l.isProfiler=function(ue){return ae(ue)===S},l.isStrictMode=function(ue){return ae(ue)===b},l.isSuspense=function(ue){return ae(ue)===U},l.isValidElementType=function(ue){return typeof ue=="string"||typeof ue=="function"||ue===_||ue===B||ue===S||ue===b||ue===U||ue===F||typeof ue=="object"&&ue!==null&&(ue.$$typeof===G||ue.$$typeof===H||ue.$$typeof===E||ue.$$typeof===N||ue.$$typeof===V||ue.$$typeof===X||ue.$$typeof===Z||ue.$$typeof===te||ue.$$typeof===W)},l.typeOf=ae}),_$=L((l,h)=>{h.exports=cN()}),x$=L((l,h)=>{var d=_$(),g={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},_={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},b={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},S={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},E={};E[d.ForwardRef]=b,E[d.Memo]=S;function N(W){return d.isMemo(W)?S:E[W.$$typeof]||g}var I=Object.defineProperty,B=Object.getOwnPropertyNames,V=Object.getOwnPropertySymbols,U=Object.getOwnPropertyDescriptor,F=Object.getPrototypeOf,H=Object.prototype;function G(W,X,Z){if(typeof X!="string"){if(H){var te=F(X);te&&te!==H&&G(W,te,Z)}var ae=B(X);V&&(ae=ae.concat(V(X)));for(var oe=N(W),ue=N(X),Ee=0;Ee<ae.length;++Ee){var Ie=ae[Ee];if(!_[Ie]&&!(Z&&Z[Ie])&&!(ue&&ue[Ie])&&!(oe&&oe[Ie])){var _e=U(X,Ie);try{I(W,Ie,_e)}catch{}}}}return W}h.exports=G});function js(){return(js=Object.assign||function(l){for(var h=1;h<arguments.length;h++){var d=arguments[h];for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&(l[g]=d[g])}return l}).apply(this,arguments)}function Sc(l){return typeof l=="function"}function Gd(l){return l.displayName||l.name||"Component"}function Tb(l){return l&&typeof l.styledComponentId=="string"}function s0(l){for(var h=arguments.length,d=new Array(h>1?h-1:0),g=1;g<h;g++)d[g-1]=arguments[g];throw new Error("An error occurred. See https://git.io/JUIaE#"+l+" for more information."+(d.length>0?" Args: "+d.join(", "):""))}function $d(l){var h,d="";for(h=Math.abs(l);h>52;h=h/52|0)d=Ib(h%52)+d;return(Ib(h%52)+d).replace(wl,"$1-$2")}function K5(l){for(var h=0;h<l.length;h+=1){var d=l[h];if(Sc(d)&&!Tb(d))return!1}return!0}function uN(l){var h,d,g,_,b=l===void 0?H0:l,S=b.options,E=S===void 0?H0:S,N=b.plugins,I=N===void 0?$m:N,B=new iN(E),V=[],U=function(G){function W(X){if(X)try{G(X+"}")}catch{}}return function(X,Z,te,ae,oe,ue,Ee,Ie,_e,Oe){switch(X){case 1:if(_e===0&&Z.charCodeAt(0)===64)return G(Z+";"),"";break;case 2:if(Ie===0)return Z+"/*|*/";break;case 3:switch(Ie){case 102:case 112:return G(te[0]+Z),"";default:return Z+(Oe===0?"/*|*/":"")}case-2:Z.split("/*|*/}").forEach(W)}}}(function(G){V.push(G)}),F=function(G,W,X){return W===0&&vN.indexOf(X[d.length])!==-1||X.match(_)?G:"."+h};function H(G,W,X,Z){Z===void 0&&(Z="&");var te=G.replace(yN,""),ae=W&&X?X+" "+W+" { "+te+" }":te;return h=Z,d=W,g=new RegExp("\\"+d+"\\b","g"),_=new RegExp("(\\"+d+"\\b){2,}"),B(X||!W?"":W,ae)}return B.use([].concat(I,[function(G,W,X){G===2&&X.length&&X[0].lastIndexOf(d)>0&&(X[0]=X[0].replace(g,F))},U,function(G){if(G===-2){var W=V;return V=[],W}}])),H.hash=I.length?I.reduce(function(G,W){return W.name||s0(15),yh(G,W.name)},5381).toString():"",H}function Z5(){return(0,ks.useContext)(Z3)||Ob}function hN(){return(0,ks.useContext)(qm)||av}function Q5(l){var h=(0,ks.useState)(l.stylisPlugins),d=h[0],g=h[1],_=Z5(),b=(0,ks.useMemo)(function(){var E=_;return l.sheet?E=l.sheet:l.target&&(E=E.reconstructWithOptions({target:l.target},!1)),l.disableCSSOMInjection&&(E=E.reconstructWithOptions({useCSSOMInjection:!1})),E},[l.disableCSSOMInjection,l.sheet,l.target]),S=(0,ks.useMemo)(function(){return uN({options:{prefix:!l.disableVendorPrefixes},plugins:d})},[l.disableVendorPrefixes,d]);return(0,ks.useEffect)(function(){(0,Cb.default)(d,l.stylisPlugins)||g(l.stylisPlugins)},[l.stylisPlugins]),ks.default.createElement(Z3.Provider,{value:b},ks.default.createElement(qm.Provider,{value:S},l.children))}function J5(l){return lv.test(l)?l.replace(Bb,bN).replace(xN,"-ms-"):l}function o0(l,h,d,g){if(Array.isArray(l)){for(var _,b=[],S=0,E=l.length;S<E;S+=1)(_=o0(l[S],h,d,g))!==""&&(Array.isArray(_)?b.push.apply(b,_):b.push(_));return b}if(w(l))return"";if(Tb(l))return"."+l.styledComponentId;if(Sc(l)){if(typeof(I=l)!="function"||I.prototype&&I.prototype.isReactComponent||!h)return l;var N=l(h);return o0(N,h,d,g)}var I;return l instanceof _N?d?(l.inject(d,g),l.getName(g)):l:wp(l)?function B(V,U){var F,H,G=[];for(var W in V)V.hasOwnProperty(W)&&!w(V[W])&&(Array.isArray(V[W])&&V[W].isCss||Sc(V[W])?G.push(J5(W)+":",V[W],";"):wp(V[W])?G.push.apply(G,B(V[W],W)):G.push(J5(W)+": "+(F=W,(H=V[W])==null||typeof H=="boolean"||H===""?"":typeof H!="number"||H===0||F in oN||F.startsWith("--")?String(H).trim():H+"px")+";"));return U?[U+" {"].concat(G,["}"]):G}(l):l.toString()}function Qa(l){for(var h=arguments.length,d=new Array(h>1?h-1:0),g=1;g<h;g++)d[g-1]=arguments[g];return Sc(l)||wp(l)?k(o0(q3($m,[l].concat(d)))):d.length===0&&l.length===1&&typeof l[0]=="string"?l:k(o0(q3(l,d)))}function W3(l){return l.replace(ee,"-").replace(le,"")}function ev(l){return typeof l=="string"&&!0}function Eb(l,h,d){var g=l[d];De(h)&&De(g)?vu(g,h):l[d]=h}function vu(l){for(var h=arguments.length,d=new Array(h>1?h-1:0),g=1;g<h;g++)d[g-1]=arguments[g];for(var _=0,b=d;_<b.length;_++){var S=b[_];if(De(S))for(var E in S)nt(E)&&Eb(l,S[E],E)}return l}function Mb(l,h,d){var g=Tb(l),_=!ev(l),b=h.attrs,S=b===void 0?$m:b,E=h.componentId,N=E===void 0?function(Z,te){var ae=typeof Z!="string"?"sc":W3(Z);Et[ae]=(Et[ae]||0)+1;var oe=ae+"-"+ve("5.3.11"+ae+Et[ae]);return te?te+"-"+oe:oe}(h.displayName,h.parentComponentId):E,I=h.displayName,B=I===void 0?function(Z){return ev(Z)?"styled."+Z:"Styled("+Gd(Z)+")"}(l):I,V=h.displayName&&h.componentId?W3(h.displayName)+"-"+h.componentId:h.componentId||N,U=g&&l.attrs?Array.prototype.concat(l.attrs,S).filter(Boolean):S,F=h.shouldForwardProp;g&&l.shouldForwardProp&&(F=h.shouldForwardProp?function(Z,te,ae){return l.shouldForwardProp(Z,te,ae)&&h.shouldForwardProp(Z,te,ae)}:l.shouldForwardProp);var H,G=new Fb(d,V,g?l.componentStyle:void 0),W=G.isStatic&&S.length===0,X=function(Z,te){return function(ae,oe,ue,Ee){var Ie=ae.attrs,_e=ae.componentStyle,Oe=ae.defaultProps,ot=ae.foldedComponentIds,de=ae.shouldForwardProp,Be=ae.styledComponentId,re=ae.target,Ye=function(gt,Je,kn){gt===void 0&&(gt=H0);var Mt=js({},Je,{theme:gt}),En={};return kn.forEach(function(Yn){var gr,dr,ki,ie=Yn;for(gr in Sc(ie)&&(ie=ie(Mt)),ie)Mt[gr]=En[gr]=gr==="className"?(dr=En[gr],ki=ie[gr],dr&&ki?dr+" "+ki:dr||ki):ie[gr]}),[Mt,En]}(j(oe,(0,ks.useContext)(lt),Oe)||H0,oe,Ie),nn=Ye[0],ke=Ye[1],Re=function(gt,Je,kn,Mt){var En=Z5(),Yn=hN(),gr=Je?gt.generateAndInjectStyles(H0,En,Yn):gt.generateAndInjectStyles(kn,En,Yn);return gr}(_e,Ee,nn),Ze=ue,Pt=ke.$as||oe.$as||ke.as||oe.as||re,pe=ev(Pt),xe=ke!==oe?js({},oe,{},ke):oe,ct={};for(var dt in xe)dt[0]!=="$"&&dt!=="as"&&(dt==="forwardedAs"?ct.as=xe[dt]:(de?de(dt,Sb,Pt):!pe||Sb(dt))&&(ct[dt]=xe[dt]));return oe.style&&ke.style!==oe.style&&(ct.style=js({},oe.style,{},ke.style)),ct.className=Array.prototype.concat(ot,Be,Re!==Be?Re:null,oe.className,ke.className).filter(Boolean).join(" "),ct.ref=Ze,(0,ks.createElement)(Pt,ct)}(H,Z,te,W)};return X.displayName=B,(H=ks.default.forwardRef(X)).attrs=U,H.componentStyle=G,H.displayName=B,H.shouldForwardProp=F,H.foldedComponentIds=g?Array.prototype.concat(l.foldedComponentIds,l.styledComponentId):$m,H.styledComponentId=V,H.target=g?l.target:l,H.withComponent=function(Z){var te=h.componentId,ae=function(ue,Ee){if(ue==null)return{};var Ie,_e,Oe={},ot=Object.keys(ue);for(_e=0;_e<ot.length;_e++)Ie=ot[_e],Ee.indexOf(Ie)>=0||(Oe[Ie]=ue[Ie]);return Oe}(h,["componentId"]),oe=te&&te+"-"+(ev(Z)?Z:W3(Gd(Z)));return Mb(Z,js({},ae,{attrs:U,componentId:oe}),d)},Object.defineProperty(H,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(Z){this._foldedDefaultProps=g?vu({},l.defaultProps,Z):Z}}),Object.defineProperty(H,"toString",{value:function(){return"."+H.styledComponentId}}),_&&(0,dN.default)(H,l,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0,withComponent:!0}),H}function tv(l){for(var h=arguments.length,d=new Array(h>1?h-1:0),g=1;g<h;g++)d[g-1]=arguments[g];var _=Qa.apply(void 0,[l].concat(d)),b="sc-global-"+ve(JSON.stringify(_)),S=new hn(_,b);function E(I){var B=Z5(),V=hN(),U=(0,ks.useContext)(lt),F=(0,ks.useRef)(B.allocateGSInstance(b)).current;return B.server&&N(F,I,B,U,V),(0,ks.useLayoutEffect)(function(){if(!B.server)return N(F,I,B,U,V),function(){return S.removeStyles(F,B)}},[F,I,B,U,V]),null}function N(I,B,V,U,F){if(S.isStatic)S.renderStyles(I,rv,V,F);else{var H=js({},B,{theme:j(B,U,E.defaultProps)});S.renderStyles(I,H,V,F)}}return ks.default.memo(E)}var Gm,ks,Cb,dN,q3,wp,$m,H0,wc,X3,nv,rv,iv,Y3,Hm,Tp,gh,sv,fN,pN,Ab,Rb,Pb,ga,Nb,ov,mN,gN,jm,K3,Wm,wl,Ib,yh,kb,Db,Fb,yN,vN,Z3,qm,Ob,av,_N,lv,Bb,xN,bN,w,k,j,ee,le,ve,De,nt,lt,Et,on,hn,me,at=C(()=>{Gm=z(m$()),ks=z(Le()),Cb=z(zm()),g$(),Y5(),wb(),dN=z(x$()),q3=function(l,h){for(var d=[l[0]],g=0,_=h.length;g<_;g+=1)d.push(h[g],l[g+1]);return d},wp=function(l){return l!==null&&typeof l=="object"&&(l.toString?l.toString():Object.prototype.toString.call(l))==="[object Object]"&&!(0,Gm.typeOf)(l)},$m=Object.freeze([]),H0=Object.freeze({}),wc=typeof process<"u"&&process.env!==void 0&&({}.REACT_APP_SC_ATTR||{}.SC_ATTR)||"data-styled",X3=typeof window<"u"&&"HTMLElement"in window,nv=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&process.env!==void 0&&({}.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&{}.REACT_APP_SC_DISABLE_SPEEDY!==""?{}.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&{}.REACT_APP_SC_DISABLE_SPEEDY:{}.SC_DISABLE_SPEEDY!==void 0&&{}.SC_DISABLE_SPEEDY!==""&&{}.SC_DISABLE_SPEEDY!=="false"&&{}.SC_DISABLE_SPEEDY)),rv={},iv=function(){function l(d){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=d}var h=l.prototype;return h.indexOfGroup=function(d){for(var g=0,_=0;_<d;_++)g+=this.groupSizes[_];return g},h.insertRules=function(d,g){if(d>=this.groupSizes.length){for(var _=this.groupSizes,b=_.length,S=b;d>=S;)(S<<=1)<0&&s0(16,""+d);this.groupSizes=new Uint32Array(S),this.groupSizes.set(_),this.length=S;for(var E=b;E<S;E++)this.groupSizes[E]=0}for(var N=this.indexOfGroup(d+1),I=0,B=g.length;I<B;I++)this.tag.insertRule(N,g[I])&&(this.groupSizes[d]++,N++)},h.clearGroup=function(d){if(d<this.length){var g=this.groupSizes[d],_=this.indexOfGroup(d),b=_+g;this.groupSizes[d]=0;for(var S=_;S<b;S++)this.tag.deleteRule(_)}},h.getGroup=function(d){var g="";if(d>=this.length||this.groupSizes[d]===0)return g;for(var _=this.groupSizes[d],b=this.indexOfGroup(d),S=b+_,E=b;E<S;E++)g+=this.tag.getRule(E)+`/*!sc*/
`;return g},l}(),Y3=new Map,Hm=new Map,Tp=1,gh=function(l){if(Y3.has(l))return Y3.get(l);for(;Hm.has(Tp);)Tp++;var h=Tp++;return Y3.set(l,h),Hm.set(h,l),h},sv=function(l){return Hm.get(l)},fN=function(l,h){h>=Tp&&(Tp=h+1),Y3.set(l,h),Hm.set(h,l)},pN="style["+wc+'][data-styled-version="5.3.11"]',Ab=new RegExp("^"+wc+'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)'),Rb=function(l,h,d){for(var g,_=d.split(","),b=0,S=_.length;b<S;b++)(g=_[b])&&l.registerName(h,g)},Pb=function(l,h){for(var d=(h.textContent||"").split(`/*!sc*/
`),g=[],_=0,b=d.length;_<b;_++){var S=d[_].trim();if(S){var E=S.match(Ab);if(E){var N=0|parseInt(E[1],10),I=E[2];N!==0&&(fN(I,N),Rb(l,I,E[3]),l.getTag().insertRules(N,g)),g.length=0}else g.push(S)}}},ga=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null},Nb=function(l){var h=document.head,d=l||h,g=document.createElement("style"),_=function(E){for(var N=E.childNodes,I=N.length;I>=0;I--){var B=N[I];if(B&&B.nodeType===1&&B.hasAttribute(wc))return B}}(d),b=_!==void 0?_.nextSibling:null;g.setAttribute(wc,"active"),g.setAttribute("data-styled-version","5.3.11");var S=ga();return S&&g.setAttribute("nonce",S),d.insertBefore(g,b),g},ov=function(){function l(d){var g=this.element=Nb(d);g.appendChild(document.createTextNode("")),this.sheet=function(_){if(_.sheet)return _.sheet;for(var b=document.styleSheets,S=0,E=b.length;S<E;S++){var N=b[S];if(N.ownerNode===_)return N}s0(17)}(g),this.length=0}var h=l.prototype;return h.insertRule=function(d,g){try{return this.sheet.insertRule(g,d),this.length++,!0}catch{return!1}},h.deleteRule=function(d){this.sheet.deleteRule(d),this.length--},h.getRule=function(d){var g=this.sheet.cssRules[d];return g!==void 0&&typeof g.cssText=="string"?g.cssText:""},l}(),mN=function(){function l(d){var g=this.element=Nb(d);this.nodes=g.childNodes,this.length=0}var h=l.prototype;return h.insertRule=function(d,g){if(d<=this.length&&d>=0){var _=document.createTextNode(g),b=this.nodes[d];return this.element.insertBefore(_,b||null),this.length++,!0}return!1},h.deleteRule=function(d){this.element.removeChild(this.nodes[d]),this.length--},h.getRule=function(d){return d<this.length?this.nodes[d].textContent:""},l}(),gN=function(){function l(d){this.rules=[],this.length=0}var h=l.prototype;return h.insertRule=function(d,g){return d<=this.length&&(this.rules.splice(d,0,g),this.length++,!0)},h.deleteRule=function(d){this.rules.splice(d,1),this.length--},h.getRule=function(d){return d<this.length?this.rules[d]:""},l}(),jm=X3,K3={isServer:!X3,useCSSOMInjection:!nv},Wm=function(){function l(d,g,_){d===void 0&&(d=H0),g===void 0&&(g={}),this.options=js({},K3,{},d),this.gs=g,this.names=new Map(_),this.server=!!d.isServer,!this.server&&X3&&jm&&(jm=!1,function(b){for(var S=document.querySelectorAll(pN),E=0,N=S.length;E<N;E++){var I=S[E];I&&I.getAttribute(wc)!=="active"&&(Pb(b,I),I.parentNode&&I.parentNode.removeChild(I))}}(this))}l.registerId=function(d){return gh(d)};var h=l.prototype;return h.reconstructWithOptions=function(d,g){return g===void 0&&(g=!0),new l(js({},this.options,{},d),this.gs,g&&this.names||void 0)},h.allocateGSInstance=function(d){return this.gs[d]=(this.gs[d]||0)+1},h.getTag=function(){return this.tag||(this.tag=(_=(g=this.options).isServer,b=g.useCSSOMInjection,S=g.target,d=_?new gN(S):b?new ov(S):new mN(S),new iv(d)));var d,g,_,b,S},h.hasNameForId=function(d,g){return this.names.has(d)&&this.names.get(d).has(g)},h.registerName=function(d,g){if(gh(d),this.names.has(d))this.names.get(d).add(g);else{var _=new Set;_.add(g),this.names.set(d,_)}},h.insertRules=function(d,g,_){this.registerName(d,g),this.getTag().insertRules(gh(d),_)},h.clearNames=function(d){this.names.has(d)&&this.names.get(d).clear()},h.clearRules=function(d){this.getTag().clearGroup(gh(d)),this.clearNames(d)},h.clearTag=function(){this.tag=void 0},h.toString=function(){return function(d){for(var g=d.getTag(),_=g.length,b="",S=0;S<_;S++){var E=sv(S);if(E!==void 0){var N=d.names.get(E),I=g.getGroup(S);if(N&&I&&N.size){var B=wc+".g"+S+'[id="'+E+'"]',V="";N!==void 0&&N.forEach(function(U){U.length>0&&(V+=U+",")}),b+=""+I+B+'{content:"'+V+`"}/*!sc*/
`}}}return b}(this)},l}(),wl=/(a)(d)/gi,Ib=function(l){return String.fromCharCode(l+(l>25?39:97))},yh=function(l,h){for(var d=h.length;d;)l=33*l^h.charCodeAt(--d);return l},kb=function(l){return yh(5381,l)},Db=kb("5.3.11"),Fb=function(){function l(h,d,g){this.rules=h,this.staticRulesId="",this.isStatic=(g===void 0||g.isStatic)&&K5(h),this.componentId=d,this.baseHash=yh(Db,d),this.baseStyle=g,Wm.registerId(d)}return l.prototype.generateAndInjectStyles=function(h,d,g){var _=this.componentId,b=[];if(this.baseStyle&&b.push(this.baseStyle.generateAndInjectStyles(h,d,g)),this.isStatic&&!g.hash)if(this.staticRulesId&&d.hasNameForId(_,this.staticRulesId))b.push(this.staticRulesId);else{var S=o0(this.rules,h,d,g).join(""),E=$d(yh(this.baseHash,S)>>>0);if(!d.hasNameForId(_,E)){var N=g(S,"."+E,void 0,_);d.insertRules(_,E,N)}b.push(E),this.staticRulesId=E}else{for(var I=this.rules.length,B=yh(this.baseHash,g.hash),V="",U=0;U<I;U++){var F=this.rules[U];if(typeof F=="string")V+=F;else if(F){var H=o0(F,h,d,g),G=Array.isArray(H)?H.join(""):H;B=yh(B,G+U),V+=G}}if(V){var W=$d(B>>>0);if(!d.hasNameForId(_,W)){var X=g(V,"."+W,void 0,_);d.insertRules(_,W,X)}b.push(W)}}return b.join(" ")},l}(),yN=/^\s*\/\/.*$/gm,vN=[":","[",".","#"],Z3=ks.default.createContext(),Z3.Consumer,qm=ks.default.createContext(),Ob=(qm.Consumer,new Wm),av=uN(),_N=function(){function l(h,d){var g=this;this.inject=function(_,b){b===void 0&&(b=av);var S=g.name+b.hash;_.hasNameForId(g.id,S)||_.insertRules(g.id,S,b(g.rules,S,"@keyframes"))},this.toString=function(){return s0(12,String(g.name))},this.name=h,this.id="sc-keyframes-"+h,this.rules=d}return l.prototype.getName=function(h){return h===void 0&&(h=av),this.name+h.hash},l}(),lv=/([A-Z])/,Bb=/([A-Z])/g,xN=/^ms-/,bN=function(l){return"-"+l.toLowerCase()},w=function(l){return l==null||l===!1||l===""},k=function(l){return Array.isArray(l)&&(l.isCss=!0),l},j=function(l,h,d){return d===void 0&&(d=H0),l.theme!==d.theme&&l.theme||h||d.theme},ee=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,le=/(^-|-$)/g,ve=function(l){return $d(kb(l)>>>0)},De=function(l){return typeof l=="function"||typeof l=="object"&&l!==null&&!Array.isArray(l)},nt=function(l){return l!=="__proto__"&&l!=="constructor"&&l!=="prototype"},lt=ks.default.createContext(),lt.Consumer,Et={},on=function(l){return function h(d,g,_){if(_===void 0&&(_=H0),!(0,Gm.isValidElementType)(g))return s0(1,String(g));var b=function(){return d(g,_,Qa.apply(void 0,arguments))};return b.withConfig=function(S){return h(d,g,js({},_,{},S))},b.attrs=function(S){return h(d,g,js({},_,{attrs:Array.prototype.concat(_.attrs,S).filter(Boolean)}))},b}(Mb,l)},["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","textPath","tspan"].forEach(function(l){on[l]=on(l)}),hn=function(){function l(d,g){this.rules=d,this.componentId=g,this.isStatic=K5(d),Wm.registerId(this.componentId+1)}var h=l.prototype;return h.createStyles=function(d,g,_,b){var S=b(o0(this.rules,g,_,b).join(""),""),E=this.componentId+d;_.insertRules(E,E,S)},h.removeStyles=function(d,g){g.clearRules(this.componentId+d)},h.renderStyles=function(d,g,_,b){d>2&&Wm.registerId(this.componentId+d),this.removeStyles(d,_),this.createStyles(d,g,_,b)},l}(),function(){function l(){var d=this;this._emitSheetCSS=function(){var g=d.instance.toString();if(!g)return"";var _=ga();return"<style "+[_&&'nonce="'+_+'"',wc+'="true"','data-styled-version="5.3.11"'].filter(Boolean).join(" ")+">"+g+"</style>"},this.getStyleTags=function(){return d.sealed?s0(2):d._emitSheetCSS()},this.getStyleElement=function(){var g;if(d.sealed)return s0(2);var _=((g={})[wc]="",g["data-styled-version"]="5.3.11",g.dangerouslySetInnerHTML={__html:d.instance.toString()},g),b=ga();return b&&(_.nonce=b),[ks.default.createElement("style",js({},_,{key:"sc-0-0"}))]},this.seal=function(){d.sealed=!0},this.instance=new Wm({isServer:!0}),this.sealed=!1}var h=l.prototype;return h.collectStyles=function(d){return this.sealed?s0(2):ks.default.createElement(Q5,{sheet:this.instance},d)},h.interleaveWithNodeStream=function(d){return s0(3)},l}(),me=on});function Un(){return Un=Object.assign||function(l){for(var h=1;h<arguments.length;h++){var d=arguments[h];for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&(l[g]=d[g])}return l},Un.apply(this,arguments)}var Vr=C(()=>{});function ri(l){if(l===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l}var Lr=C(()=>{});function mi(l,h){return mi=Object.setPrototypeOf||function(d,g){return d.__proto__=g,d},mi(l,h)}var Xo=C(()=>{});function Tl(l,h){l.prototype=Object.create(h.prototype),l.prototype.constructor=l,mi(l,h)}var Oa=C(()=>{Xo()});function Hi(l){return Hi=Object.setPrototypeOf?Object.getPrototypeOf:function(h){return h.__proto__||Object.getPrototypeOf(h)},Hi(l)}var Ba=C(()=>{});function a0(l){return Function.toString.call(l).indexOf("[native code]")!==-1}var _u=C(()=>{});function Ep(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Mp=C(()=>{});function xu(l,h,d){return Ep()?xu=Reflect.construct:xu=function(g,_,b){var S=[null];S.push.apply(S,_);var E=Function.bind.apply(g,S),N=new E;return b&&mi(N,b.prototype),N},xu.apply(null,arguments)}var Cp=C(()=>{Xo(),Mp()});function vh(l){var h=typeof Map=="function"?new Map:void 0;return vh=function(d){if(d===null||!a0(d))return d;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(typeof h<"u"){if(h.has(d))return h.get(d);h.set(d,g)}function g(){return xu(d,arguments,Hi(this).constructor)}return g.prototype=Object.create(d.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),mi(g,d)},vh(l)}var So=C(()=>{Ba(),Xo(),_u(),Cp()}),l0=C(()=>{});function us(l){return l.charAt(0).toUpperCase()+l.slice(1)}function _h(l,h){if(!l)return h.toLowerCase();var d=l.split("-");if(d.length>1)return d.splice(1,0,h),d.reduce(function(_,b){return""+_+us(b)});var g=l.replace(/([a-z])([A-Z])/g,"$1"+h+"$2");return l===g?""+l+h:g}function xh(l,h){for(var d={},g=0;g<h.length;g+=1)(h[g]||h[g]===0)&&(d[_h(l,dse[g])]=h[g]);return d}function cse(l){for(var h=arguments.length,d=new Array(h>1?h-1:0),g=1;g<h;g++)d[g-1]=arguments[g];var _=d[0],b=d[1],S=b===void 0?_:b,E=d[2],N=E===void 0?_:E,I=d[3],B=I===void 0?S:I,V=[_,S,N,B];return xh(l,V)}function b$(l){return Math.round(l*255)}function Fke(l,h,d){return b$(l)+","+b$(h)+","+b$(d)}function Lb(l,h,d,g){if(g===void 0&&(g=Fke),h===0)return g(d,d,d);var _=(l%360+360)%360/60,b=(1-Math.abs(2*d-1))*h,S=b*(1-Math.abs(_%2-1)),E=0,N=0,I=0;_>=0&&_<1?(E=b,N=S):_>=1&&_<2?(E=S,N=b):_>=2&&_<3?(N=b,I=S):_>=3&&_<4?(N=S,I=b):_>=4&&_<5?(E=S,I=b):_>=5&&_<6&&(E=b,I=S);var B=d-b/2,V=E+B,U=N+B,F=I+B;return g(V,U,F)}function Oke(l){if(typeof l!="string")return l;var h=l.toLowerCase();return A$[h]?"#"+A$[h]:l}function S$(l){if(typeof l!="string")throw new bh(3);var h=Oke(l);if(h.match(fse))return{red:parseInt(""+h[1]+h[2],16),green:parseInt(""+h[3]+h[4],16),blue:parseInt(""+h[5]+h[6],16)};if(h.match(pse)){var d=parseFloat((parseInt(""+h[7]+h[8],16)/255).toFixed(2));return{red:parseInt(""+h[1]+h[2],16),green:parseInt(""+h[3]+h[4],16),blue:parseInt(""+h[5]+h[6],16),alpha:d}}if(h.match(mse))return{red:parseInt(""+h[1]+h[1],16),green:parseInt(""+h[2]+h[2],16),blue:parseInt(""+h[3]+h[3],16)};if(h.match(gse)){var g=parseFloat((parseInt(""+h[4]+h[4],16)/255).toFixed(2));return{red:parseInt(""+h[1]+h[1],16),green:parseInt(""+h[2]+h[2],16),blue:parseInt(""+h[3]+h[3],16),alpha:g}}var _=EN.exec(h);if(_)return{red:parseInt(""+_[1],10),green:parseInt(""+_[2],10),blue:parseInt(""+_[3],10)};var b=yse.exec(h.substring(0,50));if(b)return{red:parseInt(""+b[1],10),green:parseInt(""+b[2],10),blue:parseInt(""+b[3],10),alpha:parseFloat(""+b[4])};var S=vse.exec(h);if(S){var E=parseInt(""+S[1],10),N=parseInt(""+S[2],10)/100,I=parseInt(""+S[3],10)/100,B="rgb("+Lb(E,N,I)+")",V=EN.exec(B);if(!V)throw new bh(4,h,B);return{red:parseInt(""+V[1],10),green:parseInt(""+V[2],10),blue:parseInt(""+V[3],10)}}var U=_se.exec(h.substring(0,50));if(U){var F=parseInt(""+U[1],10),H=parseInt(""+U[2],10)/100,G=parseInt(""+U[3],10)/100,W="rgb("+Lb(F,H,G)+")",X=EN.exec(W);if(!X)throw new bh(4,h,W);return{red:parseInt(""+X[1],10),green:parseInt(""+X[2],10),blue:parseInt(""+X[3],10),alpha:parseFloat(""+U[4])}}throw new bh(5)}function Bke(l){var h=l.red/255,d=l.green/255,g=l.blue/255,_=Math.max(h,d,g),b=Math.min(h,d,g),S=(_+b)/2;if(_===b)return l.alpha!==void 0?{hue:0,saturation:0,lightness:S,alpha:l.alpha}:{hue:0,saturation:0,lightness:S};var E,N=_-b,I=S>.5?N/(2-_-b):N/(_+b);switch(_){case h:E=(d-g)/N+(d<g?6:0);break;case d:E=(g-h)/N+2;break;default:E=(h-d)/N+4;break}return E*=60,l.alpha!==void 0?{hue:E,saturation:I,lightness:S,alpha:l.alpha}:{hue:E,saturation:I,lightness:S}}function w$(l){return Bke(S$(l))}function Q3(l){var h=l.toString(16);return h.length===1?"0"+h:h}function T$(l){return Q3(Math.round(l*255))}function Lke(l,h,d){return MN("#"+T$(l)+T$(h)+T$(d))}function SN(l,h,d){return Lb(l,h,d,Lke)}function Uke(l,h,d){if(typeof l=="number"&&typeof h=="number"&&typeof d=="number")return SN(l,h,d);if(typeof l=="object"&&h===void 0&&d===void 0)return SN(l.hue,l.saturation,l.lightness);throw new bh(1)}function zke(l,h,d,g){if(typeof l=="number"&&typeof h=="number"&&typeof d=="number"&&typeof g=="number")return g>=1?SN(l,h,d):"rgba("+Lb(l,h,d)+","+g+")";if(typeof l=="object"&&h===void 0&&d===void 0&&g===void 0)return l.alpha>=1?SN(l.hue,l.saturation,l.lightness):"rgba("+Lb(l.hue,l.saturation,l.lightness)+","+l.alpha+")";throw new bh(2)}function E$(l,h,d){if(typeof l=="number"&&typeof h=="number"&&typeof d=="number")return MN("#"+Q3(l)+Q3(h)+Q3(d));if(typeof l=="object"&&h===void 0&&d===void 0)return MN("#"+Q3(l.red)+Q3(l.green)+Q3(l.blue));throw new bh(6)}function use(l,h,d,g){if(typeof l=="string"&&typeof h=="number"){var _=S$(l);return"rgba("+_.red+","+_.green+","+_.blue+","+h+")"}else{if(typeof l=="number"&&typeof h=="number"&&typeof d=="number"&&typeof g=="number")return g>=1?E$(l,h,d):"rgba("+l+","+h+","+d+","+g+")";if(typeof l=="object"&&h===void 0&&d===void 0&&g===void 0)return l.alpha>=1?E$(l.red,l.green,l.blue):"rgba("+l.red+","+l.green+","+l.blue+","+l.alpha+")"}throw new bh(7)}function M$(l){if(typeof l!="object")throw new bh(8);if(bse(l))return use(l);if(xse(l))return E$(l);if(wse(l))return zke(l);if(Sse(l))return Uke(l);throw new bh(8)}function hse(l,h,d){return function(){var g=d.concat(Array.prototype.slice.call(arguments));return g.length>=h?l.apply(this,g):hse(l,h,g)}}function wN(l){return hse(l,l.length,[])}function TN(l,h,d){return Math.max(l,Math.min(h,d))}function Vke(l,h){if(h==="transparent")return h;var d=w$(h);return M$(Un({},d,{lightness:TN(0,1,d.lightness-parseFloat(l))}))}function Gke(l,h){if(h==="transparent")return h;var d=w$(h);return M$(Un({},d,{lightness:TN(0,1,d.lightness+parseFloat(l))}))}function $ke(l,h){if(h==="transparent")return h;var d=w$(h);return M$(Un({},d,{saturation:TN(0,1,d.saturation+parseFloat(l))}))}function Hke(l,h){if(h==="transparent")return h;var d=S$(h),g=typeof d.alpha=="number"?d.alpha:1,_=Un({},d,{alpha:TN(0,1,+(g*100-parseFloat(l)*100).toFixed(2)/100)});return use(_)}function C$(l){for(var h=arguments.length,d=new Array(h>1?h-1:0),g=1;g<h;g++)d[g-1]=arguments[g];return Tse.indexOf(l)>=0&&l?Un({},cse.apply(void 0,[""].concat(d)),{position:l}):cse.apply(void 0,["",l].concat(d))}var bh,dse,A$,fse,pse,mse,gse,EN,yse,vse,_se,MN,xse,bse,Sse,wse,Ub,cv,CN,Sh,Tse,Tc=C(()=>{Vr(),Lr(),Oa(),So(),l0(),bh=function(l){Tl(h,l);function h(d){var g;return g=l.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+d+" for more information.")||this,ri(g)}return h}(vh(Error)),dse=["Top","Right","Bottom","Left"],A$={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},fse=/^#[a-fA-F0-9]{6}$/,pse=/^#[a-fA-F0-9]{8}$/,mse=/^#[a-fA-F0-9]{3}$/,gse=/^#[a-fA-F0-9]{4}$/,EN=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i,yse=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([-+]?[0-9]*[.]?[0-9]+)\s*\)$/i,vse=/^hsl\(\s*(\d{0,3}[.]?[0-9]+)\s*,\s*(\d{1,3}[.]?[0-9]?)%\s*,\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,_se=/^hsla\(\s*(\d{0,3}[.]?[0-9]+)\s*,\s*(\d{1,3}[.]?[0-9]?)%\s*,\s*(\d{1,3}[.]?[0-9]?)%\s*,\s*([-+]?[0-9]*[.]?[0-9]+)\s*\)$/i,MN=function(l){return l.length===7&&l[1]===l[2]&&l[3]===l[4]&&l[5]===l[6]?"#"+l[1]+l[3]+l[5]:l},xse=function(l){return typeof l.red=="number"&&typeof l.green=="number"&&typeof l.blue=="number"&&(typeof l.alpha!="number"||typeof l.alpha>"u")},bse=function(l){return typeof l.red=="number"&&typeof l.green=="number"&&typeof l.blue=="number"&&typeof l.alpha=="number"},Sse=function(l){return typeof l.hue=="number"&&typeof l.saturation=="number"&&typeof l.lightness=="number"&&(typeof l.alpha!="number"||typeof l.alpha>"u")},wse=function(l){return typeof l.hue=="number"&&typeof l.saturation=="number"&&typeof l.lightness=="number"&&typeof l.alpha=="number"},Ub=wN(Vke),cv=wN(Gke),CN=wN($ke),Sh=wN(Hke),Tse=["absolute","fixed","relative","static","sticky"]});function jke(l,h,d){return h in l?Object.defineProperty(l,h,{value:d,enumerable:!0,configurable:!0,writable:!0}):l[h]=d,l}function Ese(l,h){var d=Object.keys(l);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(l);h&&(g=g.filter(function(_){return Object.getOwnPropertyDescriptor(l,_).enumerable})),d.push.apply(d,g)}return d}function J3(l){for(var h=1;h<arguments.length;h++){var d=arguments[h]!=null?arguments[h]:{};h%2?Ese(Object(d),!0).forEach(function(g){jke(l,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(d)):Ese(Object(d)).forEach(function(g){Object.defineProperty(l,g,Object.getOwnPropertyDescriptor(d,g))})}return l}function uv(l,h){if(l==null)return{};var d={},g=Object.keys(l),_,b;for(b=0;b<g.length;b++)_=g[b],!(h.indexOf(_)>=0)&&(d[_]=l[_]);return d}var zb=C(()=>{}),Mse,R$,Cse=C(()=>{Mse=z(Le()),R$=(0,Mse.createContext)({})});function Wke(l,h,d){return h in l?Object.defineProperty(l,h,{value:d,enumerable:!0,configurable:!0,writable:!0}):l[h]=d,l}function Ase(l,h){var d=Object.keys(l);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(l);h&&(g=g.filter(function(_){return Object.getOwnPropertyDescriptor(l,_).enumerable})),d.push.apply(d,g)}return d}function hv(l){for(var h=1;h<arguments.length;h++){var d=arguments[h]!=null?arguments[h]:{};h%2?Ase(Object(d),!0).forEach(function(g){Wke(l,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(d)):Ase(Object(d)).forEach(function(g){Object.defineProperty(l,g,Object.getOwnPropertyDescriptor(d,g))})}return l}function P$(l,h){if(l==null)return{};var d={},g=Object.keys(l),_,b;for(b=0;b<g.length;b++)_=g[b],!(h.indexOf(_)>=0)&&(d[_]=l[_]);return d}function qke(l,h){if(l){if(typeof l=="string")return Rse(l,h);var d=Object.prototype.toString.call(l).slice(8,-1);if(d==="Object"&&l.constructor&&(d=l.constructor.name),d==="Map"||d==="Set")return Array.from(l);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return Rse(l,h)}}function Rse(l,h){(h==null||h>l.length)&&(h=l.length);for(var d=0,g=new Array(h);d<h;d++)g[d]=l[d];return g}function Pse(l,h){var d;if(typeof Symbol>"u"||l[Symbol.iterator]==null){if(Array.isArray(l)||(d=qke(l))||h&&l&&typeof l.length=="number"){d&&(l=d);var g=0;return function(){return g>=l.length?{done:!0}:{done:!1,value:l[g++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return d=l[Symbol.iterator](),d.next.bind(d)}var AN=C(()=>{});function Xke(l){return typeof l=="function"}var N$,Nse,Yke=C(()=>{N$=z(Le()),Cse(),AN(),Nse=function(l,h,d){d===void 0&&(d=h.children);var g=(0,N$.useContext)(R$);if(g.useCreateElement)return g.useCreateElement(l,h,d);if(typeof l=="string"&&Xke(d)){h.children;var _=P$(h,["children"]);return d(_)}return(0,N$.createElement)(l,h,d)}});function Kke(l,h,d){return h in l?Object.defineProperty(l,h,{value:d,enumerable:!0,configurable:!0,writable:!0}):l[h]=d,l}function Ise(l,h){var d=Object.keys(l);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(l);h&&(g=g.filter(function(_){return Object.getOwnPropertyDescriptor(l,_).enumerable})),d.push.apply(d,g)}return d}function dv(l){for(var h=1;h<arguments.length;h++){var d=arguments[h]!=null?arguments[h]:{};h%2?Ise(Object(d),!0).forEach(function(g){Kke(l,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(d)):Ise(Object(d)).forEach(function(g){Object.defineProperty(l,g,Object.getOwnPropertyDescriptor(d,g))})}return l}function Zke(l,h){if(l==null)return{};var d={},g=Object.keys(l),_,b;for(b=0;b<g.length;b++)_=g[b],!(h.indexOf(_)>=0)&&(d[_]=l[_]);return d}var kse=C(()=>{});function Qke(l){return typeof l=="object"&&l!=null}var Jke=C(()=>{});function I$(l){var h;if(!Qke(l))return!1;var d=Object.getPrototypeOf(l);return d==null?!0:((h=d.constructor)===null||h===void 0?void 0:h.toString())===Object.toString()}var Dse=C(()=>{Jke()});function Fse(l,h){for(var d=Object.keys(l),g={},_={},b=0,S=d;b<S.length;b++){var E=S[b];h.indexOf(E)>=0?g[E]=l[E]:_[E]=l[E]}return[g,_]}function Ose(l,h){if(h===void 0&&(h=[]),!I$(l.state))return Fse(l,h);var d=Fse(l,[].concat(h,["state"])),g=d[0],_=d[1],b=g.state,S=Zke(g,["state"]);return[dv(dv({},b),S),_]}var eDe=C(()=>{kse(),Dse()});function RN(l,h){if(l===h)return!0;if(!l||!h||typeof l!="object"||typeof h!="object")return!1;var d=Object.keys(l),g=Object.keys(h),_=d.length;if(g.length!==_)return!1;for(var b=0,S=d;b<S.length;b++){var E=S[b];if(l[E]!==h[E])return!1}return!0}var k$=C(()=>{});function Bse(l){return l.name==="normalizePropsAreEqualInner"?l:function(h,d){return!I$(h.state)||!I$(d.state)?l(h,d):l(dv(dv({},h.state),h),dv(dv({},d.state),d))}}var tDe=C(()=>{kse(),Dse()});function nDe(l){return(0,D$.forwardRef)(l)}function rDe(l,h){return(0,D$.memo)(l,h)}function Vb(l){var h=l.as,d=l.useHook,g=l.memo,_=l.propsAreEqual,b=_===void 0?d==null?void 0:d.unstable_propsAreEqual:_,S=l.keys,E=S===void 0?(d==null?void 0:d.__keys)||[]:S,N=l.useCreateElement,I=N===void 0?Nse:N,B=function(V,U){var F=V.as,H=F===void 0?h:F,G=P$(V,["as"]);if(d){var W,X=Ose(G,E),Z=X[0],te=X[1],ae=d(Z,hv({ref:U},te)),oe=ae.wrapElement,ue=P$(ae,["wrapElement"]),Ee=((W=H.render)===null||W===void 0?void 0:W.__keys)||H.__keys,Ie=Ee&&Ose(G,Ee)[0],_e=Ie?hv(hv({},ue),Ie):ue,Oe=I(H,_e);return oe?oe(Oe):Oe}return I(H,hv({ref:U},G))};return B=nDe(B),g&&(B=rDe(B,b&&Bse(b))),B.__keys=E,B.unstable_propsAreEqual=Bse(b||RN),B}var D$,Gb=C(()=>{D$=z(Le()),AN(),Yke(),eDe(),k$(),tDe()});function Lse(l,h){(0,F$.useDebugValue)(l);var d=(0,F$.useContext)(R$);return d[l]!=null?d[l]:h}var F$,Use=C(()=>{F$=z(Le()),Cse()});function iDe(l,h,d){h===void 0&&(h={}),d===void 0&&(d={});var g="use"+l+"Props";(0,zse.useDebugValue)(g);var _=Lse(g);return _?_(h,d):d}var zse,sDe=C(()=>{zse=z(Le()),Use()});function oDe(l,h,d){h===void 0&&(h={}),d===void 0&&(d={});var g="use"+l+"Options";(0,Vse.useDebugValue)(g);var _=Lse(g);return _?hv(hv({},h),_(h,d)):h}var Vse,aDe=C(()=>{Vse=z(Le()),Use(),AN()});function lDe(l){return Array.isArray(l)?l:typeof l<"u"?[l]:[]}var cDe=C(()=>{});function $b(l){var h,d,g=lDe(l.compose),_=function(E,N){if(l.useOptions&&(E=l.useOptions(E,N)),l.name&&(E=oDe(l.name,E,N)),l.compose)for(var I=Pse(g),B;!(B=I()).done;){var V=B.value;E=V.__useOptions(E,N)}return E},b=function(E,N,I){if(E===void 0&&(E={}),N===void 0&&(N={}),I===void 0&&(I=!1),I||(E=_(E,N)),l.useProps&&(N=l.useProps(E,N)),l.name&&(N=iDe(l.name,E,N)),l.compose)if(l.useComposeOptions&&(E=l.useComposeOptions(E,N)),l.useComposeProps)N=l.useComposeProps(E,N);else for(var B=Pse(g),V;!(V=B()).done;){var U=V.value;N=U(E,N,!0)}var F={},H=N||{};for(var G in H)H[G]!==void 0&&(F[G]=H[G]);return F};b.__useOptions=_;var S=g.reduce(function(E,N){return E.push.apply(E,N.__keys||[]),E},[]);return b.__keys=[].concat(S,((h=l.useState)===null||h===void 0?void 0:h.__keys)||[],l.keys||[]),b.unstable_propsAreEqual=l.propsAreEqual||((d=g[0])===null||d===void 0?void 0:d.unstable_propsAreEqual)||RN,b}var Hb=C(()=>{z(Le()),sDe(),AN(),aDe(),k$(),cDe()});function Gse(l,h){h===void 0&&(h=null),l&&(typeof l=="function"?l(h):l.current=h)}function $se(l,h){return(0,Hse.useMemo)(function(){return l==null&&h==null?null:function(d){Gse(l,d),Gse(h,d)}},[l,h])}var Hse,jse=C(()=>{Hse=z(Le())});function O$(l){if(l.tagName==="BUTTON")return!0;if(l.tagName==="INPUT"){var h=l;return Wse.indexOf(h.type)!==-1}return!1}var Wse,B$=C(()=>{Wse=["button","color","file","image","reset","submit"]}),L$=C(()=>{}),uDe=C(()=>{L$(),z(Le())}),PN=C(()=>{L$(),z(Le()),uDe()});function qse(l){return l?l.ownerDocument||l:document}var Xse=C(()=>{});function hDe(l){return l&&qse(l).defaultView||Yse}var Yse,dDe=C(()=>{Xse();try{Yse=window}catch{}});function fDe(){var l=hDe();return!!(typeof l<"u"&&l.document&&l.document.createElement)}var NN,U$=C(()=>{dDe(),NN=fDe()}),z$,V$,G$=C(()=>{z$=z(Le()),U$(),V$=NN?z$.useLayoutEffect:z$.useEffect});function fv(l){var h=(0,Kse.useRef)(l);return V$(function(){h.current=l}),h}var Kse,Zse=C(()=>{Kse=z(Le()),G$()});function pDe(l){return l.target===l.currentTarget}var mDe=C(()=>{});function gDe(l){var h=qse(l),d=h.activeElement;return d!=null&&d.nodeName?d:null}var yDe=C(()=>{Xse()});function Qse(l,h){return l===h||l.contains(h)}var Jse=C(()=>{});function vDe(l){var h=gDe(l);if(!h)return!1;if(Qse(l,h))return!0;var d=h.getAttribute("aria-activedescendant");return d?d===l.id?!0:!!l.querySelector("#"+d):!1}var _De=C(()=>{yDe(),Jse()});function xDe(l){return!Qse(l.currentTarget,l.target)}var bDe=C(()=>{Jse()});function IN(l){return NN?window.navigator.userAgent.indexOf(l)!==-1:!1}var SDe=C(()=>{U$()});function wDe(l,h){return"matches"in l?l.matches(h):"msMatchesSelector"in l?l.msMatchesSelector(h):l.webkitMatchesSelector(h)}var TDe=C(()=>{});function EDe(l){var h=l;return h.offsetWidth>0||h.offsetHeight>0||l.getClientRects().length>0}function MDe(l){return wDe(l,eoe)&&EDe(l)}var eoe,CDe=C(()=>{TDe(),eoe="input:not([type='hidden']):not([disabled]), select:not([disabled]), textarea:not([disabled]), a[href], button:not([disabled]), [tabindex], iframe, object, embed, area[href], audio[controls], video[controls], [contenteditable]:not([contenteditable='false'])"}),toe,kN,noe=C(()=>{zb(),Gb(),Hb(),k$(),toe=["unstable_system"],kN=$b({name:"Role",keys:toe,propsAreEqual:function(l,h){var d=l.unstable_system,g=uv(l,["unstable_system"]),_=h.unstable_system,b=uv(h,["unstable_system"]);return d!==_&&!RN(d,_)?!1:RN(g,b)}}),Vb({as:"div",useHook:kN})});function roe(l){!vDe(l)&&MDe(l)&&l.focus()}function ADe(l){return l.tagName==="BUTTON"||l.tagName==="INPUT"||l.tagName==="SELECT"||l.tagName==="TEXTAREA"||l.tagName==="A"}function RDe(l){return l.tagName==="BUTTON"||l.tagName==="INPUT"||l.tagName==="SELECT"||l.tagName==="TEXTAREA"}function PDe(l,h,d,g){return l?h&&!d?-1:void 0:h?g:g||0}function $$(l,h){return(0,pv.useCallback)(function(d){var g;(g=l.current)===null||g===void 0||g.call(l,d),!d.defaultPrevented&&h&&(d.stopPropagation(),d.preventDefault())},[l,h])}var pv,ioe,soe,H$,NDe=C(()=>{zb(),Gb(),Hb(),pv=z(Le()),jse(),B$(),PN(),Zse(),G$(),_De(),bDe(),SDe(),CDe(),noe(),ioe=["disabled","focusable"],soe=IN("Mac")&&!IN("Chrome")&&(IN("Safari")||IN("Firefox")),H$=$b({name:"Tabbable",compose:kN,keys:ioe,useOptions:function(l,h){var d=h.disabled;return J3({disabled:d},l)},useProps:function(l,h){var d=h.ref,g=h.tabIndex,_=h.onClickCapture,b=h.onMouseDownCapture,S=h.onMouseDown,E=h.onKeyPressCapture,N=h.style,I=uv(h,["ref","tabIndex","onClickCapture","onMouseDownCapture","onMouseDown","onKeyPressCapture","style"]),B=(0,pv.useRef)(null),V=fv(_),U=fv(b),F=fv(S),H=fv(E),G=!!l.disabled&&!l.focusable,W=(0,pv.useState)(!0),X=W[0],Z=W[1],te=(0,pv.useState)(!0),ae=te[0],oe=te[1],ue=l.disabled?J3({pointerEvents:"none"},N):N;V$(function(){var ot=B.current;ot&&(ADe(ot)||Z(!1),RDe(ot)||oe(!1))},[]);var Ee=$$(V,l.disabled),Ie=$$(U,l.disabled),_e=$$(H,l.disabled),Oe=(0,pv.useCallback)(function(ot){var de;(de=F.current)===null||de===void 0||de.call(F,ot);var Be=ot.currentTarget;if(!ot.defaultPrevented&&soe&&!xDe(ot)&&O$(Be)){var re=requestAnimationFrame(function(){Be.removeEventListener("mouseup",Ye,!0),roe(Be)}),Ye=function(){cancelAnimationFrame(re),roe(Be)};Be.addEventListener("mouseup",Ye,{once:!0,capture:!0})}},[]);return J3({ref:$se(B,d),style:ue,tabIndex:PDe(G,X,ae,g),disabled:G&&ae?!0:void 0,"aria-disabled":l.disabled?!0:void 0,onClickCapture:Ee,onMouseDownCapture:Ie,onMouseDown:Oe,onKeyPressCapture:_e},I)}}),Vb({as:"div",useHook:H$})});function IDe(l){var h=l.currentTarget;return l.isTrusted?O$(h)||h.tagName==="INPUT"||h.tagName==="TEXTAREA"||h.tagName==="A"||h.tagName==="SELECT":!1}var DN,ooe,j$,kDe=C(()=>{zb(),Gb(),Hb(),DN=z(Le()),B$(),PN(),Zse(),mDe(),NDe(),ooe=["unstable_clickOnEnter","unstable_clickOnSpace"],j$=$b({name:"Clickable",compose:H$,keys:ooe,useOptions:function(l){var h=l.unstable_clickOnEnter,d=h===void 0?!0:h,g=l.unstable_clickOnSpace,_=g===void 0?!0:g,b=uv(l,["unstable_clickOnEnter","unstable_clickOnSpace"]);return J3({unstable_clickOnEnter:d,unstable_clickOnSpace:_},b)},useProps:function(l,h){var d=h.onKeyDown,g=h.onKeyUp,_=uv(h,["onKeyDown","onKeyUp"]),b=(0,DN.useState)(!1),S=b[0],E=b[1],N=fv(d),I=fv(g),B=(0,DN.useCallback)(function(U){var F;if((F=N.current)===null||F===void 0||F.call(N,U),!U.defaultPrevented&&!l.disabled&&!U.metaKey&&pDe(U)){var H=l.unstable_clickOnEnter&&U.key==="Enter",G=l.unstable_clickOnSpace&&U.key===" ";if(H||G){if(IDe(U))return;U.preventDefault(),H?U.currentTarget.click():G&&E(!0)}}},[l.disabled,l.unstable_clickOnEnter,l.unstable_clickOnSpace]),V=(0,DN.useCallback)(function(U){var F;if((F=I.current)===null||F===void 0||F.call(I,U),!U.defaultPrevented&&!l.disabled&&!U.metaKey){var H=l.unstable_clickOnSpace&&U.key===" ";S&&H&&(E(!1),U.currentTarget.click())}},[l.disabled,l.unstable_clickOnSpace,S]);return J3({"data-active":S||void 0,onKeyDown:B,onKeyUp:V},_)}}),Vb({as:"button",memo:!0,useHook:j$})}),jb,aoe,loe,coe,DDe=C(()=>{zb(),Gb(),Hb(),jb=z(Le()),jse(),B$(),PN(),kDe(),aoe=[],loe=$b({name:"Button",compose:j$,keys:aoe,useProps:function(l,h){var d=h.ref,g=uv(h,["ref"]),_=(0,jb.useRef)(null),b=(0,jb.useState)(void 0),S=b[0],E=b[1],N=(0,jb.useState)("button"),I=N[0],B=N[1];return(0,jb.useEffect)(function(){var V=_.current;V&&(O$(V)||(V.tagName!=="A"&&E("button"),B(void 0)))},[]),J3({ref:$se(_,d),role:S,type:I},g)}}),coe=Vb({as:"button",memo:!0,useHook:loe})}),uoe,hoe,doe,FDe=C(()=>{zb(),Gb(),Hb(),noe(),uoe=[],hoe=$b({name:"Group",compose:kN,keys:uoe,useProps:function(l,h){return J3({role:"group"},h)}}),doe=Vb({as:"div",useHook:hoe})});function ODe(){return NN?document.body:null}var foe,mv,BDe=C(()=>{foe=z(Le()),G$(),U$(),z(gu()),mv=(0,foe.createContext)(ODe())}),W$,LDe=C(()=>{typeof window<"u"&&(W$={get passive(){}},window.addEventListener("testPassive",null,W$),window.removeEventListener("testPassive",null,W$))}),e9=C(()=>{z(Le()),PN(),DDe(),FDe(),z(gu()),BDe(),LDe(),L$()});function vi(l){let h=(0,q$.useMemo)(()=>{let _=l;return{get current(){return _},set current(b){_=b,g(b)}}},[]),[d,g]=(0,q$.useState)(()=>l);return[h,d]}var q$,Ti=C(()=>{q$=z(Le())});function UDe(l){return h=>El.default.createElement(_oe,null,El.default.createElement(l,R({},h)))}var El,poe,moe,Si,gv,goe,yoe,voe,X$,Y$,_oe,Ei=C(()=>{Tc(),at(),at(),El=z(Le()),poe=z(gu()),e9(),Ti(),Si=Qa(moe||(moe=$([`
  #pointer-root & {
    pointer-events: none;
  }
  #pointer-root.normal & {
    pointer-events: auto;
  }
`]))),gv={panel:{bg:"#282b2f",head:{title:{color:"#bbb"},punctuation:{color:"#808080"}},body:{compoudThing:{label:{get color(){return cv(.6,gv.panel.bg)}}}}}},yoe=typeof window<"u"?tv(goe||(goe=$([`
  :host {
    all: initial;
    color: white;
    font: 11px -apple-system, BlinkMacSystemFont, Segoe WPC, Segoe Editor,
      HelveticaNeue-Light, Ubuntu, Droid Sans, sans-serif;
  }

  * {
    padding: 0;
    margin: 0;
    font-size: 100%;
    font: inherit;
    vertical-align: baseline;
    list-style: none;
  }
`]))):{},X$=me.div(voe||(voe=$([`
  z-index: 51;
  position: fixed;
  top: 0px;
  right: 0px;
  bottom: 0px;
  left: 0px;
  pointer-events: none;
`]))),Y$=l=>El.default.createElement(Q5,{disableVendorPrefixes:!0,target:l.target},El.default.createElement(El.default.Fragment,null,El.default.createElement(yoe,null),l.children)),_oe=l=>{let[h,d]=(0,El.useState)(null),[g,_]=(0,El.useState)(null);(0,El.useLayoutEffect)(()=>{if(!h)return;let{parentNode:E}=h;if(!E)return;let N=E.shadowRoot?parent.shadowRoot:E.attachShadow({mode:"open"});_(N)},[h]);let[b,S]=vi(void 0);return g?poe.default.createPortal(El.default.createElement(Y$,{target:g},El.default.createElement(El.default.Fragment,null,El.default.createElement(X$,{ref:b}),El.default.createElement(mv.Provider,{value:S},l.children))),g):El.default.createElement("template",{ref:d,"shadow-root":"open"},l.children)}}),yv,xoe,boe,Xm,Soe,Wb,woe,Toe,FN,Eoe,K$,Hd,Ap=C(()=>{Ei(),at(),yv={get outlinePanel(){return 1},get propsPanel(){return yv.outlinePanel},get sequenceEditorPanel(){return this.outlinePanel-1},get toolbar(){return this.outlinePanel+1},get pluginPanes(){return this.sequenceEditorPanel-1}},xoe=gv.panel.bg,Xm=me.span(boe||(boe=$([`
  white-space: nowrap;
`]))),Wb=me.span(Soe||(Soe=$([`
  white-space: nowrap;
  color: `,`;
`])),gv.panel.head.punctuation.color),Toe=me.div(woe||(woe=$([`
  background: `,`;
  flex-grow: 1;
  overflow-y: scroll;
  padding: 0;
`])),xoe),FN=18,K$=me.div(Eoe||(Eoe=$([`
  height: `,`px;
  box-sizing: border-box;
  display: flex;
  align-items: center;
  padding: 0 10px;
  position: relative;
  color: #adadadb3;
  border-bottom: 1px solid rgb(0 0 0 / 13%);
  background-color: #25272b;
  font-size: 10px;
  font-weight: 500;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
`])),FN),Hd=100}),Moe,wh,vv=C(()=>{Moe=()=>{},wh=Moe});function zDe(l){return Z$.createElement("svg",R({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l),Z$.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.775 2.781a.5.5 0 01.5.5v1.7H4.67c.108-.957.92-1.7 1.905-1.7h6.608a1.917 1.917 0 110 3.834H6.574c-.78 0-1.452-.466-1.751-1.135H2.275v5.03h2.39a2.032 2.032 0 012.023-1.854h6.38a2.031 2.031 0 110 4.063h-6.38c-.83 0-1.543-.497-1.858-1.21H1.775a.5.5 0 01-.5-.5V3.281a.5.5 0 01.5-.5zm4.799 1.5h6.608a.917.917 0 110 1.834H6.574a.917.917 0 110-1.834zm.114 5.875h6.38a1.031 1.031 0 110 2.063h-6.38a1.032 1.032 0 110-2.063z",fill:"currentColor"}))}var Z$,Q$,VDe=C(()=>{Z$=z(Le()),Q$=zDe});function GDe(l){return J$.createElement("svg",R({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l),J$.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 10.5L4 6.654 5.2 5.5 8 8.385 10.8 5.5 12 6.654 8 10.5z",fill:"currentColor"}))}var J$,Coe,$De=C(()=>{J$=z(Le()),Coe=GDe});function HDe(l){return eH.createElement("svg",R({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l),eH.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.5 3c-1.072 0-1.969.904-1.969 1.969 0 1 .929 1.968 1.969 1.968h9A1.969 1.969 0 1012.5 3h-9zm9 1H5.531v1.938H12.5A.969.969 0 0012.5 4zM3.5 9.14a1.969 1.969 0 000 3.938h9a1.969 1.969 0 100-3.937h-9zm9 1H8.406v1.938H12.5a.969.969 0 100-1.937z",fill:"currentColor"}))}var eH,Aoe,jDe=C(()=>{eH=z(Le()),Aoe=HDe});function WDe(l){return tH.createElement("svg",R({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l),tH.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M.166 7.994a2.26 2.26 0 114.518 0 2.26 2.26 0 01-4.518 0zM2.425 6.91a1.085 1.085 0 100 2.17 1.085 1.085 0 000-2.17zM5.74 7.994a2.26 2.26 0 114.519 0 2.26 2.26 0 01-4.519 0zM8 6.91a1.085 1.085 0 100 2.17 1.085 1.085 0 000-2.17zM13.575 5.735a2.26 2.26 0 100 4.519 2.26 2.26 0 000-4.52zm-1.086 2.26a1.085 1.085 0 112.171 0 1.085 1.085 0 01-2.17 0z",fill:"currentColor"}))}var tH,Roe,qDe=C(()=>{tH=z(Le()),Roe=WDe});function XDe(l){return nH.createElement("svg",R({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l),nH.createElement("path",{d:"M8.339 4.5l-2.055.644 4.451 1.393v2.748l-2.966.928-2.504-.783V6.738l2.42.758 2.055-.644-4.458-1.395L4 5.858v4.463L7.768 11.5 12 10.175V5.646L8.339 4.5z",fill:"currentColor"}))}var nH,rH,YDe=C(()=>{nH=z(Le()),rH=XDe});function KDe(l){return iH.createElement("svg",R({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l),iH.createElement("path",{d:"M8 1.57c-.416 0-.752.36-.752.804v.482c-1.715.372-3.006 1.994-3.006 3.938v.473c0 1.18-.407 2.32-1.14 3.205l-.173.208a.85.85 0 00-.125.864.75.75 0 00.686.475h9.019a.752.752 0 00.686-.475.845.845 0 00-.125-.864l-.174-.208a5.026 5.026 0 01-1.139-3.205v-.473c0-1.944-1.291-3.566-3.006-3.938v-.482c0-.445-.336-.804-.752-.804zm1.063 12.39c.282-.301.44-.71.44-1.138H6.496c0 .428.158.837.44 1.138.281.302.664.47 1.063.47.4 0 .783-.168 1.064-.47z",fill:"currentColor"}))}var iH,ON,ZDe=C(()=>{iH=z(Le()),ON=KDe});function QDe(l){return sH.createElement("svg",R({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l),sH.createElement("path",{d:"M6.8 11.6a.6.6 0 00.6-.6V7.4a.6.6 0 00-1.2 0V11a.6.6 0 00.6.6zm6-7.2h-2.4v-.6A1.8 1.8 0 008.6 2H7.4a1.8 1.8 0 00-1.8 1.8v.6H3.2a.6.6 0 100 1.2h.6v6.6A1.8 1.8 0 005.6 14h4.8a1.8 1.8 0 001.8-1.8V5.6h.6a.6.6 0 100-1.2zm-6-.6a.6.6 0 01.6-.6h1.2a.6.6 0 01.6.6v.6H6.8v-.6zm4.2 8.4a.6.6 0 01-.6.6H5.6a.6.6 0 01-.6-.6V5.6h6v6.6zm-1.8-.6a.6.6 0 00.6-.6V7.4a.6.6 0 00-1.2 0V11a.6.6 0 00.6.6z",fill:"currentColor"}))}var sH,oH,JDe=C(()=>{sH=z(Le()),oH=QDe}),qb=C(()=>{VDe(),$De(),jDe(),qDe(),YDe(),ZDe(),JDe()}),jd,Poe,BN,Noe,Ioe,koe,Doe,Foe,Ooe,Boe,Loe,Uoe,zoe,Voe,Goe,$oe,Hoe,joe,Xb,LN=C(()=>{jd=z(Le()),at(),vv(),Ei(),qb(),BN=me.li(Poe||(Poe=$([`
  margin: 0;
  padding: 0;
  list-style: none;
  display: flex;
  justify-content: flex-start;
  flex-direction: column;
  align-items: flex-start;
`]))),Ioe=me.div(Noe||(Noe=$([""]))),Doe=me(Ioe)(koe||(koe=$([`
  position: relative;
  margin-top: 2px;
  margin-bottom: 2px;
  margin-left: calc(4px + var(--depth) * 16px);
  padding-left: 4px;
  padding-right: 8px;
  gap: 4px;
  height: 21px;
  line-height: 0;
  box-sizing: border-box;
  display: flex;
  flex-wrap: nowrap;
  align-items: center;
  pointer-events: none;
  white-space: nowrap;

  border-radius: 2px;
  box-shadow: 0 3px 4px -1px rgba(0, 0, 0, 0.48);

  color: rgba(255, 255, 255, 0.9);
  background: rgba(40, 43, 47, 0.65);
  backdrop-filter: blur(14px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);

  &.descendant-is-selected {
    background: rgba(29, 53, 59, 0.7);
  }

  `,`;
  &:not(.not-selectable):not(.selected):hover {
    background: rgba(59, 63, 69, 0.9);

    border-bottom: 1px solid rgba(255, 255, 255, 0.24);
  }

  &:not(.not-selectable):not(.selected):active {
    background: rgba(82, 88, 96, 0.9);
    border-bottom: 1px solid rgba(255, 255, 255, 0.24);
  }

  &.selected {
    background: rgba(30, 88, 102, 0.7);
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  }

  @supports not (backdrop-filter: blur()) {
    background: rgba(40, 43, 47, 0.95);
  }
`])),Si),Ooe=Qa(Foe||(Foe=$([`
  font-weight: 500;
  font-size: 11px;
  & {
  }
`]))),Loe=me.span(Boe||(Boe=$([`
  `,`;

  `,`;
  position: relative;
  // Compensate for border bottom
  top: 0.5px;
  display: flex;
  height: 20px;
  align-items: center;
  box-sizing: border-box;
`])),Ooe,Si),zoe=me.div(Uoe||(Uoe=$([`
  font-weight: 500;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  opacity: 0.99;
`]))),Goe=me.span(Voe||(Voe=$([`
  font-size: 9px;
  position: relative;
  display: block;
  transition: transform 0.1s ease-out;

  &:hover {
    transform: rotate(-20deg);
  }

  `,`.collapsed & {
    transform: rotate(-90deg);

    &:hover {
      transform: rotate(-70deg);
    }
  }
`])),BN),Hoe=me.ul($oe||($oe=$([`
  margin: 0;
  padding: 0;
  list-style: none;

  `,`.collapsed & {
    display: none;
  }
`])),BN),joe=({label:l,children:h,depth:d,select:g,selectionStatus:_,labelDecoration:b,collapsed:S=!1,setIsCollapsed:E})=>{let N=h!==void 0;return jd.default.createElement(BN,{style:{"--depth":d},className:S?"collapsed":""},jd.default.createElement(Doe,{className:_,onClick:g??wh,"data-header":!0},jd.default.createElement(zoe,null,N?jd.default.createElement(Goe,{onClick:I=>{I.stopPropagation(),I.preventDefault(),E==null||E(!S)}},jd.default.createElement(Coe,null)):jd.default.createElement(rH,null)),jd.default.createElement(Loe,null,jd.default.createElement("span",null,l)),b),N&&jd.default.createElement(Hoe,null,h))},Xb=joe});function eFe(l){return Object.keys(l)}function tFe(l){return Object.keys((0,Wd.val)(l.sheetTemplatesP))}function nFe(){let l=i0(Ym().filter(h=>vt(h)||Sn(h)).map(h=>Sn(h)?h.sheet:h))[0];if(l)return l.getSequence()}var Wd,Ym,Woe,Km=C(()=>{Wd=Jt,Kr(),bo(),Fe(),Ym=()=>{var l;let h=(0,Wd.val)(ge().projectsP),d=((l=(0,Wd.val)(ge().atomP.historic.panels.outlinePanel.selection))!=null?l:[]).map(g=>{let _=h[g.projectId];if(!_)return;if(g.type==="Project")return _;if(!(0,Wd.val)(_.sheetTemplatesP[g.sheetId]))return;let b=Woe(_,g.sheetId);if(!b)return;if(g.type==="Sheet")return b;let S=(0,Wd.val)(b.objectsP[g.objectKey]);if(S)return S});return i0(d.filter(g=>typeof g<"u"))},Woe=(l,h)=>{let d=ge().atomP.historic.projects.stateByProjectId[l.address.projectId],g=(0,Wd.val)(d.stateBySheetId[h].selectedInstanceId),_=(0,Wd.val)(l.sheetTemplatesP[h]);if(_){if(g)return(0,Wd.val)(_.instancesP[g]);{let b=(0,Wd.val)(_.instancesP);return b[eFe(b)[0]]}}}}),qoe,Xoe,rFe=C(()=>{Fe(),qoe=z(Le()),LN(),Qn(),Km(),Xoe=({sheetObject:l,depth:h,overrideLabel:d})=>{let g=()=>{ge().transaction(({stateEditors:b})=>{b.studio.historic.panels.outline.selection.set([l])})},_=Rr(()=>Ym(),[]);return qoe.default.createElement(Xb,{select:g,label:d??l.address.objectKey,depth:h,selectionStatus:_.includes(l)?"selected":"not-selected"})}});function aH(l){var h;let d=l.type==="namespace"?"namespace:".concat(l.sheet.address.sheetId,":").concat(l.path.join("/")):l.type==="Theatre_Project"?"project":l.type==="Theatre_Sheet"?"sheetInstance:".concat(l.address.sheetId,":").concat(l.address.sheetInstanceId):"unknown",g=l.type==="namespace"?l.sheet.address.projectId:l.address.projectId,_=(h=Dr(ge().atomP.ahistoric.projects.stateByProjectId[g].collapsedItemsInOutline[d]))!=null?h:!1,b=(0,Yoe.useCallback)(S=>{ge().transaction(({stateEditors:E})=>{E.studio.ahistoric.projects.stateByProjectId.collapsedItemsInOutline.set({projectId:g,isCollapsed:S,itemKey:d})})},[d]);return{collapsed:_,setCollapsed:b}}var Yoe,lH=C(()=>{Yoe=z(Le()),Fe(),Qn()});function Koe(l){return qd.default.createElement(qd.default.Fragment,null,[...l.namespace.entries()].map(([h,{object:d,nested:g}])=>qd.default.createElement(iFe,{key:h,label:h,object:d,nested:g,visualIndentation:l.visualIndentation,path:l.path,sheet:l.sheet})))}function iFe(l){let{nested:h,label:d,object:g,sheet:_}=l,{collapsed:b,setCollapsed:S}=aH({type:"namespace",sheet:_,path:[...l.path,d]}),E=h&&qd.default.createElement(Koe,{namespace:h,path:[...l.path,d],key:"namespaceTree("+d+")",visualIndentation:l.visualIndentation+1,sheet:_}),N=g&&qd.default.createElement(Xoe,{depth:l.visualIndentation,key:"objectPath("+g.address.objectKey+")",sheetObject:g,overrideLabel:d});return qd.default.createElement(qd.default.Fragment,{key:"".concat(d," - ").concat(l.visualIndentation)},N,E&&qd.default.createElement(Xb,{selectionStatus:"not-selectable",label:d,key:"baseItem(".concat(d,")"),depth:l.visualIndentation,children:E,collapsed:b,setIsCollapsed:S}))}function Zoe(l,h,d=sFe(h)){let[g,..._]=d,b=l.get(g);b||(b={nested:void 0,object:void 0,path:[...d]},l.set(g,b)),_.length===0?(console.assert(!b.object,"expect not to have existing object with same name",{existing:b,object:h}),b.object=h):(b.nested||(b.nested=new Map),Zoe(b.nested,h,_))}function sFe(l){let h=cH.get(l);return h||(h=l.address.objectKey.split(nae),console.assert(h.length>0,"expected not empty"),cH.set(l,h)),h}var Qoe,qd,Joe,eae,tae,nae,cH,oFe=C(()=>{Qn(),Qoe=Jt,qd=z(Le()),at(),rFe(),LN(),lH(),me.li(Joe||(Joe=$([`
  color: `,`;
`])),l=>l.isSelected?"white":"hsl(1, 1%, 80%)"),eae=({sheet:l,depth:h})=>Rr(()=>{let d=(0,Qoe.val)(l.objectsP),g=Object.values(d).filter(b=>b!=null),_=new Map;return g.forEach(b=>{Zoe(_,b)}),qd.default.createElement(Koe,{namespace:_,visualIndentation:h,path:[],sheet:l})},[l,h]),tae=eae,nae=/\s*\/\s*/g,cH=new WeakMap}),_v,rae,iae,sae,oae,aae,lae,aFe=C(()=>{Fe(),Km(),Qn(),_v=z(Le()),at(),oFe(),LN(),lH(),iae=me.div(rae||(rae=$([`
  display: flex;
`]))),me.li(sae||(sae=$([`
  color: `,`;
`])),l=>l.isSelected?"white":"hsl(1, 1%, 80%)"),aae=me.div(oae||(oae=$([""]))),lae=({sheet:l,depth:h})=>{let{collapsed:d,setCollapsed:g}=aH(l),_=(0,_v.useCallback)(()=>{ge().transaction(({stateEditors:b})=>{b.studio.historic.panels.outline.selection.set([l])})},[l]);return Rr(()=>{let b=Ym();return _v.default.createElement(Xb,{depth:h,select:_,setIsCollapsed:g,collapsed:d,selectionStatus:b.some(S=>S===l)?"selected":b.some(S=>S.type==="Theatre_SheetObject"&&S.sheet===l)?"descendant-is-selected":"not-selected",label:_v.default.createElement(iae,null,l.address.sheetId,": ",l.address.sheetInstanceId)},_v.default.createElement(aae,null,_v.default.createElement(tae,{depth:h+1,sheet:l,key:"objectList"+l.address.sheetInstanceId})))},[h,d])}}),uH,xv,cae,uae,hae,dae,lFe=C(()=>{Qn(),uH=Jt,xv=z(Le()),at(),aFe(),me.div(cae||(cae=$([`
  display: flex;
`]))),me.li(uae||(uae=$([`
  color: `,`;
`])),l=>l.isSelected?"white":"hsl(1, 1%, 80%)"),me.div(hae||(hae=$([""]))),dae=({sheetId:l,depth:h,project:d})=>Rr(()=>{let g=(0,uH.val)(d.sheetTemplatesP[l]);if(!g)return xv.default.createElement(xv.default.Fragment,null);let _=(0,uH.val)(g.instancesP);return xv.default.createElement(xv.default.Fragment,null,Object.entries(_).map(([b,S])=>xv.default.createElement(lae,{key:S.address.sheetInstanceId,sheet:S,depth:h})))},[h,l,d])}),UN,fae,pae,cFe=C(()=>{Km(),Qn(),UN=z(Le()),lFe(),fae=({project:l,depth:h})=>Rr(()=>{if(!l)return null;let d=tFe(l);return UN.default.createElement(UN.default.Fragment,null,d.map(g=>UN.default.createElement(dae,{depth:h,sheetId:g,key:"sheet-".concat(g),project:l})))},[l,h]),pae=fae}),Yb,mae,gae,yae,vae,_ae,uFe=C(()=>{Yb=z(Le()),LN(),cFe(),Fe(),Qn(),Km(),mae=Jt,at(),lH(),yae=me.div(gae||(gae=$([`
  color: #ff6363;
  margin-left: 11px;
  background: #4c282d;
  padding: 2px 8px;
  border-radius: 2px;
  font-size: 10px;
  box-shadow: 0 2px 8px -4px black;
`]))),vae=({depth:l,project:h})=>{let d=Rr(()=>Ym(),[]),g=Rr(()=>{let E=h.address.projectId,N=(0,mae.val)(ge().atomP.ephemeral.coreByProject[E].loadingState);return(N==null?void 0:N.type)==="browserStateIsNotBasedOnDiskState"},[h]),_=(0,Yb.useCallback)(()=>{ge().transaction(({stateEditors:E})=>{E.studio.historic.panels.outline.selection.set([h])})},[h]),{collapsed:b,setCollapsed:S}=aH(h);return Yb.default.createElement(Xb,{depth:l,label:h.address.projectId,setIsCollapsed:S,collapsed:b,labelDecoration:g?Yb.default.createElement(yae,null,"Has Conflicts"):null,children:Yb.default.createElement(pae,{project:h,depth:l+1}),selectionStatus:d.includes(h)?"selected":d.some(E=>E.address.projectId===h.address.projectId)?"descendant-is-selected":"not-selected",select:_})},_ae=vae}),xae,hH,bae,Sae,wae,Tae,hFe=C(()=>{xae=Jt,Qn(),Fe(),hH=z(Le()),at(),uFe(),Sae=me.ul(bae||(bae=$([`
  list-style: none;
  margin: 0;
  padding: 0;
  padding-right: 4px;
`]))),wae=l=>Rr(()=>{let h=(0,xae.val)(ge().projectsP);return hH.default.createElement(Sae,null,Object.keys(h).map(d=>{let g=h[d];return hH.default.createElement(_ae,{depth:0,project:g,key:"projectListItem-".concat(d)})}))},[]),Tae=wae});function Eae(l){let[h,d]=(0,dH.useState)(!1);return(0,dH.useEffect)(()=>{let g=b=>{let S=h?200:50,E=56,N=l==="left"?b.x<S:b.x>window.innerWidth-S;N&&(N=b.y>E),d(!!N)};document.addEventListener("mousemove",g);let _=()=>{d(!1)};return document.addEventListener("mouseleave",_),()=>{document.removeEventListener("mousemove",g),document.removeEventListener("mouseleave",_)}},[h]),h}var dH,Mae=C(()=>{dH=z(Le())}),Kb,bv,fH,Cae,Aae,Rae,Pae,zN,Zb,Nae,dFe=C(()=>{Kb=z(Le()),at(),Ap(),hFe(),Qn(),Fe(),Mae(),bv=Jt,Ei(),fH="44px",Aae=me.div(Cae||(Cae=$([`
  `,`;
  background-color: transparent;
  position: absolute;
  left: 8px;
  z-index: `,`;

  top: calc(`,` + 8px);
  height: fit-content;
  max-height: calc(100% - `,`);
  overflow-y: scroll;
  overflow-x: hidden;
  padding: 0;
  user-select: none;

  &::-webkit-scrollbar {
    display: none;
  }

  scrollbar-width: none;

  display: `,`;

  &:hover {
    display: block;
  }

  // Create a small buffer on the bottom to aid selecting the bottom item in a long, scrolling list
  &::after {
    content: '';
    display: block;
    height: 20px;
  }
`])),Si,yv.outlinePanel,fH,fH,({pin:l})=>l?"block":"none"),Rae=()=>{var l;let h=(l=Dr(ge().atomP.ahistoric.pinOutline))!=null?l:!0,d=Dr(Nae),g=Eae("left");return(0,Kb.useLayoutEffect)(()=>{zN.set(g)},[g]),(0,Kb.useEffect)(()=>()=>{Zb.set(!1),zN.set(!1)},[]),Kb.default.createElement(Aae,{pin:h||d,onMouseEnter:()=>{Zb.set(!0)},onMouseLeave:()=>{Zb.set(!1)}},Kb.default.createElement(Tae,null))},Pae=Rae,zN=new bv.Atom(!1),Zb=new bv.Atom(!1),Nae=(0,bv.prism)(()=>{let l=(0,bv.val)(Zb.prism),h=(0,bv.val)(zN.prism);return l||h})}),Iae,kae,Dae,fFe=C(()=>{at(),kae=me.input.attrs({type:"checkbox"})(Iae||(Iae=$([`
  outline: none;
`]))),Dae=kae});function pFe({propConfig:l,editingTools:h,value:d,autoFocus:g}){let _=(0,pH.useCallback)(b=>{h.permanentlySetValue(!!b.target.checked)},[l,h]);return pH.default.createElement(Oae,{checked:d,onChange:_,autoFocus:g})}var pH,Fae,Oae,Bae,mFe=C(()=>{pH=z(Le()),at(),fFe(),Oae=me(Dae)(Fae||(Fae=$([`
  margin-left: 6px;

  :focus {
    outline: 1px solid #555;
  }
`]))),Bae=pFe});function VN(l){return h=>{l.forEach(d=>{typeof d=="function"?d(h):d!=null&&(d.current=h)})}}var GN=C(()=>{});function mH(l,h,d){(0,Lae.useEffect)(()=>{if(!l||d===!1)return;let g=Array.isArray(l)?l.filter(b=>b):[l],_=b=>{g.every(S=>!b.composedPath().includes(S))&&h(b)};return window.addEventListener("mousedown",_,{capture:!0,passive:!1}),()=>{window.removeEventListener("mousedown",_,{capture:!0,passive:!1})}},[l,d])}var Lae,gH=C(()=>{Lae=z(Le())}),Rp,Uae,Pp,zae,Vae,Gae,$ae,yH,Hae,bu,jae,Ec=C(()=>{Rp=z(Le()),at(),Uae="pointer-root",Pp="--lockedCursor",Vae=me.div(zae||(zae=$([`
  pointer-events: auto;
  &.normal {
    pointer-events: none;
  }
`]))),$ae=me.div(Gae||(Gae=$([`
  position: absolute;
  inset: 0;
  pointer-events: none;

  #pointer-root:not(.normal) > & {
    pointer-events: auto;
  }
`]))),yH=(0,Rp.createContext)({}),Hae=l=>{var h,d,g,_;let[b,S]=(0,Rp.useState)([]),E=(0,Rp.useMemo)(()=>({getLock:(I,B)=>{let V={className:I,cursor:B};return S(U=>[...U,V]),()=>{S(U=>U.filter(F=>F!==V))}}}),[]),N=(d=(h=b[0])==null?void 0:h.cursor)!=null?d:"";return Rp.default.createElement(yH.Provider,{value:E},Rp.default.createElement(Vae,{id:Uae,className:((_=(g=b[0])==null?void 0:g.className)!=null?_:"normal")+" "+l.className},Rp.default.createElement($ae,{style:{cursor:N,[Pp]:N}},l.children)))},bu=(l,h,d)=>{let g=(0,Rp.useContext)(yH);(0,Rp.useLayoutEffect)(()=>{if(l)return g.getLock(h,d)},[l,h,d])},jae=Hae});function Wae(l){return Qb.default.createElement(vH.Provider,{value:l.logger},l.children)}function Zm(l,h){let d=(0,Qb.useContext)(vH);return(0,Qb.useMemo)(()=>l?d.named(l,h):d,[d,l,h])}var Qb,vH,Qm=C(()=>{Qb=z(Le()),vH=Qb.default.createContext(null)});function gFe(){let l=Zm("PointerCapturing"),h=Th.default.useRef(null),d=()=>h.current!=null;return g=>{let _,b=S=>(_=S,h.current=S,S);return{capturing:{capturePointer(S){if(l._debug("Capturing pointer",{forDebugName:g,reason:S}),h.current!=null)throw new Error('"'.concat(g,'" attempted capturing pointer for "').concat(S,'" while already captured by "').concat(h.current.debugOwnerName,'" for "').concat(h.current.debugReason,'"'));let E=b({debugOwnerName:g,debugReason:S});return{isCapturing(){return E===h.current},release(){return E===h.current?(l._debug("Releasing pointer",{forDebugName:g,reason:S}),b(null),!0):!1}}},isPointerBeingCaptured:d},forceRelease(){_&&h.current===_&&(l._debug("Force releasing pointer",{localCapture:_}),b(null))}}}}function yFe(l){let h=gFe();return Th.default.createElement(_H.Provider,{value:h},Th.default.createElement(Xae,{children:l.children}))}function qae(l){let h=(0,Th.useContext)(_H),d=(0,Th.useMemo)(()=>h(l),[l,h]);return(0,Th.useEffect)(()=>()=>{d.forceRelease()},[d]),d.capturing}var Th,_H,Xae,xH=C(()=>{Th=z(Le()),Qm(),_H=Th.default.createContext(null),Xae=Th.default.memo(({children:l})=>Th.default.createElement(Th.default.Fragment,null,l))}),bH,vFe=C(()=>{bH=typeof window<"u"&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)});function eo(l,h){let d=(0,Sv.useRef)(h);d.current=h;let g=h.shouldPointerLock&&!bH,_=(0,Sv.useRef)({domDragStarted:!1}),{capturePointer:b}=qae("useDrag for ".concat(h.debugName)),S=(0,Sv.useRef)({onDrag:wh,onDragEnd:wh,onClick:wh}),E=(0,Sv.useRef)(),[N,I]=vi(!1);return(0,Sv.useLayoutEffect)(()=>{if(!l)return;let B=()=>{let Z=_.current.domDragStarted&&_.current.detection.detected;N.current!==Z&&(N.current=Z)},V=Z=>{if(!_.current.domDragStarted)return;let te=_.current;if(!_Fe(Z,te)&&(te.detection.detected||(te.detection.totalDistanceMoved+=Math.abs(Z.movementY)+Math.abs(Z.movementX),te.detection.totalDistanceMoved>Yae&&(g&&l.requestPointerLock(),te.detection={detected:!0,dragMovement:{x:0,y:0},dragEventCount:0},B())),te.detection.detected)){te.detection.dragEventCount+=1;let{dragMovement:ae}=te.detection;if(g)ae.x+=Z.movementX,ae.y+=Z.movementY;else{let{startPos:oe}=te;ae.x=Z.screenX-oe.x,ae.y=Z.screenY-oe.y}S.current.onDrag(ae.x,ae.y,Z,Z.movementX,Z.movementY)}},U=Z=>{if(H(),!_.current.domDragStarted)return;let te=_.current.detection.detected;_.current={domDragStarted:!1},h.shouldPointerLock&&!bH&&document.exitPointerLock(),S.current.onDragEnd(te),window.focus(),te||S.current.onClick(Z),B()},F=()=>{document.addEventListener("mousemove",V),document.addEventListener("mouseup",U)},H=()=>{var Z;(Z=E.current)==null||Z.release(),document.removeEventListener("mousemove",V),document.removeEventListener("mouseup",U)},G=Z=>{d.current.disabled||_.current.domDragStarted&&_.current.detection.detected&&(d.current.dontBlockMouseDown||(Z.stopPropagation(),Z.preventDefault()),_.current.detection={detected:!1,totalDistanceMoved:0},B())},W=Z=>{var te,ae,oe,ue;(te=E.current)==null||te.release();let Ee=d.current;if(Ee.disabled===!0||!((ae=Ee.buttons)!=null?ae:[0]).includes(Z.button))return;let Ie=Ee.onDragStart(Z);Ie!==!1&&(S.current.onDrag=Ie.onDrag,S.current.onDragEnd=(oe=Ie.onDragEnd)!=null?oe:wh,S.current.onClick=(ue=Ie.onClick)!=null?ue:wh,E.current=b("Drag start"),Ee.dontBlockMouseDown||(Z.stopPropagation(),Z.preventDefault()),_.current={domDragStarted:!0,startPos:{x:Z.screenX,y:Z.screenY},detection:{detected:!1,totalDistanceMoved:0}},B(),F())},X=Z=>{W(Z)};return l.addEventListener("mousedown",X),l.addEventListener("click",G),()=>{var Z,te;H(),l.removeEventListener("mousedown",X),l.removeEventListener("click",G),_.current.domDragStarted&&((te=(Z=S.current).onDragEnd)==null||te.call(Z,_.current.detection.detected)),_.current={domDragStarted:!1},B()}},[l]),bu(I&&!!h.lockCSSCursorTo,"dragging",h.lockCSSCursorTo),[I]}function _Fe(l,h){return(!h.detection.detected||h.detection.detected&&h.detection.dragEventCount<3)&&(Math.abs(l.movementX)>SH||Math.abs(l.movementY)>SH)}var Sv,Yae,SH,Yo=C(()=>{Sv=z(Le()),Ec(),xH(),vv(),vFe(),Ti(),Yae=3,SH=100});function xFe(l){return isNaN(l)?"NaN":fh(l)?l.toFixed(0):GP(l,3).toString()}var Kae,Zae,Np,Qae,$N,Jae,ele,tle,nle,rle,ile,sle,ole,HN,wH=C(()=>{bo(),Kae=z(Le()),Zae=z(Le()),Np=z(Le()),at(),GN(),Ti(),gH(),Yo(),$N=me.div(Qae||(Qae=$([`
  height: 100%;
  width: 100%;
  position: relative;
  z-index: 0;
  box-sizing: border-box;
  display: flex;
  align-items: center;

  &:after {
    position: absolute;
    inset: 1px 0 2px;
    display: block;
    content: ' ';
    background-color: transparent;
    border: 1px solid transparent;
    z-index: -2;
    box-sizing: border-box;
    border-radius: 1px;
  }

  &:hover,
  &.dragging,
  &.editingViaKeyboard {
    &:after {
      background-color: #10101042;
      border-color: #00000059;
    }
  }
`]))),ele=me.input(Jae||(Jae=$([`
  background: transparent;
  border: 1px solid transparent;
  color: rgba(255, 255, 255, 0.9);
  padding: 1px 6px;
  font: inherit;
  outline: none;
  cursor: ew-resize;
  text-align: left;
  width: 100%;
  height: calc(100% - 4px);
  border-radius: 2px;

  &:focus {
    cursor: text;
  }
`]))),nle=me.div(tle||(tle=$([`
  position: absolute;
  inset: 3px 2px 4px;
  transform: scale(var(--percentage), 1);
  transform-origin: top left;
  background-color: #2d5561;
  z-index: -1;
  border-radius: 2px;
  pointer-events: none;

  `,".dragging &, ",`.noFocus:hover & {
    background-color: #338198;
  }
`])),$N,$N),ile=me.div(rle||(rle=$([`
  display: contents;
`]))),sle=l=>!0,ole=l=>{var h;let[d]=vi({mode:"noFocus"}),g=(h=l.isValid)!=null?h:sle,_=(0,Np.useRef)(l);_.current=l;let b=(0,Np.useRef)(null);mH(b.current,()=>{b.current.blur()},d.current.mode==="editingViaKeyboard");let S=(0,Np.useRef)(null),E=(0,Np.useMemo)(()=>{let W=Ie=>{let _e=Ie.target,{value:Oe}=_e,ot=d.current;d.current=M(R({},ot),{currentEditedValueInString:Oe});let de=parseFloat(Oe);!isFinite(de)||!g(de)||_.current.temporarilySetValue(de)},X=()=>{d.current.mode==="editingViaKeyboard"&&(Z(),d.current={mode:"noFocus"}),l.onBlur&&l.onBlur()},Z=()=>{let Ie=d.current,_e=parseFloat(Ie.currentEditedValueInString);!isFinite(_e)||!g(_e)||Ie.valueBeforeEditing===_e?_.current.discardTemporaryValue():_.current.permanentlySetValue(_e)},te=Ie=>{Ie.key==="Escape"?(_.current.discardTemporaryValue(),d.current={mode:"noFocus"},b.current.blur()):(Ie.key==="Enter"||Ie.key==="Tab")&&(Z(),b.current.blur())},ae=Ie=>{d.current.mode==="noFocus"&&(b.current.focus(),Ie.preventDefault()),Ie.stopPropagation()},oe=()=>{d.current.mode==="noFocus"?ue():d.current.mode},ue=()=>{let Ie=_.current.value;d.current={mode:"editingViaKeyboard",currentEditedValueInString:String(Ie),valueBeforeEditing:Ie},setTimeout(()=>{b.current.focus(),b.current.setSelectionRange(0,100)})},Ee;return{inputChange:W,onBlur:X,transitionToDraggingMode:()=>{var Ie;let _e=_.current.value;Ee=(Ie=b.current)==null?void 0:Ie.getBoundingClientRect().width,d.current={mode:"dragging"};let Oe=_e,ot=_e;return S.current=document.body.style.cursor,{onDrag(de,Be,re,Ye){let nn=re.altKey?Ye/10:Ye,ke=ot+l.nudge({deltaX:nn,deltaFraction:nn/Ee,magnitude:1});ot=l.range?Ss(ke,l.range[0],l.range[1]):ke,_.current.temporarilySetValue(ot)},onDragEnd(de){de?(Oe===ot?_.current.discardTemporaryValue():_.current.permanentlySetValue(ot),d.current={mode:"noFocus"}):(_.current.discardTemporaryValue(),d.current={mode:"noFocus"})},onClick(){b.current.focus(),b.current.setSelectionRange(0,100)}}},onInputKeyDown:te,onClick:ae,onFocus:oe}},[]);(0,Kae.useEffect)(()=>()=>{E.onBlur()},[]);let N=d.current.mode!=="editingViaKeyboard"?xFe(l.value):d.current.currentEditedValueInString;typeof N=="number"&&isNaN(N)&&(N="NaN");let I=[b];l.inputRef&&I.push(l.inputRef);let B=Np.default.createElement(ele,{key:"input",type:"text",onChange:E.inputChange,value:N,onBlur:E.onBlur,onKeyDown:E.onInputKeyDown,onClick:E.onClick,onFocus:E.onFocus,ref:VN(I),onMouseDown:W=>{W.stopPropagation()},onDoubleClick:W=>{W.preventDefault(),W.stopPropagation()},autoFocus:l.autoFocus}),{range:V}=l,U=parseFloat(N),F=V?Np.default.createElement(nle,{style:{"--percentage":Ss((U-V[0])/(V[1]-V[0]),0,1)}}):null,[H,G]=(0,Zae.useState)(null);return eo(H,{debugName:"form/BasicNumberInput",onDragStart:E.transitionToDraggingMode,lockCSSCursorTo:"ew-resize",shouldPointerLock:!0,disabled:d.current.mode==="editingViaKeyboard"}),Np.default.createElement($N,{className:l.className+" "+d.current.mode},Np.default.createElement(ile,{ref:G},B),F)},HN=ole});function bFe({propConfig:l,editingTools:h,value:d,autoFocus:g}){let _=(0,TH.useCallback)(b=>l.nudgeFn(M(R({},b),{config:l})),[l]);return TH.default.createElement(HN,{value:d,temporarilySetValue:h.temporarilySetValue,discardTemporaryValue:h.discardTemporaryValue,permanentlySetValue:h.permanentlySetValue,range:l.range,nudge:_,autoFocus:g})}var TH,EH,ale=C(()=>{wH(),TH=z(Le()),EH=bFe});function SFe({value:l,onChange:h,options:d,autoFocus:g}){let _=(0,Jb.useCallback)(b=>{h(String(b.target.value))},[h]);return Jb.default.createElement(MH,{role:"radiogroup"},Object.keys(d).map((b,S)=>Jb.default.createElement(ule,{key:"label-"+S,"data-checked":l===b},d[b],Jb.default.createElement(dle,{type:"radio",checked:l===b,value:b,onChange:_,name:"switchbox",autoFocus:g}))))}var Jb,lle,MH,cle,ule,hle,dle,fle,wFe=C(()=>{Tc(),Jb=z(Le()),at(),MH=me.form(lle||(lle=$([`
  display: flex;
  flex-direction: row;
  align-items: stretch;
  vertical-align: middle;
  justify-content: stretch;
  height: 24px;
  width: 100%;
`]))),ule=me.label(cle||(cle=$([`
  padding: 0 0.5em;
  background: transparent;
  /* background: #373748; */
  display: flex;
  align-items: center;
  justify-content: center;
  flex-grow: 1;
  color: #a7a7a7;
  border: 1px solid transparent;
  box-sizing: border-box;
  border-right-width: 0px;

  & + &:last-child {
    border-right-width: 1px;
  }

  `,`:hover > & {
    border-color: #1c2123;
    /* background-color: #373748; */
    /* color: `,`; */
  }

  &&:hover {
    background-color: #464654;
  }

  &&[data-checked='true'] {
    color: white;
    background: #3f3f4c;
  }
`])),MH,Ub(.1,"white")),dle=me.input(hle||(hle=$([`
  position: absolute;
  opacity: 0;
  pointer-events: none;
  width: 0;
  height: 0;
`]))),fle=SFe}),TFe=C(()=>{}),CH,AH,RH,ple=C(()=>{CH=z(Le()),AH={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},RH=CH.default.createContext&&CH.default.createContext(AH)});function mle(l){return l&&l.map(function(h,d){return Tv.default.createElement(h.tag,Ip({key:d},h.attr),mle(h.child))})}function wv(l){return function(h){return Tv.default.createElement(EFe,Ip({attr:Ip({},l.attr)},h),mle(l.child))}}function EFe(l){var h=function(d){var g=l.attr,_=l.size,b=l.title,S=gle(l,["attr","size","title"]),E=_||d.size||"1em",N;return d.className&&(N=d.className),l.className&&(N=(N?N+" ":"")+l.className),Tv.default.createElement("svg",Ip({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},d.attr,g,S,{className:N,style:Ip(Ip({color:l.color||d.color},d.style),l.style),height:E,width:E,xmlns:"http://www.w3.org/2000/svg"}),b&&Tv.default.createElement("title",null,b),l.children)};return RH!==void 0?Tv.default.createElement(RH.Consumer,null,function(d){return h(d)}):h(AH)}var Tv,Ip,gle,MFe=C(()=>{Tv=z(Le()),ple(),Ip=function(){return Ip=Object.assign||function(l){for(var h,d=1,g=arguments.length;d<g;d++){h=arguments[d];for(var _ in h)Object.prototype.hasOwnProperty.call(h,_)&&(l[_]=h[_])}return l},Ip.apply(this,arguments)},gle=function(l,h){var d={};for(var g in l)Object.prototype.hasOwnProperty.call(l,g)&&h.indexOf(g)<0&&(d[g]=l[g]);if(l!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _=0,g=Object.getOwnPropertySymbols(l);_<g.length;_++)h.indexOf(g[_])<0&&Object.prototype.propertyIsEnumerable.call(l,g[_])&&(d[g[_]]=l[g[_]]);return d}}),No=C(()=>{TFe(),MFe(),ple()}),CFe=C(()=>{No()}),AFe=C(()=>{No()});function RFe(l){return wv({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}}]})(l)}var PFe=C(()=>{No()}),NFe=C(()=>{No()}),IFe=C(()=>{No()});function kFe(l){return wv({tag:"svg",attr:{viewBox:"0 0 8 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M5.5 3L7 4.5 3.25 8 7 11.5 5.5 13l-5-5 5-5z"}}]})(l)}function DFe(l){return wv({tag:"svg",attr:{viewBox:"0 0 8 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"}}]})(l)}var FFe=C(()=>{No()}),OFe=C(()=>{No()}),BFe=C(()=>{No()}),LFe=C(()=>{No()}),UFe=C(()=>{No()}),zFe=C(()=>{No()}),VFe=C(()=>{No()}),GFe=C(()=>{No()}),$Fe=C(()=>{No()}),HFe=C(()=>{No()});function yle(l){return wv({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"}}]})(l)}var jFe=C(()=>{No()}),WFe=C(()=>{No()}),qFe=C(()=>{No()}),XFe=C(()=>{No()});function YFe(l){return wv({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none"},child:[{tag:"path",attr:{d:"M6 9.65685L7.41421 11.0711L11.6569 6.82843L15.8995 11.0711L17.3137 9.65685L11.6569 4L6 9.65685Z",fill:"currentColor"}},{tag:"path",attr:{d:"M6 14.4433L7.41421 13.0291L11.6569 17.2717L15.8995 13.0291L17.3137 14.4433L11.6569 20.1001L6 14.4433Z",fill:"currentColor"}}]})(l)}var KFe=C(()=>{No()});function ZFe(l){return wv({tag:"svg",attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M14 10.44l-.413.56H2.393L2 10.46 7.627 5h.827L14 10.44z"}}]})(l)}var QFe=C(()=>{No()}),Ev=C(()=>{CFe(),AFe(),PFe(),NFe(),IFe(),FFe(),OFe(),BFe(),LFe(),UFe(),zFe(),VFe(),GFe(),$Fe(),HFe(),jFe(),WFe(),qFe(),XFe(),KFe(),QFe()});function JFe({value:l,onChange:h,options:d,className:g,autoFocus:_}){let b=(0,t9.useCallback)(S=>{h(String(S.target.value))},[h]);return t9.default.createElement(_le,null,t9.default.createElement(wle,{className:g,value:l,onChange:b,autoFocus:_},Object.keys(d).map((S,E)=>t9.default.createElement("option",{key:"option-"+E,value:S},d[S]))),t9.default.createElement(ble,null,t9.default.createElement(YFe,null)))}var t9,vle,_le,xle,ble,Sle,wle,Tle,eOe=C(()=>{t9=z(Le()),at(),Ev(),_le=me.div(vle||(vle=$([`
  width: 100%;
  position: relative;
`]))),ble=me.div(xle||(xle=$([`
  position: absolute;
  right: 0px;
  top: 0;
  bottom: 0;
  width: 1.5em;
  font-size: 14px;
  display: flex;
  align-items: center;
  color: #6b7280;
  pointer-events: none;
`]))),wle=me.select(Sle||(Sle=$([`
  appearance: none;
  background-color: transparent;
  box-sizing: border-box;
  border: 1px solid transparent;
  color: rgba(255, 255, 255, 0.85);
  padding: 1px 6px;
  font: inherit;
  outline: none;
  text-align: left;
  width: 100%;
  border-radius: 2px;
  /*
  looks like putting percentages in the height of a select box doesn't work in Firefox. Not sure why.
  So we're hard-coding the height to 26px, unlike all other inputs that use a relative height.
  */
  height: 26px /* calc(100% - 4px); */;

  @supports (-moz-appearance: none) {
    /* Ugly hack to remove the extra left padding that shows up only in Firefox */
    text-indent: -2px;
  }

  &:hover,
  &:focus {
    background-color: #10101042;
    border-color: #00000059;
  }
`]))),Tle=JFe});function tOe({propConfig:l,editingTools:h,value:d,autoFocus:g}){let _=(0,jN.useCallback)(b=>{h.permanentlySetValue(b)},[l,h]);return l.as==="menu"?jN.default.createElement(Tle,{value:d,onChange:_,options:l.valuesAndLabels,autoFocus:g}):jN.default.createElement(fle,{value:d,onChange:_,options:l.valuesAndLabels,autoFocus:g})}var jN,Ele,nOe=C(()=>{jN=z(Le()),wFe(),eOe(),Ele=tOe}),Mle,eS,Cle,Ale,Rle,Ple,WN,PH=C(()=>{at(),Mle=z(Le()),eS=z(Le()),GN(),Ti(),gH(),Ale=me.input.attrs({type:"text"})(Cle||(Cle=$([`
  background: transparent;
  border: 1px solid transparent;
  color: rgba(255, 255, 255, 0.9);
  padding: 1px 6px;
  font: inherit;
  outline: none;
  cursor: text;
  text-align: left;
  width: 100%;
  height: calc(100% - 4px);
  border-radius: 2px;
  border: 1px solid transparent;
  box-sizing: border-box;

  &:hover {
    background-color: #10101042;
    border-color: #00000059;
  }

  &:hover,
  &:focus {
    cursor: text;
    background-color: #10101042;
    border-color: #00000059;
  }

  &.invalid {
    border-color: red;
  }
`]))),Rle=l=>!0,Ple=l=>{var h,d;let[g]=vi({mode:"noFocus"}),_=(h=l.isValid)!=null?h:Rle,b=(0,eS.useRef)(l);b.current=l;let S=(0,eS.useRef)(null);mH(S.current,()=>{S.current.blur()},g.current.mode==="editingViaKeyboard");let E=(0,eS.useMemo)(()=>{let B=X=>{let Z=X.target,{value:te}=Z,ae=g.current;g.current=M(R({},ae),{currentEditedValueInString:te}),_(te)&&b.current.temporarilySetValue(te)},V=()=>{var X,Z;g.current.mode==="editingViaKeyboard"&&(U(),g.current={mode:"noFocus"}),(Z=(X=b.current).onBlur)==null||Z.call(X)},U=()=>{let X=g.current,Z=X.currentEditedValueInString;_(Z)?X.valueBeforeEditing===Z?b.current.discardTemporaryValue():b.current.permanentlySetValue(Z):b.current.discardTemporaryValue()},F=X=>{X.key==="Escape"?(b.current.discardTemporaryValue(),g.current={mode:"noFocus"},S.current.blur()):(X.key==="Enter"||X.key==="Tab")&&(U(),S.current.blur())},H=X=>{g.current.mode==="noFocus"&&(S.current.focus(),X.preventDefault()),X.stopPropagation()},G=()=>{g.current.mode==="noFocus"?W():g.current.mode},W=()=>{let X=b.current.value;g.current={mode:"editingViaKeyboard",currentEditedValueInString:String(X),valueBeforeEditing:X},setTimeout(()=>{S.current.focus()})};return{inputChange:B,onBlur:V,onInputKeyDown:F,onClick:H,onFocus:G}},[]);(0,Mle.useEffect)(()=>()=>{E.onBlur()},[]);let N=g.current.mode!=="editingViaKeyboard"?l.value:g.current.currentEditedValueInString,I=[S];return l.inputRef&&I.push(l.inputRef),eS.default.createElement(Ale,{key:"input",type:"text",className:"".concat((d=l.className)!=null?d:""," ").concat(_(N)?"":"invalid"),onChange:E.inputChange,value:N,onBlur:E.onBlur,onKeyDown:E.onInputKeyDown,onClick:E.onClick,onFocus:E.onFocus,ref:VN(I),onMouseDown:B=>{B.stopPropagation()},onDoubleClick:B=>{B.preventDefault(),B.stopPropagation()},autoFocus:l.autoFocus})},WN=Ple});function rOe({editingTools:l,value:h,autoFocus:d}){return Nle.default.createElement(WN,{value:h,temporarilySetValue:l.temporarilySetValue,discardTemporaryValue:l.discardTemporaryValue,permanentlySetValue:l.permanentlySetValue,autoFocus:d})}var Nle,Ile,iOe=C(()=>{Nle=z(Le()),PH(),Ile=rOe});function sOe(l){l=l.trim().toLowerCase();let h=l.match(kH);if(!h)return{r:0,g:0,b:0,a:1};let d=oOe(h[1]);return{r:parseInt(d.substr(0,2),16)/255,g:parseInt(d.substr(2,2),16)/255,b:parseInt(d.substr(4,2),16)/255,a:parseInt(d.substr(6,2),16)/255}}function NH(l,{removeAlphaIfOpaque:h=!1}={}){let d=(l.a*255|256).toString(16).slice(1),g=(l.r*255|256).toString(16).slice(1)+(l.g*255|256).toString(16).slice(1)+(l.b*255|256).toString(16).slice(1)+(h&&d==="ff"?"":d);return"#".concat(g)}function IH(l){return M(R({},l),{toString(){return NH(this,{removeAlphaIfOpaque:!0})}})}function oOe(l){switch(l.length){case 3:return"".concat(l.repeat(2),"ff");case 4:let h=l.substr(0,3),d=l[3];return"".concat(h.repeat(2)).concat(d.repeat(2));case 6:return"".concat(l,"ff")}return l}var kH,kle=C(()=>{kH=/^#*([0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/i});function qN(l){let h=(0,DH.useRef)(l),d=(0,DH.useRef)(g=>{h.current&&h.current(g)});return h.current=l,d.current}var DH,Dle=C(()=>{DH=z(Le())}),n9,XN=C(()=>{n9=(l,h=0,d=1)=>l>d?d:l<h?h:l}),tS,FH,Fle,OH,BH=C(()=>{tS=z(Le()),FH=(0,tS.createContext)(void 0),Fle=({children:l})=>{let[h,d]=(0,tS.useState)(!1);return tS.default.createElement(FH.Provider,{value:{editing:h,setEditing:d}},l)},OH=()=>(0,tS.useContext)(FH)}),Jm,Mv,Ole,YN,LH,UH,Ble,Lle,Ule,zle,nS,KN=C(()=>{Jm=z(Le()),Dle(),XN(),at(),BH(),Mv=l=>"touches"in l,Ole=(l,h)=>{for(let d=0;d<l.length;d++)if(l[d].identifier===h)return l[d];return l[0]},YN=l=>l&&l.ownerDocument.defaultView||self,LH=(l,h,d)=>{let g=l.getBoundingClientRect(),_=Mv(h)?Ole(h.touches,d):h;return{left:n9((_.pageX-(g.left+YN(l).pageXOffset))/g.width),top:n9((_.pageY-(g.top+YN(l).pageYOffset))/g.height)}},UH=l=>{!Mv(l)&&l.preventDefault()},Ble=(l,h)=>h&&!Mv(l),Ule=me.div(Lle||(Lle=$([`
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  border-radius: inherit;
  outline: none;
  /* Don't trigger the default scrolling behavior when the event is originating from this element */
  touch-action: none;
`]))),zle=l=>{var h=l,{onMove:d,onKey:g}=h,_=O(h,["onMove","onKey"]);let b=(0,Jm.useRef)(null),S=qN(d),E=qN(g),N=(0,Jm.useRef)(null),I=(0,Jm.useRef)(!1),{setEditing:B}=OH(),[V,U,F]=(0,Jm.useMemo)(()=>{let H=({nativeEvent:te})=>{let ae=b.current;if(ae&&(UH(te),!(Ble(te,I.current)||!ae))){if(Mv(te)){I.current=!0;let oe=te.changedTouches||[];oe.length&&(N.current=oe[0].identifier)}ae.focus(),B(!0),S(LH(ae,te,N.current)),Z(!0)}},G=te=>{UH(te),(Mv(te)?te.touches.length>0:te.buttons>0)&&b.current?S(LH(b.current,te,N.current)):(B(!1),Z(!1))},W=te=>{B(!1),Z(!1)},X=te=>{let ae=te.which||te.keyCode;ae<37||ae>40||(te.preventDefault(),E({left:ae===39?.05:ae===37?-.05:0,top:ae===40?.05:ae===38?-.05:0}))};function Z(te){let ae=I.current,oe=b.current,ue=YN(oe),Ee=te?ue.addEventListener:ue.removeEventListener;Ee(ae?"touchmove":"mousemove",G),Ee(ae?"touchend":"mouseup",W)}return[H,X,Z]},[E,S]);return(0,Jm.useEffect)(()=>F,[F]),Jm.default.createElement(Ule,M(R({},_),{onTouchStart:V,onMouseDown:V,ref:b,onKeyDown:U,tabIndex:0,role:"slider"}))},nS=Jm.default.memo(zle)}),zH,Vle,Gle,$le,Hle,jle,Wle,ZN,VH=C(()=>{zH=z(Le()),at(),KN(),Gle=me(nS)(Vle||(Vle=$([""]))),Hle=me.div($le||($le=$([`
  position: absolute;
  z-index: 1;
  box-sizing: border-box;
  width: 16px;
  height: 16px;
  transform: translate(-50%, -50%);
  background-color: #fff;
  border: 1px solid #ffffff00;
  border-radius: 2px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);

  `,`:focus & {
    transform: translate(-50%, -50%) scale(1.1);
  }
`])),Gle),Wle=me.div(jle||(jle=$([`
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  border-radius: inherit;
`]))),ZN=({className:l,color:h,left:d,top:g=.5})=>{let _={top:"".concat(g*100,"%"),left:"".concat(d*100,"%")};return zH.default.createElement(Hle,{style:_,className:l},zH.default.createElement(Wle,{style:{backgroundColor:h}}))}}),Ml,QN=C(()=>{Ml=(l,h=0,d=Math.pow(10,h))=>Math.round(d*l)/d}),GH,JN,eI,qle,Xle,tI=C(()=>{QN(),GH=({h:l,s:h,v:d,a:g})=>{let _=(200-h)*d/100;return{h:Ml(l),s:Ml(_>0&&_<200?h*d/100/(_<=100?_:200-_)*100:0),l:Ml(_/2),a:Ml(g,2)}},JN=l=>{let{h,s:d,l:g}=GH(l);return"hsl(".concat(h,", ").concat(d,"%, ").concat(g,"%)")},eI=l=>{let{h,s:d,l:g,a:_}=GH(l);return"hsla(".concat(h,", ").concat(d,"%, ").concat(g,"%, ").concat(_,")")},qle=({h:l,s:h,v:d,a:g})=>{l=l/360*6,h=h/100,d=d/100;let _=Math.floor(l),b=d*(1-h),S=d*(1-(l-_)*h),E=d*(1-(1-l+_)*h),N=_%6;return{r:Ml([d,S,b,b,E,d][N]*255),g:Ml([E,d,d,S,b,b][N]*255),b:Ml([b,b,E,d,d,S][N]*255),a:Ml(g,2)}},Xle=({r:l,g:h,b:d,a:g})=>{let _=Math.max(l,h,d),b=_-Math.min(l,h,d),S=b?_===l?(h-d)/b:_===h?2+(d-l)/b:4+(l-h)/b:0;return{h:Ml(60*(S<0?S+6:S)),s:Ml(_?b/_*100:0),v:Ml(_/255*100),a:g}}}),rS,Yle,Kle,Zle,Qle,Jle,e0e,aOe=C(()=>{rS=z(Le()),KN(),VH(),tI(),XN(),QN(),at(),Kle=me.div(Yle||(Yle=$([`
  position: relative;
  height: 16px;
  border-radius: 2px;

  background: linear-gradient(
    to right,
    #f00 0%,
    #ff0 17%,
    #0f0 33%,
    #0ff 50%,
    #00f 67%,
    #f0f 83%,
    #f00 100%
  );
`]))),Qle=me(ZN)(Zle||(Zle=$([`
  z-index: 2;
`]))),Jle=({className:l,hue:h,onChange:d})=>rS.default.createElement(Kle,{className:l},rS.default.createElement(nS,{onMove:g=>{d({h:360*g.left})},onKey:g=>{d({h:n9(h+g.left*360,0,360)})},"aria-label":"Hue","aria-valuetext":Ml(h)},rS.default.createElement(Qle,{left:h/360,color:JN({h,s:100,v:100,a:1})}))),e0e=rS.default.memo(Jle)}),iS,t0e,n0e,r0e,i0e,s0e,o0e,lOe=C(()=>{iS=z(Le()),KN(),VH(),tI(),XN(),QN(),at(),n0e=me.div(t0e||(t0e=$([`
  position: relative;
  flex-grow: 1;
  border-color: transparent; /* Fixes https://github.com/omgovich/react-colorful/issues/139 */
  border-bottom: 12px solid #000;
  border-radius: 2px;
  background-image: linear-gradient(to top, #000, rgba(0, 0, 0, 0)),
    linear-gradient(to right, #fff, rgba(255, 255, 255, 0));

  // Improve elements rendering on light backgrounds
  box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.05);
`]))),i0e=me(ZN)(r0e||(r0e=$([`
  z-index: 3;
`]))),s0e=({hsva:l,onChange:h})=>{let d=b=>{h({s:b.left*100,v:100-b.top*100})},g=b=>{h({s:n9(l.s+b.left*100,0,100),v:n9(l.v-b.top*100,0,100)})},_={backgroundColor:JN({h:l.h,s:100,v:100,a:1})};return iS.default.createElement(n0e,{style:_},iS.default.createElement(nS,{onMove:d,onKey:g,"aria-label":"Color","aria-valuetext":"Saturation ".concat(Ml(l.s),"%, Brightness ").concat(Ml(l.v),"%")},iS.default.createElement(i0e,{top:1-l.v/100,left:l.s/100,color:JN(l)})))},o0e=iS.default.memo(s0e)}),sS,a0e,l0e,c0e,u0e,h0e,d0e,f0e,cOe=C(()=>{sS=z(Le()),KN(),VH(),tI(),XN(),QN(),at(),l0e=me.div(a0e||(a0e=$([`
  position: relative;
  height: 16px;
  border-radius: 2px;
  // Checkerboard
  background-color: #fff;
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><rect x="8" width="8" height="8"/><rect y="8" width="8" height="8"/></svg>');
`]))),u0e=me.div.attrs(({colorFrom:l,colorTo:h})=>({style:{backgroundImage:"linear-gradient(90deg, ".concat(l,", ").concat(h,")")}}))(c0e||(c0e=$([`
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  border-radius: inherit;

  // Improve rendering on light backgrounds
  box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.05);
`]))),d0e=me(ZN)(h0e||(h0e=$([`
  // Checkerboard
  background-color: #fff;
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><rect x="8" width="8" height="8"/><rect y="8" width="8" height="8"/></svg>');
`]))),f0e=({className:l,hsva:h,onChange:d})=>{let g=E=>{d({a:E.left})},_=E=>{d({a:n9(h.a+E.left)})},b=eI(Object.assign({},h,{a:0})),S=eI(Object.assign({},h,{a:1}));return sS.default.createElement(l0e,{className:l},sS.default.createElement(u0e,{colorFrom:b,colorTo:S}),sS.default.createElement(nS,{onMove:g,onKey:_,"aria-label":"Alpha","aria-valuetext":"".concat(Ml(h.a*100),"%")},sS.default.createElement(d0e,{left:h.a,color:eI(h)})))}}),nI,p0e=C(()=>{nI=(l,h)=>{if(l===h)return!0;for(let d in l)if(l[d]!==h[d])return!1;return!0}});function uOe(l,h,d,g){let{editing:_}=OH(),[b,S]=(0,kp.useState)(h),E=qN(d),N=qN(g),I=_?b:h,[B,V]=(0,kp.useState)(()=>l.toHsva(I)),U=(0,kp.useRef)({color:I,hsva:B}),F=(0,kp.useRef)({color:I,hsva:B});(0,kp.useEffect)(()=>{_&&S(U.current.color)},[_]),(0,kp.useEffect)(()=>{let G=l.fromHsva(B);_?!nI(B,U.current.hsva)&&!l.equal(G,U.current.color)&&(U.current={hsva:B,color:G},S(G),E(G)):!nI(B,F.current.hsva)&&!l.equal(G,F.current.color)&&(F.current={hsva:B,color:G},U.current={hsva:B,color:G},N(G))},[_,B,l,E,N]),(0,kp.useEffect)(()=>{if(!_&&!l.equal(I,F.current.color)){let G=l.toHsva(I);F.current={hsva:G,color:I},V(G)}},[_,I,l]);let H=(0,kp.useCallback)(G=>{V(W=>Object.assign({},W,G))},[]);return[B,H]}var kp,hOe=C(()=>{kp=z(Le()),p0e(),Dle(),BH()}),Cv,m0e,g0e,y0e,dOe=C(()=>{Cv=z(Le()),aOe(),lOe(),cOe(),hOe(),at(),g0e=me.div(m0e||(m0e=$([`
  position: relative;
  display: flex;
  gap: 4px;
  flex-direction: column;
  width: 200px;
  height: 200px;
  user-select: none;
  cursor: default;
`]))),y0e=l=>{var h=l,{className:d,colorModel:g,color:_=g.defaultColor,temporarilySetValue:b,permanentlySetValue:S,discardTemporaryValue:E}=h,N=O(h,["className","colorModel","color","temporarilySetValue","permanentlySetValue","discardTemporaryValue"]);let[I,B]=uOe(g,_,b,S);return(0,Cv.useEffect)(()=>()=>{E()},[]),Cv.default.createElement(g0e,R({},N),Cv.default.createElement(o0e,{hsva:I,onChange:B}),Cv.default.createElement(e0e,{hue:I.h,onChange:B}),Cv.default.createElement(f0e,{hsva:I,onChange:B}))}}),$H,v0e,_0e,x0e,b0e,fOe=C(()=>{$H=z(Le()),dOe(),p0e(),tI(),BH(),v0e=l=>({r:l.r/255,g:l.g/255,b:l.b/255,a:l.a}),_0e=l=>({r:l.r*255,g:l.g*255,b:l.b*255,a:l.a}),x0e={defaultColor:{r:0,g:0,b:0,a:1},toHsva:l=>Xle(_0e(l)),fromHsva:l=>v0e(qle(l)),equal:nI},b0e=l=>$H.default.createElement(Fle,null,$H.default.createElement(y0e,M(R({},l),{permanentlySetValue:h=>{l.permanentlySetValue(h)},colorModel:x0e})))}),pOe=C(()=>{fOe()}),S0e,w0e,T0e,mOe=C(()=>{S0e=z(Le()),w0e=function(l){(0,S0e.useEffect)(l,[])},T0e=w0e}),E0e,M0e,C0e,gOe=C(()=>{E0e=z(Le()),mOe(),M0e=function(l){var h=(0,E0e.useRef)(l);h.current=l,T0e(function(){return function(){return h.current()}})},C0e=M0e}),rI,A0e,R0e,yOe=C(()=>{rI=z(Le()),gOe(),A0e=function(l){var h=(0,rI.useRef)(0),d=(0,rI.useState)(l),g=d[0],_=d[1],b=(0,rI.useCallback)(function(S){cancelAnimationFrame(h.current),h.current=requestAnimationFrame(function(){_(S)})},[]);return C0e(function(){cancelAnimationFrame(h.current)}),[g,b]},R0e=A0e});function vOe(l){for(var h=[],d=1;d<arguments.length;d++)h[d-1]=arguments[d];l&&l.addEventListener&&l.addEventListener.apply(l,h)}function _Oe(l){for(var h=[],d=1;d<arguments.length;d++)h[d-1]=arguments[d];l&&l.removeEventListener&&l.removeEventListener.apply(l,h)}var iI,xOe=C(()=>{iI=typeof window<"u"}),P0e,N0e,sI,HH=C(()=>{P0e=z(Le()),yOe(),xOe(),N0e=function(l,h){l===void 0&&(l=1/0),h===void 0&&(h=1/0);var d=R0e({width:iI?window.innerWidth:l,height:iI?window.innerHeight:h}),g=d[0],_=d[1];return(0,P0e.useEffect)(function(){if(iI){var b=function(){_({width:window.innerWidth,height:window.innerHeight})};return vOe(window,"resize",b),function(){_Oe(window,"resize",b)}}},[]),g},sI=N0e});function jH(l){let[h,d]=(0,WH.useState)(null);return(0,WH.useLayoutEffect)(()=>(l&&d(l.getBoundingClientRect()),()=>{d(null)}),[l]),h}var WH,I0e=C(()=>{WH=z(Le())}),k0e,D0e,qH,F0e=C(()=>{k0e=z(Le()),D0e=(0,k0e.createContext)({}),qH=D0e});function bOe(l,h,d){let g=l.getBoundingClientRect(),_=b=>{(b.clientX<g.left-h||b.clientX>g.left+g.width+h||b.clientY<g.top-h||b.clientY>g.top+g.height+h)&&d(b)};return window.addEventListener("mousemove",_),()=>{window.removeEventListener("mousemove",_)}}var SOe=C(()=>{}),O0e,oI,XH,B0e,YH,L0e=C(()=>{O0e=z(Le()),oI=z(Le()),HH(),I0e(),F0e(),Ti(),gH(),SOe(),vv(),bo(),XH=8,B0e=l=>{var h,d;let g=l.children(),[_,b]=vi(null),S=g.props.style?R({},g.props.style):{};S.position="absolute";let E=jH(b),N=jH(l.target),I=sI(),[B,V]=(0,oI.useState)({});return(0,oI.useLayoutEffect)(()=>{var U,F,H;if(!E||!b||!N)return;let G=(U=l.verticalGap)!=null?U:8,W={},X=(F=l.verticalPlacement)!=null?F:"bottom",Z=0,te=0;X==="bottom"?N.bottom+E.height+G<I.height?(X="bottom",Z=N.bottom+G,W.top="0px"):N.top>E.height+G?(X="top",Z=N.top-(E.height+G),W.bottom="0px",W.transform="rotateZ(180deg)"):X="overlay":X==="top"&&(N.top>E.height+G?(X="top",Z=N.top-(E.height+G),W.bottom="0px",W.transform="rotateZ(180deg)"):N.bottom+E.height+G<I.height?(X="bottom",Z=N.bottom+G,W.top="0px"):X="overlay");let ae=0;if(X!=="overlay"){let Oe=N.left+N.width/2;Oe<E.width/2?(te=G,ae=Math.max(Oe-G,XH)):Oe+E.width/2>I.width?(te=I.width-(G+E.width),ae=Math.min(Oe-te,E.width-XH)):(te=Oe-E.width/2,ae=E.width/2),W.left=ae+"px"}let{minX:oe=-1/0,maxX:ue=1/0,minY:Ee=-1/0,maxY:Ie=1/0}=(H=l.constraints)!=null?H:{},_e={left:Ss(te,oe,ue-E.width),top:Ss(Z,Ee,Ie+E.height)};if(b.style.left=_e.left+"px",b.style.top=_e.top+"px",V(W),l.onPointerOutside)return bOe(b,l.onPointerOutside.threshold,l.onPointerOutside.callback)},[E,b,l.target,N,I,l.onPointerOutside]),mH([b,(h=l.target)!=null?h:null],(d=l.onClickOutside)!=null?d:wh),O0e.default.createElement(qH.Provider,{value:B},(0,oI.cloneElement)(g,{ref:_,style:S}))},YH=B0e});function Xd(l,h){let d=(...F)=>{},{isPointerBeingCaptured:g}=qae("usePopover"),[_,b]=vi({isOpen:!1}),S=(0,Cl.useRef)(l),E=(0,Cl.useCallback)(F=>{_.current={isOpen:!1}},[]),N=(0,Cl.useCallback)((F,H)=>{var G;let W=typeof S.current=="function"?S.current():S.current;function X(){B.childHasFocusRef.current||W.closeOnClickOutside!==!1&&E("clicked outside popover")}_.current={isOpen:!0,clickPoint:{clientX:F.clientX,clientY:F.clientY},target:H,opts:W,onClickOutside:X,onPointerOutside:W.closeWhenPointerIsDistant===!1?void 0:{threshold:(G=W.pointerDistanceThreshold)!=null?G:100,callback:()=>{B.childHasFocusRef.current||g()||E("pointer outside")}}}},[]),I=(0,Cl.useCallback)((...F)=>{_.current.isOpen?E("toggled"):N(...F)},[]),B=wOe({_debug:d,state:b}),[,V]=(0,Cl.useContext)(kS);(0,Cl.useEffect)(()=>{let F;return b.isOpen&&(F=V()),()=>F==null?void 0:F()},[b.isOpen]);let U=(0,Cl.useContext)(mv);return{node:b.isOpen?(0,U0e.createPortal)(Cl.default.createElement(KH.Provider,{value:B.childPopoverLock},Cl.default.createElement(YH,{children:h,target:b.target,onClickOutside:b.onClickOutside,onPointerOutside:b.onPointerOutside,constraints:b.opts.constraints,verticalGap:b.opts.verticalGap})),U):Cl.default.createElement(Cl.default.Fragment,null),open:N,close:E,toggle:I,isOpen:b.isOpen}}function wOe(l){let h=(0,Cl.useContext)(KH);(0,Cl.useEffect)(()=>{if(l.state.isOpen){let g=h.takeFocus();return l._debug("take focus"),()=>{l._debug("release focus"),g.releaseFocus()}}},[l.state.isOpen]);let d=(0,Cl.useRef)(!1);return{childHasFocusRef:d,childPopoverLock:{takeFocus(){return d.current=!0,{releaseFocus(){d.current=!1}}}}}}var Cl,U0e,KH,Yd=C(()=>{xH(),Ti(),Cl=z(Le()),U0e=z(gu()),e9(),L0e(),Uj(),KH=Cl.default.createContext({takeFocus(){return{releaseFocus(){}}}})}),Dp,z0e,V0e,G0e,$0e,H0e,j0e,W0e,q0e,X0e,Y0e,K0e,Z0e,TOe=C(()=>{Dp=z(Le()),at(),F0e(),V0e=me.div(z0e||(z0e=$([`
  position: absolute;
  width: 0;
  height: 0;
  color: var(--popover-arrow-color);
  pointer-events: none;
`]))),$0e=me.div(G0e||(G0e=$([`
  width: 12px;
  height: 8px;
  position: absolute;
  left: -7px;
  top: -8px;
  text-align: center;
  line-height: 0;
`]))),j0e=me.path(H0e||(H0e=$([`
  fill: var(--popover-bg);
`]))),q0e=me.path(W0e||(W0e=$([`
  fill: var(--popover-inner-stroke);
`]))),Y0e=me.path(X0e||(X0e=$([`
  fill: var(--popover-outer-stroke);
`]))),K0e=(0,Dp.forwardRef)(({className:l},h)=>{let d=(0,Dp.useContext)(qH);return Dp.default.createElement(V0e,{className:l,ref:h,style:R({},d)},Dp.default.createElement($0e,null,Dp.default.createElement("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Dp.default.createElement(Y0e,{d:"M6 0L0 6H12L6 0Z"}),Dp.default.createElement(q0e,{d:"M6 1.5L0 7.5H12L6 1.5Z"}),Dp.default.createElement(j0e,{d:"M6 3L0 9H12L6 3Z"}))))}),Z0e=K0e}),aI,ZH,Q0e,J0e,ece,Kd,Zd=C(()=>{Ei(),Tc(),aI=z(Le()),at(),TOe(),ZH=Sh(.05,"#2a2a31"),J0e=me.div(Q0e||(Q0e=$([`
  position: absolute;
  --popover-bg: `,`;
  --popover-inner-stroke: #505159;
  --popover-outer-stroke: #111;

  background: var(--popover-bg);

  color: white;
  padding: 0;
  margin: 0;
  cursor: default;
  `,`;
  border-radius: 3px;
  z-index: 10000;
  border: 1px solid var(--popover-inner-stroke);
  box-shadow: 0 0 0 1px var(--popover-outer-stroke), 0 6px 8px -4px black;
  backdrop-filter: blur(8px);

  & a {
    color: inherit;
  }
`])),ZH,Si),ece=aI.default.forwardRef(({children:l,className:h,showPopoverEdgeTriangle:d=!0},g)=>aI.default.createElement(J0e,{className:h,ref:g},d?aI.default.createElement(Z0e,null):void 0,l)),Kd=ece});function EOe({editingTools:l,value:h,autoFocus:d}){let g=(0,Qd.useRef)(null),_=(0,Qd.useCallback)(S=>{let E=IH(sOe(S));l.permanentlySetValue(E)},[l]),b=Xd({debugName:"RgbaPropEditor"},()=>Qd.default.createElement(lce,null,Qd.default.createElement(b0e,{color:{r:h.r,g:h.g,b:h.b,a:h.a},temporarilySetValue:S=>{let E=IH(S);l.temporarilySetValue(E)},permanentlySetValue:S=>{let E=IH(S);l.permanentlySetValue(E)},discardTemporaryValue:l.discardTemporaryValue})));return Qd.default.createElement(Qd.default.Fragment,null,Qd.default.createElement(nce,null,Qd.default.createElement(ice,{rgbaColor:h,ref:g,onClick:S=>{b.toggle(S,g.current)}}),Qd.default.createElement(oce,{value:NH(h,{removeAlphaIfOpaque:!0}),temporarilySetValue:QH,discardTemporaryValue:QH,permanentlySetValue:_,isValid:S=>!!S.match(kH),autoFocus:d})),b.node)}var Qd,tce,nce,rce,ice,sce,oce,QH,ace,lce,cce,MOe=C(()=>{kle(),kle(),Qd=z(Le()),pOe(),at(),Yd(),PH(),Zd(),nce=me.div(tce||(tce=$([`
  display: flex;
  align-items: center;
  height: 100%;
  gap: 4px;
`]))),ice=me.div.attrs(l=>({style:{background:NH(l.rgbaColor)}}))(rce||(rce=$([`
  height: 18px;
  aspect-ratio: 1;
  border-radius: 99999px;
`]))),oce=me(WN)(sce||(sce=$([`
  flex: 1;
`]))),QH=()=>{},lce=me.div(ace||(ace=$([`
  position: absolute;
  background-color: `,`;
  color: white;
  margin: 0;
  cursor: default;
  border-radius: 3px;
  z-index: 10000;
  backdrop-filter: blur(8px);

  padding: 4px;
  pointer-events: all;

  border: none;
  box-shadow: none;
`])),ZH),cce=EOe});function COe({propConfig:l,editingTools:h,value:d,autoFocus:g}){let[_,b]=Eh.default.useState();(0,Eh.useEffect)(()=>{b(d?h.getAssetUrl(d):void 0)},[d]);let S=(0,Eh.useCallback)(N=>he(this,null,function*(){let I=N.target.files[0];h.permanentlySetValue({type:"image",id:void 0});let B=yield h.createAsset(I);B?h.permanentlySetValue({type:"image",id:B}):h.permanentlySetValue(d),N.target.value=null}),[h,d]),E=!(d!=null&&d.id);return Eh.default.createElement(JH,{empty:E},Eh.default.createElement(gce,{empty:E,title:E?"Upload image":'"'.concat(d.id,'" (Click to upload new image)')},Eh.default.createElement(vce,{type:"file",onChange:S,accept:"image/*,.hdr",autoFocus:g}),_?Eh.default.createElement(xce,{src:_}):Eh.default.createElement(dce,null)),!E&&Eh.default.createElement(Sce,{title:"Delete image",onClick:()=>{h.permanentlySetValue({type:"image",id:void 0})}},Eh.default.createElement(oH,null)))}var Eh,uce,JH,hce,dce,fce,pce,mce,gce,yce,vce,_ce,xce,bce,Sce,wce,AOe=C(()=>{qb(),Eh=z(Le()),at(),JH=me.div(uce||(uce=$([`
  display: flex;
  align-items: center;
  height: 100%;
  gap: 4px;
`]))),dce=me.div(hce||(hce=$([`
  position: absolute;
  inset: -5px;
  // rotate 45deg
  transform: rotate(45deg);
  --checker-color: #ededed36;
  &:hover {
    --checker-color: #ededed77;
  }
  // checkerboard background with 4px squares
  background-image: linear-gradient(
      45deg,
      var(--checker-color) 25%,
      transparent 25%
    ),
    linear-gradient(-45deg, var(--checker-color) 25%, transparent 25%),
    linear-gradient(45deg, transparent 75%, var(--checker-color) 75%),
    linear-gradient(-45deg, transparent 75%, var(--checker-color) 75%);
  background-size: 5px 5px;
`]))),gce=me.label(mce||(mce=$([`
  position: relative;
  cursor: default;
  box-sizing: border-box;

  height: 18px;
  aspect-ratio: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 16px;

  overflow: hidden;
  color: #ccc;
  &:hover {
    color: white;
  }

  border-radius: 99999px;
  border: 1px solid hwb(220deg 40% 52%);
  &:hover {
    border-color: hwb(220deg 45% 52%);
  }

  `,`
`])),l=>l.empty?Qa(fce||(fce=$([""]))):Qa(pce||(pce=$([""])))),vce=me.input.attrs({type:"file"})(yce||(yce=$([`
  display: none;
`]))),xce=me.img(_ce||(_ce=$([`
  position: absolute;
  inset: 0;
  height: 100%;
  aspect-ratio: 1;

  object-fit: cover;
`]))),Sce=me.button(bce||(bce=$([`
  display: flex;
  align-items: center;
  justify-content: center;
  outline: none;
  background: transparent;
  color: #a8a8a9;

  border: none;
  height: 100%;
  aspect-ratio: 1/1;

  opacity: 0;

  `,`:hover & {
    opacity: 0.8;
  }

  &:hover {
    opacity: 1;
    color: white;
  }
`])),JH),wce=COe});function ROe({propConfig:l,editingTools:h,value:d,autoFocus:g}){let[_,b]=Mh.default.useState();(0,Mh.useEffect)(()=>{b(d?h.getAssetUrl(d):void 0)},[d]);let S=(0,Mh.useCallback)(N=>he(this,null,function*(){let I=N.target.files[0];h.permanentlySetValue({type:"file",id:void 0});let B=yield h.createAsset(I);B?h.permanentlySetValue({type:"file",id:B}):h.permanentlySetValue(d),N.target.value=null}),[h,d]),E=!(d!=null&&d.id);return Mh.default.createElement(ej,{empty:E},Mh.default.createElement(Pce,{empty:E,title:E?"Upload file":'"'.concat(d.id,'" (Click to upload new file)')},Mh.default.createElement(Ice,{type:"file",onChange:S,autoFocus:g}),_?Mh.default.createElement(rH,null):Mh.default.createElement(Mce,null)),!E&&Mh.default.createElement(Dce,{title:"Delete file",onClick:()=>{h.permanentlySetValue({type:"file",id:void 0})}},Mh.default.createElement(oH,null)))}var Mh,Tce,ej,Ece,Mce,Cce,Ace,Rce,Pce,Nce,Ice,kce,Dce,Fce,POe=C(()=>{qb(),Mh=z(Le()),at(),ej=me.div(Tce||(Tce=$([`
  display: flex;
  align-items: center;
  height: 100%;
  gap: 4px;
`]))),Mce=me.div(Ece||(Ece=$([`
  position: absolute;
  inset: -5px;
  // rotate 45deg
  transform: rotate(45deg);
  --checker-color: #ededed36;
  &:hover {
    --checker-color: #ededed77;
  }
  // checkerboard background with 4px squares
  background-image: linear-gradient(
      45deg,
      var(--checker-color) 25%,
      transparent 25%
    ),
    linear-gradient(-45deg, var(--checker-color) 25%, transparent 25%),
    linear-gradient(45deg, transparent 75%, var(--checker-color) 75%),
    linear-gradient(-45deg, transparent 75%, var(--checker-color) 75%);
  background-size: 5px 5px;
`]))),Pce=me.label(Rce||(Rce=$([`
  position: relative;
  cursor: default;
  box-sizing: border-box;

  height: 18px;
  aspect-ratio: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 16px;

  overflow: hidden;
  color: #ccc;
  &:hover {
    color: white;
  }

  border-radius: 99999px;
  border: 1px solid hwb(220deg 40% 52%);
  &:hover {
    border-color: hwb(220deg 45% 52%);
  }

  `,`
`])),l=>l.empty?Qa(Cce||(Cce=$([""]))):Qa(Ace||(Ace=$([""])))),Ice=me.input.attrs({type:"file"})(Nce||(Nce=$([`
  display: none;
`]))),Dce=me.button(kce||(kce=$([`
  display: flex;
  align-items: center;
  justify-content: center;
  outline: none;
  background: transparent;
  color: #a8a8a9;

  border: none;
  height: 100%;
  aspect-ratio: 1/1;

  opacity: 0;

  `,`:hover & {
    opacity: 0.8;
  }

  &:hover {
    opacity: 1;
    color: white;
  }
`])),ej),Fce=ROe}),tj,Oce=C(()=>{mFe(),ale(),nOe(),iOe(),MOe(),AOe(),POe(),tj={number:EH,string:Ile,boolean:Bae,stringLiteral:Ele,rgba:cce,image:wce,file:Fce}});function oS(l){let h=new WeakMap;return d=>(h.has(d)||h.set(d,l(d)),h.get(d))}var lI=C(()=>{});function Jd(l){return l.type==="compound"||l.type==="enum"}function cI(l,h){if(!l)return;let[d,...g]=h;if(d===void 0)return l;if(!Jd(l))return;let _=l.type==="enum"?l.cases[d]:l.props[d];return cI(_,g)}function uI(l,h){let d=h.deserializeAndSanitize(l);return d===void 0?h.default:d}function NOe(l){return!Jd(l)}function*aS(l,h){if(l.type==="compound")for(let d in l.props)yield*Pe(aS(l.props[d],[...h,d]));else{if(l.type==="enum")throw new Error("Not implemented yet");return yield{path:h,conf:l}}}var nj,eg=C(()=>{lI(),nj=oS(l=>{if(l.type==="enum")throw new Error("Not implemented yet for enums");for(let h in l.props){let d=l.props[h];if(Jd(d)){if(nj(d))return!0}else return!0}return!1})}),rj,Bce=C(()=>{rj="calc(var(--left-pad) + var(--depth) * var(--step))"}),Lce,tg,r9=C(()=>{at(),tg=Qa(Lce||(Lce=$([`
  font-weight: 300;
  font-size: 11px;
  color: `,`;
  text-shadow: 0.5px 0.5px 2px rgba(0, 0, 0, 0.3);
`])),l=>l.isHighlighted==="self"?"#CCC":"#919191")}),lS,hI,Uce,zce,Vce,Gce,$ce,Hce,jce=C(()=>{vv(),lS=z(Le()),at(),hI=26,zce=me.li(Uce||(Uce=$([`
  height: `,`px;
  padding: 0 12px;
  margin: 0;
  display: flex;
  align-items: center;
  font-size: 11px;
  font-weight: 400;
  position: relative;
  color: `,`;
  cursor: `,`;

  &:after {
    position: absolute;
    inset: 2px 1px;
    display: block;
    content: ' ';
    pointer-events: none;
    z-index: -1;
    border-radius: 3px;
  }

  &:hover:after {
    background-color: `,`;
  }
`])),hI,l=>l.enabled?"white":"#8f8f8f",l=>l.enabled?"normal":"not-allowed",l=>l.enabled?"rgba(63, 174, 191, 0.75)":"initial"),Gce=me.span(Vce||(Vce=$([""]))),$ce=l=>lS.default.createElement(zce,{onClick:l.enabled?l.onClick:wh,enabled:l.enabled,title:l.enabled?void 0:"Disabled"},lS.default.createElement(Gce,null,lS.default.createElement(lS.default.Fragment,null,l.label))),Hce=$ce});function IOe(l){let h=(0,ij.useRef)(l);h.current=l,(0,ij.useEffect)(()=>{let d=g=>h.current(g);return window.addEventListener("keydown",d),()=>{window.removeEventListener("keydown",d)}},[])}var ij,kOe=C(()=>{ij=z(Le())}),cS,Wce,qce,Xce,Yce,Kce,Zce,Qce,sj,Jce=C(()=>{cS=z(Le()),jce(),at(),Tc(),Ei(),Wce=190,qce=!0,Yce=me.ul(Xce||(Xce=$([`
  position: absolute;
  min-width: `,`px;
  z-index: 10000;
  background: `,`;
  backdrop-filter: blur(2px);
  color: white;
  list-style-type: none;
  padding: 2px 0;
  margin: 0;
  border-radius: 1px;
  cursor: default;
  `,`;
  border-radius: 3px;
`])),Wce,Sh(.2,"#111"),Si),Zce=me.div(Kce||(Kce=$([`
  padding: 4px 10px;
  border-bottom: 1px solid #6262626d;
  color: #adadadb3;
  font-size: 11px;
  font-weight: 500;
`]))),Qce=cS.default.forwardRef((l,h)=>cS.default.createElement(Yce,{ref:h},qce&&l.displayName?cS.default.createElement(Zce,null,l.displayName):null,l.items.map((d,g)=>cS.default.createElement(Hce,{key:"item-".concat(g),label:d.label,enabled:d.enabled!==!1,onClick:_=>{d.callback&&d.callback(_),l.onRequestClose()}})))),sj=Qce}),eue,tue,dI,nue,uS,rue,iue,DOe=C(()=>{I0e(),eue=z(Le()),tue=z(Le()),dI=z(Le()),nue=z(gu()),HH(),jce(),e9(),kOe(),Jce(),uS=20,rue=l=>{let[h,d]=(0,dI.useState)(null),g=jH(h),_=sI();(0,dI.useLayoutEffect)(()=>{if(!g||!h)return;let E={left:g.width/2,top:hI/2+(l.displayName?hI:0)},N={left:l.clickPoint.clientX-E.left,top:l.clickPoint.clientY-E.top};N.left<0?N.left=0:N.left+g.width>_.width&&(N.left=_.width-g.width),N.top<0?N.top=0:N.top+g.height>_.height&&(N.top=_.height-g.height),h.style.left=N.left+"px",h.style.top=N.top+"px";let I=B=>{(B.clientX<N.left-uS||B.clientX>N.left+g.width+uS||B.clientY<N.top-uS||B.clientY>N.top+g.height+uS)&&l.onRequestClose()};return window.addEventListener("mousemove",I),()=>{window.removeEventListener("mousemove",I)}},[g,h,l.clickPoint,_,l.onRequestClose]);let b=(0,tue.useContext)(mv);IOe(E=>{E.key==="Escape"&&l.onRequestClose()});let S=(0,eue.useMemo)(()=>{let E=Array.isArray(l.items)?l.items:l.items();return E.length>0?E:[{label:l.displayName?"No actions for ".concat(l.displayName):"No actions found",enabled:!1}]},[l.items]);return(0,nue.createPortal)(dI.default.createElement(sj,{items:S,onRequestClose:l.onRequestClose,displayName:l.displayName,ref:d}),b)},iue=rue}),fI,sue,oue,FOe=C(()=>{fI=z(Le()),sue=(l,h)=>{let[d,g]=(0,fI.useState)({isOpen:!1}),_=(0,fI.useCallback)(()=>g({isOpen:!1}),[]);return(0,fI.useEffect)(()=>{if(!l||h.disabled===!0){g({isOpen:!1});return}let b=S=>{g({isOpen:!0,event:S}),S.preventDefault(),S.stopPropagation()};return l.addEventListener("contextmenu",b),()=>{l.removeEventListener("contextmenu",b)}},[l,h.disabled]),[d,_]},oue=sue});function c0(l,h){let[d,g]=oue(l,h),[,_]=(0,Av.useContext)(kS);return(0,Av.useEffect)(()=>{var b;let S;return d.isOpen&&((b=h.onOpen)==null||b.call(h),S=_()),()=>S==null?void 0:S()},[d.isOpen,h.onOpen]),[d.isOpen?Av.default.createElement(iue,{items:h.menuItems,displayName:h.displayName,clickPoint:d.event,onRequestClose:g}):aue,g,d.isOpen]}var Av,aue,u0=C(()=>{Av=z(Le()),DOe(),FOe(),Uj(),aue=Av.default.createElement(Av.default.Fragment,null)});function ng(l,h){return h.length===0?l:pp(l,h)}var pI=C(()=>{mp()});function lue(l,h){return l==null?null:l instanceof Element&&l.matches(h)?l:lue(l.parentElement,h)}var OOe=C(()=>{});function hS(l,h){let d=l;for(let g of h)d=d[g];return d}var mI=C(()=>{});function BOe(l){let h=new gI.Atom(void 0),d=new gI.Atom({}),g=new gI.Atom({}),_=0;return{addRelatedFlags(b,S){let E=String(++_),N=S.map(I=>{let B={flag:I.flag},V=[I.affects,b,E];return g.setByPointer(U=>hS(U,V),B),V});return()=>{for(let I of N)g.setByPointer(B=>hS(B,I),void 0)}},usePresenceFlag(b){if(!l.enabled)return;let S=(0,dS.useMemo)(()=>{if(!b)return aj;let E=h.prism,N=(0,fS.pointerToPrism)(d.pointer[b]),I=(0,fS.pointerToPrism)(g.pointer[b]);return(0,fS.prism)(()=>{if(N.getValue())return 2;{let B=I.getValue(),V=E.getValue(),U=B&&V&&B[V];if(U){let F;for(let H of Object.values(U))H&&(F&&F>=H.flag||(F=H.flag));return F}return}})},[b]);return j3(S)},setUserHover(b){let S=h.get();S!==b&&(S&&d.setByPointer(E=>E[S],!1),h.set(b),b&&d.setByPointer(E=>E[b],!0))}}}function i9(l){let h=dS.default.useContext(lj),d=h.usePresenceFlag(l);return{attrs:{[yI]:l},flag:d,useRelations(g,_){(0,oj.useEffect)(()=>l&&h.addRelatedFlags(l,g()),[l,..._])}}}function cue(l){let h=dS.default.useContext(lj),d=Zm("PresenceListeners");(0,oj.useEffect)(()=>{let g;if(!l)return;let _=b=>{if(b.target instanceof Node){let S=lue(b.target,"[".concat(yI,"]"));if(S){let E=S.getAttribute(yI);g!==E&&(g=E,h.setUserHover(E||void 0),d._debug("Updated current hover",{itemKey:E}));return}g!=null&&(g=null,h.setUserHover(void 0),d._debug("Cleared current hover"))}};return l.addEventListener("mouseover",_),()=>{l.removeEventListener("mouseover",_),g!=null&&(g=null,d._debug("Cleared current hover as part of cleanup"))}},[l,h])}var dS,oj,fS,gI,aj,lj,yI,s9=C(()=>{dS=z(Le()),oj=z(Le()),Qm(),fS=Jt,gI=Jt,Qn(),OOe(),mI(),aj=(0,fS.prism)(()=>{}),aj.keepHot(),lj=dS.default.createContext(BOe({enabled:!1})),yI="data-pi-key"}),Ja,uue,pS,hue,cj,rg,due,uj,fue,pue,mue,vI,gue,yue,vue,_ue,xue,bue,mS,Sue,hj,_I=C(()=>{Ei(),Tc(),Ja=z(Le()),at(),s9(),pS=me.div(uue||(uue=$([`
  display: flex;
  justify-content: center;
  align-items: center;
  width: 16px;
  margin: 0 0px 0 2px;
  position: relative;
  z-index: 0;
  opacity: 0.7;

  &:after {
    position: absolute;
    left: -14px;
    right: -14px;
    top: -2px;
    bottom: -2px;
    content: ' ';
    display: none;
    z-index: -1;
    background: `,`;
  }

  &:hover {
    opacity: 1;
    &:after {
      display: block;
    }
  }
`])),Sh(.2,"black")),cj=me.div(hue||(hue=$([`
  background: none;
  position: relative;
  border: 0;
  transition: transform 0.1s ease-out;
  z-index: 0;
  outline: none;
  cursor: pointer;

  &:after {
    display: none;
    `,`:hover & {
      display: block;
    }
    position: absolute;
    left: -4px;
    right: -4px;
    top: -4px;
    bottom: -4px;
    content: ' ';
    z-index: -1;
  }
`])),pS),rg={offColor:"#555",onColor:"#e0c917"},uj=me(cj)(due||(due=$([`
  &:hover {
    color: #e0c917;
  }

  color: `,`;
`])),l=>l.presence===2?"white":l.isOn?rg.onColor:rg.offColor),pue=Qa(fue||(fue=$([`
  pointer-events: none !important;
`]))),vI=me(cj)(mue||(mue=$([`
  color: `,`;

  `,`;
`])),l=>l.flag===2?"white":l.available?rg.onColor:rg.offColor,l=>l.available?Si:pue),yue=me(vI)(gue||(gue=$([`
  transform: translateX(2px);
  `,`:hover & {
    transform: translateX(-7px);
  }
`])),pS),_ue=me(vI)(vue||(vue=$([`
  transform: translateX(-2px);
  `,`:hover & {
    transform: translateX(7px);
  }
`])),pS),(l=>{let h=me.g(xue||(xue=$([`
    stroke-width: 1;
    `,`:hover & path {
      stroke-width: 3;
    }
  `])),vI);l.Prev=()=>Ja.default.createElement("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ja.default.createElement(h,{transform:"translate(6 3)"},Ja.default.createElement("path",{d:"M4 1L1 4L4 7",stroke:"currentColor"}))),l.Next=()=>Ja.default.createElement("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ja.default.createElement(h,{transform:"translate(1 3)"},Ja.default.createElement("path",{d:"M1 1L4 4L1 7",stroke:"currentColor"})));let d=me.g(bue||(bue=$([`
    stroke-width: 0;
    `,`:hover & path {
      stroke: currentColor;
      stroke-width: 2;
    }
  `])),uj);l.Cur=()=>Ja.default.createElement("svg",{width:"8",height:"12",viewBox:"0 0 8 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ja.default.createElement(d,{transform:"translate(1 4)"},Ja.default.createElement("path",{d:"M3 0L6 3L3 6L0 3L3 0Z",fill:"currentColor"})))})(mS||(mS={})),Sue=l=>{var h,d,g,_,b;let S=i9((h=l.prev)==null?void 0:h.itemKey),E=i9(((d=l.cur)==null?void 0:d.type)==="on"?l.cur.itemKey:void 0),N=i9((g=l.next)==null?void 0:g.itemKey);return Ja.default.createElement(pS,null,Ja.default.createElement(yue,R({available:!!l.prev,onClick:(_=l.prev)==null?void 0:_.jump,flag:S.flag},S.attrs),Ja.default.createElement(mS.Prev,null)),Ja.default.createElement(uj,R({isOn:l.cur.type==="on",onClick:l.cur.toggle,presence:E.flag},E.attrs),Ja.default.createElement(mS.Cur,null)),Ja.default.createElement(_ue,R({available:!!l.next,onClick:(b=l.next)==null?void 0:b.jump,flag:N.flag},N.attrs),Ja.default.createElement(mS.Next,null)))},hj=Sue}),xI,gS,wue,Tue,Eue,Mue,Cue,Aue,Rue,yS,Pue=C(()=>{Tc(),xI=z(Le()),at(),Fe(),_I(),eg(),gS={defaultState:{color:Sh(.95,"#C4C4C4"),hoverColor:Sh(.15,rg.onColor)},withStaticOverride:{color:Sh(.85,"#C4C4C4"),hoverColor:Sh(.15,rg.onColor)}},Tue=me.div(wue||(wue=$([`
  width: 16px;
  margin: 0 0px 0 2px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;

  color: `,`;

  &:hover {
    color: `,`;
  }
`])),l=>l.hasStaticOverride?gS.withStaticOverride.color:gS.defaultState.color,l=>l.hasStaticOverride?gS.withStaticOverride.hoverColor:gS.defaultState.hoverColor),Mue=me.div(Eue||(Eue=$([`
  width: 5px;
  height: 5px;
  border-radius: 1px;
  transform: rotate(45deg);
  /* border: 1px solid currentColor; */
  background-color: currentColor;
`]))),Aue=me.div(Cue||(Cue=$([`
  width: 5px;
  height: 5px;
  background-color: currentColor;
  border-radius: 1px;
  transform: rotate(45deg);
`]))),Rue=l=>{let{hasStaticOverride:h,obj:d,propConfig:g,pathToProp:_}=l;return xI.default.createElement(Tue,{hasStaticOverride:h,onClick:()=>{ge().transaction(({stateEditors:b})=>{for(let{path:S,conf:E}of aS(g,_)){if(Jd(E))continue;let N=M(R({},d.address),{pathToProp:S});b.coreByProject.historic.sheetsById.sequence.setPrimitivePropAsSequenced(N,g)}})},title:"Sequence this prop"},h?xI.default.createElement(Aue,{title:"The default value is overridden"}):xI.default.createElement(Mue,{title:"This is the default value for this prop"}))},yS=Rue});function vS(l){return JSON.stringify(dj(l))}function dj(l){return Ud(l)?Object.keys(l).sort().reduce((h,d)=>(h[d]=dj(l[d]),h),{}):Array.isArray(l)?l.map(dj):l}var LOe=C(()=>{bo()}),Nue,_S,Iue=C(()=>{Nue="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",_S=(l=21)=>{let h="",d=l;for(;d--;)h+=Nue[Math.random()*64|0];return h}});function kue(){return _S(10)}function UOe(){return _S(10)}function zOe(){return _S(10)}var ya,Fp=C(()=>{LOe(),Iue(),ya={forSheet(){return"sheet"},forSheetObject(l){return vS({o:l.address.objectKey})},forSheetObjectProp(l,h){return vS({o:l.address.objectKey,p:h})},forTrackKeyframe(l,h,d){return vS({o:l.address.objectKey,t:h,k:d})},forSheetObjectAggregateKeyframe(l,h){return ya.forCompoundPropAggregateKeyframe(l,[],h)},forSheetAggregateKeyframe(l,h){return vS({o:l.address.sheetId,pos:h})},forCompoundPropAggregateKeyframe(l,h,d){return vS({o:l.address.objectKey,p:h,pos:d})}}});function Due(l,h,d){if(!h||h.data.keyframes.length===0)return Fue;let g=fj.get(h.data);if(g&&g[0]===d)return g[1];function _(S){if(!h)return;let E=h.data.keyframes[S];return E&&{kf:E,track:h,itemKey:ya.forTrackKeyframe(l,h.id,E.id)}}let b=(()=>{let S=h.data.keyframes.findIndex(N=>N.position>=d);if(S===-1)return{prev:_(h.data.keyframes.length-1)};let E=_(S);return E.kf.position===d?{prev:_(S-1),cur:E,next:_(S+1)}:{next:E,prev:_(S-1)}})();return fj.set(h.data,[d,b]),b}var fj,Fue,Oue=C(()=>{Fp(),fj=new WeakMap,Fue={}}),pj,Bue=C(()=>{pj={}});function VOe(l,h,d){let g=(0,Su.getPointerParts)(l).path;return Rr(()=>{if(!nj(d))return{type:"AllStatic",beingScrubbed:!1,contextMenuItems:[],controlIndicators:o9.default.createElement(yS,{hasStaticOverride:!1,obj:h,pathToProp:g,propConfig:d})};let _=!!(0,Su.val)(pp(ge().atomP.ephemeral.projects.stateByProjectId[h.address.projectId].stateBySheetId[h.address.sheetId].stateByObjectKey[h.address.objectKey].valuesBeingScrubbed,(0,Su.getPointerParts)(l).path)),b=[],S={beingScrubbed:_,contextMenuItems:b,controlIndicators:o9.default.createElement(o9.default.Fragment,null)},E=(0,Su.val)(h.template.getMapOfValidSequenceTracks_forStudio()),N=ng(E,g),I=N!==void 0&&Object.keys(N).length!==0,B=[],V=(0,Su.val)(h.template.getStaticButNotSequencedOverrides()),U=ng(V??pj,g)!==void 0;if(I)for(let F of aS(d,[])){if(Jd(F.conf))continue;let H=ng(N,F.path);typeof H!="string"?U=!0:B.push(H)}if((U||I)&&b.push({label:"Reset all to default",callback:()=>{ge().transaction(({unset:F})=>{F(l)})}}),I&&b.push({label:"Make all static",callback:()=>{ge().transaction(({stateEditors:F})=>{for(let{path:H,conf:G}of aS(d,[])){if(Jd(G))continue;let W=M(R({},h.address),{pathToProp:[...g,...H]}),X=hS(l,H);F.coreByProject.historic.sheetsById.sequence.setPrimitivePropAsStatic(M(R({},W),{value:h.getValueByPointer(X)}))}})}}),(!I||I&&U)&&b.push({label:"Sequence all",callback:()=>{ge().transaction(({stateEditors:F})=>{for(let{path:H,conf:G}of aS(d,g)){if(Jd(G))continue;let W=M(R({},h.address),{pathToProp:H});F.coreByProject.historic.sheetsById.sequence.setPrimitivePropAsSequenced(W,d)}})}}),I){let F=Su.prism.memo("controlIndicators",()=>o9.default.createElement(GOe,{pointerToProp:l,obj:h,possibleSequenceTrackIds:N,listOfDescendantTrackIds:B}),[N,B]);return M(R({},S),{type:"HasSequences",controlIndicators:F})}else return M(R({},S),{type:"AllStatic",controlIndicators:o9.default.createElement(yS,{hasStaticOverride:U,obj:h,pathToProp:g,propConfig:d})})},[])}function GOe({pointerToProp:l,obj:h,possibleSequenceTrackIds:d,listOfDescendantTrackIds:g}){return Rr(()=>{let _=(0,Su.getPointerParts)(l).path,b=(0,Su.val)(h.sheet.getSequence().positionPrism),S=g.map(F=>({trackId:F,track:(0,Su.val)(h.template.project.pointers.historic.sheetsById[h.address.sheetId].sequence.tracksByObject[h.address.objectKey].trackData[F])})).filter(({track:F})=>!!F).map(F=>M(R({},F),{nearbies:Due(h,{id:F.trackId,data:F.track,sheetObject:h},b)})),E=S.find(({nearbies:F})=>!!F.cur),N=S.every(({nearbies:F})=>!!F.cur),I=S.reduce((F,H)=>H.nearbies.prev&&(F===void 0||H.nearbies.prev.kf.position>F.kf.position)?H.nearbies.prev:F,void 0),B=S.reduce((F,H)=>H.nearbies.next&&(F===void 0||H.nearbies.next.kf.position<F.kf.position)?H.nearbies.next:F,void 0),V=()=>{N?ge().transaction(F=>{F.unset(l)}):E?ge().transaction(F=>{F.set(l,(0,Su.val)(l))}):ge().transaction(F=>{F.set(l,(0,Su.val)(l))})},U={cur:E?{type:"on",itemKey:ya.forCompoundPropAggregateKeyframe(h,_,b),toggle:V}:{toggle:V,type:"off"},prev:I!==void 0?{position:I.kf.position,itemKey:ya.forCompoundPropAggregateKeyframe(h,_,I.kf.position),jump:()=>{h.sheet.getSequence().position=I.kf.position}}:void 0,next:B!==void 0?{position:B.kf.position,itemKey:ya.forCompoundPropAggregateKeyframe(h,_,B.kf.position),jump:()=>{h.sheet.getSequence().position=B.kf.position}}:void 0};return o9.default.createElement(hj,R({},U))},[l,h,d,g])}var Su,o9,$Oe=C(()=>{Fe(),pI(),Qn(),Su=Jt,mp(),o9=z(Le()),Pue(),eg(),Fp(),mI(),_I(),Oue(),Bue()});function HOe(){let l=0,h=new zue.Atom({hasLock:!1});return{replaceLock(d,g){let _=l++,b=h.get();return b.hasLock&&b.cleanup(),h.set({hasLock:!0,lockId:_,cleanup:g,deepPath:jOe(Lue(d))}),function(){let S=h.get();S.hasLock&&S.lockId===_&&(S.cleanup(),h.set({hasLock:!1}))}},getIsPropHighlightedD(d){let g=hS(h.pointer.deepPath,Lue(d));return(0,Vue.prism)(()=>{let _=(0,Uue.val)(g);return _===!0?"self":_?"descendent":null})}}}function Lue(l){return[l.projectId,l.sheetId,l.objectKey,...l.pathToProp]}function jOe(l){let h={};return Vd(h,l,!0),h}var Uue,zue,Vue,bI,mj=C(()=>{Uue=Jt,zue=Jt,Vue=Jt,mI(),gb(),bI=HOe()});function WOe(l,h){return JSON.stringify(l,h,2).replace(/^([\{\[])\n (\s+)/,"$1$2").replace(/(\n[ ]+[\{\[])\n\s+/g,"$1 ").replace(/\n\s*([\]\}])/g," $1")}var qOe=C(()=>{});function Gue(l,h=!0){try{return typeof l=="string"?l:typeof l=="function"||l instanceof Error?l.toString():h?WOe(l):JSON.stringify(l)}catch{return(l==null?void 0:l.name)||String(l)}}var XOe=C(()=>{qOe()});function YOe(l,h,d){l||(arguments.length>2?$ue(h,d):$ue(h))}function $ue(l,h){let d=arguments.length>1,g=Gue(typeof l=="function"?l():l),_=d?`
Instead found: `.concat(Gue(h)):"";throw new Xue("Invariant: ".concat(g).concat(_),h)}var Hue,jue,Wue,que,Xue,KOe=C(()=>{XOe(),Hue=/^\s*at.+node:internal.+/gm,jue=/^\s*(at|[^@]+@) (?:Object\.)?invariant.+/gm,Wue=/^\s*(at|[^@]+@).+test\-helpers.+/gm,que=/^\s*(at|[^@]+@).+(debounce|invariant|iif)\.[tj]s.*/gm,Xue=class extends Error{constructor(l,h){var d;super(l),K(this,"found"),h!==void 0&&(this.found=h),this.stack=(d=this.stack)==null?void 0:d.replace(jue,"").replace(que,"").replace(Wue,"").replace(Hue,"")}}});function ZOe(l){return(0,SI.prism)(()=>{if(Array.isArray(l)){let h=new Array(l.length);for(let d=0;d<l.length;d++)h[d]=l[d].getValue();return h}else{let h={};for(let d in l)h[d]=(0,SI.val)(l[d]);return h}})}function gj(l){let h=Rv.default.memo(Rv.default.forwardRef(function(d,g){let _=[],b={},S={ref:g};for(let B in d){let V=d[B];(0,SI.isPrism)(V)?(_.push(V),b[B]=V):S[B]=V}let E=(0,Rv.useRef)(_.length);YOe(E.current===_.length,"expect same number of observable props on every invocation of deriver wrapped component.",{initial:E.current,count:_.length});let N=(0,Rv.useMemo)(()=>ZOe(b),_),I=j3(N);return I&&Rv.default.createElement(l,R(R({},S),I))}));return h.displayName="deriver(".concat(l.displayName,")"),h}var SI,Rv,Yue=C(()=>{SI=Jt,Qn(),Rv=z(Le()),KOe()});function QOe(l,h,d){return(0,Ch.prism)(()=>{var g;let _=(0,Ch.getPointerParts)(l).path,b=h.getValueByPointer(l),S=Ch.prism.memo("editPropValue",()=>{let H=null;return{temporarilySetValue(G){H||(H=ge().scrub()),H.capture(W=>{W.set(l,G)})},discardTemporaryValue(){H&&(H.discard(),H=null)},permanentlySetValue(G){H?(H.capture(W=>{W.set(l,G)}),H.commit(),H=null):ge().transaction(W=>{W.set(l,G)})}}},[]),E={createAsset:H=>h.sheet.project.assetStorage.createAsset(H),getAssetUrl:H=>H.id?h.sheet.project.assetStorage.getAssetUrl(H.id):void 0},N=(0,Ch.val)(pp(ge().atomP.ephemeral.projects.stateByProjectId[h.address.projectId].stateBySheetId[h.address.sheetId].stateByObjectKey[h.address.objectKey].valuesBeingScrubbed,(0,Ch.getPointerParts)(l).path))===!0,I=[],B=M(R(R({},S),E),{value:b,beingScrubbed:N,contextMenuItems:I,controlIndicators:Pv.default.createElement(Pv.default.Fragment,null)}),V=NOe(d);if(V){let H=(0,Ch.val)(h.template.getMapOfValidSequenceTracks_forStudio()),G=ng(H,_);if(typeof G=="string"){I.push({label:"Make static",callback:()=>{ge().transaction(({stateEditors:ue})=>{let Ee=M(R({},h.address),{pathToProp:_});ue.coreByProject.historic.sheetsById.sequence.setPrimitivePropAsStatic(M(R({},Ee),{value:h.getValueByPointer(l)}))})}});let W=G,X=Ch.prism.sub("lcr",()=>{let ue=(0,Ch.val)(h.template.project.pointers.historic.sheetsById[h.address.sheetId].sequence.tracksByObject[h.address.objectKey].trackData[W]),Ee=(0,Ch.val)(h.sheet.getSequence().positionPrism);return Due(h,ue&&{data:ue,id:W,sheetObject:h},Ee)},[W]),Z;B.beingScrubbed?Z="Sequenced_OnKeyframe_BeingScrubbed":X.cur?Z="Sequenced_OnKeyframe":((g=X.prev)==null?void 0:g.kf.connectedRight)===!0?Z="Sequenced_BeingInterpolated":Z="Sequened_NotBeingInterpolated";let te=()=>{X.cur?ge().transaction(ue=>{ue.unset(l)}):ge().transaction(ue=>{ue.set(l,B.value)})},ae={cur:X.cur?{type:"on",itemKey:X.cur.itemKey,toggle:te}:{type:"off",toggle:te},prev:X.prev!==void 0?{itemKey:X.prev.itemKey,position:X.prev.kf.position,jump:()=>{h.sheet.getSequence().position=X.prev.kf.position}}:void 0,next:X.next!==void 0?{itemKey:X.next.itemKey,position:X.next.kf.position,jump:()=>{h.sheet.getSequence().position=X.next.kf.position}}:void 0},oe=Pv.default.createElement(hj,R({},ae));return M(R({},B),{type:"Sequenced",shade:Z,nearbyKeyframes:X,controlIndicators:oe})}}let U=(0,Ch.val)(h.template.getStaticValues()),F=ng(U,_);return typeof F<"u"&&I.push({label:"Reset to default",callback:()=>{ge().transaction(({unset:H})=>{H(l)})}}),V&&I.push({label:"Sequence",callback:()=>{ge().transaction(({stateEditors:H})=>{let G=M(R({},h.address),{pathToProp:_});H.coreByProject.historic.sheetsById.sequence.setPrimitivePropAsSequenced(G,d)})}}),typeof F<"u"?M(R({},B),{type:"Static",shade:B.beingScrubbed?"Static_BeingScrubbed":"Static",controlIndicators:Pv.default.createElement(yS,{hasStaticOverride:!0,obj:h,pathToProp:_,propConfig:d})}):M(R({},B),{type:"Default",shade:"Default",controlIndicators:Pv.default.createElement(yS,{hasStaticOverride:!0,obj:h,pathToProp:_,propConfig:d})})})}function JOe(l,h,d){if(wI.has(l))return wI.get(l);{let g=QOe(l,h,d);return wI.set(l,g),g}}function yj(l,h,d){let g=JOe(l,h,d);return j3(g)}var Pv,Ch,wI,vj=C(()=>{mp(),Pv=z(Le()),Ch=Jt,Fe(),pI(),Qn(),eg(),Pue(),Oue(),_I(),wI=new WeakMap});function eBe({propConfig:l,pointerToProp:h,obj:d,SimpleEditorComponent:g}){let _=yj(h,d,l);return el.default.createElement(EH,{editingTools:_,propConfig:l,value:_.value})}function tBe({pointerToProp:l,obj:h,propConfig:d,visualIndentation:g}){var _;let b=(_=d.label)!=null?_:yp((0,xS.getPointerParts)(l).path),S=Object.entries(d.props),E=S.filter(([te,ae])=>Jd(ae)),N=S.filter(([te,ae])=>!Jd(ae)),[I,B]=vi(null),V=VOe(l,h,d),[U]=c0(B,{menuItems:V.contextMenuItems}),F=E.length>0,H=(0,el.useMemo)(()=>bI.getIsPropHighlightedD(M(R({},h.address),{pathToProp:(0,xS.getPointerParts)(l).path})),[l]),G="".concat(h.address.projectId,",").concat(h.address.sheetId,",").concat(h.address.sheetInstanceId,",").concat(h.address.objectKey,",").concat((0,xS.getPointerParts)(l).path.join()),W=hhe(d);(0,el.useLayoutEffect)(()=>{TI.has(G)||TI.set(G,new xS.Atom(W))},[G,d]);let X=TI.get(G),Z=Rr(()=>X?(0,Kue.val)(X.pointer):W,[X]);return el.default.createElement(Que,null,U,el.default.createElement(_j,{style:{"--depth":g-1}},el.default.createElement(the,{isVectorProp:W},el.default.createElement(rhe,null,V.controlIndicators),el.default.createElement(she,{isHighlighted:H,ref:I},el.default.createElement("span",null,b||"Props")),el.default.createElement(ahe,{isCollapsed:Z,isVector:W,onClick:()=>{X==null||X.set(!X.get())}},el.default.createElement(yle,null))),W&&Z&&el.default.createElement(fhe,null,[...S].map(([te,ae])=>el.default.createElement(eBe,{key:"prop-"+te,propConfig:ae,pointerToProp:l[te],obj:h})))),!Z&&el.default.createElement(uhe,{style:{"--depth":g},depth:g,lastSubIsComposite:F},[...N,...E].map(([te,ae])=>el.default.createElement(bj,{key:"prop-"+te,propConfig:ae,pointerToProp:l[te],obj:h,visualIndentation:g+1}))))}var xS,el,Kue,Zue,Que,Jue,_j,ehe,the,nhe,rhe,ihe,she,ohe,ahe,lhe,che,uhe,hhe,dhe,fhe,phe,TI,nBe=C(()=>{eg(),xS=Jt,U3(),Tc(),el=z(Le()),at(),Bce(),r9(),Ei(),Ti(),Ahe(),u0(),$Oe(),mj(),Yue(),ale(),vj(),Qn(),Kue=Jt,Ev(),lI(),Que=me.div(Zue||(Zue=$([`
  --step: 15px;
  --left-pad: 15px;
  `,`;
  --right-width: 60%;
`])),Si),_j=me.div(Jue||(Jue=$([`
  height: 30px;
  display: flex;
  align-items: stretch;
  position: relative;
`]))),the=me.div(ehe||(ehe=$([`
  padding-left: `,`;
  display: flex;
  align-items: center;
  overflow: hidden;
  `,`;
`])),rj,({isVectorProp:l})=>l?"width: calc(100% - var(--right-width))":""),rhe=me.div(nhe||(nhe=$([`
  flexshrink: 0;
`]))),she=gj(me.div(ihe||(ihe=$([`
  margin-left: 4px;
  cursor: default;
  height: 100%;
  display: flex;
  align-items: center;
  gap: 4px;
  user-select: none;
  &:hover {
    color: white;
  }
  overflow: hidden;

  `,`;
`])),()=>tg)),ahe=me.span(ohe||(ohe=$([`
  width: 28px;
  height: 28px;
  font-size: 9px;
  display: flex;
  align-items: center;
  justify-content: center;

  transition: transform 0.05s ease-out, color 0.1s ease-out;
  transform: rotateZ(`,`deg);
  color: #66686a;

  visibility: `,`;

  `,`:hover & {
    visibility: visible;
  }

  &:hover {
    transform: rotateZ(`,`deg);
    color: #c0c4c9;
  }
`])),l=>l.isCollapsed?0:90,l=>!l.isVector&&l.isCollapsed||l.isVector&&!l.isCollapsed?"visible":"hidden",_j,l=>l.isCollapsed?15:75),lhe=Sh(.05,"#282b2f"),uhe=me.div(che||(che=$([`
  /* background: `,`; */
  /* padding: `,` 0; */
`])),({depth:l})=>Ub(l*.03,lhe),l=>l.lastSubIsComposite?0:"4px"),hhe=oS(l=>{let h=Object.entries(l.props);return h.length<=3&&h.every(([d,g])=>g.type==="number"&&["x","y","z"].includes(d))}),fhe=me.div(dhe||(dhe=$([`
  display: flex;
  align-items: center;
  justify-content: stretch;
  padding: 0 8px 0 2px;
  box-sizing: border-box;
  height: 100%;
  width: var(--right-width);
  flex-shrink: 0;
  flex-grow: 0;
`]))),phe=el.default.memo(tBe),TI=new Map});function rBe({isHighlighted:l}){return l==="self"?"#1857a4":l==="descendent"?"#0a2f5c":"initial"}var iBe=C(()=>{});function sBe({propConfig:l,pointerToProp:h,editingTools:d,children:g,isPropHighlightedD:_}){var b;let S=(b=l.label)!=null?b:yp((0,xj.getPointerParts)(h).path),[E,N]=vi(null),[I]=c0(N,{menuItems:d.contextMenuItems});return Nv.default.createElement(ghe,{isHighlighted:_},I,Nv.default.createElement(vhe,null,Nv.default.createElement(She,null,d.controlIndicators),Nv.default.createElement(xhe,{isHighlighted:_,ref:E,title:["obj","props",...(0,xj.getPointerParts)(h).path].join(".")},S)),Nv.default.createElement(The,null,g))}var xj,Nv,mhe,ghe,yhe,vhe,_he,xhe,bhe,She,whe,The,oBe=C(()=>{xj=Jt,u0(),Ti(),bo(),Nv=z(Le()),at(),Ei(),r9(),Yue(),Bce(),iBe(),ghe=gj(me.div(mhe||(mhe=$([`
  display: flex;
  height: 30px;
  justify-content: flex-start;
  align-items: stretch;
  // We cannot calculate both the container (details panel) width and the descendant
  // (this) width dynamically. This leads to the container width being calculated
  // without this percentage being taken into consideration leads to horizontal
  // clipping/scrolling--the same way as if we explicitly fixed either the container
  // width, or the descendant width.
  // The correct solution for tabulated UIs with dynamic container widths is to use
  // CSS grid. For now I fixed this issue by just giving a great enough width
  // to the details panel so most things don't break.
  --right-width: 60%;
  position: relative;
  `,`;

  /* background-color: `,`; */
`])),Si,rBe)),vhe=me.div(yhe||(yhe=$([`
  box-sizing: border-box;
  padding-left: `,`;
  padding-right: 4px;
  display: flex;
  flex-direction: row;
  justify-content: flex-start;
  align-items: stretch;
  gap: 4px;
  flex-grow: 0;
  flex-shrink: 0;
  width: calc(100% - var(--right-width));
`])),rj),xhe=gj(me.div(_he||(_he=$([`
  text-align: left;
  flex: 1 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: flex;
  align-items: center;
  user-select: none;
  cursor: default;

  `,`;
  &:hover {
    color: white;
  }
`])),tg)),She=me.div(bhe||(bhe=$([`
  flex-basis: 8px;
  flex: 0 0;
  display: flex;
  align-items: center;
`]))),The=me.div(whe||(whe=$([`
  display: flex;
  align-items: center;
  justify-content: stretch;
  padding: 0 8px 0 2px;
  box-sizing: border-box;
  height: 100%;
  width: var(--right-width);
  flex-shrink: 0;
  flex-grow: 0;
`])))});function aBe({propConfig:l,pointerToProp:h,obj:d,SimpleEditorComponent:g}){let _=yj(h,d,l),b=(0,bS.useMemo)(()=>bI.getIsPropHighlightedD(M(R({},d.address),{pathToProp:(0,Ehe.getPointerParts)(h).path})),[h]);return bS.default.createElement(sBe,{editingTools:_,propConfig:l,pointerToProp:h,isPropHighlightedD:b},bS.default.createElement(g,{editingTools:_,propConfig:l,value:_.value}))}var bS,Ehe,Mhe,lBe=C(()=>{bS=z(Le()),vj(),oBe(),Ehe=Jt,mj(),Mhe=bS.default.memo(aBe)}),SS,Che,bj,Ahe=C(()=>{SS=z(Le()),Oce(),nBe(),lBe(),Che=({propConfig:l,visualIndentation:h,pointerToProp:d,obj:g})=>{if(l.type==="compound")return SS.default.createElement(phe,{obj:g,visualIndentation:h,pointerToProp:d,propConfig:l});if(l.type==="enum")return SS.default.createElement(SS.default.Fragment,null);{let _=tj[l.type];return SS.default.createElement(Mhe,{SimpleEditorComponent:_,obj:g,visualIndentation:h,pointerToProp:d,propConfig:l})}},bj=Che});function Rhe(l){return EI.has(l)||EI.set(l,(Phe++).toString()),EI.get(l)}var EI,Phe,Nhe=C(()=>{EI=new WeakMap,Phe=0}),Iv,Ihe,khe,Dhe,Fhe,Ohe,Bhe,cBe=C(()=>{Iv=z(Le()),Ahe(),Qn(),Nhe(),at(),khe=me.div(Ihe||(Ihe=$([`
  display: flex;
  flex-direction: column;
  gap: 4px;
  padding: 8px;
`]))),Fhe=me.button(Dhe||(Dhe=$([`
  display: flex;
  align-items: center;
  justify-content: center;
  outline: none;
  border-radius: 2px;

  color: #a8a8a9;
  background: rgba(255, 255, 255, 0.1);

  border: none;
  height: 28px;

  &:hover {
    background: rgba(255, 255, 255, 0.15);
  }

  &:active {
    background: rgba(255, 255, 255, 0.2);
  }
`]))),Ohe=({objects:l})=>{let h=l[0],d=Dr(h.template.configPointer),g=Dr(h.template._temp_actionsPointer);return Iv.default.createElement(Iv.default.Fragment,null,Iv.default.createElement(bj,{key:Rhe(h),obj:h,pointerToProp:h.propsP,propConfig:d,visualIndentation:1}),Iv.default.createElement(khe,null,g&&Object.entries(g).map(([_,b])=>Iv.default.createElement(Fhe,{key:_,onClick:()=>{b(h.publicApi)}},_))))},Bhe=Ohe}),Lhe,Uhe,MI,zhe=C(()=>{at(),Uhe=me.button(Lhe||(Lhe=$([`
  text-align: center;
  padding: 8px;
  border-radius: 2px;
  border: 1px solid #627b7b87;
  background-color: #4b787d3d;
  color: #eaeaea;
  font-weight: 400;
  display: block;
  appearance: none;
  flex-grow: 1;
  cursor: `,`;
  opacity: `,`;

  &:hover {
    background-color: #7dc1c878;
    border-color: #9ebcbf;
  }
`])),l=>l.disabled?"none":"pointer",l=>l.disabled?.4:1),MI=Uhe}),uBe=C(()=>{}),Vhe,hBe=C(()=>{uBe(),Vhe=(l=21)=>{let h="",d=crypto.getRandomValues(new Uint8Array(l));for(;l--;){let g=d[l]&63;g<36?h+=g.toString(36):g<62?h+=(g-26).toString(36).toUpperCase():g<63?h+="_":h+="-"}return h}});function Ghe(){return Vhe(16)}var $he=C(()=>{hBe()}),Hhe,Op,Sj,jhe,Whe,qhe,Xhe,Yhe=C(()=>{Hhe=Jt,Ti(),Op=z(Le()),Sj=(0,Op.createContext)(null),jhe=0,Whe=()=>{let l=(0,Op.useMemo)(()=>jhe++,[]),{cur:h,set:d}=(0,Op.useContext)(Sj),[g,_]=vi(!1),b=(0,Op.useCallback)((S,E)=>{d(S?l:-1,E)},[]);return(0,Op.useEffect)(()=>h.onStale(()=>{let S=h.getValue()===l;g.current!==S&&(g.current=S)}),[h,l]),[_,b]},qhe=({children:l})=>{let h=(0,Op.useMemo)(()=>new Hhe.Atom(-1),[]),d=h.prism,g=(0,Op.useMemo)(()=>{let _;return(b,S)=>{let E=_!==void 0;_!==void 0&&(clearTimeout(_),_=void 0),S===0||E?h.set(b):_=setTimeout(()=>{h.set(b),_=void 0},S)}},[]);return Op.default.createElement(Sj.Provider,{value:{cur:d,set:g}},l)},Xhe=qhe});function kv(l,h){let d=l.enabled!==!1,[g,_]=Whe(),[b,S]=vi(null);(0,Zhe.useEffect)(()=>{if(!d)return;let N=b.current;if(!N)return;let I=()=>{var V;return _(!0,(V=l.enterDelay)!=null?V:400)},B=()=>{var V;return _(!1,(V=l.exitDelay)!=null?V:200)};return N.addEventListener("mouseenter",I),N.addEventListener("mouseleave",B),()=>{N.removeEventListener("mouseenter",I),N.removeEventListener("mouseleave",B)}},[b,d,l.enterDelay,l.exitDelay]);let E=(0,Khe.useContext)(mv);return[d&&g&&S?(0,Qhe.createPortal)(CI.default.createElement(YH,{children:h,target:S,onClickOutside:wh,verticalPlacement:l.verticalPlacement,verticalGap:l.verticalGap}),E):CI.default.createElement(CI.default.Fragment,null),b,g]}var Khe,Zhe,CI,Qhe,wS=C(()=>{Ti(),Khe=z(Le()),Zhe=z(Le()),CI=z(Le()),L0e(),Qhe=z(gu()),Yhe(),e9(),vv()}),Jhe,ede,Dv,AI=C(()=>{at(),Zd(),ede=me(Kd)(Jhe||(Jhe=$([`
  padding: 1em;
  max-width: 240px;
  pointer-events: none !important;
  --popover-outer-stroke: transparent;
  --popover-inner-stroke: #45464d;
`]))),Dv=ede}),ef,tde,nde,rde,ide,sde,ode,ade,lde,cde,dBe=C(()=>{Qn(),Fe(),ef=z(Le()),at(),$he(),wS(),AI(),zhe(),nde=me.div(tde||(tde=$([`
  padding: 8px 10px;
  position: relative;
  background-color: #6d232352;
  &:before {
    position: absolute;
    content: ' ';
    display: block;
    left: 0;
    top: 0;
    bottom: 0;
    width: 2px;
    background-color: #ff000070;
  }
`]))),ide=me.div(rde||(rde=$([`
  margin-bottom: 1em;
  & a {
    color: inherit;
  }
`]))),ode=me.div(sde||(sde=$([`
  display: flex;
  gap: 8px;
`]))),ade=({projectId:l})=>{let h=Dr(ge().atomP.ephemeral.coreByProject[l].loadingState);return h&&h.type==="browserStateIsNotBasedOnDiskState"?ef.default.createElement(lde,{loadingState:h,projectId:l}):null},lde=({projectId:l,loadingState:h})=>{let d=()=>{ge().transaction(({drafts:N,stateEditors:I})=>{I.coreByProject.historic.revisionHistory.add({projectId:l,revision:h.onDiskState.revisionHistory[0]}),I.coreByProject.historic.revisionHistory.add({projectId:l,revision:Ghe()}),N.ephemeral.coreByProject[l].loadingState={type:"loaded"}})},g=()=>{ge().transaction(({drafts:N})=>{N.historic.coreByProject[l]=h.onDiskState,N.ephemeral.coreByProject[l].loadingState={type:"loaded"}})},[_,b]=kv({},()=>ef.default.createElement(Dv,null,"The browser's state will override the disk state.")),[S,E]=kv({},()=>ef.default.createElement(Dv,null,"The disk's state will override the browser's state."));return ef.default.createElement(nde,null,ef.default.createElement(ide,null,"Browser state is not based on disk state."," ",ef.default.createElement("a",{href:"https://www.theatrejs.com/docs/latest/manual/projects#state",target:"_blank"},"Learn more.")),ef.default.createElement(ode,null,_,ef.default.createElement(MI,{onClick:d,ref:b},"Use browser's state"),S,ef.default.createElement(MI,{onClick:g,ref:E},"Use disk state")))},cde=ade}),fBe=L((l,h)=>{(function(d){typeof l=="object"&&typeof h<"u"?h.exports=d():(typeof window<"u"?window:typeof lo<"u"?lo:typeof self<"u"?self:this).JSZip=d()})(function(){return function d(g,_,b){function S(I,B){if(!_[I]){if(!g[I]){var V=typeof LF=="function"&&LF;if(!B&&V)return V(I,!0);if(E)return E(I,!0);var U=new Error("Cannot find module '"+I+"'");throw U.code="MODULE_NOT_FOUND",U}var F=_[I]={exports:{}};g[I][0].call(F.exports,function(H){var G=g[I][1][H];return S(G||H)},F,F.exports,d,g,_,b)}return _[I].exports}for(var E=typeof LF=="function"&&LF,N=0;N<b.length;N++)S(b[N]);return S}({1:[function(d,g,_){var b=d("./utils"),S=d("./support"),E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";_.encode=function(N){for(var I,B,V,U,F,H,G,W=[],X=0,Z=N.length,te=Z,ae=b.getTypeOf(N)!=="string";X<N.length;)te=Z-X,V=ae?(I=N[X++],B=X<Z?N[X++]:0,X<Z?N[X++]:0):(I=N.charCodeAt(X++),B=X<Z?N.charCodeAt(X++):0,X<Z?N.charCodeAt(X++):0),U=I>>2,F=(3&I)<<4|B>>4,H=1<te?(15&B)<<2|V>>6:64,G=2<te?63&V:64,W.push(E.charAt(U)+E.charAt(F)+E.charAt(H)+E.charAt(G));return W.join("")},_.decode=function(N){var I,B,V,U,F,H,G=0,W=0,X="data:";if(N.substr(0,X.length)===X)throw new Error("Invalid base64 input, it looks like a data url.");var Z,te=3*(N=N.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(N.charAt(N.length-1)===E.charAt(64)&&te--,N.charAt(N.length-2)===E.charAt(64)&&te--,te%1!=0)throw new Error("Invalid base64 input, bad content length.");for(Z=S.uint8array?new Uint8Array(0|te):new Array(0|te);G<N.length;)I=E.indexOf(N.charAt(G++))<<2|(U=E.indexOf(N.charAt(G++)))>>4,B=(15&U)<<4|(F=E.indexOf(N.charAt(G++)))>>2,V=(3&F)<<6|(H=E.indexOf(N.charAt(G++))),Z[W++]=I,F!==64&&(Z[W++]=B),H!==64&&(Z[W++]=V);return Z}},{"./support":30,"./utils":32}],2:[function(d,g,_){var b=d("./external"),S=d("./stream/DataWorker"),E=d("./stream/Crc32Probe"),N=d("./stream/DataLengthProbe");function I(B,V,U,F,H){this.compressedSize=B,this.uncompressedSize=V,this.crc32=U,this.compression=F,this.compressedContent=H}I.prototype={getContentWorker:function(){var B=new S(b.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new N("data_length")),V=this;return B.on("end",function(){if(this.streamInfo.data_length!==V.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),B},getCompressedWorker:function(){return new S(b.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},I.createWorkerFrom=function(B,V,U){return B.pipe(new E).pipe(new N("uncompressedSize")).pipe(V.compressWorker(U)).pipe(new N("compressedSize")).withStreamInfo("compression",V)},g.exports=I},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(d,g,_){var b=d("./stream/GenericWorker");_.STORE={magic:"\0\0",compressWorker:function(){return new b("STORE compression")},uncompressWorker:function(){return new b("STORE decompression")}},_.DEFLATE=d("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(d,g,_){var b=d("./utils"),S=function(){for(var E,N=[],I=0;I<256;I++){E=I;for(var B=0;B<8;B++)E=1&E?3988292384^E>>>1:E>>>1;N[I]=E}return N}();g.exports=function(E,N){return E!==void 0&&E.length?b.getTypeOf(E)!=="string"?function(I,B,V,U){var F=S,H=U+V;I^=-1;for(var G=U;G<H;G++)I=I>>>8^F[255&(I^B[G])];return-1^I}(0|N,E,E.length,0):function(I,B,V,U){var F=S,H=U+V;I^=-1;for(var G=U;G<H;G++)I=I>>>8^F[255&(I^B.charCodeAt(G))];return-1^I}(0|N,E,E.length,0):0}},{"./utils":32}],5:[function(d,g,_){_.base64=!1,_.binary=!1,_.dir=!1,_.createFolders=!0,_.date=null,_.compression=null,_.compressionOptions=null,_.comment=null,_.unixPermissions=null,_.dosPermissions=null},{}],6:[function(d,g,_){var b=null;b=typeof Promise<"u"?Promise:d("lie"),g.exports={Promise:b}},{lie:37}],7:[function(d,g,_){var b=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",S=d("pako"),E=d("./utils"),N=d("./stream/GenericWorker"),I=b?"uint8array":"array";function B(V,U){N.call(this,"FlateWorker/"+V),this._pako=null,this._pakoAction=V,this._pakoOptions=U,this.meta={}}_.magic="\b\0",E.inherits(B,N),B.prototype.processChunk=function(V){this.meta=V.meta,this._pako===null&&this._createPako(),this._pako.push(E.transformTo(I,V.data),!1)},B.prototype.flush=function(){N.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},B.prototype.cleanUp=function(){N.prototype.cleanUp.call(this),this._pako=null},B.prototype._createPako=function(){this._pako=new S[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var V=this;this._pako.onData=function(U){V.push({data:U,meta:V.meta})}},_.compressWorker=function(V){return new B("Deflate",V)},_.uncompressWorker=function(){return new B("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(d,g,_){function b(F,H){var G,W="";for(G=0;G<H;G++)W+=String.fromCharCode(255&F),F>>>=8;return W}function S(F,H,G,W,X,Z){var te,ae,oe=F.file,ue=F.compression,Ee=Z!==I.utf8encode,Ie=E.transformTo("string",Z(oe.name)),_e=E.transformTo("string",I.utf8encode(oe.name)),Oe=oe.comment,ot=E.transformTo("string",Z(Oe)),de=E.transformTo("string",I.utf8encode(Oe)),Be=_e.length!==oe.name.length,re=de.length!==Oe.length,Ye="",nn="",ke="",Re=oe.dir,Ze=oe.date,Pt={crc32:0,compressedSize:0,uncompressedSize:0};H&&!G||(Pt.crc32=F.crc32,Pt.compressedSize=F.compressedSize,Pt.uncompressedSize=F.uncompressedSize);var pe=0;H&&(pe|=8),Ee||!Be&&!re||(pe|=2048);var xe=0,ct=0;Re&&(xe|=16),X==="UNIX"?(ct=798,xe|=function(gt,Je){var kn=gt;return gt||(kn=Je?16893:33204),(65535&kn)<<16}(oe.unixPermissions,Re)):(ct=20,xe|=function(gt){return 63&(gt||0)}(oe.dosPermissions)),te=Ze.getUTCHours(),te<<=6,te|=Ze.getUTCMinutes(),te<<=5,te|=Ze.getUTCSeconds()/2,ae=Ze.getUTCFullYear()-1980,ae<<=4,ae|=Ze.getUTCMonth()+1,ae<<=5,ae|=Ze.getUTCDate(),Be&&(nn=b(1,1)+b(B(Ie),4)+_e,Ye+="up"+b(nn.length,2)+nn),re&&(ke=b(1,1)+b(B(ot),4)+de,Ye+="uc"+b(ke.length,2)+ke);var dt="";return dt+=`
\0`,dt+=b(pe,2),dt+=ue.magic,dt+=b(te,2),dt+=b(ae,2),dt+=b(Pt.crc32,4),dt+=b(Pt.compressedSize,4),dt+=b(Pt.uncompressedSize,4),dt+=b(Ie.length,2),dt+=b(Ye.length,2),{fileRecord:V.LOCAL_FILE_HEADER+dt+Ie+Ye,dirRecord:V.CENTRAL_FILE_HEADER+b(ct,2)+dt+b(ot.length,2)+"\0\0\0\0"+b(xe,4)+b(W,4)+Ie+Ye+ot}}var E=d("../utils"),N=d("../stream/GenericWorker"),I=d("../utf8"),B=d("../crc32"),V=d("../signature");function U(F,H,G,W){N.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=H,this.zipPlatform=G,this.encodeFileName=W,this.streamFiles=F,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}E.inherits(U,N),U.prototype.push=function(F){var H=F.meta.percent||0,G=this.entriesCount,W=this._sources.length;this.accumulate?this.contentBuffer.push(F):(this.bytesWritten+=F.data.length,N.prototype.push.call(this,{data:F.data,meta:{currentFile:this.currentFile,percent:G?(H+100*(G-W-1))/G:100}}))},U.prototype.openedSource=function(F){this.currentSourceOffset=this.bytesWritten,this.currentFile=F.file.name;var H=this.streamFiles&&!F.file.dir;if(H){var G=S(F,H,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:G.fileRecord,meta:{percent:0}})}else this.accumulate=!0},U.prototype.closedSource=function(F){this.accumulate=!1;var H=this.streamFiles&&!F.file.dir,G=S(F,H,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(G.dirRecord),H)this.push({data:function(W){return V.DATA_DESCRIPTOR+b(W.crc32,4)+b(W.compressedSize,4)+b(W.uncompressedSize,4)}(F),meta:{percent:100}});else for(this.push({data:G.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},U.prototype.flush=function(){for(var F=this.bytesWritten,H=0;H<this.dirRecords.length;H++)this.push({data:this.dirRecords[H],meta:{percent:100}});var G=this.bytesWritten-F,W=function(X,Z,te,ae,oe){var ue=E.transformTo("string",oe(ae));return V.CENTRAL_DIRECTORY_END+"\0\0\0\0"+b(X,2)+b(X,2)+b(Z,4)+b(te,4)+b(ue.length,2)+ue}(this.dirRecords.length,G,F,this.zipComment,this.encodeFileName);this.push({data:W,meta:{percent:100}})},U.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},U.prototype.registerPrevious=function(F){this._sources.push(F);var H=this;return F.on("data",function(G){H.processChunk(G)}),F.on("end",function(){H.closedSource(H.previous.streamInfo),H._sources.length?H.prepareNextSource():H.end()}),F.on("error",function(G){H.error(G)}),this},U.prototype.resume=function(){return!!N.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},U.prototype.error=function(F){var H=this._sources;if(!N.prototype.error.call(this,F))return!1;for(var G=0;G<H.length;G++)try{H[G].error(F)}catch{}return!0},U.prototype.lock=function(){N.prototype.lock.call(this);for(var F=this._sources,H=0;H<F.length;H++)F[H].lock()},g.exports=U},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(d,g,_){var b=d("../compressions"),S=d("./ZipFileWorker");_.generateWorker=function(E,N,I){var B=new S(N.streamFiles,I,N.platform,N.encodeFileName),V=0;try{E.forEach(function(U,F){V++;var H=function(Z,te){var ae=Z||te,oe=b[ae];if(!oe)throw new Error(ae+" is not a valid compression method !");return oe}(F.options.compression,N.compression),G=F.options.compressionOptions||N.compressionOptions||{},W=F.dir,X=F.date;F._compressWorker(H,G).withStreamInfo("file",{name:U,dir:W,date:X,comment:F.comment||"",unixPermissions:F.unixPermissions,dosPermissions:F.dosPermissions}).pipe(B)}),B.entriesCount=V}catch(U){B.error(U)}return B}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(d,g,_){function b(){if(!(this instanceof b))return new b;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var S=new b;for(var E in this)typeof this[E]!="function"&&(S[E]=this[E]);return S}}(b.prototype=d("./object")).loadAsync=d("./load"),b.support=d("./support"),b.defaults=d("./defaults"),b.version="3.10.1",b.loadAsync=function(S,E){return new b().loadAsync(S,E)},b.external=d("./external"),g.exports=b},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(d,g,_){var b=d("./utils"),S=d("./external"),E=d("./utf8"),N=d("./zipEntries"),I=d("./stream/Crc32Probe"),B=d("./nodejsUtils");function V(U){return new S.Promise(function(F,H){var G=U.decompressed.getContentWorker().pipe(new I);G.on("error",function(W){H(W)}).on("end",function(){G.streamInfo.crc32!==U.decompressed.crc32?H(new Error("Corrupted zip : CRC32 mismatch")):F()}).resume()})}g.exports=function(U,F){var H=this;return F=b.extend(F||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:E.utf8decode}),B.isNode&&B.isStream(U)?S.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):b.prepareContent("the loaded zip file",U,!0,F.optimizedBinaryString,F.base64).then(function(G){var W=new N(F);return W.load(G),W}).then(function(G){var W=[S.Promise.resolve(G)],X=G.files;if(F.checkCRC32)for(var Z=0;Z<X.length;Z++)W.push(V(X[Z]));return S.Promise.all(W)}).then(function(G){for(var W=G.shift(),X=W.files,Z=0;Z<X.length;Z++){var te=X[Z],ae=te.fileNameStr,oe=b.resolve(te.fileNameStr);H.file(oe,te.decompressed,{binary:!0,optimizedBinaryString:!0,date:te.date,dir:te.dir,comment:te.fileCommentStr.length?te.fileCommentStr:null,unixPermissions:te.unixPermissions,dosPermissions:te.dosPermissions,createFolders:F.createFolders}),te.dir||(H.file(oe).unsafeOriginalName=ae)}return W.zipComment.length&&(H.comment=W.zipComment),H})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(d,g,_){var b=d("../utils"),S=d("../stream/GenericWorker");function E(N,I){S.call(this,"Nodejs stream input adapter for "+N),this._upstreamEnded=!1,this._bindStream(I)}b.inherits(E,S),E.prototype._bindStream=function(N){var I=this;(this._stream=N).pause(),N.on("data",function(B){I.push({data:B,meta:{percent:0}})}).on("error",function(B){I.isPaused?this.generatedError=B:I.error(B)}).on("end",function(){I.isPaused?I._upstreamEnded=!0:I.end()})},E.prototype.pause=function(){return!!S.prototype.pause.call(this)&&(this._stream.pause(),!0)},E.prototype.resume=function(){return!!S.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},g.exports=E},{"../stream/GenericWorker":28,"../utils":32}],13:[function(d,g,_){var b=d("readable-stream").Readable;function S(E,N,I){b.call(this,N),this._helper=E;var B=this;E.on("data",function(V,U){B.push(V)||B._helper.pause(),I&&I(U)}).on("error",function(V){B.emit("error",V)}).on("end",function(){B.push(null)})}d("../utils").inherits(S,b),S.prototype._read=function(){this._helper.resume()},g.exports=S},{"../utils":32,"readable-stream":16}],14:[function(d,g,_){g.exports={isNode:typeof Buffer<"u",newBufferFrom:function(b,S){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(b,S);if(typeof b=="number")throw new Error('The "data" argument must not be a number');return new Buffer(b,S)},allocBuffer:function(b){if(Buffer.alloc)return Buffer.alloc(b);var S=new Buffer(b);return S.fill(0),S},isBuffer:function(b){return Buffer.isBuffer(b)},isStream:function(b){return b&&typeof b.on=="function"&&typeof b.pause=="function"&&typeof b.resume=="function"}}},{}],15:[function(d,g,_){function b(oe,ue,Ee){var Ie,_e=E.getTypeOf(ue),Oe=E.extend(Ee||{},B);Oe.date=Oe.date||new Date,Oe.compression!==null&&(Oe.compression=Oe.compression.toUpperCase()),typeof Oe.unixPermissions=="string"&&(Oe.unixPermissions=parseInt(Oe.unixPermissions,8)),Oe.unixPermissions&&16384&Oe.unixPermissions&&(Oe.dir=!0),Oe.dosPermissions&&16&Oe.dosPermissions&&(Oe.dir=!0),Oe.dir&&(oe=X(oe)),Oe.createFolders&&(Ie=W(oe))&&Z.call(this,Ie,!0);var ot=_e==="string"&&Oe.binary===!1&&Oe.base64===!1;Ee&&Ee.binary!==void 0||(Oe.binary=!ot),(ue instanceof V&&ue.uncompressedSize===0||Oe.dir||!ue||ue.length===0)&&(Oe.base64=!1,Oe.binary=!0,ue="",Oe.compression="STORE",_e="string");var de=null;de=ue instanceof V||ue instanceof N?ue:H.isNode&&H.isStream(ue)?new G(oe,ue):E.prepareContent(oe,ue,Oe.binary,Oe.optimizedBinaryString,Oe.base64);var Be=new U(oe,de,Oe);this.files[oe]=Be}var S=d("./utf8"),E=d("./utils"),N=d("./stream/GenericWorker"),I=d("./stream/StreamHelper"),B=d("./defaults"),V=d("./compressedObject"),U=d("./zipObject"),F=d("./generate"),H=d("./nodejsUtils"),G=d("./nodejs/NodejsStreamInputAdapter"),W=function(oe){oe.slice(-1)==="/"&&(oe=oe.substring(0,oe.length-1));var ue=oe.lastIndexOf("/");return 0<ue?oe.substring(0,ue):""},X=function(oe){return oe.slice(-1)!=="/"&&(oe+="/"),oe},Z=function(oe,ue){return ue=ue!==void 0?ue:B.createFolders,oe=X(oe),this.files[oe]||b.call(this,oe,null,{dir:!0,createFolders:ue}),this.files[oe]};function te(oe){return Object.prototype.toString.call(oe)==="[object RegExp]"}var ae={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(oe){var ue,Ee,Ie;for(ue in this.files)Ie=this.files[ue],(Ee=ue.slice(this.root.length,ue.length))&&ue.slice(0,this.root.length)===this.root&&oe(Ee,Ie)},filter:function(oe){var ue=[];return this.forEach(function(Ee,Ie){oe(Ee,Ie)&&ue.push(Ie)}),ue},file:function(oe,ue,Ee){if(arguments.length!==1)return oe=this.root+oe,b.call(this,oe,ue,Ee),this;if(te(oe)){var Ie=oe;return this.filter(function(Oe,ot){return!ot.dir&&Ie.test(Oe)})}var _e=this.files[this.root+oe];return _e&&!_e.dir?_e:null},folder:function(oe){if(!oe)return this;if(te(oe))return this.filter(function(_e,Oe){return Oe.dir&&oe.test(_e)});var ue=this.root+oe,Ee=Z.call(this,ue),Ie=this.clone();return Ie.root=Ee.name,Ie},remove:function(oe){oe=this.root+oe;var ue=this.files[oe];if(ue||(oe.slice(-1)!=="/"&&(oe+="/"),ue=this.files[oe]),ue&&!ue.dir)delete this.files[oe];else for(var Ee=this.filter(function(_e,Oe){return Oe.name.slice(0,oe.length)===oe}),Ie=0;Ie<Ee.length;Ie++)delete this.files[Ee[Ie].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(oe){var ue,Ee={};try{if((Ee=E.extend(oe||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:S.utf8encode})).type=Ee.type.toLowerCase(),Ee.compression=Ee.compression.toUpperCase(),Ee.type==="binarystring"&&(Ee.type="string"),!Ee.type)throw new Error("No output type specified.");E.checkSupport(Ee.type),Ee.platform!=="darwin"&&Ee.platform!=="freebsd"&&Ee.platform!=="linux"&&Ee.platform!=="sunos"||(Ee.platform="UNIX"),Ee.platform==="win32"&&(Ee.platform="DOS");var Ie=Ee.comment||this.comment||"";ue=F.generateWorker(this,Ee,Ie)}catch(_e){(ue=new N("error")).error(_e)}return new I(ue,Ee.type||"string",Ee.mimeType)},generateAsync:function(oe,ue){return this.generateInternalStream(oe).accumulate(ue)},generateNodeStream:function(oe,ue){return(oe=oe||{}).type||(oe.type="nodebuffer"),this.generateInternalStream(oe).toNodejsStream(ue)}};g.exports=ae},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(d,g,_){g.exports=d("stream")},{stream:void 0}],17:[function(d,g,_){var b=d("./DataReader");function S(E){b.call(this,E);for(var N=0;N<this.data.length;N++)E[N]=255&E[N]}d("../utils").inherits(S,b),S.prototype.byteAt=function(E){return this.data[this.zero+E]},S.prototype.lastIndexOfSignature=function(E){for(var N=E.charCodeAt(0),I=E.charCodeAt(1),B=E.charCodeAt(2),V=E.charCodeAt(3),U=this.length-4;0<=U;--U)if(this.data[U]===N&&this.data[U+1]===I&&this.data[U+2]===B&&this.data[U+3]===V)return U-this.zero;return-1},S.prototype.readAndCheckSignature=function(E){var N=E.charCodeAt(0),I=E.charCodeAt(1),B=E.charCodeAt(2),V=E.charCodeAt(3),U=this.readData(4);return N===U[0]&&I===U[1]&&B===U[2]&&V===U[3]},S.prototype.readData=function(E){if(this.checkOffset(E),E===0)return[];var N=this.data.slice(this.zero+this.index,this.zero+this.index+E);return this.index+=E,N},g.exports=S},{"../utils":32,"./DataReader":18}],18:[function(d,g,_){var b=d("../utils");function S(E){this.data=E,this.length=E.length,this.index=0,this.zero=0}S.prototype={checkOffset:function(E){this.checkIndex(this.index+E)},checkIndex:function(E){if(this.length<this.zero+E||E<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+E+"). Corrupted zip ?")},setIndex:function(E){this.checkIndex(E),this.index=E},skip:function(E){this.setIndex(this.index+E)},byteAt:function(){},readInt:function(E){var N,I=0;for(this.checkOffset(E),N=this.index+E-1;N>=this.index;N--)I=(I<<8)+this.byteAt(N);return this.index+=E,I},readString:function(E){return b.transformTo("string",this.readData(E))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var E=this.readInt(4);return new Date(Date.UTC(1980+(E>>25&127),(E>>21&15)-1,E>>16&31,E>>11&31,E>>5&63,(31&E)<<1))}},g.exports=S},{"../utils":32}],19:[function(d,g,_){var b=d("./Uint8ArrayReader");function S(E){b.call(this,E)}d("../utils").inherits(S,b),S.prototype.readData=function(E){this.checkOffset(E);var N=this.data.slice(this.zero+this.index,this.zero+this.index+E);return this.index+=E,N},g.exports=S},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(d,g,_){var b=d("./DataReader");function S(E){b.call(this,E)}d("../utils").inherits(S,b),S.prototype.byteAt=function(E){return this.data.charCodeAt(this.zero+E)},S.prototype.lastIndexOfSignature=function(E){return this.data.lastIndexOf(E)-this.zero},S.prototype.readAndCheckSignature=function(E){return E===this.readData(4)},S.prototype.readData=function(E){this.checkOffset(E);var N=this.data.slice(this.zero+this.index,this.zero+this.index+E);return this.index+=E,N},g.exports=S},{"../utils":32,"./DataReader":18}],21:[function(d,g,_){var b=d("./ArrayReader");function S(E){b.call(this,E)}d("../utils").inherits(S,b),S.prototype.readData=function(E){if(this.checkOffset(E),E===0)return new Uint8Array(0);var N=this.data.subarray(this.zero+this.index,this.zero+this.index+E);return this.index+=E,N},g.exports=S},{"../utils":32,"./ArrayReader":17}],22:[function(d,g,_){var b=d("../utils"),S=d("../support"),E=d("./ArrayReader"),N=d("./StringReader"),I=d("./NodeBufferReader"),B=d("./Uint8ArrayReader");g.exports=function(V){var U=b.getTypeOf(V);return b.checkSupport(U),U!=="string"||S.uint8array?U==="nodebuffer"?new I(V):S.uint8array?new B(b.transformTo("uint8array",V)):new E(b.transformTo("array",V)):new N(V)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(d,g,_){_.LOCAL_FILE_HEADER="PK",_.CENTRAL_FILE_HEADER="PK",_.CENTRAL_DIRECTORY_END="PK",_.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",_.ZIP64_CENTRAL_DIRECTORY_END="PK",_.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(d,g,_){var b=d("./GenericWorker"),S=d("../utils");function E(N){b.call(this,"ConvertWorker to "+N),this.destType=N}S.inherits(E,b),E.prototype.processChunk=function(N){this.push({data:S.transformTo(this.destType,N.data),meta:N.meta})},g.exports=E},{"../utils":32,"./GenericWorker":28}],25:[function(d,g,_){var b=d("./GenericWorker"),S=d("../crc32");function E(){b.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}d("../utils").inherits(E,b),E.prototype.processChunk=function(N){this.streamInfo.crc32=S(N.data,this.streamInfo.crc32||0),this.push(N)},g.exports=E},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(d,g,_){var b=d("../utils"),S=d("./GenericWorker");function E(N){S.call(this,"DataLengthProbe for "+N),this.propName=N,this.withStreamInfo(N,0)}b.inherits(E,S),E.prototype.processChunk=function(N){if(N){var I=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=I+N.data.length}S.prototype.processChunk.call(this,N)},g.exports=E},{"../utils":32,"./GenericWorker":28}],27:[function(d,g,_){var b=d("../utils"),S=d("./GenericWorker");function E(N){S.call(this,"DataWorker");var I=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,N.then(function(B){I.dataIsReady=!0,I.data=B,I.max=B&&B.length||0,I.type=b.getTypeOf(B),I.isPaused||I._tickAndRepeat()},function(B){I.error(B)})}b.inherits(E,S),E.prototype.cleanUp=function(){S.prototype.cleanUp.call(this),this.data=null},E.prototype.resume=function(){return!!S.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,b.delay(this._tickAndRepeat,[],this)),!0)},E.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(b.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},E.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var N=null,I=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":N=this.data.substring(this.index,I);break;case"uint8array":N=this.data.subarray(this.index,I);break;case"array":case"nodebuffer":N=this.data.slice(this.index,I)}return this.index=I,this.push({data:N,meta:{percent:this.max?this.index/this.max*100:0}})},g.exports=E},{"../utils":32,"./GenericWorker":28}],28:[function(d,g,_){function b(S){this.name=S||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}b.prototype={push:function(S){this.emit("data",S)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(S){this.emit("error",S)}return!0},error:function(S){return!this.isFinished&&(this.isPaused?this.generatedError=S:(this.isFinished=!0,this.emit("error",S),this.previous&&this.previous.error(S),this.cleanUp()),!0)},on:function(S,E){return this._listeners[S].push(E),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(S,E){if(this._listeners[S])for(var N=0;N<this._listeners[S].length;N++)this._listeners[S][N].call(this,E)},pipe:function(S){return S.registerPrevious(this)},registerPrevious:function(S){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=S.streamInfo,this.mergeStreamInfo(),this.previous=S;var E=this;return S.on("data",function(N){E.processChunk(N)}),S.on("end",function(){E.end()}),S.on("error",function(N){E.error(N)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var S=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),S=!0),this.previous&&this.previous.resume(),!S},flush:function(){},processChunk:function(S){this.push(S)},withStreamInfo:function(S,E){return this.extraStreamInfo[S]=E,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var S in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,S)&&(this.streamInfo[S]=this.extraStreamInfo[S])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var S="Worker "+this.name;return this.previous?this.previous+" -> "+S:S}},g.exports=b},{}],29:[function(d,g,_){var b=d("../utils"),S=d("./ConvertWorker"),E=d("./GenericWorker"),N=d("../base64"),I=d("../support"),B=d("../external"),V=null;if(I.nodestream)try{V=d("../nodejs/NodejsStreamOutputAdapter")}catch{}function U(H,G){return new B.Promise(function(W,X){var Z=[],te=H._internalType,ae=H._outputType,oe=H._mimeType;H.on("data",function(ue,Ee){Z.push(ue),G&&G(Ee)}).on("error",function(ue){Z=[],X(ue)}).on("end",function(){try{var ue=function(Ee,Ie,_e){switch(Ee){case"blob":return b.newBlob(b.transformTo("arraybuffer",Ie),_e);case"base64":return N.encode(Ie);default:return b.transformTo(Ee,Ie)}}(ae,function(Ee,Ie){var _e,Oe=0,ot=null,de=0;for(_e=0;_e<Ie.length;_e++)de+=Ie[_e].length;switch(Ee){case"string":return Ie.join("");case"array":return Array.prototype.concat.apply([],Ie);case"uint8array":for(ot=new Uint8Array(de),_e=0;_e<Ie.length;_e++)ot.set(Ie[_e],Oe),Oe+=Ie[_e].length;return ot;case"nodebuffer":return Buffer.concat(Ie);default:throw new Error("concat : unsupported type '"+Ee+"'")}}(te,Z),oe);W(ue)}catch(Ee){X(Ee)}Z=[]}).resume()})}function F(H,G,W){var X=G;switch(G){case"blob":case"arraybuffer":X="uint8array";break;case"base64":X="string"}try{this._internalType=X,this._outputType=G,this._mimeType=W,b.checkSupport(X),this._worker=H.pipe(new S(X)),H.lock()}catch(Z){this._worker=new E("error"),this._worker.error(Z)}}F.prototype={accumulate:function(H){return U(this,H)},on:function(H,G){var W=this;return H==="data"?this._worker.on(H,function(X){G.call(W,X.data,X.meta)}):this._worker.on(H,function(){b.delay(G,arguments,W)}),this},resume:function(){return b.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(H){if(b.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new V(this,{objectMode:this._outputType!=="nodebuffer"},H)}},g.exports=F},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(d,g,_){if(_.base64=!0,_.array=!0,_.string=!0,_.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",_.nodebuffer=typeof Buffer<"u",_.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")_.blob=!1;else{var b=new ArrayBuffer(0);try{_.blob=new Blob([b],{type:"application/zip"}).size===0}catch{try{var S=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);S.append(b),_.blob=S.getBlob("application/zip").size===0}catch{_.blob=!1}}}try{_.nodestream=!!d("readable-stream").Readable}catch{_.nodestream=!1}},{"readable-stream":16}],31:[function(d,g,_){for(var b=d("./utils"),S=d("./support"),E=d("./nodejsUtils"),N=d("./stream/GenericWorker"),I=new Array(256),B=0;B<256;B++)I[B]=252<=B?6:248<=B?5:240<=B?4:224<=B?3:192<=B?2:1;I[254]=I[254]=1;function V(){N.call(this,"utf-8 decode"),this.leftOver=null}function U(){N.call(this,"utf-8 encode")}_.utf8encode=function(F){return S.nodebuffer?E.newBufferFrom(F,"utf-8"):function(H){var G,W,X,Z,te,ae=H.length,oe=0;for(Z=0;Z<ae;Z++)(64512&(W=H.charCodeAt(Z)))==55296&&Z+1<ae&&(64512&(X=H.charCodeAt(Z+1)))==56320&&(W=65536+(W-55296<<10)+(X-56320),Z++),oe+=W<128?1:W<2048?2:W<65536?3:4;for(G=S.uint8array?new Uint8Array(oe):new Array(oe),Z=te=0;te<oe;Z++)(64512&(W=H.charCodeAt(Z)))==55296&&Z+1<ae&&(64512&(X=H.charCodeAt(Z+1)))==56320&&(W=65536+(W-55296<<10)+(X-56320),Z++),W<128?G[te++]=W:(W<2048?G[te++]=192|W>>>6:(W<65536?G[te++]=224|W>>>12:(G[te++]=240|W>>>18,G[te++]=128|W>>>12&63),G[te++]=128|W>>>6&63),G[te++]=128|63&W);return G}(F)},_.utf8decode=function(F){return S.nodebuffer?b.transformTo("nodebuffer",F).toString("utf-8"):function(H){var G,W,X,Z,te=H.length,ae=new Array(2*te);for(G=W=0;G<te;)if((X=H[G++])<128)ae[W++]=X;else if(4<(Z=I[X]))ae[W++]=65533,G+=Z-1;else{for(X&=Z===2?31:Z===3?15:7;1<Z&&G<te;)X=X<<6|63&H[G++],Z--;1<Z?ae[W++]=65533:X<65536?ae[W++]=X:(X-=65536,ae[W++]=55296|X>>10&1023,ae[W++]=56320|1023&X)}return ae.length!==W&&(ae.subarray?ae=ae.subarray(0,W):ae.length=W),b.applyFromCharCode(ae)}(F=b.transformTo(S.uint8array?"uint8array":"array",F))},b.inherits(V,N),V.prototype.processChunk=function(F){var H=b.transformTo(S.uint8array?"uint8array":"array",F.data);if(this.leftOver&&this.leftOver.length){if(S.uint8array){var G=H;(H=new Uint8Array(G.length+this.leftOver.length)).set(this.leftOver,0),H.set(G,this.leftOver.length)}else H=this.leftOver.concat(H);this.leftOver=null}var W=function(Z,te){var ae;for((te=te||Z.length)>Z.length&&(te=Z.length),ae=te-1;0<=ae&&(192&Z[ae])==128;)ae--;return ae<0||ae===0?te:ae+I[Z[ae]]>te?ae:te}(H),X=H;W!==H.length&&(S.uint8array?(X=H.subarray(0,W),this.leftOver=H.subarray(W,H.length)):(X=H.slice(0,W),this.leftOver=H.slice(W,H.length))),this.push({data:_.utf8decode(X),meta:F.meta})},V.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:_.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},_.Utf8DecodeWorker=V,b.inherits(U,N),U.prototype.processChunk=function(F){this.push({data:_.utf8encode(F.data),meta:F.meta})},_.Utf8EncodeWorker=U},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(d,g,_){var b=d("./support"),S=d("./base64"),E=d("./nodejsUtils"),N=d("./external");function I(G){return G}function B(G,W){for(var X=0;X<G.length;++X)W[X]=255&G.charCodeAt(X);return W}d("setimmediate"),_.newBlob=function(G,W){_.checkSupport("blob");try{return new Blob([G],{type:W})}catch{try{var X=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return X.append(G),X.getBlob(W)}catch{throw new Error("Bug : can't construct the Blob.")}}};var V={stringifyByChunk:function(G,W,X){var Z=[],te=0,ae=G.length;if(ae<=X)return String.fromCharCode.apply(null,G);for(;te<ae;)W==="array"||W==="nodebuffer"?Z.push(String.fromCharCode.apply(null,G.slice(te,Math.min(te+X,ae)))):Z.push(String.fromCharCode.apply(null,G.subarray(te,Math.min(te+X,ae)))),te+=X;return Z.join("")},stringifyByChar:function(G){for(var W="",X=0;X<G.length;X++)W+=String.fromCharCode(G[X]);return W},applyCanBeUsed:{uint8array:function(){try{return b.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return b.nodebuffer&&String.fromCharCode.apply(null,E.allocBuffer(1)).length===1}catch{return!1}}()}};function U(G){var W=65536,X=_.getTypeOf(G),Z=!0;if(X==="uint8array"?Z=V.applyCanBeUsed.uint8array:X==="nodebuffer"&&(Z=V.applyCanBeUsed.nodebuffer),Z)for(;1<W;)try{return V.stringifyByChunk(G,X,W)}catch{W=Math.floor(W/2)}return V.stringifyByChar(G)}function F(G,W){for(var X=0;X<G.length;X++)W[X]=G[X];return W}_.applyFromCharCode=U;var H={};H.string={string:I,array:function(G){return B(G,new Array(G.length))},arraybuffer:function(G){return H.string.uint8array(G).buffer},uint8array:function(G){return B(G,new Uint8Array(G.length))},nodebuffer:function(G){return B(G,E.allocBuffer(G.length))}},H.array={string:U,array:I,arraybuffer:function(G){return new Uint8Array(G).buffer},uint8array:function(G){return new Uint8Array(G)},nodebuffer:function(G){return E.newBufferFrom(G)}},H.arraybuffer={string:function(G){return U(new Uint8Array(G))},array:function(G){return F(new Uint8Array(G),new Array(G.byteLength))},arraybuffer:I,uint8array:function(G){return new Uint8Array(G)},nodebuffer:function(G){return E.newBufferFrom(new Uint8Array(G))}},H.uint8array={string:U,array:function(G){return F(G,new Array(G.length))},arraybuffer:function(G){return G.buffer},uint8array:I,nodebuffer:function(G){return E.newBufferFrom(G)}},H.nodebuffer={string:U,array:function(G){return F(G,new Array(G.length))},arraybuffer:function(G){return H.nodebuffer.uint8array(G).buffer},uint8array:function(G){return F(G,new Uint8Array(G.length))},nodebuffer:I},_.transformTo=function(G,W){if(W=W||"",!G)return W;_.checkSupport(G);var X=_.getTypeOf(W);return H[X][G](W)},_.resolve=function(G){for(var W=G.split("/"),X=[],Z=0;Z<W.length;Z++){var te=W[Z];te==="."||te===""&&Z!==0&&Z!==W.length-1||(te===".."?X.pop():X.push(te))}return X.join("/")},_.getTypeOf=function(G){return typeof G=="string"?"string":Object.prototype.toString.call(G)==="[object Array]"?"array":b.nodebuffer&&E.isBuffer(G)?"nodebuffer":b.uint8array&&G instanceof Uint8Array?"uint8array":b.arraybuffer&&G instanceof ArrayBuffer?"arraybuffer":void 0},_.checkSupport=function(G){if(!b[G.toLowerCase()])throw new Error(G+" is not supported by this platform")},_.MAX_VALUE_16BITS=65535,_.MAX_VALUE_32BITS=-1,_.pretty=function(G){var W,X,Z="";for(X=0;X<(G||"").length;X++)Z+="\\x"+((W=G.charCodeAt(X))<16?"0":"")+W.toString(16).toUpperCase();return Z},_.delay=function(G,W,X){setImmediate(function(){G.apply(X||null,W||[])})},_.inherits=function(G,W){function X(){}X.prototype=W.prototype,G.prototype=new X},_.extend=function(){var G,W,X={};for(G=0;G<arguments.length;G++)for(W in arguments[G])Object.prototype.hasOwnProperty.call(arguments[G],W)&&X[W]===void 0&&(X[W]=arguments[G][W]);return X},_.prepareContent=function(G,W,X,Z,te){return N.Promise.resolve(W).then(function(ae){return b.blob&&(ae instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(ae))!==-1)&&typeof FileReader<"u"?new N.Promise(function(oe,ue){var Ee=new FileReader;Ee.onload=function(Ie){oe(Ie.target.result)},Ee.onerror=function(Ie){ue(Ie.target.error)},Ee.readAsArrayBuffer(ae)}):ae}).then(function(ae){var oe=_.getTypeOf(ae);return oe?(oe==="arraybuffer"?ae=_.transformTo("uint8array",ae):oe==="string"&&(te?ae=S.decode(ae):X&&Z!==!0&&(ae=function(ue){return B(ue,b.uint8array?new Uint8Array(ue.length):new Array(ue.length))}(ae))),ae):N.Promise.reject(new Error("Can't read the data of '"+G+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(d,g,_){var b=d("./reader/readerFor"),S=d("./utils"),E=d("./signature"),N=d("./zipEntry"),I=d("./support");function B(V){this.files=[],this.loadOptions=V}B.prototype={checkSignature:function(V){if(!this.reader.readAndCheckSignature(V)){this.reader.index-=4;var U=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+S.pretty(U)+", expected "+S.pretty(V)+")")}},isSignature:function(V,U){var F=this.reader.index;this.reader.setIndex(V);var H=this.reader.readString(4)===U;return this.reader.setIndex(F),H},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var V=this.reader.readData(this.zipCommentLength),U=I.uint8array?"uint8array":"array",F=S.transformTo(U,V);this.zipComment=this.loadOptions.decodeFileName(F)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var V,U,F,H=this.zip64EndOfCentralSize-44;0<H;)V=this.reader.readInt(2),U=this.reader.readInt(4),F=this.reader.readData(U),this.zip64ExtensibleData[V]={id:V,length:U,value:F}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var V,U;for(V=0;V<this.files.length;V++)U=this.files[V],this.reader.setIndex(U.localHeaderOffset),this.checkSignature(E.LOCAL_FILE_HEADER),U.readLocalPart(this.reader),U.handleUTF8(),U.processAttributes()},readCentralDir:function(){var V;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(E.CENTRAL_FILE_HEADER);)(V=new N({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(V);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var V=this.reader.lastIndexOfSignature(E.CENTRAL_DIRECTORY_END);if(V<0)throw this.isSignature(0,E.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(V);var U=V;if(this.checkSignature(E.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===S.MAX_VALUE_16BITS||this.diskWithCentralDirStart===S.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===S.MAX_VALUE_16BITS||this.centralDirRecords===S.MAX_VALUE_16BITS||this.centralDirSize===S.MAX_VALUE_32BITS||this.centralDirOffset===S.MAX_VALUE_32BITS){if(this.zip64=!0,(V=this.reader.lastIndexOfSignature(E.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(V),this.checkSignature(E.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,E.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(E.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(E.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var F=this.centralDirOffset+this.centralDirSize;this.zip64&&(F+=20,F+=12+this.zip64EndOfCentralSize);var H=U-F;if(0<H)this.isSignature(U,E.CENTRAL_FILE_HEADER)||(this.reader.zero=H);else if(H<0)throw new Error("Corrupted zip: missing "+Math.abs(H)+" bytes.")},prepareReader:function(V){this.reader=b(V)},load:function(V){this.prepareReader(V),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},g.exports=B},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(d,g,_){var b=d("./reader/readerFor"),S=d("./utils"),E=d("./compressedObject"),N=d("./crc32"),I=d("./utf8"),B=d("./compressions"),V=d("./support");function U(F,H){this.options=F,this.loadOptions=H}U.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(F){var H,G;if(F.skip(22),this.fileNameLength=F.readInt(2),G=F.readInt(2),this.fileName=F.readData(this.fileNameLength),F.skip(G),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((H=function(W){for(var X in B)if(Object.prototype.hasOwnProperty.call(B,X)&&B[X].magic===W)return B[X];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+S.pretty(this.compressionMethod)+" unknown (inner file : "+S.transformTo("string",this.fileName)+")");this.decompressed=new E(this.compressedSize,this.uncompressedSize,this.crc32,H,F.readData(this.compressedSize))},readCentralPart:function(F){this.versionMadeBy=F.readInt(2),F.skip(2),this.bitFlag=F.readInt(2),this.compressionMethod=F.readString(2),this.date=F.readDate(),this.crc32=F.readInt(4),this.compressedSize=F.readInt(4),this.uncompressedSize=F.readInt(4);var H=F.readInt(2);if(this.extraFieldsLength=F.readInt(2),this.fileCommentLength=F.readInt(2),this.diskNumberStart=F.readInt(2),this.internalFileAttributes=F.readInt(2),this.externalFileAttributes=F.readInt(4),this.localHeaderOffset=F.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");F.skip(H),this.readExtraFields(F),this.parseZIP64ExtraField(F),this.fileComment=F.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var F=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),F==0&&(this.dosPermissions=63&this.externalFileAttributes),F==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var F=b(this.extraFields[1].value);this.uncompressedSize===S.MAX_VALUE_32BITS&&(this.uncompressedSize=F.readInt(8)),this.compressedSize===S.MAX_VALUE_32BITS&&(this.compressedSize=F.readInt(8)),this.localHeaderOffset===S.MAX_VALUE_32BITS&&(this.localHeaderOffset=F.readInt(8)),this.diskNumberStart===S.MAX_VALUE_32BITS&&(this.diskNumberStart=F.readInt(4))}},readExtraFields:function(F){var H,G,W,X=F.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});F.index+4<X;)H=F.readInt(2),G=F.readInt(2),W=F.readData(G),this.extraFields[H]={id:H,length:G,value:W};F.setIndex(X)},handleUTF8:function(){var F=V.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=I.utf8decode(this.fileName),this.fileCommentStr=I.utf8decode(this.fileComment);else{var H=this.findExtraFieldUnicodePath();if(H!==null)this.fileNameStr=H;else{var G=S.transformTo(F,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(G)}var W=this.findExtraFieldUnicodeComment();if(W!==null)this.fileCommentStr=W;else{var X=S.transformTo(F,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(X)}}},findExtraFieldUnicodePath:function(){var F=this.extraFields[28789];if(F){var H=b(F.value);return H.readInt(1)!==1||N(this.fileName)!==H.readInt(4)?null:I.utf8decode(H.readData(F.length-5))}return null},findExtraFieldUnicodeComment:function(){var F=this.extraFields[25461];if(F){var H=b(F.value);return H.readInt(1)!==1||N(this.fileComment)!==H.readInt(4)?null:I.utf8decode(H.readData(F.length-5))}return null}},g.exports=U},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(d,g,_){function b(H,G,W){this.name=H,this.dir=W.dir,this.date=W.date,this.comment=W.comment,this.unixPermissions=W.unixPermissions,this.dosPermissions=W.dosPermissions,this._data=G,this._dataBinary=W.binary,this.options={compression:W.compression,compressionOptions:W.compressionOptions}}var S=d("./stream/StreamHelper"),E=d("./stream/DataWorker"),N=d("./utf8"),I=d("./compressedObject"),B=d("./stream/GenericWorker");b.prototype={internalStream:function(H){var G=null,W="string";try{if(!H)throw new Error("No output type specified.");var X=(W=H.toLowerCase())==="string"||W==="text";W!=="binarystring"&&W!=="text"||(W="string"),G=this._decompressWorker();var Z=!this._dataBinary;Z&&!X&&(G=G.pipe(new N.Utf8EncodeWorker)),!Z&&X&&(G=G.pipe(new N.Utf8DecodeWorker))}catch(te){(G=new B("error")).error(te)}return new S(G,W,"")},async:function(H,G){return this.internalStream(H).accumulate(G)},nodeStream:function(H,G){return this.internalStream(H||"nodebuffer").toNodejsStream(G)},_compressWorker:function(H,G){if(this._data instanceof I&&this._data.compression.magic===H.magic)return this._data.getCompressedWorker();var W=this._decompressWorker();return this._dataBinary||(W=W.pipe(new N.Utf8EncodeWorker)),I.createWorkerFrom(W,H,G)},_decompressWorker:function(){return this._data instanceof I?this._data.getContentWorker():this._data instanceof B?this._data:new E(this._data)}};for(var V=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],U=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},F=0;F<V.length;F++)b.prototype[V[F]]=U;g.exports=b},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(d,g,_){(function(b){var S,E,N=b.MutationObserver||b.WebKitMutationObserver;if(N){var I=0,B=new N(H),V=b.document.createTextNode("");B.observe(V,{characterData:!0}),S=function(){V.data=I=++I%2}}else if(b.setImmediate||b.MessageChannel===void 0)S="document"in b&&"onreadystatechange"in b.document.createElement("script")?function(){var G=b.document.createElement("script");G.onreadystatechange=function(){H(),G.onreadystatechange=null,G.parentNode.removeChild(G),G=null},b.document.documentElement.appendChild(G)}:function(){setTimeout(H,0)};else{var U=new b.MessageChannel;U.port1.onmessage=H,S=function(){U.port2.postMessage(0)}}var F=[];function H(){var G,W;E=!0;for(var X=F.length;X;){for(W=F,F=[],G=-1;++G<X;)W[G]();X=F.length}E=!1}g.exports=function(G){F.push(G)!==1||E||S()}}).call(this,typeof lo<"u"?lo:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(d,g,_){var b=d("immediate");function S(){}var E={},N=["REJECTED"],I=["FULFILLED"],B=["PENDING"];function V(X){if(typeof X!="function")throw new TypeError("resolver must be a function");this.state=B,this.queue=[],this.outcome=void 0,X!==S&&G(this,X)}function U(X,Z,te){this.promise=X,typeof Z=="function"&&(this.onFulfilled=Z,this.callFulfilled=this.otherCallFulfilled),typeof te=="function"&&(this.onRejected=te,this.callRejected=this.otherCallRejected)}function F(X,Z,te){b(function(){var ae;try{ae=Z(te)}catch(oe){return E.reject(X,oe)}ae===X?E.reject(X,new TypeError("Cannot resolve promise with itself")):E.resolve(X,ae)})}function H(X){var Z=X&&X.then;if(X&&(typeof X=="object"||typeof X=="function")&&typeof Z=="function")return function(){Z.apply(X,arguments)}}function G(X,Z){var te=!1;function ae(Ee){te||(te=!0,E.reject(X,Ee))}function oe(Ee){te||(te=!0,E.resolve(X,Ee))}var ue=W(function(){Z(oe,ae)});ue.status==="error"&&ae(ue.value)}function W(X,Z){var te={};try{te.value=X(Z),te.status="success"}catch(ae){te.status="error",te.value=ae}return te}(g.exports=V).prototype.finally=function(X){if(typeof X!="function")return this;var Z=this.constructor;return this.then(function(te){return Z.resolve(X()).then(function(){return te})},function(te){return Z.resolve(X()).then(function(){throw te})})},V.prototype.catch=function(X){return this.then(null,X)},V.prototype.then=function(X,Z){if(typeof X!="function"&&this.state===I||typeof Z!="function"&&this.state===N)return this;var te=new this.constructor(S);return this.state!==B?F(te,this.state===I?X:Z,this.outcome):this.queue.push(new U(te,X,Z)),te},U.prototype.callFulfilled=function(X){E.resolve(this.promise,X)},U.prototype.otherCallFulfilled=function(X){F(this.promise,this.onFulfilled,X)},U.prototype.callRejected=function(X){E.reject(this.promise,X)},U.prototype.otherCallRejected=function(X){F(this.promise,this.onRejected,X)},E.resolve=function(X,Z){var te=W(H,Z);if(te.status==="error")return E.reject(X,te.value);var ae=te.value;if(ae)G(X,ae);else{X.state=I,X.outcome=Z;for(var oe=-1,ue=X.queue.length;++oe<ue;)X.queue[oe].callFulfilled(Z)}return X},E.reject=function(X,Z){X.state=N,X.outcome=Z;for(var te=-1,ae=X.queue.length;++te<ae;)X.queue[te].callRejected(Z);return X},V.resolve=function(X){return X instanceof this?X:E.resolve(new this(S),X)},V.reject=function(X){var Z=new this(S);return E.reject(Z,X)},V.all=function(X){var Z=this;if(Object.prototype.toString.call(X)!=="[object Array]")return this.reject(new TypeError("must be an array"));var te=X.length,ae=!1;if(!te)return this.resolve([]);for(var oe=new Array(te),ue=0,Ee=-1,Ie=new this(S);++Ee<te;)_e(X[Ee],Ee);return Ie;function _e(Oe,ot){Z.resolve(Oe).then(function(de){oe[ot]=de,++ue!==te||ae||(ae=!0,E.resolve(Ie,oe))},function(de){ae||(ae=!0,E.reject(Ie,de))})}},V.race=function(X){var Z=this;if(Object.prototype.toString.call(X)!=="[object Array]")return this.reject(new TypeError("must be an array"));var te=X.length,ae=!1;if(!te)return this.resolve([]);for(var oe=-1,ue=new this(S);++oe<te;)Ee=X[oe],Z.resolve(Ee).then(function(Ie){ae||(ae=!0,E.resolve(ue,Ie))},function(Ie){ae||(ae=!0,E.reject(ue,Ie))});var Ee;return ue}},{immediate:36}],38:[function(d,g,_){var b={};(0,d("./lib/utils/common").assign)(b,d("./lib/deflate"),d("./lib/inflate"),d("./lib/zlib/constants")),g.exports=b},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(d,g,_){var b=d("./zlib/deflate"),S=d("./utils/common"),E=d("./utils/strings"),N=d("./zlib/messages"),I=d("./zlib/zstream"),B=Object.prototype.toString,V=0,U=-1,F=0,H=8;function G(X){if(!(this instanceof G))return new G(X);this.options=S.assign({level:U,method:H,chunkSize:16384,windowBits:15,memLevel:8,strategy:F,to:""},X||{});var Z=this.options;Z.raw&&0<Z.windowBits?Z.windowBits=-Z.windowBits:Z.gzip&&0<Z.windowBits&&Z.windowBits<16&&(Z.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new I,this.strm.avail_out=0;var te=b.deflateInit2(this.strm,Z.level,Z.method,Z.windowBits,Z.memLevel,Z.strategy);if(te!==V)throw new Error(N[te]);if(Z.header&&b.deflateSetHeader(this.strm,Z.header),Z.dictionary){var ae;if(ae=typeof Z.dictionary=="string"?E.string2buf(Z.dictionary):B.call(Z.dictionary)==="[object ArrayBuffer]"?new Uint8Array(Z.dictionary):Z.dictionary,(te=b.deflateSetDictionary(this.strm,ae))!==V)throw new Error(N[te]);this._dict_set=!0}}function W(X,Z){var te=new G(Z);if(te.push(X,!0),te.err)throw te.msg||N[te.err];return te.result}G.prototype.push=function(X,Z){var te,ae,oe=this.strm,ue=this.options.chunkSize;if(this.ended)return!1;ae=Z===~~Z?Z:Z===!0?4:0,typeof X=="string"?oe.input=E.string2buf(X):B.call(X)==="[object ArrayBuffer]"?oe.input=new Uint8Array(X):oe.input=X,oe.next_in=0,oe.avail_in=oe.input.length;do{if(oe.avail_out===0&&(oe.output=new S.Buf8(ue),oe.next_out=0,oe.avail_out=ue),(te=b.deflate(oe,ae))!==1&&te!==V)return this.onEnd(te),!(this.ended=!0);oe.avail_out!==0&&(oe.avail_in!==0||ae!==4&&ae!==2)||(this.options.to==="string"?this.onData(E.buf2binstring(S.shrinkBuf(oe.output,oe.next_out))):this.onData(S.shrinkBuf(oe.output,oe.next_out)))}while((0<oe.avail_in||oe.avail_out===0)&&te!==1);return ae===4?(te=b.deflateEnd(this.strm),this.onEnd(te),this.ended=!0,te===V):ae!==2||(this.onEnd(V),!(oe.avail_out=0))},G.prototype.onData=function(X){this.chunks.push(X)},G.prototype.onEnd=function(X){X===V&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=X,this.msg=this.strm.msg},_.Deflate=G,_.deflate=W,_.deflateRaw=function(X,Z){return(Z=Z||{}).raw=!0,W(X,Z)},_.gzip=function(X,Z){return(Z=Z||{}).gzip=!0,W(X,Z)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(d,g,_){var b=d("./zlib/inflate"),S=d("./utils/common"),E=d("./utils/strings"),N=d("./zlib/constants"),I=d("./zlib/messages"),B=d("./zlib/zstream"),V=d("./zlib/gzheader"),U=Object.prototype.toString;function F(G){if(!(this instanceof F))return new F(G);this.options=S.assign({chunkSize:16384,windowBits:0,to:""},G||{});var W=this.options;W.raw&&0<=W.windowBits&&W.windowBits<16&&(W.windowBits=-W.windowBits,W.windowBits===0&&(W.windowBits=-15)),!(0<=W.windowBits&&W.windowBits<16)||G&&G.windowBits||(W.windowBits+=32),15<W.windowBits&&W.windowBits<48&&!(15&W.windowBits)&&(W.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new B,this.strm.avail_out=0;var X=b.inflateInit2(this.strm,W.windowBits);if(X!==N.Z_OK)throw new Error(I[X]);this.header=new V,b.inflateGetHeader(this.strm,this.header)}function H(G,W){var X=new F(W);if(X.push(G,!0),X.err)throw X.msg||I[X.err];return X.result}F.prototype.push=function(G,W){var X,Z,te,ae,oe,ue,Ee=this.strm,Ie=this.options.chunkSize,_e=this.options.dictionary,Oe=!1;if(this.ended)return!1;Z=W===~~W?W:W===!0?N.Z_FINISH:N.Z_NO_FLUSH,typeof G=="string"?Ee.input=E.binstring2buf(G):U.call(G)==="[object ArrayBuffer]"?Ee.input=new Uint8Array(G):Ee.input=G,Ee.next_in=0,Ee.avail_in=Ee.input.length;do{if(Ee.avail_out===0&&(Ee.output=new S.Buf8(Ie),Ee.next_out=0,Ee.avail_out=Ie),(X=b.inflate(Ee,N.Z_NO_FLUSH))===N.Z_NEED_DICT&&_e&&(ue=typeof _e=="string"?E.string2buf(_e):U.call(_e)==="[object ArrayBuffer]"?new Uint8Array(_e):_e,X=b.inflateSetDictionary(this.strm,ue)),X===N.Z_BUF_ERROR&&Oe===!0&&(X=N.Z_OK,Oe=!1),X!==N.Z_STREAM_END&&X!==N.Z_OK)return this.onEnd(X),!(this.ended=!0);Ee.next_out&&(Ee.avail_out!==0&&X!==N.Z_STREAM_END&&(Ee.avail_in!==0||Z!==N.Z_FINISH&&Z!==N.Z_SYNC_FLUSH)||(this.options.to==="string"?(te=E.utf8border(Ee.output,Ee.next_out),ae=Ee.next_out-te,oe=E.buf2string(Ee.output,te),Ee.next_out=ae,Ee.avail_out=Ie-ae,ae&&S.arraySet(Ee.output,Ee.output,te,ae,0),this.onData(oe)):this.onData(S.shrinkBuf(Ee.output,Ee.next_out)))),Ee.avail_in===0&&Ee.avail_out===0&&(Oe=!0)}while((0<Ee.avail_in||Ee.avail_out===0)&&X!==N.Z_STREAM_END);return X===N.Z_STREAM_END&&(Z=N.Z_FINISH),Z===N.Z_FINISH?(X=b.inflateEnd(this.strm),this.onEnd(X),this.ended=!0,X===N.Z_OK):Z!==N.Z_SYNC_FLUSH||(this.onEnd(N.Z_OK),!(Ee.avail_out=0))},F.prototype.onData=function(G){this.chunks.push(G)},F.prototype.onEnd=function(G){G===N.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=G,this.msg=this.strm.msg},_.Inflate=F,_.inflate=H,_.inflateRaw=function(G,W){return(W=W||{}).raw=!0,H(G,W)},_.ungzip=H},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(d,g,_){var b=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";_.assign=function(N){for(var I=Array.prototype.slice.call(arguments,1);I.length;){var B=I.shift();if(B){if(typeof B!="object")throw new TypeError(B+"must be non-object");for(var V in B)B.hasOwnProperty(V)&&(N[V]=B[V])}}return N},_.shrinkBuf=function(N,I){return N.length===I?N:N.subarray?N.subarray(0,I):(N.length=I,N)};var S={arraySet:function(N,I,B,V,U){if(I.subarray&&N.subarray)N.set(I.subarray(B,B+V),U);else for(var F=0;F<V;F++)N[U+F]=I[B+F]},flattenChunks:function(N){var I,B,V,U,F,H;for(I=V=0,B=N.length;I<B;I++)V+=N[I].length;for(H=new Uint8Array(V),I=U=0,B=N.length;I<B;I++)F=N[I],H.set(F,U),U+=F.length;return H}},E={arraySet:function(N,I,B,V,U){for(var F=0;F<V;F++)N[U+F]=I[B+F]},flattenChunks:function(N){return[].concat.apply([],N)}};_.setTyped=function(N){N?(_.Buf8=Uint8Array,_.Buf16=Uint16Array,_.Buf32=Int32Array,_.assign(_,S)):(_.Buf8=Array,_.Buf16=Array,_.Buf32=Array,_.assign(_,E))},_.setTyped(b)},{}],42:[function(d,g,_){var b=d("./common"),S=!0,E=!0;try{String.fromCharCode.apply(null,[0])}catch{S=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{E=!1}for(var N=new b.Buf8(256),I=0;I<256;I++)N[I]=252<=I?6:248<=I?5:240<=I?4:224<=I?3:192<=I?2:1;function B(V,U){if(U<65537&&(V.subarray&&E||!V.subarray&&S))return String.fromCharCode.apply(null,b.shrinkBuf(V,U));for(var F="",H=0;H<U;H++)F+=String.fromCharCode(V[H]);return F}N[254]=N[254]=1,_.string2buf=function(V){var U,F,H,G,W,X=V.length,Z=0;for(G=0;G<X;G++)(64512&(F=V.charCodeAt(G)))==55296&&G+1<X&&(64512&(H=V.charCodeAt(G+1)))==56320&&(F=65536+(F-55296<<10)+(H-56320),G++),Z+=F<128?1:F<2048?2:F<65536?3:4;for(U=new b.Buf8(Z),G=W=0;W<Z;G++)(64512&(F=V.charCodeAt(G)))==55296&&G+1<X&&(64512&(H=V.charCodeAt(G+1)))==56320&&(F=65536+(F-55296<<10)+(H-56320),G++),F<128?U[W++]=F:(F<2048?U[W++]=192|F>>>6:(F<65536?U[W++]=224|F>>>12:(U[W++]=240|F>>>18,U[W++]=128|F>>>12&63),U[W++]=128|F>>>6&63),U[W++]=128|63&F);return U},_.buf2binstring=function(V){return B(V,V.length)},_.binstring2buf=function(V){for(var U=new b.Buf8(V.length),F=0,H=U.length;F<H;F++)U[F]=V.charCodeAt(F);return U},_.buf2string=function(V,U){var F,H,G,W,X=U||V.length,Z=new Array(2*X);for(F=H=0;F<X;)if((G=V[F++])<128)Z[H++]=G;else if(4<(W=N[G]))Z[H++]=65533,F+=W-1;else{for(G&=W===2?31:W===3?15:7;1<W&&F<X;)G=G<<6|63&V[F++],W--;1<W?Z[H++]=65533:G<65536?Z[H++]=G:(G-=65536,Z[H++]=55296|G>>10&1023,Z[H++]=56320|1023&G)}return B(Z,H)},_.utf8border=function(V,U){var F;for((U=U||V.length)>V.length&&(U=V.length),F=U-1;0<=F&&(192&V[F])==128;)F--;return F<0||F===0?U:F+N[V[F]]>U?F:U}},{"./common":41}],43:[function(d,g,_){g.exports=function(b,S,E,N){for(var I=65535&b|0,B=b>>>16&65535|0,V=0;E!==0;){for(E-=V=2e3<E?2e3:E;B=B+(I=I+S[N++]|0)|0,--V;);I%=65521,B%=65521}return I|B<<16|0}},{}],44:[function(d,g,_){g.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(d,g,_){var b=function(){for(var S,E=[],N=0;N<256;N++){S=N;for(var I=0;I<8;I++)S=1&S?3988292384^S>>>1:S>>>1;E[N]=S}return E}();g.exports=function(S,E,N,I){var B=b,V=I+N;S^=-1;for(var U=I;U<V;U++)S=S>>>8^B[255&(S^E[U])];return-1^S}},{}],46:[function(d,g,_){var b,S=d("../utils/common"),E=d("./trees"),N=d("./adler32"),I=d("./crc32"),B=d("./messages"),V=0,U=4,F=0,H=-2,G=-1,W=4,X=2,Z=8,te=9,ae=286,oe=30,ue=19,Ee=2*ae+1,Ie=15,_e=3,Oe=258,ot=Oe+_e+1,de=42,Be=113,re=1,Ye=2,nn=3,ke=4;function Re(ie,_t){return ie.msg=B[_t],_t}function Ze(ie){return(ie<<1)-(4<ie?9:0)}function Pt(ie){for(var _t=ie.length;0<=--_t;)ie[_t]=0}function pe(ie){var _t=ie.state,yt=_t.pending;yt>ie.avail_out&&(yt=ie.avail_out),yt!==0&&(S.arraySet(ie.output,_t.pending_buf,_t.pending_out,yt,ie.next_out),ie.next_out+=yt,_t.pending_out+=yt,ie.total_out+=yt,ie.avail_out-=yt,_t.pending-=yt,_t.pending===0&&(_t.pending_out=0))}function xe(ie,_t){E._tr_flush_block(ie,0<=ie.block_start?ie.block_start:-1,ie.strstart-ie.block_start,_t),ie.block_start=ie.strstart,pe(ie.strm)}function ct(ie,_t){ie.pending_buf[ie.pending++]=_t}function dt(ie,_t){ie.pending_buf[ie.pending++]=_t>>>8&255,ie.pending_buf[ie.pending++]=255&_t}function gt(ie,_t){var yt,Te,we=ie.max_chain_length,et=ie.strstart,Dt=ie.prev_length,qt=ie.nice_match,ut=ie.strstart>ie.w_size-ot?ie.strstart-(ie.w_size-ot):0,rn=ie.window,Gt=ie.w_mask,Xt=ie.prev,or=ie.strstart+Oe,Mi=rn[et+Dt-1],Pr=rn[et+Dt];ie.prev_length>=ie.good_match&&(we>>=2),qt>ie.lookahead&&(qt=ie.lookahead);do if(rn[(yt=_t)+Dt]===Pr&&rn[yt+Dt-1]===Mi&&rn[yt]===rn[et]&&rn[++yt]===rn[et+1]){et+=2,yt++;do;while(rn[++et]===rn[++yt]&&rn[++et]===rn[++yt]&&rn[++et]===rn[++yt]&&rn[++et]===rn[++yt]&&rn[++et]===rn[++yt]&&rn[++et]===rn[++yt]&&rn[++et]===rn[++yt]&&rn[++et]===rn[++yt]&&et<or);if(Te=Oe-(or-et),et=or-Oe,Dt<Te){if(ie.match_start=_t,qt<=(Dt=Te))break;Mi=rn[et+Dt-1],Pr=rn[et+Dt]}}while((_t=Xt[_t&Gt])>ut&&--we!=0);return Dt<=ie.lookahead?Dt:ie.lookahead}function Je(ie){var _t,yt,Te,we,et,Dt,qt,ut,rn,Gt,Xt=ie.w_size;do{if(we=ie.window_size-ie.lookahead-ie.strstart,ie.strstart>=Xt+(Xt-ot)){for(S.arraySet(ie.window,ie.window,Xt,Xt,0),ie.match_start-=Xt,ie.strstart-=Xt,ie.block_start-=Xt,_t=yt=ie.hash_size;Te=ie.head[--_t],ie.head[_t]=Xt<=Te?Te-Xt:0,--yt;);for(_t=yt=Xt;Te=ie.prev[--_t],ie.prev[_t]=Xt<=Te?Te-Xt:0,--yt;);we+=Xt}if(ie.strm.avail_in===0)break;if(Dt=ie.strm,qt=ie.window,ut=ie.strstart+ie.lookahead,rn=we,Gt=void 0,Gt=Dt.avail_in,rn<Gt&&(Gt=rn),yt=Gt===0?0:(Dt.avail_in-=Gt,S.arraySet(qt,Dt.input,Dt.next_in,Gt,ut),Dt.state.wrap===1?Dt.adler=N(Dt.adler,qt,Gt,ut):Dt.state.wrap===2&&(Dt.adler=I(Dt.adler,qt,Gt,ut)),Dt.next_in+=Gt,Dt.total_in+=Gt,Gt),ie.lookahead+=yt,ie.lookahead+ie.insert>=_e)for(et=ie.strstart-ie.insert,ie.ins_h=ie.window[et],ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[et+1])&ie.hash_mask;ie.insert&&(ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[et+_e-1])&ie.hash_mask,ie.prev[et&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=et,et++,ie.insert--,!(ie.lookahead+ie.insert<_e)););}while(ie.lookahead<ot&&ie.strm.avail_in!==0)}function kn(ie,_t){for(var yt,Te;;){if(ie.lookahead<ot){if(Je(ie),ie.lookahead<ot&&_t===V)return re;if(ie.lookahead===0)break}if(yt=0,ie.lookahead>=_e&&(ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+_e-1])&ie.hash_mask,yt=ie.prev[ie.strstart&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=ie.strstart),yt!==0&&ie.strstart-yt<=ie.w_size-ot&&(ie.match_length=gt(ie,yt)),ie.match_length>=_e)if(Te=E._tr_tally(ie,ie.strstart-ie.match_start,ie.match_length-_e),ie.lookahead-=ie.match_length,ie.match_length<=ie.max_lazy_match&&ie.lookahead>=_e){for(ie.match_length--;ie.strstart++,ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+_e-1])&ie.hash_mask,yt=ie.prev[ie.strstart&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=ie.strstart,--ie.match_length!=0;);ie.strstart++}else ie.strstart+=ie.match_length,ie.match_length=0,ie.ins_h=ie.window[ie.strstart],ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+1])&ie.hash_mask;else Te=E._tr_tally(ie,0,ie.window[ie.strstart]),ie.lookahead--,ie.strstart++;if(Te&&(xe(ie,!1),ie.strm.avail_out===0))return re}return ie.insert=ie.strstart<_e-1?ie.strstart:_e-1,_t===U?(xe(ie,!0),ie.strm.avail_out===0?nn:ke):ie.last_lit&&(xe(ie,!1),ie.strm.avail_out===0)?re:Ye}function Mt(ie,_t){for(var yt,Te,we;;){if(ie.lookahead<ot){if(Je(ie),ie.lookahead<ot&&_t===V)return re;if(ie.lookahead===0)break}if(yt=0,ie.lookahead>=_e&&(ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+_e-1])&ie.hash_mask,yt=ie.prev[ie.strstart&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=ie.strstart),ie.prev_length=ie.match_length,ie.prev_match=ie.match_start,ie.match_length=_e-1,yt!==0&&ie.prev_length<ie.max_lazy_match&&ie.strstart-yt<=ie.w_size-ot&&(ie.match_length=gt(ie,yt),ie.match_length<=5&&(ie.strategy===1||ie.match_length===_e&&4096<ie.strstart-ie.match_start)&&(ie.match_length=_e-1)),ie.prev_length>=_e&&ie.match_length<=ie.prev_length){for(we=ie.strstart+ie.lookahead-_e,Te=E._tr_tally(ie,ie.strstart-1-ie.prev_match,ie.prev_length-_e),ie.lookahead-=ie.prev_length-1,ie.prev_length-=2;++ie.strstart<=we&&(ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[ie.strstart+_e-1])&ie.hash_mask,yt=ie.prev[ie.strstart&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=ie.strstart),--ie.prev_length!=0;);if(ie.match_available=0,ie.match_length=_e-1,ie.strstart++,Te&&(xe(ie,!1),ie.strm.avail_out===0))return re}else if(ie.match_available){if((Te=E._tr_tally(ie,0,ie.window[ie.strstart-1]))&&xe(ie,!1),ie.strstart++,ie.lookahead--,ie.strm.avail_out===0)return re}else ie.match_available=1,ie.strstart++,ie.lookahead--}return ie.match_available&&(Te=E._tr_tally(ie,0,ie.window[ie.strstart-1]),ie.match_available=0),ie.insert=ie.strstart<_e-1?ie.strstart:_e-1,_t===U?(xe(ie,!0),ie.strm.avail_out===0?nn:ke):ie.last_lit&&(xe(ie,!1),ie.strm.avail_out===0)?re:Ye}function En(ie,_t,yt,Te,we){this.good_length=ie,this.max_lazy=_t,this.nice_length=yt,this.max_chain=Te,this.func=we}function Yn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new S.Buf16(2*Ee),this.dyn_dtree=new S.Buf16(2*(2*oe+1)),this.bl_tree=new S.Buf16(2*(2*ue+1)),Pt(this.dyn_ltree),Pt(this.dyn_dtree),Pt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new S.Buf16(Ie+1),this.heap=new S.Buf16(2*ae+1),Pt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new S.Buf16(2*ae+1),Pt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function gr(ie){var _t;return ie&&ie.state?(ie.total_in=ie.total_out=0,ie.data_type=X,(_t=ie.state).pending=0,_t.pending_out=0,_t.wrap<0&&(_t.wrap=-_t.wrap),_t.status=_t.wrap?de:Be,ie.adler=_t.wrap===2?0:1,_t.last_flush=V,E._tr_init(_t),F):Re(ie,H)}function dr(ie){var _t=gr(ie);return _t===F&&function(yt){yt.window_size=2*yt.w_size,Pt(yt.head),yt.max_lazy_match=b[yt.level].max_lazy,yt.good_match=b[yt.level].good_length,yt.nice_match=b[yt.level].nice_length,yt.max_chain_length=b[yt.level].max_chain,yt.strstart=0,yt.block_start=0,yt.lookahead=0,yt.insert=0,yt.match_length=yt.prev_length=_e-1,yt.match_available=0,yt.ins_h=0}(ie.state),_t}function ki(ie,_t,yt,Te,we,et){if(!ie)return H;var Dt=1;if(_t===G&&(_t=6),Te<0?(Dt=0,Te=-Te):15<Te&&(Dt=2,Te-=16),we<1||te<we||yt!==Z||Te<8||15<Te||_t<0||9<_t||et<0||W<et)return Re(ie,H);Te===8&&(Te=9);var qt=new Yn;return(ie.state=qt).strm=ie,qt.wrap=Dt,qt.gzhead=null,qt.w_bits=Te,qt.w_size=1<<qt.w_bits,qt.w_mask=qt.w_size-1,qt.hash_bits=we+7,qt.hash_size=1<<qt.hash_bits,qt.hash_mask=qt.hash_size-1,qt.hash_shift=~~((qt.hash_bits+_e-1)/_e),qt.window=new S.Buf8(2*qt.w_size),qt.head=new S.Buf16(qt.hash_size),qt.prev=new S.Buf16(qt.w_size),qt.lit_bufsize=1<<we+6,qt.pending_buf_size=4*qt.lit_bufsize,qt.pending_buf=new S.Buf8(qt.pending_buf_size),qt.d_buf=1*qt.lit_bufsize,qt.l_buf=3*qt.lit_bufsize,qt.level=_t,qt.strategy=et,qt.method=yt,dr(ie)}b=[new En(0,0,0,0,function(ie,_t){var yt=65535;for(yt>ie.pending_buf_size-5&&(yt=ie.pending_buf_size-5);;){if(ie.lookahead<=1){if(Je(ie),ie.lookahead===0&&_t===V)return re;if(ie.lookahead===0)break}ie.strstart+=ie.lookahead,ie.lookahead=0;var Te=ie.block_start+yt;if((ie.strstart===0||ie.strstart>=Te)&&(ie.lookahead=ie.strstart-Te,ie.strstart=Te,xe(ie,!1),ie.strm.avail_out===0)||ie.strstart-ie.block_start>=ie.w_size-ot&&(xe(ie,!1),ie.strm.avail_out===0))return re}return ie.insert=0,_t===U?(xe(ie,!0),ie.strm.avail_out===0?nn:ke):(ie.strstart>ie.block_start&&(xe(ie,!1),ie.strm.avail_out),re)}),new En(4,4,8,4,kn),new En(4,5,16,8,kn),new En(4,6,32,32,kn),new En(4,4,16,16,Mt),new En(8,16,32,32,Mt),new En(8,16,128,128,Mt),new En(8,32,128,256,Mt),new En(32,128,258,1024,Mt),new En(32,258,258,4096,Mt)],_.deflateInit=function(ie,_t){return ki(ie,_t,Z,15,8,0)},_.deflateInit2=ki,_.deflateReset=dr,_.deflateResetKeep=gr,_.deflateSetHeader=function(ie,_t){return ie&&ie.state?ie.state.wrap!==2?H:(ie.state.gzhead=_t,F):H},_.deflate=function(ie,_t){var yt,Te,we,et;if(!ie||!ie.state||5<_t||_t<0)return ie?Re(ie,H):H;if(Te=ie.state,!ie.output||!ie.input&&ie.avail_in!==0||Te.status===666&&_t!==U)return Re(ie,ie.avail_out===0?-5:H);if(Te.strm=ie,yt=Te.last_flush,Te.last_flush=_t,Te.status===de)if(Te.wrap===2)ie.adler=0,ct(Te,31),ct(Te,139),ct(Te,8),Te.gzhead?(ct(Te,(Te.gzhead.text?1:0)+(Te.gzhead.hcrc?2:0)+(Te.gzhead.extra?4:0)+(Te.gzhead.name?8:0)+(Te.gzhead.comment?16:0)),ct(Te,255&Te.gzhead.time),ct(Te,Te.gzhead.time>>8&255),ct(Te,Te.gzhead.time>>16&255),ct(Te,Te.gzhead.time>>24&255),ct(Te,Te.level===9?2:2<=Te.strategy||Te.level<2?4:0),ct(Te,255&Te.gzhead.os),Te.gzhead.extra&&Te.gzhead.extra.length&&(ct(Te,255&Te.gzhead.extra.length),ct(Te,Te.gzhead.extra.length>>8&255)),Te.gzhead.hcrc&&(ie.adler=I(ie.adler,Te.pending_buf,Te.pending,0)),Te.gzindex=0,Te.status=69):(ct(Te,0),ct(Te,0),ct(Te,0),ct(Te,0),ct(Te,0),ct(Te,Te.level===9?2:2<=Te.strategy||Te.level<2?4:0),ct(Te,3),Te.status=Be);else{var Dt=Z+(Te.w_bits-8<<4)<<8;Dt|=(2<=Te.strategy||Te.level<2?0:Te.level<6?1:Te.level===6?2:3)<<6,Te.strstart!==0&&(Dt|=32),Dt+=31-Dt%31,Te.status=Be,dt(Te,Dt),Te.strstart!==0&&(dt(Te,ie.adler>>>16),dt(Te,65535&ie.adler)),ie.adler=1}if(Te.status===69)if(Te.gzhead.extra){for(we=Te.pending;Te.gzindex<(65535&Te.gzhead.extra.length)&&(Te.pending!==Te.pending_buf_size||(Te.gzhead.hcrc&&Te.pending>we&&(ie.adler=I(ie.adler,Te.pending_buf,Te.pending-we,we)),pe(ie),we=Te.pending,Te.pending!==Te.pending_buf_size));)ct(Te,255&Te.gzhead.extra[Te.gzindex]),Te.gzindex++;Te.gzhead.hcrc&&Te.pending>we&&(ie.adler=I(ie.adler,Te.pending_buf,Te.pending-we,we)),Te.gzindex===Te.gzhead.extra.length&&(Te.gzindex=0,Te.status=73)}else Te.status=73;if(Te.status===73)if(Te.gzhead.name){we=Te.pending;do{if(Te.pending===Te.pending_buf_size&&(Te.gzhead.hcrc&&Te.pending>we&&(ie.adler=I(ie.adler,Te.pending_buf,Te.pending-we,we)),pe(ie),we=Te.pending,Te.pending===Te.pending_buf_size)){et=1;break}et=Te.gzindex<Te.gzhead.name.length?255&Te.gzhead.name.charCodeAt(Te.gzindex++):0,ct(Te,et)}while(et!==0);Te.gzhead.hcrc&&Te.pending>we&&(ie.adler=I(ie.adler,Te.pending_buf,Te.pending-we,we)),et===0&&(Te.gzindex=0,Te.status=91)}else Te.status=91;if(Te.status===91)if(Te.gzhead.comment){we=Te.pending;do{if(Te.pending===Te.pending_buf_size&&(Te.gzhead.hcrc&&Te.pending>we&&(ie.adler=I(ie.adler,Te.pending_buf,Te.pending-we,we)),pe(ie),we=Te.pending,Te.pending===Te.pending_buf_size)){et=1;break}et=Te.gzindex<Te.gzhead.comment.length?255&Te.gzhead.comment.charCodeAt(Te.gzindex++):0,ct(Te,et)}while(et!==0);Te.gzhead.hcrc&&Te.pending>we&&(ie.adler=I(ie.adler,Te.pending_buf,Te.pending-we,we)),et===0&&(Te.status=103)}else Te.status=103;if(Te.status===103&&(Te.gzhead.hcrc?(Te.pending+2>Te.pending_buf_size&&pe(ie),Te.pending+2<=Te.pending_buf_size&&(ct(Te,255&ie.adler),ct(Te,ie.adler>>8&255),ie.adler=0,Te.status=Be)):Te.status=Be),Te.pending!==0){if(pe(ie),ie.avail_out===0)return Te.last_flush=-1,F}else if(ie.avail_in===0&&Ze(_t)<=Ze(yt)&&_t!==U)return Re(ie,-5);if(Te.status===666&&ie.avail_in!==0)return Re(ie,-5);if(ie.avail_in!==0||Te.lookahead!==0||_t!==V&&Te.status!==666){var qt=Te.strategy===2?function(ut,rn){for(var Gt;;){if(ut.lookahead===0&&(Je(ut),ut.lookahead===0)){if(rn===V)return re;break}if(ut.match_length=0,Gt=E._tr_tally(ut,0,ut.window[ut.strstart]),ut.lookahead--,ut.strstart++,Gt&&(xe(ut,!1),ut.strm.avail_out===0))return re}return ut.insert=0,rn===U?(xe(ut,!0),ut.strm.avail_out===0?nn:ke):ut.last_lit&&(xe(ut,!1),ut.strm.avail_out===0)?re:Ye}(Te,_t):Te.strategy===3?function(ut,rn){for(var Gt,Xt,or,Mi,Pr=ut.window;;){if(ut.lookahead<=Oe){if(Je(ut),ut.lookahead<=Oe&&rn===V)return re;if(ut.lookahead===0)break}if(ut.match_length=0,ut.lookahead>=_e&&0<ut.strstart&&(Xt=Pr[or=ut.strstart-1])===Pr[++or]&&Xt===Pr[++or]&&Xt===Pr[++or]){Mi=ut.strstart+Oe;do;while(Xt===Pr[++or]&&Xt===Pr[++or]&&Xt===Pr[++or]&&Xt===Pr[++or]&&Xt===Pr[++or]&&Xt===Pr[++or]&&Xt===Pr[++or]&&Xt===Pr[++or]&&or<Mi);ut.match_length=Oe-(Mi-or),ut.match_length>ut.lookahead&&(ut.match_length=ut.lookahead)}if(ut.match_length>=_e?(Gt=E._tr_tally(ut,1,ut.match_length-_e),ut.lookahead-=ut.match_length,ut.strstart+=ut.match_length,ut.match_length=0):(Gt=E._tr_tally(ut,0,ut.window[ut.strstart]),ut.lookahead--,ut.strstart++),Gt&&(xe(ut,!1),ut.strm.avail_out===0))return re}return ut.insert=0,rn===U?(xe(ut,!0),ut.strm.avail_out===0?nn:ke):ut.last_lit&&(xe(ut,!1),ut.strm.avail_out===0)?re:Ye}(Te,_t):b[Te.level].func(Te,_t);if(qt!==nn&&qt!==ke||(Te.status=666),qt===re||qt===nn)return ie.avail_out===0&&(Te.last_flush=-1),F;if(qt===Ye&&(_t===1?E._tr_align(Te):_t!==5&&(E._tr_stored_block(Te,0,0,!1),_t===3&&(Pt(Te.head),Te.lookahead===0&&(Te.strstart=0,Te.block_start=0,Te.insert=0))),pe(ie),ie.avail_out===0))return Te.last_flush=-1,F}return _t!==U?F:Te.wrap<=0?1:(Te.wrap===2?(ct(Te,255&ie.adler),ct(Te,ie.adler>>8&255),ct(Te,ie.adler>>16&255),ct(Te,ie.adler>>24&255),ct(Te,255&ie.total_in),ct(Te,ie.total_in>>8&255),ct(Te,ie.total_in>>16&255),ct(Te,ie.total_in>>24&255)):(dt(Te,ie.adler>>>16),dt(Te,65535&ie.adler)),pe(ie),0<Te.wrap&&(Te.wrap=-Te.wrap),Te.pending!==0?F:1)},_.deflateEnd=function(ie){var _t;return ie&&ie.state?(_t=ie.state.status)!==de&&_t!==69&&_t!==73&&_t!==91&&_t!==103&&_t!==Be&&_t!==666?Re(ie,H):(ie.state=null,_t===Be?Re(ie,-3):F):H},_.deflateSetDictionary=function(ie,_t){var yt,Te,we,et,Dt,qt,ut,rn,Gt=_t.length;if(!ie||!ie.state||(et=(yt=ie.state).wrap)===2||et===1&&yt.status!==de||yt.lookahead)return H;for(et===1&&(ie.adler=N(ie.adler,_t,Gt,0)),yt.wrap=0,Gt>=yt.w_size&&(et===0&&(Pt(yt.head),yt.strstart=0,yt.block_start=0,yt.insert=0),rn=new S.Buf8(yt.w_size),S.arraySet(rn,_t,Gt-yt.w_size,yt.w_size,0),_t=rn,Gt=yt.w_size),Dt=ie.avail_in,qt=ie.next_in,ut=ie.input,ie.avail_in=Gt,ie.next_in=0,ie.input=_t,Je(yt);yt.lookahead>=_e;){for(Te=yt.strstart,we=yt.lookahead-(_e-1);yt.ins_h=(yt.ins_h<<yt.hash_shift^yt.window[Te+_e-1])&yt.hash_mask,yt.prev[Te&yt.w_mask]=yt.head[yt.ins_h],yt.head[yt.ins_h]=Te,Te++,--we;);yt.strstart=Te,yt.lookahead=_e-1,Je(yt)}return yt.strstart+=yt.lookahead,yt.block_start=yt.strstart,yt.insert=yt.lookahead,yt.lookahead=0,yt.match_length=yt.prev_length=_e-1,yt.match_available=0,ie.next_in=qt,ie.input=ut,ie.avail_in=Dt,yt.wrap=et,F},_.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(d,g,_){g.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(d,g,_){g.exports=function(b,S){var E,N,I,B,V,U,F,H,G,W,X,Z,te,ae,oe,ue,Ee,Ie,_e,Oe,ot,de,Be,re,Ye;E=b.state,N=b.next_in,re=b.input,I=N+(b.avail_in-5),B=b.next_out,Ye=b.output,V=B-(S-b.avail_out),U=B+(b.avail_out-257),F=E.dmax,H=E.wsize,G=E.whave,W=E.wnext,X=E.window,Z=E.hold,te=E.bits,ae=E.lencode,oe=E.distcode,ue=(1<<E.lenbits)-1,Ee=(1<<E.distbits)-1;e:do{te<15&&(Z+=re[N++]<<te,te+=8,Z+=re[N++]<<te,te+=8),Ie=ae[Z&ue];t:for(;;){if(Z>>>=_e=Ie>>>24,te-=_e,(_e=Ie>>>16&255)===0)Ye[B++]=65535&Ie;else{if(!(16&_e)){if(!(64&_e)){Ie=ae[(65535&Ie)+(Z&(1<<_e)-1)];continue t}if(32&_e){E.mode=12;break e}b.msg="invalid literal/length code",E.mode=30;break e}Oe=65535&Ie,(_e&=15)&&(te<_e&&(Z+=re[N++]<<te,te+=8),Oe+=Z&(1<<_e)-1,Z>>>=_e,te-=_e),te<15&&(Z+=re[N++]<<te,te+=8,Z+=re[N++]<<te,te+=8),Ie=oe[Z&Ee];n:for(;;){if(Z>>>=_e=Ie>>>24,te-=_e,!(16&(_e=Ie>>>16&255))){if(!(64&_e)){Ie=oe[(65535&Ie)+(Z&(1<<_e)-1)];continue n}b.msg="invalid distance code",E.mode=30;break e}if(ot=65535&Ie,te<(_e&=15)&&(Z+=re[N++]<<te,(te+=8)<_e&&(Z+=re[N++]<<te,te+=8)),F<(ot+=Z&(1<<_e)-1)){b.msg="invalid distance too far back",E.mode=30;break e}if(Z>>>=_e,te-=_e,(_e=B-V)<ot){if(G<(_e=ot-_e)&&E.sane){b.msg="invalid distance too far back",E.mode=30;break e}if(Be=X,(de=0)===W){if(de+=H-_e,_e<Oe){for(Oe-=_e;Ye[B++]=X[de++],--_e;);de=B-ot,Be=Ye}}else if(W<_e){if(de+=H+W-_e,(_e-=W)<Oe){for(Oe-=_e;Ye[B++]=X[de++],--_e;);if(de=0,W<Oe){for(Oe-=_e=W;Ye[B++]=X[de++],--_e;);de=B-ot,Be=Ye}}}else if(de+=W-_e,_e<Oe){for(Oe-=_e;Ye[B++]=X[de++],--_e;);de=B-ot,Be=Ye}for(;2<Oe;)Ye[B++]=Be[de++],Ye[B++]=Be[de++],Ye[B++]=Be[de++],Oe-=3;Oe&&(Ye[B++]=Be[de++],1<Oe&&(Ye[B++]=Be[de++]))}else{for(de=B-ot;Ye[B++]=Ye[de++],Ye[B++]=Ye[de++],Ye[B++]=Ye[de++],2<(Oe-=3););Oe&&(Ye[B++]=Ye[de++],1<Oe&&(Ye[B++]=Ye[de++]))}break}}break}}while(N<I&&B<U);N-=Oe=te>>3,Z&=(1<<(te-=Oe<<3))-1,b.next_in=N,b.next_out=B,b.avail_in=N<I?I-N+5:5-(N-I),b.avail_out=B<U?U-B+257:257-(B-U),E.hold=Z,E.bits=te}},{}],49:[function(d,g,_){var b=d("../utils/common"),S=d("./adler32"),E=d("./crc32"),N=d("./inffast"),I=d("./inftrees"),B=1,V=2,U=0,F=-2,H=1,G=852,W=592;function X(de){return(de>>>24&255)+(de>>>8&65280)+((65280&de)<<8)+((255&de)<<24)}function Z(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new b.Buf16(320),this.work=new b.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function te(de){var Be;return de&&de.state?(Be=de.state,de.total_in=de.total_out=Be.total=0,de.msg="",Be.wrap&&(de.adler=1&Be.wrap),Be.mode=H,Be.last=0,Be.havedict=0,Be.dmax=32768,Be.head=null,Be.hold=0,Be.bits=0,Be.lencode=Be.lendyn=new b.Buf32(G),Be.distcode=Be.distdyn=new b.Buf32(W),Be.sane=1,Be.back=-1,U):F}function ae(de){var Be;return de&&de.state?((Be=de.state).wsize=0,Be.whave=0,Be.wnext=0,te(de)):F}function oe(de,Be){var re,Ye;return de&&de.state?(Ye=de.state,Be<0?(re=0,Be=-Be):(re=1+(Be>>4),Be<48&&(Be&=15)),Be&&(Be<8||15<Be)?F:(Ye.window!==null&&Ye.wbits!==Be&&(Ye.window=null),Ye.wrap=re,Ye.wbits=Be,ae(de))):F}function ue(de,Be){var re,Ye;return de?(Ye=new Z,(de.state=Ye).window=null,(re=oe(de,Be))!==U&&(de.state=null),re):F}var Ee,Ie,_e=!0;function Oe(de){if(_e){var Be;for(Ee=new b.Buf32(512),Ie=new b.Buf32(32),Be=0;Be<144;)de.lens[Be++]=8;for(;Be<256;)de.lens[Be++]=9;for(;Be<280;)de.lens[Be++]=7;for(;Be<288;)de.lens[Be++]=8;for(I(B,de.lens,0,288,Ee,0,de.work,{bits:9}),Be=0;Be<32;)de.lens[Be++]=5;I(V,de.lens,0,32,Ie,0,de.work,{bits:5}),_e=!1}de.lencode=Ee,de.lenbits=9,de.distcode=Ie,de.distbits=5}function ot(de,Be,re,Ye){var nn,ke=de.state;return ke.window===null&&(ke.wsize=1<<ke.wbits,ke.wnext=0,ke.whave=0,ke.window=new b.Buf8(ke.wsize)),Ye>=ke.wsize?(b.arraySet(ke.window,Be,re-ke.wsize,ke.wsize,0),ke.wnext=0,ke.whave=ke.wsize):(Ye<(nn=ke.wsize-ke.wnext)&&(nn=Ye),b.arraySet(ke.window,Be,re-Ye,nn,ke.wnext),(Ye-=nn)?(b.arraySet(ke.window,Be,re-Ye,Ye,0),ke.wnext=Ye,ke.whave=ke.wsize):(ke.wnext+=nn,ke.wnext===ke.wsize&&(ke.wnext=0),ke.whave<ke.wsize&&(ke.whave+=nn))),0}_.inflateReset=ae,_.inflateReset2=oe,_.inflateResetKeep=te,_.inflateInit=function(de){return ue(de,15)},_.inflateInit2=ue,_.inflate=function(de,Be){var re,Ye,nn,ke,Re,Ze,Pt,pe,xe,ct,dt,gt,Je,kn,Mt,En,Yn,gr,dr,ki,ie,_t,yt,Te,we=0,et=new b.Buf8(4),Dt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!de||!de.state||!de.output||!de.input&&de.avail_in!==0)return F;(re=de.state).mode===12&&(re.mode=13),Re=de.next_out,nn=de.output,Pt=de.avail_out,ke=de.next_in,Ye=de.input,Ze=de.avail_in,pe=re.hold,xe=re.bits,ct=Ze,dt=Pt,_t=U;e:for(;;)switch(re.mode){case H:if(re.wrap===0){re.mode=13;break}for(;xe<16;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}if(2&re.wrap&&pe===35615){et[re.check=0]=255&pe,et[1]=pe>>>8&255,re.check=E(re.check,et,2,0),xe=pe=0,re.mode=2;break}if(re.flags=0,re.head&&(re.head.done=!1),!(1&re.wrap)||(((255&pe)<<8)+(pe>>8))%31){de.msg="incorrect header check",re.mode=30;break}if((15&pe)!=8){de.msg="unknown compression method",re.mode=30;break}if(xe-=4,ie=8+(15&(pe>>>=4)),re.wbits===0)re.wbits=ie;else if(ie>re.wbits){de.msg="invalid window size",re.mode=30;break}re.dmax=1<<ie,de.adler=re.check=1,re.mode=512&pe?10:12,xe=pe=0;break;case 2:for(;xe<16;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}if(re.flags=pe,(255&re.flags)!=8){de.msg="unknown compression method",re.mode=30;break}if(57344&re.flags){de.msg="unknown header flags set",re.mode=30;break}re.head&&(re.head.text=pe>>8&1),512&re.flags&&(et[0]=255&pe,et[1]=pe>>>8&255,re.check=E(re.check,et,2,0)),xe=pe=0,re.mode=3;case 3:for(;xe<32;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}re.head&&(re.head.time=pe),512&re.flags&&(et[0]=255&pe,et[1]=pe>>>8&255,et[2]=pe>>>16&255,et[3]=pe>>>24&255,re.check=E(re.check,et,4,0)),xe=pe=0,re.mode=4;case 4:for(;xe<16;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}re.head&&(re.head.xflags=255&pe,re.head.os=pe>>8),512&re.flags&&(et[0]=255&pe,et[1]=pe>>>8&255,re.check=E(re.check,et,2,0)),xe=pe=0,re.mode=5;case 5:if(1024&re.flags){for(;xe<16;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}re.length=pe,re.head&&(re.head.extra_len=pe),512&re.flags&&(et[0]=255&pe,et[1]=pe>>>8&255,re.check=E(re.check,et,2,0)),xe=pe=0}else re.head&&(re.head.extra=null);re.mode=6;case 6:if(1024&re.flags&&(Ze<(gt=re.length)&&(gt=Ze),gt&&(re.head&&(ie=re.head.extra_len-re.length,re.head.extra||(re.head.extra=new Array(re.head.extra_len)),b.arraySet(re.head.extra,Ye,ke,gt,ie)),512&re.flags&&(re.check=E(re.check,Ye,gt,ke)),Ze-=gt,ke+=gt,re.length-=gt),re.length))break e;re.length=0,re.mode=7;case 7:if(2048&re.flags){if(Ze===0)break e;for(gt=0;ie=Ye[ke+gt++],re.head&&ie&&re.length<65536&&(re.head.name+=String.fromCharCode(ie)),ie&&gt<Ze;);if(512&re.flags&&(re.check=E(re.check,Ye,gt,ke)),Ze-=gt,ke+=gt,ie)break e}else re.head&&(re.head.name=null);re.length=0,re.mode=8;case 8:if(4096&re.flags){if(Ze===0)break e;for(gt=0;ie=Ye[ke+gt++],re.head&&ie&&re.length<65536&&(re.head.comment+=String.fromCharCode(ie)),ie&&gt<Ze;);if(512&re.flags&&(re.check=E(re.check,Ye,gt,ke)),Ze-=gt,ke+=gt,ie)break e}else re.head&&(re.head.comment=null);re.mode=9;case 9:if(512&re.flags){for(;xe<16;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}if(pe!==(65535&re.check)){de.msg="header crc mismatch",re.mode=30;break}xe=pe=0}re.head&&(re.head.hcrc=re.flags>>9&1,re.head.done=!0),de.adler=re.check=0,re.mode=12;break;case 10:for(;xe<32;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}de.adler=re.check=X(pe),xe=pe=0,re.mode=11;case 11:if(re.havedict===0)return de.next_out=Re,de.avail_out=Pt,de.next_in=ke,de.avail_in=Ze,re.hold=pe,re.bits=xe,2;de.adler=re.check=1,re.mode=12;case 12:if(Be===5||Be===6)break e;case 13:if(re.last){pe>>>=7&xe,xe-=7&xe,re.mode=27;break}for(;xe<3;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}switch(re.last=1&pe,xe-=1,3&(pe>>>=1)){case 0:re.mode=14;break;case 1:if(Oe(re),re.mode=20,Be!==6)break;pe>>>=2,xe-=2;break e;case 2:re.mode=17;break;case 3:de.msg="invalid block type",re.mode=30}pe>>>=2,xe-=2;break;case 14:for(pe>>>=7&xe,xe-=7&xe;xe<32;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}if((65535&pe)!=(pe>>>16^65535)){de.msg="invalid stored block lengths",re.mode=30;break}if(re.length=65535&pe,xe=pe=0,re.mode=15,Be===6)break e;case 15:re.mode=16;case 16:if(gt=re.length){if(Ze<gt&&(gt=Ze),Pt<gt&&(gt=Pt),gt===0)break e;b.arraySet(nn,Ye,ke,gt,Re),Ze-=gt,ke+=gt,Pt-=gt,Re+=gt,re.length-=gt;break}re.mode=12;break;case 17:for(;xe<14;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}if(re.nlen=257+(31&pe),pe>>>=5,xe-=5,re.ndist=1+(31&pe),pe>>>=5,xe-=5,re.ncode=4+(15&pe),pe>>>=4,xe-=4,286<re.nlen||30<re.ndist){de.msg="too many length or distance symbols",re.mode=30;break}re.have=0,re.mode=18;case 18:for(;re.have<re.ncode;){for(;xe<3;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}re.lens[Dt[re.have++]]=7&pe,pe>>>=3,xe-=3}for(;re.have<19;)re.lens[Dt[re.have++]]=0;if(re.lencode=re.lendyn,re.lenbits=7,yt={bits:re.lenbits},_t=I(0,re.lens,0,19,re.lencode,0,re.work,yt),re.lenbits=yt.bits,_t){de.msg="invalid code lengths set",re.mode=30;break}re.have=0,re.mode=19;case 19:for(;re.have<re.nlen+re.ndist;){for(;En=(we=re.lencode[pe&(1<<re.lenbits)-1])>>>16&255,Yn=65535&we,!((Mt=we>>>24)<=xe);){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}if(Yn<16)pe>>>=Mt,xe-=Mt,re.lens[re.have++]=Yn;else{if(Yn===16){for(Te=Mt+2;xe<Te;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}if(pe>>>=Mt,xe-=Mt,re.have===0){de.msg="invalid bit length repeat",re.mode=30;break}ie=re.lens[re.have-1],gt=3+(3&pe),pe>>>=2,xe-=2}else if(Yn===17){for(Te=Mt+3;xe<Te;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}xe-=Mt,ie=0,gt=3+(7&(pe>>>=Mt)),pe>>>=3,xe-=3}else{for(Te=Mt+7;xe<Te;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}xe-=Mt,ie=0,gt=11+(127&(pe>>>=Mt)),pe>>>=7,xe-=7}if(re.have+gt>re.nlen+re.ndist){de.msg="invalid bit length repeat",re.mode=30;break}for(;gt--;)re.lens[re.have++]=ie}}if(re.mode===30)break;if(re.lens[256]===0){de.msg="invalid code -- missing end-of-block",re.mode=30;break}if(re.lenbits=9,yt={bits:re.lenbits},_t=I(B,re.lens,0,re.nlen,re.lencode,0,re.work,yt),re.lenbits=yt.bits,_t){de.msg="invalid literal/lengths set",re.mode=30;break}if(re.distbits=6,re.distcode=re.distdyn,yt={bits:re.distbits},_t=I(V,re.lens,re.nlen,re.ndist,re.distcode,0,re.work,yt),re.distbits=yt.bits,_t){de.msg="invalid distances set",re.mode=30;break}if(re.mode=20,Be===6)break e;case 20:re.mode=21;case 21:if(6<=Ze&&258<=Pt){de.next_out=Re,de.avail_out=Pt,de.next_in=ke,de.avail_in=Ze,re.hold=pe,re.bits=xe,N(de,dt),Re=de.next_out,nn=de.output,Pt=de.avail_out,ke=de.next_in,Ye=de.input,Ze=de.avail_in,pe=re.hold,xe=re.bits,re.mode===12&&(re.back=-1);break}for(re.back=0;En=(we=re.lencode[pe&(1<<re.lenbits)-1])>>>16&255,Yn=65535&we,!((Mt=we>>>24)<=xe);){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}if(En&&!(240&En)){for(gr=Mt,dr=En,ki=Yn;En=(we=re.lencode[ki+((pe&(1<<gr+dr)-1)>>gr)])>>>16&255,Yn=65535&we,!(gr+(Mt=we>>>24)<=xe);){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}pe>>>=gr,xe-=gr,re.back+=gr}if(pe>>>=Mt,xe-=Mt,re.back+=Mt,re.length=Yn,En===0){re.mode=26;break}if(32&En){re.back=-1,re.mode=12;break}if(64&En){de.msg="invalid literal/length code",re.mode=30;break}re.extra=15&En,re.mode=22;case 22:if(re.extra){for(Te=re.extra;xe<Te;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}re.length+=pe&(1<<re.extra)-1,pe>>>=re.extra,xe-=re.extra,re.back+=re.extra}re.was=re.length,re.mode=23;case 23:for(;En=(we=re.distcode[pe&(1<<re.distbits)-1])>>>16&255,Yn=65535&we,!((Mt=we>>>24)<=xe);){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}if(!(240&En)){for(gr=Mt,dr=En,ki=Yn;En=(we=re.distcode[ki+((pe&(1<<gr+dr)-1)>>gr)])>>>16&255,Yn=65535&we,!(gr+(Mt=we>>>24)<=xe);){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}pe>>>=gr,xe-=gr,re.back+=gr}if(pe>>>=Mt,xe-=Mt,re.back+=Mt,64&En){de.msg="invalid distance code",re.mode=30;break}re.offset=Yn,re.extra=15&En,re.mode=24;case 24:if(re.extra){for(Te=re.extra;xe<Te;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}re.offset+=pe&(1<<re.extra)-1,pe>>>=re.extra,xe-=re.extra,re.back+=re.extra}if(re.offset>re.dmax){de.msg="invalid distance too far back",re.mode=30;break}re.mode=25;case 25:if(Pt===0)break e;if(gt=dt-Pt,re.offset>gt){if((gt=re.offset-gt)>re.whave&&re.sane){de.msg="invalid distance too far back",re.mode=30;break}Je=gt>re.wnext?(gt-=re.wnext,re.wsize-gt):re.wnext-gt,gt>re.length&&(gt=re.length),kn=re.window}else kn=nn,Je=Re-re.offset,gt=re.length;for(Pt<gt&&(gt=Pt),Pt-=gt,re.length-=gt;nn[Re++]=kn[Je++],--gt;);re.length===0&&(re.mode=21);break;case 26:if(Pt===0)break e;nn[Re++]=re.length,Pt--,re.mode=21;break;case 27:if(re.wrap){for(;xe<32;){if(Ze===0)break e;Ze--,pe|=Ye[ke++]<<xe,xe+=8}if(dt-=Pt,de.total_out+=dt,re.total+=dt,dt&&(de.adler=re.check=re.flags?E(re.check,nn,dt,Re-dt):S(re.check,nn,dt,Re-dt)),dt=Pt,(re.flags?pe:X(pe))!==re.check){de.msg="incorrect data check",re.mode=30;break}xe=pe=0}re.mode=28;case 28:if(re.wrap&&re.flags){for(;xe<32;){if(Ze===0)break e;Ze--,pe+=Ye[ke++]<<xe,xe+=8}if(pe!==(4294967295&re.total)){de.msg="incorrect length check",re.mode=30;break}xe=pe=0}re.mode=29;case 29:_t=1;break e;case 30:_t=-3;break e;case 31:return-4;case 32:default:return F}return de.next_out=Re,de.avail_out=Pt,de.next_in=ke,de.avail_in=Ze,re.hold=pe,re.bits=xe,(re.wsize||dt!==de.avail_out&&re.mode<30&&(re.mode<27||Be!==4))&&ot(de,de.output,de.next_out,dt-de.avail_out)?(re.mode=31,-4):(ct-=de.avail_in,dt-=de.avail_out,de.total_in+=ct,de.total_out+=dt,re.total+=dt,re.wrap&&dt&&(de.adler=re.check=re.flags?E(re.check,nn,dt,de.next_out-dt):S(re.check,nn,dt,de.next_out-dt)),de.data_type=re.bits+(re.last?64:0)+(re.mode===12?128:0)+(re.mode===20||re.mode===15?256:0),(ct==0&&dt===0||Be===4)&&_t===U&&(_t=-5),_t)},_.inflateEnd=function(de){if(!de||!de.state)return F;var Be=de.state;return Be.window&&(Be.window=null),de.state=null,U},_.inflateGetHeader=function(de,Be){var re;return de&&de.state&&2&(re=de.state).wrap?((re.head=Be).done=!1,U):F},_.inflateSetDictionary=function(de,Be){var re,Ye=Be.length;return de&&de.state?(re=de.state).wrap!==0&&re.mode!==11?F:re.mode===11&&S(1,Be,Ye,0)!==re.check?-3:ot(de,Be,Ye,Ye)?(re.mode=31,-4):(re.havedict=1,U):F},_.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(d,g,_){var b=d("../utils/common"),S=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],E=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],N=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],I=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];g.exports=function(B,V,U,F,H,G,W,X){var Z,te,ae,oe,ue,Ee,Ie,_e,Oe,ot=X.bits,de=0,Be=0,re=0,Ye=0,nn=0,ke=0,Re=0,Ze=0,Pt=0,pe=0,xe=null,ct=0,dt=new b.Buf16(16),gt=new b.Buf16(16),Je=null,kn=0;for(de=0;de<=15;de++)dt[de]=0;for(Be=0;Be<F;Be++)dt[V[U+Be]]++;for(nn=ot,Ye=15;1<=Ye&&dt[Ye]===0;Ye--);if(Ye<nn&&(nn=Ye),Ye===0)return H[G++]=20971520,H[G++]=20971520,X.bits=1,0;for(re=1;re<Ye&&dt[re]===0;re++);for(nn<re&&(nn=re),de=Ze=1;de<=15;de++)if(Ze<<=1,(Ze-=dt[de])<0)return-1;if(0<Ze&&(B===0||Ye!==1))return-1;for(gt[1]=0,de=1;de<15;de++)gt[de+1]=gt[de]+dt[de];for(Be=0;Be<F;Be++)V[U+Be]!==0&&(W[gt[V[U+Be]]++]=Be);if(Ee=B===0?(xe=Je=W,19):B===1?(xe=S,ct-=257,Je=E,kn-=257,256):(xe=N,Je=I,-1),de=re,ue=G,Re=Be=pe=0,ae=-1,oe=(Pt=1<<(ke=nn))-1,B===1&&852<Pt||B===2&&592<Pt)return 1;for(;;){for(Ie=de-Re,Oe=W[Be]<Ee?(_e=0,W[Be]):W[Be]>Ee?(_e=Je[kn+W[Be]],xe[ct+W[Be]]):(_e=96,0),Z=1<<de-Re,re=te=1<<ke;H[ue+(pe>>Re)+(te-=Z)]=Ie<<24|_e<<16|Oe|0,te!==0;);for(Z=1<<de-1;pe&Z;)Z>>=1;if(Z!==0?(pe&=Z-1,pe+=Z):pe=0,Be++,--dt[de]==0){if(de===Ye)break;de=V[U+W[Be]]}if(nn<de&&(pe&oe)!==ae){for(Re===0&&(Re=nn),ue+=re,Ze=1<<(ke=de-Re);ke+Re<Ye&&!((Ze-=dt[ke+Re])<=0);)ke++,Ze<<=1;if(Pt+=1<<ke,B===1&&852<Pt||B===2&&592<Pt)return 1;H[ae=pe&oe]=nn<<24|ke<<16|ue-G|0}}return pe!==0&&(H[ue+pe]=de-Re<<24|64<<16|0),X.bits=nn,0}},{"../utils/common":41}],51:[function(d,g,_){g.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(d,g,_){var b=d("../utils/common"),S=0,E=1;function N(we){for(var et=we.length;0<=--et;)we[et]=0}var I=0,B=29,V=256,U=V+1+B,F=30,H=19,G=2*U+1,W=15,X=16,Z=7,te=256,ae=16,oe=17,ue=18,Ee=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ie=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],_e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Oe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ot=new Array(2*(U+2));N(ot);var de=new Array(2*F);N(de);var Be=new Array(512);N(Be);var re=new Array(256);N(re);var Ye=new Array(B);N(Ye);var nn,ke,Re,Ze=new Array(F);function Pt(we,et,Dt,qt,ut){this.static_tree=we,this.extra_bits=et,this.extra_base=Dt,this.elems=qt,this.max_length=ut,this.has_stree=we&&we.length}function pe(we,et){this.dyn_tree=we,this.max_code=0,this.stat_desc=et}function xe(we){return we<256?Be[we]:Be[256+(we>>>7)]}function ct(we,et){we.pending_buf[we.pending++]=255&et,we.pending_buf[we.pending++]=et>>>8&255}function dt(we,et,Dt){we.bi_valid>X-Dt?(we.bi_buf|=et<<we.bi_valid&65535,ct(we,we.bi_buf),we.bi_buf=et>>X-we.bi_valid,we.bi_valid+=Dt-X):(we.bi_buf|=et<<we.bi_valid&65535,we.bi_valid+=Dt)}function gt(we,et,Dt){dt(we,Dt[2*et],Dt[2*et+1])}function Je(we,et){for(var Dt=0;Dt|=1&we,we>>>=1,Dt<<=1,0<--et;);return Dt>>>1}function kn(we,et,Dt){var qt,ut,rn=new Array(W+1),Gt=0;for(qt=1;qt<=W;qt++)rn[qt]=Gt=Gt+Dt[qt-1]<<1;for(ut=0;ut<=et;ut++){var Xt=we[2*ut+1];Xt!==0&&(we[2*ut]=Je(rn[Xt]++,Xt))}}function Mt(we){var et;for(et=0;et<U;et++)we.dyn_ltree[2*et]=0;for(et=0;et<F;et++)we.dyn_dtree[2*et]=0;for(et=0;et<H;et++)we.bl_tree[2*et]=0;we.dyn_ltree[2*te]=1,we.opt_len=we.static_len=0,we.last_lit=we.matches=0}function En(we){8<we.bi_valid?ct(we,we.bi_buf):0<we.bi_valid&&(we.pending_buf[we.pending++]=we.bi_buf),we.bi_buf=0,we.bi_valid=0}function Yn(we,et,Dt,qt){var ut=2*et,rn=2*Dt;return we[ut]<we[rn]||we[ut]===we[rn]&&qt[et]<=qt[Dt]}function gr(we,et,Dt){for(var qt=we.heap[Dt],ut=Dt<<1;ut<=we.heap_len&&(ut<we.heap_len&&Yn(et,we.heap[ut+1],we.heap[ut],we.depth)&&ut++,!Yn(et,qt,we.heap[ut],we.depth));)we.heap[Dt]=we.heap[ut],Dt=ut,ut<<=1;we.heap[Dt]=qt}function dr(we,et,Dt){var qt,ut,rn,Gt,Xt=0;if(we.last_lit!==0)for(;qt=we.pending_buf[we.d_buf+2*Xt]<<8|we.pending_buf[we.d_buf+2*Xt+1],ut=we.pending_buf[we.l_buf+Xt],Xt++,qt===0?gt(we,ut,et):(gt(we,(rn=re[ut])+V+1,et),(Gt=Ee[rn])!==0&&dt(we,ut-=Ye[rn],Gt),gt(we,rn=xe(--qt),Dt),(Gt=Ie[rn])!==0&&dt(we,qt-=Ze[rn],Gt)),Xt<we.last_lit;);gt(we,te,et)}function ki(we,et){var Dt,qt,ut,rn=et.dyn_tree,Gt=et.stat_desc.static_tree,Xt=et.stat_desc.has_stree,or=et.stat_desc.elems,Mi=-1;for(we.heap_len=0,we.heap_max=G,Dt=0;Dt<or;Dt++)rn[2*Dt]!==0?(we.heap[++we.heap_len]=Mi=Dt,we.depth[Dt]=0):rn[2*Dt+1]=0;for(;we.heap_len<2;)rn[2*(ut=we.heap[++we.heap_len]=Mi<2?++Mi:0)]=1,we.depth[ut]=0,we.opt_len--,Xt&&(we.static_len-=Gt[2*ut+1]);for(et.max_code=Mi,Dt=we.heap_len>>1;1<=Dt;Dt--)gr(we,rn,Dt);for(ut=or;Dt=we.heap[1],we.heap[1]=we.heap[we.heap_len--],gr(we,rn,1),qt=we.heap[1],we.heap[--we.heap_max]=Dt,we.heap[--we.heap_max]=qt,rn[2*ut]=rn[2*Dt]+rn[2*qt],we.depth[ut]=(we.depth[Dt]>=we.depth[qt]?we.depth[Dt]:we.depth[qt])+1,rn[2*Dt+1]=rn[2*qt+1]=ut,we.heap[1]=ut++,gr(we,rn,1),2<=we.heap_len;);we.heap[--we.heap_max]=we.heap[1],function(Pr,ll){var bg,Rl,Oh,no,L9,i8,Bh=ll.dyn_tree,s8=ll.max_code,hw=ll.stat_desc.static_tree,dw=ll.stat_desc.has_stree,fw=ll.stat_desc.extra_bits,o8=ll.stat_desc.extra_base,Ru=ll.stat_desc.max_length,Lh=0;for(no=0;no<=W;no++)Pr.bl_count[no]=0;for(Bh[2*Pr.heap[Pr.heap_max]+1]=0,bg=Pr.heap_max+1;bg<G;bg++)Ru<(no=Bh[2*Bh[2*(Rl=Pr.heap[bg])+1]+1]+1)&&(no=Ru,Lh++),Bh[2*Rl+1]=no,s8<Rl||(Pr.bl_count[no]++,L9=0,o8<=Rl&&(L9=fw[Rl-o8]),i8=Bh[2*Rl],Pr.opt_len+=i8*(no+L9),dw&&(Pr.static_len+=i8*(hw[2*Rl+1]+L9)));if(Lh!==0){do{for(no=Ru-1;Pr.bl_count[no]===0;)no--;Pr.bl_count[no]--,Pr.bl_count[no+1]+=2,Pr.bl_count[Ru]--,Lh-=2}while(0<Lh);for(no=Ru;no!==0;no--)for(Rl=Pr.bl_count[no];Rl!==0;)s8<(Oh=Pr.heap[--bg])||(Bh[2*Oh+1]!==no&&(Pr.opt_len+=(no-Bh[2*Oh+1])*Bh[2*Oh],Bh[2*Oh+1]=no),Rl--)}}(we,et),kn(rn,Mi,we.bl_count)}function ie(we,et,Dt){var qt,ut,rn=-1,Gt=et[1],Xt=0,or=7,Mi=4;for(Gt===0&&(or=138,Mi=3),et[2*(Dt+1)+1]=65535,qt=0;qt<=Dt;qt++)ut=Gt,Gt=et[2*(qt+1)+1],++Xt<or&&ut===Gt||(Xt<Mi?we.bl_tree[2*ut]+=Xt:ut!==0?(ut!==rn&&we.bl_tree[2*ut]++,we.bl_tree[2*ae]++):Xt<=10?we.bl_tree[2*oe]++:we.bl_tree[2*ue]++,rn=ut,Mi=(Xt=0)===Gt?(or=138,3):ut===Gt?(or=6,3):(or=7,4))}function _t(we,et,Dt){var qt,ut,rn=-1,Gt=et[1],Xt=0,or=7,Mi=4;for(Gt===0&&(or=138,Mi=3),qt=0;qt<=Dt;qt++)if(ut=Gt,Gt=et[2*(qt+1)+1],!(++Xt<or&&ut===Gt)){if(Xt<Mi)for(;gt(we,ut,we.bl_tree),--Xt!=0;);else ut!==0?(ut!==rn&&(gt(we,ut,we.bl_tree),Xt--),gt(we,ae,we.bl_tree),dt(we,Xt-3,2)):Xt<=10?(gt(we,oe,we.bl_tree),dt(we,Xt-3,3)):(gt(we,ue,we.bl_tree),dt(we,Xt-11,7));rn=ut,Mi=(Xt=0)===Gt?(or=138,3):ut===Gt?(or=6,3):(or=7,4)}}N(Ze);var yt=!1;function Te(we,et,Dt,qt){dt(we,(I<<1)+(qt?1:0),3),function(ut,rn,Gt,Xt){En(ut),Xt&&(ct(ut,Gt),ct(ut,~Gt)),b.arraySet(ut.pending_buf,ut.window,rn,Gt,ut.pending),ut.pending+=Gt}(we,et,Dt,!0)}_._tr_init=function(we){yt||(function(){var et,Dt,qt,ut,rn,Gt=new Array(W+1);for(ut=qt=0;ut<B-1;ut++)for(Ye[ut]=qt,et=0;et<1<<Ee[ut];et++)re[qt++]=ut;for(re[qt-1]=ut,ut=rn=0;ut<16;ut++)for(Ze[ut]=rn,et=0;et<1<<Ie[ut];et++)Be[rn++]=ut;for(rn>>=7;ut<F;ut++)for(Ze[ut]=rn<<7,et=0;et<1<<Ie[ut]-7;et++)Be[256+rn++]=ut;for(Dt=0;Dt<=W;Dt++)Gt[Dt]=0;for(et=0;et<=143;)ot[2*et+1]=8,et++,Gt[8]++;for(;et<=255;)ot[2*et+1]=9,et++,Gt[9]++;for(;et<=279;)ot[2*et+1]=7,et++,Gt[7]++;for(;et<=287;)ot[2*et+1]=8,et++,Gt[8]++;for(kn(ot,U+1,Gt),et=0;et<F;et++)de[2*et+1]=5,de[2*et]=Je(et,5);nn=new Pt(ot,Ee,V+1,U,W),ke=new Pt(de,Ie,0,F,W),Re=new Pt(new Array(0),_e,0,H,Z)}(),yt=!0),we.l_desc=new pe(we.dyn_ltree,nn),we.d_desc=new pe(we.dyn_dtree,ke),we.bl_desc=new pe(we.bl_tree,Re),we.bi_buf=0,we.bi_valid=0,Mt(we)},_._tr_stored_block=Te,_._tr_flush_block=function(we,et,Dt,qt){var ut,rn,Gt=0;0<we.level?(we.strm.data_type===2&&(we.strm.data_type=function(Xt){var or,Mi=4093624447;for(or=0;or<=31;or++,Mi>>>=1)if(1&Mi&&Xt.dyn_ltree[2*or]!==0)return S;if(Xt.dyn_ltree[18]!==0||Xt.dyn_ltree[20]!==0||Xt.dyn_ltree[26]!==0)return E;for(or=32;or<V;or++)if(Xt.dyn_ltree[2*or]!==0)return E;return S}(we)),ki(we,we.l_desc),ki(we,we.d_desc),Gt=function(Xt){var or;for(ie(Xt,Xt.dyn_ltree,Xt.l_desc.max_code),ie(Xt,Xt.dyn_dtree,Xt.d_desc.max_code),ki(Xt,Xt.bl_desc),or=H-1;3<=or&&Xt.bl_tree[2*Oe[or]+1]===0;or--);return Xt.opt_len+=3*(or+1)+5+5+4,or}(we),ut=we.opt_len+3+7>>>3,(rn=we.static_len+3+7>>>3)<=ut&&(ut=rn)):ut=rn=Dt+5,Dt+4<=ut&&et!==-1?Te(we,et,Dt,qt):we.strategy===4||rn===ut?(dt(we,2+(qt?1:0),3),dr(we,ot,de)):(dt(we,4+(qt?1:0),3),function(Xt,or,Mi,Pr){var ll;for(dt(Xt,or-257,5),dt(Xt,Mi-1,5),dt(Xt,Pr-4,4),ll=0;ll<Pr;ll++)dt(Xt,Xt.bl_tree[2*Oe[ll]+1],3);_t(Xt,Xt.dyn_ltree,or-1),_t(Xt,Xt.dyn_dtree,Mi-1)}(we,we.l_desc.max_code+1,we.d_desc.max_code+1,Gt+1),dr(we,we.dyn_ltree,we.dyn_dtree)),Mt(we),qt&&En(we)},_._tr_tally=function(we,et,Dt){return we.pending_buf[we.d_buf+2*we.last_lit]=et>>>8&255,we.pending_buf[we.d_buf+2*we.last_lit+1]=255&et,we.pending_buf[we.l_buf+we.last_lit]=255&Dt,we.last_lit++,et===0?we.dyn_ltree[2*Dt]++:(we.matches++,et--,we.dyn_ltree[2*(re[Dt]+V+1)]++,we.dyn_dtree[2*xe(et)]++),we.last_lit===we.lit_bufsize-1},_._tr_align=function(we){dt(we,2,3),gt(we,te,ot),function(et){et.bi_valid===16?(ct(et,et.bi_buf),et.bi_buf=0,et.bi_valid=0):8<=et.bi_valid&&(et.pending_buf[et.pending++]=255&et.bi_buf,et.bi_buf>>=8,et.bi_valid-=8)}(we)}},{"../utils/common":41}],53:[function(d,g,_){g.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(d,g,_){(function(b){(function(S,E){if(!S.setImmediate){var N,I,B,V,U=1,F={},H=!1,G=S.document,W=Object.getPrototypeOf&&Object.getPrototypeOf(S);W=W&&W.setTimeout?W:S,N={}.toString.call(S.process)==="[object process]"?function(ae){process.nextTick(function(){Z(ae)})}:function(){if(S.postMessage&&!S.importScripts){var ae=!0,oe=S.onmessage;return S.onmessage=function(){ae=!1},S.postMessage("","*"),S.onmessage=oe,ae}}()?(V="setImmediate$"+Math.random()+"$",S.addEventListener?S.addEventListener("message",te,!1):S.attachEvent("onmessage",te),function(ae){S.postMessage(V+ae,"*")}):S.MessageChannel?((B=new MessageChannel).port1.onmessage=function(ae){Z(ae.data)},function(ae){B.port2.postMessage(ae)}):G&&"onreadystatechange"in G.createElement("script")?(I=G.documentElement,function(ae){var oe=G.createElement("script");oe.onreadystatechange=function(){Z(ae),oe.onreadystatechange=null,I.removeChild(oe),oe=null},I.appendChild(oe)}):function(ae){setTimeout(Z,0,ae)},W.setImmediate=function(ae){typeof ae!="function"&&(ae=new Function(""+ae));for(var oe=new Array(arguments.length-1),ue=0;ue<oe.length;ue++)oe[ue]=arguments[ue+1];var Ee={callback:ae,args:oe};return F[U]=Ee,N(U),U++},W.clearImmediate=X}function X(ae){delete F[ae]}function Z(ae){if(H)setTimeout(Z,0,ae);else{var oe=F[ae];if(oe){H=!0;try{(function(ue){var Ee=ue.callback,Ie=ue.args;switch(Ie.length){case 0:Ee();break;case 1:Ee(Ie[0]);break;case 2:Ee(Ie[0],Ie[1]);break;case 3:Ee(Ie[0],Ie[1],Ie[2]);break;default:Ee.apply(E,Ie)}})(oe)}finally{X(ae),H=!1}}}}function te(ae){ae.source===S&&typeof ae.data=="string"&&ae.data.indexOf(V)===0&&Z(+ae.data.slice(V.length))}})(typeof self>"u"?b===void 0?this:b:self)}).call(this,typeof lo<"u"?lo:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}),wj,RI,ude,Tj,hde,dde,TS,fde,Ej,pde,PI,ES,MS,ig,mde,gde,yde,Fv,j0,vde,_de,Mj,NI,pBe=C(()=>{wj=z(Le(),1),RI=z(Le(),1),ude=l=>typeof l=="function",Tj=(l,h)=>ude(l)?l(h):l,hde=(()=>{let l=0;return()=>(++l).toString()})(),dde=20,TS=new Map,fde=1e3,Ej=l=>{if(TS.has(l))return;let h=setTimeout(()=>{TS.delete(l),ig({type:4,toastId:l})},fde);TS.set(l,h)},pde=l=>{let h=TS.get(l);h&&clearTimeout(h)},PI=(l,h)=>{switch(h.type){case 0:return M(R({},l),{toasts:[h.toast,...l.toasts].slice(0,dde)});case 1:return h.toast.id&&pde(h.toast.id),M(R({},l),{toasts:l.toasts.map(b=>b.id===h.toast.id?R(R({},b),h.toast):b)});case 2:let{toast:d}=h;return l.toasts.find(b=>b.id===d.id)?PI(l,{type:1,toast:d}):PI(l,{type:0,toast:d});case 3:let{toastId:g}=h;return g?Ej(g):l.toasts.forEach(b=>{Ej(b.id)}),M(R({},l),{toasts:l.toasts.map(b=>b.id===g||g===void 0?M(R({},b),{visible:!1}):b)});case 4:return h.toastId===void 0?M(R({},l),{toasts:[]}):M(R({},l),{toasts:l.toasts.filter(b=>b.id!==h.toastId)});case 5:return M(R({},l),{pausedAt:h.time});case 6:let _=h.time-(l.pausedAt||0);return M(R({},l),{pausedAt:void 0,toasts:l.toasts.map(b=>M(R({},b),{pauseDuration:b.pauseDuration+_}))})}},ES=[],MS={toasts:[],pausedAt:void 0},ig=l=>{MS=PI(MS,l),ES.forEach(h=>{h(MS)})},mde={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},gde=(l={})=>{let[h,d]=(0,wj.useState)(MS);(0,wj.useEffect)(()=>(ES.push(d),()=>{let _=ES.indexOf(d);_>-1&&ES.splice(_,1)}),[h]);let g=h.toasts.map(_=>{var b,S;return M(R(R(R({},l),l[_.type]),_),{duration:_.duration||((b=l[_.type])==null?void 0:b.duration)||(l==null?void 0:l.duration)||mde[_.type],style:R(R(R({},l.style),(S=l[_.type])==null?void 0:S.style),_.style)})});return M(R({},h),{toasts:g})},yde=(l,h="blank",d)=>M(R({createdAt:Date.now(),visible:!0,type:h,ariaProps:{role:"status","aria-live":"polite"},message:l,pauseDuration:0},d),{id:(d==null?void 0:d.id)||hde()}),Fv=l=>(h,d)=>{let g=yde(h,l,d);return ig({type:2,toast:g}),g.id},j0=(l,h)=>Fv("blank")(l,h),j0.error=Fv("error"),j0.success=Fv("success"),j0.loading=Fv("loading"),j0.custom=Fv("custom"),j0.dismiss=l=>{ig({type:3,toastId:l})},j0.remove=l=>ig({type:4,toastId:l}),j0.promise=(l,h,d)=>{let g=j0.loading(h.loading,R(R({},d),d==null?void 0:d.loading));return l.then(_=>(j0.success(Tj(h.success,_),R(R({id:g},d),d==null?void 0:d.success)),_)).catch(_=>{j0.error(Tj(h.error,_),R(R({id:g},d),d==null?void 0:d.error))}),l},vde=(l,h)=>{ig({type:1,toast:{id:l,height:h}})},_de=()=>{ig({type:5,time:Date.now()})},Mj=l=>{let{toasts:h,pausedAt:d}=gde(l);(0,RI.useEffect)(()=>{if(d)return;let b=Date.now(),S=h.map(E=>{if(E.duration===1/0)return;let N=(E.duration||0)+E.pauseDuration-(b-E.createdAt);if(N<0){E.visible&&j0.dismiss(E.id);return}return setTimeout(()=>j0.dismiss(E.id),N)});return()=>{S.forEach(E=>E&&clearTimeout(E))}},[h,d]);let g=(0,RI.useCallback)(()=>{d&&ig({type:6,time:Date.now()})},[d]),_=(0,RI.useCallback)((b,S)=>{let{reverseOrder:E=!1,gutter:N=8,defaultPosition:I}=S||{},B=h.filter(F=>(F.position||I)===(b.position||I)&&F.height),V=B.findIndex(F=>F.id===b.id),U=B.filter((F,H)=>H<V&&F.visible).length;return B.filter(F=>F.visible).slice(...E?[U+1]:[0,U]).reduce((F,H)=>F+(H.height||0)+N,0)},[h]);return{toasts:h,handlers:{updateHeight:vde,startPause:_de,endPause:g,calculateOffset:_}}},NI=j0});function xde(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}function mBe(l){a9=l}function La(l,h){if(h){if(Ade.test(l))return l.replace(Rde,Cj)}else if(Pde.test(l))return l.replace(Nde,Cj);return l}function bde(l){return l.replace(kde,(h,d)=>(d=d.toLowerCase(),d==="colon"?":":d.charAt(0)==="#"?d.charAt(1)==="x"?String.fromCharCode(parseInt(d.substring(2),16)):String.fromCharCode(+d.substring(1)):""))}function ms(l,h){l=typeof l=="string"?l:l.source,h=h||"";let d={replace:(g,_)=>(_=_.source||_,_=_.replace(Dde,"$1"),l=l.replace(g,_),d),getRegex:()=>new RegExp(l,h)};return d}function Sde(l,h,d){if(l){let g;try{g=decodeURIComponent(bde(d)).replace(Fde,"").toLowerCase()}catch{return null}if(g.indexOf("javascript:")===0||g.indexOf("vbscript:")===0||g.indexOf("data:")===0)return null}h&&!Ode.test(d)&&(d=gBe(h,d));try{d=encodeURI(d).replace(/%25/g,"%")}catch{return null}return d}function gBe(l,h){CS[" "+l]||(Bde.test(l)?CS[" "+l]=l+"/":CS[" "+l]=II(l,"/",!0)),l=CS[" "+l];let d=l.indexOf(":")===-1;return h.substring(0,2)==="//"?d?h:l.replace(Lde,"$1")+h:h.charAt(0)==="/"?d?h:l.replace(Ude,"$1")+h:l+h}function Ah(l){let h=1,d,g;for(;h<arguments.length;h++){d=arguments[h];for(g in d)Object.prototype.hasOwnProperty.call(d,g)&&(l[g]=d[g])}return l}function wde(l,h){let d=l.replace(/\|/g,(b,S,E)=>{let N=!1,I=S;for(;--I>=0&&E[I]==="\\";)N=!N;return N?"|":" |"}),g=d.split(/ \|/),_=0;if(g[0].trim()||g.shift(),g.length>0&&!g[g.length-1].trim()&&g.pop(),g.length>h)g.splice(h);else for(;g.length<h;)g.push("");for(;_<g.length;_++)g[_]=g[_].trim().replace(/\\\|/g,"|");return g}function II(l,h,d){let g=l.length;if(g===0)return"";let _=0;for(;_<g;){let b=l.charAt(g-_-1);if(b===h&&!d)_++;else if(b!==h&&d)_++;else break}return l.slice(0,g-_)}function yBe(l,h){if(l.indexOf(h[1])===-1)return-1;let d=l.length,g=0,_=0;for(;_<d;_++)if(l[_]==="\\")_++;else if(l[_]===h[0])g++;else if(l[_]===h[1]&&(g--,g<0))return _;return-1}function Tde(l){l&&l.sanitize&&!l.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function Ede(l,h){if(h<1)return"";let d="";for(;h>1;)h&1&&(d+=l),h>>=1,l+=l;return d+l}function Mde(l,h,d,g){let _=h.href,b=h.title?La(h.title):null,S=l[1].replace(/\\([\[\]])/g,"$1");if(l[0].charAt(0)!=="!"){g.state.inLink=!0;let E={type:"link",raw:d,href:_,title:b,text:S,tokens:g.inlineTokens(S)};return g.state.inLink=!1,E}return{type:"image",raw:d,href:_,title:b,text:La(S)}}function vBe(l,h){let d=l.match(/^(\s+)(?:```)/);if(d===null)return h;let g=d[1];return h.split(`
`).map(_=>{let b=_.match(/^\s+/);if(b===null)return _;let[S]=b;return S.length>=g.length?_.slice(g.length):_}).join(`
`)}function _Be(l){return l.replace(/---/g,"").replace(/--/g,"").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1").replace(/'/g,"").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1").replace(/"/g,"").replace(/\.{3}/g,"")}function Cde(l){let h="",d,g,_=l.length;for(d=0;d<_;d++)g=l.charCodeAt(d),Math.random()>.5&&(g="x"+g.toString(16)),h+="&#"+g+";";return h}function wr(l,h,d){if(typeof l>"u"||l===null)throw new Error("marked(): input parameter is undefined or null");if(typeof l!="string")throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(l)+", string expected");if(typeof h=="function"&&(d=h,h=null),h=Ah({},wr.defaults,h||{}),Tde(h),d){let _=h.highlight,b;try{b=l9.lex(l,h)}catch(N){return d(N)}let S=function(N){let I;if(!N)try{h.walkTokens&&wr.walkTokens(b,h.walkTokens),I=sg.parse(b,h)}catch(B){N=B}return h.highlight=_,N?d(N):d(null,I)};if(!_||_.length<3||(delete h.highlight,!b.length))return S();let E=0;wr.walkTokens(b,function(N){N.type==="code"&&(E++,setTimeout(()=>{_(N.text,N.lang,function(I,B){if(I)return S(I);B!=null&&B!==N.text&&(N.text=B,N.escaped=!0),E--,E===0&&S()})},0))}),E===0&&S();return}function g(_){if(_.message+=`
Please report this to https://github.com/markedjs/marked.`,h.silent)return"<p>An error occurred:</p><pre>"+La(_.message+"",!0)+"</pre>";throw _}try{let _=l9.lex(l,h);if(h.walkTokens){if(h.async)return Promise.all(wr.walkTokens(_,h.walkTokens)).then(()=>sg.parse(_,h)).catch(g);wr.walkTokens(_,h.walkTokens)}return sg.parse(_,h)}catch(_){g(_)}}var a9,Ade,Rde,Pde,Nde,Ide,Cj,kde,Dde,Fde,Ode,CS,Bde,Lde,Ude,AS,kI,mr,jn,l9,DI,Aj,Rj,sg,xBe=C(()=>{a9=xde(),Ade=/[&<>"']/,Rde=/[&<>"']/g,Pde=/[<>"']|&(?!#?\w+;)/,Nde=/[<>"']|&(?!#?\w+;)/g,Ide={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Cj=l=>Ide[l],kde=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,Dde=/(^|[^\[])\^/g,Fde=/[^\w:]/g,Ode=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i,CS={},Bde=/^[^:]+:\/*[^/]*$/,Lde=/^([^:]+:)[\s\S]*$/,Ude=/^([^:]+:\/*[^/]*)[\s\S]*$/,AS={exec:function(){}},kI=class{constructor(l){this.options=l||a9}space(l){let h=this.rules.block.newline.exec(l);if(h&&h[0].length>0)return{type:"space",raw:h[0]}}code(l){let h=this.rules.block.code.exec(l);if(h){let d=h[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:h[0],codeBlockStyle:"indented",text:this.options.pedantic?d:II(d,`
`)}}}fences(l){let h=this.rules.block.fences.exec(l);if(h){let d=h[0],g=vBe(d,h[3]||"");return{type:"code",raw:d,lang:h[2]?h[2].trim():h[2],text:g}}}heading(l){let h=this.rules.block.heading.exec(l);if(h){let d=h[2].trim();if(/#$/.test(d)){let g=II(d,"#");(this.options.pedantic||!g||/ $/.test(g))&&(d=g.trim())}return{type:"heading",raw:h[0],depth:h[1].length,text:d,tokens:this.lexer.inline(d)}}}hr(l){let h=this.rules.block.hr.exec(l);if(h)return{type:"hr",raw:h[0]}}blockquote(l){let h=this.rules.block.blockquote.exec(l);if(h){let d=h[0].replace(/^ *>[ \t]?/gm,"");return{type:"blockquote",raw:h[0],tokens:this.lexer.blockTokens(d,[]),text:d}}}list(l){let h=this.rules.block.list.exec(l);if(h){let d,g,_,b,S,E,N,I,B,V,U,F,H=h[1].trim(),G=H.length>1,W={type:"list",raw:"",ordered:G,start:G?+H.slice(0,-1):"",loose:!1,items:[]};H=G?"\\d{1,9}\\".concat(H.slice(-1)):"\\".concat(H),this.options.pedantic&&(H=G?H:"[*+-]");let X=new RegExp("^( {0,3}".concat(H,")((?:[	 ][^\\n]*)?(?:\\n|$))"));for(;l&&(F=!1,!(!(h=X.exec(l))||this.rules.block.hr.test(l)));){if(d=h[0],l=l.substring(d.length),I=h[2].split(`
`,1)[0],B=l.split(`
`,1)[0],this.options.pedantic?(b=2,U=I.trimLeft()):(b=h[2].search(/[^ ]/),b=b>4?1:b,U=I.slice(b),b+=h[1].length),E=!1,!I&&/^ *$/.test(B)&&(d+=B+`
`,l=l.substring(B.length+1),F=!0),!F){let te=new RegExp("^ {0,".concat(Math.min(3,b-1),"}(?:[*+-]|\\d{1,9}[.)])((?: [^\\n]*)?(?:\\n|$))")),ae=new RegExp("^ {0,".concat(Math.min(3,b-1),"}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)")),oe=new RegExp("^ {0,".concat(Math.min(3,b-1),"}(?:```|~~~)")),ue=new RegExp("^ {0,".concat(Math.min(3,b-1),"}#"));for(;l&&(V=l.split(`
`,1)[0],I=V,this.options.pedantic&&(I=I.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(oe.test(I)||ue.test(I)||te.test(I)||ae.test(l)));){if(I.search(/[^ ]/)>=b||!I.trim())U+=`
`+I.slice(b);else if(!E)U+=`
`+I;else break;!E&&!I.trim()&&(E=!0),d+=V+`
`,l=l.substring(V.length+1)}}W.loose||(N?W.loose=!0:/\n *\n *$/.test(d)&&(N=!0)),this.options.gfm&&(g=/^\[[ xX]\] /.exec(U),g&&(_=g[0]!=="[ ] ",U=U.replace(/^\[[ xX]\] +/,""))),W.items.push({type:"list_item",raw:d,task:!!g,checked:_,loose:!1,text:U}),W.raw+=d}W.items[W.items.length-1].raw=d.trimRight(),W.items[W.items.length-1].text=U.trimRight(),W.raw=W.raw.trimRight();let Z=W.items.length;for(S=0;S<Z;S++){this.lexer.state.top=!1,W.items[S].tokens=this.lexer.blockTokens(W.items[S].text,[]);let te=W.items[S].tokens.filter(oe=>oe.type==="space"),ae=te.every(oe=>{let ue=oe.raw.split(""),Ee=0;for(let Ie of ue)if(Ie===`
`&&(Ee+=1),Ee>1)return!0;return!1});!W.loose&&te.length&&ae&&(W.loose=!0,W.items[S].loose=!0)}return W}}html(l){let h=this.rules.block.html.exec(l);if(h){let d={type:"html",raw:h[0],pre:!this.options.sanitizer&&(h[1]==="pre"||h[1]==="script"||h[1]==="style"),text:h[0]};if(this.options.sanitize){let g=this.options.sanitizer?this.options.sanitizer(h[0]):La(h[0]);d.type="paragraph",d.text=g,d.tokens=this.lexer.inline(g)}return d}}def(l){let h=this.rules.block.def.exec(l);if(h)return h[3]&&(h[3]=h[3].substring(1,h[3].length-1)),{type:"def",tag:h[1].toLowerCase().replace(/\s+/g," "),raw:h[0],href:h[2],title:h[3]}}table(l){let h=this.rules.block.table.exec(l);if(h){let d={type:"table",header:wde(h[1]).map(g=>({text:g})),align:h[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:h[3]&&h[3].trim()?h[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(d.header.length===d.align.length){d.raw=h[0];let g=d.align.length,_,b,S,E;for(_=0;_<g;_++)/^ *-+: *$/.test(d.align[_])?d.align[_]="right":/^ *:-+: *$/.test(d.align[_])?d.align[_]="center":/^ *:-+ *$/.test(d.align[_])?d.align[_]="left":d.align[_]=null;for(g=d.rows.length,_=0;_<g;_++)d.rows[_]=wde(d.rows[_],d.header.length).map(N=>({text:N}));for(g=d.header.length,b=0;b<g;b++)d.header[b].tokens=this.lexer.inline(d.header[b].text);for(g=d.rows.length,b=0;b<g;b++)for(E=d.rows[b],S=0;S<E.length;S++)E[S].tokens=this.lexer.inline(E[S].text);return d}}}lheading(l){let h=this.rules.block.lheading.exec(l);if(h)return{type:"heading",raw:h[0],depth:h[2].charAt(0)==="="?1:2,text:h[1],tokens:this.lexer.inline(h[1])}}paragraph(l){let h=this.rules.block.paragraph.exec(l);if(h){let d=h[1].charAt(h[1].length-1)===`
`?h[1].slice(0,-1):h[1];return{type:"paragraph",raw:h[0],text:d,tokens:this.lexer.inline(d)}}}text(l){let h=this.rules.block.text.exec(l);if(h)return{type:"text",raw:h[0],text:h[0],tokens:this.lexer.inline(h[0])}}escape(l){let h=this.rules.inline.escape.exec(l);if(h)return{type:"escape",raw:h[0],text:La(h[1])}}tag(l){let h=this.rules.inline.tag.exec(l);if(h)return!this.lexer.state.inLink&&/^<a /i.test(h[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(h[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(h[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(h[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:h[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(h[0]):La(h[0]):h[0]}}link(l){let h=this.rules.inline.link.exec(l);if(h){let d=h[2].trim();if(!this.options.pedantic&&/^</.test(d)){if(!/>$/.test(d))return;let b=II(d.slice(0,-1),"\\");if((d.length-b.length)%2===0)return}else{let b=yBe(h[2],"()");if(b>-1){let S=(h[0].indexOf("!")===0?5:4)+h[1].length+b;h[2]=h[2].substring(0,b),h[0]=h[0].substring(0,S).trim(),h[3]=""}}let g=h[2],_="";if(this.options.pedantic){let b=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(g);b&&(g=b[1],_=b[3])}else _=h[3]?h[3].slice(1,-1):"";return g=g.trim(),/^</.test(g)&&(this.options.pedantic&&!/>$/.test(d)?g=g.slice(1):g=g.slice(1,-1)),Mde(h,{href:g&&g.replace(this.rules.inline._escapes,"$1"),title:_&&_.replace(this.rules.inline._escapes,"$1")},h[0],this.lexer)}}reflink(l,h){let d;if((d=this.rules.inline.reflink.exec(l))||(d=this.rules.inline.nolink.exec(l))){let g=(d[2]||d[1]).replace(/\s+/g," ");if(g=h[g.toLowerCase()],!g||!g.href){let _=d[0].charAt(0);return{type:"text",raw:_,text:_}}return Mde(d,g,d[0],this.lexer)}}emStrong(l,h,d=""){let g=this.rules.inline.emStrong.lDelim.exec(l);if(!g||g[3]&&d.match(/[\p{L}\p{N}]/u))return;let _=g[1]||g[2]||"";if(!_||_&&(d===""||this.rules.inline.punctuation.exec(d))){let b=g[0].length-1,S,E,N=b,I=0,B=g[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(B.lastIndex=0,h=h.slice(-1*l.length+b);(g=B.exec(h))!=null;){if(S=g[1]||g[2]||g[3]||g[4]||g[5]||g[6],!S)continue;if(E=S.length,g[3]||g[4]){N+=E;continue}else if((g[5]||g[6])&&b%3&&!((b+E)%3)){I+=E;continue}if(N-=E,N>0)continue;if(E=Math.min(E,E+N+I),Math.min(b,E)%2){let U=l.slice(1,b+g.index+E);return{type:"em",raw:l.slice(0,b+g.index+E+1),text:U,tokens:this.lexer.inlineTokens(U)}}let V=l.slice(2,b+g.index+E-1);return{type:"strong",raw:l.slice(0,b+g.index+E+1),text:V,tokens:this.lexer.inlineTokens(V)}}}}codespan(l){let h=this.rules.inline.code.exec(l);if(h){let d=h[2].replace(/\n/g," "),g=/[^ ]/.test(d),_=/^ /.test(d)&&/ $/.test(d);return g&&_&&(d=d.substring(1,d.length-1)),d=La(d,!0),{type:"codespan",raw:h[0],text:d}}}br(l){let h=this.rules.inline.br.exec(l);if(h)return{type:"br",raw:h[0]}}del(l){let h=this.rules.inline.del.exec(l);if(h)return{type:"del",raw:h[0],text:h[2],tokens:this.lexer.inlineTokens(h[2])}}autolink(l,h){let d=this.rules.inline.autolink.exec(l);if(d){let g,_;return d[2]==="@"?(g=La(this.options.mangle?h(d[1]):d[1]),_="mailto:"+g):(g=La(d[1]),_=g),{type:"link",raw:d[0],text:g,href:_,tokens:[{type:"text",raw:g,text:g}]}}}url(l,h){let d;if(d=this.rules.inline.url.exec(l)){let g,_;if(d[2]==="@")g=La(this.options.mangle?h(d[0]):d[0]),_="mailto:"+g;else{let b;do b=d[0],d[0]=this.rules.inline._backpedal.exec(d[0])[0];while(b!==d[0]);g=La(d[0]),d[1]==="www."?_="http://"+g:_=g}return{type:"link",raw:d[0],text:g,href:_,tokens:[{type:"text",raw:g,text:g}]}}}inlineText(l,h){let d=this.rules.inline.text.exec(l);if(d){let g;return this.lexer.state.inRawBlock?g=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(d[0]):La(d[0]):d[0]:g=La(this.options.smartypants?h(d[0]):d[0]),{type:"text",raw:d[0],text:g}}}},mr={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?<?([^\s>]+)>?(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:AS,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/},mr._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/,mr._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/,mr.def=ms(mr.def).replace("label",mr._label).replace("title",mr._title).getRegex(),mr.bullet=/(?:[*+-]|\d{1,9}[.)])/,mr.listItemStart=ms(/^( *)(bull) */).replace("bull",mr.bullet).getRegex(),mr.list=ms(mr.list).replace(/bull/g,mr.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+mr.def.source+")").getRegex(),mr._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",mr._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,mr.html=ms(mr.html,"i").replace("comment",mr._comment).replace("tag",mr._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),mr.paragraph=ms(mr._paragraph).replace("hr",mr.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",mr._tag).getRegex(),mr.blockquote=ms(mr.blockquote).replace("paragraph",mr.paragraph).getRegex(),mr.normal=Ah({},mr),mr.gfm=Ah({},mr.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"}),mr.gfm.table=ms(mr.gfm.table).replace("hr",mr.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",mr._tag).getRegex(),mr.gfm.paragraph=ms(mr._paragraph).replace("hr",mr.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",mr.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",mr._tag).getRegex(),mr.pedantic=Ah({},mr.normal,{html:ms(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",mr._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:AS,paragraph:ms(mr.normal._paragraph).replace("hr",mr.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",mr.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()}),jn={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:AS,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^[^_*]*?\_\_[^_*]*?\*[^_*]*?(?=\_\_)|[^*]+(?=[^*])|[punct_](\*+)(?=[\s]|$)|[^punct*_\s](\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|[^punct*_\s](\*+)(?=[^punct*_\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?\_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|[punct*](\_+)(?=[\s]|$)|[^punct*_\s](\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:AS,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/},jn._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~",jn.punctuation=ms(jn.punctuation).replace(/punctuation/g,jn._punctuation).getRegex(),jn.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g,jn.escapedEmSt=/\\\*|\\_/g,jn._comment=ms(mr._comment).replace("(?:-->|$)","-->").getRegex(),jn.emStrong.lDelim=ms(jn.emStrong.lDelim).replace(/punct/g,jn._punctuation).getRegex(),jn.emStrong.rDelimAst=ms(jn.emStrong.rDelimAst,"g").replace(/punct/g,jn._punctuation).getRegex(),jn.emStrong.rDelimUnd=ms(jn.emStrong.rDelimUnd,"g").replace(/punct/g,jn._punctuation).getRegex(),jn._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,jn._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,jn._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,jn.autolink=ms(jn.autolink).replace("scheme",jn._scheme).replace("email",jn._email).getRegex(),jn._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,jn.tag=ms(jn.tag).replace("comment",jn._comment).replace("attribute",jn._attribute).getRegex(),jn._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,jn._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,jn._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,jn.link=ms(jn.link).replace("label",jn._label).replace("href",jn._href).replace("title",jn._title).getRegex(),jn.reflink=ms(jn.reflink).replace("label",jn._label).replace("ref",mr._label).getRegex(),jn.nolink=ms(jn.nolink).replace("ref",mr._label).getRegex(),jn.reflinkSearch=ms(jn.reflinkSearch,"g").replace("reflink",jn.reflink).replace("nolink",jn.nolink).getRegex(),jn.normal=Ah({},jn),jn.pedantic=Ah({},jn.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:ms(/^!?\[(label)\]\((.*?)\)/).replace("label",jn._label).getRegex(),reflink:ms(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",jn._label).getRegex()}),jn.gfm=Ah({},jn.normal,{escape:ms(jn.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/}),jn.gfm.url=ms(jn.gfm.url,"i").replace("email",jn.gfm._extended_email).getRegex(),jn.breaks=Ah({},jn.gfm,{br:ms(jn.br).replace("{2,}","*").getRegex(),text:ms(jn.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()}),l9=class Tee{constructor(h){this.tokens=[],this.tokens.links=Object.create(null),this.options=h||a9,this.options.tokenizer=this.options.tokenizer||new kI,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let d={block:mr.normal,inline:jn.normal};this.options.pedantic?(d.block=mr.pedantic,d.inline=jn.pedantic):this.options.gfm&&(d.block=mr.gfm,this.options.breaks?d.inline=jn.breaks:d.inline=jn.gfm),this.tokenizer.rules=d}static get rules(){return{block:mr,inline:jn}}static lex(h,d){return new Tee(d).lex(h)}static lexInline(h,d){return new Tee(d).inlineTokens(h)}lex(h){h=h.replace(/\r\n|\r/g,`
`),this.blockTokens(h,this.tokens);let d;for(;d=this.inlineQueue.shift();)this.inlineTokens(d.src,d.tokens);return this.tokens}blockTokens(h,d=[]){this.options.pedantic?h=h.replace(/\t/g,"    ").replace(/^ +$/gm,""):h=h.replace(/^( *)(\t+)/gm,(E,N,I)=>N+"    ".repeat(I.length));let g,_,b,S;for(;h;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(E=>(g=E.call({lexer:this},h,d))?(h=h.substring(g.raw.length),d.push(g),!0):!1))){if(g=this.tokenizer.space(h)){h=h.substring(g.raw.length),g.raw.length===1&&d.length>0?d[d.length-1].raw+=`
`:d.push(g);continue}if(g=this.tokenizer.code(h)){h=h.substring(g.raw.length),_=d[d.length-1],_&&(_.type==="paragraph"||_.type==="text")?(_.raw+=`
`+g.raw,_.text+=`
`+g.text,this.inlineQueue[this.inlineQueue.length-1].src=_.text):d.push(g);continue}if(g=this.tokenizer.fences(h)){h=h.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.heading(h)){h=h.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.hr(h)){h=h.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.blockquote(h)){h=h.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.list(h)){h=h.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.html(h)){h=h.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.def(h)){h=h.substring(g.raw.length),_=d[d.length-1],_&&(_.type==="paragraph"||_.type==="text")?(_.raw+=`
`+g.raw,_.text+=`
`+g.raw,this.inlineQueue[this.inlineQueue.length-1].src=_.text):this.tokens.links[g.tag]||(this.tokens.links[g.tag]={href:g.href,title:g.title});continue}if(g=this.tokenizer.table(h)){h=h.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.lheading(h)){h=h.substring(g.raw.length),d.push(g);continue}if(b=h,this.options.extensions&&this.options.extensions.startBlock){let E=1/0,N=h.slice(1),I;this.options.extensions.startBlock.forEach(function(B){I=B.call({lexer:this},N),typeof I=="number"&&I>=0&&(E=Math.min(E,I))}),E<1/0&&E>=0&&(b=h.substring(0,E+1))}if(this.state.top&&(g=this.tokenizer.paragraph(b))){_=d[d.length-1],S&&_.type==="paragraph"?(_.raw+=`
`+g.raw,_.text+=`
`+g.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=_.text):d.push(g),S=b.length!==h.length,h=h.substring(g.raw.length);continue}if(g=this.tokenizer.text(h)){h=h.substring(g.raw.length),_=d[d.length-1],_&&_.type==="text"?(_.raw+=`
`+g.raw,_.text+=`
`+g.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=_.text):d.push(g);continue}if(h){let E="Infinite loop on byte: "+h.charCodeAt(0);if(this.options.silent){console.error(E);break}else throw new Error(E)}}return this.state.top=!0,d}inline(h,d=[]){return this.inlineQueue.push({src:h,tokens:d}),d}inlineTokens(h,d=[]){let g,_,b,S=h,E,N,I;if(this.tokens.links){let B=Object.keys(this.tokens.links);if(B.length>0)for(;(E=this.tokenizer.rules.inline.reflinkSearch.exec(S))!=null;)B.includes(E[0].slice(E[0].lastIndexOf("[")+1,-1))&&(S=S.slice(0,E.index)+"["+Ede("a",E[0].length-2)+"]"+S.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(E=this.tokenizer.rules.inline.blockSkip.exec(S))!=null;)S=S.slice(0,E.index)+"["+Ede("a",E[0].length-2)+"]"+S.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(E=this.tokenizer.rules.inline.escapedEmSt.exec(S))!=null;)S=S.slice(0,E.index)+"++"+S.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);for(;h;)if(N||(I=""),N=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(B=>(g=B.call({lexer:this},h,d))?(h=h.substring(g.raw.length),d.push(g),!0):!1))){if(g=this.tokenizer.escape(h)){h=h.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.tag(h)){h=h.substring(g.raw.length),_=d[d.length-1],_&&g.type==="text"&&_.type==="text"?(_.raw+=g.raw,_.text+=g.text):d.push(g);continue}if(g=this.tokenizer.link(h)){h=h.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.reflink(h,this.tokens.links)){h=h.substring(g.raw.length),_=d[d.length-1],_&&g.type==="text"&&_.type==="text"?(_.raw+=g.raw,_.text+=g.text):d.push(g);continue}if(g=this.tokenizer.emStrong(h,S,I)){h=h.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.codespan(h)){h=h.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.br(h)){h=h.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.del(h)){h=h.substring(g.raw.length),d.push(g);continue}if(g=this.tokenizer.autolink(h,Cde)){h=h.substring(g.raw.length),d.push(g);continue}if(!this.state.inLink&&(g=this.tokenizer.url(h,Cde))){h=h.substring(g.raw.length),d.push(g);continue}if(b=h,this.options.extensions&&this.options.extensions.startInline){let B=1/0,V=h.slice(1),U;this.options.extensions.startInline.forEach(function(F){U=F.call({lexer:this},V),typeof U=="number"&&U>=0&&(B=Math.min(B,U))}),B<1/0&&B>=0&&(b=h.substring(0,B+1))}if(g=this.tokenizer.inlineText(b,_Be)){h=h.substring(g.raw.length),g.raw.slice(-1)!=="_"&&(I=g.raw.slice(-1)),N=!0,_=d[d.length-1],_&&_.type==="text"?(_.raw+=g.raw,_.text+=g.text):d.push(g);continue}if(h){let B="Infinite loop on byte: "+h.charCodeAt(0);if(this.options.silent){console.error(B);break}else throw new Error(B)}}return d}},DI=class{constructor(l){this.options=l||a9}code(l,h,d){let g=(h||"").match(/\S*/)[0];if(this.options.highlight){let _=this.options.highlight(l,g);_!=null&&_!==l&&(d=!0,l=_)}return l=l.replace(/\n$/,"")+`
`,g?'<pre><code class="'+this.options.langPrefix+La(g,!0)+'">'+(d?l:La(l,!0))+`</code></pre>
`:"<pre><code>"+(d?l:La(l,!0))+`</code></pre>
`}blockquote(l){return`<blockquote>
`.concat(l,`</blockquote>
`)}html(l){return l}heading(l,h,d,g){if(this.options.headerIds){let _=this.options.headerPrefix+g.slug(d);return"<h".concat(h,' id="').concat(_,'">').concat(l,"</h").concat(h,`>
`)}return"<h".concat(h,">").concat(l,"</h").concat(h,`>
`)}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(l,h,d){let g=h?"ol":"ul",_=h&&d!==1?' start="'+d+'"':"";return"<"+g+_+`>
`+l+"</"+g+`>
`}listitem(l){return"<li>".concat(l,`</li>
`)}checkbox(l){return"<input "+(l?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(l){return"<p>".concat(l,`</p>
`)}table(l,h){return h&&(h="<tbody>".concat(h,"</tbody>")),`<table>
<thead>
`+l+`</thead>
`+h+`</table>
`}tablerow(l){return`<tr>
`.concat(l,`</tr>
`)}tablecell(l,h){let d=h.header?"th":"td";return(h.align?"<".concat(d,' align="').concat(h.align,'">'):"<".concat(d,">"))+l+"</".concat(d,`>
`)}strong(l){return"<strong>".concat(l,"</strong>")}em(l){return"<em>".concat(l,"</em>")}codespan(l){return"<code>".concat(l,"</code>")}br(){return this.options.xhtml?"<br/>":"<br>"}del(l){return"<del>".concat(l,"</del>")}link(l,h,d){if(l=Sde(this.options.sanitize,this.options.baseUrl,l),l===null)return d;let g='<a href="'+La(l)+'"';return h&&(g+=' title="'+h+'"'),g+=">"+d+"</a>",g}image(l,h,d){if(l=Sde(this.options.sanitize,this.options.baseUrl,l),l===null)return d;let g='<img src="'.concat(l,'" alt="').concat(d,'"');return h&&(g+=' title="'.concat(h,'"')),g+=this.options.xhtml?"/>":">",g}text(l){return l}},Aj=class{strong(l){return l}em(l){return l}codespan(l){return l}del(l){return l}html(l){return l}text(l){return l}link(l,h,d){return""+d}image(l,h,d){return""+d}br(){return""}},Rj=class{constructor(){this.seen={}}serialize(l){return l.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(l,h){let d=l,g=0;if(this.seen.hasOwnProperty(d)){g=this.seen[l];do g++,d=l+"-"+g;while(this.seen.hasOwnProperty(d))}return h||(this.seen[l]=g,this.seen[d]=0),d}slug(l,h={}){let d=this.serialize(l);return this.getNextSafeSlug(d,h.dryrun)}},sg=class Eee{constructor(h){this.options=h||a9,this.options.renderer=this.options.renderer||new DI,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Aj,this.slugger=new Rj}static parse(h,d){return new Eee(d).parse(h)}static parseInline(h,d){return new Eee(d).parseInline(h)}parse(h,d=!0){let g="",_,b,S,E,N,I,B,V,U,F,H,G,W,X,Z,te,ae,oe,ue,Ee=h.length;for(_=0;_<Ee;_++){if(F=h[_],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[F.type]&&(ue=this.options.extensions.renderers[F.type].call({parser:this},F),ue!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(F.type))){g+=ue||"";continue}switch(F.type){case"space":continue;case"hr":{g+=this.renderer.hr();continue}case"heading":{g+=this.renderer.heading(this.parseInline(F.tokens),F.depth,bde(this.parseInline(F.tokens,this.textRenderer)),this.slugger);continue}case"code":{g+=this.renderer.code(F.text,F.lang,F.escaped);continue}case"table":{for(V="",B="",E=F.header.length,b=0;b<E;b++)B+=this.renderer.tablecell(this.parseInline(F.header[b].tokens),{header:!0,align:F.align[b]});for(V+=this.renderer.tablerow(B),U="",E=F.rows.length,b=0;b<E;b++){for(I=F.rows[b],B="",N=I.length,S=0;S<N;S++)B+=this.renderer.tablecell(this.parseInline(I[S].tokens),{header:!1,align:F.align[S]});U+=this.renderer.tablerow(B)}g+=this.renderer.table(V,U);continue}case"blockquote":{U=this.parse(F.tokens),g+=this.renderer.blockquote(U);continue}case"list":{for(H=F.ordered,G=F.start,W=F.loose,E=F.items.length,U="",b=0;b<E;b++)Z=F.items[b],te=Z.checked,ae=Z.task,X="",Z.task&&(oe=this.renderer.checkbox(te),W?Z.tokens.length>0&&Z.tokens[0].type==="paragraph"?(Z.tokens[0].text=oe+" "+Z.tokens[0].text,Z.tokens[0].tokens&&Z.tokens[0].tokens.length>0&&Z.tokens[0].tokens[0].type==="text"&&(Z.tokens[0].tokens[0].text=oe+" "+Z.tokens[0].tokens[0].text)):Z.tokens.unshift({type:"text",text:oe}):X+=oe),X+=this.parse(Z.tokens,W),U+=this.renderer.listitem(X,ae,te);g+=this.renderer.list(U,H,G);continue}case"html":{g+=this.renderer.html(F.text);continue}case"paragraph":{g+=this.renderer.paragraph(this.parseInline(F.tokens));continue}case"text":{for(U=F.tokens?this.parseInline(F.tokens):F.text;_+1<Ee&&h[_+1].type==="text";)F=h[++_],U+=`
`+(F.tokens?this.parseInline(F.tokens):F.text);g+=d?this.renderer.paragraph(U):U;continue}default:{let Ie='Token with "'+F.type+'" type was not found.';if(this.options.silent){console.error(Ie);return}else throw new Error(Ie)}}}return g}parseInline(h,d){d=d||this.renderer;let g="",_,b,S,E=h.length;for(_=0;_<E;_++){if(b=h[_],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[b.type]&&(S=this.options.extensions.renderers[b.type].call({parser:this},b),S!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(b.type))){g+=S||"";continue}switch(b.type){case"escape":{g+=d.text(b.text);break}case"html":{g+=d.html(b.text);break}case"link":{g+=d.link(b.href,b.title,this.parseInline(b.tokens,d));break}case"image":{g+=d.image(b.href,b.title,b.text);break}case"strong":{g+=d.strong(this.parseInline(b.tokens,d));break}case"em":{g+=d.em(this.parseInline(b.tokens,d));break}case"codespan":{g+=d.codespan(b.text);break}case"br":{g+=d.br();break}case"del":{g+=d.del(this.parseInline(b.tokens,d));break}case"text":{g+=d.text(b.text);break}default:{let N='Token with "'+b.type+'" type was not found.';if(this.options.silent){console.error(N);return}else throw new Error(N)}}}return g}},wr.options=wr.setOptions=function(l){return Ah(wr.defaults,l),mBe(wr.defaults),wr},wr.getDefaults=xde,wr.defaults=a9,wr.use=function(...l){let h=Ah({},...l),d=wr.defaults.extensions||{renderers:{},childTokens:{}},g;l.forEach(_=>{if(_.extensions&&(g=!0,_.extensions.forEach(b=>{if(!b.name)throw new Error("extension name required");if(b.renderer){let S=d.renderers?d.renderers[b.name]:null;S?d.renderers[b.name]=function(...E){let N=b.renderer.apply(this,E);return N===!1&&(N=S.apply(this,E)),N}:d.renderers[b.name]=b.renderer}if(b.tokenizer){if(!b.level||b.level!=="block"&&b.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");d[b.level]?d[b.level].unshift(b.tokenizer):d[b.level]=[b.tokenizer],b.start&&(b.level==="block"?d.startBlock?d.startBlock.push(b.start):d.startBlock=[b.start]:b.level==="inline"&&(d.startInline?d.startInline.push(b.start):d.startInline=[b.start]))}b.childTokens&&(d.childTokens[b.name]=b.childTokens)})),_.renderer){let b=wr.defaults.renderer||new DI;for(let S in _.renderer){let E=b[S];b[S]=(...N)=>{let I=_.renderer[S].apply(b,N);return I===!1&&(I=E.apply(b,N)),I}}h.renderer=b}if(_.tokenizer){let b=wr.defaults.tokenizer||new kI;for(let S in _.tokenizer){let E=b[S];b[S]=(...N)=>{let I=_.tokenizer[S].apply(b,N);return I===!1&&(I=E.apply(b,N)),I}}h.tokenizer=b}if(_.walkTokens){let b=wr.defaults.walkTokens;h.walkTokens=function(S){let E=[];return E.push(_.walkTokens.call(this,S)),b&&(E=E.concat(b.call(this,S))),E}}g&&(h.extensions=d),wr.setOptions(h)})},wr.walkTokens=function(l,h){let d=[];for(let g of l)switch(d=d.concat(h.call(wr,g)),g.type){case"table":{for(let _ of g.header)d=d.concat(wr.walkTokens(_.tokens,h));for(let _ of g.rows)for(let b of _)d=d.concat(wr.walkTokens(b.tokens,h));break}case"list":{d=d.concat(wr.walkTokens(g.items,h));break}default:wr.defaults.extensions&&wr.defaults.extensions.childTokens&&wr.defaults.extensions.childTokens[g.type]?wr.defaults.extensions.childTokens[g.type].forEach(function(_){d=d.concat(wr.walkTokens(g[_],h))}):g.tokens&&(d=d.concat(wr.walkTokens(g.tokens,h)))}return d},wr.parseInline=function(l,h){if(typeof l>"u"||l===null)throw new Error("marked.parseInline(): input parameter is undefined or null");if(typeof l!="string")throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(l)+", string expected");h=Ah({},wr.defaults,h||{}),Tde(h);try{let d=l9.lexInline(l,h);return h.walkTokens&&wr.walkTokens(d,h.walkTokens),sg.parseInline(d,h)}catch(d){if(d.message+=`
Please report this to https://github.com/markedjs/marked.`,h.silent)return"<p>An error occurred:</p><pre>"+La(d.message+"",!0)+"</pre>";throw d}},wr.Parser=sg,wr.parser=sg.parse,wr.Renderer=DI,wr.TextRenderer=Aj,wr.Lexer=l9,wr.lexer=l9.lex,wr.Tokenizer=kI,wr.Slugger=Rj,wr.parse=wr,wr.options,wr.setOptions,wr.use,wr.walkTokens,wr.parseInline,sg.parse,l9.lex}),zde,Vde,Pj,Gde=C(()=>{at(),AI(),Vde=me(Dv)(zde||(zde=$([`
  padding: 6px;
`]))),Pj=Vde}),Io,FI,RS,OI,$de,Hde,jde,Nj,Wde,qde,Xde,Ij,Yde,Kde,Zde,Qde,Jde,PS,NS,efe,tfe,nfe,rfe,ife,sfe,ofe,afe,lfe,cfe,ufe,hfe,kj,IS=C(()=>{Io=z(Le()),pBe(),at(),Ei(),Qn(),Fe(),xBe(),wS(),Gde(),FI=({title:l,message:h})=>"".concat(l," ").concat(h),RS=(()=>{let l=new Map;return{add:h=>{let d=FI(h);l.has(d)?l.set(d,l.get(d)+1):l.set(d,1)},delete:h=>{let d=FI(h);l.has(d)&&l.get(d)>1?l.set(d,l.get(d)-1):l.delete(d)},clear:()=>{l.clear()},check:h=>l.has(FI(h))}})(),OI=(()=>{let l=new Map;return{add:h=>{l.has(h)?l.set(h,l.get(h)+1):l.set(h,1)},delete:h=>{l.has(h)&&l.get(h)>1?l.set(h,l.get(h)-1):l.delete(h)},clear:()=>{l.clear()},check:h=>l.has(h),get types(){return Array.of(...l.keys())}}})(),Hde=me.div($de||($de=$([`
  width: 100%;
  border-radius: 4px;
  display: flex;
  gap: 12px;
  `,`;
  background-color: rgba(40, 43, 47, 0.8);
  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.25), 0 2px 6px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(14px);

  @supports not (backdrop-filter: blur()) {
    background: rgba(40, 43, 47, 0.95);
  }
`])),Si),Nj=me.div(jde||(jde=$([`
  font-size: 14px;
  font-weight: bold;
  color: #fff;
`]))),qde=me.div(Wde||(Wde=$([`
  flex: 1;
  flex-direction: column;
  width: 0;
  display: flex;
  padding: 16px 0;
  gap: 12px;
`]))),Ij=me.div(Xde||(Xde=$([`
  color: #b4b4b4;
  font-size: 12px;
  line-height: 1.4;

  a {
    color: rgba(255, 255, 255, 0.9);
  }

  em {
    font-style: italic;
  }

  strong {
    font-weight: bold;
    color: #d5d5d5;
  }

  p {
    margin-bottom: 8px;
  }

  code {
    font-family: monospace;
    background: rgba(0, 0, 0, 0.3);
    padding: 1px 1px 2px;
    border-radius: 4px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    white-space: pre-wrap;
  }

  pre > code {
    white-space: pre;
    display: block;
    overflow: auto;
    padding: 4px;
  }

  pre {
    white-space: pre-wrap;
    margin-bottom: 8px;
  }
`]))),Kde=me.button(Yde||(Yde=$([`
  color: rgba(255, 255, 255, 0.9);
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: center;
  background: none;
  border: none;
  padding-left: 12px;
  padding-right: 12px;
  border-left: 1px solid rgba(255, 255, 255, 0.05);

  &:hover {
    background: rgba(255, 255, 255, 0.05);
  }
`]))),Zde={info:"#3b82f6",success:"#10b981",warning:"#f59e0b",error:"#ef4444"},Jde=me.div(Qde||(Qde=$([`
  display: flex;
  justify-content: center;
  margin-left: 12px;
  padding-top: 21px;

  ::before {
    content: '';
    width: 8px;
    height: 8px;
    border-radius: 999999px;
    background-color: `,`;
  }
`])),({type:l})=>Zde[l]),PS=l=>(h,d,g=[],_=!1)=>{(_||!RS.check({title:h,message:d}))&&(RS.add({title:h,message:d}),OI.add(l),NI.custom(b=>Io.default.createElement(Hde,null,Io.default.createElement(Jde,{type:l}),Io.default.createElement(qde,null,Io.default.createElement(Nj,null,h),Io.default.createElement(Ij,{dangerouslySetInnerHTML:{__html:wr.parse(d)}}),g.length>0&&Io.default.createElement(Ij,null,Io.default.createElement("span",null,"Docs:"," ",g.map((S,E)=>Io.default.createElement(Io.Fragment,{key:E},E>0&&", ",Io.default.createElement("a",{target:"_blank",href:S.url},S.title)))))),Io.default.createElement(Kde,{onClick:()=>{NI.remove(b.id),RS.delete({title:h,message:d}),OI.delete(l)}},"Close")),{duration:1/0}))},NS={warning:PS("warning"),success:PS("success"),info:PS("info"),error:PS("error")},tfe=me.div(efe||(efe=$([`
  display: flex;
  justify-content: `,`;
  gap: 12px;
`])),({align:l})=>l==="center"?"center":"flex-end"),rfe=me.button(nfe||(nfe=$([`
  position: relative;
  border-radius: 4px;
  display: flex;
  align-items: center;
  gap: 12px;
  `,`;
  background-color: rgba(40, 43, 47, 0.8);
  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.25), 0 2px 6px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(14px);
  border: none;
  padding: 12px;
  color: #fff;
  overflow: hidden;

  ::before {
    content: '';
    position: absolute;
    inset: 0;
  }

  :hover::before {
    background: `,`;
  }

  @supports not (backdrop-filter: blur()) {
    background: rgba(40, 43, 47, 0.95);
  }
`])),Si,({danger:l})=>l?"rgba(255, 0, 0, 0.1)":"rgba(255, 255, 255, 0.1)"),sfe=me.div(ife||(ife=$([`
  z-index: 10;
  display: flex;
  flex-direction: column;
  gap: 8px;
  position: fixed;
  right: 92px;
  top: 50px;
  width: 500px;
  height: 85vh;
  min-height: 400px;
`]))),afe=me.div(ofe||(ofe=$([`
  overflow: hidden;
  pointer-events: auto;
  border-radius: 4px;

  & > div {
    display: flex;
    flex-direction: column-reverse;
    gap: 8px;
    overflow: scroll;
    height: 100%;
  }
`]))),cfe=me.div(lfe||(lfe=$([`
  width: fit-content;
  padding: 8px;
  border-radius: 4px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  color: #b4b4b4;
  font-size: 12px;
  line-height: 1.4;
`]))),ufe=()=>{let{hasNotifications:l}=kj();return kv({enabled:!l},()=>Io.default.createElement(Pj,null,Io.default.createElement(cfe,null,Io.default.createElement(Nj,null,"No notifications"),"Notifications will appear here when you get them.")))},hfe=()=>{var l;let{toasts:h,handlers:d}=Mj(),{startPause:g,endPause:_}=d,b=(l=Dr(ge().atomP.ahistoric.pinNotifications))!=null?l:!1;return Io.default.createElement(sfe,null,b?h.length>0&&Io.default.createElement(afe,{onMouseEnter:g,onMouseLeave:_},Io.default.createElement("div",null,h.map(S=>Io.default.createElement("div",{key:S.id},S.message(S))))):null,Io.default.createElement(tfe,{align:"side"},b&&h.length>0&&Io.default.createElement(rfe,{onClick:()=>{OI.clear(),RS.clear(),NI.remove()},danger:!0},"Clear")))},kj=()=>{let{toasts:l}=Mj();return{hasNotifications:l.length>0}}});function Dj(l,h){var d;let g=Object.values((d=(0,dfe.val)(l.pointers.historic.sheetsById))!=null?d:{}),_=g.flatMap(S=>{var E;return Object.values((E=S==null?void 0:S.staticOverrides.byObject)!=null?E:{})}).flatMap(S=>Object.values(S??{})),b=[...g.flatMap(S=>{var E,N;return Object.values((N=(E=S==null?void 0:S.sequence)==null?void 0:E.tracksByObject)!=null?N:{})}).flatMap(S=>{var E;return Object.values((E=S==null?void 0:S.trackData)!=null?E:{})}).flatMap(S=>S==null?void 0:S.keyframes).map(S=>S==null?void 0:S.value)];return _.forEach(S=>{Ne(S,E=>{b.push(E)},[])}),b.filter(S=>(S==null?void 0:S.type)&&(h?(S==null?void 0:S.type)==h:typeof(S==null?void 0:S.type)=="string")).map(S=>S.id).filter((S,E,N)=>S!==null&&S!==""&&N.indexOf(S)===E)}var dfe,ffe=C(()=>{dfe=Jt,Ht()});function pfe(l,h){let d=new File([l],h),g=URL.createObjectURL(d),_=Object.assign(document.createElement("a"),{href:g,target:"_blank",rel:"noopener"});_.setAttribute("download",h),_.click(),setTimeout(()=>{URL.revokeObjectURL(g)},4e4)}var Mc,mfe,gfe,yfe,vfe,_fe,xfe,bfe,Sfe,wfe,bBe=C(()=>{Fe(),Zd(),Yd(),Mc=z(Le()),at(),zhe(),dBe(),mfe=z(fBe()),IS(),ffe(),yfe=me.div(gfe||(gfe=$([""]))),_fe=me.div(vfe||(vfe=$([`
  padding: 8px 10px;
  display: flex;
  flex-direction: column;
  align-items: stretch;
`]))),bfe=me(Kd)(xfe||(xfe=$([`
  display flex;
  flex-direction: column;
  gap: 1em;
  width: 280px;
  padding: 1em;
`]))),Sfe=({projects:l})=>{let h=l[0],d=h.address.projectId,g=d.replace(/[^\w\d'_\-]+/g," ").trim(),_="".concat(g,".theatre-project-state.json"),[b,S]=(0,Mc.useState)(!1),E=(0,Mc.useCallback)(()=>he(void 0,null,function*(){var I,B;let V=Dj(h),U=new Map;try{yield Promise.all(V.map(H=>he(void 0,null,function*(){let G=h.assetStorage.getAssetUrl(H),W=yield fetch(G);W.ok&&U.set(H,yield W.blob())})))}catch{NS.error("Failed to access assets","Export aborted. Failed to access assets at ".concat((B=(I=h.config.assets)==null?void 0:I.baseUrl)!=null?B:"/",". This is likely due to a CORS issue."));return}if(U.size>0){let H=new mfe.default;for(let[W,X]of U)H.file(W,X);let G=yield H.generateAsync({type:"blob"});pfe(G,"".concat(g,".assets.zip"))}let F=JSON.stringify(ge().createContentOfSaveFile(h.address.projectId),null,2);pfe(F,_),S(!0),setTimeout(()=>{S(!1)},2e3)}),[h,_]),N=Xd({debugName:"ProjectDetails",pointerDistanceThreshold:50},()=>Mc.default.createElement(bfe,null,Mc.default.createElement("p",null,"This will create a JSON file with the state of your project. You can commit this file to your git repo and include it in your production bundle."),Mc.default.createElement("p",null,"If your project uses assets, this will also create a zip file with all the assets that you can unpack in your public folder."),Mc.default.createElement("a",{href:"https://www.theatrejs.com/docs/latest/manual/projects#state",target:"_blank"},"Here is a quick guide on how to export to production.")));return Mc.default.createElement(Mc.default.Fragment,null,N.node,Mc.default.createElement(yfe,null,Mc.default.createElement(cde,{projectId:d}),Mc.default.createElement(_fe,null,Mc.default.createElement(MI,{onMouseEnter:I=>N.open(I,I.target),onClick:b?void 0:E,disabled:b},b?"(Exported)":"Export ".concat(d," to JSON")))))},wfe=Sfe}),og,Tfe,Efe,Mfe,Cfe,Afe,Rfe,Pfe,Nfe,Ife,kfe,SBe=C(()=>{og=z(Le()),at(),qb(),Efe=me.div(Tfe||(Tfe=$([`
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 24px;
`]))),Cfe=me.div(Mfe||(Mfe=$([`
  display: flex;
  flex-direction: column;
  gap: 11px;
  color: rgba(255, 255, 255, 0.9);
`]))),Rfe=me.div(Afe||(Afe=$([`
  color: rgba(145, 145, 145, 0.8);
`]))),Nfe=me.a(Pfe||(Pfe=$([`
  color: #919191;
  font-size: 10px;
  text-decoration-color: #40434a;
  text-underline-offset: 3px;
`]))),Ife=()=>og.default.createElement(Efe,null,og.default.createElement(Cfe,null,og.default.createElement(Rfe,null,og.default.createElement(Q$,null)),og.default.createElement("div",null,"Please select an object from the ",og.default.createElement("u",null,"Outline Menu")," to see its properties.")),og.default.createElement(Nfe,{href:"https://www.theatrejs.com/docs/latest/manual/objects",target:"_blank"},"Learn more about Objects")),kfe=Ife});function Dfe(){let[l,h]=(0,Fj.useState)(!1),d=(0,Fj.useMemo)(()=>{let g=new Set;return()=>{let _=()=>{g.delete(_),h(g.size>0)};return g.add(_),h(!0),_}},[]);return[l,d]}var Fj,Ffe=C(()=>{Fj=z(Le())}),ws,Ov,Ofe,Bfe,BI,Lfe,Oj,Ufe,Bj,zfe,Lj,kS,Vfe,Gfe,LI,c9,Uj=C(()=>{Km(),Qn(),ws=z(Le()),at(),Kr(),Ap(),Ei(),cBe(),bBe(),Fe(),Mae(),Ov=Jt,SBe(),Ffe(),s9(),Ofe="32px",BI=me.div(Bfe||(Bfe=$([`
  `,`;
  background-color: rgba(40, 43, 47, 0.8);
  position: fixed;
  right: 8px;
  top: 50px;
  // Temporary, see comment about CSS grid in SingleRowPropEditor.
  width: 280px;
  height: fit-content;
  z-index: `,`;

  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.25), 0 2px 6px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(14px);
  border-radius: 2px;

  display: `,`;

  &:hover {
    display: block;
  }

  @supports not (backdrop-filter: blur()) {
    background: rgba(40, 43, 47, 0.95);
  }
`])),Si,yv.propsPanel,({pin:l})=>l?"block":"none"),Oj=me.div(Lfe||(Lfe=$([`
  margin: 0 10px;
  color: #919191;
  font-weight: 500;
  font-size: 10px;
  user-select: none;
  `,`;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
`])),Si),Bj=me.div(Ufe||(Ufe=$([`
  height: `,`;
  display: flex;
  align-items: center;
`])),Ofe),Lj=me.div(zfe||(zfe=$([`
  `,`;
  max-height: calc(100vh - 100px);
  overflow-y: scroll;
  &::-webkit-scrollbar {
    display: none;
  }

  scrollbar-width: none;
  padding: 0;
  user-select: none;

  /* Set the font-size for input values in the detail panel */
  font-size: 12px;
`])),Si),kS=(0,ws.createContext)([!1,()=>()=>{}]),Vfe=l=>{let h=Dr(ge().atomP.ahistoric.pinDetails)!==!1,d=Eae("right");(0,ws.useLayoutEffect)(()=>{LI.set(d)},[d]),(0,ws.useEffect)(()=>()=>{c9.set(!1),LI.set(!1)},[]);let[g]=(0,ws.useContext)(kS),_=h||d||g,[b,S]=(0,ws.useState)(null);return cue(b),Rr(()=>{let E=Ym(),N=E.find(Sn);if(N)return ws.default.createElement(BI,{"data-testid":"DetailPanel-Object",pin:_,ref:S,onMouseEnter:()=>{c9.set(!0)},onMouseLeave:()=>{c9.set(!1)}},ws.default.createElement(Bj,null,ws.default.createElement(Oj,{title:"".concat(N.sheet.address.sheetId,": ").concat(N.sheet.address.sheetInstanceId," > ").concat(N.address.objectKey)},ws.default.createElement(Xm,null,N.sheet.address.sheetId," "),ws.default.createElement(Wb,null,":",""),ws.default.createElement(Xm,null,N.sheet.address.sheetInstanceId," "),ws.default.createElement(Wb,null,""),ws.default.createElement(Xm,null,N.address.objectKey))),ws.default.createElement(Lj,null,ws.default.createElement(Bhe,{objects:[N]})));let I=E.find(In);return I?ws.default.createElement(BI,{pin:_},ws.default.createElement(Bj,null,ws.default.createElement(Oj,{title:"".concat(I.address.projectId)},ws.default.createElement(Xm,null,I.address.projectId," "))),ws.default.createElement(Lj,null,ws.default.createElement(wfe,{projects:[I]}))):ws.default.createElement(BI,{pin:_,onMouseEnter:()=>{c9.set(!0)},onMouseLeave:()=>{c9.set(!1)}},ws.default.createElement(kfe,null))},[_])},Gfe=()=>{let l=Dfe();return ws.default.createElement(kS.Provider,{value:l},ws.default.createElement(Vfe,null))},LI=new Ov.Atom(!1),c9=new Ov.Atom(!1),(0,Ov.prism)(()=>{let l=(0,Ov.val)(c9.prism),h=(0,Ov.val)(LI.prism);return l||h})}),zj,UI,zI,Vj,Bv,$fe,Gj,Lv=C(()=>{zj=Jt,Qn(),Fe(),Ffe(),UI=z(Le()),HH(),zI=(l,h)=>{let d=l.left/h.width,g=(l.left+l.width)/h.width,_=l.top/h.height,b=(l.height+l.top)/h.height;return{edges:{left:d<=.5?{from:"screenLeft",distance:d}:{from:"screenRight",distance:1-d},right:g<=.5?{from:"screenLeft",distance:g}:{from:"screenRight",distance:1-g},top:_<=.5?{from:"screenTop",distance:_}:{from:"screenBottom",distance:1-_},bottom:b<=.5?{from:"screenTop",distance:b}:{from:"screenBottom",distance:1-b}}}},Vj=UI.default.createContext(null),Bv=()=>(0,UI.useContext)(Vj),$fe=({panelId:l,children:h,defaultPosition:d,minDims:g})=>{let _=sI(800,200),[b,S]=Dfe(),{stuff:E}=Rr(()=>{var N;let{edges:I}=(N=(0,zj.val)(ge().atomP.historic.panelPositions[l]))!=null?N:d,B=Math.floor(_.width*(I.left.from==="screenLeft"?I.left.distance:1-I.left.distance)),V=Math.floor(_.width*(I.right.from==="screenLeft"?I.right.distance:1-I.right.distance)),U=Math.floor(_.height*(I.top.from==="screenTop"?I.top.distance:1-I.top.distance)),F=Math.floor(_.height*(I.bottom.from==="screenTop"?I.bottom.distance:1-I.bottom.distance)),H=Math.max(V-B,g.width),G=Math.max(F-U,g.height);return{stuff:{dims:zj.prism.memo("dims",()=>({width:H,left:B,top:U,height:G}),[H,B,U,G]),panelId:l,minDims:g,boundsHighlighted:b,addBoundsHighlightLock:S}}},[l,_,b,S]);return UI.default.createElement(Vj.Provider,{value:E},h)},Gj=$fe}),DS,Hfe,jfe,Wfe,$j,qfe=C(()=>{Ti(),Fe(),Yo(),DS=z(Le()),at(),Lv(),Ec(),bo(),Ap(),jfe=me.div(Hfe||(Hfe=$([`
  cursor: move;
`]))),Wfe=l=>{let h=Bv(),d=(0,DS.useRef)(h);d.current=h;let[g,_]=vi(null),b=(0,DS.useMemo)(()=>({debugName:"PanelDragZone",lockCursorTo:"move",onDragStart(){let I=d.current,B,V=h.addBoundsHighlightLock();return{onDrag(U,F){let H=M(R({},I.dims),{top:Ss(I.dims.top+F,0,window.innerHeight-Hd),left:Ss(I.dims.left+U,-I.dims.width+Hd,window.innerWidth-Hd)}),G=zI(H,{width:window.innerWidth,height:window.innerHeight});B==null||B.discard(),B=ge().tempTransaction(({stateEditors:W})=>{W.studio.historic.panelPositions.setPanelPosition({position:G,panelId:I.panelId})})},onDragEnd(U){V(),U?B==null||B.commit():B==null||B.discard()}}}}),[]),[S]=eo(_,b);bu(S,"dragging","move");let[E,N]=(0,DS.useMemo)(()=>{let I;return[function(){if(I){let B=I;I=void 0,B()}I=h.addBoundsHighlightLock()},function(){if(I){let B=I;I=void 0,B()}}]},[]);return DS.default.createElement(jfe,M(R({},l),{ref:g,onMouseEnter:E,onMouseLeave:N}))},$j=Wfe}),VI,Xfe,Hj,Yfe,jj,Kfe,Wj,Zfe,Qfe,Jfe,epe,tpe,qj,npe,rpe,ipe,spe,ope,FS,ape,lpe,cpe,upe,hpe,dpe,fpe,ppe,mpe,Xj,gpe,Bp,wBe=C(()=>{Ti(),Fe(),Yo(),Tc(),VI=z(Le()),at(),Lv(),Ei(),bo(),Ap(),Hj=me.div(Xfe||(Xfe=$([`
  position: absolute;
  `,`;
  &:after {
    position: absolute;
    inset: -5px;
    display: block;
    content: ' ';
  }

  opacity: 0;
  background-color: #478698;

  &.isHighlighted {
    opacity: 0.7;
  }

  &.isDragging {
    opacity: 1;
    /* background-color: `,`; */
  }

  &:hover {
    opacity: 1;
  }
`])),Si,cv(.2,"#478698")),jj=me(Hj)(Yfe||(Yfe=$([`
  /**
  The horizintal/vertical resize handles have z-index:-1 and are offset 1px outside of the panel
  to make sure they don't occlude any element that pops out of the panel (like the Playhead in SequenceEditorPanel).

  This means that panels will always need an extra 1px margin for their resize handles to be visible, but that's not a problem
  that we have to deal with right now (if it is at all a problem).
  
   */
  z-index: -1;
`]))),Wj=me(jj)(Kfe||(Kfe=$([`
  left: 0px;
  right: 0px;
  height: 1px;
`]))),Qfe=me(Wj)(Zfe||(Zfe=$([`
  top: -1px;
`]))),epe=me(Wj)(Jfe||(Jfe=$([`
  bottom: -1px;
`]))),qj=me(jj)(tpe||(tpe=$([`
  z-index: -1;
  top: -1px;
  bottom: -1px;
  width: 1px;
`]))),rpe=me(qj)(npe||(npe=$([`
  left: -1px;
`]))),spe=me(qj)(ipe||(ipe=$([`
  right: -1px;
`]))),FS=me(Hj)(ope||(ope=$([`
  // The angles have z-index: 10 to make sure they _do_ occlude other elements in the panel.
  z-index: 10;
  width: 8px;
  height: 8px;
`]))),lpe=me(FS)(ape||(ape=$([`
  top: 0;
  left: 0;
`]))),upe=me(FS)(cpe||(cpe=$([`
  top: 0;
  right: 0;
`]))),dpe=me(FS)(hpe||(hpe=$([`
  bottom: 0;
  left: 0;
`]))),ppe=me(FS)(fpe||(fpe=$([`
  bottom: 0;
  right: 0;
`]))),mpe={Top:Qfe,TopLeft:lpe,TopRight:upe,Bottom:epe,BottomLeft:dpe,BottomRight:ppe,Left:rpe,Right:spe},Xj={Top:"ns-resize",Bottom:"ns-resize",Left:"ew-resize",Right:"ew-resize",TopLeft:"nw-resize",TopRight:"ne-resize",BottomLeft:"sw-resize",BottomRight:"se-resize"},gpe=({which:l})=>{let h=Bv(),d=(0,VI.useRef)(h);d.current=h;let[g,_]=vi(null),b=(0,VI.useMemo)(()=>({debugName:"PanelResizeHandle",lockCursorTo:Xj[l],onDragStart(){let I,B=d.current,V=h.addBoundsHighlightLock();return{onDrag(U,F){let H=R({},B.dims);if(l.startsWith("Bottom"))H.height=Math.max(H.height+F,B.minDims.height);else if(l.startsWith("Top")){let W=H.top+H.height,X=Ss(H.top+F,0,Math.min(W-B.minDims.height,window.innerHeight-Hd)),Z=W-X;H.height=Z,H.top=X}if(l.endsWith("Left")){let W=H.left+H.width,X=Math.min(H.left+U,Math.min(W-B.minDims.width,window.innerWidth-Hd)),Z=W-X;H.width=Z,H.left=X}else l.endsWith("Right")&&(H.width=Math.max(H.width+U,Math.max(B.minDims.width,Hd-B.dims.left)));let G=zI(H,{width:window.innerWidth,height:window.innerHeight});I==null||I.discard(),I=ge().tempTransaction(({stateEditors:W})=>{W.studio.historic.panelPositions.setPanelPosition({position:G,panelId:B.panelId})})},onDragEnd(U){V(),U?I==null||I.commit():I==null||I.discard()}}}}),[l]),[S]=eo(_,b),E=mpe[l],N=l.length<=6;return VI.default.createElement(E,{ref:g,className:[S?"isDragging":"",h.boundsHighlighted&&N?"isHighlighted":""].join(" "),style:{cursor:Xj[l]}})},Bp=gpe}),Rh,ype,vpe,TBe=C(()=>{Rh=z(Le()),wBe(),ype=l=>Rh.default.createElement(Rh.default.Fragment,null,Rh.default.createElement(Bp,{which:"Bottom"}),Rh.default.createElement(Bp,{which:"Top"}),Rh.default.createElement(Bp,{which:"Left"}),Rh.default.createElement(Bp,{which:"Right"}),Rh.default.createElement(Bp,{which:"TopLeft"}),Rh.default.createElement(Bp,{which:"TopRight"}),Rh.default.createElement(Bp,{which:"BottomLeft"}),Rh.default.createElement(Bp,{which:"BottomRight"})),vpe=ype}),GI,_pe,xpe,bpe,Yj,Spe=C(()=>{Ei(),GI=z(Le()),at(),Lv(),TBe(),xpe=me.div(_pe||(_pe=$([`
  position: absolute;
  user-select: none;
  box-sizing: border-box;
  `,`;
  /* box-shadow: 1px 2px 10px -5px black; */

  z-index: 1000;
`])),Si),bpe=GI.default.forwardRef((l,h)=>{let d=Bv(),g=l,{style:_,children:b}=g,S=O(g,["style","children"]);return GI.default.createElement(xpe,M(R({ref:h},S),{style:R({width:d.dims.width+"px",height:d.dims.height+"px",top:d.dims.top+"px",left:d.dims.left+"px"},_??{})}),GI.default.createElement(vpe,null),b)}),Yj=bpe}),EBe=L((l,h)=>{(function(d,g){typeof l=="object"&&typeof h<"u"?g(l,Le()):(d=typeof globalThis<"u"?globalThis:d||self,g(d.ReactErrorBoundary={},d.React))})(l,function(d,g){function _(F){if(F&&F.__esModule)return F;var H=Object.create(null);return F&&Object.keys(F).forEach(function(G){if(G!=="default"){var W=Object.getOwnPropertyDescriptor(F,G);Object.defineProperty(H,G,W.get?W:{enumerable:!0,get:function(){return F[G]}})}}),H.default=F,Object.freeze(H)}var b=_(g);function S(F,H){return S=Object.setPrototypeOf||function(G,W){return G.__proto__=W,G},S(F,H)}function E(F,H){F.prototype=Object.create(H.prototype),F.prototype.constructor=F,S(F,H)}var N=function(F,H){return F===void 0&&(F=[]),H===void 0&&(H=[]),F.length!==H.length||F.some(function(G,W){return!Object.is(G,H[W])})},I={error:null},B=function(F){E(H,F);function H(){for(var W,X=arguments.length,Z=new Array(X),te=0;te<X;te++)Z[te]=arguments[te];return W=F.call.apply(F,[this].concat(Z))||this,W.state=I,W.updatedWithError=!1,W.resetErrorBoundary=function(){for(var ae,oe=arguments.length,ue=new Array(oe),Ee=0;Ee<oe;Ee++)ue[Ee]=arguments[Ee];W.props.onReset==null||(ae=W.props).onReset.apply(ae,ue),W.reset()},W}H.getDerivedStateFromError=function(W){return{error:W}};var G=H.prototype;return G.reset=function(){this.updatedWithError=!1,this.setState(I)},G.componentDidCatch=function(W,X){var Z,te;(Z=(te=this.props).onError)==null||Z.call(te,W,X)},G.componentDidMount=function(){var W=this.state.error;W!==null&&(this.updatedWithError=!0)},G.componentDidUpdate=function(W){var X=this.state.error,Z=this.props.resetKeys;if(X!==null&&!this.updatedWithError){this.updatedWithError=!0;return}if(X!==null&&N(W.resetKeys,Z)){var te,ae;(te=(ae=this.props).onResetKeysChange)==null||te.call(ae,W.resetKeys,Z),this.reset()}},G.render=function(){var W=this.state.error,X=this.props,Z=X.fallbackRender,te=X.FallbackComponent,ae=X.fallback;if(W!==null){var oe={error:W,resetErrorBoundary:this.resetErrorBoundary};if(b.isValidElement(ae))return ae;if(typeof Z=="function")return Z(oe);if(te)return b.createElement(te,oe);throw new Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}return this.props.children},H}(b.Component);function V(F,H){var G=function(X){return b.createElement(B,H,b.createElement(F,X))},W=F.displayName||F.name||"Unknown";return G.displayName="withErrorBoundary("+W+")",G}function U(F){var H=b.useState(null),G=H[0],W=H[1];if(F!=null)throw F;if(G!=null)throw G;return W}d.ErrorBoundary=B,d.useErrorHandler=U,d.withErrorBoundary=V,Object.defineProperty(d,"__esModule",{value:!0})})}),tl,wpe,Tpe,Epe,Mpe,Cpe,Ape,Rpe,Ppe,Npe,Ipe,kpe,Dpe,Fpe,Ope,Bpe,Lpe,Upe,zpe,Vpe,MBe=C(()=>{tl=z(Le()),at(),Ap(),Lv(),qfe(),Spe(),wpe=z(EBe()),Ev(),Fe(),Ap(),Tpe={edges:{left:{from:"screenLeft",distance:.3},right:{from:"screenRight",distance:.3},top:{from:"screenTop",distance:.3},bottom:{from:"screenBottom",distance:.3}}},Epe={width:300,height:300},Mpe=({paneInstance:l})=>tl.default.createElement(Gj,{panelId:"pane-".concat(l.instanceId),defaultPosition:Tpe,minDims:Epe},tl.default.createElement(zpe,{paneInstance:l})),Ape=me(Yj)(Cpe||(Cpe=$([`
  display: flex;
  flex-direction: column;

  box-shadow: 0px 5px 12px -4px rgb(0 0 0 / 22%);
  z-index: `,`;
`])),yv.pluginPanes),Ppe=me.div(Rpe||(Rpe=$([`
  width: 100%;
`]))),Ipe=me.div(Npe||(Npe=$([`
  display: flex;
  align-items: center;
  opacity: 1;
  position: absolute;
  right: 4px;
  top: 0;
  bottom: 0;
`]))),Dpe=me.button(kpe||(kpe=$([`
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 2px;
  font-size: 11px;
  height: 10px;
  width: 18px;
  color: #adadadb3;
  background: transparent;
  border: none;
  cursor: pointer;
  &:hover {
    color: white;
  }
`]))),Ope=me(Toe)(Fpe||(Fpe=$([`
  position: relative;
  overflow: hidden;

  &:after {
    z-index: 10;
    position: absolute;
    inset: 0;
    display: block;
    content: ' ';
    pointer-events: none;

    #pointer-root:not(.normal) & {
      pointer-events: auto;
    }
  }
`]))),Lpe=me.div(Bpe||(Bpe=$([`
  padding: 12px;

  & > pre {
    border: 1px solid #ff62624f;
    background-color: rgb(255 0 0 / 5%);
    margin: 8px 0;
    padding: 8px;
    font-family: monospace;
    overflow: scroll;
    color: #ff9896;
  }
`]))),Upe=l=>tl.default.createElement(Lpe,null,"An Error occurred rendering this pane. Open the console for more info.",tl.default.createElement("pre",null,JSON.stringify({message:l.error.message,stack:l.error.stack},null,2))),zpe=({paneInstance:l})=>{let[h,d]=(0,tl.useState)(null),g=l.definition.mount;(0,tl.useLayoutEffect)(()=>{if(!h)return;let b=g({paneId:l.instanceId,node:h});if(typeof b=="function")return b},[h,g,l.instanceId]);let _=(0,tl.useCallback)(()=>{ge().paneManager.destroyPane(l.instanceId)},[l]);return tl.default.createElement(Ape,{"data-testid":"theatre-pane-wrapper-".concat(l.instanceId)},tl.default.createElement($j,null,tl.default.createElement(K$,null,tl.default.createElement(Ipe,null,tl.default.createElement(Dpe,{onClick:_,title:"Close Pane"},tl.default.createElement(RFe,null))),tl.default.createElement(Ppe,null,l.instanceId))),tl.default.createElement(wpe.ErrorBoundary,{FallbackComponent:Upe},tl.default.createElement(Ope,{"data-testid":"theatre-pane-content-".concat(l.instanceId),ref:d})))},Vpe=Mpe}),Kj,Zj,Gpe=C(()=>{Kj=Jt,Zj=(l,h)=>{let d=Kj.prism.memo(l,()=>new Kj.Atom(h),[]);return d.set(h),d}});function $pe(l,h){(0,Hpe.useLayoutEffect)(()=>{if(!l||h.type!=="propWithChildren"&&h.type!=="primitiveProp"&&h.type!=="sheetObject")return;let d=null,g=M(R({},h.sheetObject.address),{pathToProp:h.type==="sheetObject"?[]:h.pathToProp});function _(){d=bI.replaceLock(g,()=>{})}function b(){d==null||d()}return l.addEventListener("mouseenter",_),l.addEventListener("mouseleave",b),()=>{d==null||d(),l.removeEventListener("mouseenter",_),l.removeEventListener("mouseleave",b)}},[l])}var Hpe,jpe=C(()=>{Hpe=z(Le()),mj()}),ag,Wpe,Qj,qpe,Jj,Xpe,eW,Ype,Kpe,Zpe,Qpe,Jpe,e1e,t1e,$I,HI=C(()=>{Ei(),ag=z(Le()),Ev(),at(),r9(),jpe(),Qj=me.li(Wpe||(Wpe=$([`
  --depth: `,`;
  margin: 0;
  padding: 0;
  list-style: none;
`])),l=>l.depth),Jj=me.div(qpe||(qpe=$([`
  border-bottom: 1px solid #7695b705;
`]))),eW=me(Jj)(Xpe||(Xpe=$([`
  padding-left: calc(8px + var(--depth) * 20px);

  display: flex;
  align-items: stretch;
  color: `,`;

  box-sizing: border-box;

  `,`;
`])),gv.panel.body.compoudThing.label.color,l=>l.isSelected&&"background: blue"),Kpe=me.span(Ype||(Ype=$([`
  `,`;
  overflow-x: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  padding-right: 4px;
  line-height: 26px;
  flex-wrap: nowrap;

  `,`:hover & {
    color: #ccc;
  }
`])),tg,eW),Qpe=me.span(Zpe||(Zpe=$([`
  width: 12px;
  padding: 8px;
  font-size: 9px;
  display: flex;
  align-items: center;

  transition: transform 0.05s ease-out, color 0.1s ease-out;
  transform: rotateZ(`,`deg);
  color: #66686a;

  &:hover {
    transform: rotateZ(`,`deg);
    color: #c0c4c9;
  }
`])),l=>l.isCollapsed?0:90,l=>l.isCollapsed?15:75),e1e=me.ul(Jpe||(Jpe=$([`
  margin: 0;
  padding: 0;
  list-style: none;
`]))),t1e=({leaf:l,label:h,children:d,isSelectable:g,isSelected:_,toggleSelect:b,toggleCollapsed:S,isCollapsed:E})=>{let N=Array.isArray(d)&&d.length>0,I=(0,ag.useRef)(null);return $pe(I.current,l),l.shouldRender?ag.default.createElement(Qj,{depth:l.depth},ag.default.createElement(eW,{ref:I,style:{height:l.nodeHeight+"px"},isSelectable:g===!0,isSelected:_===!0,onClick:b,isEven:l.n%2===0},ag.default.createElement(Qpe,{isCollapsed:E,onClick:S},ag.default.createElement(yle,null)),ag.default.createElement(Kpe,null,h)),N&&ag.default.createElement(e1e,null,d)):null},$I=t1e});function CBe(l,h){return h.every((d,g)=>d===l[g])}function ABe(l,h){if(l.length!==h.length)return!1;for(let d=0;d<l.length;d++)if(l[d]!==h[d])return!1;return!0}function jI(l){var h;let d=[];for(;;){let g=d.length,_=(h=l[0])==null?void 0:h[g];if(_===void 0)return d;for(let b of l)if(_!==b[g])return d;d.push(_)}}var tf,WI,nf=C(()=>{lI(),tf=oS(l=>JSON.stringify(l)),WI=l=>JSON.parse(l)});function RBe(l,h){let d=(0,tW.useRef)({combo:l,listener:h});d.current={combo:l,listener:h},(0,tW.useEffect)(()=>{function g(S){S.key===d.current.combo&&d.current.listener({down:!0,event:S})}function _(S){S.key===d.current.combo&&d.current.listener({down:!1,event:S})}function b(S){d.current.listener({down:!1,event:void 0})}return document.addEventListener("keydown",g),document.addEventListener("keyup",_),window.addEventListener("blur",b),()=>{document.removeEventListener("keydown",g),document.removeEventListener("keyup",_),window.removeEventListener("blur",b)}},[])}var tW,PBe=C(()=>{tW=z(Le())});function n1e(l){let[h,d]=(0,r1e.useState)(!1);return RBe(l,({down:g})=>{d(g)}),h}var r1e,i1e=C(()=>{r1e=z(Le()),PBe()});function NBe(l){let h=(0,nW.useMemo)(()=>new s1e.Atom(l),[]);return(0,nW.useLayoutEffect)(()=>{h.set(l)},[l]),h}var s1e,nW,IBe=C(()=>{s1e=Jt,nW=z(Le())});function o1e(l,h,d){let g=(0,rW.pointer)({root:{},path:[]}),_=h(g);Vd(l,(0,rW.getPointerParts)(_).path,d)}var rW,kBe=C(()=>{rW=Jt,gb()}),qI,a1e,h0,Ph=C(()=>{qI="data-pos",a1e={checkIfMouseEventSnapToPos(l,h){let d=l.composedPath().find(g=>g instanceof Element&&g!==(h==null?void 0:h.ignore)&&g.hasAttribute(qI));if(d){let g=parseFloat(d.getAttribute(qI));if(isFinite(g))return g}return null},includePositionSnapAttrs(l){return{[qI]:l}}},h0=a1e});function XI(l){let h=l.type==="sheet"?FBe(l):iW(l);return{byPosition:DBe(h),tracks:h}}function DBe(l){let h=new Map;for(let d of l)for(let g of d.data.keyframes){let _=h.get(g.position);_||(_=[],h.set(g.position,_)),_.push({kf:g,track:d,itemKey:ya.forTrackKeyframe(d.sheetObject,d.id,g.id)})}return h}function FBe(l){return l.children.flatMap(iW)}function iW(l){return l.children.flatMap(h=>h.type==="propWithChildren"?iW(h):OBe(h))}function OBe(l){let h=l.sheetObject,d=h.address.projectId,g=ge().atomP.historic.coreByProject[d].sheetsById[h.address.sheetId].sequence.tracksByObject[h.address.objectKey],_=(0,YI.val)(g.trackIdByPropPath[tf(l.pathToProp)]);if(!_)return[];let b=(0,YI.val)(g.trackData[_]);return b?[{id:_,data:b,sheetObject:h}]:[]}function BBe(l,h){return i0(l.children.flatMap(d=>sW(d,h)))}function sW(l,h){return i0(l.children.flatMap(d=>d.type==="propWithChildren"?sW(d,h):LBe(d,h)))}function LBe(l,h){var d,g;let _=l.sheetObject,b=_.address.projectId,S=ge().atomP.historic.coreByProject[b].sheetsById[_.address.sheetId].sequence.tracksByObject[_.address.objectKey],E=(0,YI.val)(S.trackIdByPropPath[tf(l.pathToProp)]);return E?(g=(d=h[_.address.objectKey])==null?void 0:d[E])!=null?g:[]:[]}var YI,Uv=C(()=>{Fe(),YI=Jt,Fp(),nf(),bo()});function UBe(l,h){let[d,g]=vi(null),_=Zm("useCaptureSelection");return eo(h,(0,zv.useMemo)(()=>({debugName:"DopeSheetSelectionView/useCaptureSelection",dontBlockMouseDown:!0,lockCSSCursorTo:"cell",onDragStart(b){if(!b.shiftKey||b.target instanceof HTMLInputElement)return!1;let S=h.getBoundingClientRect(),E=b.clientX-S.left-(0,wu.val)(l.scaledSpace.leftPadding),N=(0,wu.val)(l.scaledSpace.toUnitSpace)(E);return d.current={h:[N,N],v:[b.clientY-S.top,b.clientY-S.top]},(0,wu.val)(l.selectionAtom).set({current:void 0}),{onDrag(I,B,V){let U=h.getBoundingClientRect(),F=V.clientX-U.left-(0,wu.val)(l.scaledSpace.leftPadding),H=(0,wu.val)(l.scaledSpace.toUnitSpace)(F);d.current={h:[d.current.h[0],H],v:[d.current.v[0],V.clientY-U.top]};let G=oW.boundsToSelection(_,(0,wu.val)(l),d.current);(0,wu.val)(l.selectionAtom).set({current:G})},onDragEnd(I){d.current=null}}}}),[l,h,d])),g}var wu,zv,lg,l1e,c1e,u1e,oW,h1e,d1e,aW,f1e,p1e,zBe=C(()=>{Fe(),Yo(),i1e(),IBe(),kBe(),Ti(),Qn(),wu=Jt,zv=z(Le()),at(),Ph(),Uv(),Qm(),lg=5,c1e=me.div(l1e||(l1e=$([`
  cursor: `,`;
`])),l=>l.isShiftDown?"cell":"default"),u1e=({layoutP:l,children:h,height:d})=>{let[g,_]=vi(null),b=n1e("Shift"),S=UBe(l,_),E=(0,zv.useRef)(S);return E.current=S,zv.default.createElement(c1e,{style:{height:d+"px"},ref:g,isShiftDown:b,className:"selectionview"},S&&zv.default.createElement(f1e,{state:S,layoutP:l}),h)},(l=>{let h=(S,E,N,I,B)=>{let V=XI(N);if(N.top+N.nodeHeight/2+lg>I.v[0]&&N.top+N.nodeHeight/2-lg<I.v[1])for(let[U,F]of V.byPosition){let H=E.scaledSpace.toUnitSpace(lg);if(!(U+H<=I.h[0]||U-H>=I.h[1]))for(let G of F)o1e(B,W=>W[G.track.sheetObject.address.objectKey].byTrackId[G.track.id].byKeyframeId[G.kf.id],!0)}g(S,E,N,I,B)},d={sheet(S,E,N,I,B){h(S,E,N,I,B)},propWithChildren(S,E,N,I,B){h(S,E,N,I,B)},sheetObject(S,E,N,I,B){h(S,E,N,I,B)},primitiveProp(S,E,N,I,B){let{sheetObject:V,trackId:U}=N,F=(0,wu.val)(ge().atomP.historic.coreByProject[V.address.projectId].sheetsById[V.address.sheetId].sequence.tracksByObject[V.address.objectKey].trackData[U]);if(!(I.v[0]>N.top+N.heightIncludingChildren/2+lg||N.top+N.heightIncludingChildren/2-lg>I.v[1])){for(let H of F.keyframes)if(!(H.position+E.scaledSpace.toUnitSpace(lg)<=I.h[0])){if(H.position-E.scaledSpace.toUnitSpace(lg)>=I.h[1])break;o1e(B,G=>G[V.address.objectKey].byTrackId[U].byKeyframeId[H.id],!0)}}}},g=(S,E,N,I,B)=>{if("children"in N)for(let V of N.children)_(S,E,V,I,B)};function _(S,E,N,I,B){if(!N.shouldRender||I.v[0]>N.top+N.heightIncludingChildren||N.top>I.v[1])return;let V=d[N.type];V?V(S,E,N,I,B):g(S,E,N,I,B)}function b(S,E,N){let I={};N=aW(N);let B=E.tree;_(S.utilFor.internal(),E,B,N,I);let V=E.tree.sheet;return{type:"DopeSheetSelection",byObjectKey:I,getDragHandlers(U){return{debugName:"DopeSheetSelectionView/boundsToSelection",onDragStart(){let F,H=E.scaledSpace.toUnitSpace;return{onDrag(G,W,X){F&&(F.discard(),F=void 0);let Z=h0.checkIfMouseEventSnapToPos(X,{ignore:U.domNode}),te=Z!=null?Z-U.positionAtStartOfDrag:H(G);F=ge().tempTransaction(({stateEditors:ae})=>{let oe=ae.coreByProject.historic.sheetsById.sequence.transformKeyframes;for(let ue of Object.keys(I)){let{byTrackId:Ee}=I[ue];for(let Ie of Object.keys(Ee)){let{byKeyframeId:_e}=Ee[Ie];oe({trackId:Ie,keyframeIds:Object.keys(_e),translate:te,scale:1,origin:0,snappingFunction:V.getSequence().closestGridPosition,objectKey:ue,projectId:U.projectId,sheetId:U.sheetId})}}})},onDragEnd(G){G?F==null||F.commit():F==null||F.discard()}}}}},delete(){ge().transaction(({stateEditors:U})=>{let F=U.coreByProject.historic.sheetsById.sequence.deleteKeyframes;for(let H of Object.keys(I)){let{byTrackId:G}=I[H];for(let W of Object.keys(G)){let{byKeyframeId:X}=G[W];F(M(R({},V.address),{objectKey:H,trackId:W,keyframeIds:Object.keys(X)}))}}})}}}l.boundsToSelection=b})(oW||(oW={})),d1e=me.div(h1e||(h1e=$([`
  position: absolute;
  background: rgba(255, 255, 255, 0.1);
  border: 1px dashed rgba(255, 255, 255, 0.4);
  box-sizing: border-box;
`]))),aW=l=>({h:[...l.h].sort((h,d)=>h-d),v:[...l.v].sort((h,d)=>h-d)}),f1e=({state:l,layoutP:h})=>{let d=NBe(l);return Rr(()=>{let g=(0,wu.val)(d.pointer),_=aW(g),b=(0,wu.val)(h.scaledSpace.fromUnitSpace),S=(0,wu.val)(h.scaledSpace.leftPadding),E=_.h.map(b).map(U=>U+S),N=_.v[0],I=_.v[1]-_.v[0],B=E[0],V=E[1]-E[0];return zv.default.createElement(d1e,{style:{top:N+"px",height:I+"px",left:B+"px",width:V+"px"}})},[h,d])},p1e=u1e}),u9,m1e,g1e,lW,y1e,v1e,_1e,x1e=C(()=>{vv(),u9=z(Le()),at(),jp(),g1e=me.div(m1e||(m1e=$([`
  position: absolute;
  top: 0;
  right: 0;
  left: 0;
  bottom: 0;
  overflow-x: hidden;
  overflow-y: scroll;
  z-index: `,`;

  &::-webkit-scrollbar {
    display: none;
  }

  scrollbar-width: none;
`])),()=>ff.scrollableArea),lW=(0,u9.createContext)(wh),y1e=()=>(0,u9.useContext)(lW),v1e=l=>{let h=(0,u9.useRef)(null),d=(0,u9.useCallback)(g=>{h.current.scrollBy(0,g.deltaY)},[]);return u9.default.createElement(lW.Provider,{value:d},u9.default.createElement(g1e,{ref:h},l.children))},_1e=v1e}),b1e,VBe=C(()=>{b1e='data:image/svg+xml,<svg width="34" height="34" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">%0A  <path d="M1 7V1H7" stroke="%2374FFDE" stroke-width="0.25" />%0A  <path d="M7 33H1L1 27" stroke="%2374FFDE" stroke-width="0.25" />%0A  <path d="M33 27V33H27" stroke="%2374FFDE" stroke-width="0.25" />%0A  <path d="M27 1L33 1V7" stroke="%2374FFDE" stroke-width="0.25" />%0A</svg>'}),Tu,KI=C(()=>{Tu=(l,h=l)=>`
  left: `.concat(l*-.5,`px;
  top: `).concat(h*-.5,`px;
  width: `).concat(l,`px;
  height: `).concat(h,`px;
`)}),ZI,S1e,w1e,GBe=C(()=>{ZI=Jt,S1e=(0,ZI.prism)(()=>{let[l,h]=ZI.prism.state("pos",null);return ZI.prism.effect("setupListeners",()=>{let d=g=>{h(g)};return document.addEventListener("mousemove",d),()=>{document.removeEventListener("mousemove",d)}},[]),l}),w1e=S1e}),Lp,d0,OS,T1e,E1e,M1e,C1e,Up,rf,QI,A1e,R1e,nl=C(()=>{Lp=Jt,GBe(),bo(),d0=z(Le()),OS=(0,d0.createContext)(null),T1e=0,E1e=({children:l,layoutP:h})=>{let d=(0,d0.useMemo)(()=>new Lp.Atom([]),[]),g=(0,d0.useMemo)(()=>(0,Lp.prism)(()=>{let S=Lp.prism.memo("p",()=>A1e(h),[h]).getValue(),E=(0,Lp.val)(d.pointer);return E.length>0?yp(E).position:S}),[h]),_=(0,d0.useCallback)(()=>{let S=T1e++;return d.reduce(E=>[...E,{id:S,position:[-1,0]}]),{set:E=>{d.reduce(N=>{let I=N.findIndex(V=>V.id===S);if(I===-1)return console.warn("Lock is already freed. This is a bug."),N;let B=[...N];return B.splice(I,1,{id:S,position:[E,E===-1?0:1]}),B})},unlock:()=>{d.reduce(E=>E.filter(N=>N.id!==S))}}},[]),b={currentD:g,getLock:_};return d0.default.createElement(OS.Provider,{value:b},l)},M1e=()=>(0,d0.useContext)(OS).currentD,C1e=()=>{let{getLock:l}=(0,d0.useContext)(OS),h=(0,d0.useRef)();return(0,d0.useLayoutEffect)(()=>()=>{var d;(d=h.current)==null||d.unlock()},[]),(0,d0.useMemo)(()=>{let d;return(g,_)=>{var b,S;(d==null?void 0:d.shouldLock)!==g&&(g?h.current=l():(b=h.current)==null||b.unlock()),(d==null?void 0:d.pos)!==_&&g&&((S=h.current)==null||S.set(_)),d={shouldLock:g,pos:_}}},[l])},Up=(l,h)=>{let{getLock:d}=(0,d0.useContext)(OS),g=(0,d0.useRef)();(0,d0.useLayoutEffect)(()=>{if(l)return g.current=d(),()=>{g.current.unlock()}},[l,d]),(0,d0.useLayoutEffect)(()=>{l&&g.current.set(h)},[h,l])},rf=l=>({[QI]:l==="hide"?l:l.toFixed(3)}),QI="data-theatre-lock-framestamp-to",A1e=l=>(0,Lp.prism)(()=>{let h=(0,Lp.val)(l.rightDims),d=(0,Lp.val)(l.clippedSpace.toUnitSpace),g=(0,Lp.val)(w1e);if(!g)return[-1,0];for(let B of g.composedPath()){if(!(B instanceof HTMLElement||B instanceof SVGElement))break;if(B.hasAttribute(QI)){let V=B.getAttribute(QI);if(typeof V!="string")continue;if(V==="hide")return[-1,0];let U=parseFloat(V);if(isFinite(U)&&U>=0)return[U,2]}}let{clientX:_,clientY:b}=g,{screenX:S,screenY:E,width:N,height:I}=h;if(Zi(_,S,S+N)&&Zi(b,E+16,E+I)){let B=_-S;return[d(B),3]}else return[-1,0]}),R1e=E1e}),P1e,BS,cW,N1e,I1e,sf,k1e=C(()=>{Ei(),Ec(),at(),VBe(),KI(),Ph(),nl(),P1e=12,BS=34,cW="beingDragged",sf={BEING_DRAGGED_CLASS:cW,CSS:Qa(N1e||(N1e=$([`
    position: absolute;
    `,`;
    `,`;

    &.`,` {
      pointer-events: none !important;
    }
  `])),Tu(P1e),Si,cW),CSS_WHEN_SOMETHING_DRAGGING:Qa(I1e||(I1e=$([`
    pointer-events: auto;
    cursor: var(`,`);

    //  thing
    // This box extends the hitzone so the user does not
    // accidentally leave the hitzone
    &:hover:after {
      position: absolute;
      top: calc(50% - `,`px);
      left: calc(50% - `,`px);
      width: `,`px;
      height: `,`px;
      display: block;
      content: ' ';
      background: url(`,`) no-repeat 100% 100%;
      // This icon might also fit: GiConvergenceTarget
    }
  `])),Pp,BS/2,BS/2,BS,BS,b1e),reactProps(l){return M(R(R({},rf(l.position)),h0.includePositionSnapAttrs(l.position)),{className:l.isDragging?sf.BEING_DRAGGED_CLASS:""})}}});function uW(){US.set({mode:"snapToAll"})}function h9(){US.set({mode:"snapToNone"})}function D1e(l){US.set({mode:"snapToSome",positions:l})}function F1e(l,h){return Object.fromEntries(Object.entries(l).map(([d,g])=>[d,Object.fromEntries(Object.entries(g.trackData).map(([_,b])=>[_,b.keyframes.filter(S=>h(S,{trackId:_,trackData:b,objectKey:d})).map(S=>S.position)]))]))}var O1e,B1e,hW,L1e,U1e,z1e,V1e,G1e,LS,US,dW,d9=C(()=>{O1e=Jt,B1e=Jt,hW=z(Le()),at(),k1e(),U1e=me.div(L1e||(L1e=$([`
  z-index: 1;
  cursor: ew-resize;

  `,`

  #pointer-root.draggingPositionInSequenceEditor & {
    `,`
  }
`])),sf.CSS,sf.CSS_WHEN_SOMETHING_DRAGGING),V1e=me.div(z1e||(z1e=$([`
  position: absolute;
`]))),G1e=l=>hW.default.createElement(V1e,{style:{top:"".concat(l.leaf.nodeHeight/2,"px"),left:"calc(".concat((0,B1e.val)(l.layoutP.scaledSpace.leftPadding),"px + calc(var(--unitSpaceToScaledSpaceMultiplier) * ").concat(l.position,"px))")}},hW.default.createElement(U1e,R({},sf.reactProps({isDragging:!1,position:l.position})))),LS=G1e,US=new O1e.Atom({mode:"snapToNone"}),dW=US.prism});function $Be(l,h){let d=(0,f9.useMemo)(()=>({debugName:"HorizontallyScrollableArea",onDragStart(_){if(_.target instanceof HTMLInputElement||_.shiftKey||_.altKey||_.ctrlKey||_.metaKey||_.composedPath().some(V=>V instanceof HTMLElement&&V.draggable===!0))return!1;let b=_.clientX-h.getBoundingClientRect().left,S=Ss((0,to.val)(l.clippedSpace.toUnitSpace)(b),0,1/0),E=(0,to.val)(l.seeker.setIsSeeking),N=(0,to.val)(l.sheet).getSequence();N.position=S;let I=S,B=(0,to.val)(l.scaledSpace.toUnitSpace);return E(!0),uW(),{onDrag(V,U,F){let H=B(V),G=Ss(I+H,0,N.length),W=h0.checkIfMouseEventSnapToPos(F,{});W!=null&&(G=W),N.position=G},onDragEnd(){E(!1),h9()}}}}),[l,h]),[g]=eo(h,d);bu(g,"draggingPositionInSequenceEditor","ew-resize")}function HBe(l,h){let d=y1e();(0,f9.useLayoutEffect)(()=>{if(!h)return;let g=b=>{if(b.ctrlKey){b.preventDefault(),b.stopPropagation();let S=b.clientX-h.getBoundingClientRect().left,E=(0,to.val)(l.clippedSpace.toUnitSpace)(S),N=(0,to.val)(l.clippedSpace.range),I=1+fW(b.deltaY,[-50,50])*.03,B=vp(N,F=>(F-E)*I+E),V=(0,to.val)(l.sheet).getSequence().length,U=V+V*.25;(0,to.val)(l.clippedSpace.setRange)(jBe(B,[0,U]));return}else if(b.shiftKey){b.preventDefault(),b.stopPropagation();let S=(0,to.val)(l.sheet).getSequence().length,E=(0,to.val)(l.clippedSpace.range),N=(E.end-E.start)/S,I=fW(b.deltaY||b.deltaX,[-50,50])*.05*N,B=vp(E,V=>V+I);(0,to.val)(l.clippedSpace.setRange)(B);return}else{d(b),b.preventDefault(),b.stopPropagation();let S=(0,to.val)(l.scaledSpace.toUnitSpace)(b.deltaX*1),E=(0,to.val)(l.clippedSpace.range),N=vp(E,I=>I+S);(0,to.val)(l.clippedSpace.setRange)(N);return}},_={capture:!0,passive:!1};return h.addEventListener("wheel",g,_),()=>{h.removeEventListener("wheel",g,_)}},[h,l]),eo(h,(0,f9.useMemo)(()=>({onDragStart(g){let _=(0,to.val)(l.clippedSpace.range),b=(0,to.val)(l.clippedSpace.setRange),S=(0,to.val)(l.scaledSpace.toUnitSpace);return g.preventDefault(),g.stopPropagation(),{onDrag(E,N,I,B,V){d({deltaY:-V});let U=-S(E),F=vp(_,H=>H+U);b(F)}}},debugName:"HorizontallyScrollableArea Middle Button Drag",buttons:[1],lockCSSCursorTo:"grabbing"}),[l]))}function fW(l,[h,d]){return Math.max(Math.min(l,d),h)}function jBe(l,h){return vp(l,d=>fW(d,h))}function WBe(l,h){(0,f9.useLayoutEffect)(()=>{if(!h)return;let d=(0,to.prism)(()=>{let S=(0,to.val)(l.clippedSpace.range);return(0,to.val)(l.scaledSpace.fromUnitSpace)(S.start)}),g=()=>{let S=d.getValue();h.scrollLeft=S},_=d.onStale(g);g();let b=setTimeout(g,100);return()=>{clearTimeout(b),_()}},[l,h])}var to,f9,$1e,H1e,j1e,pW,W1e=C(()=>{Yo(),Ti(),Qn(),to=Jt,bo(),f9=z(Le()),at(),x1e(),Ei(),Ec(),Ph(),d9(),H1e=me.div($1e||($1e=$([`
  position: absolute;

  right: 0;
  overflow-x: scroll;
  overflow-y: hidden;
  `,`;

  // hide the scrollbar on Gecko
  scrollbar-width: none;

  // hide the scrollbar on Webkit/Blink
  &::-webkit-scrollbar {
    display: none;
  }
`])),Si),j1e=f9.default.memo(({layoutP:l,children:h,height:d})=>{let{width:g,unitSpaceToScaledSpaceMultiplier:_}=Rr(()=>({width:(0,to.val)(l.rightDims.width),unitSpaceToScaledSpaceMultiplier:(0,to.val)(l.scaledSpace.fromUnitSpace)(1)}),[l]),[b,S]=vi(null);return HBe(l,S),$Be(l,S),WBe(l,S),f9.default.createElement(H1e,{ref:b,style:{width:g+"px",height:d+"px","--unitSpaceToScaledSpaceMultiplier":_}},h)}),pW=j1e}),JI,q1e,X1e,Y1e,K1e,Z1e,Q1e,J1e,Vv,ek=C(()=>{JI=z(Le()),at(),X1e=me.li(q1e||(q1e=$([`
  margin: 0;
  padding: 0;
  list-style: none;
  box-sizing: border-box;
  position: relative;
`]))),K1e=me.div(Y1e||(Y1e=$([`
  box-sizing: border-box;
  width: 100%;
  position: relative;

  &:before {
    position: absolute;
    display: block;
    content: ' ';
    left: -40px;
    top: 0;
    bottom: 0;
    right: 0;
    box-sizing: border-box;
    border-bottom: 1px solid #252b3869;
    background: `,`;
  }
`])),l=>l.isEven?"transparent":"#6b8fb505"),Q1e=me.ul(Z1e||(Z1e=$([`
  margin: 0;
  padding: 0;
  list-style: none;
`]))),J1e=({leaf:l,children:h,node:d,isCollapsed:g})=>{let _=Array.isArray(h)&&h.length>0;return l.shouldRender?JI.default.createElement(X1e,null,JI.default.createElement(K1e,{style:{height:l.nodeHeight+"px"},isEven:l.n%2===0},d),_&&JI.default.createElement(Q1e,null,h)):null},Vv=J1e}),qBe=L((l,h)=>{(function(){var d=this,g={};typeof l<"u"?h.exports=g:d.fuzzy=g,g.simpleFilter=function(_,b){return b.filter(function(S){return g.test(_,S)})},g.test=function(_,b){return g.match(_,b)!==null},g.match=function(_,b,S){S=S||{};var E=0,N=[],I=b.length,B=0,V=0,U=S.pre||"",F=S.post||"",H=S.caseSensitive&&b||b.toLowerCase(),G;_=S.caseSensitive&&_||_.toLowerCase();for(var W=0;W<I;W++)G=b[W],H[W]===_[E]?(G=U+G+F,E+=1,V+=1+V):V=0,B+=V,N[N.length]=G;return E===_.length?(B=H===_?1/0:B,{rendered:N.join(""),score:B}):null},g.filter=function(_,b,S){return!b||b.length===0?[]:typeof _!="string"?b:(S=S||{},b.reduce(function(E,N,I,B){var V=N;S.extract&&(V=S.extract(N));var U=g.match(_,V,S);return U!=null&&(E[E.length]={string:U.rendered,score:U.score,index:I,original:N}),E},[]).sort(function(E,N){var I=N.score-E.score;return I||E.index-N.index}))}})()});function XBe(l,h){let[d,g]=(0,tk.useState)(!1),_=(0,tk.useRef)(h);return d||(_.current=h),(0,tk.useMemo)(()=>l(g),_.current)}var tk,YBe=C(()=>{tk=z(Le())}),mW,cg,nk=C(()=>{mW="rgba(26, 28, 30, 0.97);",cg="#272B2F"});function eme(l,h,d,g){let _=XBe(b=>({debugName:"CurveSegmentEditor/useKeyframeDrag",lockCSSCursorTo:"move",onDragStart(){return b(!0),{onDrag(S,E){l&&d.onCurveChange(g(S,E))},onDragEnd(S){b(!1),d.onCancelCurveChange()}}}}),[l,d.onCurveChange,d.onCancelCurveChange]);eo(h,_)}var bi,rk,zS,Gv,tme,VS,nme,ik,rme,ime,sme,$v,ome,p9,ame,lme,gW,cme,sk,ume,yW,hme,dme,KBe=C(()=>{bi=z(Le()),Yo(),Ti(),A5(),at(),Ei(),YBe(),nk(),rk=.12,zS=1+rk*2,Gv=.01,tme=8,VS=(1-Gv)/(tme-1),nme="#3EAAA4",ik="#3EAAA4",rme="#3EAAA4",ime="#3EAAA4",sme="#3EAAA4",$v="#3EAAA4",ome="#3EAAA4",p9="#B3B3B3",ame="#3eaaa4",lme="#67dfd8",gW=["goldenrod","cornflowerblue","dodgerblue","lawngreen"],sk=me.circle(cme||(cme=$([`
  stroke-width: 0.1px;
  vector-effect: non-scaling-stroke;
  r: 0.04px;
  pointer-events: none;
  transition: r 0.15s;
  fill: `,`;
`])),ame),yW=me.circle(ume||(ume=$([`
  stroke-width: 0.1px;
  vector-effect: non-scaling-stroke;
  r: 0.09px;
  cursor: move;
  `,`;
  &:hover {
    opacity: 0.4;
  }
  &:hover + `,` {
    fill: `,`;
  }
`])),Si,sk,lme),hme=l=>{let{curveConnection:{left:h,right:d},backgroundConnections:g}=l,_=Math.min(0,1-d.handles[1],1-h.handles[3]),b=Math.max(1,1-d.handles[1],1-h.handles[3]),S=Math.max(1,b-_),E=X=>(X-_)/S,[N,I]=vi(null),B=zS/((I==null?void 0:I.clientWidth)||1),V=zS/((I==null?void 0:I.clientHeight)||1),[U,F]=vi(null);eme(I,F,l,(X,Z)=>{let te=Ss(h.handles[2]+X*B,0,1),ae=h.handles[3]-Z*V;return[te,ae,d.handles[0],d.handles[1]]});let[H,G]=vi(null);eme(I,G,l,(X,Z)=>{let te=Ss(d.handles[0]+X*B,0,1),ae=d.handles[1]-Z*V;return[h.handles[2],h.handles[3],te,ae]});let W=X=>"M0 ".concat(E(1)," C").concat(X.left.handles[2]," ").concat(E(1-X.left.handles[3])," ").concat(X.right.handles[0]," ").concat(E(1-X.right.handles[1])," 1 ").concat(E(0));return bi.default.createElement("svg",{height:"100%",width:"100%",ref:N,viewBox:"".concat(-rk," ").concat(-rk," ").concat(zS," ").concat(zS),xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none",fill:"none"},bi.default.createElement("linearGradient",{id:"myGradient",gradientTransform:"rotate(90)"},bi.default.createElement("stop",{offset:E(-1),stopColor:ome}),bi.default.createElement("stop",{offset:E(0),stopColor:$v}),bi.default.createElement("stop",{offset:E(.3),stopColor:sme}),bi.default.createElement("stop",{offset:E(.5),stopColor:ime}),bi.default.createElement("stop",{offset:E(.7),stopColor:rme}),bi.default.createElement("stop",{offset:E(1),stopColor:ik}),bi.default.createElement("stop",{offset:E(2),stopColor:nme})),bi.default.createElement("pattern",{id:"dot-background-pattern-1",width:VS,height:VS/S,y:-_/S},bi.default.createElement("rect",{width:Gv,height:Gv,fill:p9,opacity:.3})),bi.default.createElement("rect",{x:0,y:0,width:"1",height:1,fill:"url(#dot-background-pattern-1)"}),bi.default.createElement("pattern",{id:"dot-background-pattern-2",width:VS,height:VS},bi.default.createElement("rect",{width:Gv,height:Gv,fill:p9})),bi.default.createElement("rect",{x:0,y:E(0),width:"1",height:E(1)-E(0),fill:"url(#dot-background-pattern-2)"}),!h.type||h.type==="bezier"?bi.default.createElement(bi.default.Fragment,null,bi.default.createElement("line",{x1:0,y1:E(1),x2:h.handles[2],y2:E(1-h.handles[3]),stroke:p9,strokeWidth:"0.01"}),bi.default.createElement("line",{x1:1,y1:E(0),x2:d.handles[0],y2:E(1-d.handles[1]),stroke:p9,strokeWidth:"0.01"}),bi.default.createElement("path",{d:W(l.curveConnection),stroke:"none",fill:"url('#myGradient')",opacity:"0.1"}),g.map((X,Z)=>bi.default.createElement("path",{key:X.objectKey+"/"+X.left.id,d:W(X),stroke:gW[Z%gW.length],opacity:.6,strokeWidth:"0.01"})),bi.default.createElement("path",{d:W(l.curveConnection),stroke:"url('#myGradient')",strokeWidth:"0.02"}),bi.default.createElement("circle",{cx:0,cy:E(1),r:"0.025",stroke:ik,strokeWidth:"0.02",fill:cg}),bi.default.createElement("circle",{cx:1,cy:E(0),r:"0.025",stroke:$v,strokeWidth:"0.02",fill:cg}),bi.default.createElement(yW,{ref:U,cx:h.handles[2],cy:E(1-h.handles[3]),fill:ik,opacity:.2}),bi.default.createElement(sk,{cx:h.handles[2],cy:E(1-h.handles[3])}),bi.default.createElement(yW,{ref:H,cx:d.handles[0],cy:E(1-d.handles[1]),fill:$v,opacity:.2}),bi.default.createElement(sk,{cx:d.handles[0],cy:E(1-d.handles[1])})):bi.default.createElement(bi.default.Fragment,null,bi.default.createElement("line",{x1:0,y1:E(1),x2:1,y2:E(1),stroke:p9,strokeWidth:"0.01"}),bi.default.createElement("line",{x1:1,y1:E(1),x2:1,y2:0,stroke:p9,strokeWidth:"0.01"}),bi.default.createElement("circle",{cx:0,cy:1,r:"0.025",stroke:$v,strokeWidth:"0.02",fill:cg}),bi.default.createElement("circle",{cx:1,cy:0,r:"0.025",stroke:$v,strokeWidth:"0.02",fill:cg})))},dme=hme});function ok(l){return l.map(h=>h.toFixed(3)).join(", ")}function ak(l){if(!l||(l==null?void 0:l.length)>fme)return null;let h=l.split(",");if(h.length!==4)return null;let d=h.map(g=>Number(g.trim()));return!d.every(g=>isFinite(g))||d[0]<0||d[0]>1||d[2]<0||d[2]>1?null:d}function ZBe(l,h,d={threshold:.02}){if(!l||!h)return!1;let g=0;for(let _=0;_<4;_++)g+=Math.abs(l[_]-h[_]);return g<d.threshold}var fme,lk,pme=C(()=>{fme=128,lk=[{label:"Quad Out",value:"0.250, 0.460, 0.450, 0.940"},{label:"Quad In Out",value:"0.455, 0.030, 0.515, 0.955"},{label:"Quad In",value:"0.550, 0.085, 0.680, 0.530"},{label:"Cubic Out",value:"0.215, 0.610, 0.355, 1.000"},{label:"Cubic In Out",value:"0.645, 0.045, 0.355, 1.000"},{label:"Cubic In",value:"0.550, 0.055, 0.675, 0.190"},{label:"Quart Out",value:"0.165, 0.840, 0.440, 1.000"},{label:"Quart In Out",value:"0.770, 0.000, 0.175, 1.000"},{label:"Quart In",value:"0.895, 0.030, 0.685, 0.220"},{label:"Quint Out",value:"0.230, 1.000, 0.320, 1.000"},{label:"Quint In Out",value:"0.860, 0.000, 0.070, 1.000"},{label:"Quint In",value:"0.755, 0.050, 0.855, 0.060"},{label:"Sine Out",value:"0.390, 0.575, 0.565, 1.000"},{label:"Sine In Out",value:"0.445, 0.050, 0.550, 0.950"},{label:"Sine In",value:"0.470, 0.000, 0.745, 0.715"},{label:"Expo Out",value:"0.190, 1.000, 0.220, 1.000"},{label:"Expo In Out",value:"1.000, 0.000, 0.000, 1.000"},{label:"Expo In",value:"0.780, 0.000, 0.810, 0.00"},{label:"Circ Out",value:"0.075, 0.820, 0.165, 1.000"},{label:"Circ In Out",value:"0.785, 0.135, 0.150, 0.860"},{label:"Circ In",value:"0.600, 0.040, 0.980, 0.335"},{label:"Back Out",value:"0.175, 0.885, 0.320, 1.275"},{label:"Back In Out",value:"0.680, -0.550, 0.265, 1.550"},{label:"Back In",value:"0.600, -0.280, 0.735, 0.045"},{label:"linear",value:"0.5, 0.5, 0.5, 0.5"},{label:"In Out",value:"0.42,0,0.58,1"},{label:"Hold",value:"0, 0, Infinity, Infinity"}]}),Al,ck,m9,vW,mme,gme,GS,_W,xW,yme,vme,QBe=C(()=>{Al=z(Le()),ck=.75,m9=.1,vW=1+ck*2,mme="#F5F5F5",gme="#888888",GS="#4f4f4f",_W="rgba(255, 255, 255, 0.1)",xW=l=>1-l,yme=l=>{let{easing:h,isSelected:d}=l,g=d?mme:gme,_="".concat(-ck," ").concat(-ck," ").concat(vW," ").concat(vW);if(h){let b=[h[0],xW(h[1])],S=[h[2],xW(h[3])];return Al.default.createElement("svg",{height:"100%",width:"100%",viewBox:_,fill:"none",xmlns:"http://www.w3.org/2000/svg"},Al.default.createElement("line",{x1:"0",y1:"1",x2:b[0],y2:b[1],stroke:GS,strokeWidth:"0.1"}),Al.default.createElement("line",{x1:"1",y1:"0",x2:S[0],y2:S[1],stroke:GS,strokeWidth:"0.1"}),Al.default.createElement("circle",{cx:b[0],cy:b[1],r:.1,fill:_W}),Al.default.createElement("circle",{cx:S[0],cy:S[1],r:.1,fill:_W}),Al.default.createElement("circle",{cx:b[0],cy:b[1],r:m9,fill:GS}),Al.default.createElement("circle",{cx:S[0],cy:S[1],r:m9,fill:GS}),Al.default.createElement("path",{d:"M0 1 C".concat(b[0]," ").concat(b[1]," ").concat(S[0],` 
        `).concat(S[1]," 1 0"),stroke:g,strokeWidth:"0.08"}),Al.default.createElement("circle",{cx:0,cy:1,r:m9,fill:g}),Al.default.createElement("circle",{cx:1,cy:0,r:m9,fill:g}))}return Al.default.createElement("svg",{height:"100%",width:"100%",viewBox:_,fill:"none",xmlns:"http://www.w3.org/2000/svg"},Al.default.createElement("line",{x1:"0",y1:"1",x2:1,y2:1,stroke:g,strokeWidth:"0.08"}),Al.default.createElement("line",{x1:"1",y1:"0",x2:1,y2:1,stroke:g,strokeWidth:"0.08"}),Al.default.createElement("circle",{cx:0,cy:1,r:m9,fill:g}),Al.default.createElement("circle",{cx:1,cy:0,r:m9,fill:g}))},vme=yme}),$S,_me,xme,bme,Sme,wme,Tme,Eme,JBe=C(()=>{wS(),$S=z(Le()),at(),pme(),QBe(),GN(),nk(),Zd(),bme=me.div(xme||(xme=$([`
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  aspect-ratio: 1;

  transition: background-color 0.15s;
  background-color: `,`;
  border-radius: 2px;
  cursor: pointer;
  outline: none;

  `,`

  &:hover {
    background-color: #31353a;
  }

  &:focus {
    background-color: #383d42;
  }
`])),cg,({isSelected:l})=>l&&Qa(_me||(_me=$([`
      background-color: #383d42;
    `])))),wme=me(Kd)(Sme||(Sme=$([`
  padding: 0.5em;
  color: white;
  max-width: 240px;
  pointer-events: none !important;
  --popover-bg: black;
  --popover-outer-stroke: transparent;
  --popover-inner-stroke: transparent;
  box-shadow: none;
`]))),Tme=$S.default.forwardRef((l,h)=>{let[d,g]=kv({enabled:!0,verticalPlacement:l.tooltipPlacement,verticalGap:0},()=>$S.default.createElement(wme,{showPopoverEdgeTriangle:!1},l.easing.label));return $S.default.createElement(bme,R({ref:VN([g,h])},l),d,$S.default.createElement(vme,{easing:ak(l.easing.value),isSelected:l.isSelected}))}),Eme=Tme});function eLe(l){var h;let[d,g]=(0,Mme.useState)(null),_=S=>{if(d===null){l.items.length>0&&g(0);return}let E=d+S*l.uiColumns,N=E<0,I=E>l.items.length-1;if(N||I){if(l.canVerticleExit&&l.canVerticleExit(N?"top":"bottom")){g(null);return}return}g(E)},b=S=>{d===null?g(iLe(S,l.items.length)):d+S<0?g(null):g(Math.min(d+S,l.items.length-1))};return{focusFirstItem(){g(0)},onParentEltKeyDown:S=>{if(S.key==="ArrowRight")b(1);else if(S.key==="ArrowLeft")b(-1);else if(S.key==="ArrowUp")_(-1);else if(S.key==="ArrowDown")_(1);else return 0;return 1},gridItems:l.items.map((S,E)=>l.renderItem({isSelected:E===d,item:S,select(N){g(E),l.onSelectItem(S)===1&&(N==null||N.preventDefault(),N==null||N.stopPropagation())}})),currentSelection:(h=l.items[d??-1])!=null?h:null}}var Mme,tLe=C(()=>{Mme=z(Le()),hk()});function Cme(l,h,d){var g;(g=l.current)==null||g.discard(),l.current=null;let _=ak(d);_===null?l.current=rLe(h):l.current=nLe(h,_)}function Ame(l){var h;(h=l.current)==null||h.discard(),l.current=null}function nLe(l,h){return ge().tempTransaction(({stateEditors:d})=>{let{setHandlesForKeyframe:g,setKeyframeType:_}=d.coreByProject.historic.sheetsById.sequence;for(let{projectId:b,sheetId:S,objectKey:E,trackId:N,left:I,right:B}of l)g({projectId:b,sheetId:S,objectKey:E,trackId:N,keyframeId:I.id,start:[h[0],h[1]]}),g({projectId:b,sheetId:S,objectKey:E,trackId:N,keyframeId:B.id,end:[h[2],h[3]]}),_({projectId:b,sheetId:S,objectKey:E,trackId:N,keyframeId:I.id,keyframeType:"bezier"})})}function rLe(l){return ge().tempTransaction(({stateEditors:h})=>{let{setKeyframeType:d}=h.coreByProject.historic.sheetsById.sequence;for(let{projectId:g,sheetId:_,objectKey:b,trackId:S,left:E}of l)d({projectId:g,sheetId:_,objectKey:b,trackId:S,keyframeId:E.id,keyframeType:"hold"})})}function iLe(l,h){return(l%h+h)%h}function sLe(l,h){return()=>setTimeout(l,h)}function oLe({left:l,right:h}){return({left:d,right:g})=>l.handles[2]!==d.handles[2]||l.handles[3]!==d.handles[3]||h.handles[0]!==g.handles[0]||h.handles[1]!==g.handles[1]}var uk,Ds,Rme,bW,SW,Pme,Nme,Ime,kme,Dme,Fme,Ome,Bme,Lme,Ume,zme,Vme,wW,aLe,TW,Gme,hk=C(()=>{uk=Jt,Ds=z(Le()),at(),Rme=z(qBe()),Fe(),KBe(),JBe(),pme(),nk(),Ti(),tLe(),bW=3,SW=53,Pme=25,Ime=me.div(Nme||(Nme=$([`
  background: `,`;
  display: grid;
  grid-template-areas:
    'search  tween'
    'presets tween';
  grid-template-rows: 32px 1fr;
  grid-template-columns: `,`px 120px;
  gap: 1px;
  height: 120px;
`])),mW,bW*SW),Dme=me.div(kme||(kme=$([`
  overflow: auto;
  grid-area: presets;

  display: grid;
  grid-template-columns: repeat(`,`, 1fr);
  grid-auto-rows: min-content;
  gap: 1px;

  overflow-y: scroll;
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* Internet Explorer 10+ */
  &::-webkit-scrollbar {
    /* WebKit */
    width: 0;
    height: 0;
  }
`])),bW),Ome=me.input.attrs({type:"text"})(Fme||(Fme=$([`
  background-color: `,`;
  border: none;
  border-radius: 2px;
  color: rgba(255, 255, 255, 0.8);
  padding: 6px;
  font-size: 12px;
  outline: none;
  cursor: text;
  text-align: left;
  width: 100%;
  height: 100%;
  box-sizing: border-box;

  grid-area: search;

  &:hover {
    background-color: #212121;
  }

  &:focus {
    background-color: rgba(16, 16, 16, 0.26);
    outline: 1px solid rgba(0, 0, 0, 0.35);
  }
`])),cg),Lme=me.div(Bme||(Bme=$([`
  grid-area: tween;
  background: `,`;
`])),cg),zme=me.div(Ume||(Ume=$([`
  grid-column: 1 / 4;
  padding: 6px;
  color: #888888;
`]))),Vme=l=>{let h=(0,Ds.useMemo)(()=>[l.curveConnection,...l.additionalConnections],[l.curveConnection,...l.additionalConnections]),d=(0,Ds.useRef)(null);(0,Ds.useEffect)(()=>{let de=Gme(h);return()=>{var Be;de(),(Be=d.current)==null||Be.commit()}},[d]);let g=[l.curveConnection.left.handles[2],l.curveConnection.left.handles[3],l.curveConnection.right.handles[0],l.curveConnection.right.handles[1]],_=(0,Ds.useRef)(null);(0,Ds.useLayoutEffect)(()=>{var de,Be;(de=_.current)==null||de.select(),(Be=_.current)==null||Be.focus()},[_.current]);let[b,S]=(0,Ds.useState)(ok(g)),E=de=>{de!==void 0&&(B(1),S(de.target.value),ak(de.target.value)&&U(de.target.value))},N=de=>{var Be,re;B(1),(de.key==="ArrowDown"||de.key==="ArrowUp")&&de.preventDefault(),de.key==="ArrowDown"?(ot.focusFirstItem(),(re=(Be=ue.current[X[0].label])==null?void 0:Be.current)==null||re.focus()):de.key==="Escape"?(Ame(d),l.onRequestClose("key Escape")):de.key==="Enter"&&l.onRequestClose("key Enter")},[I,B]=(0,Ds.useState)(0);(0,Ds.useEffect)(()=>{I===2?S(ok(g)):I===3&&b!==""&&S("")},h);let[V,U]=(0,Ds.useState)(ok(g)),[F,H]=(0,Ds.useState)(null);(0,Ds.useEffect)(()=>{var de;I!==0&&I!==3&&Cme(d,h,(de=F??V)!=null?de:"")},[F,V,I]),h.some(oLe(l.curveConnection))&&I===0&&B(3);let G=de=>{var Be,re;B(2);let Ye=ok(de);S(Ye),U(Ye),(Be=_.current)==null||Be.select(),(re=_.current)==null||re.focus()},W=()=>{},X=(0,Ds.useMemo)(()=>/^[A-Za-z]/.test(b)?Rme.default.filter(b,lk,{extract:de=>de.label}).map(de=>de.original):lk,[b]);(0,Ds.useEffect)(()=>{I===1&&X[0]&&U(X[0].value)},[X]);let Z=de=>{de.key==="Escape"?(Ame(d),l.onRequestClose("key Escape"),de.stopPropagation()):de.key==="Enter"&&(l.onRequestClose("key Enter"),de.stopPropagation())},te=de=>{I===0&&B(2),H(de.value)},ae=()=>H(null),oe=de=>(Cme(d,h,de.value),l.onRequestClose("selected easing option"),1),ue=(0,Ds.useRef)(lk.reduce((de,Be)=>(de[Be.label]={current:null},de),{})),[Ee,Ie]=vi(null),[_e,Oe]=(0,Ds.useState)(0);(0,Ds.useEffect)(()=>{let de=()=>{var Be;Oe((Be=Ie==null?void 0:Ie.scrollTop)!=null?Be:0)};return Ie==null||Ie.addEventListener("scroll",de),()=>Ie==null?void 0:Ie.removeEventListener("scroll",de)},[Ie]);let ot=eLe({items:X,uiColumns:3,onSelectItem:oe,canVerticleExit(de){var Be,re;return de==="top"?((Be=_.current)==null||Be.select(),(re=_.current)==null||re.focus(),1):0},renderItem:({item:de,select:Be})=>{var re,Ye;return Ds.default.createElement(Eme,{key:de.label,easing:de,tabIndex:0,onKeyDown:Z,ref:ue.current[de.label],onMouseOver:()=>te(de),onMouseOut:ae,onClick:Be,tooltipPlacement:((Ye=(re=ue.current[de.label].current)==null?void 0:re.offsetTop)!=null?Ye:0)-(_e??0)<SW+Pme?"bottom":"top",isSelected:ZBe(g,ak(de.value))})}});return(0,Ds.useLayoutEffect)(()=>{var de,Be;if(ot.currentSelection!==null&&document.activeElement!==_.current){let re=(Be=(de=ue.current)==null?void 0:de[ot.currentSelection.label])==null?void 0:Be.current;re==null||re.focus(),U(ot.currentSelection.value),/^[A-Za-z]/.test(b)||S(ot.currentSelection.value)}},[ot.currentSelection]),Ds.default.createElement(Ime,null,Ds.default.createElement(Ome,{value:b,placeholder:I===3?"Multiple easings selected":"Search presets...",onPaste:sLe(E),onChange:E,ref:_,onKeyDown:N}),Ds.default.createElement(Dme,{ref:Ee,onKeyDown:de=>ot.onParentEltKeyDown(de)},ot.gridItems,ot.gridItems.length===0?Ds.default.createElement(zme,null,"No results found"):void 0),Ds.default.createElement(Lme,{onClick:()=>{var de;return(de=_.current)==null?void 0:de.focus()}},Ds.default.createElement(dme,{curveConnection:l.curveConnection,backgroundConnections:l.additionalConnections,onCurveChange:G,onCancelCurveChange:W})))},wW=Vme,{isCurveEditorOpenD:aLe,isConnectionEditingInCurvePopover:TW,getLock:Gme}=(()=>{let l=new uk.Atom([]);return{getLock(h){return l.set(h),function(){l.set([])}},isCurveEditorOpenD:(0,uk.prism)(()=>l.prism.getValue().length>0),isConnectionEditingInCurvePopover(h){return uk.prism.ensurePrism(),l.prism.getValue().some(({left:d,right:g})=>h.left.id===d.id&&h.right.id===g.id)}}})()});function lLe(l,h){for(let{keyframeId:d}of hLe(h))if(l.left.id===d)return!0;return!1}function $me(l,h,d){return(0,fk.prism)(()=>{if(d===void 0)return[];let g=[];for(let{objectKey:_,trackId:b}of Hme(d)){let S=(0,fk.val)(ge().atomP.historic.coreByProject[l].sheetsById[h].sequence.tracksByObject[_].trackData[b]);S&&(g=g.concat(uLe(S.keyframes).filter(E=>lLe(E,d)).map(({left:E,right:N})=>({left:E,right:N,trackId:b,objectKey:_,sheetId:h,projectId:l}))))}return g})}function dk(l,h,d){var g;if(d===void 0)return[];let _=[];for(let{objectKey:S,trackId:E,keyframeIds:N}of Hme(d))_=_.concat((g=EW({projectId:l,sheetId:h,objectKey:S,trackId:E,keyframeIds:N}))!=null?g:[]);let b=jI(_.map(S=>S.pathToProp));return _.map(({keyframe:S,pathToProp:E})=>({keyframe:S,pathToProp:E.slice(b.length)}))}function EW({projectId:l,sheetId:h,objectKey:d,trackId:g,keyframeIds:_}){let b=(0,fk.val)(ge().atomP.historic.coreByProject[l].sheetsById[h].sequence.tracksByObject[d]),S=b==null?void 0:b.trackData[g];if(!S)return null;let E=cLe((b==null?void 0:b.trackIdByPropPath)||{})[g];if(!E)return null;let N=[d,...WI(E)];return _.map(I=>({keyframe:S.keyframes.find(B=>B.id===I),pathToProp:N})).filter(({keyframe:I})=>I!==void 0)}function cLe(l){let h={};for(let[d,g]of Object.entries(l))h[g]=d;return h}function uLe(l){return l.map((h,d)=>({left:h,right:l[d+1]})).slice(0,-1)}function hLe(l){var h,d,g;let _=[];for(let[b,S]of Object.entries((h=l==null?void 0:l.byObjectKey)!=null?h:{}))for(let[E,N]of Object.entries((d=S==null?void 0:S.byTrackId)!=null?d:{}))for(let I of Object.keys((g=N==null?void 0:N.byKeyframeId)!=null?g:{}))_.push({objectKey:b,trackId:E,keyframeId:I});return _}function Hme(l){var h,d,g;let _=[];for(let[b,S]of Object.entries((h=l==null?void 0:l.byObjectKey)!=null?h:{}))for(let[E,N]of Object.entries((d=S==null?void 0:S.byTrackId)!=null?d:{}))_.push({objectKey:b,trackId:E,keyframeIds:Object.keys((g=N==null?void 0:N.byKeyframeId)!=null?g:{})});return _}var fk,Hv=C(()=>{fk=Jt,Fe(),nf()});function dLe(l,h){return(0,jme.useMemo)(()=>fLe(l,h),[])}function fLe(l,h){let d=null,g=S=>ge().tempTransaction(E=>l(E,S));function _(){d==null||d.discard(),d=null}let b={createAsset:h.sheet.project.assetStorage.createAsset,getAssetUrl:S=>S.id?h.sheet.project.assetStorage.getAssetUrl(S.id):void 0};return R({temporarilySetValue(S){_(),d=g(S)},discardTemporaryValue:_,permanentlySetValue(S){_(),g(S).commit()}},b)}var jme,pLe=C(()=>{Fe(),jme=z(Le())});function MW(l){var h;if(l.type==="sheetObject")return rl.default.createElement(rl.default.Fragment,null,rl.default.createElement(pk,{style:{paddingLeft:"".concat(l.indent*mk,"px")}},l.sheetObject.address.objectKey),l.children.map((d,g)=>rl.default.createElement(MW,M(R({key:g},d),{autoFocusInput:l.autoFocusInput&&g===0,indent:l.indent+1}))));if(l.type==="propWithChildren"){let d=(h=l.propConfig.label)!=null?h:yp(l.pathToProp);return rl.default.createElement(rl.default.Fragment,null,rl.default.createElement(pk,{style:{paddingLeft:"".concat(l.indent*mk,"px")}},d),l.children.map((g,_)=>rl.default.createElement(MW,M(R({key:_},g),{autoFocusInput:l.autoFocusInput&&_===0,indent:l.indent+1}))))}else return rl.default.createElement(mLe,M(R({},l),{autoFocusInput:l.autoFocusInput,indent:l.indent}))}function mLe(l){var h;let d=(h=l.propConfig.label)!=null?h:yp(l.pathToProp),g=gLe(l);if(l.propConfig.type==="enum")return rl.default.createElement(rl.default.Fragment,null);{let _=tj[l.propConfig.type];return rl.default.createElement(qme,null,rl.default.createElement(pk,null,rl.default.createElement("span",{style:{paddingLeft:"".concat(l.indent*mk,"px")}},d)),rl.default.createElement(Kme,null,rl.default.createElement(_,{editingTools:g,propConfig:l.propConfig,value:uI(l.keyframe.value,l.propConfig),autoFocus:l.autoFocusInput})))}}function gLe(l){let h=l.sheetObject;return dLe(({stateEditors:d},g)=>{let _=M(R({},l.keyframe),{value:g});d.coreByProject.historic.sheetsById.sequence.replaceKeyframes(M(R({},h.address),{trackId:l.trackId,keyframes:[_],snappingFunction:h.sheet.getSequence().closestGridPosition}))},h)}var rl,Wme,qme,Xme,pk,mk,Yme,Kme,yLe=C(()=>{rl=z(Le()),at(),Oce(),U3(),pLe(),eg(),qme=me.div(Wme||(Wme=$([`
  display: flex;
  align-items: stretch;
  min-width: 200px;

  select {
    min-width: 100px;
  }
`]))),pk=me.div(Xme||(Xme=$([`
  font-style: normal;
  font-weight: 400;
  font-size: 11px;
  line-height: 13px;
  letter-spacing: 0.01em;
  padding: 6px 6px 6px 0;

  width: 40%;

  color: #919191;

  overflow: hidden;
`]))),mk=10,Kme=me.div(Yme||(Yme=$([`
  display: flex;
  align-items: center;
  width: 60%;
`])))});function gk(l){return Xd({debugName:"useKeyframeInlineEditorPopover"},()=>yk.default.createElement(Kd,{showPopoverEdgeTriangle:!0},yk.default.createElement("div",{style:{margin:"1px 2px 1px 10px"}},Array.isArray(l)?l.map((h,d)=>yk.default.createElement(MW,M(R({key:d},h),{autoFocusInput:d===0,indent:0}))):void 0)))}var yk,vk=C(()=>{yk=z(Le()),Yd(),Zd(),yLe()});function vLe(l,h,d){return c0(l,{displayName:"Keyframe",menuItems:()=>{let g=dk(d.leaf.sheetObject.address.projectId,d.leaf.sheetObject.address.sheetId,d.selection);return[{label:g.length>0?"Copy (selection)":"Copy",callback:()=>{g.length>0?ge().transaction(_=>{_.stateEditors.studio.ahistoric.setClipboardKeyframes(g)}):ge().transaction(_=>{_.stateEditors.studio.ahistoric.setClipboardKeyframes([{keyframe:d.keyframe,pathToProp:d.leaf.pathToProp}])})}},{label:d.selection!==void 0?"Delete (selection)":"Delete",callback:()=>{d.selection?d.selection.delete():ge().transaction(({stateEditors:_})=>{_.coreByProject.historic.sheetsById.sequence.deleteKeyframes(M(R({},d.leaf.sheetObject.address),{keyframeIds:[d.keyframe.id],trackId:d.leaf.trackId}))})}}]},onOpen(){h._debug("Show keyframe",d)}})}function _Le(l,h,d){let g=(0,ug.useRef)(h);g.current=h;let{onClickFromDrag:_}=d,b=(0,ug.useMemo)(()=>({debugName:"KeyframeDot/useDragKeyframe",onDragStart(E){let N=g.current,I=(0,_k.val)(ge().atomP.historic.coreByProject[N.leaf.sheetObject.address.projectId].sheetsById[N.leaf.sheetObject.address.sheetId].sequence.tracksByObject),B=F1e(I,function(H,{trackId:G,objectKey:W}){var X,Z;return H.id!==N.keyframe.id&&!(N.selection&&(Z=(X=N.selection.byObjectKey[W])==null?void 0:X.byTrackId[G])!=null&&Z.byKeyframeId[H.id])});if(D1e(B),N.selection){let{selection:H,leaf:G}=N,{sheetObject:W}=G,X=H.getDragHandlers(M(R({},W.address),{domNode:l,positionAtStartOfDrag:N.track.data.keyframes[N.index].position})).onDragStart(E);return X&&M(R({},X),{onClick:_,onDragEnd:(...Z)=>{var te;(te=X.onDragEnd)==null||te.call(X,...Z),h9()}})}let V=N,U=(0,_k.val)(V.layoutP.scaledSpace.toUnitSpace),F;return{onDrag(H,G,W){var X;let Z=V.track.data.keyframes[V.index],te=Math.max((X=h0.checkIfMouseEventSnapToPos(W,{ignore:l}))!=null?X:Z.position+U(H),0);F==null||F.discard(),F=void 0,F=ge().tempTransaction(({stateEditors:ae})=>{ae.coreByProject.historic.sheetsById.sequence.replaceKeyframes(M(R({},V.leaf.sheetObject.address),{trackId:V.leaf.trackId,keyframes:[M(R({},Z),{position:te})],snappingFunction:(0,_k.val)(V.layoutP.sheet).getSequence().closestGridPosition}))})},onDragEnd(H){H?F==null||F.commit():F==null||F.discard(),h9()},onClick(H){_(H)}}}}),[_]),[S]=eo(l,b);return Up(S,h.keyframe.position),bu(S,"draggingPositionInSequenceEditor","ew-resize"),[S]}var ug,_k,HS,CW,jS,AW,Zme,xk,Qme,Jme,ege,tge,nge,rge,ige=C(()=>{ug=z(Le()),at(),Fe(),u0(),Yo(),Ti(),_k=Jt,nl(),Ec(),Ph(),KI(),Qm(),Hv(),Ei(),d9(),vk(),s9(),HS=6,CW=HS+2,jS={normalColor:"#40AAA4",selectedColor:"#F2C95C",inlineEditorOpenColor:"#FCF3DC",selectedAndInlineEditorOpenColor:"#CBEBEA"},AW=({isSelected:l,isInlineEditorPopoverOpen:h})=>l&&h?jS.inlineEditorOpenColor:l?jS.selectedColor:h?jS.selectedAndInlineEditorOpenColor:jS.normalColor,xk=me.div(Zme||(Zme=$([`
  position: absolute;
  `,`

  background: `,`;
  transform: rotateZ(45deg);

  `,`;

  z-index: 1;
  pointer-events: none;
`])),Tu(HS),l=>AW(l),l=>l.flag===2?"outline: 2px solid white;":""),Jme=me.div(Qme||(Qme=$([`
  position: absolute;
  `,`

  background: `,`;

  `,`;

  z-index: 1;
  pointer-events: none;
`])),Tu(HS*1.5),l=>AW(l),l=>l.flag===2?"outline: 2px solid white;":""),tge=me.div(ege||(ege=$([`
  z-index: 1;
  cursor: ew-resize;

  position: absolute;
  `,`;
  `,`;

  & + `,` {
    `,`
  }

  &:hover + `,` {
    `,`
  }
`])),Tu(12),Si,xk,l=>l.isInlineEditorPopoverOpen?Tu(CW):"",xk,Tu(CW)),nge=l=>{let h=Zm("SingleKeyframeDot",l.keyframe.id),d=i9(l.itemKey),[g,_]=vi(null),[b]=vLe(_,h,l),{node:S,toggle:E,isOpen:N}=gk([{type:"primitiveProp",keyframe:l.keyframe,pathToProp:l.leaf.pathToProp,propConfig:l.leaf.propConf,sheetObject:l.leaf.sheetObject,trackId:l.leaf.trackId}]);_Le(_,l,{onClickFromDrag(B){E(B,g.current)}});let I=!l.keyframe.type||l.keyframe.type==="bezier";return ug.default.createElement(ug.default.Fragment,null,ug.default.createElement(tge,R({ref:g,isInlineEditorPopoverOpen:N},d.attrs)),I?ug.default.createElement(xk,{isSelected:!!l.selection,isInlineEditorPopoverOpen:N,flag:d.flag}):ug.default.createElement(Jme,{isSelected:!!l.selection,isInlineEditorPopoverOpen:N,flag:d.flag}),S,b)},rge=nge}),RW,PW,NW,g9,sge,oge,IW,age=C(()=>{Tc(),RW=z(Le()),at(),ige(),PW=HS/2+1,NW=1e3,g9={normalColor:"#365b59",selectedColor:"#8A7842",barColor:l=>{let h=l.isSelected?g9.selectedColor:g9.normalColor;return l.isPopoverOpen?CN(.2,cv(.2,h)):h},hoverColor:l=>{let h=l.isSelected?g9.selectedColor:g9.normalColor;return l.isPopoverOpen?CN(.2,cv(.2,h)):CN(.1,cv(.1,h))}},oge=me.div(sge||(sge=$([`
  position: absolute;
  background: `,`;
  height: `,`px;
  width: `,`px;

  left: 0;
  top: -`,`px;
  transform-origin: top left;
  z-index: 0;
  cursor: ew-resize;

  &:after {
    display: block;
    position: absolute;
    content: ' ';
    top: -4px;
    bottom: -4px;
    left: 0;
    right: 0;
  }

  &:hover {
    background: `,`;
  }
`])),g9.barColor,PW,NW,PW/2,g9.hoverColor),IW=RW.default.forwardRef((l,h)=>{let d={isPopoverOpen:l.isPopoverOpen,isSelected:l.isSelected};return RW.default.createElement(oge,M(R({},d),{ref:h,style:{transform:"scaleX(calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(l.connectorLengthInUnitSpace/NW,"))")},onClick:g=>{var _;(_=l.openPopover)==null||_.call(l,g)}}),l.children)})});function xLe(l,h){let d=(0,kW.useRef)(h);d.current=h;let g=(0,kW.useMemo)(()=>({debugName:"useDragKeyframe",lockCSSCursorTo:"ew-resize",onDragStart(_){let b=d.current,S;if(b.selection){let{selection:B,leaf:V}=b,{sheetObject:U}=V;return B.getDragHandlers(M(R({},U.address),{domNode:l,positionAtStartOfDrag:b.track.data.keyframes[b.index].position})).onDragStart(_)}let E=b,N=(0,bk.val)(E.layoutP.sheet).getSequence(),I=(0,bk.val)(E.layoutP.scaledSpace.toUnitSpace);return{onDrag(B,V,U){let F=I(B);S&&(S.discard(),S=void 0),S=ge().tempTransaction(({stateEditors:H})=>{H.coreByProject.historic.sheetsById.sequence.transformKeyframes(M(R({},E.leaf.sheetObject.address),{trackId:E.leaf.trackId,keyframeIds:[E.keyframe.id,E.track.data.keyframes[E.index+1].id],translate:F,scale:1,origin:0,snappingFunction:N.closestGridPosition}))})},onDragEnd(B){B?S&&S.commit():S&&S.discard()}}}}),[]);eo(l,g)}function bLe(l,h,d,g){return c0(h,{displayName:"Tween",menuItems:()=>{let _=dk(l.leaf.sheetObject.address.projectId,l.leaf.sheetObject.address.sheetId,l.selection);return[{label:_.length>0?"Copy (selection)":"Copy",callback:()=>{_.length>0?ge().transaction(b=>{b.stateEditors.studio.ahistoric.setClipboardKeyframes(_)}):ge().transaction(b=>{b.stateEditors.studio.ahistoric.setClipboardKeyframes([{keyframe:d,pathToProp:l.leaf.pathToProp},{keyframe:g,pathToProp:l.leaf.pathToProp}])})}},{label:l.selection?"Delete (selection)":"Delete",callback:()=>{l.selection?l.selection.delete():ge().transaction(({stateEditors:b})=>{b.coreByProject.historic.sheetsById.sequence.deleteKeyframes(M(R({},l.leaf.sheetObject.address),{keyframeIds:[d.id,g.id],trackId:l.leaf.trackId}))})}}]}})}var bk,hg,kW,DW,lge,cge,uge,hge,dge,SLe=C(()=>{Fe(),u0(),Yo(),Ti(),bk=Jt,hg=z(Le()),kW=z(Le()),Yd(),Zd(),hk(),age(),nk(),Qn(),Hv(),Hv(),at(),DW=5,cge=me(Kd)(lge||(lge=$([`
  --popover-outer-stroke: transparent;
  --popover-inner-stroke: `,`;
`])),mW),uge=l=>{let{index:h,track:d}=l,g=d.data.keyframes[h],_=d.data.keyframes[h+1],[b,S]=vi(null),{node:E,toggle:N,close:I}=Xd(()=>{let F=(0,bk.val)(l.layoutP.rightDims);return{debugName:"Connector",constraints:{minX:F.screenX+DW,maxX:F.screenX+F.width-DW}}},()=>hg.default.createElement(dge,M(R({},l),{closePopover:I}))),[B]=bLe(l,S,g,_);xLe(S,l);let V=_.position-g.position,U={isPopoverOpen:Rr(()=>TW(M(R({},l.leaf.sheetObject.address),{trackId:l.leaf.trackId,left:g,right:_})),[l.leaf.sheetObject.address,l.leaf.trackId,g,_]),isSelected:l.selection!==void 0};return hg.default.createElement(hg.default.Fragment,null,hg.default.createElement(IW,M(R({ref:b,connectorLengthInUnitSpace:V},U),{openPopover:F=>{S&&N(F,S)}}),E),B)},hge=uge,dge=hg.default.forwardRef((l,h)=>{let{index:d,track:{data:g},selection:_}=l,b=g.keyframes[d],S=g.keyframes[d+1],E=l.leaf.trackId,N=l.leaf.sheetObject.address,I=Rr(()=>$me(N.projectId,N.sheetId,_).getValue(),[N,_]),B=R({left:b,right:S,trackId:E},N);return hg.default.createElement(cge,{showPopoverEdgeTriangle:!1,ref:h},hg.default.createElement(wW,{curveConnection:B,additionalConnections:I,onRequestClose:l.closePopover}))})}),fge,y9,pge,mge,gge,yge,vge,wLe=C(()=>{fge=Jt,y9=z(Le()),at(),SLe(),ige(),mge=me.div(pge||(pge=$([`
  position: absolute;
`]))),gge=y9.default.createElement(y9.default.Fragment,null),yge=y9.default.memo(l=>{let{index:h,track:{data:d}}=l,g=d.keyframes[h],_=d.keyframes[h+1],b=g.connectedRight&&!!_;return y9.default.createElement(mge,{style:{top:"".concat(l.leaf.nodeHeight/2,"px"),left:"calc(".concat((0,fge.val)(l.layoutP.scaledSpace.leftPadding),"px + calc(var(--unitSpaceToScaledSpaceMultiplier) * ").concat(g.position,"px))")}},y9.default.createElement(rge,M(R({},l),{itemKey:l.itemKey})),b?y9.default.createElement(hge,R({},l)):gge)}),vge=yge});function TLe(l,h){return c0(l,{displayName:"Keyframe Track",menuItems:()=>{var d;let g=(d=(0,jv.val)(ge().atomP.ahistoric.clipboard.keyframesWithRelativePaths))!=null?d:[];return[ELe(h,g)]}})}function ELe(l,h){return{label:"Paste Keyframes",enabled:h.length>0,callback:()=>{var d;let g=(0,jv.val)(l.layoutP.sheet).getSequence(),_=(d=h[0])==null?void 0:d.pathToProp,b=h.filter(({keyframe:S,pathToProp:E})=>ABe(_,E)).map(({keyframe:S,pathToProp:E})=>S);ge().transaction(({stateEditors:S})=>{var E;g.position=g.closestGridPosition(g.position);let N=(E=MLe(b))==null?void 0:E.position;for(let I of b)S.coreByProject.historic.sheetsById.sequence.setKeyframeAtPosition(M(R({},l.leaf.sheetObject.address),{trackId:l.leaf.trackId,position:g.position+I.position-N,handles:I.handles,value:I.value,snappingFunction:g.closestGridPosition,type:I.type}))})}}}function MLe(l){let h=null;for(let d of l)(h===null||d.position<h.position)&&(h=d);return h}var jv,zp,_ge,xge,FW,bge,CLe=C(()=>{Qn(),jv=Jt,zp=z(Le()),at(),wLe(),u0(),Ti(),Fe(),nf(),d9(),Fp(),xge=me.div(_ge||(_ge=$([`
  position: relative;
  height: 100%;
  width: 100%;
`]))),FW=zp.default.memo(l=>{var h;let{layoutP:d,trackData:g,leaf:_}=l,[b,S]=vi(null),{selectedKeyframeIds:E,selection:N}=Rr(()=>{let te=(0,jv.val)(d.selectionAtom),ae=(0,jv.val)(te.pointer.current.byObjectKey[_.sheetObject.address.objectKey].byTrackId[_.trackId].byKeyframeId);return ae?{selectedKeyframeIds:ae,selection:(0,jv.val)(te.pointer.current)}:{selectedKeyframeIds:{},selection:void 0}},[d,_.trackId]),[I,B,V]=TLe(S,l),U=Dr(dW),F=U.mode==="snapToSome"?(h=U.positions[_.sheetObject.address.objectKey])==null?void 0:h[_.trackId]:[],H=U.mode==="snapToAll",G=(0,zp.useMemo)(()=>({data:g,id:_.trackId,sheetObject:l.leaf.sheetObject}),[g,_.trackId]),W=g.keyframes.map((te,ae)=>zp.default.createElement(vge,{key:"keyframe-"+te.id,itemKey:ya.forTrackKeyframe(_.sheetObject,_.trackId,te.id),keyframe:te,index:ae,track:G,layoutP:d,leaf:_,selection:E[te.id]===!0?N:void 0})),X=F.map(te=>zp.default.createElement(LS,{key:"snap-target-"+te,layoutP:d,leaf:_,position:te})),Z=H?g.keyframes.map(te=>zp.default.createElement(LS,{key:"additionalSnapTarget-".concat(te.id),layoutP:d,leaf:_,position:te.position})):null;return zp.default.createElement(xge,{ref:b,style:{background:V?"#444850 ":"unset"}},W,X,zp.default.createElement(zp.default.Fragment,null,Z),I)}),FW.displayName="BasicKeyframedTrack",bge=FW}),Sge,WS,wge,Tge,ALe=C(()=>{Fe(),Qn(),Sge=Jt,WS=z(Le()),ek(),CLe(),Qm(),wge=({leaf:l,layoutP:h})=>{let d=Zm("PrimitivePropRow",l.pathToProp.join());return Rr(()=>{let{sheetObject:g}=l,{trackId:_}=l,b=(0,Sge.val)(ge().atomP.historic.coreByProject[g.address.projectId].sheetsById[g.address.sheetId].sequence.tracksByObject[g.address.objectKey].trackData[_]);return(b==null?void 0:b.type)!=="BasicKeyframedTrack"?(d.errorDev("trackData type ".concat(b==null?void 0:b.type," is not yet supported on the sequence editor")),WS.default.createElement(Vv,{leaf:l,isCollapsed:!1,node:WS.default.createElement("div",null)})):WS.default.createElement(Vv,{leaf:l,isCollapsed:!1,node:WS.default.createElement(bge,{layoutP:h,trackData:b,leaf:l})})},[l,h])},Tge=wge});function RLe(l){return l()}var PLe=C(()=>{});function Ege(l){let{index:h,aggregateKeyframes:d,selection:g}=l;return Rr(Mge(l),[h,d,g,l.viewModel])}function Mge(l){let{index:h,aggregateKeyframes:d,selection:g}=l,{projectId:_,sheetId:b}=l.viewModel.type==="sheet"?l.viewModel.sheet.address:l.viewModel.sheetObject.address;return()=>{let S=d[h],E=d[h+1],N=E&&S.keyframes.length===E.keyframes.length&&S.keyframes.every(({track:U},F)=>E.keyframes[F].track===U)?{length:E.position-S.position,selected:S.selected===0&&E.selected===0}:null,I=N?S.keyframes.map(({kf:U,track:F},H)=>M(R({},F.sheetObject.address),{trackId:F.id,left:U,right:E.keyframes[H].kf})):[],B=RLe(()=>{let U=OW.prism.memo("selectedConnections",()=>$me(_,b,g),[_,b,g]).getValue();return[...I,...U]}),V=I.every(U=>TW(U));return{itemKey:OW.prism.memo("itemKey",()=>l.viewModel.type==="sheet"?ya.forSheetAggregateKeyframe(l.viewModel.sheet,S.position):l.viewModel.type==="sheetObject"?ya.forSheetObjectAggregateKeyframe(l.viewModel.sheetObject,S.position):ya.forCompoundPropAggregateKeyframe(l.viewModel.sheetObject,l.viewModel.pathToProp,S.position),[l.viewModel,S.position]),cur:S,connected:N,isAggregateEditingInCurvePopover:V,allConnections:B}}}var OW,BW=C(()=>{OW=Jt,Fp(),hk(),Qn(),Hv(),PLe()});function NLe(l,h){let d=(0,Eu.useRef)(h);d.current=h;let g=(0,Eu.useMemo)(()=>({debugName:"useDragKeyframe",lockCSSCursorTo:"ew-resize",onDragStart(_){let b=d.current,S,E=b.aggregateKeyframes[b.index].keyframes,{selection:N,viewModel:I}=b,B=I.type==="sheet"?I.sheet.address:I.sheetObject.address;if(N&&b.aggregateKeyframes[b.index].selected===0)return N.getDragHandlers(M(R({},B),{domNode:l,positionAtStartOfDrag:b.aggregateKeyframes[b.index].position})).onDragStart(_);let V=b,U=(0,Sk.val)(V.layoutP.sheet).getSequence(),F=(0,Sk.val)(V.layoutP.scaledSpace.toUnitSpace);return{onDrag(H,G,W){let X=F(H);S&&(S.discard(),S=void 0),S=ge().tempTransaction(({stateEditors:Z})=>{for(let te of E)Z.coreByProject.historic.sheetsById.sequence.transformKeyframes(M(R({},te.track.sheetObject.address),{trackId:te.track.id,keyframeIds:[te.kf.id,te.track.data.keyframes[te.track.data.keyframes.indexOf(te.kf)+1].id],translate:X,scale:1,origin:0,snappingFunction:U.closestGridPosition}))})},onDragEnd(H){H?S&&S.commit():S&&S.discard()}}}}),[]);return eo(l,g)}function ILe(l,h){return c0(h,{displayName:"Aggregate Tween",menuItems:()=>{let d=l.utils.allConnections.reduce((E,N)=>{var I;return E.concat((I=EW(M(R({},N),{keyframeIds:[N.left.id,N.right.id]})))!=null?I:[])},[]),g=jI(d.map(E=>E.pathToProp)),_=d.map(({keyframe:E,pathToProp:N})=>({keyframe:E,pathToProp:N.slice(g.length)})),b=l.editorProps.viewModel,S=b.type==="sheet"?b.sheet.address:b.sheetObject.address;return[{label:"Copy",callback:()=>{if(l.editorProps.selection){let E=dk(S.projectId,S.sheetId,l.editorProps.selection);ge().transaction(N=>{N.stateEditors.studio.ahistoric.setClipboardKeyframes(E)})}else ge().transaction(E=>{E.stateEditors.studio.ahistoric.setClipboardKeyframes(_)})}},{label:"Delete",callback:()=>{l.editorProps.selection?l.editorProps.selection.delete():ge().transaction(({stateEditors:E})=>{for(let N of l.utils.allConnections)E.coreByProject.historic.sheetsById.sequence.deleteKeyframes(M(R({},S),{objectKey:N.objectKey,keyframeIds:[N.left.id,N.right.id],trackId:N.trackId}))})}}]}})}var Sk,Eu,LW,Cge,Age,Rge,Pge,kLe=C(()=>{Sk=Jt,Eu=z(Le()),age(),Yd(),Ti(),Fe(),Yo(),hk(),BW(),at(),Zd(),Hv(),u0(),nf(),LW=5,Age=me(Kd)(Cge||(Cge=$([`
  --popover-outer-stroke: transparent;
  --popover-inner-stroke: rgba(26, 28, 30, 0.97);
`]))),Rge=Eu.default.forwardRef((l,h)=>{let{allConnections:d}=Ege(l);return Eu.default.createElement(Age,{showPopoverEdgeTriangle:!1,ref:h},Eu.default.createElement(wW,{curveConnection:d[0],additionalConnections:d,onRequestClose:l.closePopover}))}),Pge=l=>{let[h,d]=vi(null),{editorProps:g}=l,[_]=ILe(l,d),[b]=NLe(d,l.editorProps),{node:S,toggle:E,close:N}=Xd(()=>{let V=(0,Sk.val)(g.layoutP.rightDims);return{debugName:"Connector",constraints:{minX:V.screenX+LW,maxX:V.screenX+V.width-LW}}},()=>Eu.default.createElement(Rge,M(R({},g),{closePopover:N}))),{connected:I,isAggregateEditingInCurvePopover:B}=l.utils;return I||b?Eu.default.createElement(Eu.default.Fragment,null,Eu.default.createElement(IW,{ref:h,connectorLengthInUnitSpace:I?I.length:0,isSelected:I?I.selected:!1,isPopoverOpen:B,openPopover:V=>{d&&E(V,d)}}),S,_):Eu.default.createElement(Eu.default.Fragment,null)}});function DLe(l){let h={isSelected:l.isSelected,flag:l.flag};return Vp.default.createElement(wk,null,l.isAllHere?Vp.default.createElement(Oge,R({},h)):Vp.default.createElement(Bge,R({},h)))}var Vp,UW,Nge,Ige,wk,kge,Dge,zW,VW,GW,$W,Fge,Oge,Bge,FLe=C(()=>{Vp=z(Le()),at(),KI(),Ei(),UW=16,Nge=UW+2,wk=me.div(Ige||(Ige=$([`
  position: absolute;
  `,`
  z-index: 1;
`])),Tu(UW)),Dge=me.div(kge||(kge=$([`
  z-index: 2;
  cursor: ew-resize;

  position: absolute;
  `,`;
  `,`;

  &:hover
    + `,`,
    #pointer-root.draggingPositionInSequenceEditor
    &:hover
    + `,` {
    `,`
  }
`])),Tu(12),Si,wk,wk,Tu(Nge)),zW="#F2C95C",VW="#40AAA4",GW="#45747C",$W=l=>l.isSelected===0?zW:l.isSelected===1?VW:GW,Fge=l=>l.isSelected===0?zW:l.isSelected===1?VW:GW,Oge=l=>Vp.default.createElement("svg",{width:"100%",height:"100%",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Vp.default.createElement("rect",{x:"4.46443",y:"10.0078",width:"5",height:"5",transform:"rotate(-45 4.46443 10.0078)",fill:"#212327",stroke:Fge(l)}),Vp.default.createElement("rect",{x:"3.75732",y:"6.01953",width:"6",height:"6",transform:"rotate(-45 3.75732 6.01953)",fill:$W(l),stroke:l.flag===2?"white":void 0,strokeWidth:l.flag===2?"2px":void 0})),Bge=l=>Vp.default.createElement("svg",{width:"100%",height:"100%",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Vp.default.createElement("rect",{x:"4.46443",y:"8",width:"5",height:"5",transform:"rotate(-45 4.46443 8)",fill:"#23262B",stroke:l.flag===2?"white":$W(l),strokeWidth:l.flag===2?"2px":void 0}))});function OLe(l,h){let d=l.children.map(g=>g.type==="propWithChildren"?HW(g,h):Lge(g,h)).filter(jW);return d.length===0?null:{type:"sheetObject",sheetObject:l.sheetObject,children:d}}function HW(l,h){let d=l.children.map(g=>g.type==="propWithChildren"?HW(g,h):Lge(g,h)).filter(jW);return d.length===0?null:{type:"propWithChildren",pathToProp:l.pathToProp,propConfig:l.propConf,children:d}}function Lge(l,h){let d=h.find(g=>g.track.id===l.trackId);return d?{type:"primitiveProp",keyframe:d.kf,pathToProp:l.pathToProp,propConfig:l.propConf,sheetObject:l.sheetObject,trackId:l.trackId}:null}function BLe(l){var h,d,g,_;let{cur:b}=l.utils,S=gk(l.editorProps.viewModel.type==="sheet"?null:l.editorProps.viewModel.type==="sheetObject"?(d=(h=OLe(l.editorProps.viewModel,b.keyframes))==null?void 0:h.children)!=null?d:null:(_=(g=HW(l.editorProps.viewModel,b.keyframes))==null?void 0:g.children)!=null?_:null),E=i9(l.utils.itemKey);E.useRelations(()=>b.keyframes.map(V=>({affects:V.itemKey,flag:2})),[b.keyframes.map(V=>V.track.id).join("-")]);let[N,I]=vi(null),[B]=LLe(l,I);return qS.default.createElement(qS.default.Fragment,null,qS.default.createElement(Dge,M(R(R({ref:N},E.attrs),h0.includePositionSnapAttrs(b.position)),{onClick:V=>l.editorProps.viewModel.type!=="sheet"?S.open(V,N.current):null})),qS.default.createElement(DLe,{flag:E.flag,isAllHere:b.allHere,isSelected:b.selected}),B,S.node)}function LLe(l,h){return c0(h,{displayName:"Aggregate Keyframe",menuItems:()=>{let d=l.editorProps.viewModel,g=l.editorProps.selection;return[{label:g?"Copy (selection)":"Copy",callback:()=>{if(g){let{projectId:_,sheetId:b}=d.type==="sheet"?d.sheet.address:d.sheetObject.address,S=dk(_,b,g);ge().transaction(E=>{E.stateEditors.studio.ahistoric.setClipboardKeyframes(S)})}else{let _=l.utils.cur.keyframes.flatMap(N=>{var I;return(I=EW(M(R({},N.track.sheetObject.address),{trackId:N.track.id,keyframeIds:[N.kf.id]})))!=null?I:[]}),b=d.type==="sheet"?[]:d.type==="sheetObject"?[d.sheetObject.address.objectKey]:d.type==="propWithChildren"?[d.sheetObject.address.objectKey,...d.pathToProp]:[],S=jI([b,..._.map(N=>N.pathToProp)]),E=_.map(({keyframe:N,pathToProp:I})=>({keyframe:N,pathToProp:I.slice(S.length)}));ge().transaction(N=>{N.stateEditors.studio.ahistoric.setClipboardKeyframes(E)})}}},{label:g?"Delete (selection)":"Delete",callback:()=>{g?g.delete():ge().transaction(({stateEditors:_})=>{for(let b of l.utils.cur.keyframes)_.coreByProject.historic.sheetsById.sequence.deleteKeyframes(M(R({},b.track.sheetObject.address),{keyframeIds:[b.kf.id],trackId:b.track.id}))})}}]}})}var qS,jW,ULe=C(()=>{qS=z(Le()),Ti(),s9(),u0(),FLe(),Fe(),Hv(),nf(),Ph(),vk(),jW=l=>l!==null}),Uge,XS,zge,Vge,Gge,$ge,zLe=C(()=>{Uge=Jt,XS=z(Le()),at(),kLe(),BW(),ULe(),Vge=me.div(zge||(zge=$([`
  position: absolute;
`]))),Gge=XS.default.memo(l=>{let h=Ege(l);return XS.default.createElement(Vge,{style:{top:"".concat(l.viewModel.nodeHeight/2,"px"),left:"calc(".concat((0,Uge.val)(l.layoutP.scaledSpace.leftPadding),"px + calc(var(--unitSpaceToScaledSpaceMultiplier) * ").concat(h.cur.position,"px))")}},XS.default.createElement(BLe,{editorProps:l,utils:h}),XS.default.createElement(Pge,{editorProps:l,utils:h}))}),$ge=Gge});function VLe(l){let{layoutP:h,aggregatedKeyframes:d,viewModel:g}=l,_=Zm("AggregatedKeyframeTrack"),[b,S]=vi(null),{selectedPositions:E,selection:N}=GLe(h,d),[I,B,V]=jLe(S,l,()=>_._debug("see aggregatedKeyframes",l.aggregatedKeyframes)),U=(0,Mu.useMemo)(()=>[...d.byPosition.entries()].sort((te,ae)=>te[0]-ae[0]).map(([te,ae])=>({position:te,keyframes:ae,selected:E.get(te),allHere:ae.length===d.tracks.length})),[d,E]),F=Dr(dW),H=F.mode==="snapToAll",G=F.mode==="snapToSome"?F.positions:pj,W=(0,Mu.useMemo)(()=>g.type==="sheet"?BBe(g,G):sW(g,G),[G]).map(te=>Mu.default.createElement(LS,{key:"snap-target-"+te,layoutP:h,leaf:g,position:te})),X=(0,Mu.useMemo)(()=>U.map(({position:te,keyframes:ae},oe)=>({position:te,editorProps:{index:oe,layoutP:h,viewModel:g,aggregateKeyframes:U,selection:E.has(te)?N:void 0}})),[U,g,E]);YLe(S,te=>{var ae;return(ae=X.find(oe=>oe.position===te))==null?void 0:ae.editorProps},{onClickFromDrag(te){}});let Z=X.map((te,ae)=>Mu.default.createElement(Mu.Fragment,{key:"agg-"+U[ae].keyframes[0].kf.id},H&&Mu.default.createElement(LS,{layoutP:h,leaf:g,position:te.position}),Mu.default.createElement($ge,R({},te.editorProps))));return Mu.default.createElement(qge,{ref:b,style:{background:V?"#444850 ":"unset"}},Z,W,I)}function GLe(l,h){return Rr(()=>(0,f0.val)($Le(l,h)),[l,h])}function $Le(l,h){return(0,f0.prism)(()=>{let d=(0,f0.val)(l.selectionAtom),g=(0,f0.val)(d.pointer.current);if(!g)return Xge;let _=new Map;for(let[b,S]of h.byPosition){let E=HLe(S,g);E!==void 0&&E!==Ek&&_.set(b,E)}return{selectedPositions:_,selection:(0,f0.val)(d.pointer.current)}})}function HLe(l,h){var d,g,_;let b;for(let{track:S,kf:E}of l){let N=((_=(g=(d=h.byObjectKey[S.sheetObject.address.objectKey])==null?void 0:d.byTrackId[S.id])==null?void 0:g.byKeyframeId)==null?void 0:_[E.id])===!0;b===void 0?N?b=XW:b=Ek:N?b===Ek&&(b=YW):b===XW&&(b=YW)}return b}function jLe(l,h,d){return c0(l,{onOpen:d,displayName:"Aggregate Keyframe Track",menuItems:()=>{var g;let _=(g=(0,f0.pointerToPrism)(ge().atomP.ahistoric.clipboard.keyframesWithRelativePaths).getValue())!=null?g:[];return[WLe(h,_)]}})}function WLe(l,h){return{label:"Paste Keyframes",enabled:h.length>0,callback:()=>{let d=(0,f0.val)(l.layoutP.sheet).getSequence();l.viewModel.type==="sheet"?qLe(l.viewModel,h,d):XLe(l.viewModel,h,d)}}}function qLe(l,h,d){var g;let{projectId:_,sheetId:b,sheetInstanceId:S}=l.sheet.address;if(h.every(({pathToProp:E})=>E.length===0))for(let E of l.children.map(N=>N.sheetObject)){let N=(0,f0.pointerToPrism)(ge().atomP.historic.coreByProject[_].sheetsById[b].sequence.tracksByObject[E.address.objectKey]).getValue(),I=Object.keys((g=N==null?void 0:N.trackData)!=null?g:{});WW(E.address,I,h,d)}else{let E=(0,f0.pointerToPrism)(ge().atomP.historic.coreByProject[_].sheetsById[b].sequence.tracksByObject).getValue(),N=h.map(({keyframe:I,pathToProp:B})=>{var V,U;let F=B[0],H=B.slice(1),G=tf([...H]),W=((U=(V=E==null?void 0:E[F])==null?void 0:V.trackIdByPropPath)!=null?U:{})[G];return W?{keyframe:I,trackId:W,address:{objectKey:F,projectId:_,sheetId:b,sheetInstanceId:S}}:null}).filter(I=>I!==null);Hge(N,d)}}function XLe(l,h,d){var g;let{projectId:_,sheetId:b,objectKey:S}=l.sheetObject.address,E=(0,f0.pointerToPrism)(ge().atomP.historic.coreByProject[_].sheetsById[b].sequence.tracksByObject[S]).getValue();if(h.every(({pathToProp:N})=>N.length===0)){let N=Object.keys((g=E==null?void 0:E.trackData)!=null?g:{});if(l.type==="sheetObject")WW(l.sheetObject.address,N,h,d);else{let I=(E==null?void 0:E.trackIdByPropPath)||{},B=Object.entries(I).filter(([V,U])=>U!==void 0&&CBe(WI(V),l.pathToProp)).map(([V,U])=>U);WW(l.sheetObject.address,B,h,d)}}else{let N=(E==null?void 0:E.trackIdByPropPath)||{},I=l.type==="propWithChildren"?l.pathToProp:[],B=h.map(({keyframe:V,pathToProp:U})=>{let F=tf([...I,...U]),H=N[F];return H?{keyframe:V,trackId:H,address:l.sheetObject.address}:null}).filter(V=>V!==null);Hge(B,d)}}function WW(l,h,d,g){var _;g.position=g.closestGridPosition(g.position);let b=(_=jge(d.map(({keyframe:S})=>S)))==null?void 0:_.position;ge().transaction(({stateEditors:S})=>{for(let E of h)for(let{keyframe:N}of d)S.coreByProject.historic.sheetsById.sequence.setKeyframeAtPosition(M(R({},l),{trackId:E,position:g.position+N.position-b,handles:N.handles,value:N.value,snappingFunction:g.closestGridPosition,type:N.type}))})}function Hge(l,h){var d;h.position=h.closestGridPosition(h.position);let g=(d=jge(l.map(({keyframe:_})=>_)))==null?void 0:d.position;ge().transaction(({stateEditors:_})=>{for(let{keyframe:b,trackId:S,address:E}of l)_.coreByProject.historic.sheetsById.sequence.setKeyframeAtPosition(M(R({},E),{trackId:S,position:h.position+b.position-g,handles:b.handles,value:b.value,snappingFunction:h.closestGridPosition,type:b.type}))})}function jge(l){let h=null;for(let d of l)(h===null||d.position<h.position)&&(h=d);return h}function YLe(l,h,d){let g=Zm("useDragForAggregateKeyframeDot"),_=C1e(),b=(0,Mu.useMemo)(()=>({debugName:"AggregateKeyframeDot/useDragKeyframe",onDragStart(E){g._debug("onDragStart",{target:E.target});let N=Number(E.target.dataset.pos),I=h(N);if(!I)return g._debug("no props found for ",{positionToFind:N}),!1;_(!0,N);let B=(0,f0.prism)(Mge(I)).getValue().cur.keyframes,V=I.viewModel.type==="sheet"?I.viewModel.sheet.address:I.viewModel.sheetObject.address,U=(0,f0.val)(ge().atomP.historic.coreByProject[V.projectId].sheetsById[V.sheetId].sequence.tracksByObject),F=F1e(U,function(X,{trackId:Z,objectKey:te}){var ae,oe;return B.every(ue=>X.id!==ue.kf.id)&&!(I.selection&&(oe=(ae=I.selection.byObjectKey[te])==null?void 0:ae.byTrackId[Z])!=null&&oe.byKeyframeId[X.id])});if(D1e(F),I.selection&&I.aggregateKeyframes[I.index].selected===0){let{selection:X,viewModel:Z}=I,te=X.getDragHandlers(M(R({},V),{domNode:l,positionAtStartOfDrag:B[0].kf.position})).onDragStart(E);return te&&M(R({},te),{onClick:d.onClickFromDrag,onDragEnd:(...ae)=>{var oe;(oe=te.onDragEnd)==null||oe.call(te,...ae),h9()}})}let H=I,G=(0,f0.val)(H.layoutP.scaledSpace.toUnitSpace),W;return{onDrag(X,Z,te){var ae;let oe=Math.max((ae=h0.checkIfMouseEventSnapToPos(te,{}))!=null?ae:B[0].kf.position+G(X),0);_(!0,oe),W==null||W.discard(),W=void 0,W=ge().tempTransaction(({stateEditors:ue})=>{for(let Ee of B){let Ie=Ee.kf;ue.coreByProject.historic.sheetsById.sequence.replaceKeyframes(M(R({},Ee.track.sheetObject.address),{trackId:Ee.track.id,keyframes:[M(R({},Ie),{position:oe})],snappingFunction:(0,f0.val)(H.layoutP.sheet).getSequence().closestGridPosition}))}})},onDragEnd(X){_(!1,-1),X?W==null||W.commit():(W==null||W.discard(),d.onClickFromDrag(E)),h9()},onClick(X){d.onClickFromDrag(X)}}}}),[h,d.onClickFromDrag]),[S]=eo(l,b);return bu(S,"draggingPositionInSequenceEditor","ew-resize"),[S]}var f0,Mu,Wge,qge,Xge,Yge,Tk,qW,XW,YW,Ek,KW=C(()=>{Qn(),f0=Jt,Mu=z(Le()),at(),u0(),Ti(),zLe(),Uv(),Qm(),BW(),Ph(),Yo(),nl(),Ec(),Fe(),nf(),d9(),Bue(),d9(),Uv(),qge=me.div(Wge||(Wge=$([`
  position: relative;
  height: 100%;
  width: 100%;
`]))),Xge=Object.freeze({selectedPositions:new Map,selection:void 0}),Yge=Mu.default.memo(VLe),Tk=Yge,qW=(l=>(l[l.AllSelected=0]="AllSelected",l[l.AtLeastOneUnselected=1]="AtLeastOneUnselected",l[l.NoneSelected=2]="NoneSelected",l))(qW||{}),{AllSelected:XW,AtLeastOneUnselected:YW,NoneSelected:Ek}=qW}),Wv,ZW,Kge,KLe=C(()=>{Qn(),Wv=z(Le()),ALe(),ek(),KW(),Uv(),Qm(),ZW=(l,h)=>l.type==="propWithChildren"?Wv.default.createElement(Kge,{layoutP:h,viewModel:l,key:"prop"+l.pathToProp[l.pathToProp.length-1]}):Wv.default.createElement(Tge,{layoutP:h,leaf:l,key:"prop"+l.pathToProp[l.pathToProp.length-1]}),Kge=({viewModel:l,layoutP:h})=>{let d=Zm("RightPropWithChildrenRow",l.pathToProp.join());return Rr(()=>{let g=XI(l);return Wv.default.createElement(Wae,{logger:d},Wv.default.createElement(Vv,{leaf:l,node:Wv.default.createElement(Tk,{layoutP:h,aggregatedKeyframes:g,viewModel:l}),isCollapsed:l.isCollapsed},l.children.map(_=>ZW(_,h))))},[l,h])}}),QW,Zge,Qge,ZLe=C(()=>{Qn(),QW=z(Le()),KLe(),ek(),Uv(),KW(),Zge=({leaf:l,layoutP:h})=>Rr(()=>{let d=XI(l);return QW.default.createElement(Vv,{leaf:l,node:QW.default.createElement(Tk,{layoutP:h,aggregatedKeyframes:d,viewModel:l}),isCollapsed:l.isCollapsed},l.children.map(g=>ZW(g,h)))},[l,h]),Qge=Zge}),Mk,Jge,e2e,QLe=C(()=>{Qn(),Mk=z(Le()),ZLe(),ek(),Uv(),KW(),Jge=({leaf:l,layoutP:h})=>Rr(()=>{let d=XI(l);return Mk.default.createElement(Vv,{leaf:l,node:Mk.default.createElement(Tk,{layoutP:h,aggregatedKeyframes:d,viewModel:l}),isCollapsed:l.isCollapsed},l.children.map(g=>Mk.default.createElement(Qge,{layoutP:h,key:"sheetObject-"+g.sheetObject.address.objectKey,leaf:g})))},[l,h]),e2e=Jge}),YS,v9,Ck,t2e,n2e,r2e,i2e,s2e=C(()=>{Qn(),YS=Jt,v9=z(Le()),at(),zBe(),W1e(),QLe(),Ck=1e6,n2e=me.ul(t2e||(t2e=$([`
  margin: 0;
  padding: 0;
  list-style: none;
  position: absolute;
  left: 0;
  width: `,`px;
`])),Ck),r2e=({layoutP:l})=>Rr(()=>{let h=(0,YS.val)(l.tree),d=(0,YS.val)(l.tree.top)+Math.max((0,YS.val)(l.tree.heightIncludingChildren),(0,YS.val)(l.dopeSheetDims.height));return v9.default.createElement(v9.default.Fragment,null,v9.default.createElement(pW,{layoutP:l,height:d},v9.default.createElement(p1e,{layoutP:l,height:d},v9.default.createElement(n2e,{style:{top:h.top+"px"}},v9.default.createElement(e2e,{leaf:h,layoutP:l})))))},[l]),i2e=r2e});function JW(l,h,d,g){let _="calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(l,"px)"),b="calc((var(--graphEditorVerticalSpace) - var(--graphEditorVerticalSpace) * ".concat(h,") * 1px)");d===0&&(d=1e-4);let S="calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(d,")");g===0&&(g=.001);let E="calc(var(--graphEditorVerticalSpace) * ".concat(g*-1,")");return"translate(".concat(_,", ").concat(b,") scale(").concat(S,", ").concat(E,")")}function JLe(l,h){let{index:d,trackData:g}=h,_=g.keyframes[d],b=g.keyframes[d+1];return c0(l,{menuItems:()=>[{label:"Delete",callback:()=>{ge().transaction(({stateEditors:S})=>{let{deleteKeyframes:E}=S.coreByProject.historic.sheetsById.sequence;E(M(R({},h.sheetObject.address),{trackId:h.trackId,keyframeIds:[_.id,b.id]}))})}}]})}var Ak,o2e,a2e,l2e,c2e,u2e,eq=C(()=>{eg(),Fe(),u0(),Ti(),Ak=z(Le()),at(),a2e=me.path(o2e||(o2e=$([`
  stroke-width: 2;
  stroke: var(--main-color);
  fill: none;
  vector-effect: non-scaling-stroke;
`]))),l2e="M 0 0 L 1 0 L 1 1",c2e=l=>{let{index:h,trackData:d}=l,g=d.keyframes[h],_=d.keyframes[h+1],b=_.position-g.position,[S,E]=vi(null),[N]=JLe(E,l),I=l.isScalar?uI(g.value,l.propConfig):0,B=l.isScalar?uI(_.value,l.propConfig):1,V=l.extremumSpace.fromValueSpace(I),U=l.extremumSpace.fromValueSpace(B)-V,F=JW(g.position,V,b,U),H=g.handles[2],G=g.handles[3],W=_.handles[0],X=_.handles[1],Z="M 0 0 C ".concat(H," ").concat(G," ").concat(W," ").concat(X," 1 1");return Ak.default.createElement(Ak.default.Fragment,null,Ak.default.createElement(a2e,{ref:S,d:!g.type||g.type==="bezier"?Z:l2e,style:{transform:F}}),N)},u2e=c2e});function eUe(l,h){let d=(0,_9.useRef)(h);d.current=h;let g=(0,_9.useMemo)(()=>({debugName:"CurveHandler/useOurDrags",lockCSSCursorTo:"move",onDragStart(){let _,b=d.current,S=(0,KS.val)(b.layoutP.scaledSpace.toUnitSpace),E=(0,KS.val)(b.layoutP.graphEditorVerticalSpace.toExtremumSpace),N=b.extremumSpace.lock();return{onDrag(I,B){_&&(_.discard(),_=void 0);let{index:V,trackData:U}=b,F=U.keyframes[V],H=U.keyframes[V+1],G=S(I)/(H.position-F.position),W=-B,X=E(W),Z=b.extremumSpace.deltaToValueSpace(X),te=h.isScalar?F.value:0,ae=h.isScalar?H.value:1,oe=Z/(ae-te);if(b.which==="left"){let ue=Ss(F.handles[2]+G,0,1),Ee=F.handles[3]+oe;_=ge().tempTransaction(({stateEditors:Ie})=>{Ie.coreByProject.historic.sheetsById.sequence.replaceKeyframes(M(R({},b.sheetObject.address),{snappingFunction:(0,KS.val)(b.layoutP.sheet).getSequence().closestGridPosition,trackId:b.trackId,keyframes:[M(R({},F),{handles:[F.handles[0],F.handles[1],ue,Ee]})]}))})}else{let ue=Ss(H.handles[0]+G,0,1),Ee=H.handles[1]+oe;_=ge().tempTransaction(({stateEditors:Ie})=>{Ie.coreByProject.historic.sheetsById.sequence.replaceKeyframes(M(R({},b.sheetObject.address),{trackId:b.trackId,snappingFunction:(0,KS.val)(b.layoutP.sheet).getSequence().closestGridPosition,keyframes:[M(R({},H),{handles:[ue,Ee,H.handles[2],H.handles[3]]})]}))})}},onDragEnd(I){N(),I?_&&_.commit():_&&_.discard()}}}}),[]);eo(l,g)}function tUe(l,h){return c0(l,{menuItems:()=>[{label:"Delete",callback:()=>{ge().transaction(({stateEditors:d})=>{d.coreByProject.historic.sheetsById.sequence.deleteKeyframes(M(R({},h.sheetObject.address),{keyframeIds:[h.keyframe.id],trackId:h.trackId}))})}}]})}var KS,_9,h2e,tq,d2e,f2e,p2e,m2e,g2e,nq,nUe=C(()=>{Fe(),u0(),Yo(),Ti(),KS=Jt,bo(),_9=z(Le()),at(),eq(),Ei(),tq=me.circle(h2e||(h2e=$([`
  stroke-width: 1px;
  vector-effect: non-scaling-stroke;
  fill: var(--main-color);
  r: 2px;
  pointer-events: none;
`]))),f2e=me.circle(d2e||(d2e=$([`
  stroke-width: 6px;
  vector-effect: non-scaling-stroke;
  r: 6px;
  fill: transparent;
  cursor: move;
  `,`;
  &:hover {
  }
  &:hover + `,` {
    r: 6px;
  }
`])),Si,tq),m2e=me.path(p2e||(p2e=$([`
  stroke-width: 1;
  stroke: var(--main-color);
  /* stroke: gray; */
  fill: none;
  vector-effect: non-scaling-stroke;
`]))),g2e=l=>{let[h,d]=vi(null),{index:g,trackData:_}=l,b=_.keyframes[g],S=_.keyframes[g+1],[E]=tUe(d,l);eUe(d,l);let N=l.which==="left"?b.handles[2]:S.handles[0],I=b.position+(S.position-b.position)*N,B=l.which==="left"?b.handles[3]:S.handles[1],V=l.isScalar?b.value:0,U=l.isScalar?S.value:1,F=V+(U-V)*B,H=l.extremumSpace.fromValueSpace(F),G=H-l.extremumSpace.fromValueSpace(l.which==="left"?V:U),W=JW(l.which==="left"?b.position:S.position,l.extremumSpace.fromValueSpace(l.which==="left"?V:U),I-(l.which==="left"?b.position:S.position),G);return _9.default.createElement("g",null,_9.default.createElement(f2e,{ref:h,style:{cx:"calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(I," * 1px)"),cy:"calc((var(--graphEditorVerticalSpace) - var(--graphEditorVerticalSpace) * ".concat(H,") * 1px)")}}),_9.default.createElement(tq,{style:{cx:"calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(I," * 1px)"),cy:"calc((var(--graphEditorVerticalSpace) - var(--graphEditorVerticalSpace) * ".concat(H,") * 1px)")}}),_9.default.createElement(m2e,{d:"M 0 0 L 1 1",style:{transform:W}}),E)},nq=g2e});function rUe(l){let[h,d]=(0,dg.useState)(!1);Up(h,l.props.keyframe.position);let g=(0,dg.useRef)(l.props);g.current=l.props;let _=(0,dg.useMemo)(()=>({debugName:"GraphEditorDotScalar/useDragKeyframe",lockCSSCursorTo:"move",onDragStart(b){d(!0);let S=!!b.altKey,E=g.current,N=(0,Rk.val)(E.layoutP.scaledSpace.toUnitSpace),I=(0,Rk.val)(E.layoutP.graphEditorVerticalSpace.toExtremumSpace),B=E.extremumSpace.lock(),V;return{onDrag(U,F){let H=E.trackData.keyframes[E.index],G=N(U),W=-F,X=I(W),Z=E.extremumSpace.deltaToValueSpace(X),te=[],ae=M(R({},H),{position:H.position+G,value:H.value+Z,handles:[...H.handles]});if(te.push(ae),S){let oe=E.trackData.keyframes[E.index-1];if(oe&&Math.abs(H.value-oe.value)>0){let Ee=M(R({},oe),{handles:[...oe.handles]});te.push(Ee),Ee.handles[3]=sUe(oe.handles[3],oe.value,oe.value,H.value,ae.value)}let ue=E.trackData.keyframes[E.index+1];if(ue&&Math.abs(H.value-ue.value)>0){let Ee=M(R({},ue),{handles:[...ue.handles]});te.push(Ee),Ee.handles[1]=oUe(Ee.handles[1],Ee.value,Ee.value,H.value,ae.value)}}V==null||V.discard(),V=ge().tempTransaction(({stateEditors:oe})=>{oe.coreByProject.historic.sheetsById.sequence.replaceKeyframes(M(R({},E.sheetObject.address),{trackId:E.trackId,keyframes:te,snappingFunction:(0,Rk.val)(E.layoutP.sheet).getSequence().closestGridPosition}))})},onDragEnd(U){d(!1),B(),U?V==null||V.commit():(V==null||V.discard(),l.onDetectedClick(b))}}}}),[]);return eo(l.node,_),bu(h,"draggingPositionInSequenceEditor","move"),h}function iUe(l,h){return c0(l,{menuItems:()=>[{label:"Delete",callback:()=>{ge().transaction(({stateEditors:d})=>{d.coreByProject.historic.sheetsById.sequence.deleteKeyframes(M(R({},h.sheetObject.address),{keyframeIds:[h.keyframe.id],trackId:h.trackId}))})}}]})}function sUe(l,h,d,g,_){return(g-h)*l/(_-d)}function oUe(l,h,d,g,_){return((h-g)*l+g-h+d-_)/(d-_)}var Rk,dg,y2e,rq,v2e,_2e,x2e,b2e,aUe=C(()=>{Fe(),u0(),Yo(),Ti(),Rk=Jt,dg=z(Le()),at(),nl(),nl(),Ei(),Ec(),Ph(),vk(),s9(),rq=me.circle(y2e||(y2e=$([`
  fill: var(--main-color);
  stroke-width: 1px;
  vector-effect: non-scaling-stroke;

  r: 2px;
`]))),_2e=me.circle(v2e||(v2e=$([`
  stroke-width: 6px;
  vector-effect: non-scaling-stroke;
  r: 6px;
  fill: transparent;
  `,`;

  &:hover + `,` {
    r: 6px;
  }

  #pointer-root.normal & {
    cursor: move;
  }

  #pointer-root.draggingPositionInSequenceEditor & {
    pointer-events: auto;
    cursor: var(`,`);
  }

  &.beingDragged {
    pointer-events: none !important;
  }
`])),Si,rq,Pp),x2e=l=>{let[h,d]=vi(null),{index:g,trackData:_}=l,b=_.keyframes[g],[S]=iUe(d,l),E=i9(l.itemKey),N=b.value,I=l.extremumSpace.fromValueSpace(N),B=gk([{type:"primitiveProp",keyframe:l.keyframe,pathToProp:l.pathToProp,propConfig:l.propConfig,sheetObject:l.sheetObject,trackId:l.trackId}]),V=rUe({node:d,props:l,onDetectedClick:U=>B.toggle(U,U.target instanceof Element?U.target:d)});return dg.default.createElement(dg.default.Fragment,null,dg.default.createElement(_2e,M(R(R(R({ref:h,style:{cx:"calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(b.position," * 1px)"),cy:"calc((var(--graphEditorVerticalSpace) - var(--graphEditorVerticalSpace) * ".concat(I,") * 1px)")}},rf(b.position)),h0.includePositionSnapAttrs(b.position)),E.attrs),{className:V?"beingDragged":""})),dg.default.createElement(rq,{style:{cx:"calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(b.position," * 1px)"),cy:"calc((var(--graphEditorVerticalSpace) - var(--graphEditorVerticalSpace) * ".concat(I,") * 1px)"),fill:E.flag===2?"white":void 0}}),B.node,S)},b2e=x2e});function lUe(l){let[h,d]=(0,fg.useState)(!1);Up(h,l.props.keyframe.position);let g=(0,fg.useRef)(l.props);g.current=l.props;let _=(0,fg.useMemo)(()=>({debugName:"GraphEditorDotNonScalar/useDragKeyframe",lockCSSCursorTo:"ew-resize",onDragStart(b){d(!0);let S=g.current,E=(0,iq.val)(S.layoutP.scaledSpace.toUnitSpace),N=S.extremumSpace.lock(),I;return{onDrag(B,V){let U=S.trackData.keyframes[S.index],F=E(B),H=[],G=M(R({},U),{position:U.position+F,value:U.value,handles:[...U.handles]});H.push(G),I==null||I.discard(),I=ge().tempTransaction(({stateEditors:W})=>{W.coreByProject.historic.sheetsById.sequence.replaceKeyframes(M(R({},S.sheetObject.address),{trackId:S.trackId,keyframes:H,snappingFunction:(0,iq.val)(S.layoutP.sheet).getSequence().closestGridPosition}))})},onDragEnd(B){d(!1),N(),B?I==null||I.commit():(I==null||I.discard(),l.onDetectedClick(b))}}}}),[]);return eo(l.node,_),bu(h,"draggingPositionInSequenceEditor","ew-resize"),h}function cUe(l,h){return c0(l,{menuItems:()=>[{label:"Delete",callback:()=>{ge().transaction(({stateEditors:d})=>{d.coreByProject.historic.sheetsById.sequence.deleteKeyframes(M(R({},h.sheetObject.address),{keyframeIds:[h.keyframe.id],trackId:h.trackId}))})}}]})}var iq,fg,S2e,sq,w2e,T2e,E2e,oq,uUe=C(()=>{Fe(),u0(),Yo(),Ti(),iq=Jt,fg=z(Le()),at(),nl(),nl(),Ei(),Ec(),Ph(),vk(),s9(),sq=me.circle(S2e||(S2e=$([`
  fill: var(--main-color);
  stroke-width: 1px;
  vector-effect: non-scaling-stroke;

  r: 2px;
`]))),T2e=me.circle(w2e||(w2e=$([`
  stroke-width: 6px;
  vector-effect: non-scaling-stroke;
  r: 6px;
  fill: transparent;
  `,`;

  &:hover + `,` {
    r: 6px;
  }

  #pointer-root.normal & {
    cursor: ew-resize;
  }

  #pointer-root.draggingPositionInSequenceEditor & {
    pointer-events: auto;
    cursor: var(`,`);
  }

  &.beingDragged {
    pointer-events: none !important;
  }
`])),Si,sq,Pp),E2e=l=>{let[h,d]=vi(null),{index:g,trackData:_,itemKey:b}=l,S=_.keyframes[g],[E]=cUe(d,l),N=i9(b),I=l.which==="left"?0:1,B=gk([{type:"primitiveProp",keyframe:l.keyframe,pathToProp:l.pathToProp,propConfig:l.propConfig,sheetObject:l.sheetObject,trackId:l.trackId}]),V=lUe({node:d,props:l,onDetectedClick:F=>B.toggle(F,F.target instanceof Element?F.target:d)}),U=l.extremumSpace.fromValueSpace(I);return fg.default.createElement(fg.default.Fragment,null,fg.default.createElement(T2e,M(R(R(R({ref:h,style:{cx:"calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(S.position," * 1px)"),cy:"calc((var(--graphEditorVerticalSpace) - var(--graphEditorVerticalSpace) * ".concat(U,") * 1px)")}},N.attrs),rf(S.position)),h0.includePositionSnapAttrs(S.position)),{className:V?"beingDragged":""})),fg.default.createElement(sq,{style:{cx:"calc(var(--unitSpaceToScaledSpaceMultiplier) * ".concat(S.position," * 1px)"),cy:"calc((var(--graphEditorVerticalSpace) - var(--graphEditorVerticalSpace) * ".concat(U,") * 1px)"),fill:N.flag===2?"white":void 0}}),B.node,E)},oq=E2e}),Pk,M2e,C2e,A2e,R2e,hUe=C(()=>{Pk=z(Le()),at(),eq(),C2e=me.path(M2e||(M2e=$([`
  stroke-width: 2;
  stroke: var(--main-color);
  stroke-dasharray: 3 2;
  fill: none;
  vector-effect: non-scaling-stroke;
  opacity: 0.3;
`]))),A2e=l=>{let{index:h,trackData:d}=l,g="M 0 0 L 1 1",_=JW(d.keyframes[h].position,l.extremumSpace.fromValueSpace(0),0,l.extremumSpace.fromValueSpace(1)-l.extremumSpace.fromValueSpace(0));return Pk.default.createElement(Pk.default.Fragment,null,Pk.default.createElement(C2e,{d:g,style:{transform:_}}))},R2e=A2e}),il,P2e,N2e,I2e,k2e,D2e,dUe=C(()=>{il=z(Le()),at(),eq(),nUe(),aUe(),uUe(),hUe(),N2e=me.g(P2e||(P2e=$([`
  /* position: absolute; */
`]))),I2e=il.default.createElement(il.default.Fragment,null),k2e=l=>{let{index:h,trackData:d,isScalar:g}=l,_=d.keyframes[h],b=d.keyframes[h+1],S=_.connectedRight&&!!b&&b.value!==_.value;return il.default.createElement(N2e,null,S?il.default.createElement(il.default.Fragment,null,il.default.createElement(u2e,R({},l)),!_.type||_.type==="bezier"&&il.default.createElement(il.default.Fragment,null,il.default.createElement(nq,M(R({},l),{which:"left"})),il.default.createElement(nq,M(R({},l),{which:"right"})))):I2e,g?il.default.createElement(b2e,R({},l)):il.default.createElement(il.default.Fragment,null,il.default.createElement(oq,M(R({},l),{which:"left"})),il.default.createElement(oq,M(R({},l),{which:"right"})),il.default.createElement(R2e,R({},l))))},D2e=k2e});function fUe(l,h){let d=1/0,g=-1/0;function _(b){d=Math.min(b,d),g=Math.max(b,g)}return l.forEach((b,S)=>{let E=uI(b.value,h);if(_(E),!b.connectedRight)return;let N=l[S+1];if(!N)return;let I=(typeof N.value=="number"?N.value:1)-E;_(E+b.handles[3]*I),_(E+N.handles[1]*I)}),[d,g]}function pUe(l){let h=0,d=1;function g(_){h=Math.min(_,h),d=Math.max(_,d)}return l.forEach((_,b)=>{if(!_.connectedRight)return;let S=l[b+1];S&&(g(_.handles[3]),g(S.handles[1]))}),[h,d]}var of,F2e,O2e,mUe=C(()=>{Fp(),of=z(Le()),Ik(),dUe(),eg(),Qn(),F2e=of.default.memo(({layoutP:l,trackData:h,sheetObject:d,trackId:g,color:_,pathToProp:b})=>{let S=cI(Dr(d.template.configPointer),b);if(Jd(S))return console.error("Composite prop types cannot be keyframed"),of.default.createElement(of.default.Fragment,null);let[E,N]=(0,of.useState)(!1),I=(0,of.useMemo)(()=>{let F=new Set;return function(){let H=F.size===0;F.add(G),H&&N(!0);function G(){let W=F.size>0;F.delete(G),W&&F.size===0&&N(!1)}return G}},[]),B=(0,of.useMemo)(()=>{let F=S.type==="number"?fUe(h.keyframes,S):pUe(h.keyframes),H=X=>(X-F[0])/(F[1]-F[0]),G=X=>F[0]+W(X),W=X=>X*(F[1]-F[0]);return{fromValueSpace:H,toValueSpace:G,deltaToValueSpace:W,lock:I}},[h.keyframes]),V=(0,of.useRef)(void 0);E||(V.current=B);let U=h.keyframes.map((F,H)=>of.default.createElement(D2e,{pathToProp:b,propConfig:S,itemKey:ya.forTrackKeyframe(d,g,F.id),keyframe:F,index:H,trackData:h,layoutP:l,sheetObject:d,trackId:g,isScalar:S.type==="number",key:F.id,extremumSpace:V.current,color:_}));return of.default.createElement("g",{style:{"--main-color":ZS[_].iconColor}},U)}),O2e=F2e}),B2e,Nk,L2e,U2e,gUe=C(()=>{Fe(),Qn(),B2e=Jt,Nk=z(Le()),mUe(),L2e=l=>Rr(()=>{let{sheetObject:h,trackId:d}=l,g=(0,B2e.val)(ge().atomP.historic.coreByProject[h.address.projectId].sheetsById[h.address.sheetId].sequence.tracksByObject[h.address.objectKey].trackData[d]);return(g==null?void 0:g.type)!=="BasicKeyframedTrack"?(console.error("trackData type ".concat(g==null?void 0:g.type," is not yet supported on the graph editor")),Nk.default.createElement(Nk.default.Fragment,null)):Nk.default.createElement(O2e,M(R({},l),{trackData:g}))},[l.trackId,l.layoutP]),U2e=L2e});function z2e({clippedSpaceRange:l,clippedSpaceWidth:h,fps:d,gapWidth:g=120},_){let b=1/d,S=l.end-l.start,E=h/(d*S),N=Math.floor(g/E),I=(N<d?V2e(d).find(U=>U>=N):d*Math.floor(N/d))*b,B=Math.floor(l.start/I),V=Math.ceil(l.end/I);for(let U=B;U<=V;U++){let F=U*I,H=F%1===0;_(F,H)}}var V2e,G2e=C(()=>{bo(),V2e=b5(l=>{let h=[];for(let d=1;d<=l;d++)l%d===0&&h.push(d);return h})});function yUe(l){let{clippedSpaceWidth:h,height:d,ctx:g,unitSpaceToClippedSpace:_,snapToGrid:b}=l;g.clearRect(0,0,h,d),z2e(l,(S,E)=>{let N=b(S),I=Math.floor(_(N));g.strokeStyle=E?"rgba(225, 225, 225, 0.04)":"rgba(255, 255, 255, 0.01)",g.beginPath(),g.moveTo(I,0),g.lineTo(I,d),g.stroke(),g.closePath()})}var x9,b9,$2e,H2e,j2e,W2e,q2e,X2e,Y2e,K2e,aq,Z2e=C(()=>{x9=Jt,b9=z(Le()),at(),G2e(),Fe(),H2e=me.div($2e||($2e=$([`
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  pointer-events: none;
`]))),W2e=me.canvas(j2e||(j2e=$([`
  position: relative;
  left: 0;
`]))),q2e=l=>{let h=l;return h.webkitBackingStorePixelRatio||h.mozBackingStorePixelRatio||h.msBackingStorePixelRatio||h.oBackingStorePixelRatio||h.backingStorePixelRatio||1},X2e=()=>window.devicePixelRatio||1,Y2e=l=>X2e()/q2e(l),K2e=({layoutP:l,width:h,height:d})=>{let g=(0,b9.useRef)(null),[_,b]=(0,b9.useState)(null),{ctx:S,ratio:E}=(0,b9.useMemo)(()=>{if(!_)return{};let N=_.getContext("2d"),I=Y2e(N);return{ctx:N,ratio:I}},[_]);return(0,b9.useLayoutEffect)(()=>{if(!S)return;_.width=h*E,_.height=d*E;let N=(0,x9.prism)(()=>{let I=(0,x9.val)(l.sheet).getSequence();return{ctx:S,clippedSpaceRange:(0,x9.val)(l.clippedSpace.range),clippedSpaceWidth:(0,x9.val)(l.clippedSpace.width),unitSpaceToClippedSpace:(0,x9.val)(l.clippedSpace.fromUnitSpace),height:d,leftPadding:(0,x9.val)(l.scaledSpace.leftPadding),fps:I.subUnitsPerUnit,snapToGrid:B=>I.closestGridPosition(B)}}).onChange(ge().ticker,I=>{S.save(),S.scale(E,E),yUe(I),S.restore()},!0);return()=>{N()}},[S,h,d,l]),b9.default.createElement(H2e,{ref:g,style:{width:h+"px"}},b9.default.createElement(W2e,{ref:b,style:{width:h+"px",height:d+"px"}}))},aq=K2e}),af,S9,ZS,Q2e,J2e,e3e,t3e,n3e,r3e,Ik=C(()=>{Fe(),nf(),pI(),Qn(),af=Jt,S9=z(Le()),at(),s2e(),W1e(),gUe(),Z2e(),Tc(),ZS={1:{iconColor:"#b98b08"},2:{iconColor:"#70a904"},3:{iconColor:"#2e928a"},4:{iconColor:"#a943bb"},5:{iconColor:"#b90808"},6:{iconColor:"#b4bf0e"}},J2e=me.div(Q2e||(Q2e=$([`
  position: absolute;
  right: 0;
  bottom: 0;
  background: `,`;
`])),Sh(.03,"#1a1c1e")),t3e=me.svg(e3e||(e3e=$([`
  position: absolute;
  top: 0;
  left: 0;
  margin: 0;
  pointer-events: none;
`]))),n3e=({layoutP:l})=>Rr(()=>{let h=(0,af.val)(l.sheet),d=(0,af.val)(ge().atomP.historic.projects.stateByProjectId[h.address.projectId].stateBySheetId[h.address.sheetId].sequenceEditor.selectedPropsByObject),g=(0,af.val)(l.graphEditorDims.height),_=(0,af.val)(l.scaledSpace.fromUnitSpace)(1),b=[];if(d)for(let[E,N]of Object.entries(d)){let I=h.getObject(E);if(!I)continue;let B=(0,af.val)(I.template.getMapOfValidSequenceTracks_forStudio());for(let[V,U]of Object.entries(N)){let F=WI(V),H=ng(B,F);H&&b.push(S9.default.createElement(U2e,{key:"graph-".concat(E,"-").concat(V),sheetObject:I,pathToProp:F,layoutP:l,trackId:H,color:U}))}}let S=(0,af.val)(l.rightDims.width);return S9.default.createElement(J2e,{style:{width:S+"px",height:g+"px","--unitSpaceToScaledSpaceMultiplier":_,"--graphEditorVerticalSpace":"".concat((0,af.val)(l.graphEditorVerticalSpace.space))}},S9.default.createElement(aq,{layoutP:l,width:S,height:g}),S9.default.createElement(pW,{layoutP:l,height:g},S9.default.createElement(t3e,{width:Ck,height:g,viewBox:"0 0 ".concat(Ck," ").concat(g)},S9.default.createElement("g",{style:{transform:"translate(".concat((0,af.val)(l.scaledSpace.leftPadding),"px, ").concat((0,af.val)(l.graphEditorDims.padding.top),"px)")}},b))))},[l]),r3e=n3e}),i3e,Cu,s3e,o3e,a3e,l3e,lq,c3e,u3e,h3e,d3e,f3e,p3e,m3e,vUe=C(()=>{Fe(),nf(),mI(),Qn(),i3e=Jt,Cu=z(Le()),at(),vj(),_I(),Ik(),HI(),r9(),jpe(),s3e={label:{color:"#9a9a9a"}},a3e=me(Qj)(o3e||(o3e=$([""]))),lq=me(Jj)(l3e||(l3e=$([`
  display: flex;
  color: `,`;
  padding-right: 12px;
  align-items: center;
  justify-content: flex-end;
  box-sizing: border-box;
`])),s3e.label.color),u3e=me.button(c3e||(c3e=$([`
  background: none;
  border: none;
  outline: none;
  display: flex;
  box-sizing: border-box;
  font-size: 14px;
  align-items: center;
  height: 100%;
  margin-left: 12px;
  color: `,`;

  &:not([disabled]):hover {
    color: white;
  }
`])),l=>l.isSelected?ZS[l.graphEditorColor].iconColor:rg.offColor),h3e=()=>Cu.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"12",viewBox:"0 0 640 512"},Cu.default.createElement("g",{transform:"translate(0 100)"},Cu.default.createElement("path",{fill:"currentColor",d:"M368 32h-96c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32V64c0-17.67-14.33-32-32-32zM208 88h-84.75C113.75 64.56 90.84 48 64 48 28.66 48 0 76.65 0 112s28.66 64 64 64c26.84 0 49.75-16.56 59.25-40h79.73c-55.37 32.52-95.86 87.32-109.54 152h49.4c11.3-41.61 36.77-77.21 71.04-101.56-3.7-8.08-5.88-16.99-5.88-26.44V88zm-48 232H64c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32zM576 48c-26.84 0-49.75 16.56-59.25 40H432v72c0 9.45-2.19 18.36-5.88 26.44 34.27 24.35 59.74 59.95 71.04 101.56h49.4c-13.68-64.68-54.17-119.48-109.54-152h79.73c9.5 23.44 32.41 40 59.25 40 35.34 0 64-28.65 64-64s-28.66-64-64-64zm0 272h-96c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32z"}))),f3e=me.span(d3e||(d3e=$([`
  margin-right: 4px;
  `,`;

  `,`:hover & {
    color: #ccc;
  }
`])),tg,lq),p3e=({leaf:l})=>{var h;let d=hS(l.sheetObject.propsP,l.pathToProp),g=l.sheetObject,{controlIndicators:_}=yj(d,g,l.propConf),b=Rr(()=>{let U=l.sheetObject.address,F=tf(l.pathToProp);return(0,i3e.val)(ge().atomP.historic.projects.stateByProjectId[U.projectId].stateBySheetId[U.sheetId].sequenceEditor.selectedPropsByObject[U.objectKey][F])},[l]),S=(0,Cu.useRef)(!1),E=typeof b=="string";S.current=E;let N=(0,Cu.useCallback)(()=>{let U=l.sheetObject.address;ge().transaction(({stateEditors:F})=>{S.current?F.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.removePropFromGraphEditor(M(R({},U),{pathToProp:l.pathToProp})):(F.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.addPropToGraphEditor(M(R({},U),{pathToProp:l.pathToProp})),F.studio.historic.panels.sequenceEditor.graphEditor.setIsOpen({isOpen:!0}))})},[l]),I=(h=l.propConf.label)!=null?h:l.pathToProp[l.pathToProp.length-1],B=!0,V=(0,Cu.useRef)(null);return $pe(V.current,l),Cu.default.createElement(a3e,{depth:l.depth},Cu.default.createElement(lq,{ref:V,isEven:l.n%2===0,style:{height:l.nodeHeight+"px"},isSelected:E===!0},Cu.default.createElement(f3e,null,I),_,Cu.default.createElement(u3e,{onClick:N,isSelected:E===!0,graphEditorColor:b??"1",style:{opacity:1},disabled:!B},Cu.default.createElement(h3e,null))))},m3e=p3e});function cq(l,h){ge().transaction(({stateEditors:d})=>{d.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.sequenceEditorCollapsableItems.set(M(R({},h.sheetAddress),{studioSheetItemKey:h.sheetItemKey,isCollapsed:l}))})}var uq=C(()=>{Fe()}),qv,hq,g3e,_Ue=C(()=>{qv=z(Le()),HI(),vUe(),uq(),hq=l=>{let h="prop"+l.pathToProp[l.pathToProp.length-1];return l.shouldRender?l.type==="propWithChildren"?qv.default.createElement(g3e,{leaf:l,key:h}):qv.default.createElement(m3e,{leaf:l,key:h}):qv.default.createElement(qv.default.Fragment,{key:h})},g3e=({leaf:l})=>qv.default.createElement($I,{leaf:l,label:l.pathToProp[l.pathToProp.length-1],isCollapsed:l.isCollapsed,toggleCollapsed:()=>cq(!l.isCollapsed,{sheetAddress:l.sheetObject.address,sheetItemKey:l.sheetItemKey})},l.children.map(h=>hq(h)))}),y3e,v3e,_3e,xUe=C(()=>{y3e=z(Le()),HI(),_Ue(),uq(),Fe(),v3e=({leaf:l})=>y3e.default.createElement($I,{leaf:l,label:l.sheetObject.address.objectKey,isCollapsed:l.isCollapsed,toggleSelect:()=>{ge().transaction(({stateEditors:h})=>{h.studio.historic.panels.outline.selection.set([l.sheetObject])})},toggleCollapsed:()=>cq(!l.isCollapsed,{sheetAddress:l.sheetObject.address,sheetItemKey:l.sheetItemKey})},l.children.map(h=>hq(h))),_3e=v3e}),dq,x3e,b3e,bUe=C(()=>{Qn(),dq=z(Le()),xUe(),HI(),uq(),Nhe(),x3e=({leaf:l})=>Rr(()=>dq.default.createElement($I,{leaf:l,label:l.sheet.address.sheetId,isCollapsed:l.isCollapsed,toggleCollapsed:()=>{cq(!l.isCollapsed,{sheetAddress:l.sheet.address,sheetItemKey:l.sheetItemKey})}},l.children.map(h=>dq.default.createElement(_3e,{key:"sheetObject-"+Rhe(h.sheetObject),leaf:h}))),[l]),b3e=x3e}),fq,kk,S3e,w3e,T3e,E3e,M3e,C3e,SUe=C(()=>{Qn(),fq=Jt,kk=z(Le()),at(),bUe(),w3e=me.div(S3e||(S3e=$([`
  position: absolute;
  left: 0;
  overflow-x: visible;
`]))),E3e=me.ul(T3e||(T3e=$([`
  margin: 0;
  padding: 0;
  list-style: none;
`]))),M3e=({layoutP:l})=>Rr(()=>{let h=(0,fq.val)(l.tree),d=(0,fq.val)(l.leftDims.width);return kk.default.createElement(w3e,{style:{width:d+"px",top:h.top+"px"}},kk.default.createElement(E3e,null,kk.default.createElement(b3e,{leaf:h})))},[l]),C3e=M3e}),pq,A3e,R3e,P3e,N3e,wUe=C(()=>{Ei(),jp(),Qn(),Tc(),pq=z(Le()),at(),Z2e(),R3e=me.div(A3e||(A3e=$([`
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  z-index: `,`;
  overflow: hidden;
  background: `,`;
  pointer-events: none;
`])),()=>ff.rightBackground,Sh(.01,Ub(1*.03,gv.panel.bg))),P3e=({layoutP:l})=>{let h=Dr(l.rightDims.width),d=Dr(l.panelDims.height);return pq.default.createElement(R3e,{style:{width:h+"px"}},pq.default.createElement(aq,{width:h,height:d,layoutP:l}))},N3e=P3e}),Xv,I3e,k3e,D3e,F3e,TUe=C(()=>{Qn(),Xv=z(Le()),at(),SUe(),wUe(),s2e(),x1e(),k3e=me.div(I3e||(I3e=$([`
  position: absolute;
  left: 0;
  right: 0;
`]))),D3e=({layoutP:l})=>{let h=Dr(l.dopeSheetDims.height);return Xv.default.createElement(k3e,{style:{height:h+"px"}},Xv.default.createElement(N3e,{layoutP:l}),Xv.default.createElement(_1e,null,Xv.default.createElement(C3e,{layoutP:l}),Xv.default.createElement(i2e,{layoutP:l})))},F3e=D3e});function EUe(l,h,d){return mq.prism.memo(l,()=>(0,mq.prism)(h),d).getValue()}var mq,MUe=C(()=>{mq=Jt});function Ts(l){return function(h,d){return l(h,d())}}function Cc(l){return Object.freeze({audience:w9(l,8)?"internal":w9(l,16)?"dev":"public",category:w9(l,4)?"troubleshooting":w9(l,2)?"todo":"general",level:w9(l,512)?512:w9(l,256)?256:w9(l,128)?128:64})}function w9(l,h){return(l&h)===h}function Es(l,h){return((h&32)===32?!0:(h&16)===16?l.dev:(h&8)===8?l.internal:!1)&&l.min<=h}function O3e(l=console,h={}){let d=M(R({},lf),{includes:R({},lf.includes)}),g={styled:RUe.bind(d,l),noStyle:NUe.bind(d,l)},_=AUe.bind(d);function b(){return d.loggingConsoleStyle&&d.loggerConsoleStyle?g.styled:g.noStyle}return d.create=b(),{configureLogger(S){var E;S==="console"?(d.loggerConsoleStyle=lf.loggerConsoleStyle,d.create=b()):S.type==="console"?(d.loggerConsoleStyle=(E=S.style)!=null?E:lf.loggerConsoleStyle,d.create=b()):S.type==="keyed"?(d.creatExt=N=>S.keyed(N.names),d.create=_):S.type==="named"&&(d.creatExt=CUe.bind(null,S.named),d.create=_)},configureLogging(S){var E,N,I,B,V;d.includes.dev=(E=S.dev)!=null?E:lf.includes.dev,d.includes.internal=(N=S.internal)!=null?N:lf.includes.internal,d.includes.min=(I=S.min)!=null?I:lf.includes.min,d.include=(B=S.include)!=null?B:lf.include,d.loggingConsoleStyle=(V=S.consoleStyle)!=null?V:lf.loggingConsoleStyle,d.create=b()},getLogger(){return d.create({names:[]})}}}function CUe(l,h){let d=[];for(let{name:g,key:_}of h.names)d.push(_==null?g:"".concat(g," (").concat(_,")"));return l(d)}function AUe(l){let h=R(R({},this.includes),this.include(l)),d=this.filtered,g=this.named.bind(this,l),_=this.creatExt(l),b=Es(h,524),S=Es(h,522),E=Es(h,521),N=Es(h,529),I=Es(h,545),B=Es(h,265),V=Es(h,268),U=Es(h,273),F=Es(h,289),H=Es(h,137),G=Es(h,145),W=Es(h,73),X=Es(h,81),Z=b?_.error.bind(_,W0._hmm):d.bind(l,524),te=S?_.error.bind(_,W0._todo):d.bind(l,522),ae=E?_.error.bind(_,W0._error):d.bind(l,521),oe=N?_.error.bind(_,W0.errorDev):d.bind(l,529),ue=I?_.error.bind(_,W0.errorPublic):d.bind(l,545),Ee=V?_.warn.bind(_,W0._kapow):d.bind(l,268),Ie=B?_.warn.bind(_,W0._warn):d.bind(l,265),_e=U?_.warn.bind(_,W0.warnDev):d.bind(l,273),Oe=F?_.warn.bind(_,W0.warnPublic):d.bind(l,273),ot=H?_.debug.bind(_,W0._debug):d.bind(l,137),de=G?_.debug.bind(_,W0.debugDev):d.bind(l,145),Be=W?_.trace.bind(_,W0._trace):d.bind(l,73),re=X?_.trace.bind(_,W0.traceDev):d.bind(l,81),Ye={_hmm:Z,_todo:te,_error:ae,errorDev:oe,errorPublic:ue,_kapow:Ee,_warn:Ie,warnDev:_e,warnPublic:Oe,_debug:ot,debugDev:de,_trace:Be,traceDev:re,lazy:{_hmm:b?Ts(Z):Z,_todo:S?Ts(te):te,_error:E?Ts(ae):ae,errorDev:N?Ts(oe):oe,errorPublic:I?Ts(ue):ue,_kapow:V?Ts(Ee):Ee,_warn:B?Ts(Ie):Ie,warnDev:U?Ts(_e):_e,warnPublic:F?Ts(Oe):Oe,_debug:H?Ts(ot):ot,debugDev:G?Ts(de):de,_trace:W?Ts(Be):Be,traceDev:X?Ts(re):re},named:g,utilFor:{internal(){return{debug:Ye._debug,error:Ye._error,warn:Ye._warn,trace:Ye._trace,named(nn,ke){return Ye.named(nn,ke).utilFor.internal()}}},dev(){return{debug:Ye.debugDev,error:Ye.errorDev,warn:Ye.warnDev,trace:Ye.traceDev,named(nn,ke){return Ye.named(nn,ke).utilFor.dev()}}},public(){return{error:Ye.errorPublic,warn:Ye.warnPublic,debug(nn,ke){Ye._warn('(public "debug" filtered out) '.concat(nn),ke)},trace(nn,ke){Ye._warn('(public "trace" filtered out) '.concat(nn),ke)},named(nn,ke){return Ye.named(nn,ke).utilFor.public()}}}}};return Ye}function RUe(l,h){let d=R(R({},this.includes),this.include(h)),g=[],_="";for(let N=0;N<h.names.length;N++){let{name:I,key:B}=h.names[N];if(_+=" %c".concat(I),g.push(this.style.css(I)),B!=null){let V="%c#".concat(B);_+=V,g.push(this.style.css(V))}}let b=this.filtered,S=this.named.bind(this,h),E=[_,...g];return B3e(b,h,d,l,E,PUe(E),S)}function PUe(l){let h=l.slice(0);for(let d=1;d<h.length;d++)h[d]+=";background-color:#e0005a;padding:2px;color:white";return h}function NUe(l,h){let d=R(R({},this.includes),this.include(h)),g="";for(let E=0;E<h.names.length;E++){let{name:N,key:I}=h.names[E];g+=" ".concat(N),I!=null&&(g+="#".concat(I))}let _=this.filtered,b=this.named.bind(this,h),S=[g];return B3e(_,h,d,l,S,S,b)}function B3e(l,h,d,g,_,b,S){let E=Es(d,524),N=Es(d,522),I=Es(d,521),B=Es(d,529),V=Es(d,545),U=Es(d,265),F=Es(d,268),H=Es(d,273),G=Es(d,289),W=Es(d,137),X=Es(d,145),Z=Es(d,73),te=Es(d,81),ae=E?g.error.bind(g,..._):l.bind(h,524),oe=N?g.error.bind(g,..._):l.bind(h,522),ue=I?g.error.bind(g,..._):l.bind(h,521),Ee=B?g.error.bind(g,..._):l.bind(h,529),Ie=V?g.error.bind(g,..._):l.bind(h,545),_e=F?g.warn.bind(g,...b):l.bind(h,268),Oe=U?g.warn.bind(g,..._):l.bind(h,265),ot=H?g.warn.bind(g,..._):l.bind(h,273),de=G?g.warn.bind(g,..._):l.bind(h,273),Be=W?g.info.bind(g,..._):l.bind(h,137),re=X?g.info.bind(g,..._):l.bind(h,145),Ye=Z?g.debug.bind(g,..._):l.bind(h,73),nn=te?g.debug.bind(g,..._):l.bind(h,81),ke={_hmm:ae,_todo:oe,_error:ue,errorDev:Ee,errorPublic:Ie,_kapow:_e,_warn:Oe,warnDev:ot,warnPublic:de,_debug:Be,debugDev:re,_trace:Ye,traceDev:nn,lazy:{_hmm:E?Ts(ae):ae,_todo:N?Ts(oe):oe,_error:I?Ts(ue):ue,errorDev:B?Ts(Ee):Ee,errorPublic:V?Ts(Ie):Ie,_kapow:F?Ts(_e):_e,_warn:U?Ts(Oe):Oe,warnDev:H?Ts(ot):ot,warnPublic:G?Ts(de):de,_debug:W?Ts(Be):Be,debugDev:X?Ts(re):re,_trace:Z?Ts(Ye):Ye,traceDev:te?Ts(nn):nn},named:S,utilFor:{internal(){return{debug:ke._debug,error:ke._error,warn:ke._warn,trace:ke._trace,named(Re,Ze){return ke.named(Re,Ze).utilFor.internal()}}},dev(){return{debug:ke.debugDev,error:ke.errorDev,warn:ke.warnDev,trace:ke.traceDev,named(Re,Ze){return ke.named(Re,Ze).utilFor.dev()}}},public(){return{error:ke.errorPublic,warn:ke.warnPublic,debug(Re,Ze){ke._warn('(public "debug" filtered out) '.concat(Re),Ze)},trace(Re,Ze){ke._warn('(public "trace" filtered out) '.concat(Re),Ze)},named(Re,Ze){return ke.named(Re,Ze).utilFor.public()}}}}};return ke}var W0,lf,L3e=C(()=>{W0={_hmm:Cc(524),_todo:Cc(522),_error:Cc(521),errorDev:Cc(529),errorPublic:Cc(545),_kapow:Cc(268),_warn:Cc(265),warnDev:Cc(273),warnPublic:Cc(289),_debug:Cc(137),debugDev:Cc(145),_trace:Cc(73),traceDev:Cc(81)},lf={loggingConsoleStyle:!0,loggerConsoleStyle:!0,includes:Object.freeze({internal:!1,dev:!1,min:256}),filtered:function(){},include:function(){return{}},create:null,creatExt:null,named(l,h,d){return this.create({names:[...l.names,{name:h,key:d}]})},style:{bold:void 0,italic:void 0,cssMemo:new Map([["",""]]),collapseOnRE:/[a-z- ]+/g,color:void 0,collapsed(l){if(l.length<5)return l;let h=l.replace(this.collapseOnRE,"");return this.cssMemo.has(h)||this.cssMemo.set(h,this.css(l)),h},css(l){var h,d,g,_;let b=this.cssMemo.get(l);if(b)return b;let S="color:".concat((d=(h=this.color)==null?void 0:h.call(this,l))!=null?d:"hsl(".concat((l.charCodeAt(0)+l.charCodeAt(l.length-1))%360,", 100%, 60%)"));return(g=this.bold)!=null&&g.test(l)&&(S+=";font-weight:600"),(_=this.italic)!=null&&_.test(l)&&(S+=";font-style:italic"),this.cssMemo.set(l,S),S}}}}),gq,Dk,Fk=C(()=>{L3e(),L3e(),gq=O3e(console,{_debug:function(){},_error:function(){}}),gq.configureLogging({dev:!0,min:64}),Dk=gq.getLogger().named("Theatre.js (default logger)").utilFor.dev()}),pg,T9,U3e,IUe=C(()=>{Fp(),pg=Jt,Fk(),Ap(),T9=28,U3e=(l,h)=>{var d;pg.prism.ensurePrism();let g=!0,_=FN+T9,b=0,S=h.atomP.ahistoric.projects.stateByProjectId[l.address.projectId].stateBySheetId[l.address.sheetId].sequence.collapsableItems,E=S.byId[ya.forSheet()].isCollapsed,N=(d=(0,pg.pointerToPrism)(E).getValue())!=null?d:!1,I={type:"sheet",isCollapsed:N,sheet:l,children:[],sheetItemKey:ya.forSheet(),shouldRender:g,top:FN,depth:0,n:b,nodeHeight:g?T9:0,heightIncludingChildren:-1};b+=1;for(let G of Object.values((0,pg.val)(l.objectsP)))G&&B(G,I.children,I.depth+1,!N);I.heightIncludingChildren=_-I.top;function B(G,W,X,Z){var te;let ae=(0,pg.val)(G.template.getMapOfValidSequenceTracks_forStudio()),oe=(0,pg.val)(G.template.configPointer);if(Object.keys(ae).length===0)return;let ue=S.byId[ya.forSheetObject(G)].isCollapsed,Ee=(te=(0,pg.pointerToPrism)(ue).getValue())!=null?te:!1,Ie={type:"sheetObject",isCollapsed:Ee,sheetItemKey:ya.forSheetObject(G),shouldRender:Z,top:_,children:[],depth:X,n:b,sheetObject:G,nodeHeight:Z?T9:0,heightIncludingChildren:-1};W.push(Ie),Z&&(b+=1,_+=Ie.nodeHeight),V(G,ae,[],oe,Ie.children,X+1,Z&&!Ee),Ie.heightIncludingChildren=_-Ie.top}function V(G,W,X,Z,te,ae,oe){for(let[ue,Ee]of Object.entries(W)){let Ie=Z.props[ue];U(G,Ee,[...X,ue],Ie,te,ae,oe)}}function U(G,W,X,Z,te,ae,oe){Z.type==="compound"?F(G,W,Z,X,Z,te,ae,oe):Z.type==="enum"?Dk.warn("Prop type enum is not yet supported in the sequence editor"):H(G,W,X,Z,te,ae,oe)}function F(G,W,X,Z,te,ae,oe,ue){var Ee;let Ie=S.byId[ya.forSheetObjectProp(G,Z)].isCollapsed,_e=(Ee=(0,pg.pointerToPrism)(Ie).getValue())!=null?Ee:!1,Oe={type:"propWithChildren",isCollapsed:_e,propConf:X,pathToProp:Z,sheetItemKey:ya.forSheetObjectProp(G,Z),sheetObject:G,shouldRender:ue,top:_,children:[],nodeHeight:ue?T9:0,heightIncludingChildren:-1,depth:oe,trackMapping:W,n:b};ae.push(Oe),ue&&(_+=Oe.nodeHeight,b+=1),V(G,W,Z,te,Oe.children,oe+1,ue&&!_e),Oe.heightIncludingChildren=_-Oe.top}function H(G,W,X,Z,te,ae,oe){let ue={type:"primitiveProp",propConf:Z,depth:ae,sheetItemKey:ya.forSheetObjectProp(G,X),sheetObject:G,pathToProp:X,shouldRender:oe,top:_,nodeHeight:oe?T9:0,heightIncludingChildren:oe?T9:0,trackId:W,n:b};te.push(ue),b+=1,_+=ue.nodeHeight}return I}});function kUe(l,h){let d=ge(),g=d.atomP.ahistoric.projects.stateByProjectId[l.address.projectId].stateBySheetId[l.address.sheetId],_=d.atomP.historic.projects.stateByProjectId[l.address.projectId].stateBySheetId[l.address.sheetId];return(0,q0.prism)(()=>{var b;let S=EUe("tree",()=>U3e(l,d),[]),E=(0,q0.val)(h),N=(0,q0.val)(d.atomP.historic.panels.sequenceEditor.graphEditor),I=(0,q0.val)(_.sequenceEditor.selectedPropsByObject),B=!!I&&Object.keys(I).length>0,{leftDims:V,rightDims:U,graphEditorDims:F,dopeSheetDims:H,horizontalScrollbarDims:G}=q0.prism.memo("leftDims",()=>{var Oe;let ot={width:Math.floor(E.width*z3e),height:E.height,screenX:E.screenX,screenY:E.screenY},de={width:E.width-ot.width,height:E.height,screenX:E.screenX+ot.width,screenY:E.screenY},Be=B&&(N==null?void 0:N.isOpen)===!0,re=Math.floor((Be?Ss((Oe=N==null?void 0:N.height)!=null?Oe:.5,.1,.7):0)*E.heightWithoutBorder),Ye=0+re,nn=E.height-Ye,ke={width:E.width,height:nn,screenX:E.screenX,screenY:E.screenY},Re={isAvailable:B,isOpen:Be,width:de.width,height:re,screenX:E.screenX,screenY:E.screenY+nn,padding:{top:20,bottom:20}};return{leftDims:ot,rightDims:de,graphEditorDims:Re,dopeSheetDims:ke,horizontalScrollbarDims:{bottom:0}}},[E,N,B]),W=q0.prism.memo("graphEditorVerticalSpace",()=>{let Oe=F.height-F.padding.top-F.padding.bottom;return{space:Oe,fromExtremumSpace(ot){return ot*Oe},toExtremumSpace(ot){return ot/Oe}}},[F]),[X,Z]=q0.prism.state("isSeeking",!1),te={isSeeking:X,setIsSeeking:Z},ae={},oe=(b=(0,q0.val)(g.sequence.clippedSpaceRange))!=null?b:V3e,ue=q0.prism.memo("scaledSpace",()=>{let Oe=oe.end-oe.start,ot=U.width,de=Oe/ot,Be=ot/Oe;return{fromUnitSpace(re){return re*Be},toUnitSpace(re){return re*de},leftPadding:10}},[oe,U.width]),Ee=q0.prism.memo("setClippedSpaceRange",()=>function(Oe){d.transaction(({stateEditors:ot})=>{let de=R({},Oe);if(de.end<=de.start&&(de.end=de.start+1),de.start<0){let Be=de.end-de.start;de.start=0,de.end=Be}ot.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.clippedSpaceRange.set(M(R({},l.address),{range:de}))})},[]),Ie=q0.prism.memo("clippedSpace",()=>({range:oe,width:U.width,fromUnitSpace(Oe){return ue.fromUnitSpace(Oe-oe.start)+ue.leftPadding},toUnitSpace(Oe){return ue.toUnitSpace(Oe-ue.leftPadding)+oe.start},setRange:Ee}),[oe,U.width,ue,Ee]),_e=q0.prism.memo("selection.current",()=>new q0.Atom({}),[]);return Zj("finalAtom",{sheet:l,tree:S,panelDims:E,leftDims:V,rightDims:U,dopeSheetDims:H,horizontalScrollbarDims:G,seeker:te,unitSpace:ae,scaledSpace:ue,clippedSpace:Ie,graphEditorDims:F,graphEditorVerticalSpace:W,selectionAtom:_e}).pointer})}var q0,z3e,V3e,DUe=C(()=>{Fe(),MUe(),Gpe(),q0=Jt,IUe(),bo(),z3e=.2,V3e={start:0,end:10}});function FUe(l){let{fullSecondStampsContainer:h,sequencePositionFormatter:d,snapToGrid:g,unitSpaceToClippedSpace:_}=l,b="";z2e(l,(S,E)=>{let N=g(S),I=_(N);E?b+=G3e(d.formatFullUnitForGrid(N),I,"full-unit"):b+=G3e(d.formatSubUnitForGrid(N),I,"sub-unit")}),h.innerHTML=b}function G3e(l,h,d){return'<span class="'.concat(d,'" style="transform: translate3d(').concat(h.toFixed(1),'px, -50%, 0);">').concat(l,"</span>")}var E9,M9,$3e,H3e,mg,j3e,W3e,q3e,X3e,Y3e,K3e,Z3e=C(()=>{E9=Jt,Tc(),M9=z(Le()),at(),G2e(),Fe(),H3e=me.div($3e||($3e=$([`
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  pointer-events: none;
`]))),mg={fullUnitStampColor:"#6a6a6a",stampFontSize:"10px",get subUnitStampColor(){return Ub(.2,mg.fullUnitStampColor)}},W3e=me.div(j3e||(j3e=$([`
  position: absolute;
  top: 0;
  height: 100%;
  left: 0;
  overflow: hidden;
  z-index: 2;
  will-change: transform;
  pointer-events: none;
`]))),X3e=me.div(q3e||(q3e=$([`
  position: absolute;
  top: 0;
  left: 0;

  & > span {
    position: absolute;
    display: block;
    top: 9px;
    left: -10px;
    color: `,`;
    text-align: center;
    font-size: `,`;
    width: 20px;

    &.full-unit {
      color: `,`;
    }

    &.sub-unit {
      color: `,`;
    }
  }

  pointer-events: none;
`])),mg.fullUnitStampColor,mg.stampFontSize,mg.fullUnitStampColor,mg.subUnitStampColor),Y3e=({layoutP:l,width:h})=>{let d=(0,M9.useRef)(null),[g,_]=(0,M9.useState)(null);return(0,M9.useLayoutEffect)(()=>{if(g)return(0,E9.prism)(()=>{let b=(0,E9.val)(l.sheet).getSequence();return{fullSecondStampsContainer:g,clippedSpaceRange:(0,E9.val)(l.clippedSpace.range),clippedSpaceWidth:(0,E9.val)(l.clippedSpace.width),unitSpaceToClippedSpace:(0,E9.val)(l.clippedSpace.fromUnitSpace),leftPadding:(0,E9.val)(l.scaledSpace.leftPadding),fps:b.subUnitsPerUnit,sequencePositionFormatter:b.positionFormatter,snapToGrid:S=>b.closestGridPosition(S)}}).onChange(ge().ticker,FUe,!0)},[g,h,l]),M9.default.createElement(H3e,{ref:d,style:{width:h+"px"}},M9.default.createElement(W3e,{style:{width:h+"px"}},M9.default.createElement(X3e,{ref:_})))},K3e=Y3e});function OUe(l){let[h,d]=(0,yq.useState)(!1);return(0,yq.useEffect)(()=>{if(d(!1),!l)return;let g=b=>{b.target===l?d(!0):d(!1)},_=()=>{d(!1)};return l.addEventListener("mouseenter",g),l.addEventListener("mousemove",g),l.addEventListener("mouseleave",_),()=>{d(!1),l.removeEventListener("mouseenter",g),l.removeEventListener("mousemove",g),l.removeEventListener("mouseleave",_)}},[l]),h}var yq,BUe=C(()=>{yq=z(Le())});function LUe(l,h){let d=0,[g,_]=l,[b,S]=h;return _-g>S-b?[b,S]:(g<b&&(d=0-g),_>S&&(d=S-_),[g+d,_+d])}var cf,gg,Ko,vq,Q3e,Ok,J3e,e9e,t9e=C(()=>{cf=Jt,Qn(),Ei(),Fe(),A9(),u0(),Yo(),Ti(),gg=z(Le()),at(),nl(),Ko={enabled:{backgroundColor:"#2C2F34",stroke:"#646568"},disabled:{backgroundColor:"#282a2cc5",stroke:"#595a5d"},hover:{backgroundColor:"#34373D",stroke:"#C8CAC0"},dragging:{backgroundColor:"#3F444A",stroke:"#C8CAC0"},thumbWidth:9,hitZoneWidth:26,rangeStripMinWidth:30},vq=1e3,Ok=me.div(Q3e||(Q3e=$([`
  position: absolute;
  height: `,`px;
  background-color: `,`;
  cursor: grab;
  top: 0;
  left: 0;
  width: `,`px;
  transform-origin: left top;
  &:hover {
    background-color: `,`;
  }
  &.dragging {
    background-color: `,`;
    cursor: grabbing !important;
  }
  `,`;

  /* covers the one pixel space between the focus range strip and the top strip
  of the sequence editor panel, which would have caused that one pixel to act
  like a panel drag zone */
  &:after {
    display: block;
    content: ' ';
    position: absolute;
    bottom: -1px;
    height: 1px;
    left: 0;
    right: 0;
    background: transparent;
    pointer-events: normal;
    z-index: -1;
  }
`])),()=>hf-1,l=>l.enabled?Ko.enabled.backgroundColor:Ko.disabled.backgroundColor,vq,Ko.hover.backgroundColor,Ko.dragging.backgroundColor,Si),J3e=({layoutP:l})=>{let h=(0,gg.useMemo)(()=>(0,cf.prism)(()=>{let{projectId:I,sheetId:B}=(0,cf.val)(l.sheet).address;return(0,cf.val)(ge().atomP.ahistoric.projects.stateByProjectId[I].stateBySheetId[B].sequence.focusRange)}),[l]),[d,g]=vi(null),[_]=c0(g,{menuItems:()=>{let I=(0,cf.val)(l.sheet),B=h.getValue();return[{label:"Delete focus range",callback:()=>{ge().tempTransaction(({stateEditors:V})=>{V.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.focusRange.unset(R({},I.address))}).commit()}},{label:B!=null&&B.enabled?"Disable focus range":"Enable focus range",callback:()=>{B!==void 0&&ge().tempTransaction(({stateEditors:V})=>{V.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.focusRange.set(M(R({},I.address),{range:B.range,enabled:!B.enabled}))}).commit()}}]}}),b=Dr(l.scaledSpace.toUnitSpace),S=Dr(l.sheet),E=(0,gg.useMemo)(()=>{let I,B;return{debugName:"FocusRangeStrip",onDragStart(V){let U,F=h.getValue();if(!F)return!1;let H=F.range.start,G=F.range.end,W=!1,X=(0,cf.val)(l.sheet).getSequence();return{onDrag(Z){if(F=h.getValue(),F){W=!0;let te=b(Z),ae=H+te,oe=G+te;oe<ae&&(oe=ae),[I,B]=LUe([ae,oe],[0,X.length]).map(ue=>X.closestGridPosition(ue)),U&&U.discard(),U=ge().tempTransaction(({stateEditors:ue})=>{var Ee;ue.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.focusRange.set(M(R({},S.address),{range:{start:I,end:B},enabled:(Ee=F==null?void 0:F.enabled)!=null?Ee:!0}))})}},onDragEnd(){F&&(W&&U!==void 0?U.commit():U&&U.discard())}}},lockCSSCursorTo:"grabbing"}},[S,b]),[N]=eo(g,E);return Up(N,-1),Rr(()=>{let I=h.getValue(),B=(I==null?void 0:I.range)||{start:0,end:0},V=(0,cf.val)(l.clippedSpace.fromUnitSpace)(B.start),U=(0,cf.val)(l.clippedSpace.fromUnitSpace)(B.end),F,H;return V<0&&(V=0),U>(0,cf.val)(l.clippedSpace.width)&&(U=(0,cf.val)(l.clippedSpace.width)),V>U?(H=0,F=0):(H=V,F=(U-V)/vq),I?gg.default.createElement(gg.default.Fragment,null,_,gg.default.createElement(Ok,{id:"range-strip",enabled:I.enabled,className:"".concat(N?"dragging":""," ").concat(I.enabled?"enabled":""),ref:d,style:{transform:"translateX(".concat(H,"px) scale(").concat(F,", 1)")}})):gg.default.createElement(gg.default.Fragment,null)},[l,d,h,_,N])},e9e=J3e}),yg,Gp,n9e,r9e,i9e,s9e,o9e,a9e,l9e,_q,UUe=C(()=>{yg=Jt,Qn(),Fe(),A9(),Ec(),Yo(),Ti(),Gp=z(Le()),at(),nl(),t9e(),Ph(),r9e=me.div(n9e||(n9e=$([`
  position: absolute;
  top: 0;
  // the right handle has to be pulled back by its width since its right side indicates its position, not its left side
  left: `,`px;
  transform-origin: left top;
  width: `,`px;
  height: `,`px;
  z-index: 3;

  --bg: `,`;

  stroke: `,`;
  user-select: none;

  cursor: `,`;

  // no pointer events unless pointer-root is in normal mode _and_ the
  // focus range is enabled
  #pointer-root & {
    pointer-events: none;
  }

  #pointer-root.normal & {
    pointer-events: auto;
  }

  #pointer-root.draggingPositionInSequenceEditor & {
    pointer-events: auto;
    cursor: var(`,`);
  }

  &.dragging {
    pointer-events: none !important;
  }

  // highlight the handle if it's hovered, or the whole strip is hovverd
  `,`:hover ~ &, &:hover {
    --bg: `,`;
    stroke: `,`;
  }

  // highlight the handle when it's being dragged or the whole strip is being dragged.
  // using dragging.dragging to give this selector priority, as it seems to be overridden
  // by the hover selector above
  &.dragging,
  `,`.dragging.dragging ~ & {
    --bg: `,`;
    stroke: `,`;
  }

  #pointer-root.draggingPositionInSequenceEditor &:hover {
    --bg: `,`;
    stroke: #40aaa4;
  }

  background-color: var(--bg);

  // a larger hit zone
  &:before {
    display: block;
    content: ' ';
    position: absolute;
    inset: -8px;
  }
`])),l=>l.type==="start"?0:-Ko.thumbWidth,Ko.thumbWidth,()=>hf-1,({enabled:l})=>l?Ko.enabled.backgroundColor:Ko.disabled.backgroundColor,Ko.enabled.stroke,l=>l.type==="start"?"w-resize":"e-resize",Pp,()=>Ok,Ko.hover.backgroundColor,Ko.hover.stroke,()=>Ok,Ko.dragging.backgroundColor,Ko.dragging.stroke,Ko.dragging.backgroundColor),s9e=me.div(i9e||(i9e=$([`
  position: absolute;
  top: 0;
  bottom: 0;
  pointer-events: none;

  background: linear-gradient(
    `,`deg,
    var(--bg) 0%,
    #ffffff00 100%
  );

  width: 12px;
  left: `,`px;
`])),l=>l.type==="start"?90:-90,l=>l.type==="start"?Ko.thumbWidth:-Ko.thumbWidth+1),a9e=me.div(o9e||(o9e=$([`
  position: absolute;
  top: 0;
  bottom: 0;
  pointer-events: none;

  background: linear-gradient(
    `,`deg,
    `,` 0%,
    #ffffff00 100%
  );

  width: 12px;
  left: `,`px;
`])),l=>l.type==="start"?-90:90,()=>QS.backgroundColor,l=>l.type==="start"?-12:Ko.thumbWidth),l9e=({layoutP:l,thumbType:h})=>{var d;let[g,_]=vi(null),b=(0,Gp.useMemo)(()=>(0,yg.prism)(()=>{let{projectId:I,sheetId:B}=(0,yg.val)(l.sheet).address;return(0,yg.val)(ge().atomP.ahistoric.projects.stateByProjectId[I].stateBySheetId[B].sequence.focusRange)}),[l]),S=(0,Gp.useMemo)(()=>({debugName:"FocusRangeThumb",onDragStart(){let I,B,V=(0,yg.val)(l.sheet),U={start:0,end:V.getSequence().length},F=b.getValue()||{range:U,enabled:!1},H=F.enabled,G=F.range[h],W=(0,yg.val)(l.scaledSpace.toUnitSpace),X=W(Ko.rangeStripMinWidth);return{onDrag(Z,te,ae){var oe;let ue,Ee=h0.checkIfMouseEventSnapToPos(ae,{ignore:_});if(Ee==null){let _e=W(Z);ue=G+_e}else ue=Ee;B=((oe=b.getValue())==null?void 0:oe.range)||U,h==="start"?ue=Math.max(Math.min(ue,B.end-X),0):ue=Math.min(Math.max(ue,B.start+X),V.getSequence().length);let Ie=V.getSequence().closestGridPosition(ue);I!==void 0&&I.discard(),I=ge().tempTransaction(({stateEditors:_e})=>{_e.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.focusRange.set(M(R({},V.address),{range:M(R({},B),{[h]:Ie}),enabled:H}))})},onDragEnd(Z){Z?I==null||I.commit():I==null||I.discard()}}}}),[l]),[E]=eo(_,S);bu(E,"draggingPositionInSequenceEditor",h==="start"?"w-resize":"e-resize");let N=Dr(b);return Up(E,(d=N==null?void 0:N.range[h])!=null?d:0),Rr(()=>{let I=b.getValue();if(!I)return null;let{enabled:B}=I,V=I.range[h],U=(0,yg.val)(l.clippedSpace.fromUnitSpace)(V);return(U<0||(0,yg.val)(l.clippedSpace.width)<U)&&(U=-1e4),Gp.default.createElement(r9e,M(R(R({ref:g},h0.includePositionSnapAttrs(V)),rf(V)),{className:"".concat(E&&"dragging"," ").concat(B&&"enabled"),enabled:B,type:h,style:{transform:"translate3d(".concat(U,"px, 0, 0)")}}),Gp.default.createElement(s9e,{type:h,enabled:B}),Gp.default.createElement(a9e,{type:h}),Gp.default.createElement("svg",{viewBox:"0 0 9 18",xmlns:"http://www.w3.org/2000/svg"},Gp.default.createElement("line",{x1:"4",y1:"6",x2:"4",y2:"12"}),Gp.default.createElement("line",{x1:"6",y1:"6",x2:"6",y2:"12"})))},[l,g,b,E])},_q=l9e});function zUe(l,h){let[d,g]=(0,uf.useState)("none");return bu(d!=="none","dragging",d==="creating"?"ew-resize":"move"),(0,uf.useMemo)(()=>{let _=()=>({debugName:"FocusRangeZone/focusRangeCreationGestureHandlers",onDragStart(S){let E,N=(0,C9.val)(l.clippedSpace.toUnitSpace),I=(0,C9.val)(l.scaledSpace.toUnitSpace),B=(0,C9.val)(l.sheet),V=B.getSequence(),U=S.target.getBoundingClientRect(),F=N(S.clientX-U.left),H=I(Ko.rangeStripMinWidth);return{onDrag(G){let W=I(G),X=F,Z=F+W;[X,Z]=[Ss(X,0,V.length),Ss(Z,0,V.length)].map(te=>V.closestGridPosition(te)),Z<X?[X,Z]=[Math.max(Math.min(Z,X-H),0),X]:G>0&&(Z=Math.min(Math.max(Z,X+H),V.length)),E&&E.discard(),E=ge().tempTransaction(({stateEditors:te})=>{te.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence.focusRange.set(M(R({},B.address),{range:{start:X,end:Z},enabled:!0}))})},onDragEnd(G){G&&E!==void 0?E.commit():E&&E.discard()}}},lockCSSCursorTo:"ew-resize"}),b=()=>({debugName:"FocusRangeZone/panelMoveGestureHandlers",onDragStart(){let S,E=h.current,N=h.current.addBoundsHighlightLock();return{onDrag(I,B){let V=M(R({},E.dims),{top:Ss(E.dims.top+B,0,window.innerHeight-Hd),left:Ss(E.dims.left+I,-E.dims.width+Hd,window.innerWidth-Hd)}),U=zI(V,{width:window.innerWidth,height:window.innerHeight});S==null||S.discard(),S=ge().tempTransaction(({stateEditors:F})=>{F.studio.historic.panelPositions.setPanelPosition({position:U,panelId:E.panelId})})},onDragEnd(I){N(),I?S==null||S.commit():S==null||S.discard()}}},lockCSSCursorTo:"move"});return{debugName:"FocusRangeZone",onDragStart(S){let[E,N]=S.shiftKey?["creating",_().onDragStart(S)]:["moving-panel",b().onDragStart(S)];return g(E),N===!1?!1:{onDrag(I,B,V,U,F){N.onDrag(I,B,V,U,F)},onDragEnd(I){var B;g("none"),(B=N.onDragEnd)==null||B.call(N,I)}}}}},[l,h])}var C9,uf,c9e,u9e,h9e,d9e,VUe=C(()=>{C9=Jt,Qn(),Fe(),Lv(),A9(),Ec(),Yo(),BUe(),i1e(),Ti(),bo(),uf=z(Le()),at(),t9e(),UUe(),Ap(),u9e=me.div(c9e||(c9e=$([`
  position: absolute;
  height: `,`px;
  left: 0;
  right: 0;
  box-sizing: border-box;
  /* Use the "grab" cursor if the shift key is up, which is the one used on the top strip of the sequence editor */
  cursor: `,`;
`])),()=>hf,l=>l.isShiftDown?"ew-resize":"move"),h9e=({layoutP:l})=>{let[h,d]=vi(null),g=Bv(),_=(0,uf.useRef)(g);_.current=g;let b=(0,uf.useMemo)(()=>(0,C9.prism)(()=>{let{projectId:N,sheetId:I}=(0,C9.val)(l.sheet).address;return(0,C9.val)(ge().atomP.ahistoric.projects.stateByProjectId[N].stateBySheetId[I].sequence.focusRange)}),[l]);eo(d,zUe(l,_));let S=n1e("Shift"),E=OUe(d);return(0,uf.useEffect)(()=>{if(!S&&E)return _.current.addBoundsHighlightLock()},[!S&&E]),Rr(()=>uf.default.createElement(u9e,{ref:h,isShiftDown:S},uf.default.createElement(e9e,{layoutP:l}),uf.default.createElement(_q,{thumbType:"start",layoutP:l}),uf.default.createElement(_q,{thumbType:"end",layoutP:l})),[l,b,S])},d9e=h9e}),Yv,hf,QS,f9e,p9e,m9e,g9e,A9=C(()=>{Qn(),Yv=z(Le()),at(),Z3e(),nl(),Ei(),VUe(),hf=18,QS={backgroundColor:"#1f2120eb",borderColor:"#1c1e21"},p9e=me.div(f9e||(f9e=$([`
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: `,`px;
  box-sizing: border-box;
  background: `,`;
  border-bottom: 1px solid `,`;
  `,`;
`])),hf,QS.backgroundColor,QS.borderColor,Si),m9e=({layoutP:l})=>{let h=Dr(l.rightDims.width);return Yv.default.createElement(Yv.default.Fragment,null,Yv.default.createElement(p9e,R({},rf("hide")),Yv.default.createElement(K3e,{layoutP:l,width:h,height:hf}),Yv.default.createElement(d9e,{layoutP:l})))},g9e=m9e}),R9,y9e,v9e,_9e,x9e,b9e,S9e,w9e,T9e,GUe=C(()=>{R9=z(Le()),at(),Qn(),Fe(),wH(),r9(),y9e=l=>isFinite(l)&&l>0,_9e=me.div(v9e||(v9e=$([`
  display: flex;
  gap: 8px;
  padding: 4px 8px;
  height: 28px;
  align-items: center;
`]))),b9e=me.div(x9e||(x9e=$([`
  `,`;
  white-space: nowrap;
`])),tg),S9e=({deltaX:l})=>l*.25,w9e=({layoutP:l})=>{let h=Dr(l.sheet),d=(0,R9.useMemo)(()=>{let _;return{temporarilySetValue(b){_&&(_.discard(),_=void 0),_=ge().tempTransaction(({stateEditors:S})=>{S.coreByProject.historic.sheetsById.sequence.setLength(M(R({},h.address),{length:b}))})},discardTemporaryValue(){_&&(_.discard(),_=void 0)},permanentlySetValue(b){_&&(_.discard(),_=void 0),ge().transaction(({stateEditors:S})=>{S.coreByProject.historic.sheetsById.sequence.setLength(M(R({},h.address),{length:b}))})}}},[l,h]),g=(0,R9.useRef)(null);return(0,R9.useLayoutEffect)(()=>{g.current.focus()},[]),Rr(()=>{let _=h.getSequence().length;return R9.default.createElement(_9e,null,R9.default.createElement(b9e,null,"Sequence length"),R9.default.createElement(HN,M(R({value:_},d),{isValid:y9e,inputRef:g,nudge:S9e})))},[h,d,g])},T9e=w9e});function $Ue(l,h){let d=(0,X0.useRef)(h);d.current=h;let g=(0,X0.useMemo)(()=>({debugName:"LengthIndicator/useDragBulge",lockCSSCursorTo:"ew-resize",onDragStart(b){let S,E=d.current,N=(0,P9.val)(d.current.layoutP.sheet),I=N.getSequence().length,B=(0,P9.val)(E.layoutP.scaledSpace.toUnitSpace);return{onDrag(V,U,F){let H=B(V);S&&(S.discard(),S=void 0),S=ge().tempTransaction(({stateEditors:G})=>{G.coreByProject.historic.sheetsById.sequence.setLength(M(R({},N.address),{length:I+H}))})},onDragEnd(V){V?S&&S.commit():S&&S.discard()}}}}),[]),[_]=eo(l,g);return Up(_,-1),[_]}var P9,X0,xq,JS,E9e,vg,M9e,C9e,A9e,R9e,P9e,N9e,I9e,k9e,D9e,F9e,O9e,HUe=C(()=>{Qn(),P9=Jt,X0=z(Le()),at(),jp(),A9(),Ti(),Yo(),Fe(),Yd(),nl(),Ev(),GUe(),Ei(),Zd(),xq=1e3,JS={stripNormal:"#0000006c",stripActive:"#000000"},vg=me.div(E9e||(E9e=$([`
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  z-index: `,`;
  pointer-events: none;

  &:after {
    display: block;
    content: ' ';
    position: absolute;
    /* top: `,`px; */
    top: 0;
    bottom: 0;
    left: -1px;
    width: 1px;
    background-color: `,`;
  }

  &:hover:after,
  &.dragging:after {
    background-color: `,`;
  }
`])),()=>ff.lengthIndicatorStrip,hf,JS.stripNormal,JS.stripActive),C9e=me.div(M9e||(M9e=$([`
  position: absolute;
  top: `,`px;
  width: 100px;
  left: -50px;
  pointer-events: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 1;
`])),hf-15),R9e=me.div(A9e||(A9e=$([`
  margin-top: 8px;
  font-size: 10px;
  white-space: nowrap;
  padding: 2px 8px;
  border-radius: 2px;
  `,`;
  cursor: ew-resize;
  color: #464646;
  background-color: #0000004d;
  display: none;

  `,":hover &, ",`.dragging & {
    display: block;
    color: white;
    background-color: `,`;
  }
`])),Si,vg,vg,JS.stripActive),N9e=me.div(P9e||(P9e=$([`
  font-size: 10px;
  white-space: nowrap;
  padding: 1px 2px;
  border-radius: 2px;
  `,`;
  justify-content: center;
  align-items: center;
  cursor: ew-resize;
  color: #5d5d5d;
  background-color: #191919;

  `,":hover &, ",`.dragging & {
    color: white;
    background-color: `,`;

    & > svg:first-child {
      margin-right: -1px;
    }
  }

  & > svg:first-child {
    margin-right: -4px;
  }
`])),Si,vg,vg,JS.stripActive),k9e=me.div(I9e||(I9e=$([`
  position: absolute;
  top: 0;
  left: 0;
  background-color: rgb(23 23 23 / 43%);
  width: `,`px;
  z-index: `,`;
  transform-origin: left top;

  `,".dragging ~ &, ",`:hover ~ & {
    background-color: rgb(23 23 23 / 60%);
  }
`])),xq,()=>ff.lengthIndicatorCover,vg,vg),D9e=-1e4,F9e=({layoutP:l})=>{let[h,d]=vi(null),[g]=$Ue(d,{layoutP:l}),{node:_,toggle:b,close:S}=Xd({debugName:"LengthIndicator"},()=>X0.default.createElement(Kd,null,X0.default.createElement(T9e,{layoutP:l,onRequestClose:S})));return Rr(()=>{let E=(0,P9.val)(l.sheet),N=(0,P9.val)(l.rightDims.height),I=E.getSequence(),B=I.length,V=B,U=(0,P9.val)(l.clippedSpace.fromUnitSpace)(V),F=(0,P9.val)(l.clippedSpace.width),H,G;return U>F?(G=0,H=0):(U<0&&(U=0),G=U,H=(F-U)/xq),X0.default.createElement(X0.default.Fragment,null,_,X0.default.createElement(vg,{style:{height:N+"px",transform:"translateX(".concat(G===0?D9e:G,"px)")},className:g?"dragging":""},X0.default.createElement(C9e,null,X0.default.createElement(N9e,R({ref:h,onClick:W=>{b(W,d)}},rf("hide")),X0.default.createElement(kFe,null),X0.default.createElement(DFe,null)),X0.default.createElement(R9e,null,"Sequence length:"," ",I.positionFormatter.formatBasic(B)))),X0.default.createElement(k9e,{title:"Length",style:{height:N+"px",transform:"translateX(".concat(G,"px) scale(").concat(H,", 1)")}}))},[l,h,g,_])},O9e=F9e}),bq,$p,B9e,L9e,U9e,z9e,V9e,G9e,$9e,H9e,jUe=C(()=>{Qn(),bq=Jt,$p=z(Le()),at(),Z3e(),jp(),A9(),nl(),L9e=me.div(B9e||(B9e=$([`
  position: absolute;
  top: 0;
  left: 0;
  margin-top: 0px;
`]))),z9e=me.div(U9e||(U9e=$([`
  position: absolute;
  top: 16px;
  font-size: `,`;
  color: `,`;
  text-align: center;
  transform: translateX(-50%);
  background: `,`;
  padding: 1px 8px;
  font-variant-numeric: tabular-nums;
  pointer-events: none;
  z-index: `,`;
`])),mg.stampFontSize,mg.fullUnitStampColor,QS.backgroundColor,()=>ff.currentFrameStamp),G9e=me.div(V9e||(V9e=$([`
  position: absolute;
  top: 5px;
  left: -0px;
  bottom: 0;
  width: 0.5px;
  background: rgba(100, 100, 100, 0.2);
  pointer-events: none;
`]))),$9e=$p.default.memo(({layoutP:l})=>{let[h,d]=Dr(M1e()),g=Dr(l.clippedSpace.fromUnitSpace),{sequence:_,formatter:b,clippedSpaceWidth:S}=Rr(()=>{let B=(0,bq.val)(l.sheet).getSequence(),V=(0,bq.val)(l.clippedSpace.width);return{sequence:B,formatter:B.positionFormatter,clippedSpaceWidth:V}},[l]);if(h==-1)return $p.default.createElement($p.default.Fragment,null);let E=d===3?_.closestGridPosition(h):h,N=g(E),I=N>=0&&N<=S;return $p.default.createElement($p.default.Fragment,null,$p.default.createElement(L9e,null,$p.default.createElement(z9e,{style:{opacity:I?1:0,transform:"translate3d(calc(".concat(N,"px - 50%), 0, 0)")}},b.formatForPlayhead(E)),$p.default.createElement(G9e,{posType:d,style:{opacity:I?1:0,transform:"translate3d(".concat(N,"px, 0, 0)")}}))," ")}),H9e=$9e}),Nh,p0,j9e,W9e,q9e,X9e,Y9e,Bk,K9e,Sq,Z9e,Lk,Q9e,Uk,J9e,wq,eye,tye,WUe=C(()=>{Qn(),Nh=Jt,NP(),Tc(),p0=z(Le()),at(),jp(),nl(),Ei(),Yo(),W9e=me.div(j9e||(j9e=$([`
  --threadHeight: 6px;
  --bg-inactive: #32353b;
  --bg-active: #5b5c5d;
  position: absolute;
  height: 0;
  width: 100%;
  left: 12px;
  /* bottom: 8px; */
  z-index: `,`;
  `,`
`])),()=>ff.horizontalScrollbar,Si),X9e=me.div(q9e||(q9e=$([`
  position: relative;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--threadHeight);
`]))),Bk=me.div(Y9e||(Y9e=$([`
  position: absolute;
  height: 5px;
  background: var(--bg-inactive);
  cursor: ew-resize;
  z-index: 2;

  &:hover,
  &:active {
    background: var(--bg-active);
  }

  &:after {
    `,`;
    display: block;
    content: ' ';
  }
`])),C$("absolute","-4px")),Sq=me.div(K9e||(K9e=$([`
  position: absolute;
  height: 5px;
  width: 7px;
  left: 0;
  z-index: 2;
  top: 0;
  bottom: 0;
  display: block;

  &:hover:before {
    background: var(--bg-active);
  }

  &:before {
    `,`;
    display: block;
    content: ' ';
    background: var(--bg-inactive);
    border-radius: 0 2px 2px 0;
  }

  &:after {
    `,`;
    display: block;
    content: ' ';
  }
`])),C$("absolute","0"),C$("absolute","-4px")),Lk=me(Sq)(Z9e||(Z9e=$([`
  left: calc(-1 * 7px);
  cursor: w-resize;
  &:before {
    transform: scaleX(-1);
  }
`]))),Uk=me(Sq)(Q9e||(Q9e=$([`
  cursor: e-resize;
  left: 0px;
`]))),wq=me.div(J9e||(J9e=$([`
  display: `,`;
  position: absolute;
  top: -20px;
  left: 4px;
  padding: 0 4px;
  transform: translateX(-50%);
  background: #131d1f;
  border-radius: 4px;
  color: #fff;
  font-size: 10px;
  line-height: 18px;
  text-align: center;

  `,`:hover &,
  `,`:hover &,
  `,":hover ~ ",` &,
  `,":hover ~ ",` & {
    display: block;
  }
`])),l=>l.active?"block":"none",Lk,Uk,Bk,Lk,Bk,Uk),eye=({layoutP:l})=>{let h=(0,p0.useCallback)(W=>W.toFixed(2),[]),d=(0,p0.useMemo)(()=>(0,Nh.prism)(()=>{let W=(0,Nh.val)(l.rightDims.width)-25,X=(0,Nh.val)(l.clippedSpace.range),Z=(0,Nh.val)(l.sheet).getSequence().length,te=Math.max(X.end,Z),ae=X.start/te*W,oe=X.end/te*W;return{rightWidth:W,clippedSpaceRange:X,sequenceLength:Z,assumedLengthOfSequence:te,rangeStartX:ae,rangeEndX:oe,bottom:(0,Nh.val)(l.horizontalScrollbarDims.bottom)}}),[l]),{rangeStartX:g,rangeEndX:_,clippedSpaceRange:b,bottom:S}=Dr(d),[E,N]=(0,p0.useState)("nothing"),I=(0,p0.useMemo)(()=>{let W=(0,Nh.val)(d),X=()=>{W=(0,Nh.val)(d)},Z=te=>te/W.rightWidth*W.assumedLengthOfSequence;return{onRangeDragStart(){return X(),{onDrag(te){N("both");let ae=Z(te),oe=vp(W.clippedSpaceRange,ue=>ue+ae);(0,Nh.val)(l.clippedSpace.setRange)(oe)},onDragEnd(){N("nothing")}}},onRangeStartDragStart(){return X(),{onDrag(te){N("start");let ae=Z(te),oe={start:W.clippedSpaceRange.start+ae,end:W.clippedSpaceRange.end};oe.start>oe.end-1&&(oe.start=oe.end-1),oe.start<=0&&(oe.start=0),(0,Nh.val)(l.clippedSpace.setRange)(oe)},onDragEnd(){N("nothing")}}},onRangeEndDragStart(){return X(),{onDrag(te){N("end");let ae=Z(te),oe={start:W.clippedSpaceRange.start,end:W.clippedSpaceRange.end+ae};oe.end<oe.start+1&&(oe.end=oe.start+1),oe.end>=W.assumedLengthOfSequence&&(oe.end=W.assumedLengthOfSequence),(0,Nh.val)(l.clippedSpace.setRange)(oe)},onDragEnd(){N("nothing")}}}}},[l,d]),[B,V]=(0,p0.useState)(null);eo(B,{debugName:"HorizontalScrollbar/onRangeDrag",onDragStart:I.onRangeDragStart,lockCSSCursorTo:"ew-resize"});let[U,F]=(0,p0.useState)(null);eo(U,{debugName:"HorizontalScrollbar/onRangeStartDrag",onDragStart:I.onRangeStartDragStart,lockCSSCursorTo:"w-resize"});let[H,G]=(0,p0.useState)(null);return eo(H,{debugName:"HorizontalScrollbar/onRangeEndDrag",onDragStart:I.onRangeEndDragStart,lockCSSCursorTo:"e-resize"}),p0.default.createElement(W9e,R({style:{bottom:S+8+"px"}},rf("hide")),p0.default.createElement(X9e,null,p0.default.createElement(Bk,{ref:V,style:{width:"".concat(_-g,"px"),transform:"translate3d(".concat(g,"px, 0, 0)")}}),p0.default.createElement(Lk,{ref:F,style:{transform:"translate3d(".concat(g,"px, 0, 0)")}},p0.default.createElement(wq,{active:E==="both"||E==="start"},h(b.start))),p0.default.createElement(Uk,{ref:G,style:{transform:"translate3d(".concat(_,"px, 0, 0)")}},p0.default.createElement(wq,{active:E==="both"||E==="end"},h(b.end)))))},tye=eye}),nye,rye,iye,sye,oye,qUe=C(()=>{nye=z(Le()),at(),iye=me.div(rye||(rye=$([`
  position: absolute;
  inset: `,`px;
`])),l=>l.room*-1),sye=l=>nye.default.createElement(iye,{room:l.room}),oye=sye}),zk,Vk,Tq,aye,lye,cye,uye,hye,dye,fye,pye,XUe=C(()=>{at(),Qn(),wH(),r9(),zk=z(Le()),Vk=z(Le()),Tq=Jt,A5(),aye=l=>isFinite(l)&&l>=0,cye=me.div(lye||(lye=$([`
  display: flex;
  gap: 8px;
  padding: 4px 8px;
  height: 28px;
  align-items: center;
`]))),hye=me.div(uye||(uye=$([`
  `,`;
  white-space: nowrap;
`])),tg),dye=({deltaX:l})=>l*.25,fye=({layoutP:l,onRequestClose:h})=>{let d=(0,Tq.val)(l.sheet),g=d.getSequence(),_=(0,zk.useMemo)(()=>{let S,E=g.position;return{temporarilySetValue(N){S&&(S=void 0),S=Ss(N,0,g.length),g.position=S},discardTemporaryValue(){S&&(S=void 0,g.position=E,h("discardTemporaryValue"))},permanentlySetValue(N){S&&(S=void 0),g.position=Ss(N,0,g.length),h("permanentlySetValue")}}},[l,g]),b=(0,zk.useRef)(null);return(0,zk.useLayoutEffect)(()=>{b.current.focus()},[]),Rr(()=>{let S=d.getSequence(),E=Number((0,Tq.val)(S.pointer.position).toFixed(3));return Vk.default.createElement(cye,null,Vk.default.createElement(hye,null,"Sequence position"),Vk.default.createElement(HN,M(R({value:E},_),{isValid:aye,inputRef:b,nudge:dye})))},[d,_,b])},pye=fye}),mye,YUe=C(()=>{mye=typeof navigator<"u"&&navigator.platform.toUpperCase().indexOf("MAC")>=0}),gye,KUe=C(()=>{YUe(),gye=l=>mye?l.metaKey===!0:l.ctrlKey===!0});function ZUe(){Gk=!1}function QUe(){Gk=!0}function JUe(){let l=ge();(0,yye.useEffect)(()=>{let h=d=>{let g=d.composedPath()[0];if(!(g&&(g.tagName==="INPUT"||g.tagName==="TEXTAREA"))){if(d.key==="z"||d.key==="Z"||d.code==="KeyZ")if(gye(d))d.shiftKey===!0?l.redo():l.undo();else return;else if(d.code==="Space"&&!d.shiftKey&&!d.metaKey&&!d.altKey&&!d.ctrlKey){if(!Gk)return;let _=nFe();if(_)if(_.playing)_.pause();else{let{projectId:b,sheetId:S}=_.address,E=(0,Ih.prism)(()=>{let B=(0,Ih.val)(ge().atomP.ahistoric.projects.stateByProjectId[b].stateBySheetId[S].sequence.focusRange);return Ih.prism.memo("shouldFollowFocusRange",()=>{let V=_.position;if(B){let U=V>=B.range.start&&V<=B.range.end;return B.enabled?!!U:!0}else return!0},[])&&B&&B.enabled?{range:[B.range.start,B.range.end],isFollowingARange:!0}:{range:[0,(0,Ih.val)(_.pointer.length)],isFollowingARange:!1}}),N=_.playDynamicRange((0,Ih.prism)(()=>(0,Ih.val)(E).range),ge().ticker),I=Eq(_);N.finally(()=>{I.set(void 0)}),I.set(E)}else return}else if(d.altKey&&(d.key==="\\"||d.code==="Backslash"||d.code==="IntlBackslash"))l.transaction(({stateEditors:_,drafts:b})=>{_.studio.ahistoric.setVisibilityState(b.ahistoric.visibilityState==="everythingIsHidden"?"everythingIsVisible":"everythingIsHidden")});else return;d.preventDefault(),d.stopPropagation()}};return window.addEventListener("keydown",h),()=>{window.removeEventListener("keydown",h)}},[])}var yye,Ih,Gk,Eq,vye,Mq=C(()=>{yye=z(Le()),Fe(),KUe(),Km(),Ih=Jt,lI(),Gk=!0,Eq=oS(l=>new Ih.Atom(void 0)),vye=oS(l=>(0,Ih.prism)(()=>{let h=Eq(l).prism.getValue();if(h)return h.getValue().isFollowingARange;{let{projectId:d,sheetId:g}=l.address,_=(0,Ih.val)(ge().atomP.ahistoric.projects.stateByProjectId[d].stateBySheetId[g].sequence.focusRange);if(!_||!_.enabled)return!1;let b=(0,Ih.val)(l.pointer.position);return b>=_.range.start&&b<=_.range.end}}))});function eze(l,h){return c0(l,{menuItems(){return[{label:"Place marker",callback:()=>{ge().transaction(({stateEditors:d})=>{let g=(0,df.val)(h.layoutP.sheet),_=g.getSequence();d.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.replaceMarkers({sheetAddress:g.address,markers:[{id:zOe(),position:_.position}],snappingFunction:_.closestGridPosition})})}}]}})}var df,Au,_ye,N9,xye,bye,Sye,Cq,wye,Tye,Eye,Mye,Cye,Aye,tze=C(()=>{qUe(),Yo(),Ti(),Qn(),df=Jt,A5(),Au=z(Le()),at(),jp(),nl(),Ei(),Yd(),Zd(),XUe(),Mq(),Ec(),u0(),Fe(),Fp(),Ph(),d9(),N9=me.div(_ye||(_ye=$([`
  --thumbColor: #00e0ff;
  position: absolute;
  top: 0;
  left: 0;
  width: 5px;
  height: 100%;
  z-index: `,`;
  pointer-events: none;

  display: `,`;
`])),()=>ff.playhead,l=>l.isVisible?"block":"none"),bye=me.div(xye||(xye=$([`
  position: absolute;
  top: 8px;
  width: 0;
  height: calc(100% - 8px);
  border-left: 1px solid #27e0fd;
  z-index: 10;
  pointer-events: none;

  #pointer-root.draggingPositionInSequenceEditor &:not(.seeking) {
    /* pointer-events: auto; */
    /* cursor: var(`,`); */

    &:after {
      position: absolute;
      inset: -8px;
      display: block;
      content: ' ';
    }
  }
`])),Pp),Cq=me.div(Sye||(Sye=$([`
  background-color: var(--thumbColor);
  position: absolute;
  width: 5px;
  height: 13px;
  top: -4px;
  left: -2px;
  z-index: 11;
  cursor: ew-resize;
  --sunblock-color: #1f2b2b;

  `,`;

  `,`.seeking > & {
    pointer-events: none !important;
  }

  #pointer-root.draggingPositionInSequenceEditor
    `,`:not(.seeking)
    > & {
    pointer-events: auto;
    cursor: var(`,`);
  }

  `,`.playheadattachedtofocusrange > & {
    top: -8px;
    --sunblock-color: #005662;
    &:before,
    &:after {
      border-bottom-width: 8px;
    }
  }

  &:before {
    position: absolute;
    display: block;
    content: ' ';
    left: -2px;
    width: 0;
    height: 0;
    border-bottom: 4px solid var(--sunblock-color);
    border-left: 2px solid transparent;
  }

  &:after {
    position: absolute;
    display: block;
    content: ' ';
    right: -2px;
    width: 0;
    height: 0;
    border-bottom: 4px solid var(--sunblock-color);
    border-right: 2px solid transparent;
  }
`])),Si,N9,N9,Pp,N9),Tye=me.div(wye||(wye=$([`
  position: absolute;
  left: 1px;
  right: 1px;
  top: 13px;
  border-top: 3px solid var(--thumbColor);
  border-right: 1px solid transparent;
  border-left: 1px solid transparent;
  pointer-events: none;

  /* `,`.playheadattachedtofocusrange & {
    top: 10px;
    &:before,
    &:after {
      height: 15px;
    }
  } */

  &:before {
    position: absolute;
    display: block;
    content: ' ';
    top: -4px;
    left: -2px;
    height: 8px;
    width: 2px;
    background: none;
    border-radius: 0 100% 0 0;
    border-top: 1px solid var(--thumbColor);
    border-right: 1px solid var(--thumbColor);
  }

  &:after {
    position: absolute;
    display: block;
    content: ' ';
    top: -4px;
    right: -2px;
    height: 8px;
    width: 2px;
    background: none;
    border-radius: 100% 0 0 0;
    border-top: 1px solid var(--thumbColor);
    border-left: 1px solid var(--thumbColor);
  }
`])),N9),Mye=me.div(Eye||(Eye=$([`
  display: none;
  position: absolute;
  top: -20px;
  left: 4px;
  padding: 0 2px;
  transform: translateX(-50%);
  background: #1a1a1a;
  border-radius: 4px;
  color: #fff;
  font-size: 10px;
  line-height: 18px;
  text-align: center;
  `,":hover &, ",`.seeking & {
    display: block;
  }
`])),Cq,N9),Cye=({layoutP:l})=>{let[h,d]=vi(null),{node:g,toggle:_,close:b}=Xd({debugName:"Playhead"},()=>Au.default.createElement(Kd,null,Au.default.createElement(pye,{layoutP:l,onRequestClose:b}))),S=(0,Au.useMemo)(()=>({debugName:"RightOverlay/Playhead",onDragStart(){let I=(0,df.val)(l.sheet).getSequence(),B=I.position,V=(0,df.val)(l.scaledSpace.toUnitSpace),U=(0,df.val)(l.seeker.setIsSeeking);return U(!0),uW(),{onDrag(F,H,G){var W;let X=V(F);I.position=(W=h0.checkIfMouseEventSnapToPos(G,{ignore:d}))!=null?W:Ss(B+X,0,I.length)},onDragEnd(F){U(!1),h9()},onClick(F){_(F,h.current)}}}}),[l,d]),[E]=eo(d,S);bu(E,"draggingPositionInSequenceEditor","ew-resize"),Up(Dr(l.seeker.isSeeking)||E,-1);let[N]=eze(d,{layoutP:l});return Rr(()=>{let I=(0,df.val)(l.seeker.isSeeking),B=(0,df.val)(l.sheet).getSequence(),V=(0,df.val)(vye(B)),U=B.positionPrism.getValue(),F=(0,df.val)(l.clippedSpace.fromUnitSpace)(U),H=F>=0&&F<=(0,df.val)(l.clippedSpace.width);return Au.default.createElement(Au.default.Fragment,null,N,g,Au.default.createElement(N9,R({isVisible:H,style:{transform:"translate3d(".concat(F,"px, 0, 0)")},className:"".concat(I&&"seeking"," ").concat(V&&"playheadattachedtofocusrange")},rf("hide")),Au.default.createElement(Cq,R({ref:h},h0.includePositionSnapAttrs(U)),Au.default.createElement(oye,{room:8}),Au.default.createElement(Tye,null),Au.default.createElement(Mye,null,B.positionFormatter.formatForPlayhead(B.closestGridPosition(U)))),Au.default.createElement(bye,M(R({},h0.includePositionSnapAttrs(U)),{className:I?"seeking":""}))))},[l,h,g])},Aye=Cye}),I9,ew,$k,Rye,Pye,Nye,Iye,nze=C(()=>{I9=Jt,Qn(),Fe(),A9(),ew=z(Le()),at(),$k=1e3,Pye=me.div(Rye||(Rye=$([`
  position: absolute;
  top: `,`px;
  left: 0;
  opacity: 0.15;
  width: `,`px;
  transform-origin: top left;
  pointer-events: none;
  background-color: `,`;
`])),hf,$k,l=>l.enabled?"#000000":"transparent"),Nye=({layoutP:l})=>{let h=(0,ew.useMemo)(()=>(0,I9.prism)(()=>{let{projectId:d,sheetId:g}=(0,I9.val)(l.sheet).address;return(0,I9.val)(ge().atomP.ahistoric.projects.stateByProjectId[d].stateBySheetId[g].sequence.focusRange)}),[l]);return Rr(()=>{let d=h.getValue();if(!d||!d.enabled)return null;let g=(0,I9.val)(l.rightDims.height)-hf,_=(0,I9.val)(l.clippedSpace.fromUnitSpace),b=(0,I9.val)(l.clippedSpace.width),S=[];{let E=0,N=_(d.range.start),I,B;E>N?(B=0,I=0):(N>b&&(N=b),B=E,I=(N-E)/$k),S.push({translateX:B,scaleX:I})}{let E=_(d.range.end),N=b,I,B;E>N?(B=0,I=0):(E<0&&(E=0),B=E,I=(N-E)/$k),S.push({translateX:B,scaleX:I})}return ew.default.createElement(ew.default.Fragment,null,S.map(({translateX:E,scaleX:N},I)=>ew.default.createElement(Pye,{key:"curtain-".concat(I),enabled:!0,style:{height:"".concat(g,"px"),transform:"translateX(".concat(E,"px) scaleX(").concat(N,")")}})))},[l,h])},Iye=Nye}),Kv,kye,Dye,Fye,Oye,Bye,rze=C(()=>{Kv=z(Le()),at(),Qn(),Fe(),r9(),PH(),Dye=me.div(kye||(kye=$([`
  display: flex;
  gap: 8px;
  /* padding: 4px 8px; */
  height: 28px;
  align-items: center;
`]))),me.div(Fye||(Fye=$([`
  `,`;
  white-space: nowrap;
`])),tg),Oye=({layoutP:l,marker:h})=>{var d;let g=Dr(l.sheet),_=(0,Kv.useMemo)(()=>{let S;return{temporarilySetValue(E){S&&(S.discard(),S=void 0),S=ge().tempTransaction(({stateEditors:N})=>{N.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateMarker({sheetAddress:g.address,markerId:h.id,label:E})})},discardTemporaryValue(){S&&(S.discard(),S=void 0)},permanentlySetValue(E){S&&(S.discard(),S=void 0),ge().transaction(({stateEditors:N})=>{N.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.updateMarker({sheetAddress:g.address,markerId:h.id,label:E})})}}},[l,g]),b=(0,Kv.useRef)(null);return(0,Kv.useLayoutEffect)(()=>{b.current.focus()},[]),Kv.default.createElement(Dye,null,Kv.default.createElement(WN,M(R({value:(d=h.label)!=null?d:""},_),{isValid:()=>!0,inputRef:b})))},Bye=Oye});function ize(l,h){return c0(l,{menuItems(){return[{label:"Remove marker",callback:()=>{ge().transaction(({stateEditors:d})=>{d.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.removeMarker({sheetAddress:h.sheetAddress,markerId:h.markerId})})}}]}})}function sze(l,h){let d=(0,m0.useRef)(h);d.current=h;let g=(0,m0.useMemo)(()=>({debugName:"MarkerDot/useDragMarker (".concat(h.marker.id,")"),onDragStart(b){let S=d.current.marker,E=(0,Hk.val)(h.layoutP.scaledSpace.toUnitSpace),N;return uW(),{onDrag(I,B,V){var U;let F=S,H=Math.max((U=h0.checkIfMouseEventSnapToPos(V,{ignore:l}))!=null?U:F.position+E(I),0);N==null||N.discard(),N=ge().tempTransaction(({stateEditors:G})=>{G.studio.historic.projects.stateByProjectId.stateBySheetId.sequenceEditor.replaceMarkers({sheetAddress:(0,Hk.val)(h.layoutP.sheet.address),markers:[M(R({},F),{position:H})],snappingFunction:(0,Hk.val)(h.layoutP.sheet).getSequence().closestGridPosition})})},onDragEnd(I){I?N==null||N.commit():N==null||N.discard(),h9()}}}}),[]),[_]=eo(l,g);return Up(_,h.marker.position),bu(_,"draggingPositionInSequenceEditor draggingMarker","ew-resize"),[_]}var Hk,m0,Aq,Rq,Lye,Uye,zye,Vye,Gye,jk,$ye,Hye,jye,Wye,qye,Xye,oze=C(()=>{Hk=Jt,Qn(),Fe(),Ec(),u0(),Ti(),m0=z(Le()),at(),nl(),Yo(),jp(),Ph(),KI(),k1e(),d9(),Yd(),Zd(),rze(),Aq=12,Rq=12,Lye=Aq*2,Uye=Rq*2,Vye=me.div(zye||(zye=$([`
  position: absolute;
  // below the sequence ruler "top bar"
  top: 18px;
  z-index: `,`;
`])),()=>ff.marker),jk=me.div(Gye||(Gye=$([`
  position: absolute;
  `,`
  pointer-events: none;
`])),Tu(Aq,Rq)),$ye=m0.default.memo(()=>m0.default.createElement(jk,{children:m0.default.createElement("svg",{width:"100%",height:"100%",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},m0.default.createElement("path",{d:"M12 5H0V7H2.71973L5.96237 10.2426L9.20501 7H12V5Z",fill:"#40AAA4"}))})),jye=me.div(Hye||(Hye=$([`
  z-index: 1;
  cursor: ew-resize;

  `,`

  // :not dragging marker to ensure that markers don't snap to other markers
  // this works because only one marker track (so this technique is not used by keyframes...)
  #pointer-root.draggingPositionInSequenceEditor:not(.draggingMarker) & {
    `,`
  }

  // "All instances of this component <Mark/> inside #pointer-root when it has the .draggingPositionInSequenceEditor class"
  // ref: https://styled-components.com/docs/basics#pseudoelements-pseudoselectors-and-nesting
  #pointer-root.draggingPositionInSequenceEditor:not(.draggingMarker) &,
  #pointer-root.draggingPositionInSequenceEditor
    &.`,` {
    pointer-events: auto;
    cursor: var(`,`);
  }

  &:hover
    + `,`,
    // notice , "or" in CSS
    &.`,`
    + `,` {
    `,`
  }
`])),sf.CSS,sf.CSS_WHEN_SOMETHING_DRAGGING,sf.BEING_DRAGGED_CLASS,Pp,jk,sf.BEING_DRAGGED_CLASS,jk,Tu(Lye,Uye)),Wye=({layoutP:l,markerId:h})=>{let d=Dr(l.sheet.address),g=Dr(ge().atomP.historic.projects.stateByProjectId[d.projectId].stateBySheetId[d.sheetId].sequenceEditor.markerSet.byId[h]);if(!g)return null;let _=Dr(l.clippedSpace.width),b=Dr(l.clippedSpace.fromUnitSpace)(g.position),S=b<=0||b>_,E=S?-1e4:b,N=S?0:1;return m0.default.createElement(Vye,{style:{transform:"translateX(".concat(E,"px) scale(").concat(N,")")}},m0.default.createElement(Xye,{marker:g,layoutP:l}))},qye=Wye,Xye=({layoutP:l,marker:h})=>{let d=Dr(l.sheet.address),[g,_]=vi(null),[b]=ize(_,{sheetAddress:d,markerId:h.id}),[S]=sze(_,{layoutP:l,marker:h}),{node:E,toggle:N,close:I}=Xd({debugName:"MarkerPopover"},()=>m0.default.createElement(Kd,null,m0.default.createElement(Bye,{marker:h,layoutP:l,onRequestClose:I})));return m0.default.createElement(m0.default.Fragment,null,b,E,m0.default.createElement(jye,R({title:h.label?"Marker: ".concat(h.label):"Marker",ref:g,onClick:B=>{N(B,g.current)}},sf.reactProps({isDragging:S,position:h.position}))),m0.default.createElement($ye,null))}}),Wk,Yye,Kye,aze=C(()=>{Qn(),Fe(),Wk=z(Le()),oze(),Yye=({layoutP:l})=>{let h=Dr(l.sheet.address),d=ge().atomP.historic.projects.stateByProjectId[h.projectId].stateBySheetId[h.sheetId].sequenceEditor.markerSet,g=Dr(d.allIds);return Wk.default.createElement(Wk.default.Fragment,null,g&&Object.keys(g).map(_=>Wk.default.createElement(qye,{key:_,layoutP:l,markerId:_})))},Kye=Yye}),Zye,Hp,Qye,Jye,e4e,t4e,lze=C(()=>{jp(),Qn(),Zye=Jt,Hp=z(Le()),at(),HUe(),jUe(),WUe(),tze(),A9(),nze(),aze(),Jye=me.div(Qye||(Qye=$([`
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  z-index: `,`;
  overflow: visible;
  pointer-events: none;
`])),()=>ff.rightOverlay),e4e=({layoutP:l})=>Rr(()=>{let h=(0,Zye.val)(l.rightDims.width);return Hp.default.createElement(Jye,{style:{width:h+"px"}},Hp.default.createElement(Aye,{layoutP:l}),Hp.default.createElement(tye,{layoutP:l}),Hp.default.createElement(H9e,{layoutP:l}),Hp.default.createElement(g9e,{layoutP:l}),Hp.default.createElement(Kye,{layoutP:l}),Hp.default.createElement(O9e,{layoutP:l}),Hp.default.createElement(Iye,{layoutP:l}))},[l]),t4e=e4e}),n4e,qk,r4e,i4e,s4e,o4e,cze=C(()=>{n4e=Jt,Qn(),Fe(),qk=z(Le()),at(),Ev(),nl(),i4e=me.button(r4e||(r4e=$([`
  outline: none;
  background-color: #1c1d21;
  border: 1px solid #191919;
  border-radius: 2px;
  display: flex;
  bottom: 14px;
  right: 8px;
  z-index: 1;
  position: absolute;

  padding: 4px 8px;
  display: flex;
  color: #656d77;
  line-height: 20px;
  font-size: 10px;

  &:hover {
    color: white;
  }

  & > svg {
    transition: transform 0.3s;
    transform: rotateZ(0deg);
  }

  &:hover > svg {
    transform: rotateZ(-20deg);
  }

  &.open > svg {
    transform: rotateZ(-180deg);
  }

  &.open:hover > svg {
    transform: rotateZ(-160deg);
  }
`]))),s4e=({layoutP:l})=>{let h=Dr(l.graphEditorDims.isOpen),d=(0,qk.useCallback)(()=>{let g=(0,n4e.val)(l.graphEditorDims.isOpen);ge().transaction(({stateEditors:_})=>{_.studio.historic.panels.sequenceEditor.graphEditor.setIsOpen({isOpen:!g})})},[l]);return qk.default.createElement(i4e,R({onClick:d,title:"Toggle graph editor",className:h?"open":""},rf("hide")),qk.default.createElement(ZFe,null))},o4e=s4e}),kh,Fs,a4e,l4e,c4e,u4e,ff,h4e,d4e,f4e,p4e,m4e,g4e,y4e,v4e,_4e,jp=C(()=>{Km(),Qn(),Gpe(),kh=Jt,Fs=z(Le()),at(),TUe(),Ik(),DUe(),lze(),Lv(),qfe(),Spe(),nl(),Kr(),bo(),cze(),Ap(),s9(),l4e=me(Yj)(a4e||(a4e=$([`
  z-index: `,`;
  box-shadow: 2px 2px 0 rgb(0 0 0 / 11%);
`])),yv.sequenceEditorPanel),u4e=me.div(c4e||(c4e=$([`
  background-color: rgba(40, 43, 47, 0.99);
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  z-index: -1;
  pointer-events: none;
`]))),ff=(()=>{let l={rightBackground:0,scrollableArea:0,rightOverlay:0,lengthIndicatorCover:0,lengthIndicatorStrip:0,playhead:0,currentFrameStamp:0,marker:0,horizontalScrollbar:0},h=-1;for(let d of Object.keys(l))l[d]=h,h++;return l})(),d4e=me($j)(h4e||(h4e=$([`
  position: absolute;
  left: 0;
  top: 0;
  z-index: 1;
`]))),f4e={edges:{left:{from:"screenLeft",distance:.1},right:{from:"screenRight",distance:.2},top:{from:"screenBottom",distance:.4},bottom:{from:"screenBottom",distance:.01}}},p4e={width:800,height:200},m4e=l=>Fs.default.createElement(Gj,{panelId:"sequenceEditor",defaultPosition:f4e,minDims:p4e},Fs.default.createElement(g4e,null)),g4e=()=>{let{dims:l}=Bv(),[h,d]=(0,Fs.useState)(null);return cue(h),Rr(()=>{let g=kh.prism.memo("panelSize",()=>{let U=l.width,F=l.height;return{width:U,height:F,widthWithoutBorder:U-2,heightWithoutBorder:F-4,screenX:l.left,screenY:l.top}},[l]),_=i0(Ym().filter(U=>vt(U)||Sn(U)).map(U=>Sn(U)?U.sheet:U));if(i0(_.map(U=>U.template)).length!==1)return Fs.default.createElement(Fs.default.Fragment,null);let b=_[0];if(!b)return Fs.default.createElement(Fs.default.Fragment,null);let S=Zj("panelSizeP",g).pointer,E=kh.prism.memo("key",()=>JSON.stringify(b.address),[b]),N=kh.prism.memo("layout",()=>kUe(b,S),[b,S]).getValue();if((0,kh.val)(N.tree.children).length===0)return Fs.default.createElement(Fs.default.Fragment,null);let I=kh.prism.memo("containerRef",_4e,[]),B=(0,kh.val)(N.graphEditorDims.isAvailable),V=(0,kh.val)(N.graphEditorDims.isOpen);return Fs.default.createElement(l4e,{ref:U=>{I(U),U!==h&&d(U)}},Fs.default.createElement(u4e,{style:{width:"".concat((0,kh.val)(N.leftDims.width),"px")}}),Fs.default.createElement(R1e,{layoutP:N},Fs.default.createElement(y4e,{layoutP:N}),Fs.default.createElement(F3e,{key:E+"-dopeSheet",layoutP:N}),V&&Fs.default.createElement(r3e,{key:E+"-graphEditor",layoutP:N}),B&&Fs.default.createElement(o4e,{layoutP:N}),Fs.default.createElement(t4e,{layoutP:N})))},[l,h])},y4e=({layoutP:l})=>Rr(()=>{let h=(0,kh.val)(l.sheet);return Fs.default.createElement(d4e,{style:{width:(0,kh.val)(l.leftDims.width)}},Fs.default.createElement(K$,null,Fs.default.createElement(Xm,null,h.address.sheetId," "),Fs.default.createElement(Wb,null,":",""),Fs.default.createElement(Xm,null,h.address.sheetInstanceId," "),Fs.default.createElement(Wb,null,"",">",""),Fs.default.createElement(Xm,null,"Sequence")))},[l]),v4e=m4e,_4e=()=>{let l=null,h={passive:!1,capture:!1},d=g=>{Math.abs(g.deltaY)<Math.abs(g.deltaX)&&(g.preventDefault(),g.stopPropagation())};return g=>{l!==g&&l&&l.removeEventListener("wheel",d,h),l=g,g&&g.addEventListener("wheel",d,h)}}}),k9,x4e,b4e,uze=C(()=>{dFe(),Uj(),k9=z(Le()),Fe(),Qn(),MBe(),jp(),x4e=()=>{let l=Dr(ge().paneManager.allPanesD),h=Object.entries(l).map(([d,g])=>k9.default.createElement(Vpe,{key:"pane-".concat(d),paneInstance:g}));return k9.default.createElement(k9.default.Fragment,null,h,k9.default.createElement(Pae,null),k9.default.createElement(Gfe,null),k9.default.createElement(v4e,null))},b4e=x4e}),S4e,w4e,T4e,hze=C(()=>{at(),AI(),w4e=me(Dv)(S4e||(S4e=$([`
  --popover-outer-stroke: #e11c1c;
  --popover-inner-stroke: #2c1c1c;
  --popover-bg: #2c1c1c;
  pointer-events: none !important;
`]))),T4e=w4e}),dze=L((l,h)=>{var d,g;d=[],g=[];function _(b,S,E){var N,I,B,V,U,F,H,G;if(b===S)return 0;if(N=b.length,I=S.length,N===0)return I;if(I===0)return N;for(E&&(b=b.toLowerCase(),S=S.toLowerCase()),H=0;H<N;)g[H]=b.charCodeAt(H),d[H]=++H;for(G=0;G<I;)for(B=S.charCodeAt(G),V=U=G++,H=-1;++H<N;)F=B===g[H]?U:U+1,U=d[H],d[H]=V=U>V?F>V?V+1:F:F>U?U+1:F;return V}h.exports=_}),fze=L((l,h)=>{var d=dze();function g(){var _,b,S,E,N,I=0,B=arguments[0],V=arguments[1],U=V.length,F=arguments[2];F&&(E=F.threshold,N=F.ignoreCase),E===void 0&&(E=0);for(var H=0;H<U;++H)N?b=d(B,V[H],!0):b=d(B,V[H]),b>B.length?_=1-b/V[H].length:_=1-b/B.length,_>I&&(I=_,S=V[H]);return I>=E?S:null}h.exports=g});function pze(l,h,d="Did you mean ",g="?"){let _=(0,E4e.default)(l,h,{threshold:.7});return _?d+JSON.stringify(_)+g:""}var E4e,mze=C(()=>{E4e=z(fze())});function M4e(l,h){return l.length<=h?l:l.substr(0,h-3)+"..."}var gze=C(()=>{}),C4e,Pq,A4e=C(()=>{gze(),C4e=l=>typeof l=="string"?'string("'.concat(M4e(l,10),'")'):typeof l=="number"?"number(".concat(M4e(String(l),10),")"):l===null?"null":l===void 0?"undefined":typeof l=="boolean"?String(l):Array.isArray(l)?"array":typeof l=="object"?"object":"unknown",Pq=C4e}),R4e,P4e,Nq,N4e=C(()=>{at(),e9(),P4e=me(doe)(R4e||(R4e=$([`
  display: flex;
  height: fit-content;
  backdrop-filter: blur(14px);
  border-radius: 2px;
`]))),Nq=P4e}),Zv,I4e,k4e,D4e,Qv,tw=C(()=>{at(),Ei(),Zv=z(Le()),wS(),GN(),Gde(),N4e(),k4e=me.button(I4e||(I4e=$([`
  `,`;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 600;
  width: 32px;
  height: 32px;
  outline: none;

  color: #a8a8a9;

  background: rgba(40, 43, 47, 0.8);
  backdrop-filter: blur(14px);
  border: none;
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 2px;

  svg {
    display: block;
  }

  &:hover {
    background: rgba(59, 63, 69, 0.8);
  }

  &:active {
    background: rgba(82, 88, 96, 0.8);
  }

  &.selected {
    color: rgba(255, 255, 255, 0.8);
    border-bottom: 1px solid rgba(255, 255, 255, 0.7);
  }

  // Don't blur if in a button group, because it already blurs. We need to blur
  // on the group-level, otherwise we get seams.
  `,` > & {
    backdrop-filter: none;
    filter: none;
    border-radius: 0;

    &:first-child {
      border-top-left-radius: 2px;
      border-bottom-left-radius: 2px;
    }

    &:last-child {
      border-bottom-right-radius: 2px;
      border-top-right-radius: 2px;
    }
  }

  @supports not (backdrop-filter: blur()) {
    background: rgba(40, 43, 47, 0.95);
  }
`])),Si,Nq),D4e=Zv.default.forwardRef((l,h)=>{var d=l,{title:g}=d,_=O(d,["title"]);let[b,S]=kv({enabled:typeof g=="string"},()=>Zv.default.createElement(Pj,null,g));return Zv.default.createElement(Zv.default.Fragment,null,b,Zv.default.createElement(k4e,R({ref:VN([S,h])},_))," ")}),Qv=D4e}),F4e,O4e,B4e,L4e,U4e,yze=C(()=>{F4e=z(Le()),tw(),at(),Ei(),B4e=me(Qv)(O4e||(O4e=$([`
  `,`;
  & > svg {
    width: 1em;
    height: 1em;
    pointer-events: none;
  }
`])),Si),L4e=({config:l,testId:h})=>{var d;return F4e.default.createElement(B4e,{onClick:l.onClick,"data-testid":h,title:l.title,dangerouslySetInnerHTML:{__html:(d=l.svgSource)!=null?d:""}})},U4e=L4e});function vze({value:l,label:h,icon:d,onClick:g,isSelected:_}){return Jv.default.createElement(Jv.default.Fragment,null,Jv.default.createElement(Qv,{forwardedAs:coe,className:_?"selected":void 0,"aria-label":h,onClick:g,title:h},d))}var Jv,z4e,V4e,_ze=C(()=>{Jv=z(Le()),e9(),tw(),N4e(),z4e=({value:l,onChange:h,options:d})=>Jv.default.createElement(Nq,null,d.map(({label:g,icon:_,value:b})=>Jv.default.createElement(vze,{key:b,value:b,isSelected:l===b,label:g,icon:_,onClick:()=>h(b)}))),V4e=z4e}),Iq,G4e,$4e,H4e,j4e,xze=C(()=>{Iq=z(Le()),at(),Ei(),_ze(),$4e=me.div(G4e||(G4e=$([`
  `,`;
  & > svg {
    width: 1em;
    height: 1em;
    pointer-events: none;
  }
`])),Si),H4e=({config:l})=>Iq.default.createElement(V4e,{onChange:l.onChange,options:l.options.map(({label:h,value:d,svgSource:g})=>({label:h,value:d,icon:Iq.default.createElement($4e,{dangerouslySetInnerHTML:{__html:g}})})),value:l.value}),j4e=H4e}),nw,W4e,q4e,X4e,Y4e,bze=C(()=>{nw=z(Le()),at(),Ei(),tw(),Jce(),Yd(),q4e=me.div(W4e||(W4e=$([`
  `,`;
  & > svg {
    width: 1em;
    height: 1em;
    pointer-events: none;
  }
`])),Si),X4e=({config:l})=>{let h=(0,nw.useRef)(null),d=Xd(()=>{let g=h.current.getBoundingClientRect();return{debugName:"ExtensionFlyoutMenu:"+l.label,constraints:{maxX:g.right,maxY:8,minX:g.left,minY:8},verticalGap:2}},()=>nw.default.createElement(sj,{items:l.items.map((g,_)=>({label:g.label,callback:()=>{var b;try{(b=g.onClick)==null||b.call(g)}catch(S){console.error(S)}}})),onRequestClose:()=>{d.close("clicked")}}));return nw.default.createElement(q4e,null,d.node,nw.default.createElement(Qv,{ref:h,onClick:g=>{d.open(g,h.current)}},l.label))},Y4e=X4e});function Sze(l){return kq[l]}var rw,K4e,kq,Z4e,Q4e,wze=C(()=>{mze(),A4e(),rw=z(Le()),yze(),xze(),bze(),K4e=l=>rw.default.createElement(rw.default.Fragment,null,l.config.map((h,d)=>rw.default.createElement(Z4e,{config:h,key:d}))),kq={Icon:U4e,Switch:j4e,Flyout:Y4e},Z4e=({config:l})=>{let h=Sze(l.type);if(!h)throw new Error("No tool with tool.type ".concat(Pq(l.type)," exists. Did you mean ").concat(pze(l.type,Object.keys(kq))));return rw.default.createElement(h,{config:l})},Q4e=K4e}),J4e,pf,e5e,t5e,n5e,Dq,r5e,i5e,Fq,s5e=C(()=>{J4e=Jt,Qn(),Fe(),pf=z(Le()),at(),wze(),t5e=me.div(e5e||(e5e=$([`
  height: 36px;
  /* pointer-events: none; */

  display: flex;
  gap: 0.5rem;
  justify-content: center;
`]))),Dq=me.div(n5e||(n5e=$([`
  position: abolute;
  height: 32px;
  width: 1px;
  background: #373b40;
  opacity: 0.4;
`]))),r5e=({extension:l,toolbarId:h})=>{var d;let g=(0,pf.useMemo)(()=>new J4e.Atom([]),[]),_=(d=l.toolbars)==null?void 0:d[h];(0,pf.useLayoutEffect)(()=>{let S=_==null?void 0:_(g.set.bind(g),ge().publicApi);if(typeof S=="function")return S},[l,h,_]);let b=Dr(g.prism);return pf.default.createElement(Q4e,{config:b})},i5e=({toolbarId:l,showLeftDivider:h})=>{var d;let g=[],_=Dr(ge().atomP.ephemeral.extensions.byId),b=!1;for(let[,S]of Object.entries(_))!S||!((d=S.toolbars)!=null&&d[l])||(g.push(pf.default.createElement(pf.default.Fragment,{key:"extensionToolbar-"+S.id},b?pf.default.createElement(Dq,null):void 0,pf.default.createElement(r5e,{extension:S,toolbarId:l}))),b=!0);return g.length===0?null:pf.default.createElement(t5e,{"data-testid":"theatre-extensionToolbar-".concat(l)},h?pf.default.createElement(Dq,null):void 0,g)},Fq=i5e}),iw,o5e,a5e,l5e,Xk,Tze=C(()=>{at(),iw=z(Le()),tw(),a5e=me(Qv)(o5e||(o5e=$([`
  color: `,`;

  border-bottom: 1px solid
    `,`;
`])),({pinned:l})=>l?"rgba(255, 255, 255, 0.8)":"#A8A8A9",({pinned:l})=>l?"rgba(255, 255, 255, 0.7)":"rgba(255, 255, 255, 0.08)"),l5e=(0,iw.forwardRef)((l,h)=>{var d=l,{children:g,hint:_,pinned:b,icon:S,pinHintIcon:E,unpinHintIcon:N}=d,I=O(d,["children","hint","pinned","icon","pinHintIcon","unpinHintIcon"]);let[B,V]=(0,iw.useState)(!1),U=B||_;return iw.default.createElement(a5e,M(R({},I),{pinned:b,ref:h,onMouseOver:()=>V(!0),onMouseOut:()=>V(!1)}),iw.default.createElement("div",{style:{pointerEvents:"none",width:"fit-content",height:"fit-content",inset:0}},U&&!b?E:U&&b?N:S),g)}),Xk=l5e});function Eze(l){return Oq.createElement("svg",R({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l),Oq.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.732 4.048l-.792-.792L7.2 8l4.74 4.744.792-.792L8.781 8l3.951-3.952zm-3.932 0l-.792-.792L3.268 8l4.74 4.744.792-.792L4.848 8 8.8 4.048z",fill:"currentColor"}))}var Oq,Bq,Mze=C(()=>{Oq=z(Le()),Bq=Eze});function Cze(l){return Lq.createElement("svg",R({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l),Lq.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.694 3.765l.792-.792 4.74 4.744-4.74 4.744-.792-.793 3.951-3.951-3.951-3.952zm3.932 0l.792-.792 4.74 4.744-4.74 4.744-.792-.793 3.952-3.951-3.952-3.952z",fill:"currentColor"}))}var Lq,Uq,Aze=C(()=>{Lq=z(Le()),Uq=Cze}),Zo,c5e,u5e,h5e,zq,d5e,_g,f5e,p5e,m5e,g5e,y5e,v5e,_5e,x5e,b5e,Yk,S5e,w5e,Vq,Gq,T5e,E5e,Rze=C(()=>{Qn(),Fe(),Zo=z(Le()),at(),u5e=me.div(c5e||(c5e=$([`
  width: 138px;
  border-radius: 2px;
  background-color: rgba(42, 45, 50, 0.9);
  position: absolute;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  box-shadow: 0px 1px 1px rgba(0, 0, 0, 0.25), 0px 2px 6px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(14px);
  pointer-events: auto;
  // makes the edges of the item highlights match the rounded corners
  overflow: hidden;

  @supports not (backdrop-filter: blur()) {
    background-color: rgba(42, 45, 50, 0.98);
  }

  color: rgba(255, 255, 255, 0.9);

  & a {
    // Fix colors of links to not be default
    color: inherit;
  }
`]))),zq=me.div(h5e||(h5e=$([`
  position: relative;
  padding: 0px 12px;
  font-weight: 400;
  font-size: 11px;
  height: 32px;
  text-decoration: none;
  user-select: none;
  display: flex;
  flex-direction: row;
  align-items: center;
  cursor: default;
`]))),_g=me(zq)(d5e||(d5e=$([`
  &:before {
    position: absolute;
    display: block;
    content: ' ';
    inset: 3px;
    border-radius: 3px;
    background: rgba(255, 255, 255, 0.1);
    opacity: 0;
  }

  &.secondary {
    color: rgba(255, 255, 255, 0.5);
  }

  &:hover {
    /* background-color: #398995; */
    color: white !important;
    &:before {
      opacity: 1;
    }
  }
`]))),p5e=me(zq)(f5e||(f5e=$([`
  height: auto;
  min-height: 32px;
  padding-top: 12px;
  padding-bottom: 10px;
  flex-direction: column;
  justify-content: flex-start;
  align-items: stretch;
  gap: 8px;
  color: rgba(255, 255, 255, 0.5);
`]))),g5e=me.div(m5e||(m5e=$([`
  font-weight: 600;
`]))),v5e=me.div(y5e||(y5e=$([`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
`]))),x5e=me.div(_5e||(_5e=$([`
  margin-left: 2px;
`]))),Yk=me.div(b5e||(b5e=$([`
  height: 1px;
  margin: 0 2px;
  background: rgba(255, 255, 255, 0.02);
`]))),w5e=me.div(S5e||(S5e=$([`
  position: absolute;
  width: 8px;
  height: 8px;
  background: #40aaa4;
  right: 14px;
  top: 12px;
  border-radius: 50%;
`]))),Vq="0.7.2",Gq=Vq.match(/^[^\-]+/)[0],T5e=Zo.default.forwardRef((l,h)=>{let d=Dr(ge().atomP.ahistoric.updateChecker.result.hasUpdates);return Zo.default.createElement(u5e,{ref:h},Zo.default.createElement(_g,{as:"a",href:"https://www.theatrejs.com/docs/latest",className:"",target:"_blank"},"Docs"),Zo.default.createElement(_g,{as:"a",href:"https://www.theatrejs.com/docs/latest/releases",className:"",target:"_blank"},"Changelog"),Zo.default.createElement(Yk,null),Zo.default.createElement(_g,{as:"a",href:"https://github.com/theatre-js/theatre",className:"",target:"_blank"},"Github"),Zo.default.createElement(_g,{as:"a",href:"https://twitter.com/theatre_js",className:"",target:"_blank"},"Twitter"),Zo.default.createElement(_g,{className:"",as:"a",href:"https://discord.gg/bm9f8F9Y9N",target:"_blank"},"Discord"),Zo.default.createElement(Yk,null),Zo.default.createElement(p5e,null,Zo.default.createElement(g5e,null,"Version"),Zo.default.createElement(v5e,null,Zo.default.createElement(x5e,null,Vq," ",d===!0?"(outdated)":d===!1?"(latest)":""))),d===!0&&Zo.default.createElement(Zo.default.Fragment,null,Zo.default.createElement(Yk,null),Zo.default.createElement(_g,{as:"a",href:"https://www.theatrejs.com/docs/latest/releases".concat(encodeURIComponent(Gq)),className:"",target:"_blank"},"Update",Zo.default.createElement(w5e,null)),Zo.default.createElement(_g,{as:"a",href:"https://www.theatrejs.com/docs/latest/releases#".concat(encodeURIComponent(Gq)),className:"",target:"_blank"},"What's new?")))}),E5e=T5e}),ss,M5e,C5e,A5e,R5e,P5e,N5e,$q,I5e,Hq,k5e,jq,D5e,F5e,Pze=C(()=>{Qn(),Fe(),ss=z(Le()),at(),wS(),hze(),AI(),M5e=Jt,s5e(),Tze(),qb(),Mze(),Aze(),tw(),Yd(),Rze(),IS(),A5e=me.div(C5e||(C5e=$([`
  height: 36px;
  pointer-events: none;

  display: flex;
  justify-content: space-between;
  padding: 12px;
`]))),P5e=me.div(R5e||(R5e=$([`
  color: white;
  width: 14px;
  height: 14px;
  background: #d00;
  border-radius: 4px;
  text-align: center;
  line-height: 14px;
  font-weight: 600;
  font-size: 8px;
  position: relative;
  left: -6px;
  top: -11px;
  margin-right: -14px;
  box-shadow: 0 4px 6px -4px #00000059;
`]))),$q=me.div(N5e||(N5e=$([`
  display: flex;
  gap: 8px;
`]))),Hq=me.div(I5e||(I5e=$([`
  position: absolute;
  background: `,`;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  right: -2px;
  top: -2px;
`])),({type:l})=>l==="info"?"#40aaa4":"#f59e0b"),me.div(k5e||(k5e=$([`
  position: absolute;
  height: 32px;
  width: 1px;
  background: #373b40;
  opacity: 0.4;
`]))),jq=!1,D5e=()=>{var l,h,d;let g=Rr(()=>{let G=(0,M5e.val)(ge().atomP.ephemeral.coreByProject);return Object.entries(G).map(([W,X])=>({projectId:W,state:X})).filter(({state:W})=>W.loadingState.type==="browserStateIsNotBasedOnDiskState")},[]),[_,b]=kv({enabled:g.length>0,enterDelay:g.length>0?0:200},()=>g.length>0?ss.default.createElement(T4e,null,g.length===1?'There is a state conflict in project "'.concat(g[0].projectId,'". Select the project in the outline below in order to fix it.'):"There are ".concat(g.length," projects that have state conflicts. They are highlighted in the outline below. ")):ss.default.createElement(Dv,null,ss.default.createElement(ss.default.Fragment,null,"Outline"))),S=(l=Dr(ge().atomP.ahistoric.pinOutline))!=null?l:!0,E=(h=Dr(ge().atomP.ahistoric.pinDetails))!=null?h:!0,N=Dr(ge().atomP.ahistoric.updateChecker.result.hasUpdates)===!0,I=Xd(()=>{let G=B.current.getBoundingClientRect();return{debugName:"More Menu",constraints:{maxX:G.right,maxY:8,minX:G.left-140,minY:8},verticalGap:2}},()=>ss.default.createElement(E5e,null)),B=(0,ss.useRef)(null),V=(0,ss.useMemo)(()=>(window.__IS_VISUAL_REGRESSION_TESTING&&(jq||(jq=!0,console.warn("Visual regression testing enabled, so we're showing the updates badge unconditionally"))),N||window.__IS_VISUAL_REGRESSION_TESTING?!0:N),[N]),{hasNotifications:U}=kj(),[F,H]=ufe();return ss.default.createElement(A5e,null,ss.default.createElement($q,null,_,ss.default.createElement(Xk,{ref:b,"data-testid":"OutlinePanel-TriggerButton",onClick:()=>{ge().transaction(({stateEditors:G,drafts:W})=>{var X;G.studio.ahistoric.setPinOutline(!((X=W.ahistoric.pinOutline)==null||X))})},icon:ss.default.createElement(Q$,null),pinHintIcon:ss.default.createElement(Uq,null),unpinHintIcon:ss.default.createElement(Bq,null),pinned:S}),g.length>0?ss.default.createElement(P5e,null,g.length):null,ss.default.createElement(Fq,{showLeftDivider:!0,toolbarId:"global"})),ss.default.createElement($q,null,F,ss.default.createElement(Xk,{ref:H,onClick:()=>{ge().transaction(({stateEditors:G,drafts:W})=>{var X;G.studio.ahistoric.setPinNotifications(!((X=W.ahistoric.pinNotifications)!=null&&X))})},icon:ss.default.createElement(ON,null),pinHintIcon:ss.default.createElement(ON,null),unpinHintIcon:ss.default.createElement(ON,null),pinned:(d=Dr(ge().atomP.ahistoric.pinNotifications))!=null?d:!1},U&&ss.default.createElement(Hq,{type:"warning"})),I.node,ss.default.createElement(Qv,{ref:B,onClick:G=>{I.toggle(G,B.current)}},ss.default.createElement(Roe,null),V&&ss.default.createElement(Hq,{type:"info"})),ss.default.createElement(Xk,{ref:b,onClick:()=>{ge().transaction(({stateEditors:G,drafts:W})=>{var X;G.studio.ahistoric.setPinDetails(!((X=W.ahistoric.pinDetails)==null||X))})},icon:ss.default.createElement(Aoe,null),pinHintIcon:ss.default.createElement(Bq,null),unpinHintIcon:ss.default.createElement(Uq,null),pinned:E})))},F5e=D5e}),O5e,sw,B5e,ow,L5e,U5e,z5e,V5e,G5e=C(()=>{O5e=Jt,Qn(),sw=z(Le()),B5e=z(gu()),ow=new O5e.Atom({set:{},byId:{}}),L5e=1,U5e=()=>{let l=L5e++;function h(g,_,b){ow.reduce(S=>({byId:M(R({},S.byId),{[l]:{comp:g,props:_,portalNode:b}}),set:M(R({},S.set),{[l]:!0})}))}function d(){ow.reduce(g=>{let _=R({},g.set),b=R({},g.byId);return delete _[l],{byId:b,set:_}})}return{mountOrRender:h,unmount:d}},z5e=()=>{let l=Object.keys(Dr(ow.pointer.set));return sw.default.createElement(sw.default.Fragment,null,l.map(h=>sw.default.createElement(V5e,{key:"id-"+h,id:h})))},V5e=({id:l})=>{let{comp:h,portalNode:d,props:g}=Dr(ow.pointer.byId[l]);return(0,B5e.createPortal)(sw.default.createElement(h,R({},g)),d)}});function Nze(l){let h=ge(),[d,g]=vi(void 0),_=O3e();_.configureLogging({min:128,dev:qq,internal:qq});let b=_.getLogger().named("Theatre.js UIRoot");JUe();let S=Dr(h.atomP.ahistoric.visibilityState);return(0,sl.useEffect)(()=>(S==="everythingIsHidden"&&console.warn("Theatre.js Studio is hidden. Use the keyboard shortcut 'alt + \\' to restore the studio, or call studio.ui.restore()."),()=>{}),[S]),Rr(()=>{let E=(0,Wq.val)(h.atomP.ahistoric.visibilityState);return(0,Wq.val)(h.atomP.ephemeral.initialised)?sl.default.createElement(Wae,{logger:b},sl.default.createElement(Xhe,null,sl.default.createElement(yFe,null,sl.default.createElement(X5e,null),sl.default.createElement(mv.Provider,{value:g},sl.default.createElement(Y$,{target:window.__IS_VISUAL_REGRESSION_TESTING===!0?void 0:l.containerShadow},sl.default.createElement(sl.default.Fragment,null,sl.default.createElement(H5e,null),sl.default.createElement(W5e,{className:E==="everythingIsHidden"?"invisible":""},sl.default.createElement(X$,{ref:d}),sl.default.createElement(F5e,null),sl.default.createElement(b4e,null),sl.default.createElement(hfe,null)))))))):null},[h,d,g])}var Wq,sl,$5e,H5e,j5e,W5e,q5e,qq,X5e,Ize=C(()=>{Fe(),Qn(),Wq=Jt,sl=z(Le()),at(),uze(),Pze(),Ti(),e9(),Mq(),Ec(),Yhe(),xH(),G5e(),Ei(),Fk(),Qm(),IS(),H5e=typeof window<"u"?tv($5e||($5e=$([`
  :host {
    contain: strict;
  }
`]))):{},W5e=me(jae)(j5e||(j5e=$([`
  z-index: 50;
  position: fixed;
  inset: 0;

  &.invisible {
    pointer-events: none !important;
    opacity: 0;
    transform: translateX(1000000px);
  }
`]))),qq=/Playground.+Theatre\.js/.test((q5e=typeof document<"u"?document==null?void 0:document.title:null)!=null?q5e:""),X5e=()=>sl.default.createElement(z5e,null)}),kze=L(l=>{var h=gu();l.createRoot=h.createRoot,l.hydrateRoot=h.hydrateRoot}),Y5e={};Y(Y5e,{default:()=>Q5e});var K5e,Z5e,Q5e,Dze=C(()=>{Ize(),K5e=z(Le()),Z5e=z(kze()),G5e(),Ei(),s5e(),Q5e=class{constructor(){K(this,"containerEl",document.createElement("div")),K(this,"_renderTimeout"),K(this,"_documentBodyUIIsRenderedIn"),K(this,"containerShadow"),this.containerEl.id="theatrejs-studio-root",this.containerEl.style.cssText=`
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      pointer-events: none;
      z-index: 100;
    `;let l=()=>{if(window.__IS_VISUAL_REGRESSION_TESTING===!0){let h=document.createElement("div");return h.id="theatrejs-faux-shadow-root",document.body.appendChild(h),h}else return this.containerEl.attachShadow({mode:"open"})};this.containerShadow=l()}render(){let l=()=>{if(!document.body){this._renderTimeout=setTimeout(l,5);return}this._renderTimeout=void 0,this._documentBodyUIIsRenderedIn=document.body,this._documentBodyUIIsRenderedIn.appendChild(this.containerEl),Z5e.default.createRoot(this.containerShadow).render(K5e.default.createElement(Nze,{containerShadow:this.containerShadow}))};this._renderTimeout=setTimeout(l,10)}renderToolset(l,h){let d=U5e();return d.mountOrRender(UDe(Fq),{toolbarId:l},h),d.unmount}}}),Fze=L(l=>{l.compare=_,l.reduce=b;var h,d,g;l.REMOVE=h=-1,l.ADD=d=1,l.EQUAL=g=0;function _(B,V){var U=B.length,F=V.length,H=S(B,V),G=H<U&&H<F?E(B,V):0,W=G+H-1;U-=W,F-=W;for(var X=I(U,F),Z=U-1;Z>=0;--Z)for(var te=F-1;te>=0;--te)X[te][Z]=N(X,B,V,H,Z,te);return{prefix:H,matrix:X,suffix:G}}function b(B,V,U){var F,H,G,W,X=U.matrix,Z=U.prefix;for(F=0;F<Z;++F)V=B(V,g,F,F);for(G=F,Z=X.length,F=0,H=0;F<Z;)switch(W=X[F][H].type,V=B(V,W,F+G,H+G),W){case g:++F,++H;break;case h:++H;break;case d:++F;break}for(F+=G,H+=G,Z=U.suffix,G=0;G<Z;++G)V=B(V,g,F+G,H+G);return V}function S(B,V){for(var U=0,F=Math.min(B.length,V.length);U<F&&B[U]===V[U];)++U;return U}function E(B,V){for(var U=B.length-1,F=V.length-1,H=Math.min(U,F),G=0;G<H&&B[U-G]===V[F-G];)++G;return G}function N(B,V,U,F,H,G){return V[H+F]===U[G+F]?{value:B[G+1][H+1].value,type:g}:B[G][H+1].value<B[G+1][H].value?{value:B[G][H+1].value+1,type:h}:{value:B[G+1][H].value+1,type:d}}function I(B,V){var U=[],F,H,G;for(G=U[V]=[],H=0;H<B;++H)G[H]={value:B-H,type:h};for(F=0;F<V;++F)U[F]=[],U[F][B]={value:V-F,type:d};return U[V][B]={value:0,type:g},U}}),J5e=L(l=>{l.cons=h,l.tail=d,l.map=g;function h(_,b){var S=b.length,E=new Array(S+1);E[0]=_;for(var N=0;N<S;++N)E[N+1]=b[N];return E}function d(_){for(var b=_.length-1,S=new Array(b),E=0;E<b;++E)S[E]=_[E+1];return S}function g(_,b){for(var S=new Array(b.length),E=0;E<b.length;++E)S[E]=_(b[E]);return S}}),Oze=L((l,h)=>{h.exports=S;var d=/\/|~1|~0/g,g="/",_="~",b="~1";function S(E,N){var I,B,V,U;for(I=E.charAt(0)===g?1:0,B="",d.lastIndex=I;V=d.exec(E);)if(U=V[0],B+=E.slice(I,d.lastIndex-U.length),I=d.lastIndex,U===g){if(N(B)===!1)return E;B=""}else B+=U===b?g:_;return B+=E.slice(I),N(B),E}}),Xq=L(l=>{var h=Oze();l.find=B,l.join=U,l.absolute=V,l.parse=F,l.contains=H,l.encodeSegment=W,l.decodeSegment=G,l.parseArrayIndex=te,l.isValidArrayIndex=Z;var d="/",g=/\//g,_="~1",b=/~1/g,S="~",E=/~/g,N="~0",I=/~0/g;function B(oe,ue,Ee,Ie){if(typeof ue=="string"){if(ue==="")return{target:oe,key:void 0};if(ue===d)return{target:oe,key:""};var _e=oe,Oe,ot=Ie!==void 0;return h(ue,function(de){if(oe==null)return _e=null,!1;Array.isArray(oe)?Oe=ot?ae(Ee,te(de),oe,Ie):de==="-"?de:te(de):Oe=de,_e=oe,oe=oe[Oe]}),_e===null?void 0:{target:_e,key:Oe}}}function V(oe){return oe[0]===d?oe:d+oe}function U(oe){return oe.join(d)}function F(oe){var ue=[];return h(oe,ue.push.bind(ue)),ue}function H(oe,ue){return ue.indexOf(oe)===0&&ue[oe.length]===d}function G(oe){return oe.replace(b,d).replace(I,S)}function W(oe){return oe.replace(E,N).replace(g,_)}var X=/^(0|[1-9]\d*)$/;function Z(oe){return X.test(oe)}function te(oe){if(Z(oe))return+oe;throw new SyntaxError("invalid array index "+oe)}function ae(oe,ue,Ee,Ie){var _e=ue;if(_e<0)throw new Error("array index out of bounds "+_e);if(Ie!==void 0&&typeof oe=="function"&&(_e=oe(ue,Ee,Ie),_e<0))throw new Error("could not find patch context "+Ie);return _e}}),eve=L((l,h)=>{h.exports=d;function d(b){return b==null||typeof b!="object"?b:Array.isArray(b)?g(b):_(b)}function g(b){for(var S=b.length,E=new Array(S),N=0;N<S;++N)E[N]=d(b[N]);return E}function _(b){for(var S=Object.keys(b),E={},N,I=0,B=S.length;I<B;++I)N=S[I],E[N]=d(b[N]);return E}}),Bze=L((l,h)=>{h.exports=d;function d(b,S){return b===S?!0:Array.isArray(b)&&Array.isArray(S)?g(b,S):typeof b=="object"&&typeof S=="object"?_(b,S):!1}function g(b,S){if(b.length!==S.length)return!1;for(var E=0;E<b.length;++E)if(!d(b[E],S[E]))return!1;return!0}function _(b,S){if(b===null&&S!==null||b!==null&&S===null)return!1;var E=Object.keys(b),N=Object.keys(S);if(E.length!==N.length)return!1;for(var I=0,B;I<E.length;++I)if(B=E[I],!(B in S&&d(b[B],S[B])))return!1;return!0}}),Lze=L((l,h)=>{var d=Xq();h.exports=function(B,V){var U=d.parse(B.path),F=d.parse(V.path),H=N(U,F),G=b(U,F,H.length),W=I(B),X=I(V);return H.length===0&&!G?[X,W]:G?_(W,U,X,F):g(W,U,X)};function g(B,V,U,F){if(B.path===U.path)throw new TypeError("cannot commute "+B.op+","+U.op+" with identical object paths");return[U,B]}function _(B,V,U,F){return V.length===F.length?S(B,V,U,F):(V.length>F.length?(V=E(U,F,B,V,-1),B.path=d.absolute(d.join(V))):(F=E(B,V,U,F,1),U.path=d.absolute(d.join(F))),[U,B])}function b(B,V,U){return d.isValidArrayIndex(B[U])&&d.isValidArrayIndex(V[U])}function S(B,V,U,F){var H=V.length-1,G=+V[H],W=+F[H],X;return G<W?B.op==="add"||B.op==="copy"?(X=F.slice(),X[H]=Math.max(0,W-1),U.path=d.absolute(d.join(X))):B.op==="remove"&&(X=F.slice(),X[H]=W+1,U.path=d.absolute(d.join(X))):U.op==="add"||U.op==="copy"?(X=V.slice(),X[H]=G+1,B.path=d.absolute(d.join(X))):G>W&&U.op==="remove"&&(X=V.slice(),X[H]=Math.max(0,G-1),B.path=d.absolute(d.join(X))),[U,B]}function E(B,V,U,F,H){var G=V.length-1,W=+V[G],X=+F[G],Z=F.slice();return W>X||(B.op==="add"||B.op==="copy"?Z[G]=Math.max(0,X-H):B.op==="remove"&&(Z[G]=Math.max(0,X+H))),Z}function N(B,V){var U=B.length,F=V.length;if(U===0||F===0||U<2&&F<2)return[];for(var H=U===F?U-1:Math.min(U,F),G=0;G<H&&B[G]===V[G];)++G;return B.slice(0,G)}function I(B){return B.op==="remove"?{op:B.op,path:B.path}:B.op==="copy"||B.op==="move"?{op:B.op,path:B.path,from:B.from}:{op:B.op,path:B.path,value:B.value}}}),tve=L((l,h)=>{h.exports=d;function d(g){Error.call(this),this.name=this.constructor.name,this.message=g,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,this.constructor)}d.prototype=Object.create(Error.prototype),d.prototype.constructor=d}),Yq=L((l,h)=>{h.exports=d;function d(g){Error.call(this),this.name=this.constructor.name,this.message=g,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,this.constructor)}d.prototype=Object.create(Error.prototype),d.prototype.constructor=d}),nve=L((l,h)=>{h.exports=d;function d(g){Error.call(this),this.name=this.constructor.name,this.message=g,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,this.constructor)}d.prototype=Object.create(Error.prototype),d.prototype.constructor=d}),rve=L(l=>{var h=Xq(),d=eve(),g=Bze(),_=Lze(),b=J5e(),S=tve(),E=Yq(),N=nve(),I=h.find,B=h.parseArrayIndex;l.test={apply:V,inverse:U,commute:F},l.add={apply:H,inverse:W,commute:X},l.remove={apply:oe,inverse:Ee,commute:Ie},l.replace={apply:Z,inverse:te,commute:ae},l.move={apply:_e,inverse:Oe,commute:ot},l.copy={apply:de,inverse:Be,commute:X};function V(ke,Re,Ze){var Pt=I(ke,Re.path,Ze.findContext,Re.context),pe=Pt.target,xe,ct;if(Array.isArray(pe)?(xe=B(Pt.key),ct=pe[xe]):ct=Pt.key===void 0?Pt.target:Pt.target[Pt.key],!g(ct,Re.value))throw new S("test failed "+JSON.stringify(Re));return ke}function U(ke,Re){return ke.push(Re),1}function F(ke,Re){if(ke.path===Re.path&&Re.op==="remove")throw new TypeError("Can't commute test,remove -> remove,test for same path");return Re.op==="test"||Re.op==="replace"?[Re,ke]:_(ke,Re)}function H(ke,Re,Ze){var Pt=I(ke,Re.path,Ze.findContext,Re.context);if(re(Pt))throw new E("path does not exist "+Re.path);if(Re.value===void 0)throw new E("missing value");var pe=d(Re.value);return Pt.key===void 0?pe:(G(Pt,pe),ke)}function G(ke,Re){var Ze=ke.target;if(Array.isArray(Ze))if(ke.key==="-")Ze.push(Re);else{if(ke.key>Ze.length)throw new E("target of add outside of array bounds");Ze.splice(ke.key,0,Re)}else if(nn(Ze))Ze[ke.key]=Re;else throw new E("target of add must be an object or array "+ke.key)}function W(ke,Re){var Ze=Re.context;return Ze!==void 0&&(Ze={before:Ze.before,after:b.cons(Re.value,Ze.after)}),ke.push({op:"test",path:Re.path,value:Re.value,context:Ze}),ke.push({op:"remove",path:Re.path,context:Ze}),1}function X(ke,Re){if(ke.path===Re.path&&Re.op==="remove")throw new TypeError("Can't commute add,remove -> remove,add for same path");return _(ke,Re)}function Z(ke,Re,Ze){var Pt=I(ke,Re.path,Ze.findContext,Re.context);if(re(Pt)||Ye(Pt))throw new E("path does not exist "+Re.path);if(Re.value===void 0)throw new E("missing value");var pe=d(Re.value);if(Pt.key===void 0)return pe;var xe=Pt.target;return Array.isArray(xe)?xe[B(Pt.key)]=pe:xe[Pt.key]=pe,ke}function te(ke,Re,Ze,Pt){var pe=Pt[Ze-1];if(pe===void 0||pe.op!=="test"||pe.path!==Re.path)throw new N("cannot invert replace w/o test");var xe=pe.context;return xe!==void 0&&(xe={before:xe.before,after:b.cons(pe.value,b.tail(xe.after))}),ke.push({op:"test",path:pe.path,value:Re.value}),ke.push({op:"replace",path:pe.path,value:pe.value}),2}function ae(ke,Re){if(ke.path===Re.path&&Re.op==="remove")throw new TypeError("Can't commute replace,remove -> remove,replace for same path");return Re.op==="test"||Re.op==="replace"?[Re,ke]:_(ke,Re)}function oe(ke,Re,Ze){var Pt=I(ke,Re.path,Ze.findContext,Re.context);if(re(Pt)||Pt.target[Pt.key]===void 0)throw new E("path does not exist "+Re.path);return ue(Pt),ke}function ue(ke){var Re=ke.target,Ze;if(Array.isArray(Re))return Ze=Re.splice(B(ke.key),1),Ze[0];if(nn(Re))return Ze=Re[ke.key],delete Re[ke.key],Ze;throw new E("target of remove must be an object or array")}function Ee(ke,Re,Ze,Pt){var pe=Pt[Ze-1];if(pe===void 0||pe.op!=="test"||pe.path!==Re.path)throw new N("cannot invert remove w/o test");var xe=pe.context;return xe!==void 0&&(xe={before:xe.before,after:b.tail(xe.after)}),ke.push({op:"add",path:pe.path,value:pe.value,context:xe}),2}function Ie(ke,Re){return ke.path===Re.path&&Re.op==="remove"?[Re,ke]:_(ke,Re)}function _e(ke,Re,Ze){if(h.contains(Re.path,Re.from))throw new E("move.from cannot be ancestor of move.path");var Pt=I(ke,Re.path,Ze.findContext,Re.context),pe=I(ke,Re.from,Ze.findContext,Re.fromContext);return G(Pt,ue(pe)),ke}function Oe(ke,Re){return ke.push({op:"move",path:Re.from,context:Re.fromContext,from:Re.path,fromContext:Re.context}),1}function ot(ke,Re){if(ke.path===Re.path&&Re.op==="remove")throw new TypeError("Can't commute move,remove -> move,replace for same path");return _(ke,Re)}function de(ke,Re,Ze){var Pt=I(ke,Re.path,Ze.findContext,Re.context),pe=I(ke,Re.from,Ze.findContext,Re.fromContext);if(re(pe)||Ye(pe))throw new E("copy.from must exist");var xe=pe.target,ct;return Array.isArray(xe)?ct=xe[B(pe.key)]:ct=xe[pe.key],G(Pt,d(ct)),ke}function Be(ke,Re){throw new N("cannot invert "+Re.op)}function re(ke){return ke===void 0||ke.target==null&&ke.key!==void 0}function Ye(ke){return ke.key!==void 0&&ke.target[ke.key]===void 0}function nn(ke){return ke!==null&&typeof ke=="object"}}),Uze=L(l=>{var h=rve(),d=eve(),g=Yq();l.apply=b,l.applyInPlace=S,l.clone=d,l.isValidObject=N,l.defaultHash=E;var _={};function b(B,V,U){return S(B,d(V),U)}function S(B,V,U){if(U||(U=_),!Array.isArray(B))return V;for(var F,H,G=0;G<B.length;++G){if(H=B[G],F=h[H.op],F===void 0)throw new g("invalid op "+JSON.stringify(H));V=F.apply(V,H,U)}return V}function E(B){return N(B)||I(B)?JSON.stringify(B):B}function N(B){return B!==null&&Object.prototype.toString.call(B)==="[object Object]"}function I(B){return Object.prototype.toString.call(B)==="[object Array]"}}),zze=L((l,h)=>{var d=rve();h.exports=function(_){var b=[],S,E;for(S=_.length-1;S>=0;S-=E)E=g(b,_[S],S,_);return b};function g(_,b,S,E){var N=d[b.op];return N!==void 0&&typeof N.inverse=="function"?N.inverse(_,b,S,E):1}}),Vze=L(l=>{var h=Fze(),d=J5e(),g=Uze(),_=zze(),b=Xq(),S=b.encodeSegment;l.diff=I,l.patch=g.apply,l.patchInPlace=g.applyInPlace,l.inverse=_,l.clone=g.clone,l.InvalidPatchOperationError=Yq(),l.TestFailedError=tve(),l.PatchNotInvertibleError=nve();var E=g.isValidObject,N=g.defaultHash;function I(te,ae,oe){return V(te,ae,"",B(oe,[])).patch}function B(te,ae){return typeof te=="object"?{patch:ae,hash:W(Z,te.hash,N),makeContext:W(Z,te.makeContext,X),invertible:te.invertible!==!1}:{patch:ae,hash:W(Z,te,N),makeContext:X,invertible:!0}}function V(te,ae,oe,ue){return Array.isArray(te)&&Array.isArray(ae)?F(te,ae,oe,ue):E(te)&&E(ae)?U(te,ae,oe,ue):G(te,ae,oe,ue)}function U(te,ae,oe,ue){var Ee=Object.keys(ae),Ie=ue.patch,_e,Oe;for(_e=Ee.length-1;_e>=0;--_e){Oe=Ee[_e];var ot=oe+"/"+S(Oe);te[Oe]!==void 0?V(te[Oe],ae[Oe],ot,ue):Ie.push({op:"add",path:ot,value:ae[Oe]})}for(Ee=Object.keys(te),_e=Ee.length-1;_e>=0;--_e)if(Oe=Ee[_e],ae[Oe]===void 0){var de=oe+"/"+S(Oe);ue.invertible&&Ie.push({op:"test",path:de,value:te[Oe]}),Ie.push({op:"remove",path:de})}return ue}function F(te,ae,oe,ue){var Ee=d.map(ue.hash,te),Ie=d.map(ue.hash,ae),_e=h.compare(Ee,Ie);return H(te,ae,oe,ue,_e)}function H(te,ae,oe,ue,Ee){var Ie=0;return h.reduce(function(_e,Oe,ot,de){var Be,re,Ye=_e.patch,nn=oe+"/"+(de+Ie);return Oe===h.REMOVE?(Be=Ye[Ye.length-1],re=_e.makeContext(de,te),_e.invertible&&Ye.push({op:"test",path:nn,value:te[de],context:re}),Be!==void 0&&Be.op==="add"&&Be.path===nn?(Be.op="replace",Be.context=re):Ye.push({op:"remove",path:nn,context:re}),Ie-=1):Oe===h.ADD?(Ye.push({op:"add",path:nn,value:ae[ot],context:_e.makeContext(de,te)}),Ie+=1):V(te[de],ae[ot],nn,_e),_e},ue,Ee)}function G(te,ae,oe,ue){return te!==ae&&(ue.invertible&&ue.patch.push({op:"test",path:oe,value:te}),ue.patch.push({op:"replace",path:oe,value:ae})),ue}function W(te,ae,oe){return te(ae)?ae:oe}function X(){}function Z(te){return typeof te=="function"}}),D9=L((l,h)=>{function d(g,_){for(var b=0,S=_.length-1;b<S;b++){if(!g[_[b]])return null;g=g[_[b]]}return g}h.exports=d}),xg=L((l,h)=>{function d(_){return _==="~0"?"~":"/"}function g(_){var b=_.split("/");if(_.indexOf("~")===-1)return b;for(var S=0,E=b.length;S<E;S++)b[S].indexOf("~")!==-1&&(b[S]=b[S].replace(/~[01]/g,d));return b}h.exports=g}),Gze=L((l,h)=>{var d=D9(),g=xg();function _(b,S){var E=g(S),N=E[E.length-1],I=d(b,E);return I?I[N]:void 0}h.exports=_}),Kk=L((l,h)=>{function d(g,_){if(g===_)return!0;if(!(g&&_)||typeof g!="object"||typeof _!="object"||g.length!==_.length)return!1;if(Array.isArray(g)){if(!Array.isArray(_))return!1;for(var b=0,S=g.length;b<S;b++)if(!d(g[b],_[b]))return!1;return!0}var E=Object.keys(g);if(E.length!==Object.keys(_).length)return!1;for(var N=0,I=E.length;N<I;N++){var B=E[N];if(!d(g[B],_[B]))return!1}return!0}h.exports=d}),Zk=L((l,h)=>{function d(g,_){if(_==="-")return g.length;for(var b=0,S=_.length;b<S;b++){var E=_.charCodeAt(b);if(57<E||E<48)return 1/0}return+_}h.exports=d}),Qk=L((l,h)=>{var d=Kk(),g=D9(),_=Zk(),b=xg();function S(E,N,I,B){if(typeof I>"u")return"[op:add] require value, but got undefined";var V=b(N),U=V[V.length-1],F=g(E,V);if(F===null)return"[op:add] path not found: "+N;if(Array.isArray(F)){var H=_(F,U);if(F.length<H)return"[op:add] invalid array index: "+N;B(E,V).splice(H,0,I)}else d(F[U],I)||(B(E,V)[U]=I)}h.exports=S}),ive=L((l,h)=>{var d=D9(),g=Zk(),_=xg();function b(S,E,N){var I=_(E),B=I[I.length-1],V=d(S,I);if(V===null)return"[op:remove] path not found: "+E;if(Array.isArray(V)){var U=g(V,B);if(V.length<=U)return"[op:remove] invalid array index: "+E;N(S,I).splice(U,1)}else delete N(S,I)[B]}h.exports=b}),sve=L((l,h)=>{var d=Kk(),g=D9(),_=Zk(),b=xg();function S(E,N,I,B){if(typeof I>"u")return"[op:replace] require value, but got undefined";var V=b(N),U=V[V.length-1],F=g(E,V);if(F===null)return"[op:replace] path not found: "+N;if(Array.isArray(F)){var H=_(F,U);if(F.length<=H)return"[op:replace] invalid array index: "+N;d(F[H],I)||B(E,V).splice(H,1,I)}else d(F[U],I)||(B(E,V)[U]=I)}h.exports=S}),ove=L((l,h)=>{var d=Qk(),g=D9(),_=Zk(),b=xg();function S(E,N,I,B){if(I!==N){var V=b(N),U=V[V.length-1],F=g(E,V);if(F===null)return"[op:move] path not found: "+N;var H=void 0;if(Array.isArray(F)){var G=_(F,U);if(F.length<=G)return"[op:move] invalid array index: "+I;H=F[G],B(E,V).splice(G,1)}else H=F[U],delete B(E,V)[U];return d(E,I,H,B)}}h.exports=S}),ave=L((l,h)=>{var d=D9(),g=xg(),_=Qk();function b(S,E,N,I){var B=g(E),V=B[B.length-1],U=d(S,B);return U===null?"[op:copy] path not found: "+E:_(S,N,U[V],I)}h.exports=b}),lve=L((l,h)=>{var d=Kk(),g=D9(),_=xg();function b(S,E,N){var I=_(E),B=I[I.length-1],V=g(S,I);if(V===null)return"[op:test] path not found: "+E;if(!d(V[B],N)){var U=JSON.stringify(V[B]),F=JSON.stringify(N);return"[op:test] not matched: "+U+" "+F}}h.exports=b}),Kq=L((l,h)=>{function d(g){if(!g||typeof g!="object")return g;if(Array.isArray(g)){for(var _=g.length,b=new Array(_),S=0;S<_;S++)b[S]=g[S];return b}for(var E=Object.keys(g),N={},I=0,B=E.length;I<B;I++){var V=E[I];N[V]=g[V]}return N}h.exports=d}),$ze=L((l,h)=>{var d=Gze(),g=Qk(),_=ive(),b=sve(),S=ove(),E=ave(),N=lve(),I=Kk(),B=Kq(),V=xg();function U(F,H){return{get:function(G){return d(F,G)},add:function(G,W){return g(F,G,W,H)},remove:function(G){return _(F,G,H)},replace:function(G,W){return b(F,G,W,H)},move:function(G,W){return S(F,G,W,H)},copy:function(G,W){return E(F,G,W,H)},test:function(G,W){return N(F,G,W)},deepEqual:I,shallowCopy:B,toKeys:V}}h.exports=U}),Hze=L((l,h)=>{function d(g,_,b,S){return S.error=b,S.partial?_[""]:g}h.exports=d}),jze=L((l,h)=>{function d(g){return!!g}h.exports=d}),Wze=L((l,h)=>{function d(g){if(g)throw new TypeError(g)}h.exports=d}),qze=L((l,h)=>{var d=Kq();function g(_,b){for(var S=0,E=b.length-1;S<E;S++)_=_[b[S]]=d(_[b[S]]);return _}h.exports=g}),Xze=L((l,h)=>{var d=Kq();function g(b,S,E){var N=b[S];return E.has(N)||(N=d(N),E.add(N)),N}function _(b,S,E){for(var N=0,I=S.length-1;N<I;N++)b=b[S[N]]=g(b,S[N],E);return b}h.exports=_}),Yze=L((l,h)=>{var d=$ze(),g=Hze(),_=jze(),b=Wze(),S=qze(),E=Xze(),N=Qk(),I=ive(),B=sve(),V=ove(),U=ave(),F=lve(),H=Set||function(){var W=[];return W.has=function(X){return this.indexOf(X)!==-1},W.add=function(X){this.push(X)},W};function G(W,X,Z){if(X.length===0)return W;Z=Z||{};for(var te=Z.strict?b:_,ae=X.length===1?S:function(Oe){return function(ot,de){return E(ot,de,Oe)}}(new H),oe={"":W},ue,Ee=0,Ie=X.length;Ee<Ie;Ee++){var _e=X[Ee];switch(_e.op){case"add":if(te(N(oe,""+_e.path,_e.value,ae)))return g(W,oe,_e,Z);break;case"remove":if(te(I(oe,""+_e.path,ae)))return g(W,oe,_e,Z);break;case"replace":if(te(B(oe,""+_e.path,_e.value,ae)))return g(W,oe,_e,Z);break;case"move":if(te(V(oe,""+_e.from,""+_e.path,ae)))return g(W,oe,_e,Z);break;case"copy":if(te(U(oe,""+_e.from,""+_e.path,ae)))return g(W,oe,_e,Z);break;case"test":if(te(F(oe,""+_e.path,_e.value)))return g(W,oe,_e,Z);break;default:if(Z.custom&&Z.custom[_e.op]){if(ue=ue||d(oe,ae),te(Z.custom[_e.op](ue,_e,Ee,X)))return g(W,oe,_e,Z)}else return te("[op:"+_e.op+"] unknown"),g(W,oe,_e,Z);break}}return oe[""]}h.exports=G}),Kze=L((l,h)=>{h.exports=Yze()}),Zze=L((l,h)=>{(function(d,g){typeof l=="object"&&typeof h=="object"?h.exports=g():typeof l=="object"?l.blobCompare=g():d.blobCompare=g()})(window,function(){return function(d){var g={};function _(b){if(g[b])return g[b].exports;var S=g[b]={i:b,l:!1,exports:{}};return d[b].call(S.exports,S,S.exports,_),S.l=!0,S.exports}return _.m=d,_.c=g,_.d=function(b,S,E){_.o(b,S)||Object.defineProperty(b,S,{enumerable:!0,get:E})},_.r=function(b){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(b,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(b,"__esModule",{value:!0})},_.t=function(b,S){if(1&S&&(b=_(b)),8&S||4&S&&typeof b=="object"&&b&&b.__esModule)return b;var E=Object.create(null);if(_.r(E),Object.defineProperty(E,"default",{enumerable:!0,value:b}),2&S&&typeof b!="string")for(var N in b)_.d(E,N,(function(I){return b[I]}).bind(null,N));return E},_.n=function(b){var S=b&&b.__esModule?function(){return b.default}:function(){return b};return _.d(S,"a",S),S},_.o=function(b,S){return Object.prototype.hasOwnProperty.call(b,S)},_.p="",_(_.s=4)}([function(d,g,_){var b=function(B,V){if(Array.isArray(B))return B;if(Symbol.iterator in Object(B))return function(U,F){var H=[],G=!0,W=!1,X=void 0;try{for(var Z,te=U[Symbol.iterator]();!(G=(Z=te.next()).done)&&(H.push(Z.value),!F||H.length!==F);G=!0);}catch(ae){W=!0,X=ae}finally{try{!G&&te.return&&te.return()}finally{if(W)throw X}}return H}(B,V);throw new TypeError("Invalid attempt to destructure non-iterable instance")},S=function(){function B(V,U){for(var F=0;F<U.length;F++){var H=U[F];H.enumerable=H.enumerable||!1,H.configurable=!0,"value"in H&&(H.writable=!0),Object.defineProperty(V,H.key,H)}}return function(V,U,F){return U&&B(V.prototype,U),F&&B(V,F),V}}();function E(B){if(Array.isArray(B)){for(var V=0,U=Array(B.length);V<B.length;V++)U[V]=B[V];return U}return Array.from(B)}var N=_(2),I=function(B){function V(U){(function(H,G){if(!(H instanceof G))throw new TypeError("Cannot call a class as a function")})(this,V);var F=function(H,G){if(!H)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!G||typeof G!="object"&&typeof G!="function"?H:G}(this,(V.__proto__||Object.getPrototypeOf(V)).call(this));return F._messageId=1,F._messages=new Map,F._worker=U,F._worker.onmessage=F._onMessage.bind(F),F._id=Math.ceil(1e7*Math.random()),F}return function(U,F){if(typeof F!="function"&&F!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof F);U.prototype=Object.create(F&&F.prototype,{constructor:{value:U,enumerable:!1,writable:!0,configurable:!0}}),F&&(Object.setPrototypeOf?Object.setPrototypeOf(U,F):U.__proto__=F)}(V,B),S(V,[{key:"terminate",value:function(){this._worker.terminate()}},{key:"isFree",value:function(){return this._messages.size===0}},{key:"jobsLength",value:function(){return this._messages.size}},{key:"exec",value:function(U){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,H=this,G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],W=arguments[3];return new Promise(function(X,Z){var te=H._messageId++;H._messages.set(te,[X,Z,W]),H._worker.postMessage([te,F,U],G||[])})}},{key:"postMessage",value:function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,F=this,H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],G=arguments[2];return new Promise(function(W,X){var Z=F._messageId++;F._messages.set(Z,[W,X,G]),F._worker.postMessage([Z,U],H||[])})}},{key:"emit",value:function(U){for(var F=arguments.length,H=Array(F>1?F-1:0),G=1;G<F;G++)H[G-1]=arguments[G];this._worker.postMessage({eventName:U,args:H})}},{key:"_onMessage",value:function(U){var F;if(!Array.isArray(U.data)&&U.data.eventName)return(F=function Z(te,ae,oe){te===null&&(te=Function.prototype);var ue=Object.getOwnPropertyDescriptor(te,ae);if(ue===void 0){var Ee=Object.getPrototypeOf(te);return Ee===null?void 0:Z(Ee,ae,oe)}if("value"in ue)return ue.value;var Ie=ue.get;return Ie!==void 0?Ie.call(oe):void 0}(V.prototype.__proto__||Object.getPrototypeOf(V.prototype),"emit",this)).call.apply(F,[this,U.data.eventName].concat(E(U.data.args)));var H,G=(H=U.data,Array.isArray(H)?H:Array.from(H)),W=G[0],X=G.slice(1);if(W===1)this._onEvent.apply(this,E(X));else{if(W!==0)throw new Error("Wrong message type '"+W+"'");this._onResult.apply(this,E(X))}}},{key:"_onResult",value:function(U,F,H){var G=this._messages.get(U),W=b(G,2),X=W[0],Z=W[1];return this._messages.delete(U),F===1?X(H):Z(H)}},{key:"_onEvent",value:function(U,F,H){var G=this._messages.get(U),W=b(G,3)[2];W&&W(F,H)}}]),V}(N);d.exports=I},function(d,g,_){d.exports=function(){return _(3)(`!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var f=r(1),c=0,l=1,s=0,y=1,p="main",b=function(e){return"object"===(void 0===e?"undefined":i(e))&&"function"==typeof e.then&&"function"==typeof e.catch};var v=function e(t,r){u(this,e),this.payload=t,this.transferable=r};e.exports=function(e){var t,r,i,h=(i=e,(r=p)in(t={})?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t),d=self.postMessage.bind(self),m=new(function(e){function t(){return u(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"emit",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return d({eventName:e,args:r}),this}},{key:"emitLocally",value:function(e){for(var r,n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];(r=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"emit",this)).call.apply(r,[this,e].concat(i))}},{key:"operation",value:function(e,t){return h[e]=t,this}}]),t}(f)),g=function(e,t,r){var n=function(t){t&&t instanceof v?w(e,y,t.payload,t.transferable):w(e,y,t)},o=function(t){w(e,s,{message:t.message,stack:t.stack})};try{var i=_(e,t,r);b(i)?i.then(n).catch(o):n(i)}catch(e){o(e)}},_=function(e,t,r){var n=h[r||p];if(!n)throw new Error("Not found handler for this request");return n(t,O.bind(null,e))},w=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];d([c,e,t,r],n)},O=function(e,t,r){if(!t)throw new Error("eventName is required");if("string"!=typeof t)throw new Error("eventName should be string");d([l,e,t,r])};return self.addEventListener("message",(function(e){var t=e.data;Array.isArray(t)?g.apply(void 0,a(t)):t&&t.eventName&&m.emitLocally.apply(m,[t.eventName].concat(a(t.args)))})),m},e.exports.TransferableResponse=v},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperty(this,"__listeners",{value:{},enumerable:!1,writable:!1})}return n(e,[{key:"emit",value:function(e){if(!this.__listeners[e])return this;for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o=!0,i=!1,a=void 0;try{for(var u,f=this.__listeners[e][Symbol.iterator]();!(o=(u=f.next()).done);o=!0){var c=u.value;c.apply(void 0,r)}}catch(e){i=!0,a=e}finally{try{!o&&f.return&&f.return()}finally{if(i)throw a}}return this}},{key:"once",value:function(e,t){var r=this,n=function n(){r.off(e,n),t.apply(void 0,arguments)};return this.on(e,n)}},{key:"on",value:function(e,t){return this.__listeners[e]||(this.__listeners[e]=[]),this.__listeners[e].push(t),this}},{key:"off",value:function(e,t){return this.__listeners[e]=t?this.__listeners[e].filter((function(e){return e!==t})):[],this}}]),e}();e.exports=o},function(e,t,r){"use strict";r.r(t);var n=r(0);r.n(n)()().operation("binary",async({blob:e,chunk:t})=>await function(e,t){return new Promise((r,n)=>{const o=new FileReader,i=t?Math.min(t,e.size):e.size,a=e.slice(0,i);o.onload=()=>r(o.result),o.onerror=n,o.readAsBinaryString(a)})}(e,t)).operation("buffer",async({blob:e,chunk:t})=>await function(e,t){return new Promise((r,n)=>{const o=new FileReader,i=t?Math.min(t,e.size):e.size,a=e.slice(0,i);o.onload=()=>r(o.result),o.onerror=n,o.readAsArrayBuffer(a)})}(e,t)).operation("compare",({buf1:e,buf2:t})=>(function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;const r=new DataView(e),n=new DataView(t);for(var o=e.byteLength;o--;)if(r.getUint8(o)!==n.getUint8(o))return!1;return!0})(e,t))}]);`,null)}},function(d,g,_){var b=function(){function E(N,I){for(var B=0;B<I.length;B++){var V=I[B];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(N,V.key,V)}}return function(N,I,B){return I&&E(N.prototype,I),B&&E(N,B),N}}(),S=function(){function E(){(function(N,I){if(!(N instanceof I))throw new TypeError("Cannot call a class as a function")})(this,E),Object.defineProperty(this,"__listeners",{value:{},enumerable:!1,writable:!1})}return b(E,[{key:"emit",value:function(N){if(!this.__listeners[N])return this;for(var I=arguments.length,B=Array(I>1?I-1:0),V=1;V<I;V++)B[V-1]=arguments[V];var U=!0,F=!1,H=void 0;try{for(var G,W=this.__listeners[N][Symbol.iterator]();!(U=(G=W.next()).done);U=!0){var X=G.value;X.apply(void 0,B)}}catch(Z){F=!0,H=Z}finally{try{!U&&W.return&&W.return()}finally{if(F)throw H}}return this}},{key:"once",value:function(N,I){var B=this,V=function U(){B.off(N,U),I.apply(void 0,arguments)};return this.on(N,V)}},{key:"on",value:function(N,I){return this.__listeners[N]||(this.__listeners[N]=[]),this.__listeners[N].push(I),this}},{key:"off",value:function(N,I){return this.__listeners[N]=I?this.__listeners[N].filter(function(B){return B!==I}):[],this}}]),E}();d.exports=S},function(d,g,_){var b=window.URL||window.webkitURL;d.exports=function(S,E){try{try{var N;try{(N=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(S),N=N.getBlob()}catch{N=new Blob([S])}return new Worker(b.createObjectURL(N))}catch{return new Worker("data:application/javascript,"+encodeURIComponent(S))}}catch{if(!E)throw Error("Inline worker is not supported");return new Worker(E)}}},function(d,g,_){_.r(g);var b=_(0),S=_.n(b),E=_(1),N=_.n(E);_.d(g,"workersEnabled",function(){return I}),_.d(g,"default",function(){return B});let I=!!window.Worker;class B{static toBinaryStringWithWorker(U,F){return he(this,null,function*(){let H=new S.a(new N.a),G=yield H.exec("binary",{blob:U,chunk:F});return H.terminate(),G})}static toBinaryStringWithoutWorker(U,F){return function(H,G){return new Promise((W,X)=>{let Z=new FileReader,te=G?Math.min(G,H.size):H.size,ae=H.slice(0,te);Z.onload=()=>W(Z.result),Z.onerror=X,Z.readAsBinaryString(ae)})}(U,F)}static toBinaryString(U,F,H=!0){return H&&I?this.toBinaryStringWithWorker(U,F):this.toBinaryStringWithoutWorker(U,F)}static toArrayBufferWithWorker(U,F){return he(this,null,function*(){let H=new S.a(new N.a),G=yield H.exec("buffer",{blob:U,chunk:F});return H.terminate(),G})}static toArrayBufferWithoutWorker(U,F){return function(H,G){return new Promise((W,X)=>{let Z=new FileReader,te=G?Math.min(G,H.size):H.size,ae=H.slice(0,te);Z.onload=()=>W(Z.result),Z.onerror=X,Z.readAsArrayBuffer(ae)})}(U,F)}static toArrayBuffer(U,F,H=!0){return H&&I?this.toArrayBufferWithWorker(U,F):this.toArrayBufferWithoutWorker(U,F)}static compareBuffersWithWorker(U,F){return he(this,null,function*(){if(U===F)return!0;let H=new S.a(new N.a),G=yield H.exec("compare",{buf1:U,buf2:F},[U,F]);return H.terminate(),G})}static compareBuffersWithoutWorker(U,F){return function(H,G){if(H===G)return!0;if(H.byteLength!==G.byteLength)return!1;let W=new DataView(H),X=new DataView(G);for(var Z=H.byteLength;Z--;)if(W.getUint8(Z)!==X.getUint8(Z))return!1;return!0}(U,F)}static compareBuffers(U,F,H=!0){return H&&I?this.compareBuffersWithWorker(U,F):this.compareBuffersWithoutWorker(U,F)}static sizeEqual(U,F){return U.size===F.size}static typeEqual(U,F){return U.type===F.type}static magicNumbersEqual(U,F,H=!0){return he(this,null,function*(){if(U===F)return!0;let G=[24,16,14,12,8,6,4],[W,X]=yield Promise.all([this.toBinaryString(U,24,H),this.toBinaryString(F,24,H)]);for(let Z of G)if(W.substring(0,Z)===X.substring(0,Z))return!0;return!1})}static bytesEqualWithBinaryString(U,F,H,G=!0){return he(this,null,function*(){if(U===F)return!0;let[W,X]=yield Promise.all([this.toBinaryString(U,H,G),this.toBinaryString(F,H,G)]);return W===X})}static bytesEqualWithArrayBuffer(U,F,H,G=!0){return he(this,null,function*(){if(U===F)return!0;let[W,X]=yield Promise.all([this.toArrayBuffer(U,H,G),this.toArrayBuffer(F,H,G)]);return this.compareBuffers(W,X,G)})}static isEqual(U,F){return he(this,arguments,function*(H,G,{methods:W=["size","type","magic","byte"],byte:X="buffer",partial:Z=!1,chunks:te=null,worker:ae=!0}={}){let oe=null;for(let ue of W){if(oe===!1||Z&&oe===!0)break;switch(ue){case"byte":case"bytes":case"content":te=te instanceof Array?te:[H.size],oe=!0;for(let Ee of te){let Ie=!1;Ie=X==="buffer"?yield this.bytesEqualWithArrayBuffer(H,G,Ee,ae):yield this.bytesEqualWithBinaryString(H,G,Ee,ae),Ie||(oe=!1)}break;case"magic":case"headers":case"numbers":case"mime":oe=yield this.magicNumbersEqual(H,G,ae);break;case"size":case"sizes":oe=this.sizeEqual(H,G);break;case"type":case"types":oe=this.typeEqual(H,G);break;default:throw new Error("Blob-compare : Unknown comparison method")}}return oe})}}}])})}),cve={};Y(cve,{ToolbarDropdownSelect:()=>mGe,default:()=>yGe}),i.exports=ne(cve),Fe(),Ht();var uve=Jt;Kr();var Qze=0,Jze=class{constructor(l){this._studio=l,K(this,"_id"),K(this,"_state",{type:"Ready"}),this._id=String(Qze++)}get status(){return this._state.type}reset(){let{_state:l}=this;if(l.type!=="Ready")if(l.type==="Captured")this._state={type:"Ready"},l.transaction.discard(),l.flagsTransaction.discard();else throw l.type==="Committed"?new Error("This scrub is already committed and can't be reset."):new Error("This scrub is already discarded and can't be reset.")}commit(){let{_state:l}=this;if(l.type==="Captured")l.transaction.commit(),l.flagsTransaction.discard(),this._state={type:"Committed"};else if(l.type==="Ready"){console.warn("Scrub is empty. Nothing to commit.");return}else throw l.type==="Committed"?new Error("This scrub is already committed."):new Error("This scrub is already discarded and can't be comitted.")}capture(l){if(this._state.type==="Captured"&&this.reset(),this._state.type==="Ready"){let h=!0;try{this._state=R({type:"Captured"},this._capture(l)),h=!1}finally{h&&(console.error("This scrub's callback threw an error. We're undo-ing all of the changes made by this scrub, and marking it as discarded."),this._state={type:"Discarded"})}}else throw this._state.type==="Committed"?new Error("This scrub is already committed and cannot capture again. If you wish to capture more, you can start a new studio.scrub() or do so before scrub.commit()"):new Error("This scrub is already discarded and cannot capture again. If you wish to capture more, you can start a new studio.scrub() or do so before scrub.discard()")}_capture(l){let h=[],d=this._studio.tempTransaction(_=>{let b=!0,S={set:(E,N)=>{if(!b)throw new Error("You seem to have called the scrub api after scrub.capture()");let{root:I,path:B}=(0,uve.getPointerParts)(E);if(!Sn(I))throw new Error("We can only scrub props of Sheet Objects for now");_.set(E,N),h.push(E)}};try{l(S)}finally{b=!1}}),g=this._studio.tempTransaction(({stateEditors:_})=>{h.forEach(b=>{let{root:S,path:E}=(0,uve.getPointerParts)(b);if(!Sn(S))return;let N=S.template.getDefaultsAtPointer(b);Ne(N,(I,B)=>{_.studio.ephemeral.projects.stateByProjectId.stateBySheetId.stateByObjectKey.propsBeingScrubbed.flag(M(R({},S.address),{pathToProp:B}))},E)})});return{transaction:d,flagsTransaction:g}}discard(){let{_state:l}=this;if(l.type==="Captured"||l.type==="Ready")l.type==="Captured"&&(l.transaction.discard(),l.flagsTransaction.discard()),this._state={type:"Discarded"};else throw l.type==="Committed"?new Error("This scrub is already committed and can't be discarded."):new Error("This scrub is already discarded")}},eVe=Jt,hve=typeof window<"u"?Promise.resolve().then(()=>(Dze(),Y5e)).then(l=>l.default):null,tVe=class{constructor(l){this.studio=l,K(this,"_rendered",!1),K(this,"_nonSSRBits",hve?hve.then(h=>new h):Promise.reject()),K(this,"ready",this._nonSSRBits.then(()=>{},()=>{}))}render(){this._rendered||(this._rendered=!0,this._nonSSRBits.then(l=>{l.render()}).catch(l=>{throw console.error(l),l}))}hide(){this.studio.transaction(({drafts:l})=>{l.ahistoric.visibilityState="everythingIsHidden"})}restore(){this.render(),this.studio.transaction(({drafts:l})=>{l.ahistoric.visibilityState="everythingIsVisible"})}get isHidden(){return(0,eVe.val)(this.studio.atomP.ahistoric.visibilityState)==="everythingIsHidden"}renderToolset(l,h){let d=!1,g=null;return this._nonSSRBits.then(_=>{d||(g=_.renderToolset(l,h))}).catch(_=>{console.error(_)}),()=>{if(g){g();return}d||(d=!0)}}},Jk=Jt;function nVe(l){return l}var rVe=(l,h=nVe)=>{let d=g=>({type:l,payload:h(g)});return d.type=l,d.is=g=>g&&g.type&&g.type===l,d},mf=rVe,dve=z(Vze()),fve=z(Kze());U3();var eD,iVe=new Uint8Array(16);function sVe(){if(!eD&&(eD=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!eD))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return eD(iVe)}var oVe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function aVe(l){return typeof l=="string"&&oVe.test(l)}var lVe=aVe,ol=[];for(tD=0;tD<256;++tD)ol.push((tD+256).toString(16).substr(1));var tD;function cVe(l){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,d=(ol[l[h+0]]+ol[l[h+1]]+ol[l[h+2]]+ol[l[h+3]]+"-"+ol[l[h+4]]+ol[l[h+5]]+"-"+ol[l[h+6]]+ol[l[h+7]]+"-"+ol[l[h+8]]+ol[l[h+9]]+"-"+ol[l[h+10]]+ol[l[h+11]]+ol[l[h+12]]+ol[l[h+13]]+ol[l[h+14]]+ol[l[h+15]]).toLowerCase();if(!lVe(d))throw TypeError("Stringified UUID is invalid");return d}var uVe=cVe;function hVe(l,h,d){l=l||{};var g=l.random||(l.rng||sVe)();if(g[6]=g[6]&15|64,g[8]=g[8]&63|128,h){d=d||0;for(var _=0;_<16;++_)h[d+_]=g[_];return h}return uVe(g)}var dVe=hVe,aw={replaceHistory:mf("@history/replaceHistory"),startHistoryFromScratch:mf("@history/startHistoryFromScratch"),undo:mf("@history/undo"),redo:mf("@history/redo")},fVe={type:"@history/unknownAction",payload:""},pVe={maxNumberOfCommits:100},mVe=(l,h=pVe)=>{let d=Zq(l(void 0,fVe));return function(g,_){return aw.startHistoryFromScratch.is(_)?Zq(l(void 0,_.payload)):aw.replaceHistory.is(_)?_.payload:aw.undo.is(_)?g?vVe(g):d:aw.redo.is(_)?g?_Ve(g):d:g?gVe(g,l(g.innerState,_),h):Zq(l(void 0,_))}};function Zq(l){return{currentCommitHash:void 0,commitsByHash:{},listOfCommitHashes:[],innerState:l}}function gVe(l,h,d){if(h===l.innerState)return l;let g=yVe(l.innerState,h);if(g.forwardDiff.length===0)return l;let _=yp(l.listOfCommitHashes),b={currentCommitHash:g.hash,commitsByHash:R({},l.commitsByHash),listOfCommitHashes:[...l.listOfCommitHashes],innerState:h};if(l.currentCommitHash!==_){let S=l.listOfCommitHashes.findIndex(E=>E===l.currentCommitHash);l.listOfCommitHashes.slice(S+1).forEach(E=>{delete b.commitsByHash[E]}),b.listOfCommitHashes.splice(S+1,b.listOfCommitHashes.length)}if(b.listOfCommitHashes.push(g.hash),b.commitsByHash[g.hash]=g,b.listOfCommitHashes.length>d.maxNumberOfCommits){let S=b.listOfCommitHashes.length-d.maxNumberOfCommits;b.listOfCommitHashes.slice(0,S).forEach(E=>{delete b.commitsByHash[E]}),b.listOfCommitHashes.splice(0,S)}return b}function yVe(l,h){let d=dve.default.diff(l,h,{invertible:!1}),g=dve.default.diff(h,l,{invertible:!1}),_=Date.now(),b=dVe();return{forwardDiff:d,backwardDiff:g,timestamp:_,hash:b}}function vVe(l){if(l.currentCommitHash===void 0)return l;let h=l.listOfCommitHashes.findIndex(S=>S===l.currentCommitHash);if(h===-1)throw new Error("This should never happen");let d=l.commitsByHash[l.currentCommitHash],g=(0,fve.default)(l.innerState,d.backwardDiff),_=h-1,b=_===-1?void 0:l.listOfCommitHashes[_];return M(R({},l),{currentCommitHash:b,innerState:g})}function _Ve(l){if(l.listOfCommitHashes.length===0)return l;let h=l.listOfCommitHashes.findIndex(S=>S===l.currentCommitHash);if(h===l.listOfCommitHashes.length-1)return l;let d=h+1,g=l.listOfCommitHashes[d],_=l.commitsByHash[g],b=(0,fve.default)(l.innerState,_.forwardDiff);return M(R({},l),{currentCommitHash:g,innerState:b})}Fk();var nD={ahistoric:{visibilityState:"everythingIsVisible",theTrigger:{position:{closestCorner:"bottomLeft",distanceFromHorizontalEdge:.02,distanceFromVerticalEdge:.02}},coreByProject:{},projects:{stateByProjectId:{}}},historic:{projects:{stateByProjectId:{}},autoKey:!0,coreByProject:{},panelInstanceDesceriptors:{}},ephemeral:{initialised:!1,coreByProject:{},projects:{stateByProjectId:{}},extensions:{byId:{},paneClasses:{}},showOutline:!1}},pve=mf("@storeBundle/replacePersistentState",l=>l),mve=mf("@storeBundle/reduceParts",l=>l),e8={historic:aw,replacePersistentState:pve,reduceParts:mve},gve=mf("@storeBundle/setInnerHistoricState",l=>l),xVe=(l=nD.historic,h)=>gve.is(h)?h.payload:l,Qq=mVe(xVe),yve=(l,h)=>{if(pve.is(h)){let{historic:d,ahistoric:g}=h.payload,_=(l==null?void 0:l.ephemeral)||nD.ephemeral;return{$persistent:{historic:d,ahistoric:g},ephemeral:_}}else if(l){let{historic:d,ahistoric:g}=l.$persistent,{ephemeral:_}=l;if(mve.is(h)){let b={historic:l.$persistent.historic.innerState,ahistoric:l.$persistent.ahistoric,ephemeral:l.ephemeral},S=h.payload(b);if(S===b)return l;d.innerState!==S.historic&&(d=Qq(d,gve(S.historic))),g=S.ahistoric,_=S.ephemeral}else{let b=Qq(d,h);if(b===d)return l;d=b}return{$persistent:d===l.$persistent.historic&&g===l.$persistent.ahistoric?l.$persistent:{historic:d,ahistoric:g},ephemeral:_}}else{let d=Qq(void 0,{}),g=nD.ahistoric,_=nD.ephemeral;return{$persistent:{historic:d,ahistoric:g},ephemeral:_}}},vve=mf("@history/pushTempAction",l=>l),_ve=mf("@history/discardTempAction",l=>l),xve=mf("@history/commitTempAction",l=>l),bVe=0,SVe=()=>{let l=bVe++;return{push:h=>vve({id:l,originalAction:h}),discard:()=>_ve(l),commit:()=>xve(l)}},wVe=(l,h)=>{if(l){let{tempActions:d,permanent:g}=l.$temps,_;if(vve.is(h))d=[...d,h];else if(xve.is(h)){let S=d.find(E=>E.payload.id===h.payload);S?(_=S.payload.originalAction,d=d.filter(E=>E.payload.id!==h.payload)):Dk.error("Comitting temp action group ".concat(h.payload," isn't possible as this group doesn't exist"))}else _ve.is(h)?d=d.filter(S=>S.payload.id!==h.payload):_=h;_&&(g=yve(l.$temps.permanent,_));let b={historic:g.$persistent.historic.innerState,ahistoric:g.$persistent.ahistoric,ephemeral:g.ephemeral};for(let S of d)b=S.payload.originalAction.payload(b);return R({$temps:{tempActions:d,permanent:g},$persistent:g.$persistent},b)}else{let d=yve(void 0,h);return{$temps:{permanent:d,tempActions:[]},$persistent:d.$persistent,historic:d.$persistent.historic.innerState,ahistoric:d.$persistent.ahistoric,ephemeral:d.ephemeral}}};nf(),nf(),Fp();function bve(l,h){if(typeof l!="object"||l===null)return;if(h.length===0){for(let S of Object.keys(l))delete l[S];return}let d=h.slice(0,h.length-1),g=l,_=new WeakMap;for(let S of d){let E=g,N=E[S];if(typeof N!="object"||N===null)return;_.set(N,E),g=N}let b=h.slice().reverse();for(let S of b){if(delete g[S],Object.keys(g).length>0)return;g=_.get(g)}}function TVe(l,{scale:h,origin:d,translate:g}){let _=d+(l-d)*h;return g+_}function Dh(l){for(var h=arguments.length,d=Array(h>1?h-1:0),g=1;g<h;g++)d[g-1]=arguments[g];throw Error("[Immer] minified error nr: "+l+(d.length?" "+d.map(function(_){return"'"+_+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function t8(l){return!!l&&!!l[Ac]}function F9(l){return!!l&&(function(h){if(!h||typeof h!="object")return!1;var d=Object.getPrototypeOf(h);if(d===null)return!0;var g=Object.hasOwnProperty.call(d,"constructor")&&d.constructor;return g===Object||typeof g=="function"&&Function.toString.call(g)===NVe}(l)||Array.isArray(l)||!!l[Nve]||!!l.constructor[Nve]||eX(l)||tX(l))}function lw(l,h,d){d===void 0&&(d=!1),n8(l)===0?(d?Object.keys:fX)(l).forEach(function(g){d&&typeof g=="symbol"||h(g,l[g],l)}):l.forEach(function(g,_){return h(_,g,l)})}function n8(l){var h=l[Ac];return h?h.i>3?h.i-4:h.i:Array.isArray(l)?1:eX(l)?2:tX(l)?3:0}function Jq(l,h){return n8(l)===2?l.has(h):Object.prototype.hasOwnProperty.call(l,h)}function EVe(l,h){return n8(l)===2?l.get(h):l[h]}function Sve(l,h,d){var g=n8(l);g===2?l.set(h,d):g===3?(l.delete(h),l.add(d)):l[h]=d}function MVe(l,h){return l===h?l!==0||1/l==1/h:l!=l&&h!=h}function eX(l){return RVe&&l instanceof Map}function tX(l){return PVe&&l instanceof Set}function O9(l){return l.o||l.t}function nX(l){if(Array.isArray(l))return Array.prototype.slice.call(l);var h=IVe(l);delete h[Ac];for(var d=fX(h),g=0;g<d.length;g++){var _=d[g],b=h[_];b.writable===!1&&(b.writable=!0,b.configurable=!0),(b.get||b.set)&&(h[_]={configurable:!0,writable:!0,enumerable:b.enumerable,value:l[_]})}return Object.create(Object.getPrototypeOf(l),h)}function rX(l,h){return h===void 0&&(h=!1),iX(l)||t8(l)||!F9(l)||(n8(l)>1&&(l.set=l.add=l.clear=l.delete=CVe),Object.freeze(l),h&&lw(l,function(d,g){return rX(g,!0)},!0)),l}function CVe(){Dh(2)}function iX(l){return l==null||typeof l!="object"||Object.isFrozen(l)}function Wp(l){var h=kVe[l];return h||Dh(18,l),h}function wve(){return cw}function sX(l,h){h&&(Wp("Patches"),l.u=[],l.s=[],l.v=h)}function rD(l){oX(l),l.p.forEach(AVe),l.p=null}function oX(l){l===cw&&(cw=l.l)}function Tve(l){return cw={p:[],l:cw,h:l,m:!0,_:0}}function AVe(l){var h=l[Ac];h.i===0||h.i===1?h.j():h.O=!0}function aX(l,h){h._=h.p.length;var d=h.p[0],g=l!==void 0&&l!==d;return h.h.g||Wp("ES5").S(h,l,g),g?(d[Ac].P&&(rD(h),Dh(4)),F9(l)&&(l=iD(h,l),h.l||sD(h,l)),h.u&&Wp("Patches").M(d[Ac],l,h.u,h.s)):l=iD(h,d,[]),rD(h),h.u&&h.v(h.u,h.s),l!==Pve?l:void 0}function iD(l,h,d){if(iX(h))return h;var g=h[Ac];if(!g)return lw(h,function(b,S){return Eve(l,g,h,b,S,d)},!0),h;if(g.A!==l)return h;if(!g.P)return sD(l,g.t,!0),g.t;if(!g.I){g.I=!0,g.A._--;var _=g.i===4||g.i===5?g.o=nX(g.k):g.o;lw(g.i===3?new Set(_):_,function(b,S){return Eve(l,g,_,b,S,d)}),sD(l,_,!1),d&&l.u&&Wp("Patches").R(g,d,l.u,l.s)}return g.o}function Eve(l,h,d,g,_,b){if(t8(_)){var S=iD(l,_,b&&h&&h.i!==3&&!Jq(h.D,g)?b.concat(g):void 0);if(Sve(d,g,S),!t8(S))return;l.m=!1}if(F9(_)&&!iX(_)){if(!l.h.F&&l._<1)return;iD(l,_),h&&h.A.l||sD(l,_)}}function sD(l,h,d){d===void 0&&(d=!1),l.h.F&&l.m&&rX(h,d)}function lX(l,h){var d=l[Ac];return(d?O9(d):l)[h]}function Mve(l,h){if(h in l)for(var d=Object.getPrototypeOf(l);d;){var g=Object.getOwnPropertyDescriptor(d,h);if(g)return g;d=Object.getPrototypeOf(d)}}function cX(l){l.P||(l.P=!0,l.l&&cX(l.l))}function uX(l){l.o||(l.o=nX(l.t))}function hX(l,h,d){var g=eX(h)?Wp("MapSet").N(h,d):tX(h)?Wp("MapSet").T(h,d):l.g?function(_,b){var S=Array.isArray(_),E={i:S?1:0,A:b?b.A:wve(),P:!1,I:!1,D:{},l:b,t:_,k:null,o:null,j:null,C:!1},N=E,I=aD;S&&(N=[E],I=lD);var B=Proxy.revocable(N,I),V=B.revoke,U=B.proxy;return E.k=U,E.j=V,U}(h,d):Wp("ES5").J(h,d);return(d?d.A:wve()).p.push(g),g}function oD(l){return t8(l)||Dh(22,l),function h(d){if(!F9(d))return d;var g,_=d[Ac],b=n8(d);if(_){if(!_.P&&(_.i<4||!Wp("ES5").K(_)))return _.t;_.I=!0,g=Cve(d,b),_.I=!1}else g=Cve(d,b);return lw(g,function(S,E){_&&EVe(_.t,S)===E||Sve(g,S,h(E))}),b===3?new Set(g):g}(l)}function Cve(l,h){switch(h){case 2:return new Map(l);case 3:return Array.from(l)}return nX(l)}var Ave,cw,dX=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",RVe=typeof Map<"u",PVe=typeof Set<"u",Rve=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Pve=dX?Symbol.for("immer-nothing"):((Ave={})["immer-nothing"]=!0,Ave),Nve=dX?Symbol.for("immer-draftable"):"__$immer_draftable",Ac=dX?Symbol.for("immer-state"):"__$immer_state",NVe=""+Object.prototype.constructor,fX=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(l){return Object.getOwnPropertyNames(l).concat(Object.getOwnPropertySymbols(l))}:Object.getOwnPropertyNames,IVe=Object.getOwnPropertyDescriptors||function(l){var h={};return fX(l).forEach(function(d){h[d]=Object.getOwnPropertyDescriptor(l,d)}),h},kVe={},aD={get:function(l,h){if(h===Ac)return l;var d=O9(l);if(!Jq(d,h))return function(_,b,S){var E,N=Mve(b,S);return N?"value"in N?N.value:(E=N.get)===null||E===void 0?void 0:E.call(_.k):void 0}(l,d,h);var g=d[h];return l.I||!F9(g)?g:g===lX(l.t,h)?(uX(l),l.o[h]=hX(l.A.h,g,l)):g},has:function(l,h){return h in O9(l)},ownKeys:function(l){return Reflect.ownKeys(O9(l))},set:function(l,h,d){var g=Mve(O9(l),h);if(g!=null&&g.set)return g.set.call(l.k,d),!0;if(!l.P){var _=lX(O9(l),h),b=_==null?void 0:_[Ac];if(b&&b.t===d)return l.o[h]=d,l.D[h]=!1,!0;if(MVe(d,_)&&(d!==void 0||Jq(l.t,h)))return!0;uX(l),cX(l)}return l.o[h]===d&&typeof d!="number"&&(d!==void 0||h in l.o)||(l.o[h]=d,l.D[h]=!0,!0)},deleteProperty:function(l,h){return lX(l.t,h)!==void 0||h in l.t?(l.D[h]=!1,uX(l),cX(l)):delete l.D[h],l.o&&delete l.o[h],!0},getOwnPropertyDescriptor:function(l,h){var d=O9(l),g=Reflect.getOwnPropertyDescriptor(d,h);return g&&{writable:!0,configurable:l.i!==1||h!=="length",enumerable:g.enumerable,value:d[h]}},defineProperty:function(){Dh(11)},getPrototypeOf:function(l){return Object.getPrototypeOf(l.t)},setPrototypeOf:function(){Dh(12)}},lD={};lw(aD,function(l,h){lD[l]=function(){return arguments[0]=arguments[0][0],h.apply(this,arguments)}}),lD.deleteProperty=function(l,h){return aD.deleteProperty.call(this,l[0],h)},lD.set=function(l,h,d){return aD.set.call(this,l[0],h,d,l[0])};var DVe=function(){function l(d){var g=this;this.g=Rve,this.F=!0,this.produce=function(_,b,S){if(typeof _=="function"&&typeof b!="function"){var E=b;b=_;var N=g;return function(F){var H=this;F===void 0&&(F=E);for(var G=arguments.length,W=Array(G>1?G-1:0),X=1;X<G;X++)W[X-1]=arguments[X];return N.produce(F,function(Z){var te;return(te=b).call.apply(te,[H,Z].concat(W))})}}var I;if(typeof b!="function"&&Dh(6),S!==void 0&&typeof S!="function"&&Dh(7),F9(_)){var B=Tve(g),V=hX(g,_,void 0),U=!0;try{I=b(V),U=!1}finally{U?rD(B):oX(B)}return typeof Promise<"u"&&I instanceof Promise?I.then(function(F){return sX(B,S),aX(F,B)},function(F){throw rD(B),F}):(sX(B,S),aX(I,B))}if(!_||typeof _!="object")return(I=b(_))===Pve?void 0:(I===void 0&&(I=_),g.F&&rX(I,!0),I);Dh(21,_)},this.produceWithPatches=function(_,b){return typeof _=="function"?function(N){for(var I=arguments.length,B=Array(I>1?I-1:0),V=1;V<I;V++)B[V-1]=arguments[V];return g.produceWithPatches(N,function(U){return _.apply(void 0,[U].concat(B))})}:[g.produce(_,b,function(N,I){S=N,E=I}),S,E];var S,E},typeof(d==null?void 0:d.useProxies)=="boolean"&&this.setUseProxies(d.useProxies),typeof(d==null?void 0:d.autoFreeze)=="boolean"&&this.setAutoFreeze(d.autoFreeze)}var h=l.prototype;return h.createDraft=function(d){F9(d)||Dh(8),t8(d)&&(d=oD(d));var g=Tve(this),_=hX(this,d,void 0);return _[Ac].C=!0,oX(g),_},h.finishDraft=function(d,g){var _=d&&d[Ac],b=_.A;return sX(b,g),aX(void 0,b)},h.setAutoFreeze=function(d){this.F=d},h.setUseProxies=function(d){d&&!Rve&&Dh(20),this.g=d},h.applyPatches=function(d,g){var _;for(_=g.length-1;_>=0;_--){var b=g[_];if(b.path.length===0&&b.op==="replace"){d=b.value;break}}var S=Wp("Patches").$;return t8(d)?S(d,g):this.produce(d,function(E){return S(E,g.slice(_+1))})},l}(),Rc=new DVe;Rc.produce,Rc.produceWithPatches.bind(Rc),Rc.setAutoFreeze.bind(Rc),Rc.setUseProxies.bind(Rc),Rc.applyPatches.bind(Rc);var pX=Rc.createDraft.bind(Rc),mX=Rc.finishDraft.bind(Rc);z3(),JG(),W5(),gb(),HP(),Ik(),bo(),Kr();var Fh={create(l){let h={byId:{},allIds:{}};if(l)for(let[d,g]of l)h.byId[d]=g,h.allIds[d]=!0;return h},shallowCopy(l){return{byId:R({},l==null?void 0:l.byId),allIds:R({},l==null?void 0:l.allIds)}},add(l,h,d){return{byId:M(R({},l==null?void 0:l.byId),{[h]:d}),allIds:M(R({},l==null?void 0:l.allIds),{[h]:!0})}},merge(l){let h=Fh.create();for(let d=0;d<l.length;d++)h.byId=R(R({},h.byId),l[d].byId),h.allIds=R(R({},h.allIds),l[d].allIds);return h},remove(l,h){let d=Fh.shallowCopy(l);return delete d.allIds[h],delete d.byId[h],d},filter(l,h){let d=Fh.shallowCopy(l);for(let[g,_]of Object.entries(d.byId))h(_)||(delete d.allIds[g],delete d.byId[g]);return d}},Ive=l=>(gX=l,yX),gX,al=()=>{if(gX===void 0)throw new Error("Calling stateEditors outside of a transaction is not allowed.");return gX},yX;(l=>{(h=>{(d=>{(g=>{function _(b){let S=al().historic;S.panelPositions!=null||(S.panelPositions={}),S.panelPositions[b.panelId]=b.position}g.setPanelPosition=_})(d.panelPositions||(d.panelPositions={})),(g=>{function _(){var b;return(b=al().historic).panels!=null||(b.panels={}),al().historic.panels}g._ensure=_,(b=>{function S(){let E=l.studio.historic.panels._ensure();return E.outlinePanel!=null||(E.outlinePanel={}),E.outlinePanel}b._ensure=S,(E=>{function N(B){let V=[];for(let U of i0(B))In(U)?V.push(R({type:"Project"},U.address)):vt(U)?(V.push(R({type:"Sheet"},U.template.address)),l.studio.historic.projects.stateByProjectId.stateBySheetId.setSelectedInstanceId(U.address)):Ut(U)?V.push(R({type:"Sheet"},U.address)):Sn(U)?(V.push(R({type:"SheetObject"},U.template.address)),l.studio.historic.projects.stateByProjectId.stateBySheetId.setSelectedInstanceId(U.sheet.address)):Xn(U)&&V.push(R({type:"SheetObject"},U.address));b._ensure().selection=V}E.set=N;function I(){b._ensure().selection=[]}E.unset=I})(b.selection||(b.selection={}))})(g.outline||(g.outline={})),(b=>{function S(){let E=l.studio.historic.panels._ensure();return E.sequenceEditor!=null||(E.sequenceEditor={}),E.sequenceEditor}b._ensure=S,(E=>{function N(){let B=b._ensure();return B.graphEditor!=null||(B.graphEditor={height:.5,isOpen:!1}),B.graphEditor}function I(B){N().isOpen=B.isOpen}E.setIsOpen=I})(b.graphEditor||(b.graphEditor={}))})(g.sequenceEditor||(g.sequenceEditor={}))})(d.panels||(d.panels={})),(g=>{(_=>{function b(S){let E=al().historic;return E.projects.stateByProjectId[S.projectId]||(E.projects.stateByProjectId[S.projectId]={stateBySheetId:{}}),E.projects.stateByProjectId[S.projectId]}_._ensure=b,(S=>{function E(I){let B=l.studio.historic.projects.stateByProjectId._ensure(I);return B.stateBySheetId[I.sheetId]||(B.stateBySheetId[I.sheetId]={selectedInstanceId:void 0,sequenceEditor:{selectedPropsByObject:{}}}),B.stateBySheetId[I.sheetId]}S._ensure=E;function N(I){l.studio.historic.projects.stateByProjectId.stateBySheetId._ensure(I).selectedInstanceId=I.sheetInstanceId}S.setSelectedInstanceId=N,(I=>{function B(W){let{selectedPropsByObject:X}=S._ensure(W).sequenceEditor;X[W.objectKey]||(X[W.objectKey]={});let Z=X[W.objectKey],te=tf(W.pathToProp),ae=new Set(Object.keys(ZS));for(let[ue,Ee]of Object.entries(oD(X)))for(let[Ie,_e]of Object.entries(Ee))ae.delete(_e);let oe=ae.size>0?ae.values().next().value:Object.keys(ZS)[0];Z[te]=oe}I.addPropToGraphEditor=B;function V(W){let{selectedPropsByObject:X}=S._ensure(W).sequenceEditor;if(!X[W.objectKey])return;let Z=X[W.objectKey],te=tf(W.pathToProp);Z[te]&&bve(X,[W.objectKey,te])}I.removePropFromGraphEditor=V;function U(W){let X=l.studio.historic.projects.stateByProjectId.stateBySheetId._ensure(W).sequenceEditor;return X.markerSet||(X.markerSet=Fh.create()),X.markerSet}function F(W){let X=U(W.sheetAddress),Z=W.markers.filter(ue=>!!isFinite(ue.position)).map(ue=>M(R({},ue),{position:W.snappingFunction(ue.position)})),te=Lm(Z,"id"),ae=Fh.filter(X,ue=>ue&&!te[ue.id]),oe=Lm(Object.values(ae.byId),"position");Z.forEach(({position:ue})=>{let Ee=oe[ue];Ee&&(ae=Fh.remove(ae,Ee.id))}),Object.assign(X,Fh.merge([ae,Fh.create(Z.map(ue=>[ue.id,ue]))]))}I.replaceMarkers=F;function H(W){let X=U(W.sheetAddress);Object.assign(X,Fh.remove(X,W.markerId))}I.removeMarker=H;function G(W){let X=U(W.sheetAddress).byId[W.markerId];X!==void 0&&(X.label=W.label)}I.updateMarker=G})(S.sequenceEditor||(S.sequenceEditor={}))})(_.stateBySheetId||(_.stateBySheetId={}))})(g.stateByProjectId||(g.stateByProjectId={}))})(d.projects||(d.projects={}))})(h.historic||(h.historic={})),(d=>{function g(_){al().ephemeral.showOutline=_}d.setShowOutline=g,(_=>{(b=>{function S(E){let N=al().ephemeral;return N.projects.stateByProjectId[E.projectId]||(N.projects.stateByProjectId[E.projectId]={stateBySheetId:{}}),N.projects.stateByProjectId[E.projectId]}b._ensure=S,(E=>{function N(I){let B=l.studio.ephemeral.projects.stateByProjectId._ensure(I);return B.stateBySheetId[I.sheetId]||(B.stateBySheetId[I.sheetId]={stateByObjectKey:{}}),B.stateBySheetId[I.sheetId]}E._ensure=N,(I=>{function B(V){var U;let F=l.studio.ephemeral.projects.stateByProjectId.stateBySheetId._ensure(V).stateByObjectKey;return F[U=V.objectKey]!=null||(F[U]={}),F[V.objectKey]}I._ensure=B,(V=>{function U(H){let G=l.studio.ephemeral.projects.stateByProjectId.stateBySheetId.stateByObjectKey._ensure(H);return G.valuesBeingScrubbed!=null||(G.valuesBeingScrubbed={}),G.valuesBeingScrubbed}V._ensure=U;function F(H){Vd(U(H),H.pathToProp,!0)}V.flag=F})(I.propsBeingScrubbed||(I.propsBeingScrubbed={}))})(E.stateByObjectKey||(E.stateByObjectKey={}))})(b.stateBySheetId||(b.stateBySheetId={}))})(_.stateByProjectId||(_.stateByProjectId={}))})(d.projects||(d.projects={}))})(h.ephemeral||(h.ephemeral={})),(d=>{function g(N){al().ahistoric.pinOutline=N}d.setPinOutline=g;function _(N){al().ahistoric.pinDetails=N}d.setPinDetails=_;function b(N){al().ahistoric.pinNotifications=N}d.setPinNotifications=b;function S(N){al().ahistoric.visibilityState=N}d.setVisibilityState=S;function E(N){let I=jI(N.map(U=>U.pathToProp)),B=N.map(({keyframe:U,pathToProp:F})=>({keyframe:U,pathToProp:F.slice(I.length)})),V=al();V.ahistoric.clipboard?V.ahistoric.clipboard.keyframesWithRelativePaths=B:V.ahistoric.clipboard={keyframesWithRelativePaths:B}}d.setClipboardKeyframes=E,(N=>{(I=>{function B(V){let U=al().ahistoric;return U.projects.stateByProjectId[V.projectId]||(U.projects.stateByProjectId[V.projectId]={stateBySheetId:{}}),U.projects.stateByProjectId[V.projectId]}I._ensure=B,(V=>{function U(H){let G=l.studio.ahistoric.projects.stateByProjectId._ensure(H);return G.collapsedItemsInOutline||(G.collapsedItemsInOutline={}),G.collapsedItemsInOutline}V._ensure=U;function F(H){let G=l.studio.ahistoric.projects.stateByProjectId.collapsedItemsInOutline._ensure(H);H.isCollapsed?G[H.itemKey]=!0:delete G[H.itemKey]}V.set=F})(I.collapsedItemsInOutline||(I.collapsedItemsInOutline={})),(V=>{function U(F){let H=l.studio.ahistoric.projects.stateByProjectId._ensure(F);return H.stateBySheetId[F.sheetId]||(H.stateBySheetId[F.sheetId]={}),H.stateBySheetId[F.sheetId]}V._ensure=U,(F=>{function H(G){let W=l.studio.ahistoric.projects.stateByProjectId.stateBySheetId._ensure(G);return W.sequence||(W.sequence={}),W.sequence}F._ensure=H,(G=>{function W(Z){l.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence._ensure(Z).focusRange={range:Z.range,enabled:Z.enabled}}G.set=W;function X(Z){l.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence._ensure(Z).focusRange=void 0}G.unset=X})(F.focusRange||(F.focusRange={})),(G=>{function W(X){l.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence._ensure(X).clippedSpaceRange=R({},X.range)}G.set=W})(F.clippedSpaceRange||(F.clippedSpaceRange={})),(G=>{function W(Z){let te=l.studio.ahistoric.projects.stateByProjectId.stateBySheetId.sequence._ensure(Z),ae=te.collapsableItems;return ae||(ae=te.collapsableItems=Fh.create()),ae}function X(Z){let te=W(Z);Object.assign(te,Fh.add(te,Z.studioSheetItemKey,{isCollapsed:Z.isCollapsed}))}G.set=X})(F.sequenceEditorCollapsableItems||(F.sequenceEditorCollapsableItems={}))})(V.sequence||(V.sequence={}))})(I.stateBySheetId||(I.stateBySheetId={}))})(N.stateByProjectId||(N.stateByProjectId={}))})(d.projects||(d.projects={}))})(h.ahistoric||(h.ahistoric={}))})(l.studio||(l.studio={})),(h=>{(d=>{(g=>{function _(b){let S=al().historic.coreByProject[b.projectId].revisionHistory,E=50;S.unshift(b.revision),S.length>E&&(S.length=E)}g.add=_})(d.revisionHistory||(d.revisionHistory={})),(g=>{function _(E){let N=al().historic.coreByProject[E.projectId].sheetsById;return N[E.sheetId]||(N[E.sheetId]={staticOverrides:{byObject:{}}}),N[E.sheetId]}g._ensure=_;function b(E){let N=al().historic.coreByProject[E.projectId].sheetsById[E.sheetId];if(!N)return;delete N.staticOverrides.byObject[E.objectKey];let I=N.sequence;I&&delete I.tracksByObject[E.objectKey]}g.forgetObject=b;function S(E){al().historic.coreByProject[E.projectId].sheetsById[E.sheetId]&&delete al().historic.coreByProject[E.projectId].sheetsById[E.sheetId]}g.forgetSheet=S,(E=>{function N(_e){let Oe=l.coreByProject.historic.sheetsById._ensure(_e);return Oe.sequence!=null||(Oe.sequence={subUnitsPerUnit:30,length:10,type:"PositionalSequence",tracksByObject:{}}),Oe.sequence}E._ensure=N;function I(_e){N(_e).length=Ss(parseFloat(_e.length.toFixed(2)),.01,1/0)}E.setLength=I;function B(_e){N(_e).subUnitsPerUnit=Ss(_e.subUnitsPerUnit,1,T(2,12))}E.setSubUnitsPerUnit=B;function V(_e){var Oe;let ot=l.coreByProject.historic.sheetsById.sequence._ensure(_e).tracksByObject;return ot[Oe=_e.objectKey]!=null||(ot[Oe]={trackData:{},trackIdByPropPath:{}}),ot[_e.objectKey]}function U(_e,Oe){let ot=V(_e),de=tf(_e.pathToProp);if(typeof ot.trackIdByPropPath[de]=="string")return;let Be=UOe(),re={type:"BasicKeyframedTrack",__debugName:"".concat(_e.objectKey,":").concat(de),keyframes:[]};ot.trackData[Be]=re,ot.trackIdByPropPath[de]=Be}E.setPrimitivePropAsSequenced=U;function F(_e){let Oe=V(_e),ot=tf(_e.pathToProp),de=Oe.trackIdByPropPath[ot];typeof de=="string"&&(delete Oe.trackIdByPropPath[ot],delete Oe.trackData[de],l.coreByProject.historic.sheetsById.staticOverrides.byObject.setValueOfPrimitiveProp(_e))}E.setPrimitivePropAsStatic=F;function H(_e){let Oe=V(_e);for(let ot of Object.keys(Oe.trackIdByPropPath)){let de=JSON.parse(ot);if(_e.pathToProp.every((Be,re)=>de[re]===Be)){let Be=Oe.trackIdByPropPath[ot];if(typeof Be!="string")continue;delete Oe.trackIdByPropPath[ot],delete Oe.trackData[Be]}}l.coreByProject.historic.sheetsById.staticOverrides.byObject.setValueOfCompoundProp(_e)}E.setCompoundPropAsStatic=H;function G(_e){return V(_e).trackData[_e.trackId]}function W(_e){let Oe=G(_e);if(Oe)return Oe.keyframes.find(ot=>ot.id===_e.keyframeId)}function X(_e){let Oe=_e.snappingFunction(_e.position),ot=G(_e);if(!ot)return;let{keyframes:de}=ot,Be=de.findIndex(nn=>nn.position===Oe);if(Be!==-1){let nn=de[Be];nn.value=_e.value;return}let re=RP(de,nn=>nn.position<Oe);if(re===-1){de.unshift({id:kue(),position:Oe,connectedRight:!0,handles:_e.handles||[.5,1,.5,0],type:_e.type||"bezier",value:_e.value});return}let Ye=de[re];de.splice(re+1,0,{id:kue(),position:Oe,connectedRight:Ye.connectedRight,handles:_e.handles||[.5,1,.5,0],type:_e.type||"bezier",value:_e.value})}E.setKeyframeAtPosition=X;function Z(_e){let Oe=G(_e);if(!Oe)return;let{keyframes:ot}=Oe,de=ot.findIndex(Be=>Be.position===_e.position);de!==-1&&ot.splice(de,1)}E.unsetKeyframeAtPosition=Z;function te(_e){let Oe=G(_e);if(!Oe)return;let ot=oD(Oe.keyframes).filter(de=>_e.keyframeIds.includes(de.id)).map(de=>{let Be=de.position,re=_e.snappingFunction(TVe(Be,_e));return M(R({},de),{position:re})});Ie(M(R({},_e),{keyframes:ot}))}E.transformKeyframes=te;function ae(_e){let Oe=G(_e);Oe&&(Oe.keyframes=Oe.keyframes.map((ot,de)=>{let Be=Oe.keyframes[de-1],re=_e.keyframeIds.includes(ot.id),Ye=_e.keyframeIds.includes(Be==null?void 0:Be.id);return re&&!Ye?M(R({},ot),{handles:[ot.handles[0],ot.handles[1],_e.handles[0],_e.handles[1]]}):re&&Ye?M(R({},ot),{handles:[_e.handles[2],_e.handles[3],_e.handles[0],_e.handles[1]]}):Ye?M(R({},ot),{handles:[_e.handles[2],_e.handles[3],ot.handles[2],ot.handles[3]]}):ot}))}E.setTweenBetweenKeyframes=ae;function oe(_e){var Oe,ot,de,Be,re,Ye,nn,ke;let Re=W(_e);Re&&(Re.handles=[(ot=(Oe=_e.end)==null?void 0:Oe[0])!=null?ot:Re.handles[0],(Be=(de=_e.end)==null?void 0:de[1])!=null?Be:Re.handles[1],(Ye=(re=_e.start)==null?void 0:re[0])!=null?Ye:Re.handles[2],(ke=(nn=_e.start)==null?void 0:nn[1])!=null?ke:Re.handles[3]])}E.setHandlesForKeyframe=oe;function ue(_e){let Oe=G(_e);Oe&&(Oe.keyframes=Oe.keyframes.filter(ot=>_e.keyframeIds.indexOf(ot.id)===-1))}E.deleteKeyframes=ue;function Ee(_e){let Oe=W(_e);Oe&&(Oe.type=_e.keyframeType)}E.setKeyframeType=Ee;function Ie(_e){let Oe=G(_e);if(!Oe)return;let ot=oD(Oe.keyframes),de=_e.keyframes.filter(ke=>!(typeof ke.value=="number"&&!isFinite(ke.value)||!ke.handles.every(Re=>isFinite(Re)))).map(ke=>M(R({},ke),{position:_e.snappingFunction(ke.position)})),Be=Lm(de,"id"),re=ot.filter(ke=>!Be[ke.id]),Ye=Lm(re,"position");de.forEach(({position:ke})=>{let Re=Ye[ke];Re&&VP(re,Re)});let nn=yb([...re,...de],"position");Oe.keyframes=nn}E.replaceKeyframes=Ie})(g.sequence||(g.sequence={})),(E=>{(N=>{function I(F){var H;let G=l.coreByProject.historic.sheetsById._ensure(F).staticOverrides.byObject;return G[H=F.objectKey]!=null||(G[H]={}),G[F.objectKey]}function B(F){let H=I(F);Vd(H,F.pathToProp,F.value)}N.setValueOfCompoundProp=B;function V(F){let H=I(F);Vd(H,F.pathToProp,F.value)}N.setValueOfPrimitiveProp=V;function U(F){let H=l.coreByProject.historic.sheetsById._ensure(F).staticOverrides.byObject[F.objectKey];H&&bve(H,F.pathToProp)}N.unsetValueOfPrimitiveProp=U})(E.byObject||(E.byObject={}))})(g.staticOverrides||(g.staticOverrides={}))})(d.sheetsById||(d.sheetsById={}))})(h.historic||(h.historic={}))})(l.coreByProject||(l.coreByProject={}))})(yX||(yX={}));function vX(){let l,h,d=new Promise((_,b)=>{l=S=>{_(S),g.status="resolved"},h=S=>{b(S),g.status="rejected"}}),g={resolve:l,reject:h,promise:d,status:"pending"};return g}var FVe=Jt;function OVe(l){let h=l.getState(),d=new FVe.Atom(h);return l.subscribe(()=>{let g=l.getState();d.set(g),h=g}),d}XA();function BVe(l){var h,d=l.Symbol;return typeof d=="function"?d.observable?h=d.observable:(h=d("observable"),d.observable=h):h="@@observable",h}var uw;typeof self<"u"?uw=self:typeof window<"u"?uw=window:typeof lo<"u"?uw=lo:uw=i;var LVe=BVe(uw),kve=LVe,Dve={INIT:"@@redux/INIT"};function Fve(l,h,d){var g;if(typeof h=="function"&&typeof d>"u"&&(d=h,h=void 0),typeof d<"u"){if(typeof d!="function")throw new Error("Expected the enhancer to be a function.");return d(Fve)(l,h)}if(typeof l!="function")throw new Error("Expected the reducer to be a function.");var _=l,b=h,S=[],E=S,N=!1;function I(){E===S&&(E=S.slice())}function B(){return b}function V(G){if(typeof G!="function")throw new Error("Expected listener to be a function.");var W=!0;return I(),E.push(G),function(){if(W){W=!1,I();var X=E.indexOf(G);E.splice(X,1)}}}function U(G){if(!Ud(G))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(typeof G.type>"u")throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(N)throw new Error("Reducers may not dispatch actions.");try{N=!0,b=_(b,G)}finally{N=!1}for(var W=S=E,X=0;X<W.length;X++){var Z=W[X];Z()}return G}function F(G){if(typeof G!="function")throw new Error("Expected the nextReducer to be a function.");_=G,U({type:Dve.INIT})}function H(){var G,W=V;return G={subscribe:function(X){if(typeof X!="object")throw new TypeError("Expected the observer to be an object.");function Z(){X.next&&X.next(B())}Z();var te=W(Z);return{unsubscribe:te}}},G[kve]=function(){return this},G}return U({type:Dve.INIT}),g={dispatch:U,subscribe:V,getState:B,replaceReducer:F},g[kve]=H,g}function UVe(){for(var l=arguments.length,h=Array(l),d=0;d<l;d++)h[d]=arguments[d];return h.length===0?function(g){return g}:h.length===1?h[0]:h.reduce(function(g,_){return function(){return g(_.apply(void 0,arguments))}})}function zVe(l){let h=UVe();return Fve(l.rootReducer,void 0,h)}Fk(),wP();var _X=new WeakMap,VVe=(l,h,d)=>{let g=N=>{l.dispatch(e8.replacePersistentState(N))},_=Ove(d),b=()=>l.getState().$persistent;E();let S=()=>{let N=b(),I=_X.get(l);N!==I&&(_X.set(l,N),localStorage.setItem(_,JSON.stringify(N)))};l.subscribe(G5(S,1e3)),window&&window.addEventListener("beforeunload",S);function E(){let N=localStorage.getItem(_);if(N){let I,B=!0;try{I=JSON.parse(N),B=!1}catch{Dk.warn("Could not parse Theatre's persisted state. This must be a bug. Please report it.")}finally{B||g(I),h()}}else h()}},GVe=(l,h)=>{let d=Ove(h),g=l.getState().$persistent;localStorage.removeItem(d),_X.set(l,g)};function Ove(l){return l+".persistent"}$he(),Kr(),mp(),is(),Ht(),pI();var cD=Jt;eg(),bo(),A4e();function xX(l){if(typeof l=="boolean"||typeof l=="string"||typeof l=="number")return l;if(Ud(l)){let h={},d=!1;for(let[g,_]of Object.entries(l))xX(_)!==void 0&&(h[g]=_,d=!0);if(d)return h}else return}function Bve(l,h,d){for(let[g,_]of Object.entries(l.props))if(_.type==="compound")Bve(_,[...h,g],d);else{if(_.type==="enum")throw new Error("Not yet implemented");d(_,[...h,g])}}function $Ve(l,h,d){return{set:(g,_)=>{l();let b=xX(_);if(typeof b>"u")return;let{root:S,path:E}=(0,cD.getPointerParts)(g);if(Sn(S)){let N=S.template.getMapOfValidSequenceTracks_forStudio().getValue(),I=cI(S.template.staticConfig,E);if(!I)throw new Error("Object ".concat(S.address.objectKey," does not have a prop at ").concat(JSON.stringify(E)));let B=(V,U,F)=>{if(V==null)return;if(xX(U.deserializeAndSanitize(V))===void 0)throw new Error("Invalid value ".concat(Pq(V)," for object.props").concat(F.map(W=>"[".concat(JSON.stringify(W),"]")).join("")," is invalid"));let H=M(R({},S.address),{pathToProp:F}),G=pp(N,F);if(typeof G=="string"){let W=S.sheet.getSequence();W.position=W.closestGridPosition(W.position),h.coreByProject.historic.sheetsById.sequence.setKeyframeAtPosition(M(R({},H),{trackId:G,position:W.position,value:V,snappingFunction:W.closestGridPosition,type:"bezier"}))}else h.coreByProject.historic.sheetsById.staticOverrides.byObject.setValueOfPrimitiveProp(M(R({},H),{value:V}))};if(I.type==="compound"){let V=(0,cD.getPointerParts)(g).path,U=V.length;Bve(I,V,(F,H)=>{let G=H.slice(U),W=ng(b,G);if(typeof W<"u")B(W,F,H);else throw new Error("Property object.props".concat(H.map(X=>"[".concat(JSON.stringify(X),"]")).join("")," is required but not provided"))})}else{if(I.type==="enum")throw new Error("Enums aren't implemented yet");B(b,I,E)}}else if(ln(S)){let[N]=E;if(N==="subUnitsPerUnit"){if(typeof b!="number"||!fh(b)||b<1)throw new Error("Value ".concat(b," is not an integer, which is required for setting sequence prop ").concat(N));h.coreByProject.historic.sheetsById.sequence.setSubUnitsPerUnit(M(R({},S.address),{subUnitsPerUnit:b}))}else if(N==="length"){if(typeof b!="number"||b<=.001)throw new Error("Value ".concat(b," is not a positive number, which is required for setting sequence prop ").concat(N));h.coreByProject.historic.sheetsById.sequence.setLength(M(R({},S.address),{length:b}))}else throw new Error("Setting sequence prop ".concat(N," is not supported"))}else throw new Error("Only setting props of SheetObject-s and sequences is supported in a transaction so far")},unset:g=>{l();let{root:_,path:b}=(0,cD.getPointerParts)(g);if(Sn(_)){let S=_.template.getMapOfValidSequenceTracks_forStudio().getValue(),E=ng(_.template.getDefaultValues().getValue(),b),N=cI(_.template.staticConfig,b),I=(B,V)=>{let U=M(R({},_.address),{pathToProp:V}),F=pp(S,V);typeof F=="string"?h.coreByProject.historic.sheetsById.sequence.unsetKeyframeAtPosition(M(R({},U),{trackId:F,position:_.sheet.getSequence().positionSnappedToGrid})):N!==void 0&&h.coreByProject.historic.sheetsById.staticOverrides.byObject.unsetValueOfPrimitiveProp(U)};N.type==="compound"?Ne(E,(B,V)=>{I(B,V)},(0,cD.getPointerParts)(g).path):I(E,b)}else throw new Error("Only setting props of SheetObject-s is supported in a transaction so far")},get drafts(){return l(),d},get stateEditors(){return h}}}var HVe=class{constructor(){K(this,"_reduxStore"),K(this,"_atom"),K(this,"atomP"),this._reduxStore=zVe({rootReducer:wVe,devtoolsOptions:{name:"Theatre.js Studio"}}),this._atom=OVe(this._reduxStore),this.atomP=this._atom.pointer}initialize(l){let h=vX();return l.usePersistentStorage===!0?VVe(this._reduxStore,()=>{this.tempTransaction(({drafts:d})=>{d.ephemeral.initialised=!0}).commit(),h.resolve()},l.persistenceKey):(this.tempTransaction(({drafts:d})=>{d.ephemeral.initialised=!0}).commit(),h.resolve()),h.promise}getState(){return this._reduxStore.getState()}__experimental_clearPersistentStorage(l){return GVe(this._reduxStore,l),this.getState()}__dev_startHistoryFromScratch(l){this._reduxStore.dispatch(e8.historic.startHistoryFromScratch(e8.reduceParts(h=>M(R({},h),{historic:l}))))}tempTransaction(l){let h=SVe(),d,g=h.push(e8.reduceParts(_=>{let b={historic:pX(_.historic),ahistoric:pX(_.ahistoric),ephemeral:pX(_.ephemeral)},S=!0,E=()=>{if(!S)throw new Error("You seem to have called the transaction api after studio.transaction() has finished running")},N=Ive(b),I=$Ve(E,N,b);try{return l(I),S=!1,{historic:mX(b.historic),ahistoric:mX(b.ahistoric),ephemeral:mX(b.ephemeral)}}catch(B){return d=B,_}finally{Ive(void 0)}}));if(this._reduxStore.dispatch(g),d)throw this._reduxStore.dispatch(h.discard()),d;return{commit:()=>{this._reduxStore.dispatch(h.commit())},discard:()=>{this._reduxStore.dispatch(h.discard())}}}undo(){this._reduxStore.dispatch(e8.historic.undo())}redo(){this._reduxStore.dispatch(e8.historic.redo())}createContentOfSaveFile(l){if(!this._reduxStore.getState().$persistent.historic.innerState.coreByProject[l])throw new Error("Project ".concat(l," has not been initialized."));let h=Ghe();this.tempTransaction(({stateEditors:g})=>{g.coreByProject.historic.revisionHistory.add({projectId:l,revision:h})}).commit();let d=this._reduxStore.getState().$persistent.historic.innerState.coreByProject[l];return R({},d)}},jVe=Jt,bX=class{constructor(){K(this,"_values",{})}get(l,h){if(this.has(l))return this._values[l];{let d=h();return this._values[l]=d,d}}has(l){return this._values.hasOwnProperty(l)}};Kr(),Km(),Fe(),bo(),Mq();var WVe=class{constructor(l){K(this,"ui",{hide(){ge().ui.hide()},get isHidden(){return ge().ui.isHidden},restore(){ge().ui.restore()},renderToolset(h,d){return ge().ui.renderToolset(h,d)}}),K(this,"_cache",new bX),K(this,"__experimental",{__experimental_disblePlayPauseKeyboardShortcut(){ZUe()},__experimental_enablePlayPauseKeyboardShortcut(){QUe()},__experimental_clearPersistentStorage(h){return ge().clearPersistentStorage(h)},__experimental_createContentOfSaveFileTyped(h){return ge().createContentOfSaveFile(h)}})}initialize(l){return ge().initialize(l)}extend(l,h){ge().extend(l,h)}transaction(l){return ge().transaction(({set:h,unset:d,stateEditors:g})=>l({set:h,unset:d,__experimental_forgetObject:_=>{if(!lr(_))throw new Error("object in transactionApi.__experimental_forgetObject(object) must be the return type of sheet.object(...)");g.coreByProject.historic.sheetsById.forgetObject(_.address)},__experimental_forgetSheet:_=>{if(!Yr(_))throw new Error("sheet in transactionApi.__experimental_forgetSheet(sheet) must be the return type of project.sheet()");g.coreByProject.historic.sheetsById.forgetSheet(_.address)}}))}_getSelectionPrism(){return this._cache.get("_getSelectionPrism()",()=>(0,jVe.prism)(()=>Ym().filter(l=>l.type==="Theatre_SheetObject"||l.type==="Theatre_Sheet").map(l=>l.publicApi)))}_getSelection(){return this._getSelectionPrism().getValue()}setSelection(l){let h=[...l].filter(d=>lr(d)||Yr(d)).map(d=>ge().corePrivateAPI(d));ge().transaction(({stateEditors:d})=>{d.studio.historic.panels.outline.selection.set(h)})}onSelectionChange(l){let h=ge();return this._getSelectionPrism().onChange(h.ticker,l,!0)}get selection(){return this._getSelection()}scrub(){return ge().scrub()}getStudioProject(){let l=ge().core;if(!l)throw new Error("You're calling studio.getStudioProject() before `@theatre/core` is loaded. To fix this:\n1. Check if `@theatre/core` is import/required in your bundle.\n2. Check the stack trace of this error and make sure the funciton that calls getStudioProject() is run after `@theatre/core` is loaded.");return ge().getStudioProject(l)}debouncedScrub(l=1e3){let h,d=G5(()=>{let g=h;g&&(h=void 0,g.commit())},l);return{capture:g=>{h||(h=this.scrub());let _=!0;try{h.capture(g),_=!1}finally{if(_){let b=h;h=void 0,b.discard()}else d()}}}}createPane(l){return ge().paneManager.createPane(l)}destroyPane(l){return ge().paneManager.destroyPane(l)}createContentOfSaveFile(l){return ge().createContentOfSaveFile(l)}};Iue();var B9=Jt,qVe=class{constructor(l){this._studio=l,K(this,"_cache",new bX),this._instantiatePanesAsTheyComeIn()}_instantiatePanesAsTheyComeIn(){let l=this._getAllPanes();l.onStale(()=>{l.getValue()})}_getAllPanes(){return this._cache.get("_getAllPanels()",()=>(0,B9.prism)(()=>{if(!(0,B9.val)(this._studio.coreP))return{};let l=(0,B9.val)(this._studio.atomP.historic.panelInstanceDesceriptors),h=(0,B9.val)(this._studio.atomP.ephemeral.extensions.paneClasses),d={};for(let g of Object.values(l)){if(!g)continue;let _=h[g.paneClass];if(!_)continue;let{instanceId:b}=g,{extensionId:S,classDefinition:E}=_,N=B9.prism.memo("instance-".concat(g.instanceId),()=>({extensionId:S,instanceId:b,definition:E}),[E]);d[b]=N}return d}))}get allPanesD(){return this._getAllPanes()}createPane(l){if(!this._studio.core)throw new Error("Can't create a pane because @theatre/core is not yet loaded");let h=(0,B9.val)(this._studio.atomP.ephemeral.extensions.paneClasses[l].extensionId),d=(0,B9.val)(this._studio.atomP.historic.panelInstanceDesceriptors),g;for(let _=1;_<1e3&&(g="".concat(l," #").concat(_),!!d[g]);_++);if(!h)throw new Error('Pane class "'.concat(l,'" is not registered.'));return this._studio.transaction(({drafts:_})=>{_.historic.panelInstanceDesceriptors[g]={instanceId:g,paneClass:l}}),this._getAllPanes().getValue()[g]}destroyPane(l){if(!this._studio.core)throw new Error("Can't do this yet because @theatre/core is not yet loaded");this._studio.transaction(({drafts:h})=>{delete h.historic.panelInstanceDesceriptors[l]})}},uD=Jt;Fe();var Lve=30*60*1e3,XVe=1e3*60*60;function YVe(){return he(this,null,function*(){let l=ge().atomP.ahistoric.visibilityState;if((0,uD.val)(l)==="everythingIsVisible")return;let h=vX(),d=(0,uD.pointerToPrism)(l).onStale(()=>{(0,uD.val)(l)==="everythingIsVisible"&&(d(),h.resolve(void 0))});return h.promise})}function KVe(){return he(this,null,function*(){if(!"0.7.2".match(/COMPAT/))for(yield hD(500),yield YVe();;){let l=(0,uD.val)(ge().atomP.ahistoric.updateChecker);if(l&&l.result!=="error"){let h=l.lastChecked,d=Date.now(),g=Math.abs(d-h);g<Lve&&(yield hD(Lve-g))}try{let h=yield fetch(new Request("https://updates.theatrejs.com/updates/0.7.2"));if(h.ok){let d=yield h.json();if(!ZVe(d))throw new Error("Bad response");ge().transaction(({drafts:g})=>{g.ahistoric.updateChecker={lastChecked:Date.now(),result:R({},d)}}),yield hD(1e3)}else throw new Error("HTTP Error ".concat(h.statusText))}catch{yield hD(XVe)}}})}var hD=l=>new Promise(h=>setTimeout(h,l));function ZVe(l){if(typeof l!="object")return!1;let h=l;return typeof h.hasUpdates!="boolean"?!1:h.hasUpdates===!0&&typeof h.newVersion=="string"&&typeof h.releasePage=="string"||h.hasUpdates===!1}var QVe=z(zm());function qp(l){return new Promise((h,d)=>{l.oncomplete=l.onsuccess=()=>h(l.result),l.onabort=l.onerror=()=>d(l.error)})}function Uve(l,h){let d=indexedDB.open(l);d.onupgradeneeded=()=>d.result.createObjectStore(h);let g=qp(d);return(_,b)=>g.then(S=>b(S.transaction(h,_).objectStore(h)))}var SX;function r8(){return SX||(SX=Uve("keyval-store","keyval")),SX}function JVe(l,h=r8()){return h("readonly",d=>qp(d.get(l)))}function eGe(l,h,d=r8()){return d("readwrite",g=>(g.put(h,l),qp(g.transaction)))}function tGe(l,h=r8()){return h("readwrite",d=>(d.delete(l),qp(d.transaction)))}function wX(l,h){return l.openCursor().onsuccess=function(){this.result&&(h(this.result),this.result.continue())},qp(l.transaction)}function nGe(l=r8()){return l("readonly",h=>{if(h.getAllKeys)return qp(h.getAllKeys());let d=[];return wX(h,g=>d.push(g.key)).then(()=>d)})}function rGe(l=r8()){return l("readonly",h=>{if(h.getAll)return qp(h.getAll());let d=[];return wX(h,g=>d.push(g.value)).then(()=>d)})}function iGe(l=r8()){return l("readonly",h=>{if(h.getAll&&h.getAllKeys)return Promise.all([qp(h.getAllKeys()),qp(h.getAll())]).then(([g,_])=>g.map((b,S)=>[b,_[S]]));let d=[];return l("readonly",g=>wX(g,_=>d.push([_.key,_.value])).then(()=>d))})}var sGe=l=>{let h=Uve("theatrejs-".concat(l),"default-store");return{set:(d,g)=>eGe(d,g,h),get:d=>JVe(d,h),del:d=>tGe(d,h),keys:()=>nGe(h),entries:()=>iGe(h),values:()=>rGe(h)}};ffe(),IS();var zve="theatre-0.4",oGe=`You seem to have imported '@theatre/studio' but haven't initialized it. You can initialize the studio by:
\`\`\`
import studio from '@theatre/studio'
studio.initialize()
\`\`\`

* If you didn't mean to import '@theatre/studio', this means that your bundler is not tree-shaking it. This is most likely a bundler misconfiguration.

* If you meant to import '@theatre/studio' without showing its UI, you can do that by running:

\`\`\`
import studio from '@theatre/studio'
studio.initialize()
studio.ui.hide()
\`\`\`
`,aGe="You seem to have imported '@theatre/studio' but called `studio.initialize()` after some delay.\nTheatre.js projects remain in pending mode (won't play their sequences) until the studio is initialized, so you should place the `studio.initialize()` line right after the import line:\n\n```\nimport studio from '@theatre/studio'\n// ... and other imports\n\nstudio.initialize()\n```\n",lGe=class{constructor(){K(this,"ui"),K(this,"publicApi"),K(this,"address"),K(this,"_projectsProxy",new Jk.PointerProxy(new Jk.Atom({}).pointer)),K(this,"projectsP",this._projectsProxy.pointer),K(this,"_store",new HVe),K(this,"_corePrivateApi"),K(this,"_cache",new bX),K(this,"paneManager"),K(this,"_coreAtom",new Jk.Atom({})),K(this,"_initializedDeferred",vX()),K(this,"_initializeFnCalled",!1),K(this,"_didWarnAboutNotInitializing",!1),K(this,"_coreBits"),K(this,"_rafDriver"),this.address={studioId:_S(10)},this.publicApi=new WVe(this),this.ui=new tVe(this),this._attachToIncomingProjects(),this.paneManager=new qVe(this),typeof window<"u"&&setTimeout(()=>{this._initializeFnCalled||(console.error(oGe),this._didWarnAboutNotInitializing=!0)},100)}get ticker(){if(!this._rafDriver)throw new Error("`studio.ticker` was read before studio.initialize() was called.");return this._rafDriver.ticker}get atomP(){return this._store.atomP}initialize(l){return he(this,null,function*(){if(!this._coreBits)throw new Error("You seem to have imported `@theatre/studio` without importing `@theatre/core`. Make sure to include an import of `@theatre/core` before calling `studio.initializer()`.");if(this._initializeFnCalled)return this._initializedDeferred.promise;this._initializeFnCalled=!0,this._didWarnAboutNotInitializing&&console.warn(aGe);let h={persistenceKey:zve,usePersistentStorage:!0};if(typeof(l==null?void 0:l.persistenceKey)=="string"&&(h.persistenceKey=l.persistenceKey),((l==null?void 0:l.usePersistentStorage)===!1||typeof window>"u")&&(h.usePersistentStorage=!1),l!=null&&l.__experimental_rafDriver){if(l.__experimental_rafDriver.type!=="Theatre_RafDriver_PublicAPI")throw new Error("parameter `rafDriver` in `studio.initialize({__experimental_rafDriver})` must be either be undefined, or the return type of core.createRafDriver()");let d=this._coreBits.privateAPI(l.__experimental_rafDriver);if(!d)throw new Error("parameter `rafDriver` in `studio.initialize({__experimental_rafDriver})` seems to come from a different version of `@theatre/core` than the version that is attached to `@theatre/studio`");this._rafDriver=d}else this._rafDriver=this._coreBits.getCoreRafDriver();try{yield this._store.initialize(h)}catch(d){this._initializedDeferred.reject(d);return}typeof window<"u"&&(yield this.ui.ready),this._initializedDeferred.resolve(),this.ui.render(),KVe().catch(d=>{console.error(d)})})}get initialized(){return this._initializedDeferred.promise}_attachToIncomingProjects(){let l=(0,Jk.pointerToPrism)(this.projectsP),h=d=>{for(let g of Object.values(d))g.isAttachedToStudio||g.attachToStudio(this)};l.onStale(()=>{h(l.getValue())}),h(l.getValue())}setCoreBits(l){this._coreBits=l,this._corePrivateApi=l.privateAPI,this._coreAtom.setByPointer(h=>h.core,l.coreExports),this._setProjectsP(l.projectsP)}_setProjectsP(l){this._projectsProxy.setPointer(l)}scrub(){return new Jze(this)}tempTransaction(l){return this._store.tempTransaction(l)}transaction(l){return this.tempTransaction(l).commit()}__dev_startHistoryFromScratch(l){return this._store.__dev_startHistoryFromScratch(l)}get corePrivateAPI(){return this._corePrivateApi}get core(){return this._coreAtom.get().core}get coreP(){return this._coreAtom.pointer.core}extend(l,h){if(!l||typeof l!="object")throw new Error("Extensions must be JS objects");if(typeof l.id!="string")throw new Error("extension.id must be a string");let d=(h==null?void 0:h.__experimental_reconfigure)===!0,g=l.id,_=this._store.getState().ephemeral.extensions.byId[g];if(_&&!d){if(l===_||(0,QVe.default)(l,_))return;throw new Error('Extension id "'.concat(l.id,'" is already defined. If you mean to re-configure the extension, do it like this: studio.extend(extension, {__experimental_reconfigure: true})})'))}this.transaction(({drafts:b})=>{var S,E;b.ephemeral.extensions.byId[l.id]=l;let N=b.ephemeral.extensions.paneClasses;d&&_&&((S=_.panes)==null||S.forEach(I=>{delete N[I.class]})),(E=l.panes)==null||E.forEach(I=>{if(typeof I.class!="string")throw new Error("pane.class must be a string");if(I.class.length<3)throw new Error("pane.class should be a string with 3 or more characters");let B=N[I.class];if(B)if(d&&B.extensionId===l.id)console.warn('Pane class "'.concat(I.class,'" already exists. This is a bug in Theatre.js. Please report it at https://github.com/theatre-js/theatre/issues/new'));else throw new Error('Pane class "'.concat(I.class,'" already exists and is supplied by extension ').concat(B));N[I.class]={extensionId:l.id,classDefinition:I}})})}getStudioProject(l){return this._cache.get("getStudioProject",()=>l.getProject("Studio"))}getExtensionSheet(l,h){return this._cache.get("extensionSheet-"+l,()=>this.getStudioProject(h).sheet("Extension "+l))}undo(){this._store.undo()}redo(){this._store.redo()}createContentOfSaveFile(l){return this._store.createContentOfSaveFile(l)}createAssetStorage(l,h){return he(this,null,function*(){if(typeof window>"u")return{getAssetUrl:()=>"",createAsset:()=>Promise.resolve(null)};if(!("indexedDB"in window))return console.log("This browser doesn't support IndexedDB."),{getAssetUrl:I=>{throw new Error("IndexedDB is required by the default asset manager, but it's not supported by this browser. To use assets, please provide your own asset manager to the project config.")},createAsset:I=>{throw new Error("IndexedDB is required by the default asset manager, but it's not supported by this browser. To use assets, please provide your own asset manager to the project config.")}};let d=sGe("".concat(l.address.projectId,"-assets")),g=Dj(l),_=yield d.keys();yield Promise.all(_.map(I=>he(this,null,function*(){g.includes(I)||(yield d.del(I))}))),yield Promise.all(_.map(I=>he(this,null,function*(){var B,V;let U="".concat(h,"/").concat(I);try{(yield fetch(U,{method:"HEAD"})).ok&&(yield d.del(I))}catch{NS.error("Failed to access assets","Failed to access assets at ".concat((V=(B=l.config.assets)==null?void 0:B.baseUrl)!=null?V:"/",". This is likely due to a CORS issue."))}})));let b=new Map(yield d.entries()),S=new Map,E=I=>{if(S.has(I))return S.get(I);{let B=URL.createObjectURL(I);return S.set(I,B),B}},N=I=>{let B=b.get(I);if(!B)throw new Error("Asset with id ".concat(I," not found"));return E(B)};return{getAssetUrl:I=>b.has(I)?N(I):"".concat(h,"/").concat(I),createAsset:I=>he(this,null,function*(){var B,V,U;let F=Dj(l),H=!1;if(F.includes(I.name)){let G;try{G=(B=b.get(I.name))!=null?B:yield fetch("".concat(h,"/").concat(I.name)).then(W=>W.ok?W.blob():void 0)}catch{return NS.error("Failed to access assets","Failed to access assets at ".concat((U=(V=l.config.assets)==null?void 0:V.baseUrl)!=null?U:"/",". This is likely due to a CORS issue.")),Promise.resolve(null)}if(G){if(H=yield(yield Promise.resolve().then(()=>z(Zze()))).default.isEqual(I,G),H)return I.name;{let W=X=>{let Z=prompt(X,I.name);return Z===null?!1:Z===""?W("Asset name cannot be empty. Please choose a different file name for this asset."):F.includes(Z)?(console.log(F),W("An asset with this name already exists. Please choose a different file name for this asset.")):(I=new File([I],Z,{type:I.type}),!0)};if(!W("An asset with this name already exists. Please choose a different file name for this asset."))return null}}}return b.set(I.name,I),yield d.set(I.name,I),I.name})}})}clearPersistentStorage(l=zve){this._store.__experimental_clearPersistentStorage(l)}},TX="__TheatreJS_StudioBundle",cGe="__TheatreJS_CoreBundle",uGe="__TheatreJS_Notifications",hGe=class{constructor(l){this._studio=l,K(this,"_coreBundle")}get type(){return"Theatre_StudioBundle"}registerCoreBundle(l){if(this._coreBundle)throw new Error("StudioBundle.coreBundle is already registered. This is a bug.");this._coreBundle=l;let h;l.getBitsForStudio(this._studio,d=>{h=d}),this._studio.setCoreBits(h)}},dGe=z(Le());at();var Vve,fGe=me.div(Vve||(Vve=$([""]))),pGe=l=>dGe.default.createElement(fGe,null),mGe=pGe;IS();var EX=new lGe;je(EX);var gGe=EX.publicApi,yGe=gGe;vGe();function vGe(){if(typeof window>"u")return;let l=window[TX];if(typeof l<"u")throw typeof l=="object"&&l&&typeof l.version=="string"?new Error(`It seems that the module '@theatre/studio' is loaded more than once. This could have two possible causes:
1. You might have two separate versions of Theatre.js in node_modules.
2. Or this might be a bundling misconfiguration, in case you're using a bundler like Webpack/ESBuild/Rollup.

Note that it **is okay** to import '@theatre/studio' multiple times. But those imports should point to the same module.`):new Error("The variable window.".concat(TX," seems to be already set by a module other than @theatre/core."));let h=new hGe(EX);window[TX]=h;let d=window[cGe];d&&d!==null&&d.type==="Theatre_CoreBundle"&&h.registerCoreBundle(d)}typeof window<"u"&&(window[uGe]={notify:NS});/*! Bundled license information:

	lodash-es/lodash.js:
	  (**
	   * @license
	   * Lodash (Custom Build) <https://lodash.com/>
	   * Build: `lodash modularize exports="es" -o ./`
	   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
	   * Released under MIT license <https://lodash.com/license>
	   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
	   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
	   *)

	queue-microtask/index.js:
	  (*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

	react/cjs/react.production.min.js:
	  (**
	   * @license React
	   * react.production.min.js
	   *
	   * Copyright (c) Facebook, Inc. and its affiliates.
	   *
	   * This source code is licensed under the MIT license found in the
	   * LICENSE file in the root directory of this source tree.
	   *)

	scheduler/cjs/scheduler.production.min.js:
	  (**
	   * @license React
	   * scheduler.production.min.js
	   *
	   * Copyright (c) Facebook, Inc. and its affiliates.
	   *
	   * This source code is licensed under the MIT license found in the
	   * LICENSE file in the root directory of this source tree.
	   *)

	react-dom/cjs/react-dom.production.min.js:
	  (**
	   * @license React
	   * react-dom.production.min.js
	   *
	   * Copyright (c) Facebook, Inc. and its affiliates.
	   *
	   * This source code is licensed under the MIT license found in the
	   * LICENSE file in the root directory of this source tree.
	   *)

	react-is/cjs/react-is.production.min.js:
	  (** @license React v17.0.2
	   * react-is.production.min.js
	   *
	   * Copyright (c) Facebook, Inc. and its affiliates.
	   *
	   * This source code is licensed under the MIT license found in the
	   * LICENSE file in the root directory of this source tree.
	   *)

	react-is/cjs/react-is.production.min.js:
	  (** @license React v16.13.1
	   * react-is.production.min.js
	   *
	   * Copyright (c) Facebook, Inc. and its affiliates.
	   *
	   * This source code is licensed under the MIT license found in the
	   * LICENSE file in the root directory of this source tree.
	   *)

	jszip/dist/jszip.min.js:
	  (*!
	  
	  JSZip v3.10.1 - A JavaScript class for generating and reading zip files
	  <http://stuartk.com/jszip>
	  
	  (c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
	  Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.
	  
	  JSZip uses the library pako released under the MIT license :
	  https://github.com/nodeca/pako/blob/main/LICENSE
	  *)

	jiff/lib/lcs.js:
	  (** @license MIT License (c) copyright 2010-2014 original author or authors *)

	jiff/lib/array.js:
	  (** @license MIT License (c) copyright 2010-2014 original author or authors *)

	jiff/lib/jsonPointerParse.js:
	  (** @license MIT License (c) copyright 2010-2014 original author or authors *)

	jiff/lib/jsonPointer.js:
	  (** @license MIT License (c) copyright 2010-2014 original author or authors *)

	jiff/lib/clone.js:
	  (** @license MIT License (c) copyright 2010-2014 original author or authors *)

	jiff/lib/jsonPatch.js:
	  (** @license MIT License (c) copyright 2010-2014 original author or authors *)

	jiff/jiff.js:
	  (** @license MIT License (c) copyright 2010-2014 original author or authors *)
	*/})(RL,RL.exports);var UWe=RL.exports;const zCe=fHe(UWe);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const fx="177",n_={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},k6={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},VCe=0,Mee=1,GCe=2,zWe=0,Bne=1,VWe=2,jc=3,Xl=0,Ui=1,Co=2,vl=0,fc=1,f4=2,p4=3,m4=4,Jy=5,gl=100,FU=101,OU=102,Lne=103,Une=104,ud=200,KM=201,ZM=202,QM=203,g4=204,y4=205,JM=206,eC=207,tC=208,nC=209,BU=210,zne=211,Vne=212,Gne=213,$ne=214,cM=0,uM=1,hM=2,z2=3,dM=4,fM=5,pM=6,mM=7,rC=0,$Ce=1,HCe=2,Yl=0,Hne=1,jne=2,Wne=3,qne=4,jCe=5,Xne=6,Yne=7,Bxe="attached",GWe="detached",Wy=300,Wf=301,qf=302,v4=303,M_=304,_4=306,tu=1e3,ta=1001,x4=1002,es=1003,Kne=1004,T1=1005,_s=1006,r_=1007,oc=1008,ps=1009,e4=1010,t4=1011,_d=1012,qa=1013,fs=1014,Ys=1015,Aa=1016,LU=1017,UU=1018,pc=1020,zU=35902,Zne=1021,iC=1022,xs=1023,Zc=1026,mc=1027,sC=1028,px=1029,E1=1030,mx=1031,$We=1032,gx=1033,n4=33776,D2=33777,F2=33778,O2=33779,gM=35840,yM=35841,vM=35842,_M=35843,xM=36196,C_=37492,A_=37496,R_=37808,P_=37809,N_=37810,I_=37811,k_=37812,D_=37813,F_=37814,O_=37815,B_=37816,L_=37817,U_=37818,z_=37819,V_=37820,G_=37821,r4=36492,Cee=36494,Aee=36495,Qne=36283,bM=36284,SM=36285,wM=36286,HWe=2200,jWe=2201,WWe=2202,PL=2300,Ree=2301,IK=2302,D6=2400,F6=2401,NL=2402,Jne=2500,qWe=2501,oC=3200,XWe=3201,j1=0,WCe=1,Xa="",Hr="srgb",_l="srgb-linear",$_="linear",zn="srgb",YWe=0,Sy=7680,KWe=7681,ZWe=7682,QWe=7683,JWe=34055,eqe=34056,tqe=5386,nqe=512,rqe=513,iqe=514,sqe=515,oqe=516,aqe=517,lqe=518,Pee=519,ere=512,VU=513,tre=514,GU=515,nre=516,rre=517,ire=518,sre=519,IL=35044,O6=35048,Nee="300 es",jl=2e3,V2=2001;let e0=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const r=n[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}};const Ol=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Lxe=1234567;const PE=Math.PI/180,b4=180/Math.PI;function Sd(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Ol[i&255]+Ol[i>>8&255]+Ol[i>>16&255]+Ol[i>>24&255]+"-"+Ol[e&255]+Ol[e>>8&255]+"-"+Ol[e>>16&15|64]+Ol[e>>24&255]+"-"+Ol[t&63|128]+Ol[t>>8&255]+"-"+Ol[t>>16&255]+Ol[t>>24&255]+Ol[n&255]+Ol[n>>8&255]+Ol[n>>16&255]+Ol[n>>24&255]).toLowerCase()}function ei(i,e,t){return Math.max(e,Math.min(t,i))}function ore(i,e){return(i%e+e)%e}function cqe(i,e,t,n,r){return n+(i-e)*(r-n)/(t-e)}function uqe(i,e,t){return i!==e?(t-i)/(e-i):0}function NE(i,e,t){return(1-t)*i+t*e}function hqe(i,e,t,n){return NE(i,e,1-Math.exp(-t*n))}function dqe(i,e=1){return e-Math.abs(ore(i,e*2)-e)}function fqe(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function pqe(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function mqe(i,e){return i+Math.floor(Math.random()*(e-i+1))}function gqe(i,e){return i+Math.random()*(e-i)}function yqe(i){return i*(.5-Math.random())}function vqe(i){i!==void 0&&(Lxe=i);let e=Lxe+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function _qe(i){return i*PE}function xqe(i){return i*b4}function bqe(i){return(i&i-1)===0&&i!==0}function Sqe(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function wqe(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function Tqe(i,e,t,n,r){const s=Math.cos,o=Math.sin,a=s(t/2),c=o(t/2),u=s((e+n)/2),f=o((e+n)/2),m=s((e-n)/2),v=o((e-n)/2),x=s((n-e)/2),T=o((n-e)/2);switch(r){case"XYX":i.set(a*f,c*m,c*v,a*u);break;case"YZY":i.set(c*v,a*f,c*m,a*u);break;case"ZXZ":i.set(c*m,c*v,a*f,a*u);break;case"XZX":i.set(a*f,c*T,c*x,a*u);break;case"YXY":i.set(c*x,a*f,c*T,a*u);break;case"ZYZ":i.set(c*T,c*x,a*f,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function R0(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Qr(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const ml={DEG2RAD:PE,RAD2DEG:b4,generateUUID:Sd,clamp:ei,euclideanModulo:ore,mapLinear:cqe,inverseLerp:uqe,lerp:NE,damp:hqe,pingpong:dqe,smoothstep:fqe,smootherstep:pqe,randInt:mqe,randFloat:gqe,randFloatSpread:yqe,seededRandom:vqe,degToRad:_qe,radToDeg:xqe,isPowerOfTwo:bqe,ceilPowerOfTwo:Sqe,floorPowerOfTwo:wqe,setQuaternionFromProperEuler:Tqe,normalize:Qr,denormalize:R0};let mn=class qCe{constructor(e=0,t=0){qCe.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=ei(this.x,e.x,t.x),this.y=ei(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=ei(this.x,e,t),this.y=ei(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ei(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ei(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*r+e.x,this.y=s*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},qi=class{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,s,o,a){let c=n[r+0],u=n[r+1],f=n[r+2],m=n[r+3];const v=s[o+0],x=s[o+1],T=s[o+2],P=s[o+3];if(a===0){e[t+0]=c,e[t+1]=u,e[t+2]=f,e[t+3]=m;return}if(a===1){e[t+0]=v,e[t+1]=x,e[t+2]=T,e[t+3]=P;return}if(m!==P||c!==v||u!==x||f!==T){let R=1-a;const M=c*v+u*x+f*T+m*P,O=M>=0?1:-1,C=1-M*M;if(C>Number.EPSILON){const Y=Math.sqrt(C),J=Math.atan2(Y,M*O);R=Math.sin(R*J)/Y,a=Math.sin(a*J)/Y}const L=a*O;if(c=c*R+v*L,u=u*R+x*L,f=f*R+T*L,m=m*R+P*L,R===1-a){const Y=1/Math.sqrt(c*c+u*u+f*f+m*m);c*=Y,u*=Y,f*=Y,m*=Y}}e[t]=c,e[t+1]=u,e[t+2]=f,e[t+3]=m}static multiplyQuaternionsFlat(e,t,n,r,s,o){const a=n[r],c=n[r+1],u=n[r+2],f=n[r+3],m=s[o],v=s[o+1],x=s[o+2],T=s[o+3];return e[t]=a*T+f*m+c*x-u*v,e[t+1]=c*T+f*v+u*m-a*x,e[t+2]=u*T+f*x+a*v-c*m,e[t+3]=f*T-a*m-c*v-u*x,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,u=a(n/2),f=a(r/2),m=a(s/2),v=c(n/2),x=c(r/2),T=c(s/2);switch(o){case"XYZ":this._x=v*f*m+u*x*T,this._y=u*x*m-v*f*T,this._z=u*f*T+v*x*m,this._w=u*f*m-v*x*T;break;case"YXZ":this._x=v*f*m+u*x*T,this._y=u*x*m-v*f*T,this._z=u*f*T-v*x*m,this._w=u*f*m+v*x*T;break;case"ZXY":this._x=v*f*m-u*x*T,this._y=u*x*m+v*f*T,this._z=u*f*T+v*x*m,this._w=u*f*m-v*x*T;break;case"ZYX":this._x=v*f*m-u*x*T,this._y=u*x*m+v*f*T,this._z=u*f*T-v*x*m,this._w=u*f*m+v*x*T;break;case"YZX":this._x=v*f*m+u*x*T,this._y=u*x*m+v*f*T,this._z=u*f*T-v*x*m,this._w=u*f*m-v*x*T;break;case"XZY":this._x=v*f*m-u*x*T,this._y=u*x*m-v*f*T,this._z=u*f*T+v*x*m,this._w=u*f*m+v*x*T;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],s=t[8],o=t[1],a=t[5],c=t[9],u=t[2],f=t[6],m=t[10],v=n+a+m;if(v>0){const x=.5/Math.sqrt(v+1);this._w=.25/x,this._x=(f-c)*x,this._y=(s-u)*x,this._z=(o-r)*x}else if(n>a&&n>m){const x=2*Math.sqrt(1+n-a-m);this._w=(f-c)/x,this._x=.25*x,this._y=(r+o)/x,this._z=(s+u)/x}else if(a>m){const x=2*Math.sqrt(1+a-n-m);this._w=(s-u)/x,this._x=(r+o)/x,this._y=.25*x,this._z=(c+f)/x}else{const x=2*Math.sqrt(1+m-n-a);this._w=(o-r)/x,this._x=(s+u)/x,this._y=(c+f)/x,this._z=.25*x}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ei(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,s=e._z,o=e._w,a=t._x,c=t._y,u=t._z,f=t._w;return this._x=n*f+o*a+r*u-s*c,this._y=r*f+o*c+s*a-n*u,this._z=s*f+o*u+n*c-r*a,this._w=o*f-n*a-r*c-s*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+n*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const x=1-t;return this._w=x*o+t*this._w,this._x=x*n+t*this._x,this._y=x*r+t*this._y,this._z=x*s+t*this._z,this.normalize(),this}const u=Math.sqrt(c),f=Math.atan2(u,a),m=Math.sin((1-t)*f)/u,v=Math.sin(t*f)/u;return this._w=o*m+this._w*v,this._x=n*m+this._x*v,this._y=r*m+this._y*v,this._z=s*m+this._z*v,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},be=class XCe{constructor(e=0,t=0,n=0){XCe.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Uxe.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Uxe.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*r,this.y=s[1]*t+s[4]*n+s[7]*r,this.z=s[2]*t+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z,c=e.w,u=2*(o*r-a*n),f=2*(a*t-s*r),m=2*(s*n-o*t);return this.x=t+c*u+o*m-a*f,this.y=n+c*f+a*u-s*m,this.z=r+c*m+s*f-o*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r,this.y=s[1]*t+s[5]*n+s[9]*r,this.z=s[2]*t+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=ei(this.x,e.x,t.x),this.y=ei(this.y,e.y,t.y),this.z=ei(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=ei(this.x,e,t),this.y=ei(this.y,e,t),this.z=ei(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ei(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,s=e.z,o=t.x,a=t.y,c=t.z;return this.x=r*c-s*a,this.y=s*o-n*c,this.z=n*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return kK.copy(this).projectOnVector(e),this.sub(kK)}reflect(e){return this.sub(kK.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ei(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const kK=new be,Uxe=new qi;let Or=class YCe{constructor(e,t,n,r,s,o,a,c,u){YCe.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,c,u)}set(e,t,n,r,s,o,a,c,u){const f=this.elements;return f[0]=e,f[1]=r,f[2]=a,f[3]=t,f[4]=s,f[5]=c,f[6]=n,f[7]=o,f[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[3],c=n[6],u=n[1],f=n[4],m=n[7],v=n[2],x=n[5],T=n[8],P=r[0],R=r[3],M=r[6],O=r[1],C=r[4],L=r[7],Y=r[2],J=r[5],z=r[8];return s[0]=o*P+a*O+c*Y,s[3]=o*R+a*C+c*J,s[6]=o*M+a*L+c*z,s[1]=u*P+f*O+m*Y,s[4]=u*R+f*C+m*J,s[7]=u*M+f*L+m*z,s[2]=v*P+x*O+T*Y,s[5]=v*R+x*C+T*J,s[8]=v*M+x*L+T*z,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],f=e[8];return t*o*f-t*a*u-n*s*f+n*a*c+r*s*u-r*o*c}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],f=e[8],m=f*o-a*u,v=a*c-f*s,x=u*s-o*c,T=t*m+n*v+r*x;if(T===0)return this.set(0,0,0,0,0,0,0,0,0);const P=1/T;return e[0]=m*P,e[1]=(r*u-f*n)*P,e[2]=(a*n-r*o)*P,e[3]=v*P,e[4]=(f*t-r*c)*P,e[5]=(r*s-a*t)*P,e[6]=x*P,e[7]=(n*c-u*t)*P,e[8]=(o*t-n*s)*P,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,o,a){const c=Math.cos(s),u=Math.sin(s);return this.set(n*c,n*u,-n*(c*o+u*a)+o+e,-r*u,r*c,-r*(-u*o+c*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(DK.makeScale(e,t)),this}rotate(e){return this.premultiply(DK.makeRotation(-e)),this}translate(e,t){return this.premultiply(DK.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const DK=new Or;function are(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}function TM(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function KCe(){const i=TM("canvas");return i.style.display="block",i}const zxe={};function Qc(i){i in zxe||(zxe[i]=!0,console.warn(i))}function Eqe(i,e,t){return new Promise(function(n,r){function s(){switch(i.clientWaitSync(e,i.SYNC_FLUSH_COMMANDS_BIT,0)){case i.WAIT_FAILED:r();break;case i.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:n()}}setTimeout(s,t)})}function Mqe(i){const e=i.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function Cqe(i){const e=i.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const Vxe=new Or().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Gxe=new Or().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Aqe(){const i={enabled:!0,workingColorSpace:_l,spaces:{},convert:function(r,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===zn&&(r.r=P1(r.r),r.g=P1(r.g),r.b=P1(r.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===zn&&(r.r=i_(r.r),r.g=i_(r.g),r.b=i_(r.b))),r},workingToColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},colorSpaceToWorking:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Xa?$_:this.spaces[r].transfer},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,o){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(r,s){return Qc("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),i.workingToColorSpace(r,s)},toWorkingColorSpace:function(r,s){return Qc("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),i.colorSpaceToWorking(r,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return i.define({[_l]:{primaries:e,whitePoint:n,transfer:$_,toXYZ:Vxe,fromXYZ:Gxe,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Hr},outputColorSpaceConfig:{drawingBufferColorSpace:Hr}},[Hr]:{primaries:e,whitePoint:n,transfer:zn,toXYZ:Vxe,fromXYZ:Gxe,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Hr}}}),i}const rr=Aqe();function P1(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function i_(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let N8,Rqe=class{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{N8===void 0&&(N8=TM("canvas")),N8.width=e.width,N8.height=e.height;const r=N8.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=N8}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=TM("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=P1(s[o]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(P1(t[n]/255)*255):t[n]=P1(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},Pqe=0,lre=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Pqe++}),this.uuid=Sd(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(FK(r[o].image)):s.push(FK(r[o]))}else s=FK(r);n.url=s}return t||(e.images[this.uuid]=n),n}};function FK(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?Rqe.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Nqe=0;const OK=new be;let Ao=class OB extends e0{constructor(e=OB.DEFAULT_IMAGE,t=OB.DEFAULT_MAPPING,n=ta,r=ta,s=_s,o=oc,a=xs,c=ps,u=OB.DEFAULT_ANISOTROPY,f=Xa){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Nqe++}),this.uuid=Sd(),this.name="",this.source=new lre(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=u,this.format=a,this.internalFormat=null,this.type=c,this.offset=new mn(0,0),this.repeat=new mn(1,1),this.center=new mn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Or,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=f,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(OK).x}get height(){return this.source.getSize(OK).y}get depth(){return this.source.getSize(OK).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`);continue}r&&n&&r.isVector2&&n.isVector2||r&&n&&r.isVector3&&n.isVector3||r&&n&&r.isMatrix3&&n.isMatrix3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Wy)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case tu:e.x=e.x-Math.floor(e.x);break;case ta:e.x=e.x<0?0:1;break;case x4:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case tu:e.y=e.y-Math.floor(e.y);break;case ta:e.y=e.y<0?0:1;break;case x4:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};Ao.DEFAULT_IMAGE=null;Ao.DEFAULT_MAPPING=Wy;Ao.DEFAULT_ANISOTROPY=1;let ir=class ZCe{constructor(e=0,t=0,n=0,r=1){ZCe.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,s;const c=e.elements,u=c[0],f=c[4],m=c[8],v=c[1],x=c[5],T=c[9],P=c[2],R=c[6],M=c[10];if(Math.abs(f-v)<.01&&Math.abs(m-P)<.01&&Math.abs(T-R)<.01){if(Math.abs(f+v)<.1&&Math.abs(m+P)<.1&&Math.abs(T+R)<.1&&Math.abs(u+x+M-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const C=(u+1)/2,L=(x+1)/2,Y=(M+1)/2,J=(f+v)/4,z=(m+P)/4,ne=(T+R)/4;return C>L&&C>Y?C<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(C),r=J/n,s=z/n):L>Y?L<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(L),n=J/r,s=ne/r):Y<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(Y),n=z/s,r=ne/s),this.set(n,r,s,t),this}let O=Math.sqrt((R-T)*(R-T)+(m-P)*(m-P)+(v-f)*(v-f));return Math.abs(O)<.001&&(O=1),this.x=(R-T)/O,this.y=(m-P)/O,this.z=(v-f)/O,this.w=Math.acos((u+x+M-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=ei(this.x,e.x,t.x),this.y=ei(this.y,e.y,t.y),this.z=ei(this.z,e.z,t.z),this.w=ei(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=ei(this.x,e,t),this.y=ei(this.y,e,t),this.z=ei(this.z,e,t),this.w=ei(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(ei(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},t3=class extends e0{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:_s,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new ir(0,0,e,t),this.scissorTest=!1,this.viewport=new ir(0,0,e,t);const r={width:e,height:t,depth:n.depth},s=new Ao(r);this.textures=[];const o=n.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:_s,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n,this.textures[r].isArrayTexture=this.textures[r].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const r=Object.assign({},e.textures[t].image);this.textures[t].source=new lre(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},yc=class extends t3{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}},cre=class extends Ao{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=es,this.minFilter=es,this.wrapR=ta,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}};class Iqe extends Ao{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=es,this.minFilter=es,this.wrapR=ta,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let R4=class{constructor(e=new be(1/0,1/0,1/0),t=new be(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(qh.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(qh.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=qh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,qh):qh.fromBufferAttribute(s,o),qh.applyMatrix4(e.matrixWorld),this.expandByPoint(qh);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),UF.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),UF.copy(n.boundingBox)),UF.applyMatrix4(e.matrixWorld),this.union(UF)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,qh),qh.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(iT),zF.subVectors(this.max,iT),I8.subVectors(e.a,iT),k8.subVectors(e.b,iT),D8.subVectors(e.c,iT),Gg.subVectors(k8,I8),$g.subVectors(D8,k8),Q9.subVectors(I8,D8);let t=[0,-Gg.z,Gg.y,0,-$g.z,$g.y,0,-Q9.z,Q9.y,Gg.z,0,-Gg.x,$g.z,0,-$g.x,Q9.z,0,-Q9.x,-Gg.y,Gg.x,0,-$g.y,$g.x,0,-Q9.y,Q9.x,0];return!BK(t,I8,k8,D8,zF)||(t=[1,0,0,0,1,0,0,0,1],!BK(t,I8,k8,D8,zF))?!1:(VF.crossVectors(Gg,$g),t=[VF.x,VF.y,VF.z],BK(t,I8,k8,D8,zF))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,qh).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(qh).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(n1[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),n1[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),n1[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),n1[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),n1[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),n1[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),n1[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),n1[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(n1),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}};const n1=[new be,new be,new be,new be,new be,new be,new be,new be],qh=new be,UF=new R4,I8=new be,k8=new be,D8=new be,Gg=new be,$g=new be,Q9=new be,iT=new be,zF=new be,VF=new be,J9=new be;function BK(i,e,t,n,r){for(let s=0,o=i.length-3;s<=o;s+=3){J9.fromArray(i,s);const a=r.x*Math.abs(J9.x)+r.y*Math.abs(J9.y)+r.z*Math.abs(J9.z),c=e.dot(J9),u=t.dot(J9),f=n.dot(J9);if(Math.max(-Math.max(c,u,f),Math.min(c,u,f))>a)return!1}return!0}const kqe=new R4,sT=new be,LK=new be;let nm=class{constructor(e=new be,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):kqe.setFromPoints(e).getCenter(n);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;sT.subVectors(e,this.center);const t=sT.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.addScaledVector(sT,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(LK.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(sT.copy(e.center).add(LK)),this.expandByPoint(sT.copy(e.center).sub(LK))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}};const r1=new be,UK=new be,GF=new be,Hg=new be,zK=new be,$F=new be,VK=new be;let yx=class{constructor(e=new be,t=new be(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,r1)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=r1.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(r1.copy(this.origin).addScaledVector(this.direction,t),r1.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){UK.copy(e).add(t).multiplyScalar(.5),GF.copy(t).sub(e).normalize(),Hg.copy(this.origin).sub(UK);const s=e.distanceTo(t)*.5,o=-this.direction.dot(GF),a=Hg.dot(this.direction),c=-Hg.dot(GF),u=Hg.lengthSq(),f=Math.abs(1-o*o);let m,v,x,T;if(f>0)if(m=o*c-a,v=o*a-c,T=s*f,m>=0)if(v>=-T)if(v<=T){const P=1/f;m*=P,v*=P,x=m*(m+o*v+2*a)+v*(o*m+v+2*c)+u}else v=s,m=Math.max(0,-(o*v+a)),x=-m*m+v*(v+2*c)+u;else v=-s,m=Math.max(0,-(o*v+a)),x=-m*m+v*(v+2*c)+u;else v<=-T?(m=Math.max(0,-(-o*s+a)),v=m>0?-s:Math.min(Math.max(-s,-c),s),x=-m*m+v*(v+2*c)+u):v<=T?(m=0,v=Math.min(Math.max(-s,-c),s),x=v*(v+2*c)+u):(m=Math.max(0,-(o*s+a)),v=m>0?s:Math.min(Math.max(-s,-c),s),x=-m*m+v*(v+2*c)+u);else v=o>0?-s:s,m=Math.max(0,-(o*v+a)),x=-m*m+v*(v+2*c)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,m),r&&r.copy(UK).addScaledVector(GF,v),x}intersectSphere(e,t){r1.subVectors(e.center,this.origin);const n=r1.dot(this.direction),r=r1.dot(r1)-n*n,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=n-o,c=n+o;return c<0?null:a<0?this.at(c,t):this.at(a,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,s,o,a,c;const u=1/this.direction.x,f=1/this.direction.y,m=1/this.direction.z,v=this.origin;return u>=0?(n=(e.min.x-v.x)*u,r=(e.max.x-v.x)*u):(n=(e.max.x-v.x)*u,r=(e.min.x-v.x)*u),f>=0?(s=(e.min.y-v.y)*f,o=(e.max.y-v.y)*f):(s=(e.max.y-v.y)*f,o=(e.min.y-v.y)*f),n>o||s>r||((s>n||isNaN(n))&&(n=s),(o<r||isNaN(r))&&(r=o),m>=0?(a=(e.min.z-v.z)*m,c=(e.max.z-v.z)*m):(a=(e.max.z-v.z)*m,c=(e.min.z-v.z)*m),n>c||a>r)||((a>n||n!==n)&&(n=a),(c<r||r!==r)&&(r=c),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,r1)!==null}intersectTriangle(e,t,n,r,s){zK.subVectors(t,e),$F.subVectors(n,e),VK.crossVectors(zK,$F);let o=this.direction.dot(VK),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Hg.subVectors(this.origin,e);const c=a*this.direction.dot($F.crossVectors(Hg,$F));if(c<0)return null;const u=a*this.direction.dot(zK.cross(Hg));if(u<0||c+u>o)return null;const f=-a*Hg.dot(VK);return f<0?null:this.at(f/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Vn=class Iee{constructor(e,t,n,r,s,o,a,c,u,f,m,v,x,T,P,R){Iee.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,c,u,f,m,v,x,T,P,R)}set(e,t,n,r,s,o,a,c,u,f,m,v,x,T,P,R){const M=this.elements;return M[0]=e,M[4]=t,M[8]=n,M[12]=r,M[1]=s,M[5]=o,M[9]=a,M[13]=c,M[2]=u,M[6]=f,M[10]=m,M[14]=v,M[3]=x,M[7]=T,M[11]=P,M[15]=R,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Iee().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/F8.setFromMatrixColumn(e,0).length(),s=1/F8.setFromMatrixColumn(e,1).length(),o=1/F8.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),a=Math.sin(n),c=Math.cos(r),u=Math.sin(r),f=Math.cos(s),m=Math.sin(s);if(e.order==="XYZ"){const v=o*f,x=o*m,T=a*f,P=a*m;t[0]=c*f,t[4]=-c*m,t[8]=u,t[1]=x+T*u,t[5]=v-P*u,t[9]=-a*c,t[2]=P-v*u,t[6]=T+x*u,t[10]=o*c}else if(e.order==="YXZ"){const v=c*f,x=c*m,T=u*f,P=u*m;t[0]=v+P*a,t[4]=T*a-x,t[8]=o*u,t[1]=o*m,t[5]=o*f,t[9]=-a,t[2]=x*a-T,t[6]=P+v*a,t[10]=o*c}else if(e.order==="ZXY"){const v=c*f,x=c*m,T=u*f,P=u*m;t[0]=v-P*a,t[4]=-o*m,t[8]=T+x*a,t[1]=x+T*a,t[5]=o*f,t[9]=P-v*a,t[2]=-o*u,t[6]=a,t[10]=o*c}else if(e.order==="ZYX"){const v=o*f,x=o*m,T=a*f,P=a*m;t[0]=c*f,t[4]=T*u-x,t[8]=v*u+P,t[1]=c*m,t[5]=P*u+v,t[9]=x*u-T,t[2]=-u,t[6]=a*c,t[10]=o*c}else if(e.order==="YZX"){const v=o*c,x=o*u,T=a*c,P=a*u;t[0]=c*f,t[4]=P-v*m,t[8]=T*m+x,t[1]=m,t[5]=o*f,t[9]=-a*f,t[2]=-u*f,t[6]=x*m+T,t[10]=v-P*m}else if(e.order==="XZY"){const v=o*c,x=o*u,T=a*c,P=a*u;t[0]=c*f,t[4]=-m,t[8]=u*f,t[1]=v*m+P,t[5]=o*f,t[9]=x*m-T,t[2]=T*m-x,t[6]=a*f,t[10]=P*m+v}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Dqe,e,Fqe)}lookAt(e,t,n){const r=this.elements;return Dc.subVectors(e,t),Dc.lengthSq()===0&&(Dc.z=1),Dc.normalize(),jg.crossVectors(n,Dc),jg.lengthSq()===0&&(Math.abs(n.z)===1?Dc.x+=1e-4:Dc.z+=1e-4,Dc.normalize(),jg.crossVectors(n,Dc)),jg.normalize(),HF.crossVectors(Dc,jg),r[0]=jg.x,r[4]=HF.x,r[8]=Dc.x,r[1]=jg.y,r[5]=HF.y,r[9]=Dc.y,r[2]=jg.z,r[6]=HF.z,r[10]=Dc.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[4],c=n[8],u=n[12],f=n[1],m=n[5],v=n[9],x=n[13],T=n[2],P=n[6],R=n[10],M=n[14],O=n[3],C=n[7],L=n[11],Y=n[15],J=r[0],z=r[4],ne=r[8],K=r[12],$=r[1],he=r[5],Ce=r[9],Pe=r[13],je=r[2],ge=r[6],Xe=r[10],Fe=r[14],Ne=r[3],tt=r[7],mt=r[11],Ht=r[15];return s[0]=o*J+a*$+c*je+u*Ne,s[4]=o*z+a*he+c*ge+u*tt,s[8]=o*ne+a*Ce+c*Xe+u*mt,s[12]=o*K+a*Pe+c*Fe+u*Ht,s[1]=f*J+m*$+v*je+x*Ne,s[5]=f*z+m*he+v*ge+x*tt,s[9]=f*ne+m*Ce+v*Xe+x*mt,s[13]=f*K+m*Pe+v*Fe+x*Ht,s[2]=T*J+P*$+R*je+M*Ne,s[6]=T*z+P*he+R*ge+M*tt,s[10]=T*ne+P*Ce+R*Xe+M*mt,s[14]=T*K+P*Pe+R*Fe+M*Ht,s[3]=O*J+C*$+L*je+Y*Ne,s[7]=O*z+C*he+L*ge+Y*tt,s[11]=O*ne+C*Ce+L*Xe+Y*mt,s[15]=O*K+C*Pe+L*Fe+Y*Ht,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],s=e[12],o=e[1],a=e[5],c=e[9],u=e[13],f=e[2],m=e[6],v=e[10],x=e[14],T=e[3],P=e[7],R=e[11],M=e[15];return T*(+s*c*m-r*u*m-s*a*v+n*u*v+r*a*x-n*c*x)+P*(+t*c*x-t*u*v+s*o*v-r*o*x+r*u*f-s*c*f)+R*(+t*u*m-t*a*x-s*o*m+n*o*x+s*a*f-n*u*f)+M*(-r*a*f-t*c*m+t*a*v+r*o*m-n*o*v+n*c*f)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],f=e[8],m=e[9],v=e[10],x=e[11],T=e[12],P=e[13],R=e[14],M=e[15],O=m*R*u-P*v*u+P*c*x-a*R*x-m*c*M+a*v*M,C=T*v*u-f*R*u-T*c*x+o*R*x+f*c*M-o*v*M,L=f*P*u-T*m*u+T*a*x-o*P*x-f*a*M+o*m*M,Y=T*m*c-f*P*c-T*a*v+o*P*v+f*a*R-o*m*R,J=t*O+n*C+r*L+s*Y;if(J===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const z=1/J;return e[0]=O*z,e[1]=(P*v*s-m*R*s-P*r*x+n*R*x+m*r*M-n*v*M)*z,e[2]=(a*R*s-P*c*s+P*r*u-n*R*u-a*r*M+n*c*M)*z,e[3]=(m*c*s-a*v*s-m*r*u+n*v*u+a*r*x-n*c*x)*z,e[4]=C*z,e[5]=(f*R*s-T*v*s+T*r*x-t*R*x-f*r*M+t*v*M)*z,e[6]=(T*c*s-o*R*s-T*r*u+t*R*u+o*r*M-t*c*M)*z,e[7]=(o*v*s-f*c*s+f*r*u-t*v*u-o*r*x+t*c*x)*z,e[8]=L*z,e[9]=(T*m*s-f*P*s-T*n*x+t*P*x+f*n*M-t*m*M)*z,e[10]=(o*P*s-T*a*s+T*n*u-t*P*u-o*n*M+t*a*M)*z,e[11]=(f*a*s-o*m*s-f*n*u+t*m*u+o*n*x-t*a*x)*z,e[12]=Y*z,e[13]=(f*P*r-T*m*r+T*n*v-t*P*v-f*n*R+t*m*R)*z,e[14]=(T*a*r-o*P*r-T*n*c+t*P*c+o*n*R-t*a*R)*z,e[15]=(o*m*r-f*a*r+f*n*c-t*m*c-o*n*v+t*a*v)*z,this}scale(e){const t=this.elements,n=e.x,r=e.y,s=e.z;return t[0]*=n,t[4]*=r,t[8]*=s,t[1]*=n,t[5]*=r,t[9]*=s,t[2]*=n,t[6]*=r,t[10]*=s,t[3]*=n,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),s=1-n,o=e.x,a=e.y,c=e.z,u=s*o,f=s*a;return this.set(u*o+n,u*a-r*c,u*c+r*a,0,u*a+r*c,f*a+n,f*c-r*o,0,u*c-r*a,f*c+r*o,s*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,s,o){return this.set(1,n,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,s=t._x,o=t._y,a=t._z,c=t._w,u=s+s,f=o+o,m=a+a,v=s*u,x=s*f,T=s*m,P=o*f,R=o*m,M=a*m,O=c*u,C=c*f,L=c*m,Y=n.x,J=n.y,z=n.z;return r[0]=(1-(P+M))*Y,r[1]=(x+L)*Y,r[2]=(T-C)*Y,r[3]=0,r[4]=(x-L)*J,r[5]=(1-(v+M))*J,r[6]=(R+O)*J,r[7]=0,r[8]=(T+C)*z,r[9]=(R-O)*z,r[10]=(1-(v+P))*z,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let s=F8.set(r[0],r[1],r[2]).length();const o=F8.set(r[4],r[5],r[6]).length(),a=F8.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Xh.copy(this);const u=1/s,f=1/o,m=1/a;return Xh.elements[0]*=u,Xh.elements[1]*=u,Xh.elements[2]*=u,Xh.elements[4]*=f,Xh.elements[5]*=f,Xh.elements[6]*=f,Xh.elements[8]*=m,Xh.elements[9]*=m,Xh.elements[10]*=m,t.setFromRotationMatrix(Xh),n.x=s,n.y=o,n.z=a,this}makePerspective(e,t,n,r,s,o,a=jl){const c=this.elements,u=2*s/(t-e),f=2*s/(n-r),m=(t+e)/(t-e),v=(n+r)/(n-r);let x,T;if(a===jl)x=-(o+s)/(o-s),T=-2*o*s/(o-s);else if(a===V2)x=-o/(o-s),T=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=u,c[4]=0,c[8]=m,c[12]=0,c[1]=0,c[5]=f,c[9]=v,c[13]=0,c[2]=0,c[6]=0,c[10]=x,c[14]=T,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,n,r,s,o,a=jl){const c=this.elements,u=1/(t-e),f=1/(n-r),m=1/(o-s),v=(t+e)*u,x=(n+r)*f;let T,P;if(a===jl)T=(o+s)*m,P=-2*m;else if(a===V2)T=s*m,P=-1*m;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*u,c[4]=0,c[8]=0,c[12]=-v,c[1]=0,c[5]=2*f,c[9]=0,c[13]=-x,c[2]=0,c[6]=0,c[10]=P,c[14]=-T,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}};const F8=new be,Xh=new Vn,Dqe=new be(0,0,0),Fqe=new be(1,1,1),jg=new be,HF=new be,Dc=new be,$xe=new Vn,Hxe=new qi;let Mo=class QCe{constructor(e=0,t=0,n=0,r=QCe.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],c=r[1],u=r[5],f=r[9],m=r[2],v=r[6],x=r[10];switch(t){case"XYZ":this._y=Math.asin(ei(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-f,x),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(v,u),this._z=0);break;case"YXZ":this._x=Math.asin(-ei(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(a,x),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-m,s),this._z=0);break;case"ZXY":this._x=Math.asin(ei(v,-1,1)),Math.abs(v)<.9999999?(this._y=Math.atan2(-m,x),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-ei(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(v,x),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(ei(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-f,u),this._y=Math.atan2(-m,s)):(this._x=0,this._y=Math.atan2(a,x));break;case"XZY":this._z=Math.asin(-ei(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(v,u),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-f,x),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return $xe.makeRotationFromQuaternion(e),this.setFromRotationMatrix($xe,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Hxe.setFromEuler(this),this.setFromQuaternion(Hxe,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Mo.DEFAULT_ORDER="XYZ";let ure=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},Oqe=0;const jxe=new be,O8=new qi,i1=new Vn,jF=new be,oT=new be,Bqe=new be,Lqe=new qi,Wxe=new be(1,0,0),qxe=new be(0,1,0),Xxe=new be(0,0,1),Yxe={type:"added"},Uqe={type:"removed"},B8={type:"childadded",child:null},GK={type:"childremoved",child:null};let gi=class BB extends e0{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Oqe++}),this.uuid=Sd(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=BB.DEFAULT_UP.clone();const e=new be,t=new Mo,n=new qi,r=new be(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Vn},normalMatrix:{value:new Or}}),this.matrix=new Vn,this.matrixWorld=new Vn,this.matrixAutoUpdate=BB.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=BB.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ure,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return O8.setFromAxisAngle(e,t),this.quaternion.multiply(O8),this}rotateOnWorldAxis(e,t){return O8.setFromAxisAngle(e,t),this.quaternion.premultiply(O8),this}rotateX(e){return this.rotateOnAxis(Wxe,e)}rotateY(e){return this.rotateOnAxis(qxe,e)}rotateZ(e){return this.rotateOnAxis(Xxe,e)}translateOnAxis(e,t){return jxe.copy(e).applyQuaternion(this.quaternion),this.position.add(jxe.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Wxe,e)}translateY(e){return this.translateOnAxis(qxe,e)}translateZ(e){return this.translateOnAxis(Xxe,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(i1.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?jF.copy(e):jF.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),oT.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?i1.lookAt(oT,jF,this.up):i1.lookAt(jF,oT,this.up),this.quaternion.setFromRotationMatrix(i1),r&&(i1.extractRotation(r.matrixWorld),O8.setFromRotationMatrix(i1),this.quaternion.premultiply(O8.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Yxe),B8.child=e,this.dispatchEvent(B8),B8.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Uqe),GK.child=e,this.dispatchEvent(GK),GK.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),i1.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),i1.multiply(e.parent.matrixWorld)),e.applyMatrix4(i1),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Yxe),B8.child=e,this.dispatchEvent(B8),B8.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(oT,e,Bqe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(oT,Lqe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(a=>({...a,boundingBox:a.boundingBox?a.boundingBox.toJSON():void 0,boundingSphere:a.boundingSphere?a.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(a=>({...a})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(r.boundingBox=this.boundingBox.toJSON()));function s(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let u=0,f=c.length;u<f;u++){const m=c[u];s(e.shapes,m)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,u=this.material.length;c<u;c++)a.push(s(e.materials,this.material[c]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];r.animations.push(s(e.animations,c))}}if(t){const a=o(e.geometries),c=o(e.materials),u=o(e.textures),f=o(e.images),m=o(e.shapes),v=o(e.skeletons),x=o(e.animations),T=o(e.nodes);a.length>0&&(n.geometries=a),c.length>0&&(n.materials=c),u.length>0&&(n.textures=u),f.length>0&&(n.images=f),m.length>0&&(n.shapes=m),v.length>0&&(n.skeletons=v),x.length>0&&(n.animations=x),T.length>0&&(n.nodes=T)}return n.object=r,n;function o(a){const c=[];for(const u in a){const f=a[u];delete f.metadata,c.push(f)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}};gi.DEFAULT_UP=new be(0,1,0);gi.DEFAULT_MATRIX_AUTO_UPDATE=!0;gi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Yh=new be,s1=new be,$K=new be,o1=new be,L8=new be,U8=new be,Kxe=new be,HK=new be,jK=new be,WK=new be,qK=new ir,XK=new ir,YK=new ir;let aT=class v6{constructor(e=new be,t=new be,n=new be){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Yh.subVectors(e,t),r.cross(Yh);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,n,r,s){Yh.subVectors(r,t),s1.subVectors(n,t),$K.subVectors(e,t);const o=Yh.dot(Yh),a=Yh.dot(s1),c=Yh.dot($K),u=s1.dot(s1),f=s1.dot($K),m=o*u-a*a;if(m===0)return s.set(0,0,0),null;const v=1/m,x=(u*c-a*f)*v,T=(o*f-a*c)*v;return s.set(1-x-T,T,x)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,o1)===null?!1:o1.x>=0&&o1.y>=0&&o1.x+o1.y<=1}static getInterpolation(e,t,n,r,s,o,a,c){return this.getBarycoord(e,t,n,r,o1)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,o1.x),c.addScaledVector(o,o1.y),c.addScaledVector(a,o1.z),c)}static getInterpolatedAttribute(e,t,n,r,s,o){return qK.setScalar(0),XK.setScalar(0),YK.setScalar(0),qK.fromBufferAttribute(e,t),XK.fromBufferAttribute(e,n),YK.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(qK,s.x),o.addScaledVector(XK,s.y),o.addScaledVector(YK,s.z),o}static isFrontFacing(e,t,n,r){return Yh.subVectors(n,t),s1.subVectors(e,t),Yh.cross(s1).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Yh.subVectors(this.c,this.b),s1.subVectors(this.a,this.b),Yh.cross(s1).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return v6.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return v6.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,s){return v6.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}containsPoint(e){return v6.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return v6.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,s=this.c;let o,a;L8.subVectors(r,n),U8.subVectors(s,n),HK.subVectors(e,n);const c=L8.dot(HK),u=U8.dot(HK);if(c<=0&&u<=0)return t.copy(n);jK.subVectors(e,r);const f=L8.dot(jK),m=U8.dot(jK);if(f>=0&&m<=f)return t.copy(r);const v=c*m-f*u;if(v<=0&&c>=0&&f<=0)return o=c/(c-f),t.copy(n).addScaledVector(L8,o);WK.subVectors(e,s);const x=L8.dot(WK),T=U8.dot(WK);if(T>=0&&x<=T)return t.copy(s);const P=x*u-c*T;if(P<=0&&u>=0&&T<=0)return a=u/(u-T),t.copy(n).addScaledVector(U8,a);const R=f*T-x*m;if(R<=0&&m-f>=0&&x-T>=0)return Kxe.subVectors(s,r),a=(m-f)/(m-f+(x-T)),t.copy(r).addScaledVector(Kxe,a);const M=1/(R+P+v);return o=P*M,a=v*M,t.copy(n).addScaledVector(L8,o).addScaledVector(U8,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const JCe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Wg={h:0,s:0,l:0},WF={h:0,s:0,l:0};function KK(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}let yn=class{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Hr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,rr.colorSpaceToWorking(this,t),this}setRGB(e,t,n,r=rr.workingColorSpace){return this.r=e,this.g=t,this.b=n,rr.colorSpaceToWorking(this,r),this}setHSL(e,t,n,r=rr.workingColorSpace){if(e=ore(e,1),t=ei(t,0,1),n=ei(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=KK(o,s,e+1/3),this.g=KK(o,s,e),this.b=KK(o,s,e-1/3)}return rr.colorSpaceToWorking(this,r),this}setStyle(e,t=Hr){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Hr){const n=JCe[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=P1(e.r),this.g=P1(e.g),this.b=P1(e.b),this}copyLinearToSRGB(e){return this.r=i_(e.r),this.g=i_(e.g),this.b=i_(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Hr){return rr.workingToColorSpace(Bl.copy(this),e),Math.round(ei(Bl.r*255,0,255))*65536+Math.round(ei(Bl.g*255,0,255))*256+Math.round(ei(Bl.b*255,0,255))}getHexString(e=Hr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=rr.workingColorSpace){rr.workingToColorSpace(Bl.copy(this),t);const n=Bl.r,r=Bl.g,s=Bl.b,o=Math.max(n,r,s),a=Math.min(n,r,s);let c,u;const f=(a+o)/2;if(a===o)c=0,u=0;else{const m=o-a;switch(u=f<=.5?m/(o+a):m/(2-o-a),o){case n:c=(r-s)/m+(r<s?6:0);break;case r:c=(s-n)/m+2;break;case s:c=(n-r)/m+4;break}c/=6}return e.h=c,e.s=u,e.l=f,e}getRGB(e,t=rr.workingColorSpace){return rr.workingToColorSpace(Bl.copy(this),t),e.r=Bl.r,e.g=Bl.g,e.b=Bl.b,e}getStyle(e=Hr){rr.workingToColorSpace(Bl.copy(this),e);const t=Bl.r,n=Bl.g,r=Bl.b;return e!==Hr?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(Wg),this.setHSL(Wg.h+e,Wg.s+t,Wg.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Wg),e.getHSL(WF);const n=NE(Wg.h,WF.h,t),r=NE(Wg.s,WF.s,t),s=NE(Wg.l,WF.l,t);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*r,this.g=s[1]*t+s[4]*n+s[7]*r,this.b=s[2]*t+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Bl=new yn;yn.NAMES=JCe;let zqe=0,Ka=class extends e0{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:zqe++}),this.uuid=Sd(),this.name="",this.type="Material",this.blending=fc,this.side=Xl,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=g4,this.blendDst=y4,this.blendEquation=gl,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new yn(0,0,0),this.blendAlpha=0,this.depthFunc=z2,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Pee,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Sy,this.stencilZFail=Sy,this.stencilZPass=Sy,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==fc&&(n.blending=this.blending),this.side!==Xl&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==g4&&(n.blendSrc=this.blendSrc),this.blendDst!==y4&&(n.blendDst=this.blendDst),this.blendEquation!==gl&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==z2&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Pee&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Sy&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Sy&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Sy&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},Ea=class extends Ka{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new yn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mo,this.combine=rC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}};const v1=Vqe();function Vqe(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),n=new Uint32Array(512),r=new Uint32Array(512);for(let c=0;c<256;++c){const u=c-127;u<-27?(n[c]=0,n[c|256]=32768,r[c]=24,r[c|256]=24):u<-14?(n[c]=1024>>-u-14,n[c|256]=1024>>-u-14|32768,r[c]=-u-1,r[c|256]=-u-1):u<=15?(n[c]=u+15<<10,n[c|256]=u+15<<10|32768,r[c]=13,r[c|256]=13):u<128?(n[c]=31744,n[c|256]=64512,r[c]=24,r[c|256]=24):(n[c]=31744,n[c|256]=64512,r[c]=13,r[c|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let c=1;c<1024;++c){let u=c<<13,f=0;for(;!(u&8388608);)u<<=1,f-=8388608;u&=-8388609,f+=947912704,s[c]=u|f}for(let c=1024;c<2048;++c)s[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)o[c]=c<<23;o[31]=1199570944,o[32]=2147483648;for(let c=33;c<63;++c)o[c]=2147483648+(c-32<<23);o[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(a[c]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function nc(i){Math.abs(i)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),i=ei(i,-65504,65504),v1.floatView[0]=i;const e=v1.uint32View[0],t=e>>23&511;return v1.baseTable[t]+((e&8388607)>>v1.shiftTable[t])}function nE(i){const e=i>>10;return v1.uint32View[0]=v1.mantissaTable[v1.offsetTable[e]+(i&1023)]+v1.exponentTable[e],v1.floatView[0]}class Zxe{static toHalfFloat(e){return nc(e)}static fromHalfFloat(e){return nE(e)}}const Jo=new be,qF=new mn;let Gqe=0,Ra=class{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Gqe++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=IL,this.updateRanges=[],this.gpuType=Ys,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)qF.fromBufferAttribute(this,t),qF.applyMatrix3(e),this.setXY(t,qF.x,qF.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Jo.fromBufferAttribute(this,t),Jo.applyMatrix3(e),this.setXYZ(t,Jo.x,Jo.y,Jo.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Jo.fromBufferAttribute(this,t),Jo.applyMatrix4(e),this.setXYZ(t,Jo.x,Jo.y,Jo.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Jo.fromBufferAttribute(this,t),Jo.applyNormalMatrix(e),this.setXYZ(t,Jo.x,Jo.y,Jo.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Jo.fromBufferAttribute(this,t),Jo.transformDirection(e),this.setXYZ(t,Jo.x,Jo.y,Jo.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=R0(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Qr(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=R0(t,this.array)),t}setX(e,t){return this.normalized&&(t=Qr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=R0(t,this.array)),t}setY(e,t){return this.normalized&&(t=Qr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=R0(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Qr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=R0(t,this.array)),t}setW(e,t){return this.normalized&&(t=Qr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Qr(t,this.array),n=Qr(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Qr(t,this.array),n=Qr(n,this.array),r=Qr(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=Qr(t,this.array),n=Qr(n,this.array),r=Qr(r,this.array),s=Qr(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==IL&&(e.usage=this.usage),e}},$U=class extends Ra{constructor(e,t,n){super(new Uint16Array(e),t,n)}},hre=class extends Ra{constructor(e,t,n){super(new Uint32Array(e),t,n)}},eAe=class extends Ra{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=nE(this.array[e*this.itemSize]);return this.normalized&&(t=R0(t,this.array)),t}setX(e,t){return this.normalized&&(t=Qr(t,this.array)),this.array[e*this.itemSize]=nc(t),this}getY(e){let t=nE(this.array[e*this.itemSize+1]);return this.normalized&&(t=R0(t,this.array)),t}setY(e,t){return this.normalized&&(t=Qr(t,this.array)),this.array[e*this.itemSize+1]=nc(t),this}getZ(e){let t=nE(this.array[e*this.itemSize+2]);return this.normalized&&(t=R0(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Qr(t,this.array)),this.array[e*this.itemSize+2]=nc(t),this}getW(e){let t=nE(this.array[e*this.itemSize+3]);return this.normalized&&(t=R0(t,this.array)),t}setW(e,t){return this.normalized&&(t=Qr(t,this.array)),this.array[e*this.itemSize+3]=nc(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Qr(t,this.array),n=Qr(n,this.array)),this.array[e+0]=nc(t),this.array[e+1]=nc(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Qr(t,this.array),n=Qr(n,this.array),r=Qr(r,this.array)),this.array[e+0]=nc(t),this.array[e+1]=nc(n),this.array[e+2]=nc(r),this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=Qr(t,this.array),n=Qr(n,this.array),r=Qr(r,this.array),s=Qr(s,this.array)),this.array[e+0]=nc(t),this.array[e+1]=nc(n),this.array[e+2]=nc(r),this.array[e+3]=nc(s),this}},br=class extends Ra{constructor(e,t,n){super(new Float32Array(e),t,n)}},$qe=0;const Ou=new Vn,ZK=new gi,z8=new be,Fc=new R4,lT=new R4,Ga=new be;let Xi=class tAe extends e0{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:$qe++}),this.uuid=Sd(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(are(e)?hre:$U)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Or().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ou.makeRotationFromQuaternion(e),this.applyMatrix4(Ou),this}rotateX(e){return Ou.makeRotationX(e),this.applyMatrix4(Ou),this}rotateY(e){return Ou.makeRotationY(e),this.applyMatrix4(Ou),this}rotateZ(e){return Ou.makeRotationZ(e),this.applyMatrix4(Ou),this}translate(e,t,n){return Ou.makeTranslation(e,t,n),this.applyMatrix4(Ou),this}scale(e,t,n){return Ou.makeScale(e,t,n),this.applyMatrix4(Ou),this}lookAt(e){return ZK.lookAt(e),ZK.updateMatrix(),this.applyMatrix4(ZK.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(z8).negate(),this.translate(z8.x,z8.y,z8.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];n.push(o.x,o.y,o.z||0)}this.setAttribute("position",new br(n,3))}else{const n=Math.min(e.length,t.count);for(let r=0;r<n;r++){const s=e[r];t.setXYZ(r,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new R4);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new be(-1/0,-1/0,-1/0),new be(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const s=t[n];Fc.setFromBufferAttribute(s),this.morphTargetsRelative?(Ga.addVectors(this.boundingBox.min,Fc.min),this.boundingBox.expandByPoint(Ga),Ga.addVectors(this.boundingBox.max,Fc.max),this.boundingBox.expandByPoint(Ga)):(this.boundingBox.expandByPoint(Fc.min),this.boundingBox.expandByPoint(Fc.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new nm);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new be,1/0);return}if(e){const n=this.boundingSphere.center;if(Fc.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];lT.setFromBufferAttribute(a),this.morphTargetsRelative?(Ga.addVectors(Fc.min,lT.min),Fc.expandByPoint(Ga),Ga.addVectors(Fc.max,lT.max),Fc.expandByPoint(Ga)):(Fc.expandByPoint(lT.min),Fc.expandByPoint(lT.max))}Fc.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)Ga.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(Ga));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],c=this.morphTargetsRelative;for(let u=0,f=a.count;u<f;u++)Ga.fromBufferAttribute(a,u),c&&(z8.fromBufferAttribute(e,u),Ga.add(z8)),r=Math.max(r,n.distanceToSquared(Ga))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ra(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let ne=0;ne<n.count;ne++)a[ne]=new be,c[ne]=new be;const u=new be,f=new be,m=new be,v=new mn,x=new mn,T=new mn,P=new be,R=new be;function M(ne,K,$){u.fromBufferAttribute(n,ne),f.fromBufferAttribute(n,K),m.fromBufferAttribute(n,$),v.fromBufferAttribute(s,ne),x.fromBufferAttribute(s,K),T.fromBufferAttribute(s,$),f.sub(u),m.sub(u),x.sub(v),T.sub(v);const he=1/(x.x*T.y-T.x*x.y);isFinite(he)&&(P.copy(f).multiplyScalar(T.y).addScaledVector(m,-x.y).multiplyScalar(he),R.copy(m).multiplyScalar(x.x).addScaledVector(f,-T.x).multiplyScalar(he),a[ne].add(P),a[K].add(P),a[$].add(P),c[ne].add(R),c[K].add(R),c[$].add(R))}let O=this.groups;O.length===0&&(O=[{start:0,count:e.count}]);for(let ne=0,K=O.length;ne<K;++ne){const $=O[ne],he=$.start,Ce=$.count;for(let Pe=he,je=he+Ce;Pe<je;Pe+=3)M(e.getX(Pe+0),e.getX(Pe+1),e.getX(Pe+2))}const C=new be,L=new be,Y=new be,J=new be;function z(ne){Y.fromBufferAttribute(r,ne),J.copy(Y);const K=a[ne];C.copy(K),C.sub(Y.multiplyScalar(Y.dot(K))).normalize(),L.crossVectors(J,K);const he=L.dot(c[ne])<0?-1:1;o.setXYZW(ne,C.x,C.y,C.z,he)}for(let ne=0,K=O.length;ne<K;++ne){const $=O[ne],he=$.start,Ce=$.count;for(let Pe=he,je=he+Ce;Pe<je;Pe+=3)z(e.getX(Pe+0)),z(e.getX(Pe+1)),z(e.getX(Pe+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Ra(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let v=0,x=n.count;v<x;v++)n.setXYZ(v,0,0,0);const r=new be,s=new be,o=new be,a=new be,c=new be,u=new be,f=new be,m=new be;if(e)for(let v=0,x=e.count;v<x;v+=3){const T=e.getX(v+0),P=e.getX(v+1),R=e.getX(v+2);r.fromBufferAttribute(t,T),s.fromBufferAttribute(t,P),o.fromBufferAttribute(t,R),f.subVectors(o,s),m.subVectors(r,s),f.cross(m),a.fromBufferAttribute(n,T),c.fromBufferAttribute(n,P),u.fromBufferAttribute(n,R),a.add(f),c.add(f),u.add(f),n.setXYZ(T,a.x,a.y,a.z),n.setXYZ(P,c.x,c.y,c.z),n.setXYZ(R,u.x,u.y,u.z)}else for(let v=0,x=t.count;v<x;v+=3)r.fromBufferAttribute(t,v+0),s.fromBufferAttribute(t,v+1),o.fromBufferAttribute(t,v+2),f.subVectors(o,s),m.subVectors(r,s),f.cross(m),n.setXYZ(v+0,f.x,f.y,f.z),n.setXYZ(v+1,f.x,f.y,f.z),n.setXYZ(v+2,f.x,f.y,f.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ga.fromBufferAttribute(e,t),Ga.normalize(),e.setXYZ(t,Ga.x,Ga.y,Ga.z)}toNonIndexed(){function e(a,c){const u=a.array,f=a.itemSize,m=a.normalized,v=new u.constructor(c.length*f);let x=0,T=0;for(let P=0,R=c.length;P<R;P++){a.isInterleavedBufferAttribute?x=c[P]*a.data.stride+a.offset:x=c[P]*f;for(let M=0;M<f;M++)v[T++]=u[x++]}return new Ra(v,f,m)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new tAe,n=this.index.array,r=this.attributes;for(const a in r){const c=r[a],u=e(c,n);t.setAttribute(a,u)}const s=this.morphAttributes;for(const a in s){const c=[],u=s[a];for(let f=0,m=u.length;f<m;f++){const v=u[f],x=e(v,n);c.push(x)}t.morphAttributes[a]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const u=o[a];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const u in c)c[u]!==void 0&&(e[u]=c[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const c in n){const u=n[c];e.data.attributes[c]=u.toJSON(e.data)}const r={};let s=!1;for(const c in this.morphAttributes){const u=this.morphAttributes[c],f=[];for(let m=0,v=u.length;m<v;m++){const x=u[m];f.push(x.toJSON(e.data))}f.length>0&&(r[c]=f,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere=a.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const r=e.attributes;for(const u in r){const f=r[u];this.setAttribute(u,f.clone(t))}const s=e.morphAttributes;for(const u in s){const f=[],m=s[u];for(let v=0,x=m.length;v<x;v++)f.push(m[v].clone(t));this.morphAttributes[u]=f}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let u=0,f=o.length;u<f;u++){const m=o[u];this.addGroup(m.start,m.count,m.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const Qxe=new Vn,ey=new yx,XF=new nm,Jxe=new be,YF=new be,KF=new be,ZF=new be,QK=new be,QF=new be,e7e=new be,JF=new be;let dn=class extends gi{constructor(e=new Xi,t=new Ea){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){QF.set(0,0,0);for(let c=0,u=s.length;c<u;c++){const f=a[c],m=s[c];f!==0&&(QK.fromBufferAttribute(m,e),o?QF.addScaledVector(QK,f):QF.addScaledVector(QK.sub(t),f))}t.add(QF)}return t}raycast(e,t){const n=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),XF.copy(n.boundingSphere),XF.applyMatrix4(s),ey.copy(e.ray).recast(e.near),!(XF.containsPoint(ey.origin)===!1&&(ey.intersectSphere(XF,Jxe)===null||ey.origin.distanceToSquared(Jxe)>(e.far-e.near)**2))&&(Qxe.copy(s).invert(),ey.copy(e.ray).applyMatrix4(Qxe),!(n.boundingBox!==null&&ey.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,ey)))}_computeIntersections(e,t,n){let r;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,u=s.attributes.uv,f=s.attributes.uv1,m=s.attributes.normal,v=s.groups,x=s.drawRange;if(a!==null)if(Array.isArray(o))for(let T=0,P=v.length;T<P;T++){const R=v[T],M=o[R.materialIndex],O=Math.max(R.start,x.start),C=Math.min(a.count,Math.min(R.start+R.count,x.start+x.count));for(let L=O,Y=C;L<Y;L+=3){const J=a.getX(L),z=a.getX(L+1),ne=a.getX(L+2);r=eO(this,M,e,n,u,f,m,J,z,ne),r&&(r.faceIndex=Math.floor(L/3),r.face.materialIndex=R.materialIndex,t.push(r))}}else{const T=Math.max(0,x.start),P=Math.min(a.count,x.start+x.count);for(let R=T,M=P;R<M;R+=3){const O=a.getX(R),C=a.getX(R+1),L=a.getX(R+2);r=eO(this,o,e,n,u,f,m,O,C,L),r&&(r.faceIndex=Math.floor(R/3),t.push(r))}}else if(c!==void 0)if(Array.isArray(o))for(let T=0,P=v.length;T<P;T++){const R=v[T],M=o[R.materialIndex],O=Math.max(R.start,x.start),C=Math.min(c.count,Math.min(R.start+R.count,x.start+x.count));for(let L=O,Y=C;L<Y;L+=3){const J=L,z=L+1,ne=L+2;r=eO(this,M,e,n,u,f,m,J,z,ne),r&&(r.faceIndex=Math.floor(L/3),r.face.materialIndex=R.materialIndex,t.push(r))}}else{const T=Math.max(0,x.start),P=Math.min(c.count,x.start+x.count);for(let R=T,M=P;R<M;R+=3){const O=R,C=R+1,L=R+2;r=eO(this,o,e,n,u,f,m,O,C,L),r&&(r.faceIndex=Math.floor(R/3),t.push(r))}}}};function Hqe(i,e,t,n,r,s,o,a){let c;if(e.side===Ui?c=n.intersectTriangle(o,s,r,!0,a):c=n.intersectTriangle(r,s,o,e.side===Xl,a),c===null)return null;JF.copy(a),JF.applyMatrix4(i.matrixWorld);const u=t.ray.origin.distanceTo(JF);return u<t.near||u>t.far?null:{distance:u,point:JF.clone(),object:i}}function eO(i,e,t,n,r,s,o,a,c,u){i.getVertexPosition(a,YF),i.getVertexPosition(c,KF),i.getVertexPosition(u,ZF);const f=Hqe(i,e,t,n,YF,KF,ZF,e7e);if(f){const m=new be;aT.getBarycoord(e7e,YF,KF,ZF,m),r&&(f.uv=aT.getInterpolatedAttribute(r,a,c,u,m,new mn)),s&&(f.uv1=aT.getInterpolatedAttribute(s,a,c,u,m,new mn)),o&&(f.normal=aT.getInterpolatedAttribute(o,a,c,u,m,new be),f.normal.dot(n.direction)>0&&f.normal.multiplyScalar(-1));const v={a,b:c,c:u,normal:new be,materialIndex:0};aT.getNormal(YF,KF,ZF,v.normal),f.face=v,f.barycoord=m}return f}let Oo=class nAe extends Xi{constructor(e=1,t=1,n=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const c=[],u=[],f=[],m=[];let v=0,x=0;T("z","y","x",-1,-1,n,t,e,o,s,0),T("z","y","x",1,-1,n,t,-e,o,s,1),T("x","z","y",1,1,e,n,t,r,o,2),T("x","z","y",1,-1,e,n,-t,r,o,3),T("x","y","z",1,-1,e,t,n,r,s,4),T("x","y","z",-1,-1,e,t,-n,r,s,5),this.setIndex(c),this.setAttribute("position",new br(u,3)),this.setAttribute("normal",new br(f,3)),this.setAttribute("uv",new br(m,2));function T(P,R,M,O,C,L,Y,J,z,ne,K){const $=L/z,he=Y/ne,Ce=L/2,Pe=Y/2,je=J/2,ge=z+1,Xe=ne+1;let Fe=0,Ne=0;const tt=new be;for(let mt=0;mt<Xe;mt++){const Ht=mt*he-Pe;for(let pn=0;pn<ge;pn++){const In=pn*$-Ce;tt[P]=In*O,tt[R]=Ht*C,tt[M]=je,u.push(tt.x,tt.y,tt.z),tt[P]=0,tt[R]=0,tt[M]=J>0?1:-1,f.push(tt.x,tt.y,tt.z),m.push(pn/z),m.push(1-mt/ne),Fe+=1}}for(let mt=0;mt<ne;mt++)for(let Ht=0;Ht<z;Ht++){const pn=v+Ht+ge*mt,In=v+Ht+ge*(mt+1),vt=v+(Ht+1)+ge*(mt+1),Ut=v+(Ht+1)+ge*mt;c.push(pn,In,Ut),c.push(In,vt,Ut),Ne+=6}a.addGroup(x,Ne,K),x+=Ne,v+=Fe}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nAe(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function H_(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const r=i[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function b0(i){const e={};for(let t=0;t<i.length;t++){const n=H_(i[t]);for(const r in n)e[r]=n[r]}return e}function jqe(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function rAe(i){const e=i.getRenderTarget();return e===null?i.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:rr.workingColorSpace}const Wqe={clone:H_,merge:b0};var qqe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Xqe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;let D0=class extends Ka{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=qqe,this.fragmentShader=Xqe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=H_(e.uniforms),this.uniformsGroups=jqe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}},aC=class extends gi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Vn,this.projectionMatrix=new Vn,this.projectionMatrixInverse=new Vn,this.coordinateSystem=jl}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const qg=new be,t7e=new mn,n7e=new mn;let po=class extends aC{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=b4*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(PE*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return b4*2*Math.atan(Math.tan(PE*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){qg.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(qg.x,qg.y).multiplyScalar(-e/qg.z),qg.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(qg.x,qg.y).multiplyScalar(-e/qg.z)}getViewSize(e,t){return this.getViewBounds(e,t7e,n7e),t.subVectors(n7e,t7e)}setViewOffset(e,t,n,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(PE*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,u=o.fullHeight;s+=o.offsetX*r/c,t-=o.offsetY*n/u,r*=o.width/c,n*=o.height/u}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const V8=-90,G8=1;let iAe=class extends gi{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new po(V8,G8,e,t);r.layers=this.layers,this.add(r);const s=new po(V8,G8,e,t);s.layers=this.layers,this.add(s);const o=new po(V8,G8,e,t);o.layers=this.layers,this.add(o);const a=new po(V8,G8,e,t);a.layers=this.layers,this.add(a);const c=new po(V8,G8,e,t);c.layers=this.layers,this.add(c);const u=new po(V8,G8,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,s,o,a,c]=t;for(const u of t)this.remove(u);if(e===jl)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===V2)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,u,f]=this.children,m=e.getRenderTarget(),v=e.getActiveCubeFace(),x=e.getActiveMipmapLevel(),T=e.xr.enabled;e.xr.enabled=!1;const P=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,s),e.setRenderTarget(n,1,r),e.render(t,o),e.setRenderTarget(n,2,r),e.render(t,a),e.setRenderTarget(n,3,r),e.render(t,c),e.setRenderTarget(n,4,r),e.render(t,u),n.texture.generateMipmaps=P,e.setRenderTarget(n,5,r),e.render(t,f),e.setRenderTarget(m,v,x),e.xr.enabled=T,n.texture.needsPMREMUpdate=!0}},vx=class extends Ao{constructor(e=[],t=Wf,n,r,s,o,a,c,u,f){super(e,t,n,r,s,o,a,c,u,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},sAe=class extends yc{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new vx(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Oo(5,5,5),s=new D0({name:"CubemapFromEquirect",uniforms:H_(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Ui,blending:vl});s.uniforms.tEquirect.value=t;const o=new dn(r,s),a=t.minFilter;return t.minFilter===oc&&(t.minFilter=_s),new iAe(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,n=!0,r=!0){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(s)}},qy=class extends gi{constructor(){super(),this.isGroup=!0,this.type="Group"}};const Yqe={type:"move"};let LB=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new qy,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new qy,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new be,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new be),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new qy,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new be,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new be),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,s=null,o=null;const a=this._targetRay,c=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){o=!0;for(const P of e.hand.values()){const R=t.getJointPose(P,n),M=this._getHandJoint(u,P);R!==null&&(M.matrix.fromArray(R.transform.matrix),M.matrix.decompose(M.position,M.rotation,M.scale),M.matrixWorldNeedsUpdate=!0,M.jointRadius=R.radius),M.visible=R!==null}const f=u.joints["index-finger-tip"],m=u.joints["thumb-tip"],v=f.position.distanceTo(m.position),x=.02,T=.005;u.inputState.pinching&&v>x+T?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&v<=x-T&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,n),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Yqe)))}return a!==null&&(a.visible=r!==null),c!==null&&(c.visible=s!==null),u!==null&&(u.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new qy;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}},W1=class extends gi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Mo,this.environmentIntensity=1,this.environmentRotation=new Mo,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}},oAe=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=IL,this.updateRanges=[],this.version=0,this.uuid=Sd()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Sd()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Sd()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};const v0=new be;let Kqe=class aAe{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)v0.fromBufferAttribute(this,t),v0.applyMatrix4(e),this.setXYZ(t,v0.x,v0.y,v0.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)v0.fromBufferAttribute(this,t),v0.applyNormalMatrix(e),this.setXYZ(t,v0.x,v0.y,v0.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)v0.fromBufferAttribute(this,t),v0.transformDirection(e),this.setXYZ(t,v0.x,v0.y,v0.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=R0(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Qr(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Qr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Qr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Qr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Qr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=R0(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=R0(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=R0(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=R0(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Qr(t,this.array),n=Qr(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Qr(t,this.array),n=Qr(n,this.array),r=Qr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Qr(t,this.array),n=Qr(n,this.array),r=Qr(r,this.array),s=Qr(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new Ra(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new aAe(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},Zqe=class extends Ka{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new yn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}};const r7e=new be,i7e=new ir,s7e=new ir,Qqe=new be,o7e=new Vn,tO=new be,JK=new nm,a7e=new Vn,eZ=new yx;class dre extends dn{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Bxe,this.bindMatrix=new Vn,this.bindMatrixInverse=new Vn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new R4),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,tO),this.boundingBox.expandByPoint(tO)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new nm),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,tO),this.boundingSphere.expandByPoint(tO)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,r=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),JK.copy(this.boundingSphere),JK.applyMatrix4(r),e.ray.intersectsSphere(JK)!==!1&&(a7e.copy(r).invert(),eZ.copy(e.ray).applyMatrix4(a7e),!(this.boundingBox!==null&&eZ.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,eZ)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new ir,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===Bxe?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===GWe?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;i7e.fromBufferAttribute(r.attributes.skinIndex,e),s7e.fromBufferAttribute(r.attributes.skinWeight,e),r7e.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=s7e.getComponent(s);if(o!==0){const a=i7e.getComponent(s);o7e.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(Qqe.copy(r7e).applyMatrix4(o7e),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class kee extends gi{constructor(){super(),this.isBone=!0,this.type="Bone"}}let B6=class extends Ao{constructor(e=null,t=1,n=1,r,s,o,a,c,u=es,f=es,m,v){super(null,o,a,c,u,f,r,s,m,v),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const l7e=new Vn,Jqe=new Vn;class fre{constructor(e=[],t=[]){this.uuid=Sd(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Vn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new Vn;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const a=e[s]?e[s].matrixWorld:Jqe;l7e.multiplyMatrices(a,t[s]),l7e.toArray(n,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new fre(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new B6(t,e,e,xs,Ys);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const s=e.bones[n];let o=t[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new kee),this.bones.push(o),this.boneInverses.push(new Vn().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,s=t.length;r<s;r++){const o=t[r];e.bones.push(o.uuid);const a=n[r];e.boneInverses.push(a.toArray())}return e}}let eXe=class extends Ra{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}};const tZ=new be,tXe=new be,nXe=new Or;let Of=class{constructor(e=new be(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=tZ.subVectors(n,t).cross(tXe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(tZ),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||nXe.getNormalMatrix(e),r=this.coplanarPoint(tZ).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const ty=new nm,nO=new be;let lC=class{constructor(e=new Of,t=new Of,n=new Of,r=new Of,s=new Of,o=new Of){this.planes=[e,t,n,r,s,o]}set(e,t,n,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=jl){const n=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],c=r[3],u=r[4],f=r[5],m=r[6],v=r[7],x=r[8],T=r[9],P=r[10],R=r[11],M=r[12],O=r[13],C=r[14],L=r[15];if(n[0].setComponents(c-s,v-u,R-x,L-M).normalize(),n[1].setComponents(c+s,v+u,R+x,L+M).normalize(),n[2].setComponents(c+o,v+f,R+T,L+O).normalize(),n[3].setComponents(c-o,v-f,R-T,L-O).normalize(),n[4].setComponents(c-a,v-m,R-P,L-C).normalize(),t===jl)n[5].setComponents(c+a,v+m,R+P,L+C).normalize();else if(t===V2)n[5].setComponents(a,m,P,C).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),ty.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),ty.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ty)}intersectsSprite(e){return ty.center.set(0,0,0),ty.radius=.7071067811865476,ty.applyMatrix4(e.matrixWorld),this.intersectsSphere(ty)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(nO.x=r.normal.x>0?e.max.x:e.min.x,nO.y=r.normal.y>0?e.max.y:e.min.y,nO.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(nO)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};const Sf=new Vn,wf=new lC;let rXe=class lAe{constructor(){this.coordinateSystem=jl}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Sf.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),wf.setFromProjectionMatrix(Sf,this.coordinateSystem),wf.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Sf.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),wf.setFromProjectionMatrix(Sf,this.coordinateSystem),wf.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Sf.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),wf.setFromProjectionMatrix(Sf,this.coordinateSystem),wf.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Sf.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),wf.setFromProjectionMatrix(Sf,this.coordinateSystem),wf.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Sf.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),wf.setFromProjectionMatrix(Sf,this.coordinateSystem),wf.containsPoint(e))return!0}return!1}clone(){return new lAe}},su=class extends Ka{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new yn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}};const kL=new be,DL=new be,c7e=new Vn,cT=new yx,rO=new nm,nZ=new be,u7e=new be;class rc extends gi{constructor(e=new Xi,t=new su){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let r=1,s=t.count;r<s;r++)kL.fromBufferAttribute(t,r-1),DL.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=kL.distanceTo(DL);e.setAttribute("lineDistance",new br(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),rO.copy(n.boundingSphere),rO.applyMatrix4(r),rO.radius+=s,e.ray.intersectsSphere(rO)===!1)return;c7e.copy(r).invert(),cT.copy(e.ray).applyMatrix4(c7e);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,u=this.isLineSegments?2:1,f=n.index,v=n.attributes.position;if(f!==null){const x=Math.max(0,o.start),T=Math.min(f.count,o.start+o.count);for(let P=x,R=T-1;P<R;P+=u){const M=f.getX(P),O=f.getX(P+1),C=iO(this,e,cT,c,M,O,P);C&&t.push(C)}if(this.isLineLoop){const P=f.getX(T-1),R=f.getX(x),M=iO(this,e,cT,c,P,R,T-1);M&&t.push(M)}}else{const x=Math.max(0,o.start),T=Math.min(v.count,o.start+o.count);for(let P=x,R=T-1;P<R;P+=u){const M=iO(this,e,cT,c,P,P+1,P);M&&t.push(M)}if(this.isLineLoop){const P=iO(this,e,cT,c,T-1,x,T-1);P&&t.push(P)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function iO(i,e,t,n,r,s,o){const a=i.geometry.attributes.position;if(kL.fromBufferAttribute(a,r),DL.fromBufferAttribute(a,s),t.distanceSqToSegment(kL,DL,nZ,u7e)>n)return;nZ.applyMatrix4(i.matrixWorld);const u=e.ray.origin.distanceTo(nZ);if(!(u<e.near||u>e.far))return{distance:u,point:u7e.clone().applyMatrix4(i.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:i}}const h7e=new be,d7e=new be;class cC extends rc{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let r=0,s=t.count;r<s;r+=2)h7e.fromBufferAttribute(t,r),d7e.fromBufferAttribute(t,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+h7e.distanceTo(d7e);e.setAttribute("lineDistance",new br(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}let pre=class extends Ka{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new yn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}};const f7e=new Vn,Dee=new yx,sO=new nm,oO=new be;class iXe extends gi{constructor(e=new Xi,t=new pre){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),sO.copy(n.boundingSphere),sO.applyMatrix4(r),sO.radius+=s,e.ray.intersectsSphere(sO)===!1)return;f7e.copy(r).invert(),Dee.copy(e.ray).applyMatrix4(f7e);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,u=n.index,m=n.attributes.position;if(u!==null){const v=Math.max(0,o.start),x=Math.min(u.count,o.start+o.count);for(let T=v,P=x;T<P;T++){const R=u.getX(T);oO.fromBufferAttribute(m,R),p7e(oO,R,c,r,e,t,this)}}else{const v=Math.max(0,o.start),x=Math.min(m.count,o.start+o.count);for(let T=v,P=x;T<P;T++)oO.fromBufferAttribute(m,T),p7e(oO,T,c,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function p7e(i,e,t,n,r,s,o){const a=Dee.distanceSqToPoint(i);if(a<t){const c=new be;Dee.closestPointToPoint(i,c),c.applyMatrix4(n);const u=r.ray.origin.distanceTo(c);if(u<r.near||u>r.far)return;s.push({distance:u,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}let sXe=class extends Ao{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=es,this.minFilter=es,this.generateMipmaps=!1,this.needsUpdate=!0}},Jc=class extends Ao{constructor(e,t,n=fs,r,s,o,a=es,c=es,u,f=Zc,m=1){if(f!==Zc&&f!==mc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const v={width:e,height:t,depth:m};super(v,r,s,o,a,c,f,n,u),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new lre(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}};class HU extends Xi{constructor(e=1,t=32,n=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const s=[],o=[],a=[],c=[],u=new be,f=new mn;o.push(0,0,0),a.push(0,0,1),c.push(.5,.5);for(let m=0,v=3;m<=t;m++,v+=3){const x=n+m/t*r;u.x=e*Math.cos(x),u.y=e*Math.sin(x),o.push(u.x,u.y,u.z),a.push(0,0,1),f.x=(o[v]/e+1)/2,f.y=(o[v+1]/e+1)/2,c.push(f.x,f.y)}for(let m=1;m<=t;m++)s.push(m,m+1,0);this.setIndex(s),this.setAttribute("position",new br(o,3)),this.setAttribute("normal",new br(a,3)),this.setAttribute("uv",new br(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new HU(e.radius,e.segments,e.thetaStart,e.thetaLength)}}let x0=class cAe extends Xi{constructor(e=1,t=1,n=1,r=32,s=1,o=!1,a=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:c};const u=this;r=Math.floor(r),s=Math.floor(s);const f=[],m=[],v=[],x=[];let T=0;const P=[],R=n/2;let M=0;O(),o===!1&&(e>0&&C(!0),t>0&&C(!1)),this.setIndex(f),this.setAttribute("position",new br(m,3)),this.setAttribute("normal",new br(v,3)),this.setAttribute("uv",new br(x,2));function O(){const L=new be,Y=new be;let J=0;const z=(t-e)/n;for(let ne=0;ne<=s;ne++){const K=[],$=ne/s,he=$*(t-e)+e;for(let Ce=0;Ce<=r;Ce++){const Pe=Ce/r,je=Pe*c+a,ge=Math.sin(je),Xe=Math.cos(je);Y.x=he*ge,Y.y=-$*n+R,Y.z=he*Xe,m.push(Y.x,Y.y,Y.z),L.set(ge,z,Xe).normalize(),v.push(L.x,L.y,L.z),x.push(Pe,1-$),K.push(T++)}P.push(K)}for(let ne=0;ne<r;ne++)for(let K=0;K<s;K++){const $=P[K][ne],he=P[K+1][ne],Ce=P[K+1][ne+1],Pe=P[K][ne+1];(e>0||K!==0)&&(f.push($,he,Pe),J+=3),(t>0||K!==s-1)&&(f.push(he,Ce,Pe),J+=3)}u.addGroup(M,J,0),M+=J}function C(L){const Y=T,J=new mn,z=new be;let ne=0;const K=L===!0?e:t,$=L===!0?1:-1;for(let Ce=1;Ce<=r;Ce++)m.push(0,R*$,0),v.push(0,$,0),x.push(.5,.5),T++;const he=T;for(let Ce=0;Ce<=r;Ce++){const je=Ce/r*c+a,ge=Math.cos(je),Xe=Math.sin(je);z.x=K*Xe,z.y=R*$,z.z=K*ge,m.push(z.x,z.y,z.z),v.push(0,$,0),J.x=ge*.5+.5,J.y=Xe*.5*$+.5,x.push(J.x,J.y),T++}for(let Ce=0;Ce<r;Ce++){const Pe=Y+Ce,je=he+Ce;L===!0?f.push(je,je+1,Pe):f.push(je+1,je,Pe),ne+=3}u.addGroup(M,ne,L===!0?1:2),M+=ne}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cAe(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}};class mre extends Xi{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const s=[],o=[];a(r),u(n),f(),this.setAttribute("position",new br(s,3)),this.setAttribute("normal",new br(s.slice(),3)),this.setAttribute("uv",new br(o,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(O){const C=new be,L=new be,Y=new be;for(let J=0;J<t.length;J+=3)x(t[J+0],C),x(t[J+1],L),x(t[J+2],Y),c(C,L,Y,O)}function c(O,C,L,Y){const J=Y+1,z=[];for(let ne=0;ne<=J;ne++){z[ne]=[];const K=O.clone().lerp(L,ne/J),$=C.clone().lerp(L,ne/J),he=J-ne;for(let Ce=0;Ce<=he;Ce++)Ce===0&&ne===J?z[ne][Ce]=K:z[ne][Ce]=K.clone().lerp($,Ce/he)}for(let ne=0;ne<J;ne++)for(let K=0;K<2*(J-ne)-1;K++){const $=Math.floor(K/2);K%2===0?(v(z[ne][$+1]),v(z[ne+1][$]),v(z[ne][$])):(v(z[ne][$+1]),v(z[ne+1][$+1]),v(z[ne+1][$]))}}function u(O){const C=new be;for(let L=0;L<s.length;L+=3)C.x=s[L+0],C.y=s[L+1],C.z=s[L+2],C.normalize().multiplyScalar(O),s[L+0]=C.x,s[L+1]=C.y,s[L+2]=C.z}function f(){const O=new be;for(let C=0;C<s.length;C+=3){O.x=s[C+0],O.y=s[C+1],O.z=s[C+2];const L=R(O)/2/Math.PI+.5,Y=M(O)/Math.PI+.5;o.push(L,1-Y)}T(),m()}function m(){for(let O=0;O<o.length;O+=6){const C=o[O+0],L=o[O+2],Y=o[O+4],J=Math.max(C,L,Y),z=Math.min(C,L,Y);J>.9&&z<.1&&(C<.2&&(o[O+0]+=1),L<.2&&(o[O+2]+=1),Y<.2&&(o[O+4]+=1))}}function v(O){s.push(O.x,O.y,O.z)}function x(O,C){const L=O*3;C.x=e[L+0],C.y=e[L+1],C.z=e[L+2]}function T(){const O=new be,C=new be,L=new be,Y=new be,J=new mn,z=new mn,ne=new mn;for(let K=0,$=0;K<s.length;K+=9,$+=6){O.set(s[K+0],s[K+1],s[K+2]),C.set(s[K+3],s[K+4],s[K+5]),L.set(s[K+6],s[K+7],s[K+8]),J.set(o[$+0],o[$+1]),z.set(o[$+2],o[$+3]),ne.set(o[$+4],o[$+5]),Y.copy(O).add(C).add(L).divideScalar(3);const he=R(Y);P(J,$+0,O,he),P(z,$+2,C,he),P(ne,$+4,L,he)}}function P(O,C,L,Y){Y<0&&O.x===1&&(o[C]=O.x-1),L.x===0&&L.z===0&&(o[C]=Y/2/Math.PI+.5)}function R(O){return Math.atan2(O.z,-O.x)}function M(O){return Math.atan2(-O.y,Math.sqrt(O.x*O.x+O.z*O.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new mre(e.vertices,e.indices,e.radius,e.details)}}class uAe{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let r=0;const s=n.length;let o;t?o=t:o=e*n[s-1];let a=0,c=s-1,u;for(;a<=c;)if(r=Math.floor(a+(c-a)/2),u=n[r]-o,u<0)a=r+1;else if(u>0)c=r-1;else{c=r;break}if(r=c,n[r]===o)return r/(s-1);const f=n[r],v=n[r+1]-f,x=(o-f)/v;return(r+x)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),c=t||(o.isVector2?new mn:new be);return c.copy(a).sub(o).normalize(),c}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new be,r=[],s=[],o=[],a=new be,c=new Vn;for(let x=0;x<=e;x++){const T=x/e;r[x]=this.getTangentAt(T,new be)}s[0]=new be,o[0]=new be;let u=Number.MAX_VALUE;const f=Math.abs(r[0].x),m=Math.abs(r[0].y),v=Math.abs(r[0].z);f<=u&&(u=f,n.set(1,0,0)),m<=u&&(u=m,n.set(0,1,0)),v<=u&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let x=1;x<=e;x++){if(s[x]=s[x-1].clone(),o[x]=o[x-1].clone(),a.crossVectors(r[x-1],r[x]),a.length()>Number.EPSILON){a.normalize();const T=Math.acos(ei(r[x-1].dot(r[x]),-1,1));s[x].applyMatrix4(c.makeRotationAxis(a,T))}o[x].crossVectors(r[x],s[x])}if(t===!0){let x=Math.acos(ei(s[0].dot(s[e]),-1,1));x/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(x=-x);for(let T=1;T<=e;T++)s[T].applyMatrix4(c.makeRotationAxis(r[T],x*T)),o[T].crossVectors(r[T],s[T])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}function gre(){let i=0,e=0,t=0,n=0;function r(s,o,a,c){i=s,e=a,t=-3*s+3*o-2*a-c,n=2*s-2*o+a+c}return{initCatmullRom:function(s,o,a,c,u){r(o,a,u*(a-s),u*(c-o))},initNonuniformCatmullRom:function(s,o,a,c,u,f,m){let v=(o-s)/u-(a-s)/(u+f)+(a-o)/f,x=(a-o)/f-(c-o)/(f+m)+(c-a)/m;v*=f,x*=f,r(o,a,v,x)},calc:function(s){const o=s*s,a=o*s;return i+e*s+t*o+n*a}}}const aO=new be,rZ=new gre,iZ=new gre,sZ=new gre;class m7e extends uAe{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new be){const n=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let a=Math.floor(o),c=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:c===0&&a===s-1&&(a=s-2,c=1);let u,f;this.closed||a>0?u=r[(a-1)%s]:(aO.subVectors(r[0],r[1]).add(r[0]),u=aO);const m=r[a%s],v=r[(a+1)%s];if(this.closed||a+2<s?f=r[(a+2)%s]:(aO.subVectors(r[s-1],r[s-2]).add(r[s-1]),f=aO),this.curveType==="centripetal"||this.curveType==="chordal"){const x=this.curveType==="chordal"?.5:.25;let T=Math.pow(u.distanceToSquared(m),x),P=Math.pow(m.distanceToSquared(v),x),R=Math.pow(v.distanceToSquared(f),x);P<1e-4&&(P=1),T<1e-4&&(T=P),R<1e-4&&(R=P),rZ.initNonuniformCatmullRom(u.x,m.x,v.x,f.x,T,P,R),iZ.initNonuniformCatmullRom(u.y,m.y,v.y,f.y,T,P,R),sZ.initNonuniformCatmullRom(u.z,m.z,v.z,f.z,T,P,R)}else this.curveType==="catmullrom"&&(rZ.initCatmullRom(u.x,m.x,v.x,f.x,this.tension),iZ.initCatmullRom(u.y,m.y,v.y,f.y,this.tension),sZ.initCatmullRom(u.z,m.z,v.z,f.z,this.tension));return n.set(rZ.calc(c),iZ.calc(c),sZ.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new be().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function oXe(i,e,t=2){const n=e&&e.length,r=n?e[0]*t:i.length;let s=hAe(i,0,r,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,c,u;if(n&&(s=hXe(i,e,s,t)),i.length>80*t){a=1/0,c=1/0;let f=-1/0,m=-1/0;for(let v=t;v<r;v+=t){const x=i[v],T=i[v+1];x<a&&(a=x),T<c&&(c=T),x>f&&(f=x),T>m&&(m=T)}u=Math.max(f-a,m-c),u=u!==0?32767/u:0}return EM(s,o,t,a,c,u,0),o}function hAe(i,e,t,n,r){let s;if(r===SXe(i,e,t,n)>0)for(let o=e;o<t;o+=n)s=g7e(o/n|0,i[o],i[o+1],s);else for(let o=t-n;o>=e;o-=n)s=g7e(o/n|0,i[o],i[o+1],s);return s&&j_(s,s.next)&&(CM(s),s=s.next),s}function S4(i,e){if(!i)return i;e||(e=i);let t=i,n;do if(n=!1,!t.steiner&&(j_(t,t.next)||mo(t.prev,t,t.next)===0)){if(CM(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function EM(i,e,t,n,r,s,o){if(!i)return;!o&&s&&gXe(i,n,r,s);let a=i;for(;i.prev!==i.next;){const c=i.prev,u=i.next;if(s?lXe(i,n,r,s):aXe(i)){e.push(c.i,i.i,u.i),CM(i),i=u.next,a=u.next;continue}if(i=u,i===a){o?o===1?(i=cXe(S4(i),e),EM(i,e,t,n,r,s,2)):o===2&&uXe(i,e,t,n,r,s):EM(S4(i),e,t,n,r,s,1);break}}}function aXe(i){const e=i.prev,t=i,n=i.next;if(mo(e,t,n)>=0)return!1;const r=e.x,s=t.x,o=n.x,a=e.y,c=t.y,u=n.y,f=Math.min(r,s,o),m=Math.min(a,c,u),v=Math.max(r,s,o),x=Math.max(a,c,u);let T=n.next;for(;T!==e;){if(T.x>=f&&T.x<=v&&T.y>=m&&T.y<=x&&rE(r,a,s,c,o,u,T.x,T.y)&&mo(T.prev,T,T.next)>=0)return!1;T=T.next}return!0}function lXe(i,e,t,n){const r=i.prev,s=i,o=i.next;if(mo(r,s,o)>=0)return!1;const a=r.x,c=s.x,u=o.x,f=r.y,m=s.y,v=o.y,x=Math.min(a,c,u),T=Math.min(f,m,v),P=Math.max(a,c,u),R=Math.max(f,m,v),M=Fee(x,T,e,t,n),O=Fee(P,R,e,t,n);let C=i.prevZ,L=i.nextZ;for(;C&&C.z>=M&&L&&L.z<=O;){if(C.x>=x&&C.x<=P&&C.y>=T&&C.y<=R&&C!==r&&C!==o&&rE(a,f,c,m,u,v,C.x,C.y)&&mo(C.prev,C,C.next)>=0||(C=C.prevZ,L.x>=x&&L.x<=P&&L.y>=T&&L.y<=R&&L!==r&&L!==o&&rE(a,f,c,m,u,v,L.x,L.y)&&mo(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;C&&C.z>=M;){if(C.x>=x&&C.x<=P&&C.y>=T&&C.y<=R&&C!==r&&C!==o&&rE(a,f,c,m,u,v,C.x,C.y)&&mo(C.prev,C,C.next)>=0)return!1;C=C.prevZ}for(;L&&L.z<=O;){if(L.x>=x&&L.x<=P&&L.y>=T&&L.y<=R&&L!==r&&L!==o&&rE(a,f,c,m,u,v,L.x,L.y)&&mo(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function cXe(i,e){let t=i;do{const n=t.prev,r=t.next.next;!j_(n,r)&&fAe(n,t,t.next,r)&&MM(n,r)&&MM(r,n)&&(e.push(n.i,t.i,r.i),CM(t),CM(t.next),t=i=r),t=t.next}while(t!==i);return S4(t)}function uXe(i,e,t,n,r,s){let o=i;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&_Xe(o,a)){let c=pAe(o,a);o=S4(o,o.next),c=S4(c,c.next),EM(o,e,t,n,r,s,0),EM(c,e,t,n,r,s,0);return}a=a.next}o=o.next}while(o!==i)}function hXe(i,e,t,n){const r=[];for(let s=0,o=e.length;s<o;s++){const a=e[s]*n,c=s<o-1?e[s+1]*n:i.length,u=hAe(i,a,c,n,!1);u===u.next&&(u.steiner=!0),r.push(vXe(u))}r.sort(dXe);for(let s=0;s<r.length;s++)t=fXe(r[s],t);return t}function dXe(i,e){let t=i.x-e.x;if(t===0&&(t=i.y-e.y,t===0)){const n=(i.next.y-i.y)/(i.next.x-i.x),r=(e.next.y-e.y)/(e.next.x-e.x);t=n-r}return t}function fXe(i,e){const t=pXe(i,e);if(!t)return e;const n=pAe(t,i);return S4(n,n.next),S4(t,t.next)}function pXe(i,e){let t=e;const n=i.x,r=i.y;let s=-1/0,o;if(j_(i,t))return t;do{if(j_(i,t.next))return t.next;if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const m=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(m<=n&&m>s&&(s=m,o=t.x<t.next.x?t:t.next,m===n))return o}t=t.next}while(t!==e);if(!o)return null;const a=o,c=o.x,u=o.y;let f=1/0;t=o;do{if(n>=t.x&&t.x>=c&&n!==t.x&&dAe(r<u?n:s,r,c,u,r<u?s:n,r,t.x,t.y)){const m=Math.abs(r-t.y)/(n-t.x);MM(t,i)&&(m<f||m===f&&(t.x>o.x||t.x===o.x&&mXe(o,t)))&&(o=t,f=m)}t=t.next}while(t!==a);return o}function mXe(i,e){return mo(i.prev,i,e.prev)<0&&mo(e.next,i,i.next)<0}function gXe(i,e,t,n){let r=i;do r.z===0&&(r.z=Fee(r.x,r.y,e,t,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==i);r.prevZ.nextZ=null,r.prevZ=null,yXe(r)}function yXe(i){let e,t=1;do{let n=i,r;i=null;let s=null;for(e=0;n;){e++;let o=n,a=0;for(let u=0;u<t&&(a++,o=o.nextZ,!!o);u++);let c=t;for(;a>0||c>0&&o;)a!==0&&(c===0||!o||n.z<=o.z)?(r=n,n=n.nextZ,a--):(r=o,o=o.nextZ,c--),s?s.nextZ=r:i=r,r.prevZ=s,s=r;n=o}s.nextZ=null,t*=2}while(e>1);return i}function Fee(i,e,t,n,r){return i=(i-t)*r|0,e=(e-n)*r|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function vXe(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function dAe(i,e,t,n,r,s,o,a){return(r-o)*(e-a)>=(i-o)*(s-a)&&(i-o)*(n-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(r-o)*(n-a)}function rE(i,e,t,n,r,s,o,a){return!(i===o&&e===a)&&dAe(i,e,t,n,r,s,o,a)}function _Xe(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!xXe(i,e)&&(MM(i,e)&&MM(e,i)&&bXe(i,e)&&(mo(i.prev,i,e.prev)||mo(i,e.prev,e))||j_(i,e)&&mo(i.prev,i,i.next)>0&&mo(e.prev,e,e.next)>0)}function mo(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function j_(i,e){return i.x===e.x&&i.y===e.y}function fAe(i,e,t,n){const r=cO(mo(i,e,t)),s=cO(mo(i,e,n)),o=cO(mo(t,n,i)),a=cO(mo(t,n,e));return!!(r!==s&&o!==a||r===0&&lO(i,t,e)||s===0&&lO(i,n,e)||o===0&&lO(t,i,n)||a===0&&lO(t,e,n))}function lO(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function cO(i){return i>0?1:i<0?-1:0}function xXe(i,e){let t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&fAe(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function MM(i,e){return mo(i.prev,i,i.next)<0?mo(i,e,i.next)>=0&&mo(i,i.prev,e)>=0:mo(i,e,i.prev)<0||mo(i,i.next,e)<0}function bXe(i,e){let t=i,n=!1;const r=(i.x+e.x)/2,s=(i.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==i);return n}function pAe(i,e){const t=Oee(i.i,i.x,i.y),n=Oee(e.i,e.x,e.y),r=i.next,s=e.prev;return i.next=e,e.prev=i,t.next=r,r.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function g7e(i,e,t,n){const r=Oee(i,e,t);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function CM(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Oee(i,e,t){return{i,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function SXe(i,e,t,n){let r=0;for(let s=e,o=t-n;s<t;s+=n)r+=(i[o]-i[s])*(i[s+1]+i[o+1]),o=s;return r}class wXe{static triangulate(e,t,n=2){return oXe(e,t,n)}}class yre{static area(e){const t=e.length;let n=0;for(let r=t-1,s=0;s<t;r=s++)n+=e[r].x*e[s].y-e[s].x*e[r].y;return n*.5}static isClockWise(e){return yre.area(e)<0}static triangulateShape(e,t){const n=[],r=[],s=[];y7e(e),v7e(n,e);let o=e.length;t.forEach(y7e);for(let c=0;c<t.length;c++)r.push(o),o+=t[c].length,v7e(n,t[c]);const a=wXe.triangulate(n,r);for(let c=0;c<a.length;c+=3)s.push(a.slice(c,c+3));return s}}function y7e(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function v7e(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class Xy extends mre{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Xy(e.radius,e.detail)}}let _x=class mAe extends Xi{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(n),c=Math.floor(r),u=a+1,f=c+1,m=e/a,v=t/c,x=[],T=[],P=[],R=[];for(let M=0;M<f;M++){const O=M*v-o;for(let C=0;C<u;C++){const L=C*m-s;T.push(L,-O,0),P.push(0,0,1),R.push(C/a),R.push(1-M/c)}}for(let M=0;M<c;M++)for(let O=0;O<a;O++){const C=O+u*M,L=O+u*(M+1),Y=O+1+u*(M+1),J=O+1+u*M;x.push(C,L,J),x.push(L,Y,J)}this.setIndex(x),this.setAttribute("position",new br(T,3)),this.setAttribute("normal",new br(P,3)),this.setAttribute("uv",new br(R,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new mAe(e.width,e.height,e.widthSegments,e.heightSegments)}},G2=class gAe extends Xi{constructor(e=1,t=32,n=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const c=Math.min(o+a,Math.PI);let u=0;const f=[],m=new be,v=new be,x=[],T=[],P=[],R=[];for(let M=0;M<=n;M++){const O=[],C=M/n;let L=0;M===0&&o===0?L=.5/t:M===n&&c===Math.PI&&(L=-.5/t);for(let Y=0;Y<=t;Y++){const J=Y/t;m.x=-e*Math.cos(r+J*s)*Math.sin(o+C*a),m.y=e*Math.cos(o+C*a),m.z=e*Math.sin(r+J*s)*Math.sin(o+C*a),T.push(m.x,m.y,m.z),v.copy(m).normalize(),P.push(v.x,v.y,v.z),R.push(J+L,1-C),O.push(u++)}f.push(O)}for(let M=0;M<n;M++)for(let O=0;O<t;O++){const C=f[M][O+1],L=f[M][O],Y=f[M+1][O],J=f[M+1][O+1];(M!==0||o>0)&&x.push(C,L,J),(M!==n-1||c<Math.PI)&&x.push(L,Y,J)}this.setIndex(x),this.setAttribute("position",new br(T,3)),this.setAttribute("normal",new br(P,3)),this.setAttribute("uv",new br(R,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gAe(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}};class ky extends Xi{constructor(e=1,t=.4,n=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:s},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],c=[],u=[],f=new be,m=new be,v=new be;for(let x=0;x<=n;x++)for(let T=0;T<=r;T++){const P=T/r*s,R=x/n*Math.PI*2;m.x=(e+t*Math.cos(R))*Math.cos(P),m.y=(e+t*Math.cos(R))*Math.sin(P),m.z=t*Math.sin(R),a.push(m.x,m.y,m.z),f.x=e*Math.cos(P),f.y=e*Math.sin(P),v.subVectors(m,f).normalize(),c.push(v.x,v.y,v.z),u.push(T/r),u.push(x/n)}for(let x=1;x<=n;x++)for(let T=1;T<=r;T++){const P=(r+1)*x+T-1,R=(r+1)*(x-1)+T-1,M=(r+1)*(x-1)+T,O=(r+1)*x+T;o.push(P,R,O),o.push(R,M,O)}this.setIndex(o),this.setAttribute("position",new br(a,3)),this.setAttribute("normal",new br(c,3)),this.setAttribute("uv",new br(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ky(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class vre extends Xi{constructor(e=1,t=.4,n=64,r=8,s=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:s,q:o},n=Math.floor(n),r=Math.floor(r);const a=[],c=[],u=[],f=[],m=new be,v=new be,x=new be,T=new be,P=new be,R=new be,M=new be;for(let C=0;C<=n;++C){const L=C/n*s*Math.PI*2;O(L,s,o,e,x),O(L+.01,s,o,e,T),R.subVectors(T,x),M.addVectors(T,x),P.crossVectors(R,M),M.crossVectors(P,R),P.normalize(),M.normalize();for(let Y=0;Y<=r;++Y){const J=Y/r*Math.PI*2,z=-t*Math.cos(J),ne=t*Math.sin(J);m.x=x.x+(z*M.x+ne*P.x),m.y=x.y+(z*M.y+ne*P.y),m.z=x.z+(z*M.z+ne*P.z),c.push(m.x,m.y,m.z),v.subVectors(m,x).normalize(),u.push(v.x,v.y,v.z),f.push(C/n),f.push(Y/r)}}for(let C=1;C<=n;C++)for(let L=1;L<=r;L++){const Y=(r+1)*(C-1)+(L-1),J=(r+1)*C+(L-1),z=(r+1)*C+L,ne=(r+1)*(C-1)+L;a.push(Y,J,ne),a.push(J,z,ne)}this.setIndex(a),this.setAttribute("position",new br(c,3)),this.setAttribute("normal",new br(u,3)),this.setAttribute("uv",new br(f,2));function O(C,L,Y,J,z){const ne=Math.cos(C),K=Math.sin(C),$=Y/L*C,he=Math.cos($);z.x=J*(2+he)*.5*ne,z.y=J*(2+he)*K*.5,z.z=J*Math.sin($)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vre(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}let TXe=class extends Ka{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new yn(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}},yAe=class extends Ka{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new yn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=j1,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mo,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}},jU=class extends yAe{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new mn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ei(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new yn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new yn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new yn(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}},Yy=class extends Ka{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new yn(16777215),this.specular=new yn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=j1,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mo,this.combine=rC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}},EXe=class extends Ka{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new yn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=j1,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},_re=class extends Ka{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=j1,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}},vAe=class extends Ka{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new yn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new yn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=j1,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mo,this.combine=rC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}};class _Ae extends Ka{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=oC,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class MXe extends Ka{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}let xre=class extends Ka{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new yn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=j1,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}},CXe=class extends su{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}};function uO(i,e){return!i||i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}function AXe(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function RXe(i){function e(r,s){return i[r]-i[s]}const t=i.length,n=new Array(t);for(let r=0;r!==t;++r)n[r]=r;return n.sort(e),n}function _7e(i,e,t){const n=i.length,r=new i.constructor(n);for(let s=0,o=0;o!==n;++s){const a=t[s]*e;for(let c=0;c!==e;++c)r[o++]=i[a+c]}return r}function xAe(i,e,t,n){let r=1,s=i[0];for(;s!==void 0&&s[n]===void 0;)s=i[r++];if(s===void 0)return;let o=s[n];if(o!==void 0)if(Array.isArray(o))do o=s[n],o!==void 0&&(e.push(s.time),t.push(...o)),s=i[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[n],o!==void 0&&(e.push(s.time),o.toArray(t,t.length)),s=i[r++];while(s!==void 0);else do o=s[n],o!==void 0&&(e.push(s.time),t.push(o)),s=i[r++];while(s!==void 0)}class WU{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],s=t[n-1];e:{t:{let o;n:{r:if(!(e<r)){for(let a=n+2;;){if(r===void 0){if(e<s)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(s=r,r=t[++n],e<r)break t}o=t.length;break n}if(!(e>=s)){const a=t[1];e<a&&(n=2,s=a);for(let c=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===c)break;if(r=s,s=t[--n-1],e>=s)break t}o=n,n=0;break n}break e}for(;n<o;){const a=n+o>>>1;e<t[a]?o=a:n=a+1}if(r=t[n],s=t[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,r)}return this.interpolate_(n,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=n[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class PXe extends WU{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:D6,endingEnd:D6}}intervalChanged_(e,t,n){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],c=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case F6:s=e,a=2*t-n;break;case NL:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=n}if(c===void 0)switch(this.getSettings_().endingEnd){case F6:o=e,c=2*n-t;break;case NL:o=1,c=n+r[1]-r[0];break;default:o=e-1,c=t}const u=(n-t)*.5,f=this.valueSize;this._weightPrev=u/(t-a),this._weightNext=u/(c-n),this._offsetPrev=s*f,this._offsetNext=o*f}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,u=c-a,f=this._offsetPrev,m=this._offsetNext,v=this._weightPrev,x=this._weightNext,T=(n-t)/(r-t),P=T*T,R=P*T,M=-v*R+2*v*P-v*T,O=(1+v)*R+(-1.5-2*v)*P+(-.5+v)*T+1,C=(-1-x)*R+(1.5+x)*P+.5*T,L=x*R-x*P;for(let Y=0;Y!==a;++Y)s[Y]=M*o[f+Y]+O*o[u+Y]+C*o[c+Y]+L*o[m+Y];return s}}class bAe extends WU{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,u=c-a,f=(n-t)/(r-t),m=1-f;for(let v=0;v!==a;++v)s[v]=o[u+v]*m+o[c+v]*f;return s}}class NXe extends WU{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Cd{constructor(e,t,n,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=uO(t,this.TimeBufferType),this.values=uO(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:uO(e.times,Array),values:uO(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(n.interpolation=r)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new NXe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new bAe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new PXe(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case PL:t=this.InterpolantFactoryMethodDiscrete;break;case Ree:t=this.InterpolantFactoryMethodLinear;break;case IK:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return PL;case this.InterpolantFactoryMethodLinear:return Ree;case this.InterpolantFactoryMethodSmooth:return IK}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let s=0,o=r-1;for(;s!==r&&n[s]<e;)++s;for(;o!==-1&&n[o]>t;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=n.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const c=n[a];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,c),e=!1;break}if(o!==null&&o>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,c,o),e=!1;break}o=c}if(r!==void 0&&AXe(r))for(let a=0,c=r.length;a!==c;++a){const u=r[a];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,u),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===IK,s=e.length-1;let o=1;for(let a=1;a<s;++a){let c=!1;const u=e[a],f=e[a+1];if(u!==f&&(a!==1||u!==e[0]))if(r)c=!0;else{const m=a*n,v=m-n,x=m+n;for(let T=0;T!==n;++T){const P=t[m+T];if(P!==t[v+T]||P!==t[x+T]){c=!0;break}}}if(c){if(a!==o){e[o]=e[a];const m=a*n,v=o*n;for(let x=0;x!==n;++x)t[v+x]=t[m+x]}++o}}if(s>0){e[o]=e[s];for(let a=s*n,c=o*n,u=0;u!==n;++u)t[c+u]=t[a+u];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,r=new n(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Cd.prototype.ValueTypeName="";Cd.prototype.TimeBufferType=Float32Array;Cd.prototype.ValueBufferType=Float32Array;Cd.prototype.DefaultInterpolation=Ree;class xx extends Cd{constructor(e,t,n){super(e,t,n)}}xx.prototype.ValueTypeName="bool";xx.prototype.ValueBufferType=Array;xx.prototype.DefaultInterpolation=PL;xx.prototype.InterpolantFactoryMethodLinear=void 0;xx.prototype.InterpolantFactoryMethodSmooth=void 0;class SAe extends Cd{constructor(e,t,n,r){super(e,t,n,r)}}SAe.prototype.ValueTypeName="color";class AM extends Cd{constructor(e,t,n,r){super(e,t,n,r)}}AM.prototype.ValueTypeName="number";class IXe extends WU{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=(n-t)/(r-t);let u=e*a;for(let f=u+a;u!==f;u+=4)qi.slerpFlat(s,0,o,u-a,o,u,c);return s}}class W_ extends Cd{constructor(e,t,n,r){super(e,t,n,r)}InterpolantFactoryMethodLinear(e){return new IXe(this.times,this.values,this.getValueSize(),e)}}W_.prototype.ValueTypeName="quaternion";W_.prototype.InterpolantFactoryMethodSmooth=void 0;class bx extends Cd{constructor(e,t,n){super(e,t,n)}}bx.prototype.ValueTypeName="string";bx.prototype.ValueBufferType=Array;bx.prototype.DefaultInterpolation=PL;bx.prototype.InterpolantFactoryMethodLinear=void 0;bx.prototype.InterpolantFactoryMethodSmooth=void 0;class RM extends Cd{constructor(e,t,n,r){super(e,t,n,r)}}RM.prototype.ValueTypeName="vector";class Bee{constructor(e="",t=-1,n=[],r=Jne){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=Sd(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let o=0,a=n.length;o!==a;++o)t.push(DXe(n[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=n.length;s!==o;++s)t.push(Cd.toJSON(n[s]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const s=t.length,o=[];for(let a=0;a<s;a++){let c=[],u=[];c.push((a+s-1)%s,a,(a+1)%s),u.push(0,1,0);const f=RXe(c);c=_7e(c,1,f),u=_7e(u,1,f),!r&&c[0]===0&&(c.push(s),u.push(u[0])),o.push(new AM(".morphTargetInfluences["+t[a].name+"]",c,u).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const r=e;n=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,c=e.length;a<c;a++){const u=e[a],f=u.name.match(s);if(f&&f.length>1){const m=f[1];let v=r[m];v||(r[m]=v=[]),v.push(u)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,n));return o}static parseAnimation(e,t){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(m,v,x,T,P){if(x.length!==0){const R=[],M=[];xAe(x,R,M,T),R.length!==0&&P.push(new m(v,R,M))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let c=e.length||-1;const u=e.hierarchy||[];for(let m=0;m<u.length;m++){const v=u[m].keys;if(!(!v||v.length===0))if(v[0].morphTargets){const x={};let T;for(T=0;T<v.length;T++)if(v[T].morphTargets)for(let P=0;P<v[T].morphTargets.length;P++)x[v[T].morphTargets[P]]=-1;for(const P in x){const R=[],M=[];for(let O=0;O!==v[T].morphTargets.length;++O){const C=v[T];R.push(C.time),M.push(C.morphTarget===P?1:0)}r.push(new AM(".morphTargetInfluence["+P+"]",R,M))}c=x.length*o}else{const x=".bones["+t[m].name+"]";n(RM,x+".position",v,"pos",r),n(W_,x+".quaternion",v,"rot",r),n(RM,x+".scale",v,"scl",r)}}return r.length===0?null:new this(s,c,r,a)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,r=e.length;n!==r;++n){const s=this.tracks[n];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function kXe(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return AM;case"vector":case"vector2":case"vector3":case"vector4":return RM;case"color":return SAe;case"quaternion":return W_;case"bool":case"boolean":return xx;case"string":return bx}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function DXe(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=kXe(i.type);if(i.times===void 0){const t=[],n=[];xAe(i.keys,t,n,"value"),i.times=t,i.values=n}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const FL={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class FXe{constructor(e,t,n){const r=this;let s=!1,o=0,a=0,c;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(f){a++,s===!1&&r.onStart!==void 0&&r.onStart(f,o,a),s=!0},this.itemEnd=function(f){o++,r.onProgress!==void 0&&r.onProgress(f,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(f){r.onError!==void 0&&r.onError(f)},this.resolveURL=function(f){return c?c(f):f},this.setURLModifier=function(f){return c=f,this},this.addHandler=function(f,m){return u.push(f,m),this},this.removeHandler=function(f){const m=u.indexOf(f);return m!==-1&&u.splice(m,2),this},this.getHandler=function(f){for(let m=0,v=u.length;m<v;m+=2){const x=u[m],T=u[m+1];if(x.global&&(x.lastIndex=0),x.test(f))return T}return null}}}const OXe=new FXe;class $2{constructor(e){this.manager=e!==void 0?e:OXe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,s){n.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}$2.DEFAULT_MATERIAL_NAME="__DEFAULT";const a1={};class BXe extends Error{constructor(e,t){super(e),this.response=t}}class LXe extends $2{constructor(e){super(e),this.mimeType="",this.responseType=""}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=FL.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(a1[e]!==void 0){a1[e].push({onLoad:t,onProgress:n,onError:r});return}a1[e]=[],a1[e].push({onLoad:t,onProgress:n,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,c=this.responseType;fetch(o).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const f=a1[e],m=u.body.getReader(),v=u.headers.get("X-File-Size")||u.headers.get("Content-Length"),x=v?parseInt(v):0,T=x!==0;let P=0;const R=new ReadableStream({start(M){O();function O(){m.read().then(({done:C,value:L})=>{if(C)M.close();else{P+=L.byteLength;const Y=new ProgressEvent("progress",{lengthComputable:T,loaded:P,total:x});for(let J=0,z=f.length;J<z;J++){const ne=f[J];ne.onProgress&&ne.onProgress(Y)}M.enqueue(L),O()}},C=>{M.error(C)})}}});return new Response(R)}else throw new BXe(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(c){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(f=>new DOMParser().parseFromString(f,a));case"json":return u.json();default:if(a==="")return u.text();{const m=/charset="?([^;"\s]*)"?/i.exec(a),v=m&&m[1]?m[1].toLowerCase():void 0,x=new TextDecoder(v);return u.arrayBuffer().then(T=>x.decode(T))}}}).then(u=>{FL.add(e,u);const f=a1[e];delete a1[e];for(let m=0,v=f.length;m<v;m++){const x=f[m];x.onLoad&&x.onLoad(u)}}).catch(u=>{const f=a1[e];if(f===void 0)throw this.manager.itemError(e),u;delete a1[e];for(let m=0,v=f.length;m<v;m++){const x=f[m];x.onError&&x.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class wAe extends $2{constructor(e){super(e)}load(e,t,n,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=FL.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=TM("img");function c(){f(),FL.add(e,this),t&&t(this),s.manager.itemEnd(e)}function u(m){f(),r&&r(m),s.manager.itemError(e),s.manager.itemEnd(e)}function f(){a.removeEventListener("load",c,!1),a.removeEventListener("error",u,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class UXe extends $2{constructor(e){super(e)}load(e,t,n,r){const s=new vx;s.colorSpace=Hr;const o=new wAe(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function c(u){o.load(e[u],function(f){s.images[u]=f,a++,a===6&&(s.needsUpdate=!0,t&&t(s))},void 0,r)}for(let u=0;u<e.length;++u)c(u);return s}}class TAe extends $2{constructor(e){super(e)}load(e,t,n,r){const s=new Ao,o=new wAe(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},n,r),s}}let P4=class extends gi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new yn(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}},EAe=class extends P4{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(gi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new yn(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}};const oZ=new Vn,x7e=new be,b7e=new be;let bre=class{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new mn(512,512),this.mapType=ps,this.map=null,this.mapPass=null,this.matrix=new Vn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new lC,this._frameExtents=new mn(1,1),this._viewportCount=1,this._viewports=[new ir(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;x7e.setFromMatrixPosition(e.matrixWorld),t.position.copy(x7e),b7e.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(b7e),t.updateMatrixWorld(),oZ.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(oZ),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(oZ)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},zXe=class extends bre{constructor(){super(new po(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=b4*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||t.far;(n!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},Sx=class extends P4{constructor(e,t,n=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(gi.DEFAULT_UP),this.updateMatrix(),this.target=new gi,this.distance=n,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new zXe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};const S7e=new Vn,uT=new be,aZ=new be;let VXe=class extends bre{constructor(){super(new po(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new mn(4,2),this._viewportCount=6,this._viewports=[new ir(2,1,1,1),new ir(0,1,1,1),new ir(3,1,1,1),new ir(1,1,1,1),new ir(3,0,1,1),new ir(1,0,1,1)],this._cubeDirections=[new be(1,0,0),new be(-1,0,0),new be(0,0,1),new be(0,0,-1),new be(0,1,0),new be(0,-1,0)],this._cubeUps=[new be(0,1,0),new be(0,1,0),new be(0,1,0),new be(0,1,0),new be(0,0,1),new be(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),uT.setFromMatrixPosition(e.matrixWorld),n.position.copy(uT),aZ.copy(n.position),aZ.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(aZ),n.updateMatrixWorld(),r.makeTranslation(-uT.x,-uT.y,-uT.z),S7e.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(S7e)}},Lee=class extends P4{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new VXe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},w4=class extends aC{constructor(e=-1,t=1,n=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,o=n+e,a=r+t,c=r-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,o=s+u*this.view.width,a-=f*this.view.offsetY,c=a-f*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},GXe=class extends bre{constructor(){super(new w4(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},qU=class extends P4{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(gi.DEFAULT_UP),this.updateMatrix(),this.target=new gi,this.shadow=new GXe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},MAe=class extends P4{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}},CAe=class extends P4{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}},$Xe=class{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new be)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(n*s)),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*n*s),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const n=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-r*r)}},HXe=class extends P4{constructor(e=new $Xe,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}};class jXe{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}let AAe=class extends po{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}};class RAe{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=w7e(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=w7e();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function w7e(){return performance.now()}class WXe{constructor(e,t,n){this.binding=e,this.valueSize=n;let r,s,o;switch(t){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==r;++a)n[s+a]=n[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(n,s,0,a,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const c=t*this._origIndex;this._mixBufferRegion(n,r,c,1-s,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let c=t,u=t+t;c!==u;++c)if(n[c]!==n[c+t]){a.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let s=n,o=r;s!==o;++s)t[s]=t[r+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[t+o]=e[n+o]}_slerp(e,t,n,r){qi.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,s){const o=this._workIndex*s;qi.multiplyQuaternionsFlat(e,o,e,t,e,n),qi.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,n,r,s){const o=1-r;for(let a=0;a!==s;++a){const c=t+a;e[c]=e[c]*o+e[n+a]*r}}_lerpAdditive(e,t,n,r,s){for(let o=0;o!==s;++o){const a=t+o;e[a]=e[a]+e[n+o]*r}}}const Sre="\\[\\]\\.:\\/",qXe=new RegExp("["+Sre+"]","g"),wre="[^"+Sre+"]",XXe="[^"+Sre.replace("\\.","")+"]",YXe=/((?:WC+[\/:])*)/.source.replace("WC",wre),KXe=/(WCOD+)?/.source.replace("WCOD",XXe),ZXe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",wre),QXe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",wre),JXe=new RegExp("^"+YXe+KXe+ZXe+QXe+"$"),eYe=["material","materials","bones","map"];class tYe{constructor(e,t,n){const r=n||Ai.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];r!==void 0&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=n.length;r!==s;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class Ai{constructor(e,t,n){this.path=t,this.parsedPath=n||Ai.parseTrackName(t),this.node=Ai.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Ai.Composite(e,t,n):new Ai(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(qXe,"")}static parseTrackName(e){const t=JXe.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=n.nodeName.substring(r+1);eYe.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===t||a.uuid===t)return a;const c=n(a.children);if(c)return c}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(e||(e=Ai.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let u=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let f=0;f<e.length;f++)if(e[f].name===u){u=f;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(u!==void 0){if(e[u]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[u]}}const o=e[r];if(o===void 0){const u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?a=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}c=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(c=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ai.Composite=tYe;Ai.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ai.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ai.prototype.GetterByBindingType=[Ai.prototype._getValue_direct,Ai.prototype._getValue_array,Ai.prototype._getValue_arrayElement,Ai.prototype._getValue_toArray];Ai.prototype.SetterByBindingTypeAndVersioning=[[Ai.prototype._setValue_direct,Ai.prototype._setValue_direct_setNeedsUpdate,Ai.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ai.prototype._setValue_array,Ai.prototype._setValue_array_setNeedsUpdate,Ai.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ai.prototype._setValue_arrayElement,Ai.prototype._setValue_arrayElement_setNeedsUpdate,Ai.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ai.prototype._setValue_fromArray,Ai.prototype._setValue_fromArray_setNeedsUpdate,Ai.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class nYe{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const s=t.tracks,o=s.length,a=new Array(o),c={endingStart:D6,endingEnd:D6};for(let u=0;u!==o;++u){const f=s[u].createInterpolant(null);a[u]=f,f.settings=c}this._interpolantSettings=c,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=jWe,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n=!1){if(e.fadeOut(t),this.fadeIn(t),n===!0){const r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n=!1){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const c=a.parameterPositions,u=a.sampleValues;return c[0]=s,c[1]=s+n,u[0]=e/o,u[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const c=(e-s)*n;c<0||n===0?t=0:(this._startTime=null,t=n*c)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const c=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case qWe:for(let f=0,m=c.length;f!==m;++f)c[f].evaluate(o),u[f].accumulateAdditive(a);break;case Jne:default:for(let f=0,m=c.length;f!==m;++f)c[f].evaluate(o),u[f].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,s=this._loopCount;const o=n===WWe;if(e===0)return s===-1?r:o&&(s&1)===1?t-r:r;if(n===HWe){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=t||r<0){const a=Math.floor(r/t);r-=t*a,s+=Math.abs(a);const c=this.repetitions-s;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(c===1){const u=e<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)===1)return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=F6,r.endingEnd=F6):(e?r.endingStart=this.zeroSlopeAtStart?F6:D6:r.endingStart=NL,t?r.endingEnd=this.zeroSlopeAtEnd?F6:D6:r.endingEnd=NL)}_scheduleFading(e,t,n){const r=this._mixer,s=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,c=o.sampleValues;return a[0]=s,c[0]=t,a[1]=s+e,c[1]=n,this}}const rYe=new Float32Array(1);class iYe extends e0{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,c=n.uuid,u=this._bindingsByRootAndName;let f=u[c];f===void 0&&(f={},u[c]=f);for(let m=0;m!==s;++m){const v=r[m],x=v.name;let T=f[x];if(T!==void 0)++T.referenceCount,o[m]=T;else{if(T=o[m],T!==void 0){T._cacheIndex===null&&(++T.referenceCount,this._addInactiveBinding(T,c,x));continue}const P=t&&t._propertyBindings[m].binding.parsedPath;T=new WXe(Ai.create(n,x,P),v.ValueTypeName,v.getValueSize()),++T.referenceCount,this._addInactiveBinding(T,c,x),o[m]=T}a[m].resultBuffer=T.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,n)}const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,s=this._actionsByClip;let o=s[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],c=a.knownActions,u=c[c.length-1],f=e._byClipCacheIndex;u._byClipCacheIndex=f,c[f]=u,c.pop(),e._byClipCacheIndex=null;const m=a.actionByRoot,v=(e._localRoot||this._root).uuid;delete m[v],c.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[t];o===void 0&&(o={},r[t]=o),o[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,s=n.path,o=this._bindingsByRootAndName,a=o[r],c=t[t.length-1],u=e._cacheIndex;c._cacheIndex=u,t[u]=c,t.pop(),delete a[s],Object.keys(a).length===0&&delete o[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new bAe(new Float32Array(2),new Float32Array(2),1,rYe),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=n,t[n]=s}clipAction(e,t,n){const r=t||this._root,s=r.uuid;let o=typeof e=="string"?Bee.findByName(r,e):e;const a=o!==null?o.uuid:e,c=this._actionsByClip[a];let u=null;if(n===void 0&&(o!==null?n=o.blendMode:n=Jne),c!==void 0){const m=c.actionByRoot[s];if(m!==void 0&&m.blendMode===n)return m;u=c.knownActions[0],o===null&&(o=u._clip)}if(o===null)return null;const f=new nYe(this,o,t,n);return this._bindAction(f,u),this._addInactiveAction(f,a,s),f}existingAction(e,t){const n=t||this._root,r=n.uuid,s=typeof e=="string"?Bee.findByName(n,e):e,o=s?s.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let u=0;u!==n;++u)t[u]._update(r,e,s,o);const a=this._bindings,c=this._nActiveBindings;for(let u=0;u!==c;++u)a[u].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,s=r[n];if(s!==void 0){const o=s.knownActions;for(let a=0,c=o.length;a!==c;++a){const u=o[a];this._deactivateAction(u);const f=u._cacheIndex,m=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,m._cacheIndex=f,t[f]=m,t.pop(),this._removeInactiveBindingsForAction(u)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const a=n[o].actionByRoot,c=a[t];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}const r=this._bindingsByRootAndName,s=r[t];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}let uo=class PAe{constructor(e){this.value=e}clone(){return new PAe(this.value.clone===void 0?this.value:this.value.clone())}},sYe=class extends oAe{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}};const T7e=new Vn;class OL{constructor(e,t,n=0,r=1/0){this.ray=new yx(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new ure,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return T7e.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(T7e),this}intersectObject(e,t=!0,n=[]){return Uee(e,this,n,t),n.sort(E7e),n}intersectObjects(e,t=!0,n=[]){for(let r=0,s=e.length;r<s;r++)Uee(e[r],this,n,t);return n.sort(E7e),n}}function E7e(i,e){return i.distance-e.distance}function Uee(i,e,t,n){let r=!0;if(i.layers.test(e.layers)&&i.raycast(e,t)===!1&&(r=!1),r===!0&&n===!0){const s=i.children;for(let o=0,a=s.length;o<a;o++)Uee(s[o],e,t,!0)}}class zee{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=ei(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(ei(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}let NAe=class IAe{constructor(e,t,n,r){IAe.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,r){const s=this.elements;return s[0]=e,s[2]=t,s[1]=n,s[3]=r,this}};const M7e=new be;class oYe extends gi{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Xi,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,c=32;o<c;o++,a++){const u=o/c*Math.PI*2,f=a/c*Math.PI*2;r.push(Math.cos(u),Math.sin(u),1,Math.cos(f),Math.sin(f),1)}n.setAttribute("position",new br(r,3));const s=new su({fog:!1,toneMapped:!1});this.cone=new cC(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),M7e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(M7e),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Xg=new be,hO=new Vn,lZ=new Vn;class aYe extends cC{constructor(e){const t=kAe(e),n=new Xi,r=[],s=[],o=new yn(0,0,1),a=new yn(0,1,0);for(let u=0;u<t.length;u++){const f=t[u];f.parent&&f.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(o.r,o.g,o.b),s.push(a.r,a.g,a.b))}n.setAttribute("position",new br(r,3)),n.setAttribute("color",new br(s,3));const c=new su({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,c),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");lZ.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<t.length;s++){const a=t[s];a.parent&&a.parent.isBone&&(hO.multiplyMatrices(lZ,a.matrixWorld),Xg.setFromMatrixPosition(hO),r.setXYZ(o,Xg.x,Xg.y,Xg.z),hO.multiplyMatrices(lZ,a.parent.matrixWorld),Xg.setFromMatrixPosition(hO),r.setXYZ(o+1,Xg.x,Xg.y,Xg.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function kAe(i){const e=[];i.isBone===!0&&e.push(i);for(let t=0;t<i.children.length;t++)e.push(...kAe(i.children[t]));return e}class lYe extends dn{constructor(e,t,n){const r=new G2(t,4,2),s=new Ea({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const cYe=new be,C7e=new yn,A7e=new yn;class uYe extends gi{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new Xy(t);r.rotateY(Math.PI*.5),this.material=new Ea({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),o=new Float32Array(s.count*3);r.setAttribute("color",new Ra(o,3)),this.add(new dn(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");C7e.copy(this.light.color),A7e.copy(this.light.groundColor);for(let n=0,r=t.count;n<r;n++){const s=n<r/2?C7e:A7e;t.setXYZ(n,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(cYe.setFromMatrixPosition(this.light.matrixWorld).negate())}}const R7e=new be,dO=new be,P7e=new be;class hYe extends gi{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new Xi;r.setAttribute("position",new br([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new su({fog:!1,toneMapped:!1});this.lightPlane=new rc(r,s),this.add(this.lightPlane),r=new Xi,r.setAttribute("position",new br([0,0,0,0,0,1],3)),this.targetLine=new rc(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),R7e.setFromMatrixPosition(this.light.matrixWorld),dO.setFromMatrixPosition(this.light.target.matrixWorld),P7e.subVectors(dO,R7e),this.lightPlane.lookAt(dO),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(dO),this.targetLine.scale.z=P7e.length()}}const fO=new be,To=new aC;class dYe extends cC{constructor(e){const t=new Xi,n=new su({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(T,P){c(T),c(P)}function c(T){r.push(0,0,0),s.push(0,0,0),o[T]===void 0&&(o[T]=[]),o[T].push(r.length/3-1)}t.setAttribute("position",new br(r,3)),t.setAttribute("color",new br(s,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const u=new yn(16755200),f=new yn(16711680),m=new yn(43775),v=new yn(16777215),x=new yn(3355443);this.setColors(u,f,m,v,x)}setColors(e,t,n,r,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,r=1;To.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const s=this.camera.coordinateSystem===jl?-1:0;Fo("c",t,e,To,0,0,s),Fo("t",t,e,To,0,0,1),Fo("n1",t,e,To,-1,-1,s),Fo("n2",t,e,To,n,-1,s),Fo("n3",t,e,To,-1,r,s),Fo("n4",t,e,To,n,r,s),Fo("f1",t,e,To,-1,-1,1),Fo("f2",t,e,To,n,-1,1),Fo("f3",t,e,To,-1,r,1),Fo("f4",t,e,To,n,r,1),Fo("u1",t,e,To,n*.7,r*1.1,s),Fo("u2",t,e,To,-1*.7,r*1.1,s),Fo("u3",t,e,To,0,r*2,s),Fo("cf1",t,e,To,-1,0,1),Fo("cf2",t,e,To,n,0,1),Fo("cf3",t,e,To,0,-1,1),Fo("cf4",t,e,To,0,r,1),Fo("cn1",t,e,To,-1,0,s),Fo("cn2",t,e,To,n,0,s),Fo("cn3",t,e,To,0,-1,s),Fo("cn4",t,e,To,0,r,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Fo(i,e,t,n,r,s,o){fO.set(r,s,o).unproject(n);const a=e[i];if(a!==void 0){const c=t.getAttribute("position");for(let u=0,f=a.length;u<f;u++)c.setXYZ(a[u],fO.x,fO.y,fO.z)}}class fYe extends cC{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Xi;r.setAttribute("position",new br(t,3)),r.setAttribute("color",new br(n,3));const s=new su({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(e,t,n){const r=new yn,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(n),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class DAe extends e0{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function N7e(i,e,t,n){const r=pYe(n);switch(t){case Zne:return i*e;case sC:return i*e/r.components*r.byteLength;case px:return i*e/r.components*r.byteLength;case E1:return i*e*2/r.components*r.byteLength;case mx:return i*e*2/r.components*r.byteLength;case iC:return i*e*3/r.components*r.byteLength;case xs:return i*e*4/r.components*r.byteLength;case gx:return i*e*4/r.components*r.byteLength;case n4:case D2:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case F2:case O2:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case yM:case _M:return Math.max(i,16)*Math.max(e,8)/4;case gM:case vM:return Math.max(i,8)*Math.max(e,8)/2;case xM:case C_:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case A_:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case R_:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case P_:return Math.floor((i+4)/5)*Math.floor((e+3)/4)*16;case N_:return Math.floor((i+4)/5)*Math.floor((e+4)/5)*16;case I_:return Math.floor((i+5)/6)*Math.floor((e+4)/5)*16;case k_:return Math.floor((i+5)/6)*Math.floor((e+5)/6)*16;case D_:return Math.floor((i+7)/8)*Math.floor((e+4)/5)*16;case F_:return Math.floor((i+7)/8)*Math.floor((e+5)/6)*16;case O_:return Math.floor((i+7)/8)*Math.floor((e+7)/8)*16;case B_:return Math.floor((i+9)/10)*Math.floor((e+4)/5)*16;case L_:return Math.floor((i+9)/10)*Math.floor((e+5)/6)*16;case U_:return Math.floor((i+9)/10)*Math.floor((e+7)/8)*16;case z_:return Math.floor((i+9)/10)*Math.floor((e+9)/10)*16;case V_:return Math.floor((i+11)/12)*Math.floor((e+9)/10)*16;case G_:return Math.floor((i+11)/12)*Math.floor((e+11)/12)*16;case r4:case Cee:case Aee:return Math.ceil(i/4)*Math.ceil(e/4)*16;case Qne:case bM:return Math.ceil(i/4)*Math.ceil(e/4)*8;case SM:case wM:return Math.ceil(i/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function pYe(i){switch(i){case ps:case e4:return{byteLength:1,components:1};case _d:case t4:case Aa:return{byteLength:2,components:1};case LU:case UU:return{byteLength:2,components:4};case fs:case qa:case Ys:return{byteLength:4,components:1};case zU:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${i}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:fx}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=fx);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function FAe(){let i=null,e=!1,t=null,n=null;function r(s,o){t(s,o),n=i.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(r),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){i=s}}}function mYe(i){const e=new WeakMap;function t(a,c){const u=a.array,f=a.usage,m=u.byteLength,v=i.createBuffer();i.bindBuffer(c,v),i.bufferData(c,u,f),a.onUploadCallback();let x;if(u instanceof Float32Array)x=i.FLOAT;else if(u instanceof Uint16Array)a.isFloat16BufferAttribute?x=i.HALF_FLOAT:x=i.UNSIGNED_SHORT;else if(u instanceof Int16Array)x=i.SHORT;else if(u instanceof Uint32Array)x=i.UNSIGNED_INT;else if(u instanceof Int32Array)x=i.INT;else if(u instanceof Int8Array)x=i.BYTE;else if(u instanceof Uint8Array)x=i.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)x=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:v,type:x,bytesPerElement:u.BYTES_PER_ELEMENT,version:a.version,size:m}}function n(a,c,u){const f=c.array,m=c.updateRanges;if(i.bindBuffer(u,a),m.length===0)i.bufferSubData(u,0,f);else{m.sort((x,T)=>x.start-T.start);let v=0;for(let x=1;x<m.length;x++){const T=m[v],P=m[x];P.start<=T.start+T.count+1?T.count=Math.max(T.count,P.start+P.count-T.start):(++v,m[v]=P)}m.length=v+1;for(let x=0,T=m.length;x<T;x++){const P=m[x];i.bufferSubData(u,P.start*f.BYTES_PER_ELEMENT,f,P.start,P.count)}c.clearUpdateRanges()}c.onUploadCallback()}function r(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const c=e.get(a);c&&(i.deleteBuffer(c.buffer),e.delete(a))}function o(a,c){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const f=e.get(a);(!f||f.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const u=e.get(a);if(u===void 0)e.set(a,t(a,c));else if(u.version<a.version){if(u.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(u.buffer,a,c),u.version=a.version}}return{get:r,remove:s,update:o}}var gYe=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,yYe=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,vYe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,_Ye=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,xYe=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,bYe=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,SYe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,wYe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,TYe=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,EYe=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,MYe=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,CYe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,AYe=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,RYe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,PYe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,NYe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,IYe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,kYe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,DYe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,FYe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,OYe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,BYe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,LYe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,UYe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,zYe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,VYe=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,GYe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,$Ye=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,HYe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,jYe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,WYe="gl_FragColor = linearToOutputTexel( gl_FragColor );",qYe=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,XYe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,YYe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,KYe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,ZYe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,QYe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,JYe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,eKe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,tKe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,nKe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,rKe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,iKe=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,sKe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,oKe=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,aKe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lKe=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,cKe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,uKe=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,hKe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,dKe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,fKe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,pKe=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,mKe=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,gKe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,yKe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,vKe=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,_Ke=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,xKe=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,bKe=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,SKe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,wKe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,TKe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,EKe=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,MKe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,CKe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,AKe=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,RKe=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,PKe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,NKe=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,IKe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,kKe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,DKe=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,FKe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,OKe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,BKe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,LKe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,UKe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,zKe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,VKe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,GKe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,$Ke=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,HKe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,jKe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,WKe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,qKe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,XKe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,YKe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,KKe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,ZKe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,QKe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,JKe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,eZe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,tZe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,nZe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,rZe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,iZe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,sZe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,oZe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,aZe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,lZe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,cZe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,uZe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,hZe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,dZe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,fZe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,pZe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const mZe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,gZe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,yZe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,vZe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,_Ze=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,xZe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,bZe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,SZe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,wZe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,TZe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,EZe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,MZe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,CZe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,AZe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,RZe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,PZe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,NZe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,IZe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kZe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,DZe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,FZe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,OZe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,BZe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,LZe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,UZe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,zZe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,VZe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,GZe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$Ze=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,HZe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,jZe=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,WZe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,qZe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,XZe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ii={alphahash_fragment:gYe,alphahash_pars_fragment:yYe,alphamap_fragment:vYe,alphamap_pars_fragment:_Ye,alphatest_fragment:xYe,alphatest_pars_fragment:bYe,aomap_fragment:SYe,aomap_pars_fragment:wYe,batching_pars_vertex:TYe,batching_vertex:EYe,begin_vertex:MYe,beginnormal_vertex:CYe,bsdfs:AYe,iridescence_fragment:RYe,bumpmap_pars_fragment:PYe,clipping_planes_fragment:NYe,clipping_planes_pars_fragment:IYe,clipping_planes_pars_vertex:kYe,clipping_planes_vertex:DYe,color_fragment:FYe,color_pars_fragment:OYe,color_pars_vertex:BYe,color_vertex:LYe,common:UYe,cube_uv_reflection_fragment:zYe,defaultnormal_vertex:VYe,displacementmap_pars_vertex:GYe,displacementmap_vertex:$Ye,emissivemap_fragment:HYe,emissivemap_pars_fragment:jYe,colorspace_fragment:WYe,colorspace_pars_fragment:qYe,envmap_fragment:XYe,envmap_common_pars_fragment:YYe,envmap_pars_fragment:KYe,envmap_pars_vertex:ZYe,envmap_physical_pars_fragment:lKe,envmap_vertex:QYe,fog_vertex:JYe,fog_pars_vertex:eKe,fog_fragment:tKe,fog_pars_fragment:nKe,gradientmap_pars_fragment:rKe,lightmap_pars_fragment:iKe,lights_lambert_fragment:sKe,lights_lambert_pars_fragment:oKe,lights_pars_begin:aKe,lights_toon_fragment:cKe,lights_toon_pars_fragment:uKe,lights_phong_fragment:hKe,lights_phong_pars_fragment:dKe,lights_physical_fragment:fKe,lights_physical_pars_fragment:pKe,lights_fragment_begin:mKe,lights_fragment_maps:gKe,lights_fragment_end:yKe,logdepthbuf_fragment:vKe,logdepthbuf_pars_fragment:_Ke,logdepthbuf_pars_vertex:xKe,logdepthbuf_vertex:bKe,map_fragment:SKe,map_pars_fragment:wKe,map_particle_fragment:TKe,map_particle_pars_fragment:EKe,metalnessmap_fragment:MKe,metalnessmap_pars_fragment:CKe,morphinstance_vertex:AKe,morphcolor_vertex:RKe,morphnormal_vertex:PKe,morphtarget_pars_vertex:NKe,morphtarget_vertex:IKe,normal_fragment_begin:kKe,normal_fragment_maps:DKe,normal_pars_fragment:FKe,normal_pars_vertex:OKe,normal_vertex:BKe,normalmap_pars_fragment:LKe,clearcoat_normal_fragment_begin:UKe,clearcoat_normal_fragment_maps:zKe,clearcoat_pars_fragment:VKe,iridescence_pars_fragment:GKe,opaque_fragment:$Ke,packing:HKe,premultiplied_alpha_fragment:jKe,project_vertex:WKe,dithering_fragment:qKe,dithering_pars_fragment:XKe,roughnessmap_fragment:YKe,roughnessmap_pars_fragment:KKe,shadowmap_pars_fragment:ZKe,shadowmap_pars_vertex:QKe,shadowmap_vertex:JKe,shadowmask_pars_fragment:eZe,skinbase_vertex:tZe,skinning_pars_vertex:nZe,skinning_vertex:rZe,skinnormal_vertex:iZe,specularmap_fragment:sZe,specularmap_pars_fragment:oZe,tonemapping_fragment:aZe,tonemapping_pars_fragment:lZe,transmission_fragment:cZe,transmission_pars_fragment:uZe,uv_pars_fragment:hZe,uv_pars_vertex:dZe,uv_vertex:fZe,worldpos_vertex:pZe,background_vert:mZe,background_frag:gZe,backgroundCube_vert:yZe,backgroundCube_frag:vZe,cube_vert:_Ze,cube_frag:xZe,depth_vert:bZe,depth_frag:SZe,distanceRGBA_vert:wZe,distanceRGBA_frag:TZe,equirect_vert:EZe,equirect_frag:MZe,linedashed_vert:CZe,linedashed_frag:AZe,meshbasic_vert:RZe,meshbasic_frag:PZe,meshlambert_vert:NZe,meshlambert_frag:IZe,meshmatcap_vert:kZe,meshmatcap_frag:DZe,meshnormal_vert:FZe,meshnormal_frag:OZe,meshphong_vert:BZe,meshphong_frag:LZe,meshphysical_vert:UZe,meshphysical_frag:zZe,meshtoon_vert:VZe,meshtoon_frag:GZe,points_vert:$Ze,points_frag:HZe,shadow_vert:jZe,shadow_frag:WZe,sprite_vert:qZe,sprite_frag:XZe},Nn={common:{diffuse:{value:new yn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Or},alphaMap:{value:null},alphaMapTransform:{value:new Or},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Or}},envmap:{envMap:{value:null},envMapRotation:{value:new Or},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Or}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Or}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Or},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Or},normalScale:{value:new mn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Or},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Or}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Or}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Or}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new yn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new yn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Or},alphaTest:{value:0},uvTransform:{value:new Or}},sprite:{diffuse:{value:new yn(16777215)},opacity:{value:1},center:{value:new mn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Or},alphaMap:{value:null},alphaMapTransform:{value:new Or},alphaTest:{value:0}}},Bf={basic:{uniforms:b0([Nn.common,Nn.specularmap,Nn.envmap,Nn.aomap,Nn.lightmap,Nn.fog]),vertexShader:ii.meshbasic_vert,fragmentShader:ii.meshbasic_frag},lambert:{uniforms:b0([Nn.common,Nn.specularmap,Nn.envmap,Nn.aomap,Nn.lightmap,Nn.emissivemap,Nn.bumpmap,Nn.normalmap,Nn.displacementmap,Nn.fog,Nn.lights,{emissive:{value:new yn(0)}}]),vertexShader:ii.meshlambert_vert,fragmentShader:ii.meshlambert_frag},phong:{uniforms:b0([Nn.common,Nn.specularmap,Nn.envmap,Nn.aomap,Nn.lightmap,Nn.emissivemap,Nn.bumpmap,Nn.normalmap,Nn.displacementmap,Nn.fog,Nn.lights,{emissive:{value:new yn(0)},specular:{value:new yn(1118481)},shininess:{value:30}}]),vertexShader:ii.meshphong_vert,fragmentShader:ii.meshphong_frag},standard:{uniforms:b0([Nn.common,Nn.envmap,Nn.aomap,Nn.lightmap,Nn.emissivemap,Nn.bumpmap,Nn.normalmap,Nn.displacementmap,Nn.roughnessmap,Nn.metalnessmap,Nn.fog,Nn.lights,{emissive:{value:new yn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ii.meshphysical_vert,fragmentShader:ii.meshphysical_frag},toon:{uniforms:b0([Nn.common,Nn.aomap,Nn.lightmap,Nn.emissivemap,Nn.bumpmap,Nn.normalmap,Nn.displacementmap,Nn.gradientmap,Nn.fog,Nn.lights,{emissive:{value:new yn(0)}}]),vertexShader:ii.meshtoon_vert,fragmentShader:ii.meshtoon_frag},matcap:{uniforms:b0([Nn.common,Nn.bumpmap,Nn.normalmap,Nn.displacementmap,Nn.fog,{matcap:{value:null}}]),vertexShader:ii.meshmatcap_vert,fragmentShader:ii.meshmatcap_frag},points:{uniforms:b0([Nn.points,Nn.fog]),vertexShader:ii.points_vert,fragmentShader:ii.points_frag},dashed:{uniforms:b0([Nn.common,Nn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ii.linedashed_vert,fragmentShader:ii.linedashed_frag},depth:{uniforms:b0([Nn.common,Nn.displacementmap]),vertexShader:ii.depth_vert,fragmentShader:ii.depth_frag},normal:{uniforms:b0([Nn.common,Nn.bumpmap,Nn.normalmap,Nn.displacementmap,{opacity:{value:1}}]),vertexShader:ii.meshnormal_vert,fragmentShader:ii.meshnormal_frag},sprite:{uniforms:b0([Nn.sprite,Nn.fog]),vertexShader:ii.sprite_vert,fragmentShader:ii.sprite_frag},background:{uniforms:{uvTransform:{value:new Or},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ii.background_vert,fragmentShader:ii.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Or}},vertexShader:ii.backgroundCube_vert,fragmentShader:ii.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ii.cube_vert,fragmentShader:ii.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ii.equirect_vert,fragmentShader:ii.equirect_frag},distanceRGBA:{uniforms:b0([Nn.common,Nn.displacementmap,{referencePosition:{value:new be},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ii.distanceRGBA_vert,fragmentShader:ii.distanceRGBA_frag},shadow:{uniforms:b0([Nn.lights,Nn.fog,{color:{value:new yn(0)},opacity:{value:1}}]),vertexShader:ii.shadow_vert,fragmentShader:ii.shadow_frag}};Bf.physical={uniforms:b0([Bf.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Or},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Or},clearcoatNormalScale:{value:new mn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Or},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Or},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Or},sheen:{value:0},sheenColor:{value:new yn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Or},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Or},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Or},transmissionSamplerSize:{value:new mn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Or},attenuationDistance:{value:0},attenuationColor:{value:new yn(0)},specularColor:{value:new yn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Or},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Or},anisotropyVector:{value:new mn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Or}}]),vertexShader:ii.meshphysical_vert,fragmentShader:ii.meshphysical_frag};const pO={r:0,b:0,g:0},ny=new Mo,YZe=new Vn;function KZe(i,e,t,n,r,s,o){const a=new yn(0);let c=s===!0?0:1,u,f,m=null,v=0,x=null;function T(C){let L=C.isScene===!0?C.background:null;return L&&L.isTexture&&(L=(C.backgroundBlurriness>0?t:e).get(L)),L}function P(C){let L=!1;const Y=T(C);Y===null?M(a,c):Y&&Y.isColor&&(M(Y,1),L=!0);const J=i.xr.getEnvironmentBlendMode();J==="additive"?n.buffers.color.setClear(0,0,0,1,o):J==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(i.autoClear||L)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil))}function R(C,L){const Y=T(L);Y&&(Y.isCubeTexture||Y.mapping===_4)?(f===void 0&&(f=new dn(new Oo(1,1,1),new D0({name:"BackgroundCubeMaterial",uniforms:H_(Bf.backgroundCube.uniforms),vertexShader:Bf.backgroundCube.vertexShader,fragmentShader:Bf.backgroundCube.fragmentShader,side:Ui,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),f.geometry.deleteAttribute("normal"),f.geometry.deleteAttribute("uv"),f.onBeforeRender=function(J,z,ne){this.matrixWorld.copyPosition(ne.matrixWorld)},Object.defineProperty(f.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(f)),ny.copy(L.backgroundRotation),ny.x*=-1,ny.y*=-1,ny.z*=-1,Y.isCubeTexture&&Y.isRenderTargetTexture===!1&&(ny.y*=-1,ny.z*=-1),f.material.uniforms.envMap.value=Y,f.material.uniforms.flipEnvMap.value=Y.isCubeTexture&&Y.isRenderTargetTexture===!1?-1:1,f.material.uniforms.backgroundBlurriness.value=L.backgroundBlurriness,f.material.uniforms.backgroundIntensity.value=L.backgroundIntensity,f.material.uniforms.backgroundRotation.value.setFromMatrix4(YZe.makeRotationFromEuler(ny)),f.material.toneMapped=rr.getTransfer(Y.colorSpace)!==zn,(m!==Y||v!==Y.version||x!==i.toneMapping)&&(f.material.needsUpdate=!0,m=Y,v=Y.version,x=i.toneMapping),f.layers.enableAll(),C.unshift(f,f.geometry,f.material,0,0,null)):Y&&Y.isTexture&&(u===void 0&&(u=new dn(new _x(2,2),new D0({name:"BackgroundMaterial",uniforms:H_(Bf.background.uniforms),vertexShader:Bf.background.vertexShader,fragmentShader:Bf.background.fragmentShader,side:Xl,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(u)),u.material.uniforms.t2D.value=Y,u.material.uniforms.backgroundIntensity.value=L.backgroundIntensity,u.material.toneMapped=rr.getTransfer(Y.colorSpace)!==zn,Y.matrixAutoUpdate===!0&&Y.updateMatrix(),u.material.uniforms.uvTransform.value.copy(Y.matrix),(m!==Y||v!==Y.version||x!==i.toneMapping)&&(u.material.needsUpdate=!0,m=Y,v=Y.version,x=i.toneMapping),u.layers.enableAll(),C.unshift(u,u.geometry,u.material,0,0,null))}function M(C,L){C.getRGB(pO,rAe(i)),n.buffers.color.setClear(pO.r,pO.g,pO.b,L,o)}function O(){f!==void 0&&(f.geometry.dispose(),f.material.dispose(),f=void 0),u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0)}return{getClearColor:function(){return a},setClearColor:function(C,L=1){a.set(C),c=L,M(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(C){c=C,M(a,c)},render:P,addToRenderList:R,dispose:O}}function ZZe(i,e){const t=i.getParameter(i.MAX_VERTEX_ATTRIBS),n={},r=v(null);let s=r,o=!1;function a($,he,Ce,Pe,je){let ge=!1;const Xe=m(Pe,Ce,he);s!==Xe&&(s=Xe,u(s.object)),ge=x($,Pe,Ce,je),ge&&T($,Pe,Ce,je),je!==null&&e.update(je,i.ELEMENT_ARRAY_BUFFER),(ge||o)&&(o=!1,L($,he,Ce,Pe),je!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.get(je).buffer))}function c(){return i.createVertexArray()}function u($){return i.bindVertexArray($)}function f($){return i.deleteVertexArray($)}function m($,he,Ce){const Pe=Ce.wireframe===!0;let je=n[$.id];je===void 0&&(je={},n[$.id]=je);let ge=je[he.id];ge===void 0&&(ge={},je[he.id]=ge);let Xe=ge[Pe];return Xe===void 0&&(Xe=v(c()),ge[Pe]=Xe),Xe}function v($){const he=[],Ce=[],Pe=[];for(let je=0;je<t;je++)he[je]=0,Ce[je]=0,Pe[je]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:he,enabledAttributes:Ce,attributeDivisors:Pe,object:$,attributes:{},index:null}}function x($,he,Ce,Pe){const je=s.attributes,ge=he.attributes;let Xe=0;const Fe=Ce.getAttributes();for(const Ne in Fe)if(Fe[Ne].location>=0){const mt=je[Ne];let Ht=ge[Ne];if(Ht===void 0&&(Ne==="instanceMatrix"&&$.instanceMatrix&&(Ht=$.instanceMatrix),Ne==="instanceColor"&&$.instanceColor&&(Ht=$.instanceColor)),mt===void 0||mt.attribute!==Ht||Ht&&mt.data!==Ht.data)return!0;Xe++}return s.attributesNum!==Xe||s.index!==Pe}function T($,he,Ce,Pe){const je={},ge=he.attributes;let Xe=0;const Fe=Ce.getAttributes();for(const Ne in Fe)if(Fe[Ne].location>=0){let mt=ge[Ne];mt===void 0&&(Ne==="instanceMatrix"&&$.instanceMatrix&&(mt=$.instanceMatrix),Ne==="instanceColor"&&$.instanceColor&&(mt=$.instanceColor));const Ht={};Ht.attribute=mt,mt&&mt.data&&(Ht.data=mt.data),je[Ne]=Ht,Xe++}s.attributes=je,s.attributesNum=Xe,s.index=Pe}function P(){const $=s.newAttributes;for(let he=0,Ce=$.length;he<Ce;he++)$[he]=0}function R($){M($,0)}function M($,he){const Ce=s.newAttributes,Pe=s.enabledAttributes,je=s.attributeDivisors;Ce[$]=1,Pe[$]===0&&(i.enableVertexAttribArray($),Pe[$]=1),je[$]!==he&&(i.vertexAttribDivisor($,he),je[$]=he)}function O(){const $=s.newAttributes,he=s.enabledAttributes;for(let Ce=0,Pe=he.length;Ce<Pe;Ce++)he[Ce]!==$[Ce]&&(i.disableVertexAttribArray(Ce),he[Ce]=0)}function C($,he,Ce,Pe,je,ge,Xe){Xe===!0?i.vertexAttribIPointer($,he,Ce,je,ge):i.vertexAttribPointer($,he,Ce,Pe,je,ge)}function L($,he,Ce,Pe){P();const je=Pe.attributes,ge=Ce.getAttributes(),Xe=he.defaultAttributeValues;for(const Fe in ge){const Ne=ge[Fe];if(Ne.location>=0){let tt=je[Fe];if(tt===void 0&&(Fe==="instanceMatrix"&&$.instanceMatrix&&(tt=$.instanceMatrix),Fe==="instanceColor"&&$.instanceColor&&(tt=$.instanceColor)),tt!==void 0){const mt=tt.normalized,Ht=tt.itemSize,pn=e.get(tt);if(pn===void 0)continue;const In=pn.buffer,vt=pn.type,Ut=pn.bytesPerElement,Sn=vt===i.INT||vt===i.UNSIGNED_INT||tt.gpuType===qa;if(tt.isInterleavedBufferAttribute){const ln=tt.data,Xn=ln.stride,Yr=tt.offset;if(ln.isInstancedInterleavedBuffer){for(let lr=0;lr<Ne.locationSize;lr++)M(Ne.location+lr,ln.meshPerAttribute);$.isInstancedMesh!==!0&&Pe._maxInstanceCount===void 0&&(Pe._maxInstanceCount=ln.meshPerAttribute*ln.count)}else for(let lr=0;lr<Ne.locationSize;lr++)R(Ne.location+lr);i.bindBuffer(i.ARRAY_BUFFER,In);for(let lr=0;lr<Ne.locationSize;lr++)C(Ne.location+lr,Ht/Ne.locationSize,vt,mt,Xn*Ut,(Yr+Ht/Ne.locationSize*lr)*Ut,Sn)}else{if(tt.isInstancedBufferAttribute){for(let ln=0;ln<Ne.locationSize;ln++)M(Ne.location+ln,tt.meshPerAttribute);$.isInstancedMesh!==!0&&Pe._maxInstanceCount===void 0&&(Pe._maxInstanceCount=tt.meshPerAttribute*tt.count)}else for(let ln=0;ln<Ne.locationSize;ln++)R(Ne.location+ln);i.bindBuffer(i.ARRAY_BUFFER,In);for(let ln=0;ln<Ne.locationSize;ln++)C(Ne.location+ln,Ht/Ne.locationSize,vt,mt,Ht*Ut,Ht/Ne.locationSize*ln*Ut,Sn)}}else if(Xe!==void 0){const mt=Xe[Fe];if(mt!==void 0)switch(mt.length){case 2:i.vertexAttrib2fv(Ne.location,mt);break;case 3:i.vertexAttrib3fv(Ne.location,mt);break;case 4:i.vertexAttrib4fv(Ne.location,mt);break;default:i.vertexAttrib1fv(Ne.location,mt)}}}}O()}function Y(){ne();for(const $ in n){const he=n[$];for(const Ce in he){const Pe=he[Ce];for(const je in Pe)f(Pe[je].object),delete Pe[je];delete he[Ce]}delete n[$]}}function J($){if(n[$.id]===void 0)return;const he=n[$.id];for(const Ce in he){const Pe=he[Ce];for(const je in Pe)f(Pe[je].object),delete Pe[je];delete he[Ce]}delete n[$.id]}function z($){for(const he in n){const Ce=n[he];if(Ce[$.id]===void 0)continue;const Pe=Ce[$.id];for(const je in Pe)f(Pe[je].object),delete Pe[je];delete Ce[$.id]}}function ne(){K(),o=!0,s!==r&&(s=r,u(s.object))}function K(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:a,reset:ne,resetDefaultState:K,dispose:Y,releaseStatesOfGeometry:J,releaseStatesOfProgram:z,initAttributes:P,enableAttribute:R,disableUnusedAttributes:O}}function QZe(i,e,t){let n;function r(u){n=u}function s(u,f){i.drawArrays(n,u,f),t.update(f,n,1)}function o(u,f,m){m!==0&&(i.drawArraysInstanced(n,u,f,m),t.update(f,n,m))}function a(u,f,m){if(m===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,u,0,f,0,m);let x=0;for(let T=0;T<m;T++)x+=f[T];t.update(x,n,1)}function c(u,f,m,v){if(m===0)return;const x=e.get("WEBGL_multi_draw");if(x===null)for(let T=0;T<u.length;T++)o(u[T],f[T],v[T]);else{x.multiDrawArraysInstancedWEBGL(n,u,0,f,0,v,0,m);let T=0;for(let P=0;P<m;P++)T+=f[P]*v[P];t.update(T,n,1)}}this.setMode=r,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=c}function JZe(i,e,t,n){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const z=e.get("EXT_texture_filter_anisotropic");r=i.getParameter(z.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(z){return!(z!==xs&&n.convert(z)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(z){const ne=z===Aa&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(z!==ps&&n.convert(z)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)&&z!==Ys&&!ne)}function c(z){if(z==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";z="mediump"}return z==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=t.precision!==void 0?t.precision:"highp";const f=c(u);f!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",f,"instead."),u=f);const m=t.logarithmicDepthBuffer===!0,v=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),x=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),T=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),P=i.getParameter(i.MAX_TEXTURE_SIZE),R=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),M=i.getParameter(i.MAX_VERTEX_ATTRIBS),O=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),C=i.getParameter(i.MAX_VARYING_VECTORS),L=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),Y=T>0,J=i.getParameter(i.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:a,precision:u,logarithmicDepthBuffer:m,reverseDepthBuffer:v,maxTextures:x,maxVertexTextures:T,maxTextureSize:P,maxCubemapSize:R,maxAttributes:M,maxVertexUniforms:O,maxVaryings:C,maxFragmentUniforms:L,vertexTextures:Y,maxSamples:J}}function eQe(i){const e=this;let t=null,n=0,r=!1,s=!1;const o=new Of,a=new Or,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(m,v){const x=m.length!==0||v||n!==0||r;return r=v,n=m.length,x},this.beginShadows=function(){s=!0,f(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(m,v){t=f(m,v,0)},this.setState=function(m,v,x){const T=m.clippingPlanes,P=m.clipIntersection,R=m.clipShadows,M=i.get(m);if(!r||T===null||T.length===0||s&&!R)s?f(null):u();else{const O=s?0:n,C=O*4;let L=M.clippingState||null;c.value=L,L=f(T,v,C,x);for(let Y=0;Y!==C;++Y)L[Y]=t[Y];M.clippingState=L,this.numIntersection=P?this.numPlanes:0,this.numPlanes+=O}};function u(){c.value!==t&&(c.value=t,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function f(m,v,x,T){const P=m!==null?m.length:0;let R=null;if(P!==0){if(R=c.value,T!==!0||R===null){const M=x+P*4,O=v.matrixWorldInverse;a.getNormalMatrix(O),(R===null||R.length<M)&&(R=new Float32Array(M));for(let C=0,L=x;C!==P;++C,L+=4)o.copy(m[C]).applyMatrix4(O,a),o.normal.toArray(R,L),R[L+3]=o.constant}c.value=R,c.needsUpdate=!0}return e.numPlanes=P,e.numIntersection=0,R}}function tQe(i){let e=new WeakMap;function t(o,a){return a===v4?o.mapping=Wf:a===M_&&(o.mapping=qf),o}function n(o){if(o&&o.isTexture){const a=o.mapping;if(a===v4||a===M_)if(e.has(o)){const c=e.get(o).texture;return t(c,o.mapping)}else{const c=o.image;if(c&&c.height>0){const u=new sAe(c.height);return u.fromEquirectangularTexture(i,o),e.set(o,u),o.addEventListener("dispose",r),t(u.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const c=e.get(a);c!==void 0&&(e.delete(a),c.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}const L6=4,I7e=[.125,.215,.35,.446,.526,.582],Dy=20,cZ=new w4,k7e=new yn;let uZ=null,hZ=0,dZ=0,fZ=!1;const wy=(1+Math.sqrt(5))/2,$8=1/wy,D7e=[new be(-wy,$8,0),new be(wy,$8,0),new be(-$8,0,wy),new be($8,0,wy),new be(0,wy,-$8),new be(0,wy,$8),new be(-1,1,-1),new be(1,1,-1),new be(-1,1,1),new be(1,1,1)],nQe=new be;let F7e=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100,s={}){const{size:o=256,position:a=nQe}=s;uZ=this._renderer.getRenderTarget(),hZ=this._renderer.getActiveCubeFace(),dZ=this._renderer.getActiveMipmapLevel(),fZ=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,n,r,c,a),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=L7e(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=B7e(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(uZ,hZ,dZ),this._renderer.xr.enabled=fZ,e.scissorTest=!1,mO(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Wf||e.mapping===qf?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),uZ=this._renderer.getRenderTarget(),hZ=this._renderer.getActiveCubeFace(),dZ=this._renderer.getActiveMipmapLevel(),fZ=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:_s,minFilter:_s,generateMipmaps:!1,type:Aa,format:xs,colorSpace:_l,depthBuffer:!1},r=O7e(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=O7e(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=rQe(s)),this._blurMaterial=iQe(s,e,t)}return r}_compileMaterial(e){const t=new dn(this._lodPlanes[0],e);this._renderer.compile(t,cZ)}_sceneToCubeUV(e,t,n,r,s){const c=new po(90,1,t,n),u=[1,-1,1,1,1,1],f=[1,1,1,-1,-1,-1],m=this._renderer,v=m.autoClear,x=m.toneMapping;m.getClearColor(k7e),m.toneMapping=Yl,m.autoClear=!1;const T=new Ea({name:"PMREM.Background",side:Ui,depthWrite:!1,depthTest:!1}),P=new dn(new Oo,T);let R=!1;const M=e.background;M?M.isColor&&(T.color.copy(M),e.background=null,R=!0):(T.color.copy(k7e),R=!0);for(let O=0;O<6;O++){const C=O%3;C===0?(c.up.set(0,u[O],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x+f[O],s.y,s.z)):C===1?(c.up.set(0,0,u[O]),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y+f[O],s.z)):(c.up.set(0,u[O],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y,s.z+f[O]));const L=this._cubeSize;mO(r,C*L,O>2?L:0,L,L),m.setRenderTarget(r),R&&m.render(P,c),m.render(e,c)}P.geometry.dispose(),P.material.dispose(),m.toneMapping=x,m.autoClear=v,e.background=M}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===Wf||e.mapping===qf;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=L7e()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=B7e());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new dn(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const c=this._cubeSize;mO(t,0,0,3*c,2*c),n.setRenderTarget(t),n.render(o,cZ)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=D7e[(r-s-1)%D7e.length];this._blur(e,s-1,s,o,a)}t.autoClear=n}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,a){const c=this._renderer,u=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const f=3,m=new dn(this._lodPlanes[r],u),v=u.uniforms,x=this._sizeLods[n]-1,T=isFinite(s)?Math.PI/(2*x):2*Math.PI/(2*Dy-1),P=s/T,R=isFinite(s)?1+Math.floor(f*P):Dy;R>Dy&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${R} samples when the maximum is set to ${Dy}`);const M=[];let O=0;for(let z=0;z<Dy;++z){const ne=z/P,K=Math.exp(-ne*ne/2);M.push(K),z===0?O+=K:z<R&&(O+=2*K)}for(let z=0;z<M.length;z++)M[z]=M[z]/O;v.envMap.value=e.texture,v.samples.value=R,v.weights.value=M,v.latitudinal.value=o==="latitudinal",a&&(v.poleAxis.value=a);const{_lodMax:C}=this;v.dTheta.value=T,v.mipInt.value=C-n;const L=this._sizeLods[r],Y=3*L*(r>C-L6?r-C+L6:0),J=4*(this._cubeSize-L);mO(t,Y,J,3*L,2*L),c.setRenderTarget(t),c.render(m,cZ)}};function rQe(i){const e=[],t=[],n=[];let r=i;const s=i-L6+1+I7e.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let c=1/a;o>i-L6?c=I7e[o-i+L6-1]:o===0&&(c=0),n.push(c);const u=1/(a-2),f=-u,m=1+u,v=[f,f,m,f,m,m,f,f,m,m,f,m],x=6,T=6,P=3,R=2,M=1,O=new Float32Array(P*T*x),C=new Float32Array(R*T*x),L=new Float32Array(M*T*x);for(let J=0;J<x;J++){const z=J%3*2/3-1,ne=J>2?0:-1,K=[z,ne,0,z+2/3,ne,0,z+2/3,ne+1,0,z,ne,0,z+2/3,ne+1,0,z,ne+1,0];O.set(K,P*T*J),C.set(v,R*T*J);const $=[J,J,J,J,J,J];L.set($,M*T*J)}const Y=new Xi;Y.setAttribute("position",new Ra(O,P)),Y.setAttribute("uv",new Ra(C,R)),Y.setAttribute("faceIndex",new Ra(L,M)),e.push(Y),r>L6&&r--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function O7e(i,e,t){const n=new yc(i,e,t);return n.texture.mapping=_4,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function mO(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function iQe(i,e,t){const n=new Float32Array(Dy),r=new be(0,1,0);return new D0({name:"SphericalGaussianBlur",defines:{n:Dy,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Tre(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:vl,depthTest:!1,depthWrite:!1})}function B7e(){return new D0({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Tre(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:vl,depthTest:!1,depthWrite:!1})}function L7e(){return new D0({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Tre(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:vl,depthTest:!1,depthWrite:!1})}function Tre(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function sQe(i){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const c=a.mapping,u=c===v4||c===M_,f=c===Wf||c===qf;if(u||f){let m=e.get(a);const v=m!==void 0?m.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==v)return t===null&&(t=new F7e(i)),m=u?t.fromEquirectangular(a,m):t.fromCubemap(a,m),m.texture.pmremVersion=a.pmremVersion,e.set(a,m),m.texture;if(m!==void 0)return m.texture;{const x=a.image;return u&&x&&x.height>0||f&&x&&r(x)?(t===null&&(t=new F7e(i)),m=u?t.fromEquirectangular(a):t.fromCubemap(a),m.texture.pmremVersion=a.pmremVersion,e.set(a,m),a.addEventListener("dispose",s),m.texture):null}}}return a}function r(a){let c=0;const u=6;for(let f=0;f<u;f++)a[f]!==void 0&&c++;return c===u}function s(a){const c=a.target;c.removeEventListener("dispose",s);const u=e.get(c);u!==void 0&&(e.delete(c),u.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function oQe(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=i.getExtension(n)}return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const r=t(n);return r===null&&Qc("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function aQe(i,e,t,n){const r={},s=new WeakMap;function o(m){const v=m.target;v.index!==null&&e.remove(v.index);for(const T in v.attributes)e.remove(v.attributes[T]);v.removeEventListener("dispose",o),delete r[v.id];const x=s.get(v);x&&(e.remove(x),s.delete(v)),n.releaseStatesOfGeometry(v),v.isInstancedBufferGeometry===!0&&delete v._maxInstanceCount,t.memory.geometries--}function a(m,v){return r[v.id]===!0||(v.addEventListener("dispose",o),r[v.id]=!0,t.memory.geometries++),v}function c(m){const v=m.attributes;for(const x in v)e.update(v[x],i.ARRAY_BUFFER)}function u(m){const v=[],x=m.index,T=m.attributes.position;let P=0;if(x!==null){const O=x.array;P=x.version;for(let C=0,L=O.length;C<L;C+=3){const Y=O[C+0],J=O[C+1],z=O[C+2];v.push(Y,J,J,z,z,Y)}}else if(T!==void 0){const O=T.array;P=T.version;for(let C=0,L=O.length/3-1;C<L;C+=3){const Y=C+0,J=C+1,z=C+2;v.push(Y,J,J,z,z,Y)}}else return;const R=new(are(v)?hre:$U)(v,1);R.version=P;const M=s.get(m);M&&e.remove(M),s.set(m,R)}function f(m){const v=s.get(m);if(v){const x=m.index;x!==null&&v.version<x.version&&u(m)}else u(m);return s.get(m)}return{get:a,update:c,getWireframeAttribute:f}}function lQe(i,e,t){let n;function r(v){n=v}let s,o;function a(v){s=v.type,o=v.bytesPerElement}function c(v,x){i.drawElements(n,x,s,v*o),t.update(x,n,1)}function u(v,x,T){T!==0&&(i.drawElementsInstanced(n,x,s,v*o,T),t.update(x,n,T))}function f(v,x,T){if(T===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,x,0,s,v,0,T);let R=0;for(let M=0;M<T;M++)R+=x[M];t.update(R,n,1)}function m(v,x,T,P){if(T===0)return;const R=e.get("WEBGL_multi_draw");if(R===null)for(let M=0;M<v.length;M++)u(v[M]/o,x[M],P[M]);else{R.multiDrawElementsInstancedWEBGL(n,x,0,s,v,0,P,0,T);let M=0;for(let O=0;O<T;O++)M+=x[O]*P[O];t.update(M,n,1)}}this.setMode=r,this.setIndex=a,this.render=c,this.renderInstances=u,this.renderMultiDraw=f,this.renderMultiDrawInstances=m}function cQe(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(t.calls++,o){case i.TRIANGLES:t.triangles+=a*(s/3);break;case i.LINES:t.lines+=a*(s/2);break;case i.LINE_STRIP:t.lines+=a*(s-1);break;case i.LINE_LOOP:t.lines+=a*s;break;case i.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:n}}function uQe(i,e,t){const n=new WeakMap,r=new ir;function s(o,a,c){const u=o.morphTargetInfluences,f=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,m=f!==void 0?f.length:0;let v=n.get(a);if(v===void 0||v.count!==m){let $=function(){ne.dispose(),n.delete(a),a.removeEventListener("dispose",$)};var x=$;v!==void 0&&v.texture.dispose();const T=a.morphAttributes.position!==void 0,P=a.morphAttributes.normal!==void 0,R=a.morphAttributes.color!==void 0,M=a.morphAttributes.position||[],O=a.morphAttributes.normal||[],C=a.morphAttributes.color||[];let L=0;T===!0&&(L=1),P===!0&&(L=2),R===!0&&(L=3);let Y=a.attributes.position.count*L,J=1;Y>e.maxTextureSize&&(J=Math.ceil(Y/e.maxTextureSize),Y=e.maxTextureSize);const z=new Float32Array(Y*J*4*m),ne=new cre(z,Y,J,m);ne.type=Ys,ne.needsUpdate=!0;const K=L*4;for(let he=0;he<m;he++){const Ce=M[he],Pe=O[he],je=C[he],ge=Y*J*4*he;for(let Xe=0;Xe<Ce.count;Xe++){const Fe=Xe*K;T===!0&&(r.fromBufferAttribute(Ce,Xe),z[ge+Fe+0]=r.x,z[ge+Fe+1]=r.y,z[ge+Fe+2]=r.z,z[ge+Fe+3]=0),P===!0&&(r.fromBufferAttribute(Pe,Xe),z[ge+Fe+4]=r.x,z[ge+Fe+5]=r.y,z[ge+Fe+6]=r.z,z[ge+Fe+7]=0),R===!0&&(r.fromBufferAttribute(je,Xe),z[ge+Fe+8]=r.x,z[ge+Fe+9]=r.y,z[ge+Fe+10]=r.z,z[ge+Fe+11]=je.itemSize===4?r.w:1)}}v={count:m,texture:ne,size:new mn(Y,J)},n.set(a,v),a.addEventListener("dispose",$)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(i,"morphTexture",o.morphTexture,t);else{let T=0;for(let R=0;R<u.length;R++)T+=u[R];const P=a.morphTargetsRelative?1:1-T;c.getUniforms().setValue(i,"morphTargetBaseInfluence",P),c.getUniforms().setValue(i,"morphTargetInfluences",u)}c.getUniforms().setValue(i,"morphTargetsTexture",v.texture,t),c.getUniforms().setValue(i,"morphTargetsTextureSize",v.size)}return{update:s}}function hQe(i,e,t,n){let r=new WeakMap;function s(c){const u=n.render.frame,f=c.geometry,m=e.get(c,f);if(r.get(m)!==u&&(e.update(m),r.set(m,u)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),r.get(c)!==u&&(t.update(c.instanceMatrix,i.ARRAY_BUFFER),c.instanceColor!==null&&t.update(c.instanceColor,i.ARRAY_BUFFER),r.set(c,u))),c.isSkinnedMesh){const v=c.skeleton;r.get(v)!==u&&(v.update(),r.set(v,u))}return m}function o(){r=new WeakMap}function a(c){const u=c.target;u.removeEventListener("dispose",a),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:s,dispose:o}}const OAe=new Ao,U7e=new Jc(1,1),BAe=new cre,LAe=new Iqe,UAe=new vx,z7e=[],V7e=[],G7e=new Float32Array(16),$7e=new Float32Array(9),H7e=new Float32Array(4);function wx(i,e,t){const n=i[0];if(n<=0||n>0)return i;const r=e*t;let s=z7e[r];if(s===void 0&&(s=new Float32Array(r),z7e[r]=s),e!==0){n.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,i[o].toArray(s,a)}return s}function Na(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function Ia(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function XU(i,e){let t=V7e[e];t===void 0&&(t=new Int32Array(e),V7e[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function dQe(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function fQe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Na(t,e))return;i.uniform2fv(this.addr,e),Ia(t,e)}}function pQe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Na(t,e))return;i.uniform3fv(this.addr,e),Ia(t,e)}}function mQe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Na(t,e))return;i.uniform4fv(this.addr,e),Ia(t,e)}}function gQe(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Na(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),Ia(t,e)}else{if(Na(t,n))return;H7e.set(n),i.uniformMatrix2fv(this.addr,!1,H7e),Ia(t,n)}}function yQe(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Na(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),Ia(t,e)}else{if(Na(t,n))return;$7e.set(n),i.uniformMatrix3fv(this.addr,!1,$7e),Ia(t,n)}}function vQe(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Na(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),Ia(t,e)}else{if(Na(t,n))return;G7e.set(n),i.uniformMatrix4fv(this.addr,!1,G7e),Ia(t,n)}}function _Qe(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function xQe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Na(t,e))return;i.uniform2iv(this.addr,e),Ia(t,e)}}function bQe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Na(t,e))return;i.uniform3iv(this.addr,e),Ia(t,e)}}function SQe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Na(t,e))return;i.uniform4iv(this.addr,e),Ia(t,e)}}function wQe(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function TQe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Na(t,e))return;i.uniform2uiv(this.addr,e),Ia(t,e)}}function EQe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Na(t,e))return;i.uniform3uiv(this.addr,e),Ia(t,e)}}function MQe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Na(t,e))return;i.uniform4uiv(this.addr,e),Ia(t,e)}}function CQe(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r);let s;this.type===i.SAMPLER_2D_SHADOW?(U7e.compareFunction=GU,s=U7e):s=OAe,t.setTexture2D(e||s,r)}function AQe(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||LAe,r)}function RQe(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTextureCube(e||UAe,r)}function PQe(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||BAe,r)}function NQe(i){switch(i){case 5126:return dQe;case 35664:return fQe;case 35665:return pQe;case 35666:return mQe;case 35674:return gQe;case 35675:return yQe;case 35676:return vQe;case 5124:case 35670:return _Qe;case 35667:case 35671:return xQe;case 35668:case 35672:return bQe;case 35669:case 35673:return SQe;case 5125:return wQe;case 36294:return TQe;case 36295:return EQe;case 36296:return MQe;case 35678:case 36198:case 36298:case 36306:case 35682:return CQe;case 35679:case 36299:case 36307:return AQe;case 35680:case 36300:case 36308:case 36293:return RQe;case 36289:case 36303:case 36311:case 36292:return PQe}}function IQe(i,e){i.uniform1fv(this.addr,e)}function kQe(i,e){const t=wx(e,this.size,2);i.uniform2fv(this.addr,t)}function DQe(i,e){const t=wx(e,this.size,3);i.uniform3fv(this.addr,t)}function FQe(i,e){const t=wx(e,this.size,4);i.uniform4fv(this.addr,t)}function OQe(i,e){const t=wx(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function BQe(i,e){const t=wx(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function LQe(i,e){const t=wx(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function UQe(i,e){i.uniform1iv(this.addr,e)}function zQe(i,e){i.uniform2iv(this.addr,e)}function VQe(i,e){i.uniform3iv(this.addr,e)}function GQe(i,e){i.uniform4iv(this.addr,e)}function $Qe(i,e){i.uniform1uiv(this.addr,e)}function HQe(i,e){i.uniform2uiv(this.addr,e)}function jQe(i,e){i.uniform3uiv(this.addr,e)}function WQe(i,e){i.uniform4uiv(this.addr,e)}function qQe(i,e,t){const n=this.cache,r=e.length,s=XU(t,r);Na(n,s)||(i.uniform1iv(this.addr,s),Ia(n,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||OAe,s[o])}function XQe(i,e,t){const n=this.cache,r=e.length,s=XU(t,r);Na(n,s)||(i.uniform1iv(this.addr,s),Ia(n,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||LAe,s[o])}function YQe(i,e,t){const n=this.cache,r=e.length,s=XU(t,r);Na(n,s)||(i.uniform1iv(this.addr,s),Ia(n,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||UAe,s[o])}function KQe(i,e,t){const n=this.cache,r=e.length,s=XU(t,r);Na(n,s)||(i.uniform1iv(this.addr,s),Ia(n,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||BAe,s[o])}function ZQe(i){switch(i){case 5126:return IQe;case 35664:return kQe;case 35665:return DQe;case 35666:return FQe;case 35674:return OQe;case 35675:return BQe;case 35676:return LQe;case 5124:case 35670:return UQe;case 35667:case 35671:return zQe;case 35668:case 35672:return VQe;case 35669:case 35673:return GQe;case 5125:return $Qe;case 36294:return HQe;case 36295:return jQe;case 36296:return WQe;case 35678:case 36198:case 36298:case 36306:case 35682:return qQe;case 35679:case 36299:case 36307:return XQe;case 35680:case 36300:case 36308:case 36293:return YQe;case 36289:case 36303:case 36311:case 36292:return KQe}}class QQe{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=NQe(t.type)}}class JQe{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=ZQe(t.type)}}class eJe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],n)}}}const pZ=/(\w+)(\])?(\[|\.)?/g;function j7e(i,e){i.seq.push(e),i.map[e.id]=e}function tJe(i,e,t){const n=i.name,r=n.length;for(pZ.lastIndex=0;;){const s=pZ.exec(n),o=pZ.lastIndex;let a=s[1];const c=s[2]==="]",u=s[3];if(c&&(a=a|0),u===void 0||u==="["&&o+2===r){j7e(t,u===void 0?new QQe(a,i,e):new JQe(a,i,e));break}else{let m=t.map[a];m===void 0&&(m=new eJe(a),j7e(t,m)),t=m}}}class UB{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const s=e.getActiveUniform(t,r),o=e.getUniformLocation(t,s.name);tJe(s,o,this)}}setValue(e,t,n,r){const s=this.map[t];s!==void 0&&s.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],c=n[a.id];c.needsUpdate!==!1&&a.setValue(e,c.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&n.push(o)}return n}}function W7e(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const nJe=37297;let rJe=0;function iJe(i,e){const t=i.split(`
`),n=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;n.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return n.join(`
`)}const q7e=new Or;function sJe(i){rr._getMatrix(q7e,rr.workingColorSpace,i);const e=`mat3( ${q7e.elements.map(t=>t.toFixed(4))} )`;switch(rr.getTransfer(i)){case $_:return[e,"LinearTransferOETF"];case zn:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",i),[e,"LinearTransferOETF"]}}function X7e(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),r=i.getShaderInfoLog(e).trim();if(n&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+iJe(i.getShaderSource(e),o)}else return r}function oJe(i,e){const t=sJe(e);return[`vec4 ${i}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function aJe(i,e){let t;switch(e){case Hne:t="Linear";break;case jne:t="Reinhard";break;case Wne:t="Cineon";break;case qne:t="ACESFilmic";break;case Xne:t="AgX";break;case Yne:t="Neutral";break;case jCe:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const gO=new be;function lJe(){rr.getLuminanceCoefficients(gO);const i=gO.x.toFixed(4),e=gO.y.toFixed(4),t=gO.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${i}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function cJe(i){return[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",i.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(iE).join(`
`)}function uJe(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function hJe(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const s=i.getActiveAttrib(e,r),o=s.name;let a=1;s.type===i.FLOAT_MAT2&&(a=2),s.type===i.FLOAT_MAT3&&(a=3),s.type===i.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:i.getAttribLocation(e,o),locationSize:a}}return t}function iE(i){return i!==""}function Y7e(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function K7e(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const dJe=/^[ \t]*#include +<([\w\d./]+)>/gm;function Vee(i){return i.replace(dJe,pJe)}const fJe=new Map;function pJe(i,e){let t=ii[e];if(t===void 0){const n=fJe.get(e);if(n!==void 0)t=ii[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return Vee(t)}const mJe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Z7e(i){return i.replace(mJe,gJe)}function gJe(i,e,t,n){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function Q7e(i){let e=`precision ${i.precision} float;
	precision ${i.precision} int;
	precision ${i.precision} sampler2D;
	precision ${i.precision} samplerCube;
	precision ${i.precision} sampler3D;
	precision ${i.precision} sampler2DArray;
	precision ${i.precision} sampler2DShadow;
	precision ${i.precision} samplerCubeShadow;
	precision ${i.precision} sampler2DArrayShadow;
	precision ${i.precision} isampler2D;
	precision ${i.precision} isampler3D;
	precision ${i.precision} isamplerCube;
	precision ${i.precision} isampler2DArray;
	precision ${i.precision} usampler2D;
	precision ${i.precision} usampler3D;
	precision ${i.precision} usamplerCube;
	precision ${i.precision} usampler2DArray;
	`;return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function yJe(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===Bne?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===VWe?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===jc&&(e="SHADOWMAP_TYPE_VSM"),e}function vJe(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case Wf:case qf:e="ENVMAP_TYPE_CUBE";break;case _4:e="ENVMAP_TYPE_CUBE_UV";break}return e}function _Je(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case qf:e="ENVMAP_MODE_REFRACTION";break}return e}function xJe(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case rC:e="ENVMAP_BLENDING_MULTIPLY";break;case $Ce:e="ENVMAP_BLENDING_MIX";break;case HCe:e="ENVMAP_BLENDING_ADD";break}return e}function bJe(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function SJe(i,e,t,n){const r=i.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const c=yJe(t),u=vJe(t),f=_Je(t),m=xJe(t),v=bJe(t),x=cJe(t),T=uJe(s),P=r.createProgram();let R,M,O=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(R=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,T].filter(iE).join(`
`),R.length>0&&(R+=`
`),M=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,T].filter(iE).join(`
`),M.length>0&&(M+=`
`)):(R=[Q7e(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,T,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+f:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(iE).join(`
`),M=[Q7e(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,T,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+f:"",t.envMap?"#define "+m:"",v?"#define CUBEUV_TEXEL_WIDTH "+v.texelWidth:"",v?"#define CUBEUV_TEXEL_HEIGHT "+v.texelHeight:"",v?"#define CUBEUV_MAX_MIP "+v.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Yl?"#define TONE_MAPPING":"",t.toneMapping!==Yl?ii.tonemapping_pars_fragment:"",t.toneMapping!==Yl?aJe("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ii.colorspace_pars_fragment,oJe("linearToOutputTexel",t.outputColorSpace),lJe(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(iE).join(`
`)),o=Vee(o),o=Y7e(o,t),o=K7e(o,t),a=Vee(a),a=Y7e(a,t),a=K7e(a,t),o=Z7e(o),a=Z7e(a),t.isRawShaderMaterial!==!0&&(O=`#version 300 es
`,R=[x,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+R,M=["#define varying in",t.glslVersion===Nee?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Nee?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+M);const C=O+R+o,L=O+M+a,Y=W7e(r,r.VERTEX_SHADER,C),J=W7e(r,r.FRAGMENT_SHADER,L);r.attachShader(P,Y),r.attachShader(P,J),t.index0AttributeName!==void 0?r.bindAttribLocation(P,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(P,0,"position"),r.linkProgram(P);function z(he){if(i.debug.checkShaderErrors){const Ce=r.getProgramInfoLog(P).trim(),Pe=r.getShaderInfoLog(Y).trim(),je=r.getShaderInfoLog(J).trim();let ge=!0,Xe=!0;if(r.getProgramParameter(P,r.LINK_STATUS)===!1)if(ge=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(r,P,Y,J);else{const Fe=X7e(r,Y,"vertex"),Ne=X7e(r,J,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(P,r.VALIDATE_STATUS)+`

Material Name: `+he.name+`
Material Type: `+he.type+`

Program Info Log: `+Ce+`
`+Fe+`
`+Ne)}else Ce!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Ce):(Pe===""||je==="")&&(Xe=!1);Xe&&(he.diagnostics={runnable:ge,programLog:Ce,vertexShader:{log:Pe,prefix:R},fragmentShader:{log:je,prefix:M}})}r.deleteShader(Y),r.deleteShader(J),ne=new UB(r,P),K=hJe(r,P)}let ne;this.getUniforms=function(){return ne===void 0&&z(this),ne};let K;this.getAttributes=function(){return K===void 0&&z(this),K};let $=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return $===!1&&($=r.getProgramParameter(P,nJe)),$},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(P),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=rJe++,this.cacheKey=e,this.usedTimes=1,this.program=P,this.vertexShader=Y,this.fragmentShader=J,this}let wJe=0;class TJe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new EJe(e),t.set(e,n)),n}}class EJe{constructor(e){this.id=wJe++,this.code=e,this.usedTimes=0}}function MJe(i,e,t,n,r,s,o){const a=new ure,c=new TJe,u=new Set,f=[],m=r.logarithmicDepthBuffer,v=r.vertexTextures;let x=r.precision;const T={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function P(K){return u.add(K),K===0?"uv":`uv${K}`}function R(K,$,he,Ce,Pe){const je=Ce.fog,ge=Pe.geometry,Xe=K.isMeshStandardMaterial?Ce.environment:null,Fe=(K.isMeshStandardMaterial?t:e).get(K.envMap||Xe),Ne=Fe&&Fe.mapping===_4?Fe.image.height:null,tt=T[K.type];K.precision!==null&&(x=r.getMaxPrecision(K.precision),x!==K.precision&&console.warn("THREE.WebGLProgram.getParameters:",K.precision,"not supported, using",x,"instead."));const mt=ge.morphAttributes.position||ge.morphAttributes.normal||ge.morphAttributes.color,Ht=mt!==void 0?mt.length:0;let pn=0;ge.morphAttributes.position!==void 0&&(pn=1),ge.morphAttributes.normal!==void 0&&(pn=2),ge.morphAttributes.color!==void 0&&(pn=3);let In,vt,Ut,Sn;if(tt){const kr=Bf[tt];In=kr.vertexShader,vt=kr.fragmentShader}else In=K.vertexShader,vt=K.fragmentShader,c.update(K),Ut=c.getVertexShaderID(K),Sn=c.getFragmentShaderID(K);const ln=i.getRenderTarget(),Xn=i.state.buffers.depth.getReversed(),Yr=Pe.isInstancedMesh===!0,lr=Pe.isBatchedMesh===!0,Kr=!!K.map,wi=!!K.matcap,Zr=!!Fe,Ue=!!K.aoMap,vo=!!K.lightMap,ui=!!K.bumpMap,qr=!!K.normalMap,Dn=!!K.displacementMap,ni=!!K.emissiveMap,$n=!!K.metalnessMap,Sr=!!K.roughnessMap,Vi=K.anisotropy>0,Me=K.clearcoat>0,fe=K.dispersion>0,ft=K.iridescence>0,Ft=K.sheen>0,$t=K.transmission>0,kt=Vi&&!!K.anisotropyMap,Jn=Me&&!!K.clearcoatMap,An=Me&&!!K.clearcoatNormalMap,Hn=Me&&!!K.clearcoatRoughnessMap,Zn=ft&&!!K.iridescenceMap,Vt=ft&&!!K.iridescenceThicknessMap,Ln=Ft&&!!K.sheenColorMap,fr=Ft&&!!K.sheenRoughnessMap,ur=!!K.specularMap,Mn=!!K.specularColorMap,cr=!!K.specularIntensityMap,He=$t&&!!K.transmissionMap,Cn=$t&&!!K.thicknessMap,Wt=!!K.gradientMap,Fn=!!K.alphaMap,cn=K.alphaTest>0,zt=!!K.alphaHash,On=!!K.extensions;let pr=Yl;K.toneMapped&&(ln===null||ln.isXRRenderTarget===!0)&&(pr=i.toneMapping);const Gi={shaderID:tt,shaderType:K.type,shaderName:K.name,vertexShader:In,fragmentShader:vt,defines:K.defines,customVertexShaderID:Ut,customFragmentShaderID:Sn,isRawShaderMaterial:K.isRawShaderMaterial===!0,glslVersion:K.glslVersion,precision:x,batching:lr,batchingColor:lr&&Pe._colorsTexture!==null,instancing:Yr,instancingColor:Yr&&Pe.instanceColor!==null,instancingMorph:Yr&&Pe.morphTexture!==null,supportsVertexTextures:v,outputColorSpace:ln===null?i.outputColorSpace:ln.isXRRenderTarget===!0?ln.texture.colorSpace:_l,alphaToCoverage:!!K.alphaToCoverage,map:Kr,matcap:wi,envMap:Zr,envMapMode:Zr&&Fe.mapping,envMapCubeUVHeight:Ne,aoMap:Ue,lightMap:vo,bumpMap:ui,normalMap:qr,displacementMap:v&&Dn,emissiveMap:ni,normalMapObjectSpace:qr&&K.normalMapType===WCe,normalMapTangentSpace:qr&&K.normalMapType===j1,metalnessMap:$n,roughnessMap:Sr,anisotropy:Vi,anisotropyMap:kt,clearcoat:Me,clearcoatMap:Jn,clearcoatNormalMap:An,clearcoatRoughnessMap:Hn,dispersion:fe,iridescence:ft,iridescenceMap:Zn,iridescenceThicknessMap:Vt,sheen:Ft,sheenColorMap:Ln,sheenRoughnessMap:fr,specularMap:ur,specularColorMap:Mn,specularIntensityMap:cr,transmission:$t,transmissionMap:He,thicknessMap:Cn,gradientMap:Wt,opaque:K.transparent===!1&&K.blending===fc&&K.alphaToCoverage===!1,alphaMap:Fn,alphaTest:cn,alphaHash:zt,combine:K.combine,mapUv:Kr&&P(K.map.channel),aoMapUv:Ue&&P(K.aoMap.channel),lightMapUv:vo&&P(K.lightMap.channel),bumpMapUv:ui&&P(K.bumpMap.channel),normalMapUv:qr&&P(K.normalMap.channel),displacementMapUv:Dn&&P(K.displacementMap.channel),emissiveMapUv:ni&&P(K.emissiveMap.channel),metalnessMapUv:$n&&P(K.metalnessMap.channel),roughnessMapUv:Sr&&P(K.roughnessMap.channel),anisotropyMapUv:kt&&P(K.anisotropyMap.channel),clearcoatMapUv:Jn&&P(K.clearcoatMap.channel),clearcoatNormalMapUv:An&&P(K.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Hn&&P(K.clearcoatRoughnessMap.channel),iridescenceMapUv:Zn&&P(K.iridescenceMap.channel),iridescenceThicknessMapUv:Vt&&P(K.iridescenceThicknessMap.channel),sheenColorMapUv:Ln&&P(K.sheenColorMap.channel),sheenRoughnessMapUv:fr&&P(K.sheenRoughnessMap.channel),specularMapUv:ur&&P(K.specularMap.channel),specularColorMapUv:Mn&&P(K.specularColorMap.channel),specularIntensityMapUv:cr&&P(K.specularIntensityMap.channel),transmissionMapUv:He&&P(K.transmissionMap.channel),thicknessMapUv:Cn&&P(K.thicknessMap.channel),alphaMapUv:Fn&&P(K.alphaMap.channel),vertexTangents:!!ge.attributes.tangent&&(qr||Vi),vertexColors:K.vertexColors,vertexAlphas:K.vertexColors===!0&&!!ge.attributes.color&&ge.attributes.color.itemSize===4,pointsUvs:Pe.isPoints===!0&&!!ge.attributes.uv&&(Kr||Fn),fog:!!je,useFog:K.fog===!0,fogExp2:!!je&&je.isFogExp2,flatShading:K.flatShading===!0,sizeAttenuation:K.sizeAttenuation===!0,logarithmicDepthBuffer:m,reverseDepthBuffer:Xn,skinning:Pe.isSkinnedMesh===!0,morphTargets:ge.morphAttributes.position!==void 0,morphNormals:ge.morphAttributes.normal!==void 0,morphColors:ge.morphAttributes.color!==void 0,morphTargetsCount:Ht,morphTextureStride:pn,numDirLights:$.directional.length,numPointLights:$.point.length,numSpotLights:$.spot.length,numSpotLightMaps:$.spotLightMap.length,numRectAreaLights:$.rectArea.length,numHemiLights:$.hemi.length,numDirLightShadows:$.directionalShadowMap.length,numPointLightShadows:$.pointShadowMap.length,numSpotLightShadows:$.spotShadowMap.length,numSpotLightShadowsWithMaps:$.numSpotLightShadowsWithMaps,numLightProbes:$.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:K.dithering,shadowMapEnabled:i.shadowMap.enabled&&he.length>0,shadowMapType:i.shadowMap.type,toneMapping:pr,decodeVideoTexture:Kr&&K.map.isVideoTexture===!0&&rr.getTransfer(K.map.colorSpace)===zn,decodeVideoTextureEmissive:ni&&K.emissiveMap.isVideoTexture===!0&&rr.getTransfer(K.emissiveMap.colorSpace)===zn,premultipliedAlpha:K.premultipliedAlpha,doubleSided:K.side===Co,flipSided:K.side===Ui,useDepthPacking:K.depthPacking>=0,depthPacking:K.depthPacking||0,index0AttributeName:K.index0AttributeName,extensionClipCullDistance:On&&K.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(On&&K.extensions.multiDraw===!0||lr)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:K.customProgramCacheKey()};return Gi.vertexUv1s=u.has(1),Gi.vertexUv2s=u.has(2),Gi.vertexUv3s=u.has(3),u.clear(),Gi}function M(K){const $=[];if(K.shaderID?$.push(K.shaderID):($.push(K.customVertexShaderID),$.push(K.customFragmentShaderID)),K.defines!==void 0)for(const he in K.defines)$.push(he),$.push(K.defines[he]);return K.isRawShaderMaterial===!1&&(O($,K),C($,K),$.push(i.outputColorSpace)),$.push(K.customProgramCacheKey),$.join()}function O(K,$){K.push($.precision),K.push($.outputColorSpace),K.push($.envMapMode),K.push($.envMapCubeUVHeight),K.push($.mapUv),K.push($.alphaMapUv),K.push($.lightMapUv),K.push($.aoMapUv),K.push($.bumpMapUv),K.push($.normalMapUv),K.push($.displacementMapUv),K.push($.emissiveMapUv),K.push($.metalnessMapUv),K.push($.roughnessMapUv),K.push($.anisotropyMapUv),K.push($.clearcoatMapUv),K.push($.clearcoatNormalMapUv),K.push($.clearcoatRoughnessMapUv),K.push($.iridescenceMapUv),K.push($.iridescenceThicknessMapUv),K.push($.sheenColorMapUv),K.push($.sheenRoughnessMapUv),K.push($.specularMapUv),K.push($.specularColorMapUv),K.push($.specularIntensityMapUv),K.push($.transmissionMapUv),K.push($.thicknessMapUv),K.push($.combine),K.push($.fogExp2),K.push($.sizeAttenuation),K.push($.morphTargetsCount),K.push($.morphAttributeCount),K.push($.numDirLights),K.push($.numPointLights),K.push($.numSpotLights),K.push($.numSpotLightMaps),K.push($.numHemiLights),K.push($.numRectAreaLights),K.push($.numDirLightShadows),K.push($.numPointLightShadows),K.push($.numSpotLightShadows),K.push($.numSpotLightShadowsWithMaps),K.push($.numLightProbes),K.push($.shadowMapType),K.push($.toneMapping),K.push($.numClippingPlanes),K.push($.numClipIntersection),K.push($.depthPacking)}function C(K,$){a.disableAll(),$.supportsVertexTextures&&a.enable(0),$.instancing&&a.enable(1),$.instancingColor&&a.enable(2),$.instancingMorph&&a.enable(3),$.matcap&&a.enable(4),$.envMap&&a.enable(5),$.normalMapObjectSpace&&a.enable(6),$.normalMapTangentSpace&&a.enable(7),$.clearcoat&&a.enable(8),$.iridescence&&a.enable(9),$.alphaTest&&a.enable(10),$.vertexColors&&a.enable(11),$.vertexAlphas&&a.enable(12),$.vertexUv1s&&a.enable(13),$.vertexUv2s&&a.enable(14),$.vertexUv3s&&a.enable(15),$.vertexTangents&&a.enable(16),$.anisotropy&&a.enable(17),$.alphaHash&&a.enable(18),$.batching&&a.enable(19),$.dispersion&&a.enable(20),$.batchingColor&&a.enable(21),K.push(a.mask),a.disableAll(),$.fog&&a.enable(0),$.useFog&&a.enable(1),$.flatShading&&a.enable(2),$.logarithmicDepthBuffer&&a.enable(3),$.reverseDepthBuffer&&a.enable(4),$.skinning&&a.enable(5),$.morphTargets&&a.enable(6),$.morphNormals&&a.enable(7),$.morphColors&&a.enable(8),$.premultipliedAlpha&&a.enable(9),$.shadowMapEnabled&&a.enable(10),$.doubleSided&&a.enable(11),$.flipSided&&a.enable(12),$.useDepthPacking&&a.enable(13),$.dithering&&a.enable(14),$.transmission&&a.enable(15),$.sheen&&a.enable(16),$.opaque&&a.enable(17),$.pointsUvs&&a.enable(18),$.decodeVideoTexture&&a.enable(19),$.decodeVideoTextureEmissive&&a.enable(20),$.alphaToCoverage&&a.enable(21),K.push(a.mask)}function L(K){const $=T[K.type];let he;if($){const Ce=Bf[$];he=Wqe.clone(Ce.uniforms)}else he=K.uniforms;return he}function Y(K,$){let he;for(let Ce=0,Pe=f.length;Ce<Pe;Ce++){const je=f[Ce];if(je.cacheKey===$){he=je,++he.usedTimes;break}}return he===void 0&&(he=new SJe(i,$,K,s),f.push(he)),he}function J(K){if(--K.usedTimes===0){const $=f.indexOf(K);f[$]=f[f.length-1],f.pop(),K.destroy()}}function z(K){c.remove(K)}function ne(){c.dispose()}return{getParameters:R,getProgramCacheKey:M,getUniforms:L,acquireProgram:Y,releaseProgram:J,releaseShaderCache:z,programs:f,dispose:ne}}function CJe(){let i=new WeakMap;function e(o){return i.has(o)}function t(o){let a=i.get(o);return a===void 0&&(a={},i.set(o,a)),a}function n(o){i.delete(o)}function r(o,a,c){i.get(o)[a]=c}function s(){i=new WeakMap}return{has:e,get:t,remove:n,update:r,dispose:s}}function AJe(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function J7e(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function ebe(){const i=[];let e=0;const t=[],n=[],r=[];function s(){e=0,t.length=0,n.length=0,r.length=0}function o(m,v,x,T,P,R){let M=i[e];return M===void 0?(M={id:m.id,object:m,geometry:v,material:x,groupOrder:T,renderOrder:m.renderOrder,z:P,group:R},i[e]=M):(M.id=m.id,M.object=m,M.geometry=v,M.material=x,M.groupOrder=T,M.renderOrder=m.renderOrder,M.z=P,M.group=R),e++,M}function a(m,v,x,T,P,R){const M=o(m,v,x,T,P,R);x.transmission>0?n.push(M):x.transparent===!0?r.push(M):t.push(M)}function c(m,v,x,T,P,R){const M=o(m,v,x,T,P,R);x.transmission>0?n.unshift(M):x.transparent===!0?r.unshift(M):t.unshift(M)}function u(m,v){t.length>1&&t.sort(m||AJe),n.length>1&&n.sort(v||J7e),r.length>1&&r.sort(v||J7e)}function f(){for(let m=e,v=i.length;m<v;m++){const x=i[m];if(x.id===null)break;x.id=null,x.object=null,x.geometry=null,x.material=null,x.group=null}}return{opaque:t,transmissive:n,transparent:r,init:s,push:a,unshift:c,finish:f,sort:u}}function RJe(){let i=new WeakMap;function e(n,r){const s=i.get(n);let o;return s===void 0?(o=new ebe,i.set(n,[o])):r>=s.length?(o=new ebe,s.push(o)):o=s[r],o}function t(){i=new WeakMap}return{get:e,dispose:t}}function PJe(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new be,color:new yn};break;case"SpotLight":t={position:new be,direction:new be,color:new yn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new be,color:new yn,distance:0,decay:0};break;case"HemisphereLight":t={direction:new be,skyColor:new yn,groundColor:new yn};break;case"RectAreaLight":t={color:new yn,position:new be,halfWidth:new be,halfHeight:new be};break}return i[e.id]=t,t}}}function NJe(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mn};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mn};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mn,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let IJe=0;function kJe(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function DJe(i){const e=new PJe,t=NJe(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)n.probe.push(new be);const r=new be,s=new Vn,o=new Vn;function a(u){let f=0,m=0,v=0;for(let K=0;K<9;K++)n.probe[K].set(0,0,0);let x=0,T=0,P=0,R=0,M=0,O=0,C=0,L=0,Y=0,J=0,z=0;u.sort(kJe);for(let K=0,$=u.length;K<$;K++){const he=u[K],Ce=he.color,Pe=he.intensity,je=he.distance,ge=he.shadow&&he.shadow.map?he.shadow.map.texture:null;if(he.isAmbientLight)f+=Ce.r*Pe,m+=Ce.g*Pe,v+=Ce.b*Pe;else if(he.isLightProbe){for(let Xe=0;Xe<9;Xe++)n.probe[Xe].addScaledVector(he.sh.coefficients[Xe],Pe);z++}else if(he.isDirectionalLight){const Xe=e.get(he);if(Xe.color.copy(he.color).multiplyScalar(he.intensity),he.castShadow){const Fe=he.shadow,Ne=t.get(he);Ne.shadowIntensity=Fe.intensity,Ne.shadowBias=Fe.bias,Ne.shadowNormalBias=Fe.normalBias,Ne.shadowRadius=Fe.radius,Ne.shadowMapSize=Fe.mapSize,n.directionalShadow[x]=Ne,n.directionalShadowMap[x]=ge,n.directionalShadowMatrix[x]=he.shadow.matrix,O++}n.directional[x]=Xe,x++}else if(he.isSpotLight){const Xe=e.get(he);Xe.position.setFromMatrixPosition(he.matrixWorld),Xe.color.copy(Ce).multiplyScalar(Pe),Xe.distance=je,Xe.coneCos=Math.cos(he.angle),Xe.penumbraCos=Math.cos(he.angle*(1-he.penumbra)),Xe.decay=he.decay,n.spot[P]=Xe;const Fe=he.shadow;if(he.map&&(n.spotLightMap[Y]=he.map,Y++,Fe.updateMatrices(he),he.castShadow&&J++),n.spotLightMatrix[P]=Fe.matrix,he.castShadow){const Ne=t.get(he);Ne.shadowIntensity=Fe.intensity,Ne.shadowBias=Fe.bias,Ne.shadowNormalBias=Fe.normalBias,Ne.shadowRadius=Fe.radius,Ne.shadowMapSize=Fe.mapSize,n.spotShadow[P]=Ne,n.spotShadowMap[P]=ge,L++}P++}else if(he.isRectAreaLight){const Xe=e.get(he);Xe.color.copy(Ce).multiplyScalar(Pe),Xe.halfWidth.set(he.width*.5,0,0),Xe.halfHeight.set(0,he.height*.5,0),n.rectArea[R]=Xe,R++}else if(he.isPointLight){const Xe=e.get(he);if(Xe.color.copy(he.color).multiplyScalar(he.intensity),Xe.distance=he.distance,Xe.decay=he.decay,he.castShadow){const Fe=he.shadow,Ne=t.get(he);Ne.shadowIntensity=Fe.intensity,Ne.shadowBias=Fe.bias,Ne.shadowNormalBias=Fe.normalBias,Ne.shadowRadius=Fe.radius,Ne.shadowMapSize=Fe.mapSize,Ne.shadowCameraNear=Fe.camera.near,Ne.shadowCameraFar=Fe.camera.far,n.pointShadow[T]=Ne,n.pointShadowMap[T]=ge,n.pointShadowMatrix[T]=he.shadow.matrix,C++}n.point[T]=Xe,T++}else if(he.isHemisphereLight){const Xe=e.get(he);Xe.skyColor.copy(he.color).multiplyScalar(Pe),Xe.groundColor.copy(he.groundColor).multiplyScalar(Pe),n.hemi[M]=Xe,M++}}R>0&&(i.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Nn.LTC_FLOAT_1,n.rectAreaLTC2=Nn.LTC_FLOAT_2):(n.rectAreaLTC1=Nn.LTC_HALF_1,n.rectAreaLTC2=Nn.LTC_HALF_2)),n.ambient[0]=f,n.ambient[1]=m,n.ambient[2]=v;const ne=n.hash;(ne.directionalLength!==x||ne.pointLength!==T||ne.spotLength!==P||ne.rectAreaLength!==R||ne.hemiLength!==M||ne.numDirectionalShadows!==O||ne.numPointShadows!==C||ne.numSpotShadows!==L||ne.numSpotMaps!==Y||ne.numLightProbes!==z)&&(n.directional.length=x,n.spot.length=P,n.rectArea.length=R,n.point.length=T,n.hemi.length=M,n.directionalShadow.length=O,n.directionalShadowMap.length=O,n.pointShadow.length=C,n.pointShadowMap.length=C,n.spotShadow.length=L,n.spotShadowMap.length=L,n.directionalShadowMatrix.length=O,n.pointShadowMatrix.length=C,n.spotLightMatrix.length=L+Y-J,n.spotLightMap.length=Y,n.numSpotLightShadowsWithMaps=J,n.numLightProbes=z,ne.directionalLength=x,ne.pointLength=T,ne.spotLength=P,ne.rectAreaLength=R,ne.hemiLength=M,ne.numDirectionalShadows=O,ne.numPointShadows=C,ne.numSpotShadows=L,ne.numSpotMaps=Y,ne.numLightProbes=z,n.version=IJe++)}function c(u,f){let m=0,v=0,x=0,T=0,P=0;const R=f.matrixWorldInverse;for(let M=0,O=u.length;M<O;M++){const C=u[M];if(C.isDirectionalLight){const L=n.directional[m];L.direction.setFromMatrixPosition(C.matrixWorld),r.setFromMatrixPosition(C.target.matrixWorld),L.direction.sub(r),L.direction.transformDirection(R),m++}else if(C.isSpotLight){const L=n.spot[x];L.position.setFromMatrixPosition(C.matrixWorld),L.position.applyMatrix4(R),L.direction.setFromMatrixPosition(C.matrixWorld),r.setFromMatrixPosition(C.target.matrixWorld),L.direction.sub(r),L.direction.transformDirection(R),x++}else if(C.isRectAreaLight){const L=n.rectArea[T];L.position.setFromMatrixPosition(C.matrixWorld),L.position.applyMatrix4(R),o.identity(),s.copy(C.matrixWorld),s.premultiply(R),o.extractRotation(s),L.halfWidth.set(C.width*.5,0,0),L.halfHeight.set(0,C.height*.5,0),L.halfWidth.applyMatrix4(o),L.halfHeight.applyMatrix4(o),T++}else if(C.isPointLight){const L=n.point[v];L.position.setFromMatrixPosition(C.matrixWorld),L.position.applyMatrix4(R),v++}else if(C.isHemisphereLight){const L=n.hemi[P];L.direction.setFromMatrixPosition(C.matrixWorld),L.direction.transformDirection(R),P++}}}return{setup:a,setupView:c,state:n}}function tbe(i){const e=new DJe(i),t=[],n=[];function r(f){u.camera=f,t.length=0,n.length=0}function s(f){t.push(f)}function o(f){n.push(f)}function a(){e.setup(t)}function c(f){e.setupView(t,f)}const u={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:u,setupLights:a,setupLightsView:c,pushLight:s,pushShadow:o}}function FJe(i){let e=new WeakMap;function t(r,s=0){const o=e.get(r);let a;return o===void 0?(a=new tbe(i),e.set(r,[a])):s>=o.length?(a=new tbe(i),o.push(a)):a=o[s],a}function n(){e=new WeakMap}return{get:t,dispose:n}}const OJe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,BJe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function LJe(i,e,t){let n=new lC;const r=new mn,s=new mn,o=new ir,a=new _Ae({depthPacking:XWe}),c=new MXe,u={},f=t.maxTextureSize,m={[Xl]:Ui,[Ui]:Xl,[Co]:Co},v=new D0({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new mn},radius:{value:4}},vertexShader:OJe,fragmentShader:BJe}),x=v.clone();x.defines.HORIZONTAL_PASS=1;const T=new Xi;T.setAttribute("position",new Ra(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const P=new dn(T,v),R=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Bne;let M=this.type;this.render=function(J,z,ne){if(R.enabled===!1||R.autoUpdate===!1&&R.needsUpdate===!1||J.length===0)return;const K=i.getRenderTarget(),$=i.getActiveCubeFace(),he=i.getActiveMipmapLevel(),Ce=i.state;Ce.setBlending(vl),Ce.buffers.color.setClear(1,1,1,1),Ce.buffers.depth.setTest(!0),Ce.setScissorTest(!1);const Pe=M!==jc&&this.type===jc,je=M===jc&&this.type!==jc;for(let ge=0,Xe=J.length;ge<Xe;ge++){const Fe=J[ge],Ne=Fe.shadow;if(Ne===void 0){console.warn("THREE.WebGLShadowMap:",Fe,"has no shadow.");continue}if(Ne.autoUpdate===!1&&Ne.needsUpdate===!1)continue;r.copy(Ne.mapSize);const tt=Ne.getFrameExtents();if(r.multiply(tt),s.copy(Ne.mapSize),(r.x>f||r.y>f)&&(r.x>f&&(s.x=Math.floor(f/tt.x),r.x=s.x*tt.x,Ne.mapSize.x=s.x),r.y>f&&(s.y=Math.floor(f/tt.y),r.y=s.y*tt.y,Ne.mapSize.y=s.y)),Ne.map===null||Pe===!0||je===!0){const Ht=this.type!==jc?{minFilter:es,magFilter:es}:{};Ne.map!==null&&Ne.map.dispose(),Ne.map=new yc(r.x,r.y,Ht),Ne.map.texture.name=Fe.name+".shadowMap",Ne.camera.updateProjectionMatrix()}i.setRenderTarget(Ne.map),i.clear();const mt=Ne.getViewportCount();for(let Ht=0;Ht<mt;Ht++){const pn=Ne.getViewport(Ht);o.set(s.x*pn.x,s.y*pn.y,s.x*pn.z,s.y*pn.w),Ce.viewport(o),Ne.updateMatrices(Fe,Ht),n=Ne.getFrustum(),L(z,ne,Ne.camera,Fe,this.type)}Ne.isPointLightShadow!==!0&&this.type===jc&&O(Ne,ne),Ne.needsUpdate=!1}M=this.type,R.needsUpdate=!1,i.setRenderTarget(K,$,he)};function O(J,z){const ne=e.update(P);v.defines.VSM_SAMPLES!==J.blurSamples&&(v.defines.VSM_SAMPLES=J.blurSamples,x.defines.VSM_SAMPLES=J.blurSamples,v.needsUpdate=!0,x.needsUpdate=!0),J.mapPass===null&&(J.mapPass=new yc(r.x,r.y)),v.uniforms.shadow_pass.value=J.map.texture,v.uniforms.resolution.value=J.mapSize,v.uniforms.radius.value=J.radius,i.setRenderTarget(J.mapPass),i.clear(),i.renderBufferDirect(z,null,ne,v,P,null),x.uniforms.shadow_pass.value=J.mapPass.texture,x.uniforms.resolution.value=J.mapSize,x.uniforms.radius.value=J.radius,i.setRenderTarget(J.map),i.clear(),i.renderBufferDirect(z,null,ne,x,P,null)}function C(J,z,ne,K){let $=null;const he=ne.isPointLight===!0?J.customDistanceMaterial:J.customDepthMaterial;if(he!==void 0)$=he;else if($=ne.isPointLight===!0?c:a,i.localClippingEnabled&&z.clipShadows===!0&&Array.isArray(z.clippingPlanes)&&z.clippingPlanes.length!==0||z.displacementMap&&z.displacementScale!==0||z.alphaMap&&z.alphaTest>0||z.map&&z.alphaTest>0||z.alphaToCoverage===!0){const Ce=$.uuid,Pe=z.uuid;let je=u[Ce];je===void 0&&(je={},u[Ce]=je);let ge=je[Pe];ge===void 0&&(ge=$.clone(),je[Pe]=ge,z.addEventListener("dispose",Y)),$=ge}if($.visible=z.visible,$.wireframe=z.wireframe,K===jc?$.side=z.shadowSide!==null?z.shadowSide:z.side:$.side=z.shadowSide!==null?z.shadowSide:m[z.side],$.alphaMap=z.alphaMap,$.alphaTest=z.alphaToCoverage===!0?.5:z.alphaTest,$.map=z.map,$.clipShadows=z.clipShadows,$.clippingPlanes=z.clippingPlanes,$.clipIntersection=z.clipIntersection,$.displacementMap=z.displacementMap,$.displacementScale=z.displacementScale,$.displacementBias=z.displacementBias,$.wireframeLinewidth=z.wireframeLinewidth,$.linewidth=z.linewidth,ne.isPointLight===!0&&$.isMeshDistanceMaterial===!0){const Ce=i.properties.get($);Ce.light=ne}return $}function L(J,z,ne,K,$){if(J.visible===!1)return;if(J.layers.test(z.layers)&&(J.isMesh||J.isLine||J.isPoints)&&(J.castShadow||J.receiveShadow&&$===jc)&&(!J.frustumCulled||n.intersectsObject(J))){J.modelViewMatrix.multiplyMatrices(ne.matrixWorldInverse,J.matrixWorld);const Pe=e.update(J),je=J.material;if(Array.isArray(je)){const ge=Pe.groups;for(let Xe=0,Fe=ge.length;Xe<Fe;Xe++){const Ne=ge[Xe],tt=je[Ne.materialIndex];if(tt&&tt.visible){const mt=C(J,tt,K,$);J.onBeforeShadow(i,J,z,ne,Pe,mt,Ne),i.renderBufferDirect(ne,null,Pe,mt,J,Ne),J.onAfterShadow(i,J,z,ne,Pe,mt,Ne)}}}else if(je.visible){const ge=C(J,je,K,$);J.onBeforeShadow(i,J,z,ne,Pe,ge,null),i.renderBufferDirect(ne,null,Pe,ge,J,null),J.onAfterShadow(i,J,z,ne,Pe,ge,null)}}const Ce=J.children;for(let Pe=0,je=Ce.length;Pe<je;Pe++)L(Ce[Pe],z,ne,K,$)}function Y(J){J.target.removeEventListener("dispose",Y);for(const ne in u){const K=u[ne],$=J.target.uuid;$ in K&&(K[$].dispose(),delete K[$])}}}const UJe={[cM]:uM,[hM]:pM,[dM]:mM,[z2]:fM,[uM]:cM,[pM]:hM,[mM]:dM,[fM]:z2};function zJe(i,e){function t(){let He=!1;const Cn=new ir;let Wt=null;const Fn=new ir(0,0,0,0);return{setMask:function(cn){Wt!==cn&&!He&&(i.colorMask(cn,cn,cn,cn),Wt=cn)},setLocked:function(cn){He=cn},setClear:function(cn,zt,On,pr,Gi){Gi===!0&&(cn*=pr,zt*=pr,On*=pr),Cn.set(cn,zt,On,pr),Fn.equals(Cn)===!1&&(i.clearColor(cn,zt,On,pr),Fn.copy(Cn))},reset:function(){He=!1,Wt=null,Fn.set(-1,0,0,0)}}}function n(){let He=!1,Cn=!1,Wt=null,Fn=null,cn=null;return{setReversed:function(zt){if(Cn!==zt){const On=e.get("EXT_clip_control");zt?On.clipControlEXT(On.LOWER_LEFT_EXT,On.ZERO_TO_ONE_EXT):On.clipControlEXT(On.LOWER_LEFT_EXT,On.NEGATIVE_ONE_TO_ONE_EXT),Cn=zt;const pr=cn;cn=null,this.setClear(pr)}},getReversed:function(){return Cn},setTest:function(zt){zt?ln(i.DEPTH_TEST):Xn(i.DEPTH_TEST)},setMask:function(zt){Wt!==zt&&!He&&(i.depthMask(zt),Wt=zt)},setFunc:function(zt){if(Cn&&(zt=UJe[zt]),Fn!==zt){switch(zt){case cM:i.depthFunc(i.NEVER);break;case uM:i.depthFunc(i.ALWAYS);break;case hM:i.depthFunc(i.LESS);break;case z2:i.depthFunc(i.LEQUAL);break;case dM:i.depthFunc(i.EQUAL);break;case fM:i.depthFunc(i.GEQUAL);break;case pM:i.depthFunc(i.GREATER);break;case mM:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}Fn=zt}},setLocked:function(zt){He=zt},setClear:function(zt){cn!==zt&&(Cn&&(zt=1-zt),i.clearDepth(zt),cn=zt)},reset:function(){He=!1,Wt=null,Fn=null,cn=null,Cn=!1}}}function r(){let He=!1,Cn=null,Wt=null,Fn=null,cn=null,zt=null,On=null,pr=null,Gi=null;return{setTest:function(kr){He||(kr?ln(i.STENCIL_TEST):Xn(i.STENCIL_TEST))},setMask:function(kr){Cn!==kr&&!He&&(i.stencilMask(kr),Cn=kr)},setFunc:function(kr,pa,bl){(Wt!==kr||Fn!==pa||cn!==bl)&&(i.stencilFunc(kr,pa,bl),Wt=kr,Fn=pa,cn=bl)},setOp:function(kr,pa,bl){(zt!==kr||On!==pa||pr!==bl)&&(i.stencilOp(kr,pa,bl),zt=kr,On=pa,pr=bl)},setLocked:function(kr){He=kr},setClear:function(kr){Gi!==kr&&(i.clearStencil(kr),Gi=kr)},reset:function(){He=!1,Cn=null,Wt=null,Fn=null,cn=null,zt=null,On=null,pr=null,Gi=null}}}const s=new t,o=new n,a=new r,c=new WeakMap,u=new WeakMap;let f={},m={},v=new WeakMap,x=[],T=null,P=!1,R=null,M=null,O=null,C=null,L=null,Y=null,J=null,z=new yn(0,0,0),ne=0,K=!1,$=null,he=null,Ce=null,Pe=null,je=null;const ge=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Xe=!1,Fe=0;const Ne=i.getParameter(i.VERSION);Ne.indexOf("WebGL")!==-1?(Fe=parseFloat(/^WebGL (\d)/.exec(Ne)[1]),Xe=Fe>=1):Ne.indexOf("OpenGL ES")!==-1&&(Fe=parseFloat(/^OpenGL ES (\d)/.exec(Ne)[1]),Xe=Fe>=2);let tt=null,mt={};const Ht=i.getParameter(i.SCISSOR_BOX),pn=i.getParameter(i.VIEWPORT),In=new ir().fromArray(Ht),vt=new ir().fromArray(pn);function Ut(He,Cn,Wt,Fn){const cn=new Uint8Array(4),zt=i.createTexture();i.bindTexture(He,zt),i.texParameteri(He,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(He,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let On=0;On<Wt;On++)He===i.TEXTURE_3D||He===i.TEXTURE_2D_ARRAY?i.texImage3D(Cn,0,i.RGBA,1,1,Fn,0,i.RGBA,i.UNSIGNED_BYTE,cn):i.texImage2D(Cn+On,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,cn);return zt}const Sn={};Sn[i.TEXTURE_2D]=Ut(i.TEXTURE_2D,i.TEXTURE_2D,1),Sn[i.TEXTURE_CUBE_MAP]=Ut(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),Sn[i.TEXTURE_2D_ARRAY]=Ut(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),Sn[i.TEXTURE_3D]=Ut(i.TEXTURE_3D,i.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),ln(i.DEPTH_TEST),o.setFunc(z2),ui(!1),qr(Mee),ln(i.CULL_FACE),Ue(vl);function ln(He){f[He]!==!0&&(i.enable(He),f[He]=!0)}function Xn(He){f[He]!==!1&&(i.disable(He),f[He]=!1)}function Yr(He,Cn){return m[He]!==Cn?(i.bindFramebuffer(He,Cn),m[He]=Cn,He===i.DRAW_FRAMEBUFFER&&(m[i.FRAMEBUFFER]=Cn),He===i.FRAMEBUFFER&&(m[i.DRAW_FRAMEBUFFER]=Cn),!0):!1}function lr(He,Cn){let Wt=x,Fn=!1;if(He){Wt=v.get(Cn),Wt===void 0&&(Wt=[],v.set(Cn,Wt));const cn=He.textures;if(Wt.length!==cn.length||Wt[0]!==i.COLOR_ATTACHMENT0){for(let zt=0,On=cn.length;zt<On;zt++)Wt[zt]=i.COLOR_ATTACHMENT0+zt;Wt.length=cn.length,Fn=!0}}else Wt[0]!==i.BACK&&(Wt[0]=i.BACK,Fn=!0);Fn&&i.drawBuffers(Wt)}function Kr(He){return T!==He?(i.useProgram(He),T=He,!0):!1}const wi={[gl]:i.FUNC_ADD,[FU]:i.FUNC_SUBTRACT,[OU]:i.FUNC_REVERSE_SUBTRACT};wi[Lne]=i.MIN,wi[Une]=i.MAX;const Zr={[ud]:i.ZERO,[KM]:i.ONE,[ZM]:i.SRC_COLOR,[g4]:i.SRC_ALPHA,[BU]:i.SRC_ALPHA_SATURATE,[tC]:i.DST_COLOR,[JM]:i.DST_ALPHA,[QM]:i.ONE_MINUS_SRC_COLOR,[y4]:i.ONE_MINUS_SRC_ALPHA,[nC]:i.ONE_MINUS_DST_COLOR,[eC]:i.ONE_MINUS_DST_ALPHA,[zne]:i.CONSTANT_COLOR,[Vne]:i.ONE_MINUS_CONSTANT_COLOR,[Gne]:i.CONSTANT_ALPHA,[$ne]:i.ONE_MINUS_CONSTANT_ALPHA};function Ue(He,Cn,Wt,Fn,cn,zt,On,pr,Gi,kr){if(He===vl){P===!0&&(Xn(i.BLEND),P=!1);return}if(P===!1&&(ln(i.BLEND),P=!0),He!==Jy){if(He!==R||kr!==K){if((M!==gl||L!==gl)&&(i.blendEquation(i.FUNC_ADD),M=gl,L=gl),kr)switch(He){case fc:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case f4:i.blendFunc(i.ONE,i.ONE);break;case p4:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case m4:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",He);break}else switch(He){case fc:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case f4:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case p4:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case m4:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",He);break}O=null,C=null,Y=null,J=null,z.set(0,0,0),ne=0,R=He,K=kr}return}cn=cn||Cn,zt=zt||Wt,On=On||Fn,(Cn!==M||cn!==L)&&(i.blendEquationSeparate(wi[Cn],wi[cn]),M=Cn,L=cn),(Wt!==O||Fn!==C||zt!==Y||On!==J)&&(i.blendFuncSeparate(Zr[Wt],Zr[Fn],Zr[zt],Zr[On]),O=Wt,C=Fn,Y=zt,J=On),(pr.equals(z)===!1||Gi!==ne)&&(i.blendColor(pr.r,pr.g,pr.b,Gi),z.copy(pr),ne=Gi),R=He,K=!1}function vo(He,Cn){He.side===Co?Xn(i.CULL_FACE):ln(i.CULL_FACE);let Wt=He.side===Ui;Cn&&(Wt=!Wt),ui(Wt),He.blending===fc&&He.transparent===!1?Ue(vl):Ue(He.blending,He.blendEquation,He.blendSrc,He.blendDst,He.blendEquationAlpha,He.blendSrcAlpha,He.blendDstAlpha,He.blendColor,He.blendAlpha,He.premultipliedAlpha),o.setFunc(He.depthFunc),o.setTest(He.depthTest),o.setMask(He.depthWrite),s.setMask(He.colorWrite);const Fn=He.stencilWrite;a.setTest(Fn),Fn&&(a.setMask(He.stencilWriteMask),a.setFunc(He.stencilFunc,He.stencilRef,He.stencilFuncMask),a.setOp(He.stencilFail,He.stencilZFail,He.stencilZPass)),ni(He.polygonOffset,He.polygonOffsetFactor,He.polygonOffsetUnits),He.alphaToCoverage===!0?ln(i.SAMPLE_ALPHA_TO_COVERAGE):Xn(i.SAMPLE_ALPHA_TO_COVERAGE)}function ui(He){$!==He&&(He?i.frontFace(i.CW):i.frontFace(i.CCW),$=He)}function qr(He){He!==VCe?(ln(i.CULL_FACE),He!==he&&(He===Mee?i.cullFace(i.BACK):He===GCe?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):Xn(i.CULL_FACE),he=He}function Dn(He){He!==Ce&&(Xe&&i.lineWidth(He),Ce=He)}function ni(He,Cn,Wt){He?(ln(i.POLYGON_OFFSET_FILL),(Pe!==Cn||je!==Wt)&&(i.polygonOffset(Cn,Wt),Pe=Cn,je=Wt)):Xn(i.POLYGON_OFFSET_FILL)}function $n(He){He?ln(i.SCISSOR_TEST):Xn(i.SCISSOR_TEST)}function Sr(He){He===void 0&&(He=i.TEXTURE0+ge-1),tt!==He&&(i.activeTexture(He),tt=He)}function Vi(He,Cn,Wt){Wt===void 0&&(tt===null?Wt=i.TEXTURE0+ge-1:Wt=tt);let Fn=mt[Wt];Fn===void 0&&(Fn={type:void 0,texture:void 0},mt[Wt]=Fn),(Fn.type!==He||Fn.texture!==Cn)&&(tt!==Wt&&(i.activeTexture(Wt),tt=Wt),i.bindTexture(He,Cn||Sn[He]),Fn.type=He,Fn.texture=Cn)}function Me(){const He=mt[tt];He!==void 0&&He.type!==void 0&&(i.bindTexture(He.type,null),He.type=void 0,He.texture=void 0)}function fe(){try{i.compressedTexImage2D(...arguments)}catch(He){console.error("THREE.WebGLState:",He)}}function ft(){try{i.compressedTexImage3D(...arguments)}catch(He){console.error("THREE.WebGLState:",He)}}function Ft(){try{i.texSubImage2D(...arguments)}catch(He){console.error("THREE.WebGLState:",He)}}function $t(){try{i.texSubImage3D(...arguments)}catch(He){console.error("THREE.WebGLState:",He)}}function kt(){try{i.compressedTexSubImage2D(...arguments)}catch(He){console.error("THREE.WebGLState:",He)}}function Jn(){try{i.compressedTexSubImage3D(...arguments)}catch(He){console.error("THREE.WebGLState:",He)}}function An(){try{i.texStorage2D(...arguments)}catch(He){console.error("THREE.WebGLState:",He)}}function Hn(){try{i.texStorage3D(...arguments)}catch(He){console.error("THREE.WebGLState:",He)}}function Zn(){try{i.texImage2D(...arguments)}catch(He){console.error("THREE.WebGLState:",He)}}function Vt(){try{i.texImage3D(...arguments)}catch(He){console.error("THREE.WebGLState:",He)}}function Ln(He){In.equals(He)===!1&&(i.scissor(He.x,He.y,He.z,He.w),In.copy(He))}function fr(He){vt.equals(He)===!1&&(i.viewport(He.x,He.y,He.z,He.w),vt.copy(He))}function ur(He,Cn){let Wt=u.get(Cn);Wt===void 0&&(Wt=new WeakMap,u.set(Cn,Wt));let Fn=Wt.get(He);Fn===void 0&&(Fn=i.getUniformBlockIndex(Cn,He.name),Wt.set(He,Fn))}function Mn(He,Cn){const Fn=u.get(Cn).get(He);c.get(Cn)!==Fn&&(i.uniformBlockBinding(Cn,Fn,He.__bindingPointIndex),c.set(Cn,Fn))}function cr(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),o.setReversed(!1),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),f={},tt=null,mt={},m={},v=new WeakMap,x=[],T=null,P=!1,R=null,M=null,O=null,C=null,L=null,Y=null,J=null,z=new yn(0,0,0),ne=0,K=!1,$=null,he=null,Ce=null,Pe=null,je=null,In.set(0,0,i.canvas.width,i.canvas.height),vt.set(0,0,i.canvas.width,i.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:ln,disable:Xn,bindFramebuffer:Yr,drawBuffers:lr,useProgram:Kr,setBlending:Ue,setMaterial:vo,setFlipSided:ui,setCullFace:qr,setLineWidth:Dn,setPolygonOffset:ni,setScissorTest:$n,activeTexture:Sr,bindTexture:Vi,unbindTexture:Me,compressedTexImage2D:fe,compressedTexImage3D:ft,texImage2D:Zn,texImage3D:Vt,updateUBOMapping:ur,uniformBlockBinding:Mn,texStorage2D:An,texStorage3D:Hn,texSubImage2D:Ft,texSubImage3D:$t,compressedTexSubImage2D:kt,compressedTexSubImage3D:Jn,scissor:Ln,viewport:fr,reset:cr}}function VJe(i,e,t,n,r,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new mn,f=new WeakMap;let m;const v=new WeakMap;let x=!1;try{x=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function T(Me,fe){return x?new OffscreenCanvas(Me,fe):TM("canvas")}function P(Me,fe,ft){let Ft=1;const $t=Vi(Me);if(($t.width>ft||$t.height>ft)&&(Ft=ft/Math.max($t.width,$t.height)),Ft<1)if(typeof HTMLImageElement<"u"&&Me instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Me instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Me instanceof ImageBitmap||typeof VideoFrame<"u"&&Me instanceof VideoFrame){const kt=Math.floor(Ft*$t.width),Jn=Math.floor(Ft*$t.height);m===void 0&&(m=T(kt,Jn));const An=fe?T(kt,Jn):m;return An.width=kt,An.height=Jn,An.getContext("2d").drawImage(Me,0,0,kt,Jn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+$t.width+"x"+$t.height+") to ("+kt+"x"+Jn+")."),An}else return"data"in Me&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+$t.width+"x"+$t.height+")."),Me;return Me}function R(Me){return Me.generateMipmaps}function M(Me){i.generateMipmap(Me)}function O(Me){return Me.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:Me.isWebGL3DRenderTarget?i.TEXTURE_3D:Me.isWebGLArrayRenderTarget||Me.isCompressedArrayTexture?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D}function C(Me,fe,ft,Ft,$t=!1){if(Me!==null){if(i[Me]!==void 0)return i[Me];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Me+"'")}let kt=fe;if(fe===i.RED&&(ft===i.FLOAT&&(kt=i.R32F),ft===i.HALF_FLOAT&&(kt=i.R16F),ft===i.UNSIGNED_BYTE&&(kt=i.R8)),fe===i.RED_INTEGER&&(ft===i.UNSIGNED_BYTE&&(kt=i.R8UI),ft===i.UNSIGNED_SHORT&&(kt=i.R16UI),ft===i.UNSIGNED_INT&&(kt=i.R32UI),ft===i.BYTE&&(kt=i.R8I),ft===i.SHORT&&(kt=i.R16I),ft===i.INT&&(kt=i.R32I)),fe===i.RG&&(ft===i.FLOAT&&(kt=i.RG32F),ft===i.HALF_FLOAT&&(kt=i.RG16F),ft===i.UNSIGNED_BYTE&&(kt=i.RG8)),fe===i.RG_INTEGER&&(ft===i.UNSIGNED_BYTE&&(kt=i.RG8UI),ft===i.UNSIGNED_SHORT&&(kt=i.RG16UI),ft===i.UNSIGNED_INT&&(kt=i.RG32UI),ft===i.BYTE&&(kt=i.RG8I),ft===i.SHORT&&(kt=i.RG16I),ft===i.INT&&(kt=i.RG32I)),fe===i.RGB_INTEGER&&(ft===i.UNSIGNED_BYTE&&(kt=i.RGB8UI),ft===i.UNSIGNED_SHORT&&(kt=i.RGB16UI),ft===i.UNSIGNED_INT&&(kt=i.RGB32UI),ft===i.BYTE&&(kt=i.RGB8I),ft===i.SHORT&&(kt=i.RGB16I),ft===i.INT&&(kt=i.RGB32I)),fe===i.RGBA_INTEGER&&(ft===i.UNSIGNED_BYTE&&(kt=i.RGBA8UI),ft===i.UNSIGNED_SHORT&&(kt=i.RGBA16UI),ft===i.UNSIGNED_INT&&(kt=i.RGBA32UI),ft===i.BYTE&&(kt=i.RGBA8I),ft===i.SHORT&&(kt=i.RGBA16I),ft===i.INT&&(kt=i.RGBA32I)),fe===i.RGB&&ft===i.UNSIGNED_INT_5_9_9_9_REV&&(kt=i.RGB9_E5),fe===i.RGBA){const Jn=$t?$_:rr.getTransfer(Ft);ft===i.FLOAT&&(kt=i.RGBA32F),ft===i.HALF_FLOAT&&(kt=i.RGBA16F),ft===i.UNSIGNED_BYTE&&(kt=Jn===zn?i.SRGB8_ALPHA8:i.RGBA8),ft===i.UNSIGNED_SHORT_4_4_4_4&&(kt=i.RGBA4),ft===i.UNSIGNED_SHORT_5_5_5_1&&(kt=i.RGB5_A1)}return(kt===i.R16F||kt===i.R32F||kt===i.RG16F||kt===i.RG32F||kt===i.RGBA16F||kt===i.RGBA32F)&&e.get("EXT_color_buffer_float"),kt}function L(Me,fe){let ft;return Me?fe===null||fe===fs||fe===pc?ft=i.DEPTH24_STENCIL8:fe===Ys?ft=i.DEPTH32F_STENCIL8:fe===_d&&(ft=i.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):fe===null||fe===fs||fe===pc?ft=i.DEPTH_COMPONENT24:fe===Ys?ft=i.DEPTH_COMPONENT32F:fe===_d&&(ft=i.DEPTH_COMPONENT16),ft}function Y(Me,fe){return R(Me)===!0||Me.isFramebufferTexture&&Me.minFilter!==es&&Me.minFilter!==_s?Math.log2(Math.max(fe.width,fe.height))+1:Me.mipmaps!==void 0&&Me.mipmaps.length>0?Me.mipmaps.length:Me.isCompressedTexture&&Array.isArray(Me.image)?fe.mipmaps.length:1}function J(Me){const fe=Me.target;fe.removeEventListener("dispose",J),ne(fe),fe.isVideoTexture&&f.delete(fe)}function z(Me){const fe=Me.target;fe.removeEventListener("dispose",z),$(fe)}function ne(Me){const fe=n.get(Me);if(fe.__webglInit===void 0)return;const ft=Me.source,Ft=v.get(ft);if(Ft){const $t=Ft[fe.__cacheKey];$t.usedTimes--,$t.usedTimes===0&&K(Me),Object.keys(Ft).length===0&&v.delete(ft)}n.remove(Me)}function K(Me){const fe=n.get(Me);i.deleteTexture(fe.__webglTexture);const ft=Me.source,Ft=v.get(ft);delete Ft[fe.__cacheKey],o.memory.textures--}function $(Me){const fe=n.get(Me);if(Me.depthTexture&&(Me.depthTexture.dispose(),n.remove(Me.depthTexture)),Me.isWebGLCubeRenderTarget)for(let Ft=0;Ft<6;Ft++){if(Array.isArray(fe.__webglFramebuffer[Ft]))for(let $t=0;$t<fe.__webglFramebuffer[Ft].length;$t++)i.deleteFramebuffer(fe.__webglFramebuffer[Ft][$t]);else i.deleteFramebuffer(fe.__webglFramebuffer[Ft]);fe.__webglDepthbuffer&&i.deleteRenderbuffer(fe.__webglDepthbuffer[Ft])}else{if(Array.isArray(fe.__webglFramebuffer))for(let Ft=0;Ft<fe.__webglFramebuffer.length;Ft++)i.deleteFramebuffer(fe.__webglFramebuffer[Ft]);else i.deleteFramebuffer(fe.__webglFramebuffer);if(fe.__webglDepthbuffer&&i.deleteRenderbuffer(fe.__webglDepthbuffer),fe.__webglMultisampledFramebuffer&&i.deleteFramebuffer(fe.__webglMultisampledFramebuffer),fe.__webglColorRenderbuffer)for(let Ft=0;Ft<fe.__webglColorRenderbuffer.length;Ft++)fe.__webglColorRenderbuffer[Ft]&&i.deleteRenderbuffer(fe.__webglColorRenderbuffer[Ft]);fe.__webglDepthRenderbuffer&&i.deleteRenderbuffer(fe.__webglDepthRenderbuffer)}const ft=Me.textures;for(let Ft=0,$t=ft.length;Ft<$t;Ft++){const kt=n.get(ft[Ft]);kt.__webglTexture&&(i.deleteTexture(kt.__webglTexture),o.memory.textures--),n.remove(ft[Ft])}n.remove(Me)}let he=0;function Ce(){he=0}function Pe(){const Me=he;return Me>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Me+" texture units while this GPU supports only "+r.maxTextures),he+=1,Me}function je(Me){const fe=[];return fe.push(Me.wrapS),fe.push(Me.wrapT),fe.push(Me.wrapR||0),fe.push(Me.magFilter),fe.push(Me.minFilter),fe.push(Me.anisotropy),fe.push(Me.internalFormat),fe.push(Me.format),fe.push(Me.type),fe.push(Me.generateMipmaps),fe.push(Me.premultiplyAlpha),fe.push(Me.flipY),fe.push(Me.unpackAlignment),fe.push(Me.colorSpace),fe.join()}function ge(Me,fe){const ft=n.get(Me);if(Me.isVideoTexture&&$n(Me),Me.isRenderTargetTexture===!1&&Me.version>0&&ft.__version!==Me.version){const Ft=Me.image;if(Ft===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ft.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Sn(ft,Me,fe);return}}t.bindTexture(i.TEXTURE_2D,ft.__webglTexture,i.TEXTURE0+fe)}function Xe(Me,fe){const ft=n.get(Me);if(Me.version>0&&ft.__version!==Me.version){Sn(ft,Me,fe);return}t.bindTexture(i.TEXTURE_2D_ARRAY,ft.__webglTexture,i.TEXTURE0+fe)}function Fe(Me,fe){const ft=n.get(Me);if(Me.version>0&&ft.__version!==Me.version){Sn(ft,Me,fe);return}t.bindTexture(i.TEXTURE_3D,ft.__webglTexture,i.TEXTURE0+fe)}function Ne(Me,fe){const ft=n.get(Me);if(Me.version>0&&ft.__version!==Me.version){ln(ft,Me,fe);return}t.bindTexture(i.TEXTURE_CUBE_MAP,ft.__webglTexture,i.TEXTURE0+fe)}const tt={[tu]:i.REPEAT,[ta]:i.CLAMP_TO_EDGE,[x4]:i.MIRRORED_REPEAT},mt={[es]:i.NEAREST,[Kne]:i.NEAREST_MIPMAP_NEAREST,[T1]:i.NEAREST_MIPMAP_LINEAR,[_s]:i.LINEAR,[r_]:i.LINEAR_MIPMAP_NEAREST,[oc]:i.LINEAR_MIPMAP_LINEAR},Ht={[ere]:i.NEVER,[sre]:i.ALWAYS,[VU]:i.LESS,[GU]:i.LEQUAL,[tre]:i.EQUAL,[ire]:i.GEQUAL,[nre]:i.GREATER,[rre]:i.NOTEQUAL};function pn(Me,fe){if(fe.type===Ys&&e.has("OES_texture_float_linear")===!1&&(fe.magFilter===_s||fe.magFilter===r_||fe.magFilter===T1||fe.magFilter===oc||fe.minFilter===_s||fe.minFilter===r_||fe.minFilter===T1||fe.minFilter===oc)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),i.texParameteri(Me,i.TEXTURE_WRAP_S,tt[fe.wrapS]),i.texParameteri(Me,i.TEXTURE_WRAP_T,tt[fe.wrapT]),(Me===i.TEXTURE_3D||Me===i.TEXTURE_2D_ARRAY)&&i.texParameteri(Me,i.TEXTURE_WRAP_R,tt[fe.wrapR]),i.texParameteri(Me,i.TEXTURE_MAG_FILTER,mt[fe.magFilter]),i.texParameteri(Me,i.TEXTURE_MIN_FILTER,mt[fe.minFilter]),fe.compareFunction&&(i.texParameteri(Me,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(Me,i.TEXTURE_COMPARE_FUNC,Ht[fe.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(fe.magFilter===es||fe.minFilter!==T1&&fe.minFilter!==oc||fe.type===Ys&&e.has("OES_texture_float_linear")===!1)return;if(fe.anisotropy>1||n.get(fe).__currentAnisotropy){const ft=e.get("EXT_texture_filter_anisotropic");i.texParameterf(Me,ft.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(fe.anisotropy,r.getMaxAnisotropy())),n.get(fe).__currentAnisotropy=fe.anisotropy}}}function In(Me,fe){let ft=!1;Me.__webglInit===void 0&&(Me.__webglInit=!0,fe.addEventListener("dispose",J));const Ft=fe.source;let $t=v.get(Ft);$t===void 0&&($t={},v.set(Ft,$t));const kt=je(fe);if(kt!==Me.__cacheKey){$t[kt]===void 0&&($t[kt]={texture:i.createTexture(),usedTimes:0},o.memory.textures++,ft=!0),$t[kt].usedTimes++;const Jn=$t[Me.__cacheKey];Jn!==void 0&&($t[Me.__cacheKey].usedTimes--,Jn.usedTimes===0&&K(fe)),Me.__cacheKey=kt,Me.__webglTexture=$t[kt].texture}return ft}function vt(Me,fe,ft){return Math.floor(Math.floor(Me/ft)/fe)}function Ut(Me,fe,ft,Ft){const kt=Me.updateRanges;if(kt.length===0)t.texSubImage2D(i.TEXTURE_2D,0,0,0,fe.width,fe.height,ft,Ft,fe.data);else{kt.sort((Vt,Ln)=>Vt.start-Ln.start);let Jn=0;for(let Vt=1;Vt<kt.length;Vt++){const Ln=kt[Jn],fr=kt[Vt],ur=Ln.start+Ln.count,Mn=vt(fr.start,fe.width,4),cr=vt(Ln.start,fe.width,4);fr.start<=ur+1&&Mn===cr&&vt(fr.start+fr.count-1,fe.width,4)===Mn?Ln.count=Math.max(Ln.count,fr.start+fr.count-Ln.start):(++Jn,kt[Jn]=fr)}kt.length=Jn+1;const An=i.getParameter(i.UNPACK_ROW_LENGTH),Hn=i.getParameter(i.UNPACK_SKIP_PIXELS),Zn=i.getParameter(i.UNPACK_SKIP_ROWS);i.pixelStorei(i.UNPACK_ROW_LENGTH,fe.width);for(let Vt=0,Ln=kt.length;Vt<Ln;Vt++){const fr=kt[Vt],ur=Math.floor(fr.start/4),Mn=Math.ceil(fr.count/4),cr=ur%fe.width,He=Math.floor(ur/fe.width),Cn=Mn,Wt=1;i.pixelStorei(i.UNPACK_SKIP_PIXELS,cr),i.pixelStorei(i.UNPACK_SKIP_ROWS,He),t.texSubImage2D(i.TEXTURE_2D,0,cr,He,Cn,Wt,ft,Ft,fe.data)}Me.clearUpdateRanges(),i.pixelStorei(i.UNPACK_ROW_LENGTH,An),i.pixelStorei(i.UNPACK_SKIP_PIXELS,Hn),i.pixelStorei(i.UNPACK_SKIP_ROWS,Zn)}}function Sn(Me,fe,ft){let Ft=i.TEXTURE_2D;(fe.isDataArrayTexture||fe.isCompressedArrayTexture)&&(Ft=i.TEXTURE_2D_ARRAY),fe.isData3DTexture&&(Ft=i.TEXTURE_3D);const $t=In(Me,fe),kt=fe.source;t.bindTexture(Ft,Me.__webglTexture,i.TEXTURE0+ft);const Jn=n.get(kt);if(kt.version!==Jn.__version||$t===!0){t.activeTexture(i.TEXTURE0+ft);const An=rr.getPrimaries(rr.workingColorSpace),Hn=fe.colorSpace===Xa?null:rr.getPrimaries(fe.colorSpace),Zn=fe.colorSpace===Xa||An===Hn?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,fe.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,fe.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,fe.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Zn);let Vt=P(fe.image,!1,r.maxTextureSize);Vt=Sr(fe,Vt);const Ln=s.convert(fe.format,fe.colorSpace),fr=s.convert(fe.type);let ur=C(fe.internalFormat,Ln,fr,fe.colorSpace,fe.isVideoTexture);pn(Ft,fe);let Mn;const cr=fe.mipmaps,He=fe.isVideoTexture!==!0,Cn=Jn.__version===void 0||$t===!0,Wt=kt.dataReady,Fn=Y(fe,Vt);if(fe.isDepthTexture)ur=L(fe.format===mc,fe.type),Cn&&(He?t.texStorage2D(i.TEXTURE_2D,1,ur,Vt.width,Vt.height):t.texImage2D(i.TEXTURE_2D,0,ur,Vt.width,Vt.height,0,Ln,fr,null));else if(fe.isDataTexture)if(cr.length>0){He&&Cn&&t.texStorage2D(i.TEXTURE_2D,Fn,ur,cr[0].width,cr[0].height);for(let cn=0,zt=cr.length;cn<zt;cn++)Mn=cr[cn],He?Wt&&t.texSubImage2D(i.TEXTURE_2D,cn,0,0,Mn.width,Mn.height,Ln,fr,Mn.data):t.texImage2D(i.TEXTURE_2D,cn,ur,Mn.width,Mn.height,0,Ln,fr,Mn.data);fe.generateMipmaps=!1}else He?(Cn&&t.texStorage2D(i.TEXTURE_2D,Fn,ur,Vt.width,Vt.height),Wt&&Ut(fe,Vt,Ln,fr)):t.texImage2D(i.TEXTURE_2D,0,ur,Vt.width,Vt.height,0,Ln,fr,Vt.data);else if(fe.isCompressedTexture)if(fe.isCompressedArrayTexture){He&&Cn&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Fn,ur,cr[0].width,cr[0].height,Vt.depth);for(let cn=0,zt=cr.length;cn<zt;cn++)if(Mn=cr[cn],fe.format!==xs)if(Ln!==null)if(He){if(Wt)if(fe.layerUpdates.size>0){const On=N7e(Mn.width,Mn.height,fe.format,fe.type);for(const pr of fe.layerUpdates){const Gi=Mn.data.subarray(pr*On/Mn.data.BYTES_PER_ELEMENT,(pr+1)*On/Mn.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,cn,0,0,pr,Mn.width,Mn.height,1,Ln,Gi)}fe.clearLayerUpdates()}else t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,cn,0,0,0,Mn.width,Mn.height,Vt.depth,Ln,Mn.data)}else t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,cn,ur,Mn.width,Mn.height,Vt.depth,0,Mn.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else He?Wt&&t.texSubImage3D(i.TEXTURE_2D_ARRAY,cn,0,0,0,Mn.width,Mn.height,Vt.depth,Ln,fr,Mn.data):t.texImage3D(i.TEXTURE_2D_ARRAY,cn,ur,Mn.width,Mn.height,Vt.depth,0,Ln,fr,Mn.data)}else{He&&Cn&&t.texStorage2D(i.TEXTURE_2D,Fn,ur,cr[0].width,cr[0].height);for(let cn=0,zt=cr.length;cn<zt;cn++)Mn=cr[cn],fe.format!==xs?Ln!==null?He?Wt&&t.compressedTexSubImage2D(i.TEXTURE_2D,cn,0,0,Mn.width,Mn.height,Ln,Mn.data):t.compressedTexImage2D(i.TEXTURE_2D,cn,ur,Mn.width,Mn.height,0,Mn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):He?Wt&&t.texSubImage2D(i.TEXTURE_2D,cn,0,0,Mn.width,Mn.height,Ln,fr,Mn.data):t.texImage2D(i.TEXTURE_2D,cn,ur,Mn.width,Mn.height,0,Ln,fr,Mn.data)}else if(fe.isDataArrayTexture)if(He){if(Cn&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Fn,ur,Vt.width,Vt.height,Vt.depth),Wt)if(fe.layerUpdates.size>0){const cn=N7e(Vt.width,Vt.height,fe.format,fe.type);for(const zt of fe.layerUpdates){const On=Vt.data.subarray(zt*cn/Vt.data.BYTES_PER_ELEMENT,(zt+1)*cn/Vt.data.BYTES_PER_ELEMENT);t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,zt,Vt.width,Vt.height,1,Ln,fr,On)}fe.clearLayerUpdates()}else t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,Vt.width,Vt.height,Vt.depth,Ln,fr,Vt.data)}else t.texImage3D(i.TEXTURE_2D_ARRAY,0,ur,Vt.width,Vt.height,Vt.depth,0,Ln,fr,Vt.data);else if(fe.isData3DTexture)He?(Cn&&t.texStorage3D(i.TEXTURE_3D,Fn,ur,Vt.width,Vt.height,Vt.depth),Wt&&t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,Vt.width,Vt.height,Vt.depth,Ln,fr,Vt.data)):t.texImage3D(i.TEXTURE_3D,0,ur,Vt.width,Vt.height,Vt.depth,0,Ln,fr,Vt.data);else if(fe.isFramebufferTexture){if(Cn)if(He)t.texStorage2D(i.TEXTURE_2D,Fn,ur,Vt.width,Vt.height);else{let cn=Vt.width,zt=Vt.height;for(let On=0;On<Fn;On++)t.texImage2D(i.TEXTURE_2D,On,ur,cn,zt,0,Ln,fr,null),cn>>=1,zt>>=1}}else if(cr.length>0){if(He&&Cn){const cn=Vi(cr[0]);t.texStorage2D(i.TEXTURE_2D,Fn,ur,cn.width,cn.height)}for(let cn=0,zt=cr.length;cn<zt;cn++)Mn=cr[cn],He?Wt&&t.texSubImage2D(i.TEXTURE_2D,cn,0,0,Ln,fr,Mn):t.texImage2D(i.TEXTURE_2D,cn,ur,Ln,fr,Mn);fe.generateMipmaps=!1}else if(He){if(Cn){const cn=Vi(Vt);t.texStorage2D(i.TEXTURE_2D,Fn,ur,cn.width,cn.height)}Wt&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,Ln,fr,Vt)}else t.texImage2D(i.TEXTURE_2D,0,ur,Ln,fr,Vt);R(fe)&&M(Ft),Jn.__version=kt.version,fe.onUpdate&&fe.onUpdate(fe)}Me.__version=fe.version}function ln(Me,fe,ft){if(fe.image.length!==6)return;const Ft=In(Me,fe),$t=fe.source;t.bindTexture(i.TEXTURE_CUBE_MAP,Me.__webglTexture,i.TEXTURE0+ft);const kt=n.get($t);if($t.version!==kt.__version||Ft===!0){t.activeTexture(i.TEXTURE0+ft);const Jn=rr.getPrimaries(rr.workingColorSpace),An=fe.colorSpace===Xa?null:rr.getPrimaries(fe.colorSpace),Hn=fe.colorSpace===Xa||Jn===An?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,fe.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,fe.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,fe.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Hn);const Zn=fe.isCompressedTexture||fe.image[0].isCompressedTexture,Vt=fe.image[0]&&fe.image[0].isDataTexture,Ln=[];for(let zt=0;zt<6;zt++)!Zn&&!Vt?Ln[zt]=P(fe.image[zt],!0,r.maxCubemapSize):Ln[zt]=Vt?fe.image[zt].image:fe.image[zt],Ln[zt]=Sr(fe,Ln[zt]);const fr=Ln[0],ur=s.convert(fe.format,fe.colorSpace),Mn=s.convert(fe.type),cr=C(fe.internalFormat,ur,Mn,fe.colorSpace),He=fe.isVideoTexture!==!0,Cn=kt.__version===void 0||Ft===!0,Wt=$t.dataReady;let Fn=Y(fe,fr);pn(i.TEXTURE_CUBE_MAP,fe);let cn;if(Zn){He&&Cn&&t.texStorage2D(i.TEXTURE_CUBE_MAP,Fn,cr,fr.width,fr.height);for(let zt=0;zt<6;zt++){cn=Ln[zt].mipmaps;for(let On=0;On<cn.length;On++){const pr=cn[On];fe.format!==xs?ur!==null?He?Wt&&t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+zt,On,0,0,pr.width,pr.height,ur,pr.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+zt,On,cr,pr.width,pr.height,0,pr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):He?Wt&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+zt,On,0,0,pr.width,pr.height,ur,Mn,pr.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+zt,On,cr,pr.width,pr.height,0,ur,Mn,pr.data)}}}else{if(cn=fe.mipmaps,He&&Cn){cn.length>0&&Fn++;const zt=Vi(Ln[0]);t.texStorage2D(i.TEXTURE_CUBE_MAP,Fn,cr,zt.width,zt.height)}for(let zt=0;zt<6;zt++)if(Vt){He?Wt&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+zt,0,0,0,Ln[zt].width,Ln[zt].height,ur,Mn,Ln[zt].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+zt,0,cr,Ln[zt].width,Ln[zt].height,0,ur,Mn,Ln[zt].data);for(let On=0;On<cn.length;On++){const Gi=cn[On].image[zt].image;He?Wt&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+zt,On+1,0,0,Gi.width,Gi.height,ur,Mn,Gi.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+zt,On+1,cr,Gi.width,Gi.height,0,ur,Mn,Gi.data)}}else{He?Wt&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+zt,0,0,0,ur,Mn,Ln[zt]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+zt,0,cr,ur,Mn,Ln[zt]);for(let On=0;On<cn.length;On++){const pr=cn[On];He?Wt&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+zt,On+1,0,0,ur,Mn,pr.image[zt]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+zt,On+1,cr,ur,Mn,pr.image[zt])}}}R(fe)&&M(i.TEXTURE_CUBE_MAP),kt.__version=$t.version,fe.onUpdate&&fe.onUpdate(fe)}Me.__version=fe.version}function Xn(Me,fe,ft,Ft,$t,kt){const Jn=s.convert(ft.format,ft.colorSpace),An=s.convert(ft.type),Hn=C(ft.internalFormat,Jn,An,ft.colorSpace),Zn=n.get(fe),Vt=n.get(ft);if(Vt.__renderTarget=fe,!Zn.__hasExternalTextures){const Ln=Math.max(1,fe.width>>kt),fr=Math.max(1,fe.height>>kt);$t===i.TEXTURE_3D||$t===i.TEXTURE_2D_ARRAY?t.texImage3D($t,kt,Hn,Ln,fr,fe.depth,0,Jn,An,null):t.texImage2D($t,kt,Hn,Ln,fr,0,Jn,An,null)}t.bindFramebuffer(i.FRAMEBUFFER,Me),ni(fe)?a.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,Ft,$t,Vt.__webglTexture,0,Dn(fe)):($t===i.TEXTURE_2D||$t>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&$t<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,Ft,$t,Vt.__webglTexture,kt),t.bindFramebuffer(i.FRAMEBUFFER,null)}function Yr(Me,fe,ft){if(i.bindRenderbuffer(i.RENDERBUFFER,Me),fe.depthBuffer){const Ft=fe.depthTexture,$t=Ft&&Ft.isDepthTexture?Ft.type:null,kt=L(fe.stencilBuffer,$t),Jn=fe.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,An=Dn(fe);ni(fe)?a.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,An,kt,fe.width,fe.height):ft?i.renderbufferStorageMultisample(i.RENDERBUFFER,An,kt,fe.width,fe.height):i.renderbufferStorage(i.RENDERBUFFER,kt,fe.width,fe.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,Jn,i.RENDERBUFFER,Me)}else{const Ft=fe.textures;for(let $t=0;$t<Ft.length;$t++){const kt=Ft[$t],Jn=s.convert(kt.format,kt.colorSpace),An=s.convert(kt.type),Hn=C(kt.internalFormat,Jn,An,kt.colorSpace),Zn=Dn(fe);ft&&ni(fe)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,Zn,Hn,fe.width,fe.height):ni(fe)?a.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Zn,Hn,fe.width,fe.height):i.renderbufferStorage(i.RENDERBUFFER,Hn,fe.width,fe.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function lr(Me,fe){if(fe&&fe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,Me),!(fe.depthTexture&&fe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Ft=n.get(fe.depthTexture);Ft.__renderTarget=fe,(!Ft.__webglTexture||fe.depthTexture.image.width!==fe.width||fe.depthTexture.image.height!==fe.height)&&(fe.depthTexture.image.width=fe.width,fe.depthTexture.image.height=fe.height,fe.depthTexture.needsUpdate=!0),ge(fe.depthTexture,0);const $t=Ft.__webglTexture,kt=Dn(fe);if(fe.depthTexture.format===Zc)ni(fe)?a.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,$t,0,kt):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,$t,0);else if(fe.depthTexture.format===mc)ni(fe)?a.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,$t,0,kt):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,$t,0);else throw new Error("Unknown depthTexture format")}function Kr(Me){const fe=n.get(Me),ft=Me.isWebGLCubeRenderTarget===!0;if(fe.__boundDepthTexture!==Me.depthTexture){const Ft=Me.depthTexture;if(fe.__depthDisposeCallback&&fe.__depthDisposeCallback(),Ft){const $t=()=>{delete fe.__boundDepthTexture,delete fe.__depthDisposeCallback,Ft.removeEventListener("dispose",$t)};Ft.addEventListener("dispose",$t),fe.__depthDisposeCallback=$t}fe.__boundDepthTexture=Ft}if(Me.depthTexture&&!fe.__autoAllocateDepthBuffer){if(ft)throw new Error("target.depthTexture not supported in Cube render targets");const Ft=Me.texture.mipmaps;Ft&&Ft.length>0?lr(fe.__webglFramebuffer[0],Me):lr(fe.__webglFramebuffer,Me)}else if(ft){fe.__webglDepthbuffer=[];for(let Ft=0;Ft<6;Ft++)if(t.bindFramebuffer(i.FRAMEBUFFER,fe.__webglFramebuffer[Ft]),fe.__webglDepthbuffer[Ft]===void 0)fe.__webglDepthbuffer[Ft]=i.createRenderbuffer(),Yr(fe.__webglDepthbuffer[Ft],Me,!1);else{const $t=Me.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,kt=fe.__webglDepthbuffer[Ft];i.bindRenderbuffer(i.RENDERBUFFER,kt),i.framebufferRenderbuffer(i.FRAMEBUFFER,$t,i.RENDERBUFFER,kt)}}else{const Ft=Me.texture.mipmaps;if(Ft&&Ft.length>0?t.bindFramebuffer(i.FRAMEBUFFER,fe.__webglFramebuffer[0]):t.bindFramebuffer(i.FRAMEBUFFER,fe.__webglFramebuffer),fe.__webglDepthbuffer===void 0)fe.__webglDepthbuffer=i.createRenderbuffer(),Yr(fe.__webglDepthbuffer,Me,!1);else{const $t=Me.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,kt=fe.__webglDepthbuffer;i.bindRenderbuffer(i.RENDERBUFFER,kt),i.framebufferRenderbuffer(i.FRAMEBUFFER,$t,i.RENDERBUFFER,kt)}}t.bindFramebuffer(i.FRAMEBUFFER,null)}function wi(Me,fe,ft){const Ft=n.get(Me);fe!==void 0&&Xn(Ft.__webglFramebuffer,Me,Me.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),ft!==void 0&&Kr(Me)}function Zr(Me){const fe=Me.texture,ft=n.get(Me),Ft=n.get(fe);Me.addEventListener("dispose",z);const $t=Me.textures,kt=Me.isWebGLCubeRenderTarget===!0,Jn=$t.length>1;if(Jn||(Ft.__webglTexture===void 0&&(Ft.__webglTexture=i.createTexture()),Ft.__version=fe.version,o.memory.textures++),kt){ft.__webglFramebuffer=[];for(let An=0;An<6;An++)if(fe.mipmaps&&fe.mipmaps.length>0){ft.__webglFramebuffer[An]=[];for(let Hn=0;Hn<fe.mipmaps.length;Hn++)ft.__webglFramebuffer[An][Hn]=i.createFramebuffer()}else ft.__webglFramebuffer[An]=i.createFramebuffer()}else{if(fe.mipmaps&&fe.mipmaps.length>0){ft.__webglFramebuffer=[];for(let An=0;An<fe.mipmaps.length;An++)ft.__webglFramebuffer[An]=i.createFramebuffer()}else ft.__webglFramebuffer=i.createFramebuffer();if(Jn)for(let An=0,Hn=$t.length;An<Hn;An++){const Zn=n.get($t[An]);Zn.__webglTexture===void 0&&(Zn.__webglTexture=i.createTexture(),o.memory.textures++)}if(Me.samples>0&&ni(Me)===!1){ft.__webglMultisampledFramebuffer=i.createFramebuffer(),ft.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,ft.__webglMultisampledFramebuffer);for(let An=0;An<$t.length;An++){const Hn=$t[An];ft.__webglColorRenderbuffer[An]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,ft.__webglColorRenderbuffer[An]);const Zn=s.convert(Hn.format,Hn.colorSpace),Vt=s.convert(Hn.type),Ln=C(Hn.internalFormat,Zn,Vt,Hn.colorSpace,Me.isXRRenderTarget===!0),fr=Dn(Me);i.renderbufferStorageMultisample(i.RENDERBUFFER,fr,Ln,Me.width,Me.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+An,i.RENDERBUFFER,ft.__webglColorRenderbuffer[An])}i.bindRenderbuffer(i.RENDERBUFFER,null),Me.depthBuffer&&(ft.__webglDepthRenderbuffer=i.createRenderbuffer(),Yr(ft.__webglDepthRenderbuffer,Me,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(kt){t.bindTexture(i.TEXTURE_CUBE_MAP,Ft.__webglTexture),pn(i.TEXTURE_CUBE_MAP,fe);for(let An=0;An<6;An++)if(fe.mipmaps&&fe.mipmaps.length>0)for(let Hn=0;Hn<fe.mipmaps.length;Hn++)Xn(ft.__webglFramebuffer[An][Hn],Me,fe,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+An,Hn);else Xn(ft.__webglFramebuffer[An],Me,fe,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+An,0);R(fe)&&M(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Jn){for(let An=0,Hn=$t.length;An<Hn;An++){const Zn=$t[An],Vt=n.get(Zn);t.bindTexture(i.TEXTURE_2D,Vt.__webglTexture),pn(i.TEXTURE_2D,Zn),Xn(ft.__webglFramebuffer,Me,Zn,i.COLOR_ATTACHMENT0+An,i.TEXTURE_2D,0),R(Zn)&&M(i.TEXTURE_2D)}t.unbindTexture()}else{let An=i.TEXTURE_2D;if((Me.isWebGL3DRenderTarget||Me.isWebGLArrayRenderTarget)&&(An=Me.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(An,Ft.__webglTexture),pn(An,fe),fe.mipmaps&&fe.mipmaps.length>0)for(let Hn=0;Hn<fe.mipmaps.length;Hn++)Xn(ft.__webglFramebuffer[Hn],Me,fe,i.COLOR_ATTACHMENT0,An,Hn);else Xn(ft.__webglFramebuffer,Me,fe,i.COLOR_ATTACHMENT0,An,0);R(fe)&&M(An),t.unbindTexture()}Me.depthBuffer&&Kr(Me)}function Ue(Me){const fe=Me.textures;for(let ft=0,Ft=fe.length;ft<Ft;ft++){const $t=fe[ft];if(R($t)){const kt=O(Me),Jn=n.get($t).__webglTexture;t.bindTexture(kt,Jn),M(kt),t.unbindTexture()}}}const vo=[],ui=[];function qr(Me){if(Me.samples>0){if(ni(Me)===!1){const fe=Me.textures,ft=Me.width,Ft=Me.height;let $t=i.COLOR_BUFFER_BIT;const kt=Me.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Jn=n.get(Me),An=fe.length>1;if(An)for(let Zn=0;Zn<fe.length;Zn++)t.bindFramebuffer(i.FRAMEBUFFER,Jn.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Zn,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,Jn.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Zn,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,Jn.__webglMultisampledFramebuffer);const Hn=Me.texture.mipmaps;Hn&&Hn.length>0?t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Jn.__webglFramebuffer[0]):t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Jn.__webglFramebuffer);for(let Zn=0;Zn<fe.length;Zn++){if(Me.resolveDepthBuffer&&(Me.depthBuffer&&($t|=i.DEPTH_BUFFER_BIT),Me.stencilBuffer&&Me.resolveStencilBuffer&&($t|=i.STENCIL_BUFFER_BIT)),An){i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,Jn.__webglColorRenderbuffer[Zn]);const Vt=n.get(fe[Zn]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,Vt,0)}i.blitFramebuffer(0,0,ft,Ft,0,0,ft,Ft,$t,i.NEAREST),c===!0&&(vo.length=0,ui.length=0,vo.push(i.COLOR_ATTACHMENT0+Zn),Me.depthBuffer&&Me.resolveDepthBuffer===!1&&(vo.push(kt),ui.push(kt),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,ui)),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,vo))}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),An)for(let Zn=0;Zn<fe.length;Zn++){t.bindFramebuffer(i.FRAMEBUFFER,Jn.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Zn,i.RENDERBUFFER,Jn.__webglColorRenderbuffer[Zn]);const Vt=n.get(fe[Zn]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,Jn.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Zn,i.TEXTURE_2D,Vt,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Jn.__webglMultisampledFramebuffer)}else if(Me.depthBuffer&&Me.resolveDepthBuffer===!1&&c){const fe=Me.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[fe])}}}function Dn(Me){return Math.min(r.maxSamples,Me.samples)}function ni(Me){const fe=n.get(Me);return Me.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&fe.__useRenderToTexture!==!1}function $n(Me){const fe=o.render.frame;f.get(Me)!==fe&&(f.set(Me,fe),Me.update())}function Sr(Me,fe){const ft=Me.colorSpace,Ft=Me.format,$t=Me.type;return Me.isCompressedTexture===!0||Me.isVideoTexture===!0||ft!==_l&&ft!==Xa&&(rr.getTransfer(ft)===zn?(Ft!==xs||$t!==ps)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ft)),fe}function Vi(Me){return typeof HTMLImageElement<"u"&&Me instanceof HTMLImageElement?(u.width=Me.naturalWidth||Me.width,u.height=Me.naturalHeight||Me.height):typeof VideoFrame<"u"&&Me instanceof VideoFrame?(u.width=Me.displayWidth,u.height=Me.displayHeight):(u.width=Me.width,u.height=Me.height),u}this.allocateTextureUnit=Pe,this.resetTextureUnits=Ce,this.setTexture2D=ge,this.setTexture2DArray=Xe,this.setTexture3D=Fe,this.setTextureCube=Ne,this.rebindTextures=wi,this.setupRenderTarget=Zr,this.updateRenderTargetMipmap=Ue,this.updateMultisampleRenderTarget=qr,this.setupDepthRenderbuffer=Kr,this.setupFrameBufferTexture=Xn,this.useMultisampledRTT=ni}function GJe(i,e){function t(n,r=Xa){let s;const o=rr.getTransfer(r);if(n===ps)return i.UNSIGNED_BYTE;if(n===LU)return i.UNSIGNED_SHORT_4_4_4_4;if(n===UU)return i.UNSIGNED_SHORT_5_5_5_1;if(n===zU)return i.UNSIGNED_INT_5_9_9_9_REV;if(n===e4)return i.BYTE;if(n===t4)return i.SHORT;if(n===_d)return i.UNSIGNED_SHORT;if(n===qa)return i.INT;if(n===fs)return i.UNSIGNED_INT;if(n===Ys)return i.FLOAT;if(n===Aa)return i.HALF_FLOAT;if(n===Zne)return i.ALPHA;if(n===iC)return i.RGB;if(n===xs)return i.RGBA;if(n===Zc)return i.DEPTH_COMPONENT;if(n===mc)return i.DEPTH_STENCIL;if(n===sC)return i.RED;if(n===px)return i.RED_INTEGER;if(n===E1)return i.RG;if(n===mx)return i.RG_INTEGER;if(n===gx)return i.RGBA_INTEGER;if(n===n4||n===D2||n===F2||n===O2)if(o===zn)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(n===n4)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===D2)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===F2)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===O2)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(n===n4)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===D2)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===F2)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===O2)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===gM||n===yM||n===vM||n===_M)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(n===gM)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===yM)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===vM)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===_M)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===xM||n===C_||n===A_)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(n===xM||n===C_)return o===zn?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===A_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===R_||n===P_||n===N_||n===I_||n===k_||n===D_||n===F_||n===O_||n===B_||n===L_||n===U_||n===z_||n===V_||n===G_)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(n===R_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===P_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===N_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===I_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===k_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===D_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===F_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===O_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===B_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===L_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===U_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===z_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===V_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===G_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===r4||n===Cee||n===Aee)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(n===r4)return o===zn?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Cee)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Aee)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===Qne||n===bM||n===SM||n===wM)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(n===r4)return s.COMPRESSED_RED_RGTC1_EXT;if(n===bM)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===SM)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===wM)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===pc?i.UNSIGNED_INT_24_8:i[n]!==void 0?i[n]:null}return{convert:t}}const $Je=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,HJe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class jJe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(this.texture===null){const r=new Ao,s=e.properties.get(r);s.__webglTexture=t.texture,(t.depthNear!==n.depthNear||t.depthFar!==n.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new D0({vertexShader:$Je,fragmentShader:HJe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new dn(new _x(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class WJe extends e0{constructor(e,t){super();const n=this;let r=null,s=1,o=null,a="local-floor",c=1,u=null,f=null,m=null,v=null,x=null,T=null;const P=new jJe,R=t.getContextAttributes();let M=null,O=null;const C=[],L=[],Y=new mn;let J=null;const z=new po;z.viewport=new ir;const ne=new po;ne.viewport=new ir;const K=[z,ne],$=new AAe;let he=null,Ce=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(vt){let Ut=C[vt];return Ut===void 0&&(Ut=new LB,C[vt]=Ut),Ut.getTargetRaySpace()},this.getControllerGrip=function(vt){let Ut=C[vt];return Ut===void 0&&(Ut=new LB,C[vt]=Ut),Ut.getGripSpace()},this.getHand=function(vt){let Ut=C[vt];return Ut===void 0&&(Ut=new LB,C[vt]=Ut),Ut.getHandSpace()};function Pe(vt){const Ut=L.indexOf(vt.inputSource);if(Ut===-1)return;const Sn=C[Ut];Sn!==void 0&&(Sn.update(vt.inputSource,vt.frame,u||o),Sn.dispatchEvent({type:vt.type,data:vt.inputSource}))}function je(){r.removeEventListener("select",Pe),r.removeEventListener("selectstart",Pe),r.removeEventListener("selectend",Pe),r.removeEventListener("squeeze",Pe),r.removeEventListener("squeezestart",Pe),r.removeEventListener("squeezeend",Pe),r.removeEventListener("end",je),r.removeEventListener("inputsourceschange",ge);for(let vt=0;vt<C.length;vt++){const Ut=L[vt];Ut!==null&&(L[vt]=null,C[vt].disconnect(Ut))}he=null,Ce=null,P.reset(),e.setRenderTarget(M),x=null,v=null,m=null,r=null,O=null,In.stop(),n.isPresenting=!1,e.setPixelRatio(J),e.setSize(Y.width,Y.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(vt){s=vt,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(vt){a=vt,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||o},this.setReferenceSpace=function(vt){u=vt},this.getBaseLayer=function(){return v!==null?v:x},this.getBinding=function(){return m},this.getFrame=function(){return T},this.getSession=function(){return r},this.setSession=async function(vt){if(r=vt,r!==null){if(M=e.getRenderTarget(),r.addEventListener("select",Pe),r.addEventListener("selectstart",Pe),r.addEventListener("selectend",Pe),r.addEventListener("squeeze",Pe),r.addEventListener("squeezestart",Pe),r.addEventListener("squeezeend",Pe),r.addEventListener("end",je),r.addEventListener("inputsourceschange",ge),R.xrCompatible!==!0&&await t.makeXRCompatible(),J=e.getPixelRatio(),e.getSize(Y),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let Sn=null,ln=null,Xn=null;R.depth&&(Xn=R.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Sn=R.stencil?mc:Zc,ln=R.stencil?pc:fs);const Yr={colorFormat:t.RGBA8,depthFormat:Xn,scaleFactor:s};m=new XRWebGLBinding(r,t),v=m.createProjectionLayer(Yr),r.updateRenderState({layers:[v]}),e.setPixelRatio(1),e.setSize(v.textureWidth,v.textureHeight,!1),O=new yc(v.textureWidth,v.textureHeight,{format:xs,type:ps,depthTexture:new Jc(v.textureWidth,v.textureHeight,ln,void 0,void 0,void 0,void 0,void 0,void 0,Sn),stencilBuffer:R.stencil,colorSpace:e.outputColorSpace,samples:R.antialias?4:0,resolveDepthBuffer:v.ignoreDepthValues===!1,resolveStencilBuffer:v.ignoreDepthValues===!1})}else{const Sn={antialias:R.antialias,alpha:!0,depth:R.depth,stencil:R.stencil,framebufferScaleFactor:s};x=new XRWebGLLayer(r,t,Sn),r.updateRenderState({baseLayer:x}),e.setPixelRatio(1),e.setSize(x.framebufferWidth,x.framebufferHeight,!1),O=new yc(x.framebufferWidth,x.framebufferHeight,{format:xs,type:ps,colorSpace:e.outputColorSpace,stencilBuffer:R.stencil,resolveDepthBuffer:x.ignoreDepthValues===!1,resolveStencilBuffer:x.ignoreDepthValues===!1})}O.isXRRenderTarget=!0,this.setFoveation(c),u=null,o=await r.requestReferenceSpace(a),In.setContext(r),In.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return P.getDepthTexture()};function ge(vt){for(let Ut=0;Ut<vt.removed.length;Ut++){const Sn=vt.removed[Ut],ln=L.indexOf(Sn);ln>=0&&(L[ln]=null,C[ln].disconnect(Sn))}for(let Ut=0;Ut<vt.added.length;Ut++){const Sn=vt.added[Ut];let ln=L.indexOf(Sn);if(ln===-1){for(let Yr=0;Yr<C.length;Yr++)if(Yr>=L.length){L.push(Sn),ln=Yr;break}else if(L[Yr]===null){L[Yr]=Sn,ln=Yr;break}if(ln===-1)break}const Xn=C[ln];Xn&&Xn.connect(Sn)}}const Xe=new be,Fe=new be;function Ne(vt,Ut,Sn){Xe.setFromMatrixPosition(Ut.matrixWorld),Fe.setFromMatrixPosition(Sn.matrixWorld);const ln=Xe.distanceTo(Fe),Xn=Ut.projectionMatrix.elements,Yr=Sn.projectionMatrix.elements,lr=Xn[14]/(Xn[10]-1),Kr=Xn[14]/(Xn[10]+1),wi=(Xn[9]+1)/Xn[5],Zr=(Xn[9]-1)/Xn[5],Ue=(Xn[8]-1)/Xn[0],vo=(Yr[8]+1)/Yr[0],ui=lr*Ue,qr=lr*vo,Dn=ln/(-Ue+vo),ni=Dn*-Ue;if(Ut.matrixWorld.decompose(vt.position,vt.quaternion,vt.scale),vt.translateX(ni),vt.translateZ(Dn),vt.matrixWorld.compose(vt.position,vt.quaternion,vt.scale),vt.matrixWorldInverse.copy(vt.matrixWorld).invert(),Xn[10]===-1)vt.projectionMatrix.copy(Ut.projectionMatrix),vt.projectionMatrixInverse.copy(Ut.projectionMatrixInverse);else{const $n=lr+Dn,Sr=Kr+Dn,Vi=ui-ni,Me=qr+(ln-ni),fe=wi*Kr/Sr*$n,ft=Zr*Kr/Sr*$n;vt.projectionMatrix.makePerspective(Vi,Me,fe,ft,$n,Sr),vt.projectionMatrixInverse.copy(vt.projectionMatrix).invert()}}function tt(vt,Ut){Ut===null?vt.matrixWorld.copy(vt.matrix):vt.matrixWorld.multiplyMatrices(Ut.matrixWorld,vt.matrix),vt.matrixWorldInverse.copy(vt.matrixWorld).invert()}this.updateCamera=function(vt){if(r===null)return;let Ut=vt.near,Sn=vt.far;P.texture!==null&&(P.depthNear>0&&(Ut=P.depthNear),P.depthFar>0&&(Sn=P.depthFar)),$.near=ne.near=z.near=Ut,$.far=ne.far=z.far=Sn,(he!==$.near||Ce!==$.far)&&(r.updateRenderState({depthNear:$.near,depthFar:$.far}),he=$.near,Ce=$.far),z.layers.mask=vt.layers.mask|2,ne.layers.mask=vt.layers.mask|4,$.layers.mask=z.layers.mask|ne.layers.mask;const ln=vt.parent,Xn=$.cameras;tt($,ln);for(let Yr=0;Yr<Xn.length;Yr++)tt(Xn[Yr],ln);Xn.length===2?Ne($,z,ne):$.projectionMatrix.copy(z.projectionMatrix),mt(vt,$,ln)};function mt(vt,Ut,Sn){Sn===null?vt.matrix.copy(Ut.matrixWorld):(vt.matrix.copy(Sn.matrixWorld),vt.matrix.invert(),vt.matrix.multiply(Ut.matrixWorld)),vt.matrix.decompose(vt.position,vt.quaternion,vt.scale),vt.updateMatrixWorld(!0),vt.projectionMatrix.copy(Ut.projectionMatrix),vt.projectionMatrixInverse.copy(Ut.projectionMatrixInverse),vt.isPerspectiveCamera&&(vt.fov=b4*2*Math.atan(1/vt.projectionMatrix.elements[5]),vt.zoom=1)}this.getCamera=function(){return $},this.getFoveation=function(){if(!(v===null&&x===null))return c},this.setFoveation=function(vt){c=vt,v!==null&&(v.fixedFoveation=vt),x!==null&&x.fixedFoveation!==void 0&&(x.fixedFoveation=vt)},this.hasDepthSensing=function(){return P.texture!==null},this.getDepthSensingMesh=function(){return P.getMesh($)};let Ht=null;function pn(vt,Ut){if(f=Ut.getViewerPose(u||o),T=Ut,f!==null){const Sn=f.views;x!==null&&(e.setRenderTargetFramebuffer(O,x.framebuffer),e.setRenderTarget(O));let ln=!1;Sn.length!==$.cameras.length&&($.cameras.length=0,ln=!0);for(let lr=0;lr<Sn.length;lr++){const Kr=Sn[lr];let wi=null;if(x!==null)wi=x.getViewport(Kr);else{const Ue=m.getViewSubImage(v,Kr);wi=Ue.viewport,lr===0&&(e.setRenderTargetTextures(O,Ue.colorTexture,Ue.depthStencilTexture),e.setRenderTarget(O))}let Zr=K[lr];Zr===void 0&&(Zr=new po,Zr.layers.enable(lr),Zr.viewport=new ir,K[lr]=Zr),Zr.matrix.fromArray(Kr.transform.matrix),Zr.matrix.decompose(Zr.position,Zr.quaternion,Zr.scale),Zr.projectionMatrix.fromArray(Kr.projectionMatrix),Zr.projectionMatrixInverse.copy(Zr.projectionMatrix).invert(),Zr.viewport.set(wi.x,wi.y,wi.width,wi.height),lr===0&&($.matrix.copy(Zr.matrix),$.matrix.decompose($.position,$.quaternion,$.scale)),ln===!0&&$.cameras.push(Zr)}const Xn=r.enabledFeatures;if(Xn&&Xn.includes("depth-sensing")&&r.depthUsage=="gpu-optimized"&&m){const lr=m.getDepthInformation(Sn[0]);lr&&lr.isValid&&lr.texture&&P.init(e,lr,r.renderState)}}for(let Sn=0;Sn<C.length;Sn++){const ln=L[Sn],Xn=C[Sn];ln!==null&&Xn!==void 0&&Xn.update(ln,Ut,u||o)}Ht&&Ht(vt,Ut),Ut.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Ut}),T=null}const In=new FAe;In.setAnimationLoop(pn),this.setAnimationLoop=function(vt){Ht=vt},this.dispose=function(){}}}const ry=new Mo,qJe=new Vn;function XJe(i,e){function t(R,M){R.matrixAutoUpdate===!0&&R.updateMatrix(),M.value.copy(R.matrix)}function n(R,M){M.color.getRGB(R.fogColor.value,rAe(i)),M.isFog?(R.fogNear.value=M.near,R.fogFar.value=M.far):M.isFogExp2&&(R.fogDensity.value=M.density)}function r(R,M,O,C,L){M.isMeshBasicMaterial||M.isMeshLambertMaterial?s(R,M):M.isMeshToonMaterial?(s(R,M),m(R,M)):M.isMeshPhongMaterial?(s(R,M),f(R,M)):M.isMeshStandardMaterial?(s(R,M),v(R,M),M.isMeshPhysicalMaterial&&x(R,M,L)):M.isMeshMatcapMaterial?(s(R,M),T(R,M)):M.isMeshDepthMaterial?s(R,M):M.isMeshDistanceMaterial?(s(R,M),P(R,M)):M.isMeshNormalMaterial?s(R,M):M.isLineBasicMaterial?(o(R,M),M.isLineDashedMaterial&&a(R,M)):M.isPointsMaterial?c(R,M,O,C):M.isSpriteMaterial?u(R,M):M.isShadowMaterial?(R.color.value.copy(M.color),R.opacity.value=M.opacity):M.isShaderMaterial&&(M.uniformsNeedUpdate=!1)}function s(R,M){R.opacity.value=M.opacity,M.color&&R.diffuse.value.copy(M.color),M.emissive&&R.emissive.value.copy(M.emissive).multiplyScalar(M.emissiveIntensity),M.map&&(R.map.value=M.map,t(M.map,R.mapTransform)),M.alphaMap&&(R.alphaMap.value=M.alphaMap,t(M.alphaMap,R.alphaMapTransform)),M.bumpMap&&(R.bumpMap.value=M.bumpMap,t(M.bumpMap,R.bumpMapTransform),R.bumpScale.value=M.bumpScale,M.side===Ui&&(R.bumpScale.value*=-1)),M.normalMap&&(R.normalMap.value=M.normalMap,t(M.normalMap,R.normalMapTransform),R.normalScale.value.copy(M.normalScale),M.side===Ui&&R.normalScale.value.negate()),M.displacementMap&&(R.displacementMap.value=M.displacementMap,t(M.displacementMap,R.displacementMapTransform),R.displacementScale.value=M.displacementScale,R.displacementBias.value=M.displacementBias),M.emissiveMap&&(R.emissiveMap.value=M.emissiveMap,t(M.emissiveMap,R.emissiveMapTransform)),M.specularMap&&(R.specularMap.value=M.specularMap,t(M.specularMap,R.specularMapTransform)),M.alphaTest>0&&(R.alphaTest.value=M.alphaTest);const O=e.get(M),C=O.envMap,L=O.envMapRotation;C&&(R.envMap.value=C,ry.copy(L),ry.x*=-1,ry.y*=-1,ry.z*=-1,C.isCubeTexture&&C.isRenderTargetTexture===!1&&(ry.y*=-1,ry.z*=-1),R.envMapRotation.value.setFromMatrix4(qJe.makeRotationFromEuler(ry)),R.flipEnvMap.value=C.isCubeTexture&&C.isRenderTargetTexture===!1?-1:1,R.reflectivity.value=M.reflectivity,R.ior.value=M.ior,R.refractionRatio.value=M.refractionRatio),M.lightMap&&(R.lightMap.value=M.lightMap,R.lightMapIntensity.value=M.lightMapIntensity,t(M.lightMap,R.lightMapTransform)),M.aoMap&&(R.aoMap.value=M.aoMap,R.aoMapIntensity.value=M.aoMapIntensity,t(M.aoMap,R.aoMapTransform))}function o(R,M){R.diffuse.value.copy(M.color),R.opacity.value=M.opacity,M.map&&(R.map.value=M.map,t(M.map,R.mapTransform))}function a(R,M){R.dashSize.value=M.dashSize,R.totalSize.value=M.dashSize+M.gapSize,R.scale.value=M.scale}function c(R,M,O,C){R.diffuse.value.copy(M.color),R.opacity.value=M.opacity,R.size.value=M.size*O,R.scale.value=C*.5,M.map&&(R.map.value=M.map,t(M.map,R.uvTransform)),M.alphaMap&&(R.alphaMap.value=M.alphaMap,t(M.alphaMap,R.alphaMapTransform)),M.alphaTest>0&&(R.alphaTest.value=M.alphaTest)}function u(R,M){R.diffuse.value.copy(M.color),R.opacity.value=M.opacity,R.rotation.value=M.rotation,M.map&&(R.map.value=M.map,t(M.map,R.mapTransform)),M.alphaMap&&(R.alphaMap.value=M.alphaMap,t(M.alphaMap,R.alphaMapTransform)),M.alphaTest>0&&(R.alphaTest.value=M.alphaTest)}function f(R,M){R.specular.value.copy(M.specular),R.shininess.value=Math.max(M.shininess,1e-4)}function m(R,M){M.gradientMap&&(R.gradientMap.value=M.gradientMap)}function v(R,M){R.metalness.value=M.metalness,M.metalnessMap&&(R.metalnessMap.value=M.metalnessMap,t(M.metalnessMap,R.metalnessMapTransform)),R.roughness.value=M.roughness,M.roughnessMap&&(R.roughnessMap.value=M.roughnessMap,t(M.roughnessMap,R.roughnessMapTransform)),M.envMap&&(R.envMapIntensity.value=M.envMapIntensity)}function x(R,M,O){R.ior.value=M.ior,M.sheen>0&&(R.sheenColor.value.copy(M.sheenColor).multiplyScalar(M.sheen),R.sheenRoughness.value=M.sheenRoughness,M.sheenColorMap&&(R.sheenColorMap.value=M.sheenColorMap,t(M.sheenColorMap,R.sheenColorMapTransform)),M.sheenRoughnessMap&&(R.sheenRoughnessMap.value=M.sheenRoughnessMap,t(M.sheenRoughnessMap,R.sheenRoughnessMapTransform))),M.clearcoat>0&&(R.clearcoat.value=M.clearcoat,R.clearcoatRoughness.value=M.clearcoatRoughness,M.clearcoatMap&&(R.clearcoatMap.value=M.clearcoatMap,t(M.clearcoatMap,R.clearcoatMapTransform)),M.clearcoatRoughnessMap&&(R.clearcoatRoughnessMap.value=M.clearcoatRoughnessMap,t(M.clearcoatRoughnessMap,R.clearcoatRoughnessMapTransform)),M.clearcoatNormalMap&&(R.clearcoatNormalMap.value=M.clearcoatNormalMap,t(M.clearcoatNormalMap,R.clearcoatNormalMapTransform),R.clearcoatNormalScale.value.copy(M.clearcoatNormalScale),M.side===Ui&&R.clearcoatNormalScale.value.negate())),M.dispersion>0&&(R.dispersion.value=M.dispersion),M.iridescence>0&&(R.iridescence.value=M.iridescence,R.iridescenceIOR.value=M.iridescenceIOR,R.iridescenceThicknessMinimum.value=M.iridescenceThicknessRange[0],R.iridescenceThicknessMaximum.value=M.iridescenceThicknessRange[1],M.iridescenceMap&&(R.iridescenceMap.value=M.iridescenceMap,t(M.iridescenceMap,R.iridescenceMapTransform)),M.iridescenceThicknessMap&&(R.iridescenceThicknessMap.value=M.iridescenceThicknessMap,t(M.iridescenceThicknessMap,R.iridescenceThicknessMapTransform))),M.transmission>0&&(R.transmission.value=M.transmission,R.transmissionSamplerMap.value=O.texture,R.transmissionSamplerSize.value.set(O.width,O.height),M.transmissionMap&&(R.transmissionMap.value=M.transmissionMap,t(M.transmissionMap,R.transmissionMapTransform)),R.thickness.value=M.thickness,M.thicknessMap&&(R.thicknessMap.value=M.thicknessMap,t(M.thicknessMap,R.thicknessMapTransform)),R.attenuationDistance.value=M.attenuationDistance,R.attenuationColor.value.copy(M.attenuationColor)),M.anisotropy>0&&(R.anisotropyVector.value.set(M.anisotropy*Math.cos(M.anisotropyRotation),M.anisotropy*Math.sin(M.anisotropyRotation)),M.anisotropyMap&&(R.anisotropyMap.value=M.anisotropyMap,t(M.anisotropyMap,R.anisotropyMapTransform))),R.specularIntensity.value=M.specularIntensity,R.specularColor.value.copy(M.specularColor),M.specularColorMap&&(R.specularColorMap.value=M.specularColorMap,t(M.specularColorMap,R.specularColorMapTransform)),M.specularIntensityMap&&(R.specularIntensityMap.value=M.specularIntensityMap,t(M.specularIntensityMap,R.specularIntensityMapTransform))}function T(R,M){M.matcap&&(R.matcap.value=M.matcap)}function P(R,M){const O=e.get(M).light;R.referencePosition.value.setFromMatrixPosition(O.matrixWorld),R.nearDistance.value=O.shadow.camera.near,R.farDistance.value=O.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:r}}function YJe(i,e,t,n){let r={},s={},o=[];const a=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS);function c(O,C){const L=C.program;n.uniformBlockBinding(O,L)}function u(O,C){let L=r[O.id];L===void 0&&(T(O),L=f(O),r[O.id]=L,O.addEventListener("dispose",R));const Y=C.program;n.updateUBOMapping(O,Y);const J=e.render.frame;s[O.id]!==J&&(v(O),s[O.id]=J)}function f(O){const C=m();O.__bindingPointIndex=C;const L=i.createBuffer(),Y=O.__size,J=O.usage;return i.bindBuffer(i.UNIFORM_BUFFER,L),i.bufferData(i.UNIFORM_BUFFER,Y,J),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,C,L),L}function m(){for(let O=0;O<a;O++)if(o.indexOf(O)===-1)return o.push(O),O;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function v(O){const C=r[O.id],L=O.uniforms,Y=O.__cache;i.bindBuffer(i.UNIFORM_BUFFER,C);for(let J=0,z=L.length;J<z;J++){const ne=Array.isArray(L[J])?L[J]:[L[J]];for(let K=0,$=ne.length;K<$;K++){const he=ne[K];if(x(he,J,K,Y)===!0){const Ce=he.__offset,Pe=Array.isArray(he.value)?he.value:[he.value];let je=0;for(let ge=0;ge<Pe.length;ge++){const Xe=Pe[ge],Fe=P(Xe);typeof Xe=="number"||typeof Xe=="boolean"?(he.__data[0]=Xe,i.bufferSubData(i.UNIFORM_BUFFER,Ce+je,he.__data)):Xe.isMatrix3?(he.__data[0]=Xe.elements[0],he.__data[1]=Xe.elements[1],he.__data[2]=Xe.elements[2],he.__data[3]=0,he.__data[4]=Xe.elements[3],he.__data[5]=Xe.elements[4],he.__data[6]=Xe.elements[5],he.__data[7]=0,he.__data[8]=Xe.elements[6],he.__data[9]=Xe.elements[7],he.__data[10]=Xe.elements[8],he.__data[11]=0):(Xe.toArray(he.__data,je),je+=Fe.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,Ce,he.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function x(O,C,L,Y){const J=O.value,z=C+"_"+L;if(Y[z]===void 0)return typeof J=="number"||typeof J=="boolean"?Y[z]=J:Y[z]=J.clone(),!0;{const ne=Y[z];if(typeof J=="number"||typeof J=="boolean"){if(ne!==J)return Y[z]=J,!0}else if(ne.equals(J)===!1)return ne.copy(J),!0}return!1}function T(O){const C=O.uniforms;let L=0;const Y=16;for(let z=0,ne=C.length;z<ne;z++){const K=Array.isArray(C[z])?C[z]:[C[z]];for(let $=0,he=K.length;$<he;$++){const Ce=K[$],Pe=Array.isArray(Ce.value)?Ce.value:[Ce.value];for(let je=0,ge=Pe.length;je<ge;je++){const Xe=Pe[je],Fe=P(Xe),Ne=L%Y,tt=Ne%Fe.boundary,mt=Ne+tt;L+=tt,mt!==0&&Y-mt<Fe.storage&&(L+=Y-mt),Ce.__data=new Float32Array(Fe.storage/Float32Array.BYTES_PER_ELEMENT),Ce.__offset=L,L+=Fe.storage}}}const J=L%Y;return J>0&&(L+=Y-J),O.__size=L,O.__cache={},this}function P(O){const C={boundary:0,storage:0};return typeof O=="number"||typeof O=="boolean"?(C.boundary=4,C.storage=4):O.isVector2?(C.boundary=8,C.storage=8):O.isVector3||O.isColor?(C.boundary=16,C.storage=12):O.isVector4?(C.boundary=16,C.storage=16):O.isMatrix3?(C.boundary=48,C.storage=48):O.isMatrix4?(C.boundary=64,C.storage=64):O.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",O),C}function R(O){const C=O.target;C.removeEventListener("dispose",R);const L=o.indexOf(C.__bindingPointIndex);o.splice(L,1),i.deleteBuffer(r[C.id]),delete r[C.id],delete s[C.id]}function M(){for(const O in r)i.deleteBuffer(r[O]);o=[],r={},s={}}return{bind:c,update:u,dispose:M}}class IE{constructor(e={}){const{canvas:t=KCe(),context:n=null,depth:r=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:u=!1,powerPreference:f="default",failIfMajorPerformanceCaveat:m=!1,reverseDepthBuffer:v=!1}=e;this.isWebGLRenderer=!0;let x;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");x=n.getContextAttributes().alpha}else x=o;const T=new Uint32Array(4),P=new Int32Array(4);let R=null,M=null;const O=[],C=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Yl,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const L=this;let Y=!1;this._outputColorSpace=Hr;let J=0,z=0,ne=null,K=-1,$=null;const he=new ir,Ce=new ir;let Pe=null;const je=new yn(0);let ge=0,Xe=t.width,Fe=t.height,Ne=1,tt=null,mt=null;const Ht=new ir(0,0,Xe,Fe),pn=new ir(0,0,Xe,Fe);let In=!1;const vt=new lC;let Ut=!1,Sn=!1;const ln=new Vn,Xn=new Vn,Yr=new be,lr=new ir,Kr={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let wi=!1;function Zr(){return ne===null?Ne:1}let Ue=n;function vo(ye,Qe){return t.getContext(ye,Qe)}try{const ye={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:u,powerPreference:f,failIfMajorPerformanceCaveat:m};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${fx}`),t.addEventListener("webglcontextlost",Fn,!1),t.addEventListener("webglcontextrestored",cn,!1),t.addEventListener("webglcontextcreationerror",zt,!1),Ue===null){const Qe="webgl2";if(Ue=vo(Qe,ye),Ue===null)throw vo(Qe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(ye){throw console.error("THREE.WebGLRenderer: "+ye.message),ye}let ui,qr,Dn,ni,$n,Sr,Vi,Me,fe,ft,Ft,$t,kt,Jn,An,Hn,Zn,Vt,Ln,fr,ur,Mn,cr,He;function Cn(){ui=new oQe(Ue),ui.init(),Mn=new GJe(Ue,ui),qr=new JZe(Ue,ui,e,Mn),Dn=new zJe(Ue,ui),qr.reverseDepthBuffer&&v&&Dn.buffers.depth.setReversed(!0),ni=new cQe(Ue),$n=new CJe,Sr=new VJe(Ue,ui,Dn,$n,qr,Mn,ni),Vi=new tQe(L),Me=new sQe(L),fe=new mYe(Ue),cr=new ZZe(Ue,fe),ft=new aQe(Ue,fe,ni,cr),Ft=new hQe(Ue,ft,fe,ni),Ln=new uQe(Ue,qr,Sr),Hn=new eQe($n),$t=new MJe(L,Vi,Me,ui,qr,cr,Hn),kt=new XJe(L,$n),Jn=new RJe,An=new FJe(ui),Vt=new KZe(L,Vi,Me,Dn,Ft,x,c),Zn=new LJe(L,Ft,qr),He=new YJe(Ue,ni,qr,Dn),fr=new QZe(Ue,ui,ni),ur=new lQe(Ue,ui,ni),ni.programs=$t.programs,L.capabilities=qr,L.extensions=ui,L.properties=$n,L.renderLists=Jn,L.shadowMap=Zn,L.state=Dn,L.info=ni}Cn();const Wt=new WJe(L,Ue);this.xr=Wt,this.getContext=function(){return Ue},this.getContextAttributes=function(){return Ue.getContextAttributes()},this.forceContextLoss=function(){const ye=ui.get("WEBGL_lose_context");ye&&ye.loseContext()},this.forceContextRestore=function(){const ye=ui.get("WEBGL_lose_context");ye&&ye.restoreContext()},this.getPixelRatio=function(){return Ne},this.setPixelRatio=function(ye){ye!==void 0&&(Ne=ye,this.setSize(Xe,Fe,!1))},this.getSize=function(ye){return ye.set(Xe,Fe)},this.setSize=function(ye,Qe,bt=!0){if(Wt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Xe=ye,Fe=Qe,t.width=Math.floor(ye*Ne),t.height=Math.floor(Qe*Ne),bt===!0&&(t.style.width=ye+"px",t.style.height=Qe+"px"),this.setViewport(0,0,ye,Qe)},this.getDrawingBufferSize=function(ye){return ye.set(Xe*Ne,Fe*Ne).floor()},this.setDrawingBufferSize=function(ye,Qe,bt){Xe=ye,Fe=Qe,Ne=bt,t.width=Math.floor(ye*bt),t.height=Math.floor(Qe*bt),this.setViewport(0,0,ye,Qe)},this.getCurrentViewport=function(ye){return ye.copy(he)},this.getViewport=function(ye){return ye.copy(Ht)},this.setViewport=function(ye,Qe,bt,St){ye.isVector4?Ht.set(ye.x,ye.y,ye.z,ye.w):Ht.set(ye,Qe,bt,St),Dn.viewport(he.copy(Ht).multiplyScalar(Ne).round())},this.getScissor=function(ye){return ye.copy(pn)},this.setScissor=function(ye,Qe,bt,St){ye.isVector4?pn.set(ye.x,ye.y,ye.z,ye.w):pn.set(ye,Qe,bt,St),Dn.scissor(Ce.copy(pn).multiplyScalar(Ne).round())},this.getScissorTest=function(){return In},this.setScissorTest=function(ye){Dn.setScissorTest(In=ye)},this.setOpaqueSort=function(ye){tt=ye},this.setTransparentSort=function(ye){mt=ye},this.getClearColor=function(ye){return ye.copy(Vt.getClearColor())},this.setClearColor=function(){Vt.setClearColor(...arguments)},this.getClearAlpha=function(){return Vt.getClearAlpha()},this.setClearAlpha=function(){Vt.setClearAlpha(...arguments)},this.clear=function(ye=!0,Qe=!0,bt=!0){let St=0;if(ye){let rt=!1;if(ne!==null){const un=ne.texture.format;rt=un===gx||un===mx||un===px}if(rt){const un=ne.texture.type,Rn=un===ps||un===fs||un===_d||un===pc||un===LU||un===UU,Bn=Vt.getClearColor(),Pn=Vt.getClearAlpha(),hr=Bn.r,yr=Bn.g,er=Bn.b;Rn?(T[0]=hr,T[1]=yr,T[2]=er,T[3]=Pn,Ue.clearBufferuiv(Ue.COLOR,0,T)):(P[0]=hr,P[1]=yr,P[2]=er,P[3]=Pn,Ue.clearBufferiv(Ue.COLOR,0,P))}else St|=Ue.COLOR_BUFFER_BIT}Qe&&(St|=Ue.DEPTH_BUFFER_BIT),bt&&(St|=Ue.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Ue.clear(St)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Fn,!1),t.removeEventListener("webglcontextrestored",cn,!1),t.removeEventListener("webglcontextcreationerror",zt,!1),Vt.dispose(),Jn.dispose(),An.dispose(),$n.dispose(),Vi.dispose(),Me.dispose(),Ft.dispose(),cr.dispose(),He.dispose(),$t.dispose(),Wt.dispose(),Wt.removeEventListener("sessionstart",Ho),Wt.removeEventListener("sessionend",ka),V0.stop()};function Fn(ye){ye.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Y=!0}function cn(){console.log("THREE.WebGLRenderer: Context Restored."),Y=!1;const ye=ni.autoReset,Qe=Zn.enabled,bt=Zn.autoUpdate,St=Zn.needsUpdate,rt=Zn.type;Cn(),ni.autoReset=ye,Zn.enabled=Qe,Zn.autoUpdate=bt,Zn.needsUpdate=St,Zn.type=rt}function zt(ye){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ye.statusMessage)}function On(ye){const Qe=ye.target;Qe.removeEventListener("dispose",On),pr(Qe)}function pr(ye){Gi(ye),$n.remove(ye)}function Gi(ye){const Qe=$n.get(ye).programs;Qe!==void 0&&(Qe.forEach(function(bt){$t.releaseProgram(bt)}),ye.isShaderMaterial&&$t.releaseShaderCache(ye))}this.renderBufferDirect=function(ye,Qe,bt,St,rt,un){Qe===null&&(Qe=Kr);const Rn=rt.isMesh&&rt.matrixWorld.determinant()<0,Bn=l3(ye,Qe,bt,St,rt);Dn.setMaterial(St,Rn);let Pn=bt.index,hr=1;if(St.wireframe===!0){if(Pn=ft.getWireframeAttribute(bt),Pn===void 0)return;hr=2}const yr=bt.drawRange,er=bt.attributes.position;let Ar=yr.start*hr,oi=(yr.start+yr.count)*hr;un!==null&&(Ar=Math.max(Ar,un.start*hr),oi=Math.min(oi,(un.start+un.count)*hr)),Pn!==null?(Ar=Math.max(Ar,0),oi=Math.min(oi,Pn.count)):er!=null&&(Ar=Math.max(Ar,0),oi=Math.min(oi,er.count));const Yi=oi-Ar;if(Yi<0||Yi===1/0)return;cr.setup(rt,St,Bn,bt,Pn);let ls,Br=fr;if(Pn!==null&&(ls=fe.get(Pn),Br=ur,Br.setIndex(ls)),rt.isMesh)St.wireframe===!0?(Dn.setLineWidth(St.wireframeLinewidth*Zr()),Br.setMode(Ue.LINES)):Br.setMode(Ue.TRIANGLES);else if(rt.isLine){let tr=St.linewidth;tr===void 0&&(tr=1),Dn.setLineWidth(tr*Zr()),rt.isLineSegments?Br.setMode(Ue.LINES):rt.isLineLoop?Br.setMode(Ue.LINE_LOOP):Br.setMode(Ue.LINE_STRIP)}else rt.isPoints?Br.setMode(Ue.POINTS):rt.isSprite&&Br.setMode(Ue.TRIANGLES);if(rt.isBatchedMesh)if(rt._multiDrawInstances!==null)Qc("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Br.renderMultiDrawInstances(rt._multiDrawStarts,rt._multiDrawCounts,rt._multiDrawCount,rt._multiDrawInstances);else if(ui.get("WEBGL_multi_draw"))Br.renderMultiDraw(rt._multiDrawStarts,rt._multiDrawCounts,rt._multiDrawCount);else{const tr=rt._multiDrawStarts,Zs=rt._multiDrawCounts,Xr=rt._multiDrawCount,jo=Pn?fe.get(Pn).bytesPerElement:1,ou=$n.get(St).currentProgram.getUniforms();for(let Wo=0;Wo<Xr;Wo++)ou.setValue(Ue,"_gl_DrawID",Wo),Br.render(tr[Wo]/jo,Zs[Wo])}else if(rt.isInstancedMesh)Br.renderInstances(Ar,Yi,rt.count);else if(bt.isInstancedBufferGeometry){const tr=bt._maxInstanceCount!==void 0?bt._maxInstanceCount:1/0,Zs=Math.min(bt.instanceCount,tr);Br.renderInstances(Ar,Yi,Zs)}else Br.render(Ar,Yi)};function kr(ye,Qe,bt){ye.transparent===!0&&ye.side===Co&&ye.forceSinglePass===!1?(ye.side=Ui,ye.needsUpdate=!0,kd(ye,Qe,bt),ye.side=Xl,ye.needsUpdate=!0,kd(ye,Qe,bt),ye.side=Co):kd(ye,Qe,bt)}this.compile=function(ye,Qe,bt=null){bt===null&&(bt=ye),M=An.get(bt),M.init(Qe),C.push(M),bt.traverseVisible(function(rt){rt.isLight&&rt.layers.test(Qe.layers)&&(M.pushLight(rt),rt.castShadow&&M.pushShadow(rt))}),ye!==bt&&ye.traverseVisible(function(rt){rt.isLight&&rt.layers.test(Qe.layers)&&(M.pushLight(rt),rt.castShadow&&M.pushShadow(rt))}),M.setupLights();const St=new Set;return ye.traverse(function(rt){if(!(rt.isMesh||rt.isPoints||rt.isLine||rt.isSprite))return;const un=rt.material;if(un)if(Array.isArray(un))for(let Rn=0;Rn<un.length;Rn++){const Bn=un[Rn];kr(Bn,bt,rt),St.add(Bn)}else kr(un,bt,rt),St.add(un)}),M=C.pop(),St},this.compileAsync=function(ye,Qe,bt=null){const St=this.compile(ye,Qe,bt);return new Promise(rt=>{function un(){if(St.forEach(function(Rn){$n.get(Rn).currentProgram.isReady()&&St.delete(Rn)}),St.size===0){rt(ye);return}setTimeout(un,10)}ui.get("KHR_parallel_shader_compile")!==null?un():setTimeout(un,10)})};let pa=null;function bl(ye){pa&&pa(ye)}function Ho(){V0.stop()}function ka(){V0.start()}const V0=new FAe;V0.setAnimationLoop(bl),typeof self<"u"&&V0.setContext(self),this.setAnimationLoop=function(ye){pa=ye,Wt.setAnimationLoop(ye),ye===null?V0.stop():V0.start()},Wt.addEventListener("sessionstart",Ho),Wt.addEventListener("sessionend",ka),this.render=function(ye,Qe){if(Qe!==void 0&&Qe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(Y===!0)return;if(ye.matrixWorldAutoUpdate===!0&&ye.updateMatrixWorld(),Qe.parent===null&&Qe.matrixWorldAutoUpdate===!0&&Qe.updateMatrixWorld(),Wt.enabled===!0&&Wt.isPresenting===!0&&(Wt.cameraAutoUpdate===!0&&Wt.updateCamera(Qe),Qe=Wt.getCamera()),ye.isScene===!0&&ye.onBeforeRender(L,ye,Qe,ne),M=An.get(ye,C.length),M.init(Qe),C.push(M),Xn.multiplyMatrices(Qe.projectionMatrix,Qe.matrixWorldInverse),vt.setFromProjectionMatrix(Xn),Sn=this.localClippingEnabled,Ut=Hn.init(this.clippingPlanes,Sn),R=Jn.get(ye,O.length),R.init(),O.push(R),Wt.enabled===!0&&Wt.isPresenting===!0){const un=L.xr.getDepthSensingMesh();un!==null&&Pd(un,Qe,-1/0,L.sortObjects)}Pd(ye,Qe,0,L.sortObjects),R.finish(),L.sortObjects===!0&&R.sort(tt,mt),wi=Wt.enabled===!1||Wt.isPresenting===!1||Wt.hasDepthSensing()===!1,wi&&Vt.addToRenderList(R,ye),this.info.render.frame++,Ut===!0&&Hn.beginShadows();const bt=M.state.shadowsArray;Zn.render(bt,ye,Qe),Ut===!0&&Hn.endShadows(),this.info.autoReset===!0&&this.info.reset();const St=R.opaque,rt=R.transmissive;if(M.setupLights(),Qe.isArrayCamera){const un=Qe.cameras;if(rt.length>0)for(let Rn=0,Bn=un.length;Rn<Bn;Rn++){const Pn=un[Rn];Id(St,rt,ye,Pn)}wi&&Vt.render(ye);for(let Rn=0,Bn=un.length;Rn<Bn;Rn++){const Pn=un[Rn];Nd(R,ye,Pn,Pn.viewport)}}else rt.length>0&&Id(St,rt,ye,Qe),wi&&Vt.render(ye),Nd(R,ye,Qe);ne!==null&&z===0&&(Sr.updateMultisampleRenderTarget(ne),Sr.updateRenderTargetMipmap(ne)),ye.isScene===!0&&ye.onAfterRender(L,ye,Qe),cr.resetDefaultState(),K=-1,$=null,C.pop(),C.length>0?(M=C[C.length-1],Ut===!0&&Hn.setGlobalState(L.clippingPlanes,M.state.camera)):M=null,O.pop(),O.length>0?R=O[O.length-1]:R=null};function Pd(ye,Qe,bt,St){if(ye.visible===!1)return;if(ye.layers.test(Qe.layers)){if(ye.isGroup)bt=ye.renderOrder;else if(ye.isLOD)ye.autoUpdate===!0&&ye.update(Qe);else if(ye.isLight)M.pushLight(ye),ye.castShadow&&M.pushShadow(ye);else if(ye.isSprite){if(!ye.frustumCulled||vt.intersectsSprite(ye)){St&&lr.setFromMatrixPosition(ye.matrixWorld).applyMatrix4(Xn);const Rn=Ft.update(ye),Bn=ye.material;Bn.visible&&R.push(ye,Rn,Bn,bt,lr.z,null)}}else if((ye.isMesh||ye.isLine||ye.isPoints)&&(!ye.frustumCulled||vt.intersectsObject(ye))){const Rn=Ft.update(ye),Bn=ye.material;if(St&&(ye.boundingSphere!==void 0?(ye.boundingSphere===null&&ye.computeBoundingSphere(),lr.copy(ye.boundingSphere.center)):(Rn.boundingSphere===null&&Rn.computeBoundingSphere(),lr.copy(Rn.boundingSphere.center)),lr.applyMatrix4(ye.matrixWorld).applyMatrix4(Xn)),Array.isArray(Bn)){const Pn=Rn.groups;for(let hr=0,yr=Pn.length;hr<yr;hr++){const er=Pn[hr],Ar=Bn[er.materialIndex];Ar&&Ar.visible&&R.push(ye,Rn,Ar,bt,lr.z,er)}}else Bn.visible&&R.push(ye,Rn,Bn,bt,lr.z,null)}}const un=ye.children;for(let Rn=0,Bn=un.length;Rn<Bn;Rn++)Pd(un[Rn],Qe,bt,St)}function Nd(ye,Qe,bt,St){const rt=ye.opaque,un=ye.transmissive,Rn=ye.transparent;M.setupLightsView(bt),Ut===!0&&Hn.setGlobalState(L.clippingPlanes,bt),St&&Dn.viewport(he.copy(St)),rt.length>0&&Sl(rt,Qe,bt),un.length>0&&Sl(un,Qe,bt),Rn.length>0&&Sl(Rn,Qe,bt),Dn.buffers.depth.setTest(!0),Dn.buffers.depth.setMask(!0),Dn.buffers.color.setMask(!0),Dn.setPolygonOffset(!1)}function Id(ye,Qe,bt,St){if((bt.isScene===!0?bt.overrideMaterial:null)!==null)return;M.state.transmissionRenderTarget[St.id]===void 0&&(M.state.transmissionRenderTarget[St.id]=new yc(1,1,{generateMipmaps:!0,type:ui.has("EXT_color_buffer_half_float")||ui.has("EXT_color_buffer_float")?Aa:ps,minFilter:oc,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:rr.workingColorSpace}));const un=M.state.transmissionRenderTarget[St.id],Rn=St.viewport||he;un.setSize(Rn.z*L.transmissionResolutionScale,Rn.w*L.transmissionResolutionScale);const Bn=L.getRenderTarget();L.setRenderTarget(un),L.getClearColor(je),ge=L.getClearAlpha(),ge<1&&L.setClearColor(16777215,.5),L.clear(),wi&&Vt.render(bt);const Pn=L.toneMapping;L.toneMapping=Yl;const hr=St.viewport;if(St.viewport!==void 0&&(St.viewport=void 0),M.setupLightsView(St),Ut===!0&&Hn.setGlobalState(L.clippingPlanes,St),Sl(ye,bt,St),Sr.updateMultisampleRenderTarget(un),Sr.updateRenderTargetMipmap(un),ui.has("WEBGL_multisampled_render_to_texture")===!1){let yr=!1;for(let er=0,Ar=Qe.length;er<Ar;er++){const oi=Qe[er],Yi=oi.object,ls=oi.geometry,Br=oi.material,tr=oi.group;if(Br.side===Co&&Yi.layers.test(St.layers)){const Zs=Br.side;Br.side=Ui,Br.needsUpdate=!0,np(Yi,bt,St,ls,Br,tr),Br.side=Zs,Br.needsUpdate=!0,yr=!0}}yr===!0&&(Sr.updateMultisampleRenderTarget(un),Sr.updateRenderTargetMipmap(un))}L.setRenderTarget(Bn),L.setClearColor(je,ge),hr!==void 0&&(St.viewport=hr),L.toneMapping=Pn}function Sl(ye,Qe,bt){const St=Qe.isScene===!0?Qe.overrideMaterial:null;for(let rt=0,un=ye.length;rt<un;rt++){const Rn=ye[rt],Bn=Rn.object,Pn=Rn.geometry,hr=Rn.group;let yr=Rn.material;yr.allowOverride===!0&&St!==null&&(yr=St),Bn.layers.test(bt.layers)&&np(Bn,Qe,bt,Pn,yr,hr)}}function np(ye,Qe,bt,St,rt,un){ye.onBeforeRender(L,Qe,bt,St,rt,un),ye.modelViewMatrix.multiplyMatrices(bt.matrixWorldInverse,ye.matrixWorld),ye.normalMatrix.getNormalMatrix(ye.modelViewMatrix),rt.onBeforeRender(L,Qe,bt,St,ye,un),rt.transparent===!0&&rt.side===Co&&rt.forceSinglePass===!1?(rt.side=Ui,rt.needsUpdate=!0,L.renderBufferDirect(bt,Qe,St,rt,ye,un),rt.side=Xl,rt.needsUpdate=!0,L.renderBufferDirect(bt,Qe,St,rt,ye,un),rt.side=Co):L.renderBufferDirect(bt,Qe,St,rt,ye,un),ye.onAfterRender(L,Qe,bt,St,rt,un)}function kd(ye,Qe,bt){Qe.isScene!==!0&&(Qe=Kr);const St=$n.get(ye),rt=M.state.lights,un=M.state.shadowsArray,Rn=rt.state.version,Bn=$t.getParameters(ye,rt.state,un,Qe,bt),Pn=$t.getProgramCacheKey(Bn);let hr=St.programs;St.environment=ye.isMeshStandardMaterial?Qe.environment:null,St.fog=Qe.fog,St.envMap=(ye.isMeshStandardMaterial?Me:Vi).get(ye.envMap||St.environment),St.envMapRotation=St.environment!==null&&ye.envMap===null?Qe.environmentRotation:ye.envMapRotation,hr===void 0&&(ye.addEventListener("dispose",On),hr=new Map,St.programs=hr);let yr=hr.get(Pn);if(yr!==void 0){if(St.currentProgram===yr&&St.lightsStateVersion===Rn)return t0(ye,Bn),yr}else Bn.uniforms=$t.getUniforms(ye),ye.onBeforeCompile(Bn,L),yr=$t.acquireProgram(Bn,Pn),hr.set(Pn,yr),St.uniforms=Bn.uniforms;const er=St.uniforms;return(!ye.isShaderMaterial&&!ye.isRawShaderMaterial||ye.clipping===!0)&&(er.clippingPlanes=Hn.uniform),t0(ye,Bn),St.needsLights=lh(ye),St.lightsStateVersion=Rn,St.needsLights&&(er.ambientLightColor.value=rt.state.ambient,er.lightProbe.value=rt.state.probe,er.directionalLights.value=rt.state.directional,er.directionalLightShadows.value=rt.state.directionalShadow,er.spotLights.value=rt.state.spot,er.spotLightShadows.value=rt.state.spotShadow,er.rectAreaLights.value=rt.state.rectArea,er.ltc_1.value=rt.state.rectAreaLTC1,er.ltc_2.value=rt.state.rectAreaLTC2,er.pointLights.value=rt.state.point,er.pointLightShadows.value=rt.state.pointShadow,er.hemisphereLights.value=rt.state.hemi,er.directionalShadowMap.value=rt.state.directionalShadowMap,er.directionalShadowMatrix.value=rt.state.directionalShadowMatrix,er.spotShadowMap.value=rt.state.spotShadowMap,er.spotLightMatrix.value=rt.state.spotLightMatrix,er.spotLightMap.value=rt.state.spotLightMap,er.pointShadowMap.value=rt.state.pointShadowMap,er.pointShadowMatrix.value=rt.state.pointShadowMatrix),St.currentProgram=yr,St.uniformsList=null,yr}function rp(ye){if(ye.uniformsList===null){const Qe=ye.currentProgram.getUniforms();ye.uniformsList=UB.seqWithValue(Qe.seq,ye.uniforms)}return ye.uniformsList}function t0(ye,Qe){const bt=$n.get(ye);bt.outputColorSpace=Qe.outputColorSpace,bt.batching=Qe.batching,bt.batchingColor=Qe.batchingColor,bt.instancing=Qe.instancing,bt.instancingColor=Qe.instancingColor,bt.instancingMorph=Qe.instancingMorph,bt.skinning=Qe.skinning,bt.morphTargets=Qe.morphTargets,bt.morphNormals=Qe.morphNormals,bt.morphColors=Qe.morphColors,bt.morphTargetsCount=Qe.morphTargetsCount,bt.numClippingPlanes=Qe.numClippingPlanes,bt.numIntersection=Qe.numClipIntersection,bt.vertexAlphas=Qe.vertexAlphas,bt.vertexTangents=Qe.vertexTangents,bt.toneMapping=Qe.toneMapping}function l3(ye,Qe,bt,St,rt){Qe.isScene!==!0&&(Qe=Kr),Sr.resetTextureUnits();const un=Qe.fog,Rn=St.isMeshStandardMaterial?Qe.environment:null,Bn=ne===null?L.outputColorSpace:ne.isXRRenderTarget===!0?ne.texture.colorSpace:_l,Pn=(St.isMeshStandardMaterial?Me:Vi).get(St.envMap||Rn),hr=St.vertexColors===!0&&!!bt.attributes.color&&bt.attributes.color.itemSize===4,yr=!!bt.attributes.tangent&&(!!St.normalMap||St.anisotropy>0),er=!!bt.morphAttributes.position,Ar=!!bt.morphAttributes.normal,oi=!!bt.morphAttributes.color;let Yi=Yl;St.toneMapped&&(ne===null||ne.isXRRenderTarget===!0)&&(Yi=L.toneMapping);const ls=bt.morphAttributes.position||bt.morphAttributes.normal||bt.morphAttributes.color,Br=ls!==void 0?ls.length:0,tr=$n.get(St),Zs=M.state.lights;if(Ut===!0&&(Sn===!0||ye!==$)){const _o=ye===$&&St.id===K;Hn.setState(St,ye,_o)}let Xr=!1;St.version===tr.__version?(tr.needsLights&&tr.lightsStateVersion!==Zs.state.version||tr.outputColorSpace!==Bn||rt.isBatchedMesh&&tr.batching===!1||!rt.isBatchedMesh&&tr.batching===!0||rt.isBatchedMesh&&tr.batchingColor===!0&&rt.colorTexture===null||rt.isBatchedMesh&&tr.batchingColor===!1&&rt.colorTexture!==null||rt.isInstancedMesh&&tr.instancing===!1||!rt.isInstancedMesh&&tr.instancing===!0||rt.isSkinnedMesh&&tr.skinning===!1||!rt.isSkinnedMesh&&tr.skinning===!0||rt.isInstancedMesh&&tr.instancingColor===!0&&rt.instanceColor===null||rt.isInstancedMesh&&tr.instancingColor===!1&&rt.instanceColor!==null||rt.isInstancedMesh&&tr.instancingMorph===!0&&rt.morphTexture===null||rt.isInstancedMesh&&tr.instancingMorph===!1&&rt.morphTexture!==null||tr.envMap!==Pn||St.fog===!0&&tr.fog!==un||tr.numClippingPlanes!==void 0&&(tr.numClippingPlanes!==Hn.numPlanes||tr.numIntersection!==Hn.numIntersection)||tr.vertexAlphas!==hr||tr.vertexTangents!==yr||tr.morphTargets!==er||tr.morphNormals!==Ar||tr.morphColors!==oi||tr.toneMapping!==Yi||tr.morphTargetsCount!==Br)&&(Xr=!0):(Xr=!0,tr.__version=St.version);let jo=tr.currentProgram;Xr===!0&&(jo=kd(St,Qe,rt));let ou=!1,Wo=!1,au=!1;const $i=jo.getUniforms(),Hs=tr.uniforms;if(Dn.useProgram(jo.program)&&(ou=!0,Wo=!0,au=!0),St.id!==K&&(K=St.id,Wo=!0),ou||$!==ye){Dn.buffers.depth.getReversed()?(ln.copy(ye.projectionMatrix),Mqe(ln),Cqe(ln),$i.setValue(Ue,"projectionMatrix",ln)):$i.setValue(Ue,"projectionMatrix",ye.projectionMatrix),$i.setValue(Ue,"viewMatrix",ye.matrixWorldInverse);const Qs=$i.map.cameraPosition;Qs!==void 0&&Qs.setValue(Ue,Yr.setFromMatrixPosition(ye.matrixWorld)),qr.logarithmicDepthBuffer&&$i.setValue(Ue,"logDepthBufFC",2/(Math.log(ye.far+1)/Math.LN2)),(St.isMeshPhongMaterial||St.isMeshToonMaterial||St.isMeshLambertMaterial||St.isMeshBasicMaterial||St.isMeshStandardMaterial||St.isShaderMaterial)&&$i.setValue(Ue,"isOrthographic",ye.isOrthographicCamera===!0),$!==ye&&($=ye,Wo=!0,au=!0)}if(rt.isSkinnedMesh){$i.setOptional(Ue,rt,"bindMatrix"),$i.setOptional(Ue,rt,"bindMatrixInverse");const _o=rt.skeleton;_o&&(_o.boneTexture===null&&_o.computeBoneTexture(),$i.setValue(Ue,"boneTexture",_o.boneTexture,Sr))}rt.isBatchedMesh&&($i.setOptional(Ue,rt,"batchingTexture"),$i.setValue(Ue,"batchingTexture",rt._matricesTexture,Sr),$i.setOptional(Ue,rt,"batchingIdTexture"),$i.setValue(Ue,"batchingIdTexture",rt._indirectTexture,Sr),$i.setOptional(Ue,rt,"batchingColorTexture"),rt._colorsTexture!==null&&$i.setValue(Ue,"batchingColorTexture",rt._colorsTexture,Sr));const Ro=bt.morphAttributes;if((Ro.position!==void 0||Ro.normal!==void 0||Ro.color!==void 0)&&Ln.update(rt,bt,jo),(Wo||tr.receiveShadow!==rt.receiveShadow)&&(tr.receiveShadow=rt.receiveShadow,$i.setValue(Ue,"receiveShadow",rt.receiveShadow)),St.isMeshGouraudMaterial&&St.envMap!==null&&(Hs.envMap.value=Pn,Hs.flipEnvMap.value=Pn.isCubeTexture&&Pn.isRenderTargetTexture===!1?-1:1),St.isMeshStandardMaterial&&St.envMap===null&&Qe.environment!==null&&(Hs.envMapIntensity.value=Qe.environmentIntensity),Wo&&($i.setValue(Ue,"toneMappingExposure",L.toneMappingExposure),tr.needsLights&&ah(Hs,au),un&&St.fog===!0&&kt.refreshFogUniforms(Hs,un),kt.refreshMaterialUniforms(Hs,St,Ne,Fe,M.state.transmissionRenderTarget[ye.id]),UB.upload(Ue,rp(tr),Hs,Sr)),St.isShaderMaterial&&St.uniformsNeedUpdate===!0&&(UB.upload(Ue,rp(tr),Hs,Sr),St.uniformsNeedUpdate=!1),St.isSpriteMaterial&&$i.setValue(Ue,"center",rt.center),$i.setValue(Ue,"modelViewMatrix",rt.modelViewMatrix),$i.setValue(Ue,"normalMatrix",rt.normalMatrix),$i.setValue(Ue,"modelMatrix",rt.matrixWorld),St.isShaderMaterial||St.isRawShaderMaterial){const _o=St.uniformsGroups;for(let Qs=0,lu=_o.length;Qs<lu;Qs++){const Da=_o[Qs];He.update(Da,jo),He.bind(Da,jo)}}return jo}function ah(ye,Qe){ye.ambientLightColor.needsUpdate=Qe,ye.lightProbe.needsUpdate=Qe,ye.directionalLights.needsUpdate=Qe,ye.directionalLightShadows.needsUpdate=Qe,ye.pointLights.needsUpdate=Qe,ye.pointLightShadows.needsUpdate=Qe,ye.spotLights.needsUpdate=Qe,ye.spotLightShadows.needsUpdate=Qe,ye.rectAreaLights.needsUpdate=Qe,ye.hemisphereLights.needsUpdate=Qe}function lh(ye){return ye.isMeshLambertMaterial||ye.isMeshToonMaterial||ye.isMeshPhongMaterial||ye.isMeshStandardMaterial||ye.isShadowMaterial||ye.isShaderMaterial&&ye.lights===!0}this.getActiveCubeFace=function(){return J},this.getActiveMipmapLevel=function(){return z},this.getRenderTarget=function(){return ne},this.setRenderTargetTextures=function(ye,Qe,bt){const St=$n.get(ye);St.__autoAllocateDepthBuffer=ye.resolveDepthBuffer===!1,St.__autoAllocateDepthBuffer===!1&&(St.__useRenderToTexture=!1),$n.get(ye.texture).__webglTexture=Qe,$n.get(ye.depthTexture).__webglTexture=St.__autoAllocateDepthBuffer?void 0:bt,St.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(ye,Qe){const bt=$n.get(ye);bt.__webglFramebuffer=Qe,bt.__useDefaultFramebuffer=Qe===void 0};const cm=Ue.createFramebuffer();this.setRenderTarget=function(ye,Qe=0,bt=0){ne=ye,J=Qe,z=bt;let St=!0,rt=null,un=!1,Rn=!1;if(ye){const Pn=$n.get(ye);if(Pn.__useDefaultFramebuffer!==void 0)Dn.bindFramebuffer(Ue.FRAMEBUFFER,null),St=!1;else if(Pn.__webglFramebuffer===void 0)Sr.setupRenderTarget(ye);else if(Pn.__hasExternalTextures)Sr.rebindTextures(ye,$n.get(ye.texture).__webglTexture,$n.get(ye.depthTexture).__webglTexture);else if(ye.depthBuffer){const er=ye.depthTexture;if(Pn.__boundDepthTexture!==er){if(er!==null&&$n.has(er)&&(ye.width!==er.image.width||ye.height!==er.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Sr.setupDepthRenderbuffer(ye)}}const hr=ye.texture;(hr.isData3DTexture||hr.isDataArrayTexture||hr.isCompressedArrayTexture)&&(Rn=!0);const yr=$n.get(ye).__webglFramebuffer;ye.isWebGLCubeRenderTarget?(Array.isArray(yr[Qe])?rt=yr[Qe][bt]:rt=yr[Qe],un=!0):ye.samples>0&&Sr.useMultisampledRTT(ye)===!1?rt=$n.get(ye).__webglMultisampledFramebuffer:Array.isArray(yr)?rt=yr[bt]:rt=yr,he.copy(ye.viewport),Ce.copy(ye.scissor),Pe=ye.scissorTest}else he.copy(Ht).multiplyScalar(Ne).floor(),Ce.copy(pn).multiplyScalar(Ne).floor(),Pe=In;if(bt!==0&&(rt=cm),Dn.bindFramebuffer(Ue.FRAMEBUFFER,rt)&&St&&Dn.drawBuffers(ye,rt),Dn.viewport(he),Dn.scissor(Ce),Dn.setScissorTest(Pe),un){const Pn=$n.get(ye.texture);Ue.framebufferTexture2D(Ue.FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,Ue.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,Pn.__webglTexture,bt)}else if(Rn){const Pn=$n.get(ye.texture),hr=Qe;Ue.framebufferTextureLayer(Ue.FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,Pn.__webglTexture,bt,hr)}else if(ye!==null&&bt!==0){const Pn=$n.get(ye.texture);Ue.framebufferTexture2D(Ue.FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,Ue.TEXTURE_2D,Pn.__webglTexture,bt)}K=-1},this.readRenderTargetPixels=function(ye,Qe,bt,St,rt,un,Rn,Bn=0){if(!(ye&&ye.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Pn=$n.get(ye).__webglFramebuffer;if(ye.isWebGLCubeRenderTarget&&Rn!==void 0&&(Pn=Pn[Rn]),Pn){Dn.bindFramebuffer(Ue.FRAMEBUFFER,Pn);try{const hr=ye.textures[Bn],yr=hr.format,er=hr.type;if(!qr.textureFormatReadable(yr)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!qr.textureTypeReadable(er)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Qe>=0&&Qe<=ye.width-St&&bt>=0&&bt<=ye.height-rt&&(ye.textures.length>1&&Ue.readBuffer(Ue.COLOR_ATTACHMENT0+Bn),Ue.readPixels(Qe,bt,St,rt,Mn.convert(yr),Mn.convert(er),un))}finally{const hr=ne!==null?$n.get(ne).__webglFramebuffer:null;Dn.bindFramebuffer(Ue.FRAMEBUFFER,hr)}}},this.readRenderTargetPixelsAsync=async function(ye,Qe,bt,St,rt,un,Rn,Bn=0){if(!(ye&&ye.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Pn=$n.get(ye).__webglFramebuffer;if(ye.isWebGLCubeRenderTarget&&Rn!==void 0&&(Pn=Pn[Rn]),Pn)if(Qe>=0&&Qe<=ye.width-St&&bt>=0&&bt<=ye.height-rt){Dn.bindFramebuffer(Ue.FRAMEBUFFER,Pn);const hr=ye.textures[Bn],yr=hr.format,er=hr.type;if(!qr.textureFormatReadable(yr))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!qr.textureTypeReadable(er))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Ar=Ue.createBuffer();Ue.bindBuffer(Ue.PIXEL_PACK_BUFFER,Ar),Ue.bufferData(Ue.PIXEL_PACK_BUFFER,un.byteLength,Ue.STREAM_READ),ye.textures.length>1&&Ue.readBuffer(Ue.COLOR_ATTACHMENT0+Bn),Ue.readPixels(Qe,bt,St,rt,Mn.convert(yr),Mn.convert(er),0);const oi=ne!==null?$n.get(ne).__webglFramebuffer:null;Dn.bindFramebuffer(Ue.FRAMEBUFFER,oi);const Yi=Ue.fenceSync(Ue.SYNC_GPU_COMMANDS_COMPLETE,0);return Ue.flush(),await Eqe(Ue,Yi,4),Ue.bindBuffer(Ue.PIXEL_PACK_BUFFER,Ar),Ue.getBufferSubData(Ue.PIXEL_PACK_BUFFER,0,un),Ue.deleteBuffer(Ar),Ue.deleteSync(Yi),un}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(ye,Qe=null,bt=0){const St=Math.pow(2,-bt),rt=Math.floor(ye.image.width*St),un=Math.floor(ye.image.height*St),Rn=Qe!==null?Qe.x:0,Bn=Qe!==null?Qe.y:0;Sr.setTexture2D(ye,0),Ue.copyTexSubImage2D(Ue.TEXTURE_2D,bt,0,0,Rn,Bn,rt,un),Dn.unbindTexture()};const c3=Ue.createFramebuffer(),u3=Ue.createFramebuffer();this.copyTextureToTexture=function(ye,Qe,bt=null,St=null,rt=0,un=null){un===null&&(rt!==0?(Qc("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),un=rt,rt=0):un=0);let Rn,Bn,Pn,hr,yr,er,Ar,oi,Yi;const ls=ye.isCompressedTexture?ye.mipmaps[un]:ye.image;if(bt!==null)Rn=bt.max.x-bt.min.x,Bn=bt.max.y-bt.min.y,Pn=bt.isBox3?bt.max.z-bt.min.z:1,hr=bt.min.x,yr=bt.min.y,er=bt.isBox3?bt.min.z:0;else{const Ro=Math.pow(2,-rt);Rn=Math.floor(ls.width*Ro),Bn=Math.floor(ls.height*Ro),ye.isDataArrayTexture?Pn=ls.depth:ye.isData3DTexture?Pn=Math.floor(ls.depth*Ro):Pn=1,hr=0,yr=0,er=0}St!==null?(Ar=St.x,oi=St.y,Yi=St.z):(Ar=0,oi=0,Yi=0);const Br=Mn.convert(Qe.format),tr=Mn.convert(Qe.type);let Zs;Qe.isData3DTexture?(Sr.setTexture3D(Qe,0),Zs=Ue.TEXTURE_3D):Qe.isDataArrayTexture||Qe.isCompressedArrayTexture?(Sr.setTexture2DArray(Qe,0),Zs=Ue.TEXTURE_2D_ARRAY):(Sr.setTexture2D(Qe,0),Zs=Ue.TEXTURE_2D),Ue.pixelStorei(Ue.UNPACK_FLIP_Y_WEBGL,Qe.flipY),Ue.pixelStorei(Ue.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Qe.premultiplyAlpha),Ue.pixelStorei(Ue.UNPACK_ALIGNMENT,Qe.unpackAlignment);const Xr=Ue.getParameter(Ue.UNPACK_ROW_LENGTH),jo=Ue.getParameter(Ue.UNPACK_IMAGE_HEIGHT),ou=Ue.getParameter(Ue.UNPACK_SKIP_PIXELS),Wo=Ue.getParameter(Ue.UNPACK_SKIP_ROWS),au=Ue.getParameter(Ue.UNPACK_SKIP_IMAGES);Ue.pixelStorei(Ue.UNPACK_ROW_LENGTH,ls.width),Ue.pixelStorei(Ue.UNPACK_IMAGE_HEIGHT,ls.height),Ue.pixelStorei(Ue.UNPACK_SKIP_PIXELS,hr),Ue.pixelStorei(Ue.UNPACK_SKIP_ROWS,yr),Ue.pixelStorei(Ue.UNPACK_SKIP_IMAGES,er);const $i=ye.isDataArrayTexture||ye.isData3DTexture,Hs=Qe.isDataArrayTexture||Qe.isData3DTexture;if(ye.isDepthTexture){const Ro=$n.get(ye),_o=$n.get(Qe),Qs=$n.get(Ro.__renderTarget),lu=$n.get(_o.__renderTarget);Dn.bindFramebuffer(Ue.READ_FRAMEBUFFER,Qs.__webglFramebuffer),Dn.bindFramebuffer(Ue.DRAW_FRAMEBUFFER,lu.__webglFramebuffer);for(let Da=0;Da<Pn;Da++)$i&&(Ue.framebufferTextureLayer(Ue.READ_FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,$n.get(ye).__webglTexture,rt,er+Da),Ue.framebufferTextureLayer(Ue.DRAW_FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,$n.get(Qe).__webglTexture,un,Yi+Da)),Ue.blitFramebuffer(hr,yr,Rn,Bn,Ar,oi,Rn,Bn,Ue.DEPTH_BUFFER_BIT,Ue.NEAREST);Dn.bindFramebuffer(Ue.READ_FRAMEBUFFER,null),Dn.bindFramebuffer(Ue.DRAW_FRAMEBUFFER,null)}else if(rt!==0||ye.isRenderTargetTexture||$n.has(ye)){const Ro=$n.get(ye),_o=$n.get(Qe);Dn.bindFramebuffer(Ue.READ_FRAMEBUFFER,c3),Dn.bindFramebuffer(Ue.DRAW_FRAMEBUFFER,u3);for(let Qs=0;Qs<Pn;Qs++)$i?Ue.framebufferTextureLayer(Ue.READ_FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,Ro.__webglTexture,rt,er+Qs):Ue.framebufferTexture2D(Ue.READ_FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,Ue.TEXTURE_2D,Ro.__webglTexture,rt),Hs?Ue.framebufferTextureLayer(Ue.DRAW_FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,_o.__webglTexture,un,Yi+Qs):Ue.framebufferTexture2D(Ue.DRAW_FRAMEBUFFER,Ue.COLOR_ATTACHMENT0,Ue.TEXTURE_2D,_o.__webglTexture,un),rt!==0?Ue.blitFramebuffer(hr,yr,Rn,Bn,Ar,oi,Rn,Bn,Ue.COLOR_BUFFER_BIT,Ue.NEAREST):Hs?Ue.copyTexSubImage3D(Zs,un,Ar,oi,Yi+Qs,hr,yr,Rn,Bn):Ue.copyTexSubImage2D(Zs,un,Ar,oi,hr,yr,Rn,Bn);Dn.bindFramebuffer(Ue.READ_FRAMEBUFFER,null),Dn.bindFramebuffer(Ue.DRAW_FRAMEBUFFER,null)}else Hs?ye.isDataTexture||ye.isData3DTexture?Ue.texSubImage3D(Zs,un,Ar,oi,Yi,Rn,Bn,Pn,Br,tr,ls.data):Qe.isCompressedArrayTexture?Ue.compressedTexSubImage3D(Zs,un,Ar,oi,Yi,Rn,Bn,Pn,Br,ls.data):Ue.texSubImage3D(Zs,un,Ar,oi,Yi,Rn,Bn,Pn,Br,tr,ls):ye.isDataTexture?Ue.texSubImage2D(Ue.TEXTURE_2D,un,Ar,oi,Rn,Bn,Br,tr,ls.data):ye.isCompressedTexture?Ue.compressedTexSubImage2D(Ue.TEXTURE_2D,un,Ar,oi,ls.width,ls.height,Br,ls.data):Ue.texSubImage2D(Ue.TEXTURE_2D,un,Ar,oi,Rn,Bn,Br,tr,ls);Ue.pixelStorei(Ue.UNPACK_ROW_LENGTH,Xr),Ue.pixelStorei(Ue.UNPACK_IMAGE_HEIGHT,jo),Ue.pixelStorei(Ue.UNPACK_SKIP_PIXELS,ou),Ue.pixelStorei(Ue.UNPACK_SKIP_ROWS,Wo),Ue.pixelStorei(Ue.UNPACK_SKIP_IMAGES,au),un===0&&Qe.generateMipmaps&&Ue.generateMipmap(Zs),Dn.unbindTexture()},this.copyTextureToTexture3D=function(ye,Qe,bt=null,St=null,rt=0){return Qc('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(ye,Qe,bt,St,rt)},this.initRenderTarget=function(ye){$n.get(ye).__webglFramebuffer===void 0&&Sr.setupRenderTarget(ye)},this.initTexture=function(ye){ye.isCubeTexture?Sr.setTextureCube(ye,0):ye.isData3DTexture?Sr.setTexture3D(ye,0):ye.isDataArrayTexture||ye.isCompressedArrayTexture?Sr.setTexture2DArray(ye,0):Sr.setTexture2D(ye,0),Dn.unbindTexture()},this.resetState=function(){J=0,z=0,ne=null,Dn.reset(),cr.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return jl}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=rr._getDrawingBufferColorSpace(e),t.unpackColorSpace=rr._getUnpackColorSpace()}}const zAe=!0,Gee=document.location.hash.search("editor")>-1;var H2=(i=>(i.LOAD_COMPLETE="Events::loadComplete",i))(H2||{});const T4=new e0;var ar=(i=>(i.CUSTOM="ToolEvents::custom",i.SELECT_DROPDOWN="ToolEvents::selectDropdown",i.DRAG_UPDATE="ToolEvents::dragUpdate",i.ADD_SCENE="ToolEvents::addScene",i.REFRESH_SCENE="ToolEvents::refreshScene",i.REMOVE_SCENE="ToolEvents::removeScene",i.SET_SCENE="ToolEvents::setScene",i.GET_OBJECT="ToolEvents::getObject",i.SET_OBJECT="ToolEvents::setObject",i.UPDATE_OBJECT="ToolEvents::updateObject",i.CREATE_TEXTURE="ToolEvents::createTexture",i.REQUEST_METHOD="ToolEvents::requestMethod",i.ADD_CAMERA="ToolEvents::addCamera",i.REMOVE_CAMERA="ToolEvents::removeCamera",i.ADD_GROUP="ToolEvents::addGroup",i.REMOVE_GROUP="ToolEvents::removeGroup",i.ADD_SPLINE="ToolEvents::addSpline",i.ADD_RENDERER="ToolEvents::addRenderer",i.UPDATE_RENDERER="ToolEvents::updateRenderer",i))(ar||{});class KJe extends e0{constructor(t,n,r,s=!0){super();qe(this,"components",new Map);qe(this,"appHandlers",[]);qe(this,"editorHandlers",[]);qe(this,"_appID","");qe(this,"_debugEnabled");qe(this,"_broadcastChannel");qe(this,"_webSocket");qe(this,"_mode","app");qe(this,"_connected",!1);qe(this,"_useBC",!1);qe(this,"messageHandler",t=>{let n=t.data;this._useBC||(n=JSON.parse(t.data)),n.target==="editor"?this.handleEditorBroadcast(n):this.handleAppBroadcast(n)});qe(this,"openHandler",()=>{this._connected=!0});qe(this,"closeHandler",()=>{this._connected=!1});this._appID=t,this._debugEnabled=n,this.editor=r,n&&(this._useBC=s,s?(this._broadcastChannel=new BroadcastChannel(t),this._broadcastChannel.addEventListener("message",this.messageHandler)):(this._webSocket=new WebSocket(t),this._webSocket.addEventListener("open",this.openHandler),this._webSocket.addEventListener("close",this.closeHandler),this._webSocket.addEventListener("message",this.messageHandler)))}addComponent(t,n){this.components.set(t,n)}dispose(){this._broadcastChannel!==void 0&&this._broadcastChannel.removeEventListener("message",this.messageHandler),this._webSocket!==void 0&&(this._webSocket.removeEventListener("open",this.openHandler),this._webSocket.removeEventListener("close",this.closeHandler),this._webSocket.removeEventListener("message",this.messageHandler)),this.components.forEach(t=>{t.dispose()}),this.components.clear()}send(t){var n,r;this._mode!==t.target&&(this._useBC?(n=this._broadcastChannel)==null||n.postMessage(t):this._connected&&((r=this._webSocket)==null||r.send(JSON.stringify(t))))}handleAppBroadcast(t){switch(this.appHandlers.forEach(n=>{n.callback(t)}),t.event){case"custom":this.dispatchEvent({type:"ToolEvents::custom",value:t.data});break}}handleEditorBroadcast(t){switch(this.editorHandlers.forEach(n=>{n.callback(t)}),t.event){case"custom":this.dispatchEvent({type:"ToolEvents::custom",value:t.data});break}}get appID(){return this._appID}get connected(){return this._connected}get debugEnabled(){return this._debugEnabled}get mode(){return this._mode}get isApp(){return this._mode==="app"}get editor(){return this._mode==="editor"}set editor(t){t&&(this._mode="editor")}}class Ere{constructor(e){qe(this,"app");this.app=e,this.app.appHandlers.push({remote:this,callback:this.handleApp.bind(this)}),this.app.editorHandlers.push({remote:this,callback:this.handleEditor.bind(this)})}dispose(){const e=this.app.appHandlers.findIndex(t=>t.remote===this);e>-1&&(this.app.appHandlers.splice(e,1),this.app.editorHandlers.splice(e,1))}handleApp(e){}handleEditor(e){}}const VAe=()=>{};function BL(i){return i.substring(0,1).toUpperCase()+i.substring(1)}function ZJe(i){const e=JSON.stringify(i);return navigator.clipboard.writeText(e),e}function QJe(i){return i.r!==void 0&&i.g!==void 0&&i.b!==void 0}function nbe(i){const e=Math.round(i.r*255),t=Math.round(i.g*255),n=Math.round(i.b*255),r=c=>{const u=c.toString(16);return u.length===1?"0"+u:u},s=r(e),o=r(t),a=r(n);return"#"+s+o+a}function JJe(i,e,t,n,r){const s=1-i;return s*s*s*e+3*s*s*i*t+3*s*i*i*n+i*i*i*r}function eet(i,e,t){if(i.type!=="bezier"||i.handles.length!==4)throw new Error("Invalid keyframe data for Bzier interpolation.");const[n,r]=i.handles,s=(t-i.position)/(e.position-i.position);return JJe(s,i.value,i.value+n,e.value+r,e.value)}class tet extends Ere{constructor(){super(...arguments);qe(this,"project");qe(this,"sheets",new Map);qe(this,"sheetObjects",new Map);qe(this,"sheetObjectCBs",new Map);qe(this,"sheetObjectUnsubscribe",new Map);qe(this,"activeSheet");qe(this,"studio")}dispose(){this.project=void 0,this.sheets=new Map,this.sheetObjects=new Map,this.sheetObjectCBs=new Map,this.sheetObjectUnsubscribe=new Map}getSheetInstance(t,n){return n!==void 0?`${t}-${n}`:t}sheet(t,n){var o;if(this.project===void 0){console.error("Theatre Project hasn't been created yet.");return}const r=this.getSheetInstance(t,n);let s=this.sheets.get(r);return s!==void 0||(s=(o=this.project)==null?void 0:o.sheet(t,n),this.sheets.set(r,s)),s}playSheet(t,n,r){return new Promise(s=>{var a;const o=n!==void 0?{...n}:{};(a=this.sheet(t,r))==null||a.sequence.play(o).then(c=>s(c)),this.app.send({event:"playSheet",target:"editor",data:{sheet:t,instance:r,value:n}})})}pauseSheet(t,n){var r;(r=this.sheet(t,n))==null||r.sequence.pause(),this.app.send({event:"pauseSheet",target:"editor",data:{sheet:t,instance:n}})}clearSheetObjects(t){this.sheetObjects.forEach((n,r)=>{r.search(`${t}_`)>-1&&this.unsubscribe(n)})}sheetObject(t,n,r,s,o){if(this.project===void 0){console.error("Theatre Project hasn't been created yet.");return}const a=this.sheet(t,o);if(a===void 0)return;const u=`${this.getSheetInstance(t,o)}_${n}`;let f=this.sheetObjects.get(u),m=r;f!==void 0&&(m={...r,...f.value}),f=a.object(n,m),this.sheetObjects.set(u,f),this.sheetObjectCBs.set(u,s!==void 0?s:VAe);const v=f.onValuesChange(x=>{if(this.app.editor){for(const P in x){const R=x[P];typeof R=="object"&&QJe(R)&&(x[P]={r:R.r,g:R.g,b:R.b,a:R.a})}this.app.send({event:"updateSheetObject",target:"app",data:{sheet:t,sheetObject:u,values:x}})}const T=this.sheetObjectCBs.get(u);T!==void 0&&T(x)});return this.sheetObjectUnsubscribe.set(u,v),f}getSheetObjectKeyframes(t,n,r){const s=this.sheet(t);if(s===void 0)return[];const o=`${t}_${n}`,a=this.sheetObjects.get(o);return a===void 0?[]:s.sequence.__experimental_getKeyframes(a.props[r])}getSheetObjectVectors(t,n){const r=this.sheet(t);if(r===void 0)return[];const s=`${t}_${n}`,o=this.sheetObjects.get(s);if(o===void 0)return[];const a=[],c=r.sequence.__experimental_getKeyframes(o.props.x),u=r.sequence.__experimental_getKeyframes(o.props.y),f=r.sequence.__experimental_getKeyframes(o.props.z),m=new Set;return c.forEach(x=>m.add(x.position)),u.forEach(x=>m.add(x.position)),f.forEach(x=>m.add(x.position)),Array.from(m).sort((x,T)=>x-T).forEach(x=>{const T=(P,R)=>{const M=P.find((L,Y)=>{var J;return L.position<=R&&(((J=P[Y+1])==null?void 0:J.position)||1/0)>R}),O=P.find(L=>L.position>R);if(!M)return(O==null?void 0:O.value)||0;if(!O||M.position===R)return M.value;if(M.type==="bezier")return eet(M,O,R);const C=(R-M.position)/(O.position-M.position);return M.value+C*(O.value-M.value)};a.push({position:x,x:T(c,x),y:T(u,x),z:T(f,x)})}),a}unsubscribe(t){if(this.project===void 0){console.error("Theatre Project hasn't been created yet.");return}const n=t.address.sheetId,r=t.address.objectKey,s=this.sheets.get(n);s==null||s.detachObject(r);const o=`${n}_${r}`,a=this.sheetObjectUnsubscribe.get(o);a!==void 0&&(this.sheetObjects.delete(o),this.sheetObjectCBs.delete(o),this.sheetObjectUnsubscribe.delete(o),a())}handleApp(t){var r,s;let n;switch(t.event){case"setSheet":n=this.sheets.get(t.data.sheet),n!==void 0&&(this.activeSheet=n,(r=this.studio)==null||r.setSelection([n]));break;case"setSheetObject":n=this.sheetObjects.get(`${t.data.sheet}_${t.data.key}`),n!==void 0&&((s=this.studio)==null||s.setSelection([n]));break;case"updateSheetObject":n=this.sheets.get(t.data.sheet),n!==void 0&&n.sequence.pause(),n=this.sheetObjectCBs.get(t.data.sheetObject),n!==void 0&&n(t.data.values);break;case"updateTimeline":n=this.sheets.get(t.data.sheet),this.activeSheet!==void 0&&(this.activeSheet.sequence.position=t.data.position);break}}handleEditor(t){var n,r;if(this.app.editor)switch(t.event){case"playSheet":(n=this.sheet(t.data.sheet,t.data.instance))==null||n.sequence.play(t.data.value);break;case"pauseSheet":(r=this.sheet(t.data.sheet,t.data.instance))==null||r.sequence.pause();break}}handleEditorApp(){var t,n,r;if(this.app.editor){(t=this.studio)==null||t.ui.restore(),(n=this.studio)==null||n.onSelectionChange(c=>{c.length<1||c.forEach(u=>{let f=u.address.sheetId,m="setSheet",v={};switch(u.type){case"Theatre_Sheet_PublicAPI":m="setSheet",v={sheet:u.address.sheetId},this.activeSheet=this.sheets.get(u.address.sheetId);break;case"Theatre_SheetObject_PublicAPI":m="setSheetObject",f+=`_${u.address.objectKey}`,v={id:f,sheet:u.address.sheetId,key:u.address.objectKey},this.activeSheet=this.sheets.get(u.address.sheetId);break}this.app.send({event:m,target:"app",data:v})})});let s=-1;const o=()=>{if(this.activeSheet!==void 0&&s!==this.activeSheet.sequence.position){s=this.activeSheet.sequence.position;const c=this.activeSheet;this.app.send({event:"updateTimeline",target:"app",data:{position:s,sheet:c.address.sheetId}})}},a=()=>{o(),requestAnimationFrame(a)};o(),a()}else(r=this.studio)==null||r.ui.hide()}}const rbe=i=>{i==null||i.dispose()},GAe=i=>{if(i)if(Array.isArray(i))i.forEach(e=>GAe(e));else{for(const e in i){const t=i[e];t!==null&&t instanceof Ao&&rbe(t)}if(i.isShaderMaterial===!0){const e=i;for(const t in e.uniforms){const n=e.uniforms[t];n.value!==null&&n.value instanceof Ao&&rbe(n.value)}}i.dispose()}},Td=i=>{var e;if(i){for(;i.children.length>0;){const t=i.children[0];t.type==="Audio"?(t.pause(),t.parent&&t.parent.remove(t)):Td(t)}if(i.parent&&i.parent.remove(i),i.isMesh){const t=i;(e=t.geometry)==null||e.dispose(),GAe(t.material)}i.dispose!==void 0&&i.dispose()}};let $ee=0;const ibe=()=>{$ee=0},q_=i=>{if(!i)return;let e=i.name.replaceAll(" ","").replaceAll("/",".");if(e.length===0&&(e=`obj_${$ee}`,$ee++),i.parent!==null&&i.parent.uuid.length>0&&(e=`${i.parent.uuid}.${e}`),i.uuid=e,i.isMesh!==void 0){const t=i;if(Array.isArray(t.material))t.material.forEach((n,r)=>{n.uuid=`${e}.material.${r}`});else{const n=t.material;n.uuid=`${e}.material`}}i.children.forEach(t=>q_(t))};class Vc{static init(){this.inited||(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.inited=!0)}static renderToBlob(e){this.init();const t=e.repeat.clone(),n=e.offset.clone();if(e.repeat.set(1,1),e.offset.set(0,0),this.context!==null){this.context.clearRect(0,0,this.width,this.height);const r=e.image;if(r!=null&&r.width>0){this.canvas.title=e.sourceFile;const s=this.canvas.width/r.width,o=this.renderToCanvas(e);this.context.drawImage(o,0,0,r.width*s,r.height*s)}}return e.repeat.copy(t),e.offset.copy(n),this.canvas.toDataURL("image/png")}static renderToCanvas(e){if(this.material===null){this.camera=new w4(-.5,.5,.5,-.5,0,100),this.scene=new W1,this.material=new Ea;const t=new Xi;t.setAttribute("position",new br([-.5,-.5,0,1.5,-.5,0,-.5,1.5,0],3)),t.setAttribute("normal",new br([0,0,1,0,0,1],3)),t.setAttribute("uv",new br([0,0,2,0,0,2],2));const n=new dn(t,this.material);this.scene.add(n)}if(e.isRenderTargetTexture)this.material.map=e,this.renderer.render(this.scene,this.camera);else{const t=this.renderer.outputColorSpace,n=e.colorSpace;this.renderer.outputColorSpace=_l,e.colorSpace=_l,this.material.map=e,this.renderer.render(this.scene,this.camera),this.renderer.outputColorSpace=t,e.colorSpace=n}return this.renderer.domElement}}qe(Vc,"renderer"),qe(Vc,"canvas"),qe(Vc,"context",null),qe(Vc,"scene",null),qe(Vc,"camera",null),qe(Vc,"material",null),qe(Vc,"inited",!1),qe(Vc,"width",100),qe(Vc,"height",100);function net(i){if(i.name==="cameras")return"camera";if(i.name==="interactive")return"interactive";if(i.name==="lights")return"light";if(i.name==="ui")return"ui";if(i.name==="utils")return"utils";const e=i.type;return e.search("Helper")>-1?"icon_utils":e.search("Camera")>-1?"camera":e.search("Light")>-1?"light":"obj3D"}function _6(i){const e={name:i.name,type:i.type,uuid:i.uuid,children:[]};return i.children.forEach(t=>{e.children.push(_6(t))}),e}function ret(i){const e={};for(const t in i){const n=i[t].value;e[t]={value:n},n===null?e[t].value={src:"",offset:[0,0],repeat:[1,1]}:n!==void 0&&n.isTexture&&(e[t].value={src:n.image.src,offset:[n.offset.x,n.offset.y],repeat:[n.repeat.x,n.repeat.y]})}return e}function iet(i){switch(i){case"blendSrcAlpha":case"blendDstAlpha":case"blendEquationAlpha":case"clippingPlanes":case"shadowSide":case"precision":return!0}return!1}function H8(i){const e={};for(const t in i){if(t.substring(0,1)==="_"||t.substring(0,2)==="is"||iet(t))continue;const n=typeof i[t],r=i[t];switch(n){case"boolean":case"number":case"string":e[t]=r;break;case"object":r!==null?(e[t]=r,r.isTexture?e[t]={src:Vc.renderToBlob(r),offset:[r.offset.x,r.offset.y],repeat:[r.repeat.x,r.repeat.y]}:t==="uniforms"&&(e[t]=ret(e[t]))):t==="glslVersion"?e[t]="":e[t]={src:"",offset:[0,0],repeat:[1,1]};break}}return i.anisotropy!==void 0&&(e.anisotropy=i.anisotropy),i.clearcoat!==void 0&&(e.clearcoat=i.clearcoat),i.iridescence!==void 0&&(e.iridescence=i.iridescence),i.dispersion!==void 0&&(e.dispersion=i.dispersion),i.sheen!==void 0&&(e.sheen=i.sheen),i.transmission!==void 0&&(e.transmission=i.transmission),i.transmission!==void 0&&(e.transmission=i.transmission),e}function mZ(i){i.updateMatrix();const e={name:i.name,type:i.type,uuid:i.uuid,visible:i.visible,matrix:i.matrix.elements,animations:[],material:void 0,perspectiveCameraInfo:void 0,orthographicCameraInfo:void 0,lightInfo:void 0,children:[]};i.animations.forEach(n=>{e.animations.push({name:n.name,duration:n.duration,blendMode:n.blendMode})});const t=i.type.toLowerCase();if(t.search("mesh")>-1){const n=i;if(Array.isArray(n.material)){const r=[];n.material.forEach(s=>{r.push(H8(s))}),e.material=r}else e.material=H8(n.material)}else if(t.search("points")>-1){const n=i;if(Array.isArray(n.material)){const r=[];n.material.forEach(s=>{r.push(H8(s))}),e.material=r}else e.material=H8(n.material)}else if(t.search("line")>-1){const n=i;if(Array.isArray(n.material)){const r=[];n.material.forEach(s=>{r.push(H8(s))}),e.material=r}else e.material=H8(n.material)}else t.search("camera")>-1?i.type==="PerspectiveCamera"?e.perspectiveCameraInfo={fov:i.fov,zoom:i.zoom,near:i.near,far:i.far,focus:i.focus,aspect:i.aspect,filmGauge:i.filmGauge,filmOffset:i.filmOffset}:i.type==="OrthographicCamera"&&(e.orthographicCameraInfo={zoom:i.zoom,near:i.near,far:i.far,left:i.left,right:i.right,top:i.top,bottom:i.bottom}):t.search("light")>-1&&(e.lightInfo={color:i.color,intensity:i.intensity,decay:i.decay,distance:i.distance,angle:i.angle,penumbra:i.penumbra,groundColor:i.groundColor,width:i.width,height:i.height});return e}function set(i,e){const t=e.split(".");switch(t.length){case 1:return i[t[0]];case 2:return i[t[0]][t[1]];case 3:return i[t[0]][t[1]][t[2]];case 4:return i[t[0]][t[1]][t[2]][t[3]];case 5:return i[t[0]][t[1]][t[2]][t[3]][t[4]];case 6:return i[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]]}}function oet(i,e){for(const t in e)i[t]=e[t]}function Lo(i,e,t){if(i===void 0)return;const n=e.split("."),r=n.length;if(typeof t!="object")switch(r){case 1:i[n[0]]=t;break;case 2:i[n[0]][n[1]]=t;break;case 3:i[n[0]][n[1]][n[2]]=t;break;case 4:i[n[0]][n[1]][n[2]][n[3]]=t;break;case 5:i[n[0]][n[1]][n[2]][n[3]][n[4]]=t;break}else{let o;switch(r){case 1:o=i[n[0]];break;case 2:o=i[n[0]][n[1]];break;case 3:o=i[n[0]][n[1]][n[2]];break;case 4:o=i[n[0]][n[1]][n[2]][n[3]];break;case 5:o=i[n[0]][n[1]][n[2]][n[3]][n[4]];break}o!=null&&oet(o,t)}}function Mre(i){return new Promise((e,t)=>{const n=new Image;n.onload=()=>{const r=new Ao(n);r.wrapS=tu,r.wrapT=tu,r.needsUpdate=!0,e(r)},n.onerror=t,n.src=i})}function Ty(i,e,t){return Math.min(e,Math.max(i,t))}function sbe(i,e,t){return(t-i)/(e-i)}function Hee(i,e,t){return i*(1-t)+e*t}function hd(i,e=1){return Number(i.toFixed(e))}class aet extends Ere{constructor(){super(...arguments);qe(this,"canvas",null);qe(this,"inputElement",null);qe(this,"scene");qe(this,"scenes",new Map);qe(this,"renderer");qe(this,"renderTargets",new Map);qe(this,"groups",new Map)}dispose(){var t;this.scenes.forEach(n=>{Td(n)}),this.scenes.clear(),this.scene&&Td(this.scene),this.renderTargets.forEach(n=>{n.dispose()}),this.renderTargets.clear(),(t=this.renderer)==null||t.dispose()}getObject(t){this.app.debugEnabled&&(this.renderer!==void 0&&(Vc.renderer=this.renderer),this.app.send({event:"getObject",target:"app",data:t}))}setObject(t){this.renderer!==void 0&&(Vc.renderer=this.renderer);const n=mZ(t);this.app.send({event:"setObject",target:"editor",data:n})}requestMethod(t,n,r,s){this.app.send({event:"requestMethod",target:"app",data:{uuid:t,key:n,value:r,subitem:s}})}updateObject(t,n,r){this.app.send({event:"updateObject",target:"app",data:{uuid:t,key:n,value:r}})}createTexture(t,n,r){this.app.send({event:"createTexture",target:"app",data:{uuid:t,key:n,value:r}})}addGroup(t){this.groups.get(t.title)===void 0&&(this.groups.set(t.title,{title:t.title,onUpdate:t.onUpdate}),this.app.send({event:"addGroup",target:"editor",data:JSON.stringify(t)}))}removeGroup(t){this.groups.get(t)!==void 0&&(this.groups.delete(t),this.app.send({event:"removeGroup",target:"editor",data:t}))}updateGroup(t,n,r){this.app.send({event:"updateGroup",target:"app",data:JSON.stringify({group:t,prop:n,value:r})})}removeAllGroups(){this.groups.forEach(t=>{const n=t.title;this.groups.delete(n),this.app.send({event:"removeGroup",target:"editor",data:n})}),this.groups.clear()}addSpline(t){setTimeout(()=>{this.app.send({event:"addSpline",target:"editor",data:JSON.stringify(t.toJSON())})},1)}setRenderer(t,n=null){if(this.renderer=t,this.canvas=t.domElement,this.inputElement=n!==null?n:this.canvas,!this.app.debugEnabled)return;const r=`#${t.getClearColor(new yn).getHexString()}`;this.app.send({event:"addRenderer",target:"editor",data:{autoClear:t.autoClear,autoClearColor:t.autoClearColor,autoClearDepth:t.autoClearDepth,autoClearStencil:t.autoClearStencil,outputColorSpace:t.outputColorSpace,localClippingEnabled:t.localClippingEnabled,clearColor:r,clearAlpha:t.getClearAlpha(),colorManagement:rr.enabled,toneMapping:t.toneMapping,toneMappingExposure:t.toneMappingExposure,type:t.isWebGLRenderer?"WebGLRenderer":"WebGPURenderer"}})}updateRenderer(t){this.app.send({event:"updateRenderer",target:"app",data:t})}addScene(t){if(t===void 0||(this.scenes.set(t.name,t),!this.app.debugEnabled))return;ibe(),q_(t);const n=_6(t);this.app.send({event:"addScene",target:"editor",data:n})}refreshScene(t){if(!this.app.debugEnabled)return;const n=this.scenes.get(t);if(n!==void 0){const r=_6(n);this.app.send({event:"refreshScene",target:"app",data:r})}}removeScene(t){if(t===void 0||(this.scenes.delete(t.name),!this.app.debugEnabled))return;const n=_6(t);this.app.send({event:"removeScene",target:"editor",data:n})}removeAllScenes(){this.scenes.forEach(t=>this.removeScene(t))}getScene(t){let n=null;return this.scenes.forEach((r,s)=>{t.search(s)>-1&&(n=r)}),n}setScene(t){if(t===void 0||(this.scene=t,!this.app.debugEnabled))return;this.renderer!==void 0&&(Vc.renderer=this.renderer),ibe(),q_(t);const n=_6(t);this.app.send({event:"setScene",target:"editor",data:n})}addCamera(t){if(!this.app.debugEnabled)return;const n=mZ(t);this.app.send({event:"addCamera",target:"editor",data:n})}removeCamera(t){if(!this.app.debugEnabled)return;const n=mZ(t);this.app.send({event:"removeCamera",target:"editor",data:n})}handleApp(t){switch(t.event){case"getObject":this.app.dispatchEvent({type:ar.GET_OBJECT,value:t.data});break;case"updateObject":this.app.dispatchEvent({type:ar.UPDATE_OBJECT,value:t.data});break;case"createTexture":this.app.dispatchEvent({type:ar.CREATE_TEXTURE,value:t.data});break;case"requestMethod":this.app.dispatchEvent({type:ar.REQUEST_METHOD,value:t.data});break;case"refreshScene":this.app.send({event:"refreshScene",target:"editor",data:_6(this.scenes.get(t.data.name))});break;case"updateRenderer":this.renderer&&(this.renderer.autoClear=t.data.autoClear,this.renderer.autoClearColor=t.data.autoClearColor,this.renderer.autoClearDepth=t.data.autoClearDepth,this.renderer.autoClearStencil=t.data.autoClearStencil,this.renderer.outputColorSpace=t.data.outputColorSpace,this.renderer.localClippingEnabled=t.data.localClippingEnabled,this.renderer.setClearColor(t.data.clearColor,t.data.clearAlpha),this.renderer.toneMapping=t.data.toneMapping,this.renderer.toneMappingExposure=t.data.toneMappingExposure,rr.enabled=t.data.colorManagement);break}if(t.event==="updateGroup"){const n=JSON.parse(t.data),r=this.groups.get(n.group);r==null||r.onUpdate(n.prop,n.value)}}handleEditor(t){switch(t.event){case"setObject":this.app.dispatchEvent({type:ar.SET_OBJECT,value:t.data});break;case"addScene":this.app.dispatchEvent({type:ar.ADD_SCENE,value:t.data});break;case"refreshScene":this.app.dispatchEvent({type:ar.REFRESH_SCENE,value:t.data});break;case"removeScene":this.app.dispatchEvent({type:ar.REMOVE_SCENE,value:t.data});break;case"setScene":this.app.dispatchEvent({type:ar.SET_SCENE,value:t.data});break;case"addCamera":this.app.dispatchEvent({type:ar.ADD_CAMERA,value:t.data});break;case"removeCamera":this.app.dispatchEvent({type:ar.REMOVE_CAMERA,value:t.data});break;case"addGroup":this.app.dispatchEvent({type:ar.ADD_GROUP,value:t.data});break;case"removeGroup":this.app.dispatchEvent({type:ar.REMOVE_GROUP,value:t.data});break;case"addSpline":this.app.dispatchEvent({type:ar.ADD_SPLINE,value:t.data});break;case"addRenderer":this.app.dispatchEvent({type:ar.ADD_RENDERER,value:t.data})}}addRT(t,n){const r=new yc(32,32,n);r.texture.name=t,this.renderTargets.set(t,r)}resize(t,n){var o,a;const r=this.dpr;this.renderTargets.forEach(c=>{c.setSize(t*r,n*r)});const s=!(((o=this.renderer)==null?void 0:o.domElement)instanceof OffscreenCanvas);(a=this.renderer)==null||a.setSize(t,n,s)}set dpr(t){var n;(n=this.renderer)==null||n.setPixelRatio(Ty(1,2,t))}get dpr(){var t;return this.renderer!==void 0?(t=this.renderer)==null?void 0:t.getPixelRatio():1}get width(){return this.renderer!==void 0?this.renderer.domElement.width/this.dpr:0}get height(){return this.renderer!==void 0?this.renderer.domElement.height/this.dpr:0}}class cet extends Ere{selectDropdown(e,t){this.app.send({event:"selectComponent",target:"app",data:{dropdown:e,value:t}})}updateDropdown(e,t){this.app.send({event:"draggableListUpdate",target:"app",data:{dropdown:e,value:t}})}handleApp(e){switch(e.event){case"selectComponent":this.app.dispatchEvent({type:ar.SELECT_DROPDOWN,value:e.data});break;case"draggableListUpdate":this.app.dispatchEvent({type:ar.DRAG_UPDATE,value:e.data});break}}}function uet(i){i.app.addComponent("components",new cet(i.app));const e=i.app.components.get("theatre");e.studio=zCe;const t=()=>{T4.removeEventListener(H2.LOAD_COMPLETE,t),e.handleEditorApp()};return T4.addEventListener(H2.LOAD_COMPLETE,t),null}function het(i){return We.jsxs("div",{className:"editor",ref:i.ref,style:i.style,children:[We.jsx("div",{className:"header",children:i.header}),i.children,We.jsx("div",{className:"footer",children:i.footer})]})}let det=class{constructor(e,t){this.nodes=e,this.info=t,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this._animationLoop!==null&&this._animationLoop(t,n)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}};const fet=det;let pet=class{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let n=this.weakMap;for(let r=0;r<e.length-1;r++){const s=e[r];n.has(s)===!1&&n.set(s,new WeakMap),n=n.get(s)}return n.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return!1;return t.delete(e[e.length-1])}};const Ed=pet,Ll=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let obe=1234567;const kE=Math.PI/180,X_=180/Math.PI;function N1(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Ll[i&255]+Ll[i>>8&255]+Ll[i>>16&255]+Ll[i>>24&255]+"-"+Ll[e&255]+Ll[e>>8&255]+"-"+Ll[e>>16&15|64]+Ll[e>>24&255]+"-"+Ll[t&63|128]+Ll[t>>8&255]+"-"+Ll[t>>16&255]+Ll[t>>24&255]+Ll[n&255]+Ll[n>>8&255]+Ll[n>>16&255]+Ll[n>>24&255]).toLowerCase()}function di(i,e,t){return Math.max(e,Math.min(t,i))}function Cre(i,e){return(i%e+e)%e}function Ey(i,e,t,n,r){return n+(i-e)*(r-n)/(t-e)}function met(i,e,t){return i!==e?(t-i)/(e-i):0}function dd(i,e,t){return(1-t)*i+t*e}function get(i,e,t,n){return dd(i,e,1-Math.exp(-t*n))}function yet(i,e=1){return e-Math.abs(Cre(i,e*2)-e)}function vet(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function _et(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function xet(i,e){return i+Math.floor(Math.random()*(e-i+1))}function bet(i,e){return i+Math.random()*(e-i)}function wet(i){return i*(.5-Math.random())}function Tet(i){i!==void 0&&(obe=i);let e=obe+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function LL(i){return i*kE}function $Ae(i){return i*X_}function Eet(i){return(i&i-1)===0&&i!==0}function Met(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Cet(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function Aet(i,e,t,n,r){const s=Math.cos,o=Math.sin,a=s(t/2),c=o(t/2),u=s((e+n)/2),f=o((e+n)/2),m=s((e-n)/2),v=o((e-n)/2),x=s((n-e)/2),T=o((n-e)/2);switch(r){case"XYX":i.set(a*f,c*m,c*v,a*u);break;case"YZY":i.set(c*v,a*f,c*m,a*u);break;case"ZXZ":i.set(c*m,c*v,a*f,a*u);break;case"XZX":i.set(a*f,c*T,c*x,a*u);break;case"YXY":i.set(c*x,a*f,c*T,a*u);break;case"ZYZ":i.set(c*T,c*x,a*f,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function P0(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Jr(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const Ret={DEG2RAD:kE,RAD2DEG:X_,generateUUID:N1,clamp:di,euclideanModulo:Cre,mapLinear:Ey,inverseLerp:met,lerp:dd,damp:get,pingpong:yet,smoothstep:vet,smootherstep:_et,randInt:xet,randFloat:bet,randFloatSpread:wet,seededRandom:Tet,degToRad:LL,radToDeg:$Ae,isPowerOfTwo:Eet,ceilPowerOfTwo:Met,floorPowerOfTwo:Cet,setQuaternionFromProperEuler:Aet,normalize:Jr,denormalize:P0},HAe="177",Pet=0,Net=1,Iet=2,ket=0,Det=1,zB=3,I1=0,gc=1,s_=2,Y_=0,k1=1,UL=2,zL=3,VL=4,DE=5,md=100,jAe=101,WAe=102,Fet=103,Oet=104,d2=200,qAe=201,XAe=202,YAe=203,GL=204,$L=205,KAe=206,ZAe=207,QAe=208,JAe=209,eRe=210,tRe=0,nRe=1,rRe=2,HL=3,iRe=4,sRe=5,oRe=6,aRe=7,YU=0,Bet=1,Let=2,o_=0,Uet=1,zet=2,Vet=3,Get=4,$et=6,Het=7,Are=300,PM=301,jL=302,Rre=303,Pre=304,jee=306,K_=1e3,E2=1001,Z_=1002,Ma=1003,lRe=1004,NM=1005,nu=1006,Wee=1007,D1=1008,N0=1009,FE=1010,OE=1011,U6=1012,M0=1013,Uo=1014,Xc=1015,qu=1016,jet=1017,Wet=1018,B2=1020,cRe=35902,qet=1021,Nre=1022,Xu=1023,Hf=1026,F1=1027,Ire=1028,kre=1029,Ky=1030,Dre=1031,Xet=1032,Fre=1033,gZ=33776,VB=33777,GB=33778,$B=33779,abe=35840,lbe=35841,cbe=35842,ube=35843,hbe=36196,qee=37492,Xee=37496,Yee=37808,Kee=37809,Zee=37810,Qee=37811,Jee=37812,ete=37813,tte=37814,nte=37815,rte=37816,ite=37817,ste=37818,ote=37819,ate=37820,lte=37821,yZ=36492,Yet=36283,dbe=36284,fbe=36285,pbe=36286,j2=0,Ket=1,q1="",Wc="srgb",a_="srgb-linear",WL="linear",Fr="srgb",Zet=0,My=7680,Qet=7681,Jet=7682,ett=7683,ttt=34055,ntt=34056,rtt=5386,itt=512,stt=513,ott=514,att=515,ltt=516,ctt=517,utt=518,cte=519,uRe=512,Ore=513,hRe=514,dRe=515,fRe=516,pRe=517,mRe=518,gRe=519,qL=35044,z6=35048,ac=2e3,W2=2001;class _c{constructor(e,t,n,r,s,o,a,c,u){_c.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,c,u)}set(e,t,n,r,s,o,a,c,u){const f=this.elements;return f[0]=e,f[1]=r,f[2]=a,f[3]=t,f[4]=s,f[5]=c,f[6]=n,f[7]=o,f[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[3],c=n[6],u=n[1],f=n[4],m=n[7],v=n[2],x=n[5],T=n[8],P=r[0],R=r[3],M=r[6],O=r[1],C=r[4],L=r[7],Y=r[2],J=r[5],z=r[8];return s[0]=o*P+a*O+c*Y,s[3]=o*R+a*C+c*J,s[6]=o*M+a*L+c*z,s[1]=u*P+f*O+m*Y,s[4]=u*R+f*C+m*J,s[7]=u*M+f*L+m*z,s[2]=v*P+x*O+T*Y,s[5]=v*R+x*C+T*J,s[8]=v*M+x*L+T*z,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],f=e[8];return t*o*f-t*a*u-n*s*f+n*a*c+r*s*u-r*o*c}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],f=e[8],m=f*o-a*u,v=a*c-f*s,x=u*s-o*c,T=t*m+n*v+r*x;if(T===0)return this.set(0,0,0,0,0,0,0,0,0);const P=1/T;return e[0]=m*P,e[1]=(r*u-f*n)*P,e[2]=(a*n-r*o)*P,e[3]=v*P,e[4]=(f*t-r*c)*P,e[5]=(r*s-a*t)*P,e[6]=x*P,e[7]=(n*c-u*t)*P,e[8]=(o*t-n*s)*P,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,o,a){const c=Math.cos(s),u=Math.sin(s);return this.set(n*c,n*u,-n*(c*o+u*a)+o+e,-r*u,r*c,-r*(-u*o+c*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(vZ.makeScale(e,t)),this}rotate(e){return this.premultiply(vZ.makeRotation(-e)),this}translate(e,t){return this.premultiply(vZ.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const vZ=new _c;function yRe(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}function ute(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function htt(){const i=ute("canvas");return i.style.display="block",i}const mbe={};function X1(i){i in mbe||(mbe[i]=!0,console.warn(i))}const gbe=new _c().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),ybe=new _c().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function dtt(){const i={enabled:!0,workingColorSpace:a_,spaces:{},convert:function(r,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===Fr&&(r.r=O1(r.r),r.g=O1(r.g),r.b=O1(r.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Fr&&(r.r=l_(r.r),r.g=l_(r.g),r.b=l_(r.b))),r},workingToColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},colorSpaceToWorking:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===q1?WL:this.spaces[r].transfer},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,o){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(r,s){return X1("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),i.workingToColorSpace(r,s)},toWorkingColorSpace:function(r,s){return X1("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),i.colorSpaceToWorking(r,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return i.define({[a_]:{primaries:e,whitePoint:n,transfer:WL,toXYZ:gbe,fromXYZ:ybe,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Wc},outputColorSpaceConfig:{drawingBufferColorSpace:Wc}},[Wc]:{primaries:e,whitePoint:n,transfer:Fr,toXYZ:gbe,fromXYZ:ybe,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Wc}}}),i}const Rs=dtt();function O1(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function l_(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}const vRe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Yg={h:0,s:0,l:0},yO={h:0,s:0,l:0};function _Z(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}class zi{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Wc){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Rs.colorSpaceToWorking(this,t),this}setRGB(e,t,n,r=Rs.workingColorSpace){return this.r=e,this.g=t,this.b=n,Rs.colorSpaceToWorking(this,r),this}setHSL(e,t,n,r=Rs.workingColorSpace){if(e=Cre(e,1),t=di(t,0,1),n=di(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=_Z(o,s,e+1/3),this.g=_Z(o,s,e),this.b=_Z(o,s,e-1/3)}return Rs.colorSpaceToWorking(this,r),this}setStyle(e,t=Wc){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Wc){const n=vRe[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=O1(e.r),this.g=O1(e.g),this.b=O1(e.b),this}copyLinearToSRGB(e){return this.r=l_(e.r),this.g=l_(e.g),this.b=l_(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Wc){return Rs.workingToColorSpace(Ul.copy(this),e),Math.round(di(Ul.r*255,0,255))*65536+Math.round(di(Ul.g*255,0,255))*256+Math.round(di(Ul.b*255,0,255))}getHexString(e=Wc){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Rs.workingColorSpace){Rs.workingToColorSpace(Ul.copy(this),t);const n=Ul.r,r=Ul.g,s=Ul.b,o=Math.max(n,r,s),a=Math.min(n,r,s);let c,u;const f=(a+o)/2;if(a===o)c=0,u=0;else{const m=o-a;switch(u=f<=.5?m/(o+a):m/(2-o-a),o){case n:c=(r-s)/m+(r<s?6:0);break;case r:c=(s-n)/m+2;break;case s:c=(n-r)/m+4;break}c/=6}return e.h=c,e.s=u,e.l=f,e}getRGB(e,t=Rs.workingColorSpace){return Rs.workingToColorSpace(Ul.copy(this),t),e.r=Ul.r,e.g=Ul.g,e.b=Ul.b,e}getStyle(e=Wc){Rs.workingToColorSpace(Ul.copy(this),e);const t=Ul.r,n=Ul.g,r=Ul.b;return e!==Wc?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(Yg),this.setHSL(Yg.h+e,Yg.s+t,Yg.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Yg),e.getHSL(yO);const n=dd(Yg.h,yO.h,t),r=dd(Yg.s,yO.s,t),s=dd(Yg.l,yO.l,t);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*r,this.g=s[1]*t+s[4]*n+s[7]*r,this.b=s[2]*t+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ul=new zi;zi.NAMES=vRe;class KU{constructor(e,t,n,r){KU.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,r){const s=this.elements;return s[0]=e,s[2]=t,s[1]=n,s[3]=r,this}}class Tx{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,s,o,a){let c=n[r+0],u=n[r+1],f=n[r+2],m=n[r+3];const v=s[o+0],x=s[o+1],T=s[o+2],P=s[o+3];if(a===0){e[t+0]=c,e[t+1]=u,e[t+2]=f,e[t+3]=m;return}if(a===1){e[t+0]=v,e[t+1]=x,e[t+2]=T,e[t+3]=P;return}if(m!==P||c!==v||u!==x||f!==T){let R=1-a;const M=c*v+u*x+f*T+m*P,O=M>=0?1:-1,C=1-M*M;if(C>Number.EPSILON){const Y=Math.sqrt(C),J=Math.atan2(Y,M*O);R=Math.sin(R*J)/Y,a=Math.sin(a*J)/Y}const L=a*O;if(c=c*R+v*L,u=u*R+x*L,f=f*R+T*L,m=m*R+P*L,R===1-a){const Y=1/Math.sqrt(c*c+u*u+f*f+m*m);c*=Y,u*=Y,f*=Y,m*=Y}}e[t]=c,e[t+1]=u,e[t+2]=f,e[t+3]=m}static multiplyQuaternionsFlat(e,t,n,r,s,o){const a=n[r],c=n[r+1],u=n[r+2],f=n[r+3],m=s[o],v=s[o+1],x=s[o+2],T=s[o+3];return e[t]=a*T+f*m+c*x-u*v,e[t+1]=c*T+f*v+u*m-a*x,e[t+2]=u*T+f*x+a*v-c*m,e[t+3]=f*T-a*m-c*v-u*x,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,u=a(n/2),f=a(r/2),m=a(s/2),v=c(n/2),x=c(r/2),T=c(s/2);switch(o){case"XYZ":this._x=v*f*m+u*x*T,this._y=u*x*m-v*f*T,this._z=u*f*T+v*x*m,this._w=u*f*m-v*x*T;break;case"YXZ":this._x=v*f*m+u*x*T,this._y=u*x*m-v*f*T,this._z=u*f*T-v*x*m,this._w=u*f*m+v*x*T;break;case"ZXY":this._x=v*f*m-u*x*T,this._y=u*x*m+v*f*T,this._z=u*f*T+v*x*m,this._w=u*f*m-v*x*T;break;case"ZYX":this._x=v*f*m-u*x*T,this._y=u*x*m+v*f*T,this._z=u*f*T-v*x*m,this._w=u*f*m+v*x*T;break;case"YZX":this._x=v*f*m+u*x*T,this._y=u*x*m+v*f*T,this._z=u*f*T-v*x*m,this._w=u*f*m-v*x*T;break;case"XZY":this._x=v*f*m-u*x*T,this._y=u*x*m-v*f*T,this._z=u*f*T+v*x*m,this._w=u*f*m+v*x*T;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],s=t[8],o=t[1],a=t[5],c=t[9],u=t[2],f=t[6],m=t[10],v=n+a+m;if(v>0){const x=.5/Math.sqrt(v+1);this._w=.25/x,this._x=(f-c)*x,this._y=(s-u)*x,this._z=(o-r)*x}else if(n>a&&n>m){const x=2*Math.sqrt(1+n-a-m);this._w=(f-c)/x,this._x=.25*x,this._y=(r+o)/x,this._z=(s+u)/x}else if(a>m){const x=2*Math.sqrt(1+a-n-m);this._w=(s-u)/x,this._x=(r+o)/x,this._y=.25*x,this._z=(c+f)/x}else{const x=2*Math.sqrt(1+m-n-a);this._w=(o-r)/x,this._x=(s+u)/x,this._y=(c+f)/x,this._z=.25*x}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(di(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,s=e._z,o=e._w,a=t._x,c=t._y,u=t._z,f=t._w;return this._x=n*f+o*a+r*u-s*c,this._y=r*f+o*c+s*a-n*u,this._z=s*f+o*u+n*c-r*a,this._w=o*f-n*a-r*c-s*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+n*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const x=1-t;return this._w=x*o+t*this._w,this._x=x*n+t*this._x,this._y=x*r+t*this._y,this._z=x*s+t*this._z,this.normalize(),this}const u=Math.sqrt(c),f=Math.atan2(u,a),m=Math.sin((1-t)*f)/u,v=Math.sin(t*f)/u;return this._w=o*m+this._w*v,this._x=n*m+this._x*v,this._y=r*m+this._y*v,this._z=s*m+this._z*v,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class st{constructor(e=0,t=0,n=0){st.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(vbe.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(vbe.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*r,this.y=s[1]*t+s[4]*n+s[7]*r,this.z=s[2]*t+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z,c=e.w,u=2*(o*r-a*n),f=2*(a*t-s*r),m=2*(s*n-o*t);return this.x=t+c*u+o*m-a*f,this.y=n+c*f+a*u-s*m,this.z=r+c*m+s*f-o*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r,this.y=s[1]*t+s[5]*n+s[9]*r,this.z=s[2]*t+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=di(this.x,e.x,t.x),this.y=di(this.y,e.y,t.y),this.z=di(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=di(this.x,e,t),this.y=di(this.y,e,t),this.z=di(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(di(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,s=e.z,o=t.x,a=t.y,c=t.z;return this.x=r*c-s*a,this.y=s*o-n*c,this.z=n*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return xZ.copy(this).projectOnVector(e),this.sub(xZ)}reflect(e){return this.sub(xZ.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(di(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const xZ=new st,vbe=new Tx;class bs{constructor(e,t,n,r,s,o,a,c,u,f,m,v,x,T,P,R){bs.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,c,u,f,m,v,x,T,P,R)}set(e,t,n,r,s,o,a,c,u,f,m,v,x,T,P,R){const M=this.elements;return M[0]=e,M[4]=t,M[8]=n,M[12]=r,M[1]=s,M[5]=o,M[9]=a,M[13]=c,M[2]=u,M[6]=f,M[10]=m,M[14]=v,M[3]=x,M[7]=T,M[11]=P,M[15]=R,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new bs().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/j8.setFromMatrixColumn(e,0).length(),s=1/j8.setFromMatrixColumn(e,1).length(),o=1/j8.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),a=Math.sin(n),c=Math.cos(r),u=Math.sin(r),f=Math.cos(s),m=Math.sin(s);if(e.order==="XYZ"){const v=o*f,x=o*m,T=a*f,P=a*m;t[0]=c*f,t[4]=-c*m,t[8]=u,t[1]=x+T*u,t[5]=v-P*u,t[9]=-a*c,t[2]=P-v*u,t[6]=T+x*u,t[10]=o*c}else if(e.order==="YXZ"){const v=c*f,x=c*m,T=u*f,P=u*m;t[0]=v+P*a,t[4]=T*a-x,t[8]=o*u,t[1]=o*m,t[5]=o*f,t[9]=-a,t[2]=x*a-T,t[6]=P+v*a,t[10]=o*c}else if(e.order==="ZXY"){const v=c*f,x=c*m,T=u*f,P=u*m;t[0]=v-P*a,t[4]=-o*m,t[8]=T+x*a,t[1]=x+T*a,t[5]=o*f,t[9]=P-v*a,t[2]=-o*u,t[6]=a,t[10]=o*c}else if(e.order==="ZYX"){const v=o*f,x=o*m,T=a*f,P=a*m;t[0]=c*f,t[4]=T*u-x,t[8]=v*u+P,t[1]=c*m,t[5]=P*u+v,t[9]=x*u-T,t[2]=-u,t[6]=a*c,t[10]=o*c}else if(e.order==="YZX"){const v=o*c,x=o*u,T=a*c,P=a*u;t[0]=c*f,t[4]=P-v*m,t[8]=T*m+x,t[1]=m,t[5]=o*f,t[9]=-a*f,t[2]=-u*f,t[6]=x*m+T,t[10]=v-P*m}else if(e.order==="XZY"){const v=o*c,x=o*u,T=a*c,P=a*u;t[0]=c*f,t[4]=-m,t[8]=u*f,t[1]=v*m+P,t[5]=o*f,t[9]=x*m-T,t[2]=T*m-x,t[6]=a*f,t[10]=P*m+v}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ftt,e,ptt)}lookAt(e,t,n){const r=this.elements;return Oc.subVectors(e,t),Oc.lengthSq()===0&&(Oc.z=1),Oc.normalize(),Kg.crossVectors(n,Oc),Kg.lengthSq()===0&&(Math.abs(n.z)===1?Oc.x+=1e-4:Oc.z+=1e-4,Oc.normalize(),Kg.crossVectors(n,Oc)),Kg.normalize(),vO.crossVectors(Oc,Kg),r[0]=Kg.x,r[4]=vO.x,r[8]=Oc.x,r[1]=Kg.y,r[5]=vO.y,r[9]=Oc.y,r[2]=Kg.z,r[6]=vO.z,r[10]=Oc.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[4],c=n[8],u=n[12],f=n[1],m=n[5],v=n[9],x=n[13],T=n[2],P=n[6],R=n[10],M=n[14],O=n[3],C=n[7],L=n[11],Y=n[15],J=r[0],z=r[4],ne=r[8],K=r[12],$=r[1],he=r[5],Ce=r[9],Pe=r[13],je=r[2],ge=r[6],Xe=r[10],Fe=r[14],Ne=r[3],tt=r[7],mt=r[11],Ht=r[15];return s[0]=o*J+a*$+c*je+u*Ne,s[4]=o*z+a*he+c*ge+u*tt,s[8]=o*ne+a*Ce+c*Xe+u*mt,s[12]=o*K+a*Pe+c*Fe+u*Ht,s[1]=f*J+m*$+v*je+x*Ne,s[5]=f*z+m*he+v*ge+x*tt,s[9]=f*ne+m*Ce+v*Xe+x*mt,s[13]=f*K+m*Pe+v*Fe+x*Ht,s[2]=T*J+P*$+R*je+M*Ne,s[6]=T*z+P*he+R*ge+M*tt,s[10]=T*ne+P*Ce+R*Xe+M*mt,s[14]=T*K+P*Pe+R*Fe+M*Ht,s[3]=O*J+C*$+L*je+Y*Ne,s[7]=O*z+C*he+L*ge+Y*tt,s[11]=O*ne+C*Ce+L*Xe+Y*mt,s[15]=O*K+C*Pe+L*Fe+Y*Ht,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],s=e[12],o=e[1],a=e[5],c=e[9],u=e[13],f=e[2],m=e[6],v=e[10],x=e[14],T=e[3],P=e[7],R=e[11],M=e[15];return T*(+s*c*m-r*u*m-s*a*v+n*u*v+r*a*x-n*c*x)+P*(+t*c*x-t*u*v+s*o*v-r*o*x+r*u*f-s*c*f)+R*(+t*u*m-t*a*x-s*o*m+n*o*x+s*a*f-n*u*f)+M*(-r*a*f-t*c*m+t*a*v+r*o*m-n*o*v+n*c*f)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],f=e[8],m=e[9],v=e[10],x=e[11],T=e[12],P=e[13],R=e[14],M=e[15],O=m*R*u-P*v*u+P*c*x-a*R*x-m*c*M+a*v*M,C=T*v*u-f*R*u-T*c*x+o*R*x+f*c*M-o*v*M,L=f*P*u-T*m*u+T*a*x-o*P*x-f*a*M+o*m*M,Y=T*m*c-f*P*c-T*a*v+o*P*v+f*a*R-o*m*R,J=t*O+n*C+r*L+s*Y;if(J===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const z=1/J;return e[0]=O*z,e[1]=(P*v*s-m*R*s-P*r*x+n*R*x+m*r*M-n*v*M)*z,e[2]=(a*R*s-P*c*s+P*r*u-n*R*u-a*r*M+n*c*M)*z,e[3]=(m*c*s-a*v*s-m*r*u+n*v*u+a*r*x-n*c*x)*z,e[4]=C*z,e[5]=(f*R*s-T*v*s+T*r*x-t*R*x-f*r*M+t*v*M)*z,e[6]=(T*c*s-o*R*s-T*r*u+t*R*u+o*r*M-t*c*M)*z,e[7]=(o*v*s-f*c*s+f*r*u-t*v*u-o*r*x+t*c*x)*z,e[8]=L*z,e[9]=(T*m*s-f*P*s-T*n*x+t*P*x+f*n*M-t*m*M)*z,e[10]=(o*P*s-T*a*s+T*n*u-t*P*u-o*n*M+t*a*M)*z,e[11]=(f*a*s-o*m*s-f*n*u+t*m*u+o*n*x-t*a*x)*z,e[12]=Y*z,e[13]=(f*P*r-T*m*r+T*n*v-t*P*v-f*n*R+t*m*R)*z,e[14]=(T*a*r-o*P*r-T*n*c+t*P*c+o*n*R-t*a*R)*z,e[15]=(o*m*r-f*a*r+f*n*c-t*m*c-o*n*v+t*a*v)*z,this}scale(e){const t=this.elements,n=e.x,r=e.y,s=e.z;return t[0]*=n,t[4]*=r,t[8]*=s,t[1]*=n,t[5]*=r,t[9]*=s,t[2]*=n,t[6]*=r,t[10]*=s,t[3]*=n,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),s=1-n,o=e.x,a=e.y,c=e.z,u=s*o,f=s*a;return this.set(u*o+n,u*a-r*c,u*c+r*a,0,u*a+r*c,f*a+n,f*c-r*o,0,u*c-r*a,f*c+r*o,s*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,s,o){return this.set(1,n,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,s=t._x,o=t._y,a=t._z,c=t._w,u=s+s,f=o+o,m=a+a,v=s*u,x=s*f,T=s*m,P=o*f,R=o*m,M=a*m,O=c*u,C=c*f,L=c*m,Y=n.x,J=n.y,z=n.z;return r[0]=(1-(P+M))*Y,r[1]=(x+L)*Y,r[2]=(T-C)*Y,r[3]=0,r[4]=(x-L)*J,r[5]=(1-(v+M))*J,r[6]=(R+O)*J,r[7]=0,r[8]=(T+C)*z,r[9]=(R-O)*z,r[10]=(1-(v+P))*z,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let s=j8.set(r[0],r[1],r[2]).length();const o=j8.set(r[4],r[5],r[6]).length(),a=j8.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Kh.copy(this);const u=1/s,f=1/o,m=1/a;return Kh.elements[0]*=u,Kh.elements[1]*=u,Kh.elements[2]*=u,Kh.elements[4]*=f,Kh.elements[5]*=f,Kh.elements[6]*=f,Kh.elements[8]*=m,Kh.elements[9]*=m,Kh.elements[10]*=m,t.setFromRotationMatrix(Kh),n.x=s,n.y=o,n.z=a,this}makePerspective(e,t,n,r,s,o,a=ac){const c=this.elements,u=2*s/(t-e),f=2*s/(n-r),m=(t+e)/(t-e),v=(n+r)/(n-r);let x,T;if(a===ac)x=-(o+s)/(o-s),T=-2*o*s/(o-s);else if(a===W2)x=-o/(o-s),T=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=u,c[4]=0,c[8]=m,c[12]=0,c[1]=0,c[5]=f,c[9]=v,c[13]=0,c[2]=0,c[6]=0,c[10]=x,c[14]=T,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,n,r,s,o,a=ac){const c=this.elements,u=1/(t-e),f=1/(n-r),m=1/(o-s),v=(t+e)*u,x=(n+r)*f;let T,P;if(a===ac)T=(o+s)*m,P=-2*m;else if(a===W2)T=s*m,P=-1*m;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*u,c[4]=0,c[8]=0,c[12]=-v,c[1]=0,c[5]=2*f,c[9]=0,c[13]=-x,c[2]=0,c[6]=0,c[10]=P,c[14]=-T,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const j8=new st,Kh=new bs,ftt=new st(0,0,0),ptt=new st(1,1,1),Kg=new st,vO=new st,Oc=new st;class si{constructor(e=0,t=0){si.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=di(this.x,e.x,t.x),this.y=di(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=di(this.x,e,t),this.y=di(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(di(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(di(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*r+e.x,this.y=s*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class _i{constructor(e=0,t=0,n=0,r=1){_i.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,s;const c=e.elements,u=c[0],f=c[4],m=c[8],v=c[1],x=c[5],T=c[9],P=c[2],R=c[6],M=c[10];if(Math.abs(f-v)<.01&&Math.abs(m-P)<.01&&Math.abs(T-R)<.01){if(Math.abs(f+v)<.1&&Math.abs(m+P)<.1&&Math.abs(T+R)<.1&&Math.abs(u+x+M-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const C=(u+1)/2,L=(x+1)/2,Y=(M+1)/2,J=(f+v)/4,z=(m+P)/4,ne=(T+R)/4;return C>L&&C>Y?C<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(C),r=J/n,s=z/n):L>Y?L<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(L),n=J/r,s=ne/r):Y<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(Y),n=z/s,r=ne/s),this.set(n,r,s,t),this}let O=Math.sqrt((R-T)*(R-T)+(m-P)*(m-P)+(v-f)*(v-f));return Math.abs(O)<.001&&(O=1),this.x=(R-T)/O,this.y=(m-P)/O,this.z=(v-f)/O,this.w=Math.acos((u+x+M-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=di(this.x,e.x,t.x),this.y=di(this.y,e.y,t.y),this.z=di(this.z,e.z,t.z),this.w=di(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=di(this.x,e,t),this.y=di(this.y,e,t),this.z=di(this.z,e,t),this.w=di(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(di(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}function IM(i,e=0){let t=3735928559^e,n=1103547991^e;if(i instanceof Array)for(let r=0,s;r<i.length;r++)s=i[r],t=Math.imul(t^s,2654435761),n=Math.imul(n^s,1597334677);else for(let r=0,s;r<i.length;r++)s=i.charCodeAt(r),t=Math.imul(t^s,2654435761),n=Math.imul(n^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&n)+(t>>>0)}const mtt=i=>IM(i),Bre=i=>IM(i),XL=(...i)=>IM(i);function _Re(i,e=!1){const t=[];i.isNode===!0&&(t.push(i.id),i=i.getSelf());for(const{property:n,childNode:r}of YL(i))t.push(IM(n.slice(0,-4)),r.getCacheKey(e));return IM(t)}function*YL(i,e=!1){for(const t in i){if(t.startsWith("_")===!0)continue;const n=i[t];if(Array.isArray(n)===!0)for(let r=0;r<n.length;r++){const s=n[r];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:r,childNode:s})}else if(n&&n.isNode===!0)yield{property:t,childNode:n};else if(typeof n=="object")for(const r in n){const s=n[r];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:r,childNode:s})}}}const gtt=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),_be=new WeakMap;function ytt(i){return gtt.get(i)}function KL(i){if(i==null)return null;const e=typeof i;return i.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":i.isVector2===!0?"vec2":i.isVector3===!0?"vec3":i.isVector4===!0?"vec4":i.isMatrix2===!0?"mat2":i.isMatrix3===!0?"mat3":i.isMatrix4===!0?"mat4":i.isColor===!0?"color":i instanceof ArrayBuffer?"ArrayBuffer":null}function xRe(i,...e){const t=i?i.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),i==="color"?new zi(...e):t==="vec2"?new si(...e):t==="vec3"?new st(...e):t==="vec4"?new _i(...e):t==="mat2"?new KU(...e):t==="mat3"?new _c(...e):t==="mat4"?new bs(...e):i==="bool"?e[0]||!1:i==="float"||i==="int"||i==="uint"?e[0]||0:i==="string"?e[0]||"":i==="ArrayBuffer"?_tt(e[0]):null}function bRe(i){let e=_be.get(i);return e===void 0&&(e={},_be.set(i,e)),e}function vtt(i){let e="";const t=new Uint8Array(i);for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function _tt(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0)).buffer}let xtt=0;function btt(i){const e=Object.keys(i);let t=Object.getPrototypeOf(i);for(;t;){const n=Object.getOwnPropertyDescriptors(t);for(const r in n)if(n[r]!==void 0){const s=n[r];s&&typeof s.get=="function"&&e.push(r)}t=Object.getPrototypeOf(t)}return e}let Stt=class{constructor(e,t,n,r,s,o,a,c,u,f){this.id=xtt++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=r,this.material=s,this.scene=o,this.camera=a,this.lightsNode=c,this.context=u,this.geometry=r.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=f,this.clippingContextCacheKey=f!==null?f.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],r=new Set;for(const s of e){const o=s.node&&s.node.attribute?s.node.attribute:t.getAttribute(s.name);if(o===void 0)continue;n.push(o);const a=o.isInterleavedBufferAttribute?o.data:o;r.add(a)}return this.attributes=n,this.vertexBuffers=Array.from(r.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:r,drawRange:s}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),a=this.getIndex(),c=a!==null;let u=1;if(n.isInstancedBufferGeometry===!0?u=n.instanceCount:e.count!==void 0&&(u=Math.max(0,e.count)),u===0)return null;if(o.instanceCount=u,e.isBatchedMesh===!0)return o;let f=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(f=2);let m=s.start*f,v=(s.start+s.count)*f;r!==null&&(m=Math.max(m,r.start*f),v=Math.min(v,(r.start+r.count)*f));const x=n.attributes.position;let T=1/0;c?T=a.count:x!=null&&(T=x.count),m=Math.max(m,0),v=Math.min(v,T);const P=v-m;return P<0||P===1/0?null:(o.vertexCount=P,o.firstVertex=m,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const r=e.attributes[n];t+=n+",",r.data&&(t+=r.data.stride+","),r.offset&&(t+=r.offset+","),r.itemSize&&(t+=r.itemSize+","),r.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const r=e.morphAttributes[n];t+="morph-"+n+",";for(let s=0,o=r.length;s<o;s++){const a=r[s];t+=a.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t}=this;let n=t.customProgramCacheKey();for(const r of btt(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(r))continue;const s=t[r];let o;if(s!==null){const a=typeof s;a==="number"?o=s!==0?"1":"0":a==="object"?(o="{",s.isTexture&&(o+=s.mapping),o+="}"):o=String(s)}else o=String(s);n+=o+","}return n+=this.clippingContextCacheKey+",",e.geometry&&(n+=this.getGeometryCacheKey()),e.skeleton&&(n+=e.skeleton.bones.length+","),e.isBatchedMesh&&(n+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(n+=e._colorsTexture.uuid+",")),e.count>1&&(n+=e.uuid+","),n+=e.receiveShadow+",",mtt(n)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=XL(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=XL(e,1)),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}};const wtt=Stt,iy=[];let Ttt=class{constructor(e,t,n,r,s,o){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=r,this.bindings=s,this.info=o,this.chainMaps={}}get(e,t,n,r,s,o,a,c){const u=this.getChainMap(c);iy[0]=e,iy[1]=t,iy[2]=o,iy[3]=s;let f=u.get(iy);return f===void 0?(f=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,r,s,o,a,c),u.set(iy,f)):(f.updateClipping(a),f.needsGeometryUpdate&&f.setGeometry(e.geometry),(f.version!==t.version||f.needsUpdate)&&(f.initialCacheKey!==f.getCacheKey()?(f.dispose(),f=this.get(e,t,n,r,s,o,a,c)):f.version=t.version)),iy.length=0,f}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Ed)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,r,s,o,a,c,u,f,m){const v=this.getChainMap(m),x=new wtt(e,t,n,r,s,o,a,c,u,f);return x.onDispose=()=>{this.pipelines.delete(x),this.bindings.delete(x),this.nodes.delete(x),v.delete(x.getChainArray())},x}};const Ett=Ttt;let Mtt=class{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}};const n3=Mtt,Yu={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},v2=16,Ctt=211,Att=212;let Rtt=class extends n3{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(n.version===void 0)t===Yu.VERTEX?this.backend.createAttribute(e):t===Yu.INDEX?this.backend.createIndexAttribute(e):t===Yu.STORAGE?this.backend.createStorageAttribute(e):t===Yu.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const r=this._getBufferAttribute(e);(n.version<r.version||r.usage===z6)&&(this.backend.updateAttribute(e),n.version=r.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}};const Ptt=Rtt,_1=Ntt();function Ntt(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),n=new Uint32Array(512),r=new Uint32Array(512);for(let c=0;c<256;++c){const u=c-127;u<-27?(n[c]=0,n[c|256]=32768,r[c]=24,r[c|256]=24):u<-14?(n[c]=1024>>-u-14,n[c|256]=1024>>-u-14|32768,r[c]=-u-1,r[c|256]=-u-1):u<=15?(n[c]=u+15<<10,n[c|256]=u+15<<10|32768,r[c]=13,r[c|256]=13):u<128?(n[c]=31744,n[c|256]=64512,r[c]=24,r[c|256]=24):(n[c]=31744,n[c|256]=64512,r[c]=13,r[c|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let c=1;c<1024;++c){let u=c<<13,f=0;for(;!(u&8388608);)u<<=1,f-=8388608;u&=-8388609,f+=947912704,s[c]=u|f}for(let c=1024;c<2048;++c)s[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)o[c]=c<<23;o[31]=1199570944,o[32]=2147483648;for(let c=33;c<63;++c)o[c]=2147483648+(c-32<<23);o[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(a[c]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function Bc(i){Math.abs(i)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),i=di(i,-65504,65504),_1.floatView[0]=i;const e=_1.uint32View[0],t=e>>23&511;return _1.baseTable[t]+((e&8388607)>>_1.shiftTable[t])}function _O(i){const e=i>>10;return _1.uint32View[0]=_1.mantissaTable[_1.offsetTable[e]+(i&1023)]+_1.exponentTable[e],_1.floatView[0]}const ea=new st,xO=new si;let Itt=0;class Qu{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Itt++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=qL,this.updateRanges=[],this.gpuType=Xc,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)xO.fromBufferAttribute(this,t),xO.applyMatrix3(e),this.setXY(t,xO.x,xO.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)ea.fromBufferAttribute(this,t),ea.applyMatrix3(e),this.setXYZ(t,ea.x,ea.y,ea.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)ea.fromBufferAttribute(this,t),ea.applyMatrix4(e),this.setXYZ(t,ea.x,ea.y,ea.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ea.fromBufferAttribute(this,t),ea.applyNormalMatrix(e),this.setXYZ(t,ea.x,ea.y,ea.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ea.fromBufferAttribute(this,t),ea.transformDirection(e),this.setXYZ(t,ea.x,ea.y,ea.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=P0(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Jr(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=P0(t,this.array)),t}setX(e,t){return this.normalized&&(t=Jr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=P0(t,this.array)),t}setY(e,t){return this.normalized&&(t=Jr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=P0(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Jr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=P0(t,this.array)),t}setW(e,t){return this.normalized&&(t=Jr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Jr(t,this.array),n=Jr(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Jr(t,this.array),n=Jr(n,this.array),r=Jr(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=Jr(t,this.array),n=Jr(n,this.array),r=Jr(r,this.array),s=Jr(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==qL&&(e.usage=this.usage),e}}class SRe extends Qu{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class wRe extends Qu{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class TRe extends Qu{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=_O(this.array[e*this.itemSize]);return this.normalized&&(t=P0(t,this.array)),t}setX(e,t){return this.normalized&&(t=Jr(t,this.array)),this.array[e*this.itemSize]=Bc(t),this}getY(e){let t=_O(this.array[e*this.itemSize+1]);return this.normalized&&(t=P0(t,this.array)),t}setY(e,t){return this.normalized&&(t=Jr(t,this.array)),this.array[e*this.itemSize+1]=Bc(t),this}getZ(e){let t=_O(this.array[e*this.itemSize+2]);return this.normalized&&(t=P0(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Jr(t,this.array)),this.array[e*this.itemSize+2]=Bc(t),this}getW(e){let t=_O(this.array[e*this.itemSize+3]);return this.normalized&&(t=P0(t,this.array)),t}setW(e,t){return this.normalized&&(t=Jr(t,this.array)),this.array[e*this.itemSize+3]=Bc(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Jr(t,this.array),n=Jr(n,this.array)),this.array[e+0]=Bc(t),this.array[e+1]=Bc(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Jr(t,this.array),n=Jr(n,this.array),r=Jr(r,this.array)),this.array[e+0]=Bc(t),this.array[e+1]=Bc(n),this.array[e+2]=Bc(r),this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=Jr(t,this.array),n=Jr(n,this.array),r=Jr(r,this.array),s=Jr(s,this.array)),this.array[e+0]=Bc(t),this.array[e+1]=Bc(n),this.array[e+2]=Bc(r),this.array[e+3]=Bc(s),this}}class k0 extends Qu{constructor(e,t,n){super(new Float32Array(e),t,n)}}function ERe(i){return i.index!==null?i.index.version:i.attributes.position.version}function xbe(i){const e=[],t=i.index,n=i.attributes.position;if(t!==null){const s=t.array;for(let o=0,a=s.length;o<a;o+=3){const c=s[o+0],u=s[o+1],f=s[o+2];e.push(c,u,u,f,f,c)}}else{const s=n.array;for(let o=0,a=s.length/3-1;o<a;o+=3){const c=o+0,u=o+1,f=o+2;e.push(c,u,u,f,f,c)}}const r=new(yRe(e)?wRe:SRe)(e,1);return r.version=ERe(i),r}let ktt=class extends n3{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,n=this.get(t);n.initialized=!0,this.info.memory.geometries++;const r=()=>{this.info.memory.geometries--;const s=t.index,o=e.getAttributes();s!==null&&this.attributes.delete(s);for(const c of o)this.attributes.delete(c);const a=this.wireframes.get(t);a!==void 0&&this.attributes.delete(a),t.removeEventListener("dispose",r)};t.addEventListener("dispose",r)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,Yu.STORAGE):this.updateAttribute(s,Yu.VERTEX);const n=this.getIndex(e);n!==null&&this.updateAttribute(n,Yu.INDEX);const r=e.geometry.indirect;r!==null&&this.updateAttribute(r,Yu.INDIRECT)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:n}=e;let r=t.index;if(n.wireframe===!0){const s=this.wireframes;let o=s.get(t);o===void 0?(o=xbe(t),s.set(t,o)):o.version!==ERe(t)&&(this.attributes.delete(o),o=xbe(t),s.set(t,o)),r=o}return r}};const Dtt=ktt;let Ftt=class{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):console.error("THREE.WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}};const Ott=Ftt;let Btt=class{constructor(e){this.cacheKey=e,this.usedTimes=0}};const MRe=Btt;let Ltt=class extends MRe{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}};const Utt=Ltt;let ztt=class extends MRe{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}};const Vtt=ztt;let Gtt=0,$tt=class{constructor(e,t,n,r=null,s=null){this.id=Gtt++,this.code=e,this.stage=t,this.name=n,this.transforms=r,this.attributes=s,this.usedTimes=0}};const bZ=$tt;let Htt=class extends n3{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,r=this.get(e);if(this._needsComputeUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let a=this.programs.compute.get(o.computeShader);a===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),a=new bZ(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,a),n.createProgram(a));const c=this._getComputeCacheKey(e,a);let u=this.caches.get(c);u===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),u=this._getComputePipeline(e,a,c,t)),u.usedTimes++,a.usedTimes++,r.version=e.version,r.pipeline=u}return r.pipeline}getForRender(e,t=null){const{backend:n}=this,r=this.get(e);if(this._needsRenderUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),a=e.material?e.material.name:"";let c=this.programs.vertex.get(o.vertexShader);c===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),c=new bZ(o.vertexShader,"vertex",a),this.programs.vertex.set(o.vertexShader,c),n.createProgram(c));let u=this.programs.fragment.get(o.fragmentShader);u===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),u=new bZ(o.fragmentShader,"fragment",a),this.programs.fragment.set(o.fragmentShader,u),n.createProgram(u));const f=this._getRenderCacheKey(e,c,u);let m=this.caches.get(f);m===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),m=this._getRenderPipeline(e,c,u,f,t)):e.pipeline=m,m.usedTimes++,c.usedTimes++,u.usedTimes++,r.pipeline=m}return r.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,r){n=n||this._getComputeCacheKey(e,t);let s=this.caches.get(n);return s===void 0&&(s=new Vtt(n,t),this.caches.set(n,s),this.backend.createComputePipeline(s,r)),s}_getRenderPipeline(e,t,n,r,s){r=r||this._getRenderCacheKey(e,t,n);let o=this.caches.get(r);return o===void 0&&(o=new Utt(r,t,n),this.caches.set(r,o),e.pipeline=o,this.backend.createRenderPipeline(e,s)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}};const jtt=Htt;let Wtt=class extends n3{constructor(e,t,n,r,s,o){super(),this.backend=e,this.textures=n,this.pipelines=s,this.attributes=r,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const n of t){const r=this.get(n);r.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),r.bindGroup=n)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t){const r=this.get(n);r.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),r.bindGroup=n)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isStorageBuffer){const n=t.attribute,r=n.isIndirectStorageBufferAttribute?Yu.INDIRECT:Yu.STORAGE;this.attributes.update(n,r)}}_update(e,t){const{backend:n}=this;let r=!1,s=!0,o=0,a=0;for(const c of e.bindings)if(!(c.isNodeUniformsGroup&&this.nodes.updateGroup(c)===!1)){if(c.isStorageBuffer){const u=c.attribute,f=u.isIndirectStorageBufferAttribute?Yu.INDIRECT:Yu.STORAGE;this.attributes.update(u,f)}if(c.isUniformBuffer)c.update()&&n.updateBinding(c);else if(c.isSampler)c.update();else if(c.isSampledTexture){const u=this.textures.get(c.texture);c.needsBindingsUpdate(u.generation)&&(r=!0);const f=c.update(),m=c.texture;f&&this.textures.updateTexture(m);const v=n.get(m);if(v.externalTexture!==void 0||u.isDefaultTexture?s=!1:(o=o*10+m.id,a+=m.version),n.isWebGPUBackend===!0&&v.texture===void 0&&v.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",c,f,m,c.textureNode.value,r),this.textures.updateTexture(m),r=!0),m.isStorageTexture===!0){const x=this.get(m);c.store===!0?x.needsMipmap=!0:this.textures.needsMipmaps(m)&&x.needsMipmap===!0&&(this.backend.generateMipmaps(m),x.needsMipmap=!1)}}}r===!0&&this.backend.updateBindings(e,t,s?o:0,a)}};const qtt=Wtt;function Xtt(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?i.z-e.z:i.id-e.id}function bbe(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function Sbe(i){return(i.transmission>0||i.transmissionNode)&&i.side===s_&&i.forceSinglePass===!1}let Ytt=class{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,r,s,o,a){let c=this.renderItems[this.renderItemsIndex];return c===void 0?(c={id:e.id,object:e,geometry:t,material:n,groupOrder:r,renderOrder:e.renderOrder,z:s,group:o,clippingContext:a},this.renderItems[this.renderItemsIndex]=c):(c.id=e.id,c.object=e,c.geometry=t,c.material=n,c.groupOrder=r,c.renderOrder=e.renderOrder,c.z=s,c.group=o,c.clippingContext=a),this.renderItemsIndex++,c}push(e,t,n,r,s,o,a){const c=this.getNextRenderItem(e,t,n,r,s,o,a);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0?(Sbe(n)&&this.transparentDoublePass.push(c),this.transparent.push(c)):this.opaque.push(c)}unshift(e,t,n,r,s,o,a){const c=this.getNextRenderItem(e,t,n,r,s,o,a);n.transparent===!0||n.transmission>0?(Sbe(n)&&this.transparentDoublePass.unshift(c),this.transparent.unshift(c)):this.opaque.unshift(c)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||Xtt),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||bbe),this.transparent.length>1&&this.transparent.sort(t||bbe)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const n=this.renderItems[e];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null,n.clippingContext=null}}};const Ktt=Ytt,hT=[];let Ztt=class{constructor(e){this.lighting=e,this.lists=new Ed}get(e,t){const n=this.lists;hT[0]=e,hT[1]=t;let r=n.get(hT);return r===void 0&&(r=new Ktt(this.lighting,e,t),n.set(hT,r)),hT.length=0,r}dispose(){this.lists=new Ed}};const Qtt=Ztt;let Jtt=0,ent=class{constructor(){this.id=Jtt++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new _i,this.scissor=!1,this.scissorValue=new _i,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return CRe(this)}};function CRe(i){const{textures:e,activeCubeFace:t}=i,n=[t];for(const r of e)n.push(r.id);return Bre(n)}let N4=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const r=n[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}};const wbe=new bs,Tbe=new Tx;class nh{constructor(e=0,t=0,n=0,r=nh.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],c=r[1],u=r[5],f=r[9],m=r[2],v=r[6],x=r[10];switch(t){case"XYZ":this._y=Math.asin(di(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-f,x),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(v,u),this._z=0);break;case"YXZ":this._x=Math.asin(-di(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(a,x),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-m,s),this._z=0);break;case"ZXY":this._x=Math.asin(di(v,-1,1)),Math.abs(v)<.9999999?(this._y=Math.atan2(-m,x),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-di(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(v,x),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(di(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-f,u),this._y=Math.atan2(-m,s)):(this._x=0,this._y=Math.atan2(a,x));break;case"XZY":this._z=Math.asin(-di(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(v,u),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-f,x),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return wbe.makeRotationFromQuaternion(e),this.setFromRotationMatrix(wbe,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Tbe.setFromEuler(this),this.setFromQuaternion(Tbe,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}nh.DEFAULT_ORDER="XYZ";class tnt{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let nnt=0;const Ebe=new st,W8=new Tx,l1=new bs,bO=new st,dT=new st,rnt=new st,int=new Tx,Mbe=new st(1,0,0),Cbe=new st(0,1,0),Abe=new st(0,0,1),Rbe={type:"added"},snt={type:"removed"},q8={type:"childadded",child:null},SZ={type:"childremoved",child:null};class Pa extends N4{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:nnt++}),this.uuid=N1(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Pa.DEFAULT_UP.clone();const e=new st,t=new nh,n=new Tx,r=new st(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new bs},normalMatrix:{value:new _c}}),this.matrix=new bs,this.matrixWorld=new bs,this.matrixAutoUpdate=Pa.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Pa.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new tnt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return W8.setFromAxisAngle(e,t),this.quaternion.multiply(W8),this}rotateOnWorldAxis(e,t){return W8.setFromAxisAngle(e,t),this.quaternion.premultiply(W8),this}rotateX(e){return this.rotateOnAxis(Mbe,e)}rotateY(e){return this.rotateOnAxis(Cbe,e)}rotateZ(e){return this.rotateOnAxis(Abe,e)}translateOnAxis(e,t){return Ebe.copy(e).applyQuaternion(this.quaternion),this.position.add(Ebe.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Mbe,e)}translateY(e){return this.translateOnAxis(Cbe,e)}translateZ(e){return this.translateOnAxis(Abe,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(l1.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?bO.copy(e):bO.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),dT.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?l1.lookAt(dT,bO,this.up):l1.lookAt(bO,dT,this.up),this.quaternion.setFromRotationMatrix(l1),r&&(l1.extractRotation(r.matrixWorld),W8.setFromRotationMatrix(l1),this.quaternion.premultiply(W8.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Rbe),q8.child=e,this.dispatchEvent(q8),q8.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(snt),SZ.child=e,this.dispatchEvent(SZ),SZ.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),l1.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),l1.multiply(e.parent.matrixWorld)),e.applyMatrix4(l1),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Rbe),q8.child=e,this.dispatchEvent(q8),q8.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(dT,e,rnt),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(dT,int,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(a=>({...a,boundingBox:a.boundingBox?a.boundingBox.toJSON():void 0,boundingSphere:a.boundingSphere?a.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(a=>({...a})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(r.boundingBox=this.boundingBox.toJSON()));function s(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let u=0,f=c.length;u<f;u++){const m=c[u];s(e.shapes,m)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,u=this.material.length;c<u;c++)a.push(s(e.materials,this.material[c]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];r.animations.push(s(e.animations,c))}}if(t){const a=o(e.geometries),c=o(e.materials),u=o(e.textures),f=o(e.images),m=o(e.shapes),v=o(e.skeletons),x=o(e.animations),T=o(e.nodes);a.length>0&&(n.geometries=a),c.length>0&&(n.materials=c),u.length>0&&(n.textures=u),f.length>0&&(n.images=f),m.length>0&&(n.shapes=m),v.length>0&&(n.skeletons=v),x.length>0&&(n.animations=x),T.length>0&&(n.nodes=T)}return n.object=r,n;function o(a){const c=[];for(const u in a){const f=a[u];delete f.metadata,c.push(f)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}}Pa.DEFAULT_UP=new st(0,1,0);Pa.DEFAULT_MATRIX_AUTO_UPDATE=!0;Pa.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class Lre extends Pa{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new nh,this.environmentIntensity=1,this.environmentRotation=new nh,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Ure extends Pa{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new bs,this.projectionMatrix=new bs,this.projectionMatrixInverse=new bs,this.coordinateSystem=ac}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const fT=[],ont=new Lre,ant=new Ure;let lnt=class{constructor(){this.chainMaps={}}get(e,t,n=null){fT[0]=e,fT[1]=t;let r;if(n===null)r="default";else{const a=n.texture.format;r=`${n.textures.length}:${a}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const s=this._getChainMap(r);let o=s.get(fT);return o===void 0&&(o=new ent,s.set(fT,o)),fT.length=0,n!==null&&(o.sampleCount=n.samples===0?1:n.samples),o}getForClear(e=null){return this.get(ont,ant,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Ed)}dispose(){this.chainMaps={}}};const cnt=lnt;let X8;class unt{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{X8===void 0&&(X8=ute("canvas")),X8.width=e.width,X8.height=e.height;const r=X8.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=X8}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=ute("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=O1(s[o]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(O1(t[n]/255)*255):t[n]=O1(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let hnt=0;class zre{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:hnt++}),this.uuid=N1(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(wZ(r[o].image)):s.push(wZ(r[o]))}else s=wZ(r);n.url=s}return t||(e.images[this.uuid]=n),n}}function wZ(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?unt.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let dnt=0;const TZ=new st;class Kl extends N4{constructor(e=Kl.DEFAULT_IMAGE,t=Kl.DEFAULT_MAPPING,n=E2,r=E2,s=nu,o=D1,a=Xu,c=N0,u=Kl.DEFAULT_ANISOTROPY,f=q1){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:dnt++}),this.uuid=N1(),this.name="",this.source=new zre(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=u,this.format=a,this.internalFormat=null,this.type=c,this.offset=new si(0,0),this.repeat=new si(1,1),this.center=new si(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new _c,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=f,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(TZ).x}get height(){return this.source.getSize(TZ).y}get depth(){return this.source.getSize(TZ).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`);continue}r&&n&&r.isVector2&&n.isVector2||r&&n&&r.isVector3&&n.isVector3||r&&n&&r.isMatrix3&&n.isMatrix3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Are)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case K_:e.x=e.x-Math.floor(e.x);break;case E2:e.x=e.x<0?0:1;break;case Z_:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case K_:e.y=e.y-Math.floor(e.y);break;case E2:e.y=e.y<0?0:1;break;case Z_:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Kl.DEFAULT_IMAGE=null;Kl.DEFAULT_MAPPING=Are;Kl.DEFAULT_ANISOTROPY=1;class jf extends Kl{constructor(e,t,n=Uo,r,s,o,a=Ma,c=Ma,u,f=Hf,m=1){if(f!==Hf&&f!==F1)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const v={width:e,height:t,depth:m};super(v,r,s,o,a,c,f,n,u),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new zre(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const fnt=new st;let pnt=class extends n3{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e,t=0){const n=this.get(e),r=e.samples===0?1:e.samples,s=n.depthTextureMips||(n.depthTextureMips={}),o=e.textures,a=this.getSize(o[0]),c=a.width>>t,u=a.height>>t;let f=e.depthTexture||s[t];const m=e.depthBuffer===!0||e.stencilBuffer===!0;let v=!1;f===void 0&&m&&(f=new jf,f.format=e.stencilBuffer?F1:Hf,f.type=e.stencilBuffer?B2:Uo,f.image.width=c,f.image.height=u,f.image.depth=a.depth,f.isArrayTexture=e.multiview===!0&&a.depth>1,s[t]=f),(n.width!==a.width||a.height!==n.height)&&(v=!0,f&&(f.needsUpdate=!0,f.image.width=c,f.image.height=u,f.image.depth=f.isArrayTexture?f.image.depth:1)),n.width=a.width,n.height=a.height,n.textures=o,n.depthTexture=f||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==r&&(v=!0,f&&(f.needsUpdate=!0),n.sampleCount=r);const x={sampleCount:r};if(e.isXRRenderTarget!==!0){for(let T=0;T<o.length;T++){const P=o[T];v&&(P.needsUpdate=!0),this.updateTexture(P,x)}f&&this.updateTexture(f,x)}if(n.initialized!==!0){n.initialized=!0;const T=()=>{e.removeEventListener("dispose",T);for(let P=0;P<o.length;P++)this._destroyTexture(o[P]);f&&this._destroyTexture(f),this.delete(e)};e.addEventListener("dispose",T)}}updateTexture(e,t={}){const n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;const r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(r&&n.initialized===!0&&(s.destroySampler(e),s.destroyTexture(e)),e.isFramebufferTexture){const u=this.renderer.getRenderTarget();u?e.type=u.texture.type:e.type=N0}const{width:o,height:a,depth:c}=this.getSize(e);if(t.width=o,t.height=a,t.depth=c,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,a):1,r||e.isStorageTexture===!0)s.createSampler(e),s.createTexture(e,t),n.generation=e.version;else if(n.initialized!==!0&&s.createSampler(e),e.version>0){const f=e.image;if(f===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(f.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const m=[];for(const v of e.images)m.push(v);t.images=m}else t.image=f;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(s.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t),t.needsMipmaps&&e.mipmaps.length===0&&s.generateMipmaps(e)}}else s.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;if(n.initialized!==!0){n.initialized=!0,n.generation=e.version,this.info.memory.textures++;const u=()=>{e.removeEventListener("dispose",u),this._destroyTexture(e)};e.addEventListener("dispose",u)}n.version=e.version}getSize(e,t=fnt){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let r;return e.isCompressedTexture?e.mipmaps?r=e.mipmaps.length:r=1:r=Math.floor(Math.log2(Math.max(t,n)))+1,r}needsMipmaps(e){return e.isCompressedTexture===!0||e.generateMipmaps}_destroyTexture(e){this.has(e)===!0&&(this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e),this.info.memory.textures--)}};const mnt=pnt;let gnt=class extends zi{constructor(e,t,n,r=1){super(e,t,n),this.a=r}set(e,t,n,r=1){return this.a=r,super.set(e,t,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}};const Vre=gnt,SO={VERTEX:"vertex",FRAGMENT:"fragment"},li={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},M1={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},ynt=["fragment","vertex"],Pbe=["setup","analyze","generate"],Nbe=[...ynt,"compute"],Ex=["x","y","z","w"],vnt={analyze:"setup",generate:"analyze"};let _nt=0,jr=class extends N4{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=li.NONE,this.updateBeforeType=li.NONE,this.updateAfterType=li.NONE,this.uuid=Ret.generateUUID(),this.version=0,this.global=!1,this.parents=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:_nt++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,li.FRAME)}onRenderUpdate(e){return this.onUpdate(e,li.RENDER)}onObjectUpdate(e){return this.onUpdate(e,li.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of YL(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=XL(_Re(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const r of this.getChildren())t["node"+n++]=r;return t.outputNode||null}analyze(e,t=null){const n=e.increaseUsage(this);if(this.parents===!0){const r=e.getDataFromNode(this,"any");r.stages=r.stages||{},r.stages[e.shaderStage]=r.stages[e.shaderStage]||[],r.stages[e.shaderStage].push(t)}if(n===1){const r=e.getNodeProperties(this);for(const s of Object.values(r))s&&s.isNode===!0&&s.build(e,this)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const n=this.getShared(e);if(this!==n)return n.build(e,t);const r=e.getDataFromNode(this);r.buildStages=r.buildStages||{},r.buildStages[e.buildStage]=!0;const s=vnt[e.buildStage];if(s&&r.buildStages[s]!==!0){const c=e.getBuildStage();e.setBuildStage(s),this.build(e),e.setBuildStage(c)}e.addNode(this),e.addChain(this);let o=null;const a=e.getBuildStage();if(a==="setup"){this.updateReference(e);const c=e.getNodeProperties(this);if(c.initialized!==!0){c.initialized=!0,c.outputNode=this.setup(e)||c.outputNode||null;for(const u of Object.values(c))if(u&&u.isNode===!0){if(u.parents===!0){const f=e.getNodeProperties(u);f.parents=f.parents||[],f.parents.push(this)}u.build(e)}}o=c.outputNode}else if(a==="analyze")this.analyze(e,t);else if(a==="generate")if(this.generate.length===1){const u=this.getNodeType(e),f=e.getDataFromNode(this);o=f.snippet,o===void 0?f.generated===void 0?(f.generated=!0,o=this.generate(e)||"",f.snippet=o):(console.warn("THREE.Node: Recursion detected.",this),o=""):f.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,u,t)}else o=this.generate(e,t)||"";return e.removeChain(this),e.addSequentialNode(this),o}getSerializeChildren(){return YL(this)}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:r,index:s,childNode:o}of t)s!==void 0?(n[r]===void 0&&(n[r]=Number.isInteger(s)?[]:{}),n[r][s]=o.toJSON(e.meta).uuid):n[r]=o.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const r=[];for(const s of e.inputNodes[n])r.push(t[s]);this[n]=r}else if(typeof e.inputNodes[n]=="object"){const r={};for(const s in e.inputNodes[n]){const o=e.inputNodes[n][s];r[s]=t[o]}this[n]=r}else{const r=e.inputNodes[n];this[n]=t[r]}}}toJSON(e){const{uuid:t,type:n}=this,r=e===void 0||typeof e=="string";r&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:n,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},r!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function o(a){const c=[];for(const u in a){const f=a[u];delete f.metadata,c.push(f)}return c}if(r){const a=o(e.textures),c=o(e.images),u=o(e.nodes);a.length>0&&(s.textures=a),c.length>0&&(s.images=c),u.length>0&&(s.nodes=u)}return s}},ua=class extends jr{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const r=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,r,t);if(r!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,r),a=e.getVarFromNode(this,null,r),c=e.getPropertyName(a);return e.addLineFlowCode(`${c} = ${o}`,this),s.snippet=o,s.propertyName=c,e.format(s.propertyName,r,t)}}return super.build(e,t)}},uC=class extends jr{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),n=this.node.build(e),r=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${n}[ ${r} ]`}},ARe=class extends jr{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const r of this.convertTo.split("|"))(n===null||e.getTypeLength(t)===e.getTypeLength(r))&&(n=r);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,r=this.getNodeType(e),s=n.build(e,r);return e.format(s,r,t)}},xnt=class extends ua{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),r=e.getTypeLength(n),s=this.nodes,o=e.getComponentType(n),a=[];let c=0;for(const f of s){if(c>=r){console.error(`THREE.TSL: Length of parameters exceeds maximum length of function '${n}()' type.`);break}let m=f.getNodeType(e),v=e.getTypeLength(m),x;c+v>r&&(console.error(`THREE.TSL: Length of '${n}()' data exceeds maximum length of output type.`),v=r-c,m=e.getTypeFromLength(v)),c+=v,x=f.build(e,m);const T=e.getComponentType(m);T!==o&&(x=e.format(x,T,o)),a.push(x)}const u=`${e.getType(n)}( ${a.join(", ")} )`;return e.format(u,n,t)}};const bnt=Ex.join("");let Ibe=class extends jr{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Ex.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const n=this.node,r=e.getTypeLength(n.getNodeType(e));let s=null;if(r>1){let o=null;this.getVectorLength()>=r&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=n.build(e,o);this.components.length===r&&this.components===bnt.slice(0,this.components.length)?s=e.format(c,o,t):s=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else s=n.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}},Snt=class extends ua{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:r}=this,s=this.getNodeType(e),o=e.getComponentType(r.getNodeType(e)),a=e.getTypeFromLength(n.length,o),c=r.build(e,a),u=t.build(e,s),f=e.getTypeLength(s),m=[];for(let v=0;v<f;v++){const x=Ex[v];x===n[0]?(m.push(c),v+=n.length-1):m.push(u+"."+x)}return`${e.getType(s)}( ${m.join(", ")} )`}},wnt=class extends ua{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,r=this.getNodeType(e),s=n.build(e),o=e.getVarFromNode(this),a=e.getPropertyName(o);e.addLineFlowCode(a+" = "+s,this);const c=e.getTypeLength(r),u=[];let f=0;for(let m=0;m<c;m++){const v=Ex[m];v===t[f]?(u.push("1.0 - "+(a+"."+v)),f++):u.push(a+"."+v)}return`${e.getType(r)}( ${u.join(", ")} )`}},Gre=class extends jr{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?KL(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=KL(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=vtt(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?xRe(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}};const kbe=/float|u?int/;let rm=class extends Gre{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return kbe.test(n)&&kbe.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}},Tnt=class extends jr{static get type(){return"MemberNode"}constructor(e,t){super(),this.node=e,this.property=t,this.isMemberNode=!0}getNodeType(e){return this.node.getMemberType(e,this.property)}generate(e){return this.node.build(e)+"."+this.property}},Q_=null;const V6=new Map;function At(i,e){if(V6.has(i)){console.warn(`THREE.TSL: Redefinition of method chaining '${i}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${i} is not a function`);V6.set(i,e)}const RRe=i=>i.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),Dbe=i=>RRe(i).split("").sort().join(""),PRe={setup(i,e){const t=e.shift();return i(JU(t),...e)},get(i,e,t){if(typeof e=="string"&&i[e]===void 0){if(i.isStackNode!==!0&&e==="assign")return(...n)=>(Q_.assign(t,...n),t);if(V6.has(e)){const n=V6.get(e);return i.isStackNode?(...r)=>t.add(n(...r)):(...r)=>n(t,...r)}else{if(e==="self")return i;if(e.endsWith("Assign")&&V6.has(e.slice(0,e.length-6))){const n=V6.get(e.slice(0,e.length-6));return i.isStackNode?(...r)=>t.assign(r[0],n(...r)):(...r)=>t.assign(n(t,...r))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=RRe(e),en(new Ibe(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=Dbe(e.slice(3).toLowerCase()),n=>en(new Snt(i,e,en(n)));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=Dbe(e.slice(4).toLowerCase()),()=>en(new wnt(en(i),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),en(new Ibe(i,e));if(/^\d+$/.test(e)===!0)return en(new uC(t,new rm(Number(e),"uint")));if(/^get$/.test(e)===!0)return n=>en(new Tnt(t,n))}}}return Reflect.get(i,e,t)},set(i,e,t,n){return typeof e=="string"&&i[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(n[e].assign(t),!0):Reflect.set(i,e,t,n)}},EZ=new WeakMap,Fbe=new WeakMap,Ent=function(i,e=null){const t=KL(i);if(t==="node"){let n=EZ.get(i);return n===void 0&&(n=new Proxy(i,PRe),EZ.set(i,n),EZ.set(n,n)),n}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return en(hte(i,e));if(t==="shader")return Yt(i)}return i},Mnt=function(i,e=null){for(const t in i)i[t]=en(i[t],e);return i},Cnt=function(i,e=null){const t=i.length;for(let n=0;n<t;n++)i[n]=en(i[n],e);return i},Ant=function(i,e=null,t=null,n=null){const r=f=>en(n!==null?Object.assign(f,n):f);let s,o=e,a,c;function u(f){let m;return o?m=/[a-z]/i.test(o)?o+"()":o:m=i.type,a!==void 0&&f.length<a?(console.error(`THREE.TSL: "${m}" parameter length is less than minimum required.`),f.concat(new Array(a-f.length).fill(0))):c!==void 0&&f.length>c?(console.error(`THREE.TSL: "${m}" parameter length exceeds limit.`),f.slice(0,c)):f}return e===null?s=(...f)=>r(new i(...c_(u(f)))):t!==null?(t=en(t),s=(...f)=>r(new i(e,...c_(u(f)),t))):s=(...f)=>r(new i(e,...c_(u(f)))),s.setParameterLength=(...f)=>(f.length===1?a=c=f[0]:f.length===2&&([a,c]=f),s),s.setName=f=>(o=f,s),s},Rnt=function(i,...e){return en(new i(...c_(e)))};let Pnt=class extends jr{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,inputNodes:n}=this,r=e.getNodeProperties(t),s=t.namespace&&t.namespace===e.namespace?e.getNamespace("once"):"once";if(r[s])return r[s];let o=null;if(t.layout){let a=Fbe.get(e.constructor);a===void 0&&(a=new WeakMap,Fbe.set(e.constructor,a));let c=a.get(t);c===void 0&&(c=en(e.buildFunctionNode(t)),a.set(t,c)),e.addInclude(c),o=en(c.call(n))}else{const a=t.jsFunc,c=n!==null||a.length>1?a(n||[],e):a(e);o=en(c)}return t.once&&(r[s]=o),o}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),n=e.getOutputNamespace();return t[n]=t[n]||this.setupOutput(e),t[n]}build(e,t=null){let n=null;const r=e.getBuildStage(),s=e.getNodeProperties(this),o=e.getOutputNamespace(),a=this.getOutputNode(e);if(r==="setup"){const c=e.getNamespace("initialized");s[c]!==!0&&(s[c]=!0,s[o]=this.getOutputNode(e),s[o].build(e)),n=s[o]}else r==="analyze"?a.build(e,t):r==="generate"&&(n=a.build(e,t)||"");return n}},Nnt=class extends jr{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1,this.namespace=null}setLayout(e){return this.layout=e,this}call(e=null){return JU(e),en(new Pnt(this,e))}setup(){return this.call()}};const Int=[!1,!0],knt=[0,1,2,3],Dnt=[-1,-2],NRe=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],$re=new Map;for(const i of Int)$re.set(i,new rm(i));const Hre=new Map;for(const i of knt)Hre.set(i,new rm(i,"uint"));const jre=new Map([...Hre].map(i=>new rm(i.value,"int")));for(const i of Dnt)jre.set(i,new rm(i,"int"));const ZU=new Map([...jre].map(i=>new rm(i.value)));for(const i of NRe)ZU.set(i,new rm(i));for(const i of NRe)ZU.set(-i,new rm(-i));const QU={bool:$re,uint:Hre,ints:jre,float:ZU},Obe=new Map([...$re,...ZU]),hte=(i,e)=>Obe.has(i)?Obe.get(i):i.isNode===!0?i:new rm(i,e),Fnt=i=>{try{return i.getNodeType()}catch{return}},ha=function(i,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(i)&&t.every(r=>typeof r!="object"))&&(t=[xRe(i,...t)]),t.length===1&&e!==null&&e.has(t[0]))return en(e.get(t[0]));if(t.length===1){const r=hte(t[0],i);return Fnt(r)===i?en(r):en(new ARe(r,i))}const n=t.map(r=>hte(r));return en(new xnt(n,i))}},Bbe=i=>typeof i=="object"&&i!==null?i.value:i,Ont=i=>i!=null?i.nodeType||i.convertTo||(typeof i=="string"?i:null):null;function sE(i,e){return new Proxy(new Nnt(i,e),PRe)}const en=(i,e=null)=>Ent(i,e),JU=(i,e=null)=>new Mnt(i,e),c_=(i,e=null)=>new Cnt(i,e),Zt=(...i)=>new Ant(...i),xn=(...i)=>new Rnt(...i);let Bnt=0;const Yt=(i,e=null)=>{let t=null;e!==null&&(typeof e=="object"?t=e.return:(typeof e=="string"?t=e:console.error("THREE.TSL: Invalid layout type."),e=null));const n=new sE(i,t),r=(...s)=>{let o;JU(s),s[0]&&(s[0].isNode||Object.getPrototypeOf(s[0])!==Object.prototype)?o=[...s]:o=s[0];const c=n.call(o);return t==="void"&&c.toStack(),c};if(r.shaderNode=n,r.id=n.id,r.getNodeType=(...s)=>n.getNodeType(...s),r.getCacheKey=(...s)=>n.getCacheKey(...s),r.setLayout=s=>(n.setLayout(s),r),r.once=(s=null)=>(n.once=!0,n.namespace=s,r),e!==null){if(typeof e.inputs!="object"){const s={name:"fn"+Bnt++,type:t,inputs:[]};for(const o in e)o!=="return"&&s.inputs.push({name:o,type:e[o]});e=s}r.setLayout(e)}return r},ZL=i=>{Q_=i},IRe=()=>Q_,Vo=(...i)=>Q_.If(...i);function kRe(i){return Q_&&Q_.add(i),i}At("toStack",kRe);const Lnt=new ha("color"),Nt=new ha("float",QU.float),Ps=new ha("int",QU.ints),Unt=new ha("uint",QU.uint),Wre=new ha("bool",QU.bool),wn=new ha("vec2"),g1=new ha("ivec2"),znt=new ha("uvec2"),Vnt=new ha("bvec2"),Bt=new ha("vec3"),Gnt=new ha("ivec3"),$nt=new ha("uvec3"),Hnt=new ha("bvec3"),Gr=new ha("vec4"),jnt=new ha("ivec4"),Wnt=new ha("uvec4"),qnt=new ha("bvec4"),qre=new ha("mat2"),F0=new ha("mat3"),u_=new ha("mat4");At("toColor",Lnt);At("toFloat",Nt);At("toInt",Ps);At("toUint",Unt);At("toBool",Wre);At("toVec2",wn);At("toIVec2",g1);At("toUVec2",znt);At("toBVec2",Vnt);At("toVec3",Bt);At("toIVec3",Gnt);At("toUVec3",$nt);At("toBVec3",Hnt);At("toVec4",Gr);At("toIVec4",jnt);At("toUVec4",Wnt);At("toBVec4",qnt);At("toMat2",qre);At("toMat3",F0);At("toMat4",u_);const Xnt=Zt(uC).setParameterLength(2),Ynt=(i,e)=>en(new ARe(en(i),e));At("element",Xnt);At("convert",Ynt);At("append",i=>(console.warn("THREE.TSL: .append() has been renamed to .toStack()."),kRe(i)));let Knt=class extends ua{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return Ex.join("").slice(0,n)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:n}=this,r=e.getNodeProperties(this);r.sourceNode=n,r.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:n,sourceNode:r}=e.getNodeProperties(this),s=this.needsSplitAssign(e),o=n.getNodeType(e),a=n.build(e),c=r.build(e,o),u=r.getNodeType(e),f=e.getDataFromNode(this);let m;if(f.initialized===!0)t!=="void"&&(m=a);else if(s){const v=e.getVarFromNode(this,null,o),x=e.getPropertyName(v);e.addLineFlowCode(`${x} = ${c}`,this);const T=n.node,R=T.node.context({assign:!0}).build(e);for(let M=0;M<T.components.length;M++){const O=T.components[M];e.addLineFlowCode(`${R}.${O} = ${x}[ ${M} ]`,this)}t!=="void"&&(m=a)}else m=`${a} = ${c}`,(t==="void"||u==="void")&&(e.addLineFlowCode(m,this),t!=="void"&&(m=a));return f.initialized=!0,e.format(m,o,t)}};const Znt=Zt(Knt).setParameterLength(2);At("assign",Znt);let Lbe=class extends ua{static get type(){return"ArrayNode"}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}};const Qnt=(...i)=>{let e;if(i.length===1){const t=i[0];e=new Lbe(null,t.length,t)}else{const t=i[0],n=i[1];e=new Lbe(t,n)}return en(e)};At("toArray",(i,e)=>Qnt(Array(e).fill(i)));let DRe=class extends jr{static get type(){return"UniformGroupNode"}constructor(e,t=!1,n=1){super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}};const Jnt=i=>new DRe(i),Xre=(i,e=0)=>new DRe(i,!0,e),ert=Xre("frame"),Tr=Xre("render"),FRe=Jnt("object");let hC=class extends Gre{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=FRe}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const n=this.getSelf();return e=e.bind(n),super.onUpdate(r=>{const s=e(r,n);s!==void 0&&(this.value=s)},t)}generate(e,t){const n=this.getNodeType(e),r=this.getUniformHash(e);let s=e.getNodeFromHash(r);s===void 0&&(e.setHashNode(this,r),s=this);const o=s.getInputType(e),a=e.getUniformFromNode(s,o,e.shaderStage,this.name||e.context.label),c=e.getPropertyName(a);return e.context.label!==void 0&&delete e.context.label,e.format(c,n,t)}};const Mr=(i,e)=>{const t=Ont(e||i),n=i&&i.isNode===!0?i.node&&i.node.value||i.value:i;return en(new hC(n,t))};let ts=class extends jr{static get type(){return"PropertyNode"}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0,this.global=!0}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}};const ORe=(i,e)=>en(new ts(i,e)),QL=(i,e)=>en(new ts(i,e,!0)),Bi=xn(ts,"vec4","DiffuseColor"),Ube=xn(ts,"vec3","EmissiveColor"),x1=xn(ts,"float","Roughness"),JL=xn(ts,"float","Metalness"),dte=xn(ts,"float","Clearcoat"),eU=xn(ts,"float","ClearcoatRoughness"),G6=xn(ts,"vec3","Sheen"),Yre=xn(ts,"float","SheenRoughness"),Kre=xn(ts,"float","Iridescence"),BRe=xn(ts,"float","IridescenceIOR"),LRe=xn(ts,"float","IridescenceThickness"),fte=xn(ts,"float","AlphaT"),Cy=xn(ts,"float","Anisotropy"),HB=xn(ts,"vec3","AnisotropyT"),h_=xn(ts,"vec3","AnisotropyB"),Gc=xn(ts,"color","SpecularColor"),tU=xn(ts,"float","SpecularF90"),pte=xn(ts,"float","Shininess"),BE=xn(ts,"vec4","Output"),MZ=xn(ts,"float","dashSize"),zbe=xn(ts,"float","gapSize"),jB=xn(ts,"float","IOR"),mte=xn(ts,"float","Transmission"),URe=xn(ts,"float","Thickness"),zRe=xn(ts,"float","AttenuationDistance"),VRe=xn(ts,"color","AttenuationColor"),GRe=xn(ts,"float","Dispersion");let trt=class extends ua{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],n=this.functionNode,r=n.getInputs(e),s=this.parameters,o=(c,u)=>{const f=u.type,m=f==="pointer";let v;return m?v="&"+c.build(e):v=c.build(e,f),v};if(Array.isArray(s)){if(s.length>r.length)console.error("THREE.TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),s.length=r.length;else if(s.length<r.length)for(console.error("THREE.TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");s.length<r.length;)s.push(Nt(0));for(let c=0;c<s.length;c++)t.push(o(s[c],r[c]))}else for(const c of r){const u=s[c.name];u!==void 0?t.push(o(u,c)):(console.error(`THREE.TSL: Input '${c.name}' not found in 'Fn()'.`),t.push(o(Nt(0),c)))}return`${n.build(e,"property")}( ${t.join(", ")} )`}};const nrt=(i,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?c_(e):JU(e[0]),en(new trt(en(i),e)));At("call",nrt);const rrt={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};let $o=class gte extends ua{static get type(){return"OperatorNode"}constructor(e,t,n,...r){if(super(),r.length>0){let s=new gte(e,t,n);for(let o=0;o<r.length-1;o++)s=new gte(e,s,r[o]);t=s,n=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(rrt[this.op],t)}getNodeType(e){const t=this.op,n=this.aNode,r=this.bNode,s=n.getNodeType(e),o=r?r.getNodeType(e):null;if(s==="void"||o==="void")return"void";if(t==="%")return s;if(t==="~"||t==="&"||t==="|"||t==="^"||t===">>"||t==="<<")return e.getIntegerType(s);if(t==="!"||t==="&&"||t==="||"||t==="^^")return"bool";if(t==="=="||t==="!="||t==="<"||t===">"||t==="<="||t===">="){const a=Math.max(e.getTypeLength(s),e.getTypeLength(o));return a>1?`bvec${a}`:"bool"}else{if(e.isMatrix(s)){if(o==="float")return s;if(e.isVector(o))return e.getVectorFromMatrix(s);if(e.isMatrix(o))return s}else if(e.isMatrix(o)){if(s==="float")return o;if(e.isVector(s))return e.getVectorFromMatrix(o)}return e.getTypeLength(o)>e.getTypeLength(s)?o:s}}generate(e,t){const n=this.op,{aNode:r,bNode:s}=this,o=this.getNodeType(e);let a=null,c=null;o!=="void"?(a=r.getNodeType(e),c=s?s.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="||n==="!="?e.isVector(a)?c=a:e.isVector(c)?a=c:a!==c&&(a=c="float"):n===">>"||n==="<<"?(a=o,c=e.changeComponentType(c,"uint")):n==="%"?(a=o,c=e.isInteger(a)&&e.isInteger(c)?c:a):e.isMatrix(a)?c==="float"?c="float":e.isVector(c)?c=e.getVectorFromMatrix(a):e.isMatrix(c)||(a=c=o):e.isMatrix(c)?a==="float"?a="float":e.isVector(a)?a=e.getVectorFromMatrix(c):a=c=o:a=c=o):a=c=o;const u=r.build(e,a),f=s?s.build(e,c):null,m=e.getFunctionOperator(n);if(t!=="void"){const v=e.renderer.coordinateSystem===ac;if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">=")return v?e.isVector(a)?e.format(`${this.getOperatorMethod(e,t)}( ${u}, ${f} )`,o,t):e.format(`( ${u} ${n} ${f} )`,o,t):e.format(`( ${u} ${n} ${f} )`,o,t);if(n==="%")return e.isInteger(c)?e.format(`( ${u} % ${f} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${u}, ${f} )`,o,t);if(n==="!"||n==="~")return e.format(`(${n}${u})`,a,t);if(m)return e.format(`${m}( ${u}, ${f} )`,o,t);if(e.isMatrix(a)&&c==="float")return e.format(`( ${f} ${n} ${u} )`,o,t);if(a==="float"&&e.isMatrix(c))return e.format(`${u} ${n} ${f}`,o,t);{let x=`( ${u} ${n} ${f} )`;return!v&&o==="bool"&&e.isVector(a)&&e.isVector(c)&&(x=`all${x}`),e.format(x,o,t)}}else if(a!=="void")return m?e.format(`${m}( ${u}, ${f} )`,o,t):e.isMatrix(a)&&c==="float"?e.format(`${f} ${n} ${u}`,o,t):e.format(`${u} ${n} ${f}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}};const O0=Zt($o,"+").setParameterLength(2,1/0).setName("add"),C0=Zt($o,"-").setParameterLength(2,1/0).setName("sub"),fi=Zt($o,"*").setParameterLength(2,1/0).setName("mul"),Xf=Zt($o,"/").setParameterLength(2,1/0).setName("div"),ez=Zt($o,"%").setParameterLength(2).setName("mod"),$Re=Zt($o,"==").setParameterLength(2).setName("equal"),irt=Zt($o,"!=").setParameterLength(2).setName("notEqual"),srt=Zt($o,"<").setParameterLength(2).setName("lessThan"),ort=Zt($o,">").setParameterLength(2).setName("greaterThan"),art=Zt($o,"<=").setParameterLength(2).setName("lessThanEqual"),lrt=Zt($o,">=").setParameterLength(2).setName("greaterThanEqual"),crt=Zt($o,"&&").setParameterLength(2,1/0).setName("and"),urt=Zt($o,"||").setParameterLength(2,1/0).setName("or"),hrt=Zt($o,"!").setParameterLength(1).setName("not"),drt=Zt($o,"^^").setParameterLength(2).setName("xor"),frt=Zt($o,"&").setParameterLength(2).setName("bitAnd"),prt=Zt($o,"~").setParameterLength(2).setName("bitNot"),mrt=Zt($o,"|").setParameterLength(2).setName("bitOr"),grt=Zt($o,"^").setParameterLength(2).setName("bitXor"),yrt=Zt($o,"<<").setParameterLength(2).setName("shiftLeft"),vrt=Zt($o,">>").setParameterLength(2).setName("shiftRight"),_rt=Yt(([i])=>(i.addAssign(1),i)),xrt=Yt(([i])=>(i.subAssign(1),i)),brt=Yt(([i])=>{const e=Ps(i).toConst();return i.addAssign(1),e}),Srt=Yt(([i])=>{const e=Ps(i).toConst();return i.subAssign(1),e});At("add",O0);At("sub",C0);At("mul",fi);At("div",Xf);At("mod",ez);At("equal",$Re);At("notEqual",irt);At("lessThan",srt);At("greaterThan",ort);At("lessThanEqual",art);At("greaterThanEqual",lrt);At("and",crt);At("or",urt);At("not",hrt);At("xor",drt);At("bitAnd",frt);At("bitNot",prt);At("bitOr",mrt);At("bitXor",grt);At("shiftLeft",yrt);At("shiftRight",vrt);At("incrementBefore",_rt);At("decrementBefore",xrt);At("increment",brt);At("decrement",Srt);const wrt=(i,e)=>(console.warn('THREE.TSL: "remainder()" is deprecated. Use "mod( int( ... ) )" instead.'),ez(i,e)),Trt=(i,e)=>(console.warn('THREE.TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),ez(Ps(i),Ps(e)));At("remainder",wrt);At("modInt",Trt);let xt=class Cs extends ua{static get type(){return"MathNode"}constructor(e,t,n=null,r=null){if(super(),(e===Cs.MAX||e===Cs.MIN)&&arguments.length>3){let s=new Cs(e,t,n);for(let o=2;o<arguments.length-1;o++)s=new Cs(e,s,arguments[o]);t=s,n=arguments[arguments.length-1],r=null}this.method=e,this.aNode=t,this.bNode=n,this.cNode=r,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(n)?0:e.getTypeLength(n),a=e.isMatrix(r)?0:e.getTypeLength(r);return s>o&&s>a?t:o>a?n:a>s?r:t}getNodeType(e){const t=this.method;return t===Cs.LENGTH||t===Cs.DISTANCE||t===Cs.DOT?"float":t===Cs.CROSS?"vec3":t===Cs.ALL||t===Cs.ANY?"bool":t===Cs.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:n,method:r}=this;let s=null;if(r===Cs.ONE_MINUS)s=C0(1,t);else if(r===Cs.RECIPROCAL)s=Xf(1,t);else if(r===Cs.DIFFERENCE)s=$u(C0(t,n));else if(r===Cs.TRANSFORM_DIRECTION){let o=t,a=n;e.isMatrix(o.getNodeType(e))?a=Gr(Bt(a),0):o=Gr(Bt(o),0);const c=fi(o,a).xyz;s=DM(c)}return s!==null?s:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let r=this.method;const s=this.getNodeType(e),o=this.getInputType(e),a=this.aNode,c=this.bNode,u=this.cNode,f=e.renderer.coordinateSystem;if(r===Cs.NEGATE)return e.format("( - "+a.build(e,o)+" )",s,t);{const m=[];return r===Cs.CROSS?m.push(a.build(e,s),c.build(e,s)):f===ac&&r===Cs.STEP?m.push(a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":o),c.build(e,o)):f===ac&&(r===Cs.MIN||r===Cs.MAX)?m.push(a.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):r===Cs.REFRACT?m.push(a.build(e,o),c.build(e,o),u.build(e,"float")):r===Cs.MIX?m.push(a.build(e,o),c.build(e,o),u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":o)):(f===W2&&r===Cs.ATAN&&c!==null&&(r="atan2"),e.shaderStage!=="fragment"&&(r===Cs.DFDX||r===Cs.DFDY)&&(console.warn(`THREE.TSL: '${r}' is not supported in the ${e.shaderStage} stage.`),r="/*"+r+"*/"),m.push(a.build(e,o)),c!==null&&m.push(c.build(e,o)),u!==null&&m.push(u.build(e,o))),e.format(`${e.getMethod(r,s)}( ${m.join(", ")} )`,s,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}};xt.ALL="all";xt.ANY="any";xt.RADIANS="radians";xt.DEGREES="degrees";xt.EXP="exp";xt.EXP2="exp2";xt.LOG="log";xt.LOG2="log2";xt.SQRT="sqrt";xt.INVERSE_SQRT="inversesqrt";xt.FLOOR="floor";xt.CEIL="ceil";xt.NORMALIZE="normalize";xt.FRACT="fract";xt.SIN="sin";xt.COS="cos";xt.TAN="tan";xt.ASIN="asin";xt.ACOS="acos";xt.ATAN="atan";xt.ABS="abs";xt.SIGN="sign";xt.LENGTH="length";xt.NEGATE="negate";xt.ONE_MINUS="oneMinus";xt.DFDX="dFdx";xt.DFDY="dFdy";xt.ROUND="round";xt.RECIPROCAL="reciprocal";xt.TRUNC="trunc";xt.FWIDTH="fwidth";xt.TRANSPOSE="transpose";xt.BITCAST="bitcast";xt.EQUALS="equals";xt.MIN="min";xt.MAX="max";xt.STEP="step";xt.REFLECT="reflect";xt.DISTANCE="distance";xt.DIFFERENCE="difference";xt.DOT="dot";xt.CROSS="cross";xt.POW="pow";xt.TRANSFORM_DIRECTION="transformDirection";xt.MIX="mix";xt.CLAMP="clamp";xt.REFRACT="refract";xt.SMOOTHSTEP="smoothstep";xt.FACEFORWARD="faceforward";const Ert=Nt(1e-6),Mrt=Nt(Math.PI),Crt=Zt(xt,xt.ALL).setParameterLength(1),Art=Zt(xt,xt.ANY).setParameterLength(1),Rrt=Zt(xt,xt.RADIANS).setParameterLength(1),Prt=Zt(xt,xt.DEGREES).setParameterLength(1),HRe=Zt(xt,xt.EXP).setParameterLength(1),kM=Zt(xt,xt.EXP2).setParameterLength(1),jRe=Zt(xt,xt.LOG).setParameterLength(1),B1=Zt(xt,xt.LOG2).setParameterLength(1),Zre=Zt(xt,xt.SQRT).setParameterLength(1),Nrt=Zt(xt,xt.INVERSE_SQRT).setParameterLength(1),i4=Zt(xt,xt.FLOOR).setParameterLength(1),Qre=Zt(xt,xt.CEIL).setParameterLength(1),DM=Zt(xt,xt.NORMALIZE).setParameterLength(1),r3=Zt(xt,xt.FRACT).setParameterLength(1),fd=Zt(xt,xt.SIN).setParameterLength(1),f2=Zt(xt,xt.COS).setParameterLength(1),Irt=Zt(xt,xt.TAN).setParameterLength(1),krt=Zt(xt,xt.ASIN).setParameterLength(1),WRe=Zt(xt,xt.ACOS).setParameterLength(1),qRe=Zt(xt,xt.ATAN).setParameterLength(1,2),$u=Zt(xt,xt.ABS).setParameterLength(1),nU=Zt(xt,xt.SIGN).setParameterLength(1),L1=Zt(xt,xt.LENGTH).setParameterLength(1),Drt=Zt(xt,xt.NEGATE).setParameterLength(1),Frt=Zt(xt,xt.ONE_MINUS).setParameterLength(1),XRe=Zt(xt,xt.DFDX).setParameterLength(1),YRe=Zt(xt,xt.DFDY).setParameterLength(1),Ort=Zt(xt,xt.ROUND).setParameterLength(1),Brt=Zt(xt,xt.RECIPROCAL).setParameterLength(1),Lrt=Zt(xt,xt.TRUNC).setParameterLength(1),Urt=Zt(xt,xt.FWIDTH).setParameterLength(1),zrt=Zt(xt,xt.TRANSPOSE).setParameterLength(1),Vrt=(i,e)=>(console.warn('THREE.TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),$Re(i,e)),J_=Zt(xt,xt.MIN).setParameterLength(2,1/0),Ql=Zt(xt,xt.MAX).setParameterLength(2,1/0),KRe=Zt(xt,xt.STEP).setParameterLength(2),Grt=Zt(xt,xt.REFLECT).setParameterLength(2),$rt=Zt(xt,xt.DISTANCE).setParameterLength(2),Hrt=Zt(xt,xt.DIFFERENCE).setParameterLength(2),Jre=Zt(xt,xt.DOT).setParameterLength(2),ZRe=Zt(xt,xt.CROSS).setParameterLength(2),tz=Zt(xt,xt.POW).setParameterLength(2),QRe=Zt(xt,xt.POW,2).setParameterLength(1),jrt=Zt(xt,xt.POW,3).setParameterLength(1),Wrt=Zt(xt,xt.POW,4).setParameterLength(1),qrt=Zt(xt,xt.TRANSFORM_DIRECTION).setParameterLength(2),Xrt=i=>fi(nU(i),tz($u(i),1/3)),JRe=i=>Jre(i,i),Us=Zt(xt,xt.MIX).setParameterLength(3),Y1=(i,e=0,t=1)=>en(new xt(xt.CLAMP,en(i),en(e),en(t))),ePe=i=>Y1(i),tPe=Zt(xt,xt.REFRACT).setParameterLength(3),q2=Zt(xt,xt.SMOOTHSTEP).setParameterLength(3),Yrt=Zt(xt,xt.FACEFORWARD).setParameterLength(3),Krt=Yt(([i])=>{const n=43758.5453,r=Jre(i.xy,wn(12.9898,78.233)),s=ez(r,Mrt);return r3(fd(s).mul(n))}),Zrt=(i,e,t)=>Us(e,t,i),Qrt=(i,e,t)=>q2(e,t,i),Jrt=(i,e)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),qRe(i,e));At("all",Crt);At("any",Art);At("equals",Vrt);At("radians",Rrt);At("degrees",Prt);At("exp",HRe);At("exp2",kM);At("log",jRe);At("log2",B1);At("sqrt",Zre);At("inverseSqrt",Nrt);At("floor",i4);At("ceil",Qre);At("normalize",DM);At("fract",r3);At("sin",fd);At("cos",f2);At("tan",Irt);At("asin",krt);At("acos",WRe);At("atan",qRe);At("abs",$u);At("sign",nU);At("length",L1);At("lengthSq",JRe);At("negate",Drt);At("oneMinus",Frt);At("dFdx",XRe);At("dFdy",YRe);At("round",Ort);At("reciprocal",Brt);At("trunc",Lrt);At("fwidth",Urt);At("atan2",Jrt);At("min",J_);At("max",Ql);At("step",KRe);At("reflect",Grt);At("distance",$rt);At("dot",Jre);At("cross",ZRe);At("pow",tz);At("pow2",QRe);At("pow3",jrt);At("pow4",Wrt);At("transformDirection",qrt);At("mix",Zrt);At("clamp",Y1);At("refract",tPe);At("smoothstep",Qrt);At("faceForward",Yrt);At("difference",Hrt);At("saturate",ePe);At("cbrt",Xrt);At("transpose",zrt);At("rand",Krt);let eit=class extends jr{static get type(){return"ConditionalNode"}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(t===void 0)return this.setup(e),this.getNodeType(e);const r=t.getNodeType(e);if(n!==null){const s=n.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(r))return s}return r}setup(e){const t=this.condNode.cache(),n=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,s=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=s,r!==null&&(e.getDataFromNode(r).parentNodeBlock=s);const o=e.getNodeProperties(this);o.condNode=t,o.ifNode=n.context({nodeBlock:n}),o.elseNode=r?r.context({nodeBlock:r}):null}generate(e,t){const n=this.getNodeType(e),r=e.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;const{condNode:s,ifNode:o,elseNode:a}=e.getNodeProperties(this),c=e.currentFunctionNode,u=t!=="void",f=u?ORe(n).build(e):"";r.nodeProperty=f;const m=s.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${m} ) {

`).addFlowTab();let v=o.build(e,n);if(v&&(u?v=f+" = "+v+";":(v="return "+v+";",c===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),v="// "+v))),e.removeFlowTab().addFlowCode(e.tab+"	"+v+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let x=a.build(e,n);x&&(u?x=f+" = "+x+";":(x="return "+x+";",c===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),x="// "+x))),e.removeFlowTab().addFlowCode(e.tab+"	"+x+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(f,n,t)}};const Wl=Zt(eit).setParameterLength(2,3);At("select",Wl);const tit=(...i)=>(console.warn("THREE.TSL: cond() has been renamed to select()."),Wl(...i));At("cond",tit);let nPe=class extends jr{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}generate(e,t){const n=e.getContext();e.setContext({...e.context,...this.value});const r=this.node.build(e,t);return e.setContext(n),r}};const eie=Zt(nPe).setParameterLength(1,2),nit=(i,e)=>eie(i,{label:e});At("context",eie);At("label",nit);let WB=class extends jr{static get type(){return"VarNode"}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n,this.parents=!0}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:n,readOnly:r}=this,{renderer:s}=e,o=s.backend.isWebGPUBackend===!0;let a=!1,c=!1;r&&(a=e.isDeterministic(t),c=o?r:a);const u=e.getVectorType(this.getNodeType(e)),f=t.build(e,u),m=e.getVarFromNode(this,n,u,void 0,c),v=e.getPropertyName(m);let x=v;if(c)if(o)x=a?`const ${v}`:`let ${v}`;else{const T=e.getArrayCount(t);x=`const ${e.getVar(m.type,v,T)}`}return e.addLineFlowCode(`${x} = ${f}`,this),v}};const tie=Zt(WB),rit=(i,e=null)=>tie(i,e).toStack(),iit=(i,e=null)=>tie(i,e,!0).toStack();At("toVar",rit);At("toConst",iit);const sit=i=>(console.warn('TSL: "temp( node )" is deprecated. Use "Var( node )" or "node.toVar()" instead.'),tie(i));At("temp",sit);let oit=class extends jr{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(n===void 0){const r=this.name,s=this.getNodeType(e),o=this.interpolationType,a=this.interpolationSampling;t.varying=n=e.getVaryingFromNode(this,r,s,o,a),t.node=this.node}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(SO.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(SO.VERTEX,this.node)}generate(e){const t=e.getNodeProperties(this),n=this.setupVarying(e);if(t.propertyName===void 0){const r=this.getNodeType(e),s=e.getPropertyName(n,SO.VERTEX);e.flowNodeFromShaderStage(SO.VERTEX,this.node,r,s),t.propertyName=s}return e.getPropertyName(n)}};const Ad=Zt(oit).setParameterLength(1,2),ait=i=>Ad(i);At("toVarying",Ad);At("toVertexStage",ait);At("varying",(...i)=>(console.warn("THREE.TSL: .varying() has been renamed to .toVarying()."),Ad(...i)));At("vertexStage",(...i)=>(console.warn("THREE.TSL: .vertexStage() has been renamed to .toVertexStage()."),Ad(...i)));const lit=Yt(([i])=>{const e=i.mul(.9478672986).add(.0521327014).pow(2.4),t=i.mul(.0773993808),n=i.lessThanEqual(.04045);return Us(e,t,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),cit=Yt(([i])=>{const e=i.pow(.41666).mul(1.055).sub(.055),t=i.mul(12.92),n=i.lessThanEqual(.0031308);return Us(e,t,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),nie="WorkingColorSpace",uit="OutputColorSpace";let rPe=class extends ua{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===nie?Rs.workingColorSpace:t===uit?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let s=t;return Rs.enabled===!1||n===r||!n||!r||(Rs.getTransfer(n)===Fr&&(s=Gr(lit(s.rgb),s.a)),Rs.getPrimaries(n)!==Rs.getPrimaries(r)&&(s=Gr(F0(Rs._getMatrix(new _c,n,r)).mul(s.rgb),s.a)),Rs.getTransfer(r)===Fr&&(s=Gr(cit(s.rgb),s.a))),s}};const hit=(i,e)=>en(new rPe(en(i),nie,e)),rie=(i,e)=>en(new rPe(en(i),e,nie));At("workingToColorSpace",hit);At("colorSpaceToWorking",rie);let dit=class extends uC{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}},iPe=class extends jr{static get type(){return"ReferenceBaseNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=li.OBJECT}setGroup(e){return this.group=e,this}element(e){return en(new dit(this,en(e)))}setNodeType(e){const t=Mr(null,e).getSelf();this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}};const fit=(i,e,t)=>en(new iPe(i,e,t));let pit=class extends iPe{static get type(){return"RendererReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(Tr)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}};const mit=(i,e,t=null)=>en(new pit(i,e,t));let git=class extends ua{static get type(){return"ToneMappingNode"}constructor(e,t=vit,n=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return XL(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,n=this.toneMapping;if(n===o_)return t;let r=null;const s=e.renderer.library.getToneMappingFunction(n);return s!==null?r=Gr(s(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),r=t),r}};const yit=(i,e,t)=>en(new git(i,en(e),en(t))),vit=mit("toneMappingExposure","float");At("toneMapping",(i,e,t)=>yit(e,t,i));const _0=new st;class iie{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)_0.fromBufferAttribute(this,t),_0.applyMatrix4(e),this.setXYZ(t,_0.x,_0.y,_0.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)_0.fromBufferAttribute(this,t),_0.applyNormalMatrix(e),this.setXYZ(t,_0.x,_0.y,_0.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)_0.fromBufferAttribute(this,t),_0.transformDirection(e),this.setXYZ(t,_0.x,_0.y,_0.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=P0(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Jr(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Jr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Jr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Jr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Jr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=P0(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=P0(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=P0(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=P0(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Jr(t,this.array),n=Jr(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Jr(t,this.array),n=Jr(n,this.array),r=Jr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Jr(t,this.array),n=Jr(n,this.array),r=Jr(r,this.array),s=Jr(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new Qu(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new iie(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class sPe{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=qL,this.updateRanges=[],this.version=0,this.uuid=N1()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=N1()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=N1()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}let _it=class extends Gre{static get type(){return"BufferAttributeNode"}constructor(e,t=null,n=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=r,this.usage=qL,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),n=this.value,r=e.getTypeLength(t),s=this.bufferStride||r,o=this.bufferOffset,a=n.isInterleavedBuffer===!0?n:new sPe(n,s),c=new iie(a,r,o);a.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(n);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=r,s=r):s=Ad(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}};const sie=(i,e=null,t=0,n=0)=>en(new _it(i,e,t,n)),xit=(i,e=null,t=0,n=0)=>sie(i,e,t,n).setUsage(z6),Vbe=(i,e=null,t=0,n=0)=>sie(i,e,t,n).setInstanced(!0),Gbe=(i,e=null,t=0,n=0)=>xit(i,e,t,n).setInstanced(!0);At("toAttribute",i=>sie(i.value));let bit=class extends jr{static get type(){return"ComputeNode"}constructor(e,t,n=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=li.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let n=t[0];for(let r=1;r<t.length;r++)n*=t[r];this.dispatchCount=Math.ceil(e/n)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const n=e.getNodeProperties(this);n.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:n}=e;if(n==="compute"){const r=this.computeNode.build(e,"void");r!==""&&e.addLineFlowCode(r,this)}else{const s=e.getNodeProperties(this).outputComputeNode;if(s)return s.build(e,t)}}};const Sit=(i,e,t)=>en(new bit(en(i),e,t));At("compute",Sit);let wit=class extends jr{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){const n=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const s=this.node.build(e,...t);return e.setCache(n),s}};const qB=(i,e)=>en(new wit(en(i),e)),Tit=(i,e)=>i.context({namespace:e});At("cache",qB);let Eit=class extends jr{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}};const Mit=Zt(Eit).setParameterLength(2);At("bypass",Mit);let oPe=class extends jr{static get type(){return"RemapNode"}constructor(e,t,n,r=Nt(0),s=Nt(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=r,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:r,outHighNode:s,doClamp:o}=this;let a=e.sub(t).div(n.sub(t));return o===!0&&(a=a.clamp()),a.mul(s.sub(r)).add(r)}};const Cit=Zt(oPe,null,null,{doClamp:!1}).setParameterLength(3,5),Ait=Zt(oPe).setParameterLength(3,5);At("remap",Cit);At("remapClamp",Ait);let XB=class extends jr{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const n=this.getNodeType(e),r=this.snippet;if(n==="void")e.addLineFlowCode(r,this);else return e.format(r,n,t)}};const ex=Zt(XB).setParameterLength(1,2),Rit=i=>(i?Wl(i,ex("discard")):ex("discard")).toStack();At("discard",Rit);let Pit=class extends ua{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setup({context:e}){let t=this.colorNode||e.color;const n=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||o_,r=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||q1;return n!==o_&&(t=t.toneMapping(n)),r!==q1&&r!==Rs.workingColorSpace&&(t=t.workingToColorSpace(r)),t}};const Nit=(i,e=null,t=null)=>en(new Pit(en(i),e,t));At("renderOutput",Nit);let Iit=class extends ua{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,n=this.node.build(e),r="--- TSL debug - "+e.shaderStage+" shader ---",s="-".repeat(r.length);let o="";return o+="// #"+r+`#
`,o+=e.flow.code.replace(/^\t/mg,"")+`
`,o+="/* ... */ "+n+` /* ... */
`,o+="// #"+s+`#
`,t!==null?t(e,o):console.log(o),n}};const kit=(i,e=null)=>en(new Iit(en(i),e));At("debug",kit);let aPe=class extends jr{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const r=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(s),a=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(a.name,o,n):Ad(this).build(e,n)}else return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}};const X2=(i,e=null)=>en(new aPe(i,e));let Za=class Ay extends jr{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let r;if(n===Ay.VERTEX)r=e.getVertexIndex();else if(n===Ay.INSTANCE)r=e.getInstanceIndex();else if(n===Ay.DRAW)r=e.getDrawIndex();else if(n===Ay.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(n===Ay.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else if(n===Ay.SUBGROUP)r=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=r:s=Ad(this).build(e,t),s}};Za.VERTEX="vertex";Za.INSTANCE="instance";Za.SUBGROUP="subgroup";Za.INVOCATION_LOCAL="invocationLocal";Za.INVOCATION_SUBGROUP="invocationSubgroup";Za.DRAW="draw";const Dit=xn(Za,Za.VERTEX),oie=xn(Za,Za.INSTANCE);Za.SUBGROUP;Za.INVOCATION_SUBGROUP;Za.INVOCATION_LOCAL;const Fit=xn(Za,Za.DRAW);let Oit=class extends ts{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}},Bit=class extends jr{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.outputNode?this.outputNode.getMemberType(e,t):"void"}add(e){return this.nodes.push(e),this}If(e,t){const n=new sE(t);return this._currentCond=Wl(e,n),this.add(this._currentCond)}ElseIf(e,t){const n=new sE(t),r=Wl(e,n);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new sE(e),this}Switch(e){return this._expressionNode=en(e),this}Case(...e){const t=[];if(e.length>=2)for(let a=0;a<e.length-1;a++)t.push(this._expressionNode.equal(en(e[a])));else throw new Error("TSL: Invalid parameter length. Case() requires at least two parameters.");const n=e[e.length-1],r=new sE(n);let s=t[0];for(let a=1;a<t.length;a++)s=s.or(t[a]);const o=Wl(s,r);return this._currentCond===null?(this._currentCond=o,this.add(this._currentCond)):(this._currentCond.elseNode=o,this._currentCond=o,this)}Default(e){return this.Else(e),this}build(e,...t){const n=IRe();ZL(this);const r=e.buildStage;for(const s of this.nodes)if(r==="setup")s.build(e);else if(r==="analyze")s.build(e,this);else if(r==="generate"){const o=e.getDataFromNode(s,"any").stages,a=o&&o[e.shaderStage];if(s.isVarNode&&a&&a.length===1&&a[0]&&a[0].isStackNode)continue;s.build(e,"void")}return ZL(n),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}else(...e){return console.warn("THREE.TSL: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("THREE.TSL: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}};const CZ=Zt(Bit).setParameterLength(0,1);let Lit=class extends jr{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode("i".charCodeAt(0)+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const n={};for(let o=0,a=this.params.length-1;o<a;o++){const c=this.params[o],u=c.isNode!==!0&&c.name||this.getVarName(o),f=c.isNode!==!0&&c.type||"int";n[u]=ex(u,f)}const r=e.addStack();t.returnsNode=this.params[this.params.length-1](n,e),t.stackNode=r;const s=this.params[0];return s.isNode!==!0&&typeof s.update=="function"&&(t.updateNode=Yt(this.params[0].update)(n)),e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),n=this.params,r=t.stackNode;for(let a=0,c=n.length-1;a<c;a++){const u=n[a];let f=!1,m=null,v=null,x=null,T=null,P=null,R=null;u.isNode?u.getNodeType(e)==="bool"?(f=!0,T="bool",v=u.build(e,T)):(T="int",x=this.getVarName(a),m="0",v=u.build(e,T),P="<"):(T=u.type||"int",x=u.name||this.getVarName(a),m=u.start,v=u.end,P=u.condition,R=u.update,typeof m=="number"?m=e.generateConst(T,m):m&&m.isNode&&(m=m.build(e,T)),typeof v=="number"?v=e.generateConst(T,v):v&&v.isNode&&(v=v.build(e,T)),m!==void 0&&v===void 0?(m=m+" - 1",v="0",P=">="):v!==void 0&&m===void 0&&(m="0",P="<"),P===void 0&&(Number(m)>Number(v)?P=">=":P="<"));let M;if(f)M=`while ( ${v} )`;else{const O={start:m,end:v,condition:P},C=O.start,L=O.end;let Y;const J=()=>P.includes("<")?"+=":"-=";if(R!=null)switch(typeof R){case"function":Y=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":Y=x+" "+J()+" "+e.generateConst(T,R);break;case"string":Y=x+" "+R;break;default:R.isNode?Y=x+" "+J()+" "+R.build(e):(console.error("THREE.TSL: 'Loop( { update: ... } )' is not a function, string or number."),Y="break /* invalid update */")}else T==="int"||T==="uint"?R=P.includes("<")?"++":"--":R=J()+" 1.",Y=x+" "+R;const z=e.getVar(T,x)+" = "+C,ne=x+" "+P+" "+L;M=`for ( ${z}; ${ne}; ${Y} )`}e.addFlowCode((a===0?`
`:"")+e.tab+M+` {

`).addFlowTab()}const s=r.build(e,"void"),o=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let a=0,c=this.params.length-1;a<c;a++)e.addFlowCode((a===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),o}};const gd=(...i)=>en(new Lit(c_(i,"int"))).toStack(),Uit=()=>ex("break").toStack();class dC{constructor(e=new st(1/0,1/0,1/0),t=new st(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Zh.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Zh.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Zh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Zh):Zh.fromBufferAttribute(s,o),Zh.applyMatrix4(e.matrixWorld),this.expandByPoint(Zh);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),wO.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),wO.copy(n.boundingBox)),wO.applyMatrix4(e.matrixWorld),this.union(wO)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Zh),Zh.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(pT),TO.subVectors(this.max,pT),Y8.subVectors(e.a,pT),K8.subVectors(e.b,pT),Z8.subVectors(e.c,pT),Zg.subVectors(K8,Y8),Qg.subVectors(Z8,K8),sy.subVectors(Y8,Z8);let t=[0,-Zg.z,Zg.y,0,-Qg.z,Qg.y,0,-sy.z,sy.y,Zg.z,0,-Zg.x,Qg.z,0,-Qg.x,sy.z,0,-sy.x,-Zg.y,Zg.x,0,-Qg.y,Qg.x,0,-sy.y,sy.x,0];return!AZ(t,Y8,K8,Z8,TO)||(t=[1,0,0,0,1,0,0,0,1],!AZ(t,Y8,K8,Z8,TO))?!1:(EO.crossVectors(Zg,Qg),t=[EO.x,EO.y,EO.z],AZ(t,Y8,K8,Z8,TO))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Zh).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Zh).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(c1[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),c1[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),c1[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),c1[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),c1[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),c1[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),c1[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),c1[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(c1),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const c1=[new st,new st,new st,new st,new st,new st,new st,new st],Zh=new st,wO=new dC,Y8=new st,K8=new st,Z8=new st,Zg=new st,Qg=new st,sy=new st,pT=new st,TO=new st,EO=new st,oy=new st;function AZ(i,e,t,n,r){for(let s=0,o=i.length-3;s<=o;s+=3){oy.fromArray(i,s);const a=r.x*Math.abs(oy.x)+r.y*Math.abs(oy.y)+r.z*Math.abs(oy.z),c=e.dot(oy),u=t.dot(oy),f=n.dot(oy);if(Math.max(-Math.max(c,u,f),Math.min(c,u,f))>a)return!1}return!0}const zit=new dC,mT=new st,RZ=new st;class nz{constructor(e=new st,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):zit.setFromPoints(e).getCenter(n);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;mT.subVectors(e,this.center);const t=mT.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.addScaledVector(mT,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(RZ.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(mT.copy(e.center).add(RZ)),this.expandByPoint(mT.copy(e.center).sub(RZ))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const $be=new nz;let K1=class ba extends jr{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=li.OBJECT,this.uniformNode=new hC(null)}getNodeType(){const e=this.scope;if(e===ba.WORLD_MATRIX)return"mat4";if(e===ba.POSITION||e===ba.VIEW_POSITION||e===ba.DIRECTION||e===ba.SCALE)return"vec3";if(e===ba.RADIUS)return"float"}update(e){const t=this.object3d,n=this.uniformNode,r=this.scope;if(r===ba.WORLD_MATRIX)n.value=t.matrixWorld;else if(r===ba.POSITION)n.value=n.value||new st,n.value.setFromMatrixPosition(t.matrixWorld);else if(r===ba.SCALE)n.value=n.value||new st,n.value.setFromMatrixScale(t.matrixWorld);else if(r===ba.DIRECTION)n.value=n.value||new st,t.getWorldDirection(n.value);else if(r===ba.VIEW_POSITION){const s=e.camera;n.value=n.value||new st,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(s.matrixWorldInverse)}else if(r===ba.RADIUS){const s=e.object.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),$be.copy(s.boundingSphere).applyMatrix4(t.matrixWorld),n.value=$be.radius}}generate(e){const t=this.scope;return t===ba.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===ba.POSITION||t===ba.VIEW_POSITION||t===ba.DIRECTION||t===ba.SCALE?this.uniformNode.nodeType="vec3":t===ba.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}};K1.WORLD_MATRIX="worldMatrix";K1.POSITION="position";K1.SCALE="scale";K1.VIEW_POSITION="viewPosition";K1.DIRECTION="direction";K1.RADIUS="radius";const Vit=Zt(K1,K1.POSITION).setParameterLength(1);let lPe=class extends hC{static get type(){return"BufferNode"}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}};const cPe=(i,e,t)=>en(new lPe(i,e,t));let Git=class extends uC{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,n)}},$it=class extends lPe{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?KL(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=li.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let r=0;r<e.length;r++){const s=r*4;t[s]=e[r]}else if(n==="color")for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.r,t[s+1]=o.g,t[s+2]=o.b||0}else if(n==="mat2")for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+3]=o.elements[3]}else if(n==="mat3")for(let r=0;r<e.length;r++){const s=r*16,o=e[r];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+4]=o.elements[3],t[s+5]=o.elements[4],t[s+6]=o.elements[5],t[s+8]=o.elements[6],t[s+9]=o.elements[7],t[s+10]=o.elements[8],t[s+15]=1}else if(n==="mat4")for(let r=0;r<e.length;r++){const s=r*16,o=e[r];for(let a=0;a<o.elements.length;a++)t[s+a]=o.elements[a]}else for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.x,t[s+1]=o.y,t[s+2]=o.z||0,t[s+3]=o.w||0}}setup(e){const t=this.array.length,n=this.elementType;let r=Float32Array;const s=this.paddedType,o=e.getTypeLength(s);return n.charAt(0)==="i"&&(r=Int32Array),n.charAt(0)==="u"&&(r=Uint32Array),this.value=new r(t*o),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return en(new Git(this,en(e)))}};const Uf=(i,e)=>en(new $it(i,e));let Hit=class extends jr{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}};const rz=Zt(Hit).setParameterLength(1),uPe=Mr(0,"uint").label("u_cameraIndex").setGroup(Xre("cameraIndex")).toVarying("v_cameraIndex"),Fy=Mr("float").label("cameraNear").setGroup(Tr).onRenderUpdate(({camera:i})=>i.near),Oy=Mr("float").label("cameraFar").setGroup(Tr).onRenderUpdate(({camera:i})=>i.far),aie=Yt(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const r of i.cameras)t.push(r.projectionMatrix);e=Uf(t).setGroup(Tr).label("cameraProjectionMatrices").element(i.isMultiViewCamera?rz("gl_ViewID_OVR"):uPe).toVar("cameraProjectionMatrix")}else e=Mr("mat4").label("cameraProjectionMatrix").setGroup(Tr).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),im=Yt(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const r of i.cameras)t.push(r.matrixWorldInverse);e=Uf(t).setGroup(Tr).label("cameraViewMatrices").element(i.isMultiViewCamera?rz("gl_ViewID_OVR"):uPe).toVar("cameraViewMatrix")}else e=Mr("mat4").label("cameraViewMatrix").setGroup(Tr).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),jit=Mr(new st).label("cameraPosition").setGroup(Tr).onRenderUpdate(({camera:i},e)=>e.value.setFromMatrixPosition(i.matrixWorld));let rh=class extends K1{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}};rh.DIRECTION;const E4=xn(rh,rh.WORLD_MATRIX);rh.POSITION;rh.SCALE;rh.VIEW_POSITION;rh.RADIUS;const Wit=Mr(new _c).onObjectUpdate(({object:i},e)=>e.value.getNormalMatrix(i.matrixWorld)),iz=Yt(i=>i.renderer.overrideNodes.modelViewMatrix||qit).once()().toVar("modelViewMatrix"),qit=im.mul(E4),Hbe=Yt(i=>(i.context.isHighPrecisionModelViewMatrix=!0,Mr("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),jbe=Yt(i=>{const e=i.context.isHighPrecisionModelViewMatrix;return Mr("mat3").onObjectUpdate(({object:t,camera:n})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),sz=X2("position","vec3"),$l=sz.toVarying("positionLocal"),Wbe=sz.toVarying("positionPrevious"),FM=Yt(i=>E4.mul($l).xyz.toVarying(i.getNamespace("v_positionWorld")),"vec3").once("POSITION")(),hPe=Yt(i=>$l.transformDirection(E4).toVarying(i.getNamespace("v_positionWorldDirection")).normalize().toVar("positionWorldDirection"),"vec3").once("POSITION")(),oa=Yt(i=>i.context.setupPositionView().toVarying(i.getNamespace("v_positionView")),"vec3").once("POSITION")(),ho=oa.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");let Xit=class extends ua{static get type(){return"EquirectUVNode"}constructor(e=hPe){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan(e.x).mul(1/(Math.PI*2)).add(.5),n=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return wn(t,n)}};const dPe=Zt(Xit).setParameterLength(0,1);let Yit=class extends jr{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:n}=e;return t.coordinateSystem===ac&&n.side===gc?"false":e.getFrontFacing()}};const Kit=xn(Yit),oz=Nt(Kit).mul(2).sub(1),fPe=X2("normal","vec3"),Yf=Yt(i=>i.geometry.hasAttribute("normal")===!1?(console.warn('THREE.TSL: Vertex attribute "normal" not found on geometry.'),Bt(0,1,0)):fPe,"vec3").once()().toVar("normalLocal"),Zit=oa.dFdx().cross(oa.dFdy()).normalize().toVar("normalFlat"),Kf=Yt(i=>{let e;return i.material.flatShading===!0?e=Zit:e=Ad(pPe(Yf),"v_normalView").normalize(),e},"vec3").once()().toVar("normalView"),lie=Yt(i=>{let e=Kf.transformDirection(im);return i.material.flatShading!==!0&&(e=Ad(e,"v_normalWorld")),e},"vec3").once()().normalize().toVar("normalWorld"),ra=Yt(i=>{let e=i.context.setupNormal().context({getUV:null});return i.material.flatShading!==!0&&(e=e.mul(oz)),e},"vec3").once()().toVar("transformedNormalView"),cie=ra.transformDirection(im).toVar("transformedNormalWorld"),oE=Yt(i=>{let e=i.context.setupClearcoatNormal().context({getUV:null});return i.material.flatShading!==!0&&(e=e.mul(oz)),e},"vec3").once()().toVar("transformedClearcoatNormalView"),Qit=Yt(([i,e=E4])=>{const t=F0(e),n=i.div(Bt(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(n).xyz}),pPe=Yt(([i],e)=>{const t=e.renderer.overrideNodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(i);const n=Wit.mul(i);return im.transformDirection(n)});let Jit=class extends ua{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=Bt(ho.z,0,ho.x.negate()).normalize(),t=ho.cross(e);return wn(e.dot(ra),t.dot(ra)).mul(.495).add(.5)}};const est=xn(Jit);let tst=class extends hC{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=li.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&n.width!==void 0){const{width:r,height:s}=n;this.value=Math.log2(Math.max(r,s))}}};const nst=Zt(tst).setParameterLength(1),rst=i=>en(i).mul(.5).add(.5);let ist=class extends ua{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),o=t.sin();return qre(s,o,o.negate(),s).mul(n)}else{const s=t,o=u_(Gr(1,0,0,0),Gr(0,f2(s.x),fd(s.x).negate(),0),Gr(0,fd(s.x),f2(s.x),0),Gr(0,0,0,1)),a=u_(Gr(f2(s.y),0,fd(s.y),0),Gr(0,1,0,0),Gr(fd(s.y).negate(),0,f2(s.y),0),Gr(0,0,0,1)),c=u_(Gr(f2(s.z),fd(s.z).negate(),0,0),Gr(fd(s.z),f2(s.z),0,0),Gr(0,0,1,0),Gr(0,0,0,1));return o.mul(a).mul(c).mul(Gr(n,1)).xyz}}};const mPe=Zt(ist).setParameterLength(2);let gT,yT,ih=class l2 extends jr{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===l2.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=li.NONE;return(this.scope===l2.SIZE||this.scope===l2.VIEWPORT)&&(e=li.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===l2.VIEWPORT?t!==null?yT.copy(t.viewport):(e.getViewport(yT),yT.multiplyScalar(e.getPixelRatio())):t!==null?(gT.width=t.width,gT.height=t.height):e.getDrawingBufferSize(gT)}setup(){const e=this.scope;let t=null;return e===l2.SIZE?t=Mr(gT||(gT=new si)):e===l2.VIEWPORT?t=Mr(yT||(yT=new _i)):t=wn(az.div(yte)),t}generate(e){if(this.scope===l2.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(yte).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}};ih.COORDINATE="coordinate";ih.VIEWPORT="viewport";ih.SIZE="size";ih.UV="uv";const d_=xn(ih,ih.UV),yte=xn(ih,ih.SIZE),az=xn(ih,ih.COORDINATE),LE=xn(ih,ih.VIEWPORT);LE.zw;LE.xy;const fC=(i=0)=>X2("uv"+(i>0?i:""),"vec2");let sst=class extends jr{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),r=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${r} )`,this.getNodeType(e),t)}};const f_=Zt(sst).setParameterLength(1,2),gPe=new Kl;let Mx=class extends hC{static get type(){return"TextureNode"}constructor(e=gPe,t=null,n=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=li.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Uo?"uvec4":this.value.type===M0?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return fC(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Mr(this.value.matrix)),this._matrixUniform.mul(Bt(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?li.OBJECT:li.NONE,this}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.image instanceof ImageBitmap&&n.flipY===!0||n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0||n.isDepthTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(Ps(f_(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let r=this.uvNode;(r===null||e.context.forceUVContext===!0)&&e.context.getUV&&(r=e.context.getUV(this,e)),r||(r=this.getDefaultUV()),this.updateMatrix===!0&&(r=this.getTransformedUV(r)),r=this.setupUV(e,r);let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=r,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,n,r,s,o,a,c){const u=this.value;let f;return r?f=e.generateTextureLevel(u,t,n,r,o):s?f=e.generateTextureBias(u,t,n,s,o):c?f=e.generateTextureGrad(u,t,n,c,o):a?f=e.generateTextureCompare(u,t,n,a,o):this.sampler===!1?f=e.generateTextureLoad(u,t,n,o):f=e.generateTexture(u,t,n,o),f}generate(e,t){const n=this.value,r=e.getNodeProperties(this),s=super.generate(e,"property");if(/^sampler/.test(t))return s+"_sampler";if(e.isReference(t))return s;{const o=e.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:f,levelNode:m,biasNode:v,compareNode:x,depthNode:T,gradNode:P}=r,R=this.generateUV(e,f),M=m?m.build(e,"float"):null,O=v?v.build(e,"float"):null,C=T?T.build(e,"int"):null,L=x?x.build(e,"float"):null,Y=P?[P[0].build(e,"vec2"),P[1].build(e,"vec2")]:null,J=e.getVarFromNode(this);a=e.getPropertyName(J);const z=this.generateSnippet(e,s,R,M,O,C,L,Y);e.addLineFlowCode(`${a} = ${z}`,this),o.snippet=z,o.propertyName=a}let c=a;const u=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(c=rie(ex(c,u),n.colorSpace).setup(e).build(e,u)),e.format(c,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=en(e),t.referenceNode=this.getSelf(),en(t)}blur(e){const t=this.clone();t.biasNode=en(e).mul(nst(t)),t.referenceNode=this.getSelf();const n=t.value;return t.generateMipmaps===!1&&(n&&n.generateMipmaps===!1||n.minFilter===Ma||n.magFilter===Ma)&&(console.warn("THREE.TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),en(t)}level(e){const t=this.clone();return t.levelNode=en(e),t.referenceNode=this.getSelf(),en(t)}size(e){return f_(this,e)}bias(e){const t=this.clone();return t.biasNode=en(e),t.referenceNode=this.getSelf(),en(t)}compare(e){const t=this.clone();return t.compareNode=en(e),t.referenceNode=this.getSelf(),en(t)}grad(e,t){const n=this.clone();return n.gradNode=[en(e),en(t)],n.referenceNode=this.getSelf(),en(n)}depth(e){const t=this.clone();return t.depthNode=en(e),t.referenceNode=this.getSelf(),en(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e}};const ost=Zt(Mx).setParameterLength(1,4).setName("texture"),Ri=(i=gPe,e=null,t=null,n=null)=>{let r;return i&&i.isTextureNode===!0?(r=en(i.clone()),r.referenceNode=i.getSelf(),e!==null&&(r.uvNode=en(e)),t!==null&&(r.levelNode=en(t)),n!==null&&(r.biasNode=en(n))):r=ost(i,e,t,n),r},rd=(...i)=>Ri(...i).setSampler(!1);class ast extends Kl{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Ma,this.minFilter=Ma,this.generateMipmaps=!1,this.needsUpdate=!0}}const vT=new si;let yPe=class extends Mx{static get type(){return"ViewportTextureNode"}constructor(e=d_,t=null,n=null){n===null&&(n=new ast,n.minFilter=D1),super(n,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=li.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(vT);const n=this.value;(n.image.width!==vT.width||n.image.height!==vT.height)&&(n.image.width=vT.width,n.image.height=vT.height,n.needsUpdate=!0);const r=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(n),n.generateMipmaps=r}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}};const vPe=Zt(yPe,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let PZ=null,lst=class extends yPe{static get type(){return"ViewportDepthTextureNode"}constructor(e=d_,t=null){PZ===null&&(PZ=new jf),super(e,t,PZ)}};const cst=Zt(lst).setParameterLength(0,2);let Z1=class aE extends jr{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===aE.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,n=this.valueNode;let r=null;if(t===aE.DEPTH_BASE)n!==null&&(r=bPe().assign(n));else if(t===aE.DEPTH)e.isPerspectiveCamera?r=ust(oa.z,Fy,Oy):r=UE(oa.z,Fy,Oy);else if(t===aE.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const s=_Pe(n,Fy,Oy);r=UE(s,Fy,Oy)}else r=n;else r=UE(oa.z,Fy,Oy);return r}};Z1.DEPTH_BASE="depthBase";Z1.DEPTH="depth";Z1.LINEAR_DEPTH="linearDepth";const UE=(i,e,t)=>i.add(e).div(e.sub(t)),ust=(i,e,t)=>e.add(i).mul(t).div(t.sub(e).mul(i)),_Pe=(i,e,t)=>e.mul(t).div(t.sub(e).mul(i).sub(t)),xPe=(i,e,t)=>{e=e.max(1e-6).toVar();const n=B1(i.negate().div(e)),r=B1(t.div(e));return n.div(r)},bPe=Zt(Z1,Z1.DEPTH_BASE),SPe=xn(Z1,Z1.DEPTH),hst=Zt(Z1,Z1.LINEAR_DEPTH).setParameterLength(0,1);cst();SPe.assign=i=>bPe(i);const NZ=new st,dst=new st,fst=new _c;class p2{constructor(e=new st(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=NZ.subVectors(n,t).cross(dst.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(NZ),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||fst.getNormalMatrix(e),r=this.coplanarPoint(NZ).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}class I4 extends N4{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:nu,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new _i(0,0,e,t),this.scissorTest=!1,this.viewport=new _i(0,0,e,t);const r={width:e,height:t,depth:n.depth},s=new Kl(r);this.textures=[];const o=n.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:nu,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n,this.textures[r].isArrayTexture=this.textures[r].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const r=Object.assign({},e.textures[t].image);this.textures[t].source=new zre(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}new p2;new st;new st;new st;new bs;new st(0,0,-1);new _i;new st;new st;new _i;new si;const pst=new I4;d_.flipX();pst.depthTexture=new jf(1,1);let mst=0;class vc extends N4{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:mst++}),this.uuid=N1(),this.name="",this.type="Material",this.blending=k1,this.side=I1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=GL,this.blendDst=$L,this.blendEquation=md,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new zi(0,0,0),this.blendAlpha=0,this.depthFunc=HL,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=cte,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=My,this.stencilZFail=My,this.stencilZPass=My,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==k1&&(n.blending=this.blending),this.side!==I1&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==GL&&(n.blendSrc=this.blendSrc),this.blendDst!==$L&&(n.blendDst=this.blendDst),this.blendEquation!==md&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==HL&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==cte&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==My&&(n.stencilFail=this.stencilFail),this.stencilZFail!==My&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==My&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}const qbe=new nh,IZ=new bs,gst=Mr(0).onReference(({material:i})=>i).onObjectUpdate(({material:i})=>i.refractionRatio),kZ=Mr(1).onReference(({material:i})=>i).onObjectUpdate(function({material:i,scene:e}){return i.envMap?i.envMapIntensity:e.environmentIntensity}),wPe=Mr(new bs).onReference(function(i){return i.material}).onObjectUpdate(function({material:i,scene:e}){const t=e.environment!==null&&i.envMap===null?e.environmentRotation:i.envMapRotation;return t?(qbe.copy(t),IZ.makeRotationFromEuler(qbe)):IZ.identity(),IZ}),yst=ho.negate().reflect(ra),vst=ho.negate().refract(ra,gst),_st=yst.transformDirection(im).toVar("reflectVector"),xst=vst.transformDirection(im).toVar("reflectVector");class lz extends Kl{constructor(e=[],t=PM,n,r,s,o,a,c,u,f){super(e,t,n,r,s,o,a,c,u,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}const bst=new lz;let Sst=class extends Mx{static get type(){return"CubeTextureNode"}constructor(e,t=null,n=null,r=null){super(e,t,n,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===PM?_st:e.mapping===jL?xst:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),Bt(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return(e.renderer.coordinateSystem===W2||!n.isRenderTargetTexture)&&(t=Bt(t.x.negate(),t.yz)),wPe.mul(t)}generateUV(e,t){return t.build(e,"vec3")}};const wst=Zt(Sst).setParameterLength(1,4).setName("cubeTexture"),OM=(i=bst,e=null,t=null,n=null)=>{let r;return i&&i.isCubeTextureNode===!0?(r=en(i.clone()),r.referenceNode=i.getSelf(),e!==null&&(r.uvNode=en(e)),t!==null&&(r.levelNode=en(t)),n!==null&&(r.biasNode=en(n))):r=wst(i,e,t,n),r};let Tst=class extends uC{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}},uie=class extends jr{static get type(){return"ReferenceNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=li.OBJECT}element(e){return en(new Tst(this,en(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;this.count!==null?t=cPe(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Uf(null,e):e==="texture"?t=Ri(null):e==="cubeTexture"?t=OM(null):t=Mr(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}};const ys=(i,e,t)=>en(new uie(i,e,t)),Xbe=(i,e,t,n)=>en(new uie(i,e,n,t));let Est=class extends uie{static get type(){return"MaterialReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}};const _2=(i,e,t=null)=>en(new Est(i,e,t)),TPe=Yt(i=>(i.geometry.hasAttribute("tangent")===!1&&i.geometry.computeTangents(),X2("tangent","vec4")))(),hie=TPe.xyz.toVar("tangentLocal"),EPe=iz.mul(Gr(hie,0)).xyz.toVarying("v_tangentView").normalize().toVar("tangentView"),Mst=Yt(([i,e],t)=>{let n=i.mul(TPe.w).xyz;return t.material.flatShading!==!0&&(n=Ad(n,e)),n}).once(),Cst=Mst(Kf.cross(EPe),"v_bitangentView").normalize().toVar("bitangentView"),lE=F0(EPe,Cst,Kf),Ast=(()=>{let i=h_.cross(ho);return i=i.cross(h_).normalize(),i=Us(i,ra,Cy.mul(x1.oneMinus()).oneMinus().pow2().pow2()).normalize(),i})(),Rst=Yt(i=>{const{eye_pos:e,surf_norm:t,mapN:n,uv:r}=i,s=e.dFdx(),o=e.dFdy(),a=r.dFdx(),c=r.dFdy(),u=t,f=o.cross(u),m=u.cross(s),v=f.mul(a.x).add(m.mul(c.x)),x=f.mul(a.y).add(m.mul(c.y)),T=v.dot(v).max(x.dot(x)),P=oz.mul(T.inverseSqrt());return O0(v.mul(n.x,P),x.mul(n.y,P),u.mul(n.z)).normalize()});let Pst=class extends ua{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=j2}setup(e){const{normalMapType:t,scaleNode:n}=this;let r=this.node.mul(2).sub(1);n!==null&&(r=Bt(r.xy.mul(n),r.z));let s=null;return t===Ket?s=pPe(r):t===j2&&(e.hasGeometryAttribute("tangent")===!0?s=lE.mul(r).normalize():s=Rst({eye_pos:oa,surf_norm:Kf,mapN:r,uv:fC()})),s}};const Ybe=Zt(Pst).setParameterLength(1,2),Nst=Yt(({textureNode:i,bumpScale:e})=>{const t=r=>i.cache().context({getUV:s=>r(s.uvNode||fC()),forceUVContext:!0}),n=Nt(t(r=>r));return wn(Nt(t(r=>r.add(r.dFdx()))).sub(n),Nt(t(r=>r.add(r.dFdy()))).sub(n)).mul(e)}),Ist=Yt(i=>{const{surf_pos:e,surf_norm:t,dHdxy:n}=i,r=e.dFdx().normalize(),s=e.dFdy().normalize(),o=t,a=s.cross(o),c=o.cross(r),u=r.dot(a).mul(oz),f=u.sign().mul(n.x.mul(a).add(n.y.mul(c)));return u.abs().mul(t).sub(f).normalize()});let kst=class extends ua{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=Nst({textureNode:this.textureNode,bumpScale:e});return Ist({surf_pos:oa,surf_norm:Kf,dHdxy:t})}};const Dst=Zt(kst).setParameterLength(1,2),Kbe=new Map;let jt=class ao extends jr{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=Kbe.get(e);return n===void 0&&(n=_2(e,t),Kbe.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let r=null;if(n===ao.COLOR){const s=t.color!==void 0?this.getColor(n):Bt();t.map&&t.map.isTexture===!0?r=s.mul(this.getTexture("map")):r=s}else if(n===ao.OPACITY){const s=this.getFloat(n);t.alphaMap&&t.alphaMap.isTexture===!0?r=s.mul(this.getTexture("alpha")):r=s}else if(n===ao.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?r=this.getTexture("specular").r:r=Nt(1);else if(n===ao.SPECULAR_INTENSITY){const s=this.getFloat(n);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?r=s.mul(this.getTexture(n).a):r=s}else if(n===ao.SPECULAR_COLOR){const s=this.getColor(n);t.specularColorMap&&t.specularColorMap.isTexture===!0?r=s.mul(this.getTexture(n).rgb):r=s}else if(n===ao.ROUGHNESS){const s=this.getFloat(n);t.roughnessMap&&t.roughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).g):r=s}else if(n===ao.METALNESS){const s=this.getFloat(n);t.metalnessMap&&t.metalnessMap.isTexture===!0?r=s.mul(this.getTexture(n).b):r=s}else if(n===ao.EMISSIVE){const s=this.getFloat("emissiveIntensity"),o=this.getColor(n).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?r=o.mul(this.getTexture(n)):r=o}else if(n===ao.NORMAL)t.normalMap?(r=Ybe(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType):t.bumpMap?r=Dst(this.getTexture("bump").r,this.getFloat("bumpScale")):r=Kf;else if(n===ao.CLEARCOAT){const s=this.getFloat(n);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?r=s.mul(this.getTexture(n).r):r=s}else if(n===ao.CLEARCOAT_ROUGHNESS){const s=this.getFloat(n);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).r):r=s}else if(n===ao.CLEARCOAT_NORMAL)t.clearcoatNormalMap?r=Ybe(this.getTexture(n),this.getCache(n+"Scale","vec2")):r=Kf;else if(n===ao.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?r=s.mul(this.getTexture("sheenColor").rgb):r=s}else if(n===ao.SHEEN_ROUGHNESS){const s=this.getFloat(n);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).a):r=s,r=r.clamp(.07,1)}else if(n===ao.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(n);r=qre(_T.x,_T.y,_T.y.negate(),_T.x).mul(s.rg.mul(2).sub(wn(1)).normalize().mul(s.b))}else r=_T;else if(n===ao.IRIDESCENCE_THICKNESS){const s=ys("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=ys("0","float",t.iridescenceThicknessRange);r=s.sub(o).mul(this.getTexture(n).g).add(o)}else r=s}else if(n===ao.TRANSMISSION){const s=this.getFloat(n);t.transmissionMap?r=s.mul(this.getTexture(n).r):r=s}else if(n===ao.THICKNESS){const s=this.getFloat(n);t.thicknessMap?r=s.mul(this.getTexture(n).g):r=s}else if(n===ao.IOR)r=this.getFloat(n);else if(n===ao.LIGHT_MAP)r=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===ao.AO)r=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(n===ao.LINE_DASH_OFFSET)r=t.dashOffset?this.getFloat(n):Nt(0);else{const s=this.getNodeType(e);r=this.getCache(n,s)}return r}};jt.ALPHA_TEST="alphaTest";jt.COLOR="color";jt.OPACITY="opacity";jt.SHININESS="shininess";jt.SPECULAR="specular";jt.SPECULAR_STRENGTH="specularStrength";jt.SPECULAR_INTENSITY="specularIntensity";jt.SPECULAR_COLOR="specularColor";jt.REFLECTIVITY="reflectivity";jt.ROUGHNESS="roughness";jt.METALNESS="metalness";jt.NORMAL="normal";jt.CLEARCOAT="clearcoat";jt.CLEARCOAT_ROUGHNESS="clearcoatRoughness";jt.CLEARCOAT_NORMAL="clearcoatNormal";jt.EMISSIVE="emissive";jt.ROTATION="rotation";jt.SHEEN="sheen";jt.SHEEN_ROUGHNESS="sheenRoughness";jt.ANISOTROPY="anisotropy";jt.IRIDESCENCE="iridescence";jt.IRIDESCENCE_IOR="iridescenceIOR";jt.IRIDESCENCE_THICKNESS="iridescenceThickness";jt.IOR="ior";jt.TRANSMISSION="transmission";jt.THICKNESS="thickness";jt.ATTENUATION_DISTANCE="attenuationDistance";jt.ATTENUATION_COLOR="attenuationColor";jt.LINE_SCALE="scale";jt.LINE_DASH_SIZE="dashSize";jt.LINE_GAP_SIZE="gapSize";jt.LINE_WIDTH="linewidth";jt.LINE_DASH_OFFSET="dashOffset";jt.POINT_SIZE="size";jt.DISPERSION="dispersion";jt.LIGHT_MAP="light";jt.AO="ao";const Fst=xn(jt,jt.ALPHA_TEST),Ost=xn(jt,jt.COLOR),Bst=xn(jt,jt.SHININESS),Lst=xn(jt,jt.EMISSIVE),MPe=xn(jt,jt.OPACITY),Ust=xn(jt,jt.SPECULAR),Zbe=xn(jt,jt.SPECULAR_INTENSITY),zst=xn(jt,jt.SPECULAR_COLOR),YB=xn(jt,jt.SPECULAR_STRENGTH),DZ=xn(jt,jt.REFLECTIVITY),Vst=xn(jt,jt.ROUGHNESS),Gst=xn(jt,jt.METALNESS),$st=xn(jt,jt.NORMAL),Hst=xn(jt,jt.CLEARCOAT),jst=xn(jt,jt.CLEARCOAT_ROUGHNESS),Wst=xn(jt,jt.CLEARCOAT_NORMAL),qst=xn(jt,jt.ROTATION),Xst=xn(jt,jt.SHEEN),Yst=xn(jt,jt.SHEEN_ROUGHNESS),Kst=xn(jt,jt.ANISOTROPY),Zst=xn(jt,jt.IRIDESCENCE),Qst=xn(jt,jt.IRIDESCENCE_IOR),Jst=xn(jt,jt.IRIDESCENCE_THICKNESS),eot=xn(jt,jt.TRANSMISSION),tot=xn(jt,jt.THICKNESS),not=xn(jt,jt.IOR),rot=xn(jt,jt.ATTENUATION_DISTANCE),iot=xn(jt,jt.ATTENUATION_COLOR),sot=xn(jt,jt.LINE_SCALE),oot=xn(jt,jt.LINE_DASH_SIZE),aot=xn(jt,jt.LINE_GAP_SIZE);jt.LINE_WIDTH;const lot=xn(jt,jt.LINE_DASH_OFFSET),cot=xn(jt,jt.POINT_SIZE),uot=xn(jt,jt.DISPERSION),CPe=xn(jt,jt.LIGHT_MAP),hot=xn(jt,jt.AO),_T=Mr(new si).onReference(function(i){return i.material}).onRenderUpdate(function({material:i}){this.value.set(i.anisotropy*Math.cos(i.anisotropyRotation),i.anisotropy*Math.sin(i.anisotropyRotation))}),APe=Yt(i=>i.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class dot extends sPe{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class fot extends Qu{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}let pot=class extends jr{static get type(){return"InstanceNode"}constructor(e,t,n=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=li.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{count:t,instanceMatrix:n,instanceColor:r}=this;let{instanceMatrixNode:s,instanceColorNode:o}=this;if(s===null){if(t<=1e3)s=cPe(n.array,"mat4",Math.max(t,1)).element(oie);else{const c=new dot(n.array,16,1);this.buffer=c;const u=n.usage===z6?Gbe:Vbe,f=[u(c,"vec4",16,0),u(c,"vec4",16,4),u(c,"vec4",16,8),u(c,"vec4",16,12)];s=u_(...f)}this.instanceMatrixNode=s}if(r&&o===null){const c=new fot(r.array,3),u=r.usage===z6?Gbe:Vbe;this.bufferColor=c,o=Bt(u(c,"vec3",3,0)),this.instanceColorNode=o}const a=s.mul($l).xyz;if($l.assign(a),e.hasGeometryAttribute("normal")){const c=Qit(Yf,s);Yf.assign(c)}this.instanceColorNode!==null&&QL("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==z6&&this.buffer!==null&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==z6&&this.bufferColor!==null&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}},mot=class extends pot{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:r}=e;super(t,n,r),this.instancedMesh=e}};const got=Zt(mot).setParameterLength(1);let yot=class extends jr{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=oie:this.batchingIdNode=Fit);const n=Yt(([T])=>{const P=Ps(f_(rd(this.batchMesh._indirectTexture),0).x),R=Ps(T).mod(P),M=Ps(T).div(P);return rd(this.batchMesh._indirectTexture,g1(R,M)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(Ps(this.batchingIdNode)),r=this.batchMesh._matricesTexture,s=Ps(f_(rd(r),0).x),o=Nt(n).mul(4).toInt().toVar(),a=o.mod(s),c=o.div(s),u=u_(rd(r,g1(a,c)),rd(r,g1(a.add(1),c)),rd(r,g1(a.add(2),c)),rd(r,g1(a.add(3),c))),f=this.batchMesh._colorsTexture;if(f!==null){const P=Yt(([R])=>{const M=Ps(f_(rd(f),0).x),O=R,C=O.mod(M),L=O.div(M);return rd(f,g1(C,L)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(n);QL("vec3","vBatchColor").assign(P)}const m=F0(u);$l.assign(u.mul($l));const v=Yf.div(Bt(m[0].dot(m[0]),m[1].dot(m[1]),m[2].dot(m[2]))),x=m.mul(v).xyz;Yf.assign(x),e.hasGeometryAttribute("tangent")&&hie.mulAssign(m)}};const vot=Zt(yot).setParameterLength(1),Qbe=new WeakMap;let _ot=class extends jr{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=li.OBJECT,this.skinIndexNode=X2("skinIndex","uvec4"),this.skinWeightNode=X2("skinWeight","vec4"),this.bindMatrixNode=ys("bindMatrix","mat4"),this.bindMatrixInverseNode=ys("bindMatrixInverse","mat4"),this.boneMatricesNode=Xbe("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=$l,this.toPositionNode=$l,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(n.x),c=e.element(n.y),u=e.element(n.z),f=e.element(n.w),m=s.mul(t),v=O0(a.mul(r.x).mul(m),c.mul(r.y).mul(m),u.mul(r.z).mul(m),f.mul(r.w).mul(m));return o.mul(v).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=Yf){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(n.x),c=e.element(n.y),u=e.element(n.z),f=e.element(n.w);let m=O0(r.x.mul(a),r.y.mul(c),r.z.mul(u),r.w.mul(f));return m=o.mul(m).mul(s),m.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=Xbe("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,Wbe)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||bRe(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&Wbe.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const n=this.getSkinnedNormal();Yf.assign(n),e.hasGeometryAttribute("tangent")&&hie.assign(n)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;Qbe.get(t)!==e.frameId&&(Qbe.set(t,e.frameId),this.previousBoneMatricesNode!==null&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}};const xot=i=>en(new _ot(i));class bot extends Kl{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Ma,this.minFilter=Ma,this.wrapR=E2,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}const FZ=new WeakMap,Lc=new _i,Jbe=Yt(({bufferMap:i,influence:e,stride:t,width:n,depth:r,offset:s})=>{const o=Ps(Dit).mul(t).add(s),a=o.div(n),c=o.sub(a.mul(n));return rd(i,g1(c,a)).depth(r).xyz.mul(e)});function Sot(i){const e=i.morphAttributes.position!==void 0,t=i.morphAttributes.normal!==void 0,n=i.morphAttributes.color!==void 0,r=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,s=r!==void 0?r.length:0;let o=FZ.get(i);if(o===void 0||o.count!==s){let O=function(){R.dispose(),FZ.delete(i),i.removeEventListener("dispose",O)};var a=O;o!==void 0&&o.texture.dispose();const c=i.morphAttributes.position||[],u=i.morphAttributes.normal||[],f=i.morphAttributes.color||[];let m=0;e===!0&&(m=1),t===!0&&(m=2),n===!0&&(m=3);let v=i.attributes.position.count*m,x=1;const T=4096;v>T&&(x=Math.ceil(v/T),v=T);const P=new Float32Array(v*x*4*s),R=new bot(P,v,x,s);R.type=Xc,R.needsUpdate=!0;const M=m*4;for(let C=0;C<s;C++){const L=c[C],Y=u[C],J=f[C],z=v*x*4*C;for(let ne=0;ne<L.count;ne++){const K=ne*M;e===!0&&(Lc.fromBufferAttribute(L,ne),P[z+K+0]=Lc.x,P[z+K+1]=Lc.y,P[z+K+2]=Lc.z,P[z+K+3]=0),t===!0&&(Lc.fromBufferAttribute(Y,ne),P[z+K+4]=Lc.x,P[z+K+5]=Lc.y,P[z+K+6]=Lc.z,P[z+K+7]=0),n===!0&&(Lc.fromBufferAttribute(J,ne),P[z+K+8]=Lc.x,P[z+K+9]=Lc.y,P[z+K+10]=Lc.z,P[z+K+11]=J.itemSize===4?Lc.w:1)}}o={count:s,texture:R,stride:m,size:new si(v,x)},FZ.set(i,o),i.addEventListener("dispose",O)}return o}let wot=class extends jr{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Mr(1),this.updateType=li.OBJECT}setup(e){const{geometry:t}=e,n=t.morphAttributes.position!==void 0,r=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=s!==void 0?s.length:0,{texture:a,stride:c,size:u}=Sot(t);n===!0&&$l.mulAssign(this.morphBaseInfluence),r===!0&&Yf.mulAssign(this.morphBaseInfluence);const f=Ps(u.width);gd(o,({i:m})=>{const v=Nt(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?v.assign(rd(this.mesh.morphTexture,g1(Ps(m).add(1),Ps(oie))).r):v.assign(ys("morphTargetInfluences","float").element(m).toVar()),Vo(v.notEqual(0),()=>{n===!0&&$l.addAssign(Jbe({bufferMap:a,influence:v,stride:c,width:f,depth:m,offset:Ps(0)})),r===!0&&Yf.addAssign(Jbe({bufferMap:a,influence:v,stride:c,width:f,depth:m,offset:Ps(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,n)=>t+n,0)}};const Tot=Zt(wot).setParameterLength(1);let Cx=class extends jr{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}},Eot=class extends Cx{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}},Mot=class extends nPe{static get type(){return"LightingContextNode"}constructor(e,t=null,n=null,r=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n=Bt().toVar("directDiffuse"),r=Bt().toVar("directSpecular"),s=Bt().toVar("indirectDiffuse"),o=Bt().toVar("indirectSpecular"),a={directDiffuse:n,directSpecular:r,indirectDiffuse:s,indirectSpecular:o};return{radiance:Bt().toVar("radiance"),irradiance:Bt().toVar("irradiance"),iblIrradiance:Bt().toVar("iblIrradiance"),ambientOcclusion:Nt(1).toVar("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}};const Cot=Zt(Mot);let Aot=class extends Cx{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}},Y2=class KB extends jr{static get type(){return"ClippingNode"}constructor(e=KB.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===KB.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,r):this.scope===KB.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(n,r)}setupAlphaToCoverage(e,t){return Yt(()=>{const n=Nt().toVar("distanceToPlane"),r=Nt().toVar("distanceToGradient"),s=Nt(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const c=Uf(t);gd(o,({i:u})=>{const f=c.element(u);n.assign(oa.dot(f.xyz).negate().add(f.w)),r.assign(n.fwidth().div(2)),s.mulAssign(q2(r.negate(),r,n))})}const a=e.length;if(a>0){const c=Uf(e),u=Nt(1).toVar("intersectionClipOpacity");gd(a,({i:f})=>{const m=c.element(f);n.assign(oa.dot(m.xyz).negate().add(m.w)),r.assign(n.fwidth().div(2)),u.mulAssign(q2(r.negate(),r,n).oneMinus())}),s.mulAssign(u.oneMinus())}Bi.a.mulAssign(s),Bi.a.equal(0).discard()})()}setupDefault(e,t){return Yt(()=>{const n=t.length;if(this.hardwareClipping===!1&&n>0){const s=Uf(t);gd(n,({i:o})=>{const a=s.element(o);oa.dot(a.xyz).greaterThan(a.w).discard()})}const r=e.length;if(r>0){const s=Uf(e),o=Wre(!0).toVar("clipped");gd(r,({i:a})=>{const c=s.element(a);o.assign(oa.dot(c.xyz).greaterThan(c.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),Yt(()=>{const r=Uf(e),s=rz(t.getClipDistance());gd(n,({i:o})=>{const a=r.element(o),c=oa.dot(a.xyz).sub(a.w).negate();s.element(o).assign(c)})})()}};Y2.ALPHA_TO_COVERAGE="alphaToCoverage";Y2.DEFAULT="default";Y2.HARDWARE="hardware";const Rot=()=>en(new Y2),Pot=()=>en(new Y2(Y2.ALPHA_TO_COVERAGE)),Not=()=>en(new Y2(Y2.HARDWARE)),Iot=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];let kot=class{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=Iot,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:n,material:r,object:s}=e;if(t={material:this.getMaterialData(r),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:a}=e.context;t.bufferWidth=o,t.bufferHeight=a}this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const r=e[n];t[n]={version:r.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return e.renderer.overrideNodes.modelViewMatrix!==null||e.renderer.overrideNodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const r=e[n];r!=null&&(typeof r=="object"&&r.clone!==void 0?r.isTexture===!0?t[n]={id:r.id,version:r.version}:t[n]=r.clone():t[n]=r)}return t}equals(e){const{object:t,material:n,geometry:r}=e,s=this.getRenderObjectData(e);if(s.worldMatrix.equals(t.matrixWorld)!==!0)return s.worldMatrix.copy(t.matrixWorld),!1;const o=s.material;for(const P in o){const R=o[P],M=n[P];if(R.equals!==void 0){if(R.equals(M)===!1)return R.copy(M),!1}else if(M.isTexture===!0){if(R.id!==M.id||R.version!==M.version)return R.id=M.id,R.version=M.version,!1}else if(R!==M)return o[P]=M,!1}if(o.transmission>0){const{width:P,height:R}=e.context;if(s.bufferWidth!==P||s.bufferHeight!==R)return s.bufferWidth=P,s.bufferHeight=R,!1}const a=s.geometry,c=r.attributes,u=a.attributes,f=Object.keys(u),m=Object.keys(c);if(a.id!==r.id)return a.id=r.id,!1;if(f.length!==m.length)return s.geometry.attributes=this.getAttributesData(c),!1;for(const P of f){const R=u[P],M=c[P];if(M===void 0)return delete u[P],!1;if(R.version!==M.version)return R.version=M.version,!1}const v=r.index,x=a.indexVersion,T=v?v.version:null;if(x!==T)return a.indexVersion=T,!1;if(a.drawRange.start!==r.drawRange.start||a.drawRange.count!==r.drawRange.count)return a.drawRange.start=r.drawRange.start,a.drawRange.count=r.drawRange.count,!1;if(s.morphTargetInfluences){let P=!1;for(let R=0;R<s.morphTargetInfluences.length;R++)s.morphTargetInfluences[R]!==t.morphTargetInfluences[R]&&(P=!0);if(P)return!0}return s.center&&s.center.equals(t.center)===!1?(s.center.copy(t.center),!0):(e.bundle!==null&&(s.version=e.bundle.version),!0)}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const r=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;return r||s?!1:this.equals(e)!==!0}};const Dot=kot,Fot=.05,eSe=Yt(([i])=>r3(fi(1e4,fd(fi(17,i.x).add(fi(.1,i.y)))).mul(O0(.1,$u(fd(fi(13,i.y).add(i.x))))))),tSe=Yt(([i])=>eSe(wn(eSe(i.xy),i.z))),Oot=Yt(([i])=>{const e=Ql(L1(XRe(i.xyz)),L1(YRe(i.xyz))),t=Nt(1).div(Nt(Fot).mul(e)).toVar("pixScale"),n=wn(kM(i4(B1(t))),kM(Qre(B1(t)))),r=wn(tSe(i4(n.x.mul(i.xyz))),tSe(i4(n.y.mul(i.xyz)))),s=r3(B1(t)),o=O0(fi(s.oneMinus(),r.x),fi(s,r.y)),a=J_(s,s.oneMinus()),c=Bt(o.mul(o).div(fi(2,a).mul(C0(1,a))),o.sub(fi(.5,a)).div(C0(1,a)),C0(1,C0(1,o).mul(C0(1,o)).div(fi(2,a).mul(C0(1,a))))),u=o.lessThan(a.oneMinus()).select(o.lessThan(a).select(c.x,c.y),c.z);return Y1(u,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});let Bot=class extends aPe{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),n=e.hasGeometryAttribute(t);let r;return n===!0?r=super.generate(e):r=e.generateConst(this.nodeType,new _i(1,1,1,1)),r}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}};const Lot=(i=0)=>en(new Bot(i));let Uot=class extends vc{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{console.warn('THREE.NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}customProgramCacheKey(){return this.type+_Re(this)}build(e){this.setup(e)}setupObserver(e){return new Dot(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();e.addStack();const r=this.setupVertex(e),s=this.vertexNode||r;e.stack.outputNode=s,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let o;const a=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(n!==null?n.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const c=this.setupLighting(e);a!==null&&e.stack.add(a);const u=Gr(c,Bi.a).max(0);o=this.setupOutput(e,u),BE.assign(o);const f=this.outputNode!==null;if(f&&(o=this.outputNode),n!==null){const m=t.getMRT(),v=this.mrtNode;m!==null?(f&&BE.assign(o),o=m,v!==null&&(o=m.merge(v))):v!==null&&(o=v)}}else{let c=this.fragmentNode;c.isOutputStructNode!==!0&&(c=Gr(c)),o=this.setupOutput(e,c)}e.stack.outputNode=o,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let r=null;if(t.length>0||n.length>0){const s=e.renderer.samples;this.alphaToCoverage&&s>1?r=Pot():e.stack.add(Rot())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(Not()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let r=this.depthNode;if(r===null){const s=t.getMRT();s&&s.has("depth")?r=s.get("depth"):t.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?r=xPe(oa.z,Fy,Oy):r=UE(oa.z,Fy,Oy))}r!==null&&SPe.assign(r).toStack()}setupPositionView(){return iz.mul($l).xyz}setupModelViewProjection(){return aie.mul(oa)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),APe}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&Tot(t).toStack(),t.isSkinnedMesh===!0&&xot(t).toStack(),this.displacementMap){const r=_2("displacementMap","texture"),s=_2("displacementScale","float"),o=_2("displacementBias","float");$l.addAssign(Yf.normalize().mul(r.x.mul(s).add(o)))}return t.isBatchedMesh&&vot(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&got(t).toStack(),this.positionNode!==null&&$l.assign(Tit(this.positionNode,"POSITION")),$l}setupDiffuseColor({object:e,geometry:t}){this.maskNode!==null&&Wre(this.maskNode).not().discard();let n=this.colorNode?Gr(this.colorNode):Ost;this.vertexColors===!0&&t.hasAttribute("color")&&(n=n.mul(Lot())),e.instanceColor&&(n=QL("vec3","vInstanceColor").mul(n)),e.isBatchedMesh&&e._colorsTexture&&(n=QL("vec3","vBatchColor").mul(n)),Bi.assign(n);const r=this.opacityNode?Nt(this.opacityNode):MPe;Bi.a.assign(Bi.a.mul(r));let s=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(s=this.alphaTestNode!==null?Nt(this.alphaTestNode):Fst,Bi.a.lessThanEqual(s).discard()),this.alphaHash===!0&&Bi.a.lessThan(Oot($l)).discard(),this.transparent===!1&&this.blending===k1&&this.alphaToCoverage===!1?Bi.a.assign(1):s===null&&Bi.a.lessThanEqual(0).discard()}setupVariants(){}setupOutgoingLight(){return this.lights===!0?Bt(0):Bi.rgb}setupNormal(){return this.normalNode?Bt(this.normalNode):$st}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?_2("envMap","cubeTexture"):_2("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Aot(CPe)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const r=this.setupLightMap(e);if(r&&r.isLightingNode&&t.push(r),this.aoNode!==null||e.material.aoMap){const o=this.aoNode!==null?this.aoNode:hot;t.push(new Eot(o))}let s=this.lightsNode||e.lightsNode;return t.length>0&&(s=e.renderer.lighting.createNode([...s.getLights(),...t])),s}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:r,emissiveNode:s}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=this.setupOutgoingLight(e);if(a&&a.getScope().hasLights){const u=this.setupLightingModel(e)||null;c=Cot(a,u,n,r)}else n!==null&&(c=Bt(r!==null?Us(c,n,r):n));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(Ube.assign(Bt(s||Lst)),c=c.add(Ube)),c}setupFog(e,t){const n=e.fogNode;return n&&(BE.assign(t),t=Gr(n)),t}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),t}setDefaultValues(e){for(const n in e){const r=e[n];this[n]===void 0&&(this[n]=r,r&&r.clone&&(this[n]=r.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&t[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const n=vc.prototype.toJSON.call(this,e),r=YL(this);n.inputNodes={};for(const{property:o,childNode:a}of r)n.inputNodes[o]=a.toJSON(e).uuid;function s(o){const a=[];for(const c in o){const u=o[c];delete u.metadata,a.push(u)}return a}if(t){const o=s(e.textures),a=s(e.images),c=s(e.nodes);o.length>0&&(n.textures=o),a.length>0&&(n.images=a),c.length>0&&(n.nodes=c)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}};const la=Uot;let zot=0;const Bu=new bs,OZ=new Pa,Q8=new st,Uc=new dC,xT=new dC,$a=new st;class sm extends N4{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:zot++}),this.uuid=N1(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(yRe(e)?wRe:SRe)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new _c().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Bu.makeRotationFromQuaternion(e),this.applyMatrix4(Bu),this}rotateX(e){return Bu.makeRotationX(e),this.applyMatrix4(Bu),this}rotateY(e){return Bu.makeRotationY(e),this.applyMatrix4(Bu),this}rotateZ(e){return Bu.makeRotationZ(e),this.applyMatrix4(Bu),this}translate(e,t,n){return Bu.makeTranslation(e,t,n),this.applyMatrix4(Bu),this}scale(e,t,n){return Bu.makeScale(e,t,n),this.applyMatrix4(Bu),this}lookAt(e){return OZ.lookAt(e),OZ.updateMatrix(),this.applyMatrix4(OZ.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Q8).negate(),this.translate(Q8.x,Q8.y,Q8.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];n.push(o.x,o.y,o.z||0)}this.setAttribute("position",new k0(n,3))}else{const n=Math.min(e.length,t.count);for(let r=0;r<n;r++){const s=e[r];t.setXYZ(r,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new dC);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new st(-1/0,-1/0,-1/0),new st(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const s=t[n];Uc.setFromBufferAttribute(s),this.morphTargetsRelative?($a.addVectors(this.boundingBox.min,Uc.min),this.boundingBox.expandByPoint($a),$a.addVectors(this.boundingBox.max,Uc.max),this.boundingBox.expandByPoint($a)):(this.boundingBox.expandByPoint(Uc.min),this.boundingBox.expandByPoint(Uc.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new nz);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new st,1/0);return}if(e){const n=this.boundingSphere.center;if(Uc.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];xT.setFromBufferAttribute(a),this.morphTargetsRelative?($a.addVectors(Uc.min,xT.min),Uc.expandByPoint($a),$a.addVectors(Uc.max,xT.max),Uc.expandByPoint($a)):(Uc.expandByPoint(xT.min),Uc.expandByPoint(xT.max))}Uc.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)$a.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared($a));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],c=this.morphTargetsRelative;for(let u=0,f=a.count;u<f;u++)$a.fromBufferAttribute(a,u),c&&(Q8.fromBufferAttribute(e,u),$a.add(Q8)),r=Math.max(r,n.distanceToSquared($a))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Qu(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let ne=0;ne<n.count;ne++)a[ne]=new st,c[ne]=new st;const u=new st,f=new st,m=new st,v=new si,x=new si,T=new si,P=new st,R=new st;function M(ne,K,$){u.fromBufferAttribute(n,ne),f.fromBufferAttribute(n,K),m.fromBufferAttribute(n,$),v.fromBufferAttribute(s,ne),x.fromBufferAttribute(s,K),T.fromBufferAttribute(s,$),f.sub(u),m.sub(u),x.sub(v),T.sub(v);const he=1/(x.x*T.y-T.x*x.y);isFinite(he)&&(P.copy(f).multiplyScalar(T.y).addScaledVector(m,-x.y).multiplyScalar(he),R.copy(m).multiplyScalar(x.x).addScaledVector(f,-T.x).multiplyScalar(he),a[ne].add(P),a[K].add(P),a[$].add(P),c[ne].add(R),c[K].add(R),c[$].add(R))}let O=this.groups;O.length===0&&(O=[{start:0,count:e.count}]);for(let ne=0,K=O.length;ne<K;++ne){const $=O[ne],he=$.start,Ce=$.count;for(let Pe=he,je=he+Ce;Pe<je;Pe+=3)M(e.getX(Pe+0),e.getX(Pe+1),e.getX(Pe+2))}const C=new st,L=new st,Y=new st,J=new st;function z(ne){Y.fromBufferAttribute(r,ne),J.copy(Y);const K=a[ne];C.copy(K),C.sub(Y.multiplyScalar(Y.dot(K))).normalize(),L.crossVectors(J,K);const he=L.dot(c[ne])<0?-1:1;o.setXYZW(ne,C.x,C.y,C.z,he)}for(let ne=0,K=O.length;ne<K;++ne){const $=O[ne],he=$.start,Ce=$.count;for(let Pe=he,je=he+Ce;Pe<je;Pe+=3)z(e.getX(Pe+0)),z(e.getX(Pe+1)),z(e.getX(Pe+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Qu(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let v=0,x=n.count;v<x;v++)n.setXYZ(v,0,0,0);const r=new st,s=new st,o=new st,a=new st,c=new st,u=new st,f=new st,m=new st;if(e)for(let v=0,x=e.count;v<x;v+=3){const T=e.getX(v+0),P=e.getX(v+1),R=e.getX(v+2);r.fromBufferAttribute(t,T),s.fromBufferAttribute(t,P),o.fromBufferAttribute(t,R),f.subVectors(o,s),m.subVectors(r,s),f.cross(m),a.fromBufferAttribute(n,T),c.fromBufferAttribute(n,P),u.fromBufferAttribute(n,R),a.add(f),c.add(f),u.add(f),n.setXYZ(T,a.x,a.y,a.z),n.setXYZ(P,c.x,c.y,c.z),n.setXYZ(R,u.x,u.y,u.z)}else for(let v=0,x=t.count;v<x;v+=3)r.fromBufferAttribute(t,v+0),s.fromBufferAttribute(t,v+1),o.fromBufferAttribute(t,v+2),f.subVectors(o,s),m.subVectors(r,s),f.cross(m),n.setXYZ(v+0,f.x,f.y,f.z),n.setXYZ(v+1,f.x,f.y,f.z),n.setXYZ(v+2,f.x,f.y,f.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)$a.fromBufferAttribute(e,t),$a.normalize(),e.setXYZ(t,$a.x,$a.y,$a.z)}toNonIndexed(){function e(a,c){const u=a.array,f=a.itemSize,m=a.normalized,v=new u.constructor(c.length*f);let x=0,T=0;for(let P=0,R=c.length;P<R;P++){a.isInterleavedBufferAttribute?x=c[P]*a.data.stride+a.offset:x=c[P]*f;for(let M=0;M<f;M++)v[T++]=u[x++]}return new Qu(v,f,m)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new sm,n=this.index.array,r=this.attributes;for(const a in r){const c=r[a],u=e(c,n);t.setAttribute(a,u)}const s=this.morphAttributes;for(const a in s){const c=[],u=s[a];for(let f=0,m=u.length;f<m;f++){const v=u[f],x=e(v,n);c.push(x)}t.morphAttributes[a]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const u=o[a];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const u in c)c[u]!==void 0&&(e[u]=c[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const c in n){const u=n[c];e.data.attributes[c]=u.toJSON(e.data)}const r={};let s=!1;for(const c in this.morphAttributes){const u=this.morphAttributes[c],f=[];for(let m=0,v=u.length;m<v;m++){const x=u[m];f.push(x.toJSON(e.data))}f.length>0&&(r[c]=f,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere=a.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const r=e.attributes;for(const u in r){const f=r[u];this.setAttribute(u,f.clone(t))}const s=e.morphAttributes;for(const u in s){const f=[],m=s[u];for(let v=0,x=m.length;v<x;v++)f.push(m[v].clone(t));this.morphAttributes[u]=f}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let u=0,f=o.length;u<f;u++){const m=o[u];this.addGroup(m.start,m.count,m.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const u1=new st,BZ=new st,MO=new st,Jg=new st,LZ=new st,CO=new st,UZ=new st;class Vot{constructor(e=new st,t=new st(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,u1)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=u1.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(u1.copy(this.origin).addScaledVector(this.direction,t),u1.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){BZ.copy(e).add(t).multiplyScalar(.5),MO.copy(t).sub(e).normalize(),Jg.copy(this.origin).sub(BZ);const s=e.distanceTo(t)*.5,o=-this.direction.dot(MO),a=Jg.dot(this.direction),c=-Jg.dot(MO),u=Jg.lengthSq(),f=Math.abs(1-o*o);let m,v,x,T;if(f>0)if(m=o*c-a,v=o*a-c,T=s*f,m>=0)if(v>=-T)if(v<=T){const P=1/f;m*=P,v*=P,x=m*(m+o*v+2*a)+v*(o*m+v+2*c)+u}else v=s,m=Math.max(0,-(o*v+a)),x=-m*m+v*(v+2*c)+u;else v=-s,m=Math.max(0,-(o*v+a)),x=-m*m+v*(v+2*c)+u;else v<=-T?(m=Math.max(0,-(-o*s+a)),v=m>0?-s:Math.min(Math.max(-s,-c),s),x=-m*m+v*(v+2*c)+u):v<=T?(m=0,v=Math.min(Math.max(-s,-c),s),x=v*(v+2*c)+u):(m=Math.max(0,-(o*s+a)),v=m>0?s:Math.min(Math.max(-s,-c),s),x=-m*m+v*(v+2*c)+u);else v=o>0?-s:s,m=Math.max(0,-(o*v+a)),x=-m*m+v*(v+2*c)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,m),r&&r.copy(BZ).addScaledVector(MO,v),x}intersectSphere(e,t){u1.subVectors(e.center,this.origin);const n=u1.dot(this.direction),r=u1.dot(u1)-n*n,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=n-o,c=n+o;return c<0?null:a<0?this.at(c,t):this.at(a,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,s,o,a,c;const u=1/this.direction.x,f=1/this.direction.y,m=1/this.direction.z,v=this.origin;return u>=0?(n=(e.min.x-v.x)*u,r=(e.max.x-v.x)*u):(n=(e.max.x-v.x)*u,r=(e.min.x-v.x)*u),f>=0?(s=(e.min.y-v.y)*f,o=(e.max.y-v.y)*f):(s=(e.max.y-v.y)*f,o=(e.min.y-v.y)*f),n>o||s>r||((s>n||isNaN(n))&&(n=s),(o<r||isNaN(r))&&(r=o),m>=0?(a=(e.min.z-v.z)*m,c=(e.max.z-v.z)*m):(a=(e.max.z-v.z)*m,c=(e.min.z-v.z)*m),n>c||a>r)||((a>n||n!==n)&&(n=a),(c<r||r!==r)&&(r=c),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,u1)!==null}intersectTriangle(e,t,n,r,s){LZ.subVectors(t,e),CO.subVectors(n,e),UZ.crossVectors(LZ,CO);let o=this.direction.dot(UZ),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Jg.subVectors(this.origin,e);const c=a*this.direction.dot(CO.crossVectors(Jg,CO));if(c<0)return null;const u=a*this.direction.dot(LZ.cross(Jg));if(u<0||c+u>o)return null;const f=-a*Jg.dot(UZ);return f<0?null:this.at(f/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}const Qh=new st,h1=new st,zZ=new st,d1=new st,J8=new st,e6=new st,nSe=new st,VZ=new st,GZ=new st,$Z=new st,HZ=new _i,jZ=new _i,WZ=new _i;class yd{constructor(e=new st,t=new st,n=new st){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Qh.subVectors(e,t),r.cross(Qh);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,n,r,s){Qh.subVectors(r,t),h1.subVectors(n,t),zZ.subVectors(e,t);const o=Qh.dot(Qh),a=Qh.dot(h1),c=Qh.dot(zZ),u=h1.dot(h1),f=h1.dot(zZ),m=o*u-a*a;if(m===0)return s.set(0,0,0),null;const v=1/m,x=(u*c-a*f)*v,T=(o*f-a*c)*v;return s.set(1-x-T,T,x)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,d1)===null?!1:d1.x>=0&&d1.y>=0&&d1.x+d1.y<=1}static getInterpolation(e,t,n,r,s,o,a,c){return this.getBarycoord(e,t,n,r,d1)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,d1.x),c.addScaledVector(o,d1.y),c.addScaledVector(a,d1.z),c)}static getInterpolatedAttribute(e,t,n,r,s,o){return HZ.setScalar(0),jZ.setScalar(0),WZ.setScalar(0),HZ.fromBufferAttribute(e,t),jZ.fromBufferAttribute(e,n),WZ.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(HZ,s.x),o.addScaledVector(jZ,s.y),o.addScaledVector(WZ,s.z),o}static isFrontFacing(e,t,n,r){return Qh.subVectors(n,t),h1.subVectors(e,t),Qh.cross(h1).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Qh.subVectors(this.c,this.b),h1.subVectors(this.a,this.b),Qh.cross(h1).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return yd.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return yd.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,s){return yd.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}containsPoint(e){return yd.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return yd.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,s=this.c;let o,a;J8.subVectors(r,n),e6.subVectors(s,n),VZ.subVectors(e,n);const c=J8.dot(VZ),u=e6.dot(VZ);if(c<=0&&u<=0)return t.copy(n);GZ.subVectors(e,r);const f=J8.dot(GZ),m=e6.dot(GZ);if(f>=0&&m<=f)return t.copy(r);const v=c*m-f*u;if(v<=0&&c>=0&&f<=0)return o=c/(c-f),t.copy(n).addScaledVector(J8,o);$Z.subVectors(e,s);const x=J8.dot($Z),T=e6.dot($Z);if(T>=0&&x<=T)return t.copy(s);const P=x*u-c*T;if(P<=0&&u>=0&&T<=0)return a=u/(u-T),t.copy(n).addScaledVector(e6,a);const R=f*T-x*m;if(R<=0&&m-f>=0&&x-T>=0)return nSe.subVectors(s,r),a=(m-f)/(m-f+(x-T)),t.copy(r).addScaledVector(nSe,a);const M=1/(R+P+v);return o=P*M,a=v*M,t.copy(n).addScaledVector(J8,o).addScaledVector(e6,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}class x2 extends vc{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new zi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new nh,this.combine=YU,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const rSe=new bs,ay=new Vot,AO=new nz,iSe=new st,RO=new st,PO=new st,NO=new st,qZ=new st,IO=new st,sSe=new st,kO=new st;class Q1 extends Pa{constructor(e=new sm,t=new x2){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){IO.set(0,0,0);for(let c=0,u=s.length;c<u;c++){const f=a[c],m=s[c];f!==0&&(qZ.fromBufferAttribute(m,e),o?IO.addScaledVector(qZ,f):IO.addScaledVector(qZ.sub(t),f))}t.add(IO)}return t}raycast(e,t){const n=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),AO.copy(n.boundingSphere),AO.applyMatrix4(s),ay.copy(e.ray).recast(e.near),!(AO.containsPoint(ay.origin)===!1&&(ay.intersectSphere(AO,iSe)===null||ay.origin.distanceToSquared(iSe)>(e.far-e.near)**2))&&(rSe.copy(s).invert(),ay.copy(e.ray).applyMatrix4(rSe),!(n.boundingBox!==null&&ay.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,ay)))}_computeIntersections(e,t,n){let r;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,u=s.attributes.uv,f=s.attributes.uv1,m=s.attributes.normal,v=s.groups,x=s.drawRange;if(a!==null)if(Array.isArray(o))for(let T=0,P=v.length;T<P;T++){const R=v[T],M=o[R.materialIndex],O=Math.max(R.start,x.start),C=Math.min(a.count,Math.min(R.start+R.count,x.start+x.count));for(let L=O,Y=C;L<Y;L+=3){const J=a.getX(L),z=a.getX(L+1),ne=a.getX(L+2);r=DO(this,M,e,n,u,f,m,J,z,ne),r&&(r.faceIndex=Math.floor(L/3),r.face.materialIndex=R.materialIndex,t.push(r))}}else{const T=Math.max(0,x.start),P=Math.min(a.count,x.start+x.count);for(let R=T,M=P;R<M;R+=3){const O=a.getX(R),C=a.getX(R+1),L=a.getX(R+2);r=DO(this,o,e,n,u,f,m,O,C,L),r&&(r.faceIndex=Math.floor(R/3),t.push(r))}}else if(c!==void 0)if(Array.isArray(o))for(let T=0,P=v.length;T<P;T++){const R=v[T],M=o[R.materialIndex],O=Math.max(R.start,x.start),C=Math.min(c.count,Math.min(R.start+R.count,x.start+x.count));for(let L=O,Y=C;L<Y;L+=3){const J=L,z=L+1,ne=L+2;r=DO(this,M,e,n,u,f,m,J,z,ne),r&&(r.faceIndex=Math.floor(L/3),r.face.materialIndex=R.materialIndex,t.push(r))}}else{const T=Math.max(0,x.start),P=Math.min(c.count,x.start+x.count);for(let R=T,M=P;R<M;R+=3){const O=R,C=R+1,L=R+2;r=DO(this,o,e,n,u,f,m,O,C,L),r&&(r.faceIndex=Math.floor(R/3),t.push(r))}}}}function Got(i,e,t,n,r,s,o,a){let c;if(e.side===gc?c=n.intersectTriangle(o,s,r,!0,a):c=n.intersectTriangle(r,s,o,e.side===I1,a),c===null)return null;kO.copy(a),kO.applyMatrix4(i.matrixWorld);const u=t.ray.origin.distanceTo(kO);return u<t.near||u>t.far?null:{distance:u,point:kO.clone(),object:i}}function DO(i,e,t,n,r,s,o,a,c,u){i.getVertexPosition(a,RO),i.getVertexPosition(c,PO),i.getVertexPosition(u,NO);const f=Got(i,e,t,n,RO,PO,NO,sSe);if(f){const m=new st;yd.getBarycoord(sSe,RO,PO,NO,m),r&&(f.uv=yd.getInterpolatedAttribute(r,a,c,u,m,new si)),s&&(f.uv1=yd.getInterpolatedAttribute(s,a,c,u,m,new si)),o&&(f.normal=yd.getInterpolatedAttribute(o,a,c,u,m,new st),f.normal.dot(n.direction)>0&&f.normal.multiplyScalar(-1));const v={a,b:c,c:u,normal:new st,materialIndex:0};yd.getNormal(RO,PO,NO,v.normal),f.face=v,f.barycoord=m}return f}class die extends Ure{constructor(e=-1,t=1,n=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,o=n+e,a=r+t,c=r-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,o=s+u*this.view.width,a-=f*this.view.offsetY,c=a-f*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const XZ=new die(-1,1,1,-1,0,1);let $ot=class extends sm{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new k0([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new k0(t,2))}};const Hot=new $ot;let jot=class extends Q1{constructor(e=null){super(Hot,e),this.camera=XZ,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,XZ)}render(e){e.render(this,XZ)}};const fie=jot,cz=1/6,RPe=i=>fi(cz,fi(i,fi(i,i.negate().add(3)).sub(3)).add(1)),vte=i=>fi(cz,fi(i,fi(i,fi(3,i).sub(6))).add(4)),PPe=i=>fi(cz,fi(i,fi(i,fi(-3,i).add(3)).add(3)).add(1)),_te=i=>fi(cz,tz(i,3)),oSe=i=>RPe(i).add(vte(i)),aSe=i=>PPe(i).add(_te(i)),lSe=i=>O0(-1,vte(i).div(RPe(i).add(vte(i)))),cSe=i=>O0(1,_te(i).div(PPe(i).add(_te(i)))),uSe=(i,e,t)=>{const n=i.uvNode,r=fi(n,e.zw).add(.5),s=i4(r),o=r3(r),a=oSe(o.x),c=aSe(o.x),u=lSe(o.x),f=cSe(o.x),m=lSe(o.y),v=cSe(o.y),x=wn(s.x.add(u),s.y.add(m)).sub(.5).mul(e.xy),T=wn(s.x.add(f),s.y.add(m)).sub(.5).mul(e.xy),P=wn(s.x.add(u),s.y.add(v)).sub(.5).mul(e.xy),R=wn(s.x.add(f),s.y.add(v)).sub(.5).mul(e.xy),M=oSe(o.y).mul(O0(a.mul(i.sample(x).level(t)),c.mul(i.sample(T).level(t)))),O=aSe(o.y).mul(O0(a.mul(i.sample(P).level(t)),c.mul(i.sample(R).level(t))));return M.add(O)},Wot=Yt(([i,e=Nt(3)])=>{const t=wn(i.size(Ps(e))),n=wn(i.size(Ps(e.add(1)))),r=Xf(1,t),s=Xf(1,n),o=uSe(i,Gr(r,t),i4(e)),a=uSe(i,Gr(s,n),Qre(e));return r3(e).mix(o,a)}),bT=new nh,YZ=new bs;let J1=class cE extends jr{static get type(){return"SceneNode"}constructor(e=cE.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,n=this.scene!==null?this.scene:e.scene;let r;return t===cE.BACKGROUND_BLURRINESS?r=ys("backgroundBlurriness","float",n):t===cE.BACKGROUND_INTENSITY?r=ys("backgroundIntensity","float",n):t===cE.BACKGROUND_ROTATION?r=Mr("mat4").label("backgroundRotation").setGroup(Tr).onRenderUpdate(()=>{const s=n.background;return s!==null&&s.isTexture&&s.mapping!==Are?(bT.copy(n.backgroundRotation),bT.x*=-1,bT.y*=-1,bT.z*=-1,YZ.makeRotationFromEuler(bT)):YZ.identity(),YZ}):console.error("THREE.SceneNode: Unknown scope:",t),r}};J1.BACKGROUND_BLURRINESS="backgroundBlurriness";J1.BACKGROUND_INTENSITY="backgroundIntensity";J1.BACKGROUND_ROTATION="backgroundRotation";const qot=xn(J1,J1.BACKGROUND_BLURRINESS),hSe=xn(J1,J1.BACKGROUND_INTENSITY),Xot=xn(J1,J1.BACKGROUND_ROTATION),Yot=Yt(({texture:i,uv:e})=>{const n=Bt().toVar();return Vo(e.x.lessThan(1e-4),()=>{n.assign(Bt(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{n.assign(Bt(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{n.assign(Bt(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{n.assign(Bt(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{n.assign(Bt(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{n.assign(Bt(0,0,-1))}).Else(()=>{const s=i.sample(e.add(Bt(-.01,0,0))).r.sub(i.sample(e.add(Bt(.01,0,0))).r),o=i.sample(e.add(Bt(0,-.01,0))).r.sub(i.sample(e.add(Bt(0,.01,0))).r),a=i.sample(e.add(Bt(0,0,-.01))).r.sub(i.sample(e.add(Bt(0,0,.01))).r);n.assign(Bt(s,o,a))}),n.normalize()});let Kot=class extends Mx{static get type(){return"Texture3DNode"}constructor(e,t=null,n=null){super(e,t,n),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return Bt(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(Ps(f_(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,"vec3")}normal(e){return Yot({texture:this,uv:e})}};const Zot=Zt(Kot).setParameterLength(1,3),FO=new si;let Qot=class extends Mx{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}},dSe=class extends Qot{static get type(){return"PassMultipleTextureNode"}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}},NPe=class IPe extends ua{static get type(){return"PassNode"}constructor(e,t,n,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const s=new jf;s.isRenderTargetTexture=!0,s.name="depth";const o=new I4(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:qu,...r});o.texture.name="output",o.depthTexture=s,this.renderTarget=o,this._textures={output:o.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Mr(0),this._cameraFar=Mr(0),this._mrt=null,this._layers=null,this._resolution=1,this.isPassNode=!0,this.updateBeforeType=li.FRAME,this.global=!0}setResolution(e){return this._resolution=e,this}getResolution(){return this._resolution}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const n=this._textures[e],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=en(new dSe(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=en(new dSe(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const n=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=_Pe(this.getTextureNode(e),n,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const n=this._cameraNear,r=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=UE(s,n,r)}return t}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,e.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.renderTarget.texture.type=e.getColorBufferType(),this.scope===IPe.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let r,s;const o=t.getOutputRenderTarget();o&&o.isXRRenderTarget===!0?(s=1,r=t.xr.getCamera(),t.xr.updateCamera(r),FO.set(o.width,o.height)):(r=this.camera,s=t.getPixelRatio(),t.getSize(FO)),this._pixelRatio=s,this.setSize(FO.width,FO.height);const a=t.getRenderTarget(),c=t.getMRT(),u=r.layers.mask;this._cameraNear.value=r.near,this._cameraFar.value=r.far,this._layers!==null&&(r.layers.mask=this._layers.mask);for(const f in this._previousTextures)this.toggleTexture(f);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(n,r),t.setRenderTarget(a),t.setMRT(c),r.layers.mask=u}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio*this._resolution,r=this._height*this._pixelRatio*this._resolution;this.renderTarget.setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}};NPe.COLOR="color";NPe.DEPTH="depth";const Jot=Yt(([i,e])=>i.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),eat=Yt(([i,e])=>(i=i.mul(e),i.div(i.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),tat=Yt(([i,e])=>{i=i.mul(e),i=i.sub(.004).max(0);const t=i.mul(i.mul(6.2).add(.5)),n=i.mul(i.mul(6.2).add(1.7)).add(.06);return t.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),nat=Yt(([i])=>{const e=i.mul(i.add(.0245786)).sub(90537e-9),t=i.mul(i.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),rat=Yt(([i,e])=>{const t=F0(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=F0(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return i=i.mul(e).div(.6),i=t.mul(i),i=nat(i),i=n.mul(i),i.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),iat=F0(Bt(1.6605,-.1246,-.0182),Bt(-.5876,1.1329,-.1006),Bt(-.0728,-.0083,1.1187)),sat=F0(Bt(.6274,.0691,.0164),Bt(.3293,.9195,.088),Bt(.0433,.0113,.8956)),oat=Yt(([i])=>{const e=Bt(i).toVar(),t=Bt(e.mul(e)).toVar(),n=Bt(t.mul(t)).toVar();return Nt(15.5).mul(n.mul(t)).sub(fi(40.14,n.mul(e))).add(fi(31.96,n).sub(fi(6.868,t.mul(e))).add(fi(.4298,t).add(fi(.1191,e).sub(.00232))))}),aat=Yt(([i,e])=>{const t=Bt(i).toVar(),n=F0(Bt(.856627153315983,.137318972929847,.11189821299995),Bt(.0951212405381588,.761241990602591,.0767994186031903),Bt(.0482516061458583,.101439036467562,.811302368396859)),r=F0(Bt(1.1271005818144368,-.1413297634984383,-.14132976349843826),Bt(-.11060664309660323,1.157823702216272,-.11060664309660294),Bt(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=Nt(-12.47393),o=Nt(4.026069);return t.mulAssign(e),t.assign(sat.mul(t)),t.assign(n.mul(t)),t.assign(Ql(t,1e-10)),t.assign(B1(t)),t.assign(t.sub(s).div(o.sub(s))),t.assign(Y1(t,0,1)),t.assign(oat(t)),t.assign(r.mul(t)),t.assign(tz(Ql(Bt(0),t),Bt(2.2))),t.assign(iat.mul(t)),t.assign(Y1(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),lat=Yt(([i,e])=>{const t=Nt(.76),n=Nt(.15);i=i.mul(e);const r=J_(i.r,J_(i.g,i.b)),s=Wl(r.lessThan(.08),r.sub(fi(6.25,r.mul(r))),.04);i.subAssign(s);const o=Ql(i.r,Ql(i.g,i.b));Vo(o.lessThan(t),()=>i);const a=C0(1,t),c=C0(1,a.mul(a).div(o.add(a.sub(t))));i.mulAssign(c.div(o));const u=C0(1,Xf(1,n.mul(o.sub(c)).add(1)));return Us(i,Bt(c),u)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});let Sa=class extends jr{static get type(){return"CodeNode"}constructor(e="",t=[],n=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=n}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const r of t)r.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}},cat=class extends Sa{static get type(){return"FunctionNode"}constructor(e="",t=[],n=""){super(e,t,n)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),r=n.name,s=n.type,o=e.getCodeFromNode(this,s);r!==""&&(o.name=r);const a=e.getPropertyName(o),c=this.getNodeFunction(e).getCode(a);return o.code=c+`
`,t==="property"?a:e.format(`${a}()`,s,t)}};function kPe(i){let e;const t=i.context.getViewZ;return t!==void 0&&(e=t(this)),(e||oa.z).negate()}const uat=Yt(([i,e],t)=>{const n=kPe(t);return q2(i,e,n)}),hat=Yt(([i],e)=>{const t=kPe(e);return i.mul(i,t,t).negate().exp().oneMinus()}),fSe=Yt(([i,e])=>Gr(e.toFloat().mix(BE.rgb,i.toVec3()),BE.a));let dat=class extends jr{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}};Zt(dat);let ep=class extends jr{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),n=t.parents,r=this.method,s=this.getNodeType(e),o=this.getInputType(e),a=this.pointerNode,c=this.valueNode,u=[];u.push(`&${a.build(e,o)}`),c!==null&&u.push(c.build(e,o));const f=`${e.getMethod(r,s)}( ${u.join(", ")} )`;if(n.length===1&&n[0].isStackNode===!0)e.addLineFlowCode(f,this);else return t.constNode===void 0&&(t.constNode=ex(f,s).toConst()),t.constNode.build(e)}};ep.ATOMIC_LOAD="atomicLoad";ep.ATOMIC_STORE="atomicStore";ep.ATOMIC_ADD="atomicAdd";ep.ATOMIC_SUB="atomicSub";ep.ATOMIC_MAX="atomicMax";ep.ATOMIC_MIN="atomicMin";ep.ATOMIC_AND="atomicAnd";ep.ATOMIC_OR="atomicOr";ep.ATOMIC_XOR="atomicXor";Zt(ep);let OO;function uz(i){OO=OO||new WeakMap;let e=OO.get(i);return e===void 0&&OO.set(i,e={}),e}function DPe(i){const e=uz(i);return e.shadowMatrix||(e.shadowMatrix=Mr("mat4").setGroup(Tr).onRenderUpdate(t=>((i.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&i.shadow.updateMatrices(i),i.shadow.matrix)))}function fat(i,e=FM){const t=DPe(i).mul(e);return t.xyz.div(t.w)}function FPe(i){const e=uz(i);return e.position||(e.position=Mr(new st).setGroup(Tr).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(i.matrixWorld)))}function pat(i){const e=uz(i);return e.targetPosition||(e.targetPosition=Mr(new st).setGroup(Tr).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(i.target.matrixWorld)))}function OPe(i){const e=uz(i);return e.viewPosition||(e.viewPosition=Mr(new st).setGroup(Tr).onRenderUpdate(({camera:t},n)=>{n.value=n.value||new st,n.value.setFromMatrixPosition(i.matrixWorld),n.value.applyMatrix4(t.matrixWorldInverse)}))}const BPe=i=>im.transformDirection(FPe(i).sub(pat(i))),mat=i=>i.sort((e,t)=>e.id-t.id),gat=(i,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===i)return t;return null},KZ=new WeakMap,ST=[];let LPe=class extends jr{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Bt().toVar(),this.totalSpecularNode=Bt().toVar(),this.outgoingLightNode=Bt().toVar(),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let n=0;n<e.length;n++){const r=e[n];if(ST.push(r.id),ST.push(r.castShadow?1:0),r.isSpotLight===!0){const s=r.map!==null?r.map.id:-1,o=r.colorNode?r.colorNode.getCacheKey():-1;ST.push(s,o)}}const t=Bre(ST);return ST.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const n of this._lightNodes)t.push(n.getSelf().getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const n of t.nodes)n.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,r=mat(this._lights),s=e.renderer.library;for(const o of r)if(o.isNode)t.push(en(o));else{let a=null;if(n!==null&&(a=gat(o.id,n)),a===null){const c=s.getLightNodeClass(o.constructor);if(c===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let u=null;KZ.has(o)?u=KZ.get(o):(u=en(new c(o)),KZ.set(o,u)),t.push(u)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:r,reflectedLight:s}=e.context;r.direct({...n,lightNode:t,reflectedLight:s},e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:r,reflectedLight:s}=e.context;r.directRectArea({...n,lightNode:t,reflectedLight:s},e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const r=e.context,s=r.lightingModel,o=e.getNodeProperties(this);if(s){const{totalDiffuseNode:a,totalSpecularNode:c}=this;r.outgoingLight=n;const u=e.addStack();o.nodes=u.nodes,s.start(e);const{backdrop:f,backdropAlpha:m}=r,{directDiffuse:v,directSpecular:x,indirectDiffuse:T,indirectSpecular:P}=r.reflectedLight;let R=v.add(T);f!==null&&(m!==null?R=Bt(m.mix(R,f)):R=Bt(f),r.material.transparent=!0),a.assign(R),c.assign(x.add(P)),n.assign(a.add(c)),s.finish(e),n=n.bypass(e.removeStack())}else o.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}},yat=class extends jr{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=li.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){UPe.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||FM)}};const UPe=ORe("vec3","shadowPositionWorld");function vat(i,e={}){return e.toneMapping=i.toneMapping,e.toneMappingExposure=i.toneMappingExposure,e.outputColorSpace=i.outputColorSpace,e.renderTarget=i.getRenderTarget(),e.activeCubeFace=i.getActiveCubeFace(),e.activeMipmapLevel=i.getActiveMipmapLevel(),e.renderObjectFunction=i.getRenderObjectFunction(),e.pixelRatio=i.getPixelRatio(),e.mrt=i.getMRT(),e.clearColor=i.getClearColor(e.clearColor||new zi),e.clearAlpha=i.getClearAlpha(),e.autoClear=i.autoClear,e.scissorTest=i.getScissorTest(),e}function _at(i,e){return e=vat(i,e),i.setMRT(null),i.setRenderObjectFunction(null),i.setClearColor(0,1),i.autoClear=!0,e}function xat(i,e){i.toneMapping=e.toneMapping,i.toneMappingExposure=e.toneMappingExposure,i.outputColorSpace=e.outputColorSpace,i.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),i.setRenderObjectFunction(e.renderObjectFunction),i.setPixelRatio(e.pixelRatio),i.setMRT(e.mrt),i.setClearColor(e.clearColor,e.clearAlpha),i.autoClear=e.autoClear,i.setScissorTest(e.scissorTest)}function bat(i,e={}){return e.background=i.background,e.backgroundNode=i.backgroundNode,e.overrideMaterial=i.overrideMaterial,e}function Sat(i,e){return e=bat(i,e),i.background=null,i.backgroundNode=null,i.overrideMaterial=null,e}function wat(i,e){i.background=e.background,i.backgroundNode=e.backgroundNode,i.overrideMaterial=e.overrideMaterial}function Tat(i,e,t){return t=_at(i,t),t=Sat(e,t),t}function Eat(i,e,t){xat(i,t),wat(e,t)}const pSe=new WeakMap,Mat=Yt(({depthTexture:i,shadowCoord:e,depthLayer:t})=>{let n=Ri(i,e.xy).label("t_basic");return i.isArrayTexture&&(n=n.depth(t)),n.compare(e.z)}),Cat=Yt(({depthTexture:i,shadowCoord:e,shadow:t,depthLayer:n})=>{const r=(R,M)=>{let O=Ri(i,R);return i.isArrayTexture&&(O=O.depth(n)),O.compare(M)},s=ys("mapSize","vec2",t).setGroup(Tr),o=ys("radius","float",t).setGroup(Tr),a=wn(1).div(s),c=a.x.negate().mul(o),u=a.y.negate().mul(o),f=a.x.mul(o),m=a.y.mul(o),v=c.div(2),x=u.div(2),T=f.div(2),P=m.div(2);return O0(r(e.xy.add(wn(c,u)),e.z),r(e.xy.add(wn(0,u)),e.z),r(e.xy.add(wn(f,u)),e.z),r(e.xy.add(wn(v,x)),e.z),r(e.xy.add(wn(0,x)),e.z),r(e.xy.add(wn(T,x)),e.z),r(e.xy.add(wn(c,0)),e.z),r(e.xy.add(wn(v,0)),e.z),r(e.xy,e.z),r(e.xy.add(wn(T,0)),e.z),r(e.xy.add(wn(f,0)),e.z),r(e.xy.add(wn(v,P)),e.z),r(e.xy.add(wn(0,P)),e.z),r(e.xy.add(wn(T,P)),e.z),r(e.xy.add(wn(c,m)),e.z),r(e.xy.add(wn(0,m)),e.z),r(e.xy.add(wn(f,m)),e.z)).mul(1/17)}),Aat=Yt(({depthTexture:i,shadowCoord:e,shadow:t,depthLayer:n})=>{const r=(m,v)=>{let x=Ri(i,m);return i.isArrayTexture&&(x=x.depth(n)),x.compare(v)},s=ys("mapSize","vec2",t).setGroup(Tr),o=wn(1).div(s),a=o.x,c=o.y,u=e.xy,f=r3(u.mul(s).add(.5));return u.subAssign(f.mul(o)),O0(r(u,e.z),r(u.add(wn(a,0)),e.z),r(u.add(wn(0,c)),e.z),r(u.add(o),e.z),Us(r(u.add(wn(a.negate(),0)),e.z),r(u.add(wn(a.mul(2),0)),e.z),f.x),Us(r(u.add(wn(a.negate(),c)),e.z),r(u.add(wn(a.mul(2),c)),e.z),f.x),Us(r(u.add(wn(0,c.negate())),e.z),r(u.add(wn(0,c.mul(2))),e.z),f.y),Us(r(u.add(wn(a,c.negate())),e.z),r(u.add(wn(a,c.mul(2))),e.z),f.y),Us(Us(r(u.add(wn(a.negate(),c.negate())),e.z),r(u.add(wn(a.mul(2),c.negate())),e.z),f.x),Us(r(u.add(wn(a.negate(),c.mul(2))),e.z),r(u.add(wn(a.mul(2),c.mul(2))),e.z),f.x),f.y)).mul(1/9)}),Rat=Yt(({depthTexture:i,shadowCoord:e,depthLayer:t})=>{const n=Nt(1).toVar();let r=Ri(i).sample(e.xy);i.isArrayTexture&&(r=r.depth(t)),r=r.rg;const s=KRe(e.z,r.x);return Vo(s.notEqual(Nt(1)),()=>{const o=e.z.sub(r.x),a=Ql(0,r.y.mul(r.y));let c=a.div(a.add(o.mul(o)));c=Y1(C0(c,.3).div(.95-.3)),n.assign(Y1(Ql(s,c)))}),n}),Pat=Yt(([i,e,t])=>{let n=FM.sub(i).length();return n=n.sub(e).div(t.sub(e)),n=n.saturate(),n}),Nat=i=>{const e=i.shadow.camera,t=ys("near","float",e).setGroup(Tr),n=ys("far","float",e).setGroup(Tr),r=Vit(i);return Pat(r,t,n)},Iat=i=>{let e=pSe.get(i);if(e===void 0){const t=i.isPointLight?Nat(i):null;e=new la,e.colorNode=Gr(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,pSe.set(i,e)}return e},mSe=new Ed,t6=[],kat=(i,e,t,n)=>{t6[0]=i,t6[1]=e;let r=mSe.get(t6);return(r===void 0||r.shadowType!==t||r.useVelocity!==n)&&(r=(s,o,a,c,u,f,...m)=>{(s.castShadow===!0||s.receiveShadow&&t===zB)&&(n&&(bRe(s).useVelocity=!0),s.onBeforeShadow(i,s,a,e.camera,c,o.overrideMaterial,f),i.renderObject(s,o,a,c,u,f,...m),s.onAfterShadow(i,s,a,e.camera,c,o.overrideMaterial,f))},r.shadowType=t,r.useVelocity=n,mSe.set(t6,r)),t6[0]=null,t6[1]=null,r},Dat=Yt(({samples:i,radius:e,size:t,shadowPass:n,depthLayer:r})=>{const s=Nt(0).toVar("meanVertical"),o=Nt(0).toVar("squareMeanVertical"),a=i.lessThanEqual(Nt(1)).select(Nt(0),Nt(2).div(i.sub(1))),c=i.lessThanEqual(Nt(1)).select(Nt(0),Nt(-1));gd({start:Ps(0),end:Ps(i),type:"int",condition:"<"},({i:f})=>{const m=c.add(Nt(f).mul(a));let v=n.sample(O0(az.xy,wn(0,m).mul(e)).div(t));n.value.isArrayTexture&&(v=v.depth(r)),v=v.x,s.addAssign(v),o.addAssign(v.mul(v))}),s.divAssign(i),o.divAssign(i);const u=Zre(o.sub(s.mul(s)));return wn(s,u)}),Fat=Yt(({samples:i,radius:e,size:t,shadowPass:n,depthLayer:r})=>{const s=Nt(0).toVar("meanHorizontal"),o=Nt(0).toVar("squareMeanHorizontal"),a=i.lessThanEqual(Nt(1)).select(Nt(0),Nt(2).div(i.sub(1))),c=i.lessThanEqual(Nt(1)).select(Nt(0),Nt(-1));gd({start:Ps(0),end:Ps(i),type:"int",condition:"<"},({i:f})=>{const m=c.add(Nt(f).mul(a));let v=n.sample(O0(az.xy,wn(m,0).mul(e)).div(t));n.value.isArrayTexture&&(v=v.depth(r)),s.addAssign(v.x),o.addAssign(O0(v.y.mul(v.y),v.x.mul(v.x)))}),s.divAssign(i),o.divAssign(i);const u=Zre(o.sub(s.mul(s)));return wn(s,u)}),Oat=[Mat,Cat,Aat,Rat];let ZZ;const BO=new fie;let zPe=class extends yat{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:r,shadow:s,depthLayer:o}){const a=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),c=t({depthTexture:n,shadowCoord:r,shadow:s,depthLayer:o});return a.select(c,Nt(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:r}=e,s=ys("bias","float",n).setGroup(Tr);let o=t,a;if(n.camera.isOrthographicCamera||r.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),a=o.z,r.coordinateSystem===W2&&(a=a.mul(2).sub(1));else{const c=o.w;o=o.xy.div(c);const u=ys("near","float",n.camera).setGroup(Tr),f=ys("far","float",n.camera).setGroup(Tr);a=xPe(c.negate(),u,f)}return o=Bt(o.x,o.y.oneMinus(),a.add(s)),o}getShadowFilterFn(e){return Oat[e]}setupRenderTarget(e,t){const n=new jf(e.mapSize.width,e.mapSize.height);n.name="ShadowDepthTexture",n.compareFunction=Ore;const r=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return r.texture.name="ShadowMap",r.texture.type=e.mapType,r.depthTexture=n,{shadowMap:r,depthTexture:n}}setupShadow(e){const{renderer:t}=e,{light:n,shadow:r}=this,s=t.shadowMap.type,{depthTexture:o,shadowMap:a}=this.setupRenderTarget(r,e);if(r.camera.updateProjectionMatrix(),s===zB&&r.isPointLightShadow!==!0){o.compareFunction=null,a.depth>1?(a._vsmShadowMapVertical||(a._vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Ky,type:qu,depth:a.depth,depthBuffer:!1}),a._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=a._vsmShadowMapVertical,a._vsmShadowMapHorizontal||(a._vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Ky,type:qu,depth:a.depth,depthBuffer:!1}),a._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=a._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Ky,type:qu,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Ky,type:qu,depthBuffer:!1}));let M=Ri(o);o.isArrayTexture&&(M=M.depth(this.depthLayer));let O=Ri(this.vsmShadowMapVertical.texture);o.isArrayTexture&&(O=O.depth(this.depthLayer));const C=ys("blurSamples","float",r).setGroup(Tr),L=ys("radius","float",r).setGroup(Tr),Y=ys("mapSize","vec2",r).setGroup(Tr);let J=this.vsmMaterialVertical||(this.vsmMaterialVertical=new la);J.fragmentNode=Dat({samples:C,radius:L,size:Y,shadowPass:M,depthLayer:this.depthLayer}).context(e.getSharedContext()),J.name="VSMVertical",J=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new la),J.fragmentNode=Fat({samples:C,radius:L,size:Y,shadowPass:O,depthLayer:this.depthLayer}).context(e.getSharedContext()),J.name="VSMHorizontal"}const c=ys("intensity","float",r).setGroup(Tr),u=ys("normalBias","float",r).setGroup(Tr),f=DPe(n).mul(UPe.add(cie.mul(u))),m=this.setupShadowCoord(e,f),v=r.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(v===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const x=s===zB&&r.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:o,T=this.setupShadowFilter(e,{filterFn:v,shadowTexture:a.texture,depthTexture:x,shadowCoord:m,shadow:r,depthLayer:this.depthLayer});let P=Ri(a.texture,m);o.isArrayTexture&&(P=P.depth(this.depthLayer));const R=Us(1,T.rgb.mix(P,1),c.mul(P.a)).toVar();return this.shadowMap=a,this.shadow.map=a,R}setup(e){if(e.renderer.shadowMap.enabled!==!1)return Yt(()=>{let t=this._node;return this.setupShadowPosition(e),t===null&&(this._node=t=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(t=e.material.receivedShadowNode(t)),t})()}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:s,scene:o}=e;t.updateMatrices(r),n.setSize(t.mapSize.width,t.mapSize.height,n.depth),s.render(o,t.camera)}updateShadow(e){const{shadowMap:t,light:n,shadow:r}=this,{renderer:s,scene:o,camera:a}=e,c=s.shadowMap.type,u=t.depthTexture.version;this._depthVersionCached=u;const f=r.camera.layers.mask;r.camera.layers.mask&4294967294||(r.camera.layers.mask=a.layers.mask);const m=s.getRenderObjectFunction(),v=s.getMRT(),x=v?v.has("velocity"):!1;ZZ=Tat(s,o,ZZ),o.overrideMaterial=Iat(n),s.setRenderObjectFunction(kat(s,r,c,x)),s.setClearColor(0,0),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(m),c===zB&&r.isPointLightShadow!==!0&&this.vsmPass(s),r.camera.layers.mask=f,Eat(s,o,ZZ)}vsmPass(e){const{shadow:t}=this,n=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,n),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,n),e.setRenderTarget(this.vsmShadowMapVertical),BO.material=this.vsmMaterialVertical,BO.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),BO.material=this.vsmMaterialHorizontal,BO.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}};const Bat=(i,e)=>en(new zPe(i,e)),Lat=new zi,Nf=Yt(([i,e])=>{const t=i.toVar(),n=$u(t),r=Xf(1,Ql(n.x,Ql(n.y,n.z)));n.mulAssign(r),t.mulAssign(r.mul(e.mul(2).oneMinus()));const s=wn(t.xy).toVar(),a=e.mul(1.5).oneMinus();return Vo(n.z.greaterThanEqual(a),()=>{Vo(t.z.greaterThan(0),()=>{s.x.assign(C0(4,t.x))})}).ElseIf(n.x.greaterThanEqual(a),()=>{const c=nU(t.x);s.x.assign(t.z.mul(c).add(c.mul(2)))}).ElseIf(n.y.greaterThanEqual(a),()=>{const c=nU(t.y);s.x.assign(t.x.add(c.mul(2)).add(2)),s.y.assign(t.z.mul(c).sub(2))}),wn(.125,.25).mul(s).add(wn(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),Uat=Yt(({depthTexture:i,bd3D:e,dp:t,texelSize:n})=>Ri(i,Nf(e,n.y)).compare(t)),zat=Yt(({depthTexture:i,bd3D:e,dp:t,texelSize:n,shadow:r})=>{const s=ys("radius","float",r).setGroup(Tr),o=wn(-1,1).mul(s).mul(n.y);return Ri(i,Nf(e.add(o.xyy),n.y)).compare(t).add(Ri(i,Nf(e.add(o.yyy),n.y)).compare(t)).add(Ri(i,Nf(e.add(o.xyx),n.y)).compare(t)).add(Ri(i,Nf(e.add(o.yyx),n.y)).compare(t)).add(Ri(i,Nf(e,n.y)).compare(t)).add(Ri(i,Nf(e.add(o.xxy),n.y)).compare(t)).add(Ri(i,Nf(e.add(o.yxy),n.y)).compare(t)).add(Ri(i,Nf(e.add(o.xxx),n.y)).compare(t)).add(Ri(i,Nf(e.add(o.yxx),n.y)).compare(t)).mul(1/9)}),Vat=Yt(({filterFn:i,depthTexture:e,shadowCoord:t,shadow:n})=>{const r=t.xyz.toVar(),s=r.length(),o=Mr("float").setGroup(Tr).onRenderUpdate(()=>n.camera.near),a=Mr("float").setGroup(Tr).onRenderUpdate(()=>n.camera.far),c=ys("bias","float",n).setGroup(Tr),u=Mr(n.mapSize).setGroup(Tr),f=Nt(1).toVar();return Vo(s.sub(a).lessThanEqual(0).and(s.sub(o).greaterThanEqual(0)),()=>{const m=s.sub(o).div(a.sub(o)).toVar();m.addAssign(c);const v=r.normalize(),x=wn(1).div(u.mul(wn(4,2)));f.assign(i({depthTexture:e,bd3D:v,dp:m,texelSize:x,shadow:n}))}),f}),gSe=new _i,n6=new si,wT=new si;let Gat=class extends zPe{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===ket?Uat:zat}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:n,depthTexture:r,shadowCoord:s,shadow:o}){return Vat({filterFn:t,shadowTexture:n,depthTexture:r,shadowCoord:s,shadow:o})}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:s,scene:o}=e,a=t.getFrameExtents();wT.copy(t.mapSize),wT.multiply(a),n.setSize(wT.width,wT.height),n6.copy(t.mapSize);const c=s.autoClear,u=s.getClearColor(Lat),f=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha),s.clear();const m=t.getViewportCount();for(let v=0;v<m;v++){const x=t.getViewport(v),T=n6.x*x.x,P=wT.y-n6.y-n6.y*x.y;gSe.set(T,P,n6.x*x.z,n6.y*x.w),n.viewport.copy(gSe),t.updateMatrices(r,v),s.render(o,t.camera)}s.autoClear=c,s.setClearColor(u,f)}};const $at=(i,e)=>en(new Gat(i,e));let k4=class extends Cx{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new zi,this.colorNode=e&&e.colorNode||Mr(this.color).setGroup(Tr),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=li.FRAME}getHash(){return this.light.uuid}getLightVector(e){return OPe(this.light).sub(e.context.positionView||oa)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return Bat(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const r=this.light.shadow.shadowNode;let s;r!==void 0?s=en(r):s=this.setupShadowNode(),this.shadowNode=s,this.shadowColorNode=n=this.colorNode.mul(s),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}};const VPe=Yt(({lightDistance:i,cutoffDistance:e,decayExponent:t})=>{const n=i.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(n.mul(i.div(e).pow4().oneMinus().clamp().pow2()),n)}),Hat=({color:i,lightVector:e,cutoffDistance:t,decayExponent:n})=>{const r=e.normalize(),s=e.length(),o=VPe({lightDistance:s,cutoffDistance:t,decayExponent:n}),a=i.mul(o);return{lightDirection:r,lightColor:a}};let jat=class extends k4{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Mr(0).setGroup(Tr),this.decayExponentNode=Mr(2).setGroup(Tr)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return $at(this.light)}setupDirect(e){return Hat({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}};const ySe=Nt(1),xte=Nt(-2),LO=Nt(.8),QZ=Nt(-1),UO=Nt(.4),JZ=Nt(2),zO=Nt(.305),eQ=Nt(3),vSe=Nt(.21),Wat=Nt(4),_Se=Nt(4),qat=Nt(16),Xat=Yt(([i])=>{const e=Bt($u(i)).toVar(),t=Nt(-1).toVar();return Vo(e.x.greaterThan(e.z),()=>{Vo(e.x.greaterThan(e.y),()=>{t.assign(Wl(i.x.greaterThan(0),0,3))}).Else(()=>{t.assign(Wl(i.y.greaterThan(0),1,4))})}).Else(()=>{Vo(e.z.greaterThan(e.y),()=>{t.assign(Wl(i.z.greaterThan(0),2,5))}).Else(()=>{t.assign(Wl(i.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),Yat=Yt(([i,e])=>{const t=wn().toVar();return Vo(e.equal(0),()=>{t.assign(wn(i.z,i.y).div($u(i.x)))}).ElseIf(e.equal(1),()=>{t.assign(wn(i.x.negate(),i.z.negate()).div($u(i.y)))}).ElseIf(e.equal(2),()=>{t.assign(wn(i.x.negate(),i.y).div($u(i.z)))}).ElseIf(e.equal(3),()=>{t.assign(wn(i.z.negate(),i.y).div($u(i.x)))}).ElseIf(e.equal(4),()=>{t.assign(wn(i.x.negate(),i.z).div($u(i.y)))}).Else(()=>{t.assign(wn(i.x,i.y).div($u(i.z)))}),fi(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),Kat=Yt(([i])=>{const e=Nt(0).toVar();return Vo(i.greaterThanEqual(LO),()=>{e.assign(ySe.sub(i).mul(QZ.sub(xte)).div(ySe.sub(LO)).add(xte))}).ElseIf(i.greaterThanEqual(UO),()=>{e.assign(LO.sub(i).mul(JZ.sub(QZ)).div(LO.sub(UO)).add(QZ))}).ElseIf(i.greaterThanEqual(zO),()=>{e.assign(UO.sub(i).mul(eQ.sub(JZ)).div(UO.sub(zO)).add(JZ))}).ElseIf(i.greaterThanEqual(vSe),()=>{e.assign(zO.sub(i).mul(Wat.sub(eQ)).div(zO.sub(vSe)).add(eQ))}).Else(()=>{e.assign(Nt(-2).mul(B1(fi(1.16,i))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),Zat=Yt(([i,e])=>{const t=i.toVar();t.assign(fi(2,t).sub(1));const n=Bt(t,1).toVar();return Vo(e.equal(0),()=>{n.assign(n.zyx)}).ElseIf(e.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),Qat=Yt(([i,e,t,n,r,s])=>{const o=Nt(t),a=Bt(e),c=Y1(Kat(o),xte,s),u=r3(c),f=i4(c),m=Bt(bte(i,a,f,n,r,s)).toVar();return Vo(u.notEqual(0),()=>{const v=Bt(bte(i,a,f.add(1),n,r,s)).toVar();m.assign(Us(m,v,u))}),m}),bte=Yt(([i,e,t,n,r,s])=>{const o=Nt(t).toVar(),a=Bt(e),c=Nt(Xat(a)).toVar(),u=Nt(Ql(_Se.sub(o),0)).toVar();o.assign(Ql(o,_Se));const f=Nt(kM(o)).toVar(),m=wn(Yat(a,c).mul(f.sub(2)).add(1)).toVar();return Vo(c.greaterThan(2),()=>{m.y.addAssign(f),c.subAssign(3)}),m.x.addAssign(c.mul(f)),m.x.addAssign(u.mul(fi(3,qat))),m.y.addAssign(fi(4,kM(s).sub(f))),m.x.mulAssign(n),m.y.mulAssign(r),i.sample(m).grad(wn(),wn())}),tQ=Yt(({envMap:i,mipInt:e,outputDirection:t,theta:n,axis:r,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const c=f2(n),u=t.mul(c).add(r.cross(t).mul(fd(n))).add(r.mul(r.dot(t).mul(c.oneMinus())));return bte(i,u,e,s,o,a)}),Jat=Yt(({n:i,latitudinal:e,poleAxis:t,outputDirection:n,weights:r,samples:s,dTheta:o,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:m})=>{const v=Bt(Wl(e,t,ZRe(t,n))).toVar();Vo(v.equal(Bt(0)),()=>{v.assign(Bt(n.z,0,n.x.negate()))}),v.assign(DM(v));const x=Bt().toVar();return x.addAssign(r.element(0).mul(tQ({theta:0,axis:v,outputDirection:n,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:m}))),gd({start:Ps(1),end:i},({i:T})=>{Vo(T.greaterThanEqual(s),()=>{Uit()});const P=Nt(o.mul(Nt(T))).toVar();x.addAssign(r.element(T).mul(tQ({theta:P.mul(-1),axis:v,outputDirection:n,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:m}))),x.addAssign(r.element(T).mul(tQ({theta:P,axis:v,outputDirection:n,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:m})))}),Gr(x,1)}),e2=new st,xSe=new si,bSe=new si;class qc extends Ure{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=X_*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(kE*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return X_*2*Math.atan(Math.tan(kE*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){e2.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(e2.x,e2.y).multiplyScalar(-e/e2.z),e2.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(e2.x,e2.y).multiplyScalar(-e/e2.z)}getViewSize(e,t){return this.getViewBounds(e,xSe,bSe),t.subVectors(bSe,xSe)}setViewOffset(e,t,n,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(kE*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,u=o.fullHeight;s+=o.offsetX*r/c,t-=o.offsetY*n/u,r*=o.width/c,n*=o.height/u}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class pC extends sm{constructor(e=1,t=1,n=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const c=[],u=[],f=[],m=[];let v=0,x=0;T("z","y","x",-1,-1,n,t,e,o,s,0),T("z","y","x",1,-1,n,t,-e,o,s,1),T("x","z","y",1,1,e,n,t,r,o,2),T("x","z","y",1,-1,e,n,-t,r,o,3),T("x","y","z",1,-1,e,t,n,r,s,4),T("x","y","z",-1,-1,e,t,-n,r,s,5),this.setIndex(c),this.setAttribute("position",new k0(u,3)),this.setAttribute("normal",new k0(f,3)),this.setAttribute("uv",new k0(m,2));function T(P,R,M,O,C,L,Y,J,z,ne,K){const $=L/z,he=Y/ne,Ce=L/2,Pe=Y/2,je=J/2,ge=z+1,Xe=ne+1;let Fe=0,Ne=0;const tt=new st;for(let mt=0;mt<Xe;mt++){const Ht=mt*he-Pe;for(let pn=0;pn<ge;pn++){const In=pn*$-Ce;tt[P]=In*O,tt[R]=Ht*C,tt[M]=je,u.push(tt.x,tt.y,tt.z),tt[P]=0,tt[R]=0,tt[M]=J>0?1:-1,f.push(tt.x,tt.y,tt.z),m.push(pn/z),m.push(1-mt/ne),Fe+=1}}for(let mt=0;mt<ne;mt++)for(let Ht=0;Ht<z;Ht++){const pn=v+Ht+ge*mt,In=v+Ht+ge*(mt+1),vt=v+(Ht+1)+ge*(mt+1),Ut=v+(Ht+1)+ge*mt;c.push(pn,In,Ut),c.push(In,vt,Ut),Ne+=6}a.addGroup(x,Ne,K),x+=Ne,v+=Fe}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new pC(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}const $6=4,SSe=[.125,.215,.35,.446,.526,.582],By=20,nQ=new die(-1,1,1,-1,0,1),elt=new qc(90,1),wSe=new zi;let rQ=null,iQ=0,sQ=0;const Ry=(1+Math.sqrt(5))/2,r6=1/Ry,TSe=[new st(-Ry,r6,0),new st(Ry,r6,0),new st(-r6,0,Ry),new st(r6,0,Ry),new st(0,Ry,-r6),new st(0,Ry,r6),new st(-1,1,-1),new st(1,1,-1),new st(-1,1,1),new st(1,1,1)],tlt=new st,GPe=new WeakMap,nlt=[3,1,5,0,4,2],oQ=Zat(fC(),X2("faceIndex")).normalize(),pie=Bt(oQ.x,oQ.y,oQ.z);let rlt=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,n=.1,r=100,s={}){const{size:o=256,position:a=tlt,renderTarget:c=null}=s;if(this._setSize(o),this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const f=c||this._allocateTarget();return s.renderTarget=f,this.fromSceneAsync(e,t,n,r,s),f}rQ=this._renderer.getRenderTarget(),iQ=this._renderer.getActiveCubeFace(),sQ=this._renderer.getActiveMipmapLevel();const u=c||this._allocateTarget();return u.depthBuffer=!0,this._init(u),this._sceneToCubeUV(e,n,r,u,a),t>0&&this._blur(u,0,0,t),this._applyPMREM(u),this._cleanup(u),u}async fromSceneAsync(e,t=0,n=.1,r=100,s={}){return this._hasInitialized===!1&&await this._renderer.init(),this.fromScene(e,t,n,r,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=MSe(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=CSe(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===PM||e.mapping===jL?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(rQ,iQ,sQ),e.scissorTest=!1,VO(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),rQ=this._renderer.getRenderTarget(),iQ=this._renderer.getActiveCubeFace(),sQ=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTarget();return this._init(n),this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return ESe(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=ESe(e.width,e.height);const{_lodMax:t}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=ilt(t)),this._blurMaterial=slt(t,e.width,e.height)}}async _compileMaterial(e){const t=new Q1(this._lodPlanes[0],e);await this._renderer.compile(t,nQ)}_sceneToCubeUV(e,t,n,r,s){const o=elt;o.near=t,o.far=n;const a=[1,1,1,1,-1,1],c=[1,-1,1,-1,1,-1],u=this._renderer,f=u.autoClear;u.getClearColor(wSe),u.autoClear=!1;let m=this._backgroundBox;if(m===null){const T=new x2({name:"PMREM.Background",side:gc,depthWrite:!1,depthTest:!1});m=new Q1(new pC,T)}let v=!1;const x=e.background;x?x.isColor&&(m.material.color.copy(x),e.background=null,v=!0):(m.material.color.copy(wSe),v=!0),u.setRenderTarget(r),u.clear(),v&&u.render(m,o);for(let T=0;T<6;T++){const P=T%3;P===0?(o.up.set(0,a[T],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x+c[T],s.y,s.z)):P===1?(o.up.set(0,0,a[T]),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y+c[T],s.z)):(o.up.set(0,a[T],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y,s.z+c[T]));const R=this._cubeSize;VO(r,P*R,T>2?R:0,R,R),u.render(e,o)}u.autoClear=f,e.background=x}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===PM||e.mapping===jL;r?this._cubemapMaterial===null&&(this._cubemapMaterial=MSe(e)):this._equirectMaterial===null&&(this._equirectMaterial=CSe(e));const s=r?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=s;const a=this._cubeSize;VO(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(o,nQ)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=TSe[(r-s-1)%TSe.length];this._blur(e,s-1,s,o,a)}t.autoClear=n}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,a){const c=this._renderer,u=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const f=3,m=this._lodMeshes[r];m.material=u;const v=GPe.get(u),x=this._sizeLods[n]-1,T=isFinite(s)?Math.PI/(2*x):2*Math.PI/(2*By-1),P=s/T,R=isFinite(s)?1+Math.floor(f*P):By;R>By&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${R} samples when the maximum is set to ${By}`);const M=[];let O=0;for(let z=0;z<By;++z){const ne=z/P,K=Math.exp(-ne*ne/2);M.push(K),z===0?O+=K:z<R&&(O+=2*K)}for(let z=0;z<M.length;z++)M[z]=M[z]/O;e.texture.frame=(e.texture.frame||0)+1,v.envMap.value=e.texture,v.samples.value=R,v.weights.array=M,v.latitudinal.value=o==="latitudinal"?1:0,a&&(v.poleAxis.value=a);const{_lodMax:C}=this;v.dTheta.value=T,v.mipInt.value=C-n;const L=this._sizeLods[r],Y=3*L*(r>C-$6?r-C+$6:0),J=4*(this._cubeSize-L);VO(t,Y,J,3*L,2*L),c.setRenderTarget(t),c.render(m,nQ)}};function ilt(i){const e=[],t=[],n=[],r=[];let s=i;const o=i-$6+1+SSe.length;for(let a=0;a<o;a++){const c=Math.pow(2,s);t.push(c);let u=1/c;a>i-$6?u=SSe[a-i+$6-1]:a===0&&(u=0),n.push(u);const f=1/(c-2),m=-f,v=1+f,x=[m,m,v,m,v,v,m,m,v,v,m,v],T=6,P=6,R=3,M=2,O=1,C=new Float32Array(R*P*T),L=new Float32Array(M*P*T),Y=new Float32Array(O*P*T);for(let z=0;z<T;z++){const ne=z%3*2/3-1,K=z>2?0:-1,$=[ne,K,0,ne+2/3,K,0,ne+2/3,K+1,0,ne,K,0,ne+2/3,K+1,0,ne,K+1,0],he=nlt[z];C.set($,R*P*he),L.set(x,M*P*he);const Ce=[he,he,he,he,he,he];Y.set(Ce,O*P*he)}const J=new sm;J.setAttribute("position",new Qu(C,R)),J.setAttribute("uv",new Qu(L,M)),J.setAttribute("faceIndex",new Qu(Y,O)),e.push(J),r.push(new Q1(J,null)),s>$6&&s--}return{lodPlanes:e,sizeLods:t,sigmas:n,lodMeshes:r}}function ESe(i,e){const t={magFilter:nu,minFilter:nu,generateMipmaps:!1,type:qu,format:Xu,colorSpace:a_},n=new I4(i,e,t);return n.texture.mapping=jee,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function VO(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function mie(i){const e=new la;return e.depthTest=!1,e.depthWrite=!1,e.blending=Y_,e.name=`PMREM_${i}`,e}function slt(i,e,t){const n=Uf(new Array(By).fill(0)),r=Mr(new st(0,1,0)),s=Mr(0),o=Nt(By),a=Mr(0),c=Mr(1),u=Ri(null),f=Mr(0),m=Nt(1/e),v=Nt(1/t),x=Nt(i),T={n:o,latitudinal:a,weights:n,poleAxis:r,outputDirection:pie,dTheta:s,samples:c,envMap:u,mipInt:f,CUBEUV_TEXEL_WIDTH:m,CUBEUV_TEXEL_HEIGHT:v,CUBEUV_MAX_MIP:x},P=mie("blur");return P.fragmentNode=Jat({...T,latitudinal:a.equal(1)}),GPe.set(P,T),P}function MSe(i){const e=mie("cubemap");return e.fragmentNode=OM(i,pie),e}function CSe(i){const e=mie("equirect");return e.fragmentNode=Ri(i,dPe(pie),0),e}const olt=rlt,ASe=new WeakMap;function alt(i){const e=Math.log2(i)-2,t=1/i;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function llt(i,e,t){const n=clt(e);let r=n.get(i);if((r!==void 0?r.pmremVersion:-1)!==i.pmremVersion){const o=i.image;if(i.isCubeTexture)if(hlt(o))r=t.fromCubemap(i,r);else return null;else if(dlt(o))r=t.fromEquirectangular(i,r);else return null;r.pmremVersion=i.pmremVersion,n.set(i,r)}return r.texture}function clt(i){let e=ASe.get(i);return e===void 0&&(e=new WeakMap,ASe.set(i,e)),e}let ult=class extends ua{static get type(){return"PMREMNode"}constructor(e,t=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const r=new Kl;r.isRenderTargetTexture=!0,this._texture=Ri(r),this._width=Mr(0),this._height=Mr(0),this._maxMip=Mr(0),this.updateBeforeType=li.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=alt(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,r=this._value;n!==r.pmremVersion&&(r.isPMREMTexture===!0?t=r:t=llt(r,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new olt(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this)),t=wPe.mul(Bt(t.x,t.y.negate(),t.z));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),Qat(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}};function hlt(i){if(i==null)return!1;let e=0;const t=6;for(let n=0;n<t;n++)i[n]!==void 0&&e++;return e===t}function dlt(i){return i==null?!1:i.height>0}const $Pe=Zt(ult).setParameterLength(1,3);Yt(([i=fC()],{renderer:e,material:t})=>{const n=JRe(i.mul(2).sub(1));let r;if(t.alphaToCoverage&&e.samples>1){const s=Nt(n.fwidth()).toVar();r=q2(s.oneMinus(),s.add(1),n).oneMinus()}else r=Wl(n.greaterThan(1),0,1);return r});const BM=Yt(({f0:i,f90:e,dotVH:t})=>{const n=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return i.mul(n.oneMinus()).add(e.mul(n))}),flt=Yt(({alpha:i,dotNL:e,dotNV:t})=>{const n=i.pow2(),r=e.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt());return Xf(.5,r.add(s).max(Ert))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),plt=Yt(({alphaT:i,alphaB:e,dotTV:t,dotBV:n,dotTL:r,dotBL:s,dotNV:o,dotNL:a})=>{const c=a.mul(Bt(i.mul(t),e.mul(n),o).length()),u=o.mul(Bt(i.mul(r),e.mul(s),a).length());return Xf(.5,c.add(u)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),mlt=Yt(({alpha:i,dotNH:e})=>{const t=i.pow2(),n=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),glt=Nt(1/Math.PI),ylt=Yt(({alphaT:i,alphaB:e,dotNH:t,dotTH:n,dotBH:r})=>{const s=i.mul(e),o=Bt(e.mul(n),i.mul(r),s.mul(t)),a=o.dot(o),c=s.div(a);return glt.mul(s.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),RSe=Yt(i=>{const{lightDirection:e,f0:t,f90:n,roughness:r,f:s,USE_IRIDESCENCE:o,USE_ANISOTROPY:a}=i,c=i.normalView||ra,u=r.pow2(),f=e.add(ho).normalize(),m=c.dot(e).clamp(),v=c.dot(ho).clamp(),x=c.dot(f).clamp(),T=ho.dot(f).clamp();let P=BM({f0:t,f90:n,dotVH:T}),R,M;if(Bbe(o)&&(P=Kre.mix(P,s)),Bbe(a)){const O=HB.dot(e),C=HB.dot(ho),L=HB.dot(f),Y=h_.dot(e),J=h_.dot(ho),z=h_.dot(f);R=plt({alphaT:fte,alphaB:u,dotTV:C,dotBV:J,dotTL:O,dotBL:Y,dotNV:v,dotNL:m}),M=ylt({alphaT:fte,alphaB:u,dotNH:x,dotTH:L,dotBH:z})}else R=flt({alpha:u,dotNL:m,dotNV:v}),M=mlt({alpha:u,dotNH:x});return P.mul(R).mul(M)}),tx=Yt(i=>i.diffuseColor.mul(1/Math.PI)),HPe=Yt(({roughness:i,dotNV:e})=>{const t=Gr(-1,-.0275,-.572,.022),n=Gr(1,.0425,1.04,-.04),r=i.mul(t).add(n),s=r.x.mul(r.x).min(e.mul(-9.28).exp2()).mul(r.x).add(r.y);return wn(-1.04,1.04).mul(s).add(r.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),vlt=Yt(({f:i,f90:e,dotVH:t})=>{const n=t.oneMinus().saturate(),r=n.mul(n),s=n.mul(r,r).clamp(0,.9999);return i.sub(Bt(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),_lt=Yt(i=>{if(i.geometry.hasAttribute("normal")===!1)return Nt(0);const e=Kf.dFdx().abs().max(Kf.dFdy().abs());return e.x.max(e.y).max(e.z)}),jPe=Yt(i=>{const{roughness:e}=i,t=_lt();let n=e.max(.0525);return n=n.add(t),n=n.min(1),n}),xlt=Yt(([i,e])=>{const t=i.x,n=i.y,r=i.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(n)),s=s.add(e.element(2).mul(2*.511664).mul(r)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(n)),s=s.add(e.element(5).mul(2*.429043).mul(n).mul(r)),s=s.add(e.element(6).mul(r.mul(r).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(r)),s=s.add(e.element(8).mul(.429043).mul(fi(t,t).sub(fi(n,n)))),s});class gie extends sm{constructor(e=1,t=32,n=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const c=Math.min(o+a,Math.PI);let u=0;const f=[],m=new st,v=new st,x=[],T=[],P=[],R=[];for(let M=0;M<=n;M++){const O=[],C=M/n;let L=0;M===0&&o===0?L=.5/t:M===n&&c===Math.PI&&(L=-.5/t);for(let Y=0;Y<=t;Y++){const J=Y/t;m.x=-e*Math.cos(r+J*s)*Math.sin(o+C*a),m.y=e*Math.cos(o+C*a),m.z=e*Math.sin(r+J*s)*Math.sin(o+C*a),T.push(m.x,m.y,m.z),v.copy(m).normalize(),P.push(v.x,v.y,v.z),R.push(J+L,1-C),O.push(u++)}f.push(O)}for(let M=0;M<n;M++)for(let O=0;O<t;O++){const C=f[M][O+1],L=f[M][O],Y=f[M+1][O],J=f[M+1][O+1];(M!==0||o>0)&&x.push(C,L,J),(M!==n-1||c<Math.PI)&&x.push(L,Y,J)}this.setIndex(x),this.setAttribute("position",new k0(T,3)),this.setAttribute("normal",new k0(P,3)),this.setAttribute("uv",new k0(R,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gie(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}const Jh=new Vre;let blt=class extends n3{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const r=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(s===null)r._clearColor.getRGB(Jh),Jh.a=r._clearColor.a;else if(s.isColor===!0)s.getRGB(Jh),Jh.a=1,o=!0;else if(s.isNode===!0){const u=this.get(e),f=s;Jh.copy(r._clearColor);let m=u.backgroundMesh;if(m===void 0){let R=function(){s.removeEventListener("dispose",R),m.material.dispose(),m.geometry.dispose()};var c=R;const x=eie(Gr(f).mul(hSe),{getUV:()=>Xot.mul(lie),getTextureLevel:()=>qot});let T=APe;T=T.setZ(T.w);const P=new la;P.name="Background.material",P.side=gc,P.depthTest=!1,P.depthWrite=!1,P.allowOverride=!1,P.fog=!1,P.lights=!1,P.vertexNode=T,P.colorNode=x,u.backgroundMeshNode=x,u.backgroundMesh=m=new Q1(new gie(1,32,32),P),m.frustumCulled=!1,m.name="Background.mesh",m.onBeforeRender=function(M,O,C){this.matrixWorld.copyPosition(C.matrixWorld)},s.addEventListener("dispose",R)}const v=f.getCacheKey();u.backgroundCacheKey!==v&&(u.backgroundMeshNode.node=Gr(f).mul(hSe),u.backgroundMeshNode.needsUpdate=!0,m.material.needsUpdate=!0,u.backgroundCacheKey=v),t.unshift(m,m.geometry,m.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",s);const a=r.xr.getEnvironmentBlendMode();if(a==="additive"?Jh.set(0,0,0,1):a==="alpha-blend"&&Jh.set(0,0,0,0),r.autoClear===!0||o===!0){const u=n.clearColorValue;u.r=Jh.r,u.g=Jh.g,u.b=Jh.b,u.a=Jh.a,(r.backend.isWebGLBackend===!0||r.alpha===!0)&&(u.r*=u.a,u.g*=u.a,u.b*=u.a),n.depthClearValue=r._clearDepth,n.stencilClearValue=r._clearStencil,n.clearColor=r.autoClearColor===!0,n.clearDepth=r.autoClearDepth===!0,n.clearStencil=r.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}};const Slt=blt;let wlt=0,Tlt=class{constructor(e="",t=[],n=0,r=[]){this.name=e,this.bindings=t,this.index=n,this.bindingsReference=r,this.id=wlt++}};const Ste=Tlt;let Elt=class{constructor(e,t,n,r,s,o,a,c,u,f=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=f,this.nodeAttributes=r,this.bindings=s,this.updateNodes=o,this.updateBeforeNodes=a,this.updateAfterNodes=c,this.observer=u,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const r=new Ste(t.name,[],t.index,t);e.push(r);for(const s of t.bindings)r.bindings.push(s.clone())}else e.push(t);return e}};const Mlt=Elt;function WPe(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const r=i[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function Clt(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}const Alt=`
void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
`,Rlt=`
void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}
`;class Plt extends vc{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Alt,this.fragmentShader=Rlt,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=WPe(e.uniforms),this.uniformsGroups=Clt(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Nlt extends I4{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}const i6=-90,s6=1;class qPe extends Pa{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new qc(i6,s6,e,t);r.layers=this.layers,this.add(r);const s=new qc(i6,s6,e,t);s.layers=this.layers,this.add(s);const o=new qc(i6,s6,e,t);o.layers=this.layers,this.add(o);const a=new qc(i6,s6,e,t);a.layers=this.layers,this.add(a);const c=new qc(i6,s6,e,t);c.layers=this.layers,this.add(c);const u=new qc(i6,s6,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,s,o,a,c]=t;for(const u of t)this.remove(u);if(e===ac)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===W2)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,u,f]=this.children,m=e.getRenderTarget(),v=e.getActiveCubeFace(),x=e.getActiveMipmapLevel(),T=e.xr.enabled;e.xr.enabled=!1;const P=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,s),e.setRenderTarget(n,1,r),e.render(t,o),e.setRenderTarget(n,2,r),e.render(t,a),e.setRenderTarget(n,3,r),e.render(t,c),e.setRenderTarget(n,4,r),e.render(t,u),n.texture.generateMipmaps=P,e.setRenderTarget(n,5,r),e.render(t,f),e.setRenderTarget(m,v,x),e.xr.enabled=T,n.texture.needsPMREMUpdate=!0}}class Ilt extends Nlt{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new lz(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new pC(5,5,5),s=new Plt({name:"CubemapFromEquirect",uniforms:WPe(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:gc,blending:Y_});s.uniforms.tEquirect.value=t;const o=new Q1(r,s),a=t.minFilter;return t.minFilter===D1&&(t.minFilter=nu),new qPe(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,n=!0,r=!0){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(s)}}let klt=class extends Ilt{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new pC(5,5,5),o=dPe(hPe),a=new la;a.colorNode=Ri(t,o,0),a.side=gc,a.blending=Y_;const c=new Q1(s,a),u=new Lre;u.add(c),t.minFilter===D1&&(t.minFilter=nu);const f=new qPe(1,10,this),m=e.getMRT();return e.setMRT(null),f.update(e,u),e.setMRT(m),t.minFilter=n,t.currentGenerateMipmaps=r,c.geometry.dispose(),c.material.dispose(),this}};const XPe=klt,zE=new WeakMap;let Dlt=class extends ua{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=OM(null);const t=new lz;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=li.RENDER}updateBefore(e){const{renderer:t,material:n}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const s=r.isTextureNode?r.value:n[r.property];if(s&&s.isTexture){const o=s.mapping;if(o===Rre||o===Pre){if(zE.has(s)){const a=zE.get(s);PSe(a,s.mapping),this._cubeTexture=a}else{const a=s.image;if(Flt(a)){const c=new XPe(a.height);c.fromEquirectangularTexture(t,s),PSe(c.texture,s.mapping),this._cubeTexture=c.texture,zE.set(s,c.texture),s.addEventListener("dispose",YPe)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}};function Flt(i){return i==null?!1:i.height>0}function YPe(i){const e=i.target;e.removeEventListener("dispose",YPe);const t=zE.get(e);t!==void 0&&(zE.delete(e),t.dispose())}function PSe(i,e){e===Rre?i.mapping=PM:e===Pre&&(i.mapping=jL)}const KPe=Zt(Dlt).setParameterLength(1);let hz=class{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}},NSe=class{constructor(e,t,n=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}},Olt=class{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}},ZPe=class{constructor(e,t,n=!1,r=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=r}},Blt=class extends ZPe{constructor(e,t,n=null,r=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=n,this.interpolationSampling=r}},Llt=class{constructor(e,t,n=""){this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}},Ult=0,aQ=class{constructor(e=null){this.id=Ult++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}},zlt=class{constructor(e,t){this.name=e,this.members=t,this.output=!1}},i3=class{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}},Vlt=class extends i3{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}},Glt=class extends i3{constructor(e,t=new si){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}},$lt=class extends i3{constructor(e,t=new st){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}},Hlt=class extends i3{constructor(e,t=new _i){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}},jlt=class extends i3{constructor(e,t=new zi){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}},Wlt=class extends i3{constructor(e,t=new KU){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}},qlt=class extends i3{constructor(e,t=new _c){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}},Xlt=class extends i3{constructor(e,t=new bs){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}},Ylt=class extends Vlt{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},Klt=class extends Glt{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},Zlt=class extends $lt{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},Qlt=class extends Hlt{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},Jlt=class extends jlt{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},e0t=class extends Wlt{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},t0t=class extends qlt{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},n0t=class extends Xlt{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}};const ISe=new WeakMap,r0t=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),GO=i=>/e/g.test(i)?String(i).replace(/\+/g,""):(i=Number(i),i+(i%1?"":".0"));let QPe=class{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=CZ(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new aQ,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null}getBindGroupsCache(){let e=ISe.get(this.renderer);return e===void 0&&(e=new Ed,ISe.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new I4(e,t,n)}createCubeRenderTarget(e,t){return new XPe(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=this.getBindGroupsCache(),r=[];let s=!0;for(const a of t)r.push(a),s=s&&a.groupNode.shared!==!0;let o;return s?(o=n.get(r),o===void 0&&(o=new Ste(e,r,this.bindingsIndexes[e].group,r),n.set(r,o))):o=new Ste(e,r,this.bindingsIndexes[e].group,r),o}getBindGroupArray(e,t){const n=this.bindings[t];let r=n[e];return r===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(e===null){const t={},n=this.bindings;for(const r of Nbe)for(const s in n[r]){const o=n[r][s];(t[s]||(t[s]=[])).push(...o)}e=[];for(const r in t){const s=t[r],o=this._getBindGroup(r,s);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,n)=>t.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==li.NONE&&this.updateNodes.push(e.getSelf());for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==li.NONE&&this.updateBeforeNodes.push(e.getSelf()),n!==li.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===nu||e.magFilter===Wee||e.magFilter===NM||e.magFilter===D1||e.minFilter===nu||e.minFilter===Wee||e.minFilter===NM||e.minFilter===D1}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new aQ(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,n=null){let r=this.generateArrayDeclaration(e,t)+"( ";for(let s=0;s<t;s++){const o=n?n[s]:null;o!==null?r+=o.build(this,e):r+=this.generateConst(e),s<t-1&&(r+=", ")}return r+=" )",r}generateStruct(e,t,n=null){const r=[];for(const s of t){const{name:o,type:a}=s;n&&n[o]&&n[o].isNode?r.push(n[o].build(this,a)):r.push(this.generateConst(a))}return e+"( "+r.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new zi:e==="vec2"?t=new si:e==="vec3"?t=new st:e==="vec4"&&(t=new _i)),e==="float")return GO(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${GO(t.r)}, ${GO(t.g)}, ${GO(t.b)} )`;const n=this.getTypeLength(e),r=this.getComponentType(e),s=o=>this.generateConst(r,o);if(n===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(n===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(n===4&&e!=="mat2")return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const n=this.attributes;for(const s of n)if(s.name===e)return s;const r=new NSe(e,t);return this.registerDeclaration(r),n.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===M0)return"int";if(t===Uo)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let n=ytt(e);const r=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(n=n.replace("vec","mat")),r+n}getTypeFromArray(e){return r0t.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,r=e.itemSize,s=e.normalized;let o;return!(e instanceof TRe)&&s!==!0&&(o=this.getTypeFromArray(n)),this.getTypeFromLength(r,o)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return n!==null?Number(n[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=CZ(this.stack),this.stacks.push(IRe()||this.stack),ZL(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,ZL(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let r=n.getData(e);return r===void 0&&(r={},n.setData(e,r)),r[t]===void 0&&(r[t]={}),r[t]}getNodeProperties(e,t="any"){const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e);let r=n.bufferAttribute;if(r===void 0){const s=this.uniforms.index++;r=new NSe("nodeAttribute"+s,t,e),this.bufferAttributes.push(r),n.bufferAttribute=r}return r}getStructTypeFromNode(e,t,n=null,r=this.shaderStage){const s=this.getDataFromNode(e,r,this.globalCache);let o=s.structType;if(o===void 0){const a=this.structs.index++;n===null&&(n="StructType"+a),o=new zlt(n,t),this.structs[r].push(o),s.structType=o}return o}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t,n=this.shaderStage,r=null){const s=this.getDataFromNode(e,n,this.globalCache);let o=s.uniform;if(o===void 0){const a=this.uniforms.index++;o=new Olt(r||"nodeUniform"+a,t,e),this.uniforms[n].push(o),this.registerDeclaration(o),s.uniform=o}return o}getArrayCount(e){let t=null;return e.isArrayNode?t=e.count:e.isVarNode&&e.node.isArrayNode&&(t=e.node.count),t}getVarFromNode(e,t=null,n=e.getNodeType(this),r=this.shaderStage,s=!1){const o=this.getDataFromNode(e,r);let a=o.variable;if(a===void 0){const c=s?"_const":"_var",u=this.vars[r]||(this.vars[r]=[]),f=this.vars[c]||(this.vars[c]=0);t===null&&(t=(s?"nodeConst":"nodeVar")+f,this.vars[c]++);const m=this.getArrayCount(e);a=new ZPe(t,n,s,m),s||u.push(a),this.registerDeclaration(a),o.variable=a}return a}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,n=e.getNodeType(this),r=null,s=null){const o=this.getDataFromNode(e,"any");let a=o.varying;if(a===void 0){const c=this.varyings,u=c.length;t===null&&(t="nodeVarying"+u),a=new Blt(t,n,r,s),c.push(a),this.registerDeclaration(a),o.varying=a}return a}get namespace(){return this.context.namespace}getOutputNamespace(){return this.getNamespace("outputNode")}getNamespace(e=""){const t=this.namespace;let n;return t?n=e?t+"_"+e:t:n=e,n}registerDeclaration(e){const t=this.shaderStage,n=this.declarations[t]||(this.declarations[t]={}),r=this.getPropertyName(e);let s=1,o=r;for(;n[o]!==void 0;)o=r+"_"+s++;s>1&&(e.name=o,console.warn(`THREE.TSL: Declaration name '${r}' of '${e.type}' already in use. Renamed to '${o}'.`)),n[o]=e}getCodeFromNode(e,t,n=this.shaderStage){const r=this.getDataFromNode(e);let s=r.code;if(s===void 0){const o=this.codes[n]||(this.codes[n]=[]),a=o.length;s=new Llt("nodeCode"+a,t),o.push(s),r.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:r}=this.getDataFromNode(e);let s=!0,o=t;for(;o;){if(r.get(o)===!0){s=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(s)for(const a of n)this.addLineFlowCode(a)}addLineFlowCodeBlock(e,t,n){const r=this.getDataFromNode(e),s=r.flowCodes||(r.flowCodes=[]),o=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);s.push(t),o.set(n,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new cat,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let o=0;const a=Object.values(this);return{next:()=>({value:a[o],done:o++>=a.length})}}};for(const o of t.inputs)n[o.name]=new Oit(o.type,o.name);e.layout=null;const r=e.call(n),s=this.flowStagesNode(r,t.type);return e.layout=t,s}flowStagesNode(e,t=null){const n=this.flow,r=this.vars,s=this.declarations,o=this.cache,a=this.buildStage,c=this.stack,u={code:""};this.flow=u,this.vars={},this.declarations={},this.cache=new aQ,this.stack=CZ();for(const f of Pbe)this.setBuildStage(f),u.result=e.build(this,t);return u.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=r,this.declarations=s,this.cache=o,this.stack=c,this.setBuildStage(a),u}getFunctionOperator(){return null}buildFunctionCode(){console.warn("Abstract function.")}flowChildNode(e,t=null){const n=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,t),this.flow=n,r}flowNodeFromShaderStage(e,t,n=null,r=null){const s=this.tab,o=this.cache,a=this.shaderStage,c=this.context;this.setShaderStage(e);const u={...this.context};delete u.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=u;let f=null;if(this.buildStage==="generate"){const m=this.flowChildNode(t,n);r!==null&&(m.code+=`${this.tab+r} = ${m.result};
`),this.flowCode[e]=this.flowCode[e]+m.code,f=m}else f=t.build(this);return this.setShaderStage(a),this.cache=o,this.tab=s,this.context=c,f}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t,n=null){return`${n!==null?this.generateArrayDeclaration(e,n):this.getType(e)} ${t}`}getVars(e){let t="";const n=this.vars[e];if(n!==void 0)for(const r of n)t+=`${this.getVar(r.type,r.name)}; `;return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let n="";if(t!==void 0)for(const r of t)n+=r.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:t,renderer:n}=this;if(t!==null){let r=n.library.fromMaterial(t);r===null&&(console.error(`NodeMaterial: Material "${t.type}" is not compatible.`),r=new la),r.build(this)}else this.addFlow("compute",e);for(const r of Pbe){this.setBuildStage(r),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of Nbe){this.setShaderStage(s);const o=this.flowNodes[s];for(const a of o)r==="generate"?this.flowNode(a):a.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new Ylt(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new Klt(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new Zlt(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new Qlt(e);if(t==="color")return new Jlt(e);if(t==="mat2")return new e0t(e);if(t==="mat3")return new t0t(e);if(t==="mat4")return new n0t(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,n){if(t=this.getVectorType(t),n=this.getVectorType(n),t===n||n===null||this.isReference(n))return e;const r=this.getTypeLength(t),s=this.getTypeLength(n);return r===16&&s===9?`${this.getType(n)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:r===9&&s===4?`${this.getType(n)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:r>4||s>4||s===0?e:r===s?`${this.getType(n)}( ${e} )`:r>s?(e=n==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,s)}`,this.format(e,this.getTypeFromLength(s,this.getComponentType(t)),n)):s===4&&r>1?`${this.getType(n)}( ${this.format(e,t,"vec3")}, 1.0 )`:r===2?`${this.getType(n)}( ${this.format(e,t,"vec2")}, 0.0 )`:(r===1&&s>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${HAe} - Node System
`}*[Symbol.iterator](){}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}},kSe=class{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return n===void 0&&(n={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===li.FRAME){const{frameMap:r}=this._getMaps(this.updateBeforeMap,n);r.get(n)!==this.frameId&&e.updateBefore(this)!==!1&&r.set(n,this.frameId)}else if(t===li.RENDER){const{renderMap:r}=this._getMaps(this.updateBeforeMap,n);r.get(n)!==this.renderId&&e.updateBefore(this)!==!1&&r.set(n,this.renderId)}else t===li.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===li.FRAME){const{frameMap:r}=this._getMaps(this.updateAfterMap,n);r.get(n)!==this.frameId&&e.updateAfter(this)!==!1&&r.set(n,this.frameId)}else if(t===li.RENDER){const{renderMap:r}=this._getMaps(this.updateAfterMap,n);r.get(n)!==this.renderId&&e.updateAfter(this)!==!1&&r.set(n,this.renderId)}else t===li.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===li.FRAME){const{frameMap:r}=this._getMaps(this.updateMap,n);r.get(n)!==this.frameId&&e.update(this)!==!1&&r.set(n,this.frameId)}else if(t===li.RENDER){const{renderMap:r}=this._getMaps(this.updateMap,n);r.get(n)!==this.renderId&&e.update(this)!==!1&&r.set(n,this.renderId)}else t===li.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}},yie=class{constructor(e,t,n=null,r="",s=!1){this.type=e,this.name=t,this.count=n,this.qualifier=r,this.isConst=s}};yie.isNodeFunctionInput=!0;let i0t=class extends k4{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:BPe(this.light),lightColor:e}}};const lQ=new bs,$O=new bs;let TT=null,s0t=class extends k4{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Mr(new st).setGroup(Tr),this.halfWidth=Mr(new st).setGroup(Tr),this.updateType=li.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;$O.identity(),lQ.copy(t.matrixWorld),lQ.premultiply(n),$O.extractRotation(lQ),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4($O),this.halfHeight.value.applyMatrix4($O)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=Ri(TT.LTC_FLOAT_1),n=Ri(TT.LTC_FLOAT_2)):(t=Ri(TT.LTC_HALF_1),n=Ri(TT.LTC_HALF_2));const{colorNode:r,light:s}=this,o=OPe(s);return{lightColor:r,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){TT=e}},vie=class extends k4{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Mr(0).setGroup(Tr),this.penumbraCosNode=Mr(0).setGroup(Tr),this.cutoffDistanceNode=Mr(0).setGroup(Tr),this.decayExponentNode=Mr(0).setGroup(Tr),this.colorNode=Mr(this.color).setGroup(Tr)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:n,penumbraCosNode:r}=this;return q2(n,r,t)}getLightCoord(e){const t=e.getNodeProperties(this);let n=t.projectionUV;return n===void 0&&(n=fat(this.light,e.context.positionWorld),t.projectionUV=n),n}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:r,light:s}=this,o=this.getLightVector(e),a=o.normalize(),c=a.dot(BPe(s)),u=this.getSpotAttenuation(e,c),f=o.length(),m=VPe({lightDistance:f,cutoffDistance:n,decayExponent:r});let v=t.mul(u).mul(m),x,T;return s.colorNode?(T=this.getLightCoord(e),x=s.colorNode(T)):s.map&&(T=this.getLightCoord(e),x=Ri(s.map,T.xy).onRenderUpdate(()=>s.map)),x&&(v=T.mul(2).sub(1).abs().lessThan(1).all().select(v.mul(x),v)),{lightColor:v,lightDirection:a}}},o0t=class extends vie{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const n=this.light.iesMap;let r=null;if(n&&n.isTexture===!0){const s=t.acos().mul(1/Math.PI);r=Ri(n,wn(s,0),0).r}else r=super.getSpotAttenuation(t);return r}};const a0t=Yt(([i,e])=>{const t=i.abs().sub(e);return L1(Ql(t,0)).add(J_(Ql(t.x,t.y),0))});let l0t=class extends vie{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let n=1;t.map!==null&&(n=t.map.width/t.map.height),t.shadow.aspect=n}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=this.penumbraCosNode,n=this.getLightCoord(e),r=n.xyz.div(n.w),s=a0t(r.xy.sub(wn(.5)),wn(.5)),o=Xf(-1,C0(1,WRe(t)).sub(1));return ePe(s.mul(-2).mul(o))}},c0t=class extends k4{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}},u0t=class extends k4{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=FPe(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Mr(new zi).setGroup(Tr)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:r}=this,o=lie.dot(r).mul(.5).add(.5),a=Us(n,t,o);e.context.irradiance.addAssign(a)}},h0t=class extends k4{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let n=0;n<9;n++)t.push(new st);this.lightProbe=Uf(t)}update(e){const{light:t}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(t.sh.coefficients[n]).multiplyScalar(t.intensity)}setup(e){const t=xlt(lie,this.lightProbe);e.context.irradiance.addAssign(t)}};const DSe=new WeakMap;let d0t=class extends Cx{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const m=n.isTextureNode?n.value:t[n.property];let v=DSe.get(m);v===void 0&&(v=$Pe(m),DSe.set(m,v)),n=v}const s=t.useAnisotropy===!0||t.anisotropy>0?Ast:ra,o=n.context(FSe(x1,s)).mul(kZ),a=n.context(f0t(cie)).mul(Math.PI).mul(kZ),c=qB(o),u=qB(a);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(u);const f=e.context.lightingModel.clearcoatRadiance;if(f){const m=n.context(FSe(eU,oE)).mul(kZ),v=qB(m);f.addAssign(v)}}};const FSe=(i,e)=>{let t=null;return{getUV:()=>(t===null&&(t=ho.negate().reflect(e),t=i.mul(i).mix(t,e).normalize(),t=t.transformDirection(im)),t),getTextureLevel:()=>i}},f0t=i=>({getUV:()=>i,getTextureLevel:()=>Nt(1)});let _ie=class extends Cx{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=KPe(this.envNode)}},JPe=class{parseFunction(){console.warn("Abstract function.")}},xie=class{constructor(e,t,n="",r=""){this.type=e,this.inputs=t,this.name=n,this.precision=r}getCode(){console.warn("Abstract function.")}};xie.isNodeFunction=!0;const p0t=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,m0t=/[a-z_0-9]+/ig,OSe="#pragma main",g0t=i=>{i=i.trim();const e=i.indexOf(OSe),t=e!==-1?i.slice(e+OSe.length):i,n=t.match(p0t);if(n!==null&&n.length===5){const r=n[4],s=[];let o=null;for(;(o=m0t.exec(r))!==null;)s.push(o);const a=[];let c=0;for(;c<s.length;){const T=s[c][0]==="const";T===!0&&c++;let P=s[c][0];P==="in"||P==="out"||P==="inout"?c++:P="";const R=s[c++][0];let M=Number.parseInt(s[c][0]);Number.isNaN(M)===!1?c++:M=null;const O=s[c++][0];a.push(new yie(R,O,M,P,T))}const u=t.substring(n[0].length),f=n[3]!==void 0?n[3]:"",m=n[2],v=n[1]!==void 0?n[1]:"",x=e!==-1?i.slice(0,e):"";return{type:m,inputs:a,name:f,precision:v,inputsCode:r,blockCode:u,headerCode:x}}else throw new Error("FunctionNode: Function is not a GLSL code.")};let y0t=class extends xie{constructor(e){const{type:t,inputs:n,name:r,precision:s,inputsCode:o,blockCode:a,headerCode:c}=g0t(e);super(t,n,r,s),this.inputsCode=o,this.blockCode=a,this.headerCode=c}getCode(e=this.name){let t;const n=this.blockCode;if(n!==""){const{type:r,inputsCode:s,headerCode:o,precision:a}=this;let c=`${r} ${e} ( ${s.trim()} )`;a!==""&&(c=`${a} ${c}`),t=o+c+n}else t="";return t}},v0t=class extends JPe{parseFunction(e){return new y0t(e)}},eNe=class extends hz{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,n=e.reflectedLight,r=e.irradianceLightMap;n.indirectDiffuse.assign(Gr(0)),r?n.indirectDiffuse.addAssign(r):n.indirectDiffuse.addAssign(Gr(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(Bi.rgb)}finish(e){const{material:t,context:n}=e,r=n.outgoingLight,s=e.context.environment;if(s)switch(t.combine){case YU:r.rgb.assign(Us(r.rgb,r.rgb.mul(s.rgb),YB.mul(DZ)));break;case Bet:r.rgb.assign(Us(r.rgb,s.rgb,YB.mul(DZ)));break;case Let:r.rgb.addAssign(s.rgb.mul(YB.mul(DZ)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",t.combine);break}}};const _0t=()=>Nt(.25),x0t=Yt(({dotNH:i})=>pte.mul(Nt(.5)).add(1).mul(Nt(1/Math.PI)).mul(i.pow(pte))),b0t=Yt(({lightDirection:i})=>{const e=i.add(ho).normalize(),t=ra.dot(e).clamp(),n=ho.dot(e).clamp(),r=BM({f0:Gc,f90:1,dotVH:n}),s=_0t(),o=x0t({dotNH:t});return r.mul(s).mul(o)});let tNe=class extends eNe{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const s=ra.dot(e).clamp().mul(t);n.directDiffuse.addAssign(s.mul(tx({diffuseColor:Bi.rgb}))),this.specular===!0&&n.directSpecular.addAssign(s.mul(b0t({lightDirection:e})).mul(YB))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(tx({diffuseColor:Bi}))),r.indirectDiffuse.mulAssign(t)}};const nNe=Yt(i=>{const{dotNV:e,specularColor:t,specularF90:n,roughness:r}=i,s=HPe({dotNV:e,roughness:r});return t.mul(s.x).add(n.mul(s.y))}),S0t=Yt(({roughness:i,dotNH:e})=>{const t=i.pow2(),n=Nt(1).div(t),s=e.pow2().oneMinus().max(.0078125);return Nt(2).add(n).mul(s.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),w0t=Yt(({dotNV:i,dotNL:e})=>Nt(1).div(Nt(4).mul(e.add(i).sub(e.mul(i))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),T0t=Yt(({lightDirection:i})=>{const e=i.add(ho).normalize(),t=ra.dot(i).clamp(),n=ra.dot(ho).clamp(),r=ra.dot(e).clamp(),s=S0t({roughness:Yre,dotNH:r}),o=w0t({dotNV:n,dotNL:t});return G6.mul(s).mul(o)}),E0t=Yt(({N:i,V:e,roughness:t})=>{const s=.0078125,o=i.dot(e).saturate(),a=wn(t,o.oneMinus().sqrt());return a.assign(a.mul(.984375).add(s)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),M0t=Yt(({f:i})=>{const e=i.length();return Ql(e.mul(e).add(i.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),HO=Yt(({v1:i,v2:e})=>{const t=i.dot(e),n=t.abs().toVar(),r=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),s=n.add(4.1616724).mul(n).add(3.417594).toVar(),o=r.div(s),a=t.greaterThan(0).select(o,Ql(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return i.cross(e).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),BSe=Yt(({N:i,V:e,P:t,mInv:n,p0:r,p1:s,p2:o,p3:a})=>{const c=s.sub(r).toVar(),u=a.sub(r).toVar(),f=c.cross(u),m=Bt().toVar();return Vo(f.dot(t.sub(r)).greaterThanEqual(0),()=>{const v=e.sub(i.mul(e.dot(i))).normalize(),x=i.cross(v).negate(),T=n.mul(F0(v,x,i).transpose()).toVar(),P=T.mul(r.sub(t)).normalize().toVar(),R=T.mul(s.sub(t)).normalize().toVar(),M=T.mul(o.sub(t)).normalize().toVar(),O=T.mul(a.sub(t)).normalize().toVar(),C=Bt(0).toVar();C.addAssign(HO({v1:P,v2:R})),C.addAssign(HO({v1:R,v2:M})),C.addAssign(HO({v1:M,v2:O})),C.addAssign(HO({v1:O,v2:P})),m.assign(Bt(M0t({f:C})))}),m}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),LSe=Yt(([i,e,t,n,r])=>{const s=Bt(tPe(e.negate(),DM(i),Xf(1,n))),o=Bt(L1(r[0].xyz),L1(r[1].xyz),L1(r[2].xyz));return DM(s).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),C0t=Yt(([i,e])=>i.mul(Y1(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),A0t=vPe(),R0t=vPe(),USe=Yt(([i,e,t],{material:n})=>{const s=(n.side===gc?A0t:R0t).sample(i),o=B1(yte.x).mul(C0t(e,t));return Wot(s,o)}),zSe=Yt(([i,e,t])=>(Vo(t.notEqual(0),()=>{const n=jRe(e).negate().div(t);return HRe(n.negate().mul(i))}),Bt(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),P0t=Yt(([i,e,t,n,r,s,o,a,c,u,f,m,v,x,T])=>{let P,R;if(T){P=Gr().toVar(),R=Bt().toVar();const Y=f.sub(1).mul(T.mul(.025)),J=Bt(f.sub(Y),f,f.add(Y));gd({start:0,end:3},({i:z})=>{const ne=J.element(z),K=LSe(i,e,m,ne,a),$=o.add(K),he=u.mul(c.mul(Gr($,1))),Ce=wn(he.xy.div(he.w)).toVar();Ce.addAssign(1),Ce.divAssign(2),Ce.assign(wn(Ce.x,Ce.y.oneMinus()));const Pe=USe(Ce,t,ne);P.element(z).assign(Pe.element(z)),P.a.addAssign(Pe.a),R.element(z).assign(n.element(z).mul(zSe(L1(K),v,x).element(z)))}),P.a.divAssign(3)}else{const Y=LSe(i,e,m,f,a),J=o.add(Y),z=u.mul(c.mul(Gr(J,1))),ne=wn(z.xy.div(z.w)).toVar();ne.addAssign(1),ne.divAssign(2),ne.assign(wn(ne.x,ne.y.oneMinus())),P=USe(ne,t,f),R=n.mul(zSe(L1(Y),v,x))}const M=R.rgb.mul(P.rgb),O=i.dot(e).clamp(),C=Bt(nNe({dotNV:O,specularColor:r,specularF90:s,roughness:t})),L=R.r.add(R.g,R.b).div(3);return Gr(C.oneMinus().mul(M),P.a.oneMinus().mul(L).oneMinus())}),N0t=F0(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),I0t=i=>{const e=i.sqrt();return Bt(1).add(e).div(Bt(1).sub(e))},VSe=(i,e)=>i.sub(e).div(i.add(e)).pow2(),k0t=(i,e)=>{const t=i.mul(2*Math.PI*1e-9),n=Bt(54856e-17,44201e-17,52481e-17),r=Bt(1681e3,1795300,2208400),s=Bt(43278e5,93046e5,66121e5),o=Nt(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=n.mul(s.mul(2*Math.PI).sqrt()).mul(r.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return a=Bt(a.x.add(o),a.y,a.z).div(10685e-11),N0t.mul(a)},D0t=Yt(({outsideIOR:i,eta2:e,cosTheta1:t,thinFilmThickness:n,baseF0:r})=>{const s=Us(i,e,q2(0,.03,n)),a=i.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();Vo(a.lessThan(0),()=>Bt(1));const c=a.sqrt(),u=VSe(s,i),f=BM({f0:u,f90:1,dotVH:t}),m=f.oneMinus(),v=s.lessThan(i).select(Math.PI,0),x=Nt(Math.PI).sub(v),T=I0t(r.clamp(0,.9999)),P=VSe(T,s.toVec3()),R=BM({f0:P,f90:1,dotVH:c}),M=Bt(T.x.lessThan(s).select(Math.PI,0),T.y.lessThan(s).select(Math.PI,0),T.z.lessThan(s).select(Math.PI,0)),O=s.mul(n,c,2),C=Bt(x).add(M),L=f.mul(R).clamp(1e-5,.9999),Y=L.sqrt(),J=m.pow2().mul(R).div(Bt(1).sub(L)),ne=f.add(J).toVar(),K=J.sub(m).toVar();return gd({start:1,end:2,condition:"<=",name:"m"},({m:$})=>{K.mulAssign(Y);const he=k0t(Nt($).mul(O),Nt($).mul(C)).mul(2);ne.addAssign(K.mul(he))}),ne.max(Bt(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),F0t=Yt(({normal:i,viewDir:e,roughness:t})=>{const n=i.dot(e).saturate(),r=t.pow2(),s=Wl(t.lessThan(.25),Nt(-339.2).mul(r).add(Nt(161.4).mul(t)).sub(25.9),Nt(-8.48).mul(r).add(Nt(14.3).mul(t)).sub(9.95)),o=Wl(t.lessThan(.25),Nt(44).mul(r).sub(Nt(23.7).mul(t)).add(3.26),Nt(1.97).mul(r).sub(Nt(3.27).mul(t)).add(.72));return Wl(t.lessThan(.25),0,Nt(.1).mul(t).sub(.025)).add(s.mul(n).add(o).exp()).mul(1/Math.PI).saturate()}),cQ=Bt(.04),uQ=Nt(1);let rNe=class extends hz{constructor(e=!1,t=!1,n=!1,r=!1,s=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=r,this.transmission=s,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=Bt().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=Bt().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=Bt().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=Bt().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=Bt().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=ra.dot(ho).clamp();this.iridescenceFresnel=D0t({outsideIOR:Nt(1),eta2:BRe,cosTheta1:t,thinFilmThickness:LRe,baseF0:Gc}),this.iridescenceF0=vlt({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=FM,n=jit.sub(FM).normalize(),r=cie,s=e.context;s.backdrop=P0t(r,n,x1,Bi,Gc,tU,t,E4,im,aie,jB,URe,VRe,zRe,this.dispersion?GRe:null),s.backdropAlpha=mte,Bi.a.mulAssign(Us(1,s.backdrop.a,mte))}super.start(e)}computeMultiscattering(e,t,n){const r=ra.dot(ho).clamp(),s=HPe({roughness:x1,dotNV:r}),a=(this.iridescenceF0?Kre.mix(Gc,this.iridescenceF0):Gc).mul(s.x).add(n.mul(s.y)),u=s.x.add(s.y).oneMinus(),f=Gc.add(Gc.oneMinus().mul(.047619)),m=a.mul(f).div(u.mul(f).oneMinus());e.addAssign(a),t.addAssign(m.mul(u))}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const s=ra.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(s.mul(T0t({lightDirection:e}))),this.clearcoat===!0){const a=oE.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(RSe({lightDirection:e,f0:cQ,f90:uQ,roughness:eU,normalView:oE})))}n.directDiffuse.addAssign(s.mul(tx({diffuseColor:Bi.rgb}))),n.directSpecular.addAssign(s.mul(RSe({lightDirection:e,f0:Gc,f90:1,roughness:x1,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:r,reflectedLight:s,ltc_1:o,ltc_2:a}){const c=t.add(n).sub(r),u=t.sub(n).sub(r),f=t.sub(n).add(r),m=t.add(n).add(r),v=ra,x=ho,T=oa.toVar(),P=E0t({N:v,V:x,roughness:x1}),R=o.sample(P).toVar(),M=a.sample(P).toVar(),O=F0(Bt(R.x,0,R.y),Bt(0,1,0),Bt(R.z,0,R.w)).toVar(),C=Gc.mul(M.x).add(Gc.oneMinus().mul(M.y)).toVar();s.directSpecular.addAssign(e.mul(C).mul(BSe({N:v,V:x,P:T,mInv:O,p0:c,p1:u,p2:f,p3:m}))),s.directDiffuse.addAssign(e.mul(Bi).mul(BSe({N:v,V:x,P:T,mInv:F0(1,0,0,0,1,0,0,0,1),p0:c,p1:u,p2:f,p3:m})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(t.mul(tx({diffuseColor:Bi})))}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:r}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(n.mul(G6,F0t({normal:ra,viewDir:ho,roughness:Yre}))),this.clearcoat===!0){const f=oE.dot(ho).clamp(),m=nNe({dotNV:f,specularColor:cQ,specularF90:uQ,roughness:eU});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(m))}const s=Bt().toVar("singleScattering"),o=Bt().toVar("multiScattering"),a=n.mul(1/Math.PI);this.computeMultiscattering(s,o,tU);const c=s.add(o),u=Bi.mul(c.r.max(c.g).max(c.b).oneMinus());r.indirectSpecular.addAssign(t.mul(s)),r.indirectSpecular.addAssign(o.mul(a)),r.indirectDiffuse.addAssign(u.mul(a))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,s=ra.dot(ho).clamp().add(t),o=x1.mul(-16).oneMinus().negate().exp2(),a=t.sub(s.pow(o).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(a)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const n=oE.dot(ho).clamp(),r=BM({dotVH:n,f0:cQ,f90:uQ}),s=t.mul(dte.mul(r).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(dte));t.assign(s)}if(this.sheen===!0){const n=G6.r.max(G6.g).max(G6.b).mul(.157).oneMinus(),r=t.mul(n).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(r)}}};const GSe=new WeakMap,Tf=[],ly=[];let O0t=class extends n3{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new kSe,this.nodeBuilderCache=new Map,this.callHashCache=new Ed,this.groupsData=new Ed,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===FRe.name)return!0;if(n===Tr.name){const s=this.get(e),o=this.nodeFrame.renderId;return s.renderId!==o?(s.renderId=o,!0):!1}if(n===ert.name){const s=this.get(e),o=this.nodeFrame.frameId;return s.frameId!==o?(s.frameId=o,!0):!1}Tf[0]=t,Tf[1]=e;let r=this.groupsData.get(Tf);return r===void 0&&this.groupsData.set(Tf,r={}),Tf.length=0,r.version!==t.version?(r.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:r}=this,s=this.getForRenderCacheKey(e);if(n=r.get(s),n===void 0){const o=this.backend.createNodeBuilder(e.object,this.renderer);o.scene=e.scene,o.material=e.material,o.camera=e.camera,o.context.material=e.material,o.lightsNode=e.lightsNode,o.environmentNode=this.getEnvironmentNode(e.scene),o.fogNode=this.getFogNode(e.scene),o.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&o.enableMultiview(),o.build(),n=this._createNodeBuilderState(o),r.set(s,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const r=this.backend.createNodeBuilder(e,this.renderer);r.build(),n=this._createNodeBuilderState(r),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new Mlt(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){Tf[0]=e,Tf[1]=t;const n=this.renderer.info.calls,r=this.callHashCache.get(Tf)||{};if(r.callId!==n){const s=this.getEnvironmentNode(e),o=this.getFogNode(e);t&&ly.push(t.getCacheKey(!0)),s&&ly.push(s.getCacheKey()),o&&ly.push(o.getCacheKey()),ly.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),ly.push(this.renderer.shadowMap.enabled?1:0),r.callId=n,r.cacheKey=Bre(ly),this.callHashCache.set(Tf,r),ly.length=0}return Tf.length=0,r.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const r=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==n||r){const s=this.getCacheNode("background",n,()=>{if(n.isCubeTexture===!0||n.mapping===Rre||n.mapping===Pre||n.mapping===jee){if(e.backgroundBlurriness>0||n.mapping===jee)return $Pe(n);{let o;return n.isCubeTexture===!0?o=OM(n):o=Ri(n),KPe(o)}}else{if(n.isTexture===!0)return Ri(n,d_.flipY()).setUpdateMatrix(!0);n.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",n)}},r);t.backgroundNode=s,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n,r=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=s.get(t);return(o===void 0||r)&&(o=n(),s.set(t,o)),o}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const r=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const s=ys("color","color",n).setGroup(Tr),o=ys("density","float",n).setGroup(Tr);return fSe(s,hat(o))}else if(n.isFog){const s=ys("color","color",n).setGroup(Tr),o=ys("near","float",n).setGroup(Tr),a=ys("far","float",n).setGroup(Tr);return fSe(s,uat(o,a))}else console.error("THREE.Renderer: Unsupported fog configuration.",n)});t.fogNode=r,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const r=this.getCacheNode("environment",n,()=>{if(n.isCubeTexture===!0)return OM(n);if(n.isTexture===!0)return Ri(n);console.error("Nodes: Unsupported environment configuration.",n)});t.environmentNode=r,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,n=null,r=null,s=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=n,o.camera=r,o.material=s,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return GSe.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),r=e.isArrayTexture?Zot(e,Bt(d_,rz("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):Ri(e,d_).renderOutput(t.toneMapping,t.currentColorSpace);return GSe.set(e,n),r}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const r of n.updateNodes)t.updateNode(r)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const r of n.updateNodes)t.updateNode(r)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new kSe,this.nodeBuilderCache=new Map,this.cacheLib={}}};const B0t=O0t,hQ=new p2;let L0t=class iNe{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new _c,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const r=e.length;for(let s=0;s<r;s++){hQ.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=t[n+s],a=hQ.normal;o.x=-a.x,o.y=-a.y,o.z=-a.z,o.w=hQ.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const r=t.clippingPlanes,s=r.length;let o,a;if(this.clipIntersection?(o=this.intersectionPlanes,a=e.intersectionPlanes.length):(o=this.unionPlanes,a=e.unionPlanes.length),o.length!==a+s){o.length=a+s;for(let c=0;c<s;c++)o[a+c]=new _i;n=!0}this.projectPlanes(r,o,a),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new iNe(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}};const $Se=L0t;let U0t=class{constructor(e,t){this.bundleGroup=e,this.camera=t}};const z0t=U0t,ET=[];let V0t=class{constructor(){this.bundles=new Ed}get(e,t){const n=this.bundles;ET[0]=e,ET[1]=t;let r=n.get(ET);return r===void 0&&(r=new z0t(e,t),n.set(ET,r)),ET.length=0,r}dispose(){this.bundles=new Ed}};const G0t=V0t;let $0t=class{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(n!==null){t=new n;for(const r in e)t[r]=e[r]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t)){console.warn(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);n.set(t,e)}addClass(e,t,n){if(n.has(t)){console.warn(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);n.set(t,e)}};const sNe=$0t,H0t=new LPe,MT=[];let j0t=class extends Ed{constructor(){super()}createNode(e=[]){return new LPe().setLights(e)}getNode(e,t){if(e.isQuadMesh)return H0t;MT[0]=e,MT[1]=t;let n=this.get(MT);return n===void 0&&(n=this.createNode(),this.set(MT,n)),MT.length=0,n}};const W0t=j0t;class q0t extends qc{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class jO extends Pa{constructor(){super(),this.isGroup=!0,this.type="Group"}}const X0t={type:"move"};class Y0t{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new jO,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new jO,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new st,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new st),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new jO,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new st,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new st),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,s=null,o=null;const a=this._targetRay,c=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){o=!0;for(const P of e.hand.values()){const R=t.getJointPose(P,n),M=this._getHandJoint(u,P);R!==null&&(M.matrix.fromArray(R.transform.matrix),M.matrix.decompose(M.position,M.rotation,M.scale),M.matrixWorldNeedsUpdate=!0,M.jointRadius=R.radius),M.visible=R!==null}const f=u.joints["index-finger-tip"],m=u.joints["thumb-tip"],v=f.position.distanceTo(m.position),x=.02,T=.005;u.inputState.pinching&&v>x+T?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&v<=x-T&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,n),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(X0t)))}return a!==null&&(a.visible=r!==null),c!==null&&(c.visible=s!==null),u!==null&&(u.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new jO;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}let uE=class extends I4{constructor(e=1,t=1,n={}){super(e,t,n),this.isXRRenderTarget=!0,this.hasExternalTextures=!1,this.autoAllocateDepthBuffer=!0}copy(e){return super.copy(e),this.hasExternalTextures=e.hasExternalTextures,this.autoAllocateDepthBuffer=e.autoAllocateDepthBuffer,this}};class bie extends sm{constructor(e=1,t=1,n=1,r=32,s=1,o=!1,a=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:c};const u=this;r=Math.floor(r),s=Math.floor(s);const f=[],m=[],v=[],x=[];let T=0;const P=[],R=n/2;let M=0;O(),o===!1&&(e>0&&C(!0),t>0&&C(!1)),this.setIndex(f),this.setAttribute("position",new k0(m,3)),this.setAttribute("normal",new k0(v,3)),this.setAttribute("uv",new k0(x,2));function O(){const L=new st,Y=new st;let J=0;const z=(t-e)/n;for(let ne=0;ne<=s;ne++){const K=[],$=ne/s,he=$*(t-e)+e;for(let Ce=0;Ce<=r;Ce++){const Pe=Ce/r,je=Pe*c+a,ge=Math.sin(je),Xe=Math.cos(je);Y.x=he*ge,Y.y=-$*n+R,Y.z=he*Xe,m.push(Y.x,Y.y,Y.z),L.set(ge,z,Xe).normalize(),v.push(L.x,L.y,L.z),x.push(Pe,1-$),K.push(T++)}P.push(K)}for(let ne=0;ne<r;ne++)for(let K=0;K<s;K++){const $=P[K][ne],he=P[K+1][ne],Ce=P[K+1][ne+1],Pe=P[K][ne+1];(e>0||K!==0)&&(f.push($,he,Pe),J+=3),(t>0||K!==s-1)&&(f.push(he,Ce,Pe),J+=3)}u.addGroup(M,J,0),M+=J}function C(L){const Y=T,J=new si,z=new st;let ne=0;const K=L===!0?e:t,$=L===!0?1:-1;for(let Ce=1;Ce<=r;Ce++)m.push(0,R*$,0),v.push(0,$,0),x.push(.5,.5),T++;const he=T;for(let Ce=0;Ce<=r;Ce++){const je=Ce/r*c+a,ge=Math.cos(je),Xe=Math.sin(je);z.x=K*Xe,z.y=R*$,z.z=K*ge,m.push(z.x,z.y,z.z),v.push(0,$,0),J.x=ge*.5+.5,J.y=Xe*.5*$+.5,x.push(J.x,J.y),T++}for(let Ce=0;Ce<r;Ce++){const Pe=Y+Ce,je=he+Ce;L===!0?f.push(je,je+1,Pe):f.push(je+1,je,Pe),ne+=3}u.addGroup(M,ne,L===!0?1:2),M+=ne}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bie(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Sie extends sm{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(n),c=Math.floor(r),u=a+1,f=c+1,m=e/a,v=t/c,x=[],T=[],P=[],R=[];for(let M=0;M<f;M++){const O=M*v-o;for(let C=0;C<u;C++){const L=C*m-s;T.push(L,-O,0),P.push(0,0,1),R.push(C/a),R.push(1-M/c)}}for(let M=0;M<c;M++)for(let O=0;O<a;O++){const C=O+u*M,L=O+u*(M+1),Y=O+1+u*(M+1),J=O+1+u*M;x.push(C,L,J),x.push(L,Y,J)}this.setIndex(x),this.setAttribute("position",new k0(T,3)),this.setAttribute("normal",new k0(P,3)),this.setAttribute("uv",new k0(R,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sie(e.width,e.height,e.widthSegments,e.heightSegments)}}const HSe=new st,jSe=new st;let K0t=class extends N4{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new qc,this._cameraL.viewport=new _i,this._cameraR=new qc,this._cameraR.viewport=new _i,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new q0t,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._supportsLayers=!1,this._frameBufferTargets=null,this._createXRLayer=nct.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new si,this._onSessionEvent=J0t.bind(this),this._onSessionEnd=ect.bind(this),this._onInputSourcesChange=tct.bind(this),this._onAnimationFrame=rct.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._useLayers=typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,n,r,s,o,a,c={}){const u=new Sie(e,t),f=new uE(s,o,{format:Xu,type:N0,depthTexture:new jf(s,o,c.stencil?B2:Uo,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?F1:Hf),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});f.autoAllocateDepthBuffer=!0;const m=new x2({color:16777215,side:I1});m.map=f.texture,m.map.offset.y=1,m.map.repeat.y=-1;const v=new Q1(u,m);v.position.copy(n),v.quaternion.copy(r);const x={type:"quad",width:e,height:t,translation:n,quaternion:r,pixelwidth:s,pixelheight:o,plane:v,material:m,rendercall:a,renderTarget:f};if(this._layers.push(x),this._session!==null){x.plane.material=new x2({color:16777215,side:I1}),x.plane.material.blending=DE,x.plane.material.blendEquation=md,x.plane.material.blendSrc=d2,x.plane.material.blendDst=d2,x.xrlayer=this._createXRLayer(x);const T=this._session.renderState.layers;T.unshift(x.xrlayer),this._session.updateRenderState({layers:T})}else f.isXRRenderTarget=!1;return v}createCylinderLayer(e,t,n,r,s,o,a,c,u={}){const f=new bie(e,e,e*t/n,64,64,!0,Math.PI-t/2,t),m=new uE(o,a,{format:Xu,type:N0,depthTexture:new jf(o,a,u.stencil?B2:Uo,void 0,void 0,void 0,void 0,void 0,void 0,u.stencil?F1:Hf),stencilBuffer:u.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});m.autoAllocateDepthBuffer=!0;const v=new x2({color:16777215,side:gc});v.map=m.texture,v.map.offset.y=1,v.map.repeat.y=-1;const x=new Q1(f,v);x.position.copy(r),x.quaternion.copy(s);const T={type:"cylinder",radius:e,centralAngle:t,aspectratio:n,translation:r,quaternion:s,pixelwidth:o,pixelheight:a,plane:x,material:v,rendercall:c,renderTarget:m};if(this._layers.push(T),this._session!==null){T.plane.material=new x2({color:16777215,side:gc}),T.plane.material.blending=DE,T.plane.material.blendEquation=md,T.plane.material.blendSrc=d2,T.plane.material.blendDst=d2,T.xrlayer=this._createXRLayer(T);const P=this._session.renderState.layers;P.unshift(T.xrlayer),this._session.updateRenderState({layers:P})}else m.isXRRenderTarget=!1;return x}renderLayers(){const e=new st,t=new Tx,n=this._renderer,r=this.isPresenting,s=n.getOutputRenderTarget(),o=n._frameBufferTarget;this.isPresenting=!1;const a=new si;n.getSize(a);const c=n._quad;for(const u of this._layers)if(u.renderTarget.isXRRenderTarget=this._session!==null,u.renderTarget.hasExternalTextures=u.renderTarget.isXRRenderTarget,u.renderTarget.isXRRenderTarget&&this._supportsLayers){u.xrlayer.transform=new XRRigidTransform(u.plane.getWorldPosition(e),u.plane.getWorldQuaternion(t));const f=this._glBinding.getSubImage(u.xrlayer,this._xrFrame);n.backend.setXRRenderTargetTextures(u.renderTarget,f.colorTexture,void 0),n._setXRLayerSize(u.renderTarget.width,u.renderTarget.height),n.setOutputRenderTarget(u.renderTarget),n.setRenderTarget(null),n._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:m,quad:v}=this._frameBufferTargets.get(u.renderTarget)||{frameBufferTarget:null,quad:null};m?(n._frameBufferTarget=m,n._quad=v):(n._quad=new fie(new la),this._frameBufferTargets.set(u.renderTarget,{frameBufferTarget:n._getFrameBufferTarget(),quad:n._quad})),u.rendercall(),n._frameBufferTarget=null}else n.setRenderTarget(u.renderTarget),u.rendercall();n.setRenderTarget(null),n.setOutputRenderTarget(s),n._frameBufferTarget=o,n._setXRLayerSize(a.x,a.y),n._quad=c,this.isPresenting=r}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend;this._gl=t.getContext();const r=this._gl,s=r.getContextAttributes();if(this._session=e,e!==null){if(n.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._useLayers===!0){let o=null,a=null,c=null;t.depth&&(c=t.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,o=t.stencil?F1:Hf,a=t.stencil?B2:Uo);const u={colorFormat:r.RGBA8,depthFormat:c,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(u.textureType="texture-array",this._useMultiview=!0);const f=new XRWebGLBinding(e,r),m=f.createProjectionLayer(u),v=[m];this._glBinding=f,this._glProjLayer=m,t.setPixelRatio(1),t._setXRLayerSize(m.textureWidth,m.textureHeight);const x=this._useMultiview?2:1,T=new jf(m.textureWidth,m.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,o,x);if(this._xrRenderTarget=new uE(m.textureWidth,m.textureHeight,{format:Xu,type:N0,colorSpace:t.outputColorSpace,depthTexture:T,stencilBuffer:t.stencil,samples:s.antialias?4:0,resolveDepthBuffer:m.ignoreDepthValues===!1,resolveStencilBuffer:m.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget.hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._supportsLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._supportsLayers)for(const P of this._layers)P.plane.material=new x2({color:16777215,side:P.type==="cylinder"?gc:I1}),P.plane.material.blending=DE,P.plane.material.blendEquation=md,P.plane.material.blendSrc=d2,P.plane.material.blendDst=d2,P.xrlayer=this._createXRLayer(P),v.unshift(P.xrlayer);e.updateRenderState({layers:v})}else{const o={antialias:t.samples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},a=new XRWebGLLayer(e,r,o);this._glBaseLayer=a,e.updateRenderState({baseLayer:a}),t.setPixelRatio(1),t._setXRLayerSize(a.framebufferWidth,a.framebufferHeight),this._xrRenderTarget=new uE(a.framebufferWidth,a.framebufferHeight,{format:Xu,type:N0,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:a.ignoreDepthValues===!1,resolveStencilBuffer:a.ignoreDepthValues===!1}),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const n=e.near,r=e.far,s=this._cameraXR,o=this._cameraL,a=this._cameraR;s.near=a.near=o.near=n,s.far=a.far=o.far=r,s.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==s.near||this._currentDepthFar!==s.far)&&(t.updateRenderState({depthNear:s.near,depthFar:s.far}),this._currentDepthNear=s.near,this._currentDepthFar=s.far),o.layers.mask=e.layers.mask|2,a.layers.mask=e.layers.mask|4,s.layers.mask=o.layers.mask|a.layers.mask;const c=e.parent,u=s.cameras;WSe(s,c);for(let f=0;f<u.length;f++)WSe(u[f],c);u.length===2?Z0t(s,o,a):s.projectionMatrix.copy(o.projectionMatrix),Q0t(e,s,c)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new Y0t,this._controllers[e]=t),t}};function Z0t(i,e,t){HSe.setFromMatrixPosition(e.matrixWorld),jSe.setFromMatrixPosition(t.matrixWorld);const n=HSe.distanceTo(jSe),r=e.projectionMatrix.elements,s=t.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),c=(r[9]+1)/r[5],u=(r[9]-1)/r[5],f=(r[8]-1)/r[0],m=(s[8]+1)/s[0],v=o*f,x=o*m,T=n/(-f+m),P=T*-f;if(e.matrixWorld.decompose(i.position,i.quaternion,i.scale),i.translateX(P),i.translateZ(T),i.matrixWorld.compose(i.position,i.quaternion,i.scale),i.matrixWorldInverse.copy(i.matrixWorld).invert(),r[10]===-1)i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const R=o+T,M=a+T,O=v-P,C=x+(n-P),L=c*a/M*R,Y=u*a/M*R;i.projectionMatrix.makePerspective(O,C,L,Y,R,M),i.projectionMatrixInverse.copy(i.projectionMatrix).invert()}}function WSe(i,e){e===null?i.matrixWorld.copy(i.matrix):i.matrixWorld.multiplyMatrices(e.matrixWorld,i.matrix),i.matrixWorldInverse.copy(i.matrixWorld).invert()}function Q0t(i,e,t){t===null?i.matrix.copy(e.matrixWorld):(i.matrix.copy(t.matrixWorld),i.matrix.invert(),i.matrix.multiply(e.matrixWorld)),i.matrix.decompose(i.position,i.quaternion,i.scale),i.updateMatrixWorld(!0),i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse),i.isPerspectiveCamera&&(i.fov=X_*2*Math.atan(1/i.projectionMatrix.elements[5]),i.zoom=1)}function J0t(i){const e=this._controllerInputSources.indexOf(i.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const n=this.getReferenceSpace();t.update(i.inputSource,i.frame,n),t.dispatchEvent({type:i.type,data:i.inputSource})}}function ect(){const i=this._session,e=this._renderer;i.removeEventListener("select",this._onSessionEvent),i.removeEventListener("selectstart",this._onSessionEvent),i.removeEventListener("selectend",this._onSessionEvent),i.removeEventListener("squeeze",this._onSessionEvent),i.removeEventListener("squeezestart",this._onSessionEvent),i.removeEventListener("squeezeend",this._onSessionEvent),i.removeEventListener("end",this._onSessionEnd),i.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const n=this._controllerInputSources[t];n!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(n))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._supportsLayers===!0)for(const t of this._layers)t.renderTarget=new uE(t.pixelwidth,t.pixelheight,{format:Xu,type:N0,depthTexture:new jf(t.pixelwidth,t.pixelheight,t.stencilBuffer?B2:Uo,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?F1:Hf),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function tct(i){const e=this._controllers,t=this._controllerInputSources;for(let n=0;n<i.removed.length;n++){const r=i.removed[n],s=t.indexOf(r);s>=0&&(t[s]=null,e[s].disconnect(r))}for(let n=0;n<i.added.length;n++){const r=i.added[n];let s=t.indexOf(r);if(s===-1){for(let a=0;a<e.length;a++)if(a>=t.length){t.push(r),s=a;break}else if(t[a]===null){t[a]=r,s=a;break}if(s===-1)break}const o=e[s];o&&o.connect(r)}}function nct(i){return i.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(i.translation,i.quaternion),width:i.width/2,height:i.height/2,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(i.translation,i.quaternion),radius:i.radius,centralAngle:i.centralAngle,aspectRatio:i.aspectRatio,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight,clearOnAccess:!1})}function rct(i,e){if(e===void 0)return;const t=this._cameraXR,n=this._renderer,r=n.backend,s=this._glBaseLayer,o=this.getReferenceSpace(),a=e.getViewerPose(o);if(this._xrFrame=e,a!==null){const c=a.views;this._glBaseLayer!==null&&r.setXRTarget(s.framebuffer);let u=!1;c.length!==t.cameras.length&&(t.cameras.length=0,u=!0);for(let f=0;f<c.length;f++){const m=c[f];let v;if(this._useLayers===!0){const T=this._glBinding.getViewSubImage(this._glProjLayer,m);v=T.viewport,f===0&&r.setXRRenderTargetTextures(this._xrRenderTarget,T.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:T.depthStencilTexture)}else v=s.getViewport(m);let x=this._cameras[f];x===void 0&&(x=new qc,x.layers.enable(f),x.viewport=new _i,this._cameras[f]=x),x.matrix.fromArray(m.transform.matrix),x.matrix.decompose(x.position,x.quaternion,x.scale),x.projectionMatrix.fromArray(m.projectionMatrix),x.projectionMatrixInverse.copy(x.projectionMatrix).invert(),x.viewport.set(v.x,v.y,v.width,v.height),f===0&&(t.matrix.copy(x.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),u===!0&&t.cameras.push(x)}n.setOutputRenderTarget(this._xrRenderTarget)}for(let c=0;c<this._controllers.length;c++){const u=this._controllerInputSources[c],f=this._controllers[c];u!==null&&f!==void 0&&f.update(u,e,o)}this._currentAnimationLoop&&this._currentAnimationLoop(i,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}const ict=K0t,cy=new nz,WO=new st;class wie{constructor(e=new p2,t=new p2,n=new p2,r=new p2,s=new p2,o=new p2){this.planes=[e,t,n,r,s,o]}set(e,t,n,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=ac){const n=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],c=r[3],u=r[4],f=r[5],m=r[6],v=r[7],x=r[8],T=r[9],P=r[10],R=r[11],M=r[12],O=r[13],C=r[14],L=r[15];if(n[0].setComponents(c-s,v-u,R-x,L-M).normalize(),n[1].setComponents(c+s,v+u,R+x,L+M).normalize(),n[2].setComponents(c+o,v+f,R+T,L+O).normalize(),n[3].setComponents(c-o,v-f,R-T,L-O).normalize(),n[4].setComponents(c-a,v-m,R-P,L-C).normalize(),t===ac)n[5].setComponents(c+a,v+m,R+P,L+C).normalize();else if(t===W2)n[5].setComponents(a,m,P,C).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),cy.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),cy.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(cy)}intersectsSprite(e){return cy.center.set(0,0,0),cy.radius=.7071067811865476,cy.applyMatrix4(e.matrixWorld),this.intersectsSphere(cy)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(WO.x=r.normal.x>0?e.max.x:e.min.x,WO.y=r.normal.y>0?e.max.y:e.min.y,WO.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(WO)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const Ef=new bs,Mf=new wie;class Tie{constructor(){this.coordinateSystem=ac}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ef.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Mf.setFromProjectionMatrix(Ef,this.coordinateSystem),Mf.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ef.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Mf.setFromProjectionMatrix(Ef,this.coordinateSystem),Mf.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ef.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Mf.setFromProjectionMatrix(Ef,this.coordinateSystem),Mf.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ef.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Mf.setFromProjectionMatrix(Ef,this.coordinateSystem),Mf.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ef.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Mf.setFromProjectionMatrix(Ef,this.coordinateSystem),Mf.containsPoint(e))return!0}return!1}clone(){return new Tie}}const qSe=new Lre,qO=new si,dQ=new _i,fQ=new wie,pQ=new Tie,XO=new bs,t2=new _i;let sct=class{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:r=!0,depth:s=!0,stencil:o=!1,antialias:a=!1,samples:c=0,getFallback:u=null,colorBufferType:f=qu,multiview:m=!1}=t;this.domElement=e.getDomElement(),this.backend=e,this.samples=c||a===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=n,this.outputColorSpace=Wc,this.toneMapping=o_,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=o,this.info=new Ott,this.overrideNodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new sNe,this.lighting=new W0t,this._getFallback=u,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new _i(0,0,this._width,this._height),this._scissor=new _i(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new fie(new la),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const v=this.alpha===!0?0:1;this._clearColor=new Vre(0,0,0,v),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=f,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:Det},this.xr=new ict(this,m),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(x,T,P)=>{await this.compileAsync(x,T);const R=this._renderLists.get(x,T),M=this._renderContexts.get(x,T,this._renderTarget),O=x.overrideMaterial||P.material,C=this._objects.get(P,O,x,T,R.lightsNode,M,M.clippingContext),{fragmentShader:L,vertexShader:Y}=C.getNodeBuilderState();return{fragmentShader:L,vertexShader:Y}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(r){if(this._getFallback!==null)try{this.backend=n=this._getFallback(r),await n.init(this)}catch(s){t(s);return}else{t(r);return}}this._nodes=new B0t(this,n),this._animation=new fet(this._nodes,this.info),this._attributes=new Ptt(n),this._background=new Slt(this,this._nodes),this._geometries=new Dtt(this._attributes,this.info),this._textures=new mnt(this,n,this.info),this._pipelines=new jtt(n,this._nodes),this._bindings=new qtt(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new Ett(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new Qtt(this.lighting),this._bundles=new G0t,this._renderContexts=new cnt,this._animation.start(),this._initialized=!0,e(this)}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const r=this._nodes.nodeFrame,s=r.renderId,o=this._currentRenderContext,a=this._currentRenderObjectFunction,c=this._compilationPromises,u=e.isScene===!0?e:qSe;n===null&&(n=e);const f=this._renderTarget,m=this._renderContexts.get(n,t,f),v=this._activeMipmapLevel,x=[];this._currentRenderContext=m,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=x,r.renderId++,r.update(),m.depth=this.depth,m.stencil=this.stencil,m.clippingContext||(m.clippingContext=new $Se),m.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,f);const T=this._renderLists.get(e,t);if(T.begin(),this._projectObject(e,t,0,T,m.clippingContext),n!==e&&n.traverseVisible(function(C){C.isLight&&C.layers.test(t.layers)&&T.pushLight(C)}),T.finish(),f!==null){this._textures.updateRenderTarget(f,v);const C=this._textures.get(f);m.textures=C.textures,m.depthTexture=C.depthTexture}else m.textures=null,m.depthTexture=null;this._background.update(u,T,m);const P=T.opaque,R=T.transparent,M=T.transparentDoublePass,O=T.lightsNode;this.opaque===!0&&P.length>0&&this._renderObjects(P,t,u,O),this.transparent===!0&&R.length>0&&this._renderTransparents(R,M,t,u,O),r.renderId=s,this._currentRenderContext=o,this._currentRenderObjectFunction=a,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(x)}async renderAsync(e,t){this._initialized===!1&&await this.init(),this._renderScene(e,t)}async waitForGPU(){await this.backend.waitForGPU()}set highPrecision(e){e===!0?(this.overrideNodes.modelViewMatrix=Hbe,this.overrideNodes.modelNormalViewMatrix=jbe):this.highPrecision&&(this.overrideNodes.modelViewMatrix=null,this.overrideNodes.modelNormalViewMatrix=null)}get highPrecision(){return this.overrideNodes.modelViewMatrix===Hbe&&this.overrideNodes.modelNormalViewMatrix===jbe}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),console.error(t),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:r,camera:s,renderList:o}=e,a=this._currentRenderContext,c=this._bundles.get(r,s),u=this.backend.get(c);u.renderContexts===void 0&&(u.renderContexts=new Set);const f=r.version!==u.version,m=u.renderContexts.has(a)===!1||f;if(u.renderContexts.add(a),m){this.backend.beginBundle(a),(u.renderObjects===void 0||f)&&(u.renderObjects=[]),this._currentRenderBundle=c;const{transparentDoublePass:v,transparent:x,opaque:T}=o;this.opaque===!0&&T.length>0&&this._renderObjects(T,s,t,n),this.transparent===!0&&x.length>0&&this._renderTransparents(x,v,s,t,n),this._currentRenderBundle=null,this.backend.finishBundle(a,c),u.version=r.version}else{const{renderObjects:v}=u;for(let x=0,T=v.length;x<T;x++){const P=v[x];this._nodes.needsRefresh(P)&&(this._nodes.updateBefore(P),this._nodes.updateForRender(P),this._bindings.updateForRender(P),this._nodes.updateAfter(P))}}this.backend.addBundle(a,c)}render(e,t){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,t);this._renderScene(e,t)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this;if(e!==o_===!1&&t!==a_===!1)return null;const{width:s,height:o}=this.getDrawingBufferSize(qO),{depth:a,stencil:c}=this;let u=this._frameBufferTarget;u===null&&(u=new I4(s,o,{depthBuffer:a,stencilBuffer:c,type:this._colorBufferType,format:Xu,colorSpace:a_,generateMipmaps:!1,minFilter:nu,magFilter:nu,samples:this.samples}),u.isPostProcessingRenderTarget=!0,this._frameBufferTarget=u);const f=this.getOutputRenderTarget();return u.depthBuffer=a,u.stencilBuffer=c,f!==null?u.setSize(f.width,f.height,f.depth):u.setSize(s,o,1),u.viewport.copy(this._viewport),u.scissor.copy(this._scissor),u.viewport.multiplyScalar(this._pixelRatio),u.scissor.multiplyScalar(this._pixelRatio),u.scissorTest=this._scissorTest,u.multiview=f!==null?f.multiview:!1,u.resolveDepthBuffer=f!==null?f.resolveDepthBuffer:!0,u.autoAllocateDepthBuffer=f!==null?f.autoAllocateDepthBuffer:!1,u}_renderScene(e,t,n=!0){if(this._isDeviceLost===!0)return;const r=n?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,o=s.renderId,a=this._currentRenderContext,c=this._currentRenderObjectFunction,u=e.isScene===!0?e:qSe,f=this._renderTarget||this._outputRenderTarget,m=this._activeCubeFace,v=this._activeMipmapLevel;let x;r!==null?(x=r,this.setRenderTarget(x)):x=f;const T=this._renderContexts.get(e,t,x);this._currentRenderContext=T,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls;const P=this.coordinateSystem,R=this.xr;if(t.coordinateSystem!==P&&R.isPresenting===!1&&(t.coordinateSystem=P,t.updateProjectionMatrix(),t.isArrayCamera))for(const Pe of t.cameras)Pe.coordinateSystem=P,Pe.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),R.enabled===!0&&R.isPresenting===!0&&(R.cameraAutoUpdate===!0&&R.updateCamera(t),t=R.getCamera());let M=this._viewport,O=this._scissor,C=this._pixelRatio;x!==null&&(M=x.viewport,O=x.scissor,C=1),this.getDrawingBufferSize(qO),dQ.set(0,0,qO.width,qO.height);const L=M.minDepth===void 0?0:M.minDepth,Y=M.maxDepth===void 0?1:M.maxDepth;T.viewportValue.copy(M).multiplyScalar(C).floor(),T.viewportValue.width>>=v,T.viewportValue.height>>=v,T.viewportValue.minDepth=L,T.viewportValue.maxDepth=Y,T.viewport=T.viewportValue.equals(dQ)===!1,T.scissorValue.copy(O).multiplyScalar(C).floor(),T.scissor=this._scissorTest&&T.scissorValue.equals(dQ)===!1,T.scissorValue.width>>=v,T.scissorValue.height>>=v,T.clippingContext||(T.clippingContext=new $Se),T.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,x);const J=t.isArrayCamera?pQ:fQ;t.isArrayCamera||(XO.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),J.setFromProjectionMatrix(XO,P));const z=this._renderLists.get(e,t);if(z.begin(),this._projectObject(e,t,0,z,T.clippingContext),z.finish(),this.sortObjects===!0&&z.sort(this._opaqueSort,this._transparentSort),x!==null){this._textures.updateRenderTarget(x,v);const Pe=this._textures.get(x);T.textures=Pe.textures,T.depthTexture=Pe.depthTexture,T.width=Pe.width,T.height=Pe.height,T.renderTarget=x,T.depth=x.depthBuffer,T.stencil=x.stencilBuffer}else T.textures=null,T.depthTexture=null,T.width=this.domElement.width,T.height=this.domElement.height,T.depth=this.depth,T.stencil=this.stencil;T.width>>=v,T.height>>=v,T.activeCubeFace=m,T.activeMipmapLevel=v,T.occlusionQueryCount=z.occlusionQueryCount,this._background.update(u,z,T),T.camera=t,this.backend.beginRender(T);const{bundles:ne,lightsNode:K,transparentDoublePass:$,transparent:he,opaque:Ce}=z;return ne.length>0&&this._renderBundles(ne,u,K),this.opaque===!0&&Ce.length>0&&this._renderObjects(Ce,t,u,K),this.transparent===!0&&he.length>0&&this._renderTransparents(he,$,t,u,K),this.backend.finishRender(T),s.renderId=o,this._currentRenderContext=a,this._currentRenderObjectFunction=c,r!==null&&(this.setRenderTarget(f,m,v),this._renderOutput(x)),u.onAfterRender(this,e,t,x),T}_setXRLayerSize(e,t){this._width=e,this._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,r=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=r}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),n===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,r){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,n,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,r,s=0,o=1){const a=this._viewport;e.isVector4?a.copy(e):a.set(e,t,n,r),a.minDepth=s,a.maxDepth=o}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,n=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,t,n);const r=this._renderTarget||this._getFrameBufferTarget();let s=null;if(r!==null){this._textures.updateRenderTarget(r);const o=this._textures.get(r);s=this._renderContexts.getForClear(r),s.textures=o.textures,s.depthTexture=o.depthTexture,s.width=o.width,s.height=o.height,s.renderTarget=r,s.depth=r.depthBuffer,s.stencil=r.stencilBuffer,s.clearColorValue=this.backend.getClearColor(),s.activeCubeFace=this.getActiveCubeFace(),s.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,n,s),r!==null&&this._renderTarget===null&&this._renderOutput(r)}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,n=!0){this._initialized===!1&&await this.init(),this.clear(e,t,n)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:o_}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:a_}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()}),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,n=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const t=this._nodes.nodeFrame,n=t.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,t.renderId=this.info.calls;const r=this.backend,s=this._pipelines,o=this._bindings,a=this._nodes,c=Array.isArray(e)?e:[e];if(c[0]===void 0||c[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");r.beginCompute(e);for(const u of c){if(s.has(u)===!1){const v=()=>{u.removeEventListener("dispose",v),s.delete(u),o.delete(u),a.delete(u)};u.addEventListener("dispose",v);const x=u.onInitFunction;x!==null&&x.call(u,{renderer:this})}a.updateForCompute(u),o.updateForCompute(u);const f=o.getForCompute(u),m=s.getForCompute(u,f);r.compute(e,u,f,m)}r.finishCompute(e),t.renderId=n}async computeAsync(e){this._initialized===!1&&await this.init(),this.compute(e)}async hasFeatureAsync(e){return this._initialized===!1&&await this.init(),this.backend.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){this._initialized===!1&&await this.init(),this._textures.updateTexture(e)}initTexture(e){this._initialized===!1&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=t2.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=t2.copy(t).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=t2.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,r;n!==null?r=n.renderTarget:(r=this._renderTarget||this._getFrameBufferTarget(),r!==null&&(this._textures.updateRenderTarget(r),n=this._textures.get(r))),this._textures.updateTexture(e,{renderTarget:r}),this.backend.copyFramebufferToTexture(e,n,t)}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,r,s,o)}async readRenderTargetPixelsAsync(e,t,n,r,s,o=0,a=0){return this.backend.copyTextureToBuffer(e.textures[o],t,n,r,s,a)}_projectObject(e,t,n,r,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){const c=t.isArrayCamera?pQ:fQ;if(!e.frustumCulled||c.intersectsSprite(e,t)){this.sortObjects===!0&&t2.setFromMatrixPosition(e.matrixWorld).applyMatrix4(XO);const{geometry:u,material:f}=e;f.visible&&r.push(e,u,f,n,t2.z,null,s)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const c=t.isArrayCamera?pQ:fQ;if(!e.frustumCulled||c.intersectsObject(e,t)){const{geometry:u,material:f}=e;if(this.sortObjects===!0&&(u.boundingSphere===null&&u.computeBoundingSphere(),t2.copy(u.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(XO)),Array.isArray(f)){const m=u.groups;for(let v=0,x=m.length;v<x;v++){const T=m[v],P=f[T.materialIndex];P&&P.visible&&r.push(e,u,P,n,t2.z,T,s)}}else f.visible&&r.push(e,u,f,n,t2.z,null,s)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const c=r;r=this._renderLists.get(e,t),r.begin(),c.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}const a=e.children;for(let c=0,u=a.length;c<u;c++)this._projectObject(a[c],t,n,r,s)}_renderBundles(e,t,n){for(const r of e)this._renderBundle(r,t,n)}_renderTransparents(e,t,n,r,s){if(t.length>0){for(const{material:o}of t)o.side=gc;this._renderObjects(t,n,r,s,"backSide");for(const{material:o}of t)o.side=I1;this._renderObjects(e,n,r,s);for(const{material:o}of t)o.side=s_}else this._renderObjects(e,n,r,s)}_renderObjects(e,t,n,r,s=null){for(let o=0,a=e.length;o<a;o++){const{object:c,geometry:u,material:f,group:m,clippingContext:v}=e[o];this._currentRenderObjectFunction(c,n,t,u,f,m,r,v,s)}}renderObject(e,t,n,r,s,o,a,c=null,u=null){let f,m,v;if(e.onBeforeRender(this,t,n,r,s,o),s.allowOverride===!0&&t.overrideMaterial!==null){const x=t.overrideMaterial;s.positionNode&&s.positionNode.isNode&&(f=x.positionNode,x.positionNode=s.positionNode),x.alphaTest=s.alphaTest,x.alphaMap=s.alphaMap,x.transparent=s.transparent||s.transmission>0,x.isShadowPassMaterial&&(x.side=s.shadowSide===null?s.side:s.shadowSide,s.depthNode&&s.depthNode.isNode&&(v=x.depthNode,x.depthNode=s.depthNode),s.castShadowNode&&s.castShadowNode.isNode&&(m=x.colorNode,x.colorNode=s.castShadowNode),s.castShadowPositionNode&&s.castShadowPositionNode.isNode&&(f=x.positionNode,x.positionNode=s.castShadowPositionNode)),s=x}s.transparent===!0&&s.side===s_&&s.forceSinglePass===!1?(s.side=gc,this._handleObjectFunction(e,s,t,n,a,o,c,"backSide"),s.side=I1,this._handleObjectFunction(e,s,t,n,a,o,c,u),s.side=s_):this._handleObjectFunction(e,s,t,n,a,o,c,u),f!==void 0&&(t.overrideMaterial.positionNode=f),v!==void 0&&(t.overrideMaterial.depthNode=v),m!==void 0&&(t.overrideMaterial.colorNode=m),e.onAfterRender(this,t,n,r,s,o)}_renderObjectDirect(e,t,n,r,s,o,a,c){const u=this._objects.get(e,t,n,r,s,this._currentRenderContext,a,c);u.drawRange=e.geometry.drawRange,u.group=o;const f=this._nodes.needsRefresh(u);f&&(this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u)),this._pipelines.updateForRender(u),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(u),u.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(u,this.info),f&&this._nodes.updateAfter(u)}_createObjectPipeline(e,t,n,r,s,o,a,c){const u=this._objects.get(e,t,n,r,s,this._currentRenderContext,a,c);u.drawRange=e.geometry.drawRange,u.group=o,this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u),this._pipelines.getForRender(u,this._compilationPromises),this._nodes.updateAfter(u)}get compile(){return this.compileAsync}};const oct=sct;let act=class{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}};const Eie=act;function lct(i){return i+(v2-i%v2)%v2}let cct=class extends Eie{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return lct(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}};const oNe=cct;let uct=class extends oNe{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}};const aNe=uct;let hct=0,dct=class extends aNe{constructor(e,t){super("UniformBuffer_"+hct++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}};const lNe=dct;let fct=class extends aNe{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let n=0,r=this.uniforms.length;n<r;n++){const s=this.uniforms[n],o=s.boundary,a=s.itemSize*e,c=t%v2,u=c%o,f=c+u;t+=u,f!==0&&v2-f<a&&(t+=v2-f),s.offset=t/e,t+=a}return Math.ceil(t/v2)*v2}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s]!==r){const a=this._getBufferForType(o);a[s]=n[s]=r,t=!0}return t}updateVector2(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y){const a=this._getBufferForType(o);a[s+0]=n[s+0]=r.x,a[s+1]=n[s+1]=r.y,t=!0}return t}updateVector3(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y||n[s+2]!==r.z){const a=this._getBufferForType(o);a[s+0]=n[s+0]=r.x,a[s+1]=n[s+1]=r.y,a[s+2]=n[s+2]=r.z,t=!0}return t}updateVector4(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y||n[s+2]!==r.z||n[s+4]!==r.w){const a=this._getBufferForType(o);a[s+0]=n[s+0]=r.x,a[s+1]=n[s+1]=r.y,a[s+2]=n[s+2]=r.z,a[s+3]=n[s+3]=r.w,t=!0}return t}updateColor(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset;if(n[s+0]!==r.r||n[s+1]!==r.g||n[s+2]!==r.b){const o=this.buffer;o[s+0]=n[s+0]=r.r,o[s+1]=n[s+1]=r.g,o[s+2]=n[s+2]=r.b,t=!0}return t}updateMatrix3(e){let t=!1;const n=this.values,r=e.getValue().elements,s=e.offset;if(n[s+0]!==r[0]||n[s+1]!==r[1]||n[s+2]!==r[2]||n[s+4]!==r[3]||n[s+5]!==r[4]||n[s+6]!==r[5]||n[s+8]!==r[6]||n[s+9]!==r[7]||n[s+10]!==r[8]){const o=this.buffer;o[s+0]=n[s+0]=r[0],o[s+1]=n[s+1]=r[1],o[s+2]=n[s+2]=r[2],o[s+4]=n[s+4]=r[3],o[s+5]=n[s+5]=r[4],o[s+6]=n[s+6]=r[5],o[s+8]=n[s+8]=r[6],o[s+9]=n[s+9]=r[7],o[s+10]=n[s+10]=r[8],t=!0}return t}updateMatrix4(e){let t=!1;const n=this.values,r=e.getValue().elements,s=e.offset;return mct(n,r,s)===!1&&(this.buffer.set(r,s),pct(n,r,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}};function pct(i,e,t){for(let n=0,r=e.length;n<r;n++)i[t+n]=e[n]}function mct(i,e,t){for(let n=0,r=e.length;n<r;n++)if(i[t+n]!==e[n])return!1;return!0}const gct=fct;let yct=0,vct=class extends gct{constructor(e,t){super(e),this.id=yct++,this.groupNode=t,this.isNodeUniformsGroup=!0}};const cNe=vct;let _ct=0,xct=class extends Eie{constructor(e,t){super(e),this.id=_ct++,this.texture=t,this.version=t?t.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:t}=this;return e!==this.generation?(this.generation=e,!0):t.isVideoTexture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}},dz=class extends xct{constructor(e,t,n,r=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=r}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}},uNe=class extends dz{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledCubeTexture=!0}},hNe=class extends dz{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledTexture3D=!0}};class bct extends Kl{constructor(e=null,t=1,n=1,r,s,o,a,c,u=Ma,f=Ma,m,v){super(null,o,a,c,u,f,r,s,m,v),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Sct={textureDimensions:"textureSize",equals:"equal"},wct={low:"lowp",medium:"mediump",high:"highp"},XSe={swizzleAssign:!0,storageBuffer:!1},YSe={perspective:"smooth",linear:"noperspective"},KSe={centroid:"centroid","flat first":"flat","flat either":"flat"},ZSe=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;let Tct=class extends QPe{constructor(e,t){super(e,t,new v0t),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==q1}getMethod(e){return Sct[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${r.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const n=t.array,r=t.count*t.itemSize,{itemSize:s}=t,o=t.array.constructor.name.toLowerCase().includes("int");let a=o?kre:Ire;s===2?a=o?Dre:Ky:s===3?a=o?Xet:Nre:s===4&&(a=o?Fre:Xu);const c={Float32Array:Xc,Uint8Array:N0,Uint16Array:U6,Uint32Array:Uo,Int8Array:FE,Int16Array:OE,Int32Array:M0,Uint8ClampedArray:N0},u=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(r/s))));let f=Math.ceil(r/s/u);u*f*s<r&&f++;const m=u*f*s,v=new n.constructor(m);v.set(n,0),t.array=v;const x=new bct(t.array,u,f,a,c[t.array.constructor.name]||Xc);x.needsUpdate=!0,x.isPBOTexture=!0;const T=new Mx(x,null,null);T.setPrecision("high"),t.pboNode=T,t.pbo=T.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,r=t.value;if(this.renderer.backend.has(r)){const f=this.renderer.backend.get(r);f.pbo=r.pbo}const s=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.label),o=this.getPropertyName(s);this.increaseUsage(n);const a=n.build(this,"uint"),c=this.getDataFromNode(e);let u=c.propertyName;if(u===void 0){const f=this.getVarFromNode(e);u=this.getPropertyName(f);const m=this.getDataFromNode(t);let v=m.propertySizeName;v===void 0&&(v=u+"Size",this.getVarFromNode(t,v,"uint"),this.addLineFlowCode(`${v} = uint( textureSize( ${o}, 0 ).x )`,e),m.propertySizeName=v);const{itemSize:x}=r,T="."+Ex.join("").slice(0,x),P=`ivec2(${a} % ${v}, ${a} / ${v})`,R=this.generateTextureLoad(null,o,P,null,"0");let M="vec4";r.pbo.type===Uo?M="uvec4":r.pbo.type===M0&&(M="ivec4"),this.addLineFlowCode(`${u} = ${M}(${R})${T}`,e),c.propertyName=u}return u}generateTextureLoad(e,t,n,r,s="0"){return r?`texelFetch( ${t}, ivec3( ${n}, ${r} ), ${s} )`:`texelFetch( ${t}, ${n}, ${s} )`}generateTexture(e,t,n,r){return e.isDepthTexture?(r&&(n=`vec4( ${n}, ${r} )`),`texture( ${t}, ${n} ).x`):(r&&(n=`vec3( ${n}, ${r} )`),`texture( ${t}, ${n} )`)}generateTextureLevel(e,t,n,r){return`textureLod( ${t}, ${n}, ${r} )`}generateTextureBias(e,t,n,r){return`texture( ${t}, ${n}, ${r} )`}generateTextureGrad(e,t,n,r){return`textureGrad( ${t}, ${n}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,n,r,s,o=this.shaderStage){if(o==="fragment")return s?`texture( ${t}, vec4( ${n}, ${s}, ${r} ) )`:`texture( ${t}, vec3( ${n}, ${r} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const r of n)t.push(`${this.getVar(r.type,r.name,r.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],n=[],r={};for(const o of t){let a=null,c=!1;if(o.type==="texture"||o.type==="texture3D"){const f=o.node.value;let m="";(f.isDataTexture===!0||f.isData3DTexture===!0)&&(f.type===Uo?m="u":f.type===M0&&(m="i")),o.type==="texture3D"&&f.isArrayTexture===!1?a=`${m}sampler3D ${o.name};`:f.compareFunction?f.isArrayTexture===!0?a=`sampler2DArrayShadow ${o.name};`:a=`sampler2DShadow ${o.name};`:f.isArrayTexture===!0||f.isDataArrayTexture===!0||f.isCompressedArrayTexture===!0?a=`${m}sampler2DArray ${o.name};`:a=`${m}sampler2D ${o.name};`}else if(o.type==="cubeTexture")a=`samplerCube ${o.name};`;else if(o.type==="buffer"){const f=o.node,m=this.getType(f.bufferType),v=f.bufferCount,x=v>0?v:"";a=`${f.name} {
	${m} ${o.name}[${x}];
};
`}else a=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,c=!0;const u=o.node.precision;if(u!==null&&(a=wct[u]+" "+a),c){a="	"+a;const f=o.groupNode.name;(r[f]||(r[f]=[])).push(a)}else a="uniform "+a,n.push(a)}let s="";for(const o in r){const a=r[o];s+=this._getGLSLUniformStruct(e+"_"+o,a.join(`
`))+`
`}return s+=n.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==M0){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const r=n.array;r instanceof Uint32Array||r instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const n=this.getAttributesArray();let r=0;for(const s of n)t+=`layout( location = ${r++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push(`	${n.type} ${n.name};`);return t.join(`
`)}getStructs(e){const t=[],n=this.structs[e],r=[];for(const s of n)if(s.output)for(const o of s.members)r.push(`layout( location = ${o.index} ) out ${o.type} ${o.name};`);else{let o="struct "+s.name+` {
`;o+=this.getStructMembers(s),o+=`
};
`,t.push(o)}return r.length===0&&r.push("layout( location = 0 ) out vec4 fragColor;"),`
`+r.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const n=this.varyings;if(e==="vertex"||e==="compute")for(const r of n){e==="compute"&&(r.needsInterpolation=!0);const s=this.getType(r.type);if(r.needsInterpolation)if(r.interpolationType){const o=YSe[r.interpolationType]||r.interpolationType,a=KSe[r.interpolationSampling]||"";t+=`${o} ${a} out ${s} ${r.name};
`}else{const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}out ${s} ${r.name};
`}else t+=`${s} ${r.name};
`}else if(e==="fragment"){for(const r of n)if(r.needsInterpolation){const s=this.getType(r.type);if(r.interpolationType){const o=YSe[r.interpolationType]||r.interpolationType,a=KSe[r.interpolationSampling]||"";t+=`${o} ${a} in ${s} ${r.name};
`}else{const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}in ${s} ${r.name};
`}}}for(const r of this.builtins[e])t+=`${r};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((n,r)=>n*r,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,n=this.shaderStage){const r=this.extensions[n]||(this.extensions[n]=new Map);r.has(e)===!1&&r.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const r=this.renderer.backend.extensions;this.object.isBatchedMesh&&r.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(n!==void 0)for(const{name:r,behavior:s}of n.values())t.push(`#extension ${r} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=XSe[e];if(t===void 0){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance";break}if(n!==void 0){const r=this.renderer.backend.extensions;r.has(n)&&(r.get(n),t=!0)}XSe[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const r=e[n],s=this.getPropertyName(r.attributeNode);s&&(t+=`${r.varyingName} = ${s};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${ZSe}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${ZSe}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

// structs
${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n=`// code

`;n+=this.flowCode[t];const r=this.flowNodes[t],s=r[r.length-1];for(const a of r){const c=this.getFlowData(a),u=a.name;u&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${u}
	`),n+=`${c.code}
	`,a===s&&t!=="compute"&&(n+=`// result
	`,t==="vertex"?(n+="gl_Position = ",n+=`${c.result};`):t==="fragment"&&(a.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${c.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n,r=null){const s=super.getUniformFromNode(e,t,n,r),o=this.getDataFromNode(e,n,this.globalCache);let a=o.uniformGPU;if(a===void 0){const c=e.groupNode,u=c.name,f=this.getBindGroupArray(u,n);if(t==="texture")a=new dz(s.name,s.node,c),f.push(a);else if(t==="cubeTexture")a=new uNe(s.name,s.node,c),f.push(a);else if(t==="texture3D")a=new hNe(s.name,s.node,c),f.push(a);else if(t==="buffer"){e.name=`NodeBuffer_${e.id}`,s.name=`buffer${e.id}`;const m=new lNe(e,c);m.name=e.name,f.push(m),a=m}else{const m=this.uniformGroups[n]||(this.uniformGroups[n]={});let v=m[u];v===void 0&&(v=new cNe(n+"_"+u,c),m[u]=v,f.push(v)),a=this.getNodeUniform(s,t),v.addUniform(a)}o.uniformGPU=a}return s}};const Ect=Tct;let mQ=null,o6=null,Mct=class{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={render:null,compute:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){X1("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t){X1(`WebGPURenderer: No timestamp query pool for type '${e}' found.`);return}const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async waitForGPU(){}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return mQ=mQ||new si,this.renderer.getDrawingBufferSize(mQ)}setScissorTest(){}getClearColor(){const e=this.renderer;return o6=o6||new Vre,e.getClearColor(o6),o6.getRGB(o6),o6}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:htt(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${HAe} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}};const dNe=Mct;let Cct=0,Act=class{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}},Rct=class{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:r}=n,s=e.array,o=e.usage||r.STATIC_DRAW,a=e.isInterleavedBufferAttribute?e.data:e,c=n.get(a);let u=c.bufferGPU;u===void 0&&(u=this._createBuffer(r,t,s,o),c.bufferGPU=u,c.bufferType=t,c.version=a.version);let f;if(s instanceof Float32Array)f=r.FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?f=r.HALF_FLOAT:f=r.UNSIGNED_SHORT;else if(s instanceof Int16Array)f=r.SHORT;else if(s instanceof Uint32Array)f=r.UNSIGNED_INT;else if(s instanceof Int32Array)f=r.INT;else if(s instanceof Int8Array)f=r.BYTE;else if(s instanceof Uint8Array)f=r.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)f=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let m={bufferGPU:u,bufferType:t,type:f,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:f===r.INT||f===r.UNSIGNED_INT||e.gpuType===M0,id:Cct++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const v=this._createBuffer(r,t,s,o);m=new Act(m,v)}n.set(e,m)}updateAttribute(e){const t=this.backend,{gl:n}=t,r=e.array,s=e.isInterleavedBufferAttribute?e.data:e,o=t.get(s),a=o.bufferType,c=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(a,o.bufferGPU),c.length===0)n.bufferSubData(a,0,r);else{for(let u=0,f=c.length;u<f;u++){const m=c[u];n.bufferSubData(a,m.start*r.BYTES_PER_ELEMENT,r,m.start,m.count)}s.clearUpdateRanges()}n.bindBuffer(a,null),o.version=s.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const r=t.get(e);n.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(r),o=e.array,a=o.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,s);const c=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.bufferData(n.COPY_WRITE_BUFFER,a,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,a),await t.utils._clientWaitAsync();const u=new e.array.constructor(o.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,u),n.deleteBuffer(c),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),u.buffer}_createBuffer(e,t,n,r){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,n,r),e.bindBuffer(t,null),s}};const Pct=Rct;let gQ,CT,Nct=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;gQ={[md]:e.FUNC_ADD,[jAe]:e.FUNC_SUBTRACT,[WAe]:e.FUNC_REVERSE_SUBTRACT},CT={[d2]:e.ZERO,[qAe]:e.ONE,[XAe]:e.SRC_COLOR,[GL]:e.SRC_ALPHA,[eRe]:e.SRC_ALPHA_SATURATE,[QAe]:e.DST_COLOR,[KAe]:e.DST_ALPHA,[YAe]:e.ONE_MINUS_SRC_COLOR,[$L]:e.ONE_MINUS_SRC_ALPHA,[JAe]:e.ONE_MINUS_DST_COLOR,[ZAe]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=new _i().fromArray(t),this.currentViewport=new _i().fromArray(n),this._tempVec4=new _i}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==Pet?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===Net?t.cullFace(t.BACK):e===Iet?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,n,r,s,o,a,c){const{gl:u}=this;if(e===Y_){this.currentBlendingEnabled===!0&&(this.disable(u.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(u.BLEND),this.currentBlendingEnabled=!0),e!==DE){if(e!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==md||this.currentBlendEquationAlpha!==md)&&(u.blendEquation(u.FUNC_ADD),this.currentBlendEquation=md,this.currentBlendEquationAlpha=md),c)switch(e){case k1:u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case UL:u.blendFunc(u.ONE,u.ONE);break;case zL:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case VL:u.blendFuncSeparate(u.ZERO,u.SRC_COLOR,u.ZERO,u.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case k1:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case UL:u.blendFunc(u.SRC_ALPHA,u.ONE);break;case zL:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case VL:u.blendFunc(u.ZERO,u.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=c}return}s=s||t,o=o||n,a=a||r,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(u.blendEquationSeparate(gQ[t],gQ[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(n!==this.currentBlendSrc||r!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||a!==this.currentBlendDstAlpha)&&(u.blendFuncSeparate(CT[n],CT[r],CT[o],CT[a]),this.currentBlendSrc=n,this.currentBlendDst=r,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=a),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case tRe:t.depthFunc(t.NEVER);break;case nRe:t.depthFunc(t.ALWAYS);break;case rRe:t.depthFunc(t.LESS);break;case HL:t.depthFunc(t.LEQUAL);break;case iRe:t.depthFunc(t.EQUAL);break;case sRe:t.depthFunc(t.GEQUAL);break;case oRe:t.depthFunc(t.GREATER);break;case aRe:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,r){const s=this._tempVec4.set(e,t,n,r);if(this.currentScissor.equals(s)===!1){const{gl:o}=this;o.scissor(s.x,s.y,s.z,s.w),this.currentScissor.copy(s)}}viewport(e,t,n,r){const s=this._tempVec4.set(e,t,n,r);if(this.currentViewport.equals(s)===!1){const{gl:o}=this;o.viewport(s.x,s.y,s.z,s.w),this.currentViewport.copy(s)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:r}=this;e.side===s_?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let s=e.side===gc;t&&(s=!s),this.setFlipSided(s),e.blending===k1&&e.transparent===!1?this.setBlending(Y_):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n)for(let c=0;c<8;c++)c<n?this.enable(12288+c):this.disable(12288+c)}setPolygonOffset(e,t,n){const{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==n)&&(r.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const n=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(n.bindVertexArray(e),t!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:r}=this;return r[e]!==t?(n.bindFramebuffer(e,t),r[e]=t,e===n.DRAW_FRAMEBUFFER&&(r[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(r[n.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:n}=this;let r=[],s=!1;if(e.textures!==null){r=this.currentDrawbuffers.get(t),r===void 0&&(r=[],this.currentDrawbuffers.set(t,r));const o=e.textures;if(r.length!==o.length||r[0]!==n.COLOR_ATTACHMENT0){for(let a=0,c=o.length;a<c;a++)r[a]=n.COLOR_ATTACHMENT0+a;r.length=o.length,s=!0}}else r[0]!==n.BACK&&(r[0]=n.BACK,s=!0);s&&n.drawBuffers(r)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:r}=this;e===void 0&&(e=t.TEXTURE0+r-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:r,currentTextureSlot:s,currentBoundTextures:o,maxTextures:a}=this;n===void 0&&(s===null?n=r.TEXTURE0+a-1:n=s);let c=o[n];c===void 0&&(c={type:void 0,texture:void 0},o[n]=c),(c.type!==e||c.texture!==t)&&(s!==n&&(r.activeTexture(n),this.currentTextureSlot=n),r.bindTexture(e,t),c.type=e,c.texture=t)}bindBufferBase(e,t,n){const{gl:r}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==n?(r.bindBufferBase(e,t,n),this.currentBoundBufferBases[s]=n,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,r=n[t];r!==void 0&&r.type!==void 0&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}};const Ict=Nct;let kct=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=q1){const{gl:n,extensions:r}=this;let s;const o=Rs.getTransfer(t);if(e===N0)return n.UNSIGNED_BYTE;if(e===jet)return n.UNSIGNED_SHORT_4_4_4_4;if(e===Wet)return n.UNSIGNED_SHORT_5_5_5_1;if(e===cRe)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===FE)return n.BYTE;if(e===OE)return n.SHORT;if(e===U6)return n.UNSIGNED_SHORT;if(e===M0)return n.INT;if(e===Uo)return n.UNSIGNED_INT;if(e===Xc)return n.FLOAT;if(e===qu)return n.HALF_FLOAT;if(e===qet)return n.ALPHA;if(e===Nre)return n.RGB;if(e===Xu)return n.RGBA;if(e===Hf)return n.DEPTH_COMPONENT;if(e===F1)return n.DEPTH_STENCIL;if(e===Ire)return n.RED;if(e===kre)return n.RED_INTEGER;if(e===Ky)return n.RG;if(e===Dre)return n.RG_INTEGER;if(e===Fre)return n.RGBA_INTEGER;if(e===gZ||e===VB||e===GB||e===$B)if(o===Fr)if(s=r.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===gZ)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===VB)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===GB)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===$B)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=r.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===gZ)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===VB)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===GB)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===$B)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===abe||e===lbe||e===cbe||e===ube)if(s=r.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===abe)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===lbe)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===cbe)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===ube)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===hbe||e===qee||e===Xee)if(s=r.get("WEBGL_compressed_texture_etc"),s!==null){if(e===hbe||e===qee)return o===Fr?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===Xee)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===Yee||e===Kee||e===Zee||e===Qee||e===Jee||e===ete||e===tte||e===nte||e===rte||e===ite||e===ste||e===ote||e===ate||e===lte)if(s=r.get("WEBGL_compressed_texture_astc"),s!==null){if(e===Yee)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Kee)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Zee)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Qee)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Jee)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===ete)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===tte)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===nte)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===rte)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===ite)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===ste)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===ote)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===ate)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===lte)return o===Fr?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===yZ)if(s=r.get("EXT_texture_compression_bptc"),s!==null){if(e===yZ)return o===Fr?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===Yet||e===dbe||e===fbe||e===pbe)if(s=r.get("EXT_texture_compression_rgtc"),s!==null){if(e===yZ)return s.COMPRESSED_RED_RGTC1_EXT;if(e===dbe)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===fbe)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===pbe)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===B2?n.UNSIGNED_INT_24_8:n[e]!==void 0?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,r)=>{function s(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(t),r();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),n()}s()})}};const Dct=kct;let QSe=!1,YO,yQ,JSe,Fct=class{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},QSe===!1&&(this._init(),QSe=!0)}_init(){const e=this.gl;YO={[K_]:e.REPEAT,[E2]:e.CLAMP_TO_EDGE,[Z_]:e.MIRRORED_REPEAT},yQ={[Ma]:e.NEAREST,[lRe]:e.NEAREST_MIPMAP_NEAREST,[NM]:e.NEAREST_MIPMAP_LINEAR,[nu]:e.LINEAR,[Wee]:e.LINEAR_MIPMAP_NEAREST,[D1]:e.LINEAR_MIPMAP_LINEAR},JSe={[uRe]:e.NEVER,[gRe]:e.ALWAYS,[Ore]:e.LESS,[dRe]:e.LEQUAL,[hRe]:e.EQUAL,[mRe]:e.GEQUAL,[fRe]:e.GREATER,[pRe]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return e.isCubeTexture===!0?n=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?n=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?n=t.TEXTURE_3D:n=t.TEXTURE_2D,n}getInternalFormat(e,t,n,r,s=!1){const{gl:o,extensions:a}=this;if(e!==null){if(o[e]!==void 0)return o[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let c=t;if(t===o.RED&&(n===o.FLOAT&&(c=o.R32F),n===o.HALF_FLOAT&&(c=o.R16F),n===o.UNSIGNED_BYTE&&(c=o.R8),n===o.UNSIGNED_SHORT&&(c=o.R16),n===o.UNSIGNED_INT&&(c=o.R32UI),n===o.BYTE&&(c=o.R8I),n===o.SHORT&&(c=o.R16I),n===o.INT&&(c=o.R32I)),t===o.RED_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.R8UI),n===o.UNSIGNED_SHORT&&(c=o.R16UI),n===o.UNSIGNED_INT&&(c=o.R32UI),n===o.BYTE&&(c=o.R8I),n===o.SHORT&&(c=o.R16I),n===o.INT&&(c=o.R32I)),t===o.RG&&(n===o.FLOAT&&(c=o.RG32F),n===o.HALF_FLOAT&&(c=o.RG16F),n===o.UNSIGNED_BYTE&&(c=o.RG8),n===o.UNSIGNED_SHORT&&(c=o.RG16),n===o.UNSIGNED_INT&&(c=o.RG32UI),n===o.BYTE&&(c=o.RG8I),n===o.SHORT&&(c=o.RG16I),n===o.INT&&(c=o.RG32I)),t===o.RG_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RG8UI),n===o.UNSIGNED_SHORT&&(c=o.RG16UI),n===o.UNSIGNED_INT&&(c=o.RG32UI),n===o.BYTE&&(c=o.RG8I),n===o.SHORT&&(c=o.RG16I),n===o.INT&&(c=o.RG32I)),t===o.RGB){const u=s?WL:Rs.getTransfer(r);n===o.FLOAT&&(c=o.RGB32F),n===o.HALF_FLOAT&&(c=o.RGB16F),n===o.UNSIGNED_BYTE&&(c=o.RGB8),n===o.UNSIGNED_SHORT&&(c=o.RGB16),n===o.UNSIGNED_INT&&(c=o.RGB32UI),n===o.BYTE&&(c=o.RGB8I),n===o.SHORT&&(c=o.RGB16I),n===o.INT&&(c=o.RGB32I),n===o.UNSIGNED_BYTE&&(c=u===Fr?o.SRGB8:o.RGB8),n===o.UNSIGNED_SHORT_5_6_5&&(c=o.RGB565),n===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1),n===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGB4),n===o.UNSIGNED_INT_5_9_9_9_REV&&(c=o.RGB9_E5)}if(t===o.RGB_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RGB8UI),n===o.UNSIGNED_SHORT&&(c=o.RGB16UI),n===o.UNSIGNED_INT&&(c=o.RGB32UI),n===o.BYTE&&(c=o.RGB8I),n===o.SHORT&&(c=o.RGB16I),n===o.INT&&(c=o.RGB32I)),t===o.RGBA){const u=s?WL:Rs.getTransfer(r);n===o.FLOAT&&(c=o.RGBA32F),n===o.HALF_FLOAT&&(c=o.RGBA16F),n===o.UNSIGNED_BYTE&&(c=o.RGBA8),n===o.UNSIGNED_SHORT&&(c=o.RGBA16),n===o.UNSIGNED_INT&&(c=o.RGBA32UI),n===o.BYTE&&(c=o.RGBA8I),n===o.SHORT&&(c=o.RGBA16I),n===o.INT&&(c=o.RGBA32I),n===o.UNSIGNED_BYTE&&(c=u===Fr?o.SRGB8_ALPHA8:o.RGBA8),n===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGBA4),n===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1)}return t===o.RGBA_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RGBA8UI),n===o.UNSIGNED_SHORT&&(c=o.RGBA16UI),n===o.UNSIGNED_INT&&(c=o.RGBA32UI),n===o.BYTE&&(c=o.RGBA8I),n===o.SHORT&&(c=o.RGBA16I),n===o.INT&&(c=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(n===o.UNSIGNED_SHORT&&(c=o.DEPTH_COMPONENT16),n===o.UNSIGNED_INT&&(c=o.DEPTH_COMPONENT24),n===o.FLOAT&&(c=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&n===o.UNSIGNED_INT_24_8&&(c=o.DEPTH24_STENCIL8),(c===o.R16F||c===o.R32F||c===o.RG16F||c===o.RG32F||c===o.RGBA16F||c===o.RGBA32F)&&a.get("EXT_color_buffer_float"),c}setTextureParameters(e,t){const{gl:n,extensions:r,backend:s}=this,o=Rs.getPrimaries(Rs.workingColorSpace),a=t.colorSpace===q1?null:Rs.getPrimaries(t.colorSpace),c=t.colorSpace===q1||o===a?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,c),n.texParameteri(e,n.TEXTURE_WRAP_S,YO[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,YO[t.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||n.texParameteri(e,n.TEXTURE_WRAP_R,YO[t.wrapR])),n.texParameteri(e,n.TEXTURE_MAG_FILTER,yQ[t.magFilter]);const u=t.mipmaps!==void 0&&t.mipmaps.length>0,f=t.minFilter===nu&&u?D1:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,yQ[f]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,JSe[t.compareFunction])),r.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===Ma||t.minFilter!==NM&&t.minFilter!==D1||t.type===Xc&&r.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const m=r.get("EXT_texture_filter_anisotropic");n.texParameterf(e,m.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:r}=this,s=this.getGLTextureType(e);let o=r[s];o===void 0&&(o=t.createTexture(),n.state.bindTexture(s,o),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),r[s]=o),n.set(e,{textureGPU:o,glTextureType:s,isDefault:!0})}createTexture(e,t){const{gl:n,backend:r}=this,{levels:s,width:o,height:a,depth:c}=t,u=r.utils.convert(e.format,e.colorSpace),f=r.utils.convert(e.type),m=this.getInternalFormat(e.internalFormat,u,f,e.colorSpace,e.isVideoTexture),v=n.createTexture(),x=this.getGLTextureType(e);r.state.bindTexture(x,v),this.setTextureParameters(x,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,s,m,o,a,c):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,s,m,o,a,c):e.isVideoTexture||n.texStorage2D(x,s,m,o,a),r.set(e,{textureGPU:v,glTextureType:x,glFormat:u,glType:f,glInternalFormat:m})}copyBufferToTexture(e,t){const{gl:n,backend:r}=this,{textureGPU:s,glTextureType:o,glFormat:a,glType:c}=r.get(t),{width:u,height:f}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(o,s),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(o,0,0,0,u,f,a,c,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:r,height:s}=t,{textureGPU:o,glTextureType:a,glFormat:c,glType:u,glInternalFormat:f}=this.backend.get(e);if(!(e.isRenderTargetTexture||o===void 0))if(this.backend.state.bindTexture(a,o),this.setTextureParameters(a,e),e.isCompressedTexture){const m=e.mipmaps,v=t.image;for(let x=0;x<m.length;x++){const T=m[x];e.isCompressedArrayTexture?e.format!==n.RGBA?c!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,x,0,0,0,T.width,T.height,v.depth,c,T.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,x,0,0,0,T.width,T.height,v.depth,c,u,T.data):c!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,x,0,0,T.width,T.height,c,T.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const m=t.images;for(let v=0;v<6;v++){const x=ewe(m[v]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,0,0,r,s,c,u,x)}}else if(e.isDataArrayTexture||e.isArrayTexture){const m=t.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,c,u,m.data)}else if(e.isData3DTexture){const m=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,c,u,m.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(a,0,f,c,u,t.image);else{const m=ewe(t.image);n.texSubImage2D(a,0,0,0,r,s,c,u,m)}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:r,glTextureType:s}=n.get(e);n.state.bindTexture(s,r),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const r=n.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const s in r.framebuffers)t.deleteFramebuffer(r.framebuffers[s]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let s=0;s<r.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(r.msaaRenderbuffers[s]);delete r.msaaRenderbuffers}}}destroyTexture(e){const{gl:t,backend:n}=this,{textureGPU:r,renderTarget:s}=n.get(e);this.deallocateRenderBuffers(s),t.deleteTexture(r),n.delete(e)}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){const{gl:a,backend:c}=this,{state:u}=this.backend,{textureGPU:f,glTextureType:m,glType:v,glFormat:x}=c.get(t);u.bindTexture(m,f);let T,P,R,M,O,C,L,Y,J;const z=e.isCompressedTexture?e.mipmaps[o]:e.image;if(n!==null)T=n.max.x-n.min.x,P=n.max.y-n.min.y,R=n.isBox3?n.max.z-n.min.z:1,M=n.min.x,O=n.min.y,C=n.isBox3?n.min.z:0;else{const je=Math.pow(2,-s);T=Math.floor(z.width*je),P=Math.floor(z.height*je),e.isDataArrayTexture||e.isArrayTexture?R=z.depth:e.isData3DTexture?R=Math.floor(z.depth*je):R=1,M=0,O=0,C=0}r!==null?(L=r.x,Y=r.y,J=r.z):(L=0,Y=0,J=0),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,t.unpackAlignment);const ne=a.getParameter(a.UNPACK_ROW_LENGTH),K=a.getParameter(a.UNPACK_IMAGE_HEIGHT),$=a.getParameter(a.UNPACK_SKIP_PIXELS),he=a.getParameter(a.UNPACK_SKIP_ROWS),Ce=a.getParameter(a.UNPACK_SKIP_IMAGES);a.pixelStorei(a.UNPACK_ROW_LENGTH,z.width),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,z.height),a.pixelStorei(a.UNPACK_SKIP_PIXELS,M),a.pixelStorei(a.UNPACK_SKIP_ROWS,O),a.pixelStorei(a.UNPACK_SKIP_IMAGES,C);const Pe=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isRenderTargetTexture||e.isDepthTexture){const je=c.get(e),ge=c.get(t),Xe=c.get(je.renderTarget),Fe=c.get(ge.renderTarget),Ne=Xe.framebuffers[je.cacheKey],tt=Fe.framebuffers[ge.cacheKey];u.bindFramebuffer(a.READ_FRAMEBUFFER,Ne),u.bindFramebuffer(a.DRAW_FRAMEBUFFER,tt);let mt=a.COLOR_BUFFER_BIT;e.isDepthTexture&&(mt=a.DEPTH_BUFFER_BIT),a.blitFramebuffer(M,O,T,P,L,Y,T,P,mt,a.NEAREST),u.bindFramebuffer(a.READ_FRAMEBUFFER,null),u.bindFramebuffer(a.DRAW_FRAMEBUFFER,null)}else Pe?e.isDataTexture||e.isData3DTexture?a.texSubImage3D(m,o,L,Y,J,T,P,R,x,v,z.data):t.isCompressedArrayTexture?a.compressedTexSubImage3D(m,o,L,Y,J,T,P,R,x,z.data):a.texSubImage3D(m,o,L,Y,J,T,P,R,x,v,z):e.isDataTexture?a.texSubImage2D(m,o,L,Y,T,P,x,v,z.data):e.isCompressedTexture?a.compressedTexSubImage2D(m,o,L,Y,z.width,z.height,x,z.data):a.texSubImage2D(m,o,L,Y,T,P,x,v,z);a.pixelStorei(a.UNPACK_ROW_LENGTH,ne),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,K),a.pixelStorei(a.UNPACK_SKIP_PIXELS,$),a.pixelStorei(a.UNPACK_SKIP_ROWS,he),a.pixelStorei(a.UNPACK_SKIP_IMAGES,Ce),o===0&&t.generateMipmaps&&a.generateMipmap(m),u.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:r}=this,{state:s}=this.backend,{textureGPU:o}=this.backend.get(e),{x:a,y:c,z:u,w:f}=n,m=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,v=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(m){const x=a!==0||c!==0;let T,P;if(e.isDepthTexture===!0?(T=r.DEPTH_BUFFER_BIT,P=r.DEPTH_ATTACHMENT,t.stencil&&(T|=r.STENCIL_BUFFER_BIT)):(T=r.COLOR_BUFFER_BIT,P=r.COLOR_ATTACHMENT0),x){const R=this.backend.get(t.renderTarget),M=R.framebuffers[t.getCacheKey()],O=R.msaaFrameBuffer;s.bindFramebuffer(r.DRAW_FRAMEBUFFER,M),s.bindFramebuffer(r.READ_FRAMEBUFFER,O);const C=v-c-f;r.blitFramebuffer(a,C,a+u,C+f,a,C,a+u,C+f,T,r.NEAREST),s.bindFramebuffer(r.READ_FRAMEBUFFER,M),s.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,a,C,u,f),s.unbindTexture()}else{const R=r.createFramebuffer();s.bindFramebuffer(r.DRAW_FRAMEBUFFER,R),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,P,r.TEXTURE_2D,o,0),r.blitFramebuffer(0,0,u,f,0,0,u,f,T,r.NEAREST),r.deleteFramebuffer(R)}}else s.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,a,v-f-c,u,f),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n,r=!1){const{gl:s}=this,o=t.renderTarget,{depthTexture:a,depthBuffer:c,stencilBuffer:u,width:f,height:m}=o;if(s.bindRenderbuffer(s.RENDERBUFFER,e),c&&!u){let v=s.DEPTH_COMPONENT24;r===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(s.RENDERBUFFER,o.samples,v,f,m):n>0?(a&&a.isDepthTexture&&a.type===s.FLOAT&&(v=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,n,v,f,m)):s.renderbufferStorage(s.RENDERBUFFER,v,f,m),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e)}else c&&u&&(n>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.DEPTH24_STENCIL8,f,m):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,f,m),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e))}async copyTextureToBuffer(e,t,n,r,s,o){const{backend:a,gl:c}=this,{textureGPU:u,glFormat:f,glType:m}=this.backend.get(e),v=c.createFramebuffer();c.bindFramebuffer(c.READ_FRAMEBUFFER,v);const x=e.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+o:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,x,u,0);const T=this._getTypedArrayType(m),P=this._getBytesPerTexel(m,f),M=r*s*P,O=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,O),c.bufferData(c.PIXEL_PACK_BUFFER,M,c.STREAM_READ),c.readPixels(t,n,r,s,f,m,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await a.utils._clientWaitAsync();const C=new T(M/T.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,O),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,C),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.deleteFramebuffer(v),C}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:n}=this;let r=0;if(e===n.UNSIGNED_BYTE&&(r=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(r=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(r=4),t===n.RGBA)return r*4;if(t===n.RGB)return r*3;if(t===n.ALPHA)return r}};function ewe(i){return i.isDataTexture?i.image.data:typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?i:i.data}const Oct=Fct;let Bct=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}};const Lct=Bct;let Uct=class{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}};const zct=Uct,twe={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};let Vct=class{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:r,object:s,type:o,info:a,index:c}=this;c!==0?n.drawElements(r,t,o,e):n.drawArrays(r,e,t),a.update(s,t,1)}renderInstances(e,t,n){const{gl:r,mode:s,type:o,index:a,object:c,info:u}=this;n!==0&&(a!==0?r.drawElementsInstanced(s,t,o,e,n):r.drawArraysInstanced(s,e,t,n),u.update(c,t,n))}renderMultiDraw(e,t,n){const{extensions:r,mode:s,object:o,info:a}=this;if(n===0)return;const c=r.get("WEBGL_multi_draw");if(c===null)for(let u=0;u<n;u++)this.render(e[u],t[u]);else{this.index!==0?c.multiDrawElementsWEBGL(s,t,0,this.type,e,0,n):c.multiDrawArraysWEBGL(s,e,0,t,0,n);let u=0;for(let f=0;f<n;f++)u+=t[f];a.update(o,u,1)}}renderMultiDrawInstances(e,t,n,r){const{extensions:s,mode:o,object:a,info:c}=this;if(n===0)return;const u=s.get("WEBGL_multi_draw");if(u===null)for(let f=0;f<n;f++)this.renderInstances(e[f],t[f],r[f]);else{this.index!==0?u.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,r,0,n):u.multiDrawArraysInstancedWEBGL(o,e,0,t,0,r,0,n);let f=0;for(let m=0;m<n;m++)f+=t[m]*r[m];c.update(a,f,1)}}},Gct=class{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.pendingResolve=!1}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}};const fNe=Gct;let $ct=class extends fNe{constructor(e,t,n=2048){if(super(n),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){console.warn("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let r=0;r<this.maxQueries;r++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return X1(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e.id,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(t==null||this.activeQuery!==null)return;const n=this.queries[t];if(n)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(r){console.error("Error in beginQuery:",r),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(n){console.error("Error in endQuery:",n),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=[];for(const[r,s]of this.queryStates)if(s==="ended"){const o=this.queries[r];e.push(this.resolveQuery(o))}if(e.length===0)return this.lastValue;const n=(await Promise.all(e)).reduce((r,s)=>r+s,0);return this.lastValue=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,n}catch(e){return console.error("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let n,r=!1;const s=()=>{n&&(clearTimeout(n),n=null)},o=c=>{r||(r=!0,s(),t(c))},a=()=>{if(this.isDisposed){o(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){o(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){n=setTimeout(a,1);return}const f=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(f)/1e6)}catch(c){console.error("Error checking query:",c),t(this.lastValue)}};a()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}};const Hct=$ct,nwe=new si;let jct=class extends dNe{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.samples>0,alpha:!0,depth:e.depth,stencil:e.stencil},r=t.context!==void 0?t.context:e.domElement.getContext("webgl2",n);function s(o){o.preventDefault();const a={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(a)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=r,this.extensions=new Lct(this),this.capabilities=new zct(this),this.attributeUtils=new Pct(this),this.textureUtils=new Oct(this),this.bufferRenderer=new Vct(this),this.state=new Ict(this),this.utils=new Dct(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return ac}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,n=null){const r=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:r.RGBA8}),n!==null){const s=e.stencilBuffer?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:s}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e.autoAllocateDepthBuffer===!0&&e.multiview===!1&&console.warn("THREE.WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e.autoAllocateDepthBuffer=!1}}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new Hct(this.gl,t,2048));const n=this.timestampQueryPool[t];n.allocateQueriesForContext(e)!==null&&n.beginQuery(e)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t].endQuery(e)}getContext(){return this.gl}beginRender(e){const{state:t}=this,n=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:s,height:o}=this.getDrawingBufferSize(nwe);t.viewport(0,0,s,o)}if(e.scissor){const{x:s,y:o,width:a,height:c}=e.scissorValue;t.scissor(s,e.height-c-o,a,c)}this.initTimestampQuery(e),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const r=e.occlusionQueryCount;r>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(r),n.occlusionQueryObjects=new Array(r),n.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,r=this.get(e),s=r.previousContext;n.resetVertexState();const o=e.occlusionQueryCount;o>0&&(o>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const a=e.textures;if(a!==null)for(let c=0;c<a.length;c++){const u=a[c];u.generateMipmaps&&this.generateMipmaps(u)}if(this._currentContext=s,e.textures!==null&&e.renderTarget){const c=this.get(e.renderTarget),{resolveDepthBuffer:u,samples:f}=e.renderTarget;if(f>0&&this._useMultisampledExtension(e.renderTarget)===!1){const m=c.framebuffers[e.getCacheKey()],v=t.COLOR_BUFFER_BIT,x=c.msaaFrameBuffer,T=e.textures;n.bindFramebuffer(t.READ_FRAMEBUFFER,x),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,m);for(let P=0;P<T.length;P++)if(e.scissor){const{x:R,y:M,width:O,height:C}=e.scissorValue,L=e.height-C-M;t.blitFramebuffer(R,L,R+O,L+C,R,L,R+O,L+C,v,t.NEAREST),this._supportsInvalidateFramebuffer===!0&&t.invalidateSubFramebuffer(t.READ_FRAMEBUFFER,c.invalidationArray,R,L,O,C)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,v,t.NEAREST),this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,c.invalidationArray)}else if(u===!1&&c.framebuffers){const m=c.framebuffers[e.getCacheKey()];n.bindFramebuffer(t.DRAW_FRAMEBUFFER,m),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,c.depthInvalidationArray)}}if(s!==null)if(this._setFramebuffer(s),s.viewport)this.updateViewport(s);else{const{width:c,height:u}=this.getDrawingBufferSize(nwe);n.viewport(0,0,c,u)}this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const s=new WeakSet,{gl:o}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const a=()=>{let c=0;for(let u=0;u<n.length;u++){const f=n[u];f!==null&&o.getQueryParameter(f,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(f,o.QUERY_RESULT)===0&&s.add(r[u]),n[u]=null,o.deleteQuery(f),c++)}c<n.length?requestAnimationFrame(a):t.occluded=s};a()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:r,width:s,height:o}=e.viewportValue;t.viewport(n,e.height-o-r,s,o)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n,r=null,s=!0){const{gl:o,renderer:a}=this;r===null&&(r={textures:null,clearColorValue:this.getClearColor()});let c=0;if(e&&(c|=o.COLOR_BUFFER_BIT),t&&(c|=o.DEPTH_BUFFER_BIT),n&&(c|=o.STENCIL_BUFFER_BIT),c!==0){let u;r.clearColorValue?u=r.clearColorValue:u=this.getClearColor();const f=a.getClearDepth(),m=a.getClearStencil();if(t&&this.state.setDepthMask(!0),r.textures===null)o.clearColor(u.r,u.g,u.b,u.a),o.clear(c);else{if(s&&this._setFramebuffer(r),e)for(let v=0;v<r.textures.length;v++)v===0?o.clearBufferfv(o.COLOR,v,[u.r,u.g,u.b,u.a]):o.clearBufferfv(o.COLOR,v,[0,0,0,1]);t&&n?o.clearBufferfi(o.DEPTH_STENCIL,0,f,m):t?o.clearBufferfv(o.DEPTH,0,[f]):n&&o.clearBufferiv(o.STENCIL,0,[m])}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,t,n,r){const{state:s,gl:o}=this;this.discard===!1&&(o.enable(o.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:a,transformBuffers:c,attributes:u}=this.get(r),f=this._getVaoKey(u),m=this.vaoCache[f];m===void 0?this._createVao(u):s.setVertexState(m),s.useProgram(a),this._bindUniforms(n);const v=this._getTransformFeedback(c);o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,v),o.beginTransformFeedback(o.POINTS),u[0].isStorageInstancedBufferAttribute?o.drawArraysInstanced(o.POINTS,0,1,t.count):o.drawArrays(o.POINTS,0,t.count),o.endTransformFeedback(),o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null);for(let x=0;x<c.length;x++){const T=c[x];T.pbo&&this.textureUtils.copyBufferToTexture(T.transformBuffer,T.pbo),T.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:n,material:r,context:s,hardwareClippingPlanes:o}=e,{programGPU:a}=this.get(n),{gl:c,state:u}=this,f=this.get(s),m=e.getDrawParameters();if(m===null)return;this._bindUniforms(e.getBindings());const v=t.isMesh&&t.matrixWorld.determinant()<0;u.setMaterial(r,v,o),u.useProgram(a);const x=this.get(e);let T=x.staticVao;if(T===void 0||x.geometryId!==e.geometry.id){const z=this._getVaoKey(e.getAttributes());if(T=this.vaoCache[z],T===void 0){let ne;({vaoGPU:T,staticVao:ne}=this._createVao(e.getAttributes())),ne&&(x.staticVao=T,x.geometryId=e.geometry.id)}}const P=e.getIndex(),R=P!==null?this.get(P).bufferGPU:null;u.setVertexState(T,R);const M=f.lastOcclusionObject;if(M!==t&&M!==void 0){if(M!==null&&M.occlusionTest===!0&&(c.endQuery(c.ANY_SAMPLES_PASSED),f.occlusionQueryIndex++),t.occlusionTest===!0){const z=c.createQuery();c.beginQuery(c.ANY_SAMPLES_PASSED,z),f.occlusionQueries[f.occlusionQueryIndex]=z,f.occlusionQueryObjects[f.occlusionQueryIndex]=t}f.lastOcclusionObject=t}const O=this.bufferRenderer;t.isPoints?O.mode=c.POINTS:t.isLineSegments?O.mode=c.LINES:t.isLine?O.mode=c.LINE_STRIP:t.isLineLoop?O.mode=c.LINE_LOOP:r.wireframe===!0?(u.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),O.mode=c.LINES):O.mode=c.TRIANGLES;const{vertexCount:C,instanceCount:L}=m;let{firstVertex:Y}=m;if(O.object=t,P!==null){Y*=P.array.BYTES_PER_ELEMENT;const z=this.get(P);O.index=P.count,O.type=z.type}else O.index=0;const J=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(X1("THREE.WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),O.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?O.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):X1("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):L>1?O.renderInstances(Y,C,L):O.render(Y,C)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const z=this.get(e.camera),ne=e.camera.cameras,K=e.getBindingGroup("cameraIndex").bindings[0];if(z.indexesGPU===void 0||z.indexesGPU.length!==ne.length){const ge=new Uint32Array([0,0,0,0]),Xe=[];for(let Fe=0,Ne=ne.length;Fe<Ne;Fe++){const tt=c.createBuffer();ge[0]=Fe,c.bindBuffer(c.UNIFORM_BUFFER,tt),c.bufferData(c.UNIFORM_BUFFER,ge,c.STATIC_DRAW),Xe.push(tt)}z.indexesGPU=Xe}const $=this.get(K),he=this.renderer.getPixelRatio(),Ce=this._currentContext.renderTarget,Pe=this._isRenderCameraDepthArray(this._currentContext),je=this._currentContext.activeCubeFace;if(Pe){const ge=this.get(Ce.depthTexture);if(ge.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){ge.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:Xe}=Ce;for(let Fe=0,Ne=ne.length;Fe<Ne;Fe++)this.renderer._activeCubeFace=Fe,this._currentContext.activeCubeFace=Fe,this._setFramebuffer(this._currentContext),this.clear(!1,!0,Xe,this._currentContext,!1);this.renderer._activeCubeFace=je,this._currentContext.activeCubeFace=je}}for(let ge=0,Xe=ne.length;ge<Xe;ge++){const Fe=ne[ge];if(t.layers.test(Fe.layers)){Pe&&(this.renderer._activeCubeFace=ge,this._currentContext.activeCubeFace=ge,this._setFramebuffer(this._currentContext));const Ne=Fe.viewport;if(Ne!==void 0){const tt=Ne.x*he,mt=Ne.y*he,Ht=Ne.width*he,pn=Ne.height*he;u.viewport(Math.floor(tt),Math.floor(e.context.height-pn-mt),Math.floor(Ht),Math.floor(pn))}u.bindBufferBase(c.UNIFORM_BUFFER,$.index,z.indexesGPU[ge]),J()}this._currentContext.activeCubeFace=je,this.renderer._activeCubeFace=je}}else J()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,r,s,o){return this.textureUtils.copyTextureToBuffer(e,t,n,r,s,o)}createSampler(){}destroySampler(){}createNodeBuilder(e,t){return new Ect(e,t)}createProgram(e){const t=this.gl,{stage:n,code:r}=e,s=n==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,r),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,r=e.pipeline,{fragmentProgram:s,vertexProgram:o}=r,a=n.createProgram(),c=this.get(s).shaderGPU,u=this.get(o).shaderGPU;if(n.attachShader(a,c),n.attachShader(a,u),n.linkProgram(a),this.set(r,{programGPU:a,fragmentShader:c,vertexShader:u}),t!==null&&this.parallel){const f=new Promise(m=>{const v=this.parallel,x=()=>{n.getProgramParameter(a,v.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),m()):requestAnimationFrame(x)};x()});t.push(f);return}this._completeCompile(e,r)}_handleSource(e,t){const n=e.split(`
`),r=[],s=Math.max(t-6,0),o=Math.min(t+6,n.length);for(let a=s;a<o;a++){const c=a+1;r.push(`${c===t?">":" "} ${c}: ${n[a]}`)}return r.join(`
`)}_getShaderErrors(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),s=e.getShaderInfoLog(t).trim();if(r&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const a=parseInt(o[1]);return n.toUpperCase()+`

`+s+`

`+this._handleSource(e.getShaderSource(t),a)}else return s}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const r=this.gl,s=r.getProgramInfoLog(e).trim();if(r.getProgramParameter(e,r.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(r,e,n,t);else{const o=this._getShaderErrors(r,n,"vertex"),a=this._getShaderErrors(r,t,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(e,r.VALIDATE_STATUS)+`

Program Info Log: `+s+`
`+o+`
`+a)}else s!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",s)}}_completeCompile(e,t){const{state:n,gl:r}=this,s=this.get(t),{programGPU:o,fragmentShader:a,vertexShader:c}=s;r.getProgramParameter(o,r.LINK_STATUS)===!1&&this._logProgramError(o,a,c),n.useProgram(o);const u=e.getBindings();this._setupBindings(u,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:n,gl:r}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:o}=e,a=r.createProgram(),c=this.get(s).shaderGPU,u=this.get(o).shaderGPU,f=o.transforms,m=[],v=[];for(let R=0;R<f.length;R++){const M=f[R];m.push(M.varyingName),v.push(M.attributeNode)}r.attachShader(a,c),r.attachShader(a,u),r.transformFeedbackVaryings(a,m,r.SEPARATE_ATTRIBS),r.linkProgram(a),r.getProgramParameter(a,r.LINK_STATUS)===!1&&this._logProgramError(a,c,u),n.useProgram(a),this._setupBindings(t,a);const x=o.attributes,T=[],P=[];for(let R=0;R<x.length;R++){const M=x[R].node.attribute;T.push(M),this.has(M)||this.attributeUtils.createAttribute(M,r.ARRAY_BUFFER)}for(let R=0;R<v.length;R++){const M=v[R].attribute;this.has(M)||this.attributeUtils.createAttribute(M,r.ARRAY_BUFFER);const O=this.get(M);P.push(O)}this.set(e,{programGPU:a,transformBuffers:P,attributes:T})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let n=0,r=0;for(const s of t){this.set(s,{textures:r,uniformBuffers:n});for(const o of s.bindings)o.isUniformBuffer&&n++,o.isSampledTexture&&r++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let r=n.uniformBuffers,s=n.textures;for(const o of e.bindings)if(o.isUniformsGroup||o.isUniformBuffer){const a=o.buffer,c=t.createBuffer();t.bindBuffer(t.UNIFORM_BUFFER,c),t.bufferData(t.UNIFORM_BUFFER,a,t.DYNAMIC_DRAW),this.set(o,{index:r++,bufferGPU:c})}else if(o.isSampledTexture){const{textureGPU:a,glTextureType:c}=this.get(o.texture);this.set(o,{index:s++,textureGPU:a,glTextureType:c})}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const r=this.get(e).bufferGPU,s=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(twe).filter(r=>twe[r]===e),n=this.extensions;for(let r=0;r<t.length;r++)if(n.has(t[r]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){this.textureUtils.copyTextureToTexture(e,t,n,r,s,o)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){const{gl:t,state:n}=this;let r=null;if(e.textures!==null){const s=e.renderTarget,o=this.get(s),{samples:a,depthBuffer:c,stencilBuffer:u}=s,f=s.isWebGLCubeRenderTarget===!0,m=s.isRenderTarget3D===!0,v=s.depth>1,x=s.isXRRenderTarget===!0,T=x===!0&&s.hasExternalTextures===!0;let P=o.msaaFrameBuffer,R=o.depthRenderbuffer;const M=this.extensions.get("WEBGL_multisampled_render_to_texture"),O=this.extensions.get("OVR_multiview2"),C=this._useMultisampledExtension(s),L=CRe(e);let Y;if(f?(o.cubeFramebuffers||(o.cubeFramebuffers={}),Y=o.cubeFramebuffers[L]):x&&T===!1?Y=this._xrFramebuffer:(o.framebuffers||(o.framebuffers={}),Y=o.framebuffers[L]),Y===void 0){Y=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,Y);const J=e.textures,z=[];if(f){o.cubeFramebuffers[L]=Y;const{textureGPU:K}=this.get(J[0]),$=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+$,K,0)}else{o.framebuffers[L]=Y;for(let K=0;K<J.length;K++){const $=J[K],he=this.get($);he.renderTarget=e.renderTarget,he.cacheKey=L;const Ce=t.COLOR_ATTACHMENT0+K;if(s.multiview)O.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,Ce,he.textureGPU,0,a,0,2);else if(m||v){const Pe=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,Ce,he.textureGPU,0,Pe)}else C?M.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,Ce,t.TEXTURE_2D,he.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,Ce,t.TEXTURE_2D,he.textureGPU,0)}n.drawBuffers(e,Y)}const ne=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s.autoAllocateDepthBuffer===!0){const K=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(K,e,0,C),o.xrDepthRenderbuffer=K,z.push(u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,K),t.framebufferRenderbuffer(t.FRAMEBUFFER,ne,t.RENDERBUFFER,K)}else if(e.depthTexture!==null){z.push(u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const K=this.get(e.depthTexture);if(K.renderTarget=e.renderTarget,K.cacheKey=L,s.multiview)O.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,ne,K.textureGPU,0,a,0,2);else if(T&&C)M.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,ne,t.TEXTURE_2D,K.textureGPU,0,a);else if(e.depthTexture.isArrayTexture){const $=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,ne,K.textureGPU,0,$)}else t.framebufferTexture2D(t.FRAMEBUFFER,ne,t.TEXTURE_2D,K.textureGPU,0)}o.depthInvalidationArray=z}else{if(this._isRenderCameraDepthArray(e)){n.bindFramebuffer(t.FRAMEBUFFER,Y);const z=this.renderer._activeCubeFace,ne=this.get(e.depthTexture),K=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,K,ne.textureGPU,0,z)}if(x||C||s.multiview){n.bindFramebuffer(t.FRAMEBUFFER,Y);const z=this.get(e.textures[0]);s.multiview?O.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,z.textureGPU,0,a,0,2):C?M.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,z.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,z.textureGPU,0);const ne=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s.autoAllocateDepthBuffer===!0){const K=o.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,K),t.framebufferRenderbuffer(t.FRAMEBUFFER,ne,t.RENDERBUFFER,K)}else{const K=this.get(e.depthTexture);s.multiview?O.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,ne,K.textureGPU,0,a,0,2):C?M.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,ne,t.TEXTURE_2D,K.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,ne,t.TEXTURE_2D,K.textureGPU,0)}}}if(a>0&&C===!1&&!s.multiview){if(P===void 0){const J=[];P=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,P);const z=[],ne=e.textures;for(let K=0;K<ne.length;K++){if(z[K]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,z[K]),J.push(t.COLOR_ATTACHMENT0+K),c){const Ce=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;J.push(Ce)}const $=e.textures[K],he=this.get($);t.renderbufferStorageMultisample(t.RENDERBUFFER,a,he.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+K,t.RENDERBUFFER,z[K])}if(o.msaaFrameBuffer=P,o.msaaRenderbuffers=z,R===void 0){R=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(R,e,a),o.depthRenderbuffer=R;const K=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;J.push(K)}o.invalidationArray=J}r=o.msaaFrameBuffer}else r=Y}n.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){const r=this.get(e[n]);t+=":"+r.id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();let r="",s=!0;t.bindVertexArray(n);for(let o=0;o<e.length;o++){const a=e[o],c=this.get(a);r+=":"+c.id,t.bindBuffer(t.ARRAY_BUFFER,c.bufferGPU),t.enableVertexAttribArray(o),(a.isStorageBufferAttribute||a.isStorageInstancedBufferAttribute)&&(s=!1);let u,f;a.isInterleavedBufferAttribute===!0?(u=a.data.stride*c.bytesPerElement,f=a.offset*c.bytesPerElement):(u=0,f=0),c.isInteger?t.vertexAttribIPointer(o,a.itemSize,c.type,u,f):t.vertexAttribPointer(o,a.itemSize,c.type,a.normalized,u,f),a.isInstancedBufferAttribute&&!a.isInterleavedBufferAttribute?t.vertexAttribDivisor(o,a.meshPerAttribute):a.isInterleavedBufferAttribute&&a.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(o,a.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),this.vaoCache[r]=n,{vaoGPU:n,staticVao:s}}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let n=this.transformFeedbackCache[t];if(n!==void 0)return n;const{gl:r}=this;n=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n);for(let s=0;s<e.length;s++){const o=e[s];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,s,o.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const r of e)for(const s of r.bindings){const a=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const c=n.getUniformBlockIndex(t,s.name);n.uniformBlockBinding(t,c,a)}else if(s.isSampledTexture){const c=n.getUniformLocation(t,s.name);n.uniform1i(c,a)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const r of e)for(const s of r.bindings){const o=this.get(s),a=o.index;s.isUniformsGroup||s.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,a,o.bufferGPU):s.isSampledTexture&&n.bindTexture(o.glTextureType,o.textureGPU,t.TEXTURE0+a)}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e.autoAllocateDepthBuffer!==!1}dispose(){const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}};const rwe=jct,H6={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},hl={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},S0={Store:"store",Discard:"discard"},ji={Load:"load",Clear:"clear"},vQ={CCW:"ccw",CW:"cw"},_Q={None:"none",Front:"front",Back:"back"},nx={Uint16:"uint16",Uint32:"uint32"},ze={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Stencil8:"stencil8",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},xQ={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Ly={Linear:"linear",Nearest:"nearest"},Ur={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},uy={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},iwe={None:0,Red:1,Green:2,Blue:4,Alpha:8,All:15},n2={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},bQ={Uniform:"uniform",Storage:"storage",ReadOnlyStorage:"read-only-storage"},SQ={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},swe={Filtering:"filtering",NonFiltering:"non-filtering",Comparison:"comparison"},hy={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},owe={OneD:"1d",TwoD:"2d",ThreeD:"3d"},ja={OneD:"1d",TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",CubeArray:"cube-array",ThreeD:"3d"},Wct={All:"all",StencilOnly:"stencil-only",DepthOnly:"depth-only"},KO={Vertex:"vertex",Instance:"instance"},wte={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};let qct=class extends Eie{constructor(e,t){super(e),this.texture=t,this.version=t?t.version:0,this.isSampler=!0}};const Xct=qct;let Yct=class extends Xct{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){this.texture=this.textureNode.value}};const Kct=Yct;let Zct=class extends oNe{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}};const Qct=Zct;let Jct=0,eut=class extends Qct{constructor(e,t){super("StorageBuffer_"+Jct++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:M1.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}};const tut=eut;let nut=class extends n3{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,n=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Ly.Linear}),this.flipYSampler=e.createSampler({minFilter:Ly.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:n}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:r})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:H6.TriangleStrip,stripIndexFormat:nx.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:H6.TriangleStrip,stripIndexFormat:nx.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,n=0){const r=t.format,{width:s,height:o}=t.size,a=this.getTransferPipeline(r),c=this.getFlipYPipeline(r),u=this.device.createTexture({size:{width:s,height:o,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),f=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:ja.TwoD,baseArrayLayer:n}),m=u.createView({baseMipLevel:0,mipLevelCount:1,dimension:ja.TwoD,baseArrayLayer:0}),v=this.device.createCommandEncoder({}),x=(T,P,R)=>{const M=T.getBindGroupLayout(0),O=this.device.createBindGroup({layout:M,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:P}]}),C=v.beginRenderPass({colorAttachments:[{view:R,loadOp:ji.Clear,storeOp:S0.Store,clearValue:[0,0,0,0]}]});C.setPipeline(T),C.setBindGroup(0,O),C.draw(4,1,0,0),C.end()};x(a,f,m),x(c,m,f),this.device.queue.submit([v.finish()]),u.destroy()}generateMipmaps(e,t,n=0){const r=this.get(e);r.useCount===void 0&&(r.useCount=0,r.layers=[]);const s=r.layers[n]||this._mipmapCreateBundles(e,t,n),o=this.device.createCommandEncoder({});this._mipmapRunBundles(o,s),this.device.queue.submit([o.finish()]),r.useCount!==0&&(r.layers[n]=s),r.useCount++}_mipmapCreateBundles(e,t,n){const r=this.getTransferPipeline(t.format),s=r.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:ja.TwoD,baseArrayLayer:n});const a=[];for(let c=1;c<t.mipLevelCount;c++){const u=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),f=e.createView({baseMipLevel:c,mipLevelCount:1,dimension:ja.TwoD,baseArrayLayer:n}),m={colorAttachments:[{view:f,loadOp:ji.Clear,storeOp:S0.Store,clearValue:[0,0,0,0]}]},v=this.device.createRenderBundleEncoder({colorFormats:[t.format]});v.setPipeline(r),v.setBindGroup(0,u),v.draw(4,1,0,0),a.push({renderBundles:[v.finish()],passDescriptor:m}),o=f}return a}_mipmapRunBundles(e,t){const n=t.length;for(let r=0;r<n;r++){const s=t[r],o=e.beginRenderPass(s.passDescriptor);o.executeBundles(s.renderBundles),o.end()}}};const rut=nut,iut={[uRe]:"never",[Ore]:"less",[hRe]:"equal",[dRe]:"less-equal",[fRe]:"greater",[mRe]:"greater-equal",[gRe]:"always",[pRe]:"not-equal"},sut=[0,1,3,2,4,5];let out=class{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new jf,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,n=t.device,r=t.get(e),s={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};s.magFilter===Ly.Linear&&s.minFilter===Ly.Linear&&s.mipmapFilter===Ly.Linear&&(s.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(s.compare=iut[e.compareFunction]),r.sampler=n.createSampler(s)}createDefaultTexture(e){let t;const n=Tte(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(n):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():t=this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e,t={}){const n=this.backend,r=n.get(e);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:o,depth:a,levels:c}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const u=this._getDimension(e),f=e.internalFormat||t.format||Tte(e,n.device);r.format=f;const{samples:m,primarySamples:v,isMSAA:x}=n.utils.getTextureSampleData(e);let T=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(T|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&(T|=GPUTextureUsage.RENDER_ATTACHMENT);const P={label:e.name,size:{width:s,height:o,depthOrArrayLayers:a},mipLevelCount:c,sampleCount:v,dimension:u,format:f,usage:T};if(e.isVideoTexture){const R=e.source.data,M=new VideoFrame(R);P.size.width=M.displayWidth,P.size.height=M.displayHeight,M.close(),r.externalTexture=R}else{if(f===void 0){console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}e.isCubeTexture&&(P.textureBindingViewDimension=ja.Cube),r.texture=n.device.createTexture(P)}if(x){const R=Object.assign({},P);R.label=R.label+"-msaa",R.sampleCount=m,r.msaaTexture=n.device.createTexture(R)}r.initialized=!0,r.textureDescriptorGPU=P}destroyTexture(e){const t=this.backend,n=t.get(e);n.texture!==void 0&&n.texture.destroy(),n.msaaTexture!==void 0&&n.msaaTexture.destroy(),t.delete(e)}destroySampler(e){const n=this.backend.get(e);delete n.sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let n=0;n<6;n++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,n);else{const n=e.image.depth||1;for(let r=0;r<n;r++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,r)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:n}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:n,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,t=!1){const n=this.backend,{width:r,height:s}=n.getDrawingBufferSize(),o=this.depthTexture,a=n.get(o).texture;let c,u;if(t?(c=F1,u=B2):e&&(c=Hf,u=Uo),a!==void 0){if(o.image.width===r&&o.image.height===s&&o.format===c&&o.type===u)return a;this.destroyTexture(o)}return o.name="depthBuffer",o.format=c,o.type=u,o.image.width=r,o.image.height=s,this.createTexture(o,{width:r,height:s}),n.get(o).texture}updateTexture(e,t){const n=this.backend.get(e),{textureDescriptorGPU:r}=n;if(!(e.isRenderTargetTexture||r===void 0)){if(e.isDataTexture)this._copyBufferToTexture(t.image,n.texture,r,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let s=0;s<t.image.depth;s++)this._copyBufferToTexture(t.image,n.texture,r,s,e.flipY,s);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,r);else if(e.isCubeTexture)this._copyCubeMapToTexture(t.images,n.texture,r,e.flipY,e.premultiplyAlpha);else if(e.isVideoTexture){const s=e.source.data;n.externalTexture=s}else this._copyImageToTexture(t.image,n.texture,r,0,e.flipY,e.premultiplyAlpha);n.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,t,n,r,s,o){const a=this.backend.device,c=this.backend.get(e),u=c.texture,f=c.textureDescriptorGPU.format,m=this._getBytesPerTexel(f);let v=r*m;v=Math.ceil(v/256)*256;const x=a.createBuffer({size:r*s*m,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),T=a.createCommandEncoder();T.copyTextureToBuffer({texture:u,origin:{x:t,y:n,z:o}},{buffer:x,bytesPerRow:v},{width:r,height:s});const P=this._getTypedArrayType(f);a.queue.submit([T.finish()]),await x.mapAsync(GPUMapMode.READ);const R=x.getMappedRange();return new P(R)}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new Kl;n.minFilter=Ma,n.magFilter=Ma,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new lz;n.minFilter=Ma,n.magFilter=Ma,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(e===null){const t={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),t)}return e}_copyCubeMapToTexture(e,t,n,r,s){for(let o=0;o<6;o++){const a=e[o],c=r===!0?sut[o]:o;a.isDataTexture?this._copyBufferToTexture(a.image,t,n,c,r):this._copyImageToTexture(a,t,n,c,r,s)}}_copyImageToTexture(e,t,n,r,s,o){this.backend.device.queue.copyExternalImageToTexture({source:e,flipY:s},{texture:t,mipLevel:0,origin:{x:0,y:0,z:r},premultipliedAlpha:o},{width:e.width,height:e.height,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new rut(this.backend.device)),e}_generateMipmaps(e,t,n=0){this._getPassUtils().generateMipmaps(e,t,n)}_flipY(e,t,n=0){this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,r,s,o=0){const a=this.backend.device,c=e.data,u=this._getBytesPerTexel(n.format),f=e.width*u;a.queue.writeTexture({texture:t,mipLevel:0,origin:{x:0,y:0,z:r}},c,{offset:e.width*e.height*u*o,bytesPerRow:f},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,n,r)}_copyCompressedBufferToTexture(e,t,n){const r=this.backend.device,s=this._getBlockData(n.format),o=n.size.depthOrArrayLayers>1;for(let a=0;a<e.length;a++){const c=e[a],u=c.width,f=c.height,m=o?n.size.depthOrArrayLayers:1,v=Math.ceil(u/s.width)*s.byteLength,x=v*Math.ceil(f/s.height);for(let T=0;T<m;T++)r.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:T}},c.data,{offset:T*x,bytesPerRow:v,rowsPerImage:Math.ceil(f/s.height)},{width:Math.ceil(u/s.width)*s.width,height:Math.ceil(f/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===ze.BC1RGBAUnorm||e===ze.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===ze.BC2RGBAUnorm||e===ze.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ze.BC3RGBAUnorm||e===ze.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ze.BC4RUnorm||e===ze.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===ze.BC5RGUnorm||e===ze.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===ze.BC6HRGBUFloat||e===ze.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===ze.BC7RGBAUnorm||e===ze.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ze.ETC2RGB8Unorm||e===ze.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ze.ETC2RGB8A1Unorm||e===ze.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ze.ETC2RGBA8Unorm||e===ze.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ze.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===ze.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===ze.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===ze.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===ze.ASTC4x4Unorm||e===ze.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ze.ASTC5x4Unorm||e===ze.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===ze.ASTC5x5Unorm||e===ze.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===ze.ASTC6x5Unorm||e===ze.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===ze.ASTC6x6Unorm||e===ze.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===ze.ASTC8x5Unorm||e===ze.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===ze.ASTC8x6Unorm||e===ze.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===ze.ASTC8x8Unorm||e===ze.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===ze.ASTC10x5Unorm||e===ze.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===ze.ASTC10x6Unorm||e===ze.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===ze.ASTC10x8Unorm||e===ze.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===ze.ASTC10x10Unorm||e===ze.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===ze.ASTC12x10Unorm||e===ze.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===ze.ASTC12x12Unorm||e===ze.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=xQ.ClampToEdge;return e===K_?t=xQ.Repeat:e===Z_&&(t=xQ.MirrorRepeat),t}_convertFilterMode(e){let t=Ly.Linear;return(e===Ma||e===lRe||e===NM)&&(t=Ly.Nearest),t}_getBytesPerTexel(e){if(e===ze.R8Unorm||e===ze.R8Snorm||e===ze.R8Uint||e===ze.R8Sint)return 1;if(e===ze.R16Uint||e===ze.R16Sint||e===ze.R16Float||e===ze.RG8Unorm||e===ze.RG8Snorm||e===ze.RG8Uint||e===ze.RG8Sint)return 2;if(e===ze.R32Uint||e===ze.R32Sint||e===ze.R32Float||e===ze.RG16Uint||e===ze.RG16Sint||e===ze.RG16Float||e===ze.RGBA8Unorm||e===ze.RGBA8UnormSRGB||e===ze.RGBA8Snorm||e===ze.RGBA8Uint||e===ze.RGBA8Sint||e===ze.BGRA8Unorm||e===ze.BGRA8UnormSRGB||e===ze.RGB9E5UFloat||e===ze.RGB10A2Unorm||e===ze.RG11B10UFloat||e===ze.Depth32Float||e===ze.Depth24Plus||e===ze.Depth24PlusStencil8||e===ze.Depth32FloatStencil8)return 4;if(e===ze.RG32Uint||e===ze.RG32Sint||e===ze.RG32Float||e===ze.RGBA16Uint||e===ze.RGBA16Sint||e===ze.RGBA16Float)return 8;if(e===ze.RGBA32Uint||e===ze.RGBA32Sint||e===ze.RGBA32Float)return 16}_getTypedArrayType(e){if(e===ze.R8Uint)return Uint8Array;if(e===ze.R8Sint)return Int8Array;if(e===ze.R8Unorm)return Uint8Array;if(e===ze.R8Snorm)return Int8Array;if(e===ze.RG8Uint)return Uint8Array;if(e===ze.RG8Sint)return Int8Array;if(e===ze.RG8Unorm)return Uint8Array;if(e===ze.RG8Snorm)return Int8Array;if(e===ze.RGBA8Uint)return Uint8Array;if(e===ze.RGBA8Sint)return Int8Array;if(e===ze.RGBA8Unorm)return Uint8Array;if(e===ze.RGBA8Snorm)return Int8Array;if(e===ze.R16Uint)return Uint16Array;if(e===ze.R16Sint)return Int16Array;if(e===ze.RG16Uint)return Uint16Array;if(e===ze.RG16Sint)return Int16Array;if(e===ze.RGBA16Uint)return Uint16Array;if(e===ze.RGBA16Sint)return Int16Array;if(e===ze.R16Float||e===ze.RG16Float||e===ze.RGBA16Float)return Uint16Array;if(e===ze.R32Uint)return Uint32Array;if(e===ze.R32Sint)return Int32Array;if(e===ze.R32Float)return Float32Array;if(e===ze.RG32Uint)return Uint32Array;if(e===ze.RG32Sint)return Int32Array;if(e===ze.RG32Float)return Float32Array;if(e===ze.RGBA32Uint)return Uint32Array;if(e===ze.RGBA32Sint)return Int32Array;if(e===ze.RGBA32Float)return Float32Array;if(e===ze.BGRA8Unorm||e===ze.BGRA8UnormSRGB)return Uint8Array;if(e===ze.RGB10A2Unorm||e===ze.RGB9E5UFloat||e===ze.RG11B10UFloat)return Uint32Array;if(e===ze.Depth32Float)return Float32Array;if(e===ze.Depth24Plus||e===ze.Depth24PlusStencil8)return Uint32Array;if(e===ze.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.isData3DTexture?t=owe.ThreeD:t=owe.TwoD,t}};function Tte(i,e=null){const t=i.format,n=i.type,r=i.colorSpace,s=Rs.getTransfer(r);let o;if(i.isCompressedTexture===!0||i.isCompressedArrayTexture===!0)switch(t){case VB:o=s===Fr?ze.BC1RGBAUnormSRGB:ze.BC1RGBAUnorm;break;case GB:o=s===Fr?ze.BC2RGBAUnormSRGB:ze.BC2RGBAUnorm;break;case $B:o=s===Fr?ze.BC3RGBAUnormSRGB:ze.BC3RGBAUnorm;break;case qee:o=s===Fr?ze.ETC2RGB8UnormSRGB:ze.ETC2RGB8Unorm;break;case Xee:o=s===Fr?ze.ETC2RGBA8UnormSRGB:ze.ETC2RGBA8Unorm;break;case Yee:o=s===Fr?ze.ASTC4x4UnormSRGB:ze.ASTC4x4Unorm;break;case Kee:o=s===Fr?ze.ASTC5x4UnormSRGB:ze.ASTC5x4Unorm;break;case Zee:o=s===Fr?ze.ASTC5x5UnormSRGB:ze.ASTC5x5Unorm;break;case Qee:o=s===Fr?ze.ASTC6x5UnormSRGB:ze.ASTC6x5Unorm;break;case Jee:o=s===Fr?ze.ASTC6x6UnormSRGB:ze.ASTC6x6Unorm;break;case ete:o=s===Fr?ze.ASTC8x5UnormSRGB:ze.ASTC8x5Unorm;break;case tte:o=s===Fr?ze.ASTC8x6UnormSRGB:ze.ASTC8x6Unorm;break;case nte:o=s===Fr?ze.ASTC8x8UnormSRGB:ze.ASTC8x8Unorm;break;case rte:o=s===Fr?ze.ASTC10x5UnormSRGB:ze.ASTC10x5Unorm;break;case ite:o=s===Fr?ze.ASTC10x6UnormSRGB:ze.ASTC10x6Unorm;break;case ste:o=s===Fr?ze.ASTC10x8UnormSRGB:ze.ASTC10x8Unorm;break;case ote:o=s===Fr?ze.ASTC10x10UnormSRGB:ze.ASTC10x10Unorm;break;case ate:o=s===Fr?ze.ASTC12x10UnormSRGB:ze.ASTC12x10Unorm;break;case lte:o=s===Fr?ze.ASTC12x12UnormSRGB:ze.ASTC12x12Unorm;break;case Xu:o=s===Fr?ze.RGBA8UnormSRGB:ze.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case Xu:switch(n){case FE:o=ze.RGBA8Snorm;break;case OE:o=ze.RGBA16Sint;break;case U6:o=ze.RGBA16Uint;break;case Uo:o=ze.RGBA32Uint;break;case M0:o=ze.RGBA32Sint;break;case N0:o=s===Fr?ze.RGBA8UnormSRGB:ze.RGBA8Unorm;break;case qu:o=ze.RGBA16Float;break;case Xc:o=ze.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case Nre:switch(n){case cRe:o=ze.RGB9E5UFloat;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case Ire:switch(n){case FE:o=ze.R8Snorm;break;case OE:o=ze.R16Sint;break;case U6:o=ze.R16Uint;break;case Uo:o=ze.R32Uint;break;case M0:o=ze.R32Sint;break;case N0:o=ze.R8Unorm;break;case qu:o=ze.R16Float;break;case Xc:o=ze.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case Ky:switch(n){case FE:o=ze.RG8Snorm;break;case OE:o=ze.RG16Sint;break;case U6:o=ze.RG16Uint;break;case Uo:o=ze.RG32Uint;break;case M0:o=ze.RG32Sint;break;case N0:o=ze.RG8Unorm;break;case qu:o=ze.RG16Float;break;case Xc:o=ze.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case Hf:switch(n){case U6:o=ze.Depth16Unorm;break;case Uo:o=ze.Depth24Plus;break;case Xc:o=ze.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case F1:switch(n){case B2:o=ze.Depth24PlusStencil8;break;case Xc:e&&e.features.has(wte.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=ze.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case kre:switch(n){case M0:o=ze.R32Sint;break;case Uo:o=ze.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case Dre:switch(n){case M0:o=ze.RG32Sint;break;case Uo:o=ze.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case Fre:switch(n){case M0:o=ze.RGBA32Sint;break;case Uo:o=ze.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}return o}const aut=out,lut=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,cut=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,awe={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},uut=i=>{i=i.trim();const e=i.match(lut);if(e!==null&&e.length===4){const t=e[2],n=[];let r=null;for(;(r=cut.exec(t))!==null;)n.push({name:r[1],type:r[2]});const s=[];for(let f=0;f<n.length;f++){const{name:m,type:v}=n[f];let x=v;x.startsWith("ptr")?x="pointer":(x.startsWith("texture")&&(x=v.split("<")[0]),x=awe[x]),s.push(new yie(x,m))}const o=i.substring(e[0].length),a=e[3]||"void",c=e[1]!==void 0?e[1]:"";return{type:awe[a]||a,inputs:s,name:c,inputsCode:t,blockCode:o,outputType:a}}else throw new Error("FunctionNode: Function is not a WGSL code.")};let hut=class extends xie{constructor(e){const{type:t,inputs:n,name:r,inputsCode:s,blockCode:o,outputType:a}=uut(e);super(t,n,r),this.inputsCode=s,this.blockCode=o,this.outputType=a}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}};const dut=hut;let fut=class extends JPe{parseFunction(e){return new dut(e)}};const put=fut,a6=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},mut={[M1.READ_ONLY]:"read",[M1.WRITE_ONLY]:"write",[M1.READ_WRITE]:"read_write"},lwe={[K_]:"repeat",[E2]:"clamp",[Z_]:"mirror"},ZO={vertex:a6?a6.VERTEX:1,fragment:a6?a6.FRAGMENT:2,compute:a6?a6.COMPUTE:4},cwe={instance:!0,swizzleAssign:!1,storageBuffer:!0},gut={"^^":"tsl_xor"},yut={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},uwe={},Uu={tsl_xor:new Sa("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Sa("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Sa("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Sa("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Sa("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Sa("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Sa("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Sa("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Sa("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Sa("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Sa("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Sa("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Sa(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},hE={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};typeof navigator<"u"&&/Windows/g.test(navigator.userAgent)&&(Uu.pow_float=new Sa("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),Uu.pow_vec2=new Sa("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[Uu.pow_float]),Uu.pow_vec3=new Sa("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[Uu.pow_float]),Uu.pow_vec4=new Sa("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[Uu.pow_float]),hE.pow_float="tsl_pow_float",hE.pow_vec2="tsl_pow_vec2",hE.pow_vec3="tsl_pow_vec3",hE.pow_vec4="tsl_pow_vec4");let pNe="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(pNe+=`diagnostic( off, derivative_uniformity );
`);let vut=class extends QPe{constructor(e,t){super(e,t,new put),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==q1}_generateTextureSample(e,t,n,r,s=this.shaderStage){return s==="fragment"?r?`textureSample( ${t}, ${t}_sampler, ${n}, ${r} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this._generateTextureSampleLevel(e,t,n,"0",r)}_generateVideoSample(e,t,n=this.shaderStage){if(n==="fragment")return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${t}.x, 1.0 - ${t}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${n} shader.`)}_generateTextureSampleLevel(e,t,n,r,s){return this.isUnfilterable(e)===!1?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,r):this.generateTextureLod(e,t,n,s,r)}generateWrapFunction(e){const t=`tsl_coord_${lwe[e.wrapS]}S_${lwe[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let n=uwe[t];if(n===void 0){const r=[],s=e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const a=(c,u)=>{c===K_?(r.push(Uu.repeatWrapping_float),o+=`		tsl_repeatWrapping_float( coord.${u} )`):c===E2?(r.push(Uu.clampWrapping_float),o+=`		tsl_clampWrapping_float( coord.${u} )`):c===Z_?(r.push(Uu.mirrorWrapping_float),o+=`		tsl_mirrorWrapping_float( coord.${u} )`):(o+=`		coord.${u}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${c}" for vertex shader.`))};a(e.wrapS,"x"),o+=`,
`,a(e.wrapT,"y"),e.isData3DTexture&&(o+=`,
`,a(e.wrapR,"z")),o+=`
	);

}
`,uwe[t]=n=new Sa(o,r)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){const r=this.getDataFromNode(e,this.shaderStage,this.globalCache);r.dimensionsSnippet===void 0&&(r.dimensionsSnippet={});let s=r.dimensionsSnippet[n];if(r.dimensionsSnippet[n]===void 0){let o,a;const{primarySamples:c}=this.renderer.backend.utils.getTextureSampleData(e),u=c>1;e.isData3DTexture?a="vec3<u32>":a="vec2<u32>",u||e.isVideoTexture||e.isStorageTexture?o=t:o=`${t}${n?`, u32( ${n} )`:""}`,s=new WB(new XB(`textureDimensions( ${o} )`,a)),r.dimensionsSnippet[n]=s,(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)&&(r.arrayLayerCount=new WB(new XB(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(r.cubeFaceCount=new WB(new XB("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,n,r="0u"){this._include("biquadraticTexture");const s=this.generateWrapFunction(e),o=this.generateTextureDimension(e,t,r);return`tsl_biquadraticTexture( ${t}, ${s}( ${n} ), ${o}, u32( ${r} ) )`}generateTextureLod(e,t,n,r,s="0u"){const o=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,s),c=e.isData3DTexture?"vec3":"vec2",u=`${c}<u32>( ${o}( ${n} ) * ${c}<f32>( ${a} ) )`;return this.generateTextureLoad(e,t,u,r,s)}generateTextureLoad(e,t,n,r,s="0u"){let o;return e.isVideoTexture===!0?o=`textureLoad( ${t}, ${n} )`:r?o=`textureLoad( ${t}, ${n}, ${r}, u32( ${s} ) )`:(o=`textureLoad( ${t}, ${n}, u32( ${s} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(o+=".x")),o}generateTextureStore(e,t,n,r,s){let o;return r?o=`textureStore( ${t}, ${n}, ${r}, ${s} )`:o=`textureStore( ${t}, ${n}, ${s} )`,o}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===Xc||this.isSampleCompare(e)===!1&&e.minFilter===Ma&&e.magFilter===Ma||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,r,s=this.shaderStage){let o=null;return e.isVideoTexture===!0?o=this._generateVideoSample(t,n,s):this.isUnfilterable(e)?o=this.generateTextureLod(e,t,n,r,"0",s):o=this._generateTextureSample(e,t,n,r,s),o}generateTextureGrad(e,t,n,r,s,o=this.shaderStage){if(o==="fragment")return`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${r[0]}, ${r[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(e,t,n,r,s,o=this.shaderStage){if(o==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${s}, ${r} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(e,t,n,r,s,o=this.shaderStage){let a=null;return e.isVideoTexture===!0?a=this._generateVideoSample(t,n,o):a=this._generateTextureSampleLevel(e,t,n,r,s),a}generateTextureBias(e,t,n,r,s,o=this.shaderStage){if(o==="fragment")return`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${r} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${o} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const n=e.name,r=e.type;return r==="texture"||r==="cubeTexture"||r==="storageTexture"||r==="texture3D"?n:r==="buffer"||r==="storageBuffer"||r==="indirectStorageBuffer"?this.isCustomStruct(e)?n:n+".value":e.groupNode.name+"."+n}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=gut[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?M1.READ_ONLY:e.access}getStorageAccess(e,t){return mut[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n,r=null){const s=super.getUniformFromNode(e,t,n,r),o=this.getDataFromNode(e,n,this.globalCache);if(o.uniformGPU===void 0){let a;const c=e.groupNode,u=c.name,f=this.getBindGroupArray(u,n);if(t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"){let m=null;const v=this.getNodeAccess(e,n);if(t==="texture"||t==="storageTexture"?m=new dz(s.name,s.node,c,v):t==="cubeTexture"?m=new uNe(s.name,s.node,c,v):t==="texture3D"&&(m=new hNe(s.name,s.node,c,v)),m.store=e.isStorageTextureNode===!0,m.setVisibility(ZO[n]),this.isUnfilterable(e.value)===!1&&m.store===!1){const x=new Kct(`${s.name}_sampler`,s.node,c);x.setVisibility(ZO[n]),f.push(x,m),a=[x,m]}else f.push(m),a=[m]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const m=t==="buffer"?lNe:tut,v=new m(e,c);v.setVisibility(ZO[n]),f.push(v),a=v,s.name=r||"NodeBuffer_"+s.id}else{const m=this.uniformGroups[n]||(this.uniformGroups[n]={});let v=m[u];v===void 0&&(v=new cNe(u,c),v.setVisibility(ZO[n]),m[u]=v,f.push(v)),a=this.getNodeUniform(s,t),v.addUniform(a)}o.uniformGPU=a}return s}getBuiltin(e,t,n,r=this.shaderStage){const s=this.builtins[r]||(this.builtins[r]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(o.name+" : "+this.getType(o.type));let s=`fn ${t.name}( ${r.join(", ")} ) -> ${this.getType(t.type)} {
${n.vars}
${n.code}
`;return n.result&&(s+=`	return ${n.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(n!==void 0)for(const r of n)t.push(`enable ${r};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(n!==void 0)for(const{name:r,property:s,type:o}of n.values())t.push(`@builtin( ${r} ) ${s} : ${o}`);return t.join(`,
	`)}getScopedArray(e,t,n,r){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:r}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:n,scope:r,bufferType:s,bufferCount:o}of this.scopedArrays.values()){const a=this.getType(s);t.push(`var<${r}> ${n}: array< ${a}, ${o} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const n=this.getBuiltins("attribute");n&&t.push(n);const r=this.getAttributesArray();for(let s=0,o=r.length;s<o;s++){const a=r[s],c=a.name,u=this.getType(a.type);t.push(`@location( ${s} ) ${c} : ${u}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const n of e.members){const r=e.output?"@location( "+n.index+" ) ":"";let s=this.getType(n.type);n.atomic&&(s="atomic< "+s+" >"),t.push(`	${r+n.name} : ${s}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const r=[];for(const s of n){let o=`struct ${s.name} {
`;o+=this.getStructMembers(s),o+=`
};`,r.push(o)}t=`
`+r.join(`

`)+`
`}return t}getVar(e,t,n=null){let r=`var ${t} : `;return n!==null?r+=this.generateArrayDeclaration(e,n):r+=this.getType(e),r}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const r of n)t.push(`	${this.getVar(r.type,r.name,r.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,o=this.vars[e];for(let a=0;a<s.length;a++){const c=s[a];if(c.needsInterpolation){let u=`@location( ${a} )`;if(c.interpolationType){const f=c.interpolationSampling!==null?`, ${c.interpolationSampling} )`:" )";u+=` @interpolate( ${c.interpolationType}${f}`}else/^(int|uint|ivec|uvec)/.test(c.type)&&(u+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${u} ${c.name} : ${this.getType(c.type)}`)}else e==="vertex"&&o.includes(c)===!1&&o.push(c)}}const n=this.getBuiltins(e);n&&t.push(n);const r=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+r):r}isCustomStruct(e){const t=e.value,n=e.node,r=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&n.structTypeNode!==null,s=n.value&&n.value.array&&typeof n.value.itemSize=="number"&&n.value.array.length>n.value.itemSize;return r&&!s}getUniforms(e){const t=this.uniforms[e],n=[],r=[],s=[],o={};for(const c of t){const u=c.groupNode.name,f=this.bindingsIndexes[u];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="storageTexture"||c.type==="texture3D"){const m=c.node.value;this.isUnfilterable(m)===!1&&c.node.isStorageTextureNode!==!0&&(this.isSampleCompare(m)?n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${c.name}_sampler : sampler_comparison;`):n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${c.name}_sampler : sampler;`));let v,x="";const{primarySamples:T}=this.renderer.backend.utils.getTextureSampleData(m);if(T>1&&(x="_multisampled"),m.isCubeTexture===!0)v="texture_cube<f32>";else if(m.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&m.compareFunction===null?v=`texture${x}_2d<f32>`:v=`texture_depth${x}_2d${m.isArrayTexture===!0?"_array":""}`;else if(m.isArrayTexture===!0||m.isDataArrayTexture===!0||m.isCompressedArrayTexture===!0)v="texture_2d_array<f32>";else if(m.isVideoTexture===!0)v="texture_external";else if(m.isData3DTexture===!0)v="texture_3d<f32>";else if(c.node.isStorageTextureNode===!0){const P=Tte(m),R=this.getStorageAccess(c.node,e);v=`texture_storage_2d<${P}, ${R}>`}else{const P=this.getComponentTypeFromTexture(m).charAt(0);v=`texture${x}_2d<${P}32>`}n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${c.name} : ${v};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const m=c.node,v=this.getType(m.getNodeType(this)),x=m.bufferCount,T=x>0&&c.type==="buffer"?", "+x:"",P=m.isStorageBufferNode?`storage, ${this.getStorageAccess(m,e)}`:"uniform";if(this.isCustomStruct(c))r.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var<${P}> ${c.name} : ${v};`);else{const M=`	value : array< ${m.isAtomic?`atomic<${v}>`:`${v}`}${T} >`;r.push(this._getWGSLStructBinding(c.name,M,P,f.binding++,f.group))}}else{const m=this.getType(this.getVectorType(c.type)),v=c.groupNode.name;(o[v]||(o[v]={index:f.binding++,id:f.group,snippets:[]})).snippets.push(`	${c.name} : ${m}`)}}for(const c in o){const u=o[c];s.push(this._getWGSLStructBinding(c,u.snippets.join(`,
`),"uniform",u.index,u.id))}let a=n.join(`
`);return a+=r.join(`
`),a+=s.join(`
`),a}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let r=`// code

`;r+=this.flowCode[t];const s=this.flowNodes[t],o=s[s.length-1],a=o.outputNode,c=a!==void 0&&a.isOutputStructNode===!0;for(const u of s){const f=this.getFlowData(u),m=u.name;if(m&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${m}
`),r+=`${f.code}
	`,u===o&&t!=="compute"){if(r+=`// result

	`,t==="vertex")r+=`varyings.Vertex = ${f.result};`;else if(t==="fragment")if(c)n.returnType=a.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",r+=`return ${f.result};`;else{let v="	@location(0) color: vec4<f32>";const x=this.getBuiltins("output");x&&(v+=`,
	`+x),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",v),n.structs+=`
var<private> output : OutputStruct;`,r+=`output.color = ${f.result};

	return output;`}}}n.flow=r}this.shaderStage=null,this.material!==null?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,t=null){let n;return t!==null&&(n=this._getWGSLMethod(e+"_"+t)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getType(e){return yut[e]||e}isAvailable(e){let t=cwe[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),cwe[e]=t),t}_getWGSLMethod(e){return Uu[e]!==void 0&&this._include(e),hE[e]}_include(e){const t=Uu[e];return t.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${pNe}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${t} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x + globalId.y * numWorkgroups.x * u32(${t}) + globalId.z * numWorkgroups.x * numWorkgroups.y * u32(${t});

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,n,r=0,s=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}
@binding( ${r} ) @group( ${s} )
var<${n}> ${e} : ${o};`}};const _ut=vut;let xut=class{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=ze.Depth24PlusStencil8:e.depth&&(t=ze.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,o=s.getRenderTarget();t=o?o.samples:s.samples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return H6.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return H6.LineList;if(e.isLine)return H6.LineStrip;if(e.isMesh)return H6.TriangleList}getSampleCount(e){let t=1;return e>1&&(t=Math.pow(2,Math.floor(Math.log2(e))),t===2&&(t=4)),t}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===N0)return ze.BGRA8Unorm;if(e===qu)return ze.RGBA16Float;throw new Error("Unsupported outputType")}};const but=xut,Sut=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),wut=new Map([[TRe,["float16"]]]),Tut=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);let Eut=class{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),r=this.backend,s=r.get(n);let o=s.buffer;if(o===void 0){const a=r.device;let c=n.array;if(e.normalized===!1){if(c.constructor===Int16Array||c.constructor===Int8Array)c=new Int32Array(c);else if((c.constructor===Uint16Array||c.constructor===Uint8Array)&&(c=new Uint32Array(c),t&GPUBufferUsage.INDEX))for(let m=0;m<c.length;m++)c[m]===65535&&(c[m]=4294967295)}if(n.array=c,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){c=new c.constructor(n.count*4);for(let m=0;m<n.count;m++)c.set(n.array.subarray(m*3,m*3+3),m*4);n.itemSize=4,n.array=c,s._force3to4BytesAlignment=!0}const u=c.byteLength,f=u+(4-u%4)%4;o=a.createBuffer({label:n.name,size:f,usage:t,mappedAtCreation:!0}),new c.constructor(o.getMappedRange()).set(c),o.unmap(),s.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,r=n.device,s=n.get(t),o=n.get(t).buffer;let a=t.array;if(s._force3to4BytesAlignment===!0){a=new a.constructor(t.count*4);for(let f=0;f<t.count;f++)a.set(t.array.subarray(f*3,f*3+3),f*4);t.array=a}const c=this._isTypedArray(a),u=t.updateRanges;if(u.length===0)r.queue.writeBuffer(o,0,a,0);else{const f=c?1:a.BYTES_PER_ELEMENT;for(let m=0,v=u.length;m<v;m++){const x=u[m];let T,P;if(s._force3to4BytesAlignment===!0){const M=Math.floor(x.start/3),O=Math.ceil(x.count/3);T=M*4*f,P=O*4*f}else T=x.start*f,P=x.count*f;const R=T*(c?a.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(o,R,a,T,P)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let r=0;r<t.length;r++){const s=t[r],o=s.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(s);let c=n.get(a);if(c===void 0){let m,v;s.isInterleavedBufferAttribute===!0?(m=s.data.stride*o,v=s.data.isInstancedInterleavedBuffer?KO.Instance:KO.Vertex):(m=s.itemSize*o,v=s.isInstancedBufferAttribute?KO.Instance:KO.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(m=4),c={arrayStride:m,attributes:[],stepMode:v},n.set(a,c)}const u=this._getVertexFormat(s),f=s.isInterleavedBufferAttribute===!0?s.offset*o:0;c.attributes.push({shaderLocation:r,offset:f,format:u})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,s=t.get(this._getBufferAttribute(e)).buffer,o=s.size,a=n.createBuffer({label:`${e.name}_readback`,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),c=n.createCommandEncoder({label:`readback_encoder_${e.name}`});c.copyBufferToBuffer(s,0,a,0,o);const u=c.finish();n.queue.submit([u]),await a.mapAsync(GPUMapMode.READ);const f=a.getMappedRange(),m=new e.array.constructor(f.slice(0));return a.unmap(),m.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,r=e.array.constructor,s=e.constructor;let o;if(t===1)o=Tut.get(r);else{const c=(wut.get(s)||Sut.get(r))[n?1:0];if(c){const u=r.BYTES_PER_ELEMENT*t,m=Math.floor((u+3)/4)*4/r.BYTES_PER_ELEMENT;if(m%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${c}x${m}`}}return o||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),o}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}};const Mut=Eut;let Cut=class{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,n=t.device,r=[];let s=0;for(const o of e.bindings){const a={binding:s++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const c={};o.isStorageBuffer&&(o.visibility&4&&(o.access===M1.READ_WRITE||o.access===M1.WRITE_ONLY)?c.type=bQ.Storage:c.type=bQ.ReadOnlyStorage),a.buffer=c}else if(o.isSampler){const c={};o.texture.isDepthTexture&&(o.texture.compareFunction!==null?c.type=swe.Comparison:t.compatibilityMode&&(c.type=swe.NonFiltering)),a.sampler=c}else if(o.isSampledTexture&&o.texture.isVideoTexture)a.externalTexture={};else if(o.isSampledTexture&&o.store){const c={};c.format=this.backend.get(o.texture).texture.format;const u=o.access;u===M1.READ_WRITE?c.access=SQ.ReadWrite:u===M1.WRITE_ONLY?c.access=SQ.WriteOnly:c.access=SQ.ReadOnly,a.storageTexture=c}else if(o.isSampledTexture){const c={},{primarySamples:u}=t.utils.getTextureSampleData(o.texture);if(u>1&&(c.multisampled=!0,o.texture.isDepthTexture||(c.sampleType=hy.UnfilterableFloat)),o.texture.isDepthTexture)t.compatibilityMode&&o.texture.compareFunction===null?c.sampleType=hy.UnfilterableFloat:c.sampleType=hy.Depth;else if(o.texture.isDataTexture||o.texture.isDataArrayTexture||o.texture.isData3DTexture){const f=o.texture.type;f===M0?c.sampleType=hy.SInt:f===Uo?c.sampleType=hy.UInt:f===Xc&&(this.backend.hasFeature("float32-filterable")?c.sampleType=hy.Float:c.sampleType=hy.UnfilterableFloat)}o.isSampledCubeTexture?c.viewDimension=ja.Cube:o.texture.isArrayTexture||o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?c.viewDimension=ja.TwoDArray:o.isSampledTexture3D&&(c.viewDimension=ja.ThreeD),a.texture=c}else console.error(`WebGPUBindingUtils: Unsupported binding "${o}".`);r.push(a)}return n.createBindGroupLayout({entries:r})}createBindings(e,t,n,r=0){const{backend:s,bindGroupLayoutCache:o}=this,a=s.get(e);let c=o.get(e.bindingsReference);c===void 0&&(c=this.createBindingsLayout(e),o.set(e.bindingsReference,c));let u;n>0&&(a.groups===void 0&&(a.groups=[],a.versions=[]),a.versions[n]===r&&(u=a.groups[n])),u===void 0&&(u=this.createBindGroup(e,c),n>0&&(a.groups[n]=u,a.versions[n]=r)),a.group=u,a.layout=c}updateBinding(e){const t=this.backend,n=t.device,r=e.buffer,s=t.get(e).buffer;n.queue.writeBuffer(s,0,r,0)}createBindGroupIndex(e,t){const r=this.backend.device,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,o=e[0],a=r.createBuffer({label:"bindingCameraIndex_"+o,size:16,usage:s});r.queue.writeBuffer(a,0,e,0);const c=[{binding:0,resource:{buffer:a}}];return r.createBindGroup({label:"bindGroupCameraIndex_"+o,layout:t,entries:c})}createBindGroup(e,t){const n=this.backend,r=n.device;let s=0;const o=[];for(const a of e.bindings){if(a.isUniformBuffer){const c=n.get(a);if(c.buffer===void 0){const u=a.byteLength,f=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,m=r.createBuffer({label:"bindingBuffer_"+a.name,size:u,usage:f});c.buffer=m}o.push({binding:s,resource:{buffer:c.buffer}})}else if(a.isStorageBuffer){const c=n.get(a);if(c.buffer===void 0){const u=a.attribute;c.buffer=n.get(u).buffer}o.push({binding:s,resource:{buffer:c.buffer}})}else if(a.isSampler){const c=n.get(a.texture);o.push({binding:s,resource:c.sampler})}else if(a.isSampledTexture){const c=n.get(a.texture);let u;if(c.externalTexture!==void 0)u=r.importExternalTexture({source:c.externalTexture});else{const f=a.store?1:c.texture.mipLevelCount,m=`view-${c.texture.width}-${c.texture.height}-${f}`;if(u=c[m],u===void 0){const v=Wct.All;let x;a.isSampledCubeTexture?x=ja.Cube:a.isSampledTexture3D?x=ja.ThreeD:a.texture.isArrayTexture||a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?x=ja.TwoDArray:x=ja.TwoD,u=c[m]=c.texture.createView({aspect:v,dimension:x,mipLevelCount:f})}}o.push({binding:s,resource:u})}s++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}};const Aut=Cut;let Rut=class{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:r,geometry:s,pipeline:o}=e,{vertexProgram:a,fragmentProgram:c}=o,u=this.backend,f=u.device,m=u.utils,v=u.get(o),x=[];for(const Pe of e.getBindings()){const je=u.get(Pe);x.push(je.layout)}const T=u.attributeUtils.createShaderVertexBuffers(e);let P;r.blending!==Y_&&(r.blending!==k1||r.transparent!==!1)&&(P=this._getBlending(r));let R={};r.stencilWrite===!0&&(R={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const M=this._getColorWriteMask(r),O=[];if(e.context.textures!==null){const Pe=e.context.textures;for(let je=0;je<Pe.length;je++){const ge=m.getTextureFormatGPU(Pe[je]);O.push({format:ge,blend:P,writeMask:M})}}else{const Pe=m.getCurrentColorFormat(e.context);O.push({format:Pe,blend:P,writeMask:M})}const C=u.get(a).module,L=u.get(c).module,Y=this._getPrimitiveState(n,s,r),J=this._getDepthCompare(r),z=m.getCurrentDepthStencilFormat(e.context),ne=this._getSampleCount(e.context),K={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},C,{buffers:T}),fragment:Object.assign({},L,{targets:O}),primitive:Y,multisample:{count:ne,alphaToCoverageEnabled:r.alphaToCoverage&&ne>1},layout:f.createPipelineLayout({bindGroupLayouts:x})},$={},he=e.context.depth,Ce=e.context.stencil;if((he===!0||Ce===!0)&&(he===!0&&($.format=z,$.depthWriteEnabled=r.depthWrite,$.depthCompare=J),Ce===!0&&($.stencilFront=R,$.stencilBack={},$.stencilReadMask=r.stencilFuncMask,$.stencilWriteMask=r.stencilWriteMask),r.polygonOffset===!0&&($.depthBias=r.polygonOffsetUnits,$.depthBiasSlopeScale=r.polygonOffsetFactor,$.depthBiasClamp=0),K.depthStencil=$),t===null)v.pipeline=f.createRenderPipeline(K);else{const Pe=new Promise(je=>{f.createRenderPipelineAsync(K).then(ge=>{v.pipeline=ge,je()})});t.push(Pe)}}createBundleEncoder(e,t="renderBundleEncoder"){const n=this.backend,{utils:r,device:s}=n,o=r.getCurrentDepthStencilFormat(e),a=r.getCurrentColorFormat(e),c=this._getSampleCount(e),u={label:t,colorFormats:[a],depthStencilFormat:o,sampleCount:c};return s.createRenderBundleEncoder(u)}createComputePipeline(e,t){const n=this.backend,r=n.device,s=n.get(e.computeProgram).module,o=n.get(e),a=[];for(const c of t){const u=n.get(c);a.push(u.layout)}o.pipeline=r.createComputePipeline({compute:s,layout:r.createPipelineLayout({bindGroupLayouts:a})})}_getBlending(e){let t,n;const r=e.blending,s=e.blendSrc,o=e.blendDst,a=e.blendEquation;if(r===DE){const c=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,u=e.blendDstAlpha!==null?e.blendDstAlpha:o,f=e.blendEquationAlpha!==null?e.blendEquationAlpha:a;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(a)},n={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(u),operation:this._getBlendOperation(f)}}else{const c=e.premultipliedAlpha,u=(f,m,v,x)=>{t={srcFactor:f,dstFactor:m,operation:uy.Add},n={srcFactor:v,dstFactor:x,operation:uy.Add}};if(c)switch(r){case k1:u(Ur.One,Ur.OneMinusSrcAlpha,Ur.One,Ur.OneMinusSrcAlpha);break;case UL:u(Ur.One,Ur.One,Ur.One,Ur.One);break;case zL:u(Ur.Zero,Ur.OneMinusSrc,Ur.Zero,Ur.One);break;case VL:u(Ur.Zero,Ur.Src,Ur.Zero,Ur.SrcAlpha);break}else switch(r){case k1:u(Ur.SrcAlpha,Ur.OneMinusSrcAlpha,Ur.One,Ur.OneMinusSrcAlpha);break;case UL:u(Ur.SrcAlpha,Ur.One,Ur.SrcAlpha,Ur.One);break;case zL:u(Ur.Zero,Ur.OneMinusSrc,Ur.Zero,Ur.One);break;case VL:u(Ur.Zero,Ur.Src,Ur.Zero,Ur.Src);break}}if(t!==void 0&&n!==void 0)return{color:t,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(e){let t;switch(e){case d2:t=Ur.Zero;break;case qAe:t=Ur.One;break;case XAe:t=Ur.Src;break;case YAe:t=Ur.OneMinusSrc;break;case GL:t=Ur.SrcAlpha;break;case $L:t=Ur.OneMinusSrcAlpha;break;case QAe:t=Ur.Dst;break;case JAe:t=Ur.OneMinusDst;break;case KAe:t=Ur.DstAlpha;break;case ZAe:t=Ur.OneMinusDstAlpha;break;case eRe:t=Ur.SrcAlphaSaturated;break;case Ctt:t=Ur.Constant;break;case Att:t=Ur.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const n=e.stencilFunc;switch(n){case itt:t=hl.Never;break;case cte:t=hl.Always;break;case stt:t=hl.Less;break;case att:t=hl.LessEqual;break;case ott:t=hl.Equal;break;case utt:t=hl.GreaterEqual;break;case ltt:t=hl.Greater;break;case ctt:t=hl.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return t}_getStencilOperation(e){let t;switch(e){case My:t=n2.Keep;break;case Zet:t=n2.Zero;break;case Qet:t=n2.Replace;break;case rtt:t=n2.Invert;break;case Jet:t=n2.IncrementClamp;break;case ett:t=n2.DecrementClamp;break;case ttt:t=n2.IncrementWrap;break;case ntt:t=n2.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case md:t=uy.Add;break;case jAe:t=uy.Subtract;break;case WAe:t=uy.ReverseSubtract;break;case Fet:t=uy.Min;break;case Oet:t=uy.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,n){const r={},s=this.backend.utils;switch(r.topology=s.getPrimitiveTopology(e,n),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?nx.Uint16:nx.Uint32),n.side){case I1:r.frontFace=vQ.CCW,r.cullMode=_Q.Back;break;case gc:r.frontFace=vQ.CCW,r.cullMode=_Q.Front;break;case s_:r.frontFace=vQ.CCW,r.cullMode=_Q.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side);break}return r}_getColorWriteMask(e){return e.colorWrite===!0?iwe.All:iwe.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=hl.Always;else{const n=e.depthFunc;switch(n){case tRe:t=hl.Never;break;case nRe:t=hl.Always;break;case rRe:t=hl.Less;break;case HL:t=hl.LessEqual;break;case iRe:t=hl.Equal;break;case sRe:t=hl.GreaterEqual;break;case oRe:t=hl.Greater;break;case aRe:t=hl.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return t}};const Put=Rut;let Nut=class extends fNe{constructor(e,t,n=2048){super(n),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const r=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return X1(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e.id,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const r=this.device.createCommandEncoder();r.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),r.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const s=r.finish();if(this.device.queue.submit([s]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const o=new BigUint64Array(this.resultBuffer.getMappedRange(0,n));let a=0;for(const[,c]of e){const u=o[c],f=o[c+1],m=Number(f-u)/1e6;a+=m}return this.resultBuffer.unmap(),this.lastValue=a,a}catch(e){return console.error("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){console.error("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){console.error("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}};const Iut=Nut;let kut=class extends dNe{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new but(this),this.attributeUtils=new Mut(this),this.bindingUtils=new Aut(this),this.pipelineUtils=new Put(this),this.textureUtils=new aut(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let n;if(t.device===void 0){const o={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},a=typeof navigator<"u"?await navigator.gpu.requestAdapter(o):null;if(a===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const c=Object.values(wte),u=[];for(const m of c)a.features.has(m)&&u.push(m);const f={requiredFeatures:u,requiredLimits:t.requiredLimits};n=await a.requestDevice(f)}else n=t.device;n.lost.then(o=>{const a={api:"WebGPU",message:o.message||"Unknown reason",reason:o.reason||null,originalEvent:o};e.onDeviceLost(a)});const r=t.context!==void 0?t.context:e.domElement.getContext("webgpu");this.device=n,this.context=r;const s=t.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(wte.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s}),this.updateSize()}get coordinateSystem(){return W2}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(e===null){const n=this.renderer;e={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(n.depth,n.stencil).createView()});const r=e.colorAttachments[0];this.renderer.samples>0?r.view=this.colorBuffer.createView():r.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const t=e.colorAttachments[0];return this.renderer.samples>0?t.resolveTarget=this.context.getCurrentTexture().createView():t.view=this.context.getCurrentTexture().createView(),e}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const n=e.renderTarget,r=this.get(n);let s=r.descriptors;if(s===void 0||r.width!==n.width||r.height!==n.height||r.dimensions!==n.dimensions||r.activeMipmapLevel!==e.activeMipmapLevel||r.activeCubeFace!==e.activeCubeFace||r.samples!==n.samples){s={},r.descriptors=s;const u=()=>{n.removeEventListener("dispose",u),this.delete(n)};n.hasEventListener("dispose",u)===!1&&n.addEventListener("dispose",u)}const o=e.getCacheKey();let a=s[o];if(a===void 0){const u=e.textures,f=[];let m;const v=this._isRenderCameraDepthArray(e);for(let x=0;x<u.length;x++){const T=this.get(u[x]),P={label:`colorAttachment_${x}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:ja.TwoD};if(n.isRenderTarget3D)m=e.activeCubeFace,P.baseArrayLayer=0,P.dimension=ja.ThreeD,P.depthOrArrayLayers=u[x].image.depth;else if(n.isRenderTarget&&u[x].image.depth>1)if(v===!0){const R=e.camera.cameras;for(let M=0;M<R.length;M++){const O={...P,baseArrayLayer:M,arrayLayerCount:1,dimension:ja.TwoD},C=T.texture.createView(O);f.push({view:C,resolveTarget:void 0,depthSlice:void 0})}}else P.dimension=ja.TwoDArray,P.depthOrArrayLayers=u[x].image.depth;if(v!==!0){const R=T.texture.createView(P);let M,O;T.msaaTexture!==void 0?(M=T.msaaTexture.createView(),O=R):(M=R,O=void 0),f.push({view:M,resolveTarget:O,depthSlice:m})}}if(a={textureViews:f},e.depth){const x=this.get(e.depthTexture),T={};e.depthTexture.isArrayTexture&&(T.dimension=ja.TwoD,T.arrayLayerCount=1,T.baseArrayLayer=e.activeCubeFace),a.depthStencilView=x.texture.createView(T)}s[o]=a,r.width=n.width,r.height=n.height,r.samples=n.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace,r.dimensions=n.dimensions}const c={colorAttachments:[]};for(let u=0;u<a.textureViews.length;u++){const f=a.textureViews[u];let m={r:0,g:0,b:0,a:1};u===0&&t.clearValue&&(m=t.clearValue),c.colorAttachments.push({view:f.view,depthSlice:f.depthSlice,resolveTarget:f.resolveTarget,loadOp:t.loadOp||ji.Load,storeOp:t.storeOp||S0.Store,clearValue:m})}return a.depthStencilView&&(c.depthStencilAttachment={view:a.depthStencilView}),c}beginRender(e){const t=this.get(e),n=this.device,r=e.occlusionQueryCount;let s;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=n.createQuerySet({type:"occlusion",count:r,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(r),t.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e,{loadOp:ji.Load}),this.initTimestampQuery(e,o),o.occlusionQuerySet=s;const a=o.depthStencilAttachment;if(e.textures!==null){const u=o.colorAttachments;for(let f=0;f<u.length;f++){const m=u[f];e.clearColor?(m.clearValue=f===0?e.clearColorValue:{r:0,g:0,b:0,a:1},m.loadOp=ji.Clear):m.loadOp=ji.Load,m.storeOp=S0.Store}}else{const u=o.colorAttachments[0];e.clearColor?(u.clearValue=e.clearColorValue,u.loadOp=ji.Clear):u.loadOp=ji.Load,u.storeOp=S0.Store}e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=ji.Clear):a.depthLoadOp=ji.Load,a.depthStoreOp=S0.Store),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=ji.Clear):a.stencilLoadOp=ji.Load,a.stencilStoreOp=S0.Store);const c=n.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const u=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==u.length?this._createDepthLayerDescriptors(e,t,o,u):this._updateDepthLayerDescriptors(e,t,u),t.bundleEncoders=[],t.bundleSets=[];for(let f=0;f<u.length;f++){const m=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+f),v={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(m),t.bundleSets.push(v)}t.currentPass=null}else{const u=c.beginRenderPass(o);if(t.currentPass=u,e.viewport&&this.updateViewport(e),e.scissor){const{x:f,y:m,width:v,height:x}=e.scissorValue;u.setScissorRect(f,m,v,x)}}t.descriptor=o,t.encoder=c,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,n,r){const s=n.depthStencilAttachment;t.layerDescriptors=[];const o=this.get(e.depthTexture);o.viewCache||(o.viewCache=[]);for(let a=0;a<r.length;a++){const c={...n,colorAttachments:[{...n.colorAttachments[0],view:n.colorAttachments[a].view}]};if(n.depthStencilAttachment){const u=a;o.viewCache[u]||(o.viewCache[u]=o.texture.createView({dimension:ja.TwoD,baseArrayLayer:a,arrayLayerCount:1})),c.depthStencilAttachment={view:o.viewCache[u],depthLoadOp:s.depthLoadOp||ji.Clear,depthStoreOp:s.depthStoreOp||S0.Store,depthClearValue:s.depthClearValue||1},e.stencil&&(c.depthStencilAttachment.stencilLoadOp=s.stencilLoadOp,c.depthStencilAttachment.stencilStoreOp=s.stencilStoreOp,c.depthStencilAttachment.stencilClearValue=s.stencilClearValue)}else c.depthStencilAttachment={...s};t.layerDescriptors.push(c)}}_updateDepthLayerDescriptors(e,t,n){for(let r=0;r<n.length;r++){const s=t.layerDescriptors[r];if(s.depthStencilAttachment){const o=s.depthStencilAttachment;e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=ji.Clear):o.depthLoadOp=ji.Load),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=ji.Clear):o.stencilLoadOp=ji.Load)}}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const r=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const s=[];for(let o=0;o<t.bundleEncoders.length;o++){const a=t.bundleEncoders[o];s.push(a.finish())}for(let o=0;o<t.layerDescriptors.length;o++)if(o<s.length){const a=t.layerDescriptors[o],c=r.beginRenderPass(a);if(e.viewport){const{x:u,y:f,width:m,height:v,minDepth:x,maxDepth:T}=e.viewportValue;c.setViewport(u,f,m,v,x,T)}if(e.scissor){const{x:u,y:f,width:m,height:v}=e.scissorValue;c.setScissorRect(u,f,m,v)}c.executeBundles([s[o]]),c.end()}}else t.currentPass&&t.currentPass.end();if(n>0){const s=n*8;let o=this.occludedResolveCache.get(s);o===void 0&&(o=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,o));const a=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,o,0),t.encoder.copyBufferToBuffer(o,0,a,0,s),t.occlusionQueryBuffer=a,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const s=e.textures;for(let o=0;o<s.length;o++){const a=s[o];a.generateMipmaps===!0&&this.textureUtils.generateMipmaps(a)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const o=n.getMappedRange(),a=new BigUint64Array(o);for(let c=0;c<r.length;c++)a[c]===BigInt(0)&&s.add(r[c]);n.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:r,width:s,height:o,minDepth:a,maxDepth:c}=e.viewportValue;t.setViewport(n,r,s,o,a,c)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n,r=null){const s=this.device,o=this.renderer;let a=[],c,u,f,m;if(e){const T=this.getClearColor();u={r:T.r,g:T.g,b:T.b,a:T.a}}if(r===null){f=o.depth,m=o.stencil;const T=this._getDefaultRenderPassDescriptor();if(e){a=T.colorAttachments;const P=a[0];P.clearValue=u,P.loadOp=ji.Clear,P.storeOp=S0.Store}(f||m)&&(c=T.depthStencilAttachment)}else{f=r.depth,m=r.stencil;const T={loadOp:e?ji.Clear:ji.Load,clearValue:e?u:void 0};f&&(T.depthLoadOp=t?ji.Clear:ji.Load,T.depthClearValue=t?o.getClearDepth():void 0,T.depthStoreOp=S0.Store),m&&(T.stencilLoadOp=n?ji.Clear:ji.Load,T.stencilClearValue=n?o.getClearStencil():void 0,T.stencilStoreOp=S0.Store);const P=this._getRenderPassDescriptor(r,T);a=P.colorAttachments,c=P.depthStencilAttachment}f&&c&&c.depthLoadOp===void 0&&(t?(c.depthLoadOp=ji.Clear,c.depthClearValue=o.getClearDepth(),c.depthStoreOp=S0.Store):(c.depthLoadOp=ji.Load,c.depthStoreOp=S0.Store)),m&&c&&c.stencilLoadOp===void 0&&(n?(c.stencilLoadOp=ji.Clear,c.stencilClearValue=o.getClearStencil(),c.stencilStoreOp=S0.Store):(c.stencilLoadOp=ji.Load,c.stencilStoreOp=S0.Store));const v=s.createCommandEncoder({label:"clear"});v.beginRenderPass({colorAttachments:a,depthStencilAttachment:c}).end(),s.queue.submit([v.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(e,n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,r){const{passEncoderGPU:s}=this.get(e),o=this.get(r).pipeline;this.pipelineUtils.setPipeline(s,o);for(let f=0,m=n.length;f<m;f++){const v=n[f],x=this.get(v);s.setBindGroup(f,x.group)}const a=this.device.limits.maxComputeWorkgroupsPerDimension,c=this.get(t);c.dispatchSize===void 0&&(c.dispatchSize={x:0,y:1,z:1});const{dispatchSize:u}=c;t.dispatchCount>a?(u.x=Math.min(t.dispatchCount,a),u.y=Math.ceil(t.dispatchCount/a)):u.x=t.dispatchCount,s.dispatchWorkgroups(u.x,u.y,u.z)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,t){const{object:n,material:r,context:s,pipeline:o}=e,a=e.getBindings(),c=this.get(s),u=this.get(o).pipeline,f=e.getIndex(),m=f!==null,v=e.getDrawParameters();if(v===null)return;const x=(P,R)=>{this.pipelineUtils.setPipeline(P,u),R.pipeline=u;const M=R.bindingGroups;for(let C=0,L=a.length;C<L;C++){const Y=a[C],J=this.get(Y);M[Y.index]!==Y.id&&(P.setBindGroup(Y.index,J.group),M[Y.index]=Y.id)}if(m===!0&&R.index!==f){const C=this.get(f).buffer,L=f.array instanceof Uint16Array?nx.Uint16:nx.Uint32;P.setIndexBuffer(C,L),R.index=f}const O=e.getVertexBuffers();for(let C=0,L=O.length;C<L;C++){const Y=O[C];if(R.attributes[C]!==Y){const J=this.get(Y).buffer;P.setVertexBuffer(C,J),R.attributes[C]=Y}}s.stencil===!0&&r.stencilWrite===!0&&c.currentStencilRef!==r.stencilRef&&(P.setStencilReference(r.stencilRef),c.currentStencilRef=r.stencilRef)},T=(P,R)=>{if(x(P,R),n.isBatchedMesh===!0){const M=n._multiDrawStarts,O=n._multiDrawCounts,C=n._multiDrawCount,L=n._multiDrawInstances;L!==null&&X1("THREE.WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let Y=0;Y<C;Y++){const J=L?L[Y]:1,z=J>1?0:Y;m===!0?P.drawIndexed(O[Y],J,M[Y]/f.array.BYTES_PER_ELEMENT,0,z):P.draw(O[Y],J,M[Y],z),t.update(n,O[Y],J)}}else if(m===!0){const{vertexCount:M,instanceCount:O,firstVertex:C}=v,L=e.getIndirect();if(L!==null){const Y=this.get(L).buffer;P.drawIndexedIndirect(Y,0)}else P.drawIndexed(M,O,C,0,0);t.update(n,M,O)}else{const{vertexCount:M,instanceCount:O,firstVertex:C}=v,L=e.getIndirect();if(L!==null){const Y=this.get(L).buffer;P.drawIndirect(Y,0)}else P.draw(M,O,C,0);t.update(n,M,O)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const P=this.get(e.camera),R=e.camera.cameras,M=e.getBindingGroup("cameraIndex");if(P.indexesGPU===void 0||P.indexesGPU.length!==R.length){const C=this.get(M),L=[],Y=new Uint32Array([0,0,0,0]);for(let J=0,z=R.length;J<z;J++){Y[0]=J;const ne=this.bindingUtils.createBindGroupIndex(Y,C.layout);L.push(ne)}P.indexesGPU=L}const O=this.renderer.getPixelRatio();for(let C=0,L=R.length;C<L;C++){const Y=R[C];if(n.layers.test(Y.layers)){const J=Y.viewport;let z=c.currentPass,ne=c.currentSets;if(c.bundleEncoders){const K=c.bundleEncoders[C],$=c.bundleSets[C];z=K,ne=$}J&&z.setViewport(Math.floor(J.x*O),Math.floor(J.y*O),Math.floor(J.width*O),Math.floor(J.height*O),s.viewportValue.minDepth,s.viewportValue.maxDepth),M&&P.indexesGPU&&(z.setBindGroup(M.index,P.indexesGPU[C]),ne.bindingGroups[M.index]=M.id),T(z,ne)}}}else if(c.currentPass){if(c.occlusionQuerySet!==void 0){const P=c.lastOcclusionObject;P!==n&&(P!==null&&P.occlusionTest===!0&&(c.currentPass.endOcclusionQuery(),c.occlusionQueryIndex++),n.occlusionTest===!0&&(c.currentPass.beginOcclusionQuery(c.occlusionQueryIndex),c.occlusionQueryObjects[c.occlusionQueryIndex]=n),c.lastOcclusionObject=n)}T(c.currentPass,c.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:n,material:r}=e,s=this.utils,o=s.getSampleCountRenderContext(e.context),a=s.getCurrentColorSpace(e.context),c=s.getCurrentColorFormat(e.context),u=s.getCurrentDepthStencilFormat(e.context),f=s.getPrimitiveTopology(n,r);let m=!1;return(t.material!==r||t.materialVersion!==r.version||t.transparent!==r.transparent||t.blending!==r.blending||t.premultipliedAlpha!==r.premultipliedAlpha||t.blendSrc!==r.blendSrc||t.blendDst!==r.blendDst||t.blendEquation!==r.blendEquation||t.blendSrcAlpha!==r.blendSrcAlpha||t.blendDstAlpha!==r.blendDstAlpha||t.blendEquationAlpha!==r.blendEquationAlpha||t.colorWrite!==r.colorWrite||t.depthWrite!==r.depthWrite||t.depthTest!==r.depthTest||t.depthFunc!==r.depthFunc||t.stencilWrite!==r.stencilWrite||t.stencilFunc!==r.stencilFunc||t.stencilFail!==r.stencilFail||t.stencilZFail!==r.stencilZFail||t.stencilZPass!==r.stencilZPass||t.stencilFuncMask!==r.stencilFuncMask||t.stencilWriteMask!==r.stencilWriteMask||t.side!==r.side||t.alphaToCoverage!==r.alphaToCoverage||t.sampleCount!==o||t.colorSpace!==a||t.colorFormat!==c||t.depthStencilFormat!==u||t.primitiveTopology!==f||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=o,t.colorSpace=a,t.colorFormat=c,t.depthStencilFormat=u,t.primitiveTopology=f,t.clippingContextCacheKey=e.clippingContextCacheKey,m=!0),m}getRenderCacheKey(e){const{object:t,material:n}=e,r=this.utils,s=e.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,r.getSampleCountRenderContext(s),r.getCurrentColorSpace(s),r.getCurrentColorFormat(s),r.getCurrentDepthStencilFormat(s),r.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,r,s,o){return this.textureUtils.copyTextureToBuffer(e,t,n,r,s,o)}initTimestampQuery(e,t){if(!this.trackTimestamp)return;const n=e.isComputeNode?"compute":"render";this.timestampQueryPool[n]||(this.timestampQueryPool[n]=new Iut(this.device,n,2048));const r=this.timestampQueryPool[n],s=r.allocateQueriesForContext(e);t.timestampWrites={querySet:r.querySet,beginningOfPassWriteIndex:s,endOfPassWriteIndex:s+1}}createNodeBuilder(e,t){return new _ut(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),s=n.currentPass.finish();this.get(t).bundleGPU=s,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){let a=0,c=0,u=0,f=0,m=0,v=0,x=e.image.width,T=e.image.height,P=1;n!==null&&(n.isBox3===!0?(f=n.min.x,m=n.min.y,v=n.min.z,x=n.max.x-n.min.x,T=n.max.y-n.min.y,P=n.max.z-n.min.z):(f=n.min.x,m=n.min.y,x=n.max.x-n.min.x,T=n.max.y-n.min.y,P=1)),r!==null&&(a=r.x,c=r.y,u=r.z||0);const R=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),M=this.get(e).texture,O=this.get(t).texture;R.copyTextureToTexture({texture:M,mipLevel:s,origin:{x:f,y:m,z:v}},{texture:O,mipLevel:o,origin:{x:a,y:c,z:u}},[x,T,P]),this.device.queue.submit([R.finish()]),o===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,n){const r=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const o=this.get(e).texture;if(s.format!==o.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,o.format);return}let a;if(r.currentPass?(r.currentPass.end(),a=r.encoder):a=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),a.copyTextureToTexture({texture:s,origin:[n.x,n.y,0]},{texture:o},[n.z,n.w]),r.currentPass){const{descriptor:c}=r;for(let u=0;u<c.colorAttachments.length;u++)c.colorAttachments[u].loadOp=ji.Load;if(t.depth&&(c.depthStencilAttachment.depthLoadOp=ji.Load),t.stencil&&(c.depthStencilAttachment.stencilLoadOp=ji.Load),r.currentPass=a.beginRenderPass(c),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor){const{x:u,y:f,width:m,height:v}=t.scissorValue;r.currentPass.setScissorRect(u,f,m,v)}}else this.device.queue.submit([a.finish()]);e.generateMipmaps&&this.textureUtils.generateMipmaps(e)}};const Dut=kut;class Fut extends vc{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new zi(16777215),this.specular=new zi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=j2,this.normalScale=new si(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new nh,this.combine=YU,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}const Out=new Fut;let But=class extends la{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(Out),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new _ie(t):null}setupLightingModel(){return new tNe}setupVariants(){const e=(this.shininessNode?Nt(this.shininessNode):Bst).max(1e-4);pte.assign(e);const t=this.specularNode||Ust;Gc.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}};const Lut=But;class mNe extends vc{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new zi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=j2,this.normalScale=new si(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new nh,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}const Uut=new mNe;let zut=class extends la{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(Uut),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new d0t(t):null}setupLightingModel(){return new rNe}setupSpecular(){const e=Us(Bt(.04),Bi.rgb,JL);Gc.assign(e),tU.assign(1)}setupVariants(){const e=this.metalnessNode?Nt(this.metalnessNode):Gst;JL.assign(e);let t=this.roughnessNode?Nt(this.roughnessNode):Vst;t=jPe({roughness:t}),x1.assign(t),this.setupSpecular(),Bi.assign(Gr(Bi.rgb.mul(e.oneMinus()),Bi.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}};const gNe=zut;class Vut extends mNe{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new si(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return di(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new zi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new zi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new zi(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}const Gut=new Vut;let $ut=class extends gNe{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(Gut),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?Nt(this.iorNode):not;jB.assign(e),Gc.assign(Us(J_(QRe(jB.sub(1).div(jB.add(1))).mul(zst),Bt(1)).mul(Zbe),Bi.rgb,JL)),tU.assign(Us(Zbe,1,JL))}setupLightingModel(){return new rNe(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?Nt(this.clearcoatNode):Hst,n=this.clearcoatRoughnessNode?Nt(this.clearcoatRoughnessNode):jst;dte.assign(t),eU.assign(jPe({roughness:n}))}if(this.useSheen){const t=this.sheenNode?Bt(this.sheenNode):Xst,n=this.sheenRoughnessNode?Nt(this.sheenRoughnessNode):Yst;G6.assign(t),Yre.assign(n)}if(this.useIridescence){const t=this.iridescenceNode?Nt(this.iridescenceNode):Zst,n=this.iridescenceIORNode?Nt(this.iridescenceIORNode):Qst,r=this.iridescenceThicknessNode?Nt(this.iridescenceThicknessNode):Jst;Kre.assign(t),BRe.assign(n),LRe.assign(r)}if(this.useAnisotropy){const t=(this.anisotropyNode?wn(this.anisotropyNode):Kst).toVar();Cy.assign(t.length()),Vo(Cy.equal(0),()=>{t.assign(wn(1,0))}).Else(()=>{t.divAssign(wn(Cy)),Cy.assign(Cy.saturate())}),fte.assign(Cy.pow2().mix(x1.pow2(),1)),HB.assign(lE[0].mul(t.x).add(lE[1].mul(t.y))),h_.assign(lE[1].mul(t.x).sub(lE[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?Nt(this.transmissionNode):eot,n=this.thicknessNode?Nt(this.thicknessNode):tot,r=this.attenuationDistanceNode?Nt(this.attenuationDistanceNode):rot,s=this.attenuationColorNode?Bt(this.attenuationColorNode):iot;if(mte.assign(t),URe.assign(n),zRe.assign(r),VRe.assign(s),this.useDispersion){const o=this.dispersionNode?Nt(this.dispersionNode):uot;GRe.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?Bt(this.clearcoatNormalNode):Wst}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}};const Hut=$ut,jut=Yt(({normal:i,lightDirection:e,builder:t})=>{const n=i.dot(e),r=wn(n.mul(.5).add(.5),0);if(t.material.gradientMap){const s=_2("gradientMap","texture").context({getUV:()=>r});return Bt(s.r)}else{const s=r.fwidth().mul(.5);return Us(Bt(.7),Bt(1),q2(Nt(.7).sub(s.x),Nt(.7).add(s.x),r.x))}});let Wut=class extends hz{direct({lightDirection:e,lightColor:t,reflectedLight:n},r){const s=jut({normal:fPe,lightDirection:e,builder:r}).mul(t);n.directDiffuse.addAssign(s.mul(tx({diffuseColor:Bi.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(tx({diffuseColor:Bi}))),r.indirectDiffuse.mulAssign(t)}};class qut extends vc{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new zi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=j2,this.normalScale=new si(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Xut=new qut;let Yut=class extends la{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Xut),this.setValues(e)}setupLightingModel(){return new Wut}};const Kut=Yut;let Zut=class extends Cx{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=Nt(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}};const Qut=new x2;let Jut=class extends la{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Qut),this.setValues(e)}setupNormal(){return Kf}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new _ie(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Zut(CPe)),t}setupOutgoingLight(){return Bi.rgb}setupLightingModel(){return new eNe}};const eht=Jut;class tht extends vc{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new zi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=j2,this.normalScale=new si(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new nh,this.combine=YU,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}const nht=new tht;let rht=class extends la{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(nht),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new _ie(t):null}setupLightingModel(){return new tNe(!1)}};const iht=rht;class sht extends vc{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=j2,this.normalScale=new si(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}const oht=new sht;let aht=class extends la{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(oht),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?Nt(this.opacityNode):MPe;Bi.assign(rie(Gr(rst(ra),e),Wc))}};const lht=aht;class cht extends vc{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new zi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=j2,this.normalScale=new si(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}const uht=new cht;let hht=class extends la{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(uht),this.setValues(e)}setupVariants(e){const t=est;let n;e.material.matcap?n=_2("matcap","texture").context({getUV:()=>t}):n=Bt(Us(.2,.8,t.y)),Bi.rgb.mulAssign(n.rgb)}};const dht=hht;class yNe extends vc{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new zi(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const fht=new yNe;let pht=class extends la{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(fht),this.setValues(e)}};const mht=pht;class ght extends yNe{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}const yht=new ght;let vht=class extends la{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(yht),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?Nt(this.offsetNode):lot,t=this.dashScaleNode?Nt(this.dashScaleNode):sot,n=this.dashSizeNode?Nt(this.dashSizeNode):oot,r=this.gapSizeNode?Nt(this.gapSizeNode):aot;MZ.assign(n),zbe.assign(r);const s=Ad(X2("lineDistance").mul(t));(e?s.add(e):s).mod(MZ.add(zbe)).greaterThan(MZ).discard()}};const _ht=vht;class xht extends vc{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new zi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const bht=new xht;let Sht=class extends la{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(bht),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,r=this.sizeAttenuation,{positionNode:s,rotationNode:o,scaleNode:a}=this,c=iz.mul(Bt(s||0));let u=wn(E4[0].xyz.length(),E4[1].xyz.length());if(a!==null&&(u=u.mul(wn(a))),r===!1)if(n.isPerspectiveCamera)u=u.mul(c.z.negate());else{const x=Nt(2).div(aie.element(1).element(1));u=u.mul(x.mul(2))}let f=sz.xy;if(t.center&&t.center.isVector2===!0){const x=fit("center","vec2",t);f=f.sub(x.sub(.5))}f=f.mul(u);const m=Nt(o||qst),v=mPe(f,m);return Gr(c.xy.add(v),c.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}};const vNe=Sht;class wht extends vc{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new zi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Tht=new wht;let Eht=class extends vNe{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(Tht),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return iz.mul(Bt(e||$l)).xyz}setupVertex(e){const t=super.setupVertex(e);if(e.material.isNodeMaterial!==!0)return t;const{rotationNode:n,scaleNode:r,sizeNode:s}=this,o=sz.xy.toVar(),a=LE.z.div(LE.w);if(n&&n.isNode){const u=Nt(n);o.assign(mPe(o,u))}let c=s!==null?wn(s):cot;return this.sizeAttenuation===!0&&(c=c.mul(c.div(oa.z.negate()))),r&&r.isNode&&(c=c.mul(wn(r))),o.mulAssign(c.mul(2)),o.assign(o.div(LE.z)),o.y.assign(o.y.mul(a)),o.assign(o.mul(t.w)),t.addAssign(Gr(o,0,0)),t}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}};const Mht=Eht;let Cht=class extends hz{constructor(){super(),this.shadowNode=Nt(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){Bi.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Bi.rgb)}};class Aht extends vc{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new zi(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}const Rht=new Aht;let Pht=class extends la{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(Rht),this.setValues(e)}setupLightingModel(){return new Cht}};const Nht=Pht;class D4 extends Pa{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new zi(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}const wQ=new bs,hwe=new st,dwe=new st;class Mie{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new si(512,512),this.mapType=N0,this.map=null,this.mapPass=null,this.matrix=new bs,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new wie,this._frameExtents=new si(1,1),this._viewportCount=1,this._viewports=[new _i(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;hwe.setFromMatrixPosition(e.matrixWorld),t.position.copy(hwe),dwe.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(dwe),t.updateMatrixWorld(),wQ.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(wQ),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(wQ)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}const fwe=new bs,AT=new st,TQ=new st;class Iht extends Mie{constructor(){super(new qc(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new si(4,2),this._viewportCount=6,this._viewports=[new _i(2,1,1,1),new _i(0,1,1,1),new _i(3,1,1,1),new _i(1,1,1,1),new _i(3,0,1,1),new _i(1,0,1,1)],this._cubeDirections=[new st(1,0,0),new st(-1,0,0),new st(0,0,1),new st(0,0,-1),new st(0,1,0),new st(0,-1,0)],this._cubeUps=[new st(0,1,0),new st(0,1,0),new st(0,1,0),new st(0,1,0),new st(0,0,1),new st(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),AT.setFromMatrixPosition(e.matrixWorld),n.position.copy(AT),TQ.copy(n.position),TQ.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(TQ),n.updateMatrixWorld(),r.makeTranslation(-AT.x,-AT.y,-AT.z),fwe.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(fwe)}}class kht extends D4{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Iht}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Dht extends Mie{constructor(){super(new die(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Fht extends D4{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Pa.DEFAULT_UP),this.updateMatrix(),this.target=new Pa,this.shadow=new Dht}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Oht extends D4{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Bht extends Mie{constructor(){super(new qc(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=X_*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||t.far;(n!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Cie extends D4{constructor(e,t,n=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Pa.DEFAULT_UP),this.updateMatrix(),this.target=new Pa,this.distance=n,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new Bht}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Lht extends D4{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Uht extends D4{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Pa.DEFAULT_UP),this.updateMatrix(),this.groundColor=new zi(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}class zht{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new st)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(n*s)),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*n*s),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const n=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-r*r)}}class Vht extends D4{constructor(e=new zht,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}let Ght=class extends Cie{constructor(e,t,n,r,s,o){super(e,t,n,r,s,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}};const $ht=Ght;let Hht=class extends Cie{constructor(e,t,n,r,s,o){super(e,t,n,r,s,o),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}};const jht=Hht;let Wht=class extends sNe{constructor(){super(),this.addMaterial(Lut,"MeshPhongMaterial"),this.addMaterial(gNe,"MeshStandardMaterial"),this.addMaterial(Hut,"MeshPhysicalMaterial"),this.addMaterial(Kut,"MeshToonMaterial"),this.addMaterial(eht,"MeshBasicMaterial"),this.addMaterial(iht,"MeshLambertMaterial"),this.addMaterial(lht,"MeshNormalMaterial"),this.addMaterial(dht,"MeshMatcapMaterial"),this.addMaterial(mht,"LineBasicMaterial"),this.addMaterial(_ht,"LineDashedMaterial"),this.addMaterial(Mht,"PointsMaterial"),this.addMaterial(vNe,"SpriteMaterial"),this.addMaterial(Nht,"ShadowMaterial"),this.addLight(jat,kht),this.addLight(i0t,Fht),this.addLight(s0t,Oht),this.addLight(vie,Cie),this.addLight(c0t,Lht),this.addLight(u0t,Uht),this.addLight(h0t,Vht),this.addLight(o0t,$ht),this.addLight(l0t,jht),this.addToneMapping(Jot,Uet),this.addToneMapping(eat,zet),this.addToneMapping(tat,Vet),this.addToneMapping(rat,Get),this.addToneMapping(aat,$et),this.addToneMapping(lat,Het)}};const qht=Wht;let Xht=class extends oct{constructor(e={}){let t;e.forceWebGL?t=rwe:(t=Dut,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new rwe(e)));const n=new t(e);super(n,e),this.library=new qht,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}};const EQ=Xht;class Yht extends rc{constructor(e,t){const n=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],r=new Xi;r.setAttribute("position",new br(n,3)),r.computeBoundingSphere();const s=new su({fog:!1});super(r,s),this.light=e,this.color=t,this.type="RectAreaLightHelper";const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],a=new Xi;a.setAttribute("position",new br(o,3)),a.computeBoundingSphere(),this.add(new dn(a,new Ea({side:Ui,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),this.color!==void 0)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const pwe={type:"change"},Aie={type:"start"},_Ne={type:"end"},QO=new yx,mwe=new Of,Kht=Math.cos(70*ml.DEG2RAD),xa=new be,ec=2*Math.PI,ds={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},MQ=1e-6;class Zht extends DAe{constructor(e,t=null){super(e,t),this.state=ds.NONE,this.target=new be,this.cursor=new be,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:n_.ROTATE,MIDDLE:n_.DOLLY,RIGHT:n_.PAN},this.touches={ONE:k6.ROTATE,TWO:k6.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new be,this._lastQuaternion=new qi,this._lastTargetPosition=new be,this._quat=new qi().setFromUnitVectors(e.up,new be(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new zee,this._sphericalDelta=new zee,this._scale=1,this._panOffset=new be,this._rotateStart=new mn,this._rotateEnd=new mn,this._rotateDelta=new mn,this._panStart=new mn,this._panEnd=new mn,this._panDelta=new mn,this._dollyStart=new mn,this._dollyEnd=new mn,this._dollyDelta=new mn,this._dollyDirection=new be,this._mouse=new mn,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Jht.bind(this),this._onPointerDown=Qht.bind(this),this._onPointerUp=edt.bind(this),this._onContextMenu=adt.bind(this),this._onMouseWheel=rdt.bind(this),this._onKeyDown=idt.bind(this),this._onTouchStart=sdt.bind(this),this._onTouchMove=odt.bind(this),this._onMouseDown=tdt.bind(this),this._onMouseMove=ndt.bind(this),this._interceptControlDown=ldt.bind(this),this._interceptControlUp=cdt.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(pwe),this.update(),this.state=ds.NONE}update(e=null){const t=this.object.position;xa.copy(t).sub(this.target),xa.applyQuaternion(this._quat),this._spherical.setFromVector3(xa),this.autoRotate&&this.state===ds.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(n)&&isFinite(r)&&(n<-Math.PI?n+=ec:n>Math.PI&&(n-=ec),r<-Math.PI?r+=ec:r>Math.PI&&(r-=ec),n<=r?this._spherical.theta=Math.max(n,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+r)/2?Math.max(n,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(xa.setFromSpherical(this._spherical),xa.applyQuaternion(this._quatInverse),t.copy(this.target).add(xa),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=xa.length();o=this._clampDistance(a*this._scale);const c=a-o;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),s=!!c}else if(this.object.isOrthographicCamera){const a=new be(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=c!==this.object.zoom;const u=new be(this._mouse.x,this._mouse.y,0);u.unproject(this.object),this.object.position.sub(u).add(a),this.object.updateMatrixWorld(),o=xa.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(QO.origin.copy(this.object.position),QO.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(QO.direction))<Kht?this.object.lookAt(this.target):(mwe.setFromNormalAndCoplanarPoint(this.object.up,this.target),QO.intersectPlane(mwe,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>MQ||8*(1-this._lastQuaternion.dot(this.object.quaternion))>MQ||this._lastTargetPosition.distanceToSquared(this.target)>MQ?(this.dispatchEvent(pwe),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?ec/60*this.autoRotateSpeed*e:ec/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){xa.setFromMatrixColumn(t,0),xa.multiplyScalar(-e),this._panOffset.add(xa)}_panUp(e,t){this.screenSpacePanning===!0?xa.setFromMatrixColumn(t,1):(xa.setFromMatrixColumn(t,0),xa.crossVectors(this.object.up,xa)),xa.multiplyScalar(e),this._panOffset.add(xa)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;xa.copy(r).sub(this.target);let s=xa.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/n.clientHeight,this.object.matrix),this._panUp(2*t*s/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),r=e-n.left,s=t-n.top,o=n.width,a=n.height;this._mouse.x=r/o*2-1,this._mouse.y=-(s/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(ec*this._rotateDelta.x/t.clientHeight),this._rotateUp(ec*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(ec*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-ec*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(ec*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-ec*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._rotateStart.set(n,r)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panStart.set(n,r)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(n*n+r*r);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),r=.5*(e.pageX+n.x),s=.5*(e.pageY+n.y);this._rotateEnd.set(r,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(ec*this._rotateDelta.x/t.clientHeight),this._rotateUp(ec*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panEnd.set(n,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(n*n+r*r);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new mn,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function Qht(i){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(i)&&(this._addPointer(i),i.pointerType==="touch"?this._onTouchStart(i):this._onMouseDown(i)))}function Jht(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchMove(i):this._onMouseMove(i))}function edt(i){switch(this._removePointer(i),this._pointers.length){case 0:this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(_Ne),this.state=ds.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function tdt(i){let e;switch(i.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case n_.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(i),this.state=ds.DOLLY;break;case n_.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=ds.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=ds.ROTATE}break;case n_.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=ds.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=ds.PAN}break;default:this.state=ds.NONE}this.state!==ds.NONE&&this.dispatchEvent(Aie)}function ndt(i){switch(this.state){case ds.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(i);break;case ds.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(i);break;case ds.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(i);break}}function rdt(i){this.enabled===!1||this.enableZoom===!1||this.state!==ds.NONE||(i.preventDefault(),this.dispatchEvent(Aie),this._handleMouseWheel(this._customWheelEvent(i)),this.dispatchEvent(_Ne))}function idt(i){this.enabled!==!1&&this._handleKeyDown(i)}function sdt(i){switch(this._trackPointer(i),this._pointers.length){case 1:switch(this.touches.ONE){case k6.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(i),this.state=ds.TOUCH_ROTATE;break;case k6.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(i),this.state=ds.TOUCH_PAN;break;default:this.state=ds.NONE}break;case 2:switch(this.touches.TWO){case k6.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(i),this.state=ds.TOUCH_DOLLY_PAN;break;case k6.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(i),this.state=ds.TOUCH_DOLLY_ROTATE;break;default:this.state=ds.NONE}break;default:this.state=ds.NONE}this.state!==ds.NONE&&this.dispatchEvent(Aie)}function odt(i){switch(this._trackPointer(i),this.state){case ds.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(i),this.update();break;case ds.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(i),this.update();break;case ds.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(i),this.update();break;case ds.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(i),this.update();break;default:this.state=ds.NONE}}function adt(i){this.enabled!==!1&&i.preventDefault()}function ldt(i){i.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function cdt(i){i.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const so={LEFT:1,RIGHT:2,MIDDLE:4},Ot=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),l6={NONE:0,IN:1,OUT:-1};function dy(i){return i.isPerspectiveCamera}function c2(i){return i.isOrthographicCamera}const c6=Math.PI*2,gwe=Math.PI/2,xNe=1e-5,RT=Math.PI/180;function nd(i,e,t){return Math.max(e,Math.min(t,i))}function As(i,e=xNe){return Math.abs(i)<e}function Qi(i,e,t=xNe){return As(i-e,t)}function ywe(i,e){return Math.round(i/e)*e}function PT(i){return isFinite(i)?i:i<0?-Number.MAX_VALUE:Number.MAX_VALUE}function NT(i){return Math.abs(i)<Number.MAX_VALUE?i:i*(1/0)}function JO(i,e,t,n,r=1/0,s){n=Math.max(1e-4,n);const o=2/n,a=o*s,c=1/(1+a+.48*a*a+.235*a*a*a);let u=i-e;const f=e,m=r*n;u=nd(u,-m,m),e=i-u;const v=(t.value+o*u)*s;t.value=(t.value-o*v)*c;let x=e+(u+v)*c;return f-i>0==x>f&&(x=f,t.value=(x-f)/s),x}function vwe(i,e,t,n,r=1/0,s,o){n=Math.max(1e-4,n);const a=2/n,c=a*s,u=1/(1+c+.48*c*c+.235*c*c*c);let f=e.x,m=e.y,v=e.z,x=i.x-f,T=i.y-m,P=i.z-v;const R=f,M=m,O=v,C=r*n,L=C*C,Y=x*x+T*T+P*P;if(Y>L){const ge=Math.sqrt(Y);x=x/ge*C,T=T/ge*C,P=P/ge*C}f=i.x-x,m=i.y-T,v=i.z-P;const J=(t.x+a*x)*s,z=(t.y+a*T)*s,ne=(t.z+a*P)*s;t.x=(t.x-a*J)*u,t.y=(t.y-a*z)*u,t.z=(t.z-a*ne)*u,o.x=f+(x+J)*u,o.y=m+(T+z)*u,o.z=v+(P+ne)*u;const K=R-i.x,$=M-i.y,he=O-i.z,Ce=o.x-R,Pe=o.y-M,je=o.z-O;return K*Ce+$*Pe+he*je>0&&(o.x=R,o.y=M,o.z=O,t.x=(o.x-R)/s,t.y=(o.y-M)/s,t.z=(o.z-O)/s),o}function CQ(i,e){e.set(0,0),i.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=i.length,e.y/=i.length}function AQ(i,e){return c2(i)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class udt{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e)}}}var RQ;const hdt="2.9.0",eB=1/8,ddt=/Mac/.test((RQ=globalThis==null?void 0:globalThis.navigator)===null||RQ===void 0?void 0:RQ.platform);let Ir,_we,tB,PQ,tc,ti,Fi,u6,IT,Cf,Af,fy,xwe,bwe,Lu,kT,h6,Swe,NQ,wwe,IQ,kQ,nB;class Ff extends udt{static install(e){Ir=e.THREE,_we=Object.freeze(new Ir.Vector3(0,0,0)),tB=Object.freeze(new Ir.Vector3(0,1,0)),PQ=Object.freeze(new Ir.Vector3(0,0,1)),tc=new Ir.Vector2,ti=new Ir.Vector3,Fi=new Ir.Vector3,u6=new Ir.Vector3,IT=new Ir.Vector3,Cf=new Ir.Vector3,Af=new Ir.Vector3,fy=new Ir.Vector3,xwe=new Ir.Vector3,bwe=new Ir.Vector3,Lu=new Ir.Spherical,kT=new Ir.Spherical,h6=new Ir.Box3,Swe=new Ir.Box3,NQ=new Ir.Sphere,wwe=new Ir.Quaternion,IQ=new Ir.Quaternion,kQ=new Ir.Matrix4,nB=new Ir.Raycaster}static get ACTION(){return Ot}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=Ot.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=l6.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Ir.Vector3,this._focalOffsetVelocity=new Ir.Vector3,this._zoomVelocity={value:0},this._truckInternal=(M,O,C)=>{let L,Y;if(dy(this._camera)){const J=ti.copy(this._camera.position).sub(this._target),z=this._camera.getEffectiveFOV()*RT,ne=J.length()*Math.tan(z*.5);L=this.truckSpeed*M*ne/this._elementRect.height,Y=this.truckSpeed*O*ne/this._elementRect.height}else if(c2(this._camera)){const J=this._camera;L=M*(J.right-J.left)/J.zoom/this._elementRect.width,Y=O*(J.top-J.bottom)/J.zoom/this._elementRect.height}else return;this.verticalDragToForward?(C?this.setFocalOffset(this._focalOffsetEnd.x+L,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(L,0,!0),this.forward(-Y,!0)):C?this.setFocalOffset(this._focalOffsetEnd.x+L,this._focalOffsetEnd.y+Y,this._focalOffsetEnd.z,!0):this.truck(L,Y,!0)},this._rotateInternal=(M,O)=>{const C=c6*this.azimuthRotateSpeed*M/this._elementRect.height,L=c6*this.polarRotateSpeed*O/this._elementRect.height;this.rotate(C,L,!0)},this._dollyInternal=(M,O,C)=>{const L=Math.pow(.95,-M*this.dollySpeed),Y=this._sphericalEnd.radius,J=this._sphericalEnd.radius*L,z=nd(J,this.minDistance,this.maxDistance),ne=z-J;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(J,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(ne,!0),this._dollyToNoClamp(z,!0)):this._dollyToNoClamp(z,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?J:z)-Y,this._dollyControlCoord.set(O,C)),this._lastDollyDirection=Math.sign(-M)},this._zoomInternal=(M,O,C)=>{const L=Math.pow(.95,M*this.dollySpeed),Y=this._zoom,J=this._zoom*L;this.zoomTo(J,!0),this.dollyToCursor&&(this._changedZoom+=J-Y,this._dollyControlCoord.set(O,C))},typeof Ir>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new Ir.Quaternion().setFromUnitVectors(this._camera.up,tB),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=Ot.NONE,this._target=new Ir.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Ir.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new Ir.Spherical().setFromVector3(ti.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Ir.Vector3,new Ir.Vector3,new Ir.Vector3,new Ir.Vector3],this._updateNearPlaneCorners(),this._boundary=new Ir.Box3(new Ir.Vector3(-1/0,-1/0,-1/0),new Ir.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Ir.Vector2,this.mouseButtons={left:Ot.ROTATE,middle:Ot.DOLLY,right:Ot.TRUCK,wheel:dy(this._camera)?Ot.DOLLY:c2(this._camera)?Ot.ZOOM:Ot.NONE},this.touches={one:Ot.TOUCH_ROTATE,two:dy(this._camera)?Ot.TOUCH_DOLLY_TRUCK:c2(this._camera)?Ot.TOUCH_ZOOM_TRUCK:Ot.NONE,three:Ot.TOUCH_TRUCK};const n=new Ir.Vector2,r=new Ir.Vector2,s=new Ir.Vector2,o=M=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const L=this._domElement.getBoundingClientRect(),Y=M.clientX/L.width,J=M.clientY/L.height;if(Y<this._interactiveArea.left||Y>this._interactiveArea.right||J<this._interactiveArea.top||J>this._interactiveArea.bottom)return}const O=M.pointerType!=="mouse"?null:(M.buttons&so.LEFT)===so.LEFT?so.LEFT:(M.buttons&so.MIDDLE)===so.MIDDLE?so.MIDDLE:(M.buttons&so.RIGHT)===so.RIGHT?so.RIGHT:null;if(O!==null){const L=this._findPointerByMouseButton(O);L&&this._disposePointer(L)}if((M.buttons&so.LEFT)===so.LEFT&&this._lockedPointer)return;const C={pointerId:M.pointerId,clientX:M.clientX,clientY:M.clientY,deltaX:0,deltaY:0,mouseButton:O};this._activePointers.push(C),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,v(M)},a=M=>{M.cancelable&&M.preventDefault();const O=M.pointerId,C=this._lockedPointer||this._findPointerById(O);if(C){if(C.clientX=M.clientX,C.clientY=M.clientY,C.deltaX=M.movementX,C.deltaY=M.movementY,this._state=0,M.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(M.buttons&so.LEFT)===so.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(M.buttons&so.MIDDLE)===so.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(M.buttons&so.RIGHT)===so.RIGHT&&(this._state=this._state|this.mouseButtons.right);x()}},c=M=>{const O=this._findPointerById(M.pointerId);if(!(O&&O===this._lockedPointer)){if(O&&this._disposePointer(O),M.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=Ot.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=Ot.NONE;T()}};let u=-1;const f=M=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===Ot.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const J=this._domElement.getBoundingClientRect(),z=M.clientX/J.width,ne=M.clientY/J.height;if(z<this._interactiveArea.left||z>this._interactiveArea.right||ne<this._interactiveArea.top||ne>this._interactiveArea.bottom)return}if(M.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===Ot.ROTATE||this.mouseButtons.wheel===Ot.TRUCK){const J=performance.now();u-J<1e3&&this._getClientRect(this._elementRect),u=J}const O=ddt?-1:-3,C=M.deltaMode===1?M.deltaY/O:M.deltaY/(O*10),L=this.dollyToCursor?(M.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,Y=this.dollyToCursor?(M.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case Ot.ROTATE:{this._rotateInternal(M.deltaX,M.deltaY),this._isUserControllingRotate=!0;break}case Ot.TRUCK:{this._truckInternal(M.deltaX,M.deltaY,!1),this._isUserControllingTruck=!0;break}case Ot.OFFSET:{this._truckInternal(M.deltaX,M.deltaY,!0),this._isUserControllingOffset=!0;break}case Ot.DOLLY:{this._dollyInternal(-C,L,Y),this._isUserControllingDolly=!0;break}case Ot.ZOOM:{this._zoomInternal(-C,L,Y),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},m=M=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Ff.ACTION.NONE){const O=M instanceof PointerEvent?M.pointerId:0,C=this._findPointerById(O);C&&this._disposePointer(C),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c);return}M.preventDefault()}},v=M=>{if(!this._enabled)return;if(CQ(this._activePointers,tc),this._getClientRect(this._elementRect),n.copy(tc),r.copy(tc),this._activePointers.length>=2){const C=tc.x-this._activePointers[1].clientX,L=tc.y-this._activePointers[1].clientY,Y=Math.sqrt(C*C+L*L);s.set(0,Y);const J=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,z=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;r.set(J,z)}if(this._state=0,!M)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in M&&M.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(M.buttons&so.LEFT)===so.LEFT&&(this._state=this._state|this.mouseButtons.left),(M.buttons&so.MIDDLE)===so.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(M.buttons&so.RIGHT)===so.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&Ot.ROTATE)===Ot.ROTATE||(this._state&Ot.TOUCH_ROTATE)===Ot.TOUCH_ROTATE||(this._state&Ot.TOUCH_DOLLY_ROTATE)===Ot.TOUCH_DOLLY_ROTATE||(this._state&Ot.TOUCH_ZOOM_ROTATE)===Ot.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&Ot.TRUCK)===Ot.TRUCK||(this._state&Ot.TOUCH_TRUCK)===Ot.TOUCH_TRUCK||(this._state&Ot.TOUCH_DOLLY_TRUCK)===Ot.TOUCH_DOLLY_TRUCK||(this._state&Ot.TOUCH_ZOOM_TRUCK)===Ot.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&Ot.DOLLY)===Ot.DOLLY||(this._state&Ot.TOUCH_DOLLY)===Ot.TOUCH_DOLLY||(this._state&Ot.TOUCH_DOLLY_TRUCK)===Ot.TOUCH_DOLLY_TRUCK||(this._state&Ot.TOUCH_DOLLY_OFFSET)===Ot.TOUCH_DOLLY_OFFSET||(this._state&Ot.TOUCH_DOLLY_ROTATE)===Ot.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&Ot.ZOOM)===Ot.ZOOM||(this._state&Ot.TOUCH_ZOOM)===Ot.TOUCH_ZOOM||(this._state&Ot.TOUCH_ZOOM_TRUCK)===Ot.TOUCH_ZOOM_TRUCK||(this._state&Ot.TOUCH_ZOOM_OFFSET)===Ot.TOUCH_ZOOM_OFFSET||(this._state&Ot.TOUCH_ZOOM_ROTATE)===Ot.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&Ot.OFFSET)===Ot.OFFSET||(this._state&Ot.TOUCH_OFFSET)===Ot.TOUCH_OFFSET||(this._state&Ot.TOUCH_DOLLY_OFFSET)===Ot.TOUCH_DOLLY_OFFSET||(this._state&Ot.TOUCH_ZOOM_OFFSET)===Ot.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},x=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,CQ(this._activePointers,tc);const O=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,C=O?-O.deltaX:r.x-tc.x,L=O?-O.deltaY:r.y-tc.y;if(r.copy(tc),((this._state&Ot.ROTATE)===Ot.ROTATE||(this._state&Ot.TOUCH_ROTATE)===Ot.TOUCH_ROTATE||(this._state&Ot.TOUCH_DOLLY_ROTATE)===Ot.TOUCH_DOLLY_ROTATE||(this._state&Ot.TOUCH_ZOOM_ROTATE)===Ot.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(C,L),this._isUserControllingRotate=!0),(this._state&Ot.DOLLY)===Ot.DOLLY||(this._state&Ot.ZOOM)===Ot.ZOOM){const Y=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,J=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0,z=this.dollyDragInverted?-1:1;(this._state&Ot.DOLLY)===Ot.DOLLY?(this._dollyInternal(z*L*eB,Y,J),this._isUserControllingDolly=!0):(this._zoomInternal(z*L*eB,Y,J),this._isUserControllingZoom=!0)}if((this._state&Ot.TOUCH_DOLLY)===Ot.TOUCH_DOLLY||(this._state&Ot.TOUCH_ZOOM)===Ot.TOUCH_ZOOM||(this._state&Ot.TOUCH_DOLLY_TRUCK)===Ot.TOUCH_DOLLY_TRUCK||(this._state&Ot.TOUCH_ZOOM_TRUCK)===Ot.TOUCH_ZOOM_TRUCK||(this._state&Ot.TOUCH_DOLLY_OFFSET)===Ot.TOUCH_DOLLY_OFFSET||(this._state&Ot.TOUCH_ZOOM_OFFSET)===Ot.TOUCH_ZOOM_OFFSET||(this._state&Ot.TOUCH_DOLLY_ROTATE)===Ot.TOUCH_DOLLY_ROTATE||(this._state&Ot.TOUCH_ZOOM_ROTATE)===Ot.TOUCH_ZOOM_ROTATE){const Y=tc.x-this._activePointers[1].clientX,J=tc.y-this._activePointers[1].clientY,z=Math.sqrt(Y*Y+J*J),ne=s.y-z;s.set(0,z);const K=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,$=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&Ot.TOUCH_DOLLY)===Ot.TOUCH_DOLLY||(this._state&Ot.TOUCH_DOLLY_ROTATE)===Ot.TOUCH_DOLLY_ROTATE||(this._state&Ot.TOUCH_DOLLY_TRUCK)===Ot.TOUCH_DOLLY_TRUCK||(this._state&Ot.TOUCH_DOLLY_OFFSET)===Ot.TOUCH_DOLLY_OFFSET?(this._dollyInternal(ne*eB,K,$),this._isUserControllingDolly=!0):(this._zoomInternal(ne*eB,K,$),this._isUserControllingZoom=!0)}((this._state&Ot.TRUCK)===Ot.TRUCK||(this._state&Ot.TOUCH_TRUCK)===Ot.TOUCH_TRUCK||(this._state&Ot.TOUCH_DOLLY_TRUCK)===Ot.TOUCH_DOLLY_TRUCK||(this._state&Ot.TOUCH_ZOOM_TRUCK)===Ot.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(C,L,!1),this._isUserControllingTruck=!0),((this._state&Ot.OFFSET)===Ot.OFFSET||(this._state&Ot.TOUCH_OFFSET)===Ot.TOUCH_OFFSET||(this._state&Ot.TOUCH_DOLLY_OFFSET)===Ot.TOUCH_DOLLY_OFFSET||(this._state&Ot.TOUCH_ZOOM_OFFSET)===Ot.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(C,L,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},T=()=>{CQ(this._activePointers,tc),r.copy(tc),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",P),this._domElement.ownerDocument.addEventListener("pointerlockerror",R),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),v())},this.unlockPointer=()=>{var M,O,C;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(M=this._domElement)===null||M===void 0||M.ownerDocument.exitPointerLock(),(O=this._domElement)===null||O===void 0||O.ownerDocument.removeEventListener("pointerlockchange",P),(C=this._domElement)===null||C===void 0||C.ownerDocument.removeEventListener("pointerlockerror",R),this.cancel()};const P=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},R=()=>{this.unlockPointer()};this._addAllEventListeners=M=>{this._domElement=M,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",f,{passive:!1}),this._domElement.addEventListener("contextmenu",m)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",f,{passive:!1}),this._domElement.removeEventListener("contextmenu",m),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("pointerlockchange",P),this._domElement.ownerDocument.removeEventListener("pointerlockerror",R))},this.cancel=()=>{this._state!==Ot.NONE&&(this._state=Ot.NONE,this._activePointers.length=0,T())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=nd(e.width,0,1),this._interactiveArea.height=nd(e.height,0,1),this._interactiveArea.x=nd(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=nd(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,n=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,n)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,n=!1){this._isUserControllingRotate=!1;const r=nd(e,this.minAzimuthAngle,this.maxAzimuthAngle),s=nd(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=s,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!n||Qi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Qi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=l6.NONE,this._changedDolly=0,this._dollyToNoClamp(nd(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const n=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),a=Qi(o,this._spherical.radius);if(!(n>e)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,o)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const s=!t||Qi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(s)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(IT).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const n=!t||Qi(this._target.x,this._targetEnd.x,this.restThreshold)&&Qi(this._target.y,this._targetEnd.y,this.restThreshold)&&Qi(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=nd(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const n=!t||Qi(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(e,t,n=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,n)}truck(e,t,n=!1){this._camera.updateMatrix(),Cf.setFromMatrixColumn(this._camera.matrix,0),Af.setFromMatrixColumn(this._camera.matrix,1),Cf.multiplyScalar(e),Af.multiplyScalar(-t);const r=ti.copy(Cf).add(Af),s=Fi.copy(this._targetEnd).add(r);return this.moveTo(s.x,s.y,s.z,n)}forward(e,t=!1){ti.setFromMatrixColumn(this._camera.matrix,0),ti.crossVectors(this._camera.up,ti),ti.multiplyScalar(e);const n=Fi.copy(this._targetEnd).add(ti);return this.moveTo(n.x,n.y,n.z,t)}elevate(e,t=!1){return ti.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+ti.x,this._targetEnd.y+ti.y,this._targetEnd.z+ti.z,t)}moveTo(e,t,n,r=!1){this._isUserControllingTruck=!1;const s=ti.set(e,t,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,s,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);const o=!r||Qi(this._target.x,this._targetEnd.x,this.restThreshold)&&Qi(this._target.y,this._targetEnd.y,this.restThreshold)&&Qi(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,t,n,r=!1){const a=ti.set(e,t,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(a.x,a.y,a.z,r)}fitToBox(e,t,{cover:n=!1,paddingLeft:r=0,paddingRight:s=0,paddingBottom:o=0,paddingTop:a=0}={}){const c=[],u=e.isBox3?h6.copy(e):h6.setFromObject(e);u.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const f=ywe(this._sphericalEnd.theta,gwe),m=ywe(this._sphericalEnd.phi,gwe);c.push(this.rotateTo(f,m,t));const v=ti.setFromSpherical(this._sphericalEnd).normalize(),x=wwe.setFromUnitVectors(v,PQ),T=Qi(Math.abs(v.y),1);T&&x.multiply(IQ.setFromAxisAngle(tB,f)),x.multiply(this._yAxisUpSpaceInverse);const P=Swe.makeEmpty();Fi.copy(u.min).applyQuaternion(x),P.expandByPoint(Fi),Fi.copy(u.min).setX(u.max.x).applyQuaternion(x),P.expandByPoint(Fi),Fi.copy(u.min).setY(u.max.y).applyQuaternion(x),P.expandByPoint(Fi),Fi.copy(u.max).setZ(u.min.z).applyQuaternion(x),P.expandByPoint(Fi),Fi.copy(u.min).setZ(u.max.z).applyQuaternion(x),P.expandByPoint(Fi),Fi.copy(u.max).setY(u.min.y).applyQuaternion(x),P.expandByPoint(Fi),Fi.copy(u.max).setX(u.min.x).applyQuaternion(x),P.expandByPoint(Fi),Fi.copy(u.max).applyQuaternion(x),P.expandByPoint(Fi),P.min.x-=r,P.min.y-=o,P.max.x+=s,P.max.y+=a,x.setFromUnitVectors(PQ,v),T&&x.premultiply(IQ.invert()),x.premultiply(this._yAxisUpSpace);const R=P.getSize(ti),M=P.getCenter(Fi).applyQuaternion(x);if(dy(this._camera)){const O=this.getDistanceToFitBox(R.x,R.y,R.z,n);c.push(this.moveTo(M.x,M.y,M.z,t)),c.push(this.dollyTo(O,t)),c.push(this.setFocalOffset(0,0,0,t))}else if(c2(this._camera)){const O=this._camera,C=O.right-O.left,L=O.top-O.bottom,Y=n?Math.max(C/R.x,L/R.y):Math.min(C/R.x,L/R.y);c.push(this.moveTo(M.x,M.y,M.z,t)),c.push(this.zoomTo(Y,t)),c.push(this.setFocalOffset(0,0,0,t))}return Promise.all(c)}fitToSphere(e,t){const n=[],s="isObject3D"in e?Ff.createBoundingSphere(e,NQ):NQ.copy(e);if(n.push(this.moveTo(s.center.x,s.center.y,s.center.z,t)),dy(this._camera)){const o=this.getDistanceToFitSphere(s.radius);n.push(this.dollyTo(o,t))}else if(c2(this._camera)){const o=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,c=2*s.radius,u=Math.min(o/c,a/c);n.push(this.zoomTo(u,t))}return n.push(this.setFocalOffset(0,0,0,t)),Promise.all(n)}setLookAt(e,t,n,r,s,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=l6.NONE,this._changedDolly=0;const c=Fi.set(r,s,o),u=ti.set(e,t,n);this._targetEnd.copy(c),this._sphericalEnd.setFromVector3(u.sub(c).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const f=!a||Qi(this._target.x,this._targetEnd.x,this.restThreshold)&&Qi(this._target.y,this._targetEnd.y,this.restThreshold)&&Qi(this._target.z,this._targetEnd.z,this.restThreshold)&&Qi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Qi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Qi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(f)}lerpLookAt(e,t,n,r,s,o,a,c,u,f,m,v,x,T=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=l6.NONE,this._changedDolly=0;const P=ti.set(r,s,o),R=Fi.set(e,t,n);Lu.setFromVector3(R.sub(P).applyQuaternion(this._yAxisUpSpace));const M=u6.set(f,m,v),O=Fi.set(a,c,u);kT.setFromVector3(O.sub(M).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(P.lerp(M,x));const C=kT.theta-Lu.theta,L=kT.phi-Lu.phi,Y=kT.radius-Lu.radius;this._sphericalEnd.set(Lu.radius+Y*x,Lu.phi+L*x,Lu.theta+C*x),this.normalizeRotations(),this._needsUpdate=!0,T||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const J=!T||Qi(this._target.x,this._targetEnd.x,this.restThreshold)&&Qi(this._target.y,this._targetEnd.y,this.restThreshold)&&Qi(this._target.z,this._targetEnd.z,this.restThreshold)&&Qi(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Qi(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Qi(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(J)}setPosition(e,t,n,r=!1){return this.setLookAt(e,t,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(e,t,n,r=!1){const s=this.getPosition(ti),o=this.setLookAt(s.x,s.y,s.z,e,t,n,r);return this._sphericalEnd.phi=nd(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,t,n,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,n),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);const s=!r||Qi(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Qi(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Qi(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}setOrbitPoint(e,t,n){this._camera.updateMatrixWorld(),Cf.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Af.setFromMatrixColumn(this._camera.matrixWorldInverse,1),fy.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const r=ti.set(e,t,n),s=r.distanceTo(this._camera.position),o=r.sub(this._camera.position);Cf.multiplyScalar(o.x),Af.multiplyScalar(o.y),fy.multiplyScalar(o.z),ti.copy(Cf).add(Af).add(fy),ti.z=ti.z+s,this.dollyTo(s,!1),this.setFocalOffset(-ti.x,ti.y,-ti.z,!1),this.moveTo(e,t,n,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,n,r){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new Ir.Vector4,typeof e=="number"?this._viewport.set(e,t,n,r):this._viewport.copy(e)}getDistanceToFitBox(e,t,n,r=!1){if(AQ(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const s=e/t,o=this._camera.getEffectiveFOV()*RT,a=this._camera.aspect;return((r?s>a:s<a)?t:e/a)*.5/Math.tan(o*.5)+n*.5}getDistanceToFitSphere(e){if(AQ(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*RT,n=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,r=1<this._camera.aspect?t:n;return e/Math.sin(r*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new Ir.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new Ir.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new Ir.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new Ir.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%c6,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=c6),this._spherical.theta+=c6*Math.round((this._sphericalEnd.theta-this._spherical.theta)/c6)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!Qi(this._camera.up.x,this._cameraUp0.x)||!Qi(this._camera.up.y,this._cameraUp0.y)||!Qi(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const n=this.getPosition(ti);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,tB),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=ti.subVectors(this._target,this._camera.position).normalize(),t=Fi.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const n=this.getPosition(ti);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,s=xwe.subVectors(this._targetEnd,this._target),o=bwe.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(As(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const m=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=JO(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,m,1/0,e),this._needsUpdate=!0}if(As(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const m=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=JO(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,m,1/0,e),this._needsUpdate=!0}if(As(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const m=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=JO(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,m,this.maxSpeed,e),this._needsUpdate=!0}if(As(s.x)&&As(s.y)&&As(s.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const m=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;vwe(this._target,this._targetEnd,this._targetVelocity,m,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(As(o.x)&&As(o.y)&&As(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const m=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;vwe(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,m,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(As(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const m=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=JO(this._zoom,this._zoomEnd,this._zoomVelocity,m,1/0,e)}if(this.dollyToCursor){if(dy(this._camera)&&this._changedDolly!==0){const m=this._spherical.radius-this._lastDistance,v=this._camera,x=this._getCameraDirection(IT),T=ti.copy(x).cross(v.up).normalize();T.lengthSq()===0&&(T.x=1);const P=Fi.crossVectors(T,x),R=this._sphericalEnd.radius*Math.tan(v.getEffectiveFOV()*RT*.5),O=(this._sphericalEnd.radius-m-this._sphericalEnd.radius)/this._sphericalEnd.radius,C=u6.copy(this._targetEnd).add(T.multiplyScalar(this._dollyControlCoord.x*R*v.aspect)).add(P.multiplyScalar(this._dollyControlCoord.y*R)),L=ti.copy(this._targetEnd).lerp(C,O),Y=this._lastDollyDirection===l6.IN&&this._spherical.radius<=this.minDistance,J=this._lastDollyDirection===l6.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(Y||J)){this._sphericalEnd.radius-=m,this._spherical.radius-=m;const ne=Fi.copy(x).multiplyScalar(-m);L.add(ne)}this._boundary.clampPoint(L,L);const z=Fi.subVectors(L,this._targetEnd);this._targetEnd.copy(L),this._target.add(z),this._changedDolly-=m,As(this._changedDolly)&&(this._changedDolly=0)}else if(c2(this._camera)&&this._changedZoom!==0){const m=this._zoom-this._lastZoom,v=this._camera,x=ti.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(v.near+v.far)/(v.near-v.far)).unproject(v),T=Fi.set(0,0,-1).applyQuaternion(v.quaternion),P=u6.copy(x).add(T.multiplyScalar(-x.dot(v.up))),M=-(this._zoom-m-this._zoom)/this._zoom,O=this._getCameraDirection(IT),C=this._targetEnd.dot(O),L=ti.copy(this._targetEnd).lerp(P,M),Y=L.dot(O),J=O.multiplyScalar(Y-C);L.sub(J),this._boundary.clampPoint(L,L);const z=Fi.subVectors(L,this._targetEnd);this._targetEnd.copy(L),this._target.add(z),this._changedZoom-=m,As(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const c=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,c),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!As(this._focalOffset.x)||!As(this._focalOffset.y)||!As(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Cf.setFromMatrixColumn(this._camera.matrix,0),Af.setFromMatrixColumn(this._camera.matrix,1),fy.setFromMatrixColumn(this._camera.matrix,2),Cf.multiplyScalar(this._focalOffset.x),Af.multiplyScalar(-this._focalOffset.y),fy.multiplyScalar(this._focalOffset.z),ti.copy(Cf).add(Af).add(fy),this._camera.position.add(ti)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),ti.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const f=this._needsUpdate;return f&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):f?(this.dispatchEvent({type:"update"}),As(t,this.restThreshold)&&As(n,this.restThreshold)&&As(r,this.restThreshold)&&As(s.x,this.restThreshold)&&As(s.y,this.restThreshold)&&As(s.z,this.restThreshold)&&As(o.x,this.restThreshold)&&As(o.y,this.restThreshold)&&As(o.z,this.restThreshold)&&As(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!f&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=f,this._needsUpdate=!1,f}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:PT(this.maxDistance),minZoom:this.minZoom,maxZoom:PT(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:PT(this.maxPolarAngle),minAzimuthAngle:PT(this.minAzimuthAngle),maxAzimuthAngle:PT(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:ti.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const n=JSON.parse(e);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=NT(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=NT(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=NT(n.maxPolarAngle),this.minAzimuthAngle=NT(n.minAzimuthAngle),this.maxAzimuthAngle=NT(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this.verticalDragToForward=n.verticalDragToForward,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],t),Lu.setFromVector3(ti.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Lu.theta,Lu.phi,t),this.dollyTo(Lu.radius,t),this.zoomTo(n.zoom,t),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",hdt),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,n){const r=t.lengthSq();if(r===0)return e;const s=Fi.copy(t).add(e),a=this._boundary.clampPoint(s,u6).sub(s),c=a.lengthSq();if(c===0)return e.add(t);if(c===r)return e;if(n===0)return e.add(t).add(a);{const u=1+n*c/t.dot(a);return e.add(Fi.copy(t).multiplyScalar(u)).add(a.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(dy(this._camera)){const e=this._camera,t=e.near,n=e.getEffectiveFOV()*RT,r=Math.tan(n*.5)*t,s=r*e.aspect;this._nearPlaneCorners[0].set(-s,-r,0),this._nearPlaneCorners[1].set(s,-r,0),this._nearPlaneCorners[2].set(s,r,0),this._nearPlaneCorners[3].set(-s,r,0)}else if(c2(this._camera)){const e=this._camera,t=1/e.zoom,n=e.left*t,r=e.right*t,s=e.top*t,o=e.bottom*t;this._nearPlaneCorners[0].set(n,s,0),this._nearPlaneCorners[1].set(r,s,0),this._nearPlaneCorners[2].set(r,o,0),this._nearPlaneCorners[3].set(n,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||AQ(this._camera,"_collisionTest"))return e;const n=this._getTargetDirection(IT);kQ.lookAt(_we,n,this._camera.up);for(let r=0;r<4;r++){const s=Fi.copy(this._nearPlaneCorners[r]);s.applyMatrix4(kQ);const o=u6.addVectors(this._target,s);nB.set(o,n),nB.far=this._spherical.radius+1;const a=nB.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const n=()=>{this.removeEventListener("rest",n),t()};this.addEventListener("rest",n)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new Ir.Sphere){const n=t,r=n.center;h6.makeEmpty(),e.traverseVisible(o=>{o.isMesh&&h6.expandByObject(o)}),h6.getCenter(r);let s=0;return e.traverseVisible(o=>{if(!o.isMesh)return;const a=o,c=a.geometry.clone();c.applyMatrix4(a.matrixWorld);const f=c.attributes.position;for(let m=0,v=f.count;m<v;m++)ti.fromBufferAttribute(f,m),s=Math.max(s,r.distanceToSquared(ti))}),n.radius=Math.sqrt(s),n}}const rU=i=>{const[e,t]=_n.useState(i.options[i.index]),n=()=>{i.onToggle(!i.open)},r=s=>{s!==e&&(i.onSelect(s),t(s)),i.onToggle(!1)};return We.jsxs("div",{className:`dropdown ${i.up===!0?"up":""}`,children:[We.jsx("div",{className:"dropdown-toggle",onClick:n,children:`${i.title}: ${e}`}),i.open&&We.jsx("ul",{className:"dropdown-menu",children:i.options.map(s=>We.jsx("li",{onClick:()=>r(s),children:s},s))})]})},py=_n.forwardRef(function(e,t){const n=["Renderer","Depth","Normals","UVs","Wireframe"],[r,s]=_n.useState("Renderer"),[o,a]=_n.useState(!1),[c,u]=_n.useState(!1),[f,m]=_n.useState(!1);return We.jsxs("div",{className:`CameraWindow ${e.name}`,children:[We.jsx("div",{ref:t,className:"clickable",onClick:()=>{f&&m(!1)}}),We.jsxs("div",{className:"options",children:[e.camera!==null&&We.jsx(rU,{title:"Camera",index:e.options.indexOf(e.camera.name),open:f,options:e.options,onSelect:e.onSelectCamera,onToggle:v=>{m(v)},up:!0}),We.jsx(rU,{title:"Mode",index:n.indexOf(r),open:c,options:n,onSelect:v=>{if(v===r)return;const x=v;e.onSelectRenderMode(x),s(x)},onToggle:v=>{o&&a(!1),u(v)},up:!0})]})]})}),fdt=`out vec3 worldPosition;
uniform float uDistance;

void main() {
  // Scale the plane by the drawing distance
  worldPosition = position.xzy * uDistance;
  worldPosition.xz += cameraPosition.xz;

  gl_Position = projectionMatrix * modelViewMatrix * vec4(worldPosition, 1.0);
}`,pdt=`out vec4 fragColor;
in vec3 worldPosition;
uniform float uDivisions;
uniform float uScale;
uniform vec3 uColor;
uniform float uDistance;
uniform float uGridOpacity;
uniform float uSubgridOpacity;

float getGrid(float gapSize) {
  vec2 worldPositionByDivision = worldPosition.xz / gapSize;

  // Inverted, 0 where line, >1 where there's no line
  // We use the worldPosition (which in this case we use similarly to UVs) differential to control the anti-aliasing
  // We need to do the -0.5)-0.5 trick because the result fades out from 0 to 1, and we want both
  // worldPositionByDivision == 0.3 and worldPositionByDivision == 0.7 to result in the same fade, i.e. 0.3,
  // otherwise only one side of the line will be anti-aliased
  vec2 grid = abs(fract(worldPositionByDivision-0.5)-0.5) / fwidth(worldPositionByDivision) / 2.0;
  float gridLine = min(grid.x, grid.y);

  // Uninvert and clamp
  return 1.0 - min(gridLine, 1.0);
}

void main() {
  float cameraDistanceToGridPlane = max(200.0, distance(cameraPosition.y, worldPosition.y));
  float cameraDistanceToFragmentOnGridPlane = distance(cameraPosition.xyz, worldPosition.xyz);

  // The size of the grid and subgrid are powers of each other and they are determined based on camera distance.
  // The current grid will become the next subgrid when it becomes too small, and its next power becomes the new grid.
  float subGridPower = pow(uDivisions, floor(log(cameraDistanceToGridPlane) / log(uDivisions)));
  float gridPower = subGridPower * uDivisions;

  // If we want to fade both the grid and its subgrid, we need to displays 3 different opacities, with the next grid being the third
  float nextGridPower = gridPower * uDivisions;

  // 1 where grid, 0 where no grid
  float subgrid = getGrid(subGridPower * uScale);
  float grid = getGrid(gridPower * uScale);
  float nextGrid = getGrid(nextGridPower * uScale);

  // Where we are between the introduction of the current grid power and when we switch to the next grid power
  float stepPercentage = (cameraDistanceToGridPlane - subGridPower)/(gridPower - subGridPower);

  // The last x percentage of the current step over which we want to fade
  float fadeRange = 0.3;

  // We calculate the fade percentage from the step percentage and the fade range
  float fadePercentage = max(stepPercentage - 1.0 + fadeRange, 0.0) / fadeRange;

  // Set base opacity based on how close we are to the drawing distance, with a cubic falloff
  float baseOpacity = subgrid * pow(1.0 - min(cameraDistanceToFragmentOnGridPlane / uDistance, 1.0), 3.0);

  // Shade the subgrid
  fragColor = vec4(uColor.rgb, (baseOpacity - fadePercentage) * uSubgridOpacity);

  // Somewhat arbitrary additional fade coefficient to counter anti-aliasing popping when switching between grid powers
  float fadeCoefficient = 0.5;

  // Shade the grid
  fragColor.a = mix(fragColor.a, baseOpacity * uGridOpacity - fadePercentage * (uGridOpacity - uSubgridOpacity) * fadeCoefficient, grid);

  // Shade the next grid
  fragColor.a = mix(fragColor.a, baseOpacity * uGridOpacity, nextGrid);

  if (fragColor.a <= 0.0) discard;
}`;class mdt extends D0{constructor(e){super({extensions:{derivatives:!0},uniforms:{uScale:{value:(e==null?void 0:e.scale)!==void 0?e==null?void 0:e.scale:.1},uDivisions:{value:(e==null?void 0:e.divisions)!==void 0?e==null?void 0:e.divisions:10},uColor:{value:(e==null?void 0:e.color)!==void 0?e==null?void 0:e.color:new yn(16777215)},uDistance:{value:(e==null?void 0:e.distance)!==void 0?e==null?void 0:e.distance:1e4},uSubgridOpacity:{value:(e==null?void 0:e.subgridOpacity)!==void 0?e==null?void 0:e.subgridOpacity:.15},uGridOpacity:{value:(e==null?void 0:e.gridOpacity)!==void 0?e==null?void 0:e.gridOpacity:.25}},glslVersion:Nee,side:Co,transparent:!0,name:"InfiniteGrid",vertexShader:fdt,fragmentShader:pdt})}}class gdt extends dn{constructor(t){const n=new mdt(t);super(new _x,n);qe(this,"gridMaterial");this.gridMaterial=n,this.frustumCulled=!1,this.name="InfiniteGridHelper"}update(){this.gridMaterial.needsUpdate=!0}}function iU(i){const[e,t]=_n.useState(i.open!==void 0?i.open:!0),n=!e||i.children===void 0,r=()=>{i.app.dispatchEvent({type:ar.REMOVE_SCENE,value:i.scene})};return We.jsxs("div",{className:`accordion ${n?"hide":""}`,children:[We.jsxs("button",{className:"toggle",onClick:()=>{const s=!e;i.onToggle!==void 0&&i.onToggle(s),t(s)},children:[We.jsx("p",{className:`status ${e?"open":""}`,children:"Toggle"}),We.jsx("p",{className:"label",children:BL(i.label)})]}),i.onRefresh?We.jsxs(We.Fragment,{children:[We.jsx("button",{className:"refresh",onClick:i.onRefresh}),We.jsx("button",{className:"remove",onClick:r})]}):null,i.button,We.jsx("div",{className:e?"open":"",children:We.jsx("div",{children:i.children})},Math.random())]})}function dE(i){const[e,t]=_n.useState(i.defaultValue);return _n.useEffect(()=>{var x,T;let n=!1,r=-1,s=0,o=i.defaultValue,a=!1;const c=P=>{a=P.ctrlKey},u=P=>{var R;n=!0,s=Number((R=i.input.current)==null?void 0:R.value),r=P.clientX,document.addEventListener("mouseup",m,!1),document.addEventListener("mousemove",f,!1),document.addEventListener("contextmenu",m,!1)},f=P=>{if(!n)return;const R=i.step!==void 0?i.step:1,M=(P.clientX-r)*R*(a?10:1);o=Number((s+M).toFixed(4)),i.min!==void 0&&(o=Math.max(o,i.min)),i.max!==void 0&&(o=Math.min(o,i.max)),i.onChange!==void 0&&i.onChange(o),t(o)},m=()=>{n=!1,document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",f),document.removeEventListener("contextmenu",m)},v=P=>{const R=Number(P.target.value);i.onChange!==void 0&&i.onChange(R),t(R)};return(x=i.label.current)==null||x.addEventListener("mousedown",u,!1),i.sliderRef!==void 0&&((T=i.sliderRef.current)==null||T.addEventListener("input",v)),document.addEventListener("keydown",c,!1),document.addEventListener("keyup",c,!1),()=>{var P,R;(P=i.label.current)==null||P.removeEventListener("mousedown",u),i.sliderRef!==void 0&&((R=i.sliderRef.current)==null||R.removeEventListener("input",v)),document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",f),document.removeEventListener("contextmenu",m),document.removeEventListener("keydown",c),document.addEventListener("keyup",c,!1)}},[]),e}function s4(i){const e=_n.useRef(null),t=_n.useRef(null),[n,r]=_n.useState(i.value);return dE({label:i.labelRef,input:e,sliderRef:t,defaultValue:n,min:i.min,max:i.max,step:i.step,onChange:s=>{r(s),i.onChange!==void 0&&i.onChange(i.prop,s)}}),We.jsxs(We.Fragment,{children:[i.type==="number"&&We.jsx("input",{alt:i.alt,className:i.className,ref:e,type:"number",value:n,min:i.min,max:i.max,step:i.step,disabled:i.disabled,onChange:s=>{if(r(s.target.value),s.target.value.length===0)return;const o=Number(s.target.value);isNaN(o)||i.onChange!==void 0&&i.onChange(i.prop,o)}}),i.type==="range"&&We.jsxs(We.Fragment,{children:[We.jsx("input",{type:"text",value:n.toString(),disabled:i.disabled,ref:e,className:"min",onChange:s=>{if(s.target.value.length===0)return;const o=Number(s.target.value);isNaN(o)||i.onChange!==void 0&&i.onChange(i.prop,o)}}),We.jsx("input",{disabled:i.disabled,type:"range",value:n,min:i.min,max:i.max,step:i.step,ref:t,onChange:VAe})]})]})}function ydt(i){const e=_n.useRef(null),t=_n.useRef(null),n=_n.useRef(null),r=_n.useRef(null),s=_n.useRef(null),o=_n.useRef(null),a=_n.useRef(null),c=_n.useRef(null),u=_n.useRef(null),f=_n.useRef(null),[m,v]=_n.useState(i.value.x),[x,T]=_n.useState(i.value.y),[P,R]=_n.useState({min:Math.min(i.min,Math.min(i.value.x,i.value.y)),max:Math.max(i.max,Math.max(i.value.x,i.value.y))}),[M,O]=_n.useState(!1);dE({label:a,input:e,defaultValue:m,min:P.min,max:P.max,step:.01,onChange:K=>{v(K),i.onChange({target:{value:{x:K,y:x}}})}}),dE({label:c,input:t,defaultValue:x,min:P.min,max:P.max,step:.01,onChange:K=>{T(K),i.onChange({target:{value:{x:m,y:K}}})}}),dE({label:u,input:n,defaultValue:P.min,min:P.min-1,max:P.max+1,step:.01,onChange:K=>{R({min:K,max:P.max})}}),dE({label:f,input:r,defaultValue:P.max,min:P.min-1,max:P.max+1,step:.01,onChange:K=>{R({min:P.min,max:K})}});function C(){M||(window.addEventListener("mousemove",Y),window.addEventListener("mouseup",L),O(!0))}function L(){window.removeEventListener("mousemove",Y),window.removeEventListener("mouseup",L),O(!1)}function Y(K){const $=s.current.getBoundingClientRect(),he=Ty(0,99,K.clientX-$.left)/99,Ce=1-Ty(0,99,K.clientY-$.top)/99,Pe=hd(Hee(P.min,P.max,he),3),je=hd(Hee(P.min,P.max,Ce),3);i.onChange({target:{value:{x:Pe,y:je}}}),v(Pe),T(je)}function J(){const K=Number(n.current.value);R({min:K,max:P.max}),m<K&&v(Ty(K,P.max,m)),x<K&&T(Ty(K,P.max,x))}function z(){const K=Number(r.current.value);R({min:P.min,max:K}),m>K&&v(Ty(P.min,K,m)),x>K&&T(Ty(P.min,K,x))}_n.useEffect(()=>{o.current.style.left=`${sbe(P.min,P.max,m)*100}%`,o.current.style.top=`${(1-sbe(P.min,P.max,x))*100}%`},[P,m,x]);const ne=i.step!==void 0?i.step:.01;return We.jsxs("div",{className:"vector2",children:[We.jsxs("div",{className:"fields",children:[We.jsxs("div",{children:[We.jsx("label",{ref:a,children:"X"}),We.jsx("input",{ref:e,type:"number",value:m,min:P.min,max:P.max,step:ne,onChange:K=>{if(v(K.target.value),K.target.value.length===0)return;const $=Number(K.target.value);isNaN($)||(i.onChange({target:{value:{x:$,y:x}}}),$<P.min&&R({min:$,max:P.max}))}})]}),We.jsxs("div",{children:[We.jsx("label",{ref:c,children:"Y"}),We.jsx("input",{ref:t,type:"number",value:x,min:P.min,max:P.max,step:ne,onChange:K=>{if(T(K.target.value),K.target.value.length===0)return;const $=Number(K.target.value);isNaN($)||(i.onChange({target:{value:{x:m,y:$}}}),$>P.max&&R({min:P.min,max:$}))}})]}),We.jsxs("div",{children:[We.jsx("label",{ref:u,children:"Min"}),We.jsx("input",{ref:n,type:"number",value:P.min,step:ne,onChange:J})]}),We.jsxs("div",{children:[We.jsx("label",{ref:f,children:"Max"}),We.jsx("input",{ref:r,type:"number",value:P.max,step:ne,onChange:z})]})]}),We.jsxs("div",{className:"input",ref:s,onMouseDown:C,onMouseUp:L,children:[We.jsx("div",{className:"x"}),We.jsx("div",{className:"y"}),We.jsx("div",{className:"pt",ref:o})]})]})}function Twe(i){const e=i.value.x!==void 0&&i.value.y!==void 0&&i.value.z!==void 0,t=i.value.isEuler!==void 0,n=i.value.elements!==void 0,r=i.step!==void 0?i.step:.01,s=[];if(t){const o=_n.useMemo(()=>i.value,[]);["_x","_y","_z"].forEach(c=>{const u=_n.useRef(null);s.push(We.jsxs("div",{children:[We.jsx("label",{ref:u,children:c.substring(1).toUpperCase()}),We.jsx(s4,{value:$Ae(o[c]),type:"number",prop:c,step:.1,labelRef:u,onChange:(f,m)=>{o[f]=LL(m),i.onChange({target:{value:o}})}})]},c))})}else if(e){const o=_n.useMemo(()=>i.value,[]),a=(u,f)=>{o[u]=f,i.onChange({target:{value:o}})};["x","y","z"].forEach(u=>{const f=_n.useRef(null);s.push(We.jsxs("div",{children:[We.jsx("label",{ref:f,children:u.toUpperCase()}),We.jsx(s4,{value:o[u],type:"number",prop:u,step:r,labelRef:f,onChange:a})]},u))})}else if(n){const o=_n.useMemo(()=>i.value,[]),a=(c,u)=>{const f=Number(c);o.elements[f]=u,i.onChange({target:{value:o}})};for(let c=0;c<9;c++){const u=_n.useRef(null);s.push(We.jsxs("div",{children:[We.jsx("label",{ref:u,children:c+1}),We.jsx(s4,{value:o.elements[c],type:"number",prop:c.toString(),step:r,labelRef:u,onChange:a})]},c.toString()))}}return We.jsx("div",{className:"grid3",children:s},Math.random().toString())}function vdt(i){const e=i.value.x!==void 0,t=i.step!==void 0?i.step:.01,n=[];if(e){const r=_n.useMemo(()=>i.value,[]),s=(a,c)=>{r[a]=c,i.onChange({target:{value:r}})};["x","y","z","w"].forEach(a=>{const c=_n.useRef(null);n.push(We.jsxs("div",{children:[We.jsx("label",{ref:c,children:a.toUpperCase()}),We.jsx(s4,{value:r[a],type:"number",prop:a,step:t,labelRef:c,onChange:s})]},a))})}else{const r=_n.useMemo(()=>i.value,[]),s=(o,a)=>{const c=Number(o);r.elements[c]=a,i.onChange({target:{value:r}})};for(let o=0;o<16;o++){const a=_n.useRef(null);n.push(We.jsxs("div",{children:[We.jsx("label",{ref:a,children:o+1}),We.jsx(s4,{value:r.elements[o],type:"number",prop:o.toString(),step:t,labelRef:a,onChange:s})]},o.toString()))}}return We.jsx("div",{className:"grid4",children:n})}function _dt(i){return!(i==="defaultAttributeValues"||i==="forceSinglePass"||i==="linecap"||i==="linejoin"||i==="linewidth"||i==="normalMapType"||i==="precision"||i==="shadowSide"||i==="uniformsGroups"||i==="uniformsNeedUpdate"||i==="userData"||i==="version"||i==="wireframeLinecap"||i==="wireframeLinejoin"||i==="wireframeLinewidth"||i.slice(0,4)==="clip"||i.slice(0,7)==="polygon"||i.slice(0,7)==="stencil"||i.slice(0,2)==="is")}function xdt(i){switch(i){case"Alpha Map":return"alphaMap";case"Anisotropy Map":return"anisotropyMap";case"AO Map":return"aoMap";case"Bump Map":return"bumpMap";case"Clearcoat Map":return"clearcoatMap";case"Clearcoat Normal Map":return"clearcoatNormalMap";case"Clearcoat Roughness Map":return"clearcoatRoughnessMap";case"Displacement Map":return"displacementMap";case"Emissive Map":return"emissiveMap";case"Gradient Map":return"gradientMap";case"Iridescence Map":return"iridescenceMap";case"Iridescence Thickness Map":return"iridescenceThicknessMap";case"Map":return"map";case"Matcap":return"matcap";case"Normal Map":return"normalMap";case"Roughness Map":return"roughnessMap";case"Sheen Color Map":return"sheenColorMap";case"Sheen Roughness Map":return"sheenRoughnessMap";case"Specular Color Map":return"specularColorMap";case"Specular Map Intensity":return"specularIntensityMap";case"Thickness Map":return"thicknessMap";case"Transmission Map":return"transmissionMap"}return i}function fz(i){switch(i){case"alphaHash":return"Alpha Hash";case"alphaMap":return"Alpha Map";case"alphaToCoverage":return"Alpha To Coverage";case"anisotropy":return"Anisotropy";case"anisotropyMap":return"Anisotropy Map";case"anisotropyRotation":return"Anisotropy Rotation";case"aoMap":return"AO Map";case"aoMapIntensity":return"AO Map Intensity";case"attenuationColor":return"Attenuation Color";case"attenuationDistance":return"Attenuation Distance";case"blendAlpha":return"Blend Alpha";case"blendColor":return"Blend Color";case"blendDst":return"Blend Dst";case"blendDstAlpha":return"Blend Dst Alha";case"blendEquation":return"Blend Equation";case"blendEquationAlpha":return"Blend Equation Alpha";case"blending":return"Blending";case"blendSrc":return"Blend Src";case"blendSrcAlpha":return"Blend Src Alpha";case"bumpMap":return"Bump Map";case"bumpScale":return"Bump Scale";case"clearcoat":return"Clearcoat";case"clearcoatMap":return"Clearcoat Map";case"clearcoatNormalMap":return"Clearcoat Normal Map";case"clearcoatNormalScale":return"Clearcoat Normal Scale";case"clearcoatRoughness":return"Clearcoat Roughness";case"clearcoatRoughnessMap":return"Clearcoat Roughness Map";case"color":return"Color";case"colorWrite":return"Color Write";case"defines":return"Defines";case"depthFunc":return"Depth Func";case"depthTest":return"Depth Test";case"depthWrite":return"Depth Write";case"dispersion":return"Dispersion";case"displacementBias":return"Displacement Bias";case"displacementMap":return"Displacement Map";case"displacementScale":return"Displacement Scale";case"dithering":return"Dithering";case"emissive":return"Emissive";case"emissiveMap":return"Emissive Map";case"emissiveIntensity":return"Emissive Intensity";case"envMap":return"Environment Map";case"envMapIntensity":return"Environment Map Intensity";case"envMapRotation":return"Environment Map Rotation";case"extensions":return"Extensions";case"flatShading":return"Flat Shading";case"fragmentShader":return"Fragment Shader";case"fog":return"Fog";case"glslVersion":return"GLSL Version";case"gradientMap":return"Gradient Map";case"ior":return"IOR";case"iridescence":return"Iridescence";case"iridescenceIOR":return"Iridescence IOR";case"iridescenceMap":return"Iridescence Map";case"iridescenceThicknessMap":return"Iridescence Thickness Map";case"iridescenceThicknessRange":return"Iridescence Thickness Range";case"lights":return"Lights";case"lightMap":return"Light Map";case"lightMapIntensity":return"Light Map Intensity";case"map":return"Map";case"matcap":return"Matcap";case"metalness":return"Metalness";case"metalnessMap":return"Metalness Map";case"name":return"Name";case"normalMap":return"Normal Map";case"normalScale":return"Normal Scale";case"premultipliedAlpha":return"Premultiplied Alpha";case"opacity":return"Opacity";case"reflectivity":return"Reflectivity";case"refractionRatio":return"Refraction Ratio";case"roughness":return"Roughness";case"roughnessMap":return"Roughness Map";case"sheen":return"Sheen";case"sheenColor":return"Sheen Color";case"sheenColorMap":return"Sheen Color Map";case"sheenRoughness":return"Sheen Roughness";case"sheenRoughnessMap":return"Sheen Roughness Map";case"shininess":return"Shininess";case"side":return"Side";case"size":return"Size";case"sizeAttenuation":return"Size Attenuation";case"specular":return"Specular";case"specularColor":return"Specular Color";case"specularColorMap":return"Specular Color Map";case"specularIntensity":return"Specular Intensity";case"specularIntensityMap":return"Specular Map Intensity";case"thickness":return"Thickness";case"thicknessMap":return"Thickness Map";case"toneMapped":return"Tone Mapped";case"transmission":return"Transmission";case"transmissionMap":return"Transmission Map";case"transparent":return"Transparent";case"type":return"Type";case"uuid":return"UUID";case"uniforms":return"Uniforms";case"vertexColors":return"Vertex Colors";case"vertexShader":return"Vertex Shader";case"visible":return"Visible";case"wireframe":return"Wireframe"}return i}function bNe(i){const e=i.toLowerCase();return e.search("intensity")>-1||e==="anisotropyrotation"||e==="blendalpha"||e==="bumpscale"||e==="clearcoatroughness"||e==="displacementbias"||e==="displacementscale"||e==="metalness"||e==="opacity"||e==="reflectivity"||e==="refractionratio"||e==="roughness"||e==="sheenroughness"}function bdt(){const i=document.createElement("input");return i.type="file",new Promise((e,t)=>{i.addEventListener("change",function(){if(i.files===null)t();else{const n=i.files[0],r=new FileReader;r.onload=function(s){e(s.target.result)},r.readAsDataURL(n)}}),i.click()})}const Sdt=[{title:"Front",value:Xl},{title:"Back",value:Ui},{title:"Double",value:Co}],wdt=[{title:"No Blending",value:vl},{title:"Normal",value:fc},{title:"Additive",value:f4},{title:"Subtractive",value:p4},{title:"Multiply",value:m4},{title:"Custom",value:Jy}],Tdt=[{title:"Add",value:gl},{title:"Subtract",value:FU},{title:"Reverse Subtract",value:OU},{title:"Min",value:Lne},{title:"Max",value:Une}],Edt=[{title:"Zero",value:ud},{title:"One",value:KM},{title:"Src Color",value:ZM},{title:"One Minus Src Color",value:QM},{title:"Src Alpha",value:g4},{title:"One Minus Src Alpha",value:y4},{title:"Dst Alpha",value:JM},{title:"One Minus Dst Alpha",value:eC},{title:"Dst Color",value:tC},{title:"One Minus Dst Color",value:nC},{title:"Src Alpha Saturate",value:BU},{title:"Constant Color",value:zne},{title:"One Minus Constant Color",value:Vne},{title:"Constant Alpha",value:Gne},{title:"One Minus Constant Alpha",value:$ne}],Mdt=[{title:"Zero",value:ud},{title:"One",value:KM},{title:"Src Color",value:ZM},{title:"One Minus Src Color",value:QM},{title:"Src Alpha",value:g4},{title:"One Minus Src Alpha",value:y4},{title:"Dst Alpha",value:JM},{title:"One Minus Dst Alpha",value:eC},{title:"Dst Color",value:tC},{title:"One Minus Dst Color",value:nC},{title:"Constant Color",value:zne},{title:"One Minus Constant Color",value:Vne},{title:"Constant Alpha",value:Gne},{title:"One Minus Constant Alpha",value:$ne}];function DT(i,e){i.needsUpdate=!0,i.type="option",i.options=e}function Cdt(i,e,t,n){return{type:"boolean",title:fz(i),prop:i,value:e,needsUpdate:!0,onChange:(r,s)=>{n.updateObject(t.uuid,`material.${i}`,s),n.updateObject(t.uuid,"material.needsUpdate",!0);const o=n.getScene(t.uuid);if(o!==null){const a=o.getObjectByProperty("uuid",t.uuid);Lo(a,`material.${i}`,s)}}}}function Adt(i,e,t,n){const r={type:"number",title:fz(i),prop:i,value:e,min:void 0,max:void 0,step:.01,needsUpdate:!0,onChange:(s,o)=>{n.updateObject(t.uuid,`material.${i}`,o),n.updateObject(t.uuid,"material.needsUpdate",!0);const a=n.getScene(t.uuid);if(a!==null){const c=a.getObjectByProperty("uuid",t.uuid);Lo(c,`material.${i}`,o)}}};switch(i){case"blending":DT(r,wdt);break;case"blendDst":DT(r,Mdt);break;case"blendEquation":DT(r,Tdt);break;case"blendSrc":DT(r,Edt);break;case"side":DT(r,Sdt);break}return bNe(i)&&(r.value=Number(e),r.type="range",r.min=Math.min(0,r.value),r.max=Math.max(1,r.value),r.step=.01),r}function Rdt(i,e,t,n){const r={type:"string",title:fz(i),prop:i,value:e,needsUpdate:!0,onChange:(o,a)=>{n.updateObject(t.uuid,`material.${i}`,a),n.updateObject(t.uuid,"material.needsUpdate",!0);const c=n.getScene(t.uuid);if(c!==null){const u=c.getObjectByProperty("uuid",t.uuid);Lo(u,`material.${i}`,a)}},onKeyDown:o=>{}};return(i==="vertexShader"||i==="fragmentShader")&&(r.disabled=!1,r.latest=r.value,r.onChange=(o,a)=>{r.latest=a,n.updateObject(t.uuid,`material.${i}`,a);const c=n.getScene(t.uuid);if(c!==null){const u=c.getObjectByProperty("uuid",t.uuid);Lo(u,`material.${i}`,a)}},r.onKeyDown=o=>{if(o.key==="Enter"&&(o.altKey||o.metaKey)){n.updateObject(t.uuid,"material.needsUpdate",!0);const a=n.getScene(t.uuid);if(a!==null){const c=a.getObjectByProperty("uuid",t.uuid);Lo(c,"material.needsUpdate",!0)}}}),r}function Pdt(i){return i.x!==void 0&&i.y!==void 0&&i.z===void 0}function Ndt(i){return i.x!==void 0&&i.y!==void 0&&i.z!==void 0&&i.w===void 0}function Idt(i){return i.x!==void 0&&i.y!==void 0&&i.z!==void 0&&i.w!==void 0}function Ete(i){i.sort((e,t)=>e.title<t.title?-1:e.title>t.title?1:0)}function fE(i,e,t,n,r="",s=!1){const o=fz(i).split(".")[0].replaceAll("[","").replaceAll("]",""),a=r.length>0?`${r}.${i}`:i,c=typeof e;if(c==="boolean"||c==="string")return{title:o,prop:a,type:c,value:e,disabled:s,onChange:(u,f)=>{n.updateObject(t.uuid,`material.${a}`,f);const m=n.getScene(t.uuid);if(m!==null){const v=m.getObjectByProperty("uuid",t.uuid);Lo(v,`material.${a}`,f)}}};if(c==="number"){const u={title:o,prop:a,type:"number",value:e,step:.01,disabled:s,onChange:(f,m)=>{n.updateObject(t.uuid,`material.${a}`,m);const v=n.getScene(t.uuid);if(v!==null){const x=v.getObjectByProperty("uuid",t.uuid);Lo(x,`material.${a}`,m)}}};return bNe(o)&&(u.type="range",u.min=0,u.max=1),u}else{if(e.isColor)return{title:o,prop:a,type:"color",value:e,disabled:s,onChange:(u,f)=>{const m=new yn(f);n.updateObject(t.uuid,`material.${a}`,m);const v=n.getScene(t.uuid);if(v!==null){const x=v.getObjectByProperty("uuid",t.uuid);Lo(x,`material.${a}`,m)}}};if(Array.isArray(e)){const u=[];for(const f in e){const m=e[f],v=`[${f.toString()}]`;if(m.value!==void 0){const x=fE(`${v}.value`,m.value,t,n,a,s);x!==void 0&&u.push(x)}else{const x=fE(v,m,t,n,a,s);x!==void 0&&u.push(x)}}if(u.length>0)return Ete(u),{title:o,items:u}}else{if(Pdt(e))return{title:o,prop:a,type:"vector2",value:e,disabled:s,onChange:(u,f)=>{n.updateObject(t.uuid,`material.${a}`,f);const m=n.getScene(t.uuid);if(m!==null){const v=m.getObjectByProperty("uuid",t.uuid);Lo(v,`material.${a}`,f)}}};if(Ndt(e))return{title:o,prop:a,type:"grid3",value:e,disabled:s,onChange:(u,f)=>{n.updateObject(t.uuid,`material.${a}`,f);const m=n.getScene(t.uuid);if(m!==null){const v=m.getObjectByProperty("uuid",t.uuid);Lo(v,`material.${a}`,f)}}};if(Idt(e))return{title:o,prop:a,type:"grid4",value:e,disabled:s,onChange:(u,f)=>{n.updateObject(t.uuid,`material.${a}`,f);const m=n.getScene(t.uuid);if(m!==null){const v=m.getObjectByProperty("uuid",t.uuid);Lo(v,`material.${a}`,f)}}};if(e.isEuler)return{title:o,prop:a,type:"euler",value:e,disabled:s,onChange:(u,f)=>{n.updateObject(t.uuid,`material.${a}`,f);const m=n.getScene(t.uuid);if(m!==null){const v=m.getObjectByProperty("uuid",t.uuid);Lo(v,`material.${a}`,f)}}};if(e.src!==void 0)return{title:o,type:"image",value:e,disabled:s,onChange:(u,f)=>{const m=xdt(i),v=r.length>0?`${r}.${m}`:m;n.createTexture(t.uuid,`material.${v}`,f);const x=n.getScene(t.uuid);if(x!==null){const T=x.getObjectByProperty("uuid",t.uuid);if(T!==void 0){const P=R=>{const M=T.material,O=v.split(".");switch(O.length){case 1:M[O[0]]=R;break;case 2:M[O[0]][O[1]]=R;break;case 3:M[O[0]][O[1]][O[2]]=R;break;case 4:M[O[0]][O[1]][O[2]][O[3]]=R;break;case 5:M[O[0]][O[1]][O[2]][O[3]][O[4]]=R;break}M.needsUpdate=!0};f.src.length>0?Mre(f.src).then(R=>{R.offset.set(f.offset[0],f.offset[1]),R.repeat.set(f.repeat[0],f.repeat[1]),P(R)}):P(null)}}}};if(e.elements!==void 0)return{title:o,prop:a,type:e.elements.length>9?"grid4":"grid3",value:e,disabled:s,onChange:(u,f)=>{n.updateObject(t.uuid,`material.${a}`,f);const m=n.getScene(t.uuid);if(m!==null){const v=m.getObjectByProperty("uuid",t.uuid);Lo(v,`material.${a}`,f)}}};{const u=[],f=i==="defines"||i==="extensions";try{for(const m in e){const v=e[m];if(v!==void 0)if(v.value!==void 0){const x=fE(`${m}.value`,v.value,t,n,a,f);x!==void 0&&u.push(x)}else{const x=fE(m,v,t,n,a,f);x!==void 0&&u.push(x)}}}catch{console.log("Issue cycling through material object:",i,e)}if(u.length>0)return Ete(u),{title:o,items:u}}}}}function Ewe(i,e,t){const n=[];for(const r in i){if(!_dt(r))continue;const s=typeof i[r],o=i[r];if(s==="boolean")n.push(Cdt(r,o,e,t));else if(s==="number")n.push(Adt(r,o,e,t));else if(s==="string")n.push(Rdt(r,o,e,t));else if(s==="object"){const a=fE(r,o,e,t);a!==void 0&&n.push(a)}else o!==void 0&&console.log("other:",r,s,o)}return Ete(n),n.push({title:"Update Material",type:"button",onChange:()=>{t.updateObject(e.uuid,"material.needsUpdate",!0);const r=t.getScene(e.uuid);if(r!==null){const s=r.getObjectByProperty("uuid",e.uuid);Lo(s,"material.needsUpdate",!0)}}}),n}function kdt(i,e,t){function n(){return`${t.app.appID}_material`}const r=localStorage.getItem(n()),s=r!==null?r==="open":!1;function o(c){localStorage.setItem(n(),c?"open":"closed")}const a=i.material;if(Array.isArray(a)){const c=[],u=a.length;for(let f=0;f<u;f++)c.push(We.jsx(sh,{app:e,title:`Material ${f}`,items:Ewe(a[f],i,t)},`Material ${f}`));return We.jsx(We.Fragment,{children:c})}else return We.jsx(sh,{app:e,title:"Material",items:Ewe(a,i,t),expanded:s,onToggle:c=>{o(c)}})}const Mwe="data:image/gif;base64,R0lGODlhDgFkAIAAAP///wAAACH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDIgNzkuZGJhM2RhM2I1LCAyMDIzLzEyLzE1LTEwOjQyOjM3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjUuNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyMDk3M0NEODAxQjQxMUVGODVGNENDMkUyMUExNDk1NSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoyMDk3M0NEOTAxQjQxMUVGODVGNENDMkUyMUExNDk1NSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkE4ODc3Qzg5MDFCMzExRUY4NUY0Q0MyRTIxQTE0OTU1IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkE4ODc3QzhBMDFCMzExRUY4NUY0Q0MyRTIxQTE0OTU1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEAAAAAAAsAAAAAA4BZAAAAv+Mj6nL7Q+jnLTai7PevPsPhuJIluaJpurKtu4Lx/JM1/aN5/rO9/4PDAqHxKLxiEwql8ym8wmNSqfUqvWKzWq33K73Cw6Lx+Sy+YxOq9fstvsNj8vn9Lr9js/r9/y+/w8YKDhIWGh4iJiouMjY6PgIGSk5SVlpeYmZqTkJAGDQ+dnpuekmGgAKejpKuiZqmprKqoZKGyrbOlqrejub6xvLGyw8TFzcprurGuvqybxq7ETbrItsCz0l7Zpc+6p9/cS967w9/S2FTF0u/mzehK4Oqz3eTl9vf4+fr7/P3+//DzCgwIEECxo8iDChwoUMGzp8CDGixIkUK1q8iDGjxo0XHDt6/AgypMiRJEuaPIkypcqVLFt+KwAAOw==";function Ddt(i){const e=i.step!==void 0?i.step:.01,t=_n.useRef(null),n=_n.useRef(null),r=_n.useRef(null),s=_n.useRef(null),o=_n.useRef(null),[a]=_n.useState(i.value),[c,u]=_n.useState(i.value.offset[0]),[f,m]=_n.useState(i.value.offset[1]),[v,x]=_n.useState(i.value.repeat[0]),[T,P]=_n.useState(i.value.repeat[1]);function R(O,C,L,Y,J){if(i.onChange!==void 0){const z=i.prop!==void 0?i.prop:i.title;i.onChange(z,{src:O,offset:[C,L],repeat:[Y,J]})}}function M(O){const C=t.current.src,L=O.target.value;switch(O.target){case n.current:u(L),R(C,L,f,v,T);break;case r.current:m(L),R(C,c,L,v,T);break;case s.current:x(L),R(C,c,f,L,T);break;case o.current:P(L),R(C,c,f,v,L);break}}return We.jsxs("div",{className:"imageField",children:[We.jsx("img",{alt:i.title,ref:t,onClick:()=>{bdt().then(O=>{t.current.src=O,R(O,c,f,v,T)})},src:a.src.length>0?a.src:Mwe}),We.jsxs("div",{className:"fields",children:[We.jsxs("div",{children:[We.jsx("label",{children:"Offset:"}),We.jsx("input",{ref:n,type:"number",value:c,step:e,onChange:M}),We.jsx("input",{ref:r,type:"number",value:f,step:e,onChange:M})]}),We.jsxs("div",{children:[We.jsx("label",{children:"Repeat:"}),We.jsx("input",{ref:s,type:"number",value:v,step:e,onChange:M}),We.jsx("input",{ref:o,type:"number",value:T,step:e,onChange:M})]}),We.jsx("button",{onClick:()=>{R("",c,f,v,T),t.current.src=Mwe},children:"Clear"})]})]})}function ZB(i){var u;let e=i.value;e!==void 0&&(e.isColor!==void 0?e=nbe(i.value):i.type==="color"&&(e=nbe(new yn().setStyle(i.value,_l))));const[t,n]=_n.useState(e),r=_n.useRef(null),s=f=>{let m=f.target.value;if(i.type==="boolean")m=f.target.checked;else if(i.type==="option"&&(typeof i.value=="number"?m=Number(m):typeof i.value=="boolean"?m=!!m:typeof i.value=="object"&&(m=JSON.parse(m)),i.options!==void 0)){const v=i.options.length;for(let x=0;x<v&&i.options[x].value!==m;x++);}n(m),i.onChange!==void 0&&i.onChange(i.prop!==void 0?i.prop:i.title,m)},o={};i.disabled&&(o.opacity=.8);const a=i.type==="string"&&(t.length>100||t.search(`
`)>-1),c=a||i.type==="image"||i.type==="vector2";return We.jsxs("div",{className:`field ${c?"block":""}`,style:o,children:[i.type!=="button"&&We.jsx("label",{ref:r,children:BL(i.title)},"fieldLabel"),i.type==="string"&&!a&&We.jsx("input",{type:"text",disabled:i.disabled,onChange:s,value:t}),i.type==="string"&&a&&We.jsx("textarea",{cols:50,rows:10,disabled:i.disabled!==void 0?i.disabled:!0,onChange:s,onKeyDown:f=>{i.onKeyDown!==void 0&&i.onKeyDown(f)},value:t}),i.type==="boolean"&&We.jsx("input",{type:"checkbox",disabled:i.disabled,onChange:s,checked:t}),i.type==="number"&&We.jsx(s4,{value:t,type:i.type,prop:i.prop!==void 0?i.prop:i.title,min:i.min,max:i.max,step:i.step,disabled:i.disabled,labelRef:r,onChange:i.onChange}),i.type==="range"&&We.jsx(s4,{value:t,type:i.type,prop:i.prop!==void 0?i.prop:i.title,min:i.min,max:i.max,step:i.step,disabled:i.disabled,labelRef:r,onChange:i.onChange}),i.type==="color"&&We.jsxs(We.Fragment,{children:[We.jsx("input",{type:"text",value:t.toString(),onChange:s,disabled:i.disabled,className:"color"}),We.jsx("input",{type:"color",value:t,onChange:s,disabled:i.disabled})]}),i.type==="button"&&We.jsx("button",{disabled:i.disabled,onClick:()=>{i.onChange!==void 0&&i.onChange(i.prop!==void 0?i.prop:i.title,!0)},children:i.title}),i.type==="image"&&We.jsx(Ddt,{title:i.title,prop:i.prop,value:i.value,onChange:i.onChange}),i.type==="option"&&We.jsx(We.Fragment,{children:We.jsx("select",{onChange:s,disabled:i.disabled,defaultValue:i.value,children:(u=i.options)==null?void 0:u.map((f,m)=>We.jsx("option",{value:f.value,children:BL(f.title)},m))})}),i.type==="vector2"&&We.jsx(ydt,{step:i.step,value:t,min:0,max:1,onChange:s}),i.type==="grid3"&&We.jsx(Twe,{step:i.step,value:t,onChange:s}),i.type==="grid4"&&We.jsx(vdt,{step:i.step,value:t,onChange:s}),i.type==="euler"&&We.jsx(Twe,{step:i.step,value:t,onChange:s})]})}function Fdt(i){return"items"in i}class sh extends _n.Component{constructor(t){super(t);qe(this,"subgroupNames",[]);qe(this,"subgroupElements",[]);qe(this,"valueOverrides",new Map);qe(this,"app");this.app=t.app,this.state={lastUpdated:Date.now()}}addGroup(t){const n=[];t.items.forEach(o=>{n.push({type:o.type,prop:o.prop,title:o.title!==void 0?o.title:o.prop,value:o.value,min:o.min,max:o.max,step:o.step,options:o.options,disabled:o.disabled,onChange:(a,c)=>{t.onUpdate(a,c)}})});const r=_n.createRef(),s=We.jsx(sh,{app:this.app,ref:r,title:t.title,items:n},Math.random());return this.subgroupNames.push(t.title),this.subgroupElements.push(s),this.setState({lastUpdated:Date.now()}),r}removeGroup(t){const n=this.subgroupNames.length;for(let r=0;r<n;r++){const s=this.subgroupNames[r];if(t===s){this.subgroupNames.splice(r,1),this.subgroupElements.splice(r,1),this.setState({lastUpdated:Date.now()});return}}}setField(t,n){this.valueOverrides.set(t,n),this.setState({lastUpdated:Date.now()})}render(){const t=[];return this.props.items.forEach(n=>{if(Fdt(n))t.push(We.jsx(sh,{app:this.app,title:BL(n.title),items:n.items},Math.random()));else{const r=this.valueOverrides.get(n.title),s=r!==void 0?r:n.value;t.push(We.jsx(ZB,{title:n.title,prop:n.prop,value:s,type:n.type,min:n.min,max:n.max,step:n.step,disabled:n.disabled,options:n.options,onChange:(o,a)=>{n.onChange!==void 0&&(this.valueOverrides.delete(n.title),n.onChange(o,a))},onKeyDown:o=>{n.onKeyDown!==void 0&&n.onKeyDown(o)}},Math.random()))}}),this.subgroupElements.forEach(n=>t.push(n)),We.jsx(iU,{app:this.app,label:this.props.title,open:this.props.expanded===!0,onToggle:n=>{var r;this.props.onToggle&&((r=this.props)==null||r.onToggle(n))},children:t})}}const Ji=class Ji extends _n.Component{constructor(t){super(t);qe(this,"addGroup",t=>{const n=JSON.parse(t.value),r=[];n.items.forEach(s=>{r.push({type:s.type,prop:s.prop,title:s.title!==void 0?s.title:s.prop,value:s.value,min:s.min,max:s.max,step:s.step,options:s.options,disabled:s.disabled,onChange:(o,a)=>{this.props.three.updateGroup(n.title,o,a)}})}),Ji.groups.push(We.jsx(sh,{app:Ji.app,title:n.title,items:r},Math.random())),Ji.groupTitles.push(n.title),this.setState({lastUpdate:Date.now()})});qe(this,"removeGroup",t=>{const n=t.value,r=Ji.groupTitles.length;for(let s=0;s<r;s++)if(n===Ji.groupTitles[s]){Ji.groups.splice(s,1),Ji.groupTitles.splice(s,1),this.setState({lastUpdate:Date.now()});return}});this.state={lastUpdate:Date.now()},Ji.app=t.app,Ji.instance=this,Ji.app.addEventListener(ar.ADD_GROUP,this.addGroup),Ji.app.addEventListener(ar.REMOVE_GROUP,this.removeGroup)}componentWillUnmount(){Ji.app.removeEventListener(ar.ADD_GROUP,this.addGroup),Ji.app.removeEventListener(ar.REMOVE_GROUP,this.removeGroup)}render(){return We.jsx("div",{className:"customGroups",children:Ji.groups},this.state.lastUpdate)}static addEditorGroup(t){const n=[];t.items.forEach(o=>{n.push({type:o.type,prop:o.prop,title:o.title!==void 0?o.title:o.prop,value:o.value,min:o.min,max:o.max,step:o.step,options:o.options,disabled:o.disabled,onChange:(a,c)=>{t.onUpdate(a,c)}})});const r=_n.createRef(),s=We.jsx(sh,{app:Ji.app,ref:r,title:t.title,items:n},Math.random());return Ji.groups.push(s),Ji.groupsRefs.push(r),Ji.groupTitles.push(t.title),r}static removeEditorGroup(t){const n=Ji.groupTitles.length;for(let r=0;r<n;r++)if(t===Ji.groupTitles[r]){Ji.groups.splice(r,1),Ji.groupTitles.splice(r,1),Ji.instance.setState({lastUpdate:Date.now()});return}}};qe(Ji,"instance"),qe(Ji,"groups",[]),qe(Ji,"groupsRefs",[]),qe(Ji,"groupTitles",[]),qe(Ji,"app");let rx=Ji;const yU=class yU extends _n.Component{constructor(t){super(t);qe(this,"app");qe(this,"matrix",new Vn);qe(this,"position",new be);qe(this,"rotation",new Mo);qe(this,"scale",new be);qe(this,"open",!1);qe(this,"updateTransform",(t,n)=>{const r=t==="rotation"?{x:n._x,y:n._y,z:n._z}:n;this.props.three.updateObject(this.props.object.uuid,t,r);const s=this.props.three.getScene(this.props.object.uuid);if(s){const o=s.getObjectByProperty("uuid",this.props.object.uuid);Lo(o,t,r)}});this.app=t.app;const n=localStorage.getItem(this.expandedName),r=n!==null?n==="open":!1;this.open=r,this.saveExpanded(),this.state={lastUpdated:0,expanded:r},this.matrix.elements=t.object.matrix,t.object.uuid.length>0&&(this.position.setFromMatrixPosition(this.matrix),this.rotation.setFromRotationMatrix(this.matrix),this.scale.setFromMatrixScale(this.matrix)),yU.instance=this}update(){if(Gl.instance){const t=Gl.instance.selectedItem;if(t===void 0)return;this.position.x=hd(t.position.x,3),this.position.y=hd(t.position.y,3),this.position.z=hd(t.position.z,3),this.rotation.copy(t.rotation),this.scale.x=hd(t.scale.x,3),this.scale.y=hd(t.scale.y,3),this.scale.z=hd(t.scale.z,3),this.setState({lastUpdated:Date.now()})}}render(){return We.jsx(sh,{app:this.app,title:"Transform",expanded:this.open,items:[{title:"Position",prop:"position",type:"grid3",step:.1,value:this.position,onChange:this.updateTransform},{title:"Rotation",prop:"rotation",type:"euler",value:this.rotation,onChange:this.updateTransform},{title:"Scale",prop:"scale",type:"grid3",value:this.scale,onChange:this.updateTransform},{title:"Visible",prop:"visible",type:"boolean",value:this.props.object.visible,onChange:this.updateTransform}],onToggle:t=>{this.open=t,this.saveExpanded()}},this.state.lastUpdated)}saveExpanded(){localStorage.setItem(this.expandedName,this.open?"open":"closed")}get expandedName(){return`${this.props.three.app.appID}_transform`}};qe(yU,"instance");let sU=yU;function DQ(i){const[e,t]=_n.useState(i.selected),n="toggle"+(e?" selected":"");return We.jsx("button",{className:n,onClick:()=>{const r=!e;t(r),i.onClick(r)},style:{backgroundImage:`url(${i.icon})`,backgroundPositionX:"center",backgroundPositionY:i.top!==void 0?`${i.top}px`:"center",backgroundSize:`${i.width!==void 0?`${i.width}px`:"26px"} ${i.height}px`}},i.name)}const Odt=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>

	#if defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
}`,Bdt=`
#include <common>
#include <uv_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
	#include <clipping_planes_fragment>
	gl_FragColor = vec4(vec3(vUv, 0.0), 1.0);
}`;class Ldt extends D0{constructor(){super({defines:{USE_UV:""},vertexShader:Odt,fragmentShader:Bdt})}}const my=new OL,zl=new be,r2=new be,qs=new qi,Cwe={X:new be(1,0,0),Y:new be(0,1,0),Z:new be(0,0,1)},FQ={type:"change"},Awe={type:"mouseDown",mode:null},Rwe={type:"mouseUp",mode:null},Pwe={type:"objectChange"};class Udt extends DAe{constructor(e,t=null){super(void 0,t);const n=new jdt(this);this._root=n;const r=new Wdt;this._gizmo=r,n.add(r);const s=new qdt;this._plane=s,n.add(s);const o=this;function a(C,L){let Y=L;Object.defineProperty(o,C,{get:function(){return Y!==void 0?Y:L},set:function(J){Y!==J&&(Y=J,s[C]=J,r[C]=J,o.dispatchEvent({type:C+"-changed",value:J}),o.dispatchEvent(FQ))}}),o[C]=L,s[C]=L,r[C]=L}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0),a("minX",-1/0),a("maxX",1/0),a("minY",-1/0),a("maxY",1/0),a("minZ",-1/0),a("maxZ",1/0);const c=new be,u=new be,f=new qi,m=new qi,v=new be,x=new qi,T=new be,P=new be,R=new be,M=0,O=new be;a("worldPosition",c),a("worldPositionStart",u),a("worldQuaternion",f),a("worldQuaternionStart",m),a("cameraPosition",v),a("cameraQuaternion",x),a("pointStart",T),a("pointEnd",P),a("rotationAxis",R),a("rotationAngle",M),a("eye",O),this._offset=new be,this._startNorm=new be,this._endNorm=new be,this._cameraScale=new be,this._parentPosition=new be,this._parentQuaternion=new qi,this._parentQuaternionInv=new qi,this._parentScale=new be,this._worldScaleStart=new be,this._worldQuaternionInv=new qi,this._worldScale=new be,this._positionStart=new be,this._quaternionStart=new qi,this._scaleStart=new be,this._getPointer=zdt.bind(this),this._onPointerDown=Gdt.bind(this),this._onPointerHover=Vdt.bind(this),this._onPointerMove=$dt.bind(this),this._onPointerUp=Hdt.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&my.setFromCamera(e,this.camera);const t=OQ(this._gizmo.picker[this.mode],my);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&my.setFromCamera(e,this.camera);const t=OQ(this._plane,my,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Awe.mode=this.mode,this.dispatchEvent(Awe)}}pointerMove(e){const t=this.axis,n=this.mode,r=this.object;let s=this.space;if(n==="scale"?s="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(s="world"),r===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&my.setFromCamera(e,this.camera);const o=OQ(this._plane,my,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),s==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),s==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),r.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(s==="local"&&(r.position.applyQuaternion(qs.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this._quaternionStart)),s==="world"&&(r.parent&&r.position.add(zl.setFromMatrixPosition(r.parent.matrixWorld)),t.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(zl.setFromMatrixPosition(r.parent.matrixWorld)))),r.position.x=Math.max(this.minX,Math.min(this.maxX,r.position.x)),r.position.y=Math.max(this.minY,Math.min(this.maxY,r.position.y)),r.position.z=Math.max(this.minZ,Math.min(this.maxZ,r.position.z));else if(n==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),r2.set(a,a,a)}else zl.copy(this.pointStart),r2.copy(this.pointEnd),zl.applyQuaternion(this._worldQuaternionInv),r2.applyQuaternion(this._worldQuaternionInv),r2.divide(zl),t.search("X")===-1&&(r2.x=1),t.search("Y")===-1&&(r2.y=1),t.search("Z")===-1&&(r2.z=1);r.scale.copy(this._scaleStart).multiply(r2),this.scaleSnap&&(t.search("X")!==-1&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(zl.setFromMatrixPosition(this.camera.matrixWorld));let c=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(zl.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(Cwe[t]),zl.copy(Cwe[t]),s==="local"&&zl.applyQuaternion(this.worldQuaternion),zl.cross(this.eye),zl.length()===0?c=!0:this.rotationAngle=this._offset.dot(zl.normalize())*a),(t==="E"||c)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),s==="local"&&t!=="E"&&t!=="XYZE"?(r.quaternion.copy(this._quaternionStart),r.quaternion.multiply(qs.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),r.quaternion.copy(qs.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(FQ),this.dispatchEvent(Pwe)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(Rwe.mode=this.mode,this.dispatchEvent(Rwe)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(FQ),this.dispatchEvent(Pwe),this.pointStart.copy(this.pointEnd))}getRaycaster(){return my}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function zdt(i){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:i.button};{const e=this.domElement.getBoundingClientRect();return{x:(i.clientX-e.left)/e.width*2-1,y:-(i.clientY-e.top)/e.height*2+1,button:i.button}}}function Vdt(i){if(this.enabled)switch(i.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(i));break}}function Gdt(i){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(i)),this.pointerDown(this._getPointer(i)))}function $dt(i){this.enabled&&this.pointerMove(this._getPointer(i))}function Hdt(i){this.enabled&&(this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(i)))}function OQ(i,e,t){const n=e.intersectObject(i,!0);for(let r=0;r<n.length;r++)if(n[r].object.visible||t)return n[r];return!1}const rB=new Mo,gs=new be(0,1,0),Nwe=new be(0,0,0),Iwe=new Vn,iB=new qi,QB=new qi,Rf=new be,kwe=new Vn,pE=new be(1,0,0),Py=new be(0,1,0),mE=new be(0,0,1),sB=new be,FT=new be,OT=new be;class jdt extends gi{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const t=this.controls;t.object!==void 0&&(t.object.updateMatrixWorld(),t.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):t.object.parent.matrixWorld.decompose(t._parentPosition,t._parentQuaternion,t._parentScale),t.object.matrixWorld.decompose(t.worldPosition,t.worldQuaternion,t._worldScale),t._parentQuaternionInv.copy(t._parentQuaternion).invert(),t._worldQuaternionInv.copy(t.worldQuaternion).invert()),t.camera.updateMatrixWorld(),t.camera.matrixWorld.decompose(t.cameraPosition,t.cameraQuaternion,t._cameraScale),t.camera.isOrthographicCamera?t.camera.getWorldDirection(t.eye).negate():t.eye.copy(t.cameraPosition).sub(t.worldPosition).normalize(),super.updateMatrixWorld(e)}dispose(){this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}}class Wdt extends gi{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Ea({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new su({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const r=t.clone();r.opacity=.5;const s=e.clone();s.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const c=e.clone();c.color.setHex(16711680),c.opacity=.5;const u=e.clone();u.color.setHex(65280),u.opacity=.5;const f=e.clone();f.color.setHex(255),f.opacity=.5;const m=e.clone();m.opacity=.25;const v=e.clone();v.color.setHex(16776960),v.opacity=.25,e.clone().color.setHex(16776960);const T=e.clone();T.color.setHex(7895160);const P=new x0(0,.04,.1,12);P.translate(0,.05,0);const R=new Oo(.08,.08,.08);R.translate(0,.04,0);const M=new Xi;M.setAttribute("position",new br([0,0,0,1,0,0],3));const O=new x0(.0075,.0075,.5,3);O.translate(0,.25,0);function C(ge,Xe){const Fe=new ky(ge,.0075,3,64,Xe*Math.PI*2);return Fe.rotateY(Math.PI/2),Fe.rotateX(Math.PI/2),Fe}function L(){const ge=new Xi;return ge.setAttribute("position",new br([0,0,0,1,1,1],3)),ge}const Y={X:[[new dn(P,s),[.5,0,0],[0,0,-Math.PI/2]],[new dn(P,s),[-.5,0,0],[0,0,Math.PI/2]],[new dn(O,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new dn(P,o),[0,.5,0]],[new dn(P,o),[0,-.5,0],[Math.PI,0,0]],[new dn(O,o)]],Z:[[new dn(P,a),[0,0,.5],[Math.PI/2,0,0]],[new dn(P,a),[0,0,-.5],[-Math.PI/2,0,0]],[new dn(O,a),null,[Math.PI/2,0,0]]],XYZ:[[new dn(new Xy(.1,0),m.clone()),[0,0,0]]],XY:[[new dn(new Oo(.15,.15,.01),f.clone()),[.15,.15,0]]],YZ:[[new dn(new Oo(.15,.15,.01),c.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new dn(new Oo(.15,.15,.01),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},J={X:[[new dn(new x0(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new dn(new x0(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new dn(new x0(.2,0,.6,4),n),[0,.3,0]],[new dn(new x0(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new dn(new x0(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new dn(new x0(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new dn(new Xy(.2,0),n)]],XY:[[new dn(new Oo(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new dn(new Oo(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new dn(new Oo(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},z={START:[[new dn(new Xy(.01,2),r),null,null,null,"helper"]],END:[[new dn(new Xy(.01,2),r),null,null,null,"helper"]],DELTA:[[new rc(L(),r),null,null,null,"helper"]],X:[[new rc(M,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new rc(M,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new rc(M,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},ne={XYZE:[[new dn(C(.5,1),T),null,[0,Math.PI/2,0]]],X:[[new dn(C(.5,.5),s)]],Y:[[new dn(C(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new dn(C(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new dn(C(.75,1),v),null,[0,Math.PI/2,0]]]},K={AXIS:[[new rc(M,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},$={XYZE:[[new dn(new G2(.25,10,8),n)]],X:[[new dn(new ky(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new dn(new ky(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new dn(new ky(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new dn(new ky(.75,.1,2,24),n)]]},he={X:[[new dn(R,s),[.5,0,0],[0,0,-Math.PI/2]],[new dn(O,s),[0,0,0],[0,0,-Math.PI/2]],[new dn(R,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new dn(R,o),[0,.5,0]],[new dn(O,o)],[new dn(R,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new dn(R,a),[0,0,.5],[Math.PI/2,0,0]],[new dn(O,a),[0,0,0],[Math.PI/2,0,0]],[new dn(R,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new dn(new Oo(.15,.15,.01),f),[.15,.15,0]]],YZ:[[new dn(new Oo(.15,.15,.01),c),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new dn(new Oo(.15,.15,.01),u),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new dn(new Oo(.1,.1,.1),m.clone())]]},Ce={X:[[new dn(new x0(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new dn(new x0(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new dn(new x0(.2,0,.6,4),n),[0,.3,0]],[new dn(new x0(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new dn(new x0(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new dn(new x0(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new dn(new Oo(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new dn(new Oo(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new dn(new Oo(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new dn(new Oo(.2,.2,.2),n),[0,0,0]]]},Pe={X:[[new rc(M,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new rc(M,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new rc(M,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function je(ge){const Xe=new gi;for(const Fe in ge)for(let Ne=ge[Fe].length;Ne--;){const tt=ge[Fe][Ne][0].clone(),mt=ge[Fe][Ne][1],Ht=ge[Fe][Ne][2],pn=ge[Fe][Ne][3],In=ge[Fe][Ne][4];tt.name=Fe,tt.tag=In,mt&&tt.position.set(mt[0],mt[1],mt[2]),Ht&&tt.rotation.set(Ht[0],Ht[1],Ht[2]),pn&&tt.scale.set(pn[0],pn[1],pn[2]),tt.updateMatrix();const vt=tt.geometry.clone();vt.applyMatrix4(tt.matrix),tt.geometry=vt,tt.renderOrder=1/0,tt.position.set(0,0,0),tt.rotation.set(0,0,0),tt.scale.set(1,1,1),Xe.add(tt)}return Xe}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=je(Y)),this.add(this.gizmo.rotate=je(ne)),this.add(this.gizmo.scale=je(he)),this.add(this.picker.translate=je(J)),this.add(this.picker.rotate=je($)),this.add(this.picker.scale=je(Ce)),this.add(this.helper.translate=je(z)),this.add(this.helper.rotate=je(K)),this.add(this.helper.scale=je(Pe)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const n=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:QB;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let r=[];r=r.concat(this.picker[this.mode].children),r=r.concat(this.gizmo[this.mode].children),r=r.concat(this.helper[this.mode].children);for(let s=0;s<r.length;s++){const o=r[s];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(qs.setFromEuler(rB.set(0,0,0)),o.quaternion.copy(n).multiply(qs),Math.abs(gs.copy(pE).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(qs.setFromEuler(rB.set(0,0,Math.PI/2)),o.quaternion.copy(n).multiply(qs),Math.abs(gs.copy(Py).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(qs.setFromEuler(rB.set(0,Math.PI/2,0)),o.quaternion.copy(n).multiply(qs),Math.abs(gs.copy(mE).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(qs.setFromEuler(rB.set(0,Math.PI/2,0)),gs.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(Iwe.lookAt(Nwe,gs,Py)),o.quaternion.multiply(qs),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),zl.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),zl.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(zl),o.visible=this.dragging):(o.quaternion.copy(n),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(n),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(gs.copy(pE).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(gs.copy(Py).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(gs.copy(mE).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(gs.copy(mE).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(gs.copy(pE).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(gs.copy(Py).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(iB.copy(n),gs.copy(this.eye).applyQuaternion(qs.copy(n).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(Iwe.lookAt(this.eye,Nwe,Py)),o.name==="X"&&(qs.setFromAxisAngle(pE,Math.atan2(-gs.y,gs.z)),qs.multiplyQuaternions(iB,qs),o.quaternion.copy(qs)),o.name==="Y"&&(qs.setFromAxisAngle(Py,Math.atan2(gs.x,gs.z)),qs.multiplyQuaternions(iB,qs),o.quaternion.copy(qs)),o.name==="Z"&&(qs.setFromAxisAngle(mE,Math.atan2(gs.y,gs.x)),qs.multiplyQuaternions(iB,qs),o.quaternion.copy(qs))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(c){return o.name===c}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class qdt extends dn{constructor(){super(new _x(1e5,1e5,2,2),new Ea({visible:!1,wireframe:!0,side:Co,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),sB.copy(pE).applyQuaternion(t==="local"?this.worldQuaternion:QB),FT.copy(Py).applyQuaternion(t==="local"?this.worldQuaternion:QB),OT.copy(mE).applyQuaternion(t==="local"?this.worldQuaternion:QB),gs.copy(FT),this.mode){case"translate":case"scale":switch(this.axis){case"X":gs.copy(this.eye).cross(sB),Rf.copy(sB).cross(gs);break;case"Y":gs.copy(this.eye).cross(FT),Rf.copy(FT).cross(gs);break;case"Z":gs.copy(this.eye).cross(OT),Rf.copy(OT).cross(gs);break;case"XY":Rf.copy(OT);break;case"YZ":Rf.copy(sB);break;case"XZ":gs.copy(OT),Rf.copy(FT);break;case"XYZ":case"E":Rf.set(0,0,0);break}break;case"rotate":default:Rf.set(0,0,0)}Rf.length()===0?this.quaternion.copy(this.cameraQuaternion):(kwe.lookAt(zl.set(0,0,0),Rf,gs),this.quaternion.setFromRotationMatrix(kwe)),super.updateMatrixWorld(e)}}const sd=class sd extends e0{constructor(){super(...arguments);qe(this,"app");qe(this,"three");qe(this,"activeCamera");qe(this,"controls",new Map);qe(this,"visibility",new Map);qe(this,"setScene",()=>{this.clear()})}setApp(t,n){this.app=t,this.three=n,this.app.addEventListener(ar.SET_SCENE,this.setScene)}clear(){for(const t of this.controls.values()){t.detach(),t.disconnect();const n=t.getHelper();Td(n)}this.controls=new Map,this.visibility=new Map}add(t){let n=this.controls.get(t);if(n===void 0){const r=document.querySelector(".clickable");n=new Udt(this.activeCamera,r),n.getHelper().name=t,n.setSpace("local"),this.controls.set(t,n),this.visibility.set(t,!0),n.addEventListener("mouseDown",()=>{this.dispatchEvent({type:sd.DRAG_START})}),n.addEventListener("mouseUp",()=>{this.dispatchEvent({type:sd.DRAG_END})}),n.addEventListener("dragging-changed",s=>{var o;(o=Gl.instance)==null||o.toggleOrbitControls(s.value)})}return n}get(t){return this.controls.get(t)}remove(t){const n=this.get(t);return n===void 0?!1:(n.detach(),n.disconnect(),Td(n.getHelper()),this.controls.delete(t),!0)}enabled(t){this.controls.forEach(n=>{n.enabled=t})}updateCamera(t,n){this.activeCamera=t,this.controls.forEach(r=>{r.camera!==t&&(r.camera=t,t.getWorldPosition(r.cameraPosition),t.getWorldQuaternion(r.cameraQuaternion)),r.domElement!==n&&(r.disconnect(),r.domElement=n,r.connect(n))})}show(){this.controls.forEach(t=>{const n=t.getHelper(),r=this.visibility.get(n.name);r!==void 0&&(n.visible=r)})}hide(){this.controls.forEach(t=>{const n=t.getHelper();this.visibility.set(n.name,n.visible),n.visible=!1})}static get instance(){return sd._instance||(sd._instance=new sd),sd._instance}};qe(sd,"DRAG_START","Transform::dragStart"),qe(sd,"DRAG_END","Transform::dragEnd"),qe(sd,"_instance");let zf=sd;const Xdt=new Oo,BQ=new mn;class Dwe extends gi{constructor(t,n){const r=new yn(dd(.5,1,Math.random()),dd(.5,1,Math.random()),dd(.5,1,Math.random()));super();qe(this,"curve",new m7e);qe(this,"line");qe(this,"draggable");qe(this,"curvePos");qe(this,"tension",.5);qe(this,"closed",!1);qe(this,"subdivide",50);qe(this,"curveType");qe(this,"offset",1);qe(this,"lineMaterial");qe(this,"_camera");qe(this,"_curvePercentage",0);qe(this,"_draggableScale",10);qe(this,"_transform");qe(this,"raycaster");qe(this,"draggedMat",new Ea);qe(this,"parentGroup");qe(this,"group");qe(this,"dispose",()=>{this._transform&&(this._transform.removeEventListener("objectChange",this.updateSpline),zf.instance.remove(this.name)),this.disable(),this.parentGroup.removeGroup(this.name)});qe(this,"hideTransform",()=>{var t;(t=this._transform)==null||t.detach()});qe(this,"exportSpline",()=>{const t=[];this.draggable.children.forEach(n=>{t.push([hd(n.position.x,3),hd(n.position.y,3),hd(n.position.z,3)])}),ZJe({name:this.name,points:t,tension:this.tension,closed:this.closed,subdivide:this.subdivide,type:this.curveType}),console.log("Spline copied!")});qe(this,"showPoints",(t=!0)=>{this.draggable.visible=t});qe(this,"addPoints",(t=[])=>{if(t.length>0){const n=t.length-1;for(let r=0;r<n;r++)this.addPoint(t[r],!1);this.addPoint(t[n])}else this.addPoint(new be(-50,0,0),!1),this.addPoint(new be(50,0,0))});qe(this,"addPoint",(t,n=!0)=>{const r=this.draggable.children.length,s=new dn(Xdt,this.draggedMat);return s.name=`point_${r}`,s.position.copy(t),s.scale.setScalar(this._draggableScale),this.draggable.add(s),n&&this.updateSpline(),s});qe(this,"addNextPt",()=>{var s,o;const t=this.draggable.children.length,n=new be(dd(-this.offset,this.offset,Math.random()),dd(-this.offset,this.offset,Math.random()),dd(-this.offset,this.offset,Math.random()));t>0&&n.add(this.draggable.children[t-1].position);const r=this.addPoint(n);(s=this._transform)==null||s.attach(r),(o=this.group.current)==null||o.setField("Current Point",r.position)});qe(this,"removePoint",t=>{var n,r,s,o;if(((n=this._transform)==null?void 0:n.object)===t){(r=this._transform)==null||r.detach();const a=this.draggable.children[this.draggable.children.length-1];(s=this._transform)==null||s.attach(a),(o=this.group.current)==null||o.setField("Current Point",a.position)}Td(t),this.updateSpline()});qe(this,"removePointAt",t=>{const n=this.draggable.children[t];this.removePoint(n)});qe(this,"removeSelectedPt",()=>{var t,n;((t=this._transform)==null?void 0:t.object)!==void 0&&this.removePoint((n=this._transform)==null?void 0:n.object)});qe(this,"updateSpline",()=>{this.curve=new m7e(this.points,this.closed,this.curveType,this.tension),this.line.geometry.setFromPoints(this.getPoints()),this.curvePos.position.copy(this.getPointAt(this._curvePercentage))});qe(this,"onMouseClick",t=>{var o,a,c;if(!Gl.instance||this._transform&&!this._transform.getHelper().visible)return;const r=Gl.instance.currentWindow.current.getBoundingClientRect();BQ.x=(t.clientX-r.x)/r.width*2-1,BQ.y=-((t.clientY-r.y)/r.height)*2+1,this.raycaster.setFromCamera(BQ,this.camera);const s=this.raycaster.intersectObjects(this.draggable.children,!1);if(s.length>0){const u=s[0].object;u!==((o=this._transform)==null?void 0:o.object)&&((a=this._transform)==null||a.attach(u),(c=this.group.current)==null||c.setField("Current Point",u.position))}});qe(this,"onUpdateTransform",()=>{var t,n,r;if((t=this._transform)!=null&&t.object&&this.group){const s=(n=this._transform)==null?void 0:n.object;s.name.search("point")>-1&&((r=this.group.current)==null||r.setField("Current Point",s.position))}this.updateSpline()});qe(this,"debugPoint",t=>{t.name,t.visible=this.draggable.visible});this.name=t,this.lineMaterial=new su({color:r}),this.line=new rc(new Xi,this.lineMaterial),this.line.name="line",this.add(this.line),this._camera=n,this.curveType="catmullrom",this.draggedMat.color=r,this.draggable=new gi,this.draggable.name="draggablePoints",this.add(this.draggable),this.curvePos=new dn(new G2(1.5),new Ea({color:r})),this.curvePos.name="curvePos",this.curvePos.scale.setScalar(this._draggableScale),this.curvePos.visible=!1,this.add(this.curvePos),this.raycaster=new OL,this.raycaster.params.Line.threshold=3,this.enable()}enable(){document.addEventListener("pointerdown",this.onMouseClick)}disable(){document.removeEventListener("pointerdown",this.onMouseClick)}getPointAt(t){return this.curve.getPointAt(t)}getPoints(){return this.curve.getPoints(this.subdivide)}getTangentAt(t){return this.curve.getTangentAt(t)}get points(){const t=[];return this.draggable.children.forEach(n=>{t.push(n.position)}),t}get total(){return this.draggable.children.length}get draggableScale(){return this._draggableScale}set draggableScale(t){this._draggableScale=t,this.draggable.children.forEach(n=>n.scale.setScalar(t)),this.curvePos.scale.setScalar(t)}get camera(){return this._camera}set camera(t){this._camera=t,this._transform!==void 0&&(this._transform.camera=t)}get curvePercentage(){return this._curvePercentage}set curvePercentage(t){this._curvePercentage=t,this.curvePos.position.copy(this.getPointAt(t))}initDebug(t){var s;const n=this.draggable.children;this.parentGroup=t,this._transform=zf.instance.add(this.name),this._transform.camera=this._camera,this._transform.addEventListener("objectChange",this.onUpdateTransform),this._transform.attach(n.length>0?n[n.length-1]:this),(s=Gl.instance)==null||s.scene.add(this._transform.getHelper());const r=n.length>0?n[n.length-1].position:{x:0,y:0,z:0};this.group=t.addGroup({title:this.name,items:[{prop:"Closed",type:"boolean",value:this.closed},{prop:"Visible",type:"boolean",value:this.visible},{prop:"Show Position",type:"boolean",value:this.curvePos.visible},{prop:"Show Points",type:"boolean",value:this.draggable.visible},{prop:"Color",type:"color",value:`#${this.draggedMat.color.getHexString()}`},{prop:"Curve",type:"option",options:[{title:"Catmullrom",value:"catmullrom"},{title:"Centripetal",value:"centripetal"},{title:"Chordal",value:"chordal"}]},{prop:"Draggable Scale",type:"range",min:.01,max:100,step:.01,value:this._draggableScale},{prop:"Subdivide",type:"range",min:1,max:100,step:1,value:this.subdivide},{prop:"Tension",type:"range",min:0,max:1,step:.01,value:this.tension},{prop:"New Pt Offset",type:"range",min:0,max:10,value:this.offset},{prop:"Curve At",type:"range",min:0,max:1,step:.01,value:0},{prop:"Toggle Transform",type:"button"},{prop:"Add Point",type:"button"},{prop:"Remove Point",type:"button"},{prop:"Export",type:"button"},{prop:"Delete",type:"button"},{prop:"Current Point",type:"grid3",value:r}],onUpdate:(o,a)=>{var c,u;switch(o){case"Closed":this.closed=a,this.updateSpline();break;case"Visible":this.visible=a;break;case"Color":this.lineMaterial.color.setStyle(a),this.draggedMat.color.setStyle(a);break;case"Curve":this.curveType=a,this.updateSpline();break;case"Draggable Scale":this.draggableScale=a;break;case"Subdivide":this.subdivide=a,this.updateSpline();break;case"Tension":this.tension=a,this.updateSpline();break;case"New Pt Offset":this.offset=a;break;case"Curve At":this.curvePos.position.copy(this.getPointAt(a));break;case"Show Position":this.curvePos.visible=a;break;case"Show Points":this.draggable.visible=a;break;case"Toggle Transform":this._transform&&(this._transform.getHelper().visible=!this._transform.getHelper().visible);break;case"Add Point":this.addNextPt();break;case"Remove Point":this.removeSelectedPt();break;case"Export":this.exportSpline();break;case"Delete":Td(this);break;case"Current Point":if(this.group.current&&((c=this._transform)!=null&&c.object)){const f=(u=this._transform)==null?void 0:u.object;f.name.search("point")>-1&&(f.position.copy(a),this.updateSpline())}break}}}),this.draggable.children.forEach(o=>{this.debugPoint(o)})}}let oB=0;class Ydt extends gi{constructor(t,n){super();qe(this,"defaultScale",10);qe(this,"_camera");qe(this,"group",null);qe(this,"app");qe(this,"createSpline",(t=[])=>{const n=`Spline ${oB+1}`,r=new Dwe(n,this._camera);return r.addPoints(t),this.addSpline(r),oB++,r});qe(this,"createSplineFromArray",t=>{const n=[];return t.forEach(r=>{n.push(new be(r[0],r[1],r[2]))}),this.createSpline(n)});qe(this,"createSplineFromCatmullRom",t=>this.createSpline(t.points));qe(this,"createSplineFromJSON",t=>{const n=this.createSplineFromArray(t.points);return n.name=t.name,n.closed=t.closed,n.subdivide=t.subdivide,n.tension=t.tension,n.type=t.type,n.updateSpline(),n});qe(this,"showPoints",(t=!0)=>{this.children.forEach(n=>{n.showPoints(t)})});qe(this,"onAddSpline",t=>{const n=JSON.parse(t.value),r=`Spline ${oB+1}`,s=[];n.points.forEach(a=>{s.push(new be(a[0],a[1],a[2]))});const o=new Dwe(r,this.camera);o.addPoints(s),this.addSpline(o),oB++});this.name="Spline Editor",this._camera=t,this.app=n,this.app.addEventListener(ar.ADD_SPLINE,this.onAddSpline)}initDebug(){this.group=rx.addEditorGroup({title:this.name,items:[{type:"button",prop:"New Spline"},{type:"boolean",prop:"Show Points",value:!0},{type:"boolean",prop:"Visible",value:this.visible},{type:"range",prop:"Default Scale",min:0,max:50,step:.01,value:this.defaultScale}],onUpdate:(t,n)=>{switch(t){case"New Spline":this.createSpline();break;case"Show Points":this.showPoints(n);break;case"Visible":this.visible=n;break;case"Default Scale":this.defaultScale=n;break}}})}dispose(){this.app.removeEventListener(ar.ADD_SPLINE,this.onAddSpline),rx.removeEditorGroup(this.name)}addSpline(t){var n;t.draggableScale=this.defaultScale,t.hideTransform(),((n=this.group)==null?void 0:n.current)!==null&&t.initDebug(this.group.current),this.add(t)}get camera(){return this._camera}set camera(t){this._camera=t,this.children.forEach(n=>{const r=n;r.camera=t})}}const Fwe=["Single","Side by Side","Stacked","Quad"],Kdt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC60lEQVRYhe2YT4hNcRTHP48xpmYaNAvRyEQxEhnKQljYsRm9/EmSyJiMFAsMZWNhJYoNIUVJ2VGiyb9ZzIpMpkQSahbGv9GMYWrM+1rc2zjvzvvdd+99rzdvMd+6de75nd+5387vnN/v/G5KEuWMKRNNIB8mCRaKiiL5qQb2ApuBuUAV0Ad0AJeB3sSeJRX6LJbULTf6JTUn9Z+KWMUpPyp/Avoa4CNQZ3Sj/lNpdL/xottR7AjOkHRUUpekN5I6JbVLavDH75lIfZN0UFKTpCWS0pJem/HeJBEMG6yV1ONYtgFJbZJ+GF1jDh+zJb03NuliEuwMkMo4yErS2RA/LcbuYVyCrm1mA7Dal/8Cu4FG4JD/HsTTkCy6a+SVMTPQuc1sBKb78nHghi+/A+YBxwL2lbhRY+ThuARdEVxu5JdGFvACr0otdoZ8Y4+Rn0Sn5sFFsMvI6YB9MzA1YJ8mN8k1wAHzfj4uQVdyrpI0aJL7oqTtkq4FiqPLyCOSbktqlbRL0jlJQ2b8QdwCUZ4qvhRStZL0XFK1pMd57CRvq5mfhKBriRfiFUMY6oD7eOdwPlQAN4G10dfWg+uouwXsiOssAj4AC+JMcEWwvnAuOTEr7gTXPmg34zagOwkbIIOXAo9CbDYBrcBXYN+4UUdy2sRflyS5zVNlfPX7ugpJW5V9nI7mmh+lYU0lCZ2B3TOnAVuAk0BTwC5nuhWro46KauBOQJch5OpRaoIW34GreGf+YZdRqS9NAj4Bp4ClQDvwOWxCqSM4ADQEdKE5XvbXzlITrAVe4TW+M6NMKDXBFLAMuAD0ACfIc7pMZBXXA2cY3/xmodQRHAL2A2+NLtj8ZiEKwUL/z2WMPAJcAVYALWSf8dZuDFGWeBHwKxm3sWYhiGG8Tfo6sA2vSfiSy4GrH3wGrDcfKSSKKf6v1E9yF0XK9Q1XBPuMXMw8HXTonQFwETwNzMFr64v1jzgFHIk9ybHEZYPJo65QlD3Bf2/Q/eaHPiSWAAAAAElFTkSuQmCC",Zdt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAETklEQVRYhe2YXYhVVRTHf3d0/JhyUrMpFbImM+whSa3Mynww+4AeIgiKoozooQ+KyMyXIAujF6OXqHyI6iEKKYgIP/owsjSFqCkprdDUTEcjbWZ0HHV+Pex1ucfb9Z57Z9REXHA4Z++99l7/s/ZZ/7X2KaiczNLwfwPIk9MA+yunNMAG4DHgV+BvoB3YFff2TPstYEyfrajVroI6Sr1GvahsbJC63HzZq04pmztSvU5tVRuqYRiYg78JeBR4HPg5ntdmxovz9wJfA3uAxuibDLQCA+IqynnAQuBuYCnwMLC1rx48U12U8cZqdWqMDcx4cI16qTpYbVKHqa+ovWUeHKsujn7VL9ULq2HI+wY7gVeBJdGeFu3J4ZUiy/cAXeHRRuAQsC/GC0B3eG4BcH/0tUV7czUAeVsMsBF4Kha9HZgCvAncAuwPnXHA0wFuGLANuDrGuoGDwFxgTqzzQ7RX5FrP2eLsdb76vnogtme6+nE8H1YPlQXHwbi3q9eqn0e7Tb25VrsF68vFY0lb1AGcDTwItGQ8tQM4AIwGmqP/EPAu8A0wElgJfFGzxTo8mKWXu9Rd4ZF96jvqjSbauEC9Sn1O3R463epLaku99voCsFXdkAH3kNpcQW+IiT/bQne3eufxBtioPqP2mKhioXpWzpxb1T8C5Ifh4ZptVoriRmAIKdrI3Lujf3bobAPeJpF0NVkKrAFuI9HTOBIxnxFrF4OgQKKr/dnJlQA+AcwABgOHA4zAamA5cE7orQL+zAEHiWI+A2bFC7aSguheYCgpqAphZz3wSB7AecCICv2TgH8oFRib4gVqka0k0h8CXAxMBW6ooDejFoCvA9OBQUAvKWM0kDz4XUZvNKXtyZMWUl7vBbaQXq457PeEziDgx/KJlQAuIPFdMcEXv5OdYWBP9M8k8VpnDQCvB4aTSrCNJB5cSdrW3tBpIJVnR0qdUTxAfdGUOVTnmwqEanNmqltC/9OgqePKg5eom8PgdvW+oJ9Kupera0O3U50TL3lcAaI+oHaF4R3qa6Z822wq0Saq89T1lmSxOrxeW/Xm4uGkiqQDmECKuKHxHW0HdpMiewSpvGqKeR8Ay0iBsYIjg6261PE2o9Q3Yqv+MqWxO9R1Hl12qs+q49Vlppy82pSr+5xJKsko4AXgHlJ0t5NIeg3wLXAlqZhtIUV8J6nmWwX8QiLjdhL5TwMWkY4R6/rrwYKlMr1Y321QZ/vfwBijPqm+rF4Wc7PjE9QllurGVeoV5gRNHsAm9fnMom3qrKPoTjKdMXaYyrFygEWQ72XWW24qhPu8xcUc2UU6O8wFPjmK7jhgPHAuMJGUGQ6U6WwE5sfzTXGvei7KA9hFOiR9D/wOfFVFt4dS2tpfRe83Ur7/CPiJakfOGgBCypubatArl2r8VfOax/LfzABKtePAzHO/5FgC7KBEzB2kOrDfUm8mOeFySv9+OyFyGmB/5aQH+C9BVKmVCNuMZgAAAABJRU5ErkJggg==",Qdt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAQ0lEQVQ4jWP8////fwYqAxYozUhFM/8zkaKYWIWkGEq0b0ZdSjQY5i79TyWagRGaTUdzFEEw6lLqGzqwLoVVJ1StpwA9sBwbUqAh5gAAAABJRU5ErkJggg==",vU=class vU extends _n.Component{constructor(t){super(t);qe(this,"app");qe(this,"scene",new W1);qe(this,"renderer");qe(this,"currentScene");qe(this,"cameras",new Map);qe(this,"controls",new Map);qe(this,"currentCamera");qe(this,"currentWindow");qe(this,"cameraHelpers",new Map);qe(this,"lightHelpers",new Map);qe(this,"helpersContainer",new qy);qe(this,"grid",new gdt);qe(this,"interactionHelper",new fYe(25));qe(this,"currentTransform");qe(this,"splineEditor");qe(this,"depthMaterial",new _Ae);qe(this,"normalsMaterial",new _re);qe(this,"uvMaterial",new Ldt);qe(this,"wireframeMaterial",new Ea({opacity:.33,transparent:!0,wireframe:!0}));qe(this,"playing",!1);qe(this,"rafID",-1);qe(this,"cameraControlsRafID",-1);qe(this,"width",0);qe(this,"height",0);qe(this,"sceneSet",!1);qe(this,"tlCam",null);qe(this,"trCam",null);qe(this,"blCam",null);qe(this,"brCam",null);qe(this,"tlRender","Renderer");qe(this,"trRender","Renderer");qe(this,"blRender","Renderer");qe(this,"brRender","Renderer");qe(this,"cameraVisibility",!0);qe(this,"lightVisibility",!0);qe(this,"gridVisibility",!0);qe(this,"selectedItem");qe(this,"debugCamera");qe(this,"raycaster",new OL);qe(this,"pointer",new mn);qe(this,"cameraControls");qe(this,"canvasRef");qe(this,"containerRef");qe(this,"tlWindow");qe(this,"trWindow");qe(this,"blWindow");qe(this,"brWindow");qe(this,"setupRenderer",t=>{this.renderer&&this.renderer.dispose();const n=this.canvasRef.current,r=t.value;r.type==="WebGLRenderer"?(this.renderer=new IE({canvas:n,stencil:!1}),this.grid.visible=!0):r.type==="WebGPURenderer"&&(this.renderer=new EQ({canvas:n,stencil:!1}),this.grid.visible=!1),this.renderer&&(this.renderer.autoClear=!1,this.renderer.shadowMap.enabled=!0,this.renderer.setPixelRatio(devicePixelRatio),this.renderer.setClearColor(0),this.resize(),this.props.three.renderer=this.renderer)});qe(this,"onUpdate",()=>{this.playing&&(this.update(),this.draw(),this.rafID=requestAnimationFrame(this.onUpdate))});qe(this,"resize",()=>{var a;this.width=window.innerWidth-300,this.height=window.innerHeight,(a=this.renderer)==null||a.setSize(this.width,this.height);const t=Math.floor(this.width/2),n=Math.floor(this.height/2);this.props.three.resize(this.width,this.height),this.props.onSceneResize!==void 0&&this.sceneSet&&this.currentScene!==void 0&&this.props.onSceneResize(this.currentScene,this.width,this.height);let r=this.width,s=this.height;switch(this.state.mode){case"Side by Side":r=t,s=this.height;break;case"Stacked":r=this.width,s=n;break;case"Quad":r=t,s=n;break}const o=r/s;this.cameras.forEach(c=>{var u;c instanceof w4?(c.left=r/-2,c.right=r/2,c.top=s/2,c.bottom=s/-2,c.name==="UI"&&(c.position.x=this.width/2,c.position.y=this.height/-2,c.position.z=100),c.updateProjectionMatrix()):c instanceof po&&(c.aspect=o,c.updateProjectionMatrix()),(u=this.cameraHelpers.get(c.name))==null||u.update()})});qe(this,"sceneUpdate",t=>{this.clearLightHelpers(),this.scene.remove(this.currentScene),Td(this.currentScene);const n=this.props.scenes.get(t.value.name);if(n!==void 0){const r=new n;this.props.onSceneSet!==void 0&&this.props.onSceneSet(r),this.currentScene=r,this.props.three.scene=this.currentScene,this.scene.add(this.currentScene),this.sceneSet=!0,this.addLightHelpers()}});qe(this,"addCamera",t=>{var s;const n=t.value,r=(s=this.props.three.scene)==null?void 0:s.getObjectByProperty("uuid",n.uuid);if(r!==void 0){const o=r;this.cameras.set(n.name,o);const a=new dYe(o);a.visible=this.cameraVisibility,this.cameraHelpers.set(o.name,a),this.scene.add(a),this.setState({lastUpdate:Date.now()})}});qe(this,"removeCamera",t=>{const n=this.cameraHelpers.get(t.value.name);n!==void 0&&(this.scene.remove(n),n.dispose()),this.cameras.delete(t.value.name),this.setState({lastUpdate:Date.now()})});qe(this,"onMouseMove",t=>{var m;const n=new mn;(m=this.renderer)==null||m.getSize(n);const r=Math.min(t.clientX,n.x),s=Math.min(t.clientY,n.y);this.pointer.x=Ey(r,0,n.x,-1,1),this.pointer.y=Ey(s,0,n.y,1,-1);const o=n.x/2,a=n.y/2,c=()=>{r<o?this.pointer.x=Ey(r,0,o,-1,1):this.pointer.x=Ey(r,o,n.x,-1,1)},u=()=>{s<a?this.pointer.y=Ey(s,0,a,1,-1):this.pointer.y=Ey(s,a,n.y,1,-1)};switch(this.state.mode){case"Quad":c(),u();break;case"Side by Side":c();break;case"Stacked":u(),u();break}if(this.updateCamera(r,s,o,a),this.state.interactionMode==="Orbit")return;const f=this.raycaster.intersectObjects(this.currentScene.children);f.length>0&&this.interactionHelper.position.copy(f[0].point)});qe(this,"onClick",t=>{if(this.state.interactionMode==="Orbit")return;const n=new mn;if(this.renderer.getSize(n),t.clientX>=n.x)return;this.onMouseMove(t);const r=this.raycaster.intersectObjects(this.currentScene.children);r.length>0&&(this.props.three.getObject(r[0].object.uuid),this.interactionHelper.visible=!1,this.setState({interactionMode:"Orbit",lastUpdate:Date.now()}))});qe(this,"onKey",t=>{if(this.selectedItem!==void 0){if(t.ctrlKey){if(this.currentCamera.name==="UI")return;const n=this.controls.get(this.currentCamera.name);t.key==="0"?(t.preventDefault(),this.clearControls(),this.cameraControls=new Ff(this.currentCamera,this.currentWindow.current),this.selectedItem instanceof dn||this.selectedItem instanceof dre?(this.selectedItem.geometry.computeBoundingBox(),this.cameraControls.fitToBox(this.selectedItem.geometry.boundingBox,!0)):this.cameraControls.fitToSphere(this.selectedItem,!0),this.updateCameraControls(n,!0)):t.key==="1"?(t.preventDefault(),this.clearControls(),this.cameraControls=new Ff(this.currentCamera,this.currentWindow.current),this.cameraControls.rotateTo(0,Math.PI*.5,!0),this.cameraControls.moveTo(this.selectedItem.position.x,this.selectedItem.position.y,0,!0),this.updateCameraControls(n)):t.key==="2"?(t.preventDefault(),this.clearControls(),this.cameraControls=new Ff(this.currentCamera,this.currentWindow.current),this.cameraControls.rotateTo(0,0,!0),this.cameraControls.moveTo(this.selectedItem.position.x,0,this.selectedItem.position.z,!0),this.updateCameraControls(n)):t.key==="3"?(t.preventDefault(),this.clearControls(),this.cameraControls=new Ff(this.currentCamera,this.currentWindow.current),this.cameraControls.rotateTo(Math.PI/2,Math.PI/2,!0),this.cameraControls.moveTo(0,this.selectedItem.position.y,this.selectedItem.position.z,!0),this.updateCameraControls(n)):t.key==="4"?(t.preventDefault(),this.clearControls(),this.cameraControls=new Ff(this.currentCamera,this.currentWindow.current),this.cameraControls.rotateTo(Math.PI,Math.PI/2,!0),this.cameraControls.moveTo(this.selectedItem.position.x,this.selectedItem.position.y,0,!0),this.updateCameraControls(n)):t.key==="5"&&(t.preventDefault(),this.clearControls(),this.cameraControls=new Ff(this.currentCamera,this.currentWindow.current),this.cameraControls.rotateTo(LL(45),LL(45),!0),this.updateCameraControls(n))}else if(this.currentTransform!==void 0)switch(t.key){case"r":this.currentTransform.setMode("rotate");break;case"s":this.currentTransform.setMode("scale");break;case"t":this.currentTransform.setMode("translate");break;case"q":this.currentTransform.setSpace(this.currentTransform.space==="local"?"world":"local");break}}});qe(this,"onSetSelectedItem",t=>{this.selectedItem!==void 0&&this.updateSelectedItemHelper(!1),this.selectedItem=this.currentScene.getObjectByProperty("uuid",t.value.uuid),this.selectedItem!==void 0&&(this.currentTransform!==void 0&&(this.currentTransform.removeEventListener("objectChange",this.onUpdateTransform),zf.instance.remove(this.currentTransform.getHelper().name)),this.currentTransform=zf.instance.add(t.value.name),this.currentTransform.attach(this.selectedItem),this.scene.add(this.currentTransform.getHelper()),this.currentTransform.addEventListener("objectChange",this.onUpdateTransform),this.updateSelectedItemHelper(!0))});qe(this,"onUpdateTransform",()=>{this.selectedItem!==void 0&&(this.props.three.updateObject(this.selectedItem.uuid,"position",this.selectedItem.position),this.props.three.updateObject(this.selectedItem.uuid,"rotation",{x:this.selectedItem.rotation.x,y:this.selectedItem.rotation.y,z:this.selectedItem.rotation.z}),this.props.three.updateObject(this.selectedItem.uuid,"scale",this.selectedItem.scale),sU.instance.update())});qe(this,"clearLightHelpers",()=>{this.lightHelpers.forEach(t=>{this.helpersContainer.remove(t),t.dispose()}),this.lightHelpers.clear()});qe(this,"addLightHelpers",()=>{this.currentScene!==void 0&&this.currentScene.traverse(t=>{if(t.type.search("Light")>-1){let n;switch(t.type){case"DirectionalLight":n=new hYe(t,100),n.name=`${t.name}Helper`,n.visible=this.lightVisibility,this.lightHelpers.set(t.name,n),this.helpersContainer.add(n);break;case"HemisphereLight":n=new uYe(t,250),n.name=`${t.name}Helper`,n.visible=this.lightVisibility,this.lightHelpers.set(t.name,n),this.helpersContainer.add(n);break;case"RectAreaLight":n=new Yht(t),n.name=`${t.name}Helper`,n.visible=this.lightVisibility,this.lightHelpers.set(t.name,n),this.helpersContainer.add(n);break;case"PointLight":n=new lYe(t,100),n.name=`${t.name}Helper`,n.visible=this.lightVisibility,this.lightHelpers.set(t.name,n),this.helpersContainer.add(n);break;case"SpotLight":n=new oYe(t),n.name=`${t.name}Helper`,n.visible=this.lightVisibility,this.lightHelpers.set(t.name,n),this.helpersContainer.add(n);break}}})});qe(this,"updateCamera",(t,n,r,s)=>{switch(this.state.mode){case"Quad":n<s?t<r?this.currentCamera=this.tlCam:this.currentCamera=this.trCam:t<r?this.currentCamera=this.blCam:this.currentCamera=this.brCam;break;case"Side by Side":t<r?this.currentCamera=this.tlCam:this.currentCamera=this.trCam;break;case"Single":this.currentCamera=this.tlCam;break;case"Stacked":n<s?this.currentCamera=this.tlCam:this.currentCamera=this.trCam;break}this.splineEditor.camera=this.currentCamera,this.raycaster.setFromCamera(this.pointer,this.currentCamera),this.currentCamera===this.tlCam?this.currentWindow=this.tlWindow:this.currentCamera===this.trCam?this.currentWindow=this.trWindow:this.currentCamera===this.blCam?this.currentWindow=this.blWindow:this.currentCamera===this.brCam&&(this.currentWindow=this.brWindow),zf.instance.updateCamera(this.currentCamera,this.currentWindow.current)});qe(this,"updateCameraControls",(t,n=!1)=>{if(this.selectedItem===void 0)return;cancelAnimationFrame(this.cameraControlsRafID),this.cameraControlsRafID=-1,this.cameraControls&&(this.cameraControls.smoothTime=.1);const r=.15,s=new RAe;s.start(),this.selectedItem.getWorldPosition(t.target0);const o=()=>{const a=s.getDelta();this.cameraControls&&this.cameraControls.update(a),n&&(t.target.lerp(t.target0,r),t.object.position.lerp(t.position0,r),t.object.zoom=Hee(t.object.zoom,t.zoom0,r),t.object.updateProjectionMatrix(),t.dispatchEvent({type:"change"})),s.getElapsedTime()>=.5?(cancelAnimationFrame(this.cameraControlsRafID),this.cameraControlsRafID=-1,this.clearControls()):this.cameraControlsRafID=requestAnimationFrame(o)};o()});qe(this,"clearControls",()=>{this.cameraControls!==void 0&&(this.cameraControls.disconnect(),this.cameraControls.dispose(),this.cameraControls=void 0)});qe(this,"drawDouble",()=>{const t=this.getSceneOverride(this.tlRender),n=this.getSceneOverride(this.trRender),r=Math.floor(this.width/2),s=Math.floor(this.height/2);if(this.state.mode==="Side by Side")this.drawTo(0,0,r,this.height,this.tlCam,t),this.drawTo(r,0,r,this.height,this.trCam,n);else{const o=this.height-s;this.drawTo(0,o,this.width,s,this.tlCam,t),this.drawTo(0,0,this.width,s,this.trCam,n)}});qe(this,"drawQuad",()=>{const t=this.getSceneOverride(this.tlRender),n=this.getSceneOverride(this.trRender),r=this.getSceneOverride(this.blRender),s=this.getSceneOverride(this.brRender),o=Math.floor(this.width/2),a=Math.floor(this.height/2);let c=0,u=0;u=this.height-a,c=0,this.drawTo(c,u,o,a,this.tlCam,t),c=o,this.drawTo(c,u,o,a,this.trCam,n),u=0,c=0,this.scene.overrideMaterial=r,this.drawTo(c,u,o,a,this.blCam,r),c=o,this.drawTo(c,u,o,a,this.brCam,s)});this.app=t.app,this.app.addEventListener(ar.ADD_RENDERER,this.setupRenderer),this.canvasRef=_n.createRef(),this.containerRef=_n.createRef(),this.tlWindow=_n.createRef(),this.trWindow=_n.createRef(),this.blWindow=_n.createRef(),this.brWindow=_n.createRef();const n=t.three.app.appID,r=localStorage,s=r.getItem(`${n}_mode`);this.state={mode:s!==null?s:"Single",modeOpen:!1,renderModeOpen:!1,interactionMode:"Orbit",interactionModeOpen:!1,lastUpdate:Date.now()},r.setItem(`${n}_mode`,this.state.mode),r.setItem(`${n}_tlCam`,r.getItem(`${n}_tlCam`)!==null?r.getItem(`${n}_tlCam`):"Debug"),r.setItem(`${n}_trCam`,r.getItem(`${n}_trCam`)!==null?r.getItem(`${n}_trCam`):"Orthographic"),r.setItem(`${n}_blCam`,r.getItem(`${n}_blCam`)!==null?r.getItem(`${n}_blCam`):"Front"),r.setItem(`${n}_brCam`,r.getItem(`${n}_brCam`)!==null?r.getItem(`${n}_brCam`):"Top"),r.setItem(`${n}_tlRender`,r.getItem(`${n}_tlRender`)!==null?r.getItem(`${n}_tlRender`):"Renderer"),r.setItem(`${n}_trRender`,r.getItem(`${n}_trRender`)!==null?r.getItem(`${n}_trRender`):"Renderer"),r.setItem(`${n}_blRender`,r.getItem(`${n}_blRender`)!==null?r.getItem(`${n}_blRender`):"Renderer"),r.setItem(`${n}_brRender`,r.getItem(`${n}_brRender`)!==null?r.getItem(`${n}_brRender`):"Renderer");const o={Vector2:mn,Vector3:be,Vector4:ir,Quaternion:qi,Matrix4:Vn,Spherical:zee,Box3:R4,Sphere:nm,Raycaster:OL};Ff.install({THREE:o}),this.setupScene(),this.setupTools();const a=localStorage.getItem(this.expandedCameraVisibility);a!==null&&(this.cameraVisibility=a==="open"),this.saveExpandedCameraVisibility();const c=localStorage.getItem(this.expandedLightVisibility);c!==null&&(this.lightVisibility=c==="open"),this.saveExpandedLightVisibility();const u=localStorage.getItem(this.expandedGridVisibility);u!==null&&(this.gridVisibility=u==="open"),this.grid.visible=this.gridVisibility,this.saveExpandedGridVisibility(),vU.instance=this}componentDidMount(){this.enable(),this.assignControls(),this.resize(),this.play(),zf.instance.setApp(this.props.app,this.props.three),zf.instance.activeCamera=this.debugCamera}componentDidUpdate(t,n,r){n.mode!==this.state.mode&&(this.assignControls(),this.resize())}componentWillUnmount(){this.disable(),rx.removeEditorGroup("View Settings")}render(){const t=[];return this.cameras.forEach((n,r)=>{t.push(r)}),We.jsxs("div",{className:"multiview",children:[We.jsx("canvas",{ref:this.canvasRef}),We.jsxs("div",{className:`cameras ${this.state.mode==="Single"||this.state.mode==="Stacked"?"single":""}`,ref:this.containerRef,children:[this.state.mode==="Single"&&We.jsx(We.Fragment,{children:We.jsx(py,{name:"tl",camera:this.tlCam,options:t,ref:this.tlWindow,onSelectCamera:n=>{var s;(s=this.controls.get(this.tlCam.name))==null||s.dispose();const r=this.cameras.get(n);r!==void 0&&(this.clearCamera(this.tlCam),this.tlCam=r,localStorage.setItem(`${this.appID}_tlCam`,r.name),this.createControls(r,this.tlWindow.current))},onSelectRenderMode:n=>{this.tlRender=n,localStorage.setItem(`${this.appID}_tlRender`,n)}})}),(this.state.mode==="Side by Side"||this.state.mode==="Stacked")&&We.jsxs(We.Fragment,{children:[We.jsx(py,{name:"tl",camera:this.tlCam,options:t,ref:this.tlWindow,onSelectCamera:n=>{var s;(s=this.controls.get(this.tlCam.name))==null||s.dispose();const r=this.cameras.get(n);r!==void 0&&(this.clearCamera(this.tlCam),this.tlCam=r,localStorage.setItem(`${this.appID}_tlCam`,r.name),this.createControls(r,this.tlWindow.current))},onSelectRenderMode:n=>{this.tlRender=n,localStorage.setItem(`${this.appID}_tlRender`,n)}}),We.jsx(py,{name:"tr",camera:this.trCam,options:t,ref:this.trWindow,onSelectCamera:n=>{var s;(s=this.controls.get(this.trCam.name))==null||s.dispose();const r=this.cameras.get(n);r!==void 0&&(this.clearCamera(this.trCam),this.trCam=r,localStorage.setItem(`${this.appID}_trCam`,r.name),this.createControls(r,this.trWindow.current))},onSelectRenderMode:n=>{this.trRender=n,localStorage.setItem(`${this.appID}_trRender`,n)}})]}),this.state.mode==="Quad"&&We.jsxs(We.Fragment,{children:[We.jsx(py,{name:"tl",camera:this.tlCam,options:t,ref:this.tlWindow,onSelectCamera:n=>{var s;(s=this.controls.get(this.tlCam.name))==null||s.dispose();const r=this.cameras.get(n);r!==void 0&&(this.clearCamera(this.tlCam),this.tlCam=r,localStorage.setItem(`${this.appID}_tlCam`,r.name),this.createControls(r,this.tlWindow.current))},onSelectRenderMode:n=>{this.tlRender=n,localStorage.setItem(`${this.appID}_tlRender`,n)}}),We.jsx(py,{name:"tr",camera:this.trCam,options:t,ref:this.trWindow,onSelectCamera:n=>{var s;(s=this.controls.get(this.trCam.name))==null||s.dispose();const r=this.cameras.get(n);r!==void 0&&(this.clearCamera(this.trCam),this.trCam=r,localStorage.setItem(`${this.appID}_trCam`,r.name),this.createControls(r,this.trWindow.current))},onSelectRenderMode:n=>{this.trRender=n,localStorage.setItem(`${this.appID}_trRender`,n)}}),We.jsx(py,{name:"bl",camera:this.blCam,options:t,ref:this.blWindow,onSelectCamera:n=>{var s;(s=this.controls.get(this.blCam.name))==null||s.dispose();const r=this.cameras.get(n);r!==void 0&&(this.clearCamera(this.blCam),this.blCam=r,localStorage.setItem(`${this.appID}_blCam`,r.name),this.createControls(r,this.blWindow.current))},onSelectRenderMode:n=>{this.blRender=n,localStorage.setItem(`${this.appID}_blRender`,n)}}),We.jsx(py,{name:"br",camera:this.brCam,options:t,ref:this.brWindow,onSelectCamera:n=>{var s;(s=this.controls.get(this.brCam.name))==null||s.dispose();const r=this.cameras.get(n);r!==void 0&&(this.clearCamera(this.brCam),this.brCam=r,localStorage.setItem(`${this.appID}_brCam`,r.name),this.createControls(r,this.brWindow.current))},onSelectRenderMode:n=>{this.brRender=n,localStorage.setItem(`${this.appID}_brRender`,n)}})]})]}),We.jsxs("div",{className:"settings",children:[We.jsx(rU,{title:"View",index:Fwe.indexOf(this.state.mode),options:Fwe,onSelect:n=>{n!==this.state.mode&&(this.killControls(),this.setState({mode:n}),localStorage.setItem(`${this.appID}_mode`,n))},open:this.state.modeOpen,onToggle:n=>{this.setState({modeOpen:n,renderModeOpen:!1,interactionModeOpen:!1})}}),We.jsx(rU,{title:"Interact",index:this.state.interactionMode==="Orbit"?0:1,options:["Orbit Mode","Selection Mode"],onSelect:n=>{this.interactionHelper.visible=n==="Selection Mode",this.setState({interactionMode:this.interactionHelper.visible?"Selection":"Orbit"})},open:this.state.interactionModeOpen,onToggle:n=>{this.setState({modeOpen:!1,renderModeOpen:!1,interactionModeOpen:n})}}),We.jsx(DQ,{name:"cameraHelper",icon:Kdt,selected:this.cameraVisibility,height:24,top:2,onClick:n=>{if(this.cameraVisibility=n,this.saveExpandedCameraVisibility(),this.cameraHelpers.forEach(r=>{r.visible=n}),this.selectedItem!==void 0&&!n){const r=this.cameraHelpers.get(this.selectedItem.name);r!==void 0&&(r.visible=!0)}}}),We.jsx(DQ,{name:"lightHelper",icon:Zdt,selected:this.lightVisibility,height:24,top:4,onClick:n=>{if(this.lightVisibility=n,this.saveExpandedLightVisibility(),this.lightHelpers.forEach(r=>{r.visible=n}),this.selectedItem!==void 0&&!n&&this.selectedItem.isLight===!0){const r=this.lightHelpers.get(this.selectedItem.name);r!==void 0&&(r.visible=!0)}}}),We.jsx(DQ,{name:"gridHelper",icon:Qdt,selected:this.gridVisibility,height:21,width:21,onClick:n=>{this.gridVisibility=n,this.saveExpandedGridVisibility(),this.grid.visible=n}})]},this.state.lastUpdate)]})}setupScene(){this.scene.name="Debug Scene",this.scene.uuid="",this.helpersContainer.name="helpers",this.scene.add(this.helpersContainer),this.grid.position.y=-1,this.helpersContainer.add(this.grid),this.interactionHelper.name="interactionHelper",this.interactionHelper.visible=!1,this.helpersContainer.add(this.interactionHelper);const t=(o,a)=>{const c=new w4(-100,100,100,-100,0,3e3);return c.name=o,c.position.copy(a),c.lookAt(0,0,0),this.cameras.set(o,c),c},n=1e3;t("Top",new be(0,n,0)),t("Bottom",new be(0,-n,0)),t("Left",new be(-n,0,0)),t("Right",new be(n,0,0)),t("Front",new be(0,0,n)),t("Back",new be(0,0,-n)),t("Orthographic",new be(n,n,n)),t("UI",new be),this.debugCamera=new po(60,1,50,5e3),this.debugCamera.name="Debug",this.debugCamera.position.set(500,500,500),this.debugCamera.lookAt(0,0,0),this.cameras.set("Debug",this.debugCamera),this.currentCamera=this.debugCamera;const r=localStorage,s=this.props.three.app.appID;this.tlCam=this.cameras.get(r.getItem(`${s}_tlCam`)),this.trCam=this.cameras.get(r.getItem(`${s}_trCam`)),this.blCam=this.cameras.get(r.getItem(`${s}_blCam`)),this.brCam=this.cameras.get(r.getItem(`${s}_brCam`)),this.tlCam===void 0&&(this.tlCam=this.cameras.get("Debug")),this.trCam===void 0&&(this.trCam=this.cameras.get("Orthographic")),this.blCam===void 0&&(this.blCam=this.cameras.get("Front")),this.brCam===void 0&&(this.brCam=this.cameras.get("Top"))}setupTools(){this.splineEditor=new Ydt(this.currentCamera,this.app),this.splineEditor.initDebug(),this.scene.add(this.splineEditor)}play(){this.playing=!0,this.onUpdate()}pause(){this.playing=!1,cancelAnimationFrame(this.rafID),this.rafID=-1}toggleOrbitControls(t){this.controls.forEach(n=>{n.enabled=!t})}update(){this.controls.forEach(t=>t.update()),this.cameraHelpers.forEach(t=>t.update()),this.lightHelpers.forEach(t=>{t.update!==void 0&&t.update()}),this.props.onSceneUpdate!==void 0&&this.sceneSet&&this.props.onSceneUpdate(this.currentScene)}draw(){var t,n;switch(this.renderer&&(this.renderer instanceof IE?(t=this.renderer)==null||t.clear():this.renderer instanceof EQ&&((n=this.renderer)==null||n.clearAsync())),this.state.mode){case"Single":this.drawSingle();break;case"Side by Side":case"Stacked":this.drawDouble();break;case"Quad":this.drawQuad();break}}enable(){const t=this.containerRef.current;t.addEventListener("mousemove",this.onMouseMove),t.addEventListener("click",this.onClick),window.addEventListener("keydown",this.onKey),window.addEventListener("resize",this.resize),this.app.addEventListener(ar.SET_SCENE,this.sceneUpdate),this.app.addEventListener(ar.ADD_CAMERA,this.addCamera),this.app.addEventListener(ar.REMOVE_CAMERA,this.removeCamera),this.app.addEventListener(ar.SET_OBJECT,this.onSetSelectedItem)}disable(){const t=this.containerRef.current;t.removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("click",this.onClick),window.removeEventListener("keydown",this.onKey),window.removeEventListener("resize",this.resize),this.app.removeEventListener(ar.SET_SCENE,this.sceneUpdate),this.app.removeEventListener(ar.ADD_CAMERA,this.addCamera),this.app.removeEventListener(ar.REMOVE_CAMERA,this.removeCamera),this.app.removeEventListener(ar.SET_OBJECT,this.onSetSelectedItem)}updateSelectedItemHelper(t){if(this.selectedItem!==void 0)if(this.cameraVisibility){if(this.selectedItem.isLight===!0&&!this.lightVisibility){const n=this.lightHelpers.get(this.selectedItem.name);n!==void 0&&(n.visible=t)}}else{const n=this.cameraHelpers.get(this.selectedItem.name);n!==void 0&&(n.visible=t)}}createControls(t,n){const r=this.controls.get(t.name);if(r!==void 0&&r.dispose(),this.controls.delete(t.name),t.name==="UI")return;const s=new Zht(t,n);switch(s.enableDamping=!0,s.dampingFactor=.05,t.name){case"Top":case"Bottom":case"Left":case"Right":case"Front":case"Back":s.enableRotate=!1;break}this.controls.set(t.name,s)}clearCamera(t){const n=this.cameraHelpers.get(t.name);n!==void 0&&(this.scene.remove(n),n.dispose(),this.cameraHelpers.delete(t.name));const r=this.controls.get(t.name);r!==void 0&&(r.dispose(),this.controls.delete(t.name))}killControls(){this.controls.forEach((t,n)=>{t.dispose();const r=this.cameraHelpers.get(n);r!==void 0&&(this.scene.remove(r),r.dispose()),this.cameraHelpers.delete(n),this.controls.delete(n)}),this.controls.clear(),this.cameraHelpers.clear()}assignControls(){switch(this.state.mode){case"Single":this.createControls(this.tlCam,this.tlWindow.current);break;case"Side by Side":case"Stacked":this.createControls(this.tlCam,this.tlWindow.current),this.createControls(this.trCam,this.trWindow.current);break;case"Quad":this.createControls(this.tlCam,this.tlWindow.current),this.createControls(this.trCam,this.trWindow.current),this.createControls(this.blCam,this.blWindow.current),this.createControls(this.brCam,this.brWindow.current);break}}saveExpandedCameraVisibility(){localStorage.setItem(this.expandedCameraVisibility,this.cameraVisibility?"open":"closed")}saveExpandedLightVisibility(){localStorage.setItem(this.expandedLightVisibility,this.lightVisibility?"open":"closed")}saveExpandedGridVisibility(){localStorage.setItem(this.expandedGridVisibility,this.gridVisibility?"open":"closed")}getSceneOverride(t){switch(t){case"Depth":return this.depthMaterial;case"Normals":return this.normalsMaterial;case"Renderer":return null;case"UVs":return this.uvMaterial;case"Wireframe":return this.wireframeMaterial}return null}drawTo(t,n,r,s,o,a){var c,u,f,m;switch(o.name){case"Left":case"Right":this.grid.rotation.z=Math.PI/2;break;case"Front":case"Back":this.grid.rotation.x=Math.PI/2;break}this.scene.overrideMaterial=a,this.renderer&&((c=this.renderer)==null||c.setViewport(t,n,r,s),(u=this.renderer)==null||u.setScissor(t,n,r,s),this.renderer instanceof IE?(f=this.renderer)==null||f.render(this.scene,o):this.renderer instanceof EQ&&((m=this.renderer)==null||m.renderAsync(this.scene,o))),this.grid.rotation.set(0,0,0)}drawSingle(){const t=this.getSceneOverride(this.tlRender);this.drawTo(0,0,this.width,this.height,this.tlCam,t)}get appID(){return this.props.three.app.appID}get mode(){return this.state.mode}get three(){return this.props.three}get expandedCameraVisibility(){return`${this.appID}_multiviewCameraVisibility`}get expandedLightVisibility(){return`${this.appID}_multiviewLightVisibility`}get expandedGridVisibility(){return`${this.appID}_multiviewGridVisibility`}};qe(vU,"instance",null);let Gl=vU;function SNe(i){const e=_n.useRef(null),[t,n]=_n.useState(!1),r=i.child!==void 0&&i.child.children.length>0,s=[];return i.child!==void 0&&i.child.children.length>0&&i.child.children.map((o,a)=>{s.push(We.jsx(SNe,{app:i.app,child:o,three:i.three},a))}),_n.useEffect(()=>{if(i.child){const o=i.three.getScene(i.child.uuid);if(o!==null){const a=o.getObjectByProperty("uuid",i.child.uuid);a!==void 0&&(e.current.style.opacity=a.visible?"1":"0.25")}}},[t]),We.jsx(We.Fragment,{children:i.child!==void 0&&We.jsxs("div",{className:"childObject",children:[We.jsxs("div",{className:"child",children:[r?We.jsx("button",{className:"status",style:{backgroundPositionX:t?"-14px":"2px"},onClick:()=>{n(!t)}}):null,We.jsx("button",{className:"name",style:{left:r?"20px":"5px"},onClick:()=>{i.child!==void 0&&(i.three.getObject(i.child.uuid),t||n(!0))},children:i.child.name.length>0?`${i.child.name} (${i.child.type})`:`${i.child.type}::${i.child.uuid}`}),We.jsx("button",{className:"visibility",ref:e,onClick:()=>{if(i.child){const o=i.three.getScene(i.child.uuid);if(o!==null){const a=o.getObjectByProperty("uuid",i.child.uuid);if(a!==void 0){const c="visible",u=!a.visible;e.current.style.opacity=u?"1":"0.25",i.three.updateObject(i.child.uuid,c,u),Lo(a,c,u)}}}}}),We.jsx("div",{className:`icon ${net(i.child)}`})]}),We.jsx("div",{className:t?"open":"",children:We.jsx("div",{className:"container",children:s})})]},Math.random())})}function Owe(i){var t;const e=[];return(t=i.child)==null||t.children.map((n,r)=>{e.push(We.jsx(SNe,{app:i.app,child:n,scene:i.scene,three:i.three},r))}),We.jsx("div",{className:`scene ${i.class!==void 0?i.class:""}`,children:e})}function Bwe(i){switch(i){case"fov":return"FOV";case"zoom":return"Zoom";case"near":return"Near";case"far":return"Far";case"focus":return"Focus";case"aspect":return"Aspect";case"filmGauge":return"Film Gauge";case"filmOffset":return"Film Offset";case"left":return"Left";case"right":return"Right";case"top":return"Top";case"bottom":return"Bottom"}return i}function Jdt(i,e,t){function n(){return`${t.app.appID}_camera`}const r=localStorage.getItem(n()),s=r!==null?r==="open":!1;function o(c){localStorage.setItem(n(),c?"open":"closed")}const a=[];if(i.perspectiveCameraInfo!==void 0)for(const c in i.perspectiveCameraInfo)a.push({title:Bwe(c),prop:c,type:"number",step:.01,value:i.perspectiveCameraInfo[c],onChange:(u,f)=>{t.updateObject(i.uuid,u,f),t.requestMethod(i.uuid,"updateProjectionMatrix");const m=t.getScene(i.uuid);if(m!==null){const v=m.getObjectByProperty("uuid",i.uuid);v!==void 0&&(Lo(v,u,f),v.updateProjectionMatrix())}}});else if(i.orthographicCameraInfo!==void 0)for(const c in i.orthographicCameraInfo)a.push({title:Bwe(c),prop:c,type:"number",step:.01,value:i.orthographicCameraInfo[c],onChange:(u,f)=>{t.updateObject(i.uuid,u,f),t.requestMethod(i.uuid,"updateProjectionMatrix");const m=t.getScene(i.uuid);if(m!==null){const v=m.getObjectByProperty("uuid",i.uuid);v!==void 0&&(Lo(v,u,f),v.updateProjectionMatrix())}}});return We.jsx(sh,{app:e,title:"Camera",items:a,expanded:s,onToggle:c=>{o(c)}})}function Lwe(i){switch(i){case"color":return"Color";case"intensity":return"Intensity";case"decay":return"Decay";case"distance":return"Distance";case"angle":return"Angle";case"penumbra":return"Penumbra";case"groundColor":return"Ground Color";case"width":return"Width";case"height":return"Height"}return i}function eft(i,e,t){function n(){return`${t.app.appID}_light`}const r=localStorage.getItem(n()),s=r!==null?r==="open":!1;function o(c){localStorage.setItem(n(),c?"open":"closed")}const a=[];if(i.lightInfo!==void 0)for(const c in i.lightInfo){const u=i.lightInfo[c];u!==void 0&&(u.isColor!==void 0?a.push({title:Lwe(c),prop:c,type:"color",value:u,onChange:(f,m)=>{const v=new yn(m);t.updateObject(i.uuid,f,v);const x=t.getScene(i.uuid);if(x!==null){const T=x.getObjectByProperty("uuid",i.uuid);Lo(T,f,v)}}}):a.push({title:Lwe(c),prop:c,type:typeof u,value:u,step:typeof u=="number"?.01:void 0,onChange:(f,m)=>{t.updateObject(i.uuid,f,m);const v=t.getScene(i.uuid);if(v!==null){const x=v.getObjectByProperty("uuid",i.uuid);Lo(x,f,m)}}}))}return We.jsx(sh,{app:e,title:"Light",items:a,expanded:s,onToggle:c=>{o(c)}})}function tft(i){var v;const e=i.object,t=i.three;function n(){return`${t.app.appID}_animation`}const r=localStorage.getItem(n()),s=r!==null?r==="open":!1;function o(x){localStorage.setItem(n(),x?"open":"closed")}const a=[],c=[];let u=0;e.animations.forEach(x=>{u=Math.max(u,x.duration),x.duration>0&&c.push({title:x.name,items:[{title:"Duration",type:"number",value:x.duration,disabled:!0},{title:"Blend Mode",type:"option",disabled:!0,options:[{title:"Normal",value:2500},{title:"Additive",value:2501}]}]})}),a.push({title:"Animations",items:c});let f;const m=t.getScene(e.uuid);if(m!==null){const x=m.getObjectByProperty("uuid",e.uuid);if(x!==void 0){const T=x.mixer;if(T!==void 0){const R=[{title:"Time Scale",type:"range",value:T.timeScale,step:.01,min:-1,max:2,onChange:(M,O)=>{T.timeScale=O,t.updateObject(e.uuid,"mixer.timeScale",O)}}];R.push({title:"Stop All",type:"button",onChange:()=>{T.stopAllAction(),t.requestMethod(e.uuid,"stopAllAction",void 0,"mixer")}}),a.push({title:"Mixer",items:R}),f=new aYe(x),(v=Gl.instance)==null||v.scene.add(f)}}}return _n.useEffect(()=>()=>{f!==void 0&&Td(f)},[]),We.jsx(sh,{app:i.app,title:"Animation",items:a,expanded:s,onToggle:x=>{o(x)}})}const Mte={name:"",uuid:"",type:"",visible:!1,matrix:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],animations:[],material:void 0,perspectiveCameraInfo:void 0,orthographicCameraInfo:void 0,lightInfo:void 0,children:[]};let dl={...Mte};function nft(i){const[e,t]=_n.useState(-1);_n.useEffect(()=>{function o(c){dl={...c.value},t(Date.now())}function a(){dl={...Mte},t(Date.now())}return i.app.addEventListener(ar.SET_SCENE,a),i.app.addEventListener(ar.SET_OBJECT,o),()=>{i.app.removeEventListener(ar.SET_SCENE,a),i.app.removeEventListener(ar.SET_OBJECT,o)}},[]);const n=dl.type.toLowerCase(),r=dl.animations.length>0||dl.mixer!==void 0,s=n.search("mesh")>-1||n.search("line")>-1||n.search("points")>-1;return We.jsx(iU,{app:i.app,label:"Inspector",button:dl.uuid.length>0?We.jsx("button",{className:"remove",onClick:()=>{zf.instance.remove(dl.name),dl={...Mte},t(Date.now())}}):void 0,children:We.jsx("div",{id:"Inspector",className:i.class,children:dl.uuid.length>0&&We.jsxs(We.Fragment,{children:[We.jsxs(We.Fragment,{children:[We.jsx(ZB,{type:"string",title:"Name",prop:"name",value:dl.name,disabled:!0}),We.jsx(ZB,{type:"string",title:"Type",prop:"type",value:dl.type,disabled:!0}),We.jsx(ZB,{type:"string",title:"UUID",prop:"uuid",value:dl.uuid,disabled:!0})]}),We.jsxs(We.Fragment,{children:[We.jsx(sU,{object:dl,app:i.app,three:i.three}),r?We.jsx(tft,{app:i.app,object:dl,three:i.three}):null,n.search("camera")>-1?Jdt(dl,i.app,i.three):null,n.search("light")>-1?eft(dl,i.app,i.three):null,s?kdt(dl,i.app,i.three):null]})]})},e)},"Inspector")}class rft extends _n.Component{constructor(t){super(t);qe(this,"app");qe(this,"autoClear",!0);qe(this,"autoClearColor",!0);qe(this,"autoClearDepth",!0);qe(this,"autoClearStencil",!0);qe(this,"outputColorSpace",Hr);qe(this,"localClippingEnabled",!1);qe(this,"clearColor",new yn(0));qe(this,"clearAlpha",1);qe(this,"toneMapping",Yl);qe(this,"toneMappingExposure",1);qe(this,"type","");qe(this,"onAddRenderer",t=>{const n=t.value;if(this.autoClear=n.autoClear,this.autoClearColor=n.autoClearColor,this.autoClearDepth=n.autoClearDepth,this.autoClearStencil=n.autoClearStencil,this.outputColorSpace=n.outputColorSpace,this.localClippingEnabled=n.localClippingEnabled,this.clearAlpha=n.clearAlpha,this.type=n.type,this.toneMapping=n.toneMapping,this.toneMappingExposure=n.toneMappingExposure,this.clearColor.setStyle(n.clearColor,_l),rr.enabled=n.colorManagement,Gl.instance){const r=Gl.instance.renderer;r&&(r.autoClear=this.autoClear,r.autoClearColor=this.autoClearColor,r.autoClearDepth=this.autoClearDepth,r.autoClearStencil=this.autoClearStencil,r.outputColorSpace=this.outputColorSpace,r.localClippingEnabled=this.localClippingEnabled,r.toneMapping=this.toneMapping,r.toneMappingExposure=this.toneMappingExposure,r.setClearColor(n.clearColor,this.clearAlpha))}this.setState({lastUpdated:Date.now()})});this.app=t.app;const n=localStorage.getItem(this.expandedName),r=n!==null?n==="open":!1;if(this.state={expanded:r,lastUpdated:Date.now()},this.saveExpanded(r),Gl.instance){const s=Gl.instance.renderer;s&&(this.autoClear=s.autoClear,this.autoClearColor=s.autoClearColor,this.autoClearDepth=s.autoClearDepth,this.autoClearStencil=s.autoClearStencil,this.clearAlpha=s.getClearAlpha(),this.toneMapping=s.toneMapping,this.toneMappingExposure=s.toneMappingExposure,s instanceof IE&&(this.localClippingEnabled=s.localClippingEnabled,s.getClearColor(this.clearColor)))}this.app.addEventListener(ar.ADD_RENDERER,this.onAddRenderer)}componentwillunmount(){this.app.removeEventListener(ar.ADD_RENDERER,this.onAddRenderer)}render(){const t=()=>{if(Gl.instance){const n=Gl.instance.renderer;n&&(n.autoClear=this.autoClear,n.autoClearColor=this.autoClearColor,n.autoClearDepth=this.autoClearDepth,n.autoClearStencil=this.autoClearStencil,n.outputColorSpace=this.outputColorSpace,n.localClippingEnabled=this.localClippingEnabled,n.toneMapping=this.toneMapping,n.toneMappingExposure=this.toneMappingExposure,n.setClearColor(this.clearColor.getStyle(),this.clearAlpha),this.props.three.updateRenderer({autoClear:this.autoClear,autoClearColor:this.autoClearColor,autoClearDepth:this.autoClearDepth,autoClearStencil:this.autoClearStencil,outputColorSpace:this.outputColorSpace,localClippingEnabled:this.localClippingEnabled,clearAlpha:this.clearAlpha,clearColor:this.clearColor.getStyle(),colorManagement:rr.enabled,toneMapping:this.toneMapping,toneMappingExposure:this.toneMappingExposure}))}};return We.jsx(sh,{app:this.app,title:"Renderer",expanded:this.state.expanded,items:[{type:"boolean",title:"Auto Clear",value:this.autoClear,onChange:(n,r)=>{this.autoClear=r}},{type:"boolean",title:"Auto Clear Color",value:this.autoClearColor,onChange:(n,r)=>{this.autoClearColor=r,t()}},{type:"boolean",title:"Auto Clear Depth",value:this.autoClearDepth,onChange:(n,r)=>{this.autoClearDepth=r,t()}},{type:"boolean",title:"Auto Clear Stencil",value:this.autoClearStencil,onChange:(n,r)=>{this.autoClearStencil=r,t()}},{type:"boolean",title:"Local Clipping",value:this.localClippingEnabled,onChange:(n,r)=>{this.localClippingEnabled=r,t()}},{type:"color",title:"Clear Color",value:`#${this.clearColor.getHexString()}`,onChange:(n,r)=>{this.clearColor.setStyle(r),t()}},{type:"range",title:"Clear Alpha",min:0,max:1,step:.01,value:this.clearAlpha,onChange:(n,r)=>{this.clearAlpha=r,t()}},{type:"boolean",title:"Clear Management",value:rr.enabled,onChange:(n,r)=>{rr.enabled=r,t()}},{type:"option",title:"Color Space",value:this.outputColorSpace,options:[{title:"No Color Space",value:Xa},{title:"SRB Color Space",value:Hr},{title:"Linear SRB Color Space",value:_l}],onChange:(n,r)=>{this.outputColorSpace=r,t()}},{type:"option",title:"Tone Mapping",value:this.toneMapping,options:[{title:"None ",value:Yl},{title:"Linear ",value:Hne},{title:"Reinhard",value:jne},{title:"Cineon ",value:Wne},{title:"ACES Filmic",value:qne},{title:"AgX",value:Xne},{title:"Neutral",value:Yne},{title:"Custom",value:jCe}],onChange:(n,r)=>{this.toneMapping=r,t()}},{type:"range",title:"Tone Mapping Exposure",value:this.toneMappingExposure,min:0,max:2,step:.01,onChange:(n,r)=>{this.toneMappingExposure=r,t()}},{type:"string",title:"Type",value:this.type,disabled:!0}],onToggle:n=>{this.setState({expanded:n}),this.saveExpanded(n)}},Math.random())}saveExpanded(t){localStorage.setItem(this.expandedName,t?"open":"closed")}get expandedName(){return`${this.props.three.app.appID}_renderer`}}function ift(i){const[e]=_n.useState([]),[t]=_n.useState([]),[n,r]=_n.useState(0),s=c=>{const u=c.value;e.push(u),t.push(We.jsx(iU,{app:i.app,label:`Scene: ${u.name}`,scene:u,open:!0,onRefresh:()=>{i.three.refreshScene(u.name)},children:We.jsx(Owe,{app:i.app,child:u,scene:u,three:i.three})},Math.random())),r(Date.now())},o=c=>{const u=c.value;for(let f=0;f<e.length;f++)if(u.uuid===e[f].uuid){e[f]=u,t[f]=We.jsx(iU,{app:i.app,label:`Scene: ${u.name}`,scene:u,open:!0,onRefresh:()=>{i.three.refreshScene(u.name)},children:We.jsx(Owe,{app:i.app,child:u,scene:u,three:i.three})},Math.random()),r(Date.now());return}},a=c=>{const u=c.value;for(let f=0;f<e.length;f++)if(u.uuid===e[f].uuid){e.splice(f,1),t.splice(f,1),r(Date.now());return}};return _n.useEffect(()=>(i.app.addEventListener(ar.ADD_SCENE,s),i.app.addEventListener(ar.REFRESH_SCENE,o),i.app.addEventListener(ar.REMOVE_SCENE,a),()=>{i.app.removeEventListener(ar.ADD_SCENE,s),i.app.removeEventListener(ar.REFRESH_SCENE,o),i.app.removeEventListener(ar.REMOVE_SCENE,a)}),[]),We.jsxs("div",{id:"SidePanel",children:[We.jsx("div",{className:"scenes",children:t},n),We.jsx(nft,{app:i.app,three:i.three}),We.jsx(rft,{app:i.app,three:i.three}),We.jsx(rx,{app:i.app,three:i.three})]})}function sft(i){return We.jsx(het,{children:We.jsxs(We.Fragment,{children:[We.jsx(Gl,{app:i.app,three:i.three,scenes:i.scenes,onSceneResize:i.onSceneResize,onSceneSet:i.onSceneSet,onSceneUpdate:i.onSceneUpdate}),We.jsx(ift,{app:i.app,three:i.three})]})})}/**
 * postprocessing v6.37.4 build Sat Jun 07 2025
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2025 Raoul van Rschen
 * @license Zlib
 */var LQ=1/1e3,oft=1e3,aft=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(i){typeof document<"u"&&document.hidden!==void 0&&(i?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=i)}get delta(){return this._delta*LQ}get fixedDelta(){return this._fixedDelta*LQ}set fixedDelta(i){this._fixedDelta=i*oft}get elapsed(){return this._elapsed*LQ}update(i){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(i!==void 0?i:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(i){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},lft=(()=>{const i=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),t=new Xi;return t.setAttribute("position",new Ra(i,3)),t.setAttribute("uv",new Ra(e,2)),t})(),om=class Cte{static get fullscreenGeometry(){return lft}constructor(e="Pass",t=new W1,n=new aC){this.name=e,this.renderer=null,this.scene=t,this.camera=n,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new dn(Cte.fullscreenGeometry,e),t.frustumCulled=!1,this.scene===null&&(this.scene=new W1),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=oC){}render(e,t,n,r,s){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,n){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof yc||t instanceof Ka||t instanceof Ao||t instanceof Cte)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},cft=class extends om{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(i,e,t,n,r){const s=i.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},uft=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,hft="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",wNe=class extends D0{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new uo(null),opacity:new uo(1)},blending:vl,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:uft,vertexShader:hft})}set inputBuffer(i){this.uniforms.inputBuffer.value=i}setInputBuffer(i){this.uniforms.inputBuffer.value=i}getOpacity(i){return this.uniforms.opacity.value}setOpacity(i){this.uniforms.opacity.value=i}},dft=class extends om{constructor(i,e=!0){super("CopyPass"),this.fullscreenMaterial=new wNe,this.needsSwap=!1,this.renderTarget=i,i===void 0&&(this.renderTarget=new yc(1,1,{minFilter:_s,magFilter:_s,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(i){this.autoResize=i}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(i){this.autoResize=i}render(i,e,t,n,r){this.fullscreenMaterial.inputBuffer=e.texture,i.setRenderTarget(this.renderToScreen?null:this.renderTarget),i.render(this.scene,this.camera)}setSize(i,e){this.autoResize&&this.renderTarget.setSize(i,e)}initialize(i,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==ps?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":i!==null&&i.outputColorSpace===Hr&&(this.renderTarget.texture.colorSpace=Hr))}},Uwe=new yn,TNe=class extends om{constructor(i=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=i,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(i,e,t){this.color=i,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(i){this.overrideClearColor=i}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(i){this.overrideClearAlpha=i}render(i,e,t,n,r){const s=this.overrideClearColor,o=this.overrideClearAlpha,a=i.getClearAlpha(),c=s!==null,u=o>=0;c?(i.getClearColor(Uwe),i.setClearColor(s,u?o:a)):u&&i.setClearAlpha(o),i.setRenderTarget(this.renderToScreen?null:e),i.clear(this.color,this.depth,this.stencil),c?i.setClearColor(Uwe,a):u&&i.setClearAlpha(a)}},fft=class extends om{constructor(i,e){super("MaskPass",i,e),this.needsSwap=!1,this.clearPass=new TNe(!1,!1,!0),this.inverse=!1}set mainScene(i){this.scene=i}set mainCamera(i){this.camera=i}get inverted(){return this.inverse}set inverted(i){this.inverse=i}get clear(){return this.clearPass.enabled}set clear(i){this.clearPass.enabled=i}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(i){this.inverted=i}render(i,e,t,n,r){const s=i.getContext(),o=i.state.buffers,a=this.scene,c=this.camera,u=this.clearPass,f=this.inverted?0:1,m=1-f;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.stencil.setFunc(s.ALWAYS,f,4294967295),o.stencil.setClear(m),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?u.render(i,null):(u.render(i,e),u.render(i,t))),this.renderToScreen?(i.setRenderTarget(null),i.render(a,c)):(i.setRenderTarget(e),i.render(a,c),i.setRenderTarget(t),i.render(a,c)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(s.EQUAL,1,4294967295),o.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.stencil.setLocked(!0)}},pft=class{constructor(i=null,{depthBuffer:e=!0,stencilBuffer:t=!1,multisampling:n=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,t,r,n),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new dft,this.depthTexture=null,this.passes=[],this.timer=new aft,this.autoRenderToScreen=!0,this.setRenderer(i)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(i){const e=this.inputBuffer,t=this.multisampling;t>0&&i>0?(this.inputBuffer.samples=i,this.outputBuffer.samples=i,this.inputBuffer.dispose(),this.outputBuffer.dispose()):t!==i&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,i),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(i){if(this.renderer=i,i!==null){const e=i.getSize(new mn),t=i.getContext().getContextAttributes().alpha,n=this.inputBuffer.texture.type;n===ps&&i.outputColorSpace===Hr&&(this.inputBuffer.texture.colorSpace=Hr,this.outputBuffer.texture.colorSpace=Hr,this.inputBuffer.dispose(),this.outputBuffer.dispose()),i.autoClear=!1,this.setSize(e.width,e.height);for(const r of this.passes)r.initialize(i,t,n)}}replaceRenderer(i,e=!0){const t=this.renderer,n=t.domElement.parentNode;return this.setRenderer(i),e&&n!==null&&(n.removeChild(t.domElement),n.appendChild(i.domElement)),t}createDepthTexture(){const i=this.depthTexture=new Jc;return this.inputBuffer.depthTexture=i,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(i.format=mc,i.type=pc):i.type=fs,i}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const i of this.passes)i.setDepthTexture(null)}}createBuffer(i,e,t,n){const r=this.renderer,s=r===null?new mn:r.getDrawingBufferSize(new mn),o={minFilter:_s,magFilter:_s,stencilBuffer:e,depthBuffer:i,type:t},a=new yc(s.width,s.height,o);return n>0&&(a.ignoreDepthForMultisampleCopy=!1,a.samples=n),t===ps&&r!==null&&r.outputColorSpace===Hr&&(a.texture.colorSpace=Hr),a.texture.name="EffectComposer.Buffer",a.texture.generateMipmaps=!1,a}setMainScene(i){for(const e of this.passes)e.mainScene=i}setMainCamera(i){for(const e of this.passes)e.mainCamera=i}addPass(i,e){const t=this.passes,n=this.renderer,r=n.getDrawingBufferSize(new mn),s=n.getContext().getContextAttributes().alpha,o=this.inputBuffer.texture.type;if(i.setRenderer(n),i.setSize(r.width,r.height),i.initialize(n,s,o),this.autoRenderToScreen&&(t.length>0&&(t[t.length-1].renderToScreen=!1),i.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?t.splice(e,0,i):t.push(i),this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!0),i.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const a=this.createDepthTexture();for(i of t)i.setDepthTexture(a)}else i.setDepthTexture(this.depthTexture)}removePass(i){const e=this.passes,t=e.indexOf(i);if(t!==-1&&e.splice(t,1).length>0){if(this.depthTexture!==null){const s=(a,c)=>a||c.needsDepthTexture;e.reduce(s,!1)||(i.getDepthTexture()===this.depthTexture&&i.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&t===e.length&&(i.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const i=this.passes;this.deleteDepthTexture(),i.length>0&&(this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!1),this.passes=[])}render(i){const e=this.renderer,t=this.copyPass;let n=this.inputBuffer,r=this.outputBuffer,s=!1,o,a,c;i===void 0&&(this.timer.update(),i=this.timer.getDelta());for(const u of this.passes)u.enabled&&(u.render(e,n,r,i,s),u.needsSwap&&(s&&(t.renderToScreen=u.renderToScreen,o=e.getContext(),a=e.state.buffers.stencil,a.setFunc(o.NOTEQUAL,1,4294967295),t.render(e,n,r,i,s),a.setFunc(o.EQUAL,1,4294967295)),c=n,n=r,r=c),u instanceof fft?s=!0:u instanceof cft&&(s=!1))}setSize(i,e,t){const n=this.renderer,r=n.getSize(new mn);(i===void 0||e===void 0)&&(i=r.width,e=r.height),(r.width!==i||r.height!==e)&&n.setSize(i,e,t);const s=n.getDrawingBufferSize(new mn);this.inputBuffer.setSize(s.width,s.height),this.outputBuffer.setSize(s.width,s.height);for(const o of this.passes)o.setSize(s.width,s.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const i of this.passes)i.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),om.fullscreenGeometry.dispose()}},o4={NONE:0,DEPTH:1,CONVOLUTION:2},Oi={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},mft=class{constructor(){this.shaderParts=new Map([[Oi.FRAGMENT_HEAD,null],[Oi.FRAGMENT_MAIN_UV,null],[Oi.FRAGMENT_MAIN_IMAGE,null],[Oi.VERTEX_HEAD,null],[Oi.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=o4.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=_l}},UQ=!1,zwe=class{constructor(i=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(i),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Co:t=this.materialsFlatShadedDoubleSide;break;case Ui:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Co:t=this.materialsDoubleSide;break;case Ui:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(i){if(!(i instanceof D0))return i.clone();const e=i.uniforms,t=new Map;for(const r in e){const s=e[r].value;s.isRenderTargetTexture&&(e[r].value=null,t.set(r,s))}const n=i.clone();for(const r of t)e[r[0]].value=r[1],n.uniforms[r[0]].value=r[1];return n}setMaterial(i){if(this.disposeMaterials(),this.material=i,i!==null){const e=this.materials=[this.cloneMaterial(i),this.cloneMaterial(i),this.cloneMaterial(i)];for(const t of e)t.uniforms=Object.assign({},i.uniforms),t.side=Xl;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},i.uniforms),n.side=Ui,n}),this.materialsDoubleSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},i.uniforms),n.side=Co,n}),this.materialsFlatShaded=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},i.uniforms),n.flatShading=!0,n}),this.materialsFlatShadedBackSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},i.uniforms),n.flatShading=!0,n.side=Ui,n}),this.materialsFlatShadedDoubleSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},i.uniforms),n.flatShading=!0,n.side=Co,n})}}render(i,e,t){const n=i.shadowMap.enabled;if(i.shadowMap.enabled=!1,UQ){const r=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),i.render(e,t);for(const s of r)s[0].material=s[1];this.meshCount!==r.size&&r.clear()}else{const r=e.overrideMaterial;e.overrideMaterial=this.material,i.render(e,t),e.overrideMaterial=r}i.shadowMap.enabled=n}disposeMaterials(){if(this.material!==null){const i=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of i)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return UQ}static set workaroundEnabled(i){UQ=i}},i2=-1,C1=class extends e0{constructor(i,e=i2,t=i2,n=1){super(),this.resizable=i,this.baseSize=new mn(1,1),this.preferredSize=new mn(e,t),this.target=this.preferredSize,this.s=n,this.effectiveSize=new mn,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const i=this.baseSize,e=this.preferredSize,t=this.effectiveSize,n=this.scale;e.width!==i2?t.width=e.width:e.height!==i2?t.width=Math.round(e.height*(i.width/Math.max(i.height,1))):t.width=Math.round(i.width*n),e.height!==i2?t.height=e.height:e.width!==i2?t.height=Math.round(e.width/Math.max(i.width/Math.max(i.height,1),1)):t.height=Math.round(i.height*n)}get width(){return this.effectiveSize.width}set width(i){this.preferredWidth=i}get height(){return this.effectiveSize.height}set height(i){this.preferredHeight=i}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(i){this.s!==i&&(this.s=i,this.preferredSize.setScalar(i2),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(i){this.scale=i}get baseWidth(){return this.baseSize.width}set baseWidth(i){this.baseSize.width!==i&&(this.baseSize.width=i,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(i){this.baseWidth=i}get baseHeight(){return this.baseSize.height}set baseHeight(i){this.baseSize.height!==i&&(this.baseSize.height=i,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(i){this.baseHeight=i}setBaseSize(i,e){(this.baseSize.width!==i||this.baseSize.height!==e)&&(this.baseSize.set(i,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(i){this.preferredSize.width!==i&&(this.preferredSize.width=i,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(i){this.preferredWidth=i}get preferredHeight(){return this.preferredSize.height}set preferredHeight(i){this.preferredSize.height!==i&&(this.preferredSize.height=i,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(i){this.preferredHeight=i}setPreferredSize(i,e){(this.preferredSize.width!==i||this.preferredSize.height!==e)&&(this.preferredSize.set(i,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(i){this.s=i.scale,this.baseSize.set(i.baseWidth,i.baseHeight),this.preferredSize.set(i.preferredWidth,i.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return i2}},hi={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},gft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",yft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",vft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",_ft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",xft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",bft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",Sft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",wft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",Tft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",Eft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",Mft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",Cft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",Aft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",Rft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",Pft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",Nft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",Ift="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",kft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",Dft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",Fft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Oft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",Bft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",Lft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",Uft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",zft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",Vft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",Gft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",$ft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",Hft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",jft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",Wft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",qft="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",Xft=new Map([[hi.ADD,gft],[hi.ALPHA,yft],[hi.AVERAGE,vft],[hi.COLOR,_ft],[hi.COLOR_BURN,xft],[hi.COLOR_DODGE,bft],[hi.DARKEN,Sft],[hi.DIFFERENCE,wft],[hi.DIVIDE,Tft],[hi.DST,null],[hi.EXCLUSION,Eft],[hi.HARD_LIGHT,Mft],[hi.HARD_MIX,Cft],[hi.HUE,Aft],[hi.INVERT,Rft],[hi.INVERT_RGB,Pft],[hi.LIGHTEN,Nft],[hi.LINEAR_BURN,Ift],[hi.LINEAR_DODGE,kft],[hi.LINEAR_LIGHT,Dft],[hi.LUMINOSITY,Fft],[hi.MULTIPLY,Oft],[hi.NEGATION,Bft],[hi.NORMAL,Lft],[hi.OVERLAY,Uft],[hi.PIN_LIGHT,zft],[hi.REFLECT,Vft],[hi.SATURATION,Gft],[hi.SCREEN,$ft],[hi.SOFT_LIGHT,Hft],[hi.SRC,jft],[hi.SUBTRACT,Wft],[hi.VIVID_LIGHT,qft]]),Yft=class extends e0{constructor(i,e=1){super(),this._blendFunction=i,this.opacity=new uo(e)}getOpacity(){return this.opacity.value}setOpacity(i){this.opacity.value=i}get blendFunction(){return this._blendFunction}set blendFunction(i){this._blendFunction=i,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(i){this.blendFunction=i}getShaderCode(){return Xft.get(this.blendFunction)}},pz=class extends e0{constructor(i,e,{attributes:t=o4.NONE,blendFunction:n=hi.NORMAL,defines:r=new Map,uniforms:s=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=i,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=a,this.defines=r,this.uniforms=s,this.extensions=o,this.blendMode=new Yft(n),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=_l,this._outputColorSpace=Xa}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(i){this._inputColorSpace=i,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(i){this._outputColorSpace=i,this.setChanged()}set mainScene(i){}set mainCamera(i){}getName(){return this.name}setRenderer(i){this.renderer=i}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(i){this.attributes=i,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(i){this.fragmentShader=i,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(i){this.vertexShader=i,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(i,e=oC){}update(i,e,t){}setSize(i,e){}initialize(i,e,t){}dispose(){for(const i of Object.keys(this)){const e=this[i];(e instanceof yc||e instanceof Ka||e instanceof Ao||e instanceof om)&&this[i].dispose()}}},mC={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},Kft=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Zft="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Qft=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],ENe=class extends D0{constructor(i=new ir){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new uo(null),texelSize:new uo(new ir),scale:new uo(1),kernel:new uo(0)},blending:vl,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Kft,vertexShader:Zft}),this.setTexelSize(i.x,i.y),this.kernelSize=mC.MEDIUM}set inputBuffer(i){this.uniforms.inputBuffer.value=i}setInputBuffer(i){this.inputBuffer=i}get kernelSequence(){return Qft[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(i){this.uniforms.scale.value=i}getScale(){return this.uniforms.scale.value}setScale(i){this.uniforms.scale.value=i}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(i){this.uniforms.kernel.value=i}setKernel(i){this.kernel=i}setTexelSize(i,e){this.uniforms.texelSize.value.set(i,e,i*.5,e*.5)}setSize(i,e){const t=1/i,n=1/e;this.uniforms.texelSize.value.set(t,n,t*.5,n*.5)}},Jft=class extends om{constructor({kernelSize:i=mC.MEDIUM,resolutionScale:e=.5,width:t=C1.AUTO_SIZE,height:n=C1.AUTO_SIZE,resolutionX:r=t,resolutionY:s=n}={}){super("KawaseBlurPass"),this.renderTargetA=new yc(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new C1(this,r,s,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new ENe,this._blurMaterial.kernelSize=i,this.copyMaterial=new wNe}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(i){this._blurMaterial=i}get dithering(){return this.copyMaterial.dithering}set dithering(i){this.copyMaterial.dithering=i}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(i){this.blurMaterial.kernelSize=i}get width(){return this.resolution.width}set width(i){this.resolution.preferredWidth=i}get height(){return this.resolution.height}set height(i){this.resolution.preferredHeight=i}get scale(){return this.blurMaterial.scale}set scale(i){this.blurMaterial.scale=i}getScale(){return this.blurMaterial.scale}setScale(i){this.blurMaterial.scale=i}getKernelSize(){return this.kernelSize}setKernelSize(i){this.kernelSize=i}getResolutionScale(){return this.resolution.scale}setResolutionScale(i){this.resolution.scale=i}render(i,e,t,n,r){const s=this.scene,o=this.camera,a=this.renderTargetA,c=this.renderTargetB,u=this.blurMaterial,f=u.kernelSequence;let m=e;this.fullscreenMaterial=u;for(let v=0,x=f.length;v<x;++v){const T=v&1?c:a;u.kernel=f[v],u.inputBuffer=m.texture,i.setRenderTarget(T),i.render(s,o),m=T}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=m.texture,i.setRenderTarget(this.renderToScreen?null:t),i.render(s,o)}setSize(i,e){const t=this.resolution;t.setBaseSize(i,e);const n=t.width,r=t.height;this.renderTargetA.setSize(n,r),this.renderTargetB.setSize(n,r),this.blurMaterial.setSize(i,e)}initialize(i,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==ps?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):i!==null&&i.outputColorSpace===Hr&&(this.renderTargetA.texture.colorSpace=Hr,this.renderTargetB.texture.colorSpace=Hr))}static get AUTO_SIZE(){return C1.AUTO_SIZE}},ept=`#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))
#define ONE_OVER_TWELVE 0.08333333333333333
varying vec2 vUvDown;varying vec2 vUvUp;varying vec2 vUvLeft;varying vec2 vUvRight;varying vec2 vUvDownLeft;varying vec2 vUvUpRight;varying vec2 vUvUpLeft;varying vec2 vUvDownRight;vec4 fxaa(const in vec4 inputColor,const in vec2 uv){float lumaCenter=luminance(inputColor.rgb);float lumaDown=luminance(texture2D(inputBuffer,vUvDown).rgb);float lumaUp=luminance(texture2D(inputBuffer,vUvUp).rgb);float lumaLeft=luminance(texture2D(inputBuffer,vUvLeft).rgb);float lumaRight=luminance(texture2D(inputBuffer,vUvRight).rgb);float lumaMin=min(lumaCenter,min(min(lumaDown,lumaUp),min(lumaLeft,lumaRight)));float lumaMax=max(lumaCenter,max(max(lumaDown,lumaUp),max(lumaLeft,lumaRight)));float lumaRange=lumaMax-lumaMin;if(lumaRange<max(EDGE_THRESHOLD_MIN,lumaMax*EDGE_THRESHOLD_MAX)){return inputColor;}float lumaDownLeft=luminance(texture2D(inputBuffer,vUvDownLeft).rgb);float lumaUpRight=luminance(texture2D(inputBuffer,vUvUpRight).rgb);float lumaUpLeft=luminance(texture2D(inputBuffer,vUvUpLeft).rgb);float lumaDownRight=luminance(texture2D(inputBuffer,vUvDownRight).rgb);float lumaDownUp=lumaDown+lumaUp;float lumaLeftRight=lumaLeft+lumaRight;float lumaLeftCorners=lumaDownLeft+lumaUpLeft;float lumaDownCorners=lumaDownLeft+lumaDownRight;float lumaRightCorners=lumaDownRight+lumaUpRight;float lumaUpCorners=lumaUpRight+lumaUpLeft;float edgeHorizontal=(abs(-2.0*lumaLeft+lumaLeftCorners)+abs(-2.0*lumaCenter+lumaDownUp)*2.0+abs(-2.0*lumaRight+lumaRightCorners));float edgeVertical=(abs(-2.0*lumaUp+lumaUpCorners)+abs(-2.0*lumaCenter+lumaLeftRight)*2.0+abs(-2.0*lumaDown+lumaDownCorners));bool isHorizontal=(edgeHorizontal>=edgeVertical);float stepLength=isHorizontal?texelSize.y:texelSize.x;float luma1=isHorizontal?lumaDown:lumaLeft;float luma2=isHorizontal?lumaUp:lumaRight;float gradient1=abs(luma1-lumaCenter);float gradient2=abs(luma2-lumaCenter);bool is1Steepest=gradient1>=gradient2;float gradientScaled=0.25*max(gradient1,gradient2);float lumaLocalAverage=0.0;if(is1Steepest){stepLength=-stepLength;lumaLocalAverage=0.5*(luma1+lumaCenter);}else{lumaLocalAverage=0.5*(luma2+lumaCenter);}vec2 currentUv=uv;if(isHorizontal){currentUv.y+=stepLength*0.5;}else{currentUv.x+=stepLength*0.5;}vec2 offset=isHorizontal?vec2(texelSize.x,0.0):vec2(0.0,texelSize.y);vec2 uv1=currentUv-offset*QUALITY(0);vec2 uv2=currentUv+offset*QUALITY(0);float lumaEnd1=luminance(texture2D(inputBuffer,uv1).rgb);float lumaEnd2=luminance(texture2D(inputBuffer,uv2).rgb);lumaEnd1-=lumaLocalAverage;lumaEnd2-=lumaLocalAverage;bool reached1=abs(lumaEnd1)>=gradientScaled;bool reached2=abs(lumaEnd2)>=gradientScaled;bool reachedBoth=reached1&&reached2;if(!reached1){uv1-=offset*QUALITY(1);}if(!reached2){uv2+=offset*QUALITY(1);}if(!reachedBoth){for(int i=2;i<SAMPLES;++i){if(!reached1){lumaEnd1=luminance(texture2D(inputBuffer,uv1).rgb);lumaEnd1=lumaEnd1-lumaLocalAverage;}if(!reached2){lumaEnd2=luminance(texture2D(inputBuffer,uv2).rgb);lumaEnd2=lumaEnd2-lumaLocalAverage;}reached1=abs(lumaEnd1)>=gradientScaled;reached2=abs(lumaEnd2)>=gradientScaled;reachedBoth=reached1&&reached2;if(!reached1){uv1-=offset*QUALITY(i);}if(!reached2){uv2+=offset*QUALITY(i);}if(reachedBoth){break;}}}float distance1=isHorizontal?(uv.x-uv1.x):(uv.y-uv1.y);float distance2=isHorizontal?(uv2.x-uv.x):(uv2.y-uv.y);bool isDirection1=distance1<distance2;float distanceFinal=min(distance1,distance2);float edgeThickness=(distance1+distance2);bool isLumaCenterSmaller=lumaCenter<lumaLocalAverage;bool correctVariation1=(lumaEnd1<0.0)!=isLumaCenterSmaller;bool correctVariation2=(lumaEnd2<0.0)!=isLumaCenterSmaller;bool correctVariation=isDirection1?correctVariation1:correctVariation2;float pixelOffset=-distanceFinal/edgeThickness+0.5;float finalOffset=correctVariation?pixelOffset:0.0;float lumaAverage=ONE_OVER_TWELVE*(2.0*(lumaDownUp+lumaLeftRight)+lumaLeftCorners+lumaRightCorners);float subPixelOffset1=clamp(abs(lumaAverage-lumaCenter)/lumaRange,0.0,1.0);float subPixelOffset2=(-2.0*subPixelOffset1+3.0)*subPixelOffset1*subPixelOffset1;float subPixelOffsetFinal=subPixelOffset2*subPixelOffset2*SUBPIXEL_QUALITY;finalOffset=max(finalOffset,subPixelOffsetFinal);vec2 finalUv=uv;if(isHorizontal){finalUv.y+=finalOffset*stepLength;}else{finalUv.x+=finalOffset*stepLength;}return texture2D(inputBuffer,finalUv);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=fxaa(inputColor,uv);}`,tpt="varying vec2 vUvDown;varying vec2 vUvUp;varying vec2 vUvLeft;varying vec2 vUvRight;varying vec2 vUvDownLeft;varying vec2 vUvUpRight;varying vec2 vUvUpLeft;varying vec2 vUvDownRight;void mainSupport(const in vec2 uv){vUvDown=uv+vec2(0.0,-1.0)*texelSize;vUvUp=uv+vec2(0.0,1.0)*texelSize;vUvRight=uv+vec2(1.0,0.0)*texelSize;vUvLeft=uv+vec2(-1.0,0.0)*texelSize;vUvDownLeft=uv+vec2(-1.0,-1.0)*texelSize;vUvUpRight=uv+vec2(1.0,1.0)*texelSize;vUvUpLeft=uv+vec2(-1.0,1.0)*texelSize;vUvDownRight=uv+vec2(1.0,-1.0)*texelSize;}",npt=class extends pz{constructor({blendFunction:i=hi.SRC}={}){super("FXAAEffect",ept,{vertexShader:tpt,blendFunction:i,defines:new Map([["EDGE_THRESHOLD_MIN","0.0312"],["EDGE_THRESHOLD_MAX","0.125"],["SUBPIXEL_QUALITY","0.75"],["SAMPLES","12"]])})}get minEdgeThreshold(){return Number(this.defines.get("EDGE_THRESHOLD_MIN"))}set minEdgeThreshold(i){this.defines.set("EDGE_THRESHOLD_MIN",i.toFixed(12)),this.setChanged()}get maxEdgeThreshold(){return Number(this.defines.get("EDGE_THRESHOLD_MAX"))}set maxEdgeThreshold(i){this.defines.set("EDGE_THRESHOLD_MAX",i.toFixed(12)),this.setChanged()}get subpixelQuality(){return Number(this.defines.get("SUBPIXEL_QUALITY"))}set subpixelQuality(i){this.defines.set("SUBPIXEL_QUALITY",i.toFixed(12)),this.setChanged()}get samples(){return Number(this.defines.get("SAMPLES"))}set samples(i){this.defines.set("SAMPLES",i.toFixed(0)),this.setChanged()}},rpt=class extends om{constructor(i,e,t=null){super("RenderPass",i,e),this.needsSwap=!1,this.clearPass=new TNe,this.overrideMaterialManager=t===null?null:new zwe(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(i){this.scene=i}set mainCamera(i){this.camera=i}get renderToScreen(){return super.renderToScreen}set renderToScreen(i){super.renderToScreen=i,this.clearPass.renderToScreen=i}get overrideMaterial(){const i=this.overrideMaterialManager;return i!==null?i.material:null}set overrideMaterial(i){const e=this.overrideMaterialManager;i!==null?e!==null?e.setMaterial(i):this.overrideMaterialManager=new zwe(i):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(i){this.overrideMaterial=i}get clear(){return this.clearPass.enabled}set clear(i){this.clearPass.enabled=i}getSelection(){return this.selection}setSelection(i){this.selection=i}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(i){this.ignoreBackground=i}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(i){this.skipShadowMapUpdate=i}getClearPass(){return this.clearPass}render(i,e,t,n,r){const s=this.scene,o=this.camera,a=this.selection,c=o.layers.mask,u=s.background,f=i.shadowMap.autoUpdate,m=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(i.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(i,e),i.setRenderTarget(m),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(i,s,o):i.render(s,o),o.layers.mask=c,s.background=u,i.shadowMap.autoUpdate=f}},BT={DEFAULT:0,ESKIL:1},ipt=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*(1.0+time)));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,spt=class extends pz{constructor({blendFunction:i=hi.SCREEN,premultiply:e=!1}={}){super("NoiseEffect",ipt,{blendFunction:i}),this.premultiply=e}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(i){this.premultiply!==i&&(i?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(i){this.premultiply=i}},opt=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,apt="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",lpt=class extends ENe{constructor({kernelSize:i=mC.MEDIUM,offset:e=0,rotation:t=0,focusArea:n=.4,feather:r=.3}={}){super(),this.fragmentShader=opt,this.vertexShader=apt,this.kernelSize=i,this.uniforms.aspect=new uo(1),this.uniforms.rotation=new uo(new mn),this.uniforms.maskParams=new uo(new ir),this._offset=e,this._focusArea=n,this._feather=r,this.rotation=t,this.updateParams()}updateParams(){const i=this.uniforms.maskParams.value,e=Math.max(this.focusArea,0),t=Math.max(e-this.feather,0);i.set(this.offset-e,this.offset-t,this.offset+e,this.offset+t)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(i){this.uniforms.rotation.value.set(Math.cos(i),Math.sin(i))}get offset(){return this._offset}set offset(i){this._offset=i,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(i){this._focusArea=i,this.updateParams()}get feather(){return this._feather}set feather(i){this._feather=i,this.updateParams()}setSize(i,e){super.setSize(i,e),this.uniforms.aspect.value=i/e}},cpt=class extends Jft{constructor({offset:i=0,rotation:e=0,focusArea:t=.4,feather:n=.3,kernelSize:r=mC.MEDIUM,resolutionScale:s=.5,resolutionX:o=C1.AUTO_SIZE,resolutionY:a=C1.AUTO_SIZE}={}){super({kernelSize:r,resolutionScale:s,resolutionX:o,resolutionY:a}),this.blurMaterial=new lpt({kernelSize:r,offset:i,rotation:e,focusArea:t,feather:n})}},upt=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}`,hpt="uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",dpt=class extends pz{constructor({blendFunction:i,offset:e=0,rotation:t=0,focusArea:n=.4,feather:r=.3,kernelSize:s=mC.MEDIUM,resolutionScale:o=.5,resolutionX:a=C1.AUTO_SIZE,resolutionY:c=C1.AUTO_SIZE}={}){super("TiltShiftEffect",upt,{vertexShader:hpt,blendFunction:i,uniforms:new Map([["rotation",new uo(new mn)],["maskParams",new uo(new mn)],["map",new uo(null)]])}),this._offset=e,this._focusArea=n,this._feather=r,this.renderTarget=new yc(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new cpt({kernelSize:s,resolutionScale:o,resolutionX:a,resolutionY:c,offset:e,rotation:t,focusArea:n,feather:r});const u=this.resolution=new C1(this,a,c,o);u.addEventListener("change",f=>this.setSize(u.baseWidth,u.baseHeight)),this.rotation=t,this.updateParams()}updateParams(){const i=this.uniforms.get("maskParams").value,e=Math.max(this.focusArea-this.feather,0);i.set(this.offset-e,this.offset+e)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(i){this.uniforms.get("rotation").value.set(Math.cos(i),Math.sin(i)),this.blurPass.blurMaterial.rotation=i}get offset(){return this._offset}set offset(i){this._offset=i,this.blurPass.blurMaterial.offset=i,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(i){this._focusArea=i,this.blurPass.blurMaterial.focusArea=i,this.updateParams()}get feather(){return this._feather}set feather(i){this._feather=i,this.blurPass.blurMaterial.feather=i,this.updateParams()}get bias(){return 0}set bias(i){}update(i,e,t){this.blurPass.render(i,e,this.renderTarget)}setSize(i,e){const t=this.resolution;t.setBaseSize(i,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t)}initialize(i,e,t){this.blurPass.initialize(i,e,t),t!==void 0&&(this.renderTarget.texture.type=t,i!==null&&i.outputColorSpace===Hr&&(this.renderTarget.texture.colorSpace=Hr))}},fpt=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,ppt=class extends pz{constructor({blendFunction:i,eskil:e=!1,technique:t=e?BT.ESKIL:BT.DEFAULT,offset:n=.5,darkness:r=.5}={}){super("VignetteEffect",fpt,{blendFunction:i,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new uo(n)],["darkness",new uo(r)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(i){this.technique!==i&&(this.defines.set("VIGNETTE_TECHNIQUE",i.toFixed(0)),this.setChanged())}get eskil(){return this.technique===BT.ESKIL}set eskil(i){this.technique=i?BT.ESKIL:BT.DEFAULT}getTechnique(){return this.technique}setTechnique(i){this.technique=i}get offset(){return this.uniforms.get("offset").value}set offset(i){this.uniforms.get("offset").value=i}getOffset(){return this.offset}setOffset(i){this.offset=i}get darkness(){return this.uniforms.get("darkness").value}set darkness(i){this.uniforms.get("darkness").value=i}getDarkness(){return this.darkness}setDarkness(i){this.darkness=i}},mpt=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,gpt="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",ypt=class extends D0{constructor(i,e,t,n,r=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:fx.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new uo(null),depthBuffer:new uo(null),resolution:new uo(new mn),texelSize:new uo(new mn),cameraNear:new uo(.3),cameraFar:new uo(1e3),aspect:new uo(1),time:new uo(0)},blending:vl,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:r}),i&&this.setShaderParts(i),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(n)}set inputBuffer(i){this.uniforms.inputBuffer.value=i}setInputBuffer(i){this.uniforms.inputBuffer.value=i}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(i){this.uniforms.depthBuffer.value=i}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(i){this.defines.DEPTH_PACKING=i.toFixed(0),this.needsUpdate=!0}setDepthBuffer(i,e=oC){this.depthBuffer=i,this.depthPacking=e}setShaderData(i){this.setShaderParts(i.shaderParts),this.setDefines(i.defines),this.setUniforms(i.uniforms),this.setExtensions(i.extensions)}setShaderParts(i){return this.fragmentShader=mpt.replace(Oi.FRAGMENT_HEAD,i.get(Oi.FRAGMENT_HEAD)||"").replace(Oi.FRAGMENT_MAIN_UV,i.get(Oi.FRAGMENT_MAIN_UV)||"").replace(Oi.FRAGMENT_MAIN_IMAGE,i.get(Oi.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=gpt.replace(Oi.VERTEX_HEAD,i.get(Oi.VERTEX_HEAD)||"").replace(Oi.VERTEX_MAIN_SUPPORT,i.get(Oi.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(i){for(const e of i.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(i){for(const e of i.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(i){this.extensions={};for(const e of i)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(i){this.encodeOutput!==i&&(i?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(i){return this.encodeOutput}setOutputEncodingEnabled(i){this.encodeOutput=i}get time(){return this.uniforms.time.value}set time(i){this.uniforms.time.value=i}setDeltaTime(i){this.uniforms.time.value+=i}adoptCameraSettings(i){this.copyCameraSettings(i)}copyCameraSettings(i){i&&(this.uniforms.cameraNear.value=i.near,this.uniforms.cameraFar.value=i.far,i instanceof po?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(i,e){const t=this.uniforms;t.resolution.value.set(i,e),t.texelSize.value.set(1/i,1/e),t.aspect.value=i/e}static get Section(){return Oi}};function Vwe(i,e,t){for(const n of e){const r="$1"+i+n.charAt(0).toUpperCase()+n.slice(1),s=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(s,r))}}function vpt(i,e,t){let n=e.getFragmentShader(),r=e.getVertexShader();const s=n!==void 0&&/mainImage/.test(n),o=n!==void 0&&/mainUv/.test(n);if(t.attributes|=e.getAttributes(),n===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&t.attributes&o4.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!s&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=t.shaderParts;let u=c.get(Oi.FRAGMENT_HEAD)||"",f=c.get(Oi.FRAGMENT_MAIN_UV)||"",m=c.get(Oi.FRAGMENT_MAIN_IMAGE)||"",v=c.get(Oi.VERTEX_HEAD)||"",x=c.get(Oi.VERTEX_MAIN_SUPPORT)||"";const T=new Set,P=new Set;if(o&&(f+=`	${i}MainUv(UV);
`,t.uvTransformation=!0),r!==null&&/mainSupport/.test(r)){const O=/mainSupport *\([\w\s]*?uv\s*?\)/.test(r);x+=`	${i}MainSupport(`,x+=O?`vUv);
`:`);
`;for(const C of r.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const L of C[1].split(/\s*,\s*/))t.varyings.add(L),T.add(L),P.add(L);for(const C of r.matchAll(a))P.add(C[1])}for(const O of n.matchAll(a))P.add(O[1]);for(const O of e.defines.keys())P.add(O.replace(/\([\w\s,]*\)/g,""));for(const O of e.uniforms.keys())P.add(O);P.delete("while"),P.delete("for"),P.delete("if"),e.uniforms.forEach((O,C)=>t.uniforms.set(i+C.charAt(0).toUpperCase()+C.slice(1),O)),e.defines.forEach((O,C)=>t.defines.set(i+C.charAt(0).toUpperCase()+C.slice(1),O));const R=new Map([["fragment",n],["vertex",r]]);Vwe(i,P,t.defines),Vwe(i,P,R),n=R.get("fragment"),r=R.get("vertex");const M=e.blendMode;if(t.blendModes.set(M.blendFunction,M),s){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(m+=e.inputColorSpace===Hr?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==Xa?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const O=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;m+=`${i}MainImage(color0, UV, `,t.attributes&o4.DEPTH&&O.test(n)&&(m+="depth, ",t.readDepth=!0),m+=`color1);
	`;const C=i+"BlendOpacity";t.uniforms.set(C,M.opacity),m+=`color0 = blend${M.blendFunction}(color0, color1, ${C});

	`,u+=`uniform float ${C};

`}if(u+=n+`
`,r!==null&&(v+=r+`
`),c.set(Oi.FRAGMENT_HEAD,u),c.set(Oi.FRAGMENT_MAIN_UV,f),c.set(Oi.FRAGMENT_MAIN_IMAGE,m),c.set(Oi.VERTEX_HEAD,v),c.set(Oi.VERTEX_MAIN_SUPPORT,x),e.extensions!==null)for(const O of e.extensions)t.extensions.add(O)}}var zQ=class extends om{constructor(i,...e){super("EffectPass"),this.fullscreenMaterial=new ypt(null,null,null,i),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(i){for(const e of this.effects)e.mainScene=i}set mainCamera(i){this.fullscreenMaterial.copyCameraSettings(i);for(const e of this.effects)e.mainCamera=i}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(i){this.fullscreenMaterial.encodeOutput=i}get dithering(){return this.fullscreenMaterial.dithering}set dithering(i){const e=this.fullscreenMaterial;e.dithering=i,e.needsUpdate=!0}setEffects(i){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=i.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const i=new mft;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===hi.DST)i.attributes|=o.getAttributes()&o4.DEPTH;else{if(i.attributes&o.getAttributes()&o4.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);vpt("e"+e++,o,i)}let t=i.shaderParts.get(Oi.FRAGMENT_HEAD),n=i.shaderParts.get(Oi.FRAGMENT_MAIN_IMAGE),r=i.shaderParts.get(Oi.FRAGMENT_MAIN_UV);const s=/\bblend\b/g;for(const o of i.blendModes.values())t+=o.getShaderCode().replace(s,`blend${o.blendFunction}`)+`
`;i.attributes&o4.DEPTH?(i.readDepth&&(n=`float depth = readDepth(UV);

	`+n),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,i.colorSpace===Hr&&(n+=`color0 = sRGBToLinear(color0);
	`),i.uvTransformation?(r=`vec2 transformedUv = vUv;
`+r,i.defines.set("UV","transformedUv")):i.defines.set("UV","vUv"),i.shaderParts.set(Oi.FRAGMENT_HEAD,t),i.shaderParts.set(Oi.FRAGMENT_MAIN_IMAGE,n),i.shaderParts.set(Oi.FRAGMENT_MAIN_UV,r);for(const[o,a]of i.shaderParts)a!==null&&i.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(i)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(i,e=oC){this.fullscreenMaterial.depthBuffer=i,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(i,e)}render(i,e,t,n,r){for(const s of this.effects)s.update(i,e,n);if(!this.skipRendering||this.renderToScreen){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,s.time+=n*this.timeScale,i.setRenderTarget(this.renderToScreen?null:t),i.render(this.scene,this.camera)}}setSize(i,e){this.fullscreenMaterial.setSize(i,e);for(const t of this.effects)t.setSize(i,e)}initialize(i,e,t){this.renderer=i;for(const n of this.effects)n.initialize(i,e,t);this.updateMaterial(),t!==void 0&&t!==ps&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const i of this.effects)i.removeEventListener("change",this.listener),i.dispose()}handleEvent(i){switch(i.type){case"change":this.recompile();break}}};const _pt=`varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,xpt=`struct Light {
  float intensity;
  vec3 position;
  vec3 color;
};

uniform float time;
uniform float opacity;
uniform vec2 resolution;
uniform vec3 diffuse;
uniform vec3 mouse;
uniform sampler2D map;
uniform Light light;
uniform Light lights[3];
varying vec2 vUv;

#define MIN_ALPHA 2.0 / 255.0

void main() {
  if (opacity < MIN_ALPHA) discard;
  vec2 imageUV = vUv * 10.0;
  vec3 image = texture2D(map, imageUV).rgb;
  vec3 col = image * diffuse;
  col += (sin(time * 0.1) * 0.5 + 0.5) * 0.2;
  col += vec3(resolution, 0.0);
  col += mouse;
  gl_FragColor = vec4(col, opacity);
}`,bpt="data:image/png;base64,R0lGODlhCAAIAIAAAP///wAAACH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDEgNzkuMTQ2Mjg5OTc3NywgMjAyMy8wNi8yNS0yMzo1NzoxNCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI1LjIgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NjVENjQyODM4QTYzMTFFRUJFQTBFOTJFNjA1OTQ5N0YiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NjVENjQyODQ4QTYzMTFFRUJFQTBFOTJFNjA1OTQ5N0YiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo2NUQ2NDI4MThBNjMxMUVFQkVBMEU5MkU2MDU5NDk3RiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo2NUQ2NDI4MjhBNjMxMUVFQkVBMEU5MkU2MDU5NDk3RiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACH5BAAAAAAALAAAAAAIAAgAAAIOjH8AprzRkHyspqSoNAUAOw==";class MNe extends D0{constructor(){super({vertexShader:_pt,fragmentShader:xpt,name:"ExampleScene/SimpleShader",transparent:!0,uniforms:{diffuse:{value:new yn(16777215)},opacity:{value:1},time:{value:0},map:{value:null},resolution:{value:new mn},mouse:{value:new be},v4:{value:new ir},euler:{value:new Mo},testM3:{value:new Or},testM4:{value:new Vn},light:{value:{position:new mn(5,10),intensity:1,color:new yn(16711935)}},lights:{value:[{position:new mn(1,1),intensity:1,color:new yn(16711680)},{position:new mn(2,2),intensity:2,color:new yn(65280)},{position:new mn(3,3),intensity:3,color:new yn(255)}]}}}),Mre(bpt).then(e=>{this.uniforms.map.value=e})}update(e){this.uniforms.opacity.value=this.opacity,this.uniforms.time.value+=e}}function Spt(i){const e=new Map,t=new Map,n=i.clone();return CNe(i,n,function(r,s){e.set(s,r),t.set(r,s)}),n.traverse(function(r){if(!r.isSkinnedMesh)return;const s=r,o=e.get(r),a=o.skeleton.bones;s.skeleton=o.skeleton.clone(),s.bindMatrix.copy(o.bindMatrix),s.skeleton.bones=a.map(function(c){return t.get(c)}),s.bind(s.skeleton,s.bindMatrix)}),n}function CNe(i,e,t){t(i,e);for(let n=0;n<i.children.length;n++)CNe(i.children[n],e.children[n],t)}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var ju=Uint8Array,j6=Uint16Array,wpt=Int32Array,ANe=new ju([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),RNe=new ju([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Tpt=new ju([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),PNe=function(i,e){for(var t=new j6(31),n=0;n<31;++n)t[n]=e+=1<<i[n-1];for(var r=new wpt(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)r[s]=s-t[n]<<5|n;return{b:t,r}},NNe=PNe(ANe,2),INe=NNe.b,Ept=NNe.r;INe[28]=258,Ept[258]=28;var Mpt=PNe(RNe,0),Cpt=Mpt.b,Ate=new j6(32768);for(var Gs=0;Gs<32768;++Gs){var s2=(Gs&43690)>>1|(Gs&21845)<<1;s2=(s2&52428)>>2|(s2&13107)<<2,s2=(s2&61680)>>4|(s2&3855)<<4,Ate[Gs]=((s2&65280)>>8|(s2&255)<<8)>>1}var VE=function(i,e,t){for(var n=i.length,r=0,s=new j6(e);r<n;++r)i[r]&&++s[i[r]-1];var o=new j6(e);for(r=1;r<e;++r)o[r]=o[r-1]+s[r-1]<<1;var a;if(t){a=new j6(1<<e);var c=15-e;for(r=0;r<n;++r)if(i[r])for(var u=r<<4|i[r],f=e-i[r],m=o[i[r]-1]++<<f,v=m|(1<<f)-1;m<=v;++m)a[Ate[m]>>c]=u}else for(a=new j6(n),r=0;r<n;++r)i[r]&&(a[r]=Ate[o[i[r]-1]++]>>15-i[r]);return a},gC=new ju(288);for(var Gs=0;Gs<144;++Gs)gC[Gs]=8;for(var Gs=144;Gs<256;++Gs)gC[Gs]=9;for(var Gs=256;Gs<280;++Gs)gC[Gs]=7;for(var Gs=280;Gs<288;++Gs)gC[Gs]=8;var kNe=new ju(32);for(var Gs=0;Gs<32;++Gs)kNe[Gs]=5;var Apt=VE(gC,9,1),Rpt=VE(kNe,5,1),VQ=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},ed=function(i,e,t){var n=e/8|0;return(i[n]|i[n+1]<<8)>>(e&7)&t},GQ=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(e&7)},Ppt=function(i){return(i+7)/8|0},Npt=function(i,e,t){return(e==null||e<0)&&(e=0),(t==null||t>i.length)&&(t=i.length),new ju(i.subarray(e,t))},Ipt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ad=function(i,e,t){var n=new Error(e||Ipt[i]);if(n.code=i,Error.captureStackTrace&&Error.captureStackTrace(n,ad),!t)throw n;return n},kpt=function(i,e,t,n){var r=i.length,s=n?n.length:0;if(!r||e.f&&!e.l)return t||new ju(0);var o=!t,a=o||e.i!=2,c=e.i;o&&(t=new ju(r*3));var u=function(Kr){var wi=t.length;if(Kr>wi){var Zr=new ju(Math.max(wi*2,Kr));Zr.set(t),t=Zr}},f=e.f||0,m=e.p||0,v=e.b||0,x=e.l,T=e.d,P=e.m,R=e.n,M=r*8;do{if(!x){f=ed(i,m,1);var O=ed(i,m+1,3);if(m+=3,O)if(O==1)x=Apt,T=Rpt,P=9,R=5;else if(O==2){var J=ed(i,m,31)+257,z=ed(i,m+10,15)+4,ne=J+ed(i,m+5,31)+1;m+=14;for(var K=new ju(ne),$=new ju(19),he=0;he<z;++he)$[Tpt[he]]=ed(i,m+he*3,7);m+=z*3;for(var Ce=VQ($),Pe=(1<<Ce)-1,je=VE($,Ce,1),he=0;he<ne;){var ge=je[ed(i,m,Pe)];m+=ge&15;var C=ge>>4;if(C<16)K[he++]=C;else{var Xe=0,Fe=0;for(C==16?(Fe=3+ed(i,m,3),m+=2,Xe=K[he-1]):C==17?(Fe=3+ed(i,m,7),m+=3):C==18&&(Fe=11+ed(i,m,127),m+=7);Fe--;)K[he++]=Xe}}var Ne=K.subarray(0,J),tt=K.subarray(J);P=VQ(Ne),R=VQ(tt),x=VE(Ne,P,1),T=VE(tt,R,1)}else ad(1);else{var C=Ppt(m)+4,L=i[C-4]|i[C-3]<<8,Y=C+L;if(Y>r){c&&ad(0);break}a&&u(v+L),t.set(i.subarray(C,Y),v),e.b=v+=L,e.p=m=Y*8,e.f=f;continue}if(m>M){c&&ad(0);break}}a&&u(v+131072);for(var mt=(1<<P)-1,Ht=(1<<R)-1,pn=m;;pn=m){var Xe=x[GQ(i,m)&mt],In=Xe>>4;if(m+=Xe&15,m>M){c&&ad(0);break}if(Xe||ad(2),In<256)t[v++]=In;else if(In==256){pn=m,x=null;break}else{var vt=In-254;if(In>264){var he=In-257,Ut=ANe[he];vt=ed(i,m,(1<<Ut)-1)+INe[he],m+=Ut}var Sn=T[GQ(i,m)&Ht],ln=Sn>>4;Sn||ad(3),m+=Sn&15;var tt=Cpt[ln];if(ln>3){var Ut=RNe[ln];tt+=GQ(i,m)&(1<<Ut)-1,m+=Ut}if(m>M){c&&ad(0);break}a&&u(v+131072);var Xn=v+vt;if(v<tt){var Yr=s-tt,lr=Math.min(tt,Xn);for(Yr+v<0&&ad(3);v<lr;++v)t[v]=n[Yr+v]}for(;v<Xn;++v)t[v]=t[v-tt]}}e.l=x,e.p=pn,e.b=v,e.f=f,x&&(f=1,e.m=P,e.d=T,e.n=R)}while(!f);return v!=t.length&&o?Npt(t,0,v):t.subarray(0,v)},Dpt=new ju(0),Fpt=function(i,e){return((i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31)&&ad(6,"invalid zlib data"),(i[1]>>5&1)==+!e&&ad(6,"invalid zlib data: "+(i[1]&32?"need":"unexpected")+" dictionary"),(i[1]>>3&4)+2};function Opt(i,e){return kpt(i.subarray(Fpt(i,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}var Bpt=typeof TextDecoder<"u"&&new TextDecoder,Lpt=0;try{Bpt.decode(Dpt,{stream:!0}),Lpt=1}catch{}function DNe(i,e,t){const n=t.length-i-1;if(e>=t[n])return n-1;if(e<=t[i])return i;let r=i,s=n,o=Math.floor((r+s)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?s=o:r=o,o=Math.floor((r+s)/2);return o}function Upt(i,e,t,n){const r=[],s=[],o=[];r[0]=1;for(let a=1;a<=t;++a){s[a]=e-n[i+1-a],o[a]=n[i+a]-e;let c=0;for(let u=0;u<a;++u){const f=o[u+1],m=s[a-u],v=r[u]/(f+m);r[u]=c+f*v,c=m*v}r[a]=c}return r}function zpt(i,e,t,n){const r=DNe(i,n,e),s=Upt(r,n,i,e),o=new ir(0,0,0,0);for(let a=0;a<=i;++a){const c=t[r-i+a],u=s[a],f=c.w*u;o.x+=c.x*f,o.y+=c.y*f,o.z+=c.z*f,o.w+=c.w*u}return o}function Vpt(i,e,t,n,r){const s=[];for(let m=0;m<=t;++m)s[m]=0;const o=[];for(let m=0;m<=n;++m)o[m]=s.slice(0);const a=[];for(let m=0;m<=t;++m)a[m]=s.slice(0);a[0][0]=1;const c=s.slice(0),u=s.slice(0);for(let m=1;m<=t;++m){c[m]=e-r[i+1-m],u[m]=r[i+m]-e;let v=0;for(let x=0;x<m;++x){const T=u[x+1],P=c[m-x];a[m][x]=T+P;const R=a[x][m-1]/a[m][x];a[x][m]=v+T*R,v=P*R}a[m][m]=v}for(let m=0;m<=t;++m)o[0][m]=a[m][t];for(let m=0;m<=t;++m){let v=0,x=1;const T=[];for(let P=0;P<=t;++P)T[P]=s.slice(0);T[0][0]=1;for(let P=1;P<=n;++P){let R=0;const M=m-P,O=t-P;m>=P&&(T[x][0]=T[v][0]/a[O+1][M],R=T[x][0]*a[M][O]);const C=M>=-1?1:-M,L=m-1<=O?P-1:t-m;for(let J=C;J<=L;++J)T[x][J]=(T[v][J]-T[v][J-1])/a[O+1][M+J],R+=T[x][J]*a[M+J][O];m<=O&&(T[x][P]=-T[v][P-1]/a[O+1][m],R+=T[x][P]*a[m][O]),o[P][m]=R;const Y=v;v=x,x=Y}}let f=t;for(let m=1;m<=n;++m){for(let v=0;v<=t;++v)o[m][v]*=f;f*=t-m}return o}function Gpt(i,e,t,n,r){const s=r<i?r:i,o=[],a=DNe(i,n,e),c=Vpt(a,n,i,s,e),u=[];for(let f=0;f<t.length;++f){const m=t[f].clone(),v=m.w;m.x*=v,m.y*=v,m.z*=v,u[f]=m}for(let f=0;f<=s;++f){const m=u[a-i].clone().multiplyScalar(c[f][0]);for(let v=1;v<=i;++v)m.add(u[a-i+v].clone().multiplyScalar(c[f][v]));o[f]=m}for(let f=s+1;f<=r+1;++f)o[f]=new ir(0,0,0);return o}function $pt(i,e){let t=1;for(let r=2;r<=i;++r)t*=r;let n=1;for(let r=2;r<=e;++r)n*=r;for(let r=2;r<=i-e;++r)n*=r;return t/n}function Hpt(i){const e=i.length,t=[],n=[];for(let s=0;s<e;++s){const o=i[s];t[s]=new be(o.x,o.y,o.z),n[s]=o.w}const r=[];for(let s=0;s<e;++s){const o=t[s].clone();for(let a=1;a<=s;++a)o.sub(r[s-a].clone().multiplyScalar($pt(s,a)*n[a]));r[s]=o.divideScalar(n[0])}return r}function jpt(i,e,t,n,r){const s=Gpt(i,e,t,n,r);return Hpt(s)}class Wpt extends uAe{constructor(e,t,n,r,s){super();const o=t?t.length-1:0,a=n?n.length:0;this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=s||o;for(let c=0;c<a;++c){const u=n[c];this.controlPoints[c]=new ir(u.x,u.y,u.z,u.w)}}getPoint(e,t=new be){const n=t,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=zpt(this.degree,this.knots,this.controlPoints,r);return s.w!==1&&s.divideScalar(s.w),n.set(s.x,s.y,s.z)}getTangent(e,t=new be){const n=t,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=jpt(this.degree,this.knots,this.controlPoints,r,1);return n.copy(s[1]).normalize(),n}toJSON(){const e=super.toJSON();return e.degree=this.degree,e.knots=[...this.knots],e.controlPoints=this.controlPoints.map(t=>t.toArray()),e.startKnot=this.startKnot,e.endKnot=this.endKnot,e}fromJSON(e){return super.fromJSON(e),this.degree=e.degree,this.knots=[...e.knots],this.controlPoints=e.controlPoints.map(t=>new ir(t[0],t[1],t[2],t[3])),this.startKnot=e.startKnot,this.endKnot=e.endKnot,this}}let ai,Bo,w0;class qpt extends $2{constructor(e){super(e)}load(e,t,n,r){const s=this,o=s.path===""?jXe.extractUrlBase(e):s.path,a=new LXe(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(c){try{t(s.parse(c,o))}catch(u){r?r(u):console.error(u),s.manager.itemError(e)}},n,r)}parse(e,t){if(Jpt(e))ai=new Qpt().parse(e);else{const r=BNe(e);if(!e1t(r))throw new Error("THREE.FBXLoader: Unknown format.");if($we(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+$we(r));ai=new Zpt().parse(r)}const n=new TAe(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Xpt(n,this.manager).parse(ai)}}class Xpt{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Bo=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),s=new Ypt().parse(r);return this.parseScene(r,s,n),w0}parseConnections(){const e=new Map;return"Connections"in ai&&ai.Connections.connections.forEach(function(n){const r=n[0],s=n[1],o=n[2];e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:s,relationship:o};e.get(r).parents.push(a),e.has(s)||e.set(s,{parents:[],children:[]});const c={ID:r,relationship:o};e.get(s).children.push(c)}),e}parseImages(){const e={},t={};if("Video"in ai.Objects){const n=ai.Objects.Video;for(const r in n){const s=n[r],o=parseInt(r);if(e[o]=s.RelativeFilename||s.Filename,"Content"in s){const a=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,c=typeof s.Content=="string"&&s.Content!=="";if(a||c){const u=this.parseImage(n[r]);t[s.RelativeFilename||s.Filename]=u}}}}for(const n in e){const r=e[n];t[r]!==void 0?e[n]=t[r]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let s;switch(r){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),s="image/tga";break;case"webp":s="image/webp";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof t=="string")return"data:"+s+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in ai.Objects){const n=ai.Objects.Texture;for(const r in n){const s=this.parseTexture(n[r],e);t.set(parseInt(r),s)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const r=e.WrapModeU,s=e.WrapModeV,o=r!==void 0?r.value:0,a=s!==void 0?s.value:0;if(n.wrapS=o===0?tu:ta,n.wrapT=a===0?tu:ta,"Scaling"in e){const c=e.Scaling.value;n.repeat.x=c[0],n.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;n.offset.x=c[0],n.offset.y=c[1]}return n}loadTexture(e,t){const n=e.FileName.split(".").pop().toLowerCase();let r=this.manager.getHandler(`.${n}`);r===null&&(r=this.textureLoader);const s=r.path;s||r.setPath(this.textureLoader.path);const o=Bo.get(e.id).children;let a;if(o!==void 0&&o.length>0&&t[o[0].ID]!==void 0&&(a=t[o[0].ID],(a.indexOf("blob:")===0||a.indexOf("data:")===0)&&r.setPath(void 0)),a===void 0)return console.warn("FBXLoader: Undefined filename, creating placeholder texture."),new Ao;const c=r.load(a);return r.setPath(s),c}parseMaterials(e){const t=new Map;if("Material"in ai.Objects){const n=ai.Objects.Material;for(const r in n){const s=this.parseMaterial(n[r],e);s!==null&&t.set(parseInt(r),s)}}return t}parseMaterial(e,t){const n=e.id,r=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!Bo.has(n))return null;const o=this.parseParameters(e,t,n);let a;switch(s.toLowerCase()){case"phong":a=new Yy;break;case"lambert":a=new vAe;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new Yy;break}return a.setValues(o),a.name=r,a}parseParameters(e,t,n){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=rr.colorSpaceToWorking(new yn().fromArray(e.Diffuse.value),Hr):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(r.color=rr.colorSpaceToWorking(new yn().fromArray(e.DiffuseColor.value),Hr)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=rr.colorSpaceToWorking(new yn().fromArray(e.Emissive.value),Hr):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(r.emissive=rr.colorSpaceToWorking(new yn().fromArray(e.EmissiveColor.value),Hr)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),r.opacity=1-(e.TransparencyFactor?parseFloat(e.TransparencyFactor.value):0),(r.opacity===1||r.opacity===0)&&(r.opacity=e.Opacity?parseFloat(e.Opacity.value):null,r.opacity===null&&(r.opacity=1-(e.TransparentColor?parseFloat(e.TransparentColor.value[0]):0))),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=rr.colorSpaceToWorking(new yn().fromArray(e.Specular.value),Hr):e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=rr.colorSpaceToWorking(new yn().fromArray(e.SpecularColor.value),Hr));const s=this;return Bo.get(n).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":r.bumpMap=s.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":r.aoMap=s.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=s.getTexture(t,o.ID),r.map!==void 0&&(r.map.colorSpace=Hr);break;case"DisplacementColor":r.displacementMap=s.getTexture(t,o.ID);break;case"EmissiveColor":r.emissiveMap=s.getTexture(t,o.ID),r.emissiveMap!==void 0&&(r.emissiveMap.colorSpace=Hr);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=s.getTexture(t,o.ID);break;case"ReflectionColor":r.envMap=s.getTexture(t,o.ID),r.envMap!==void 0&&(r.envMap.mapping=v4,r.envMap.colorSpace=Hr);break;case"SpecularColor":r.specularMap=s.getTexture(t,o.ID),r.specularMap!==void 0&&(r.specularMap.colorSpace=Hr);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=s.getTexture(t,o.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),r}getTexture(e,t){return"LayeredTexture"in ai.Objects&&t in ai.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Bo.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in ai.Objects){const n=ai.Objects.Deformer;for(const r in n){const s=n[r],o=Bo.get(parseInt(r));if(s.attrType==="Skin"){const a=this.parseSkeleton(o,n);a.ID=r,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[r]=a}else if(s.attrType==="BlendShape"){const a={id:r};a.rawTargets=this.parseMorphTargets(o,n),a.id=r,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(r){const s=t[r.ID];if(s.attrType!=="Cluster")return;const o={ID:r.ID,indices:[],weights:[],transformLink:new Vn().fromArray(s.TransformLink.a)};"Indexes"in s&&(o.indices=s.Indexes.a,o.weights=s.Weights.a),n.push(o)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let r=0;r<e.children.length;r++){const s=e.children[r],o=t[s.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=Bo.get(parseInt(s.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,n.push(a)}return n}parseScene(e,t,n){w0=new qy;const r=this.parseModels(e.skeletons,t,n),s=ai.Objects.Model,o=this;r.forEach(function(c){const u=s[c.ID];o.setLookAtProperties(c,u),Bo.get(c.ID).parents.forEach(function(m){const v=r.get(m.ID);v!==void 0&&v.add(c)}),c.parent===null&&w0.add(c)}),this.bindSkeleton(e.skeletons,t,r),this.addGlobalSceneSettings(),w0.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const u=ONe(c.userData.transformData);c.applyMatrix4(u),c.updateWorldMatrix()}});const a=new Kpt().parse();w0.children.length===1&&w0.children[0].isGroup&&(w0.children[0].animations=a,w0=w0.children[0]),w0.animations=a}parseModels(e,t,n){const r=new Map,s=ai.Objects.Model;for(const o in s){const a=parseInt(o),c=s[o],u=Bo.get(a);let f=this.buildSkeleton(u,e,a,c.attrName);if(!f){switch(c.attrType){case"Camera":f=this.createCamera(u);break;case"Light":f=this.createLight(u);break;case"Mesh":f=this.createMesh(u,t,n);break;case"NurbsCurve":f=this.createCurve(u,t);break;case"LimbNode":case"Root":f=new kee;break;case"Null":default:f=new qy;break}f.name=c.attrName?Ai.sanitizeNodeName(c.attrName):"",f.userData.originalName=c.attrName,f.ID=a}this.getTransformData(f,c),r.set(a,f)}return r}buildSkeleton(e,t,n,r){let s=null;return e.parents.forEach(function(o){for(const a in t){const c=t[a];c.rawBones.forEach(function(u,f){if(u.ID===o.ID){const m=s;s=new kee,s.matrixWorld.copy(u.transformLink),s.name=r?Ai.sanitizeNodeName(r):"",s.userData.originalName=r,s.ID=n,c.bones[f]=s,m!==null&&s.add(m)}})}}),s}createCamera(e){let t,n;if(e.children.forEach(function(r){const s=ai.Objects.NodeAttribute[r.ID];s!==void 0&&(n=s)}),n===void 0)t=new gi;else{let r=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(r=1);let s=1;n.NearPlane!==void 0&&(s=n.NearPlane.value/1e3);let o=1e3;n.FarPlane!==void 0&&(o=n.FarPlane.value/1e3);let a=window.innerWidth,c=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(a=n.AspectWidth.value,c=n.AspectHeight.value);const u=a/c;let f=45;n.FieldOfView!==void 0&&(f=n.FieldOfView.value);const m=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new po(f,u,s,o),m!==null&&t.setFocalLength(m);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),t=new gi;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new gi;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(r){const s=ai.Objects.NodeAttribute[r.ID];s!==void 0&&(n=s)}),n===void 0)t=new gi;else{let r;n.LightType===void 0?r=0:r=n.LightType.value;let s=16777215;n.Color!==void 0&&(s=rr.colorSpaceToWorking(new yn().fromArray(n.Color.value),Hr));let o=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(o=0);let a=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?a=0:a=n.FarAttenuationEnd.value);const c=1;switch(r){case 0:t=new Lee(s,o,a,c);break;case 1:t=new qU(s,o);break;case 2:let u=Math.PI/3;n.InnerAngle!==void 0&&(u=ml.degToRad(n.InnerAngle.value));let f=0;n.OuterAngle!==void 0&&(f=ml.degToRad(n.OuterAngle.value),f=Math.max(f,1)),t=new Sx(s,o,a,u,f,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new Lee(s,o);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let r,s=null,o=null;const a=[];if(e.children.forEach(function(c){t.has(c.ID)&&(s=t.get(c.ID)),n.has(c.ID)&&a.push(n.get(c.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new Yy({name:$2.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(o)),"color"in s.attributes&&a.forEach(function(c){c.vertexColors=!0}),s.groups.length>0){let c=!1;for(let u=0,f=s.groups.length;u<f;u++){const m=s.groups[u];(m.materialIndex<0||m.materialIndex>=a.length)&&(m.materialIndex=a.length,c=!0)}if(c){const u=new Yy;a.push(u)}}return s.FBX_Deformer?(r=new dre(s,o),r.normalizeSkinWeights()):r=new dn(s,o),r}createCurve(e,t){const n=e.children.reduce(function(s,o){return t.has(o.ID)&&(s=t.get(o.ID)),s},null),r=new su({name:$2.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new rc(n,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=LM(t.RotationOrder.value):n.eulerOrder=LM(0),"Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&Bo.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const s=ai.Objects.Model[r.ID];if("Lcl_Translation"in s){const o=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),w0.add(e.target)):e.lookAt(new be().fromArray(o))}}})}bindSkeleton(e,t,n){const r=this.parsePoseNodes();for(const s in e){const o=e[s];Bo.get(parseInt(o.ID)).parents.forEach(function(c){if(t.has(c.ID)){const u=c.ID;Bo.get(u).parents.forEach(function(m){n.has(m.ID)&&n.get(m.ID).bind(new fre(o.bones),r[m.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in ai.Objects){const t=ai.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const r=t[n].PoseNode;Array.isArray(r)?r.forEach(function(s){e[s.Node]=new Vn().fromArray(s.Matrix.a)}):e[r.Node]=new Vn().fromArray(r.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in ai){if("AmbientColor"in ai.GlobalSettings){const e=ai.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(t!==0||n!==0||r!==0){const s=new yn().setRGB(t,n,r,Hr);w0.add(new MAe(s,1))}}"UnitScaleFactor"in ai.GlobalSettings&&(w0.userData.unitScaleFactor=ai.GlobalSettings.UnitScaleFactor.value)}}}class Ypt{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in ai.Objects){const n=ai.Objects.Geometry;for(const r in n){const s=Bo.get(parseInt(r)),o=this.parseGeometry(s,n[r],e);t.set(parseInt(r),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const r=n.skeletons,s=[],o=e.parents.map(function(m){return ai.Objects.Model[m.ID]});if(o.length===0)return;const a=e.children.reduce(function(m,v){return r[v.ID]!==void 0&&(m=r[v.ID]),m},null);e.children.forEach(function(m){n.morphTargets[m.ID]!==void 0&&s.push(n.morphTargets[m.ID])});const c=o[0],u={};"RotationOrder"in c&&(u.eulerOrder=LM(c.RotationOrder.value)),"InheritType"in c&&(u.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(u.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(u.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(u.scale=c.GeometricScaling.value);const f=ONe(u);return this.genGeometry(t,a,s,f)}genGeometry(e,t,n,r){const s=new Xi;e.attrName&&(s.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),c=new br(a.vertex,3);if(c.applyMatrix4(r),s.setAttribute("position",c),a.colors.length>0&&s.setAttribute("color",new br(a.colors,3)),t&&(s.setAttribute("skinIndex",new $U(a.weightsIndices,4)),s.setAttribute("skinWeight",new br(a.vertexWeights,4)),s.FBX_Deformer=t),a.normal.length>0){const u=new Or().getNormalMatrix(r),f=new br(a.normal,3);f.applyNormalMatrix(u),s.setAttribute("normal",f)}if(a.uvs.forEach(function(u,f){const m=f===0?"uv":`uv${f}`;s.setAttribute(m,new br(a.uvs[f],2))}),o.material&&o.material.mappingType!=="AllSame"){let u=a.materialIndex[0],f=0;if(a.materialIndex.forEach(function(m,v){m!==u&&(s.addGroup(f,v-f,u),u=m,f=v)}),s.groups.length>0){const m=s.groups[s.groups.length-1],v=m.start+m.count;v!==a.materialIndex.length&&s.addGroup(v,a.materialIndex.length-v,u)}s.groups.length===0&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,e,n,r),s}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(r,s){r.indices.forEach(function(o,a){n.weightTable[o]===void 0&&(n.weightTable[o]=[]),n.weightTable[o].push({id:s,weight:r.weights[a]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,s=!1,o=[],a=[],c=[],u=[],f=[],m=[];const v=this;return e.vertexIndices.forEach(function(x,T){let P,R=!1;x<0&&(x=x^-1,R=!0);let M=[],O=[];if(o.push(x*3,x*3+1,x*3+2),e.color){const C=aB(T,n,x,e.color);c.push(C[0],C[1],C[2])}if(e.skeleton){if(e.weightTable[x]!==void 0&&e.weightTable[x].forEach(function(C){O.push(C.weight),M.push(C.id)}),O.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const C=[0,0,0,0],L=[0,0,0,0];O.forEach(function(Y,J){let z=Y,ne=M[J];L.forEach(function(K,$,he){if(z>K){he[$]=z,z=K;const Ce=C[$];C[$]=ne,ne=Ce}})}),M=C,O=L}for(;O.length<4;)O.push(0),M.push(0);for(let C=0;C<4;++C)f.push(O[C]),m.push(M[C])}if(e.normal){const C=aB(T,n,x,e.normal);a.push(C[0],C[1],C[2])}e.material&&e.material.mappingType!=="AllSame"&&(P=aB(T,n,x,e.material)[0],P<0&&(v.negativeMaterialIndices=!0,P=0)),e.uv&&e.uv.forEach(function(C,L){const Y=aB(T,n,x,C);u[L]===void 0&&(u[L]=[]),u[L].push(Y[0]),u[L].push(Y[1])}),r++,R&&(v.genFace(t,e,o,P,a,c,u,f,m,r),n++,r=0,o=[],a=[],c=[],u=[],f=[],m=[])}),t}getNormalNewell(e){const t=new be(0,0,0);for(let n=0;n<e.length;n++){const r=e[n],s=e[(n+1)%e.length];t.x+=(r.y-s.y)*(r.z+s.z),t.y+=(r.z-s.z)*(r.x+s.x),t.z+=(r.x-s.x)*(r.y+s.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),r=(Math.abs(t.z)>.5?new be(0,1,0):new be(0,0,1)).cross(t).normalize(),s=t.clone().cross(r).normalize();return{normal:t,tangent:r,bitangent:s}}flattenVertex(e,t,n){return new mn(e.dot(t),e.dot(n))}genFace(e,t,n,r,s,o,a,c,u,f){let m;if(f>3){const v=[],x=t.baseVertexPositions||t.vertexPositions;for(let M=0;M<n.length;M+=3)v.push(new be(x[n[M]],x[n[M+1]],x[n[M+2]]));const{tangent:T,bitangent:P}=this.getNormalTangentAndBitangent(v),R=[];for(const M of v)R.push(this.flattenVertex(M,T,P));m=yre.triangulateShape(R,[])}else m=[[0,1,2]];for(const[v,x,T]of m)e.vertex.push(t.vertexPositions[n[v*3]]),e.vertex.push(t.vertexPositions[n[v*3+1]]),e.vertex.push(t.vertexPositions[n[v*3+2]]),e.vertex.push(t.vertexPositions[n[x*3]]),e.vertex.push(t.vertexPositions[n[x*3+1]]),e.vertex.push(t.vertexPositions[n[x*3+2]]),e.vertex.push(t.vertexPositions[n[T*3]]),e.vertex.push(t.vertexPositions[n[T*3+1]]),e.vertex.push(t.vertexPositions[n[T*3+2]]),t.skeleton&&(e.vertexWeights.push(c[v*4]),e.vertexWeights.push(c[v*4+1]),e.vertexWeights.push(c[v*4+2]),e.vertexWeights.push(c[v*4+3]),e.vertexWeights.push(c[x*4]),e.vertexWeights.push(c[x*4+1]),e.vertexWeights.push(c[x*4+2]),e.vertexWeights.push(c[x*4+3]),e.vertexWeights.push(c[T*4]),e.vertexWeights.push(c[T*4+1]),e.vertexWeights.push(c[T*4+2]),e.vertexWeights.push(c[T*4+3]),e.weightsIndices.push(u[v*4]),e.weightsIndices.push(u[v*4+1]),e.weightsIndices.push(u[v*4+2]),e.weightsIndices.push(u[v*4+3]),e.weightsIndices.push(u[x*4]),e.weightsIndices.push(u[x*4+1]),e.weightsIndices.push(u[x*4+2]),e.weightsIndices.push(u[x*4+3]),e.weightsIndices.push(u[T*4]),e.weightsIndices.push(u[T*4+1]),e.weightsIndices.push(u[T*4+2]),e.weightsIndices.push(u[T*4+3])),t.color&&(e.colors.push(o[v*3]),e.colors.push(o[v*3+1]),e.colors.push(o[v*3+2]),e.colors.push(o[x*3]),e.colors.push(o[x*3+1]),e.colors.push(o[x*3+2]),e.colors.push(o[T*3]),e.colors.push(o[T*3+1]),e.colors.push(o[T*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(s[v*3]),e.normal.push(s[v*3+1]),e.normal.push(s[v*3+2]),e.normal.push(s[x*3]),e.normal.push(s[x*3+1]),e.normal.push(s[x*3+2]),e.normal.push(s[T*3]),e.normal.push(s[T*3+1]),e.normal.push(s[T*3+2])),t.uv&&t.uv.forEach(function(P,R){e.uvs[R]===void 0&&(e.uvs[R]=[]),e.uvs[R].push(a[R][v*2]),e.uvs[R].push(a[R][v*2+1]),e.uvs[R].push(a[R][x*2]),e.uvs[R].push(a[R][x*2+1]),e.uvs[R].push(a[R][T*2]),e.uvs[R].push(a[R][T*2+1])})}addMorphTargets(e,t,n,r){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;n.forEach(function(o){o.rawTargets.forEach(function(a){const c=ai.Objects.Geometry[a.geoID];c!==void 0&&s.genMorphGeometry(e,t,c,r,a.name)})})}genMorphGeometry(e,t,n,r,s){const o=t.Vertices!==void 0?t.Vertices.a:[],a=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],c=n.Vertices!==void 0?n.Vertices.a:[],u=n.Indexes!==void 0?n.Indexes.a:[],f=e.attributes.position.count*3,m=new Float32Array(f);for(let P=0;P<u.length;P++){const R=u[P]*3;m[R]=c[P*3],m[R+1]=c[P*3+1],m[R+2]=c[P*3+2]}const v={vertexIndices:a,vertexPositions:m,baseVertexPositions:o},x=this.genBuffers(v),T=new br(x.vertex,3);T.name=s||n.attrName,T.applyMatrix4(r),e.morphAttributes.position.push(T)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let s=[];return n==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:s,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let s=[];return n==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:r,indices:s,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let s=[];n==="IndexToDirect"&&(s=e.ColorIndex.a);for(let o=0,a=new yn;o<r.length;o+=4)a.fromArray(r,o),rr.colorSpaceToWorking(a,Hr),a.toArray(r,o);return{dataSize:4,buffer:r,indices:s,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,s=[];for(let o=0;o<r.length;++o)s.push(o);return{dataSize:1,buffer:r,indices:s,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Xi;const n=t-1,r=e.KnotVector.a,s=[],o=e.Points.a;for(let m=0,v=o.length;m<v;m+=4)s.push(new ir().fromArray(o,m));let a,c;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){a=n,c=r.length-1-a;for(let m=0;m<n;++m)s.push(s[m])}const f=new Wpt(n,r,s,a,c).getPoints(s.length*12);return new Xi().setFromPoints(f)}}class Kpt{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const r=t[n],s=this.addClip(r);e.push(s)}return e}parseClips(){if(ai.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=ai.Objects.AnimationCurveNode,t=new Map;for(const n in e){const r=e[n];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:r.id,attr:r.attrName,curves:{}};t.set(s.id,s)}}return t}parseAnimationCurves(e){const t=ai.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map(t1t),values:t[n].KeyValueFloat.a},s=Bo.get(r.id);if(s!==void 0){const o=s.parents[0].ID,a=s.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=r:a.match(/Y/)?e.get(o).curves.y=r:a.match(/Z/)?e.get(o).curves.z=r:a.match(/DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=r)}}}parseAnimationLayers(e){const t=ai.Objects.AnimationLayer,n=new Map;for(const r in t){const s=[],o=Bo.get(parseInt(r));o!==void 0&&(o.children.forEach(function(c,u){if(e.has(c.ID)){const f=e.get(c.ID);if(f.curves.x!==void 0||f.curves.y!==void 0||f.curves.z!==void 0){if(s[u]===void 0){const m=Bo.get(c.ID).parents.filter(function(v){return v.relationship!==void 0})[0].ID;if(m!==void 0){const v=ai.Objects.Model[m.toString()];if(v===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const x={modelName:v.attrName?Ai.sanitizeNodeName(v.attrName):"",ID:v.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};w0.traverse(function(T){T.ID===v.id&&(x.transform=T.matrix,T.userData.transformData&&(x.eulerOrder=T.userData.transformData.eulerOrder))}),x.transform||(x.transform=new Vn),"PreRotation"in v&&(x.preRotation=v.PreRotation.value),"PostRotation"in v&&(x.postRotation=v.PostRotation.value),s[u]=x}}s[u]&&(s[u][f.attr]=f)}else if(f.curves.morph!==void 0){if(s[u]===void 0){const m=Bo.get(c.ID).parents.filter(function(M){return M.relationship!==void 0})[0].ID,v=Bo.get(m).parents[0].ID,x=Bo.get(v).parents[0].ID,T=Bo.get(x).parents[0].ID,P=ai.Objects.Model[T],R={modelName:P.attrName?Ai.sanitizeNodeName(P.attrName):"",morphName:ai.Objects.Deformer[m].attrName};s[u]=R}s[u][f.attr]=f}}}),n.set(parseInt(r),s))}return n}parseAnimStacks(e){const t=ai.Objects.AnimationStack,n={};for(const r in t){const s=Bo.get(parseInt(r)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(s[0].ID);n[r]={name:t[r].attrName,layer:o}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(r){t=t.concat(n.generateTracks(r))}),new Bee(e.name,-1,t)}generateTracks(e){const t=[];let n=new be,r=new be;if(e.transform&&e.transform.decompose(n,new qi,r),n=n.toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");s!==void 0&&t.push(s)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const s=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);s!==void 0&&t.push(s)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");s!==void 0&&t.push(s)}if(e.DeformPercent!==void 0){const s=this.generateMorphTrack(e);s!==void 0&&t.push(s)}return t}generateVectorTrack(e,t,n,r){const s=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(s,t,n);return new RM(e+"."+r,s,o)}generateRotationTrack(e,t,n,r,s){let o,a;if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const v=this.interpolateRotations(t.x,t.y,t.z,s);o=v[0],a=v[1]}const c=LM(0);n!==void 0&&(n=n.map(ml.degToRad),n.push(c),n=new Mo().fromArray(n),n=new qi().setFromEuler(n)),r!==void 0&&(r=r.map(ml.degToRad),r.push(c),r=new Mo().fromArray(r),r=new qi().setFromEuler(r).invert());const u=new qi,f=new Mo,m=[];if(!a||!o)return new W_(e+".quaternion",[0],[0]);for(let v=0;v<a.length;v+=3)f.set(a[v],a[v+1],a[v+2],s),u.setFromEuler(f),n!==void 0&&u.premultiply(n),r!==void 0&&u.multiply(r),v>2&&new qi().fromArray(m,(v-3)/3*4).dot(u)<0&&u.set(-u.x,-u.y,-u.z,-u.w),u.toArray(m,v/3*4);return new W_(e+".quaternion",o,m)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(s){return s/100}),r=w0.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new AM(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,r){return n-r}),t.length>1){let n=1,r=t[0];for(let s=1;s<t.length;s++){const o=t[s];o!==r&&(t[n]=o,r=o,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const r=n,s=[];let o=-1,a=-1,c=-1;return e.forEach(function(u){if(t.x&&(o=t.x.times.indexOf(u)),t.y&&(a=t.y.times.indexOf(u)),t.z&&(c=t.z.times.indexOf(u)),o!==-1){const f=t.x.values[o];s.push(f),r[0]=f}else s.push(r[0]);if(a!==-1){const f=t.y.values[a];s.push(f),r[1]=f}else s.push(r[1]);if(c!==-1){const f=t.z.values[c];s.push(f),r[2]=f}else s.push(r[2])}),s}interpolateRotations(e,t,n,r){const s=[],o=[];s.push(e.times[0]),o.push(ml.degToRad(e.values[0])),o.push(ml.degToRad(t.values[0])),o.push(ml.degToRad(n.values[0]));for(let a=1;a<e.values.length;a++){const c=[e.values[a-1],t.values[a-1],n.values[a-1]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const u=c.map(ml.degToRad),f=[e.values[a],t.values[a],n.values[a]];if(isNaN(f[0])||isNaN(f[1])||isNaN(f[2]))continue;const m=f.map(ml.degToRad),v=[f[0]-c[0],f[1]-c[1],f[2]-c[2]],x=[Math.abs(v[0]),Math.abs(v[1]),Math.abs(v[2])];if(x[0]>=180||x[1]>=180||x[2]>=180){const P=Math.max(...x)/180,R=new Mo(...u,r),M=new Mo(...m,r),O=new qi().setFromEuler(R),C=new qi().setFromEuler(M);O.dot(C)&&C.set(-C.x,-C.y,-C.z,-C.w);const L=e.times[a-1],Y=e.times[a]-L,J=new qi,z=new Mo;for(let ne=0;ne<1;ne+=1/P)J.copy(O.clone().slerp(C.clone(),ne)),s.push(L+ne*Y),z.setFromQuaternion(J,r),o.push(z.x),o.push(z.y),o.push(z.z)}else s.push(e.times[a]),o.push(ml.degToRad(e.values[a])),o.push(ml.degToRad(t.values[a])),o.push(ml.degToRad(n.values[a]))}return[s,o]}}class Zpt{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new FNe,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(r,s){const o=r.match(/^[\s\t]*;/),a=r.match(/^[\s\t]*$/);if(o||a)return;const c=r.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),u=r.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),f=r.match("^\\t{"+(t.currentIndent-1)+"}}");c?t.parseNodeBegin(r,c):u?t.parseNodeProperty(r,u,n[++s]):f?t.popStack():r.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:n},o=this.parseNodeAttr(r),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,s):n in a?(n==="PoseNode"?a.PoseNode.push(s):a[n].id!==void 0&&(a[n]={},a[n][a[n].id]=a[n]),o.id!==""&&(a[n][o.id]=s)):typeof o.id=="number"?(a[n]={},a[n][o.id]=s):n!=="Properties70"&&(n==="PoseNode"?a[n]=[s]:a[n]=s),typeof o.id=="number"&&(s.id=o.id),o.name!==""&&(s.attrName=o.name),o.type!==""&&(s.attrType=o.type),this.pushStack(s)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),s=t[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&s===","&&(s=n.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,r,s);return}if(r==="C"){const c=s.split(",").slice(1),u=parseInt(c[0]),f=parseInt(c[1]);let m=s.split(",").slice(3);m=m.map(function(v){return v.trim().replace(/^"/,"")}),r="connections",s=[u,f],r1t(s,m),o[r]===void 0&&(o[r]=[])}r==="Node"&&(o.id=s),r in o&&Array.isArray(o[r])?o[r].push(s):r!=="a"?o[r]=s:o.a=s,this.setCurrentProp(o,r),r==="a"&&s.slice(-1)!==","&&(o.a=HQ(s))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=HQ(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map(function(f){return f.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=r[0],o=r[1],a=r[2],c=r[3];let u=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=HQ(u);break}this.getPrevNode()[s]={type:o,type2:a,flag:c,value:u},this.setCurrentProp(this.getPrevNode(),s)}}class Qpt{parse(e){const t=new Gwe(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new FNe;for(;!this.endOfContent(t);){const s=this.parseNode(t,n);s!==null&&r.add(s.name,s)}return r}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(r===0)return null;const c=[];for(let v=0;v<s;v++)c.push(this.parseProperty(e));const u=c.length>0?c[0]:"",f=c.length>1?c[1]:"",m=c.length>2?c[2]:"";for(n.singleProperty=s===1&&e.getOffset()===r;r>e.getOffset();){const v=this.parseNode(e,t);v!==null&&this.parseSubNode(a,n,v)}return n.propertyList=c,typeof u=="number"&&(n.id=u),f!==""&&(n.attrName=f),m!==""&&(n.attrType=m),a!==""&&(n.name=a),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if(e==="Connections"&&n.name==="C"){const r=[];n.propertyList.forEach(function(s,o){o!==0&&r.push(s)}),t.connections===void 0&&(t.connections=[]),t.connections.push(r)}else if(n.name==="Properties70")Object.keys(n).forEach(function(s){t[s]=n[s]});else if(e==="Properties70"&&n.name==="P"){let r=n.propertyList[0],s=n.propertyList[1];const o=n.propertyList[2],a=n.propertyList[3];let c;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?c=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:c=n.propertyList[4],t[r]={type:s,type2:o,flag:a,value:c}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),s=e.getUint32(),o=e.getUint32();if(s===0)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const a=Opt(new Uint8Array(e.getArrayBuffer(o))),c=new Gwe(a.buffer);switch(t){case"b":case"c":return c.getBooleanArray(r);case"d":return c.getFloat64Array(r);case"f":return c.getFloat32Array(r);case"i":return c.getInt32Array(r);case"l":return c.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Gwe{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const r=n.indexOf(0);return r>=0&&(n=new Uint8Array(this.dv.buffer,t,r)),this._textDecoder.decode(n)}}class FNe{add(e,t){this[e]=t}}function Jpt(i){const e="Kaydara FBX Binary  \0";return i.byteLength>=e.length&&e===BNe(i,0,e.length)}function e1t(i){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(r){const s=i[r-1];return i=i.slice(t+r),t++,s}for(let r=0;r<e.length;++r)if(n(1)===e[r])return!1;return!0}function $we(i){const e=/FBXVersion: (\d+)/,t=i.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function t1t(i){return i/46186158e3}const n1t=[];function aB(i,e,t,n){let r;switch(n.mappingType){case"ByPolygonVertex":r=i;break;case"ByPolygon":r=e;break;case"ByVertice":r=t;break;case"AllSame":r=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(r=n.indices[r]);const s=r*n.dataSize,o=s+n.dataSize;return i1t(n1t,n.buffer,s,o)}const $Q=new Mo,d6=new be;function ONe(i){const e=new Vn,t=new Vn,n=new Vn,r=new Vn,s=new Vn,o=new Vn,a=new Vn,c=new Vn,u=new Vn,f=new Vn,m=new Vn,v=new Vn,x=i.inheritType?i.inheritType:0;i.translation&&e.setPosition(d6.fromArray(i.translation));const T=LM(0);if(i.preRotation){const he=i.preRotation.map(ml.degToRad);he.push(T),t.makeRotationFromEuler($Q.fromArray(he))}if(i.rotation){const he=i.rotation.map(ml.degToRad);he.push(i.eulerOrder||T),n.makeRotationFromEuler($Q.fromArray(he))}if(i.postRotation){const he=i.postRotation.map(ml.degToRad);he.push(T),r.makeRotationFromEuler($Q.fromArray(he)),r.invert()}i.scale&&s.scale(d6.fromArray(i.scale)),i.scalingOffset&&a.setPosition(d6.fromArray(i.scalingOffset)),i.scalingPivot&&o.setPosition(d6.fromArray(i.scalingPivot)),i.rotationOffset&&c.setPosition(d6.fromArray(i.rotationOffset)),i.rotationPivot&&u.setPosition(d6.fromArray(i.rotationPivot)),i.parentMatrixWorld&&(m.copy(i.parentMatrix),f.copy(i.parentMatrixWorld));const P=t.clone().multiply(n).multiply(r),R=new Vn;R.extractRotation(f);const M=new Vn;M.copyPosition(f);const O=M.clone().invert().multiply(f),C=R.clone().invert().multiply(O),L=s,Y=new Vn;if(x===0)Y.copy(R).multiply(P).multiply(C).multiply(L);else if(x===1)Y.copy(R).multiply(C).multiply(P).multiply(L);else{const Ce=new Vn().scale(new be().setFromMatrixScale(m)).clone().invert(),Pe=C.clone().multiply(Ce);Y.copy(R).multiply(P).multiply(Pe).multiply(L)}const J=u.clone().invert(),z=o.clone().invert();let ne=e.clone().multiply(c).multiply(u).multiply(t).multiply(n).multiply(r).multiply(J).multiply(a).multiply(o).multiply(s).multiply(z);const K=new Vn().copyPosition(ne),$=f.clone().multiply(K);return v.copyPosition($),ne=v.clone().multiply(Y),ne.premultiply(f.invert()),ne}function LM(i){i=i||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return i===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[i]}function HQ(i){return i.split(",").map(function(t){return parseFloat(t)})}function BNe(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=i.byteLength),new TextDecoder().decode(new Uint8Array(i,e,t))}function r1t(i,e){for(let t=0,n=i.length,r=e.length;t<r;t++,n++)i[n]=e[t]}function i1t(i,e,t,n){for(let r=t,s=0;r<n;r++,s++)i[s]=e[r];return i}var oU={exports:{}};oU.exports;(function(i,e){var t=Object.create,n=Object.defineProperty,r=Object.defineProperties,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertyNames,c=Object.getOwnPropertySymbols,u=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,v=(w,k,j)=>k in w?n(w,k,{enumerable:!0,configurable:!0,writable:!0,value:j}):w[k]=j,x=(w,k)=>{for(var j in k||(k={}))f.call(k,j)&&v(w,j,k[j]);if(c)for(var j of c(k))m.call(k,j)&&v(w,j,k[j]);return w},T=(w,k)=>r(w,o(k)),P=(w,k)=>function(){return k||(0,w[a(w)[0]])((k={exports:{}}).exports,k),k.exports},R=(w,k)=>{for(var j in k)n(w,j,{get:k[j],enumerable:!0})},M=(w,k,j,ee)=>{if(k&&typeof k=="object"||typeof k=="function")for(let le of a(k))!f.call(w,le)&&le!==j&&n(w,le,{get:()=>k[le],enumerable:!(ee=s(k,le))||ee.enumerable});return w},O=(w,k,j)=>(j=w!=null?t(u(w)):{},M(k||!w||!w.__esModule?n(j,"default",{value:w,enumerable:!0}):j,w)),C=w=>M(n({},"__esModule",{value:!0}),w),L=(w,k,j)=>(v(w,typeof k!="symbol"?k+"":k,j),j),Y=P({"../node_modules/timing-function/lib/UnitBezier.js"(w,k){k.exports=function(){function j(ee,le,ve,De){this.set(ee,le,ve,De)}return j.prototype.set=function(ee,le,ve,De){this._cx=3*ee,this._bx=3*(ve-ee)-this._cx,this._ax=1-this._cx-this._bx,this._cy=3*le,this._by=3*(De-le)-this._cy,this._ay=1-this._cy-this._by},j.epsilon=1e-6,j.prototype._sampleCurveX=function(ee){return((this._ax*ee+this._bx)*ee+this._cx)*ee},j.prototype._sampleCurveY=function(ee){return((this._ay*ee+this._by)*ee+this._cy)*ee},j.prototype._sampleCurveDerivativeX=function(ee){return(3*this._ax*ee+2*this._bx)*ee+this._cx},j.prototype._solveCurveX=function(ee,le){var ve,De,nt,lt,Et,on;for(nt=void 0,lt=void 0,Et=void 0,on=void 0,ve=void 0,De=void 0,Et=ee,De=0;De<8;){if(on=this._sampleCurveX(Et)-ee,Math.abs(on)<le)return Et;if(ve=this._sampleCurveDerivativeX(Et),Math.abs(ve)<le)break;Et=Et-on/ve,De++}if(nt=0,lt=1,Et=ee,Et<nt)return nt;if(Et>lt)return lt;for(;nt<lt;){if(on=this._sampleCurveX(Et),Math.abs(on-ee)<le)return Et;ee>on?nt=Et:lt=Et,Et=(lt-nt)*.5+nt}return Et},j.prototype.solve=function(ee,le){return this._sampleCurveY(this._solveCurveX(ee,le))},j.prototype.solveSimple=function(ee){return this._sampleCurveY(this._solveCurveX(ee,1e-6))},j}()}}),J=P({"../node_modules/levenshtein-edit-distance/index.js"(w,k){var j,ee;j=[],ee=[];function le(ve,De,nt){var lt,Et,on,hn,me,at,Un,Vr;if(ve===De)return 0;if(lt=ve.length,Et=De.length,lt===0)return Et;if(Et===0)return lt;for(nt&&(ve=ve.toLowerCase(),De=De.toLowerCase()),Un=0;Un<lt;)ee[Un]=ve.charCodeAt(Un),j[Un]=++Un;for(Vr=0;Vr<Et;)for(on=De.charCodeAt(Vr),hn=me=Vr++,Un=-1;++Un<lt;)at=on===ee[Un]?me:me+1,me=j[Un],j[Un]=hn=me>hn?at>hn?hn+1:at:at>me?me+1:at;return hn}k.exports=le}}),z=P({"../node_modules/propose/propose.js"(w,k){var j=J();function ee(){var le,ve,De,nt,lt,Et=0,on=arguments[0],hn=arguments[1],me=hn.length,at=arguments[2];at&&(nt=at.threshold,lt=at.ignoreCase),nt===void 0&&(nt=0);for(var Un=0;Un<me;++Un)lt?ve=j(on,hn[Un],!0):ve=j(on,hn[Un]),ve>on.length?le=1-ve/hn[Un].length:le=1-ve/on.length,le>Et&&(Et=le,De=hn[Un]);return Et>=nt?De:null}k.exports=ee}}),ne=P({"../node_modules/fast-deep-equal/index.js"(w,k){k.exports=function j(ee,le){if(ee===le)return!0;if(ee&&le&&typeof ee=="object"&&typeof le=="object"){if(ee.constructor!==le.constructor)return!1;var ve,De,nt;if(Array.isArray(ee)){if(ve=ee.length,ve!=le.length)return!1;for(De=ve;De--!==0;)if(!j(ee[De],le[De]))return!1;return!0}if(ee.constructor===RegExp)return ee.source===le.source&&ee.flags===le.flags;if(ee.valueOf!==Object.prototype.valueOf)return ee.valueOf()===le.valueOf();if(ee.toString!==Object.prototype.toString)return ee.toString()===le.toString();if(nt=Object.keys(ee),ve=nt.length,ve!==Object.keys(le).length)return!1;for(De=ve;De--!==0;)if(!Object.prototype.hasOwnProperty.call(le,nt[De]))return!1;for(De=ve;De--!==0;){var lt=nt[De];if(!j(ee[lt],le[lt]))return!1}return!0}return ee!==ee&&le!==le}}}),K={};R(K,{createRafDriver:()=>Vd,getProject:()=>Ob,notify:()=>_p,onChange:()=>lv,types:()=>vb,val:()=>Bb}),i.exports=C(K);var $={};R($,{createRafDriver:()=>Vd,getProject:()=>Ob,notify:()=>_p,onChange:()=>lv,types:()=>vb,val:()=>Bb});var he=Jt,Ce=class{constructor(){L(this,"atom",new he.Atom({projects:{}}))}add(w,k){this.atom.setByPointer(j=>j.projects[w],k)}get(w){return this.atom.get().projects[w]}has(w){return!!this.get(w)}},Pe=new Ce,je=Pe,ge=new WeakMap;function Xe(w){return ge.get(w)}function Fe(w,k){ge.set(w,k)}var Ne=[],tt=Array.isArray,mt=tt,Ht=typeof lo=="object"&&lo&&lo.Object===Object&&lo,pn=Ht,In=typeof self=="object"&&self&&self.Object===Object&&self,vt=pn||In||Function("return this")(),Ut=vt,Sn=Ut.Symbol,ln=Sn,Xn=Object.prototype,Yr=Xn.hasOwnProperty,lr=Xn.toString,Kr=ln?ln.toStringTag:void 0;function wi(w){var k=Yr.call(w,Kr),j=w[Kr];try{w[Kr]=void 0;var ee=!0}catch{}var le=lr.call(w);return ee&&(k?w[Kr]=j:delete w[Kr]),le}var Zr=wi,Ue=Object.prototype,vo=Ue.toString;function ui(w){return vo.call(w)}var qr=ui,Dn="[object Null]",ni="[object Undefined]",$n=ln?ln.toStringTag:void 0;function Sr(w){return w==null?w===void 0?ni:Dn:$n&&$n in Object(w)?Zr(w):qr(w)}var Vi=Sr;function Me(w){return w!=null&&typeof w=="object"}var fe=Me,ft="[object Symbol]";function Ft(w){return typeof w=="symbol"||fe(w)&&Vi(w)==ft}var $t=Ft,kt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Jn=/^\w*$/;function An(w,k){if(mt(w))return!1;var j=typeof w;return j=="number"||j=="symbol"||j=="boolean"||w==null||$t(w)?!0:Jn.test(w)||!kt.test(w)||k!=null&&w in Object(k)}var Hn=An;function Zn(w){var k=typeof w;return w!=null&&(k=="object"||k=="function")}var Vt=Zn,Ln="[object AsyncFunction]",fr="[object Function]",ur="[object GeneratorFunction]",Mn="[object Proxy]";function cr(w){if(!Vt(w))return!1;var k=Vi(w);return k==fr||k==ur||k==Ln||k==Mn}var He=cr,Cn=Ut["__core-js_shared__"],Wt=Cn,Fn=function(){var w=/[^.]+$/.exec(Wt&&Wt.keys&&Wt.keys.IE_PROTO||"");return w?"Symbol(src)_1."+w:""}();function cn(w){return!!Fn&&Fn in w}var zt=cn,On=Function.prototype,pr=On.toString;function Gi(w){if(w!=null){try{return pr.call(w)}catch{}try{return w+""}catch{}}return""}var kr=Gi,pa=/[\\^$.*+?()[\]{}|]/g,bl=/^\[object .+?Constructor\]$/,Ho=Function.prototype,ka=Object.prototype,V0=Ho.toString,Pd=ka.hasOwnProperty,Nd=RegExp("^"+V0.call(Pd).replace(pa,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Id(w){if(!Vt(w)||zt(w))return!1;var k=He(w)?Nd:bl;return k.test(kr(w))}var Sl=Id;function np(w,k){return w==null?void 0:w[k]}var kd=np;function rp(w,k){var j=kd(w,k);return Sl(j)?j:void 0}var t0=rp,l3=t0(Object,"create"),ah=l3;function lh(){this.__data__=ah?ah(null):{},this.size=0}var cm=lh;function c3(w){var k=this.has(w)&&delete this.__data__[w];return this.size-=k?1:0,k}var u3=c3,ye="__lodash_hash_undefined__",Qe=Object.prototype,bt=Qe.hasOwnProperty;function St(w){var k=this.__data__;if(ah){var j=k[w];return j===ye?void 0:j}return bt.call(k,w)?k[w]:void 0}var rt=St,un=Object.prototype,Rn=un.hasOwnProperty;function Bn(w){var k=this.__data__;return ah?k[w]!==void 0:Rn.call(k,w)}var Pn=Bn,hr="__lodash_hash_undefined__";function yr(w,k){var j=this.__data__;return this.size+=this.has(w)?0:1,j[w]=ah&&k===void 0?hr:k,this}var er=yr;function Ar(w){var k=-1,j=w==null?0:w.length;for(this.clear();++k<j;){var ee=w[k];this.set(ee[0],ee[1])}}Ar.prototype.clear=cm,Ar.prototype.delete=u3,Ar.prototype.get=rt,Ar.prototype.has=Pn,Ar.prototype.set=er;var oi=Ar;function Yi(){this.__data__=[],this.size=0}var ls=Yi;function Br(w,k){return w===k||w!==w&&k!==k}var tr=Br;function Zs(w,k){for(var j=w.length;j--;)if(tr(w[j][0],k))return j;return-1}var Xr=Zs,jo=Array.prototype,ou=jo.splice;function Wo(w){var k=this.__data__,j=Xr(k,w);if(j<0)return!1;var ee=k.length-1;return j==ee?k.pop():ou.call(k,j,1),--this.size,!0}var au=Wo;function $i(w){var k=this.__data__,j=Xr(k,w);return j<0?void 0:k[j][1]}var Hs=$i;function Ro(w){return Xr(this.__data__,w)>-1}var _o=Ro;function Qs(w,k){var j=this.__data__,ee=Xr(j,w);return ee<0?(++this.size,j.push([w,k])):j[ee][1]=k,this}var lu=Qs;function Da(w){var k=-1,j=w==null?0:w.length;for(this.clear();++k<j;){var ee=w[k];this.set(ee[0],ee[1])}}Da.prototype.clear=ls,Da.prototype.delete=au,Da.prototype.get=Hs,Da.prototype.has=_o,Da.prototype.set=lu;var um=Da,h3=t0(Ut,"Map"),Dd=h3;function Nx(){this.size=0,this.__data__={hash:new oi,map:new(Dd||um),string:new oi}}var Ix=Nx;function O4(w){var k=typeof w;return k=="string"||k=="number"||k=="symbol"||k=="boolean"?w!=="__proto__":w===null}var B4=O4;function cu(w,k){var j=w.__data__;return B4(k)?j[typeof k=="string"?"string":"hash"]:j.map}var ip=cu;function L4(w){var k=ip(this,w).delete(w);return this.size-=k?1:0,k}var d3=L4;function f3(w){return ip(this,w).get(w)}var U4=f3;function z4(w){return ip(this,w).has(w)}var V4=z4;function G4(w,k){var j=ip(this,w),ee=j.size;return j.set(w,k),this.size+=j.size==ee?0:1,this}var $4=G4;function ch(w){var k=-1,j=w==null?0:w.length;for(this.clear();++k<j;){var ee=w[k];this.set(ee[0],ee[1])}}ch.prototype.clear=Ix,ch.prototype.delete=d3,ch.prototype.get=U4,ch.prototype.has=V4,ch.prototype.set=$4;var hm=ch,kx="Expected a function";function dm(w,k){if(typeof w!="function"||k!=null&&typeof k!="function")throw new TypeError(kx);var j=function(){var ee=arguments,le=k?k.apply(this,ee):ee[0],ve=j.cache;if(ve.has(le))return ve.get(le);var De=w.apply(this,ee);return j.cache=ve.set(le,De)||ve,De};return j.cache=new(dm.Cache||hm),j}dm.Cache=hm;var Dx=dm,Fx=500;function uu(w){var k=Dx(w,function(ee){return j.size===Fx&&j.clear(),ee}),j=k.cache;return k}var uh=uu,H4=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,fm=/\\(\\)?/g,Ox=uh(function(w){var k=[];return w.charCodeAt(0)===46&&k.push(""),w.replace(H4,function(j,ee,le,ve){k.push(le?ve.replace(fm,"$1"):ee||j)}),k}),Bx=Ox;function j4(w,k){for(var j=-1,ee=w==null?0:w.length,le=Array(ee);++j<ee;)le[j]=k(w[j],j,w);return le}var Lx=j4,W4=1/0,p3=ln?ln.prototype:void 0,q4=p3?p3.toString:void 0;function X4(w){if(typeof w=="string")return w;if(mt(w))return Lx(w,X4)+"";if($t(w))return q4?q4.call(w):"";var k=w+"";return k=="0"&&1/w==-W4?"-0":k}var m3=X4;function Ux(w){return w==null?"":m3(w)}var Y4=Ux;function pm(w,k){return mt(w)?w:Hn(w,k)?[w]:Bx(Y4(w))}var Fd=pm,g3=1/0;function K4(w){if(typeof w=="string"||$t(w))return w;var k=w+"";return k=="0"&&1/w==-g3?"-0":k}var xc=K4;function sp(w,k){k=Fd(k,w);for(var j=0,ee=k.length;w!=null&&j<ee;)w=w[xc(k[j++])];return j&&j==ee?w:void 0}var op=sp;function y3(w,k,j){var ee=w==null?void 0:op(w,k);return ee===void 0?j:ee}var hu=y3;function Od(w,k){return k.length===0?w:hu(w,k)}var hh=class{constructor(){L(this,"_values",{})}get(w,k){if(this.has(w))return this._values[w];{const j=k();return this._values[w]=j,j}}has(w){return this._values.hasOwnProperty(w)}},xo=Jt,ap=function(){try{var w=t0(Object,"defineProperty");return w({},"",{}),w}catch{}}(),v3=ap;function Z4(w,k,j){k=="__proto__"&&v3?v3(w,k,{configurable:!0,enumerable:!0,value:j,writable:!0}):w[k]=j}var du=Z4,lp=Object.prototype,zx=lp.hasOwnProperty;function mm(w,k,j){var ee=w[k];(!(zx.call(w,k)&&tr(ee,j))||j===void 0&&!(k in w))&&du(w,k,j)}var cp=mm,Vx=9007199254740991,_3=/^(?:0|[1-9]\d*)$/;function Gx(w,k){var j=typeof w;return k=k??Vx,!!k&&(j=="number"||j!="symbol"&&_3.test(w))&&w>-1&&w%1==0&&w<k}var x3=Gx;function Q4(w,k,j,ee){if(!Vt(w))return w;k=Fd(k,w);for(var le=-1,ve=k.length,De=ve-1,nt=w;nt!=null&&++le<ve;){var lt=xc(k[le]),Et=j;if(lt==="__proto__"||lt==="constructor"||lt==="prototype")return w;if(le!=De){var on=nt[lt];Et=ee?ee(on,lt,nt):void 0,Et===void 0&&(Et=Vt(on)?on:x3(k[le+1])?[]:{})}cp(nt,lt,Et),nt=nt[lt]}return w}var J4=Q4;function e5(w,k,j){return w==null?w:J4(w,k,j)}var Bd=e5,Po=new WeakMap;function $x(w){return gm(w)}function gm(w){if(Po.has(w))return Po.get(w);const k=w.type==="compound"?n5(w):w.type==="enum"?t5(w):w.default;return Po.set(w,k),k}function t5(w){const k={$case:w.defaultCase};for(const[j,ee]of Object.entries(w.cases))k[j]=gm(ee);return k}function n5(w){const k={};for(const[j,ee]of Object.entries(w.props))k[j]=gm(ee);return k}var Fa=Jt,r5=O(Y());function up(w,k,j){return(0,Fa.prism)(()=>{const ee=(0,Fa.val)(k);return Fa.prism.memo("driver",()=>ee?ee.type==="BasicKeyframedTrack"?ym(w,ee,j):(w.logger.error("Track type not yet supported."),(0,Fa.prism)(()=>{})):(0,Fa.prism)(()=>{}),[ee]).getValue()})}function ym(w,k,j){return(0,Fa.prism)(()=>{let ee=Fa.prism.ref("state",{started:!1}),le=ee.current;const ve=j.getValue();return(!le.started||ve<le.validFrom||le.validTo<=ve)&&(ee.current=le=vm(w,j,k)),le.der.getValue()})}var i5=(0,Fa.prism)(()=>{});function vm(w,k,j){const ee=k.getValue();if(j.keyframes.length===0)return{started:!0,validFrom:-1/0,validTo:1/0,der:i5};let le=0;for(;;){const ve=j.keyframes[le];if(!ve)return Js.error;const De=le===j.keyframes.length-1;if(ee<ve.position)return le===0?Js.beforeFirstKeyframe(ve):Js.error;if(ve.position===ee)return De?Js.lastKeyframe(ve):Js.between(ve,j.keyframes[le+1],k);if(le===j.keyframes.length-1)return Js.lastKeyframe(ve);{const nt=le+1;if(j.keyframes[nt].position<=ee){le=nt;continue}else return Js.between(ve,j.keyframes[le+1],k)}}}var Js={beforeFirstKeyframe(w){return{started:!0,validFrom:-1/0,validTo:w.position,der:(0,Fa.prism)(()=>({left:w.value,progression:0}))}},lastKeyframe(w){return{started:!0,validFrom:w.position,validTo:1/0,der:(0,Fa.prism)(()=>({left:w.value,progression:0}))}},between(w,k,j){if(!w.connectedRight)return{started:!0,validFrom:w.position,validTo:k.position,der:(0,Fa.prism)(()=>({left:w.value,progression:0}))};const ee=ve=>(ve-w.position)/(k.position-w.position);if(!w.type||w.type==="bezier"){const ve=new r5.default(w.handles[2],w.handles[3],k.handles[0],k.handles[1]),De=(0,Fa.prism)(()=>{const nt=ee(j.getValue()),lt=ve.solveSimple(nt);return{left:w.value,right:k.value,progression:lt}});return{started:!0,validFrom:w.position,validTo:k.position,der:De}}const le=(0,Fa.prism)(()=>{const ve=ee(j.getValue()),De=Math.floor(ve);return{left:w.value,right:k.value,progression:De}});return{started:!0,validFrom:w.position,validTo:k.position,der:le}},error:{started:!0,validFrom:-1/0,validTo:1/0,der:i5}};function hp(w,k,j){const le=j.get(w);if(le&&le.override===k)return le.merged;const ve=x({},w);for(const De of Object.keys(k)){const nt=k[De],lt=w[De];ve[De]=typeof nt=="object"&&typeof lt=="object"?hp(lt,nt,j):nt===void 0?lt:nt}return j.set(w,{override:k,merged:ve}),ve}function bc(w,k){let j=w;for(const ee of k)j=j[ee];return j}var fu=Jt,s5=(w,k)=>{const j=fu.prism.memo(w,()=>new fu.Atom(k),[]);return j.set(k),j},Ii=Jt,_m=Jt,o5=/\s/;function a5(w){for(var k=w.length;k--&&o5.test(w.charAt(k)););return k}var l5=a5,xm=/^\s+/;function c5(w){return w&&w.slice(0,l5(w)+1).replace(xm,"")}var bm=c5,b3=0/0,S3=/^[-+]0x[0-9a-f]+$/i,u5=/^0b[01]+$/i,h5=/^0o[0-7]+$/i,d5=parseInt;function Sm(w){if(typeof w=="number")return w;if($t(w))return b3;if(Vt(w)){var k=typeof w.valueOf=="function"?w.valueOf():w;w=Vt(k)?k+"":k}if(typeof w!="string")return w===0?w:+w;w=bm(w);var j=u5.test(w);return j||h5.test(w)?d5(w.slice(2),j?2:8):S3.test(w)?b3:+w}var se=Sm,Se=1/0,Ge=17976931348623157e292;function Tt(w){if(!w)return w===0?w:0;if(w=se(w),w===Se||w===-Se){var k=w<0?-1:1;return k*Ge}return w===w?w:0}var vr=Tt;function yi(w){var k=vr(w),j=k%1;return k===k?j?k-j:k:0}var ma=yi;function G0(w){return w}var w3=G0,dh=t0(Ut,"WeakMap"),dp=dh,bC=Object.create,SC=function(){function w(){}return function(k){if(!Vt(k))return{};if(bC)return bC(k);w.prototype=k;var j=new w;return w.prototype=void 0,j}}(),Nz=SC;function Iz(w,k){var j=-1,ee=w.length;for(k||(k=Array(ee));++j<ee;)k[j]=w[j];return k}var wC=Iz;function Hx(w,k){for(var j=-1,ee=w==null?0:w.length;++j<ee&&k(w[j],j,w)!==!1;);return w}var kz=Hx;function jx(w,k,j,ee){var le=!j;j||(j={});for(var ve=-1,De=k.length;++ve<De;){var nt=k[ve],lt=ee?ee(j[nt],w[nt],nt,j,w):void 0;lt===void 0&&(lt=w[nt]),le?du(j,nt,lt):cp(j,nt,lt)}return j}var T3=jx,TC=9007199254740991;function EC(w){return typeof w=="number"&&w>-1&&w%1==0&&w<=TC}var wm=EC;function Wx(w){return w!=null&&wm(w.length)&&!He(w)}var MC=Wx,CC=Object.prototype;function Dz(w){var k=w&&w.constructor,j=typeof k=="function"&&k.prototype||CC;return w===j}var E3=Dz;function qx(w,k){for(var j=-1,ee=Array(w);++j<w;)ee[j]=k(j);return ee}var AC=qx,Xx="[object Arguments]";function RC(w){return fe(w)&&Vi(w)==Xx}var Yx=RC,M3=Object.prototype,PC=M3.hasOwnProperty,Fz=M3.propertyIsEnumerable,NC=Yx(function(){return arguments}())?Yx:function(w){return fe(w)&&PC.call(w,"callee")&&!Fz.call(w,"callee")},Kx=NC;function IC(){return!1}var kC=IC,Zx=e&&!e.nodeType&&e,Qx=Zx&&!0&&i&&!i.nodeType&&i,DC=Qx&&Qx.exports===Zx,Jx=DC?Ut.Buffer:void 0,FC=Jx?Jx.isBuffer:void 0,OC=FC||kC,C3=OC,BC="[object Arguments]",LC="[object Array]",UC="[object Boolean]",zC="[object Date]",VC="[object Error]",GC="[object Function]",$C="[object Map]",HC="[object Number]",jC="[object Object]",WC="[object RegExp]",qC="[object Set]",XC="[object String]",YC="[object WeakMap]",cs="[object ArrayBuffer]",KC="[object DataView]",Oz="[object Float32Array]",Bz="[object Float64Array]",f5="[object Int8Array]",e7="[object Int16Array]",t7="[object Int32Array]",Tm="[object Uint8Array]",ZC="[object Uint8ClampedArray]",p5="[object Uint16Array]",QC="[object Uint32Array]",rs={};rs[Oz]=rs[Bz]=rs[f5]=rs[e7]=rs[t7]=rs[Tm]=rs[ZC]=rs[p5]=rs[QC]=!0,rs[BC]=rs[LC]=rs[cs]=rs[UC]=rs[KC]=rs[zC]=rs[VC]=rs[GC]=rs[$C]=rs[HC]=rs[jC]=rs[WC]=rs[qC]=rs[XC]=rs[YC]=!1;function Lz(w){return fe(w)&&wm(w.length)&&!!rs[Vi(w)]}var n7=Lz;function JC(w){return function(k){return w(k)}}var A3=JC,r7=e&&!e.nodeType&&e,R3=r7&&!0&&i&&!i.nodeType&&i,eA=R3&&R3.exports===r7,m5=eA&&pn.process,tA=function(){try{var w=R3&&R3.require&&R3.require("util").types;return w||m5&&m5.binding&&m5.binding("util")}catch{}}(),Em=tA,nA=Em&&Em.isTypedArray,i7=nA?A3(nA):n7,s7=i7,rA=Object.prototype,iA=rA.hasOwnProperty;function Uz(w,k){var j=mt(w),ee=!j&&Kx(w),le=!j&&!ee&&C3(w),ve=!j&&!ee&&!le&&s7(w),De=j||ee||le||ve,nt=De?AC(w.length,String):[],lt=nt.length;for(var Et in w)(k||iA.call(w,Et))&&!(De&&(Et=="length"||le&&(Et=="offset"||Et=="parent")||ve&&(Et=="buffer"||Et=="byteLength"||Et=="byteOffset")||x3(Et,lt)))&&nt.push(Et);return nt}var sA=Uz;function oA(w,k){return function(j){return w(k(j))}}var o7=oA,aA=o7(Object.keys,Object),zz=aA,Vz=Object.prototype,g5=Vz.hasOwnProperty;function a7(w){if(!E3(w))return zz(w);var k=[];for(var j in Object(w))g5.call(w,j)&&j!="constructor"&&k.push(j);return k}var Gz=a7;function lA(w){return MC(w)?sA(w):Gz(w)}var Mm=lA;function y5(w){var k=[];if(w!=null)for(var j in Object(w))k.push(j);return k}var l7=y5,cA=Object.prototype,Cm=cA.hasOwnProperty;function v5(w){if(!Vt(w))return l7(w);var k=E3(w),j=[];for(var ee in w)ee=="constructor"&&(k||!Cm.call(w,ee))||j.push(ee);return j}var $z=v5;function uA(w){return MC(w)?sA(w,!0):$z(w)}var c7=uA;function Hz(w,k){for(var j=-1,ee=k.length,le=w.length;++j<ee;)w[le+j]=k[j];return w}var u7=Hz,jz=o7(Object.getPrototypeOf,Object),h7=jz,hA="[object Object]",dA=Function.prototype,fA=Object.prototype,d7=dA.toString,Wz=fA.hasOwnProperty,qz=d7.call(Object);function pA(w){if(!fe(w)||Vi(w)!=hA)return!1;var k=h7(w);if(k===null)return!0;var j=Wz.call(k,"constructor")&&k.constructor;return typeof j=="function"&&j instanceof j&&d7.call(j)==qz}var mA=pA;function gA(w,k,j){var ee=-1,le=w.length;k<0&&(k=-k>le?0:le+k),j=j>le?le:j,j<0&&(j+=le),le=k>j?0:j-k>>>0,k>>>=0;for(var ve=Array(le);++ee<le;)ve[ee]=w[ee+k];return ve}var yA=gA;function Xz(w,k,j){var ee=w.length;return j=j===void 0?ee:j,!k&&j>=ee?w:yA(w,k,j)}var vA=Xz,_A="\\ud800-\\udfff",Yz="\\u0300-\\u036f",Am="\\ufe20-\\ufe2f",f7="\\u20d0-\\u20ff",Kz=Yz+Am+f7,Zz="\\ufe0e\\ufe0f",xA="\\u200d",Qz=RegExp("["+xA+_A+Kz+Zz+"]");function Jz(w){return Qz.test(w)}var fp=Jz;function _5(w){return w.split("")}var eV=_5,p7="\\ud800-\\udfff",bA="\\u0300-\\u036f",SA="\\ufe20-\\ufe2f",tV="\\u20d0-\\u20ff",nV=bA+SA+tV,wA="\\ufe0e\\ufe0f",rV="["+p7+"]",m7="["+nV+"]",x5="\\ud83c[\\udffb-\\udfff]",iV="(?:"+m7+"|"+x5+")",TA="[^"+p7+"]",g7="(?:\\ud83c[\\udde6-\\uddff]){2}",EA="[\\ud800-\\udbff][\\udc00-\\udfff]",Rm="\\u200d",Pm=iV+"?",P3="["+wA+"]?",MA="(?:"+Rm+"(?:"+[TA,g7,EA].join("|")+")"+P3+Pm+")*",Nm=P3+Pm+MA,y7="(?:"+[TA+m7+"?",m7,g7,EA,rV].join("|")+")",sV=RegExp(x5+"(?="+x5+")|"+y7+Nm,"g");function CA(w){return w.match(sV)||[]}var oV=CA;function aV(w){return fp(w)?oV(w):eV(w)}var AA=aV;function lV(w,k,j){return w===w&&(j!==void 0&&(w=w<=j?w:j),k!==void 0&&(w=w>=k?w:k)),w}var cV=lV;function N3(w,k,j){return j===void 0&&(j=k,k=void 0),j!==void 0&&(j=se(j),j=j===j?j:0),k!==void 0&&(k=se(k),k=k===k?k:0),cV(se(w),k,j)}var I3=N3;function uV(){this.__data__=new um,this.size=0}var RA=uV;function hV(w){var k=this.__data__,j=k.delete(w);return this.size=k.size,j}var dV=hV;function PA(w){return this.__data__.get(w)}var fV=PA;function pV(w){return this.__data__.has(w)}var NA=pV,mV=200;function gV(w,k){var j=this.__data__;if(j instanceof um){var ee=j.__data__;if(!Dd||ee.length<mV-1)return ee.push([w,k]),this.size=++j.size,this;j=this.__data__=new hm(ee)}return j.set(w,k),this.size=j.size,this}var IA=gV;function Im(w){var k=this.__data__=new um(w);this.size=k.size}Im.prototype.clear=RA,Im.prototype.delete=dV,Im.prototype.get=fV,Im.prototype.has=NA,Im.prototype.set=IA;var pu=Im;function k3(w,k){return w&&T3(k,Mm(k),w)}var v7=k3;function _7(w,k){return w&&T3(k,c7(k),w)}var kA=_7,b5=e&&!e.nodeType&&e,x7=b5&&!0&&i&&!i.nodeType&&i,yV=x7&&x7.exports===b5,b7=yV?Ut.Buffer:void 0,S7=b7?b7.allocUnsafe:void 0;function vV(w,k){if(k)return w.slice();var j=w.length,ee=S7?S7(j):new w.constructor(j);return w.copy(ee),ee}var DA=vV;function FA(w,k){for(var j=-1,ee=w==null?0:w.length,le=0,ve=[];++j<ee;){var De=w[j];k(De,j,w)&&(ve[le++]=De)}return ve}var OA=FA;function BA(){return[]}var LA=BA,_V=Object.prototype,S5=_V.propertyIsEnumerable,w7=Object.getOwnPropertySymbols,xV=w7?function(w){return w==null?[]:(w=Object(w),OA(w7(w),function(k){return S5.call(w,k)}))}:LA,km=xV;function T7(w,k){return T3(w,km(w),k)}var bV=T7,UA=Object.getOwnPropertySymbols,Dm=UA?function(w){for(var k=[];w;)u7(k,km(w)),w=h7(w);return k}:LA,Fm=Dm;function SV(w,k){return T3(w,Fm(w),k)}var w5=SV;function E7(w,k,j){var ee=k(w);return mt(w)?ee:u7(ee,j(w))}var zA=E7;function pp(w){return zA(w,Mm,km)}var mp=pp;function wV(w){return zA(w,c7,Fm)}var M7=wV,VA=t0(Ut,"DataView"),C7=VA,A7=t0(Ut,"Promise"),T5=A7,TV=t0(Ut,"Set"),E5=TV,R7="[object Map]",EV="[object Object]",P7="[object Promise]",N7="[object Set]",GA="[object WeakMap]",$A="[object DataView]",HA=kr(C7),jA=kr(Dd),WA=kr(T5),I7=kr(E5),qA=kr(dp),Ld=Vi;(C7&&Ld(new C7(new ArrayBuffer(1)))!=$A||Dd&&Ld(new Dd)!=R7||T5&&Ld(T5.resolve())!=P7||E5&&Ld(new E5)!=N7||dp&&Ld(new dp)!=GA)&&(Ld=function(w){var k=Vi(w),j=k==EV?w.constructor:void 0,ee=j?kr(j):"";if(ee)switch(ee){case HA:return $A;case jA:return R7;case WA:return P7;case I7:return N7;case qA:return GA}return k});var Ud=Ld,XA=Object.prototype,MV=XA.hasOwnProperty;function YA(w){var k=w.length,j=new w.constructor(k);return k&&typeof w[0]=="string"&&MV.call(w,"index")&&(j.index=w.index,j.input=w.input),j}var KA=YA,ZA=Ut.Uint8Array,M5=ZA;function CV(w){var k=new w.constructor(w.byteLength);return new M5(k).set(new M5(w)),k}var C5=CV;function AV(w,k){var j=k?C5(w.buffer):w.buffer;return new w.constructor(j,w.byteOffset,w.byteLength)}var RV=AV,Ss=/\w*$/;function A5(w){var k=new w.constructor(w.source,Ss.exec(w));return k.lastIndex=w.lastIndex,k}var PV=A5,k7=ln?ln.prototype:void 0,QA=k7?k7.valueOf:void 0;function NV(w){return QA?Object(QA.call(w)):{}}var JA=NV;function IV(w,k){var j=k?C5(w.buffer):w.buffer;return new w.constructor(j,w.byteOffset,w.length)}var kV=IV,eR="[object Boolean]",DV="[object Date]",FV="[object Map]",tR="[object Number]",OV="[object RegExp]",BV="[object Set]",nR="[object String]",rR="[object Symbol]",LV="[object ArrayBuffer]",Om="[object DataView]",D3="[object Float32Array]",iR="[object Float64Array]",UV="[object Int8Array]",sR="[object Int16Array]",zV="[object Int32Array]",VV="[object Uint8Array]",oR="[object Uint8ClampedArray]",GV="[object Uint16Array]",aR="[object Uint32Array]";function lR(w,k,j){var ee=w.constructor;switch(k){case LV:return C5(w);case eR:case DV:return new ee(+w);case Om:return RV(w,j);case D3:case iR:case UV:case sR:case zV:case VV:case oR:case GV:case aR:return kV(w,j);case FV:return new ee;case tR:case nR:return new ee(w);case OV:return PV(w);case BV:return new ee;case rR:return JA(w)}}var D7=lR;function cR(w){return typeof w.constructor=="function"&&!E3(w)?Nz(h7(w)):{}}var uR=cR,$V="[object Map]";function HV(w){return fe(w)&&Ud(w)==$V}var hR=HV,dR=Em&&Em.isMap,jV=dR?A3(dR):hR,F7=jV,WV="[object Set]";function fR(w){return fe(w)&&Ud(w)==WV}var R5=fR,pR=Em&&Em.isSet,mR=pR?A3(pR):R5,P5=mR,qV=1,gR=2,gp=4,O7="[object Arguments]",B7="[object Array]",yR="[object Boolean]",L7="[object Date]",U7="[object Error]",N5="[object Function]",z7="[object GeneratorFunction]",vR="[object Map]",_R="[object Number]",V7="[object Object]",xR="[object RegExp]",bR="[object Set]",zd="[object String]",G7="[object Symbol]",XV="[object WeakMap]",SR="[object ArrayBuffer]",$7="[object DataView]",YV="[object Float32Array]",KV="[object Float64Array]",wR="[object Int8Array]",TR="[object Int16Array]",ZV="[object Int32Array]",QV="[object Uint8Array]",ER="[object Uint8ClampedArray]",JV="[object Uint16Array]",I5="[object Uint32Array]",Ki={};Ki[O7]=Ki[B7]=Ki[SR]=Ki[$7]=Ki[yR]=Ki[L7]=Ki[YV]=Ki[KV]=Ki[wR]=Ki[TR]=Ki[ZV]=Ki[vR]=Ki[_R]=Ki[V7]=Ki[xR]=Ki[bR]=Ki[zd]=Ki[G7]=Ki[QV]=Ki[ER]=Ki[JV]=Ki[I5]=!0,Ki[U7]=Ki[N5]=Ki[XV]=!1;function F3(w,k,j,ee,le,ve){var De,nt=k&qV,lt=k&gR,Et=k&gp;if(j&&(De=le?j(w,ee,le,ve):j(w)),De!==void 0)return De;if(!Vt(w))return w;var on=mt(w);if(on){if(De=KA(w),!nt)return wC(w,De)}else{var hn=Ud(w),me=hn==N5||hn==z7;if(C3(w))return DA(w,nt);if(hn==V7||hn==O7||me&&!le){if(De=lt||me?{}:uR(w),!nt)return lt?w5(w,kA(De,w)):bV(w,v7(De,w))}else{if(!Ki[hn])return le?w:{};De=D7(w,hn,nt)}}ve||(ve=new pu);var at=ve.get(w);if(at)return at;ve.set(w,De),P5(w)?w.forEach(function(ri){De.add(F3(ri,k,j,ri,w,ve))}):F7(w)&&w.forEach(function(ri,Lr){De.set(Lr,F3(ri,k,j,Lr,w,ve))});var Un=Et?lt?M7:mp:lt?c7:Mm,Vr=on?void 0:Un(w);return kz(Vr||w,function(ri,Lr){Vr&&(Lr=ri,ri=w[Lr]),cp(De,Lr,F3(ri,k,j,Lr,w,ve))}),De}var eG=F3,MR=1,tG=4;function nG(w){return eG(w,MR|tG)}var H7=nG,CR="__lodash_hash_undefined__";function rG(w){return this.__data__.set(w,CR),this}var AR=rG;function RR(w){return this.__data__.has(w)}var j7=RR;function O3(w){var k=-1,j=w==null?0:w.length;for(this.__data__=new hm;++k<j;)this.add(w[k])}O3.prototype.add=O3.prototype.push=AR,O3.prototype.has=j7;var iG=O3;function PR(w,k){for(var j=-1,ee=w==null?0:w.length;++j<ee;)if(k(w[j],j,w))return!0;return!1}var sG=PR;function oG(w,k){return w.has(k)}var k5=oG,W7=1,aG=2;function NR(w,k,j,ee,le,ve){var De=j&W7,nt=w.length,lt=k.length;if(nt!=lt&&!(De&&lt>nt))return!1;var Et=ve.get(w),on=ve.get(k);if(Et&&on)return Et==k&&on==w;var hn=-1,me=!0,at=j&aG?new iG:void 0;for(ve.set(w,k),ve.set(k,w);++hn<nt;){var Un=w[hn],Vr=k[hn];if(ee)var ri=De?ee(Vr,Un,hn,k,w,ve):ee(Un,Vr,hn,w,k,ve);if(ri!==void 0){if(ri)continue;me=!1;break}if(at){if(!sG(k,function(Lr,mi){if(!k5(at,mi)&&(Un===Lr||le(Un,Lr,j,ee,ve)))return at.push(mi)})){me=!1;break}}else if(!(Un===Vr||le(Un,Vr,j,ee,ve))){me=!1;break}}return ve.delete(w),ve.delete(k),me}var q7=NR;function IR(w){var k=-1,j=Array(w.size);return w.forEach(function(ee,le){j[++k]=[le,ee]}),j}var kR=IR;function DR(w){var k=-1,j=Array(w.size);return w.forEach(function(ee){j[++k]=ee}),j}var FR=DR,OR=1,BR=2,LR="[object Boolean]",UR="[object Date]",zR="[object Error]",VR="[object Map]",GR="[object Number]",X7="[object RegExp]",D5="[object Set]",$R="[object String]",lG="[object Symbol]",cG="[object ArrayBuffer]",HR="[object DataView]",Y7=ln?ln.prototype:void 0,F5=Y7?Y7.valueOf:void 0;function jR(w,k,j,ee,le,ve,De){switch(j){case HR:if(w.byteLength!=k.byteLength||w.byteOffset!=k.byteOffset)return!1;w=w.buffer,k=k.buffer;case cG:return!(w.byteLength!=k.byteLength||!ve(new M5(w),new M5(k)));case LR:case UR:case GR:return tr(+w,+k);case zR:return w.name==k.name&&w.message==k.message;case X7:case $R:return w==k+"";case VR:var nt=kR;case D5:var lt=ee&OR;if(nt||(nt=FR),w.size!=k.size&&!lt)return!1;var Et=De.get(w);if(Et)return Et==k;ee|=BR,De.set(w,k);var on=q7(nt(w),nt(k),ee,le,ve,De);return De.delete(w),on;case lG:if(F5)return F5.call(w)==F5.call(k)}return!1}var uG=jR,hG=1,WR=Object.prototype,K7=WR.hasOwnProperty;function Z7(w,k,j,ee,le,ve){var De=j&hG,nt=mp(w),lt=nt.length,Et=mp(k),on=Et.length;if(lt!=on&&!De)return!1;for(var hn=lt;hn--;){var me=nt[hn];if(!(De?me in k:K7.call(k,me)))return!1}var at=ve.get(w),Un=ve.get(k);if(at&&Un)return at==k&&Un==w;var Vr=!0;ve.set(w,k),ve.set(k,w);for(var ri=De;++hn<lt;){me=nt[hn];var Lr=w[me],mi=k[me];if(ee)var Xo=De?ee(mi,Lr,me,k,w,ve):ee(Lr,mi,me,w,k,ve);if(!(Xo===void 0?Lr===mi||le(Lr,mi,j,ee,ve):Xo)){Vr=!1;break}ri||(ri=me=="constructor")}if(Vr&&!ri){var Tl=w.constructor,Oa=k.constructor;Tl!=Oa&&"constructor"in w&&"constructor"in k&&!(typeof Tl=="function"&&Tl instanceof Tl&&typeof Oa=="function"&&Oa instanceof Oa)&&(Vr=!1)}return ve.delete(w),ve.delete(k),Vr}var B3=Z7,qR=1,O5="[object Arguments]",Q7="[object Array]",B5="[object Object]",XR=Object.prototype,L5=XR.hasOwnProperty;function YR(w,k,j,ee,le,ve){var De=mt(w),nt=mt(k),lt=De?Q7:Ud(w),Et=nt?Q7:Ud(k);lt=lt==O5?B5:lt,Et=Et==O5?B5:Et;var on=lt==B5,hn=Et==B5,me=lt==Et;if(me&&C3(w)){if(!C3(k))return!1;De=!0,on=!1}if(me&&!on)return ve||(ve=new pu),De||s7(w)?q7(w,k,j,ee,le,ve):uG(w,k,lt,j,ee,le,ve);if(!(j&qR)){var at=on&&L5.call(w,"__wrapped__"),Un=hn&&L5.call(k,"__wrapped__");if(at||Un){var Vr=at?w.value():w,ri=Un?k.value():k;return ve||(ve=new pu),le(Vr,ri,j,ee,ve)}}return me?(ve||(ve=new pu),B3(w,k,j,ee,le,ve)):!1}var dG=YR;function J7(w,k,j,ee,le){return w===k?!0:w==null||k==null||!fe(w)&&!fe(k)?w!==w&&k!==k:dG(w,k,j,ee,J7,le)}var eb=J7,KR=1,fG=2;function pG(w,k,j,ee){var le=j.length,ve=le,De=!ee;if(w==null)return!ve;for(w=Object(w);le--;){var nt=j[le];if(De&&nt[2]?nt[1]!==w[nt[0]]:!(nt[0]in w))return!1}for(;++le<ve;){nt=j[le];var lt=nt[0],Et=w[lt],on=nt[1];if(De&&nt[2]){if(Et===void 0&&!(lt in w))return!1}else{var hn=new pu;if(ee)var me=ee(Et,on,lt,w,k,hn);if(!(me===void 0?eb(on,Et,KR|fG,ee,hn):me))return!1}}return!0}var tb=pG;function ZR(w){return w===w&&!Vt(w)}var QR=ZR;function JR(w){for(var k=Mm(w),j=k.length;j--;){var ee=k[j],le=w[ee];k[j]=[ee,le,QR(le)]}return k}var mG=JR;function gG(w,k){return function(j){return j==null?!1:j[w]===k&&(k!==void 0||w in Object(j))}}var U5=gG;function eP(w){var k=mG(w);return k.length==1&&k[0][2]?U5(k[0][0],k[0][1]):function(j){return j===w||tb(j,w,k)}}var yG=eP;function tP(w,k){return w!=null&&k in Object(w)}var vG=tP;function _G(w,k,j){k=Fd(k,w);for(var ee=-1,le=k.length,ve=!1;++ee<le;){var De=xc(k[ee]);if(!(ve=w!=null&&j(w,De)))break;w=w[De]}return ve||++ee!=le?ve:(le=w==null?0:w.length,!!le&&wm(le)&&x3(De,le)&&(mt(w)||Kx(w)))}var nP=_G;function xG(w,k){return w!=null&&nP(w,k,vG)}var bG=xG,rP=1,SG=2;function wG(w,k){return Hn(w)&&QR(k)?U5(xc(w),k):function(j){var ee=hu(j,w);return ee===void 0&&ee===k?bG(j,w):eb(k,ee,rP|SG)}}var iP=wG;function TG(w){return function(k){return k==null?void 0:k[w]}}var sP=TG;function oP(w){return function(k){return op(k,w)}}var aP=oP;function lP(w){return Hn(w)?sP(xc(w)):aP(w)}var EG=lP;function MG(w){return typeof w=="function"?w:w==null?w3:typeof w=="object"?mt(w)?iP(w[0],w[1]):yG(w):EG(w)}var cP=MG;function CG(w){return function(k,j,ee){for(var le=-1,ve=Object(k),De=ee(k),nt=De.length;nt--;){var lt=De[w?nt:++le];if(j(ve[lt],lt,ve)===!1)break}return k}}var AG=CG,uP=AG(),RG=uP;function PG(w,k){return w&&RG(w,k,Mm)}var hP=PG,NG=function(){return Ut.Date.now()},nb=NG,Bm="Expected a function",L3=Math.max,IG=Math.min;function dP(w,k,j){var ee,le,ve,De,nt,lt,Et=0,on=!1,hn=!1,me=!0;if(typeof w!="function")throw new TypeError(Bm);k=se(k)||0,Vt(j)&&(on=!!j.leading,hn="maxWait"in j,ve=hn?L3(se(j.maxWait)||0,k):ve,me="trailing"in j?!!j.trailing:me);function at(Hi){var Ba=ee,a0=le;return ee=le=void 0,Et=Hi,De=w.apply(a0,Ba),De}function Un(Hi){return Et=Hi,nt=setTimeout(Lr,k),on?at(Hi):De}function Vr(Hi){var Ba=Hi-lt,a0=Hi-Et,_u=k-Ba;return hn?IG(_u,ve-a0):_u}function ri(Hi){var Ba=Hi-lt,a0=Hi-Et;return lt===void 0||Ba>=k||Ba<0||hn&&a0>=ve}function Lr(){var Hi=nb();if(ri(Hi))return mi(Hi);nt=setTimeout(Lr,Vr(Hi))}function mi(Hi){return nt=void 0,me&&ee?at(Hi):(ee=le=void 0,De)}function Xo(){nt!==void 0&&clearTimeout(nt),Et=0,ee=lt=le=nt=void 0}function Tl(){return nt===void 0?De:mi(nb())}function Oa(){var Hi=nb(),Ba=ri(Hi);if(ee=arguments,le=this,lt=Hi,Ba){if(nt===void 0)return Un(lt);if(hn)return clearTimeout(nt),nt=setTimeout(Lr,k),at(lt)}return nt===void 0&&(nt=setTimeout(Lr,k)),De}return Oa.cancel=Xo,Oa.flush=Tl,Oa}var kG=dP;function DG(w){var k=w==null?0:w.length;return k?w[k-1]:void 0}var fP=DG;function FG(w,k){return k.length<2?w:op(w,yA(k,0,-1))}var pP=FG;function mP(w){return typeof w=="number"&&w==ma(w)}var OG=mP;function BG(w,k){var j={};return k=cP(k),hP(w,function(ee,le,ve){du(j,le,k(ee,le,ve))}),j}var rb=BG;function gP(w,k){return k=Fd(k,w),w=pP(w,k),w==null||delete w[xc(fP(k))]}var LG=gP,yP=9007199254740991,UG=Math.floor;function vP(w,k){var j="";if(!w||k<1||k>yP)return j;do k%2&&(j+=w),k=UG(k/2),k&&(w+=w);while(k);return j}var z5=vP,_P=sP("length"),zG=_P,ib="\\ud800-\\udfff",VG="\\u0300-\\u036f",GG="\\ufe20-\\ufe2f",xP="\\u20d0-\\u20ff",$G=VG+GG+xP,bP="\\ufe0e\\ufe0f",V5="["+ib+"]",sb="["+$G+"]",ob="\\ud83c[\\udffb-\\udfff]",SP="(?:"+sb+"|"+ob+")",ab="[^"+ib+"]",lb="(?:\\ud83c[\\udde6-\\uddff]){2}",G5="[\\ud800-\\udbff][\\udc00-\\udfff]",wP="\\u200d",TP=SP+"?",cb="["+bP+"]?",HG="(?:"+wP+"(?:"+[ab,lb,G5].join("|")+")"+cb+TP+")*",jG=cb+TP+HG,yp="(?:"+[ab+sb+"?",sb,lb,G5,V5].join("|")+")",U3=RegExp(ob+"(?="+ob+")|"+yp+jG,"g");function WG(w){for(var k=U3.lastIndex=0;U3.test(w);)++k;return k}var EP=WG;function ub(w){return fp(w)?EP(w):zG(w)}var MP=ub,qG=Math.ceil;function CP(w,k){k=k===void 0?" ":m3(k);var j=k.length;if(j<2)return j?z5(k,w):k;var ee=z5(k,qG(w/MP(k)));return fp(k)?vA(AA(ee),0,w).join(""):ee.slice(0,w)}var AP=CP;function RP(w,k,j){w=Y4(w),k=ma(k);var ee=k?MP(w):0;return k&&ee<k?AP(k-ee,j)+w:w}var z3=RP;function XG(w,k){return w==null?!0:LG(w,k)}var hb=XG,YG=5*1e3,KG=class{constructor(w){L(this,"_cache",new hh),L(this,"_keepHotUntapDebounce"),Fe(this,w)}get type(){return"Theatre_SheetObject_PublicAPI"}get props(){return Xe(this).propsP}get sheet(){return Xe(this).sheet.publicApi}get project(){return Xe(this).sheet.project.publicApi}get address(){return x({},Xe(this).address)}_valuesPrism(){return this._cache.get("_valuesPrism",()=>{const w=Xe(this);return(0,_m.prism)(()=>(0,_m.val)(w.getValues().getValue()))})}onValuesChange(w,k){return lv(this._valuesPrism(),w,k)}get value(){const w=this._valuesPrism();{if(!w.isHot){this._keepHotUntapDebounce!=null&&this._keepHotUntapDebounce.flush();const k=w.keepHot();this._keepHotUntapDebounce=kG(()=>{k(),this._keepHotUntapDebounce=void 0},YG)}this._keepHotUntapDebounce&&this._keepHotUntapDebounce()}return w.getValue()}set initialValue(w){Xe(this).setInitialValue(w)}};function PP(w){const k=new WeakMap;return j=>(k.has(j)||k.set(j,w(j)),k.get(j))}function V3(w){return w.type==="compound"||w.type==="enum"}function $5(w,k){if(!w)return;const[j,...ee]=k;if(j===void 0)return w;if(!V3(w))return;const le=w.type==="enum"?w.cases[j]:w.props[j];return $5(le,ee)}function ZG(w){return!V3(w)}var QG=class{constructor(w,k,j){this.sheet=w,this.template=k,this.nativeObject=j,L(this,"$$isPointerToPrismProvider",!0),L(this,"address"),L(this,"publicApi"),L(this,"_initialValue",new Ii.Atom({})),L(this,"_cache",new hh),L(this,"_logger"),L(this,"_internalUtilCtx"),this._logger=w._logger.named("SheetObject",k.address.objectKey),this._logger._trace("creating object"),this._internalUtilCtx={logger:this._logger.utilFor.internal()},this.address=T(x({},k.address),{sheetInstanceId:w.address.sheetInstanceId}),this.publicApi=new KG(this)}get type(){return"Theatre_SheetObject"}getValues(){return this._cache.get("getValues()",()=>(0,Ii.prism)(()=>{const w=(0,Ii.val)(this.template.getDefaultValues()),k=(0,Ii.val)(this._initialValue.pointer),j=Ii.prism.memo("withInitialCache",()=>new WeakMap,[]),ee=hp(w,k,j),le=(0,Ii.val)(this.template.getStaticValues()),ve=Ii.prism.memo("withStatics",()=>new WeakMap,[]);let nt=hp(ee,le,ve),lt;{const on=Ii.prism.memo("seq",()=>this.getSequencedValues(),[]),hn=Ii.prism.memo("withSeqsCache",()=>new WeakMap,[]);lt=(0,Ii.val)((0,Ii.val)(on)),nt=hp(nt,lt,hn)}return s5("finalAtom",nt).pointer}))}getValueByPointer(w){const k=(0,Ii.val)(this.getValues()),{path:j}=(0,Ii.getPointerParts)(w);return(0,Ii.val)(bc(k,j))}pointerToPrism(w){const{path:k}=(0,Ii.getPointerParts)(w);return(0,Ii.prism)(()=>{const j=(0,Ii.val)(this.getValues());return(0,Ii.val)(bc(j,k))})}getSequencedValues(){return(0,Ii.prism)(()=>{const w=Ii.prism.memo("tracksToProcess",()=>this.template.getArrayOfValidSequenceTracks(),[]),k=(0,Ii.val)(w),j=new Ii.Atom({}),ee=(0,Ii.val)(this.template.configPointer);return Ii.prism.effect("processTracks",()=>{const le=[];for(const{trackId:ve,pathToProp:De}of k){const nt=this._trackIdToPrism(ve),lt=$5(ee,De),Et=lt.deserializeAndSanitize,on=lt.interpolate,hn=()=>{const at=nt.getValue();if(!at)return j.setByPointer(mi=>bc(mi,De),void 0);const Un=Et(at.left),Vr=Un===void 0?lt.default:Un;if(at.right===void 0)return j.setByPointer(mi=>bc(mi,De),Vr);const ri=Et(at.right),Lr=ri===void 0?lt.default:ri;return j.setByPointer(mi=>bc(mi,De),on(Vr,Lr,at.progression))},me=nt.onStale(hn);hn(),le.push(me)}return()=>{for(const ve of le)ve()}},[ee,...k]),j.pointer})}_trackIdToPrism(w){const k=this.template.project.pointers.historic.sheetsById[this.address.sheetId].sequence.tracksByObject[this.address.objectKey].trackData[w],j=this.sheet.getSequence().positionPrism;return up(this._internalUtilCtx,k,j)}get propsP(){return this._cache.get("propsP",()=>(0,Ii.pointer)({root:this,path:[]}))}validateValue(w,k){}setInitialValue(w){this.validateValue(this.propsP,w),this._initialValue.set(w)}};function Zi(w){return function(j,ee){return w(j,ee())}}var n0={_hmm:r0(524),_todo:r0(522),_error:r0(521),errorDev:r0(529),errorPublic:r0(545),_kapow:r0(268),_warn:r0(265),warnDev:r0(273),warnPublic:r0(289),_debug:r0(137),debugDev:r0(145),_trace:r0(73),traceDev:r0(81)};function r0(w){return Object.freeze({audience:fh(w,8)?"internal":fh(w,16)?"dev":"public",category:fh(w,4)?"troubleshooting":fh(w,2)?"todo":"general",level:fh(w,512)?512:fh(w,256)?256:fh(w,128)?128:64})}function fh(w,k){return(w&k)===k}function is(w,k){return((k&32)===32?!0:(k&16)===16?w.dev:(k&8)===8?w.internal:!1)&&w.min<=k}var mu={loggingConsoleStyle:!0,loggerConsoleStyle:!0,includes:Object.freeze({internal:!1,dev:!1,min:256}),filtered:function(){},include:function(){return{}},create:null,creatExt:null,named(w,k,j){return this.create({names:[...w.names,{name:k,key:j}]})},style:{bold:void 0,italic:void 0,cssMemo:new Map([["",""]]),collapseOnRE:/[a-z- ]+/g,color:void 0,collapsed(w){if(w.length<5)return w;const k=w.replace(this.collapseOnRE,"");return this.cssMemo.has(k)||this.cssMemo.set(k,this.css(w)),k},css(w){var k,j,ee,le;const ve=this.cssMemo.get(w);if(ve)return ve;let De="color:".concat((j=(k=this.color)==null?void 0:k.call(this,w))!=null?j:"hsl(".concat((w.charCodeAt(0)+w.charCodeAt(w.length-1))%360,", 100%, 60%)"));return(ee=this.bold)!=null&&ee.test(w)&&(De+=";font-weight:600"),(le=this.italic)!=null&&le.test(w)&&(De+=";font-style:italic"),this.cssMemo.set(w,De),De}}};function Lm(w=console,k={}){const j=T(x({},mu),{includes:x({},mu.includes)}),ee={styled:vp.bind(j,w),noStyle:t$.bind(j,w)},le=e$.bind(j);function ve(){return j.loggingConsoleStyle&&j.loggerConsoleStyle?ee.styled:ee.noStyle}return j.create=ve(),{configureLogger(De){var nt;De==="console"?(j.loggerConsoleStyle=mu.loggerConsoleStyle,j.create=ve()):De.type==="console"?(j.loggerConsoleStyle=(nt=De.style)!=null?nt:mu.loggerConsoleStyle,j.create=ve()):De.type==="keyed"?(j.creatExt=lt=>De.keyed(lt.names),j.create=le):De.type==="named"&&(j.creatExt=JG.bind(null,De.named),j.create=le)},configureLogging(De){var nt,lt,Et,on,hn;j.includes.dev=(nt=De.dev)!=null?nt:mu.includes.dev,j.includes.internal=(lt=De.internal)!=null?lt:mu.includes.internal,j.includes.min=(Et=De.min)!=null?Et:mu.includes.min,j.include=(on=De.include)!=null?on:mu.include,j.loggingConsoleStyle=(hn=De.consoleStyle)!=null?hn:mu.loggingConsoleStyle,j.create=ve()},getLogger(){return j.create({names:[]})}}}function JG(w,k){const j=[];for(let{name:ee,key:le}of k.names)j.push(le==null?ee:"".concat(ee," (").concat(le,")"));return w(j)}function e$(w){const k=x(x({},this.includes),this.include(w)),j=this.filtered,ee=this.named.bind(this,w),le=this.creatExt(w),ve=is(k,524),De=is(k,522),nt=is(k,521),lt=is(k,529),Et=is(k,545),on=is(k,265),hn=is(k,268),me=is(k,273),at=is(k,289),Un=is(k,137),Vr=is(k,145),ri=is(k,73),Lr=is(k,81),mi=ve?le.error.bind(le,n0._hmm):j.bind(w,524),Xo=De?le.error.bind(le,n0._todo):j.bind(w,522),Tl=nt?le.error.bind(le,n0._error):j.bind(w,521),Oa=lt?le.error.bind(le,n0.errorDev):j.bind(w,529),Hi=Et?le.error.bind(le,n0.errorPublic):j.bind(w,545),Ba=hn?le.warn.bind(le,n0._kapow):j.bind(w,268),a0=on?le.warn.bind(le,n0._warn):j.bind(w,265),_u=me?le.warn.bind(le,n0.warnDev):j.bind(w,273),Ep=at?le.warn.bind(le,n0.warnPublic):j.bind(w,273),Mp=Un?le.debug.bind(le,n0._debug):j.bind(w,137),xu=Vr?le.debug.bind(le,n0.debugDev):j.bind(w,145),Cp=ri?le.trace.bind(le,n0._trace):j.bind(w,73),vh=Lr?le.trace.bind(le,n0.traceDev):j.bind(w,81),So={_hmm:mi,_todo:Xo,_error:Tl,errorDev:Oa,errorPublic:Hi,_kapow:Ba,_warn:a0,warnDev:_u,warnPublic:Ep,_debug:Mp,debugDev:xu,_trace:Cp,traceDev:vh,lazy:{_hmm:ve?Zi(mi):mi,_todo:De?Zi(Xo):Xo,_error:nt?Zi(Tl):Tl,errorDev:lt?Zi(Oa):Oa,errorPublic:Et?Zi(Hi):Hi,_kapow:hn?Zi(Ba):Ba,_warn:on?Zi(a0):a0,warnDev:me?Zi(_u):_u,warnPublic:at?Zi(Ep):Ep,_debug:Un?Zi(Mp):Mp,debugDev:Vr?Zi(xu):xu,_trace:ri?Zi(Cp):Cp,traceDev:Lr?Zi(vh):vh},named:ee,utilFor:{internal(){return{debug:So._debug,error:So._error,warn:So._warn,trace:So._trace,named(l0,us){return So.named(l0,us).utilFor.internal()}}},dev(){return{debug:So.debugDev,error:So.errorDev,warn:So.warnDev,trace:So.traceDev,named(l0,us){return So.named(l0,us).utilFor.dev()}}},public(){return{error:So.errorPublic,warn:So.warnPublic,debug(l0,us){So._warn('(public "debug" filtered out) '.concat(l0),us)},trace(l0,us){So._warn('(public "trace" filtered out) '.concat(l0),us)},named(l0,us){return So.named(l0,us).utilFor.public()}}}}};return So}function vp(w,k){const j=x(x({},this.includes),this.include(k)),ee=[];let le="";for(let lt=0;lt<k.names.length;lt++){const{name:Et,key:on}=k.names[lt];if(le+=" %c".concat(Et),ee.push(this.style.css(Et)),on!=null){const hn="%c#".concat(on);le+=hn,ee.push(this.style.css(hn))}}const ve=this.filtered,De=this.named.bind(this,k),nt=[le,...ee];return db(ve,k,j,w,nt,NP(nt),De)}function NP(w){const k=w.slice(0);for(let j=1;j<k.length;j++)k[j]+=";background-color:#e0005a;padding:2px;color:white";return k}function t$(w,k){const j=x(x({},this.includes),this.include(k));let ee="";for(let nt=0;nt<k.names.length;nt++){const{name:lt,key:Et}=k.names[nt];ee+=" ".concat(lt),Et!=null&&(ee+="#".concat(Et))}const le=this.filtered,ve=this.named.bind(this,k),De=[ee];return db(le,k,j,w,De,De,ve)}function db(w,k,j,ee,le,ve,De){const nt=is(j,524),lt=is(j,522),Et=is(j,521),on=is(j,529),hn=is(j,545),me=is(j,265),at=is(j,268),Un=is(j,273),Vr=is(j,289),ri=is(j,137),Lr=is(j,145),mi=is(j,73),Xo=is(j,81),Tl=nt?ee.error.bind(ee,...le):w.bind(k,524),Oa=lt?ee.error.bind(ee,...le):w.bind(k,522),Hi=Et?ee.error.bind(ee,...le):w.bind(k,521),Ba=on?ee.error.bind(ee,...le):w.bind(k,529),a0=hn?ee.error.bind(ee,...le):w.bind(k,545),_u=at?ee.warn.bind(ee,...ve):w.bind(k,268),Ep=me?ee.warn.bind(ee,...le):w.bind(k,265),Mp=Un?ee.warn.bind(ee,...le):w.bind(k,273),xu=Vr?ee.warn.bind(ee,...le):w.bind(k,273),Cp=ri?ee.info.bind(ee,...le):w.bind(k,137),vh=Lr?ee.info.bind(ee,...le):w.bind(k,145),So=mi?ee.debug.bind(ee,...le):w.bind(k,73),l0=Xo?ee.debug.bind(ee,...le):w.bind(k,81),us={_hmm:Tl,_todo:Oa,_error:Hi,errorDev:Ba,errorPublic:a0,_kapow:_u,_warn:Ep,warnDev:Mp,warnPublic:xu,_debug:Cp,debugDev:vh,_trace:So,traceDev:l0,lazy:{_hmm:nt?Zi(Tl):Tl,_todo:lt?Zi(Oa):Oa,_error:Et?Zi(Hi):Hi,errorDev:on?Zi(Ba):Ba,errorPublic:hn?Zi(a0):a0,_kapow:at?Zi(_u):_u,_warn:me?Zi(Ep):Ep,warnDev:Un?Zi(Mp):Mp,warnPublic:Vr?Zi(xu):xu,_debug:ri?Zi(Cp):Cp,debugDev:Lr?Zi(vh):vh,_trace:mi?Zi(So):So,traceDev:Xo?Zi(l0):l0},named:De,utilFor:{internal(){return{debug:us._debug,error:us._error,warn:us._warn,trace:us._trace,named(_h,xh){return us.named(_h,xh).utilFor.internal()}}},dev(){return{debug:us.debugDev,error:us.errorDev,warn:us.warnDev,trace:us.traceDev,named(_h,xh){return us.named(_h,xh).utilFor.dev()}}},public(){return{error:us.errorPublic,warn:us.warnPublic,debug(_h,xh){us._warn('(public "debug" filtered out) '.concat(_h),xh)},trace(_h,xh){us._warn('(public "trace" filtered out) '.concat(_h),xh)},named(_h,xh){return us.named(_h,xh).utilFor.public()}}}}};return us}var IP=Lm(console,{_debug:function(){},_error:function(){}});IP.configureLogging({dev:!0,min:64});var H5=IP.getLogger().named("Theatre.js (default logger)").utilFor.dev(),fb=new WeakMap;function n$(w){const k=fb.get(w);if(k)return k;const j=new Map;return fb.set(w,j),kP([],w,j),j}function kP(w,k,j){for(const[ee,le]of Object.entries(k.props))if(!V3(le)){const ve=[...w,ee];j.set(JSON.stringify(ve),j.size),pb(ve,le,j)}for(const[ee,le]of Object.entries(k.props))if(V3(le)){const ve=[...w,ee];j.set(JSON.stringify(ve),j.size),pb(ve,le,j)}}function pb(w,k,j){if(k.type==="compound")kP(w,k,j);else{if(k.type==="enum")throw new Error("Enums aren't supported yet");j.set(JSON.stringify(w),j.size)}}function DP(w){return typeof w=="object"&&w!==null&&Object.keys(w).length===0}var r$=class{constructor(w,k,j,ee,le){this.sheetTemplate=w,L(this,"address"),L(this,"type","Theatre_SheetObjectTemplate"),L(this,"_config"),L(this,"_temp_actions_atom"),L(this,"_cache",new hh),L(this,"project"),L(this,"pointerToSheetState"),L(this,"pointerToStaticOverrides"),this.address=T(x({},w.address),{objectKey:k}),this._config=new xo.Atom(ee),this._temp_actions_atom=new xo.Atom(le),this.project=w.project,this.pointerToSheetState=this.sheetTemplate.project.pointers.historic.sheetsById[this.address.sheetId],this.pointerToStaticOverrides=this.pointerToSheetState.staticOverrides.byObject[this.address.objectKey]}get staticConfig(){return this._config.get()}get configPointer(){return this._config.pointer}get _temp_actions(){return this._temp_actions_atom.get()}get _temp_actionsPointer(){return this._temp_actions_atom.pointer}createInstance(w,k,j){return this._config.set(j),new QG(w,this,k)}reconfigure(w){this._config.set(w)}_temp_setActions(w){this._temp_actions_atom.set(w)}getDefaultValues(){return this._cache.get("getDefaultValues()",()=>(0,xo.prism)(()=>{const w=(0,xo.val)(this.configPointer);return $x(w)}))}getStaticValues(){return this._cache.get("getStaticValues",()=>(0,xo.prism)(()=>{var w;const k=(w=(0,xo.val)(this.pointerToStaticOverrides))!=null?w:{};return(0,xo.val)(this.configPointer).deserializeAndSanitize(k)||{}}))}getArrayOfValidSequenceTracks(){return this._cache.get("getArrayOfValidSequenceTracks",()=>(0,xo.prism)(()=>{const w=this.project.pointers.historic.sheetsById[this.address.sheetId],k=(0,xo.val)(w.sequence.tracksByObject[this.address.objectKey].trackIdByPropPath);if(!k)return Ne;const j=[];if(!k)return Ne;const ee=(0,xo.val)(this.configPointer),le=Object.entries(k);for(const[De,nt]of le){const lt=FP(De);if(!lt)continue;const Et=$5(ee,lt);Et&&ZG(Et)&&j.push({pathToProp:lt,trackId:nt})}const ve=n$(ee);return j.sort((De,nt)=>{const lt=De.pathToProp,Et=nt.pathToProp,on=ve.get(JSON.stringify(lt)),hn=ve.get(JSON.stringify(Et));return on>hn?1:-1}),j.length===0?Ne:j}))}getMapOfValidSequenceTracks_forStudio(){return this._cache.get("getMapOfValidSequenceTracks_forStudio",()=>(0,xo.prism)(()=>{const w=(0,xo.val)(this.getArrayOfValidSequenceTracks());let k={};for(const{pathToProp:j,trackId:ee}of w)Bd(k,j,ee);return k}))}getStaticButNotSequencedOverrides(){return this._cache.get("getStaticButNotSequencedOverrides",()=>(0,xo.prism)(()=>{const w=(0,xo.val)(this.getStaticValues()),k=(0,xo.val)(this.getArrayOfValidSequenceTracks()),j=H7(w);for(const{pathToProp:ee}of k){hb(j,ee);let le=ee.slice(0,-1);for(;le.length>0;){const ve=Od(j,le);if(!DP(ve))break;hb(j,le),le=le.slice(0,-1)}}if(!DP(j))return j}))}getDefaultsAtPointer(w){const{path:k}=(0,xo.getPointerParts)(w),j=this.getDefaultValues().getValue();return Od(j,k)}};function FP(w){try{return JSON.parse(w)}catch{H5.warn("property ".concat(JSON.stringify(w)," cannot be parsed. Skipping."));return}}var OP=Jt,i$=PP(w=>JSON.stringify(w));O(z());var BP=class extends Error{},G3=class extends BP{},LP=Jt,UP=Jt,s$=Jt,qo=Jt;function ph(){let w,k;const j=new Promise((le,ve)=>{w=De=>{le(De),ee.status="resolved"},k=De=>{ve(De),ee.status="rejected"}}),ee={resolve:w,reject:k,promise:j,status:"pending"};return ee}var mb=()=>{},$3=mb,o$=Jt,a$=class{constructor(){L(this,"_stopPlayCallback",$3),L(this,"_state",new o$.Atom({position:0,playing:!1})),L(this,"statePointer"),this.statePointer=this._state.pointer}destroy(){}pause(){this._stopPlayCallback(),this.playing=!1,this._stopPlayCallback=$3}gotoPosition(w){this._updatePositionInState(w)}_updatePositionInState(w){this._state.setByPointer(k=>k.position,w)}getCurrentPosition(){return this._state.get().position}get playing(){return this._state.get().playing}set playing(w){this._state.setByPointer(k=>k.playing,w)}play(w,k,j,ee,le){this.playing&&this.pause(),this.playing=!0;const ve=k[1]-k[0];{const me=this.getCurrentPosition();me<k[0]||me>k[1]?ee==="normal"||ee==="alternate"?this._updatePositionInState(k[0]):(ee==="reverse"||ee==="alternateReverse")&&this._updatePositionInState(k[1]):ee==="normal"||ee==="alternate"?me===k[1]&&this._updatePositionInState(k[0]):me===k[0]&&this._updatePositionInState(k[1])}const De=ph(),nt=le.time,lt=ve*w;let Et=this.getCurrentPosition()-k[0];(ee==="reverse"||ee==="alternateReverse")&&(Et=k[1]-this.getCurrentPosition());const on=me=>{const Un=Math.max(me-nt,0)/1e3,Vr=Math.min(Un*j+Et,lt);if(Vr!==lt){const ri=Math.floor(Vr/ve);let Lr=Vr/ve%1*ve;if(ee!=="normal")if(ee==="reverse")Lr=ve-Lr;else{const mi=ri%2===0;ee==="alternate"?mi||(Lr=ve-Lr):mi&&(Lr=ve-Lr)}this._updatePositionInState(Lr+k[0]),hn()}else{if(ee==="normal")this._updatePositionInState(k[1]);else if(ee==="reverse")this._updatePositionInState(k[0]);else{const ri=(w-1)%2===0;ee==="alternate"?ri?this._updatePositionInState(k[1]):this._updatePositionInState(k[0]):ri?this._updatePositionInState(k[0]):this._updatePositionInState(k[1])}this.playing=!1,De.resolve(!0)}};this._stopPlayCallback=()=>{le.offThisOrNextTick(on),le.offNextTick(on),this.playing&&De.resolve(!1)};const hn=()=>le.onNextTick(on);return le.onThisOrNextTick(on),De.promise}playDynamicRange(w,k){this.playing&&this.pause(),this.playing=!0;const j=ph(),ee=w.keepHot();j.promise.then(ee,ee);let le=k.time;const ve=nt=>{const lt=Math.max(nt-le,0);le=nt;const Et=lt/1e3,on=this.getCurrentPosition(),hn=w.getValue();if(on<hn[0]||on>hn[1])this.gotoPosition(hn[0]);else{let me=on+Et;me>hn[1]&&(me=hn[0]+(me-hn[1])),this.gotoPosition(me)}De()};this._stopPlayCallback=()=>{k.offThisOrNextTick(ve),k.offNextTick(ve),j.resolve(!1)};const De=()=>k.onNextTick(ve);return k.onThisOrNextTick(ve),j.promise}},zP=Jt,l$="__TheatreJS_StudioBundle",j5="__TheatreJS_CoreBundle",VP="__TheatreJS_Notifications",W5=w=>(...k)=>{var j;switch(w){case"success":{H5.debug(k.slice(0,2).join(`
`));break}case"info":{H5.debug(k.slice(0,2).join(`
`));break}case"warning":{H5.warn(k.slice(0,2).join(`
`));break}}return typeof window<"u"?(j=window[VP])==null?void 0:j.notify[w](...k):void 0},_p={warning:W5("warning"),success:W5("success"),info:W5("info"),error:W5("error")};typeof window<"u"&&(window.addEventListener("error",w=>{_p.error("An error occurred","<pre>".concat(w.message,`</pre>

See **console** for details.`))}),window.addEventListener("unhandledrejection",w=>{_p.error("An error occurred","<pre>".concat(w.reason,`</pre>

See **console** for details.`))}));var GP=class{constructor(w,k,j){this._decodedBuffer=w,this._audioContext=k,this._nodeDestination=j,L(this,"_mainGain"),L(this,"_state",new zP.Atom({position:0,playing:!1})),L(this,"statePointer"),L(this,"_stopPlayCallback",$3),this.statePointer=this._state.pointer,this._mainGain=this._audioContext.createGain(),this._mainGain.connect(this._nodeDestination)}playDynamicRange(w,k){const j=ph();this._playing&&this.pause(),this._playing=!0;let ee;const le=()=>{ee==null||ee(),ee=this._loopInRange(w.getValue(),k).stop},ve=w.onStale(le);return le(),this._stopPlayCallback=()=>{ee==null||ee(),ve(),j.resolve(!1)},j.promise}_loopInRange(w,k){let ee=this.getCurrentPosition();const le=w[1]-w[0];ee<w[0]||ee>w[1]?this._updatePositionInState(w[0]):ee===w[1]&&this._updatePositionInState(w[0]),ee=this.getCurrentPosition();const ve=this._audioContext.createBufferSource();ve.buffer=this._decodedBuffer,ve.connect(this._mainGain),ve.playbackRate.value=1,ve.loop=!0,ve.loopStart=w[0],ve.loopEnd=w[1];const De=k.time;let nt=ee-w[0];ve.start(0,ee);const lt=hn=>{let Vr=(Math.max(hn-De,0)/1e3*1+nt)/le%1*le;this._updatePositionInState(Vr+w[0]),Et()},Et=()=>k.onNextTick(lt);return k.onThisOrNextTick(lt),{stop:()=>{ve.stop(),ve.disconnect(),k.offThisOrNextTick(lt),k.offNextTick(lt)}}}get _playing(){return this._state.get().playing}set _playing(w){this._state.setByPointer(k=>k.playing,w)}destroy(){}pause(){this._stopPlayCallback(),this._playing=!1,this._stopPlayCallback=$3}gotoPosition(w){this._updatePositionInState(w)}_updatePositionInState(w){this._state.reduce(k=>T(x({},k),{position:w}))}getCurrentPosition(){return this._state.get().position}play(w,k,j,ee,le){this._playing&&this.pause(),this._playing=!0;let ve=this.getCurrentPosition();const De=k[1]-k[0];if(ee!=="normal")throw new G3('Audio-controlled sequences can only be played in the "normal" direction. '+"'".concat(ee,"' given."));ve<k[0]||ve>k[1]?this._updatePositionInState(k[0]):ve===k[1]&&this._updatePositionInState(k[0]),ve=this.getCurrentPosition();const nt=ph(),lt=this._audioContext.createBufferSource();lt.buffer=this._decodedBuffer,lt.connect(this._mainGain),lt.playbackRate.value=j,w>1e3&&(_p.warning("Can't play sequences with audio more than 1000 times","The sequence will still play, but only 1000 times. The `iterationCount: ".concat(w,"` provided to `sequence.play()`\nis too high for a sequence with audio.\n\nTo fix this, either set `iterationCount` to a lower value, or remove the audio from the sequence."),[{url:"https://www.theatrejs.com/docs/latest/manual/audio",title:"Using Audio"},{url:"https://www.theatrejs.com/docs/latest/api/core#sequence.attachaudio",title:"Audio API"}]),w=1e3),w>1&&(lt.loop=!0,lt.loopStart=k[0],lt.loopEnd=k[1]);const Et=le.time;let on=ve-k[0];const hn=De*w;lt.start(0,ve,hn-on);const me=Vr=>{const Lr=Math.max(Vr-Et,0)/1e3,mi=Math.min(Lr*j+on,hn);if(mi!==hn){let Xo=mi/De%1*De;this._updatePositionInState(Xo+k[0]),Un()}else this._updatePositionInState(k[1]),this._playing=!1,at(),nt.resolve(!0)},at=()=>{lt.stop(),lt.disconnect()};this._stopPlayCallback=()=>{at(),le.offThisOrNextTick(me),le.offNextTick(me),this._playing&&nt.resolve(!1)};const Un=()=>le.onNextTick(me);return le.onThisOrNextTick(me),nt.promise}},c$=Jt,$P=0;function Vd(w){var k;const j=De=>{ee.tick(De)},ee=new c$.Ticker({onActive(){var De;(De=w==null?void 0:w.start)==null||De.call(w)},onDormant(){var De;(De=w==null?void 0:w.stop)==null||De.call(w)}}),le={tick:j,id:$P++,name:(k=w==null?void 0:w.name)!=null?k:"CustomRafDriver-".concat($P),type:"Theatre_RafDriver_PublicAPI"},ve={type:"Theatre_RafDriver_PrivateAPI",publicApi:le,ticker:ee,start:w==null?void 0:w.start,stop:w==null?void 0:w.stop};return Fe(le,ve),le}function gb(){let w=null;const ee=Vd({name:"DefaultCoreRafDriver",start:()=>{if(typeof window<"u"){const le=ve=>{ee.tick(ve),w=window.requestAnimationFrame(le)};w=window.requestAnimationFrame(le)}else ee.tick(0),setTimeout(()=>ee.tick(1),0)},stop:()=>{typeof window<"u"&&w!==null&&window.cancelAnimationFrame(w)}});return ee}var H3;function yb(){return H3||jP(gb()),H3}function HP(){return yb().ticker}function jP(w){if(H3)throw new Error("`setCoreRafDriver()` is already called.");H3=Xe(w)}var WP=class{get type(){return"Theatre_Sequence_PublicAPI"}constructor(w){Fe(this,w)}play(w){const k=Xe(this);if(k._project.isReady()){const j=w!=null&&w.rafDriver?Xe(w.rafDriver).ticker:HP();return k.play(w??{},j)}else{const j=ph();return j.resolve(!0),j.promise}}pause(){Xe(this).pause()}get position(){return Xe(this).position}set position(w){Xe(this).position=w}__experimental_getKeyframes(w){return Xe(this).getKeyframesOfSimpleProp(w)}async attachAudio(w){const{audioContext:k,destinationNode:j,decodedBuffer:ee,gainNode:le}=await qP(w),ve=new GP(ee,k,le);return Xe(this).replacePlaybackController(ve),{audioContext:k,destinationNode:j,decodedBuffer:ee,gainNode:le}}get pointer(){return Xe(this).pointer}};async function qP(w){function k(){if(w.audioContext)return Promise.resolve(w.audioContext);const Et=new AudioContext;return Et.state==="running"||typeof window>"u"?Promise.resolve(Et):new Promise(on=>{const hn=()=>{Et.resume().catch(Un=>{console.error(Un)})},me=["mousedown","keydown","touchstart"],at={capture:!0,passive:!1};me.forEach(Un=>{window.addEventListener(Un,hn,at)}),Et.addEventListener("statechange",()=>{Et.state==="running"&&(me.forEach(Un=>{window.removeEventListener(Un,hn,at)}),on(Et))})})}async function j(){if(w.source instanceof AudioBuffer)return w.source;const Et=ph();if(typeof w.source!="string")throw new Error("Error validating arguments to sequence.attachAudio(). args.source must either be a string or an instance of AudioBuffer.");let on;try{on=await fetch(w.source)}catch(Un){throw console.error(Un),new Error("Could not fetch '".concat(w.source,"'. Network error logged above."))}let hn;try{hn=await on.arrayBuffer()}catch(Un){throw console.error(Un),new Error("Could not read '".concat(w.source,"' as an arrayBuffer."))}(await ee).decodeAudioData(hn,Et.resolve,Et.reject);let at;try{at=await Et.promise}catch(Un){throw console.error(Un),new Error("Could not decode ".concat(w.source," as an audio file."))}return at}const ee=k(),le=j(),[ve,De]=await Promise.all([ee,le]),nt=w.destinationNode||ve.destination,lt=ve.createGain();return lt.connect(nt),{audioContext:ve,decodedBuffer:De,gainNode:lt,destinationNode:nt}}var u$=h$("Theatre_SheetObject");function h$(w){return k=>typeof k=="object"&&!!k&&k.type===w}var XP=class{constructor(w,k,j,ee,le){this._project=w,this._sheet=k,this._lengthD=j,this._subUnitsPerUnitD=ee,L(this,"address"),L(this,"publicApi"),L(this,"_playbackControllerBox"),L(this,"_prismOfStatePointer"),L(this,"_positionD"),L(this,"_positionFormatterD"),L(this,"_playableRangeD"),L(this,"pointer",(0,s$.pointer)({root:this,path:[]})),L(this,"$$isPointerToPrismProvider",!0),L(this,"_logger"),L(this,"closestGridPosition",ve=>{const nt=1/this.subUnitsPerUnit;return parseFloat((Math.round(ve/nt)*nt).toFixed(3))}),this._logger=w._logger.named("Sheet",k.address.sheetId).named("Instance",k.address.sheetInstanceId),this.address=T(x({},this._sheet.address),{sequenceName:"default"}),this.publicApi=new WP(this),this._playbackControllerBox=new UP.Atom(le??new a$),this._prismOfStatePointer=(0,qo.prism)(()=>this._playbackControllerBox.prism.getValue().statePointer),this._positionD=(0,qo.prism)(()=>{const ve=this._prismOfStatePointer.getValue();return(0,qo.val)(ve.position)}),this._positionFormatterD=(0,qo.prism)(()=>{const ve=(0,qo.val)(this._subUnitsPerUnitD);return new YP(ve)})}get type(){return"Theatre_Sequence"}pointerToPrism(w){const{path:k}=(0,LP.getPointerParts)(w);if(k.length===0)return(0,qo.prism)(()=>({length:(0,qo.val)(this.pointer.length),playing:(0,qo.val)(this.pointer.playing),position:(0,qo.val)(this.pointer.position),subUnitsPerUnit:(0,qo.val)(this.pointer.subUnitsPerUnit)}));if(k.length>1)return(0,qo.prism)(()=>{});const[j]=k;return j==="length"?this._lengthD:j==="subUnitsPerUnit"?this._subUnitsPerUnitD:j==="position"?this._positionD:j==="playing"?(0,qo.prism)(()=>(0,qo.val)(this._prismOfStatePointer.getValue().playing)):(0,qo.prism)(()=>{})}getKeyframesOfSimpleProp(w){const{path:k,root:j}=(0,LP.getPointerParts)(w);if(!u$(j))throw new G3("Argument prop must be a pointer to a SheetObject property");const ee=(0,qo.val)(this._project.pointers.historic.sheetsById[this._sheet.address.sheetId].sequence.tracksByObject[j.address.objectKey]);if(!ee)return[];const{trackData:le,trackIdByPropPath:ve}=ee,De=i$(k),nt=ve[De];if(!nt)return[];const lt=le[nt];return lt?lt.keyframes:[]}get positionFormatter(){return this._positionFormatterD.getValue()}get prismOfStatePointer(){return this._prismOfStatePointer}get length(){return this._lengthD.getValue()}get positionPrism(){return this._positionD}get position(){return this._playbackControllerBox.get().getCurrentPosition()}get subUnitsPerUnit(){return this._subUnitsPerUnitD.getValue()}get positionSnappedToGrid(){return this.closestGridPosition(this.position)}set position(w){let k=w;this.pause(),k>this.length&&(k=this.length);const j=this.length;this._playbackControllerBox.get().gotoPosition(k>j?j:k)}getDurationCold(){return this._lengthD.getValue()}get playing(){return(0,qo.val)(this._playbackControllerBox.get().statePointer.playing)}_makeRangeFromSequenceTemplate(){return(0,qo.prism)(()=>[0,(0,qo.val)(this._lengthD)])}playDynamicRange(w,k){return this._playbackControllerBox.get().playDynamicRange(w,k)}async play(w,k){const j=this.length,ee=w&&w.range?w.range:[0,j],le=w&&typeof w.iterationCount=="number"?w.iterationCount:1,ve=w&&typeof w.rate<"u"?w.rate:1,De=w&&w.direction?w.direction:"normal";return await this._play(le,[ee[0],ee[1]],ve,De,k)}_play(w,k,j,ee,le){return this._playbackControllerBox.get().play(w,k,j,ee,le)}pause(){this._playbackControllerBox.get().pause()}replacePlaybackController(w){this.pause();const k=this._playbackControllerBox.get();this._playbackControllerBox.set(w);const j=k.getCurrentPosition();k.destroy(),w.gotoPosition(j)}},YP=class{constructor(w){this._fps=w}formatSubUnitForGrid(w){const k=w%1,j=1/this._fps;return Math.round(k/j)+"f"}formatFullUnitForGrid(w){let k=w,j="";if(k>=i0){const le=Math.floor(k/i0);j+=le+"h",k=k%i0}if(k>=bp){const le=Math.floor(k/bp);j+=le+"m",k=k%bp}if(k>=xp){const le=Math.floor(k/xp);j+=le+"s",k=k%xp}const ee=1/this._fps;if(k>=ee){const le=Math.floor(k/ee);j+=le+"f",k=k%ee}return j.length===0?"0s":j}formatForPlayhead(w){let k=w,j="";if(k>=i0){const le=Math.floor(k/i0);j+=z3(le.toString(),2,"0")+"h",k=k%i0}if(k>=bp){const le=Math.floor(k/bp);j+=z3(le.toString(),2,"0")+"m",k=k%bp}else j.length>0&&(j+="00m");if(k>=xp){const le=Math.floor(k/xp);j+=z3(le.toString(),2,"0")+"s",k=k%xp}else j+="00s";const ee=1/this._fps;if(k>=ee){const le=Math.round(k/ee);j+=z3(le.toString(),2,"0")+"f",k=k%ee}else k/ee>.98?(j+=z3(1 .toString(),2,"0")+"f",k=k%ee):j+="00f";return j.length===0?"00s00f":j}formatBasic(w){return w.toFixed(2)+"s"}},xp=1,bp=xp*60,i0=bp*60,vb={};R(vb,{boolean:()=>nN,compound:()=>yu,file:()=>JP,image:()=>Dr,number:()=>$0,rgba:()=>tN,string:()=>rN,stringLiteral:()=>g$});function bo(w,k){return w.length<=k?w:w.substr(0,k-3)+"..."}var d$=w=>typeof w=="string"?'string("'.concat(bo(w,10),'")'):typeof w=="number"?"number(".concat(bo(String(w),10),")"):w===null?"null":w===void 0?"undefined":typeof w=="boolean"?String(w):Array.isArray(w)?"array":typeof w=="object"?"object":"unknown",KP=d$;function Le(w,{removeAlphaIfOpaque:k=!1}={}){const j=(w.a*255|256).toString(16).slice(1),ee=(w.r*255|256).toString(16).slice(1)+(w.g*255|256).toString(16).slice(1)+(w.b*255|256).toString(16).slice(1)+(k&&j==="ff"?"":j);return"#".concat(ee)}function _b(w){return T(x({},w),{toString(){return Le(this,{removeAlphaIfOpaque:!0})}})}function f$(w){return Object.fromEntries(Object.entries(w).map(([k,j])=>[k,I3(j,0,1)]))}function p$(w){function k(j){return j>=.0031308?1.055*j**(1/2.4)-.055:12.92*j}return f$({r:k(w.r),g:k(w.g),b:k(w.b),a:w.a})}function gu(w){function k(j){return j>=.04045?((j+.055)/(1+.055))**2.4:j/12.92}return{r:k(w.r),g:k(w.g),b:k(w.b),a:w.a}}function ZP(w){let k=.4122214708*w.r+.5363325363*w.g+.0514459929*w.b,j=.2119034982*w.r+.6806995451*w.g+.1073969566*w.b,ee=.0883024619*w.r+.2817188376*w.g+.6299787005*w.b,le=Math.cbrt(k),ve=Math.cbrt(j),De=Math.cbrt(ee);return{L:.2104542553*le+.793617785*ve-.0040720468*De,a:1.9779984951*le-2.428592205*ve+.4505937099*De,b:.0259040371*le+.7827717662*ve-.808675766*De,alpha:w.a}}function Rr(w){let k=w.L+.3963377774*w.a+.2158037573*w.b,j=w.L-.1055613458*w.a-.0638541728*w.b,ee=w.L-.0894841775*w.a-1.291485548*w.b,le=k*k*k,ve=j*j*j,De=ee*ee*ee;return{r:4.0767416621*le-3.3077115913*ve+.2309699292*De,g:-1.2684380046*le+2.6097574011*ve-.3413193965*De,b:-.0041960863*le-.7034186147*ve+1.707614701*De,a:w.alpha}}var mh=Symbol("TheatrePropType_Basic");function j3(w){return typeof w=="object"&&!!w&&w[mh]==="TheatrePropType"}function q5(w){if(typeof w=="number")return $0(w);if(typeof w=="boolean")return nN(w);if(typeof w=="string")return rN(w);if(typeof w=="object"&&w){if(j3(w))return w;if(mA(w))return yu(w);throw new G3("This value is not a valid prop type: ".concat(KP(w)))}else throw new G3("This value is not a valid prop type: ".concat(KP(w)))}function QP(w){const k={};for(const j of Object.keys(w)){const ee=w[j];j3(ee)?k[j]=ee:k[j]=q5(ee)}return k}var yu=(w,k={})=>{const j=QP(w),ee=new WeakMap;return{type:"compound",props:j,valueType:null,[mh]:"TheatrePropType",label:k.label,default:rb(j,ve=>ve.default),deserializeAndSanitize:ve=>{if(typeof ve!="object"||!ve)return;if(ee.has(ve))return ee.get(ve);const De={};let nt=!1;for(const[lt,Et]of Object.entries(j))if(Object.prototype.hasOwnProperty.call(ve,lt)){const on=Et.deserializeAndSanitize(ve[lt]);on!=null&&(nt=!0,De[lt]=on)}if(ee.set(ve,De),nt)return De}}},JP=(w,k={})=>{const j=(ee,le,ve)=>{var De;return{type:"file",id:((De=k.interpolate)!=null?De:zm)(ee.id,le.id,ve)}};return{type:"file",default:{type:"file",id:w},valueType:null,[mh]:"TheatrePropType",label:k.label,interpolate:j,deserializeAndSanitize:Sp}},Sp=w=>{if(!w)return;let k=!0;if(typeof w.id!="string"&&![null,void 0].includes(w.id)&&(k=!1),w.type!=="file"&&(k=!1),!!k)return w},Dr=(w,k={})=>{const j=(ee,le,ve)=>{var De;return{type:"image",id:((De=k.interpolate)!=null?De:zm)(ee.id,le.id,ve)}};return{type:"image",default:{type:"image",id:w},valueType:null,[mh]:"TheatrePropType",label:k.label,interpolate:j,deserializeAndSanitize:xb}},xb=w=>{if(!w)return;let k=!0;if(typeof w.id!="string"&&![null,void 0].includes(w.id)&&(k=!1),w.type!=="image"&&(k=!1),!!k)return w},$0=(w,k={})=>{var j;return T(x({type:"number",valueType:0,default:w,[mh]:"TheatrePropType"},k||{}),{label:k.label,nudgeFn:(j=k.nudgeFn)!=null?j:sN,nudgeMultiplier:typeof k.nudgeMultiplier=="number"?k.nudgeMultiplier:void 0,interpolate:eN,deserializeAndSanitize:Um(k.range)})},Um=w=>w?k=>{if(typeof k=="number"&&isFinite(k))return I3(k,w[0],w[1])}:X5,X5=w=>typeof w=="number"&&isFinite(w)?w:void 0,eN=(w,k,j)=>w+j*(k-w),tN=(w={r:0,g:0,b:0,a:1},k={})=>{const j={};for(const ee of["r","g","b","a"])j[ee]=Math.min(Math.max(w[ee],0),1);return{type:"rgba",valueType:null,default:_b(j),[mh]:"TheatrePropType",label:k.label,interpolate:Qn,deserializeAndSanitize:bb}},bb=w=>{if(!w)return;let k=!0;for(const ee of["r","g","b","a"])(!Object.prototype.hasOwnProperty.call(w,ee)||typeof w[ee]!="number")&&(k=!1);if(!k)return;const j={};for(const ee of["r","g","b","a"])j[ee]=Math.min(Math.max(w[ee],0),1);return _b(j)},Qn=(w,k,j)=>{const ee=ZP(gu(w)),le=ZP(gu(k)),ve={L:(1-j)*ee.L+j*le.L,a:(1-j)*ee.a+j*le.a,b:(1-j)*ee.b+j*le.b,alpha:(1-j)*ee.alpha+j*le.alpha},De=p$(Rr(ve));return _b(De)},nN=(w,k={})=>{var j;return{type:"boolean",default:w,valueType:null,[mh]:"TheatrePropType",label:k.label,interpolate:(j=k.interpolate)!=null?j:zm,deserializeAndSanitize:m$}},m$=w=>typeof w=="boolean"?w:void 0;function zm(w){return w}var rN=(w,k={})=>{var j;return{type:"string",default:w,valueType:null,[mh]:"TheatrePropType",label:k.label,interpolate:(j=k.interpolate)!=null?j:zm,deserializeAndSanitize:iN}};function iN(w){return typeof w=="string"?w:void 0}function g$(w,k,j={}){var ee,le;return{type:"stringLiteral",default:w,valuesAndLabels:x({},k),[mh]:"TheatrePropType",valueType:null,as:(ee=j.as)!=null?ee:"menu",label:j.label,interpolate:(le=j.interpolate)!=null?le:zm,deserializeAndSanitize(ve){if(typeof ve=="string"&&Object.prototype.hasOwnProperty.call(k,ve))return ve}}}var sN=({config:w,deltaX:k,deltaFraction:j,magnitude:ee})=>{var le;const{range:ve}=w;return!w.nudgeMultiplier&&ve&&!ve.includes(1/0)&&!ve.includes(-1/0)?j*(ve[1]-ve[0])*ee:k*ee*((le=w.nudgeMultiplier)!=null?le:1)},oN=w=>w.replace(/^[\s\/]*/,"").replace(/[\s\/]*$/,"").replace(/\s*\/\s*/g," / ");function Y5(w,k){return oN(w)}O(ne());var y$=class{get type(){return"Theatre_Sheet_PublicAPI"}constructor(w){Fe(this,w)}object(w,k,j){const ee=Xe(this),le=Y5(w),ve=ee.getObject(le),De=null,nt=j==null?void 0:j.__actions__THIS_API_IS_UNSTABLE_AND_WILL_CHANGE_IN_THE_NEXT_VERSION;if(ve)return nt&&ve.template._temp_setActions(nt),ve.publicApi;{const lt=yu(k);return ee.createObject(le,De,lt,nt).publicApi}}__experimental_getExistingObject(w){const k=Xe(this),j=Y5(w),ee=k.getObject(j);return ee==null?void 0:ee.publicApi}get sequence(){return Xe(this).getSequence().publicApi}get project(){return Xe(this).project.publicApi}get address(){return x({},Xe(this).address)}detachObject(w){const k=Xe(this),j=Y5(w);if(!k.getObject(j)){_p.warning(`Couldn't delete object "`.concat(j,'"'),'There is no object with key "'.concat(j,`".

To fix this, make sure you are calling \`sheet.deleteObject("`).concat(j,'")` with the correct key.')),console.warn('Object key "'.concat(j,'" does not exist.'));return}k.deleteObject(j)}},Vm=Jt,v$=class{constructor(w,k){this.template=w,this.instanceId=k,L(this,"_objects",new Vm.Atom({})),L(this,"_sequence"),L(this,"address"),L(this,"publicApi"),L(this,"project"),L(this,"objectsP",this._objects.pointer),L(this,"type","Theatre_Sheet"),L(this,"_logger"),this._logger=w.project._logger.named("Sheet",k),this._logger._trace("creating sheet"),this.project=w.project,this.address=T(x({},w.address),{sheetInstanceId:this.instanceId}),this.publicApi=new y$(this)}createObject(w,k,j,ee={}){const ve=this.template.getObjectTemplate(w,k,j,ee).createInstance(this,k,j);return this._objects.setByPointer(De=>De[w],ve),ve}getObject(w){return this._objects.get()[w]}deleteObject(w){this._objects.reduce(k=>{const j=x({},k);return delete j[w],j})}getSequence(){if(!this._sequence){const w=(0,Vm.prism)(()=>{const j=(0,Vm.val)(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.length);return aN(j)}),k=(0,Vm.prism)(()=>{const j=(0,Vm.val)(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.subUnitsPerUnit);return lN(j)});this._sequence=new XP(this.template.project,this,w,k)}return this._sequence}},aN=w=>typeof w=="number"&&isFinite(w)&&w>0?w:10,lN=w=>typeof w=="number"&&OG(w)&&w>=1&&w<=1e3?w:30,Sb=class{constructor(w,k){this.project=w,L(this,"type","Theatre_SheetTemplate"),L(this,"address"),L(this,"_instances",new OP.Atom({})),L(this,"instancesP",this._instances.pointer),L(this,"_objectTemplates",new OP.Atom({})),L(this,"objectTemplatesP",this._objectTemplates.pointer),this.address=T(x({},w.address),{sheetId:k})}getInstance(w){let k=this._instances.get()[w];return k||(k=new v$(this,w),this._instances.setByPointer(j=>j[w],k)),k}getObjectTemplate(w,k,j,ee){let le=this._objectTemplates.get()[w];return le||(le=new r$(this,w,k,j,ee),this._objectTemplates.setByPointer(ve=>ve[w],le)),le}},wb=Jt,cN=Jt,_$=w=>new Promise(k=>setTimeout(k,w)),x$=_$;function js(w){for(var k=arguments.length,j=Array(k>1?k-1:0),ee=1;ee<k;ee++)j[ee-1]=arguments[ee];throw Error("[Immer] minified error nr: "+w+(j.length?" "+j.map(function(le){return"'"+le+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Sc(w){return!!w&&!!w[ga]}function Gd(w){return!!w&&(function(k){if(!k||typeof k!="object")return!1;var j=Object.getPrototypeOf(k);if(j===null)return!0;var ee=Object.hasOwnProperty.call(j,"constructor")&&j.constructor;return ee===Object||typeof ee=="function"&&Function.toString.call(ee)===Nb}(w)||Array.isArray(w)||!!w[Pb]||!!w.constructor[Pb]||Q5(w)||J5(w))}function Tb(w){return Sc(w)||js(23,w),w[ga].t}function s0(w,k,j){j===void 0&&(j=!1),$d(w)===0?(j?Object.keys:ov)(w).forEach(function(ee){j&&typeof ee=="symbol"||k(ee,w[ee],w)}):w.forEach(function(ee,le){return k(le,ee,w)})}function $d(w){var k=w[ga];return k?k.i>3?k.i-4:k.i:Array.isArray(w)?1:Q5(w)?2:J5(w)?3:0}function K5(w,k){return $d(w)===2?w.has(k):Object.prototype.hasOwnProperty.call(w,k)}function uN(w,k){return $d(w)===2?w.get(k):w[k]}function Z5(w,k,j){var ee=$d(w);ee===2?w.set(k,j):ee===3?(w.delete(k),w.add(j)):w[k]=j}function hN(w,k){return w===k?w!==0||1/w==1/k:w!=w&&k!=k}function Q5(w){return fN&&w instanceof Map}function J5(w){return pN&&w instanceof Set}function o0(w){return w.o||w.t}function Qa(w){if(Array.isArray(w))return Array.prototype.slice.call(w);var k=mN(w);delete k[ga];for(var j=ov(k),ee=0;ee<j.length;ee++){var le=j[ee],ve=k[le];ve.writable===!1&&(ve.writable=!0,ve.configurable=!0),(ve.get||ve.set)&&(k[le]={configurable:!0,writable:!0,enumerable:ve.enumerable,value:w[le]})}return Object.create(Object.getPrototypeOf(w),k)}function W3(w,k){return k===void 0&&(k=!1),Eb(w)||Sc(w)||!Gd(w)||($d(w)>1&&(w.set=w.add=w.clear=w.delete=ev),Object.freeze(w),k&&s0(w,function(j,ee){return W3(ee,!0)},!0)),w}function ev(){js(2)}function Eb(w){return w==null||typeof w!="object"||Object.isFrozen(w)}function vu(w){var k=gN[w];return k||js(18,w),k}function Mb(){return gh}function tv(w,k){k&&(vu("Patches"),w.u=[],w.s=[],w.v=k)}function Gm(w){ks(w),w.p.forEach(dN),w.p=null}function ks(w){w===gh&&(gh=w.l)}function Cb(w){return gh={p:[],l:gh,h:w,m:!0,_:0}}function dN(w){var k=w[ga];k.i===0||k.i===1?k.j():k.O=!0}function q3(w,k){k._=k.p.length;var j=k.p[0],ee=w!==void 0&&w!==j;return k.h.g||vu("ES5").S(k,w,ee),ee?(j[ga].P&&(Gm(k),js(4)),Gd(w)&&(w=wp(k,w),k.l||H0(k,w)),k.u&&vu("Patches").M(j[ga],w,k.u,k.s)):w=wp(k,j,[]),Gm(k),k.u&&k.v(k.u,k.s),w!==Rb?w:void 0}function wp(w,k,j){if(Eb(k))return k;var ee=k[ga];if(!ee)return s0(k,function(ve,De){return $m(w,ee,k,ve,De,j)},!0),k;if(ee.A!==w)return k;if(!ee.P)return H0(w,ee.t,!0),ee.t;if(!ee.I){ee.I=!0,ee.A._--;var le=ee.i===4||ee.i===5?ee.o=Qa(ee.k):ee.o;s0(ee.i===3?new Set(le):le,function(ve,De){return $m(w,ee,le,ve,De,j)}),H0(w,le,!1),j&&w.u&&vu("Patches").R(ee,j,w.u,w.s)}return ee.o}function $m(w,k,j,ee,le,ve){if(Sc(le)){var De=wp(w,le,ve&&k&&k.i!==3&&!K5(k.D,ee)?ve.concat(ee):void 0);if(Z5(j,ee,De),!Sc(De))return;w.m=!1}if(Gd(le)&&!Eb(le)){if(!w.h.F&&w._<1)return;wp(w,le),k&&k.A.l||H0(w,le)}}function H0(w,k,j){j===void 0&&(j=!1),w.h.F&&w.m&&W3(k,j)}function wc(w,k){var j=w[ga];return(j?o0(j):w)[k]}function X3(w,k){if(k in w)for(var j=Object.getPrototypeOf(w);j;){var ee=Object.getOwnPropertyDescriptor(j,k);if(ee)return ee;j=Object.getPrototypeOf(j)}}function nv(w){w.P||(w.P=!0,w.l&&nv(w.l))}function rv(w){w.o||(w.o=Qa(w.t))}function iv(w,k,j){var ee=Q5(k)?vu("MapSet").N(k,j):J5(k)?vu("MapSet").T(k,j):w.g?function(le,ve){var De=Array.isArray(le),nt={i:De?1:0,A:ve?ve.A:Mb(),P:!1,I:!1,D:{},l:ve,t:le,k:null,o:null,j:null,C:!1},lt=nt,Et=jm;De&&(lt=[nt],Et=K3);var on=Proxy.revocable(lt,Et),hn=on.revoke,me=on.proxy;return nt.k=me,nt.j=hn,me}(k,j):vu("ES5").J(k,j);return(j?j.A:Mb()).p.push(ee),ee}function Y3(w){return Sc(w)||js(22,w),function k(j){if(!Gd(j))return j;var ee,le=j[ga],ve=$d(j);if(le){if(!le.P&&(le.i<4||!vu("ES5").K(le)))return le.t;le.I=!0,ee=Hm(j,ve),le.I=!1}else ee=Hm(j,ve);return s0(ee,function(De,nt){le&&uN(le.t,De)===nt||Z5(ee,De,k(nt))}),ve===3?new Set(ee):ee}(w)}function Hm(w,k){switch(k){case 2:return new Map(w);case 3:return Array.from(w)}return Qa(w)}var Tp,gh,sv=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",fN=typeof Map<"u",pN=typeof Set<"u",Ab=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Rb=sv?Symbol.for("immer-nothing"):((Tp={})["immer-nothing"]=!0,Tp),Pb=sv?Symbol.for("immer-draftable"):"__$immer_draftable",ga=sv?Symbol.for("immer-state"):"__$immer_state",Nb=""+Object.prototype.constructor,ov=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(w){return Object.getOwnPropertyNames(w).concat(Object.getOwnPropertySymbols(w))}:Object.getOwnPropertyNames,mN=Object.getOwnPropertyDescriptors||function(w){var k={};return ov(w).forEach(function(j){k[j]=Object.getOwnPropertyDescriptor(w,j)}),k},gN={},jm={get:function(w,k){if(k===ga)return w;var j=o0(w);if(!K5(j,k))return function(le,ve,De){var nt,lt=X3(ve,De);return lt?"value"in lt?lt.value:(nt=lt.get)===null||nt===void 0?void 0:nt.call(le.k):void 0}(w,j,k);var ee=j[k];return w.I||!Gd(ee)?ee:ee===wc(w.t,k)?(rv(w),w.o[k]=iv(w.A.h,ee,w)):ee},has:function(w,k){return k in o0(w)},ownKeys:function(w){return Reflect.ownKeys(o0(w))},set:function(w,k,j){var ee=X3(o0(w),k);if(ee!=null&&ee.set)return ee.set.call(w.k,j),!0;if(!w.P){var le=wc(o0(w),k),ve=le==null?void 0:le[ga];if(ve&&ve.t===j)return w.o[k]=j,w.D[k]=!1,!0;if(hN(j,le)&&(j!==void 0||K5(w.t,k)))return!0;rv(w),nv(w)}return w.o[k]===j&&typeof j!="number"&&(j!==void 0||k in w.o)||(w.o[k]=j,w.D[k]=!0,!0)},deleteProperty:function(w,k){return wc(w.t,k)!==void 0||k in w.t?(w.D[k]=!1,rv(w),nv(w)):delete w.D[k],w.o&&delete w.o[k],!0},getOwnPropertyDescriptor:function(w,k){var j=o0(w),ee=Reflect.getOwnPropertyDescriptor(j,k);return ee&&{writable:!0,configurable:w.i!==1||k!=="length",enumerable:ee.enumerable,value:j[k]}},defineProperty:function(){js(11)},getPrototypeOf:function(w){return Object.getPrototypeOf(w.t)},setPrototypeOf:function(){js(12)}},K3={};s0(jm,function(w,k){K3[w]=function(){return arguments[0]=arguments[0][0],k.apply(this,arguments)}}),K3.deleteProperty=function(w,k){return jm.deleteProperty.call(this,w[0],k)},K3.set=function(w,k,j){return jm.set.call(this,w[0],k,j,w[0])};var Wm=function(){function w(j){var ee=this;this.g=Ab,this.F=!0,this.produce=function(le,ve,De){if(typeof le=="function"&&typeof ve!="function"){var nt=ve;ve=le;var lt=ee;return function(at){var Un=this;at===void 0&&(at=nt);for(var Vr=arguments.length,ri=Array(Vr>1?Vr-1:0),Lr=1;Lr<Vr;Lr++)ri[Lr-1]=arguments[Lr];return lt.produce(at,function(mi){var Xo;return(Xo=ve).call.apply(Xo,[Un,mi].concat(ri))})}}var Et;if(typeof ve!="function"&&js(6),De!==void 0&&typeof De!="function"&&js(7),Gd(le)){var on=Cb(ee),hn=iv(ee,le,void 0),me=!0;try{Et=ve(hn),me=!1}finally{me?Gm(on):ks(on)}return typeof Promise<"u"&&Et instanceof Promise?Et.then(function(at){return tv(on,De),q3(at,on)},function(at){throw Gm(on),at}):(tv(on,De),q3(Et,on))}if(!le||typeof le!="object")return(Et=ve(le))===Rb?void 0:(Et===void 0&&(Et=le),ee.F&&W3(Et,!0),Et);js(21,le)},this.produceWithPatches=function(le,ve){return typeof le=="function"?function(lt){for(var Et=arguments.length,on=Array(Et>1?Et-1:0),hn=1;hn<Et;hn++)on[hn-1]=arguments[hn];return ee.produceWithPatches(lt,function(me){return le.apply(void 0,[me].concat(on))})}:[ee.produce(le,ve,function(lt,Et){De=lt,nt=Et}),De,nt];var De,nt},typeof(j==null?void 0:j.useProxies)=="boolean"&&this.setUseProxies(j.useProxies),typeof(j==null?void 0:j.autoFreeze)=="boolean"&&this.setAutoFreeze(j.autoFreeze)}var k=w.prototype;return k.createDraft=function(j){Gd(j)||js(8),Sc(j)&&(j=Y3(j));var ee=Cb(this),le=iv(this,j,void 0);return le[ga].C=!0,ks(ee),le},k.finishDraft=function(j,ee){var le=j&&j[ga],ve=le.A;return tv(ve,ee),q3(void 0,ve)},k.setAutoFreeze=function(j){this.F=j},k.setUseProxies=function(j){j&&!Ab&&js(20),this.g=j},k.applyPatches=function(j,ee){var le;for(le=ee.length-1;le>=0;le--){var ve=ee[le];if(ve.path.length===0&&ve.op==="replace"){j=ve.value;break}}var De=vu("Patches").$;return Sc(j)?De(j,ee):this.produce(j,function(nt){return De(nt,ee.slice(le+1))})},w}(),wl=new Wm;wl.produce,wl.produceWithPatches.bind(wl),wl.setAutoFreeze.bind(wl),wl.setUseProxies.bind(wl),wl.applyPatches.bind(wl),wl.createDraft.bind(wl),wl.finishDraft.bind(wl);var Ib={currentProjectStateDefinitionVersion:"0.4.0"},yh=Ib;async function kb(w,k,j){await x$(0),w.transaction(({drafts:ee})=>{var le;const ve=k.address.projectId;ee.ephemeral.coreByProject[ve]={lastExportedObject:null,loadingState:{type:"loading"}},ee.ahistoric.coreByProject[ve]={ahistoricStuff:""};function De(){ee.ephemeral.coreByProject[ve].loadingState={type:"loaded"},ee.historic.coreByProject[ve]={sheetsById:{},definitionVersion:yh.currentProjectStateDefinitionVersion,revisionHistory:[]}}function nt(hn){ee.ephemeral.coreByProject[ve].loadingState={type:"loaded"},ee.historic.coreByProject[ve]=hn}function lt(){ee.ephemeral.coreByProject[ve].loadingState={type:"loaded"}}function Et(hn){ee.ephemeral.coreByProject[ve].loadingState={type:"browserStateIsNotBasedOnDiskState",onDiskState:hn}}const on=(le=Tb(ee.historic))==null?void 0:le.coreByProject[k.address.projectId];on?j&&on.revisionHistory.indexOf(j.revisionHistory[0])==-1?Et(j):lt():j?nt(j):De()})}function Db(){}function Fb(w){var k,j;const ee=(k=w==null?void 0:w.logging)!=null&&k.internal?(j=w.logging.min)!=null?j:256:1/0,le=ee<=128,ve=ee<=512,De=Lm(void 0,{_debug:le?console.debug.bind(console,"_coreLogger(TheatreInternalLogger) debug"):Db,_error:ve?console.error.bind(console,"_coreLogger(TheatreInternalLogger) error"):Db});if(w){const{logger:nt,logging:lt}=w;nt&&De.configureLogger(nt),lt?De.configureLogging(lt):De.configureLogging({dev:!1})}return De.getLogger().named("Theatre")}var yN=class{constructor(w,k={},j){this.config=k,this.publicApi=j,L(this,"pointers"),L(this,"_pointerProxies"),L(this,"address"),L(this,"_studioReadyDeferred"),L(this,"_assetStorageReadyDeferred"),L(this,"_readyPromise"),L(this,"_sheetTemplates",new cN.Atom({})),L(this,"sheetTemplatesP",this._sheetTemplates.pointer),L(this,"_studio"),L(this,"assetStorage"),L(this,"type","Theatre_Project"),L(this,"_logger");var ee;this._logger=Fb({logging:{dev:!0}}).named("Project",w),this._logger.traceDev("creating project"),this.address={projectId:w};const le=new cN.Atom({ahistoric:{ahistoricStuff:""},historic:(ee=k.state)!=null?ee:{sheetsById:{},definitionVersion:yh.currentProjectStateDefinitionVersion,revisionHistory:[]},ephemeral:{loadingState:{type:"loaded"},lastExportedObject:null}});this._assetStorageReadyDeferred=ph(),this.assetStorage={getAssetUrl:ve=>{var De;return"".concat((De=k.assets)==null?void 0:De.baseUrl,"/").concat(ve)},createAsset:()=>{throw new Error("Please wait for Project.ready to use assets.")}},this._pointerProxies={historic:new wb.PointerProxy(le.pointer.historic),ahistoric:new wb.PointerProxy(le.pointer.ahistoric),ephemeral:new wb.PointerProxy(le.pointer.ephemeral)},this.pointers={historic:this._pointerProxies.historic.pointer,ahistoric:this._pointerProxies.ahistoric.pointer,ephemeral:this._pointerProxies.ephemeral.pointer},je.add(w,this),this._studioReadyDeferred=ph(),this._readyPromise=Promise.all([this._studioReadyDeferred.promise,this._assetStorageReadyDeferred.promise]).then(()=>{}),k.state?setTimeout(()=>{this._studio||(this._studioReadyDeferred.resolve(void 0),this._assetStorageReadyDeferred.resolve(void 0),this._logger._trace("ready deferred resolved with no state"))},0):typeof window>"u"?console.error('Argument config.state in Theatre.getProject("'.concat(w,'", config) is empty. ')+"You can safely ignore this message if you're developing a Next.js/Remix project in development mode. But if you are shipping to your end-users, then you need to set config.state, otherwise your project's state will be empty and nothing will animate. Learn more at https://www.theatrejs.com/docs/latest/manual/projects#state"):setTimeout(()=>{if(!this._studio)throw new Error('Argument config.state in Theatre.getProject("'.concat(w,'", config) is empty. This is fine ')+"while you are using @theatre/core along with @theatre/studio. But since @theatre/studio "+'is not loaded, the state of project "'.concat(w,`" will be empty.

`)+`To fix this, you need to add @theatre/studio into the bundle and export the project's state. Learn how to do that at https://www.theatrejs.com/docs/latest/manual/projects#state
`)},1e3)}attachToStudio(w){if(this._studio){if(this._studio!==w)throw new Error("Project ".concat(this.address.projectId," is already attached to studio ").concat(this._studio.address.studioId));console.warn("Project ".concat(this.address.projectId," is already attached to studio ").concat(this._studio.address.studioId));return}this._studio=w,w.initialized.then(async()=>{var k;await kb(w,this,this.config.state),this._pointerProxies.historic.setPointer(w.atomP.historic.coreByProject[this.address.projectId]),this._pointerProxies.ahistoric.setPointer(w.atomP.ahistoric.coreByProject[this.address.projectId]),this._pointerProxies.ephemeral.setPointer(w.atomP.ephemeral.coreByProject[this.address.projectId]),await w.createAssetStorage(this,(k=this.config.assets)==null?void 0:k.baseUrl).then(j=>{this.assetStorage=j,this._assetStorageReadyDeferred.resolve(void 0)}),this._studioReadyDeferred.resolve(void 0)}).catch(k=>{throw console.error(k),k})}get isAttachedToStudio(){return!!this._studio}get ready(){return this._readyPromise}isReady(){return this._studioReadyDeferred.status==="resolved"&&this._assetStorageReadyDeferred.status==="resolved"}getOrCreateSheet(w,k="default"){let j=this._sheetTemplates.get()[w];return j||(j=new Sb(this,w),this._sheetTemplates.reduce(ee=>T(x({},ee),{[w]:j}))),j.getInstance(k)}},vN=class{get type(){return"Theatre_Project_PublicAPI"}constructor(w,k={}){Fe(this,new yN(w,k,this))}get ready(){return Xe(this).ready}get isReady(){return Xe(this).isReady()}get address(){return x({},Xe(this).address)}getAssetUrl(w){if(!this.isReady){console.error("Calling `project.getAssetUrl()` before `project.ready` is resolved, will always return `undefined`. Either use `project.ready.then(() => project.getAssetUrl())` or `await project.ready` before calling `project.getAssetUrl()`.");return}return w.id?Xe(this).assetStorage.getAssetUrl(w.id):void 0}sheet(w,k="default"){const j=Y5(w);return Xe(this).getOrCreateSheet(j,k).publicApi}};O(ne());var Z3=Jt,qm=Jt;function Ob(w,k={}){const j=je.get(w);if(j)return j.publicApi;const le=Fb().named("Project",w);return k.state?(_N(w,k.state),le._debug("deep validated config.state on disk")):le._debug("no config.state"),new vN(w,k)}var av=(w,k)=>{if(Array.isArray(k)||k==null||k.definitionVersion!==yh.currentProjectStateDefinitionVersion)throw new G3("Error validating conf.state in Theatre.getProject(".concat(JSON.stringify(w),", conf). The state seems to be formatted in a way that is unreadable to Theatre.js. Read more at https://www.theatrejs.com/docs/latest/manual/projects#state"))},_N=(w,k)=>{av(w,k)};function lv(w,k,j){const ee=j?Xe(j).ticker:HP();if((0,Z3.isPointer)(w))return(0,qm.pointerToPrism)(w).onChange(ee,k,!0);if((0,qm.isPrism)(w))return w.onChange(ee,k,!0);throw new Error("Called onChange(p) where p is neither a pointer nor a prism.")}function Bb(w){if((0,Z3.isPointer)(w))return(0,qm.pointerToPrism)(w).getValue();throw new Error("Called val(p) where p is not a pointer.")}var xN=class{constructor(){L(this,"_studio")}get type(){return"Theatre_CoreBundle"}get version(){return"0.7.2"}getBitsForStudio(w,k){if(this._studio)throw new Error("@theatre/core is already attached to @theatre/studio");this._studio=w;const j={projectsP:je.atom.pointer.projects,privateAPI:Xe,coreExports:$,getCoreRafDriver:yb};k(j)}};bN();function bN(){if(typeof window>"u")return;const w=window[j5];if(typeof w<"u")throw typeof w=="object"&&w&&typeof w.version=="string"?new Error(`It seems that the module '@theatre/core' is loaded more than once. This could have two possible causes:
1. You might have two separate versions of Theatre.js in node_modules.
2. Or this might be a bundling misconfiguration, in case you're using a bundler like Webpack/ESBuild/Rollup.

Note that it **is okay** to import '@theatre/core' multiple times. But those imports should point to the same module.`):new Error("The variable window.".concat(j5," seems to be already set by a module other than @theatre/core."));const k=new xN;window[j5]=k;const j=window[l$];j&&j!==null&&j.type==="Theatre_StudioBundle"&&j.registerCoreBundle(k)}/*! Bundled license information:

	lodash-es/lodash.js:
	  (**
	   * @license
	   * Lodash (Custom Build) <https://lodash.com/>
	   * Build: `lodash modularize exports="es" -o ./`
	   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
	   * Released under MIT license <https://lodash.com/license>
	   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
	   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
	   *)
	*/})(oU,oU.exports);var Rte=oU.exports;const mz=new Map,LNe=new Map,UNe=new Map,Rie=new Map;function s1t(i,e){return new Promise((t,n)=>{new UXe().setPath("images/milkyWay/").load(e,r=>{mz.set(i,r),t(r)},void 0,()=>{n()})})}function o1t(i,e){return new Promise((t,n)=>{new qpt().setPath("./models/").loadAsync(e).then(r=>{r.traverse(s=>{s.isMesh&&(s.castShadow=!0,s.receiveShadow=!0)}),UNe.set(i,r),t(r)}).catch(r=>{console.log("Couldn't load:",e),console.log(r),n()})})}function a1t(i,e){return new Promise((t,n)=>{new TAe().load(e,r=>{r.wrapS=tu,r.wrapT=tu,r.needsUpdate=!0,Rie.set(i,r),t(r)},void 0,()=>{n()})})}function l1t(i,e){return new Promise((t,n)=>{fetch(e).then(r=>{if(!r.ok)throw new Error(`Network response was not ok: ${r.status}`);return r.json()}).then(r=>{LNe.set(i,r),t(r)}).catch(()=>{console.log(`Couldn't load: ${e}`),n()})})}function c1t(i){return new Promise((e,t)=>{const n=[()=>s1t("environment",["dark-s_px.jpg","dark-s_nx.jpg","dark-s_py.jpg","dark-s_ny.jpg","dark-s_pz.jpg","dark-s_nz.jpg"]),()=>a1t("uv_grid","images/uv_grid_opengl.jpg"),()=>o1t("Flair","Flair.fbx"),()=>l1t("animation","json/animation.json")];Promise.all(n.map(r=>r())).then(()=>{const r=i.components.get("theatre"),s=LNe.get("animation");r.project=Rte.getProject("RemoteApp",{state:s}),r.project.ready.then(()=>{T4.dispatchEvent({type:H2.LOAD_COMPLETE}),e()})}).catch(r=>{console.log(r),t()})})}class zNe extends gi{constructor(t){super();qe(this,"mixer");this.name=t,this.scale.setScalar(.5);const n=UNe.get(t),r=Spt(n);this.add(r),this.mixer=new iYe(r),r.mixer=this.mixer,this.mixer.clipAction(r.animations[0]).play()}update(t){this.mixer.update(t)}get timeScale(){return this.mixer.timeScale}set timeScale(t){this.mixer.timeScale=t}}class VNe extends W1{constructor(){super();qe(this,"app");qe(this,"camera");qe(this,"renderer");qe(this,"clock");this.clock=new RAe,this.clock.start();const t=new gi;t.name="cameras",this.add(t),this.camera=new po(90,1,10,1e3),this.camera.name="Main",this.camera.position.set(0,100,125),this.camera.lookAt(0,50,0),t.add(this.camera)}setup(t,n){this.app=t,this.renderer=n}init(){}dispose(){this.app.components.get("theatre").clearSheetObjects(this.name)}resize(t,n){this.camera.aspect=t/n,this.camera.updateProjectionMatrix()}update(){}draw(){this.renderer.isWebGLRenderer?this.renderer.render(this,this.camera):this.renderer.renderAsync(this,this.camera)}}class GNe extends VNe{constructor(){super();qe(this,"dance");qe(this,"customMat");qe(this,"post");this.name="Scene1"}init(){const t=mz.get("environment");this.background=t,this.createLights(),this.createWorld(),this.createAnimation(),q_(this);const n=this.app.components.get("three");n.addScene(this),n.setScene(this),n.addCamera(this.camera)}createLights(){const t=new gi;t.name="lights",this.add(t);const n=new qU(16777215,.25);n.name="sun",n.castShadow=!0,n.position.set(0,50,50);const r=256;n.shadow.camera.top=r,n.shadow.camera.bottom=-r,n.shadow.camera.left=-r,n.shadow.camera.right=r,n.shadow.mapSize.width=1024,n.shadow.mapSize.height=1024,n.shadow.camera.near=10,n.shadow.camera.far=1e3,n.shadow.bias=1e-4,t.add(n);const s=new EAe(7320802,12872999,.5);s.name="hemi",t.add(s);const o=new Sx(16777215,3);o.angle=5.8,o.decay=0,o.distance=1e3,o.penumbra=Math.PI,o.name="spotlight",o.castShadow=!0,o.position.set(-50,200,200),o.lookAt(0,50,0),t.add(o)}createWorld(){const t=new gi;t.name="world",this.add(t);const n=Rie.get("uv_grid");n.repeat.setScalar(10),n.needsUpdate=!0;const r=new Yy({map:n}),s=new dn(new HU(500,36),r);s.name="floor",s.receiveShadow=!0,s.rotateX(-Math.PI/2),t.add(s),this.dance=new zNe("Flair"),this.dance.position.set(0,0,0),t.add(this.dance),this.createTestMaterials(t)}createTestMaterials(t){const n=new G2(20),r=[],s=new dn(n,new Ea({name:"BasicMaterial",transparent:!0}));s.name="Basic",t.add(s),r.push(s);const o=new dn(n,new xre({transparent:!0}));o.name="Matcap",t.add(o),r.push(o);const a=new dn(n,new Yy({name:"PhongMaterial",transparent:!0}));a.name="Phong",t.add(a),r.push(a);const c=new dn(n,new jU({name:"PhysicalMaterial",transparent:!0}));if(c.name="Physical",t.add(c),r.push(c),this.app.components.get("three").renderer.isWebGLRenderer){this.customMat=new MNe;const x=new dn(n,this.customMat);x.name="Shader",t.add(x),r.push(x)}const f=50,m=r.length,v=(m-1)/2*f;for(let x=0;x<m;x++){const T=x*f-v;r[x].position.set(T,100,-150),r[x].castShadow=!0}}createPost(){this.post=new pft(this.renderer),this.post.addPass(new rpt(this,this.camera));const t=new npt;t.minEdgeThreshold=.01,this.post.addPass(new zQ(this.camera,t));const n=new dpt({focusArea:.6});this.post.addPass(new zQ(this.camera,n));const r=new spt({});r.blendMode.opacity.value=.33,r.blendMode.blendFunction=hi.MULTIPLY;const s=new ppt({});this.post.addPass(new zQ(this.camera,r,s))}createAnimation(){const t=this.app.components.get("theatre");t.sheet(this.name),t.sheetObject(this.name,"Camera",{position:{x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z},rotation:{x:this.camera.rotation.x,y:this.camera.rotation.y,z:this.camera.rotation.z}},n=>{this.camera.position.set(n.position.x,n.position.y,n.position.z),this.camera.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z)}),t.sheetObject(this.name,"Break Dancer",{position:{x:this.dance.position.x,y:this.dance.position.y,z:this.dance.position.z},rotation:{x:this.dance.rotation.x,y:this.dance.rotation.y,z:this.dance.rotation.z}},n=>{this.dance.position.set(n.position.x,n.position.y,n.position.z),this.dance.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z)}),t.playSheet(this.name,{iterationCount:1/0})}update(){var n;const t=this.clock.getDelta();(n=this.customMat)==null||n.update(t),this.dance.update(t)}resize(t,n){var r,s;super.resize(t,n),(r=this.renderer)==null||r.setSize(t,n),this.app.editor||(s=this.post)==null||s.setSize(t,n)}}class ix{static init(){const e=[1,0,0,2e-5,1,0,0,503905e-9,1,0,0,.00201562,1,0,0,.00453516,1,0,0,.00806253,1,0,0,.0125978,1,0,0,.018141,1,0,0,.0246924,1,0,0,.0322525,1,0,0,.0408213,1,0,0,.0503999,1,0,0,.0609894,1,0,0,.0725906,1,0,0,.0852058,1,0,0,.0988363,1,0,0,.113484,1,0,0,.129153,1,0,0,.145839,1,0,0,.163548,1,0,0,.182266,1,0,0,.201942,1,0,0,.222314,1,0,0,.241906,1,0,0,.262314,1,0,0,.285754,1,0,0,.310159,1,0,0,.335426,1,0,0,.361341,1,0,0,.387445,1,0,0,.412784,1,0,0,.438197,1,0,0,.466966,1,0,0,.49559,1,0,0,.523448,1,0,0,.549938,1,0,0,.57979,1,0,0,.608746,1,0,0,.636185,1,0,0,.664748,1,0,0,.69313,1,0,0,.71966,1,0,0,.747662,1,0,0,.774023,1,0,0,.799775,1,0,0,.825274,1,0,0,.849156,1,0,0,.873248,1,0,0,.89532,1,0,0,.917565,1,0,0,.937863,1,0,0,.958139,1,0,0,.976563,1,0,0,.994658,1,0,0,1.0112,1,0,0,1.02712,1,0,0,1.04189,1,0,0,1.05568,1,0,0,1.06877,1,0,0,1.08058,1,0,0,1.09194,1,0,0,1.10191,1,0,0,1.11161,1,0,0,1.1199,1,0,0,1.12813,.999547,-448815e-12,.0224417,199902e-10,.999495,-113079e-10,.0224406,503651e-9,.999496,-452317e-10,.0224406,.00201461,.999496,-101772e-9,.0224406,.00453287,.999495,-180928e-9,.0224406,.00805845,.999497,-282702e-9,.0224406,.0125914,.999496,-407096e-9,.0224406,.0181319,.999498,-554114e-9,.0224406,.02468,.999499,-723768e-9,.0224406,.0322363,.999495,-916058e-9,.0224405,.0408009,.999499,-.00113101,.0224408,.050375,.999494,-.00136863,.0224405,.0609586,.999489,-.00162896,.0224401,.0725537,.999489,-.00191201,.0224414,.0851619,.999498,-.00221787,.0224413,.0987867,.999492,-.00254642,.0224409,.113426,.999507,-.00289779,.0224417,.129088,.999494,-.0032716,.0224386,.145767,.999546,-.0036673,.0224424,.163472,.999543,-.00408166,.0224387,.182182,.999499,-.00450056,.0224338,.201843,.999503,-.00483661,.0224203,.222198,.999546,-.00452928,.022315,.241714,.999508,-.00587403,.0224329,.262184,.999509,-.00638806,.0224271,.285609,.999501,-.00691028,.0224166,.309998,.999539,-.00741979,.0223989,.335262,.999454,-.00786282,.0223675,.361154,.999529,-.00811928,.0222828,.387224,.999503,-.00799941,.0221063,.41252,.999561,-.00952753,.0223057,.438006,.999557,-.0099134,.0222065,.466735,.999541,-.0100935,.0220402,.495332,.999562,-.00996821,.0218067,.523197,.999556,-.0105031,.0217096,.550223,.999561,-.0114191,.0217215,.579498,.999588,-.0111818,.0213357,.608416,.999633,-.0107725,.0208689,.635965,.999527,-.0121671,.0210149,.664476,.999508,-.0116005,.020431,.692786,.999568,-.0115604,.0199791,.719709,.999671,-.0121117,.0197415,.74737,.999688,-.0110769,.0188846,.773692,.99962,-.0122368,.0188452,.799534,.999823,-.0110325,.0178001,.825046,.999599,-.0114923,.0174221,.849075,.999619,-.0105923,.0164345,.872999,.999613,-.0105988,.0158227,.895371,.99964,-.00979861,.0148131,.917364,.99977,-.00967238,.0140721,.938002,.999726,-.00869175,.0129543,.957917,.99973,-.00866872,.0122329,.976557,.999773,-.00731956,.0108958,.994459,.999811,-.00756027,.0102715,1.01118,.999862,-.00583732,.00878781,1.02701,.999835,-.00631438,.00827529,1.04186,.999871,-.00450785,.00674583,1.05569,.999867,-.00486079,.00621041,1.06861,.999939,-.00322072,.00478301,1.08064,.999918,-.00318199,.00406395,1.09181,1.00003,-.00193348,.00280682,1.10207,.999928,-.00153729,.00198741,1.11152,.999933,-623666e-9,917714e-9,1.12009,1,-102387e-11,907581e-12,1.12813,.997866,-896716e-12,.0448334,199584e-10,.997987,-225945e-10,.0448389,502891e-9,.997987,-903781e-10,.0448388,.00201156,.997985,-203351e-9,.0448388,.00452602,.997986,-361514e-9,.0448388,.00804629,.997987,-56487e-8,.0448389,.0125724,.997988,-813423e-9,.0448389,.0181045,.997984,-.00110718,.0448387,.0246427,.997985,-.00144616,.0448388,.0321875,.997987,-.00183038,.044839,.0407392,.997983,-.00225987,.0448387,.0502986,.997991,-.00273467,.0448389,.0608667,.997984,-.00325481,.0448384,.0724444,.998002,-.00382043,.044839,.0850348,.997997,-.00443145,.0448396,.0986372,.998007,-.00508796,.0448397,.113255,.998008,-.00578985,.04484,.128891,.998003,-.00653683,.0448384,.145548,.997983,-.00732713,.0448358,.163221,.997985,-.00815454,.0448358,.181899,.998005,-.00898985,.0448286,.201533,.998026,-.00964404,.0447934,.221821,.998055,-.00922677,.044611,.241282,.99804,-.0117361,.0448245,.261791,.998048,-.0127628,.0448159,.285181,.998088,-.0138055,.0447996,.30954,.998058,-.0148206,.0447669,.334751,.998099,-.0156998,.044697,.36061,.998116,-.0161976,.0445122,.386603,.998195,-.015945,.0441711,.411844,.998168,-.0183947,.0444255,.43773,.998184,-.0197913,.0443809,.466009,.998251,-.0201426,.0440689,.494574,.998305,-.0198847,.0435632,.522405,.998273,-.0210577,.043414,.549967,.998254,-.0227901,.0433943,.578655,.998349,-.0223108,.0426529,.60758,.99843,-.0223088,.042,.635524,.998373,-.0241141,.0418987,.663621,.998425,-.0231446,.0408118,.691906,.998504,-.0233684,.0400565,.719339,.998443,-.0241652,.0394634,.74643,.99848,-.0228715,.0380002,.773086,.998569,-.023519,.0372322,.798988,.998619,-.0223108,.0356468,.824249,.998594,-.0223105,.034523,.848808,.998622,-.0213426,.0328887,.87227,.998669,-.0207912,.0314374,.895157,.998705,-.0198416,.0296925,.916769,.998786,-.0189168,.0279634,.937773,.998888,-.0178811,.0261597,.957431,.99906,-.0166845,.0242159,.976495,.999038,-.0155464,.0222638,.994169,.999237,-.0141349,.0201967,1.01112,.999378,-.0129324,.0181744,1.02692,.999433,-.0113192,.0159898,1.04174,.999439,-.0101244,.0140385,1.05559,.999614,-.00837456,.0117826,1.06852,.999722,-.00721769,.00983745,1.08069,.999817,-.00554067,.00769002,1.09176,.99983,-.00426961,.005782,1.10211,.999964,-.00273904,.00374503,1.11152,1.00001,-.00136739,.00187176,1.12031,.999946,393227e-10,-28919e-9,1.12804,.995847,-13435e-10,.0671785,19916e-9,.995464,-338387e-10,.0671527,501622e-9,.99547,-135355e-9,.0671531,.00200649,.995471,-30455e-8,.0671532,.00451461,.99547,-541423e-9,.0671531,.008026,.995471,-84598e-8,.0671531,.0125407,.99547,-.00121823,.0671531,.0180589,.99547,-.00165817,.0671531,.0245806,.995463,-.00216583,.0671526,.0321062,.995468,-.00274127,.0671527,.0406366,.995474,-.00338447,.0671534,.0501717,.995473,-.00409554,.0671533,.0607131,.995478,-.00487451,.0671531,.0722618,.995476,-.00572148,.0671532,.0848191,.995477,-.00663658,.0671539,.0983882,.995498,-.00761986,.0671541,.112972,.995509,-.00867094,.0671542,.128568,.995509,-.00978951,.0671531,.145183,.995503,-.0109725,.0671491,.162808,.995501,-.012211,.0671465,.181441,.99553,-.0134565,.0671371,.201015,.99555,-.014391,.0670831,.221206,.99558,-.014351,.0668883,.240813,.995577,-.0173997,.0671055,.261257,.995602,-.0191111,.0671178,.284467,.995623,-.0206705,.0670946,.308765,.995658,-.022184,.0670472,.333905,.995705,-.0234832,.0669417,.359677,.995719,-.0241933,.0666714,.385554,.995786,-.0243539,.066266,.410951,.995887,-.0271866,.0664367,.437163,.995944,-.0296012,.0664931,.464842,.996004,-.0301045,.0660105,.49332,.996128,-.0298311,.0652694,.521131,.996253,-.0316426,.0650739,.549167,.996244,-.0339043,.0649433,.57737,.996309,-.033329,.0638926,.606073,.996417,-.0338935,.0630849,.634527,.996372,-.0353104,.0625083,.66256,.996542,-.0348942,.0611986,.690516,.996568,-.0351614,.060069,.718317,.996711,-.0354317,.0588522,.74528,.996671,-.0349513,.0571902,.772061,.996865,-.0345622,.0555321,.798089,.996802,-.0342566,.0537816,.823178,.996992,-.0330862,.0516095,.847949,.996944,-.0324666,.0495537,.871431,.997146,-.0309544,.0470302,.894357,.997189,-.0299372,.0446043,.916142,.997471,-.0281389,.0418812,.937193,.997515,-.0268702,.0391823,.957,.997812,-.0247166,.0361338,.975936,.998027,-.0233525,.0333945,.99391,.998233,-.0209839,.0301917,1.01075,.998481,-.0194309,.027271,1.02669,.998859,-.0169728,.0240162,1.04173,.99894,-.0152322,.0210517,1.05551,.999132,-.0127497,.0178632,1.06856,.999369,-.0108282,.014787,1.08054,.999549,-.00845886,.0116185,1.09185,.999805,-.0063937,.00867209,1.10207,.99985,-.00414582,.00566823,1.1117,.999912,-.00207443,.00277562,1.12022,1.00001,870226e-10,-53766e-9,1.12832,.991943,-178672e-11,.0893382,198384e-10,.991952,-450183e-10,.089339,499849e-9,.991956,-180074e-9,.0893394,.0019994,.991955,-405167e-9,.0893393,.00449867,.991953,-720298e-9,.0893391,.00799764,.991955,-.00112548,.0893393,.0124964,.991957,-.0016207,.0893395,.0179951,.991958,-.00220601,.0893396,.0244939,.991947,-.00288137,.0893385,.0319929,.991962,-.00364693,.0893399,.0404933,.991965,-.00450264,.0893399,.049995,.99198,-.00544862,.0893411,.0604995,.99197,-.00648491,.0893397,.0720074,.991976,-.00761164,.089341,.0845207,.99198,-.00882891,.0893405,.0980413,.991982,-.0101367,.0893396,.112571,.992008,-.011535,.0893415,.128115,.992026,-.0130228,.0893414,.144672,.992064,-.0145966,.0893418,.162241,.992041,-.0162421,.0893359,.180801,.992086,-.0178888,.0893214,.200302,.992157,-.0190368,.0892401,.220332,.992181,-.0195584,.0890525,.240144,.992175,-.0227257,.0892153,.260728,.99221,-.0254195,.089304,.283473,.99222,-.0274883,.0892703,.307673,.992317,-.0294905,.0892027,.332729,.992374,-.0311861,.0890577,.358387,.992505,-.0320656,.0886994,.384102,.992568,-.0329715,.0883198,.409767,.992675,-.036006,.0883602,.436145,.992746,-.0392897,.0884591,.463217,.992873,-.0399337,.0878287,.491557,.992934,-.040231,.0870108,.519516,.993091,-.0422013,.0865857,.547741,.993259,-.0443503,.0861937,.575792,.993455,-.0446368,.0851187,.604233,.993497,-.0454299,.0840576,.632925,.993694,-.0463296,.0829671,.660985,.993718,-.0470619,.0817185,.688714,.993973,-.0468838,.0800294,.716743,.994207,-.046705,.0781286,.74377,.994168,-.0469698,.0763337,.77042,.9945,-.0456816,.0738184,.796659,.994356,-.0455518,.0715545,.821868,.994747,-.0439488,.0686085,.846572,.994937,-.0430056,.065869,.870435,.995142,-.0413414,.0626446,.893272,.995451,-.0396521,.05929,.915376,.995445,-.0378453,.0558503,.936196,.995967,-.0355219,.0520949,.956376,.996094,-.0335146,.048377,.975327,.996622,-.030682,.0442575,.993471,.996938,-.0285504,.0404693,1.01052,.997383,-.0253399,.0360903,1.02637,.997714,-.0231651,.0322176,1.04139,.998249,-.0198138,.0278433,1.05542,.998596,-.0174337,.0238759,1.06846,.998946,-.0141349,.0195944,1.08056,.99928,-.0115603,.0156279,1.09181,.999507,-.00839065,.0114607,1.10213,.999697,-.005666,.00763325,1.11169,.999869,-.00269902,.00364946,1.12042,1.00001,623836e-10,-319288e-10,1.12832,.987221,-222675e-11,.111332,197456e-10,.98739,-561116e-10,.111351,497563e-9,.987448,-224453e-9,.111357,.00199031,.987441,-505019e-9,.111357,.0044782,.987442,-897816e-9,.111357,.00796129,.987442,-.00140284,.111357,.0124396,.987444,-.00202012,.111357,.0179132,.987442,-.00274964,.111357,.0243824,.987446,-.00359147,.111357,.0318474,.987435,-.00454562,.111356,.0403086,.987461,-.00561225,.111358,.0497678,.987458,-.00679125,.111358,.0602239,.987443,-.0080828,.111356,.0716792,.987476,-.0094872,.111358,.0841364,.98749,-.0110044,.111361,.097597,.987508,-.0126344,.111362,.112062,.987494,-.0143767,.111357,.127533,.987526,-.0162307,.111359,.144015,.987558,-.0181912,.111361,.161502,.987602,-.0202393,.111355,.179979,.987692,-.022273,.111346,.199386,.987702,-.0235306,.111215,.219183,.987789,-.0247628,.111061,.239202,.987776,-.0280668,.111171,.259957,.987856,-.0316751,.111327,.282198,.987912,-.0342468,.111282,.306294,.988,-.0367205,.111198,.331219,.988055,-.0387766,.110994,.356708,.988241,-.0397722,.110547,.382234,.988399,-.0416076,.110198,.408227,.988539,-.0448192,.110137,.434662,.988661,-.0483793,.110143,.461442,.988967,-.0495895,.109453,.489318,.989073,-.0506797,.108628,.517516,.989274,-.0526953,.108003,.545844,.989528,-.054578,.107255,.573823,.989709,-.0561503,.106294,.601944,.989991,-.056866,.104896,.630855,.990392,-.0572914,.103336,.658925,.990374,-.0586224,.10189,.686661,.990747,-.0584764,.099783,.714548,.991041,-.0582662,.0974309,.74186,.991236,-.0584118,.0951678,.768422,.991585,-.0573055,.0921581,.794817,.991984,-.0564241,.0891167,.820336,.9921,-.0553608,.085805,.84493,.992749,-.0533816,.0820354,.868961,.99288,-.0518661,.0782181,.891931,.993511,-.0492492,.0738935,.914186,.993617,-.0471956,.0696402,.93532,.99411,-.044216,.0649659,.95543,.994595,-.0416654,.0603177,.974685,.994976,-.0384314,.0553493,.992807,.995579,-.0353491,.0503942,1.00996,.996069,-.0319787,.0452123,1.02606,.996718,-.028472,.0400112,1.04114,.997173,-.0250789,.0349456,1.05517,.997818,-.0213326,.029653,1.0683,.998318,-.0178509,.024549,1.0805,.998853,-.0141118,.0194197,1.09177,.999218,-.0105914,.0143869,1.1022,.999594,-.00693474,.00943517,1.11175,.99975,-.00340478,.00464051,1.12056,1.00001,109172e-9,-112821e-9,1.12853,.983383,-266524e-11,.133358,196534e-10,.981942,-671009e-10,.133162,494804e-9,.981946,-268405e-9,.133163,.00197923,.981944,-603912e-9,.133163,.00445326,.981941,-.00107362,.133162,.00791693,.981946,-.00167755,.133163,.0123703,.981944,-.00241569,.133162,.0178135,.981945,-.00328807,.133163,.0242466,.981945,-.00429472,.133162,.03167,.981955,-.00543573,.133164,.0400846,.981951,-.00671105,.133163,.0494901,.981968,-.00812092,.133165,.0598886,.981979,-.00966541,.133166,.0712811,.981996,-.0113446,.133168,.083669,.982014,-.0131585,.133169,.0970533,.982011,-.0151073,.133167,.111438,.982062,-.0171906,.133172,.126826,.9821,-.0194067,.133175,.143215,.982149,-.0217502,.133176,.160609,.982163,-.0241945,.133173,.178981,.982247,-.0265907,.133148,.198249,.982291,-.027916,.132974,.217795,.982396,-.0299663,.132868,.238042,.982456,-.0334544,.132934,.258901,.982499,-.0378636,.133137,.280639,.982617,-.0409274,.133085,.304604,.98274,-.0438523,.132985,.329376,.982944,-.0462288,.132728,.354697,.98308,-.0475995,.132228,.380102,.983391,-.0501901,.131924,.406256,.983514,-.0535899,.131737,.432735,.98373,-.0571858,.131567,.459359,.984056,-.0592353,.130932,.486637,.984234,-.0610488,.130092,.51509,.984748,-.0630758,.12923,.543461,.985073,-.0647398,.128174,.571376,.985195,-.0671941,.127133,.599414,.985734,-.0681345,.125576,.628134,.986241,-.0686089,.123639,.656399,.986356,-.0698511,.121834,.684258,.986894,-.0700931,.119454,.711818,.987382,-.0698321,.116718,.739511,.988109,-.0693975,.113699,.766267,.988363,-.0689584,.110454,.792456,.989112,-.0672353,.106602,.81813,.989241,-.0662034,.10267,.842889,.990333,-.0638938,.0981381,.867204,.990591,-.0618534,.0935388,.89038,.991106,-.0593117,.088553,.912576,.991919,-.0562676,.0832187,.934118,.992111,-.0534085,.0778302,.954254,.992997,-.0495459,.0720453,.973722,.993317,-.0463707,.0663458,.991949,.994133,-.0421245,.0601883,1.00936,.994705,-.0384977,.0542501,1.02559,.995495,-.0340956,.0479862,1.04083,.996206,-.030105,.041887,1.05497,.996971,-.0256095,.0355355,1.06824,.997796,-.0213932,.0293655,1.08056,.998272,-.0169612,.0232926,1.09182,.998857,-.0126756,.0172786,1.10219,.99939,-.00832486,.0113156,1.11192,.999752,-.00410826,.00557892,1.12075,1,150957e-9,-119101e-9,1.12885,.975169,-309397e-11,.154669,195073e-10,.975439,-779608e-10,.154712,491534e-9,.975464,-311847e-9,.154716,.00196617,.975464,-701656e-9,.154716,.00442387,.975462,-.0012474,.154715,.0078647,.975461,-.00194906,.154715,.0122886,.975464,-.00280667,.154715,.0176959,.975468,-.00382025,.154716,.0240867,.975471,-.00498985,.154716,.0314612,.975472,-.00631541,.154717,.0398199,.975486,-.00779719,.154718,.0491639,.975489,-.00943505,.154718,.0594932,.975509,-.0112295,.154721,.0708113,.97554,-.0131802,.154724,.0831176,.975557,-.0152876,.154726,.096415,.975585,-.0175512,.154728,.110705,.975605,-.0199713,.154729,.125992,.975645,-.0225447,.154729,.142272,.975711,-.0252649,.154735,.159549,.975788,-.0280986,.154736,.177805,.975872,-.0308232,.154704,.196911,.975968,-.0324841,.154525,.216324,.976063,-.0351281,.154432,.236628,.976157,-.0388618,.15446,.257539,.976204,-.0437704,.154665,.278975,.976358,-.047514,.154652,.302606,.976571,-.0508638,.154535,.327204,.976725,-.0534995,.154221,.352276,.977013,-.0555547,.153737,.377696,.977294,-.0586728,.153403,.403855,.977602,-.0622715,.15312,.430333,.977932,-.0658166,.152755,.456855,.978241,-.0689877,.152233,.483668,.978602,-.0712805,.15132,.512097,.979234,-.0732775,.150235,.540455,.97977,-.075163,.148978,.568486,.979995,-.0778026,.147755,.596524,.98078,-.0791854,.146019,.624825,.981628,-.0799666,.143906,.653403,.982067,-.0808532,.141561,.681445,.98271,-.0816024,.139025,.708918,.983734,-.0812511,.135764,.736594,.98431,-.0806201,.132152,.763576,.985071,-.0801605,.12846,.789797,.98618,-.0784208,.124084,.815804,.986886,-.0766643,.1193,.840869,.987485,-.0747744,.114236,.864952,.988431,-.0716701,.108654,.888431,.988886,-.0691609,.102994,.910963,.990024,-.0654048,.0967278,.932629,.990401,-.0619765,.090384,.95313,.991093,-.0579296,.0837885,.972587,.992018,-.0536576,.0770171,.991184,.992536,-.0493719,.0701486,1.00863,.993421,-.0444813,.062953,1.02494,.993928,-.040008,.0560455,1.04017,.994994,-.0347982,.04856,1.05463,.995866,-.0301017,.0416152,1.06807,.996916,-.0248225,.0342597,1.08039,.997766,-.0199229,.0271668,1.09177,.998479,-.0147422,.0201387,1.10235,.99921,-.00980173,.0131944,1.11206,.999652,-.0047426,.00640712,1.12104,.999998,891673e-10,-10379e-8,1.12906,.967868,-351885e-11,.175947,193569e-10,.968001,-886733e-10,.175972,487782e-9,.96801,-354697e-9,.175973,.00195115,.968012,-798063e-9,.175974,.00439006,.968011,-.00141879,.175973,.00780461,.968011,-.00221686,.175973,.0121948,.968016,-.00319231,.175974,.0175607,.968019,-.00434515,.175974,.0239027,.968018,-.00567538,.175974,.0312208,.968033,-.00718308,.175977,.0395158,.968049,-.00886836,.175979,.0487885,.968047,-.0107312,.175978,.0590394,.968072,-.0127719,.175981,.0702705,.968108,-.0149905,.175986,.0824836,.968112,-.0173866,.175985,.0956783,.968173,-.0199611,.175993,.109862,.96827,-.0227128,.176008,.125033,.968292,-.025639,.17601,.141193,.968339,-.0287299,.176007,.158336,.968389,-.0319399,.176001,.176441,.968501,-.034941,.175962,.195359,.968646,-.0370812,.175793,.214686,.968789,-.0402329,.175708,.234973,.96886,-.0442601,.1757,.255871,.969013,-.049398,.175876,.277238,.969242,-.0539932,.17594,.300326,.969419,-.0577299,.175781,.324702,.969763,-.0605643,.175432,.349527,.970093,-.0634488,.174992,.374976,.970361,-.0670589,.174611,.401097,.970825,-.0708246,.174226,.427496,.971214,-.0742871,.173684,.453858,.971622,-.0782608,.173186,.480637,.972175,-.0813151,.172288,.508655,.972944,-.0832678,.170979,.536973,.973595,-.0855964,.169573,.565138,.974345,-.0882163,.168152,.593222,.975233,-.0901671,.166314,.621201,.976239,-.0912111,.163931,.649919,.977289,-.0916959,.161106,.678011,.978076,-.0927061,.158272,.705717,.979533,-.0925562,.15475,.733228,.980335,-.0918159,.150638,.760454,.981808,-.0908508,.146201,.786918,.983061,-.0896172,.141386,.812953,.984148,-.0871588,.135837,.838281,.985047,-.0850624,.130135,.862594,.986219,-.0818541,.123882,.88633,.987043,-.0784523,.117126,.908952,.988107,-.0749601,.110341,.930744,.988955,-.0703548,.102885,.951728,.989426,-.0662798,.0954167,.971166,.990421,-.0610834,.0876331,.989984,.991032,-.0562936,.0797785,1.00765,.992041,-.0508154,.0718166,1.02434,.992794,-.0454045,.0637125,1.03976,.993691,-.0398194,.0555338,1.05418,.994778,-.0341482,.0473388,1.06772,.995915,-.028428,.0391016,1.08028,.997109,-.022642,.0309953,1.09185,.998095,-.0168738,.0230288,1.10247,.998985,-.0111274,.0150722,1.11229,.999581,-.00543881,.00740605,1.12131,1.00003,162239e-9,-105549e-9,1.12946,.959505,-393734e-11,.196876,191893e-10,.959599,-992157e-10,.196895,483544e-9,.959641,-396868e-9,.196903,.0019342,.959599,-892948e-9,.196895,.00435193,.959603,-.00158747,.196896,.0077368,.959604,-.00248042,.196896,.0120888,.959605,-.00357184,.196896,.0174082,.959605,-.00486169,.196896,.0236949,.959613,-.00635008,.196897,.0309497,.959619,-.00803696,.196898,.0391725,.959636,-.00992255,.196901,.0483649,.959634,-.0120067,.1969,.0585266,.959675,-.0142898,.196906,.0696609,.959712,-.0167717,.196911,.0817678,.959752,-.0194524,.196918,.0948494,.959807,-.0223321,.196925,.10891,.959828,-.0254091,.196924,.123947,.959906,-.0286815,.196934,.139968,.960005,-.0321371,.196944,.156968,.960071,-.0357114,.196936,.17491,.960237,-.0389064,.196882,.193597,.960367,-.041623,.196731,.21285,.960562,-.0452655,.196654,.233075,.960735,-.0496207,.196643,.253941,.960913,-.0549379,.196774,.275278,.961121,-.0603414,.196893,.297733,.96139,-.0644244,.196717,.321877,.961818,-.067556,.196314,.346476,.962175,-.0712709,.195917,.371907,.96255,-.0752848,.1955,.397916,.963164,-.0792073,.195026,.424229,.963782,-.0828225,.194424,.450637,.964306,-.0873119,.193831,.477288,.964923,-.0911051,.192973,.504716,.966048,-.093251,.19151,.533053,.967024,-.0958983,.190013,.561366,.968038,-.09835,.188253,.589464,.969152,-.100754,.186257,.617433,.970557,-.102239,.183775,.645801,.972104,-.102767,.180645,.674278,.973203,-.103492,.177242,.702004,.975123,-.103793,.17345,.729529,.97641,-.102839,.168886,.756712,.978313,-.101687,.163892,.783801,.980036,-.100314,.158439,.809671,.981339,-.097836,.152211,.835402,.982794,-.0950006,.145679,.860081,.984123,-.0920994,.138949,.883757,.984918,-.0878641,.131283,.90685,.985999,-.083939,.123464,.928786,.987151,-.0791234,.115324,.94983,.987827,-.0739332,.106854,.96962,.988806,-.0688088,.0982691,.98861,.989588,-.0628962,.0893456,1.00667,.990438,-.0573146,.0805392,1.02344,.991506,-.0509433,.0713725,1.03933,.992492,-.0448724,.0623732,1.05378,.993663,-.0383497,.0530838,1.06747,.994956,-.0319593,.0439512,1.08007,.99634,-.025401,.0347803,1.09182,.99761,-.0189687,.0257954,1.1025,.99863,-.0124441,.0169893,1.11247,.99947,-.00614003,.00829498,1.12151,1.00008,216624e-9,-146107e-9,1.12993,.950129,-434955e-11,.217413,190081e-10,.950264,-10957e-8,.217444,47884e-8,.9503,-438299e-9,.217451,.00191543,.950246,-986124e-9,.21744,.00430951,.950246,-.00175311,.21744,.00766137,.950245,-.00273923,.21744,.011971,.950253,-.00394453,.217441,.0172385,.950258,-.00536897,.217442,.0234641,.950267,-.00701262,.217444,.030648,.950277,-.00887551,.217446,.038791,.950284,-.0109576,.217446,.0478931,.950312,-.0132591,.217451,.0579568,.950334,-.01578,.217454,.0689821,.950378,-.0185204,.217462,.0809714,.950417,-.0214803,.217467,.0939265,.950488,-.0246594,.217479,.10785,.950534,-.0280565,.217483,.122743,.950633,-.0316685,.217498,.138611,.950698,-.0354787,.217499,.155442,.950844,-.0394003,.217507,.173208,.950999,-.0426812,.217419,.191605,.951221,-.0461302,.217317,.21084,.951412,-.0502131,.217238,.230945,.951623,-.0549183,.21722,.251745,.951867,-.0604493,.217306,.273001,.952069,-.0665189,.217466,.294874,.952459,-.0709179,.217266,.318732,.952996,-.0746112,.216891,.34318,.953425,-.0789252,.216503,.36849,.953885,-.0833293,.216042,.394373,.954617,-.087371,.215469,.420505,.955429,-.0914054,.214802,.446907,.956068,-.0961671,.214146,.473522,.957094,-.10048,.213286,.50052,.958372,-.103248,.211796,.528715,.959654,-.106033,.21016,.557065,.961305,-.108384,.208149,.585286,.962785,-.111122,.206024,.613334,.964848,-.112981,.203442,.641334,.966498,-.113717,.19996,.669955,.968678,-.114121,.196105,.698094,.970489,-.114524,.191906,.725643,.972903,-.113792,.186963,.752856,.974701,-.112406,.181343,.780013,.976718,-.110685,.175185,.806268,.978905,-.108468,.168535,.832073,.980267,-.105061,.161106,.857149,.981967,-.101675,.153387,.881145,.983063,-.0974492,.145199,.904255,.984432,-.0925815,.136527,.926686,.985734,-.0877983,.127584,.947901,.986228,-.081884,.118125,.968111,.98719,-.0761208,.108594,.98719,.988228,-.0698196,.0989996,1.00559,.989046,-.0632739,.0890074,1.02246,.990242,-.056522,.0790832,1.03841,.991252,-.0495272,.0689182,1.05347,.992542,-.0425373,.0588592,1.06724,.994096,-.0353198,.0486833,1.08009,.995593,-.028235,.0385977,1.09177,.99711,-.0209511,.0286457,1.10274,.998263,-.0139289,.0188497,1.11262,.999254,-.0067359,.009208,1.12191,.999967,141846e-9,-657764e-10,1.13024,.935608,-474692e-11,.236466,187817e-10,.93996,-11971e-8,.237568,473646e-9,.939959,-478845e-9,.237567,.0018946,.939954,-.0010774,.237566,.00426284,.939956,-.00191538,.237566,.00757842,.939954,-.00299277,.237566,.0118413,.93996,-.00430961,.237567,.0170518,.939969,-.00586589,.237569,.02321,.939982,-.00766166,.237572,.0303164,.939987,-.00969686,.237572,.0383711,.939997,-.0119715,.237574,.0473751,.940031,-.0144858,.237581,.0573298,.940073,-.0172399,.237589,.0682366,.94012,-.0202335,.237598,.080097,.940162,-.0234663,.237604,.0929116,.940237,-.0269387,.237615,.106686,.940328,-.0306489,.237632,.121421,.940419,-.0345917,.237645,.137115,.940522,-.0387481,.237654,.153766,.940702,-.0429906,.237661,.17133,.940871,-.0465089,.237561,.189502,.941103,-.050531,.23748,.208616,.941369,-.0550657,.237423,.228595,.941641,-.0601337,.237399,.249287,.941903,-.0658804,.237443,.270467,.942224,-.0722674,.237597,.292024,.942633,-.0771788,.237419,.315272,.943172,-.0815623,.237068,.339579,.943691,-.0863973,.236682,.364717,.944382,-.0911536,.236213,.390435,.945392,-.0952967,.235562,.416425,.946185,-.0998948,.234832,.442772,.947212,-.104796,.234114,.469347,.948778,-.10928,.233222,.496162,.950149,-.113081,.231845,.523978,.951989,-.115893,.230005,.552295,.953921,-.11846,.227862,.580569,.955624,-.12115,.225439,.608698,.958234,-.123373,.222635,.636696,.960593,-.124519,.219093,.665208,.963201,-.124736,.214749,.693557,.965642,-.125012,.210059,.721334,.968765,-.124661,.204935,.748613,.971753,-.122996,.198661,.776224,.973751,-.120998,.191823,.802461,.976709,-.118583,.184359,.828399,.977956,-.115102,.176437,.853693,.979672,-.111077,.167681,.877962,.981816,-.10688,.158872,.901564,.98238,-.101469,.149398,.924057,.983964,-.0960013,.139436,.945751,.984933,-.0899626,.12943,.966272,.985694,-.0832973,.11894,.985741,.986822,-.0767082,.108349,1.00407,.987725,-.0693614,.0976026,1.02154,.98877,-.06211,.086652,1.03757,.990129,-.0544143,.0756182,1.05296,.991337,-.046744,.0645753,1.06683,.992978,-.0387931,.0534683,1.0798,.994676,-.030973,.0424137,1.09181,.99645,-.0230311,.0314035,1.10286,.997967,-.0152065,.0206869,1.11291,.99922,-.00744837,.010155,1.12237,1.00002,240209e-9,-752767e-10,1.13089,.922948,-515351e-11,.255626,186069e-10,.928785,-129623e-9,.257244,468009e-9,.928761,-51849e-8,.257237,.00187202,.928751,-.0011666,.257235,.00421204,.928751,-.00207395,.257234,.0074881,.928754,-.00324055,.257235,.0117002,.92876,-.00466639,.257236,.0168486,.928763,-.00635149,.257237,.0229334,.928774,-.00829584,.257239,.029955,.928791,-.0104995,.257243,.0379139,.928804,-.0129623,.257245,.0468108,.928847,-.0156846,.257255,.0566473,.92889,-.0186661,.257263,.0674246,.928924,-.0219067,.257268,.0791433,.928989,-.0254066,.257282,.0918076,.92909,-.0291651,.257301,.105419,.92918,-.0331801,.257316,.119978,.92929,-.0374469,.257332,.135491,.929453,-.041939,.257357,.151948,.929586,-.0464612,.257347,.169275,.929858,-.0503426,.257269,.187257,.930125,-.0548409,.257199,.206204,.930403,-.0598063,.257149,.22601,.930726,-.0652437,.257122,.246561,.931098,-.0712376,.257153,.267618,.931396,-.0777506,.257237,.288993,.931947,-.0832374,.257124,.311527,.932579,-.0883955,.25683,.335697,.933194,-.0937037,.256444,.360634,.934013,-.0987292,.255939,.386126,.935307,-.103215,.255282,.412018,.936374,-.108234,.254538,.438292,.93776,-.113234,.253728,.464805,.939599,-.118013,.25275,.491464,.941036,-.122661,.251404,.518751,.94337,-.125477,.249435,.547133,.945318,-.128374,.247113,.575456,.947995,-.130996,.244441,.60372,.950818,-.133438,.241352,.63174,.954378,-.135004,.237849,.659971,.957151,-.135313,.233188,.688478,.960743,-.13521,.228001,.716767,.964352,-.135007,.222249,.744349,.967273,-.133523,.21542,.771786,.969767,-.131155,.208039,.798639,.973195,-.128492,.200076,.824774,.975557,-.125094,.191451,.850222,.977692,-.120578,.18184,.874761,.98026,-.115882,.172102,.898497,.981394,-.110372,.161859,.921636,.982386,-.10415,.15108,.943467,.983783,-.0978128,.140407,.964045,.98422,-.0906171,.129058,.98398,.985447,-.0832921,.117614,1.00276,.986682,-.0754412,.10585,1.02047,.987326,-.0673885,.0940943,1.03678,.988707,-.0592565,.0822093,1.05218,.990185,-.050717,.070192,1.06652,.991866,-.0423486,.0582081,1.07965,.993897,-.0336118,.0460985,1.09188,.995841,-.0252178,.0342737,1.10307,.997605,-.0164893,.0224829,1.11324,.999037,-.00817112,.0110647,1.12262,1.00003,291686e-9,-168673e-9,1.13139,.915304,-552675e-11,.275999,183285e-10,.91668,-139285e-9,.276414,461914e-9,.916664,-55713e-8,.276409,.00184763,.916653,-.00125354,.276406,.00415715,.916651,-.00222851,.276405,.00739053,.916655,-.00348205,.276406,.0115478,.916653,-.00501414,.276405,.0166291,.916667,-.00682478,.276409,.0226346,.91668,-.00891398,.276412,.0295648,.91669,-.0112817,.276413,.0374199,.916727,-.013928,.276422,.0462016,.916759,-.0168528,.276429,.0559101,.916793,-.0200558,.276436,.0665466,.916849,-.0235373,.276448,.0781139,.916964,-.0272973,.276474,.0906156,.917047,-.0313344,.276491,.104051,.917152,-.0356465,.276511,.118424,.917286,-.0402271,.276533,.133736,.917469,-.0450408,.276564,.149978,.917686,-.0497872,.276563,.167057,.917953,-.0540937,.276493,.184846,.918228,-.0590709,.276437,.203614,.918572,-.0644277,.276398,.223212,.918918,-.0702326,.276362,.243584,.919356,-.076484,.276383,.264465,.919842,-.0830808,.276434,.285701,.920451,-.0892972,.276407,.307559,.921113,-.095016,.276128,.331501,.921881,-.100771,.275754,.356207,.923027,-.106029,.275254,.381477,.924364,-.111029,.274595,.40722,.925818,-.116345,.273841,.433385,.92746,-.121424,.272913,.459848,.929167,-.12657,.271837,.486493,.931426,-.131581,.270575,.513432,.934001,-.135038,.268512,.541502,.936296,-.138039,.266135,.569658,.939985,-.140687,.263271,.598375,.943516,-.143247,.260058,.626563,.94782,-.145135,.256138,.654711,.951023,-.145733,.251154,.683285,.955338,-.145554,.245562,.711831,.959629,-.145008,.239265,.739573,.963123,-.144003,.232064,.767027,.966742,-.141289,.224036,.794359,.969991,-.138247,.215305,.820361,.973403,-.134786,.206051,.846548,.975317,-.129966,.195914,.871541,.977647,-.12471,.185184,.895313,.980137,-.119086,.174161,.918398,.981031,-.112297,.162792,.940679,.982037,-.105372,.150952,.961991,.983164,-.097821,.138921,.981913,.983757,-.0897245,.126611,1.00109,.985036,-.0815974,.114228,1.01902,.986289,-.0727725,.101389,1.03604,.987329,-.0639323,.0886476,1.05149,.989193,-.0548109,.0756837,1.06619,.990716,-.045687,.0627581,1.07948,.992769,-.0364315,.0498337,1.09172,.99524,-.0271761,.0370305,1.1033,.997154,-.0179609,.0243959,1.11353,.998845,-.00878063,.0119567,1.12319,1.00002,259038e-9,-108146e-9,1.13177,.903945,-591681e-11,.295126,181226e-10,.903668,-148672e-9,.295037,455367e-9,.903677,-594683e-9,.29504,.00182145,.903673,-.00133805,.295039,.00409831,.903666,-.00237872,.295036,.00728584,.903668,-.00371676,.295037,.0113842,.903679,-.00535212,.29504,.0163936,.903684,-.00728479,.295041,.0223141,.903698,-.00951473,.295044,.0291462,.903718,-.0120419,.295049,.0368904,.903754,-.0148664,.295058,.0455477,.903801,-.017988,.29507,.0551194,.903851,-.0214064,.295082,.0656058,.903921,-.0251219,.295097,.0770109,.904002,-.0291337,.295116,.0893354,.904111,-.033441,.29514,.102583,.904246,-.0380415,.295169,.116755,.904408,-.0429258,.295202,.131853,.904637,-.0480468,.295245,.147869,.904821,-.0529208,.295214,.164658,.905163,-.0577748,.295185,.182274,.905469,-.0631763,.295143,.200828,.905851,-.068917,.295112,.2202,.906322,-.0750861,.295104,.240372,.906761,-.0815855,.295086,.261082,.90735,-.0882138,.295095,.282123,.908087,-.095082,.295139,.303563,.908826,-.101488,.29492,.327028,.909832,-.107577,.294577,.351464,.911393,-.113033,.294115,.376497,.912804,-.118629,.293446,.402115,.914081,-.124232,.292581,.428111,.91637,-.129399,.29166,.454442,.91814,-.134892,.290422,.481024,.921179,-.140069,.289194,.507924,.924544,-.144431,.287421,.535557,.927995,-.147498,.284867,.563984,.931556,-.150197,.281722,.5923,.935777,-.152711,.278207,.620832,.940869,-.154836,.274148,.649069,.945994,-.155912,.269057,.677746,.949634,-.155641,.262799,.706293,.955032,-.154809,.256097,.734278,.95917,-.153678,.248618,.761751,.962931,-.151253,.239794,.789032,.966045,-.147625,.230281,.815422,.96971,-.143964,.220382,.841787,.972747,-.139464,.209846,.867446,.975545,-.133459,.198189,.892004,.978381,-.127424,.186362,.915458,.979935,-.120506,.173964,.937948,.980948,-.11282,.161429,.959732,.982234,-.104941,.148557,.980118,.982767,-.0962905,.135508,.999463,.983544,-.0873625,.122338,1.01756,.984965,-.0783447,.108669,1.03492,.986233,-.0684798,.0949911,1.05087,.987796,-.0590867,.0811386,1.0656,.989885,-.0489145,.0673099,1.0794,.991821,-.0391,.0535665,1.09174,.99448,-.029087,.0397529,1.10341,.996769,-.019114,.0261463,1.11383,.998641,-.00947007,.0128731,1.1237,.999978,446316e-9,-169093e-9,1.13253,.888362,-627064e-11,.312578,178215e-10,.889988,-157791e-9,.313148,448451e-9,.889825,-631076e-9,.313092,.00179356,.88984,-.00141994,.313097,.00403554,.889828,-.0025243,.313092,.00717429,.889831,-.00394421,.313093,.0112099,.889831,-.00567962,.313093,.0161425,.889844,-.00773051,.313096,.0219724,.889858,-.0100968,.3131,.0286999,.889882,-.0127786,.313106,.0363256,.889918,-.0157757,.313116,.0448509,.889967,-.0190878,.313129,.0542758,.89003,-.022715,.313145,.0646032,.890108,-.0266566,.313165,.0758339,.890218,-.0309131,.313193,.0879729,.890351,-.0354819,.313226,.101019,.89051,-.0403613,.313263,.114979,.890672,-.0455385,.313294,.129848,.890882,-.0509444,.313333,.145616,.891189,-.0559657,.313324,.162122,.891457,-.0613123,.313281,.179524,.891856,-.0671488,.313281,.197855,.892312,-.0732732,.313268,.216991,.892819,-.0797865,.313263,.236924,.893369,-.0865269,.313247,.257433,.894045,-.0931592,.313205,.278215,.894884,-.100532,.313276,.299467,.895832,-.107716,.313205,.322276,.897043,-.114099,.312873,.34642,.898515,-.119941,.312331,.371187,.900191,-.126044,.311731,.396656,.90188,-.131808,.310859,.422488,.904359,-.137289,.309857,.448744,.906923,-.142991,.308714,.475239,.910634,-.148253,.307465,.501983,.914502,-.153332,.305774,.529254,.919046,-.156646,.303156,.557709,.923194,-.159612,.299928,.586267,.928858,-.162027,.296245,.614925,.934464,-.164203,.291832,.643187,.939824,-.165602,.286565,.671601,.944582,-.165383,.280073,.700213,.949257,-.164439,.272891,.728432,.954389,-.162953,.264771,.756082,.958595,-.161007,.255927,.78369,.962138,-.157243,.245769,.810769,.966979,-.152872,.235127,.836999,.969566,-.148209,.22347,.862684,.972372,-.142211,.211147,.887847,.975916,-.135458,.198606,.911843,.978026,-.128398,.185498,.934795,.979686,-.120313,.17171,.956787,.980748,-.11166,.158159,.978046,.981622,-.103035,.144399,.997693,.982356,-.0930328,.13001,1.01642,.983308,-.0834627,.115778,1.03366,.985037,-.0732249,.101327,1.05014,.986493,-.0628145,.086554,1.06507,.988484,-.0526556,.0720413,1.07907,.991051,-.0415744,.0571151,1.09189,.993523,-.0314275,.0426643,1.10369,.99628,-.0203603,.0279325,1.11423,.998344,-.0102446,.0138182,1.12421,.999997,42612e-8,-193628e-9,1.1333,.871555,-660007e-11,.329176,174749e-10,.875255,-166579e-9,.330571,441051e-9,.875644,-666394e-9,.330718,.00176441,.875159,-.00149903,.330536,.00396899,.87516,-.00266493,.330536,.007056,.875158,-.00416393,.330535,.0110251,.87516,-.00599598,.330535,.0158764,.875163,-.00816108,.330536,.0216101,.875174,-.0106591,.330538,.0282266,.875199,-.0134899,.330545,.0357266,.875257,-.0166538,.330563,.0441117,.875304,-.0201501,.330575,.0533821,.875373,-.0239785,.330595,.0635395,.875464,-.0281389,.330619,.0745872,.875565,-.0326301,.330645,.0865255,.875691,-.0374516,.330676,.0993599,.875897,-.0425993,.330733,.113093,.876091,-.0480576,.330776,.127722,.876353,-.0537216,.330826,.143227,.876649,-.0589807,.330809,.159462,.877034,-.0647865,.330819,.176642,.877443,-.0709789,.330817,.194702,.877956,-.0774782,.330832,.213577,.878499,-.0843175,.330822,.233246,.879144,-.0912714,.330804,.253512,.879982,-.0980824,.330766,.274137,.88097,-.105823,.330864,.295209,.882051,-.113671,.330896,.317226,.883397,-.120303,.330545,.341068,.884987,-.12667,.330068,.365613,.886789,-.133118,.329418,.390807,.889311,-.139024,.328683,.416494,.891995,-.144971,.327729,.442618,.895106,-.150747,.326521,.469131,.899527,-.156283,.325229,.495921,.90504,-.161707,.32378,.523162,.909875,-.165661,.32122,.55092,.91561,-.168755,.317942,.579928,.921225,-.171193,.313983,.608539,.927308,-.17319,.309636,.636854,.933077,-.174819,.304262,.66523,.938766,-.175002,.297563,.693609,.943667,-.173946,.289613,.722157,.949033,-.172221,.281227,.750021,.953765,-.169869,.271545,.777466,.95804,-.166578,.261034,.804853,.962302,-.161761,.249434,.831569,.966544,-.156636,.237484,.857779,.969372,-.150784,.224395,.883051,.972486,-.143672,.210786,.907864,.975853,-.135772,.196556,.931223,.977975,-.127942,.182307,.954061,.979122,-.118347,.167607,.97531,.980719,-.109112,.152739,.995666,.981223,-.0991789,.137932,1.01475,.98216,-.0883553,.122692,1.03253,.983379,-.0780825,.107493,1.04917,.985434,-.0665646,.0917791,1.06464,.987332,-.0557714,.0764949,1.07896,.990004,-.0442805,.060721,1.09199,.992975,-.0331676,.0452284,1.10393,.995811,-.0219547,.0297934,1.11476,.9982,-.0107613,.0146415,1.12484,1.00002,248678e-9,-14555e-8,1.13413,.859519,-693595e-11,.347264,171673e-10,.859843,-17503e-8,.347394,433219e-9,.859656,-700076e-9,.347319,.00173277,.859671,-.00157517,.347325,.00389875,.859669,-.00280028,.347324,.00693112,.85967,-.0043754,.347324,.01083,.859665,-.00630049,.347321,.0155954,.859685,-.0085755,.347328,.0212278,.859694,-.0112003,.347329,.0277273,.859718,-.0141747,.347336,.0350946,.85976,-.0174988,.347348,.0433314,.85982,-.0211722,.347366,.0524384,.859892,-.0251941,.347387,.0624168,.860006,-.0295649,.347422,.0732708,.860122,-.0342825,.347453,.0849999,.860282,-.0393462,.347499,.0976102,.860482,-.0447513,.347554,.111104,.860719,-.0504775,.347614,.125479,.860998,-.0563577,.347666,.140703,.861322,-.0619473,.347662,.156681,.861724,-.0681277,.347684,.173597,.862198,-.0746567,.347709,.191371,.862733,-.0815234,.347727,.209976,.863371,-.0886643,.347744,.229351,.86414,-.0957908,.347734,.24934,.865138,-.102912,.34772,.269797,.866182,-.110924,.3478,.290654,.867436,-.119223,.347911,.312074,.869087,-.126197,.347649,.335438,.870859,-.133145,.347222,.359732,.872997,-.139869,.346645,.38467,.875939,-.146089,.345935,.41019,.879012,-.152334,.345012,.436218,.883353,-.15821,.343924,.462641,.888362,-.164097,.342636,.489449,.895026,-.169528,.341351,.516629,.900753,-.174408,.339115,.544109,.906814,-.17751,.335809,.572857,.912855,-.180101,.331597,.601554,.919438,-.182116,.32698,.630198,.925962,-.183494,.321449,.658404,.931734,-.184159,.314595,.686625,.93762,-.18304,.306462,.71531,.943858,-.181323,.297514,.744272,.948662,-.178683,.287447,.771462,.953299,-.175379,.276166,.798593,.957346,-.170395,.263758,.8256,.962565,-.165042,.251019,.852575,.966075,-.158655,.237011,.878316,.969048,-.151707,.222518,.90329,.972423,-.143271,.207848,.927745,.975833,-.134824,.192463,.950859,.977629,-.125444,.1768,.972947,.978995,-.114949,.161033,.993263,.980533,-.104936,.145523,1.01337,.980745,-.0935577,.129799,1.03128,.981814,-.0822956,.113486,1.04825,.983943,-.0710082,.0972925,1.06405,.986141,-.0587931,.0808138,1.0785,.988878,-.0472755,.0644915,1.09204,.992132,-.0349128,.0478128,1.10413,.9953,-.0232407,.031621,1.11527,.998117,-.0112713,.0154935,1.12551,1.00003,339743e-9,-195763e-9,1.13504,.845441,-729126e-11,.364305,169208e-10,.843588,-183164e-9,.363506,425067e-9,.843412,-73253e-8,.36343,.00169999,.843401,-.00164818,.363426,.00382495,.843399,-.00293008,.363425,.00679993,.843401,-.00457822,.363425,.010625,.843394,-.00659249,.363421,.0153002,.843398,-.00897282,.363421,.0208258,.843415,-.0117191,.363426,.0272024,.843438,-.0148312,.363432,.0344305,.843483,-.018309,.363447,.0425116,.84356,-.0221521,.363472,.0514471,.843646,-.0263597,.363499,.061238,.843743,-.0309315,.363527,.0718873,.84388,-.0358658,.363569,.0833969,.844079,-.0411624,.363631,.0957742,.844279,-.0468128,.363688,.109015,.844549,-.0527923,.363761,.123124,.844858,-.0588204,.363817,.138044,.84522,-.0647573,.36383,.153755,.845669,-.0713181,.363879,.170394,.846155,-.0781697,.363908,.187861,.846789,-.0853913,.363969,.206176,.847502,-.0928086,.363999,.225244,.8484,-.10005,.363997,.244926,.849461,-.107615,.364008,.265188,.850562,-.115814,.364055,.28587,.851962,-.124334,.364179,.306926,.854326,-.131995,.364233,.329605,.856295,-.139338,.363856,.35359,.858857,-.146346,.363347,.37831,.862428,-.152994,.362807,.403722,.866203,-.159463,.361963,.429537,.871629,-.165623,.36112,.456,.877365,-.171649,.359917,.482773,.883744,-.177151,.35848,.509705,.890693,-.182381,.356523,.537215,.897278,-.186076,.3533,.565493,.903958,-.188602,.349095,.594293,.910908,-.190755,.344215,.623165,.918117,-.192063,.338606,.651573,.924644,-.192758,.331544,.679869,.931054,-.192238,.323163,.708668,.937303,-.190035,.313529,.737201,.943387,-.187162,.303152,.764977,.948494,-.183876,.29146,.792683,.952546,-.178901,.277917,.819228,.958077,-.173173,.264753,.846559,.962462,-.16645,.25002,.872962,.966569,-.159452,.234873,.898729,.969108,-.15074,.218752,.923126,.973072,-.141523,.202673,.947278,.975452,-.132075,.186326,.969938,.977784,-.121257,.169396,.991325,.97899,-.110182,.153044,1.01123,.979777,-.0989634,.136485,1.0299,.980865,-.0865894,.119343,1.04727,.982432,-.0746115,.102452,1.06341,.984935,-.0621822,.0852423,1.07834,.987776,-.0495694,.0678546,1.092,.99103,-.0372386,.0506917,1.1043,.99474,-.0244353,.0333316,1.11576,.997768,-.0121448,.0164348,1.12617,1.00003,31774e-8,-169504e-9,1.13598,.825551,-756799e-11,.378425,165099e-10,.82664,-190922e-9,.378923,416504e-9,.826323,-763495e-9,.378779,.0016656,.826359,-.00171789,.378795,.00374768,.82636,-.00305402,.378795,.00666259,.826368,-.00477185,.378798,.0104104,.826364,-.00687131,.378795,.0149912,.826368,-.00935232,.378795,.0204054,.826376,-.0122146,.378797,.0266532,.826399,-.0154581,.378803,.0337355,.82646,-.0190825,.378824,.0416537,.826525,-.0230873,.378846,.0504091,.826614,-.0274719,.378876,.0600032,.82674,-.0322355,.378917,.0704393,.826888,-.0373766,.378964,.0817195,.827078,-.0428936,.379024,.0938492,.827318,-.0487778,.379099,.106828,.82764,-.0549935,.379199,.120659,.827926,-.0611058,.379227,.13526,.828325,-.0675054,.379275,.150713,.828801,-.0743455,.379332,.167034,.8294,-.0815523,.379415,.184209,.830094,-.0890779,.379495,.202203,.8309,-.096736,.379555,.220945,.831943,-.104135,.379577,.240306,.833037,-.112106,.379604,.260317,.834278,-.120554,.379668,.2808,.836192,-.129128,.3799,.301654,.838671,-.137541,.380109,.323502,.840939,-.14523,.379809,.347176,.844575,-.15248,.379593,.371706,.848379,-.159607,.37909,.39688,.853616,-.166267,.378617,.422702,.858921,-.172698,.377746,.448919,.865324,-.178823,.376749,.475661,.872207,-.184542,.375363,.502599,.880018,-.189836,.373657,.529914,.88694,-.194294,.370673,.557683,.894779,-.197022,.36662,.586848,.902242,-.199108,.36138,.615831,.909914,-.200398,.355434,.644478,.917088,-.20094,.348173,.672905,.923888,-.200671,.339482,.701327,.930495,-.198773,.32956,.730101,.937247,-.195394,.318363,.758383,.943108,-.191956,.306323,.786539,.948296,-.187227,.292576,.813637,.953472,-.181165,.278234,.840793,.958485,-.174119,.263054,.867712,.962714,-.166564,.246756,.893635,.966185,-.158181,.229945,.919028,.970146,-.148275,.212633,.943413,.973491,-.138157,.195229,.966627,.975741,-.127574,.178048,.988817,.977238,-.11554,.160312,1.00924,.978411,-.10364,.142857,1.02845,.979811,-.0913122,.125317,1.04648,.98116,-.0782558,.107627,1.06284,.983543,-.0655957,.0895862,1.07798,.986789,-.0520411,.0713756,1.092,.990292,-.0389727,.053228,1.10484,.994187,-.025808,.0351945,1.11642,.997499,-.0126071,.0173198,1.12703,.999999,275604e-9,-148602e-9,1.13674,.81075,-78735e-10,.394456,161829e-10,.808692,-198293e-9,.393453,407564e-9,.80846,-792877e-9,.39334,.00162965,.808595,-.00178416,.393407,.00366711,.808597,-.00317182,.393408,.00651934,.808598,-.00495589,.393408,.0101866,.808591,-.00713627,.393403,.0146689,.808592,-.00971285,.393402,.0199667,.80861,-.0126855,.393407,.0260803,.808633,-.0160538,.393413,.0330107,.80868,-.0198175,.393429,.0407589,.808748,-.0239758,.393453,.0493264,.808854,-.0285286,.39349,.0587161,.808992,-.0334748,.39354,.0689304,.809141,-.0388116,.393588,.0799707,.809352,-.0445375,.39366,.0918432,.809608,-.0506427,.393742,.104549,.809915,-.0570708,.393834,.118085,.810253,-.0633526,.393885,.132377,.810687,-.0700966,.393953,.147537,.811233,-.0772274,.394047,.163543,.811865,-.0847629,.394148,.180394,.812648,-.0925663,.394265,.198051,.813583,-.100416,.394363,.216443,.814683,-.108119,.394402,.235502,.815948,-.11644,.394489,.255242,.817278,-.125036,.394542,.275441,.819605,-.133655,.39486,.296094,.822256,-.142682,.395248,.317309,.825349,-.150756,.395241,.340516,.829605,-.158392,.395285,.364819,.83391,-.165801,.394922,.389736,.839808,-.172677,.394691,.415409,.845708,-.179448,.394006,.441546,.853025,-.185746,.393279,.46832,.859666,-.191684,.391655,.495302,.86789,-.197146,.390068,.52262,.875845,-.201904,.38727,.550336,.882634,-.205023,.382688,.578825,.891076,-.207098,.377543,.608103,.900589,-.208474,.371752,.63723,.90791,-.209068,.364016,.665769,.915971,-.208655,.355593,.694428,.923455,-.20729,.345439,.723224,.931514,-.203821,.334099,.751925,.937885,-.19986,.321069,.780249,.943136,-.194993,.306571,.8077,.948818,-.189132,.291556,.83497,.954433,-.181617,.275745,.86188,.959078,-.173595,.258695,.888562,.962705,-.164855,.240825,.914008,.966753,-.155129,.22268,.939145,.970704,-.144241,.204542,.963393,.973367,-.133188,.185927,.985983,.975984,-.121146,.167743,1.00704,.976994,-.108366,.149218,1.02715,.978485,-.0956746,.13131,1.0455,.980074,-.0820733,.112513,1.06221,.98225,-.0684061,.0938323,1.07782,.98553,-.0549503,.0749508,1.09199,.989529,-.0407857,.055848,1.10508,.993536,-.0271978,.0368581,1.11684,.997247,-.0132716,.0181845,1.12789,1,431817e-9,-198809e-9,1.13792,.785886,-812608e-11,.405036,157669e-10,.790388,-205278e-9,.407355,398297e-9,.790145,-820824e-9,.407231,.00159263,.790135,-.00184681,.407226,.00358336,.790119,-.00328316,.407218,.00637039,.790126,-.00512988,.40722,.0099539,.79013,-.00738684,.407221,.0143339,.790135,-.0100538,.407221,.0195107,.790134,-.0131306,.407217,.0254848,.79016,-.0166169,.407224,.0322572,.790197,-.020512,.407236,.0398284,.790273,-.0248157,.407263,.0482014,.790381,-.029527,.407304,.0573777,.790521,-.0346446,.407355,.0673602,.790704,-.0401665,.40742,.0781522,.790925,-.0460896,.407499,.0897582,.791195,-.0524017,.407589,.10218,.791522,-.0590121,.407691,.11541,.791878,-.0654876,.407748,.12939,.792361,-.0725207,.407849,.144237,.792942,-.0799844,.407963,.159924,.79362,-.0877896,.408087,.176425,.794529,-.0958451,.408259,.193733,.795521,-.103827,.408362,.211756,.796778,-.111937,.408482,.230524,.798027,-.120521,.408547,.249967,.799813,-.129242,.408721,.269926,.802387,-.138048,.409148,.290338,.805279,-.147301,.409641,.311193,.809251,-.155895,.410154,.333611,.813733,-.163942,.410297,.357615,.819081,-.171666,.410373,.382339,.825427,-.178905,.410348,.407828,.83172,-.185812,.409486,.434034,.83877,-.192318,.408776,.460493,.845817,-.198249,.407176,.487346,.854664,-.204034,.405719,.514832,.863495,-.208908,.403282,.542401,.871883,-.212765,.399293,.570683,.88065,-.214911,.393803,.599947,.89004,-.216214,.387536,.62932,.898476,-.216745,.379846,.658319,.906738,-.216387,.370625,.687138,.914844,-.215053,.360139,.71601,.923877,-.212007,.348849,.745124,.931925,-.207481,.335639,.773366,.938054,-.202418,.320798,.801636,.943895,-.196507,.304772,.829055,.949468,-.189009,.288033,.856097,.955152,-.180539,.270532,.88301,.959403,-.171437,.251639,.909296,.963309,-.161661,.232563,.934868,.967399,-.150425,.213231,.959662,.972009,-.138659,.194247,.98302,.97433,-.126595,.174718,1.00517,.975823,-.113205,.155518,1.02566,.976371,-.0996096,.136709,1.04418,.978705,-.0860754,.117571,1.06146,.981477,-.0714438,.0980046,1.07777,.984263,-.0572304,.0782181,1.09214,.988423,-.0428875,.0584052,1.10553,.993,-.0282442,.038522,1.11758,.99704,-.0140183,.0190148,1.12864,.999913,369494e-9,-145203e-9,1.13901,.777662,-84153e-10,.423844,154403e-10,.770458,-211714e-9,.419915,38845e-8,.770716,-846888e-9,.420055,.00155386,.770982,-.00190567,.420202,.00349653,.770981,-.00338782,.420201,.00621606,.77098,-.00529338,.4202,.00971274,.770983,-.00762223,.4202,.0139867,.770985,-.0103741,.420198,.0190381,.770996,-.0135489,.4202,.0248677,.771029,-.0171461,.420212,.0314764,.771052,-.0211647,.420215,.0388648,.771131,-.0256048,.420245,.047036,.771235,-.0304647,.420284,.0559911,.771383,-.0357436,.420341,.0657346,.771591,-.0414392,.420423,.0762694,.771819,-.0475462,.420506,.0875984,.772123,-.0540506,.420617,.099727,.772464,-.060797,.42072,.112637,.772855,-.0675393,.420799,.126313,.773317,-.0748323,.420893,.140824,.773981,-.0825681,.421058,.15617,.774746,-.0906307,.421226,.172322,.77566,-.0988982,.421397,.189253,.776837,-.106994,.421569,.206912,.778097,-.115528,.421704,.225359,.779588,-.124317,.421849,.24447,.781574,-.133139,.422097,.264156,.784451,-.142179,.422615,.284318,.787682,-.15165,.423269,.304902,.792433,-.160771,.424396,.3265,.797359,-.169166,.424772,.35014,.803986,-.177149,.425475,.374768,.809504,-.184745,.424996,.399928,.815885,-.19173,.424247,.425796,.823513,-.198525,.423515,.452287,.832549,-.204709,.422787,.479321,.841653,-.210447,.421187,.506718,.850401,-.215501,.418519,.53432,.859854,-.219752,.414715,.56242,.869364,-.222305,.409462,.591558,.878837,-.223744,.402926,.621074,.888636,-.224065,.395043,.650538,.898132,-.223742,.38564,.679538,.907181,-.222308,.375378,.708674,.915621,-.219837,.363212,.737714,.9239,-.215233,.349313,.767014,.931644,-.209592,.334162,.795133,.938887,-.203644,.317943,.823228,.945282,-.196349,.300581,.850822,.950758,-.18742,.282195,.877594,.956146,-.177879,.262481,.904564,.960355,-.167643,.242487,.930741,.965256,-.156671,.222668,.955868,.968029,-.144123,.201907,.979869,.97251,-.131305,.18202,1.00291,.974925,-.118335,.161909,1.02392,.975402,-.103714,.142129,1.0433,.976987,-.089415,.122447,1.06089,.979677,-.0748858,.102248,1.07713,.983184,-.0596086,.0814851,1.09218,.987466,-.0447671,.0609484,1.10585,.992348,-.0295217,.0401835,1.11829,.996674,-.0143917,.0198163,1.12966,1.00003,321364e-9,-149983e-9,1.1402,.757901,-869074e-11,.436176,151011e-10,.751195,-217848e-9,.432317,378533e-9,.751178,-871373e-9,.432307,.0015141,.751195,-.00196061,.432317,.0034068,.751198,-.00348552,.432318,.00605659,.751195,-.00544599,.432315,.00946353,.751207,-.00784203,.43232,.013628,.751213,-.0106732,.43232,.0185499,.751221,-.0139393,.432319,.0242302,.751244,-.0176398,.432325,.0306694,.7513,-.0217743,.432348,.0378698,.751358,-.0263412,.432367,.0458321,.751458,-.0313396,.432404,.0545587,.751608,-.0367682,.432464,.0640543,.7518,-.0426246,.43254,.0743222,.752065,-.0489031,.432645,.0853668,.752376,-.0555828,.432762,.0971911,.752715,-.0623861,.432859,.109768,.753137,-.069415,.432958,.123126,.753676,-.0770039,.433099,.137308,.754345,-.084971,.433272,.15229,.755235,-.0932681,.433504,.168075,.756186,-.10171,.433693,.184625,.757363,-.110019,.433857,.201897,.75884,-.11887,.434102,.220014,.760467,-.127881,.434306,.238778,.762969,-.136766,.434751,.258172,.765823,-.14612,.43529,.278062,.769676,-.15566,.436236,.298437,.774909,-.165177,.437754,.319532,.77994,-.17402,.438343,.342505,.785757,-.182201,.438609,.366693,.792487,-.190104,.438762,.391668,.80038,-.197438,.438795,.417494,.808494,-.204365,.438226,.443933,.817695,-.210714,.437283,.470929,.828111,-.216651,.436087,.498569,.837901,-.221804,.433717,.526165,.847813,-.226318,.430133,.554155,.858314,-.229297,.425213,.582822,.868891,-.230999,.418576,.612847,.878941,-.231155,.410405,.642445,.888809,-.230935,.400544,.672024,.898089,-.229343,.389613,.701366,.908081,-.226886,.377197,.730763,.916819,-.222676,.363397,.759642,.924968,-.216835,.347437,.788775,.932906,-.210245,.32995,.817135,.940025,-.202992,.312262,.844912,.946101,-.19436,.293313,.872164,.952835,-.184125,.273638,.899443,.957347,-.173657,.252385,.926389,.961434,-.162204,.231038,.951947,.965522,-.14979,.209834,.976751,.969412,-.136307,.188821,1.00022,.973902,-.122527,.168013,1.02229,.974045,-.108213,.147634,1.04199,.975775,-.0927397,.12705,1.06019,.978383,-.0778212,.106309,1.07711,.98211,-.0621216,.0849279,1.09245,.986517,-.0463847,.0633519,1.10651,.991696,-.0309353,.0419698,1.11903,.996349,-.0150914,.0206272,1.13073,1.00003,442449e-9,-231396e-9,1.14146,.727498,-885074e-11,.441528,145832e-10,.730897,-223525e-9,.443589,368298e-9,.730796,-893996e-9,.443528,.00147303,.730805,-.00201149,.443533,.00331433,.730814,-.00357596,.443538,.00589222,.730815,-.00558734,.443538,.00920678,.730822,-.00804544,.44354,.0132582,.730836,-.0109501,.443545,.0180468,.730848,-.0143008,.443546,.0235732,.730871,-.0180969,.443552,.0298382,.730915,-.022338,.443567,.0368438,.730982,-.0270225,.443591,.044591,.731076,-.0321491,.443627,.0530831,.731245,-.0377166,.443699,.0623243,.73144,-.0437216,.443777,.0723181,.7317,-.0501576,.443881,.0830691,.732034,-.0569942,.444014,.0945809,.732388,-.0638756,.444113,.106825,.732853,-.071203,.444247,.119859,.733473,-.0790076,.444442,.13369,.734195,-.0871937,.444645,.148304,.735069,-.095696,.444877,.163702,.736169,-.10426,.445133,.179861,.73747,-.112853,.44537,.196778,.738991,-.12199,.445651,.214496,.740865,-.131153,.445958,.232913,.743637,-.140245,.446548,.251977,.746797,-.149722,.447246,.271551,.751517,-.159341,.448656,.291774,.756156,-.169106,.449866,.312455,.761519,-.178436,.450919,.334552,.768295,-.186904,.451776,.358491,.776613,-.195117,.452832,.383446,.783966,-.202695,.45249,.408945,.793542,-.20985,.452587,.435364,.803192,-.216403,.451852,.462336,.813892,-.22251,.450708,.48987,.824968,-.227676,.4486,.517697,.835859,-.232443,.445156,.545975,.846825,-.235775,.440351,.574483,.858085,-.237897,.433641,.604246,.868825,-.238074,.425354,.634101,.879638,-.237661,.415383,.664201,.889966,-.236186,.404136,.693918,.899479,-.233599,.390917,.723481,.908769,-.229737,.376352,.75258,.917966,-.223836,.360372,.781764,.926304,-.217067,.342551,.811139,.934626,-.209309,.324238,.839585,.941841,-.20071,.304484,.867044,.94789,-.190602,.283607,.894579,.954196,-.179253,.262205,.921743,.958383,-.167646,.239847,.948026,.963119,-.155073,.218078,.973296,.966941,-.141426,.195899,.998135,.970836,-.126849,.174121,1.02021,.973301,-.112296,.153052,1.04085,.97448,-.0964965,.131733,1.05946,.977045,-.080489,.10997,1.07693,.980751,-.064844,.0881657,1.09254,.985475,-.0481938,.0657987,1.10697,.991089,-.0319185,.0435215,1.12004,.996122,-.0158088,.0214779,1.13173,1.00001,372455e-9,-200295e-9,1.14291,.708622,-907597e-11,.45304,141962e-10,.711162,-228911e-9,.454662,358052e-9,.709812,-914446e-9,.453797,.00143034,.709865,-.00205819,.453834,.00321935,.709864,-.00365894,.453833,.00572331,.709855,-.00571692,.453826,.00894278,.709862,-.00823201,.453828,.012878,.709875,-.011204,.453832,.0175295,.709896,-.0146323,.453839,.0228978,.709925,-.0185163,.453847,.0289839,.709974,-.0228551,.453866,.0357894,.710045,-.0276473,.453892,.0433161,.710133,-.032891,.453924,.0515665,.710292,-.0385851,.453992,.0605458,.710485,-.0447254,.45407,.0702574,.710769,-.0513051,.454192,.0807077,.711106,-.0582733,.454329,.091896,.711516,-.0652866,.45446,.103814,.712071,-.0728426,.454653,.116508,.712676,-.0808307,.45484,.129968,.713476,-.0892216,.455096,.144206,.714377,-.0979047,.455346,.159212,.715579,-.106531,.455647,.174973,.716977,-.115492,.455961,.191504,.71862,-.124821,.456315,.208835,.72084,-.134079,.4568,.226869,.723786,-.143427,.457521,.245582,.727464,-.153061,.458475,.264957,.732771,-.162768,.460239,.284948,.736515,-.172627,.460899,.30522,.743519,-.182487,.463225,.326717,.750041,-.191295,.464027,.350113,.758589,-.199746,.465227,.374782,.767703,-.207584,.465877,.400226,.777484,-.214973,.465996,.426442,.788792,-.221796,.466019,.453688,.800194,-.228038,.465083,.481246,.811234,-.233346,.462506,.509086,.822859,-.238073,.459257,.537338,.835082,-.241764,.454863,.566108,.846332,-.244241,.448163,.595126,.858355,-.244736,.439709,.625574,.87034,-.244278,.429837,.65617,.881027,-.24255,.418002,.686029,.891007,-.239912,.404325,.716039,.900874,-.236133,.389222,.745518,.911072,-.230672,.373269,.775026,.920359,-.22356,.355083,.804521,.928604,-.215591,.335533,.834045,.937175,-.206503,.315278,.861612,.942825,-.196684,.293653,.889131,.949805,-.185116,.271503,.916853,.955535,-.172703,.248821,.943541,.959843,-.159978,.225591,.970132,.964393,-.146375,.202719,.994709,.968008,-.131269,.179928,1.0186,.971013,-.11569,.158007,1.03928,.973334,-.1003,.13624,1.05887,.975775,-.0833352,.1138,1.07652,.979579,-.0668981,.0913141,1.09297,.984323,-.0500902,.0683051,1.10734,.990351,-.0332377,.0451771,1.12084,.995823,-.0161491,.0221705,1.13296,1.0001,234083e-9,-108712e-9,1.14441,.683895,-924677e-11,.46015,137429e-10,.68833,-233383e-9,.463134,346865e-9,.688368,-933547e-9,.463159,.00138748,.688367,-.00210049,.463159,.00312187,.688369,-.00373415,.463159,.00555004,.688377,-.00583449,.463163,.00867216,.688386,-.00840128,.463166,.0124884,.688398,-.0114343,.463169,.0169993,.688418,-.0149329,.463175,.0222054,.688453,-.0188964,.463188,.028108,.688515,-.0233239,.463214,.0347085,.68857,-.0282136,.463231,.0420091,.688679,-.033564,.463276,.0500132,.688854,-.0393733,.463356,.0587255,.689038,-.0456354,.46343,.0681476,.689321,-.0523433,.463553,.0782897,.689662,-.059412,.463693,.0891501,.690188,-.0665736,.4639,.100735,.690755,-.0743106,.464107,.113074,.691405,-.0824722,.464329,.126161,.692198,-.0910484,.464585,.140007,.693196,-.0998778,.464893,.154612,.69454,-.108651,.465285,.169984,.695921,-.117855,.465596,.186106,.697749,-.12734,.466056,.203034,.700375,-.136714,.466771,.220703,.703395,-.146386,.467579,.239062,.707904,-.156096,.469067,.258188,.711673,-.165904,.469851,.277759,.717489,-.175812,.471815,.297935,.724051,-.185931,.47389,.318916,.731965,-.195238,.47587,.341591,.741151,-.204021,.477523,.366062,.751416,-.212113,.478881,.391396,.761848,-.21979,.479226,.417599,.771886,-.2267,.478495,.444401,.783998,-.232991,.477622,.472084,.796523,-.238645,.475833,.500193,.808851,-.243396,.472568,.52865,.821191,-.247226,.467857,.557362,.834261,-.250102,.461871,.586768,.846762,-.251056,.453543,.617085,.859867,-.250604,.443494,.647659,.871948,-.248783,.431711,.678119,.882967,-.245855,.417911,.708399,.892826,-.242168,.401993,.738256,.90332,-.237062,.385371,.767999,.913633,-.22997,.366837,.798191,.922774,-.221687,.346372,.827756,.931371,-.212345,.325682,.856425,.938929,-.20206,.303665,.884299,.944821,-.190981,.280786,.912023,.951792,-.178065,.2573,.939669,.957712,-.164634,.233448,.96655,.961912,-.150863,.209504,.992366,.966382,-.13577,.18597,1.01633,.969588,-.119593,.162905,1.03843,.971777,-.103203,.14053,1.05841,.97433,-.0865888,.117909,1.07632,.978686,-.0690829,.0944101,1.09326,.983281,-.0516568,.0705671,1.10796,.989562,-.034558,.0468592,1.12182,.995465,-.0167808,.0229846,1.1342,.999991,373016e-9,-235606e-9,1.1459,.662251,-939016e-11,.468575,132714e-10,.666634,-237624e-9,.471675,335842e-9,.666411,-950385e-9,.471516,.00134321,.666399,-.00213833,.471509,.00302221,.666386,-.0038014,.471499,.00537283,.666405,-.00593958,.471511,.00839533,.666406,-.00855253,.471508,.0120898,.666428,-.0116401,.471519,.0164569,.666444,-.0152015,.471522,.0214971,.66649,-.0192362,.471543,.027212,.666537,-.0237428,.471558,.033603,.666617,-.0287198,.471591,.0406728,.666718,-.0341647,.471631,.0484238,.666889,-.0400759,.47171,.0568621,.667104,-.0464479,.471805,.0659915,.667374,-.0532677,.471923,.0758178,.667772,-.0603805,.472098,.0863425,.668371,-.0677392,.472363,.0975917,.668971,-.0756028,.472596,.109567,.669696,-.0839293,.472869,.122272,.670481,-.0926683,.473126,.135718,.6715,-.1016,.473442,.149914,.672911,-.110566,.47389,.164882,.674512,-.119984,.474354,.180602,.67651,-.129574,.474922,.19711,.679292,-.139106,.475764,.214371,.682798,-.148993,.476886,.232405,.686955,-.158737,.478179,.251153,.691406,-.168754,.479432,.270436,.697438,-.178703,.481481,.290374,.704761,-.188955,.484143,.311044,.713599,-.198814,.487007,.333003,.723194,-.207869,.488962,.357144,.732601,-.216189,.489815,.382169,.744193,-.22398,.490888,.408227,.754907,-.231156,.490355,.434928,.767403,-.23747,.489548,.462599,.78107,-.243503,.488274,.490908,.793893,-.248114,.484843,.519421,.807296,-.25222,.4803,.548561,.820529,-.255265,.474097,.577772,.833716,-.256741,.466041,.607782,.848403,-.25637,.456547,.638807,.860755,-.254804,.443946,.670058,.874012,-.251834,.430852,.700749,.885619,-.247867,.414903,.731446,.896069,-.242634,.397276,.761191,.906266,-.236093,.378535,.791053,.916759,-.227543,.358038,.821298,.92523,-.21783,.335705,.850747,.93436,-.207534,.313797,.879258,.941631,-.195983,.289671,.907734,.947564,-.183567,.265319,.935206,.953681,-.169345,.240815,.962739,.960008,-.154909,.216119,.989227,.964145,-.140161,.192096,1.01465,.968171,-.123411,.167855,1.03737,.969859,-.106525,.144817,1.05767,.972666,-.0891023,.12149,1.0761,.977055,-.0718094,.0975306,1.09336,.982527,-.0534213,.0730217,1.10878,.989001,-.0355579,.0483366,1.12285,.99512,-.0176383,.023938,1.13548,1.00007,368831e-9,-211581e-9,1.14744,.651047,-960845e-11,.484101,12922e-9,.644145,-241347e-9,.478968,324578e-9,.64396,-965142e-9,.478831,.00129798,.64396,-.00217154,.47883,.00292046,.643968,-.00386049,.478835,.00519202,.643974,-.00603186,.478838,.0081128,.643977,-.0086854,.478836,.011683,.643982,-.0118207,.478834,.0159031,.644024,-.0154374,.478856,.0207743,.644059,-.0195343,.478868,.0262975,.644122,-.0241103,.478896,.0324747,.644207,-.0291638,.478933,.039309,.64432,-.0346919,.478981,.0468029,.644481,-.0406919,.479053,.0549614,.644722,-.047159,.479169,.0637909,.645013,-.0540748,.479302,.0732974,.645503,-.0612001,.479541,.0834898,.646117,-.0687303,.479829,.0943873,.646707,-.0767846,.480061,.105991,.647431,-.0852465,.480343,.11831,.64831,-.0940719,.48066,.131348,.649486,-.103056,.481083,.14514,.650864,-.112261,.481528,.159676,.652604,-.121852,.482102,.174979,.654825,-.131505,.482813,.191079,.657876,-.141189,.483876,.207927,.661339,-.151239,.48499,.225586,.665463,-.161091,.486279,.243947,.670542,-.171235,.487968,.262957,.677361,-.181347,.49053,.282781,.685672,-.191679,.493862,.303311,.694551,-.201781,.49699,.324607,.703753,-.211164,.498884,.347916,.713703,-.219675,.500086,.372628,.725911,-.227836,.501554,.398694,.73862,-.23533,.502193,.425529,.752118,-.241786,.501811,.453209,.76579,-.247865,.500185,.481381,.779568,-.252696,.497159,.51011,.793991,-.256802,.492765,.539322,.808182,-.259942,.486827,.569078,.821698,-.261703,.478386,.598818,.836009,-.262006,.468772,.629762,.849824,-.260333,.456352,.661366,.863888,-.257398,.442533,.69295,.876585,-.253264,.426573,.723608,.888665,-.248026,.408964,.754378,.899537,-.241487,.389677,.784761,.9094,-.233463,.368516,.814688,.920166,-.223397,.346624,.845009,.928899,-.21255,.322717,.874431,.937156,-.200869,.298698,.902922,.943861,-.188387,.273491,.931356,.949557,-.174341,.247866,.958854,.955862,-.158994,.222496,.986098,.961721,-.143664,.197522,1.01229,.965976,-.127412,.17302,1.03571,.968652,-.109798,.148954,1.05699,.971084,-.0916787,.125044,1.07587,.975584,-.0739634,.100577,1.09372,.98122,-.055322,.0753666,1.10948,.988253,-.0366825,.0498899,1.12394,.99482,-.0180389,.024611,1.13694,1.00001,229839e-9,-188283e-9,1.14919,.613867,-964198e-11,.479449,123452e-10,.621485,-244534e-9,.485399,313091e-9,.621429,-978202e-9,.485353,.00125245,.62112,-.00220004,.485114,.00281687,.621119,-.0039111,.485112,.00500783,.621122,-.00611091,.485112,.00782498,.621133,-.00879922,.485117,.0112687,.621152,-.0119756,.485125,.0153394,.621183,-.0156396,.485139,.0200382,.621227,-.0197898,.485158,.0253663,.621298,-.0244253,.485192,.0313261,.621388,-.0295441,.485233,.0379204,.621507,-.0351432,.485286,.0451523,.621693,-.0412198,.485378,.0530277,.621933,-.0477673,.485495,.0615522,.622232,-.0547574,.485635,.0707316,.622809,-.0619417,.485943,.0805883,.623407,-.069625,.486232,.0911267,.62406,-.077796,.486516,.102354,.624835,-.0863731,.486838,.114279,.625758,-.095251,.487188,.126902,.627043,-.104299,.487695,.140285,.628438,-.113724,.488163,.154397,.630325,-.123417,.488858,.169267,.632801,-.133137,.489754,.184941,.635784,-.143052,.490815,.20136,.639406,-.153132,.492048,.218643,.643872,-.163143,.49363,.236615,.6499,-.17333,.496009,.255449,.657201,-.183622,.498994,.275006,.666221,-.194019,.502888,.295354,.674419,-.204192,.505459,.316244,.683729,-.21406,.507771,.33849,.695584,-.222854,.510245,.363166,.708583,-.231315,.512293,.389071,.721233,-.238911,.512747,.415737,.735134,-.245657,.512482,.443331,.750179,-.251879,.511526,.471891,.765073,-.256911,.508935,.500892,.779794,-.261144,.504341,.530294,.794801,-.264316,.498515,.560144,.810339,-.266276,.491015,.590213,.824818,-.266981,.481126,.620865,.839375,-.265778,.468685,.652687,.853043,-.262748,.453925,.684759,.867335,-.258474,.437912,.716209,.88037,-.253187,.419648,.747508,.891711,-.246476,.39982,.77797,.902896,-.238735,.37879,.808586,.913601,-.22885,.355891,.838843,.923019,-.217656,.331773,.869014,.933432,-.205539,.307356,.898512,.939691,-.192595,.281321,.9269,.946938,-.178945,.255441,.955297,.952372,-.163587,.229013,.983231,.95909,-.147214,.203179,1.00971,.963675,-.13064,.17792,1.03438,.968247,-.113121,.152898,1.05625,.97001,-.0945824,.128712,1.07598,.974458,-.0755648,.103349,1.094,.980168,-.0571998,.0776731,1.1104,.987295,-.0377994,.0514445,1.12491,.994432,-.0186417,.025429,1.13851,.999975,542714e-9,-282356e-9,1.15108,.592656,-980249e-11,.486018,119532e-10,.598467,-247275e-9,.490781,301531e-9,.597934,-988317e-9,.490343,.00120517,.597903,-.00222366,.490319,.0027116,.597913,-.00395315,.490327,.00482077,.597919,-.00617653,.490329,.00753264,.597936,-.00889375,.490339,.0108478,.597956,-.0121043,.490347,.0147668,.597992,-.0158073,.490365,.0192905,.598032,-.0200017,.490382,.0244204,.598109,-.0246865,.49042,.0301593,.598215,-.0298594,.490474,.03651,.59833,-.0355167,.490524,.0434757,.598525,-.0416559,.490624,.0510629,.598778,-.0482692,.490753,.0592781,.599135,-.0553114,.49094,.0681304,.599802,-.062542,.491328,.0776467,.600361,-.0703638,.491598,.0878184,.60101,-.0786256,.491882,.0986573,.601811,-.0872962,.492232,.11018,.602861,-.0962284,.492684,.1224,.604167,-.10538,.493213,.135354,.605693,-.114896,.493799,.149034,.607682,-.124654,.494576,.163469,.610672,-.13456,.4959,.178747,.613313,-.144581,.496713,.194723,.617603,-.154703,.498499,.211617,.622174,-.16489,.500188,.229183,.628855,-.175164,.503072,.247786,.636963,-.185565,.506798,.267116,.644866,-.195911,.509719,.28702,.653741,-.206104,.512776,.307763,.664942,-.216447,.516812,.329631,.67633,-.22552,.519181,.353515,.690012,-.234316,.521681,.379226,.704243,-.242032,.523129,.405901,.719396,-.249172,.523768,.433585,.734471,-.255543,.522541,.462085,.750539,-.260697,.520217,.491233,.766365,-.26501,.516293,.521094,.781677,-.268409,.509708,.551014,.797132,-.270399,.501944,.581463,.812655,-.271247,.492025,.612402,.828592,-.270708,.480424,.643798,.844044,-.268085,.465955,.67682,.857305,-.263459,.448425,.708496,.87114,-.258151,.430243,.74046,.884936,-.251171,.410578,.771583,.895772,-.243305,.38862,.802234,.906961,-.234037,.365214,.833179,.917775,-.222714,.34116,.86353,.927883,-.210175,.31572,.893557,.936617,-.196925,.289159,.922976,.943384,-.182788,.261996,.951606,.949713,-.167965,.235324,.979958,.955818,-.151109,.208408,1.00765,.961344,-.133834,.182591,1.03329,.965469,-.115987,.156958,1.0557,.968693,-.09746,.132239,1.07583,.973165,-.0778514,.106195,1.09451,.979387,-.0585067,.0797669,1.11137,.98671,-.0390409,.0530263,1.12643,.994093,-.019408,.0263163,1.14016,1.00002,540029e-9,-194487e-9,1.15299,.574483,-989066e-11,.494533,114896e-10,.574478,-249127e-9,.494528,289403e-9,.574607,-996811e-9,.494637,.00115797,.574396,-.00224241,.494458,.00260498,.574377,-.00398632,.49444,.00463102,.574386,-.00622836,.494445,.00723623,.574401,-.0089683,.494453,.010421,.574419,-.0122056,.49446,.0141859,.574459,-.0159396,.494481,.0185322,.574525,-.0201692,.49452,.0234617,.574587,-.0248924,.494547,.0289762,.574697,-.0301074,.494604,.0350797,.574853,-.0358114,.494688,.0417767,.575027,-.041999,.494772,.0490718,.575294,-.0486618,.494915,.0569728,.575733,-.0557148,.495173,.0654955,.576356,-.0630489,.495537,.0746612,.576944,-.0709285,.495836,.0844615,.57765,-.0792723,.496177,.0949142,.578491,-.0880167,.496563,.10603,.579639,-.0969462,.497096,.117841,.580989,-.10622,.497684,.130367,.582587,-.115861,.498337,.143609,.584951,-.125605,.499414,.157625,.587602,-.135608,.500518,.172413,.59076,-.145742,.501767,.187999,.594992,-.155934,.503542,.20445,.600656,-.166303,.506135,.221764,.607816,-.176681,.509542,.24002,.61522,-.187071,.51263,.258992,.623702,-.197465,.516021,.278773,.634192,-.207816,.520422,.299377,.644936,-.218183,.524073,.320802,.657888,-.2278,.528049,.34384,.670666,-.236747,.52986,.36916,.685626,-.24484,.531892,.395867,.701304,-.252071,.532727,.423488,.717727,-.258714,.532146,.452201,.733914,-.264211,.529883,.481579,.750529,-.26859,.5259,.511558,.76747,-.272046,.51999,.542042,.785189,-.274225,.513083,.572799,.800954,-.275189,.502936,.603816,.816962,-.274946,.490921,.635461,.83336,-.272695,.47684,.6676,.848143,-.268223,.459405,.70051,.861818,-.262768,.440319,.732902,.876828,-.255872,.420123,.765084,.889312,-.247703,.398379,.796391,.900412,-.238381,.374496,.827333,.912251,-.227783,.349874,.858385,.921792,-.214832,.323181,.888652,.931273,-.200949,.296624,.917763,.940295,-.186537,.269211,.947878,.946812,-.171538,.241447,.977016,.953588,-.155254,.213829,1.00501,.958841,-.137156,.186807,1.03179,.963746,-.118699,.160706,1.05502,.966468,-.0998358,.135504,1.07568,.971178,-.0805186,.109131,1.09479,.97831,-.0599348,.0818293,1.1123,.985886,-.0399661,.0545872,1.12771,.994021,-.0198682,.0269405,1.14186,1.00009,271022e-9,-12989e-8,1.15514,.538716,-990918e-11,.486732,109675e-10,.550656,-250642e-9,.497518,277412e-9,.55057,-.00100265,.497441,.00110974,.550903,-.00225672,.497733,.00249779,.550568,-.00401046,.497438,.00443906,.550574,-.00626613,.49744,.00693637,.550591,-.0090226,.497449,.00998921,.550623,-.0122795,.497469,.0135984,.550667,-.0160361,.497495,.0177654,.550724,-.0202908,.497526,.0224915,.550792,-.0250421,.497557,.0277795,.550918,-.0302878,.49763,.0336334,.551058,-.0360241,.497701,.0400573,.551276,-.0422473,.497824,.0470585,.551551,-.0489441,.497977,.0546433,.552074,-.0559596,.498312,.0628367,.552681,-.0633978,.498679,.071646,.553324,-.0713176,.499031,.0810746,.554011,-.0797268,.499365,.091129,.55488,-.0885238,.499779,.101837,.556171,-.0974417,.500444,.113239,.557498,-.106841,.501025,.125316,.559299,-.116533,.501864,.138128,.561647,-.126298,.502967,.151695,.564347,-.136388,.504129,.16604,.567863,-.146576,.505713,.181207,.572569,-.156832,.507953,.197259,.578919,-.167323,.511186,.214258,.585387,-.177712,.514042,.232038,.593134,-.188184,.517484,.250733,.603295,-.198717,.522345,.270454,.613854,-.209177,.526751,.290807,.626092,-.219644,.531595,.312202,.637868,-.229494,.534721,.334435,.652458,-.238718,.538304,.359184,.666985,-.247061,.539875,.385637,.683301,-.254652,.541042,.41328,.69998,-.261376,.540735,.441903,.717824,-.267085,.539139,.471609,.734617,-.271465,.534958,.501446,.753663,-.27528,.53032,.532571,.770512,-.277617,.522134,.563641,.787356,-.278525,.51206,.595067,.806252,-.278512,.50119,.627226,.822061,-.277023,.486791,.659402,.838959,-.273175,.470467,.692874,.85379,-.267238,.450688,.725702,.868268,-.260327,.429741,.75832,.881994,-.251946,.407223,.790189,.893885,-.242432,.383214,.821625,.905118,-.231904,.357297,.853011,.916045,-.219545,.330733,.883773,.927614,-.205378,.303916,.914435,.936005,-.190388,.275941,.944502,.944533,-.1749,.247493,.974439,.950758,-.158588,.218996,1.00286,.957078,-.141027,.191559,1.0304,.962448,-.121507,.164457,1.05466,.964993,-.102068,.138636,1.0761,.970017,-.0822598,.111861,1.09541,.97661,-.062033,.0843438,1.11317,.985073,-.0409832,.0558496,1.12911,.993515,-.020146,.0275331,1.1438,1.00006,27329e-8,-107883e-9,1.15736,.525324,-999341e-11,.498153,105385e-10,.526513,-251605e-9,.499277,265329e-9,.526517,-.00100641,.499282,.0010613,.526588,-.00226466,.499337,.00238823,.526539,-.0040255,.499302,.00424535,.526547,-.00628954,.499306,.00663364,.526561,-.00905628,.499313,.00955337,.526593,-.0123253,.499334,.0130054,.526642,-.0160957,.499365,.0169911,.5267,-.0203661,.499396,.0215122,.526792,-.0251347,.499451,.0265718,.526904,-.0303985,.499511,.0321732,.527079,-.0361554,.499617,.0383231,.527285,-.0423982,.499731,.045026,.527602,-.0491121,.499924,.0522936,.528166,-.0561127,.500306,.0601528,.52879,-.0635988,.5007,.0686059,.529421,-.071581,.501048,.0776518,.530144,-.0799854,.501421,.0873148,.531062,-.0888032,.501884,.0976084,.532374,-.0977643,.50259,.108588,.533828,-.107197,.50329,.120234,.53581,-.116887,.504312,.132602,.538063,-.126755,.505365,.145721,.5409,-.136819,.506668,.159617,.544882,-.147117,.508731,.174369,.550238,-.157446,.511601,.190028,.556038,-.167988,.514431,.206587,.563031,-.178364,.517808,.224046,.571543,-.189007,.521937,.242503,.582255,-.199546,.527415,.261977,.59272,-.210084,.531682,.282162,.605648,-.220448,.537123,.303426,.61785,-.230593,.540664,.325323,.632223,-.240238,.544467,.348993,.648819,-.24887,.547594,.375462,.665825,-.256657,.54912,.403024,.683389,-.263711,.549294,.431773,.701495,-.269666,.547649,.461494,.719197,-.274169,.543786,.491623,.737906,-.278124,.538644,.522994,.756652,-.280632,.531057,.554775,.775279,-.281741,.521972,.586441,.792688,-.281652,.509613,.618596,.811894,-.280345,.496497,.651462,.827938,-.277128,.47968,.684023,.844837,-.271646,.460688,.718024,.859239,-.264397,.438872,.751207,.874088,-.256144,.41577,.784232,.887693,-.246311,.391369,.816191,.899402,-.235497,.365872,.847828,.910973,-.223631,.338618,.87934,.92204,-.209874,.310803,.910325,.930987,-.194265,.281802,.940695,.94,-.178125,.252836,.970958,.948018,-.161479,.224239,1.00078,.955141,-.144038,.195857,1.0288,.960513,-.124915,.168487,1.05371,.963964,-.104284,.141495,1.07596,.968713,-.0838732,.114437,1.09628,.975524,-.0635579,.0863105,1.11448,.98431,-.042291,.0574774,1.13069,.992916,-.0209131,.0284343,1.14568,.999926,743097e-9,-379265e-9,1.15955,.501042,-998428e-11,.498726,100306e-10,.502992,-252112e-9,.500665,253283e-9,.502417,-.00100791,.500092,.00101259,.502965,-.00226919,.500621,.00227978,.502318,-.00403109,.499994,.00405011,.502333,-.00629832,.500005,.00632868,.502362,-.00906907,.500027,.00911446,.502369,-.0123423,.500023,.0124078,.50243,-.0161178,.500066,.016211,.502493,-.0203937,.500103,.0205256,.502592,-.0251684,.500166,.0253548,.502707,-.0304389,.50023,.0307029,.502881,-.0362015,.500335,.0365753,.503124,-.0424507,.500488,.0429798,.503443,-.0491582,.500686,.0499268,.504083,-.0561476,.501155,.0574541,.504668,-.0636846,.501524,.0655408,.505319,-.0716834,.501904,.0742072,.50609,-.0800925,.502321,.0834699,.507122,-.0888425,.502896,.0933603,.508414,-.097855,.503603,.10391,.509955,-.107304,.504416,.115113,.512061,-.116921,.505565,.127054,.514419,-.12689,.506732,.139709,.517529,-.136934,.508338,.153173,.522085,-.147327,.510987,.167528,.526986,-.157612,.513527,.182708,.533122,-.168213,.516717,.198881,.540807,-.178688,.520832,.215986,.550687,-.189511,.52632,.234335,.560567,-.199998,.531009,.253375,.571698,-.210652,.535839,.273499,.584364,-.220917,.541091,.294355,.599066,-.23137,.546875,.316525,.614148,-.241206,.551306,.339671,.631157,-.250379,.555187,.36531,.647919,-.258397,.556595,.392767,.666112,-.265528,.556949,.421397,.686158,-.271827,.556617,.451433,.704838,-.27674,.552975,.482131,.723957,-.280733,.547814,.513458,.74262,-.283359,.53997,.545446,.762009,-.284541,.530422,.57775,.781314,-.284507,.518546,.610434,.799116,-.283309,.504178,.643178,.817604,-.280378,.48843,.676248,.83459,-.275619,.469457,.709698,.850974,-.26856,.447698,.744245,.866747,-.260094,.424791,.777695,.881412,-.249929,.399913,.810392,.8936,-.239137,.37308,.842872,.905943,-.226818,.345705,.874677,.916408,-.213699,.31706,.906257,.927215,-.198428,.288444,.936881,.935625,-.181643,.258329,.96795,.944076,-.164386,.228488,.998216,.951229,-.146339,.199763,1.02689,.958793,-.127709,.172153,1.0535,.963219,-.107244,.144989,1.07646,.967562,-.0857764,.11685,1.09675,.974866,-.0645377,.0880571,1.11576,.983353,-.0431732,.0587352,1.13227,.992503,-.0218356,.0294181,1.1478,1.00003,605203e-9,-231013e-9,1.16207,.482935,-101177e-10,.504695,968142e-11,.477554,-251521e-9,.499071,240676e-9,.477904,-.00100683,.499436,96342e-8,.478368,-.00226636,.499899,.0021687,.477977,-.00402719,.499513,.00385384,.477993,-.00629226,.499525,.0060221,.478011,-.00906011,.499536,.00867289,.478051,-.0123305,.499566,.0118074,.478089,-.016102,.499587,.0154269,.478171,-.0203736,.499645,.0195341,.478254,-.025143,.499692,.0241318,.47839,-.0304071,.499779,.0292247,.478588,-.0361631,.499911,.0348196,.478812,-.0424023,.500046,.0409231,.479208,-.0490724,.500326,.047552,.479841,-.0560722,.500805,.0547377,.480392,-.0636125,.501152,.0624607,.481068,-.0716134,.501561,.0707473,.481898,-.0800062,.502054,.0796118,.483022,-.0886568,.502728,.0890974,.484332,-.0977553,.503479,.0992099,.486126,-.107173,.504546,.10999,.488066,-.11677,.50557,.121476,.490521,-.126725,.506849,.133672,.494232,-.136793,.50911,.146731,.498302,-.147116,.511345,.160577,.503565,-.157446,.514344,.175335,.510902,-.168121,.518824,.191207,.519263,-.178799,.523666,.208058,.528204,-.189407,.528296,.225875,.538854,-.200145,.533724,.244782,.551278,-.210701,.539833,.264753,.565222,-.221303,.546131,.285745,.579403,-.231688,.551496,.307592,.595469,-.241718,.556809,.330582,.610929,-.250992,.559641,.354995,.629433,-.259602,.562379,.382471,.648504,-.267038,.563676,.411126,.66756,-.273388,.562092,.440924,.689143,-.278788,.560807,.472118,.709056,-.282783,.555701,.503774,.729855,-.285836,.548698,.536364,.748954,-.287078,.538544,.56895,.768373,-.287133,.526711,.601991,.78827,-.285839,.512511,.635403,.807465,-.283238,.496323,.668797,.825194,-.27906,.477638,.702584,.842203,-.272286,.456253,.736393,.857749,-.263854,.432412,.77096,.874799,-.253943,.407806,.80489,.887497,-.24237,.38033,.83771,.89966,-.230278,.352446,.870376,.911753,-.21646,.323268,.902256,.923011,-.202071,.294314,.933306,.932375,-.185519,.264104,.965177,.940537,-.167604,.234035,.996303,.948904,-.149068,.20412,1.0261,.955263,-.129539,.175431,1.05304,.960303,-.109932,.148116,1.07617,.965512,-.0880572,.119693,1.09742,.973466,-.0660548,.0901619,1.11721,.98284,-.0439228,.0599875,1.13436,.992216,-.0219588,.0298975,1.15006,.999946,119402e-9,-208547e-10,1.16471,.447827,-100414e-10,.491543,914833e-11,.454778,-251257e-9,.499172,22891e-8,.453519,-.00100342,.497787,914184e-9,.45357,-.00225776,.497847,.00205701,.453578,-.00401371,.497855,.00365705,.45357,-.00627107,.497841,.00571453,.453598,-.00902968,.497864,.00823019,.453627,-.0122888,.497882,.0112049,.453684,-.0160475,.497923,.0146405,.453764,-.0203044,.49798,.0185394,.453866,-.0250576,.498049,.0229054,.453996,-.0303028,.49813,.0277424,.454196,-.0360379,.498267,.0330587,.454457,-.0422521,.498445,.0388613,.454926,-.0488393,.498812,.0451767,.455525,-.0558653,.499272,.0520153,.456074,-.0633772,.499625,.0593754,.456752,-.0713606,.500049,.0672751,.457648,-.07971,.500615,.0757447,.458849,-.0883032,.501399,.0848231,.46029,-.0974095,.502293,.0945135,.462,-.106729,.503301,.104848,.464121,-.116354,.504533,.115884,.466889,-.126214,.506172,.127652,.470744,-.136324,.508667,.14024,.47488,-.146595,.510995,.153673,.480845,-.157027,.514832,.168053,.488262,-.167658,.519506,.183508,.496547,-.178343,.524347,.199948,.506254,-.188916,.52983,.217503,.517961,-.199975,.536357,.236272,.531484,-.210624,.543641,.256096,.545496,-.221227,.550048,.277085,.559497,-.231568,.555076,.298615,.575752,-.241698,.560541,.321547,.591999,-.251172,.564156,.345602,.610654,-.260178,.567607,.371851,.630484,-.268094,.56923,.40076,.651807,-.274661,.569779,.430801,.67239,-.280331,.566791,.461939,.693024,-.284501,.562007,.493854,.715473,-.287852,.555791,.526992,.736323,-.28929,.546345,.560102,.755771,-.289405,.534,.593543,.775424,-.2881,.519114,.627256,.795447,-.285562,.502543,.661464,.815319,-.281416,.484773,.695206,.831769,-.275523,.463445,.729044,.849464,-.267516,.440269,.764069,.866775,-.257584,.415049,.799089,.881252,-.245817,.388049,.831948,.894209,-.233127,.35889,.865526,.906922,-.219579,.329915,.89818,.919686,-.204491,.300441,.930013,.929044,-.188962,.269445,.962061,.938393,-.171079,.238402,.994214,.94661,-.15199,.208204,1.02533,.953095,-.131953,.178653,1.0529,.958644,-.111233,.150684,1.0771,.963925,-.0903098,.122359,1.09855,.971995,-.0680505,.0923342,1.11874,.981658,-.0448512,.0614195,1.13635,.991649,-.0221931,.0303582,1.15238,.999985,393403e-9,-111086e-9,1.16772,.396806,-971563e-11,.457671,842355e-11,.429186,-249421e-9,.495017,21625e-8,.429324,-998052e-9,.495173,865322e-9,.429175,-.00224487,.494999,.00194637,.429129,-.00399041,.494952,.00346004,.429153,-.00623476,.494974,.00540684,.429168,-.0089773,.494983,.00778714,.429207,-.0122175,.495012,.0106022,.429257,-.0159542,.495047,.0138535,.429338,-.0201864,.495106,.0175443,.429431,-.0249104,.495165,.0216774,.429587,-.0301252,.495279,.0262594,.429796,-.0358249,.495432,.0312968,.430065,-.0419972,.495621,.0367985,.430588,-.0485144,.496061,.042798,.43113,-.0555028,.496472,.0492914,.431743,-.0629852,.496904,.0562907,.432448,-.0709256,.497369,.0638056,.433414,-.0791942,.498032,.071885,.434638,-.0877346,.498854,.0805517,.43611,-.0968056,.499812,.0898047,.437859,-.106002,.500891,.0997142,.440017,-.115648,.502198,.110289,.443236,-.125427,.504389,.121644,.44697,-.135492,.506809,.133769,.451689,-.145746,.509858,.146787,.45811,-.156219,.514247,.160793,.465305,-.166834,.518816,.175791,.474085,-.177546,.524331,.191906,.484808,-.188262,.53104,.209199,.49732,-.199346,.538511,.227825,.509693,-.209951,.544554,.247269,.524367,-.220533,.551616,.267978,.539228,-.231082,.557368,.289672,.55644,-.241342,.563782,.31268,.574204,-.250964,.568851,.33651,.593388,-.260306,.57312,.362219,.613358,-.268667,.574916,.390322,.634512,-.275591,.575053,.420478,.65563,-.281328,.572404,.451614,.678265,-.285948,.568893,.484112,.70011,-.289408,.561878,.517348,.723005,-.291328,.55359,.551355,.743744,-.291418,.541099,.585109,.763949,-.290252,.526489,.619487,.784186,-.287648,.509496,.65404,.804304,-.283782,.491484,.688649,.823629,-.278067,.470517,.723133,.84094,-.270588,.44705,.757163,.857852,-.261188,.421252,.792816,.874934,-.249313,.394191,.827248,.888709,-.236492,.365359,.861074,.902589,-.222185,.336016,.894417,.914201,-.207314,.30527,.926825,.925978,-.191146,.274532,.9595,.93512,-.174135,.243393,.991583,.943656,-.155231,.212414,1.02356,.951719,-.134403,.182005,1.05239,.957164,-.113023,.153043,1.07754,.962656,-.0914493,.124186,1.09984,.970695,-.0694179,.0941654,1.12,.980749,-.0466199,.0629671,1.13849,.991205,-.0227032,.0311146,1.15494,.999884,632388e-9,-254483e-9,1.1706,.379821,-957289e-11,.460637,789337e-11,.405188,-247483e-9,.491396,204064e-9,.404796,-989434e-9,.490914,815853e-9,.40483,-.00222607,.490949,.00183559,.40473,-.00395723,.49084,.00326332,.404731,-.00618287,.490836,.00509945,.404768,-.00890258,.490871,.00734463,.404791,-.0121156,.490883,.00999992,.404857,-.0158214,.490938,.0130676,.404943,-.0200178,.491004,.0165503,.405059,-.0247027,.491093,.0204521,.405213,-.0298729,.491205,.0247788,.405399,-.0355226,.491333,.0295373,.405731,-.0416352,.491604,.034741,.406303,-.0480807,.492116,.0404255,.406814,-.0550458,.492506,.0465732,.407404,-.0624652,.492926,.0532058,.408149,-.0702958,.493442,.0603442,.409128,-.0784623,.494136,.0680297,.410408,-.087007,.495054,.0762786,.411813,-.0959639,.495962,.0851046,.413735,-.105075,.497257,.0945878,.416137,-.114646,.498882,.104725,.41934,-.124394,.501132,.11563,.423326,-.134328,.503883,.127325,.428419,-.14458,.50747,.139911,.43484,-.154979,.511964,.153481,.442641,-.165628,.517328,.168114,.452511,-.176365,.524258,.183995,.463473,-.187298,.531248,.200953,.475564,-.198244,.538367,.219176,.488664,-.208938,.545175,.238514,.504073,-.219599,.553227,.259129,.520832,-.230378,.560653,.280997,.538455,-.240703,.567523,.303821,.55709,-.250548,.573287,.327948,.576646,-.259964,.577795,.353362,.596705,-.268721,.580077,.380336,.618053,-.276054,.58018,.4101,.640303,-.282176,.578747,.44161,.662365,-.286931,.574294,.474106,.684542,-.290521,.567035,.507549,.707984,-.292672,.558687,.541853,.730913,-.293189,.547606,.576581,.752948,-.292199,.533471,.61172,.773452,-.289508,.516395,.646339,.794715,-.285716,.497873,.682131,.814251,-.280051,.476845,.716396,.833057,-.272873,.453449,.751503,.84959,-.263982,.427857,.786085,.867022,-.252745,.400335,.821355,.882277,-.239655,.371304,.85646,.895375,-.225386,.340397,.890828,.909347,-.209587,.310005,.923532,.921885,-.193433,.2796,.956419,.932127,-.176135,.247276,.989445,.941869,-.157872,.216186,1.02221,.949735,-.137577,.185602,1.05195,.956617,-.115285,.155767,1.07822,.961974,-.0928418,.126103,1.10149,.96972,-.0700592,.0956758,1.12207,.98012,-.0474671,.0643269,1.1408,.990825,-.0238113,.0320863,1.1577,.999876,381574e-9,-812203e-10,1.17403,.367636,-961342e-11,.469176,753287e-11,.380377,-244772e-9,.485434,191797e-9,.380416,-978857e-9,.485475,767015e-9,.380376,-.00220165,.485435,.00172522,.380419,-.00391408,.485487,.00306734,.380438,-.00611549,.485505,.00479332,.380462,-.00880558,.485525,.00690391,.380496,-.0119837,.485551,.00940039,.38056,-.0156487,.485605,.0122848,.38064,-.0197988,.485666,.0155601,.380767,-.0244324,.48577,.0192313,.380909,-.0295444,.485871,.0233032,.381142,-.0351321,.48606,.0277861,.381472,-.0411535,.486336,.0326939,.382015,-.0475408,.486833,.0380565,.382523,-.0544395,.487231,.0438615,.383129,-.061784,.487683,.0501332,.383952,-.0695085,.488313,.0568996,.38498,-.0775819,.489077,.0641952,.386331,-.0860443,.490113,.0720324,.387788,-.0948406,.491099,.0804379,.389808,-.103899,.492566,.0894899,.39252,-.113313,.494601,.0992098,.395493,-.123007,.496619,.109641,.399826,-.132859,.499912,.120919,.405341,-.143077,.504061,.133107,.411932,-.153465,.508905,.146263,.420591,-.164108,.515482,.160544,.43101,-.174893,.523191,.176123,.441881,-.185839,.53026,.192757,.453919,-.196633,.537295,.210535,.468715,-.207611,.546156,.229886,.485182,-.218517,.555173,.250543,.501926,-.229249,.562728,.27221,.51785,-.239481,.567494,.294892,.536947,-.249395,.573889,.318987,.557115,-.259,.578831,.344348,.577966,-.268075,.582055,.371223,.599489,-.276115,.583307,.399834,.62479,-.282523,.583902,.431415,.647504,-.287663,.57953,.464301,.670601,-.291538,.573103,.498123,.693539,-.293842,.563731,.532662,.717385,-.294681,.553169,.567925,.741533,-.293717,.539908,.603502,.762142,-.291156,.521902,.639074,.783014,-.28719,.502815,.674439,.805158,-.281773,.482598,.710497,.823646,-.274682,.458949,.7456,.841879,-.266184,.433129,.781085,.859515,-.255682,.406064,.816,.875335,-.242849,.376509,.851074,.890147,-.228329,.345502,.886473,.903144,-.212491,.31428,.920751,.916618,-.195695,.282994,.954606,.927953,-.178267,.251091,.988402,.937414,-.159549,.219107,1.02141,.946823,-.140022,.18896,1.05167,.954651,-.118154,.158667,1.07819,.959955,-.0946636,.128808,1.1025,.96858,-.0711792,.0973787,1.12391,.97938,-.0475046,.0650965,1.14322,.990498,-.024059,.0326267,1.16077,.999844,-512408e-10,112444e-9,1.17727,.316912,-934977e-11,.425996,695559e-11,.356423,-241372e-9,.479108,179562e-9,.356272,-965292e-9,.478897,71811e-8,.356262,-.00217182,.478894,.00161574,.356265,-.00386092,.478895,.00287261,.356278,-.0060324,.478905,.00448907,.356293,-.00868565,.478914,.00646572,.356346,-.0118207,.478965,.00880438,.356395,-.0154355,.479001,.0115066,.356484,-.019529,.479075,.0145762,.356609,-.0240991,.47918,.018018,.356766,-.0291413,.479305,.0218379,.357009,-.0346498,.479512,.0260454,.357424,-.0405462,.479909,.0306657,.357899,-.0468825,.480337,.0357054,.358424,-.0536887,.480771,.0411728,.359041,-.0609416,.481242,.0470841,.359903,-.0685239,.481943,.0534831,.360932,-.0764883,.482741,.0603795,.362196,-.0848364,.483688,.0678028,.363847,-.0935002,.484947,.0758086,.365972,-.102471,.486588,.0844173,.368741,-.111751,.488787,.0937199,.372146,-.121334,.491405,.103732,.377114,-.131147,.495604,.114608,.38226,-.141213,.499436,.126345,.389609,-.151632,.505334,.139116,.397925,-.162073,.51168,.152995,.407824,-.172819,.518876,.168071,.420014,-.183929,.527639,.184495,.434266,-.195032,.537588,.20232,.447352,-.205792,.544379,.221189,.463726,-.216704,.553422,.241616,.481406,-.227531,.562074,.263298,.498707,-.238017,.568227,.286116,.518039,-.247936,.574473,.3101,.538277,-.257437,.579191,.335401,.561166,-.266829,.584807,.362246,.583189,-.275329,.586476,.390609,.606024,-.28234,.585578,.420998,.632419,-.287924,.584496,.454357,.656128,-.291972,.577766,.488233,.679953,-.29456,.56875,.523248,.704654,-.295816,.558388,.559168,.729016,-.295157,.544826,.595326,.752062,-.292779,.528273,.631864,.773138,-.288681,.508482,.667793,.794869,-.283358,.487341,.704035,.815101,-.27608,.46354,.739925,.834212,-.26767,.438672,.775539,.852368,-.257397,.411239,.810895,.870207,-.245689,.3829,.846472,.884063,-.231452,.351496,.881788,.898284,-.215561,.31895,.917438,.912964,-.198208,.287367,.952422,.924666,-.180426,.254487,.987551,.934429,-.161525,.222226,1.02142,.943485,-.141197,.191143,1.05218,.9521,-.120085,.161112,1.07937,.957876,-.0975881,.130982,1.10403,.966943,-.0726842,.0990553,1.12616,.978313,-.0483705,.0662818,1.14619,.990048,-.0239072,.0329243,1.16413,.999984,461885e-9,-772859e-10,1.18099,.321287,-935049e-11,.455413,659662e-11,.332595,-237513e-9,.471437,167562e-9,.332729,-949964e-9,.471618,670192e-9,.332305,-.00213618,.471028,.00150712,.332326,-.00379765,.471055,.00267959,.332344,-.00593353,.471072,.00418751,.332356,-.00854349,.471077,.00603172,.332403,-.0116268,.471121,.00821362,.332461,-.0151824,.47117,.0107357,.332552,-.0192088,.471251,.0136014,.332657,-.0237024,.47133,.0168152,.332835,-.0286615,.471487,.0203853,.333083,-.0340765,.471708,.0243212,.333547,-.0398563,.47219,.0286518,.333989,-.0460916,.472587,.0333763,.334532,-.0527897,.473054,.0385084,.335167,-.0599284,.473568,.0440638,.33608,-.0673514,.474362,.0500962,.337146,-.0752237,.475231,.0566022,.338462,-.083418,.476282,.0636272,.34014,-.0919382,.477615,.0712153,.342341,-.100741,.479404,.079417,.345088,-.109905,.481618,.0882631,.349049,-.119369,.485081,.0978851,.353939,-.129033,.489317,.108336,.359893,-.139038,.494309,.119698,.366945,-.149411,.499983,.132024,.375814,-.159843,.507185,.145558,.387112,-.170664,.516392,.160433,.40023,-.181897,.526519,.176648,.412555,-.192785,.53423,.193922,.427023,-.203663,.542741,.212662,.443685,-.214695,.552066,.232944,.461499,-.225561,.560762,.254495,.480975,-.236257,.569421,.277531,.501,-.24639,.576101,.301724,.521691,-.256101,.581493,.327112,.543478,-.265289,.585221,.353917,.566094,-.273938,.587614,.381941,.589578,-.281679,.587991,.41172,.614583,-.287655,.585928,.444148,.641813,-.292228,.582092,.478617,.666189,-.295172,.57398,.51397,.690475,-.29648,.561676,.550118,.715543,-.296203,.548758,.586933,.740405,-.293999,.532792,.62384,.762183,-.28998,.512735,.660723,.786069,-.28478,.492402,.69807,.806812,-.277568,.469058,.734422,.826987,-.268951,.443017,.770946,.844588,-.259049,.415501,.80699,.863725,-.2471,.387328,.842107,.879137,-.234157,.356108,.878078,.894634,-.218719,.324315,.914058,.909162,-.201293,.291813,.949922,.92072,-.18267,.258474,.985337,.93158,-.163212,.225593,1.0205,.941238,-.142771,.193986,1.05273,.949293,-.120956,.163392,1.08075,.956226,-.0985743,.132934,1.10559,.96546,-.075118,.101255,1.12823,.977403,-.0497921,.0675441,1.149,.989648,-.0241574,.0334681,1.16765,1.00001,5762e-7,-184807e-9,1.18519,.303474,-916603e-11,.4542,61243e-10,.308894,-232869e-9,.462306,155592e-9,.309426,-931661e-9,.463093,622499e-9,.308643,-.0020949,.461933,.00139979,.308651,-.0037242,.461941,.00248874,.308662,-.00581873,.46195,.00388933,.308687,-.00837818,.461974,.00560247,.308728,-.0114016,.462011,.00762948,.308789,-.0148884,.462067,.00997326,.308882,-.0188369,.462151,.0126375,.309007,-.0232436,.462263,.0156271,.30918,-.0281054,.462417,.0189498,.309442,-.0334065,.462667,.0226167,.309901,-.0390589,.463162,.0266614,.310331,-.0452042,.463555,.0310715,.310858,-.0517735,.464019,.0358698,.311576,-.0587359,.464669,.0410848,.312436,-.0660383,.465406,.0467453,.313526,-.0737266,.466339,.0528718,.314903,-.0817574,.467504,.0595039,.316814,-.090167,.469226,.0666888,.318965,-.0987555,.470981,.0744658,.322077,-.107792,.473814,.082912,.325947,-.117098,.477241,.0920846,.331008,-.126602,.48184,.102137,.337893,-.136619,.488334,.113135,.345106,-.146838,.494415,.12511,.355111,-.157357,.503275,.138356,.365095,-.167955,.510966,.152686,.378344,-.179157,.521508,.16856,.391599,-.190143,.530455,.18561,.407786,-.20123,.541275,.204308,.425294,-.212456,.551784,.224623,.444021,-.223568,.561493,.246172,.463418,-.234154,.569886,.268979,.484077,-.244546,.577116,.293411,.505513,-.254301,.582914,.318936,.527672,-.263564,.587208,.345856,.550565,-.272332,.589277,.374054,.573656,-.280011,.588426,.403276,.59827,-.286924,.587504,.43474,.624731,-.291994,.583401,.468767,.652396,-.295159,.576997,.504411,.67732,-.296954,.565863,.54114,.703147,-.296877,.552316,.57816,.728715,-.295147,.536773,.616124,.752448,-.291275,.51771,.653885,.775169,-.285905,.496087,.691537,.799307,-.279064,.474232,.729251,.819482,-.270294,.447676,.766267,.837659,-.260032,.419656,.802616,.856903,-.248497,.391328,.838583,.873325,-.235252,.360285,.874711,.889788,-.221126,.329215,.91077,.904486,-.204304,.296392,.94653,.917711,-.185562,.262159,.983828,.928969,-.165635,.229142,1.01955,.939707,-.14442,.19673,1.05317,.948167,-.122147,.165095,1.0823,.955222,-.099098,.13451,1.10791,.964401,-.0755332,.102476,1.1312,.976605,-.0513817,.0689667,1.15218,.989085,-.0258499,.034506,1.17129,.999908,617773e-9,-271268e-9,1.18961,.285803,-905752e-11,.452348,572272e-11,.284689,-22732e-8,.450581,143626e-9,.285263,-910214e-9,.451482,575099e-9,.285302,-.00204784,.451553,.00129395,.285318,-.00364057,.451574,.0023006,.28533,-.00568813,.451585,.00359547,.285361,-.00819001,.451618,.00517934,.285397,-.0111458,.45165,.007054,.285447,-.0145536,.451688,.00922167,.285527,-.0184127,.451758,.0116869,.285688,-.0227207,.451929,.0144555,.28584,-.0274712,.452055,.0175341,.286136,-.0326278,.452369,.0209406,.286574,-.0381792,.452853,.0246965,.287012,-.0441879,.453272,.0287996,.287542,-.0506096,.453752,.033268,.288299,-.0573634,.454488,.0381504,.289186,-.0645458,.455294,.0434447,.290302,-.0720405,.456301,.0491973,.291776,-.0799046,.457648,.0554453,.29372,-.088117,.459483,.0622311,.296052,-.0965328,.461571,.0695992,.299563,-.105409,.465085,.077658,.30335,-.114553,.468506,.0864176,.309167,-.123917,.474423,.0961078,.31529,-.13381,.47995,.106643,.324163,-.144021,.488592,.118322,.333272,-.154382,.496461,.131133,.344224,-.165015,.50562,.145208,.357733,-.176168,.516719,.16073,.373046,-.187468,.528513,.177807,.38788,-.198488,.537713,.196072,.405133,-.209545,.547999,.21605,.423845,-.220724,.55759,.237484,.443777,-.231518,.566246,.26039,.464824,-.242035,.574326,.284835,.486635,-.251898,.58037,.310518,.51012,-.261304,.58568,.337678,.535301,-.270384,.590197,.366242,.559193,-.27841,.590569,.395873,.583544,-.285325,.588161,.426857,.608834,-.291113,.584249,.459477,.635753,-.294882,.57763,.494734,.664367,-.297088,.569479,.532023,.689688,-.297364,.555064,.569629,.715732,-.295949,.539522,.608124,.741307,-.292259,.521613,.646231,.764949,-.287063,.49969,.684938,.788599,-.28012,.476747,.723548,.81048,-.27153,.45116,.761135,.831372,-.261289,.424101,.798916,.850092,-.249559,.39443,.835952,.867777,-.236348,.363849,.871606,.884632,-.221569,.332477,.907843,.90047,-.20618,.300667,.944187,.914524,-.188771,.266552,.981371,.926892,-.168362,.232349,1.01841,.937951,-.146761,.199359,1.05308,.947236,-.123813,.1675,1.0839,.954367,-.099984,.136166,1.11047,.963907,-.0759278,.103808,1.13414,.976218,-.0511367,.0697061,1.15575,.988772,-.0267415,.0352529,1.17531,.999888,-520778e-9,289926e-9,1.19389,.263546,-883274e-11,.441896,526783e-11,.262352,-221849e-9,.439889,132311e-9,.262325,-886683e-9,.439848,528824e-9,.26228,-.00199476,.439765,.00118975,.262372,-.00354671,.439922,.00211568,.26239,-.00554141,.439941,.00330652,.262412,-.00797888,.439961,.00476346,.262453,-.0108584,.440002,.00648818,.262528,-.0141788,.440085,.0084835,.262615,-.017938,.440166,.0107533,.262744,-.0221346,.440291,.0133044,.262939,-.026762,.440493,.0161445,.263277,-.0317573,.440889,.0192974,.26368,-.0371832,.441338,.0227699,.264106,-.0430371,.441753,.0265698,.264624,-.0493035,.442227,.0307178,.265378,-.0558669,.442985,.0352616,.266253,-.0628718,.443795,.0401968,.267478,-.0701569,.445008,.04559,.269062,-.077845,.446599,.0514539,.270926,-.0857941,.448349,.0578382,.273693,-.0940773,.451221,.0648363,.276746,-.102704,.454097,.0724389,.281693,-.111735,.459517,.0808744,.287335,-.121004,.46531,.0901551,.29448,-.130734,.472605,.100371,.30257,-.140777,.480251,.111644,.312465,-.15111,.489444,.124111,.324856,-.16189,.500919,.137979,.33774,-.172946,.511317,.153163,.35255,-.184152,.522684,.169817,.367786,-.19522,.53248,.187886,.385474,-.20632,.543326,.207634,.404976,-.217744,.554109,.229165,.425203,-.228691,.563395,.252068,.446704,-.239299,.571565,.276471,.468951,-.249348,.577935,.302323,.493487,-.258933,.584309,.329882,.517861,-.268009,.58773,.358525,.543309,-.276238,.589612,.388585,.569704,-.28356,.589294,.419787,.594871,-.289497,.585137,.452114,.622555,-.294452,.580356,.486466,.651167,-.296918,.57185,.523079,.677332,-.297647,.558428,.5611,.703718,-.296321,.542232,.599592,.730262,-.293339,.524541,.639138,.754304,-.288036,.502691,.677978,.778051,-.281018,.479212,.716537,.801557,-.272414,.454071,.75586,.822559,-.262419,.425952,.794477,.843051,-.250702,.397313,.832664,.86232,-.237264,.366534,.869876,.879044,-.222716,.334816,.906973,.896362,-.206827,.303143,.943558,.910342,-.189659,.269699,.979759,.924119,-.171108,.236411,1.01718,.935374,-.149579,.202224,1.05289,.944295,-.126295,.16989,1.08496,.952227,-.101511,.138089,1.11256,.962041,-.0766392,.105053,1.1375,.97528,-.0511967,.070329,1.15983,.988476,-.025463,.0351268,1.17987,.999962,286808e-10,145564e-10,1.19901,.227089,-841413e-11,.404216,472707e-11,.239725,-215083e-9,.426708,120833e-9,.239904,-860718e-9,.427028,483555e-9,.239911,-.00193661,.427039,.00108806,.239914,-.00344276,.42704,.00193457,.239933,-.00537907,.427064,.00302363,.239944,-.00774482,.427065,.00435604,.239993,-.01054,.427122,.00593398,.240052,-.0137626,.427179,.00775987,.240148,-.0174115,.427279,.00983854,.240278,-.021484,.42741,.0121763,.240472,-.0259729,.427618,.0147827,.240839,-.0308131,.428086,.0176837,.241201,-.0360893,.428482,.0208775,.241626,-.0417723,.428907,.0243821,.242207,-.0478337,.42952,.0282228,.24298,-.0542199,.430332,.0324333,.243881,-.0610015,.431222,.0370252,.245123,-.0680874,.432512,.0420535,.24667,-.0755482,.434088,.0475414,.248779,-.0832873,.436323,.0535542,.251665,-.0913546,.439509,.0601716,.255305,-.0998489,.443478,.0674282,.260049,-.108576,.448713,.0754673,.266192,-.117754,.455524,.084339,.273158,-.127294,.4627,.0941683,.282131,-.137311,.472068,.10515,.293332,-.147736,.483565,.117402,.304667,-.158357,.493702,.130824,.317785,-.169274,.504708,.145724,.333245,-.180595,.517107,.16215,.349843,-.191892,.528849,.180149,.367944,-.203168,.540301,.199746,.387579,-.214443,.551514,.221047,.408247,-.225624,.560906,.243981,.43014,-.236422,.56959,.268513,.452669,-.24654,.576098,.294409,.476196,-.256157,.580925,.322002,.501157,-.265289,.584839,.351052,.527632,-.273671,.587614,.3812,.555754,-.281254,.589119,.412994,.581682,-.287448,.585204,.445498,.608196,-.292614,.579006,.479505,.635661,-.296068,.571297,.514643,.664999,-.297395,.560855,.552213,.691039,-.296645,.544525,.591365,.7179,-.293785,.526535,.630883,.744059,-.289089,.50545,.670932,.76863,-.282239,.482514,.710904,.793273,-.273688,.457246,.750259,.814731,-.26328,.428872,.78948,.835603,-.251526,.399384,.828597,.85489,-.238339,.368811,.866892,.872828,-.223607,.336617,.90563,.889462,-.207538,.303997,.943538,.904929,-.190297,.270812,.980591,.919101,-.172034,.237453,1.01935,.930536,-.152058,.204431,1.05498,.941223,-.129515,.172495,1.08717,.94982,-.104263,.140175,1.11551,.960592,-.0781944,.106465,1.14098,.974629,-.051688,.0711592,1.16418,.98811,-.0253929,.0354432,1.18465,1.00004,804378e-9,-330876e-9,1.20462,.214668,-821282e-11,.406619,433582e-11,.218053,-208144e-9,.413025,109887e-9,.217987,-832212e-9,.412901,439362e-9,.217971,-.00187246,.412876,988623e-9,.217968,-.00332855,.41286,.00175772,.217985,-.00520055,.412882,.00274729,.218014,-.00748814,.412916,.00395842,.218054,-.0101901,.412957,.00539274,.218106,-.0133057,.413005,.00705348,.218217,-.0168342,.413139,.00894581,.218338,-.0207707,.413258,.0110754,.21855,-.0251001,.413509,.0134551,.218913,-.0297861,.413992,.0161081,.219265,-.0348956,.414383,.0190307,.219696,-.0403909,.414839,.0222458,.220329,-.0462003,.415567,.025792,.220989,-.0524208,.41621,.0296637,.222027,-.058948,.417385,.0339323,.223301,-.0658208,.418779,.0386055,.224988,-.0730347,.420665,.0437355,.227211,-.0805274,.423198,.0493844,.230131,-.088395,.426566,.0556135,.233908,-.0966208,.43091,.0624829,.239092,-.105223,.437148,.0701636,.245315,-.11424,.444302,.0786949,.253166,-.12368,.453262,.0882382,.262374,-.133569,.463211,.0988682,.273145,-.143836,.474271,.110727,.285512,-.154577,.4863,.123945,.299512,-.165501,.498817,.138581,.314287,-.176698,.510341,.154676,.331083,-.188066,.522583,.172459,.349615,-.199597,.534879,.191979,.369318,-.210843,.546083,.21309,.390377,-.222068,.5562,.235998,.412411,-.233059,.564704,.260518,.435715,-.24357,.572314,.286795,.461196,-.253356,.579395,.314559,.485587,-.262362,.581985,.343581,.511908,-.270895,.584347,.374367,.539798,-.278452,.58505,.406015,.567974,-.284877,.583344,.439168,.594303,-.290124,.577348,.473005,.622951,-.294183,.570751,.508534,.652404,-.296389,.561541,.544764,.679291,-.296605,.546426,.582927,.706437,-.294095,.528599,.622681,.734485,-.28978,.508676,.663567,.758841,-.283363,.484768,.704092,.78537,-.275015,.460434,.745101,.807315,-.264689,.432166,.784712,.8271,-.252597,.401807,.824241,.849191,-.239154,.371458,.863803,.867046,-.224451,.338873,.903063,.8852,-.208342,.306175,.942763,.901771,-.190684,.272759,.981559,.915958,-.172105,.239306,1.02048,.928046,-.152214,.206071,1.05765,.939961,-.130247,.17367,1.08999,.948711,-.10672,.142201,1.11829,.959305,-.0808688,.108454,1.14467,.973009,-.0539145,.0728109,1.16839,.987631,-.0262947,.0360625,1.19004,.999978,.00132758,-559424e-9,1.21058,.193925,-793421e-11,.391974,392537e-11,.196746,-200315e-9,.397675,991033e-10,.19667,-801099e-9,.397521,396342e-9,.196633,-.00180246,.397445,891829e-9,.196654,-.00320443,.397482,.00158582,.196659,-.00500647,.39748,.00247867,.196683,-.0072086,.397506,.00357167,.196728,-.00981001,.397562,.00486675,.196792,-.0128096,.397633,.00636707,.19689,-.0162055,.397746,.00807752,.197017,-.0199943,.397884,.0100052,.19729,-.024139,.39827,.0121691,.197583,-.0286671,.398639,.0145755,.197927,-.0335858,.399034,.0172355,.198383,-.0388806,.399554,.0201718,.199002,-.0444736,.400289,.0234194,.199739,-.0504583,.401111,.026984,.200784,-.056729,.402349,.0309217,.202075,-.0633643,.403841,.0352496,.203898,-.0703247,.406076,.0400313,.206199,-.0775565,.408841,.0453282,.209252,-.085184,.41259,.0511794,.213638,-.0931994,.418288,.0577459,.21881,-.101617,.424681,.0650508,.225642,-.11052,.433429,.0732759,.233717,-.119772,.442897,.0824683,.242823,-.129505,.452888,.0927484,.254772,-.139906,.466407,.104417,.266603,-.150402,.477413,.117211,.28073,-.161395,.490519,.131598,.295399,-.172465,.50201,.147407,.312705,-.183982,.515311,.165031,.331335,-.195532,.52786,.184336,.351037,-.206971,.5392,.205361,.372175,-.218117,.54941,.228043,.394548,-.229327,.558642,.25267,.419598,-.240052,.567861,.279071,.443922,-.249937,.573332,.306882,.471495,-.259407,.58013,.33661,.496769,-.267749,.580564,.367328,.524951,-.275524,.581696,.399753,.55318,-.282148,.579885,.433134,.581577,-.287533,.575471,.467534,.609231,-.291612,.567445,.502943,.637478,-.293911,.557657,.53871,.667795,-.295096,.546535,.576568,.694272,-.294073,.529561,.614929,.722937,-.290386,.510561,.655909,.749682,-.284481,.487846,.697663,.774754,-.276188,.462487,.738515,.799301,-.266215,.43481,.779802,.820762,-.254116,.404879,.820045,.843231,-.240393,.374559,.860294,.861857,-.225503,.341582,.900965,.880815,-.209382,.308778,.941727,.89766,-.19155,.275232,.980916,.912926,-.172346,.240938,1.02162,.926391,-.151799,.207223,1.0597,.938429,-.129968,.17484,1.09291,.947834,-.10651,.142984,1.12248,.958432,-.0824098,.109902,1.149,.972402,-.0565242,.0744454,1.1733,.987191,-.028427,.0373794,1.19538,.999975,385685e-10,-4203e-8,1.21676,.178114,-766075e-11,.385418,354027e-11,.176074,-191966e-9,.381002,887135e-10,.17601,-767549e-9,.380861,354715e-9,.17598,-.00172696,.380798,798168e-9,.175994,-.00307012,.380824,.00141928,.176017,-.00479684,.380858,.00221859,.176019,-.00690648,.380839,.00319714,.176072,-.00939888,.380913,.0043572,.176131,-.0122726,.380979,.005702,.176239,-.0155264,.38112,.00723689,.176371,-.0191551,.381272,.00896907,.176638,-.023117,.381669,.0109194,.176912,-.0274633,.382015,.0130903,.177279,-.032173,.382476,.0154949,.17774,-.0372219,.383041,.0181669,.178344,-.0426132,.38378,.0211209,.179153,-.0483309,.384773,.0243899,.180197,-.0543447,.386076,.0280062,.181581,-.0607122,.387809,.032004,.18344,-.0673855,.390205,.036453,.186139,-.0743989,.393944,.0414162,.189432,-.0817731,.39832,.0469394,.193795,-.0895464,.404188,.0531442,.199641,-.0978264,.4121,.0601374,.206679,-.106499,.421425,.0680078,.214865,-.115654,.431504,.076919,.224406,-.125268,.442526,.0868835,.235876,-.135475,.455465,.0981875,.248335,-.146023,.4681,.110759,.262868,-.157016,.482069,.124885,.278962,-.168245,.496182,.140645,.295082,-.17958,.507401,.157838,.313738,-.191227,.520252,.17695,.333573,-.202718,.531708,.197817,.356433,-.214424,.544509,.220785,.378853,-.225492,.55373,.245306,.402717,-.236236,.561348,.271593,.428375,-.246568,.568538,.299776,.454724,-.255941,.573462,.329433,.482291,-.264511,.576356,.360598,.509706,-.272129,.576446,.393204,.538805,-.278979,.575298,.427227,.568919,-.284528,.572154,.462157,.596804,-.288801,.564691,.497997,.625987,-.291334,.555134,.534467,.656414,-.292722,.545051,.571736,.683916,-.292185,.528813,.610158,.711809,-.290043,.51106,.649061,.739547,-.285246,.490103,.690081,.766914,-.277647,.465523,.732554,.791375,-.267603,.437718,.773982,.814772,-.256109,.40882,.81609,.836691,-.242281,.377823,.856849,.856984,-.227155,.34496,.898363,.876332,-.210395,.311335,.939471,.894988,-.192612,.277703,.980799,.911113,-.173236,.243019,1.02215,.924092,-.152258,.209037,1.06139,.936828,-.129575,.175909,1.09635,.946869,-.10594,.143852,1.12707,.958284,-.081318,.110289,1.15419,.972325,-.0556133,.0747232,1.17909,.986878,-.0297899,.0383149,1.20163,.999936,-.00197169,912402e-9,1.22338,.151174,-720365e-11,.351531,309789e-11,.155594,-18279e-8,.361806,78608e-9,.156099,-731569e-9,.362982,314615e-9,.156053,-.00164578,.362869,707845e-9,.156093,-.0029261,.362961,.00125884,.156099,-.00457155,.362959,.00196783,.15612,-.00658224,.362982,.00283622,.156168,-.00895774,.363048,.00386625,.156221,-.0116962,.363101,.00506109,.156324,-.0147973,.363241,.00642675,.156476,-.0182503,.363448,.00797175,.156731,-.0220266,.36384,.00971484,.156994,-.026176,.364179,.0116575,.157341,-.0306701,.36462,.0138207,.157867,-.0354591,.365364,.0162356,.15846,-.0406141,.366111,.0189092,.159308,-.0460519,.367248,.021885,.160426,-.0518096,.368767,.0252004,.161877,-.0578906,.370745,.0288825,.163995,-.0642812,.373831,.0330139,.16655,-.0710067,.377366,.0376283,.170237,-.0781522,.382799,.0428493,.175096,-.0857172,.389915,.0487324,.181069,-.0938025,.398487,.0554214,.188487,-.102363,.408799,.0630189,.197029,-.111343,.419991,.071634,.206684,-.120812,.431455,.0812797,.218698,-.131033,.445746,.0923651,.230726,-.141373,.457471,.104545,.245516,-.152387,.472388,.118449,.261551,-.163628,.486671,.133923,.277437,-.174814,.49762,.150849,.296662,-.186713,.51162,.169924,.31795,-.198513,.525435,.190848,.339422,-.210119,.536267,.213504,.362143,-.221354,.545982,.237947,.387198,-.23224,.555364,.264427,.412349,-.24257,.561489,.292519,.439274,-.252284,.566903,.322561,.466779,-.261023,.569614,.353952,.496011,-.26899,.571589,.387278,.524964,-.275498,.570325,.421356,.556518,-.281449,.568792,.457314,.584363,-.285526,.560268,.493199,.614214,-.28844,.55205,.530276,.645684,-.289777,.541906,.56855,.673446,-.289722,.526464,.606927,.701924,-.287792,.509872,.645945,.73037,-.284315,.490649,.685564,.757405,-.278804,.467964,.726511,.784025,-.269543,.441468,.768601,.808255,-.258117,.41216,.811321,.830739,-.244728,.380606,.853496,.851914,-.229428,.348111,.895374,.872586,-.212508,.314732,.937674,.891581,-.194025,.280338,.979869,.907641,-.174711,.245203,1.02253,.922233,-.153509,.21077,1.06371,.935878,-.130418,.177399,1.09972,.946338,-.105558,.144507,1.13124,.957265,-.080059,.110508,1.15973,.971668,-.0539766,.0742311,1.18515,.9866,-.0277101,.0375224,1.20858,1.00021,-515531e-9,135226e-9,1.23135,.137468,-686011e-11,.345041,273315e-11,.13703,-173378e-9,.343936,690761e-10,.136986,-693048e-9,.34383,276126e-9,.136964,-.00155931,.343761,621337e-9,.137003,-.00277211,.343863,.00110494,.137012,-.00433103,.343868,.00172744,.137043,-.00623606,.343916,.00249022,.13709,-.0084868,.343986,.00339559,.137145,-.0110814,.344045,.00444687,.137242,-.0140187,.344177,.00565007,.137431,-.0172713,.344491,.00701868,.137644,-.0208605,.344805,.00856042,.13791,-.024792,.345172,.0102863,.138295,-.0290461,.345734,.0122185,.138764,-.0335957,.346371,.0143771,.139415,-.038467,.347298,.0167894,.140272,-.0436176,.348527,.0194895,.141457,-.0491016,.350276,.0225043,.14303,-.0548764,.352646,.0258962,.145289,-.0610096,.356206,.0297168,.148502,-.0674777,.361488,.0340562,.152188,-.074345,.367103,.0389534,.157359,-.0817442,.375247,.0445541,.16379,-.0896334,.385064,.0509535,.171376,-.098005,.396082,.0582611,.179901,-.106817,.407418,.06654,.189892,-.116239,.420031,.075994,.201838,-.12627,.434321,.0867239,.214311,-.136701,.447631,.0987517,.228902,-.147616,.462046,.112353,.245107,-.158871,.476942,.127605,.262292,-.170261,.490285,.144469,.281215,-.182017,.503783,.163282,.301058,-.193729,.515505,.183873,.322752,-.205512,.52682,.206466,.347547,-.217214,.539473,.231194,.370969,-.227966,.546625,.257288,.397533,-.238555,.55472,.285789,.42398,-.248278,.559468,.315746,.452928,-.257422,.564095,.347724,.482121,-.265306,.565426,.380922,.510438,-.272043,.563205,.415639,.541188,-.277614,.561087,.451702,.571667,-.281927,.554922,.48845,.602432,-.285015,.546838,.526442,.634126,-.286512,.537415,.564896,.662816,-.286388,.522906,.604037,.692411,-.284734,.507003,.643795,.720946,-.281297,.488398,.68298,.748293,-.276262,.466353,.723466,.776931,-.269978,.443573,.764565,.801065,-.260305,.415279,.805838,.825843,-.247426,.384773,.849985,.84807,-.232437,.352555,.893174,.869122,-.215806,.318642,.936564,.888963,-.197307,.28381,.980253,.905547,-.177203,.247888,1.02463,.918554,-.155542,.212904,1.06714,.931395,-.131948,.1787,1.10451,.941749,-.106723,.145902,1.13694,.954551,-.0804939,.111193,1.1666,.970279,-.0534239,.0744697,1.19249,.986117,-.0257452,.0368788,1.21665,.999938,.00190634,-.0010291,1.23981,.118493,-647439e-11,.32272,23772e-10,.118765,-163023e-9,.323456,598573e-10,.118772,-65212e-8,.323477,239447e-9,.118843,-.00146741,.323657,538881e-9,.118804,-.00260846,.323553,95826e-8,.118826,-.00407576,.323595,.00149845,.118846,-.00586826,.323617,.00216047,.118886,-.00798578,.32367,.00294679,.118947,-.0104273,.323753,.00386124,.119055,-.0131909,.323922,.00490999,.119241,-.0162444,.324251,.00610804,.11944,-.0196339,.324544,.00745805,.119739,-.0233378,.325026,.00897805,.12011,-.0273179,.325586,.0106895,.120571,-.0316143,.326231,.0126073,.12124,-.0361939,.327264,.0147654,.122162,-.0410511,.328733,.0172001,.123378,-.0462233,.330659,.0199375,.125183,-.0517109,.333754,.0230498,.127832,-.0575652,.338507,.026597,.130909,-.0637441,.343666,.0306345,.135221,-.0704302,.351063,.035273,.14082,-.0776364,.360604,.0406137,.146781,-.0852293,.369638,.0466788,.155121,-.0935351,.3827,.0537628,.16398,-.102234,.39522,.0617985,.173926,-.111465,.40793,.07097,.185137,-.121296,.42105,.0813426,.19826,-.13169,.435735,.0931596,.212938,-.142614,.450932,.106547,.229046,-.153884,.465726,.121575,.246246,-.165382,.479461,.138286,.264637,-.176806,.492106,.15666,.284959,-.188793,.504774,.17728,.308157,-.200763,.518805,.19988,.330951,-.21239,.528231,.224293,.3549,-.223521,.536376,.250541,.381502,-.234169,.544846,.278902,.409529,-.244077,.551717,.309227,.437523,-.253363,.55517,.341426,.467624,-.261659,.557772,.37518,.497268,-.268498,.556442,.41007,.528294,-.274018,.553915,.446445,.559053,-.278169,.549153,.483779,.589329,-.281229,.539878,.522249,.622503,-.282902,.53162,.561754,.652382,-.282815,.518119,.601544,.681847,-.281247,.502187,.641574,.712285,-.277986,.484824,.682633,.740094,-.273017,.463483,.723426,.768478,-.266692,.441299,.763747,.794556,-.258358,.415238,.805565,.819408,-.248807,.386912,.847254,.843411,-.236214,.356165,.891091,.862397,-.219794,.320562,.936174,.883113,-.201768,.285322,.982562,.90023,-.181672,.249713,1.02862,.915192,-.159279,.214546,1.07163,.928458,-.134725,.180285,1.10995,.94069,-.10913,.147119,1.14354,.953409,-.0821315,.112492,1.17372,.969537,-.0542677,.0752014,1.20043,.985612,-.0259096,.0370361,1.22528,.999835,.00298198,-.00151801,1.24959,.10097,-602574e-11,.300277,202619e-11,.101577,-152164e-9,.302077,511662e-10,.101572,-608889e-9,.302066,204751e-9,.101566,-.00136997,.302047,460753e-9,.101592,-.00243557,.302114,819497e-9,.101608,-.0038053,.30214,.00128154,.101627,-.00547906,.30216,.0018483,.101669,-.00745647,.302224,.00252223,.101732,-.00973615,.302318,.00330716,.101844,-.0123097,.302513,.00421061,.102025,-.0151681,.30285,.00524481,.102224,-.0183334,.303166,.0064154,.102515,-.0217819,.303654,.00774063,.102886,-.0255067,.304243,.0092398,.103395,-.029514,.305089,.0109339,.104109,-.0337912,.306301,.0128561,.105074,-.0383565,.30798,.0150338,.10654,-.0432132,.310726,.0175228,.108478,-.0484244,.314351,.0203648,.111015,-.0539339,.319032,.0236325,.114682,-.0598885,.32605,.0274188,.11911,-.0663375,.334109,.0317905,.124736,-.0733011,.344013,.0368502,.131479,-.0807744,.355358,.0427104,.139283,-.0888204,.367614,.0494788,.148054,-.0973394,.380072,.0572367,.159037,-.10665,.395678,.0662704,.169794,-.116221,.40795,.0763192,.18314,-.126632,.423546,.087956,.197515,-.137383,.438213,.101042,.213514,-.148641,.453248,.115827,.23065,-.160117,.46688,.132283,.249148,-.171807,.479962,.150644,.270219,-.183695,.494618,.171073,.292338,-.195574,.506937,.193378,.314999,-.207205,.516463,.217585,.340991,-.218955,.528123,.24428,.367982,-.229917,.537025,.272784,.39432,-.239737,.541627,.302742,.423364,-.249048,.546466,.335112,.453751,-.257329,.549466,.369032,.48416,-.264623,.549503,.404577,.515262,-.270411,.547008,.441337,.547036,-.274581,.542249,.479162,.576614,-.277266,.533015,.517904,.611143,-.279144,.525512,.558508,.640989,-.279001,.51154,.598995,.671182,-.277324,.495641,.639935,.700848,-.273908,.477526,.681017,.729862,-.269063,.457955,.722764,.758273,-.262282,.434846,.764349,.784121,-.254281,.409203,.806206,.809798,-.24505,.382694,.848617,.834953,-.233861,.354034,.892445,.856817,-.221308,.321764,.936263,.877609,-.205996,.288118,.982401,.897489,-.186702,.253277,1.02975,.913792,-.164618,.217963,1.07488,.92785,-.140023,.183221,1.11487,.940378,-.11328,.149385,1.14947,.95273,-.0853958,.114152,1.1807,.969059,-.0568698,.0769845,1.20912,.985574,-.0276502,.0381186,1.23498,.999943,.00239052,-.00126861,1.25987,.0852715,-560067e-11,.279021,171162e-11,.0854143,-140871e-9,.279483,430516e-10,.0854191,-563385e-9,.2795,172184e-9,.0854188,-.00126753,.279493,387464e-9,.0854229,-.00225337,.279501,68918e-8,.0854443,-.00352086,.279549,.00107803,.0854697,-.00506962,.279591,.00155536,.0855093,-.00689873,.279652,.00212354,.0855724,-.00900821,.279752,.00278703,.0856991,-.0113799,.280011,.0035551,.085855,-.0140314,.280297,.00443449,.0860682,-.016963,.280682,.00543636,.086344,-.0201438,.281159,.0065788,.0867426,-.0235999,.281886,.00787977,.087239,-.0273069,.282745,.0093606,.0879815,-.031269,.284139,.011056,.0891258,-.035531,.28647,.0130065,.0906909,-.0400947,.289708,.0152495,.0927624,-.0449638,.293904,.0178454,.0958376,-.0502427,.300471,.0208915,.0995827,-.0559514,.30806,.0244247,.104526,-.0622152,.317874,.0285721,.110532,-.0690046,.329332,.0334227,.117385,-.0763068,.341217,.0390466,.12522,-.084184,.353968,.0455786,.134037,-.0925248,.366797,.0530773,.144014,-.101487,.380209,.0617424,.156013,-.111273,.395956,.071777,.168872,-.121431,.41053,.0830905,.183089,-.132105,.425073,.0959341,.198763,-.143286,.439833,.110448,.216159,-.154841,.454507,.126769,.234859,-.166588,.468368,.14495,.255879,-.178626,.482846,.165233,.27677,-.190218,.493489,.187217,.301184,-.202227,.506549,.211659,.325852,-.213764,.5158,.237922,.352824,-.22487,.525442,.26632,.380882,-.235246,.532487,.296691,.410137,-.244847,.537703,.329179,.439787,-.253122,.540361,.363135,.472291,-.260517,.542734,.399222,.501856,-.266519,.538826,.436352,.534816,-.270905,.535152,.474505,.565069,-.273826,.525979,.513988,.597154,-.275333,.516394,.554852,.630473,-.275314,.506206,.596592,.660574,-.273323,.489769,.638117,.692015,-.270008,.472578,.680457,.720647,-.265001,.452134,.723008,.750528,-.258311,.430344,.765954,.777568,-.250046,.405624,.809012,.80387,-.240114,.378339,.852425,.828439,-.228737,.349877,.895346,.851472,-.216632,.318968,.940695,.873906,-.202782,.287489,.987235,.89467,-.187059,.254394,1.03348,.912281,-.168818,.221294,1.07812,.927358,-.146494,.18675,1.11928,.940385,-.120009,.152322,1.15609,.952672,-.0917183,.117514,1.18875,.968496,-.0620321,.0797405,1.21821,.985236,-.0314945,.0402383,1.24523,.99998,-575153e-9,110644e-9,1.27133,.0702429,-512222e-11,.255273,140947e-11,.0702981,-128826e-9,.255469,354488e-10,.0703691,-515562e-9,.255727,141874e-9,.0703805,-.00116,.255754,31929e-8,.0703961,-.00206224,.255813,567999e-9,.0704102,-.00322223,.255839,88871e-8,.0704298,-.00463928,.255863,.00128272,.0704759,-.00631375,.255953,.00175283,.0705434,-.00824317,.256079,.00230342,.0706693,-.010412,.25636,.0029443,.0708189,-.0128439,.256647,.00368031,.0710364,-.0155177,.257084,.00452614,.0713223,-.0184374,.257637,.00549706,.0717182,-.0216002,.258416,.00661246,.072321,-.0249966,.259699,.00790147,.0731446,-.0286566,.261475,.0093884,.0743352,-.0325888,.264132,.0111186,.0760676,-.036843,.26815,.013145,.078454,-.0414292,.273636,.0155251,.0818618,-.0464634,.281653,.0183525,.0857382,-.0519478,.289992,.0216642,.0908131,-.0579836,.30066,.0255956,.0967512,-.0645124,.312204,.0301954,.103717,-.0716505,.325001,.0356017,.111596,-.0793232,.338129,.041896,.120933,-.087645,.352853,.0492447,.130787,-.096492,.366192,.0576749,.142311,-.105973,.380864,.0673969,.155344,-.116182,.396575,.0785899,.169535,-.126815,.411443,.0912377,.185173,-.138015,.426256,.105607,.201755,-.149325,.439607,.121551,.221334,-.161207,.455467,.139608,.241461,-.173162,.469096,.159591,.26294,-.18504,.481014,.18156,.286776,-.196881,.493291,.205781,.311596,-.208311,.503556,.231819,.338667,-.219671,.513268,.260274,.366021,-.230451,.519414,.290862,.395875,-.240131,.526766,.323196,.425564,-.248566,.52905,.357071,.457094,-.256195,.530796,.393262,.488286,-.262331,.528703,.430797,.522291,-.267141,.52727,.470231,.554172,-.270411,.519848,.510477,.586427,-.271986,.510307,.551594,.619638,-.27192,.499158,.593849,.650656,-.269817,.483852,.636314,.68284,-.266267,.467515,.679679,.714356,-.26113,.44931,.723884,.742717,-.254067,.425789,.767245,.770894,-.245652,.401144,.811819,.797358,-.235554,.374224,.856315,.823377,-.223896,.346167,.901077,.847456,-.210865,.316056,.946502,.870697,-.196574,.284503,.993711,.891068,-.180814,.251628,1.04134,.909267,-.163314,.219065,1.08609,.925653,-.143304,.186446,1.12702,.940017,-.121322,.153416,1.16371,.952398,-.0973872,.120334,1.19712,.967568,-.0698785,.08352,1.22791,.984772,-.0390031,.0439209,1.25672,1.00026,-.0070087,.00315668,1.28428,.0556653,-459654e-11,.227325,112556e-11,.0565238,-116382e-9,.230826,284985e-10,.0565717,-465666e-9,.231026,114036e-9,.0565859,-.00104773,.231079,256656e-9,.0565761,-.00186255,.231025,45663e-8,.0565913,-.00291002,.231058,714664e-9,.0566108,-.00418998,.231085,.00103224,.0566532,-.00570206,.231169,.00141202,.0567473,-.00743666,.231417,.00186018,.0568567,-.00940298,.231661,.00238264,.0569859,-.0115991,.231895,.00298699,.0572221,-.0140096,.232456,.00368957,.057519,-.0166508,.233096,.00450303,.0579534,-.01951,.234094,.00544945,.0585922,-.0225991,.235629,.00655564,.0595647,-.0259416,.238106,.00785724,.0609109,-.0295661,.241557,.00939127,.0628751,-.0335126,.246652,.0112198,.0656908,-.0378604,.254091,.0134168,.0691347,-.0426543,.262666,.0160374,.0732165,-.0478967,.272029,.0191514,.0782863,-.0536716,.283007,.0228597,.0843973,-.0600683,.295732,.0272829,.0913598,-.0670095,.308779,.032484,.0994407,-.0745516,.322886,.0385886,.108189,-.082712,.336408,.0457133,.118574,-.0914927,.351692,.0539832,.129989,-.100854,.366502,.0635162,.142722,-.110837,.381675,.0744386,.156654,-.121353,.3963,.0868483,.172151,-.132414,.411477,.100963,.188712,-.143809,.42508,.116795,.208093,-.155765,.441328,.134715,.227936,-.167608,.454328,.154396,.249495,-.179579,.467235,.176179,.27362,-.191488,.480248,.200193,.296371,-.202618,.487886,.225775,.324234,-.214133,.499632,.25441,.353049,-.225212,.509532,.285077,.381785,-.234875,.514265,.317047,.414038,-.244205,.521282,.351874,.445251,-.252145,.522931,.388279,.476819,-.258433,.520947,.425825,.509209,-.263411,.517669,.465104,.542759,-.266732,.512841,.505741,.574822,-.268263,.503317,.547611,.609324,-.268489,.493035,.590953,.641772,-.266941,.478816,.63488,.674049,-.263297,.462863,.679072,.705071,-.257618,.442931,.723487,.734709,-.250625,.421299,.768708,.763704,-.24179,.397085,.814375,.791818,-.231115,.370577,.859907,.817439,-.21922,.34232,.906715,.843202,-.205658,.312627,.953943,.866639,-.190563,.280933,1.00185,.888129,-.173978,.248393,1.05105,.907239,-.155485,.216007,1.09704,.923893,-.134782,.183233,1.13857,.938882,-.11249,.150376,1.17539,.952464,-.0890706,.117177,1.20924,.968529,-.0646523,.0813095,1.24055,.984763,-.038606,.0439378,1.27018,1.00053,-.01238,.00598668,1.29873,.0437928,-409594e-11,.204012,879224e-12,.0440166,-103395e-9,.205049,221946e-10,.0440529,-413633e-9,.205225,887981e-10,.0440493,-930594e-9,.2052,199858e-9,.0439884,-.00165352,.204901,355495e-9,.0440716,-.0025849,.205255,556983e-9,.0440968,-.00372222,.205311,805326e-9,.0441359,-.00506478,.205391,.00110333,.0442231,-.00660384,.205638,.00145768,.0443254,-.00835246,.205877,.00187275,.0444832,-.0102992,.20627,.00235938,.0447001,-.0124449,.206796,.0029299,.0450168,-.0147935,.207593,.0036005,.0454816,-.017336,.208819,.00439246,.0462446,-.0201156,.211036,.00533864,.0473694,-.0231568,.214388,.00646984,.0490191,-.0264941,.219357,.00783856,.0512776,-.030184,.226061,.00950182,.0541279,-.0342661,.234094,.0115156,.0578989,-.0388539,.244297,.0139687,.0620835,-.0438735,.254457,.0169015,.0673497,-.04951,.266706,.0204554,.0731759,-.0556263,.278753,.0246606,.0803937,-.0624585,.29309,.0297126,.0879287,-.0697556,.305856,.0355868,.0970669,-.0778795,.321059,.0425768,.106508,-.0863541,.333873,.05056,.11776,-.0955935,.349008,.0598972,.130081,-.105438,.363776,.0706314,.144454,-.115899,.380112,.0828822,.1596,-.126827,.394843,.0967611,.176097,-.138161,.409033,.112381,.194726,-.149904,.424257,.129952,.213944,-.161675,.436945,.149333,.235516,-.173659,.450176,.170892,.260564,-.185963,.466305,.194984,.285183,-.197582,.477328,.220805,.311095,-.208697,.486566,.248694,.338924,-.219519,.494811,.279015,.369757,-.229766,.504065,.311725,.3996,-.238879,.507909,.345844,.430484,-.246802,.509805,.381749,.46413,-.253924,.511436,.420251,.497077,-.259319,.508787,.459957,.530434,-.263297,.50394,.501356,.565725,-.265619,.49804,.544252,.599254,-.265842,.487346,.587856,.631251,-.263978,.472975,.631969,.663972,-.26043,.457135,.677471,.697724,-.255358,.439844,.723744,.727725,-.248308,.417872,.770653,.756417,-.239181,.39273,.817357,.785419,-.22814,.367839,.864221,.81266,-.215681,.339449,.912701,.839391,-.201623,.309279,.962419,.86366,-.185624,.278029,1.0122,.885028,-.16797,.245294,1.06186,.904639,-.148336,.212689,1.10934,.922048,-.12637,.179616,1.15063,.936952,-.102928,.146749,1.18885,.951895,-.0785268,.112733,1.22352,.967198,-.0530153,.0760056,1.25681,.984405,-.02649,.0383183,1.28762,1.00021,70019e-8,-20039e-8,1.31656,.0325964,-355447e-11,.176706,655682e-12,.0329333,-899174e-10,.178527,165869e-10,.0329181,-359637e-9,.178453,663498e-10,.0329085,-808991e-9,.178383,149332e-9,.0329181,-.00143826,.178394,265873e-9,.0329425,-.00224678,.178517,416597e-9,.0329511,-.00323575,.17849,603299e-9,.033011,-.00439875,.178695,829422e-9,.0330733,-.00574059,.178843,.00109908,.0331857,-.00725896,.179176,.00141933,.0333445,-.00895289,.179618,.0017999,.0335674,-.0108219,.180238,.00225316,.033939,-.0128687,.181417,.00279765,.0345239,-.015114,.183395,.0034564,.0354458,-.017596,.186616,.00425864,.0368313,-.0203524,.191547,.00524936,.0386115,-.0234105,.197508,.00647033,.0410303,-.0268509,.205395,.00798121,.0442245,-.0307481,.215365,.0098557,.0478659,-.0350863,.225595,.0121417,.0522416,-.0399506,.236946,.0149385,.0574513,-.045357,.249442,.0183189,.0631208,-.0512863,.261222,.0223644,.0701124,-.0579273,.275418,.0272418,.0777331,-.0650652,.288989,.0329458,.0862709,-.0728813,.302546,.0396819,.096103,-.081363,.317164,.04757,.106976,-.0904463,.331733,.0567012,.119175,-.100105,.34661,.067202,.132919,-.110375,.362249,.0792588,.147727,-.121115,.376978,.0928672,.163618,-.132299,.390681,.108228,.182234,-.143887,.406571,.125502,.201809,-.155827,.42042,.144836,.225041,-.168357,.438411,.166706,.247621,-.18004,.450368,.189909,.27097,-.191536,.460083,.215251,.296658,-.203024,.469765,.243164,.325892,-.214056,.481837,.273388,.35406,-.224104,.487474,.305344,.384372,-.233489,.492773,.339741,.41749,-.241874,.498451,.376287,.45013,-.248834,.499632,.414195,.481285,-.254658,.495233,.454077,.519183,-.259367,.496401,.496352,.551544,-.261818,.487686,.538798,.587349,-.262964,.479453,.583626,.621679,-.262128,.467709,.629451,.654991,-.258998,.452123,.67566,.686873,-.254119,.433495,.723248,.719801,-.246946,.413657,.771156,.750355,-.237709,.390366,.81989,.780033,-.226549,.364947,.868601,.809254,-.214186,.337256,.920034,.836576,-.199639,.307395,.971706,.861774,-.183169,.275431,1.02479,.885707,-.165111,.243431,1.07837,.904742,-.144363,.210921,1.12783,.915604,-.121305,.17647,1.17254,.930959,-.0962119,.143106,1.21012,.948404,-.069969,.108112,1.24474,.967012,-.0427586,.0708478,1.27718,.984183,-.0147043,.032335,1.3083,.999577,.0142165,-.00726867,1.3382,.0229227,-299799e-11,.148623,462391e-12,.0232194,-758796e-10,.15054,117033e-10,.0232315,-303636e-9,.15063,468397e-10,.0232354,-683189e-9,.150624,105472e-9,.0232092,-.0012136,.150445,187744e-9,.0232523,-.00189765,.150679,294847e-9,.0232828,-.00273247,.150789,428013e-9,.0233371,-.00371287,.150995,591134e-9,.0234015,-.00484794,.15118,787642e-9,.023514,-.00612877,.151562,.00102547,.023679,-.00756125,.152116,.00131351,.0239559,-.00914651,.153162,.00166594,.0244334,-.010904,.155133,.00210182,.025139,-.0128615,.158035,.00264406,.0262598,-.0150628,.162751,.00332923,.0277875,-.0175532,.168944,.00419773,.0298472,-.0203981,.176835,.00530034,.0325444,-.023655,.186686,.00669777,.0355581,-.0272982,.196248,.00842661,.0392841,-.0314457,.207352,.0105854,.0436815,-.0361157,.219279,.0132458,.0485272,-.0412932,.230728,.0164736,.0541574,-.0470337,.242994,.0203715,.0609479,-.0535002,.257042,.0250953,.0685228,-.0605409,.27102,.0306856,.0768042,-.0680553,.28406,.037193,.0864844,-.0765011,.299186,.0449795,.0969415,-.0852674,.3132,.0538316,.108478,-.0947333,.327138,.0641149,.121705,-.10481,.342345,.0759185,.136743,-.115474,.358472,.0894116,.152986,-.126536,.374067,.104562,.170397,-.138061,.388267,.121632,.191392,-.150203,.406467,.140996,.211566,-.161751,.418641,.161696,.233567,-.173407,.430418,.184557,.257769,-.185397,.44277,.210092,.28531,-.197048,.457191,.237827,.311726,-.20784,.464712,.267253,.340537,-.218345,.472539,.299332,.372921,-.228306,.482331,.333988,.402924,-.236665,.484378,.369722,.434475,-.244097,.484717,.407836,.469736,-.250547,.487093,.448465,.505045,-.25511,.485575,.490263,.540262,-.258444,.481225,.534495,.576347,-.259903,.473481,.579451,.608656,-.259572,.4603,.625604,.646679,-.257908,.450341,.674511,.679902,-.253663,.431561,.723269,.714159,-.247419,.412684,.773263,.745345,-.239122,.389388,.824182,.778248,-.228837,.365361,.876634,.807208,-.216197,.337667,.92945,.835019,-.201772,.307197,.985261,.860261,-.185291,.274205,1.04299,.877601,-.165809,.240178,1.09816,.898211,-.143897,.207571,1.14694,.915789,-.119513,.174904,1.19008,.931831,-.0932919,.141423,1.2297,.949244,-.0656528,.105603,1.26553,.967527,-.0370262,.0679551,1.29986,.984139,-.00730117,.0283133,1.33252,.999713,.0234648,-.0121785,1.36397,.0152135,-245447e-11,.122795,304092e-12,.0151652,-615778e-10,.122399,76292e-10,.0151181,-245948e-9,.122023,304802e-10,.0151203,-553394e-9,.12203,686634e-10,.015125,-983841e-9,.122037,122463e-9,.0151427,-.00153774,.12214,192706e-9,.0151708,-.0022103,.122237,281219e-9,.0152115,-.00300741,.12238,390804e-9,.0152877,-.00392494,.1227,526317e-9,.015412,-.00496597,.123244,69443e-8,.0156201,-.00613314,.124228,90547e-8,.0159658,-.00744113,.125945,.0011732,.0165674,-.00892546,.129098,.00151888,.017487,-.010627,.133865,.00197007,.018839,-.0126043,.140682,.0025637,.020554,-.0148814,.148534,.00333637,.0226727,-.0175123,.157381,.00433738,.0251879,-.0205266,.166685,.00561664,.0283635,-.0240319,.177796,.00725563,.0318694,-.0279432,.188251,.00928811,.0361044,-.0324313,.200038,.011835,.0406656,-.0373527,.210685,.0149146,.0463846,-.0430132,.224182,.0187254,.0525696,-.0491013,.23634,.0232283,.0598083,-.0559175,.250013,.0286521,.0679437,-.0633657,.263981,.0350634,.0771181,-.0714602,.278072,.0425882,.0881273,-.0803502,.29511,.0514487,.0996628,-.0896903,.309976,.0615766,.112702,-.099644,.325611,.0732139,.126488,-.109829,.339321,.0862324,.142625,-.120859,.35574,.101275,.15953,-.131956,.369845,.117892,.176991,-.143145,.38146,.136205,.199715,-.155292,.40052,.157252,.220787,-.167066,.412055,.179966,.243697,-.178396,.423133,.204418,.272106,-.190433,.439524,.232141,.297637,-.201265,.447041,.261109,.325273,-.211834,.454488,.292627,.357219,-.221889,.465004,.326669,.387362,-.230729,.468527,.362426,.423131,-.23924,.475836,.401533,.45543,-.246067,.475017,.441902,.493393,-.251557,.478017,.484239,.526253,-.255571,.4709,.528586,.560554,-.257752,.463167,.574346,.599306,-.258076,.456452,.621655,.634541,-.256471,.443725,.670492,.668907,-.253283,.428719,.721943,.705619,-.247562,.411348,.772477,.739034,-.240626,.388939,.8264,.771408,-.231493,.36425,.881702,.803312,-.220125,.337321,.9385,.828457,-.206645,.305364,.997437,.854819,-.190664,.273715,1.05693,.878666,-.171429,.242218,1.11251,.898404,-.149235,.209556,1.16398,.917416,-.12435,.176863,1.21014,.933133,-.0972703,.142775,1.25178,.95066,-.0683607,.106735,1.29028,.968589,-.0378724,.0681609,1.32703,.984776,-.00605712,.0273966,1.36158,.99994,.0263276,-.0138124,1.3943,.00867437,-186005e-11,.0928979,173682e-12,.00864003,-466389e-10,.0925237,435505e-11,.00864593,-186594e-9,.0925806,174322e-10,.00864095,-419639e-9,.0924903,392862e-10,.00863851,-746272e-9,.0924589,702598e-10,.00868531,-.00116456,.0929,111188e-9,.00869667,-.00167711,.0928529,163867e-9,.00874332,-.00228051,.0930914,23104e-8,.00882709,-.00297864,.0935679,31741e-8,.00898874,-.00377557,.0946165,430186e-9,.00929346,-.00469247,.0967406,580383e-9,.00978271,-.00575491,.100084,783529e-9,.0105746,-.00701514,.105447,.00106304,.0116949,-.00851797,.112494,.00144685,.0130419,-.0102757,.119876,.00196439,.0148375,-.012381,.129034,.00266433,.0168725,-.01482,.137812,.00358364,.0193689,-.0176563,.147696,.00478132,.0222691,-.0209211,.157795,.00631721,.0256891,-.0246655,.168431,.00826346,.0294686,-.0288597,.178587,.0106714,.0340412,-.0336441,.190251,.0136629,.0393918,-.039033,.202999,.0173272,.0453947,-.0450087,.215655,.0217448,.0521936,-.0515461,.228686,.0269941,.0600279,-.058817,.242838,.033272,.0692398,-.0667228,.258145,.0406457,.0793832,-.0752401,.273565,.0492239,.0902297,-.0841851,.287735,.0590105,.102014,-.0936479,.301161,.0702021,.116054,-.103967,.317438,.0832001,.13191,-.114622,.334166,.0977951,.148239,-.125452,.348192,.113985,.165809,-.136453,.361094,.131928,.184616,-.147648,.373534,.151811,.207491,-.159607,.39101,.174476,.230106,-.171119,.402504,.198798,.257036,-.182906,.418032,.225796,.281172,-.193605,.425468,.254027,.312034,-.204771,.440379,.285713,.340402,-.214988,.445406,.319196,.370231,-.224711,.44968,.35537,.407105,-.233516,.460747,.393838,.439037,-.240801,.460624,.433747,.47781,-.24762,.465957,.477234,.510655,-.251823,.460054,.52044,.550584,-.255552,.459172,.567853,.585872,-.257036,.450311,.615943,.620466,-.257535,.437763,.667693,.660496,-.255248,.426639,.718988,.695578,-.251141,.409185,.772503,.732176,-.244718,.39015,.827023,.760782,-.236782,.362594,.885651,.79422,-.225923,.33711,.943756,.824521,-.213855,.308272,1.00874,.854964,-.197723,.278529,1.06764,.878065,-.179209,.246208,1.12836,.899834,-.157569,.21329,1.18318,.918815,-.133206,.181038,1.23161,.934934,-.106545,.146993,1.27644,.952115,-.0780574,.111175,1.31842,.96906,-.0478279,.0728553,1.35839,.985178,-.0160014,.032579,1.39697,1.00039,.0173126,-.0095256,1.43312,.00384146,-124311e-11,.0613583,778271e-13,.00390023,-314043e-10,.0622919,196626e-11,.00389971,-125622e-9,.0622632,787379e-11,.00389491,-282352e-9,.0620659,1778e-8,.00391618,-502512e-9,.0624687,320918e-10,.00392662,-784458e-9,.0625113,515573e-10,.00396053,-.00112907,.0628175,778668e-10,.00401911,-.00153821,.0633286,113811e-9,.00414994,-.0020208,.0646443,16445e-8,.00441223,-.00260007,.0673886,237734e-9,.00484427,-.0033097,.0716528,345929e-9,.00549109,-.00418966,.0774998,505987e-9,.00636293,-.00527331,.0844758,739208e-9,.00746566,-.00660428,.0921325,.00107347,.00876625,-.00818826,.0997067,.00153691,.0103125,-.0100811,.107433,.00217153,.0123309,-.0123643,.117088,.00303427,.0146274,-.0150007,.126438,.00416018,.0172295,-.0180531,.135672,.00561513,.0204248,-.0215962,.146244,.007478,.0241597,-.0256234,.157481,.00981046,.0284693,-.0302209,.169125,.0127148,.033445,-.0353333,.181659,.0162453,.0391251,-.0410845,.1944,.0205417,.0454721,-.0473451,.207082,.0256333,.0530983,-.0542858,.221656,.0317036,.0615356,-.0618384,.236036,.0388319,.0703363,-.0697631,.248398,.046974,.0810391,-.0784757,.263611,.0565246,.0920144,-.0873488,.275857,.0671724,.105584,-.0973652,.292555,.0798105,.119506,-.107271,.306333,.0935945,.134434,-.117608,.318888,.109106,.153399,-.128938,.337552,.127074,.171258,-.139944,.349955,.14643,.191059,-.151288,.361545,.168,.215069,-.163018,.378421,.192082,.237838,-.174226,.38879,.217838,.266965,-.186063,.405857,.246931,.292827,-.196909,.414146,.277505,.324352,-.207473,.426955,.310711,.354427,-.217713,.433429,.346794,.389854,-.227183,.443966,.385237,.420749,-.235131,.44471,.424955,.459597,-.242786,.451729,.468446,.495316,-.248767,.45072,.513422,.534903,-.253351,.450924,.560618,.572369,-.256277,.445266,.609677,.612383,-.2576,.438798,.660995,.644037,-.256931,.421693,.713807,.686749,-.254036,.4109,.767616,.719814,-.249785,.390151,.82533,.754719,-.244283,.367847,.888311,.792022,-.235076,.345013,.948177,.822404,-.225061,.316193,1.01661,.853084,-.211113,.287013,1.08075,.879871,-.19449,.255424,1.14501,.901655,-.174023,.222879,1.20203,.919957,-.1509,.18989,1.25698,.938412,-.124923,.15606,1.30588,.953471,-.0968139,.120512,1.3529,.970451,-.066734,.0828515,1.3986,.985522,-.034734,.0424458,1.44148,1.00099,-.00102222,678929e-9,1.48398,965494e-9,-627338e-12,.0306409,197672e-13,99168e-8,-158573e-10,.0314638,499803e-12,991068e-9,-634012e-10,.031363,200682e-11,974567e-9,-14144e-8,.03036,457312e-11,998079e-9,-252812e-9,.031496,860131e-11,.00102243,-396506e-9,.0319955,148288e-10,.00107877,-577593e-9,.0331376,249141e-10,.00121622,-816816e-9,.0359396,423011e-10,.0014455,-.00113761,.0399652,724613e-10,.00178791,-.00156959,.0450556,123929e-9,.00225668,-.00214064,.0508025,208531e-9,.00285627,-.00287655,.0568443,341969e-9,.0035991,-.00380271,.0630892,544158e-9,.00455524,-.00496264,.0702204,842423e-9,.00569143,-.0063793,.0773426,.00126704,.00716928,-.00813531,.0860839,.00186642,.00885307,-.0101946,.0944079,.00267014,.0109316,-.0126386,.103951,.00374033,.0133704,-.0154876,.113786,.0051304,.0161525,-.0187317,.123477,.00688858,.0194267,-.0224652,.133986,.00910557,.0230967,-.0265976,.143979,.0118074,.0273627,-.0312848,.154645,.0151266,.0323898,-.0365949,.166765,.0191791,.0379225,-.0422914,.177932,.0239236,.0447501,-.0487469,.19167,.0296568,.0519391,-.0556398,.203224,.0362924,.0599464,-.0631646,.215652,.0440585,.0702427,-.0714308,.232089,.0531619,.0806902,-.0800605,.245258,.0634564,.0923194,-.0892815,.258609,.0752481,.106938,-.09931,.276654,.0888914,.121238,-.109575,.289847,.104055,.138817,-.120461,.307566,.121266,.15595,-.131209,.320117,.139944,.178418,-.143049,.339677,.161591,.197875,-.154074,.349886,.184303,.224368,-.166307,.369352,.210669,.252213,-.178051,.386242,.238895,.277321,-.189335,.395294,.269182,.310332,-.200683,.412148,.302508,.338809,-.210856,.418266,.337264,.372678,-.220655,.428723,.374881,.405632,-.230053,.433887,.415656,.442293,-.237993,.439911,.457982,.477256,-.244897,.440175,.502831,.515592,-.250657,.441079,.550277,.550969,-.255459,.435219,.601102,.592883,-.257696,.432882,.651785,.629092,-.259894,.421054,.708961,.672033,-.258592,.41177,.763806,.709147,-.256525,.395267,.824249,.745367,-.254677,.375013,.8951,.784715,-.247892,.353906,.959317,.818107,-.240162,.327801,1.03153,.847895,-.229741,.298821,1.10601,.879603,-.213084,.269115,1.164,.902605,-.195242,.236606,1.22854,.922788,-.174505,.203442,1.29017,.944831,-.150169,.169594,1.34157,.959656,-.124099,.135909,1.3956,.972399,-.0960626,.0990563,1.45128,.986549,-.0657097,.0602348,1.50312,1.00013,-.0333558,.0186694,1.55364,619747e-11,-1e-7,.00778326,796756e-16,237499e-13,-999999e-13,282592e-10,114596e-15,100292e-11,-166369e-11,250354e-9,677492e-14,350752e-11,-637769e-11,357289e-9,631655e-13,826445e-11,-174689e-10,516179e-9,31851e-11,242481e-10,-450868e-10,.0010223,130577e-11,455631e-10,-89044e-9,.00144302,374587e-11,971222e-10,-178311e-9,.00241912,102584e-10,171403e-9,-313976e-9,.00354938,236481e-10,292747e-9,-520026e-9,.00513765,496014e-10,789827e-9,-.00118187,.0238621,139056e-9,.00114093,-.00171827,.0286691,244093e-9,.00176119,-.00249667,.0368565,420623e-9,.0022233,-.00333742,.0400469,65673e-8,.00343382,-.00481976,.0535751,.00109323,.00427602,-.00600755,.057099,.00155268,.00461435,-.00737637,.0551084,.00215031,.00695698,-.00971401,.0715767,.00316529,.00867619,-.0120943,.0793314,.00436995,.0106694,-.0148202,.0869391,.0058959,.0140351,-.0183501,.101572,.00798757,.0168939,-.022006,.11018,.0104233,.020197,-.0261568,.119041,.0134167,.0254702,-.0312778,.135404,.0173009,.0298384,-.0362469,.1437,.0215428,.035159,-.042237,.15512,.0268882,.0427685,-.0488711,.17128,.033235,.0494848,-.0557997,.181813,.0404443,.0592394,-.0635578,.198745,.0490043,.0681463,-.071838,.210497,.0588239,.0804753,-.0809297,.228864,.0702835,.0942205,-.0906488,.247008,.0834012,.106777,-.100216,.258812,.0975952,.124471,-.110827,.278617,.114162,.138389,-.121193,.287049,.131983,.159543,-.13253,.307151,.152541,.176432,-.143611,.31564,.174673,.201723,-.15548,.33538,.199842,.229721,-.167166,.355256,.227097,.250206,-.178238,.360047,.256014,.282118,-.189905,.378761,.28855,.312821,-.201033,.39181,.323348,.341482,-.211584,.397716,.360564,.377368,-.221314,.410141,.400004,.418229,-.230474,.423485,.442371,.444881,-.239443,.418874,.488796,.488899,-.245987,.427545,.535012,.520317,-.253948,.422147,.589678,.568566,-.256616,.42719,.637683,.599607,-.26376,.415114,.703363,.64222,-.268687,.408715,.771363,.685698,-.2694,.399722,.83574,.732327,-.266642,.388651,.897764,.769873,-.267712,.369198,.983312,.806733,-.263479,.346802,1.06222,.843466,-.254575,.321368,1.13477,.873008,-.242749,.29211,1.20712,.908438,-.22725,.262143,1.27465,.936321,-.207621,.228876,1.33203,.950353,-.187932,.19484,1.40439,.96442,-.165154,.163178,1.4732,.979856,-.139302,.127531,1.53574,.982561,-.11134,.0903457,1.59982,.996389,-.0808124,.0489007,1.6577],t=[1,0,0,0,1,791421e-36,0,0,1,104392e-29,0,0,1,349405e-26,0,0,1,109923e-23,0,0,1,947414e-22,0,0,1,359627e-20,0,0,1,772053e-19,0,0,1,108799e-17,0,0,1,110655e-16,0,0,1,865818e-16,0,0,.999998,545037e-15,0,0,.999994,285095e-14,0,0,.999989,126931e-13,0,0,.999973,489938e-13,0,0,.999947,166347e-12,0,0,.999894,502694e-12,0,0,.999798,136532e-11,0,0,.999617,335898e-11,0,0,.999234,752126e-11,0,0,.998258,152586e-10,0,0,.99504,266207e-10,0,0,.980816,236802e-10,0,0,.967553,207684e-11,0,0,.966877,403733e-11,0,0,.965752,741174e-11,0,0,.96382,127746e-10,0,0,.960306,202792e-10,0,0,.953619,280232e-10,0,0,.941103,278816e-10,0,0,.926619,160221e-10,0,0,.920983,235164e-10,0,0,.912293,311924e-10,0,.0158731,.899277,348118e-10,0,.0476191,.880884,26041e-9,0,.0793651,.870399,338726e-10,0,.111111,.856138,392906e-10,0,.142857,.837436,372874e-10,0,.174603,.820973,392558e-10,0,.206349,.803583,434658e-10,0,.238095,.782168,40256e-9,0,.269841,.764107,448159e-10,0,.301587,.743092,457627e-10,0,.333333,.721626,455314e-10,0,.365079,.700375,477335e-10,0,.396825,.677334,461072e-10,0,.428571,.655702,484393e-10,0,.460317,.632059,464583e-10,0,.492064,.610125,483923e-10,0,.52381,.58653,464342e-10,0,.555556,.564508,477033e-10,0,.587302,.541405,459263e-10,0,.619048,.519556,46412e-9,0,.650794,.497292,448913e-10,0,.68254,.475898,445789e-10,0,.714286,.454722,433496e-10,0,.746032,.434042,423054e-10,0,.777778,.414126,413737e-10,0,.809524,.394387,397265e-10,0,.84127,.375841,390709e-10,0,.873016,.357219,369938e-10,0,.904762,.340084,365618e-10,0,.936508,.322714,342533e-10,0,.968254,.306974,339596e-10,0,1,1,101524e-23,0,0,1,10292e-22,0,0,1,130908e-23,0,0,1,473331e-23,0,0,1,625319e-22,0,0,1,107932e-20,0,0,1,163779e-19,0,0,1,203198e-18,0,0,1,204717e-17,0,0,.999999,168995e-16,0,0,.999998,115855e-15,0,0,.999996,66947e-14,0,0,.999991,330863e-14,0,0,.999983,141737e-13,0,0,.999968,532626e-13,0,0,.99994,177431e-12,0,0,.999891,528835e-12,0,0,.999797,142169e-11,0,0,.999617,347057e-11,0,0,.999227,77231e-10,0,0,.998239,155753e-10,0,0,.994937,268495e-10,0,0,.980225,213742e-10,0,0,.967549,21631e-10,0,0,.966865,417989e-11,0,0,.965739,763341e-11,0,0,.963794,130892e-10,0,0,.960244,206456e-10,0,0,.953495,282016e-10,0,148105e-9,.940876,271581e-10,0,.002454,.926569,164159e-10,0,.00867491,.920905,239521e-10,0,.01956,.912169,315127e-10,0,.035433,.899095,346626e-10,0,.056294,.882209,290223e-10,0,.0818191,.870272,342992e-10,0,.111259,.855977,394164e-10,0,.142857,.837431,372343e-10,0,.174603,.820826,396691e-10,0,.206349,.803408,435395e-10,0,.238095,.782838,419579e-10,0,.269841,.763941,450953e-10,0,.301587,.742904,455847e-10,0,.333333,.721463,458833e-10,0,.365079,.700197,477159e-10,0,.396825,.677501,470641e-10,0,.428571,.655527,484732e-10,0,.460317,.6324,476834e-10,0,.492064,.609964,484213e-10,0,.52381,.586839,475541e-10,0,.555556,.564353,476951e-10,0,.587302,.541589,467611e-10,0,.619048,.519413,463493e-10,0,.650794,.497337,453994e-10,0,.68254,.475797,445308e-10,0,.714286,.454659,435787e-10,0,.746032,.434065,424839e-10,0,.777778,.414018,41436e-9,0,.809524,.39455,401902e-10,0,.84127,.375742,390813e-10,0,.873016,.357501,377116e-10,0,.904762,.339996,36535e-9,0,.936508,.323069,351265e-10,0,.968254,.306897,339112e-10,0,1,1,10396e-19,0,0,1,104326e-20,0,0,1,110153e-20,0,0,1,144668e-20,0,0,1,34528e-19,0,0,1,175958e-19,0,0,1,12627e-17,0,0,1,936074e-18,0,0,1,645742e-17,0,0,.999998,401228e-16,0,0,.999997,222338e-15,0,0,.999995,10967e-13,0,0,.999991,482132e-14,0,0,.999981,189434e-13,0,0,.999967,667716e-13,0,0,.999938,212066e-12,0,0,.999886,60977e-11,0,0,.999792,159504e-11,0,0,.999608,381191e-11,0,0,.999209,833727e-11,0,0,.998179,165288e-10,0,0,.994605,274387e-10,0,0,.979468,167316e-10,0,0,.967529,242877e-11,0,0,.966836,461696e-11,0,0,.96569,830977e-11,0,0,.963706,140427e-10,0,244659e-11,.960063,217353e-10,0,760774e-9,.953113,286606e-10,0,.00367261,.940192,247691e-10,0,.00940263,.927731,195814e-10,0,.018333,.920669,252531e-10,0,.0306825,.911799,324277e-10,0,.0465556,.89857,340982e-10,0,.0659521,.883283,319622e-10,0,.0887677,.86989,35548e-9,0,.114784,.855483,397143e-10,0,.143618,.837987,391665e-10,0,.174606,.820546,411306e-10,0,.206349,.802878,436753e-10,0,.238095,.783402,444e-7,0,.269841,.763439,458726e-10,0,.301587,.742925,467097e-10,0,.333333,.721633,478887e-10,0,.365079,.69985,481251e-10,0,.396825,.67783,491811e-10,0,.428571,.655126,488199e-10,0,.460318,.632697,496025e-10,0,.492064,.609613,48829e-9,0,.52381,.587098,492754e-10,0,.555556,.564119,482625e-10,0,.587302,.541813,482807e-10,0,.619048,.519342,471552e-10,0,.650794,.497514,466765e-10,0,.68254,.475879,455582e-10,0,.714286,.454789,446007e-10,0,.746032,.434217,435382e-10,0,.777778,.414086,421753e-10,0,.809524,.394744,412093e-10,0,.84127,.375782,396634e-10,0,.873016,.357707,386419e-10,0,.904762,.340038,370345e-10,0,.936508,.323284,359725e-10,0,.968254,.306954,3436e-8,0,1,1,599567e-19,0,0,1,600497e-19,0,0,1,614839e-19,0,0,1,686641e-19,0,0,1,972658e-19,0,0,1,221271e-18,0,0,1,833195e-18,0,0,1,403601e-17,0,0,.999999,206001e-16,0,0,.999998,101739e-15,0,0,.999997,470132e-15,0,0,.999993,200436e-14,0,0,.999988,783682e-14,0,0,.999979,280338e-13,0,0,.999962,917033e-13,0,0,.999933,274514e-12,0,0,.999881,753201e-12,0,0,.999783,189826e-11,0,0,.999594,440279e-11,0,0,.999178,93898e-10,0,0,.998073,181265e-10,0,0,.993993,280487e-10,0,0,.979982,149422e-10,0,0,.968145,378481e-11,0,0,.966786,53771e-10,0,0,.965611,947508e-11,0,388934e-10,.963557,156616e-10,0,9693e-7,.959752,235144e-10,0,.00370329,.952461,291568e-10,0,.00868428,.940193,240102e-10,0,.0161889,.929042,231235e-10,0,.0263948,.920266,273968e-10,0,.0394088,.911178,337915e-10,0,.0552818,.897873,333629e-10,0,.0740138,.884053,351405e-10,0,.0955539,.869455,378034e-10,0,.119795,.854655,399378e-10,0,.14656,.838347,419108e-10,0,.175573,.820693,440831e-10,0,.206388,.802277,445599e-10,0,.238095,.783634,472691e-10,0,.269841,.763159,476984e-10,0,.301587,.742914,491487e-10,0,.333333,.721662,502312e-10,0,.365079,.699668,502817e-10,0,.396825,.677839,51406e-9,0,.428571,.655091,511095e-10,0,.460317,.632665,516067e-10,0,.492064,.609734,512255e-10,0,.52381,.587043,510263e-10,0,.555556,.564298,50565e-9,0,.587302,.541769,497951e-10,0,.619048,.519529,492698e-10,0,.650794,.497574,482066e-10,0,.68254,.476028,473689e-10,0,.714286,.454961,461941e-10,0,.746032,.434341,450618e-10,0,.777778,.414364,438355e-10,0,.809524,.394832,424196e-10,0,.84127,.376109,412563e-10,0,.873016,.35779,396226e-10,0,.904762,.340379,384886e-10,0,.936508,.323385,368214e-10,0,.968254,.307295,356636e-10,0,1,1,106465e-17,0,0,1,106555e-17,0,0,1,107966e-17,0,0,1,114601e-17,0,0,1,137123e-17,0,0,1,21243e-16,0,0,.999999,489653e-17,0,0,.999999,160283e-16,0,0,.999998,62269e-15,0,0,.999997,251859e-15,0,0,.999996,996192e-15,0,0,.999992,374531e-14,0,0,.999986,132022e-13,0,0,.999975,433315e-13,0,0,.999959,131956e-12,0,0,.999927,372249e-12,0,0,.999871,972461e-12,0,0,.999771,235343e-11,0,0,.999572,52768e-10,0,0,.999133,109237e-10,0,0,.997912,203675e-10,0,0,.993008,279396e-10,0,0,.980645,139604e-10,0,0,.970057,646596e-11,0,0,.966717,65089e-10,0,474145e-10,.965497,111863e-10,0,89544e-8,.96334,179857e-10,0,.0032647,.959294,259045e-10,0,.0075144,.951519,292327e-10,0,.0138734,.940517,249769e-10,0,.0224952,.93014,26803e-9,0,.0334828,.91972,303656e-10,0,.0468973,.910294,353323e-10,0,.0627703,.897701,351002e-10,0,.0811019,.884522,388104e-10,0,.10186,.869489,412932e-10,0,.124985,.853983,415781e-10,0,.150372,.838425,454066e-10,0,.177868,.820656,471624e-10,0,.207245,.801875,475243e-10,0,.238143,.783521,505621e-10,0,.269841,.763131,50721e-9,0,.301587,.74261,523293e-10,0,.333333,.72148,528699e-10,0,.365079,.699696,538677e-10,0,.396825,.677592,539255e-10,0,.428571,.65525,546367e-10,0,.460317,.632452,541348e-10,0,.492064,.609903,544976e-10,0,.52381,.586928,536201e-10,0,.555556,.564464,535185e-10,0,.587302,.541801,524949e-10,0,.619048,.519681,51812e-9,0,.650794,.497685,507687e-10,0,.68254,.47622,496243e-10,0,.714286,.455135,485714e-10,0,.746032,.4346,471847e-10,0,.777778,.414564,459294e-10,0,.809524,.395165,444705e-10,0,.84127,.376333,430772e-10,0,.873016,.358197,416229e-10,0,.904762,.34064,401019e-10,0,.936508,.323816,386623e-10,0,.968254,.307581,370933e-10,0,1,1,991541e-17,0,0,1,992077e-17,0,0,1,100041e-16,0,0,1,10385e-15,0,0,1,115777e-16,0,0,1,150215e-16,0,0,.999999,254738e-16,0,0,.999999,598822e-16,0,0,.999998,179597e-15,0,0,.999997,602367e-15,0,0,.999994,206835e-14,0,0,.99999,694952e-14,0,0,.999984,223363e-13,0,0,.999972,678578e-13,0,0,.999952,193571e-12,0,0,.999919,516594e-12,0,0,.99986,128739e-11,0,0,.999753,299298e-11,0,0,.999546,648258e-11,0,0,.999074,129985e-10,0,0,.997671,232176e-10,0,0,.991504,256701e-10,0,0,.981148,131141e-10,0,0,.971965,869048e-11,0,280182e-10,.966624,808301e-11,0,695475e-9,.965344,135235e-10,0,.00265522,.963048,210592e-10,0,.00622975,.958673,287473e-10,0,.0116234,.950262,281379e-10,0,.018976,.940836,271089e-10,0,.0283844,.930996,30926e-9,0,.0399151,.919848,348359e-10,0,.0536063,.909136,366092e-10,0,.0694793,.897554,384162e-10,0,.0875342,.884691,430971e-10,0,.107749,.869414,447803e-10,0,.130087,.853462,452858e-10,0,.154481,.838187,495769e-10,0,.180833,.820381,502709e-10,0,.209005,.801844,522713e-10,0,.238791,.783061,541505e-10,0,.269869,.763205,553712e-10,0,.301587,.742362,564909e-10,0,.333333,.721393,572646e-10,0,.365079,.699676,581012e-10,0,.396825,.677395,58096e-9,0,.428571,.655208,585766e-10,0,.460317,.632451,583602e-10,0,.492064,.609839,580234e-10,0,.52381,.587093,577161e-10,0,.555556,.564467,568447e-10,0,.587302,.542043,563166e-10,0,.619048,.519826,55156e-9,0,.650794,.497952,541682e-10,0,.68254,.476477,528971e-10,0,.714286,.455412,514952e-10,0,.746032,.434926,502222e-10,0,.777778,.4149,485779e-10,0,.809524,.395552,472242e-10,0,.84127,.376712,454891e-10,0,.873016,.358622,440924e-10,0,.904762,.341048,422984e-10,0,.936508,.324262,408582e-10,0,.968254,.308013,390839e-10,0,1,1,613913e-16,0,0,1,614145e-16,0,0,1,617708e-16,0,0,1,633717e-16,0,0,1,681648e-16,0,0,1,808291e-16,0,0,1,114608e-15,0,0,.999998,210507e-15,0,0,.999997,499595e-15,0,0,.999995,139897e-14,0,0,.999994,419818e-14,0,0,.999988,127042e-13,0,0,.999979,375153e-13,0,0,.999965,106206e-12,0,0,.999945,285381e-12,0,0,.999908,723611e-12,0,0,.999846,17255e-10,0,0,.999733,386104e-11,0,0,.999511,808493e-11,0,0,.998993,156884e-10,0,0,.997326,265538e-10,0,0,.989706,206466e-10,0,0,.981713,130756e-10,0,70005e-10,.973636,106473e-10,0,464797e-9,.966509,10194e-9,0,.00201743,.965149,165881e-10,0,.00497549,.962669,249147e-10,0,.00953262,.95786,317449e-10,0,.0158211,.949334,281045e-10,0,.0239343,.941041,303263e-10,0,.0339372,.931575,356754e-10,0,.0458738,.920102,397075e-10,0,.059772,.908002,384886e-10,0,.075645,.897269,43027e-9,0,.0934929,.884559,479925e-10,0,.113302,.869161,48246e-9,0,.135045,.853342,509505e-10,0,.158678,.837633,542846e-10,0,.184136,.820252,554139e-10,0,.211325,.801872,581412e-10,0,.240113,.782418,585535e-10,0,.270306,.7631,610923e-10,0,.301594,.742183,613678e-10,0,.333333,.721098,627275e-10,0,.365079,.699512,629413e-10,0,.396825,.677372,636351e-10,0,.428571,.655059,633555e-10,0,.460317,.632567,636513e-10,0,.492064,.609784,628965e-10,0,.52381,.587237,625546e-10,0,.555556,.564525,615825e-10,0,.587302,.542181,605048e-10,0,.619048,.520017,596329e-10,0,.650794,.498204,581516e-10,0,.68254,.476742,569186e-10,0,.714286,.455803,553833e-10,0,.746032,.435251,537807e-10,0,.777778,.415374,522025e-10,0,.809524,.395921,503421e-10,0,.84127,.377253,488211e-10,0,.873016,.359021,468234e-10,0,.904762,.341637,453269e-10,0,.936508,.3247,433014e-10,0,.968254,.308625,418007e-10,0,1,1,286798e-15,0,0,1,286877e-15,0,0,1,288094e-15,0,0,1,293506e-15,0,0,1,309262e-15,0,0,.999999,348593e-15,0,0,.999999,444582e-15,0,0,.999998,688591e-15,0,0,.999996,134391e-14,0,0,.999993,317438e-14,0,0,.999989,835609e-14,0,0,.999983,228677e-13,0,0,.999974,623361e-13,0,0,.999959,165225e-12,0,0,.999936,419983e-12,0,0,.999896,101546e-11,0,0,.99983,232376e-11,0,0,.999709,50156e-10,0,0,.999469,10167e-9,0,0,.998886,190775e-10,0,0,.996819,300511e-10,0,0,.988837,185092e-10,0,168222e-12,.982178,134622e-10,0,259622e-9,.975017,125961e-10,0,.00142595,.967101,13507e-9,0,.00382273,.964905,205003e-10,0,.00764164,.96218,29546e-9,0,.0130121,.956821,343738e-10,0,.0200253,.948829,305063e-10,0,.0287452,.941092,346487e-10,0,.039218,.931883,412061e-10,0,.0514748,.920211,444651e-10,0,.0655351,.907307,431252e-10,0,.0814082,.89684,490382e-10,0,.0990939,.884119,53334e-9,0,.118583,.869148,54114e-9,0,.139856,.853377,578536e-10,0,.162882,.836753,592285e-10,0,.187615,.820063,622787e-10,0,.213991,.801694,645492e-10,0,.241918,.782116,65353e-9,0,.271267,.762673,674344e-10,0,.301847,.742133,682788e-10,0,.333333,.720779,691959e-10,0,.365079,.699386,696817e-10,0,.396826,.67732,699583e-10,0,.428572,.654888,698447e-10,0,.460318,.632499,694063e-10,0,.492064,.609825,691612e-10,0,.52381,.587287,681576e-10,0,.555556,.564743,674138e-10,0,.587302,.542409,661617e-10,0,.619048,.520282,647785e-10,0,.650794,.498506,633836e-10,0,.68254,.477102,615905e-10,0,.714286,.456167,601013e-10,0,.746032,.435728,581457e-10,0,.777778,.415809,564215e-10,0,.809524,.396517,544997e-10,0,.84127,.377737,525061e-10,0,.873016,.359698,506831e-10,0,.904762,.342164,48568e-9,0,.936508,.325417,467826e-10,0,.968254,.309186,446736e-10,0,1,1,109018e-14,0,0,1,10904e-13,0,0,1,109393e-14,0,0,1,11095e-13,0,0,1,1154e-12,0,0,1,126089e-14,0,0,.999999,15059e-13,0,0,.999997,207899e-14,0,0,.999994,348164e-14,0,0,.999993,705728e-14,0,0,.999987,163692e-13,0,0,.999981,406033e-13,0,0,.999969,10245e-11,0,0,.999953,255023e-12,0,0,.999925,61511e-11,0,0,.999881,142218e-11,0,0,.99981,313086e-11,0,0,.99968,653119e-11,0,0,.999418,12832e-9,0,0,.998748,232497e-10,0,0,.996066,329522e-10,0,0,.988379,179613e-10,0,108799e-9,.982567,143715e-10,0,921302e-9,.976097,148096e-10,0,.00280738,.968475,178905e-10,0,.00596622,.964606,253921e-10,0,.0105284,.961564,348623e-10,0,.0165848,.955517,357612e-10,0,.0242,.948381,343493e-10,0,.03342,.941095,405849e-10,0,.0442777,.931923,475394e-10,0,.0567958,.91996,484328e-10,0,.0709879,.907419,502146e-10,0,.086861,.89618,561654e-10,0,.104415,.88337,587612e-10,0,.123643,.869046,618057e-10,0,.144531,.853278,657392e-10,0,.167057,.836091,66303e-9,0,.191188,.819644,704445e-10,0,.216878,.801246,714071e-10,0,.244062,.782031,740093e-10,0,.272649,.762066,74685e-9,0,.302509,.741964,766647e-10,0,.333442,.720554,766328e-10,0,.365079,.699098,777857e-10,0,.396826,.677189,774633e-10,0,.428572,.65484,776235e-10,0,.460318,.632496,770316e-10,0,.492064,.609908,762669e-10,0,.52381,.587312,753972e-10,0,.555556,.564938,739994e-10,0,.587302,.542577,728382e-10,0,.619048,.52062,71112e-9,0,.650794,.498819,694004e-10,0,.68254,.477555,675575e-10,0,.714286,.456568,653449e-10,0,.746032,.436278,636068e-10,0,.777778,.41637,613466e-10,0,.809524,.397144,594177e-10,0,.84127,.378412,570987e-10,0,.873016,.360376,550419e-10,0,.904762,.342906,527422e-10,0,.936508,.326136,506544e-10,0,.968254,.30997,484307e-10,0,1,1,354014e-14,0,0,1,354073e-14,0,0,1,354972e-14,0,0,1,358929e-14,0,0,1,370093e-14,0,0,.999999,396194e-14,0,0,.999998,453352e-14,0,0,.999997,578828e-14,0,0,.999994,863812e-14,0,0,.999991,153622e-13,0,0,.999985,316356e-13,0,0,.999977,712781e-13,0,0,.999964,166725e-12,0,0,.999945,390501e-12,0,0,.999912,895622e-12,0,0,.999866,198428e-11,0,0,.999786,421038e-11,0,0,.999647,850239e-11,0,0,.999356,162059e-10,0,0,.998563,282652e-10,0,0,.994928,336309e-10,0,244244e-10,.987999,178458e-10,0,523891e-9,.982893,159162e-10,0,.00194729,.977044,178056e-10,0,.00451099,.969972,230624e-10,0,.00835132,.964237,313922e-10,0,.013561,.960791,406145e-10,0,.0202056,.954292,372796e-10,0,.0283321,.948052,403199e-10,0,.0379739,.940938,479537e-10,0,.0491551,.931689,545292e-10,0,.0618918,.91987,54038e-9,0,.0761941,.907665,589909e-10,0,.0920672,.895281,642651e-10,0,.109511,.882621,659707e-10,0,.12852,.86873,709973e-10,0,.149085,.853008,742221e-10,0,.171189,.835944,761754e-10,0,.194809,.818949,797052e-10,0,.21991,.800951,812434e-10,0,.246447,.781847,838075e-10,0,.274352,.761649,84501e-9,0,.303535,.74152,860258e-10,0,.333857,.720495,866233e-10,0,.365104,.698742,868326e-10,0,.396826,.677096,87133e-9,0,.428572,.654782,863497e-10,0,.460318,.632335,860206e-10,0,.492064,.610031,849337e-10,0,.52381,.587457,838279e-10,0,.555556,.56513,82309e-9,0,.587302,.542877,803542e-10,0,.619048,.5209,786928e-10,0,.650794,.499291,765171e-10,0,.68254,.477971,744753e-10,0,.714286,.457221,72209e-9,0,.746032,.436803,697448e-10,0,.777778,.417083,675333e-10,0,.809524,.397749,648058e-10,0,.84127,.379177,625759e-10,0,.873016,.361061,598584e-10,0,.904762,.343713,575797e-10,0,.936508,.326894,549999e-10,0,.968254,.310816,527482e-10,0,1,1,10153e-12,0,0,1,101544e-13,0,0,1,101751e-13,0,0,1,102662e-13,0,0,1,10521e-12,0,0,.999999,111049e-13,0,0,.999999,123408e-13,0,0,.999996,14924e-12,0,0,.999992,204471e-13,0,0,.999989,326539e-13,0,0,.99998,603559e-13,0,0,.999971,123936e-12,0,0,.999955,269058e-12,0,0,.999933,593604e-12,0,0,.999901,129633e-11,0,0,.999847,275621e-11,0,0,.999761,564494e-11,0,0,.999607,110485e-10,0,0,.999282,204388e-10,0,0,.99831,341084e-10,0,22038e-11,.993288,294949e-10,0,242388e-9,.987855,192736e-10,0,.0012503,.983167,182383e-10,0,.0032745,.977908,218633e-10,0,.00646321,.971194,290662e-10,0,.0109133,.963867,386401e-10,0,.0166927,.95982,462827e-10,0,.0238494,.953497,420705e-10,0,.0324178,.947621,477743e-10,0,.0424225,.940611,568258e-10,0,.0538808,.931174,618061e-10,0,.0668047,.919919,627098e-10,0,.0812014,.907856,694714e-10,0,.0970745,.894509,735008e-10,0,.114424,.881954,763369e-10,0,.133246,.868309,821896e-10,0,.153534,.852511,83769e-9,0,.175275,.835821,881615e-10,0,.198453,.817981,896368e-10,0,.223042,.800504,930906e-10,0,.249009,.78141,945056e-10,0,.276304,.761427,963605e-10,0,.304862,.74094,968088e-10,0,.334584,.720233,981481e-10,0,.365322,.698592,979122e-10,0,.396826,.676763,981057e-10,0,.428571,.654808,973956e-10,0,.460318,.632326,962619e-10,0,.492064,.610049,952996e-10,0,.52381,.58763,933334e-10,0,.555556,.565261,917573e-10,0,.587302,.543244,896636e-10,0,.619048,.521273,873304e-10,0,.650794,.499818,852648e-10,0,.68254,.478536,823961e-10,0,.714286,.457826,79939e-9,0,.746032,.437549,77126e-9,0,.777778,.41776,743043e-10,0,.809524,.39863,716426e-10,0,.84127,.379954,686456e-10,0,.873016,.362025,660514e-10,0,.904762,.344581,630755e-10,0,.936508,.327909,605439e-10,0,.968254,.311736,576345e-10,0,1,1,263344e-13,0,0,1,263373e-13,0,0,1,263815e-13,0,0,1,265753e-13,0,0,1,271132e-13,0,0,.999999,283279e-13,0,0,.999997,30833e-12,0,0,.999995,358711e-13,0,0,.999992,461266e-13,0,0,.999985,67574e-12,0,0,.999977,11358e-11,0,0,.999966,213657e-12,0,0,.999948,431151e-12,0,0,.999923,896656e-12,0,0,.999884,186603e-11,0,0,.999826,381115e-11,0,0,.999732,754184e-11,0,0,.999561,143192e-10,0,0,.999191,257061e-10,0,0,.997955,405724e-10,0,744132e-10,.992228,276537e-10,0,716477e-9,.987638,208885e-10,0,.0022524,.983395,215226e-10,0,.00484816,.978614,270795e-10,0,.00860962,.972389,365282e-10,0,.0136083,.964392,474747e-10,0,.0198941,.95861,509141e-10,0,.0275023,.952806,48963e-9,0,.0364584,.94712,571119e-10,0,.04678,.940104,671704e-10,0,.0584799,.930398,687586e-10,0,.0715665,.919866,738161e-10,0,.086045,.907853,813235e-10,0,.101918,.894078,834582e-10,0,.119186,.881177,892093e-10,0,.137845,.867575,944548e-10,0,.157891,.852107,969607e-10,0,.179316,.835502,101456e-9,0,.202106,.81756,103256e-9,0,.226243,.79984,106954e-9,0,.251704,.780998,108066e-9,0,.278451,.761132,110111e-9,0,.306436,.740429,110459e-9,0,.335586,.719836,111219e-9,0,.365796,.698467,11145e-8,0,.3969,.676446,110393e-9,0,.428571,.654635,110035e-9,0,.460318,.632411,108548e-9,0,.492064,.609986,106963e-9,0,.52381,.587872,105238e-9,0,.555556,.565528,102665e-9,0,.587302,.543563,100543e-9,0,.619048,.52176,976182e-10,0,.650794,.500188,947099e-10,0,.68254,.479204,919929e-10,0,.714286,.458413,886139e-10,0,.746032,.438314,857839e-10,0,.777778,.418573,82411e-9,0,.809524,.39947,792211e-10,0,.84127,.380892,759546e-10,0,.873016,.362953,727571e-10,0,.904762,.345601,695738e-10,0,.936508,.328895,664907e-10,0,.968254,.312808,634277e-10,0,1,1,628647e-13,0,0,1,628705e-13,0,0,1,629587e-13,0,0,1,633441e-13,0,0,.999999,644087e-13,0,0,.999998,667856e-13,0,0,.999997,715889e-13,0,0,.999995,809577e-13,0,0,.999989,992764e-13,0,0,.999983,135834e-12,0,0,.999974,210482e-12,0,0,.999959,365215e-12,0,0,.999939,686693e-12,0,0,.999911,13472e-10,0,0,.999868,26731e-10,0,0,.999804,524756e-11,0,0,.9997,100403e-10,0,0,.99951,185019e-10,0,0,.999078,322036e-10,0,620676e-11,.997428,470002e-10,0,341552e-9,.99162,287123e-10,0,.00143727,.987479,234706e-10,0,.00349201,.983582,260083e-10,0,.0066242,.979186,337927e-10,0,.0109113,.97325,454689e-10,0,.0164064,.965221,573759e-10,0,.0231463,.957262,544114e-10,0,.0311571,.952211,587006e-10,0,.0404572,.946631,692256e-10,0,.0510592,.939391,787819e-10,0,.0629723,.929795,792368e-10,0,.0762025,.91965,875075e-10,0,.090753,.907737,950903e-10,0,.106626,.893899,972963e-10,0,.123822,.880239,10459e-8,0,.142337,.866562,107689e-9,0,.16217,.85164,113081e-9,0,.183314,.835021,116636e-9,0,.20576,.817311,120074e-9,0,.229496,.798845,121921e-9,0,.254502,.780479,12475e-8,0,.280753,.760694,125255e-9,0,.308212,.740142,126719e-9,0,.336825,.719248,12636e-8,0,.366517,.698209,126712e-9,0,.397167,.676398,125769e-9,0,.428578,.654378,124432e-9,0,.460318,.632484,123272e-9,0,.492064,.610113,12085e-8,0,.52381,.587931,118411e-9,0,.555556,.565872,11569e-8,0,.587302,.543814,112521e-9,0,.619048,.522265,109737e-9,0,.650794,.500835,106228e-9,0,.68254,.479818,102591e-9,0,.714286,.459258,991288e-10,0,.746032,.439061,952325e-10,0,.777778,.419552,91895e-9,0,.809524,.400399,879051e-10,0,.84127,.381976,844775e-10,0,.873016,.364009,806316e-10,0,.904762,.346761,771848e-10,0,.936508,.330049,735429e-10,0,.968254,.314018,702103e-10,0,1,1,139968e-12,0,0,1,139979e-12,0,0,1,140145e-12,0,0,1,14087e-11,0,0,.999999,142865e-12,0,0,.999998,147279e-12,0,0,.999997,156057e-12,0,0,.999992,17276e-11,0,0,.999989,204352e-12,0,0,.99998,26494e-11,0,0,.999969,383435e-12,0,0,.999953,618641e-12,0,0,.999929,108755e-11,0,0,.999898,201497e-11,0,0,.999849,381346e-11,0,0,.999778,719815e-11,0,0,.999661,133215e-10,0,0,.999451,238313e-10,0,0,.998936,401343e-10,0,113724e-9,.99662,517346e-10,0,820171e-9,.991094,304323e-10,0,.00238143,.987487,281757e-10,0,.00493527,.983731,320048e-10,0,.00856859,.979647,423905e-10,0,.0133393,.973837,562935e-10,0,.0192863,.96584,677442e-10,0,.0264369,.956309,623073e-10,0,.03481,.951523,704131e-10,0,.0444184,.946003,836594e-10,0,.0552713,.938454,911736e-10,0,.0673749,.929279,938264e-10,0,.0807329,.919239,103754e-9,0,.0953479,.907293,109928e-9,0,.111221,.893936,115257e-9,0,.128352,.879674,122265e-9,0,.14674,.865668,125733e-9,0,.166382,.850998,132305e-9,0,.187276,.834498,134844e-9,0,.209413,.816903,139276e-9,0,.232786,.798235,140984e-9,0,.257382,.779724,14378e-8,0,.283181,.760251,144623e-9,0,.310156,.739808,145228e-9,0,.338269,.718762,14539e-8,0,.367461,.697815,144432e-9,0,.397646,.67631,143893e-9,0,.428685,.654278,141846e-9,0,.460318,.632347,13935e-8,0,.492064,.610296,137138e-9,0,.52381,.588039,133806e-9,0,.555556,.566218,130755e-9,0,.587302,.544346,127128e-9,0,.619048,.522701,123002e-9,0,.650794,.501542,119443e-9,0,.68254,.480508,115055e-9,0,.714286,.460092,111032e-9,0,.746032,.440021,106635e-9,0,.777778,.420446,102162e-9,0,.809524,.401512,98184e-9,0,.84127,.38299,936497e-10,0,.873016,.365232,89813e-9,0,.904762,.347865,853073e-10,0,.936508,.331342,817068e-10,0,.968254,.315202,773818e-10,0,1,1,29368e-11,0,0,1,2937e-10,0,0,1,293998e-12,0,0,1,295298e-12,0,0,.999999,298865e-12,0,0,.999998,3067e-10,0,0,.999995,322082e-12,0,0,.999992,350767e-12,0,0,.999986,403538e-12,0,0,.999976,501372e-12,0,0,.999964,68562e-11,0,0,.999945,10374e-10,0,0,.999919,171269e-11,0,0,.999882,300175e-11,0,0,.999829,542144e-11,0,0,.999749,984182e-11,0,0,.99962,176213e-10,0,0,.999382,305995e-10,0,138418e-10,.998751,496686e-10,0,389844e-9,.995344,510733e-10,0,.00150343,.990768,345829e-10,0,.00352451,.987464,342841e-10,0,.00655379,.983846,399072e-10,0,.0106554,.980007,533219e-10,0,.0158723,.974494,696992e-10,0,.0222333,.96622,776754e-10,0,.029758,.956273,747718e-10,0,.0384596,.950952,864611e-10,0,.0483473,.945215,100464e-9,0,.0594266,.937287,103729e-9,0,.0717019,.928649,111665e-9,0,.0851752,.918791,12353e-8,0,.0998479,.906685,127115e-9,0,.115721,.893706,13628e-8,0,.132794,.879248,142427e-9,0,.151067,.864685,148091e-9,0,.170538,.850032,153517e-9,0,.191204,.833853,157322e-9,0,.213063,.816353,161086e-9,0,.236107,.797834,164111e-9,0,.260329,.778831,165446e-9,0,.285714,.759756,167492e-9,0,.312243,.739419,166928e-9,0,.339887,.718491,167e-6,0,.368604,.697392,165674e-9,0,.398329,.676102,163815e-9,0,.428961,.654243,162003e-9,0,.460331,.632176,158831e-9,0,.492064,.610407,155463e-9,0,.52381,.588394,152062e-9,0,.555556,.56645,147665e-9,0,.587302,.5449,14375e-8,0,.619048,.523276,138905e-9,0,.650794,.502179,134189e-9,0,.68254,.481359,129392e-9,0,.714286,.46092,124556e-9,0,.746032,.441084,11957e-8,0,.777778,.421517,114652e-9,0,.809524,.402721,109688e-9,0,.84127,.384222,104667e-9,0,.873016,.366534,999633e-10,0,.904762,.349205,950177e-10,0,.936508,.332702,907301e-10,0,.968254,.316599,859769e-10,0,1,1,585473e-12,0,0,1,585507e-12,0,0,1,58602e-11,0,0,.999999,588259e-12,0,0,.999999,594381e-12,0,0,.999998,607754e-12,0,0,.999995,633729e-12,0,0,.99999,68137e-11,0,0,.999984,767003e-12,0,0,.999973,921212e-12,0,0,.999959,120218e-11,0,0,.999936,172024e-11,0,0,.999907,268088e-11,0,0,.999866,445512e-11,0,0,.999806,768481e-11,0,0,.999716,1342e-8,0,0,.999576,232473e-10,0,0,.9993,391694e-10,0,129917e-9,.998498,608429e-10,0,845035e-9,.994132,489743e-10,0,.00237616,.99031,384644e-10,0,.00484456,.987409,421768e-10,0,.00832472,.983981,504854e-10,0,.0128643,.980268,671028e-10,0,.0184947,.974875,852749e-10,0,.025237,.966063,85531e-9,0,.0331046,.956779,900588e-10,0,.0421067,.950259,10577e-8,0,.0522487,.944239,119458e-9,0,.0635343,.936341,122164e-9,0,.0759654,.928047,134929e-9,0,.0895434,.918065,145544e-9,0,.104269,.906267,150531e-9,0,.120142,.893419,161652e-9,0,.137163,.878758,16593e-8,0,.15533,.863699,174014e-9,0,.174645,.848876,177877e-9,0,.195106,.833032,184049e-9,0,.21671,.815557,186088e-9,0,.239454,.797323,19054e-8,0,.263332,.778124,191765e-9,0,.288336,.758929,192535e-9,0,.314451,.738979,192688e-9,0,.341658,.718213,191522e-9,0,.369924,.696947,190491e-9,0,.399202,.675807,187913e-9,0,.429416,.654147,184451e-9,0,.460447,.63229,181442e-9,0,.492064,.610499,177139e-9,0,.523809,.588747,172596e-9,0,.555555,.566783,167457e-9,0,.587301,.545359,162518e-9,0,.619048,.523984,156818e-9,0,.650794,.502917,151884e-9,0,.68254,.482294,145514e-9,0,.714286,.461945,140199e-9,0,.746032,.442133,134101e-9,0,.777778,.422705,128374e-9,0,.809524,.403916,122996e-9,0,.84127,.38554,116808e-9,0,.873016,.367909,111973e-9,0,.904762,.350651,105938e-9,0,.936508,.334208,101355e-9,0,.968254,.318123,957629e-10,0,1,1,111633e-11,0,0,1,111639e-11,0,0,1,111725e-11,0,0,1,112096e-11,0,0,.999999,11311e-10,0,0,.999997,115315e-11,0,0,.999995,11956e-10,0,0,.999989,127239e-11,0,0,.999981,140772e-11,0,0,.999969,164541e-11,0,0,.999952,206607e-11,0,0,.999928,281783e-11,0,0,.999895,416835e-11,0,0,.999848,658728e-11,0,0,.999781,108648e-10,0,0,.999682,182579e-10,0,0,.999523,306003e-10,0,159122e-10,.999205,499862e-10,0,391184e-9,.998131,73306e-9,0,.00147534,.993334,513229e-10,0,.0034227,.99016,467783e-10,0,.00632232,.987321,523413e-10,0,.0102295,.984099,64267e-9,0,.0151794,.980432,843042e-10,0,.0211947,.974976,102819e-9,0,.0282899,.966429,996234e-10,0,.0364739,.957633,111074e-9,0,.0457522,.949422,128644e-9,0,.0561278,.943045,140076e-9,0,.0676023,.935448,146349e-9,0,.0801762,.927225,161854e-9,0,.0938499,.917033,169135e-9,0,.108623,.905762,179987e-9,0,.124496,.892879,189832e-9,0,.141469,.878435,195881e-9,0,.159541,.863114,20466e-8,0,.178713,.84776,209473e-9,0,.198985,.832084,214861e-9,0,.220355,.814915,217695e-9,0,.242823,.796711,220313e-9,0,.266385,.777603,22313e-8,0,.291036,.757991,222471e-9,0,.316767,.738371,222869e-9,0,.343563,.717872,221243e-9,0,.371402,.696619,218089e-9,0,.400248,.675379,21562e-8,0,.430047,.65411,21169e-8,0,.460709,.63241,206947e-9,0,.492079,.61046,201709e-9,0,.52381,.58903,196753e-9,0,.555556,.567267,189637e-9,0,.587302,.545886,184735e-9,0,.619048,.524714,177257e-9,0,.650794,.503789,171424e-9,0,.68254,.483204,164688e-9,0,.714286,.462976,157172e-9,0,.746032,.443294,151341e-9,0,.777778,.423988,143737e-9,0,.809524,.405325,138098e-9,0,.84127,.386981,130698e-9,0,.873016,.369436,125276e-9,0,.904762,.35219,118349e-9,0,.936508,.335804,11312e-8,0,.968254,.319749,106687e-9,0,1,1,204685e-11,0,0,1,204694e-11,0,0,1,204831e-11,0,0,.999999,205428e-11,0,0,.999999,207056e-11,0,0,.999997,210581e-11,0,0,.999993,21732e-10,0,0,.999987,229365e-11,0,0,.999979,250243e-11,0,0,.999965,286127e-11,0,0,.999947,348028e-11,0,0,.999918,455588e-11,0,0,.999881,643303e-11,0,0,.999828,970064e-11,0,0,.999753,153233e-10,0,0,.999642,24793e-9,0,0,.999464,402032e-10,0,122947e-9,.999089,635852e-10,0,807414e-9,.997567,857026e-10,0,.00227206,.992903,594912e-10,0,.00462812,.990011,578515e-10,0,.00794162,.987192,65399e-9,0,.0122534,.98418,819675e-10,0,.0175888,.980491,105514e-9,0,.0239635,.974779,121532e-9,0,.031387,.96675,119144e-9,0,.0398644,.958248,136125e-9,0,.0493982,.948884,155408e-9,0,.0599896,.941673,162281e-9,0,.0716382,.934521,176754e-9,0,.0843437,.926205,192873e-9,0,.0981056,.916089,200038e-9,0,.112923,.904963,213624e-9,0,.128796,.892089,221834e-9,0,.145725,.878028,232619e-9,0,.163709,.86249,238632e-9,0,.182749,.846587,247002e-9,0,.202847,.830988,250702e-9,0,.224001,.814165,255562e-9,0,.246214,.796135,257505e-9,0,.269482,.777052,258625e-9,0,.293805,.757201,258398e-9,0,.319176,.737655,256714e-9,0,.345587,.717477,255187e-9,0,.373021,.696433,251792e-9,0,.401454,.675084,247223e-9,0,.430844,.653907,242213e-9,0,.461125,.632561,237397e-9,0,.492187,.610658,229313e-9,0,.52381,.589322,224402e-9,0,.555556,.567857,216116e-9,0,.587302,.54652,209124e-9,0,.619048,.525433,201601e-9,0,.650794,.504679,192957e-9,0,.68254,.484203,186052e-9,0,.714286,.464203,177672e-9,0,.746032,.444549,170005e-9,0,.777778,.425346,162401e-9,0,.809524,.406706,1544e-7,0,.84127,.388576,147437e-9,0,.873016,.37094,139493e-9,0,.904762,.353996,133219e-9,0,.936508,.337391,125573e-9,0,.968254,.321648,119867e-9,0,1,1,362511e-11,0,0,1,362525e-11,0,0,1,362739e-11,0,0,.999999,363673e-11,0,0,.999998,366214e-11,0,0,.999996,371698e-11,0,0,.999992,382116e-11,0,0,.999986,400554e-11,0,0,.999976,432058e-11,0,0,.999961,485194e-11,0,0,.999938,574808e-11,0,0,.999908,726643e-11,0,0,.999865,984707e-11,0,0,.999807,142217e-10,0,0,.999723,215581e-10,0,0,.999602,336114e-10,0,119113e-10,.999398,527353e-10,0,355813e-9,.998946,805809e-10,0,.00137768,.996647,942908e-10,0,.00322469,.992298,668733e-10,0,.00597897,.989802,716564e-10,0,.00968903,.987019,821355e-10,0,.0143845,.984219,104555e-9,0,.0200831,.980425,131245e-9,0,.0267948,.974241,139613e-9,0,.034525,.967006,145931e-9,0,.0432757,.95893,167153e-9,0,.0530471,.949157,188146e-9,0,.0638386,.94062,194625e-9,0,.0756487,.933509,213721e-9,0,.0884762,.925088,229616e-9,0,.10232,.915178,239638e-9,0,.117178,.904093,254814e-9,0,.133051,.891337,263685e-9,0,.149939,.877326,274789e-9,0,.167841,.861794,280534e-9,0,.18676,.845758,289534e-9,0,.206696,.829792,294446e-9,0,.22765,.813037,296877e-9,0,.249625,.795285,300217e-9,0,.27262,.776323,299826e-9,0,.296636,.756673,299787e-9,0,.321671,.736856,297867e-9,0,.347718,.716883,294052e-9,0,.374768,.696089,289462e-9,0,.402804,.67505,285212e-9,0,.431796,.653509,27653e-8,0,.461695,.63258,271759e-9,0,.49242,.61104,262811e-9,0,.523822,.589567,255151e-9,0,.555556,.568322,246434e-9,0,.587302,.547235,237061e-9,0,.619048,.52616,228343e-9,0,.650794,.505716,219236e-9,0,.68254,.485274,209595e-9,0,.714286,.465411,201011e-9,0,.746032,.445854,19109e-8,0,.777778,.426911,182897e-9,0,.809524,.408222,173569e-9,0,.84127,.390307,165496e-9,0,.873016,.372624,156799e-9,0,.904762,.355804,14917e-8,0,.936508,.33924,140907e-9,0,.968254,.323534,134062e-9,0,1,1,622487e-11,0,0,1,62251e-10,0,0,1,622837e-11,0,0,.999999,624259e-11,0,0,.999998,628127e-11,0,0,.999996,636451e-11,0,0,.999991,65218e-10,0,0,.999984,679782e-11,0,0,.999973,726361e-11,0,0,.999955,803644e-11,0,0,.999931,931397e-11,0,0,.999896,114299e-10,0,0,.999847,149402e-10,0,0,.999784,207461e-10,0,0,.999692,302493e-10,0,0,.999554,454957e-10,0,997275e-10,.999326,690762e-10,0,724813e-9,.998757,101605e-9,0,.0020972,.995367,958745e-10,0,.00432324,.99209,832808e-10,0,.00746347,.989517,887601e-10,0,.0115534,.987008,10564e-8,0,.0166134,.98421,133179e-9,0,.0226552,.98021,161746e-9,0,.0296838,.973676,161821e-9,0,.0377016,.967052,178635e-9,0,.0467079,.959385,206765e-9,0,.0567013,.949461,22476e-8,0,.0676796,.939578,23574e-8,0,.0796403,.932416,25893e-8,0,.0925812,.923759,271228e-9,0,.106501,.914223,289165e-9,0,.121397,.902942,301156e-9,0,.13727,.890419,313852e-9,0,.15412,.876639,324408e-9,0,.171946,.861316,33249e-8,0,.190751,.84496,338497e-9,0,.210537,.828427,345861e-9,0,.231305,.811871,347863e-9,0,.253057,.794397,350225e-9,0,.275797,.775726,349915e-9,0,.299525,.75617,347297e-9,0,.324242,.736091,344232e-9,0,.349947,.716213,340835e-9,0,.376633,.695736,332369e-9,0,.404289,.674961,327943e-9,0,.432895,.653518,318533e-9,0,.462415,.632574,310391e-9,0,.492788,.61134,300755e-9,0,.523909,.590017,290506e-9,0,.555556,.568752,280446e-9,0,.587302,.548061,269902e-9,0,.619048,.52711,258815e-9,0,.650794,.506682,248481e-9,0,.68254,.486524,237141e-9,0,.714286,.466812,226872e-9,0,.746032,.44732,216037e-9,0,.777778,.428473,205629e-9,0,.809524,.409921,195691e-9,0,.84127,.392028,185457e-9,0,.873016,.374606,176436e-9,0,.904762,.357601,166508e-9,0,.936508,.341348,158385e-9,0,.968254,.32542,149203e-9,0,1,1,103967e-10,0,0,1,10397e-9,0,0,1,104019e-10,0,0,.999999,104231e-10,0,0,.999998,104806e-10,0,0,.999995,106042e-10,0,0,.999991,108366e-10,0,0,.999982,112415e-10,0,0,.999968,119174e-10,0,0,.99995,130227e-10,0,0,.999922,148176e-10,0,0,.999884,177303e-10,0,0,.99983,224564e-10,0,0,.999758,300966e-10,0,0,.999654,423193e-10,0,549083e-11,.999503,614848e-10,0,296087e-9,.999237,903576e-10,0,.00123144,.998491,1271e-7,0,.00295954,.994594,107754e-9,0,.00555829,.99178,103025e-9,0,.00907209,.989265,11154e-8,0,.0135257,.986998,136296e-9,0,.0189327,.984137,169154e-9,0,.0252993,.979798,196671e-9,0,.0326272,.97337,196678e-9,0,.0409157,.967239,223121e-9,0,.0501623,.959543,253809e-9,0,.0603638,.949466,265972e-9,0,.0715171,.939074,288372e-9,0,.0836187,.931118,310983e-9,0,.0966657,.922525,325561e-9,0,.110656,.912983,345725e-9,0,.125588,.901617,3556e-7,0,.141461,.889487,374012e-9,0,.158275,.875787,383445e-9,0,.176031,.860654,393972e-9,0,.19473,.844417,400311e-9,0,.214374,.82741,405004e-9,0,.234967,.810545,407378e-9,0,.256512,.793312,407351e-9,0,.279011,.774847,406563e-9,0,.302468,.755621,404903e-9,0,.326887,.735511,397486e-9,0,.352266,.715435,39357e-8,0,.378605,.695403,384739e-9,0,.405897,.674681,376108e-9,0,.43413,.65359,365997e-9,0,.463277,.632471,354957e-9,0,.493295,.61151,343593e-9,0,.524106,.59064,331841e-9,0,.555561,.569386,318891e-9,0,.587302,.548785,3072e-7,0,.619048,.528146,29361e-8,0,.650794,.507872,281709e-9,0,.68254,.487805,268627e-9,0,.714286,.468196,255887e-9,0,.746032,.448922,243997e-9,0,.777778,.430093,231662e-9,0,.809524,.411845,220339e-9,0,.84127,.393808,208694e-9,0,.873016,.376615,198045e-9,0,.904762,.359655,187375e-9,0,.936508,.343452,177371e-9,0,.968254,.32765,167525e-9,0,1,1,169351e-10,0,0,1,169356e-10,0,0,1,169427e-10,0,0,.999999,169736e-10,0,0,.999998,170575e-10,0,0,.999995,172372e-10,0,0,.99999,175739e-10,0,0,.999979,181568e-10,0,0,.999966,191206e-10,0,0,.999944,20677e-9,0,0,.999912,231644e-10,0,0,.999869,271268e-10,0,0,.999811,334272e-10,0,0,.99973,433979e-10,0,0,.999617,590083e-10,0,680315e-10,.999445,829497e-10,0,612796e-9,.999138,118019e-9,0,.00187408,.998095,156712e-9,0,.00395791,.993919,125054e-9,0,.00692144,.991333,126091e-9,0,.0107962,.989226,144912e-9,0,.0155986,.986954,175737e-9,0,.0213364,.983982,213883e-9,0,.0280114,.979128,234526e-9,0,.0356226,.973327,243725e-9,0,.0441668,.967416,2773e-7,0,.0536399,.959729,308799e-9,0,.0640376,.949758,322447e-9,0,.0753554,.939173,350021e-9,0,.0875893,.9296,370089e-9,0,.100736,.921181,391365e-9,0,.114793,.91164,413636e-9,0,.129759,.900435,427068e-9,0,.145632,.888183,441046e-9,0,.162412,.874772,454968e-9,0,.180101,.859566,461882e-9,0,.1987,.843579,471556e-9,0,.218213,.826453,474335e-9,0,.238641,.809164,477078e-9,0,.259989,.792179,47755e-8,0,.282262,.773866,472573e-9,0,.305464,.754944,469765e-9,0,.329599,.735133,462371e-9,0,.35467,.714858,453674e-9,0,.380678,.694829,443888e-9,0,.407622,.674453,432052e-9,0,.435493,.653685,420315e-9,0,.464275,.632666,406829e-9,0,.493938,.611676,392234e-9,0,.524422,.591193,379208e-9,0,.555624,.570145,36319e-8,0,.587302,.549566,349111e-9,0,.619048,.529278,334166e-9,0,.650794,.509026,318456e-9,0,.68254,.489186,30449e-8,0,.714286,.469662,289051e-9,0,.746032,.450691,275494e-9,0,.777778,.431841,261437e-9,0,.809524,.413752,247846e-9,0,.84127,.395951,235085e-9,0,.873016,.378633,222245e-9,0,.904762,.36194,210533e-9,0,.936508,.345599,198494e-9,0,.968254,.329999,188133e-9,0,1,1,269663e-10,0,0,1,26967e-9,0,0,1,269772e-10,0,0,.999999,270214e-10,0,0,.999998,271415e-10,0,0,.999994,27398e-9,0,0,.999988,278771e-10,0,0,.999977,287019e-10,0,0,.999961,300544e-10,0,0,.999937,322138e-10,0,0,.999904,356163e-10,0,0,.999854,409465e-10,0,0,.99979,492651e-10,0,0,.999699,621722e-10,0,88288e-11,.999572,819715e-10,0,223369e-9,.999381,111689e-9,0,.00105414,.999016,153862e-9,0,.0026493,.997437,187667e-9,0,.00508608,.993545,155672e-9,0,.00840554,.991135,161455e-9,0,.012629,.989157,188241e-9,0,.0177661,.986874,226229e-9,0,.0238198,.983714,268668e-9,0,.0307887,.978301,277109e-9,0,.0386688,.973227,303446e-9,0,.0474554,.967317,341851e-9,0,.0571428,.959477,370885e-9,0,.0677256,.950012,392753e-9,0,.0791988,.939484,42781e-8,0,.0915576,.928135,443866e-9,0,.104798,.919819,472959e-9,0,.118918,.910049,491551e-9,0,.133915,.899181,512616e-9,0,.149788,.886881,523563e-9,0,.166537,.87359,540183e-9,0,.184164,.858613,547386e-9,0,.202669,.842809,554809e-9,0,.222056,.825727,558316e-9,0,.242329,.808086,557824e-9,0,.263492,.790728,556346e-9,0,.285551,.772987,552672e-9,0,.30851,.7541,543738e-9,0,.332376,.734669,536107e-9,0,.357153,.714411,523342e-9,0,.382845,.694196,512238e-9,0,.409454,.674252,497465e-9,0,.436977,.65357,481096e-9,0,.465404,.632999,467054e-9,0,.494713,.611994,448771e-9,0,.524864,.591604,431889e-9,0,.555779,.571134,415238e-9,0,.587302,.550528,396369e-9,0,.619048,.530292,379477e-9,0,.650794,.510364,361488e-9,0,.68254,.490749,343787e-9,0,.714286,.471266,327822e-9,0,.746032,.452462,310626e-9,0,.777778,.433907,295352e-9,0,.809524,.415659,279179e-9,0,.84127,.398138,264685e-9,0,.873016,.380833,249905e-9,0,.904762,.364247,236282e-9,0,.936508,.348041,222905e-9,0,.968254,.332389,210522e-9,0,1,1,420604e-10,0,0,1,420614e-10,0,0,1,420757e-10,0,0,.999999,42138e-9,0,0,.999997,423067e-10,0,0,.999993,426668e-10,0,0,.999986,433372e-10,0,0,.999974,444857e-10,0,0,.999956,463554e-10,0,0,.99993,493105e-10,0,0,.999892,539077e-10,0,0,.999838,610005e-10,0,0,.999767,718822e-10,0,0,.999666,884581e-10,0,365471e-10,.999525,113398e-9,0,485623e-9,.999311,150043e-9,0,.00162096,.998865,200063e-9,0,.00355319,.996278,211014e-9,0,.00633818,.992956,189672e-9,0,.0100043,.991017,210262e-9,0,.0145648,.989055,244292e-9,0,.0200237,.986741,290481e-9,0,.0263798,.983288,334303e-9,0,.033629,.977784,340307e-9,0,.0417652,.973037,377864e-9,0,.0507821,.967181,4239e-7,0,.060673,.958971,443854e-9,0,.0714314,.950093,483039e-9,0,.0830518,.939552,517934e-9,0,.0955288,.927678,539449e-9,0,.108859,.918278,568604e-9,0,.123038,.908449,588505e-9,0,.138065,.897713,612473e-9,0,.153938,.885533,625575e-9,0,.170657,.872131,63854e-8,0,.188224,.857517,647034e-9,0,.20664,.841796,65209e-8,0,.225909,.824726,6544e-7,0,.246035,.807297,655744e-9,0,.267022,.789058,646716e-9,0,.288878,.77189,643898e-9,0,.311607,.753082,629973e-9,0,.335216,.7341,621564e-9,0,.359713,.714094,605171e-9,0,.385103,.693839,588752e-9,0,.41139,.673891,573294e-9,0,.438576,.653565,552682e-9,0,.466656,.633326,533446e-9,0,.495617,.612582,514635e-9,0,.525431,.59205,49303e-8,0,.556041,.571918,471842e-9,0,.587338,.551572,451713e-9,0,.619048,.531553,430049e-9,0,.650794,.51175,410445e-9,0,.68254,.49238,390098e-9,0,.714286,.473143,370033e-9,0,.746032,.45423,351205e-9,0,.777778,.435963,332049e-9,0,.809524,.41787,315021e-9,0,.84127,.400387,297315e-9,0,.873016,.383332,281385e-9,0,.904762,.366665,265397e-9,0,.936508,.350633,250601e-9,0,.968254,.334964,23589e-8,0,1,1,643736e-10,0,0,1,64375e-9,0,0,1,643947e-10,0,0,.999999,64481e-9,0,0,.999997,647143e-10,0,0,.999994,652119e-10,0,0,.999985,661359e-10,0,0,.999972,677116e-10,0,0,.999952,702599e-10,0,0,.999922,742517e-10,0,0,.99988,803906e-10,0,0,.99982,897315e-10,0,0,.999741,103838e-9,0,0,.999629,12496e-8,0,149024e-9,.999474,156161e-9,0,861027e-9,.999229,201034e-9,0,.00231198,.998662,259069e-9,0,.00458147,.995299,245439e-9,0,.00770895,.992732,24498e-8,0,.0117126,.990847,273211e-9,0,.0165989,.988911,316492e-9,0,.0223674,.98654,37161e-8,0,.0290135,.982636,410352e-9,0,.0365309,.977346,421756e-9,0,.0449117,.972909,475578e-9,0,.0541481,.966821,522482e-9,0,.0642326,.958686,545008e-9,0,.075158,.949754,589286e-9,0,.0869181,.939184,619995e-9,0,.0995074,.927505,654266e-9,0,.112922,.916606,682362e-9,0,.127157,.906707,704286e-9,0,.142212,.895937,725909e-9,0,.158085,.883913,743939e-9,0,.174776,.870642,755157e-9,0,.192287,.856241,764387e-9,0,.210619,.84069,771032e-9,0,.229775,.823728,765906e-9,0,.249761,.806481,767604e-9,0,.270582,.787924,754385e-9,0,.292243,.770588,749668e-9,0,.314753,.751991,731613e-9,0,.338118,.733407,717655e-9,0,.362347,.713688,700604e-9,0,.387447,.693595,678765e-9,0,.413424,.673426,657042e-9,0,.440284,.65359,635892e-9,0,.468027,.633576,611569e-9,0,.496645,.613144,586011e-9,0,.526122,.592711,563111e-9,0,.556417,.572722,537699e-9,0,.587451,.552762,512556e-9,0,.619048,.532985,489757e-9,0,.650794,.513219,464139e-9,0,.68254,.493992,442193e-9,0,.714286,.47509,418629e-9,0,.746032,.456287,397045e-9,0,.777778,.438152,375504e-9,0,.809524,.420294,35492e-8,0,.84127,.402749,335327e-9,0,.873016,.385879,316422e-9,0,.904762,.369352,298333e-9,0,.936508,.353301,281417e-9,0,.968254,.337781,265203e-9,0,1,1,968267e-10,0,0,1,968284e-10,0,0,1,968556e-10,0,0,.999999,969733e-10,0,0,.999997,972913e-10,0,0,.999993,979688e-10,0,0,.999984,992239e-10,0,0,.999969,101356e-9,0,0,.999946,104784e-9,0,0,.999913,110111e-9,0,0,.999868,118217e-9,0,0,.999801,130396e-9,0,0,.999712,148523e-9,0,124907e-10,.999589,175233e-9,0,355405e-9,.999416,213999e-9,0,.0013528,.999136,268529e-9,0,.00312557,.998367,333088e-9,0,.00573045,.994701,304757e-9,0,.00919397,.992497,318031e-9,0,.0135261,.990608,353863e-9,0,.0187278,.988715,409044e-9,0,.0247947,.986241,472967e-9,0,.0317196,.981696,495104e-9,0,.039494,.977097,532873e-9,0,.0481087,.972583,594447e-9,0,.0575549,.966142,636867e-9,0,.0678242,.95823,669899e-9,0,.0789089,.949677,719499e-9,0,.0908023,.939226,750584e-9,0,.103499,.927501,793183e-9,0,.116993,.915199,81995e-8,0,.131282,.90498,847654e-9,0,.146364,.894243,868929e-9,0,.162237,.882154,884278e-9,0,.178902,.869161,898108e-9,0,.196358,.854751,901254e-9,0,.21461,.839368,90679e-8,0,.23366,.822874,901541e-9,0,.253512,.805514,897297e-9,0,.274174,.78716,881856e-9,0,.29565,.769061,870032e-9,0,.31795,.751,851719e-9,0,.341081,.732614,830671e-9,0,.365053,.713171,806569e-9,0,.389874,.693472,78338e-8,0,.415553,.673528,756404e-9,0,.442098,.653397,726872e-9,0,.469512,.633781,700494e-9,0,.497794,.613877,67105e-8,0,.526935,.593506,640361e-9,0,.556908,.573667,613502e-9,0,.587657,.553932,583177e-9,0,.61906,.534345,554375e-9,0,.650794,.515042,527811e-9,0,.68254,.495674,499367e-9,0,.714286,.477132,47429e-8,0,.746032,.458609,447726e-9,0,.777778,.440354,424205e-9,0,.809524,.422765,399549e-9,0,.84127,.405472,378315e-9,0,.873016,.388482,355327e-9,0,.904762,.372191,336122e-9,0,.936508,.356099,315247e-9,0,.968254,.340737,29794e-8,0,1,1,143327e-9,0,0,1,14333e-8,0,0,1,143366e-9,0,0,.999999,143524e-9,0,0,.999996,143952e-9,0,0,.999991,144862e-9,0,0,.999981,146544e-9,0,0,.999966,149391e-9,0,0,.999941,153946e-9,0,0,.999905,160971e-9,0,0,.999852,171562e-9,0,0,.99978,18729e-8,0,0,.999681,210386e-9,0,826239e-10,.999546,243906e-9,0,664807e-9,.999352,291739e-9,0,.00196192,.999027,357419e-9,0,.00405941,.997886,422349e-9,0,.00699664,.99419,385008e-9,0,.0107896,.99214,409775e-9,0,.0154415,.990274,456418e-9,0,.0209488,.988455,527008e-9,0,.0273037,.985804,597685e-9,0,.0344969,.98103,613124e-9,0,.0425183,.976674,668321e-9,0,.0513575,.972021,736985e-9,0,.0610046,.965274,773789e-9,0,.0714508,.958046,830852e-9,0,.0826877,.949333,875766e-9,0,.0947085,.939135,917088e-9,0,.107507,.927119,952244e-9,0,.121078,.91469,990626e-9,0,.135419,.903006,.00101304,0,.150526,.892368,.00103834,0,.166399,.880231,.00105002,0,.183038,.867432,.00106331,0,.200443,.853208,.00106783,0,.218618,.837956,.00106458,0,.237566,.821772,.00105945,0,.257291,.804328,.00104685,0,.2778,.786465,.00103178,0,.2991,.768004,.00101077,0,.321199,.74972,985504e-9,0,.344106,.731682,962893e-9,0,.36783,.712813,932146e-9,0,.392383,.693139,89871e-8,0,.417774,.673566,869678e-9,0,.444013,.653483,835525e-9,0,.471107,.633891,799853e-9,0,.49906,.614433,766838e-9,0,.527869,.594586,732227e-9,0,.557517,.574769,696442e-9,0,.587966,.555149,663935e-9,0,.61913,.535898,629826e-9,0,.650794,.516753,596486e-9,0,.68254,.497816,567078e-9,0,.714286,.479034,534399e-9,0,.746032,.460975,507013e-9,0,.777778,.442935,477421e-9,0,.809524,.425263,451101e-9,0,.84127,.408248,424964e-9,0,.873016,.391339,39993e-8,0,.904762,.37513,377619e-9,0,.936508,.359172,354418e-9,0,.968254,.343876,334823e-9,0,1,1,209042e-9,0,0,1,209045e-9,0,0,1,209093e-9,0,0,.999999,209304e-9,0,0,.999996,209871e-9,0,0,.999991,211078e-9,0,0,.999979,213304e-9,0,0,.999963,217061e-9,0,0,.999933,223042e-9,0,0,.999894,232206e-9,0,0,.999837,245901e-9,0,0,.999756,266023e-9,0,102927e-11,.999648,295204e-9,0,233468e-9,.999499,336958e-9,0,.00108237,.999283,395563e-9,0,.00268832,.998896,473785e-9,0,.00511138,.997006,520008e-9,0,.00837705,.993819,497261e-9,0,.0124928,.991632,523722e-9,0,.0174561,.989875,587258e-9,0,.0232596,.988109,676329e-9,0,.0298932,.985155,747701e-9,0,.0373453,.980479,768803e-9,0,.0456045,.976271,841054e-9,0,.0546593,.971347,911469e-9,0,.0644994,.964528,953057e-9,0,.0751152,.957632,.00102221,0,.0864981,.948681,.00106122,0,.0986407,.938716,.00111857,0,.111537,.926629,.00114762,0,.125182,.914025,.00118995,0,.139571,.901026,.00121228,0,.154703,.890358,.00123946,0,.170576,.878283,.0012527,0,.18719,.865459,.00125536,0,.204547,.851407,.00126134,0,.222648,.836276,.00124759,0,.241498,.820436,.00124443,0,.261101,.803253,.00122071,0,.281465,.785562,.00120107,0,.302595,.76718,.00117762,0,.324501,.748551,.00114289,0,.347192,.730564,.00110872,0,.370679,.712253,.00107636,0,.394973,.692867,.00103646,0,.420085,.673695,996793e-9,0,.446027,.653912,95675e-8,0,.47281,.634129,916739e-9,0,.500441,.615004,874401e-9,0,.528921,.595587,833411e-9,0,.558244,.575965,794556e-9,0,.588384,.5566,75196e-8,0,.619281,.537428,716381e-9,0,.650795,.518623,676558e-9,0,.68254,.499964,64074e-8,0,.714286,.481356,605984e-9,0,.746032,.463279,570256e-9,0,.777778,.445673,540138e-9,0,.809524,.428032,507299e-9,0,.84127,.411112,479553e-9,0,.873016,.394444,450737e-9,0,.904762,.378247,424269e-9,0,.936508,.362415,399111e-9,0,.968254,.347103,375274e-9,0,1,1,300729e-9,0,0,1,300733e-9,0,0,1,300797e-9,0,0,.999998,301072e-9,0,0,.999996,301817e-9,0,0,.999989,303398e-9,0,0,.999977,306309e-9,0,0,.999958,311209e-9,0,0,.999927,318975e-9,0,0,.999884,330804e-9,0,0,.99982,34834e-8,0,0,.999733,373854e-9,0,326995e-10,.999613,410424e-9,0,477174e-9,.999447,462047e-9,0,.00161099,.999204,533322e-9,0,.00353153,.998725,624964e-9,0,.00627965,.995871,631786e-9,0,.0098693,.993194,632017e-9,0,.0143011,.991541,68923e-8,0,.019568,.989773,766892e-9,0,.0256593,.987647,863668e-9,0,.0325625,.984193,922089e-9,0,.0402647,.980016,970749e-9,0,.0487532,.975859,.00106027,0,.058016,.970514,.00112239,0,.0680419,.963625,.00117212,0,.0788208,.956959,.00125211,0,.0903439,.947956,.00129411,0,.102604,.93809,.00135879,0,.115594,.92659,.00139309,0,.129309,.913829,.00143253,0,.143745,.90005,.00145809,0,.158901,.888129,.0014748,0,.174774,.87607,.00148756,0,.191365,.863461,.00148714,0,.208674,.849594,.00148892,0,.226705,.834531,.00146496,0,.245461,.81903,.0014579,0,.264947,.802122,.00143039,0,.28517,.78445,.00139717,0,.306137,.766434,.00136312,0,.327857,.747816,.00132597,0,.350341,.729519,.00128323,0,.373598,.711454,.00123803,0,.397642,.692699,.00119097,0,.422485,.673723,.00114565,0,.448139,.654386,.00109552,0,.474619,.634673,.00104553,0,.501933,.615554,99985e-8,0,.530089,.596462,948207e-9,0,.559087,.577385,902299e-9,0,.588913,.558257,856448e-9,0,.619525,.5392,810395e-9,0,.650826,.520543,768558e-9,0,.68254,.502206,7239e-7,0,.714286,.48402,685794e-9,0,.746032,.465779,64471e-8,0,.777778,.448455,609583e-9,0,.809524,.431091,57227e-8,0,.84127,.414147,54042e-8,0,.873016,.39765,506545e-9,0,.904762,.381576,477635e-9,0,.936508,.365881,448446e-9,0,.968254,.350582,421424e-9,0,1,1,427144e-9,0,0,1,427151e-9,0,0,1,427232e-9,0,0,.999998,42759e-8,0,0,.999995,428555e-9,0,0,.999988,430603e-9,0,0,.999976,434368e-9,0,0,.999952,440688e-9,0,0,.999919,450667e-9,0,0,.999871,46578e-8,0,0,.999801,488024e-9,0,0,.999704,520092e-9,0,129791e-9,.999572,565553e-9,0,821056e-9,.999389,628906e-9,0,.00225241,.999114,714911e-9,0,.00449109,.998488,819218e-9,0,.00756249,.995234,80415e-8,0,.0114716,.993021,830181e-9,0,.0162131,.991407,902645e-9,0,.021776,.989625,996934e-9,0,.0281471,.987064,.00109707,0,.0353118,.983265,.00114353,0,.0432562,.979535,.0012272,0,.0519665,.975224,.00132642,0,.0614298,.969574,.00138092,0,.0716348,.963021,.00145896,0,.0825709,.956046,.00152834,0,.094229,.947136,.00158217,0,.106602,.937313,.0016347,0,.119682,.926073,.00168383,0,.133465,.913121,.00171627,0,.147947,.899165,.00174229,0,.163125,.885891,.00176137,0,.178998,.873783,.00176406,0,.195566,.861331,.00176156,0,.21283,.847569,.00175346,0,.230793,.832785,.00172753,0,.249459,.817442,.00170204,0,.268832,.800613,.00166576,0,.28892,.783597,.00162909,0,.30973,.76571,.0015826,0,.331271,.747021,.00153106,0,.353554,.728593,.00148036,0,.37659,.710661,.00142808,0,.400391,.692426,.00136906,0,.424973,.673623,.00131066,0,.450347,.65494,.00125569,0,.476531,.635448,.00119517,0,.503535,.616221,.00113828,0,.531372,.597531,.0010816,0,.560047,.578795,.00102673,0,.589554,.559892,970985e-9,0,.619869,.541307,919773e-9,0,.650923,.522608,868479e-9,0,.68254,.504484,82137e-8,0,.714286,.486603,772916e-9,0,.746032,.468802,730353e-9,0,.777778,.451172,684955e-9,0,.809524,.434348,647565e-9,0,.84127,.417445,605863e-9,0,.873016,.401077,571885e-9,0,.904762,.385039,536034e-9,0,.936508,.369483,504227e-9,0,.968254,.354272,473165e-9,0,1,1,599525e-9,0,0,1,599533e-9,0,0,1,599639e-9,0,0,.999998,600097e-9,0,0,.999994,601336e-9,0,0,.999987,603958e-9,0,0,.999972,608775e-9,0,0,.999949,616842e-9,0,0,.999912,629534e-9,0,0,.999857,648658e-9,0,0,.999781,676615e-9,0,538873e-11,.999674,716574e-9,0,308602e-9,.999528,772641e-9,0,.00127003,.999326,849806e-9,0,.00300783,.999009,952682e-9,0,.00556637,.998112,.00106394,0,.00895889,.994496,.00102228,0,.0131827,.992806,.00108586,0,.0182277,.991211,.0011759,0,.0240795,.989415,.00128955,0,.030723,.986499,.00139038,0,.0381418,.982679,.00144539,0,.046321,.978839,.00153954,0,.0552459,.974295,.00164417,0,.0649034,.968784,.00171517,0,.0752814,.962324,.00180282,0,.0863693,.954956,.00186387,0,.0981578,.94624,.00193817,0,.110639,.936517,.00198156,0,.123806,.925186,.00203042,0,.137655,.91252,.0020664,0,.15218,.898441,.00207822,0,.16738,.884394,.0020992,0,.183253,.871273,.00208748,0,.199799,.859057,.00208686,0,.21702,.845243,.00205519,0,.234918,.830723,.00202868,0,.253496,.815801,.00199501,0,.272761,.79914,.00194193,0,.292719,.782372,.00188824,0,.313377,.76482,.00183695,0,.334745,.746586,.00177418,0,.356833,.7281,.00170628,0,.379654,.709842,.00164063,0,.403221,.692019,.00157355,0,.427548,.67364,.00150262,0,.452651,.655277,.00143473,0,.478545,.636438,.00136371,0,.505246,.617364,.00129911,0,.532768,.598603,.00123014,0,.561122,.580195,.00116587,0,.590309,.561786,.00110398,0,.620318,.543377,.00104148,0,.651102,.525093,983984e-9,0,.682545,.506791,92667e-8,0,.714286,.489291,874326e-9,0,.746032,.471811,821734e-9,0,.777778,.454435,774698e-9,0,.809524,.437493,727302e-9,0,.84127,.420977,684039e-9,0,.873016,.404729,64373e-8,0,.904762,.388756,60285e-8,0,.936508,.373344,56765e-8,0,.968254,.358191,531929e-9,0,1,1,832169e-9,0,0,1,832178e-9,0,0,1,83231e-8,0,0,.999998,832893e-9,0,0,.999995,834465e-9,0,0,.999985,837791e-9,0,0,.999969,843893e-9,0,0,.999944,854086e-9,0,0,.999903,870071e-9,0,0,.999843,894042e-9,0,0,.999759,928865e-9,0,531805e-10,.999643,978242e-9,0,579365e-9,.99948,.00104684,0,.00182774,.999255,.00114012,0,.00387804,.998885,.00126188,0,.00675709,.997405,.00135888,0,.010468,.99424,.00133626,0,.0150018,.992458,.00140905,0,.0203443,.990929,.00152305,0,.0264786,.989116,.00165882,0,.0333875,.985624,.00174128,0,.0410536,.982003,.00182108,0,.0494609,.978336,.00194498,0,.0585941,.973184,.00202708,0,.0684396,.9678,.00212166,0,.0789851,.961348,.00221366,0,.0902199,.953841,.00228219,0,.102134,.94534,.00235662,0,.114721,.935552,.00240572,0,.127972,.924064,.00244405,0,.141884,.911827,.00247557,0,.156451,.897731,.00248374,0,.171672,.883409,.00249863,0,.187545,.868625,.00246688,0,.20407,.856529,.00246523,0,.221249,.842999,.00242368,0,.239083,.828505,.00237354,0,.257578,.813825,.00232588,0,.276738,.797813,.00226731,0,.296569,.781097,.00219704,0,.31708,.764038,.00212394,0,.338281,.746067,.00204786,0,.360181,.727687,.00196728,0,.382794,.709571,.00188779,0,.406133,.691503,.00180532,0,.430213,.673673,.00171849,0,.45505,.655732,.00164147,0,.480662,.637399,.00155858,0,.507065,.618616,.00147641,0,.534278,.60005,.00140125,0,.562313,.581713,.00132441,0,.59118,.563546,.00125014,0,.620875,.545605,.00118249,0,.651373,.527559,.0011116,0,.682593,.509764,.00104979,0,.714286,.49193,985977e-9,0,.746032,.475011,928592e-9,0,.777778,.457878,873466e-9,0,.809524,.440979,819585e-9,0,.84127,.424613,772365e-9,0,.873016,.408549,722195e-9,0,.904762,.392771,680014e-9,0,.936508,.377317,636797e-9,0,.968254,.362352,598318e-9,0,1,1,.00114313,0,0,1,.00114314,0,0,.999999,.00114331,0,0,.999998,.00114404,0,0,.999994,.00114601,0,0,.999984,.00115019,0,0,.999967,.00115784,0,0,.999937,.0011706,0,0,.999894,.00119054,0,0,.999828,.00122031,0,0,.999735,.00126331,0,169263e-9,.999606,.00132382,0,949167e-9,.999426,.0014071,0,.00249668,.999173,.00151895,0,.00486392,.99873,.00166102,0,.00806323,.996243,.0017023,0,.0120895,.993779,.00172782,0,.0169288,.9919,.0018108,0,.0225633,.990524,.00196028,0,.028974,.98868,.00212014,0,.036142,.984663,.00217598,0,.044049,.981457,.00230563,0,.0526781,.977608,.00243966,0,.0620137,.972215,.00251336,0,.0720418,.966798,.0026285,0,.0827499,.960241,.00271409,0,.0941271,.952489,.00278381,0,.106164,.944127,.00285399,0,.118852,.934282,.00290994,0,.132185,.923271,.00294558,0,.146157,.910803,.00296269,0,.160766,.896705,.00296803,0,.176007,.88238,.00296637,0,.19188,.867116,.00293163,0,.208385,.853636,.00289418,0,.225523,.840469,.00284663,0,.243296,.82639,.00278594,0,.261709,.811759,.00271618,0,.280767,.796113,.00263187,0,.300476,.779518,.00254589,0,.320845,.763142,.00246003,0,.341883,.745464,.00236529,0,.363601,.727491,.00226536,0,.386011,.709414,.00216375,0,.409128,.691396,.00207127,0,.432967,.67368,.00197106,0,.457545,.656049,.00187022,0,.482881,.638188,.00177605,0,.508992,.620177,.00168482,0,.535899,.601506,.00158909,0,.563619,.58362,.00150583,0,.592165,.565496,.00141791,0,.621544,.54789,.00133693,0,.651743,.530323,.00126038,0,.682709,.512795,.00118556,0,.714286,.495199,.00111527,0,.746032,.478101,.0010489,0,.777778,.461511,984264e-9,0,.809524,.444879,92591e-8,0,.84127,.428424,866582e-9,0,.873016,.412495,814463e-9,0,.904762,.396975,764498e-9,0,.936508,.381614,715967e-9,0,.968254,.366732,672483e-9,0,1,1,.00155501,0,0,1,.00155503,0,0,1,.00155524,0,0,.999998,.00155615,0,0,.999994,.0015586,0,0,.999983,.00156379,0,0,.999963,.0015733,0,0,.999932,.00158911,0,0,.999882,.00161376,0,0,.99981,.00165041,0,100875e-10,.999708,.00170304,0,367658e-9,.999565,.00177658,0,.0014234,.999368,.00187688,0,.00327939,.999081,.00200989,0,.00596629,.99852,.00217177,0,.0094852,.99549,.0021745,0,.013824,.993252,.00222357,0,.0189642,.991727,.00235022,0,.0248856,.989951,.00250561,0,.0315669,.988029,.00268829,0,.0389882,.984029,.0027496,0,.0471302,.980683,.00289793,0,.0559754,.976554,.00303315,0,.0655081,.97139,.00313257,0,.0757138,.965544,.00323656,0,.08658,.95912,.00333432,0,.0980954,.951183,.0034039,0,.110251,.942974,.00347515,0,.123038,.932642,.00350381,0,.13645,.922158,.00354519,0,.150482,.909404,.00353851,0,.165129,.896071,.0035435,0,.18039,.881206,.00349936,0,.196263,.866077,.00347256,0,.212748,.85093,.003415,0,.229847,.837703,.00333367,0,.247561,.823878,.003249,0,.265895,.809449,.00316347,0,.284854,.794379,.00306351,0,.304445,.778138,.0029499,0,.324675,.761997,.00284099,0,.345555,.744938,.00272104,0,.367095,.727212,.00260715,0,.389309,.709549,.00248855,0,.41221,.691704,.00236783,0,.435814,.673689,.00225178,0,.460138,.656453,.00213765,0,.485203,.639128,.00202178,0,.511028,.621512,.00191443,0,.537634,.603598,.00180977,0,.565041,.58559,.00170456,0,.593268,.567852,.00160927,0,.622327,.5503,.00151395,0,.652217,.533033,.00142499,0,.682907,.515942,.00133955,0,.714296,.498814,.0012602,0,.746032,.481595,.00118188,0,.777778,.465117,.00111171,0,.809524,.448865,.00104091,0,.84127,.432711,976618e-9,0,.873016,.416822,91859e-8,0,.904762,.401272,857704e-9,0,.936508,.386226,807172e-9,0,.968254,.371321,75464e-8,0,1,1,.00209596,0,0,1,.00209598,0,0,1,.00209624,0,0,.999997,.00209736,0,0,.999991,.00210039,0,0,.999979,.00210678,0,0,.999959,.00211847,0,0,.999925,.0021379,0,0,.99987,.00216809,0,0,.999791,.00221281,0,681487e-10,.999677,.00227669,0,658161e-9,.999521,.00236533,0,.00200635,.999301,.00248514,0,.0041779,.998977,.00264185,0,.00718648,.998191,.00281695,0,.0110239,.994801,.00278518,0,.015672,.993091,.00288774,0,.0211091,.991571,.00303931,0,.0273123,.9897,.00321643,0,.034259,.987023,.00337332,0,.0419282,.983289,.00346146,0,.0502998,.979892,.00363704,0,.0593562,.975111,.00373601,0,.069081,.970351,.0038842,0,.0794598,.964131,.00397053,0,.0904798,.957747,.00408078,0,.10213,.949536,.00413533,0,.1144,.941372,.00420305,0,.127284,.931049,.00422815,0,.140772,.920647,.00425048,0,.154862,.908033,.0042281,0,.169548,.895028,.00422026,0,.184828,.879968,.00415042,0,.200701,.864875,.00408821,0,.217167,.84918,.00400909,0,.234227,.834934,.00391178,0,.251884,.821397,.00380066,0,.270141,.807135,.00367974,0,.289004,.792363,.00355172,0,.308479,.776661,.003411,0,.328575,.760705,.00328123,0,.349301,.744408,.00314003,0,.370668,.726994,.0029906,0,.392689,.709598,.00285034,0,.415379,.692112,.00271179,0,.438754,.674435,.00257185,0,.46283,.65676,.00243425,0,.48763,.639982,.00230351,0,.513173,.622983,.0021777,0,.539482,.605471,.00204991,0,.566579,.58796,.00193759,0,.594488,.570463,.00181976,0,.623226,.553058,.00171497,0,.6528,.535894,.00161109,0,.683198,.519089,.00151394,0,.714354,.502454,.00142122,0,.746032,.485681,.00133488,0,.777778,.468935,.00124975,0,.809524,.452951,.00117309,0,.84127,.437139,.00110155,0,.873016,.421446,.00103124,0,.904762,.405951,966387e-9,0,.936508,.391003,908119e-9,0,.968254,.376198,848057e-9,0,1,1,.00280076,0,0,1,.00280078,0,0,.999999,.00280109,0,0,.999997,.00280246,0,0,.999992,.00280616,0,0,.999979,.00281396,0,0,.999956,.00282822,0,0,.999916,.00285186,0,0,.999857,.0028885,0,0,.999768,.00294259,0,196026e-9,.999645,.00301946,0,.00104842,.99947,.00312541,0,.00270199,.999229,.00326733,0,.00519449,.998852,.00344992,0,.00852602,.997558,.00361052,0,.0126804,.994417,.0035898,0,.017635,.992824,.00372393,0,.023365,.991344,.00390695,0,.0298456,.989337,.00410392,0,.0370529,.985811,.00420987,0,.0449651,.982772,.00437488,0,.0535615,.979001,.00455069,0,.0628243,.974102,.00464462,0,.0727368,.969197,.00480577,0,.0832844,.962759,.00487818,0,.0944545,.956207,.00498176,0,.106236,.947909,.00503392,0,.118619,.939596,.00507474,0,.131595,.929642,.00509798,0,.145159,.918807,.00508476,0,.159305,.906921,.00505634,0,.174028,.893312,.00498845,0,.189327,.878933,.0049133,0,.2052,.863986,.0048259,0,.221647,.847936,.00470848,0,.23867,.832253,.00456889,0,.25627,.818619,.00442726,0,.274453,.804788,.00427677,0,.293222,.790241,.00411906,0,.312585,.775162,.00394833,0,.33255,.759463,.00377366,0,.353126,.743598,.00361026,0,.374324,.72697,.00343627,0,.396158,.709646,.00326422,0,.418641,.69277,.00309717,0,.44179,.675371,.0029356,0,.465624,.657863,.00277712,0,.490163,.640772,.00261738,0,.515429,.624441,.0024737,0,.541445,.607497,.00233125,0,.568236,.590438,.00218994,0,.595828,.573224,.0020664,0,.624242,.556168,.00193526,0,.653496,.539232,.00182463,0,.683588,.522352,.00170735,0,.714482,.506172,.00160555,0,.746032,.489842,.00150451,0,.777778,.473463,.00140938,0,.809524,.457266,.00132568,0,.84127,.441609,.0012376,0,.873016,.426348,.00116265,0,.904762,.411002,.00108935,0,.936508,.396045,.00101946,0,.968254,.381448,955665e-9,0,1,1,.0037121,0,0,1,.00371213,0,0,1,.00371251,0,0,.999997,.00371417,0,0,.99999,.00371863,0,0,.999977,.00372807,0,0,.99995,.00374529,0,0,.999908,.0037738,0,0,.999843,.00381789,0,123596e-10,.999745,.00388273,0,407442e-9,.999608,.00397443,0,.0015447,.999415,.00409998,0,.00351385,.999143,.00426662,0,.0063316,.9987,.00447625,0,.00998679,.996363,.00455323,0,.0144569,.994021,.00461052,0,.0197151,.992372,.00476359,0,.0257344,.991007,.00499101,0,.0324882,.988767,.0051972,0,.0399517,.984872,.00528407,0,.0481022,.982004,.00548926,0,.0569191,.977714,.00564385,0,.0663839,.973076,.0057693,0,.0764801,.967565,.0058924,0,.0871928,.961384,.00599629,0,.0985095,.954435,.00605998,0,.110419,.946303,.0061133,0,.122912,.937662,.00612028,0,.13598,.927867,.00612209,0,.149617,.916475,.00604813,0,.163817,.90541,.00603088,0,.178577,.891591,.00592218,0,.193894,.877573,.00578854,0,.209767,.862511,.00566648,0,.226196,.846861,.00551481,0,.243182,.83068,.00533754,0,.260728,.815725,.00515487,0,.278837,.802321,.0049655,0,.297515,.787826,.00475421,0,.316768,.773454,.00456002,0,.336605,.758224,.00434727,0,.357034,.74265,.00414444,0,.378067,.726729,.00393738,0,.399717,.710155,.00373575,0,.421998,.693312,.00353736,0,.444928,.67653,.00334368,0,.468523,.659444,.00315981,0,.492806,.642051,.00297809,0,.517798,.625758,.00280592,0,.543525,.609615,.00264254,0,.570012,.592919,.00248459,0,.597288,.576298,.00233327,0,.625379,.559489,.00219519,0,.654307,.542891,.00205441,0,.684084,.526255,.00193385,0,.714693,.509853,.00180745,0,.746044,.494131,.00169817,0,.777778,.478114,.0015913,0,.809524,.462274,.00148981,0,.84127,.446412,.00139537,0,.873016,.431274,.00130984,0,.904762,.41635,.00122403,0,.936508,.401476,.00114809,0,.968254,.386993,.00107563,0,1,1,.00488216,0,0,1,.0048822,0,0,1,.00488265,0,0,.999997,.00488463,0,0,.999988,.00488999,0,0,.999974,.00490129,0,0,.999946,.00492191,0,0,.999897,.00495598,0,0,.999825,.00500855,0,744791e-10,.999718,.00508559,0,712744e-9,.999565,.005194,0,.00215249,.999352,.00534147,0,.00444576,.999046,.00553523,0,.00759218,.998492,.00577016,0,.0115714,.995564,.00578487,0,.0163557,.993339,.00586414,0,.021915,.991834,.00606002,0,.0282201,.990496,.00633312,0,.0352433,.987826,.00651941,0,.042959,.98383,.00660842,0,.0513439,.98109,.00685523,0,.0603772,.976131,.00695778,0,.0700402,.971922,.00714236,0,.0803163,.965901,.00721437,0,.0911908,.959606,.00732017,0,.102651,.952504,.00735788,0,.114686,.944365,.00738493,0,.127286,.935652,.00737969,0,.140443,.925813,.00733612,0,.154151,.914397,.00723094,0,.168405,.903257,.00714002,0,.183201,.890015,.00700149,0,.198536,.876014,.00682813,0,.214409,.861436,.00665567,0,.23082,.845752,.00644526,0,.24777,.829169,.00621635,0,.265263,.813435,.00597789,0,.283301,.799701,.00575694,0,.301889,.785726,.00549866,0,.321035,.77152,.0052503,0,.340746,.75683,.00499619,0,.361032,.741951,.0047543,0,.381904,.726367,.0045084,0,.403374,.710537,.00426784,0,.425457,.693965,.00403487,0,.448169,.677724,.0038075,0,.47153,.66117,.00359431,0,.495561,.644274,.00338354,0,.520284,.627449,.00318163,0,.545725,.611645,.00299672,0,.571911,.595614,.00281016,0,.598873,.579426,.00264252,0,.62664,.563016,.00247509,0,.655239,.546728,.00232647,0,.684692,.530539,.00217803,0,.714999,.514164,.00204216,0,.746106,.498344,.00191403,0,.777778,.482957,.00179203,0,.809524,.467336,.00167695,0,.84127,.451994,.00157567,0,.873016,.436514,.00147113,0,.904762,.42178,.00138034,0,.936508,.407271,.00129219,0,.968254,.392822,.0012098,0,1,1,.00637427,0,0,1,.00637431,0,0,.999999,.00637485,0,0,.999996,.00637721,0,0,.999987,.00638357,0,0,.999971,.006397,0,0,.999939,.00642142,0,0,.999888,.00646177,0,0,.999807,.00652387,0,207916e-9,.999689,.00661454,0,.00112051,.99952,.00674155,0,.00287719,.999283,.00691313,0,.00550145,.998936,.00713598,0,.00897928,.998165,.00738501,0,.0132829,.994847,.00734388,0,.01838,.993182,.00749991,0,.0242381,.991665,.0077246,0,.030826,.989708,.00797579,0,.0381152,.986663,.00813011,0,.0460794,.983288,.00830365,0,.0546951,.980104,.00853496,0,.0639411,.974855,.00861045,0,.0737988,.97045,.00879133,0,.0842516,.964509,.00886377,0,.0952848,.957594,.00890346,0,.106886,.950546,.00893289,0,.119044,.942225,.00890074,0,.131749,.933365,.00886826,0,.144994,.923202,.0087316,0,.158772,.912605,.00863082,0,.173078,.901099,.00847403,0,.187908,.888177,.00825838,0,.203261,.873955,.00801834,0,.219134,.860091,.00779026,0,.235527,.84434,.00752478,0,.252443,.828517,.00724074,0,.269883,.81239,.00693769,0,.287851,.79721,.00664817,0,.306352,.783489,.00634763,0,.325393,.769514,.00604221,0,.344981,.755419,.00573568,0,.365126,.741083,.00544359,0,.385839,.726059,.00515515,0,.407132,.710809,.00487139,0,.42902,.695052,.00459846,0,.45152,.678886,.00433412,0,.474651,.663042,.00407981,0,.498433,.646634,.00384264,0,.52289,.630117,.00360897,0,.548048,.613804,.00338863,0,.573936,.598338,.00318486,0,.600584,.582687,.00298377,0,.628027,.566809,.00280082,0,.656295,.550817,.00262255,0,.685417,.534937,.00245835,0,.715406,.519151,.00230574,0,.74624,.503118,.0021549,0,.777778,.487723,.00202008,0,.809524,.472725,.00189355,0,.84127,.457599,.00177108,0,.873016,.442558,.00165843,0,.904762,.427624,.00155494,0,.936508,.413171,.00145273,0,.968254,.399122,.00136454,0,1,1,.00826496,0,0,1,.00826499,0,0,1,.00826564,0,0,.999996,.00826842,0,0,.999987,.00827589,0,0,.999967,.00829167,0,0,.999933,.00832037,0,0,.999876,.00836768,0,109338e-10,.999786,.00844031,0,427145e-9,.999655,.00854603,0,.0016384,.999468,.00869337,0,.00372392,.999203,.008891,0,.00668513,.998803,.00914387,0,.0104968,.99748,.00935838,0,.015125,.994446,.00933309,0,.0205338,.99292,.00953084,0,.0266884,.991414,.0097893,0,.0335565,.989049,.0100228,0,.0411086,.98582,.0101664,0,.0493181,.982441,.0103582,0,.0581613,.978595,.0105292,0,.0676169,.973495,.0106274,0,.0776661,.968405,.0107261,0,.0882926,.962717,.0108234,0,.0994817,.955478,.0108102,0,.111221,.948275,.0107914,0,.123499,.940006,.0107161,0,.136308,.930831,.0106309,0,.149639,.920648,.0104083,0,.163485,.910205,.0102312,0,.177843,.898445,.0100051,0,.192707,.885986,.00971928,0,.208077,.872204,.00940747,0,.22395,.858436,.0091085,0,.240326,.843454,.00876595,0,.257208,.827437,.00839794,0,.274596,.811488,.00803692,0,.292496,.796039,.00767352,0,.310911,.781083,.0073097,0,.329849,.767642,.00694032,0,.349316,.753901,.00657476,0,.369323,.740131,.00622699,0,.38988,.725845,.0058838,0,.410999,.710991,.00555586,0,.432696,.696002,.00523089,0,.454987,.680461,.00492494,0,.47789,.664875,.00463464,0,.501426,.649273,.00435422,0,.52562,.63302,.0040875,0,.550498,.61705,.00384075,0,.576089,.601154,.00359557,0,.602427,.586008,.00337636,0,.629544,.570699,.00316019,0,.657479,.555166,.00296033,0,.686264,.539645,.00277552,0,.715924,.524159,.00259499,0,.746459,.508682,.00243257,0,.777789,.493163,.00227851,0,.809524,.478004,.00213083,0,.84127,.46347,.00199502,0,.873016,.448778,.00186967,0,.904762,.434105,.00174732,0,.936508,.419576,.00163861,0,.968254,.405541,.00153341,0,1,1,.0106462,0,0,1,.0106462,0,0,.999999,.010647,0,0,.999995,.0106502,0,0,.999985,.0106589,0,0,.999964,.0106773,0,0,.999925,.0107106,0,0,.999861,.0107655,0,712986e-10,.999763,.0108497,0,743959e-9,.999616,.0109716,0,.00227361,.999408,.0111408,0,.0046983,.999112,.0113659,0,.00800158,.998637,.0116475,0,.0121493,.996223,.0117231,0,.0171023,.994006,.0118064,0,.0228218,.992444,.0120254,0,.0292711,.991028,.0123314,0,.036417,.98803,.0124954,0,.0442295,.984816,.0126538,0,.0526815,.981399,.0128537,0,.0617492,.977085,.0129694,0,.0714114,.972154,.013091,0,.0816495,.966617,.0131166,0,.0924472,.960628,.0131583,0,.10379,.953295,.0131094,0,.115665,.94575,.0129966,0,.128062,.937654,.0128796,0,.140972,.927716,.0126477,0,.154387,.917932,.0123889,0,.168301,.907719,.012131,0,.182709,.89584,.0118013,0,.197608,.883526,.0114145,0,.212994,.870301,.0110075,0,.228867,.856272,.0106019,0,.245227,.842251,.0101938,0,.262074,.826466,.00973254,0,.279412,.810859,.0092846,0,.297244,.795051,.00883304,0,.315575,.780053,.00840272,0,.334412,.76575,.00796438,0,.35376,.752298,.00752526,0,.373631,.739153,.00711486,0,.394034,.725514,.00670361,0,.414983,.711473,.00632656,0,.436491,.696936,.00595206,0,.458575,.682126,.00559191,0,.481253,.667027,.00525362,0,.504547,.651875,.00493805,0,.528481,.636463,.00462848,0,.553081,.620641,.00433936,0,.578377,.604931,.00407,0,.604404,.589549,.00380864,0,.631197,.574712,.00357049,0,.658795,.559775,.00334466,0,.687238,.544514,.00312505,0,.716559,.529555,.00293199,0,.746776,.514402,.00274204,0,.777849,.499302,.00256647,0,.809524,.484114,.00239901,0,.84127,.469308,.00225148,0,.873016,.455133,.00210178,0,.904762,.440939,.0019727,0,.936508,.426627,.00184382,0,.968254,.412509,.00172548,0,1,1,.013628,0,0,1,.0136281,0,0,.999999,.0136289,0,0,.999995,.0136327,0,0,.999983,.0136427,0,0,.99996,.0136638,0,0,.999917,.0137022,0,0,.999846,.0137652,0,204597e-9,.999736,.0138615,0,.00116837,.999573,.0140007,0,.00303325,.99934,.0141927,0,.00580613,.999004,.0144457,0,.00945626,.998407,.0147489,0,.0139421,.995464,.014731,0,.0192202,.993328,.0148283,0,.0252495,.991799,.0150797,0,.0319921,.990397,.0154316,0,.0394138,.986835,.0155005,0,.0474843,.983938,.0157308,0,.0561763,.980154,.0158753,0,.0654661,.975659,.0159581,0,.0753326,.970171,.0159832,0,.0857571,.964803,.0160084,0,.0967236,.958366,.0159484,0,.108218,.950613,.0158001,0,.120227,.942874,.0155845,0,.132741,.935005,.0154292,0,.145751,.924991,.0150742,0,.159249,.914814,.0146757,0,.17323,.904743,.0143097,0,.187687,.893216,.0138695,0,.202619,.880769,.0133706,0,.218021,.868136,.0128606,0,.233894,.85469,.0123403,0,.250238,.840593,.0118091,0,.267052,.825808,.011253,0,.284341,.81009,.0107099,0,.302106,.79504,.0101636,0,.320354,.779757,.00964041,0,.33909,.764697,.00911896,0,.358322,.750913,.00859533,0,.378059,.738175,.00811592,0,.398311,.725242,.00764504,0,.41909,.711864,.00718885,0,.440412,.698009,.00675843,0,.462292,.683841,.00634984,0,.484748,.669391,.00595502,0,.507802,.654731,.00558671,0,.531477,.639805,.00523578,0,.555802,.624789,.00490834,0,.580805,.609325,.00459448,0,.606522,.593975,.00430342,0,.63299,.578983,.00403019,0,.66025,.564442,.0037707,0,.688346,.549835,.0035316,0,.717319,.535039,.00330255,0,.7472,.520403,.00308932,0,.777982,.505687,.00289335,0,.809524,.490939,.00270818,0,.84127,.476233,.0025343,0,.873016,.461624,.00237097,0,.904762,.447833,.00222065,0,.936508,.433992,.00207561,0,.968254,.420147,.00194955,0,1,1,.0173415,0,0,1,.0173416,0,0,.999999,.0173426,0,0,.999995,.0173468,0,0,.999983,.0173582,0,0,.999954,.0173822,0,0,.999908,.0174258,0,669501e-11,.999828,.0174973,0,427399e-9,.999705,.0176063,0,.00171019,.999524,.0177631,0,.0039248,.999263,.0179781,0,.00705382,.998878,.018258,0,.0110552,.998012,.0185551,0,.0158812,.994614,.0184264,0,.0214852,.993132,.0186385,0,.0278239,.991563,.0189067,0,.0348585,.989298,.0191577,0,.0425544,.986036,.0192522,0,.050881,.982558,.0194063,0,.059811,.978531,.019486,0,.0693209,.974198,.0195847,0,.0793895,.968148,.0194749,0,.0899984,.962565,.0194277,0,.101132,.956041,.0192991,0,.112775,.947749,.0189893,0,.124917,.94018,.018704,0,.137547,.93165,.0183458,0,.150655,.921798,.0178775,0,.164236,.911573,.0173618,0,.178281,.901569,.0168482,0,.192788,.890341,.016265,0,.207752,.877835,.0156199,0,.223171,.865472,.0149516,0,.239044,.852905,.0143274,0,.255371,.838906,.0136643,0,.272153,.824888,.0129903,0,.289393,.809977,.0123218,0,.307093,.794697,.0116572,0,.325259,.780028,.0110307,0,.343896,.765124,.0104236,0,.363012,.750411,.0098219,0,.382617,.737264,.00924397,0,.402719,.724799,.00868719,0,.423332,.712253,.00816476,0,.444469,.699267,.00767262,0,.466146,.685618,.00719746,0,.488383,.671736,.00673916,0,.511199,.657777,.00631937,0,.534618,.643497,.00592411,0,.558668,.62889,.00553928,0,.58338,.614299,.0051934,0,.608787,.599197,.00485985,0,.634929,.584175,.00454357,0,.661849,.569541,.00425787,0,.689594,.555193,.00397905,0,.718211,.540947,.00372364,0,.747742,.526593,.00348599,0,.778205,.512335,.00326103,0,.80953,.498017,.00305137,0,.84127,.483609,.00285485,0,.873016,.469368,.00267472,0,.904762,.455037,.00249945,0,.936508,.441493,.00234792,0,.968254,.428147,.00219936,0,1,1,.0219422,0,0,1,.0219423,0,0,.999998,.0219434,0,0,.999993,.0219481,0,0,.999981,.021961,0,0,.999949,.0219879,0,0,.999896,.0220367,0,593194e-10,.999808,.0221167,0,75364e-8,.99967,.0222383,0,.00237884,.999466,.0224125,0,.00495612,.999174,.0226495,0,.00844887,.998725,.0229525,0,.0128058,.996979,.0231123,0,.0179742,.994317,.0230742,0,.0239047,.992781,.0232895,0,.0305526,.991191,.0235734,0,.0378786,.987787,.0236152,0,.0458475,.985092,.0237994,0,.0544287,.981121,.0238553,0,.0635952,.976924,.0238706,0,.0733233,.97218,.0238704,0,.0835922,.965956,.0236598,0,.0943839,.959998,.0234735,0,.105682,.953245,.0232277,0,.117474,.944445,.0226973,0,.129747,.937087,.0223527,0,.142491,.928341,.0218144,0,.155697,.9184,.0211516,0,.169358,.907959,.0204553,0,.183469,.89808,.0197673,0,.198024,.887047,.0189915,0,.21302,.875221,.0182082,0,.228455,.86269,.0173584,0,.244329,.850735,.0165718,0,.260639,.837545,.0157524,0,.277389,.823639,.0149482,0,.29458,.809699,.0141431,0,.312216,.794797,.0133527,0,.3303,.780578,.0126193,0,.34884,.766019,.0118914,0,.367842,.751447,.0111839,0,.387315,.737275,.010514,0,.40727,.724545,.00987277,0,.427717,.712644,.00926569,0,.448671,.700432,.00869029,0,.470149,.687664,.00814691,0,.492167,.674288,.00763012,0,.514746,.660966,.00714437,0,.537911,.647264,.00668457,0,.561688,.633431,.00626581,0,.586108,.619133,.00585593,0,.611206,.604935,.00548188,0,.637022,.590236,.00513288,0,.663599,.575473,.0047906,0,.690989,.561228,.00448895,0,.719242,.547054,.00420233,0,.748411,.533175,.00392869,0,.778531,.519163,.00367445,0,.809583,.505328,.00344097,0,.84127,.491446,.00322003,0,.873016,.477356,.00301283,0,.904762,.46356,.00282592,0,.936508,.449623,.00264956,0,.968254,.436068,.00246956,0,1,1,.0276135,0,0,1,.0276136,0,0,.999998,.0276148,0,0,.999993,.0276201,0,0,.999976,.0276342,0,0,.999945,.027664,0,0,.999884,.0277179,0,18679e-8,.999784,.027806,0,.00119607,.99963,.0279394,0,.00318407,.999401,.0281295,0,.00613601,.999066,.0283858,0,.00999963,.998524,.0287027,0,.0147164,.995702,.0286256,0,.0202295,.993593,.0286733,0,.0264876,.992067,.0288989,0,.0334452,.990548,.0292135,0,.0410621,.986775,.0291296,0,.0493032,.984054,.0293099,0,.0581381,.979481,.0291881,0,.0675397,.975297,.0291598,0,.0774848,.96981,.028954,0,.0879528,.963524,.028628,0,.0989258,.957398,.0283135,0,.110388,.950088,.0278469,0,.122327,.941538,.0271798,0,.134729,.933332,.0265388,0,.147587,.924392,.0257776,0,.160889,.914581,.024916,0,.174631,.904347,.0240242,0,.188806,.894324,.0231229,0,.203409,.883724,.022153,0,.218437,.872207,.0211355,0,.233888,.859927,.0201048,0,.249761,.848373,.0191263,0,.266056,.836023,.0181306,0,.282774,.82289,.0171718,0,.299917,.809324,.0162196,0,.317488,.795361,.0152622,0,.335493,.781253,.01439,0,.353936,.767338,.013533,0,.372825,.753156,.0127244,0,.392168,.739122,.0119454,0,.411976,.725358,.0112054,0,.432259,.712949,.010487,0,.453032,.701621,.00984032,0,.47431,.689703,.00921495,0,.496111,.677216,.00862492,0,.518456,.664217,.00806882,0,.541367,.65137,.00755922,0,.564872,.638,.00705705,0,.589001,.62453,.00661266,0,.613789,.610601,.00618432,0,.639277,.59676,.00578033,0,.66551,.582433,.00540927,0,.692539,.568026,.00506104,0,.720422,.55414,.0047353,0,.749216,.540178,.00442889,0,.778974,.526513,.00414363,0,.809711,.512954,.00388237,0,.84127,.499403,.00362875,0,.873016,.486026,.00340827,0,.904762,.472345,.00318598,0,.936508,.458828,.00297635,0,.968254,.445379,.00279447,0,1,1,.0345716,0,0,1,.0345717,0,0,.999999,.034573,0,0,.999991,.0345787,0,0,.999974,.0345941,0,0,.999937,.0346263,0,188589e-11,.999869,.0346847,0,409238e-9,.999757,.0347798,0,.0017674,.999582,.0349233,0,.00413658,.999322,.0351265,0,.00747408,.998939,.0353967,0,.0117157,.998219,.0357018,0,.0167966,.994974,.0354726,0,.0226572,.993201,.0355621,0,.0292445,.991573,.0357641,0,.0365123,.989301,.0359252,0,.0444203,.985712,.0358017,0,.0529334,.982411,.0358353,0,.0620214,.977827,.035617,0,.0716574,.973278,.0354398,0,.0818186,.967397,.0350483,0,.0924846,.960696,.0344795,0,.103638,.954349,.0339861,0,.115263,.946066,.0331323,0,.127348,.938012,.032359,0,.13988,.929413,.0314413,0,.152849,.920355,.0304103,0,.166248,.910586,.0292785,0,.18007,.900609,.0281391,0,.194308,.890093,.0269103,0,.208958,.880013,.0257269,0,.224018,.869001,.0244671,0,.239485,.85751,.0232252,0,.255359,.84582,.0220117,0,.271638,.834383,.0208274,0,.288324,.822158,.0196628,0,.305419,.809056,.0185306,0,.322927,.795832,.0174174,0,.340851,.782547,.0163758,0,.359199,.7689,.015391,0,.377975,.755526,.0144488,0,.397189,.741681,.0135372,0,.416851,.728178,.0126957,0,.436971,.714642,.0118812,0,.457564,.702756,.0111165,0,.478644,.69175,.0104145,0,.500229,.680159,.00974439,0,.522339,.668073,.00911926,0,.544997,.655405,.00851393,0,.56823,.642921,.00797637,0,.592068,.629993,.00745119,0,.616546,.616828,.00696972,0,.641705,.603305,.00652425,0,.66759,.589833,.00610188,0,.694255,.575945,.00570834,0,.72176,.561745,.00533384,0,.750168,.548277,.00500001,0,.779545,.534467,.00467582,0,.809933,.521032,.00438092,0,.841272,.507877,.00410348,0,.873016,.494654,.00383618,0,.904762,.481592,.00358699,0,.936508,.468509,.00337281,0,.968254,.455293,.00316196,0,1,1,.0430698,0,0,1,.0430699,0,0,.999998,.0430713,0,0,.999991,.0430773,0,0,.99997,.0430936,0,0,.999928,.0431277,0,406396e-10,.999852,.0431893,0,744376e-9,.999724,.0432895,0,.0024806,.999527,.0434397,0,.00524779,.99923,.0436507,0,.00898164,.998783,.0439255,0,.0136083,.997507,.0441104,0,.0190582,.994418,.0438225,0,.0252694,.992864,.0439396,0,.0321879,.991127,.0440962,0,.039767,.987331,.0438408,0,.0479667,.984819,.0438991,0,.056752,.980384,.0435906,0,.0660929,.975846,.0432543,0,.075963,.970748,.0428293,0,.0863398,.964303,.042153,0,.0972035,.95772,.0414111,0,.108537,.950747,.0405893,0,.120325,.942533,.0394887,0,.132554,.934045,.0383544,0,.145215,.924942,.037057,0,.158296,.915811,.0356993,0,.17179,.90612,.0342401,0,.185691,.896434,.0328078,0,.199993,.886021,.031288,0,.214691,.876081,.0297776,0,.229782,.865608,.0282334,0,.245265,.854924,.026749,0,.261138,.843607,.02526,0,.277401,.832456,.0238214,0,.294056,.821342,.0224682,0,.311104,.809303,.0211297,0,.328548,.796468,.0198387,0,.346394,.784046,.0186227,0,.364645,.771262,.0174561,0,.38331,.758118,.0163806,0,.402396,.745075,.0153287,0,.421912,.731926,.0143647,0,.44187,.71863,.0134363,0,.462283,.705414,.0125603,0,.483165,.693792,.0117508,0,.504535,.683108,.0110016,0,.52641,.67183,.0102757,0,.548816,.66015,.00962044,0,.571776,.647907,.00898031,0,.595323,.635734,.00840811,0,.619489,.623208,.00786211,0,.644317,.610438,.00734953,0,.669852,.597345,.00687688,0,.696148,.584138,.00643469,0,.723267,.5707,.00602236,0,.75128,.556966,.0056324,0,.780258,.543607,.00528277,0,.810268,.530213,.00493999,0,.841311,.516912,.00462265,0,.873016,.503916,.0043307,0,.904762,.491146,.00406858,0,.936508,.478439,.00381436,0,.968254,.465834,.00358003,0,1,1,.0534039,0,0,1,.053404,0,0,.999998,.0534055,0,0,.999989,.0534116,0,0,.999968,.0534283,0,0,.999918,.0534633,0,155895e-9,.99983,.0535262,0,.00120914,.999685,.0536281,0,.00334944,.999461,.0537799,0,.00653077,.999119,.0539902,0,.0106718,.998582,.0542524,0,.0156907,.995919,.0540318,0,.0215147,.993735,.0538914,0,.0280801,.992126,.0539557,0,.0353323,.990266,.0540401,0,.0432247,.986317,.0536064,0,.0517172,.983213,.0534425,0,.0607754,.978303,.0528622,0,.0703698,.973665,.0523363,0,.0804742,.968091,.0516165,0,.0910667,.961026,.0505434,0,.102128,.954333,.049523,0,.113641,.946372,.0481698,0,.125591,.938254,.0467674,0,.137965,.929516,.0452341,0,.150754,.920106,.0435083,0,.163947,.910899,.0417399,0,.177537,.901532,.0399389,0,.191516,.891919,.0380901,0,.205881,.882006,.0362341,0,.220626,.871965,.0343444,0,.235749,.862145,.0324832,0,.251248,.852058,.0306681,0,.267121,.84161,.0289097,0,.283368,.830806,.0272079,0,.299992,.820476,.0256089,0,.316992,.809514,.0240394,0,.334374,.797865,.0225379,0,.35214,.785621,.0211235,0,.370296,.773765,.0197908,0,.388849,.761629,.0185235,0,.407807,.748891,.0173358,0,.427178,.736437,.0162305,0,.446974,.723707,.0151778,0,.467207,.710606,.0141791,0,.487892,.698019,.0132592,0,.509046,.686203,.0123887,0,.530687,.675692,.0115976,0,.552839,.664826,.0108325,0,.575527,.65349,.0101348,0,.59878,.641774,.00947756,0,.622634,.629794,.00886058,0,.647128,.617647,.00828526,0,.672308,.60534,.00775312,0,.698231,.592718,.00726033,0,.724958,.579746,.00679731,0,.752563,.566763,.00636111,0,.781127,.553515,.00595228,0,.810733,.540118,.00556876,0,.841426,.527325,.00523051,0,.873016,.514265,.00490712,0,.904762,.501406,.00460297,0,.936508,.488922,.00431247,0,.968254,.476541,.0040472,0,1,1,.0659184,0,0,1,.0659185,0,0,.999998,.06592,0,0,.999988,.0659259,0,0,.999963,.0659423,0,0,.999907,.0659764,0,374198e-9,.999806,.0660376,0,.00182071,.999639,.0661361,0,.0043894,.999378,.0662814,0,.00800055,.998985,.0664779,0,.0125594,.998285,.0666914,0,.0179786,.995071,.0661989,0,.0241822,.993172,.0660454,0,.031106,.991438,.0660105,0,.0386952,.988428,.0656875,0,.0469032,.985218,.0652913,0,.0556905,.981128,.0647107,0,.065023,.976015,.0638491,0,.0748717,.97097,.062993,0,.0852112,.964582,.0617927,0,.0960199,.957383,.0603626,0,.107279,.949969,.0588128,0,.118971,.941843,.0570274,0,.131084,.933624,.0551885,0,.143604,.924543,.053122,0,.156521,.914919,.0508897,0,.169825,.905773,.0486418,0,.18351,.896434,.0463364,0,.197569,.887195,.0440623,0,.211997,.877706,.0417799,0,.226789,.867719,.03945,0,.241944,.858587,.037243,0,.257458,.849317,.0350956,0,.273331,.839585,.0329852,0,.289563,.829856,.0310028,0,.306154,.819589,.0290953,0,.323108,.809714,.0272738,0,.340426,.79934,.0255631,0,.358113,.788224,.0239175,0,.376175,.776619,.0223831,0,.394616,.76521,.0209298,0,.413445,.753716,.0195786,0,.432671,.741564,.0183001,0,.452305,.729413,.0171259,0,.472358,.717146,.0159933,0,.492845,.70436,.0149495,0,.513783,.69219,.0139681,0,.535189,.680289,.0130577,0,.557087,.669611,.0122198,0,.5795,.659113,.0114174,0,.602459,.648148,.0106729,0,.625997,.636905,.00998997,0,.650154,.625154,.00934313,0,.674976,.613481,.00874839,0,.700518,.60154,.00818265,0,.726845,.58943,.00766889,0,.754032,.576828,.00717153,0,.782167,.564194,.00672696,0,.811344,.551501,.00630863,0,.841644,.538635,.00592177,0,.873016,.525724,.00554888,0,.904762,.513209,.00520225,0,.936508,.500457,.00488231,0,.968254,.48799,.00457153,0,1,1,.0810131,0,0,1,.0810133,0,0,.999997,.0810145,0,0,.999985,.08102,0,0,.999956,.0810347,0,195026e-10,.999893,.0810656,0,719316e-9,.999777,.0811205,0,.00259774,.999583,.081208,0,.00561807,.999281,.0813343,0,.00967472,.998813,.0814969,0,.0146627,.997597,.0815217,0,.0204902,.994379,.0808502,0,.0270802,.992744,.0806792,0,.0343674,.990745,.0804589,0,.0422974,.986646,.0796107,0,.0508242,.983611,.0790913,0,.0599087,.978869,.0780746,0,.0695175,.973475,.0768218,0,.0796223,.967845,.0754926,0,.0901983,.960778,.0737063,0,.101224,.953333,.0718052,0,.112682,.945274,.0695946,0,.124555,.936955,.0672492,0,.136831,.928319,.0647732,0,.149496,.919075,.0620947,0,.162542,.909114,.0591816,0,.175958,.900137,.0563917,0,.189739,.891069,.0535392,0,.203877,.882262,.0507642,0,.218368,.873232,.0479793,0,.233208,.864042,.045226,0,.248393,.855002,.0425413,0,.263923,.846569,.0400126,0,.279796,.837714,.0375269,0,.296012,.828918,.0352027,0,.312573,.819783,.0330011,0,.329479,.810129,.0308908,0,.346734,.800866,.0289112,0,.364342,.79093,.0270255,0,.382307,.780593,.0252758,0,.400637,.769511,.0236178,0,.419337,.758558,.0220652,0,.438418,.747632,.0206289,0,.457889,.736146,.0192873,0,.477761,.724093,.0180333,0,.49805,.71234,.0168264,0,.51877,.700201,.015746,0,.53994,.687949,.0147027,0,.561581,.676163,.0137512,0,.583718,.665001,.0128655,0,.60638,.65472,.0120366,0,.629599,.644213,.0112604,0,.653415,.633382,.0105413,0,.677874,.62212,.00986498,0,.70303,.610631,.00923308,0,.728948,.599078,.00864206,0,.755706,.587519,.00811784,0,.783396,.575505,.00761237,0,.812121,.563148,.00713949,0,.841989,.550828,.00668379,0,.873035,.538458,.00627715,0,.904762,.525905,.00588336,0,.936508,.513517,.00552687,0,.968254,.501395,.00519681,0,1,1,.0991506,0,0,1,.0991504,0,0,.999996,.0991515,0,0,.999984,.0991558,0,0,.999947,.0991672,0,114389e-9,.999874,.0991912,0,.00121503,.999739,.0992331,0,.00356108,.999514,.0992983,0,.00705578,.999159,.0993877,0,.011574,.998586,.0994837,0,.017003,.995731,.0988425,0,.0232484,.993384,.098276,0,.0302318,.991615,.0979269,0,.0378884,.989029,.0973432,0,.0461641,.985373,.0963539,0,.0550136,.981278,.0952306,0,.0643988,.975777,.0936233,0,.0742868,.970526,.0920219,0,.0846501,.963755,.0898912,0,.0954644,.956676,.0876064,0,.106709,.948099,.0847751,0,.118367,.939718,.0818638,0,.130423,.931305,.078857,0,.142862,.922342,.0756127,0,.155674,.912842,.0721473,0,.168849,.903304,.0686195,0,.182378,.89411,.0650589,0,.196255,.885512,.0616022,0,.210473,.877193,.0582434,0,.225027,.86877,.0548979,0,.239915,.860267,.0516095,0,.255132,.851915,.048468,0,.270678,.843912,.0454447,0,.286551,.83604,.0425612,0,.302751,.828245,.0398752,0,.31928,.820159,.0373198,0,.336138,.81167,.034916,0,.35333,.802659,.0326402,0,.370858,.793921,.0304901,0,.388728,.784713,.0284857,0,.406944,.774946,.0266186,0,.425515,.76448,.0248593,0,.444449,.753793,.0232114,0,.463756,.743506,.0217039,0,.483447,.732555,.0202841,0,.503535,.720965,.0189648,0,.524036,.709422,.0177189,0,.544968,.697756,.0165626,0,.56635,.685565,.015483,0,.588208,.673987,.0144892,0,.610569,.66244,.0135607,0,.633466,.651675,.0126956,0,.656936,.641598,.0118788,0,.681025,.63121,.0111261,0,.705788,.620514,.010437,0,.731289,.609366,.00978747,0,.757606,.598137,.00917257,0,.784834,.586966,.00859778,0,.813085,.575549,.00806803,0,.842485,.563797,.00757294,0,.87313,.551758,.00710592,0,.904762,.539894,.0066841,0,.936508,.527901,.00627901,0,.968254,.515819,.00590506,0,1,1,.120864,0,0,1,.120864,0,0,.999996,.120864,0,0,.99998,.120867,0,0,.99994,.120872,0,323781e-9,.999852,.120884,0,.00188693,.999693,.120903,0,.00473489,.999426,.120929,0,.00872704,.999002,.120955,0,.0137237,.998235,.120918,0,.0196068,.994608,.119764,0,.0262803,.992997,.119265,0,.0336657,.990968,.11863,0,.0416987,.987002,.117261,0,.0503261,.983524,.116009,0,.0595035,.97875,.114252,0,.0691935,.972652,.11193,0,.0793645,.966613,.109555,0,.0899894,.959275,.106612,0,.101045,.951272,.103375,0,.112512,.942323,.0996594,0,.124372,.933679,.0958841,0,.136611,.924822,.0919265,0,.149216,.915742,.0878061,0,.162176,.906348,.0834894,0,.175482,.896883,.079085,0,.189125,.88774,.0746745,0,.203098,.87986,.0705773,0,.217396,.871998,.0665005,0,.232015,.864325,.0625413,0,.24695,.856685,.0586781,0,.2622,.84925,.0550063,0,.277761,.841719,.0514727,0,.293634,.834755,.0481398,0,.309819,.827853,.0450172,0,.326315,.820888,.0420969,0,.343126,.813616,.0393702,0,.360254,.805767,.0367771,0,.377701,.797338,.0343274,0,.395474,.789122,.0320529,0,.413577,.780601,.0299485,0,.432018,.771424,.0279812,0,.450804,.761502,.0261054,0,.469944,.751166,.0243942,0,.489451,.741276,.0228087,0,.509337,.730898,.0213265,0,.529617,.719878,.0199307,0,.550307,.708379,.0186574,0,.571428,.697165,.0174446,0,.593003,.685554,.0163144,0,.615059,.673631,.015276,0,.637628,.662385,.0143003,0,.660746,.651059,.0134112,0,.68446,.640451,.0125794,0,.70882,.630536,.011793,0,.733893,.620316,.0110547,0,.759756,.609722,.0103668,0,.786505,.598804,.00973009,0,.814259,.587871,.00912812,0,.843157,.577121,.00858916,0,.87334,.566019,.00807333,0,.904762,.554664,.00759687,0,.936508,.543101,.00714759,0,.968254,.531558,.00673418,0,1,1,.146767,0,0,1,.146767,0,0,.999997,.146767,0,0,.999977,.146765,0,320658e-11,.999929,.146762,0,682576e-9,.999823,.146753,0,.00276402,.999633,.146735,0,.00614771,.999314,.146699,0,.0106613,.998796,.14662,0,.0161546,.997124,.146107,0,.0225063,.994062,.144857,0,.0296198,.992154,.144011,0,.037417,.989186,.142712,0,.0458348,.985279,.140926,0,.0548211,.980826,.13885,0,.0643326,.975056,.136168,0,.074333,.969005,.133217,0,.0847917,.961554,.12959,0,.0956828,.954206,.125886,0,.106984,.945046,.121335,0,.118675,.935678,.116492,0,.130741,.926748,.111635,0,.143166,.917764,.106625,0,.155939,.908358,.101325,0,.169049,.899219,.0960249,0,.182487,.890089,.0906527,0,.196245,.881488,.0853905,0,.210317,.874031,.0804177,0,.224697,.866932,.0756005,0,.23938,.859976,.0709019,0,.254364,.853375,.0664391,0,.269646,.846971,.0622012,0,.285223,.840483,.058129,0,.301096,.833969,.0542762,0,.317265,.82806,.0507042,0,.333729,.822128,.047368,0,.350491,.815989,.044272,0,.367554,.809336,.0413444,0,.38492,.802177,.038601,0,.402594,.79441,.0360227,0,.420582,.786573,.0336383,0,.438891,.778619,.0314321,0,.457527,.77,.029362,0,.476499,.760698,.0274102,0,.49582,.750932,.0256146,0,.5155,.740993,.023974,0,.535555,.731159,.0224182,0,.556,.720836,.0209889,0,.576855,.709913,.0196411,0,.598143,.698415,.0183824,0,.619888,.68745,.0172222,0,.642123,.676154,.0161509,0,.664883,.664383,.0151397,0,.688211,.6533,.0141873,0,.71216,.642072,.0133105,0,.736792,.631412,.0124932,0,.762186,.621622,.0117408,0,.788439,.611681,.0110358,0,.815672,.60142,.0103775,0,.844034,.59083,.00975623,0,.873699,.580254,.00918084,0,.904765,.569841,.00864721,0,.936508,.559224,.00815731,0,.968254,.548315,.00767924,0,1,1,.177563,0,0,1,.177563,0,0,.999994,.177562,0,0,.999972,.177555,0,664171e-10,.999914,.177536,0,.0012276,.999787,.177496,0,.00388025,.999556,.17742,0,.00783463,.999165,.177285,0,.0128953,.9985,.177037,0,.0189053,.995388,.175634,0,.025742,.993102,.174375,0,.033309,.990992,.173121,0,.0415298,.986932,.170896,0,.0503425,.982786,.16847,0,.0596964,.977592,.165455,0,.0695498,.971075,.161676,0,.0798676,.963967,.157458,0,.0906201,.956397,.152836,0,.101783,.947489,.147467,0,.113333,.937564,.14145,0,.125254,.928182,.135383,0,.137529,.919027,.129212,0,.150144,.909618,.12276,0,.163088,.900492,.116273,0,.176351,.891671,.1098,0,.189924,.883146,.103362,0,.203799,.875151,.0970799,0,.21797,.868338,.0911732,0,.232433,.862033,.0854966,0,.247182,.856107,.0800691,0,.262216,.850644,.0749618,0,.27753,.845261,.070079,0,.293124,.839885,.0654321,0,.308997,.834609,.0610975,0,.325149,.829083,.0569741,0,.341581,.82404,.0531736,0,.358294,.818968,.049665,0,.37529,.813496,.0463856,0,.392573,.807533,.0433217,0,.410148,.80099,.0404402,0,.428019,.793891,.0377578,0,.446192,.786281,.0352616,0,.464676,.778773,.0329577,0,.483478,.770737,.030808,0,.502608,.762094,.0287964,0,.522079,.752898,.0269254,0,.541905,.743306,.0251926,0,.5621,.733416,.023595,0,.582684,.723742,.0221155,0,.603677,.713542,.0207435,0,.625106,.702755,.019434,0,.646998,.691484,.0182046,0,.66939,.680531,.0170771,0,.692324,.66953,.0160339,0,.715849,.658126,.0150677,0,.740028,.646933,.0141551,0,.764937,.636107,.0133179,0,.790673,.625271,.0125284,0,.817358,.615225,.0117937,0,.84515,.605678,.0111181,0,.874244,.59583,.0104759,0,.904828,.585704,.00986672,0,.936508,.575413,.00929712,0,.968254,.565373,.00876713,0,1,1,.214058,0,0,.999999,.214058,0,0,.999994,.214055,0,0,.999966,.214039,0,259642e-9,.999893,.213998,0,.00200075,.999737,.21391,0,.00527775,.999449,.213745,0,.00983959,.99896,.213458,0,.0154755,.9979,.212855,0,.0220249,.994278,.210779,0,.0293654,.992254,.20926,0,.0374021,.98881,.206908,0,.0460604,.984715,.204009,0,.0552802,.979738,.200471,0,.0650127,.972884,.195813,0,.0752175,.965996,.190856,0,.0858612,.957974,.185077,0,.0969155,.949155,.17868,0,.108356,.939288,.171513,0,.120163,.928996,.163838,0,.132319,.919563,.156246,0,.144808,.910004,.148359,0,.157618,.900791,.140417,0,.170737,.892135,.132569,0,.184155,.883803,.124741,0,.197866,.876034,.117091,0,.211861,.869219,.109835,0,.226134,.863062,.102859,0,.240682,.857795,.0962928,0,.255499,.853009,.0900725,0,.270583,.848603,.0842101,0,.285931,.844335,.0786527,0,.301542,.840208,.0734397,0,.317415,.836035,.0685334,0,.33355,.83172,.0639275,0,.349948,.827135,.0595909,0,.36661,.822797,.0556204,0,.383539,.818387,.0519394,0,.400738,.813565,.0485317,0,.41821,.808142,.0453138,0,.435961,.802212,.0423354,0,.453997,.79573,.0395553,0,.472324,.788741,.036988,0,.490951,.781093,.0345688,0,.509887,.773597,.0323297,0,.529144,.765622,.0302719,0,.548735,.757083,.0283477,0,.568674,.747992,.0265562,0,.588979,.738591,.0248844,0,.609671,.728719,.0233342,0,.630773,.719146,.0219081,0,.652314,.709165,.0205711,0,.674328,.69875,.0193248,0,.696854,.687884,.0181582,0,.719942,.676818,.0170746,0,.743651,.666247,.0160718,0,.768057,.655284,.0151262,0,.793253,.64401,.0142561,0,.819363,.633353,.0134327,0,.846547,.622674,.012653,0,.875017,.612265,.0119354,0,.905021,.602455,.0112533,0,.936508,.593147,.0106234,0,.968254,.583592,.0100213,0,1,1,.25717,0,0,1,.25717,0,0,.999992,.257164,0,0,.999958,.257135,0,641715e-9,.999864,.25706,0,.00305314,.999666,.256897,0,.00700975,.999302,.256596,0,.0122194,.998663,.25607,0,.0184622,.995607,.254123,0,.0255773,.993094,.252081,0,.0334439,.9907,.249867,0,.0419696,.98594,.246118,0,.0510823,.981214,.242049,0,.0607242,.974966,.236869,0,.0708486,.967589,.230724,0,.081417,.95915,.223635,0,.0923974,.950257,.21596,0,.103763,.940165,.207296,0,.115491,.929396,.197901,0,.127562,.919288,.188437,0,.13996,.909428,.178762,0,.15267,.900105,.169072,0,.165679,.891418,.159478,0,.178979,.883347,.15002,0,.192558,.875992,.140813,0,.20641,.869466,.13196,0,.220529,.863699,.123501,0,.234907,.858553,.115436,0,.249542,.854379,.107901,0,.264428,.850894,.10088,0,.279564,.847632,.0942296,0,.294947,.844571,.0879861,0,.310575,.84163,.0821534,0,.326448,.838542,.0766409,0,.342566,.835412,.0715322,0,.358929,.831899,.0666883,0,.37554,.828177,.0622175,0,.392399,.82416,.0580452,0,.409511,.820393,.054267,0,.426878,.816068,.0507172,0,.444506,.811201,.0474041,0,.4624,.805785,.0443174,0,.480566,.799878,.0414562,0,.499013,.793469,.0388147,0,.517749,.786473,.0363453,0,.536785,.778874,.0340225,0,.556134,.771277,.0318599,0,.575809,.763426,.0298859,0,.595827,.755044,.0280357,0,.616207,.746161,.0262979,0,.636973,.737124,.0247295,0,.65815,.72761,.0232514,0,.679772,.717822,.0218755,0,.701876,.708279,.0205942,0,.724509,.698333,.0193947,0,.74773,.68802,.0182717,0,.771609,.677321,.0172044,0,.79624,.666504,.0162122,0,.821743,.656184,.0152924,0,.84828,.64556,.0144326,0,.876069,.634636,.0136157,0,.905404,.624124,.0128612,0,.936508,.613914,.0121435,0,.968254,.603589,.0114887,0,1,1,.307946,0,0,.999999,.307945,0,0,.999988,.307934,0,204479e-10,.999944,.307886,0,.00127833,.999824,.307756,0,.00445047,.999565,.30748,0,.00914673,.999085,.306966,0,.0150498,.998103,.306004,0,.0219367,.994249,.303028,0,.0296485,.991807,.300435,0,.038068,.987773,.296554,0,.0471062,.982673,.2916,0,.0566942,.976623,.285641,0,.0667768,.968757,.27815,0,.0773099,.959849,.269529,0,.088257,.950663,.260248,0,.0995879,.940129,.249704,0,.111277,.92895,.238291,0,.123304,.917996,.226501,0,.13565,.907813,.214669,0,.148299,.898305,.202835,0,.161237,.889626,.191158,0,.174455,.88175,.179695,0,.187941,.874715,.168548,0,.201687,.868746,.15792,0,.215687,.863703,.147807,0,.229933,.859315,.138149,0,.24442,.855538,.128993,0,.259145,.852428,.120414,0,.274103,.850168,.112498,0,.289293,.848132,.105054,0,.304711,.846291,.0981087,0,.320357,.844431,.0915942,0,.33623,.842493,.0855056,0,.35233,.840368,.0798204,0,.368658,.83798,.0745097,0,.385214,.83523,.0695424,0,.402002,.832091,.0649092,0,.419023,.828667,.0606291,0,.436282,.824805,.0566523,0,.453782,.820988,.0530229,0,.471529,.816635,.0496364,0,.489528,.811725,.0464658,0,.507788,.806316,.0435082,0,.526317,.800469,.0407873,0,.545124,.794107,.038255,0,.564221,.787218,.0358825,0,.583621,.779872,.0336785,0,.603341,.772097,.0316379,0,.623397,.764484,.0297379,0,.643812,.756428,.0279581,0,.664611,.748022,.0263153,0,.685824,.739268,.0247799,0,.707488,.73024,.0233385,0,.729646,.720893,.0220035,0,.752354,.71119,.0207555,0,.77568,.701791,.0195843,0,.799715,.692184,.0184891,0,.824574,.682258,.0174541,0,.850417,.67206,.0164873,0,.877466,.661717,.0155959,0,.90604,.651462,.0147519,0,.936528,.641467,.0139727,0,.968254,.631229,.0132363,0,1,1,.367573,0,0,.999999,.367571,0,0,.999984,.367553,0,183382e-9,.999925,.367473,0,.00225254,.999759,.367259,0,.00628165,.99941,.366801,0,.0117858,.998739,.365946,0,.0184359,.995529,.363191,0,.0260114,.992875,.360171,0,.0343581,.989135,.355981,0,.0433637,.984166,.350401,0,.0529438,.977871,.343348,0,.0630334,.96951,.334341,0,.0735805,.959964,.323862,0,.0845437,.950162,.312521,0,.095889,.938882,.299577,0,.107588,.926992,.285573,0,.119617,.915589,.271212,0,.131957,.904791,.256611,0,.144591,.895177,.242224,0,.157503,.886403,.227952,0,.170682,.878957,.214192,0,.184117,.872418,.200795,0,.197799,.867029,.188015,0,.21172,.862835,.175975,0,.225873,.859411,.164526,0,.240253,.856655,.153693,0,.254854,.854519,.14352,0,.269673,.852828,.13397,0,.284707,.851412,.124984,0,.299953,.850609,.116748,0,.315408,.849855,.10905,0,.331073,.849017,.101839,0,.346946,.848079,.0951359,0,.363028,.846911,.0888774,0,.379318,.845445,.0830375,0,.395818,.84362,.0775844,0,.41253,.841411,.0725054,0,.429457,.838768,.0677691,0,.446602,.835801,.0634016,0,.463968,.832341,.0593095,0,.481561,.828424,.0555121,0,.499386,.824312,.052024,0,.51745,.819918,.0487865,0,.535761,.815072,.0457801,0,.554328,.809863,.0430184,0,.573162,.804164,.0404245,0,.592275,.798034,.0380146,0,.611681,.791436,.0357436,0,.631398,.784498,.0336475,0,.651445,.777125,.0316666,0,.671845,.769365,.0298122,0,.692628,.761579,.0281001,0,.713827,.753746,.0265049,0,.735484,.745573,.0250067,0,.75765,.737083,.0236026,0,.78039,.728545,.0223302,0,.803789,.719691,.0211243,0,.82796,.710569,.0199983,0,.853056,.701216,.0189569,0,.879298,.692094,.0179702,0,.907014,.682909,.0170418,0,.936691,.673509,.0161732,0,.968254,.663863,.0153406,0,1,1,.437395,0,0,.999998,.437394,0,0,.99998,.437363,0,616704e-9,.999891,.437232,0,.00367925,.999656,.436877,0,.00867446,.999148,.436121,0,.0150679,.997959,.434564,0,.022531,.993464,.430134,0,.0308507,.990606,.426077,0,.0398805,.985027,.419397,0,.0495148,.978491,.41118,0,.0596749,.969643,.40048,0,.0703001,.959189,.38769,0,.0813427,.948223,.373575,0,.0927641,.935955,.357622,0,.104533,.923237,.34043,0,.116624,.911074,.322735,0,.129015,.899724,.30479,0,.141687,.890189,.287392,0,.154626,.881796,.270248,0,.167818,.874781,.253659,0,.181252,.869166,.237786,0,.194918,.864725,.222618,0,.208807,.861565,.208356,0,.222913,.859284,.194867,0,.237229,.857677,.18212,0,.25175,.856714,.17018,0,.266473,.856155,.158969,0,.281392,.8558,.148413,0,.296505,.855672,.138578,0,.311811,.855538,.129345,0,.327306,.855689,.120861,0,.342991,.855767,.112969,0,.358864,.855618,.105593,0,.374925,.85525,.0987451,0,.391176,.854583,.0923727,0,.407616,.853534,.0864143,0,.424249,.852061,.0808338,0,.441076,.850253,.0756771,0,.4581,.848004,.0708612,0,.475324,.845333,.0663784,0,.492754,.842376,.0622631,0,.510394,.838956,.0584112,0,.528251,.835121,.0548328,0,.546331,.830842,.0514838,0,.564644,.826212,.048355,0,.583198,.821522,.0454714,0,.602005,.816551,.0428263,0,.621078,.811211,.0403612,0,.640434,.805479,.038039,0,.660089,.799409,.0358739,0,.680066,.79306,.0338727,0,.70039,.786395,.0319985,0,.721094,.779416,.030241,0,.742215,.77214,.0285951,0,.7638,.764636,.0270747,0,.785912,.756836,.0256354,0,.808628,.749315,.0243027,0,.832055,.741561,.0230497,0,.856338,.733589,.0218801,0,.88169,.725479,.020784,0,.908441,.717255,.0197702,0,.937125,.708829,.0188168,0,.968254,.700191,.0179113,0,1,1,.518937,0,0,.999998,.518933,0,0,.999967,.518883,0,.00147741,.999832,.51866,0,.00573221,.999466,.518057,0,.011826,.998644,.516752,0,.0192116,.994458,.512347,0,.027573,.991223,.507675,0,.0367099,.985515,.500188,0,.046487,.978308,.490408,0,.0568071,.968359,.477357,0,.0675984,.95682,.461752,0,.0788059,.943929,.443796,0,.090386,.930224,.423893,0,.102304,.916514,.402682,0,.114532,.903653,.380914,0,.127047,.892315,.359212,0,.139828,.882942,.338102,0,.152861,.875438,.31773,0,.16613,.869642,.298186,0,.179624,.865304,.279491,0,.193332,.862382,.261804,0,.207247,.860666,.245146,0,.22136,.859788,.229406,0,.235666,.859608,.214605,0,.250158,.859912,.200691,0,.264832,.86053,.187623,0,.279684,.861368,.17539,0,.294711,.862237,.163901,0,.309911,.863127,.153175,0,.32528,.863923,.143147,0,.340819,.864567,.133781,0,.356524,.865013,.125042,0,.372397,.86539,.116952,0,.388438,.865591,.109476,0,.404645,.865517,.102542,0,.421022,.865084,.0960688,0,.437569,.864309,.0900499,0,.454287,.863151,.0844328,0,.471181,.861649,.0792218,0,.488253,.859742,.0743482,0,.505507,.857446,.0697963,0,.522947,.854757,.0655364,0,.54058,.851783,.061608,0,.558412,.848516,.0579701,0,.576449,.844897,.0545742,0,.594701,.840956,.0514167,0,.613178,.836676,.0484598,0,.631892,.832075,.0456934,0,.650856,.827191,.0431178,0,.670088,.822295,.0407718,0,.689606,.817294,.0386032,0,.709434,.812013,.0365675,0,.7296,.806465,.0346547,0,.750138,.800691,.0328717,0,.771093,.794709,.031211,0,.792519,.788493,.0296504,0,.814488,.782049,.0281782,0,.837097,.775403,.0267965,0,.860481,.76857,.0255002,0,.884842,.761536,.0242759,0,.910494,.754303,.0231142,0,.937985,.74692,.0220305,0,.968254,.739745,.0210192,0,1,1,.613914,0,0,.999996,.613907,0,963597e-10,.999942,.613814,0,.00301247,.999704,.613407,0,.00870385,.999046,.612302,0,.0160714,.995516,.608266,0,.0245899,.991726,.602863,0,.0339681,.985157,.593956,0,.0440254,.97642,.581748,0,.0546409,.964404,.565183,0,.0657284,.950601,.545273,0,.0772246,.935158,.522129,0,.0890812,.919364,.496782,0,.10126,.904754,.470571,0,.113731,.89176,.444037,0,.126469,.881492,.418322,0,.139454,.873656,.393522,0,.15267,.868053,.369795,0,.166101,.864336,.347171,0,.179736,.862259,.325737,0,.193565,.861556,.305532,0,.207578,.861776,.286416,0,.221769,.862661,.268355,0,.23613,.864015,.251334,0,.250656,.865711,.235352,0,.265343,.867519,.220302,0,.280187,.869351,.206161,0,.295183,.871144,.192908,0,.31033,.872839,.180505,0,.325624,.874307,.168848,0,.341065,.875667,.158021,0,.35665,.876758,.147877,0,.37238,.87764,.138441,0,.388253,.878237,.129627,0,.404269,.878563,.121415,0,.42043,.878572,.113741,0,.436735,.87842,.106652,0,.453187,.878057,.100097,0,.469786,.877413,.0940128,0,.486536,.87646,.0883462,0,.503439,.875233,.0830924,0,.520498,.8737,.0781975,0,.537717,.871873,.07364,0,.555102,.86978,.0694103,0,.572657,.867405,.0654696,0,.59039,.864751,.0617914,0,.608307,.861818,.0583491,0,.626419,.858645,.0551443,0,.644733,.855307,.0521894,0,.663264,.851736,.0494334,0,.682025,.847927,.0468504,0,.701032,.843888,.0444261,0,.720308,.839629,.0421497,0,.739875,.835158,.0400082,0,.759764,.830509,.0380076,0,.780014,.825714,.0361488,0,.800673,.820729,.0343956,0,.821803,.815751,.0327781,0,.843492,.810752,.031275,0,.86586,.805587,.0298542,0,.889087,.800317,.0285397,0,.913466,.79489,.0272948,0,.93952,.789314,.0261139,0,.96835,.783593,.0249938,0,1,1,.724258,0,0,.999992,.724243,0,726889e-9,.99987,.724044,0,.00569574,.999336,.72317,0,.0131702,.996271,.719432,0,.0220738,.991159,.712576,0,.0319405,.982465,.700927,0,.0425202,.97049,.684297,0,.0536599,.953973,.661244,0,.065258,.935546,.633804,0,.0772427,.916596,.603071,0,.0895616,.899353,.57105,0,.102175,.885216,.539206,0,.11505,.875076,.508714,0,.128164,.868334,.479571,0,.141495,.864414,.451796,0,.155026,.862678,.425328,0,.168745,.862835,.400352,0,.182639,.864067,.376532,0,.196699,.866086,.35391,0,.210915,.868557,.332424,0,.225282,.871271,.312053,0,.239792,.874058,.292764,0,.25444,.8768,.27453,0,.269223,.87939,.257297,0,.284135,.8819,.24114,0,.299174,.884187,.225934,0,.314337,.886262,.211669,0,.329622,.888119,.198311,0,.345026,.889709,.185783,0,.360549,.891054,.174063,0,.376189,.892196,.163143,0,.391946,.893101,.152952,0,.407819,.893803,.143475,0,.423808,.894277,.134647,0,.439914,.894532,.126434,0,.456137,.894576,.1188,0,.472479,.894393,.111694,0,.48894,.893976,.105069,0,.505523,.893346,.0989077,0,.52223,.892502,.0931724,0,.539064,.891441,.0878276,0,.556028,.890276,.082903,0,.573125,.888972,.0783505,0,.590361,.887469,.0741083,0,.607741,.885785,.0701633,0,.62527,.883914,.0664835,0,.642957,.881872,.0630567,0,.660809,.879651,.0598527,0,.678836,.877267,.0568615,0,.69705,.874717,.05406,0,.715465,.872012,.0514378,0,.734098,.869157,.0489805,0,.752968,.866155,.0466727,0,.772101,.863014,.0445056,0,.791529,.859748,.0424733,0,.81129,.856416,.0405957,0,.831438,.852958,.0388273,0,.852044,.849382,.0371619,0,.87321,.845694,.0355959,0,.89509,.841893,.0341155,0,.917932,.837981,.0327141,0,.942204,.833963,.0313856,0,.968981,.829847,.0301275,0,1,1,.85214,0,0,.999969,.852095,0,.00279627,.999483,.851408,0,.0107635,.994545,.84579,0,.0206454,.986188,.835231,0,.0315756,.969847,.814687,0,.0432021,.945951,.783735,0,.0553396,.91917,.746074,0,.0678766,.895488,.706938,0,.0807395,.878232,.669534,0,.0938767,.868252,.635168,0,.10725,.863873,.603069,0,.120832,.863369,.572514,0,.134598,.86545,.543169,0,.148533,.868803,.514578,0,.16262,.872794,.486762,0,.176849,.87702,.459811,0,.19121,.881054,.433654,0,.205694,.884974,.408574,0,.220294,.888587,.384525,0,.235005,.891877,.36156,0,.24982,.894793,.339661,0,.264737,.89743,.318913,0,.279751,.899796,.299302,0,.294859,.901943,.280843,0,.310058,.903858,.263481,0,.325346,.905574,.247197,0,.340721,.907069,.231915,0,.356181,.908379,.217614,0,.371725,.90952,.20425,0,.387353,.910483,.191758,0,.403063,.91128,.180092,0,.418854,.911936,.169222,0,.434727,.912454,.159098,0,.450682,.912835,.149668,0,.466718,.913078,.140884,0,.482837,.913192,.132709,0,.499038,.913175,.125095,0,.515324,.91304,.118012,0,.531695,.912781,.111417,0,.548153,.91241,.105281,0,.5647,.911924,.0995691,0,.581338,.911331,.0942531,0,.59807,.910637,.0893076,0,.6149,.90984,.0846998,0,.63183,.908941,.0804044,0,.648865,.907944,.0763984,0,.666011,.906857,.0726638,0,.683273,.90568,.0691783,0,.700659,.904416,.0659222,0,.718176,.903067,.0628782,0,.735834,.901637,.0600307,0,.753646,.900128,.0573647,0,.771625,.898544,.0548668,0,.78979,.89689,.052527,0,.808162,.895165,.0503306,0,.826771,.893371,.0482668,0,.845654,.891572,.0463605,0,.864863,.889763,.0445998,0,.884472,.887894,.0429451,0,.904592,.885967,.0413884,0,.925407,.883984,.0399225,0,.947271,.881945,.0385405,0,.97105,.879854,.0372362,0,1,.999804,.995833,0,0,.938155,.933611,0,.0158731,.864755,.854311,0,.0317461,.888594,.865264,0,.0476191,.905575,.863922,0,.0634921,.915125,.850558,0,.0793651,.920665,.829254,0,.0952381,.924073,.802578,0,.111111,.926304,.772211,0,.126984,.927829,.739366,0,.142857,.928924,.705033,0,.15873,.92973,.670019,0,.174603,.930339,.634993,0,.190476,.930811,.600485,0,.206349,.931191,.566897,0,.222222,.93149,.534485,0,.238095,.931737,.503429,0,.253968,.931939,.473811,0,.269841,.932108,.445668,0,.285714,.93225,.418993,0,.301587,.932371,.393762,0,.31746,.932474,.369939,0,.333333,.932562,.347479,0,.349206,.932638,.326336,0,.365079,.932703,.306462,0,.380952,.93276,.287805,0,.396825,.932809,.270313,0,.412698,.932851,.253933,0,.428571,.932887,.23861,0,.444444,.932917,.224289,0,.460317,.932943,.210917,0,.47619,.932965,.19844,0,.492063,.932982,.186807,0,.507937,.932995,.175966,0,.52381,.933005,.165869,0,.539683,.933011,.156468,0,.555556,.933013,.147719,0,.571429,.933013,.139579,0,.587302,.93301,.132007,0,.603175,.933004,.124965,0,.619048,.932994,.118416,0,.634921,.932982,.112326,0,.650794,.932968,.106663,0,.666667,.93295,.101397,0,.68254,.932931,.0964993,0,.698413,.932908,.0919438,0,.714286,.932883,.0877057,0,.730159,.932856,.0837623,0,.746032,.932827,.0800921,0,.761905,.932796,.0766754,0,.777778,.932762,.0734936,0,.793651,.932727,.0705296,0,.809524,.932689,.0677676,0,.825397,.93265,.0651929,0,.84127,.932609,.0627917,0,.857143,.932565,.0605515,0,.873016,.932521,.0584606,0,.888889,.932474,.0565082,0,.904762,.932427,.0546841,0,.920635,.932377,.0529793,0,.936508,.932326,.0513851,0,.952381,.932274,.0498936,0,.968254,.93222,.0484975,0,.984127,.932164,.0471899,0,1],n=new Float32Array(e),r=new Float32Array(t),s=new B6(n,64,64,xs,Ys,Wy,ta,ta,_s,es,1),o=new B6(r,64,64,xs,Ys,Wy,ta,ta,_s,es,1);s.needsUpdate=!0,o.needsUpdate=!0;const a=new Uint16Array(e.length);e.forEach(function(m,v){a[v]=Zxe.toHalfFloat(m)});const c=new Uint16Array(t.length);t.forEach(function(m,v){c[v]=Zxe.toHalfFloat(m)});const u=new B6(a,64,64,xs,Aa,Wy,ta,ta,_s,es,1),f=new B6(c,64,64,xs,Aa,Wy,ta,ta,_s,es,1);return u.needsUpdate=!0,f.needsUpdate=!0,this.LTC_HALF_1=u,this.LTC_HALF_2=f,this.LTC_FLOAT_1=s,this.LTC_FLOAT_2=o,this}}ix.LTC_HALF_1=null;ix.LTC_HALF_2=null;ix.LTC_FLOAT_1=null;ix.LTC_FLOAT_2=null;class u1t{static init(){ix.init();const{LTC_FLOAT_1:e,LTC_FLOAT_2:t,LTC_HALF_1:n,LTC_HALF_2:r}=ix;Nn.LTC_FLOAT_1=e,Nn.LTC_FLOAT_2=t,Nn.LTC_HALF_1=n,Nn.LTC_HALF_2=r}}const Hwe="Custom Group";class $Ne extends VNe{constructor(){super();qe(this,"dance");qe(this,"rttScene");qe(this,"speed",1);this.name="Scene2"}init(){const t=this.app.components.get("three");this.camera.position.set(0,100,125),this.camera.lookAt(0,50,0),this.createLights(),this.createWorld(),this.createAnimation(),q_(this),t.addScene(this),t.setScene(this),t.addCamera(this.camera),t.renderer&&(this.renderer=t.renderer)}dispose(){const t=this.app.components.get("three");t.removeGroup(Hwe),this.rttScene&&t.removeScene(this.rttScene),super.dispose()}createLights(){const t=this.app.components.get("three"),n=new gi;n.name="lights",this.add(n);const r=new Sx(16777215,3);if(r.angle=5.8,r.decay=0,r.distance=1e3,r.penumbra=Math.PI,r.name="spotlight",r.position.set(-250,200,200),r.lookAt(0,50,0),n.add(r),t.renderer!==void 0&&t.renderer instanceof IE){u1t.init();const s=new CAe(16711680,1,300,100);s.name="rectLight",s.position.set(250,100,100),s.lookAt(0,50,0),n.add(s)}}createWorld(){const t=this.app.components.get("three"),n=mz.get("environment").clone();this.background=n;const r=new gi;r.name="world",this.add(r);const s=Rie.get("uv_grid");s.repeat.setScalar(10),s.needsUpdate=!0;const o=new jU({map:s,envMap:n}),a=new dn(new HU(250,36),o);a.name="floor",a.receiveShadow=!0,a.rotateX(-Math.PI/2),r.add(a);const c=new iXe(new G2(50),new pre({size:.5}));c.name="points",c.position.set(-100,50,0),r.add(c);const u=new cC(new G2(50),new su);if(u.name="lines",u.position.set(100,50,0),r.add(u),t.renderer.isWebGLRenderer){const f=new dn(new _x(100,100),new MNe);f.name="customShaderMaterial",f.position.set(0,50,-100),r.add(f)}this.dance=new zNe("Flair"),this.dance.name="flair",this.dance.traverse(f=>{if(f instanceof dre){const m=f;m.material=new xre}}),r.add(this.dance),t.addGroup({title:Hwe,items:[{title:"Speed",prop:"speed",value:1,min:0,max:2,step:.01,type:"range"},{title:"Name",prop:"name",value:"Hello World!",type:"string"},{title:"Color",prop:"color",value:new yn(16711680),type:"color"}],onUpdate:(f,m)=>{switch(console.log(f,m),f){case"speed":this.speed=m;break}}})}createAnimation(){const t=this.app.components.get("theatre");t.sheet(this.name),t.sheetObject(this.name,"Camera",{position:{x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z},rotation:{x:this.camera.rotation.x,y:this.camera.rotation.y,z:this.camera.rotation.z}},n=>{this.camera.position.set(n.position.x,n.position.y,n.position.z),this.camera.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z)}),t.sheetObject(this.name,"Dancer",{position:{x:this.dance.position.x,y:this.dance.position.y,z:this.dance.position.z},rotation:{x:this.dance.rotation.x,y:this.dance.rotation.y,z:this.dance.rotation.z}},n=>{this.dance.position.set(n.position.x,n.position.y,n.position.z),this.dance.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z)})}update(){var n;const t=this.clock.getDelta();this.dance.update(t*this.speed),this.renderer&&((n=this.rttScene)==null||n.draw(this.clock.getElapsedTime(),this.renderer))}}const jwe=new be;class h1t extends W1{constructor(){super();qe(this,"renderTarget");qe(this,"camera");qe(this,"mesh");this.name="RTTScene";const t=mz.get("environment").clone();this.background=t,this.camera=new po(60,1,10,2e3),this.camera.position.set(0,0,100),this.camera.lookAt(jwe);const n=new qU(new yn(16777215),1);n.name="sun",this.add(n),this.mesh=new dn(new vre(10,3,100,6),new jU({envMap:t,envMapIntensity:10})),this.mesh.name="normalMesh",this.add(this.mesh);const r=new dn(new G2(20),new _re);r.name="ball",r.position.set(-40,0,0),this.add(r),this.renderTarget=new t3(512,512),this.camera.position.set(0,0,100),this.camera.lookAt(jwe),q_(this)}draw(t,n){n.isWebGLRenderer?(n.setRenderTarget(this.renderTarget),n.render(this,this.camera),n.setRenderTarget(null)):(n.setRenderTarget(this.renderTarget),n.renderAsync(this,this.camera),n.setRenderTarget(null))}}function d1t(){setTimeout(()=>{const i=document.getElementById("theatrejs-studio-root");if(i===null||i.shadowRoot===null)return;const e=i.shadowRoot.getElementById("pointer-root");if(e===null)return;const t=e.children[0];if(t===null)return;const n=t.children[1];n.style.justifyContent="left";try{const r=n.children[1];for(r.style.transform="translateX(10px)";r.children.length>1;)r.removeChild(r.children[0])}catch{}try{const r=t.children[3];r.style.top="0",r.style.right="300px"}catch{}},1e3)}function f1t(i){const[e,t]=_n.useState(!1);_n.useEffect(()=>{const r=()=>{T4.removeEventListener(H2.LOAD_COMPLETE,r),d1t(),t(!0)};T4.addEventListener(H2.LOAD_COMPLETE,r)},[]);const n=new Map;return n.set("Scene1",GNe),n.set("Scene2",$Ne),n.set("RTTScene",h1t),We.jsx(We.Fragment,{children:e&&We.jsx(sft,{app:i.app,three:i.app.components.get("three"),scenes:n,onSceneSet:r=>{r.setup(i.app),r.init()},onSceneUpdate:r=>{r.update()}})})}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const p1t=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class m1t{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=p1t,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:n,material:r,object:s}=e;if(t={material:this.getMaterialData(r),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:a}=e.context;t.bufferWidth=o,t.bufferHeight=a}this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const r=e[n];t[n]={version:r.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return e.renderer.overrideNodes.modelViewMatrix!==null||e.renderer.overrideNodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const r=e[n];r!=null&&(typeof r=="object"&&r.clone!==void 0?r.isTexture===!0?t[n]={id:r.id,version:r.version}:t[n]=r.clone():t[n]=r)}return t}equals(e){const{object:t,material:n,geometry:r}=e,s=this.getRenderObjectData(e);if(s.worldMatrix.equals(t.matrixWorld)!==!0)return s.worldMatrix.copy(t.matrixWorld),!1;const o=s.material;for(const P in o){const R=o[P],M=n[P];if(R.equals!==void 0){if(R.equals(M)===!1)return R.copy(M),!1}else if(M.isTexture===!0){if(R.id!==M.id||R.version!==M.version)return R.id=M.id,R.version=M.version,!1}else if(R!==M)return o[P]=M,!1}if(o.transmission>0){const{width:P,height:R}=e.context;if(s.bufferWidth!==P||s.bufferHeight!==R)return s.bufferWidth=P,s.bufferHeight=R,!1}const a=s.geometry,c=r.attributes,u=a.attributes,f=Object.keys(u),m=Object.keys(c);if(a.id!==r.id)return a.id=r.id,!1;if(f.length!==m.length)return s.geometry.attributes=this.getAttributesData(c),!1;for(const P of f){const R=u[P],M=c[P];if(M===void 0)return delete u[P],!1;if(R.version!==M.version)return R.version=M.version,!1}const v=r.index,x=a.indexVersion,T=v?v.version:null;if(x!==T)return a.indexVersion=T,!1;if(a.drawRange.start!==r.drawRange.start||a.drawRange.count!==r.drawRange.count)return a.drawRange.start=r.drawRange.start,a.drawRange.count=r.drawRange.count,!1;if(s.morphTargetInfluences){let P=!1;for(let R=0;R<s.morphTargetInfluences.length;R++)s.morphTargetInfluences[R]!==t.morphTargetInfluences[R]&&(P=!0);if(P)return!0}return s.center&&s.center.equals(t.center)===!1?(s.center.copy(t.center),!0):(e.bundle!==null&&(s.version=e.bundle.version),!0)}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const r=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;return r||s?!1:this.equals(e)!==!0}}function UM(i,e=0){let t=3735928559^e,n=1103547991^e;if(i instanceof Array)for(let r=0,s;r<i.length;r++)s=i[r],t=Math.imul(t^s,2654435761),n=Math.imul(n^s,1597334677);else for(let r=0,s;r<i.length;r++)s=i.charCodeAt(r),t=Math.imul(t^s,2654435761),n=Math.imul(n^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&n)+(t>>>0)}const g1t=i=>UM(i),Pie=i=>UM(i),aU=(...i)=>UM(i);function HNe(i,e=!1){const t=[];i.isNode===!0&&(t.push(i.id),i=i.getSelf());for(const{property:n,childNode:r}of lU(i))t.push(UM(n.slice(0,-4)),r.getCacheKey(e));return UM(t)}function*lU(i,e=!1){for(const t in i){if(t.startsWith("_")===!0)continue;const n=i[t];if(Array.isArray(n)===!0)for(let r=0;r<n.length;r++){const s=n[r];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:r,childNode:s})}else if(n&&n.isNode===!0)yield{property:t,childNode:n};else if(typeof n=="object")for(const r in n){const s=n[r];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:r,childNode:s})}}}const y1t=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),Wwe=new WeakMap;function v1t(i){return y1t.get(i)}function cU(i){if(i==null)return null;const e=typeof i;return i.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":i.isVector2===!0?"vec2":i.isVector3===!0?"vec3":i.isVector4===!0?"vec4":i.isMatrix2===!0?"mat2":i.isMatrix3===!0?"mat3":i.isMatrix4===!0?"mat4":i.isColor===!0?"color":i instanceof ArrayBuffer?"ArrayBuffer":null}function jNe(i,...e){const t=i?i.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),i==="color"?new yn(...e):t==="vec2"?new mn(...e):t==="vec3"?new be(...e):t==="vec4"?new ir(...e):t==="mat2"?new NAe(...e):t==="mat3"?new Or(...e):t==="mat4"?new Vn(...e):i==="bool"?e[0]||!1:i==="float"||i==="int"||i==="uint"?e[0]||0:i==="string"?e[0]||"":i==="ArrayBuffer"?x1t(e[0]):null}function WNe(i){let e=Wwe.get(i);return e===void 0&&(e={},Wwe.set(i,e)),e}function _1t(i){let e="";const t=new Uint8Array(i);for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function x1t(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0)).buffer}const lB={VERTEX:"vertex",FRAGMENT:"fragment"},ci={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},A1={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},b1t=["fragment","vertex"],qwe=["setup","analyze","generate"],Xwe=[...b1t,"compute"],Ax=["x","y","z","w"],S1t={analyze:"setup",generate:"analyze"};let w1t=0,Wr=class extends e0{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=ci.NONE,this.updateBeforeType=ci.NONE,this.updateAfterType=ci.NONE,this.uuid=ml.generateUUID(),this.version=0,this.global=!1,this.parents=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:w1t++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,ci.FRAME)}onRenderUpdate(e){return this.onUpdate(e,ci.RENDER)}onObjectUpdate(e){return this.onUpdate(e,ci.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of lU(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=aU(HNe(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const r of this.getChildren())t["node"+n++]=r;return t.outputNode||null}analyze(e,t=null){const n=e.increaseUsage(this);if(this.parents===!0){const r=e.getDataFromNode(this,"any");r.stages=r.stages||{},r.stages[e.shaderStage]=r.stages[e.shaderStage]||[],r.stages[e.shaderStage].push(t)}if(n===1){const r=e.getNodeProperties(this);for(const s of Object.values(r))s&&s.isNode===!0&&s.build(e,this)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const n=this.getShared(e);if(this!==n)return n.build(e,t);const r=e.getDataFromNode(this);r.buildStages=r.buildStages||{},r.buildStages[e.buildStage]=!0;const s=S1t[e.buildStage];if(s&&r.buildStages[s]!==!0){const c=e.getBuildStage();e.setBuildStage(s),this.build(e),e.setBuildStage(c)}e.addNode(this),e.addChain(this);let o=null;const a=e.getBuildStage();if(a==="setup"){this.updateReference(e);const c=e.getNodeProperties(this);if(c.initialized!==!0){c.initialized=!0,c.outputNode=this.setup(e)||c.outputNode||null;for(const u of Object.values(c))if(u&&u.isNode===!0){if(u.parents===!0){const f=e.getNodeProperties(u);f.parents=f.parents||[],f.parents.push(this)}u.build(e)}}o=c.outputNode}else if(a==="analyze")this.analyze(e,t);else if(a==="generate")if(this.generate.length===1){const u=this.getNodeType(e),f=e.getDataFromNode(this);o=f.snippet,o===void 0?f.generated===void 0?(f.generated=!0,o=this.generate(e)||"",f.snippet=o):(console.warn("THREE.Node: Recursion detected.",this),o=""):f.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,u,t)}else o=this.generate(e,t)||"";return e.removeChain(this),e.addSequentialNode(this),o}getSerializeChildren(){return lU(this)}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:r,index:s,childNode:o}of t)s!==void 0?(n[r]===void 0&&(n[r]=Number.isInteger(s)?[]:{}),n[r][s]=o.toJSON(e.meta).uuid):n[r]=o.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const r=[];for(const s of e.inputNodes[n])r.push(t[s]);this[n]=r}else if(typeof e.inputNodes[n]=="object"){const r={};for(const s in e.inputNodes[n]){const o=e.inputNodes[n][s];r[s]=t[o]}this[n]=r}else{const r=e.inputNodes[n];this[n]=t[r]}}}toJSON(e){const{uuid:t,type:n}=this,r=e===void 0||typeof e=="string";r&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:n,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},r!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function o(a){const c=[];for(const u in a){const f=a[u];delete f.metadata,c.push(f)}return c}if(r){const a=o(e.textures),c=o(e.images),u=o(e.nodes);a.length>0&&(s.textures=a),c.length>0&&(s.images=c),u.length>0&&(s.nodes=u)}return s}};class yC extends Wr{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),n=this.node.build(e),r=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${n}[ ${r} ]`}}class qNe extends Wr{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const r of this.convertTo.split("|"))(n===null||e.getTypeLength(t)===e.getTypeLength(r))&&(n=r);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,r=this.getNodeType(e),s=n.build(e,r);return e.format(s,r,t)}}class da extends Wr{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const r=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,r,t);if(r!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,r),a=e.getVarFromNode(this,null,r),c=e.getPropertyName(a);return e.addLineFlowCode(`${c} = ${o}`,this),s.snippet=o,s.propertyName=c,e.format(s.propertyName,r,t)}}return super.build(e,t)}}class T1t extends da{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),r=e.getTypeLength(n),s=this.nodes,o=e.getComponentType(n),a=[];let c=0;for(const f of s){if(c>=r){console.error(`THREE.TSL: Length of parameters exceeds maximum length of function '${n}()' type.`);break}let m=f.getNodeType(e),v=e.getTypeLength(m),x;c+v>r&&(console.error(`THREE.TSL: Length of '${n}()' data exceeds maximum length of output type.`),v=r-c,m=e.getTypeFromLength(v)),c+=v,x=f.build(e,m);const T=e.getComponentType(m);T!==o&&(x=e.format(x,T,o)),a.push(x)}const u=`${e.getType(n)}( ${a.join(", ")} )`;return e.format(u,n,t)}}const E1t=Ax.join("");class Ywe extends Wr{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Ax.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const n=this.node,r=e.getTypeLength(n.getNodeType(e));let s=null;if(r>1){let o=null;this.getVectorLength()>=r&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=n.build(e,o);this.components.length===r&&this.components===E1t.slice(0,this.components.length)?s=e.format(c,o,t):s=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else s=n.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class M1t extends da{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:r}=this,s=this.getNodeType(e),o=e.getComponentType(r.getNodeType(e)),a=e.getTypeFromLength(n.length,o),c=r.build(e,a),u=t.build(e,s),f=e.getTypeLength(s),m=[];for(let v=0;v<f;v++){const x=Ax[v];x===n[0]?(m.push(c),v+=n.length-1):m.push(u+"."+x)}return`${e.getType(s)}( ${m.join(", ")} )`}}class C1t extends da{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,r=this.getNodeType(e),s=n.build(e),o=e.getVarFromNode(this),a=e.getPropertyName(o);e.addLineFlowCode(a+" = "+s,this);const c=e.getTypeLength(r),u=[];let f=0;for(let m=0;m<c;m++){const v=Ax[m];v===t[f]?(u.push("1.0 - "+(a+"."+v)),f++):u.push(a+"."+v)}return`${e.getType(r)}( ${u.join(", ")} )`}}class Nie extends Wr{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?cU(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=cU(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=_1t(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?jNe(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}const Kwe=/float|u?int/;class am extends Nie{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return Kwe.test(n)&&Kwe.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}}class A1t extends Wr{static get type(){return"MemberNode"}constructor(e,t){super(),this.node=e,this.property=t,this.isMemberNode=!0}getNodeType(e){return this.node.getMemberType(e,this.property)}generate(e){return this.node.build(e)+"."+this.property}}let sx=null;const W6=new Map;function Rt(i,e){if(W6.has(i)){console.warn(`THREE.TSL: Redefinition of method chaining '${i}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${i} is not a function`);W6.set(i,e)}const XNe=i=>i.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),Zwe=i=>XNe(i).split("").sort().join(""),YNe={setup(i,e){const t=e.shift();return i(vz(t),...e)},get(i,e,t){if(typeof e=="string"&&i[e]===void 0){if(i.isStackNode!==!0&&e==="assign")return(...n)=>(sx.assign(t,...n),t);if(W6.has(e)){const n=W6.get(e);return i.isStackNode?(...r)=>t.add(n(...r)):(...r)=>n(t,...r)}else{if(e==="self")return i;if(e.endsWith("Assign")&&W6.has(e.slice(0,e.length-6))){const n=W6.get(e.slice(0,e.length-6));return i.isStackNode?(...r)=>t.assign(r[0],n(...r)):(...r)=>t.assign(n(t,...r))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=XNe(e),tn(new Ywe(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=Zwe(e.slice(3).toLowerCase()),n=>tn(new M1t(i,e,tn(n)));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=Zwe(e.slice(4).toLowerCase()),()=>tn(new C1t(tn(i),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),tn(new Ywe(i,e));if(/^\d+$/.test(e)===!0)return tn(new yC(t,new am(Number(e),"uint")));if(/^get$/.test(e)===!0)return n=>tn(new A1t(t,n))}}}return Reflect.get(i,e,t)},set(i,e,t,n){return typeof e=="string"&&i[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(n[e].assign(t),!0):Reflect.set(i,e,t,n)}},jQ=new WeakMap,Qwe=new WeakMap,R1t=function(i,e=null){const t=cU(i);if(t==="node"){let n=jQ.get(i);return n===void 0&&(n=new Proxy(i,YNe),jQ.set(i,n),jQ.set(n,n)),n}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return tn(Pte(i,e));if(t==="shader")return Kt(i)}return i},P1t=function(i,e=null){for(const t in i)i[t]=tn(i[t],e);return i},N1t=function(i,e=null){const t=i.length;for(let n=0;n<t;n++)i[n]=tn(i[n],e);return i},I1t=function(i,e=null,t=null,n=null){const r=f=>tn(n!==null?Object.assign(f,n):f);let s,o=e,a,c;function u(f){let m;return o?m=/[a-z]/i.test(o)?o+"()":o:m=i.type,a!==void 0&&f.length<a?(console.error(`THREE.TSL: "${m}" parameter length is less than minimum required.`),f.concat(new Array(a-f.length).fill(0))):c!==void 0&&f.length>c?(console.error(`THREE.TSL: "${m}" parameter length exceeds limit.`),f.slice(0,c)):f}return e===null?s=(...f)=>r(new i(...p_(u(f)))):t!==null?(t=tn(t),s=(...f)=>r(new i(e,...p_(u(f)),t))):s=(...f)=>r(new i(e,...p_(u(f)))),s.setParameterLength=(...f)=>(f.length===1?a=c=f[0]:f.length===2&&([a,c]=f),s),s.setName=f=>(o=f,s),s},k1t=function(i,...e){return tn(new i(...p_(e)))};class D1t extends Wr{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,inputNodes:n}=this,r=e.getNodeProperties(t),s=t.namespace&&t.namespace===e.namespace?e.getNamespace("once"):"once";if(r[s])return r[s];let o=null;if(t.layout){let a=Qwe.get(e.constructor);a===void 0&&(a=new WeakMap,Qwe.set(e.constructor,a));let c=a.get(t);c===void 0&&(c=tn(e.buildFunctionNode(t)),a.set(t,c)),e.addInclude(c),o=tn(c.call(n))}else{const a=t.jsFunc,c=n!==null||a.length>1?a(n||[],e):a(e);o=tn(c)}return t.once&&(r[s]=o),o}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),n=e.getOutputNamespace();return t[n]=t[n]||this.setupOutput(e),t[n]}build(e,t=null){let n=null;const r=e.getBuildStage(),s=e.getNodeProperties(this),o=e.getOutputNamespace(),a=this.getOutputNode(e);if(r==="setup"){const c=e.getNamespace("initialized");s[c]!==!0&&(s[c]=!0,s[o]=this.getOutputNode(e),s[o].build(e)),n=s[o]}else r==="analyze"?a.build(e,t):r==="generate"&&(n=a.build(e,t)||"");return n}}class F1t extends Wr{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1,this.namespace=null}setLayout(e){return this.layout=e,this}call(e=null){return vz(e),tn(new D1t(this,e))}setup(){return this.call()}}const O1t=[!1,!0],B1t=[0,1,2,3],L1t=[-1,-2],KNe=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],Iie=new Map;for(const i of O1t)Iie.set(i,new am(i));const kie=new Map;for(const i of B1t)kie.set(i,new am(i,"uint"));const Die=new Map([...kie].map(i=>new am(i.value,"int")));for(const i of L1t)Die.set(i,new am(i,"int"));const gz=new Map([...Die].map(i=>new am(i.value)));for(const i of KNe)gz.set(i,new am(i));for(const i of KNe)gz.set(-i,new am(-i));const yz={bool:Iie,uint:kie,ints:Die,float:gz},Jwe=new Map([...Iie,...gz]),Pte=(i,e)=>Jwe.has(i)?Jwe.get(i):i.isNode===!0?i:new am(i,e),U1t=i=>{try{return i.getNodeType()}catch{return}},fa=function(i,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(i)&&t.every(r=>typeof r!="object"))&&(t=[jNe(i,...t)]),t.length===1&&e!==null&&e.has(t[0]))return tn(e.get(t[0]));if(t.length===1){const r=Pte(t[0],i);return U1t(r)===i?tn(r):tn(new qNe(r,i))}const n=t.map(r=>Pte(r));return tn(new T1t(n,i))}},eTe=i=>typeof i=="object"&&i!==null?i.value:i,z1t=i=>i!=null?i.nodeType||i.convertTo||(typeof i=="string"?i:null):null;function gE(i,e){return new Proxy(new F1t(i,e),YNe)}const tn=(i,e=null)=>R1t(i,e),vz=(i,e=null)=>new P1t(i,e),p_=(i,e=null)=>new N1t(i,e),Qt=(...i)=>new I1t(...i),bn=(...i)=>new k1t(...i);let V1t=0;const Kt=(i,e=null)=>{let t=null;e!==null&&(typeof e=="object"?t=e.return:(typeof e=="string"?t=e:console.error("THREE.TSL: Invalid layout type."),e=null));const n=new gE(i,t),r=(...s)=>{let o;vz(s),s[0]&&(s[0].isNode||Object.getPrototypeOf(s[0])!==Object.prototype)?o=[...s]:o=s[0];const c=n.call(o);return t==="void"&&c.toStack(),c};if(r.shaderNode=n,r.id=n.id,r.getNodeType=(...s)=>n.getNodeType(...s),r.getCacheKey=(...s)=>n.getCacheKey(...s),r.setLayout=s=>(n.setLayout(s),r),r.once=(s=null)=>(n.once=!0,n.namespace=s,r),e!==null){if(typeof e.inputs!="object"){const s={name:"fn"+V1t++,type:t,inputs:[]};for(const o in e)o!=="return"&&s.inputs.push({name:o,type:e[o]});e=s}r.setLayout(e)}return r},uU=i=>{sx=i},ZNe=()=>sx,Go=(...i)=>sx.If(...i);function QNe(i){return sx&&sx.add(i),i}Rt("toStack",QNe);const G1t=new fa("color"),It=new fa("float",yz.float),Ns=new fa("int",yz.ints),$1t=new fa("uint",yz.uint),Fie=new fa("bool",yz.bool),Tn=new fa("vec2"),y1=new fa("ivec2"),H1t=new fa("uvec2"),j1t=new fa("bvec2"),Lt=new fa("vec3"),W1t=new fa("ivec3"),q1t=new fa("uvec3"),X1t=new fa("bvec3"),$r=new fa("vec4"),Y1t=new fa("ivec4"),K1t=new fa("uvec4"),Z1t=new fa("bvec4"),Oie=new fa("mat2"),B0=new fa("mat3"),m_=new fa("mat4");Rt("toColor",G1t);Rt("toFloat",It);Rt("toInt",Ns);Rt("toUint",$1t);Rt("toBool",Fie);Rt("toVec2",Tn);Rt("toIVec2",y1);Rt("toUVec2",H1t);Rt("toBVec2",j1t);Rt("toVec3",Lt);Rt("toIVec3",W1t);Rt("toUVec3",q1t);Rt("toBVec3",X1t);Rt("toVec4",$r);Rt("toIVec4",Y1t);Rt("toUVec4",K1t);Rt("toBVec4",Z1t);Rt("toMat2",Oie);Rt("toMat3",B0);Rt("toMat4",m_);const Q1t=Qt(yC).setParameterLength(2),J1t=(i,e)=>tn(new qNe(tn(i),e));Rt("element",Q1t);Rt("convert",J1t);Rt("append",i=>(console.warn("THREE.TSL: .append() has been renamed to .toStack()."),QNe(i)));class ns extends Wr{static get type(){return"PropertyNode"}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0,this.global=!0}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const vC=(i,e)=>tn(new ns(i,e)),hU=(i,e)=>tn(new ns(i,e,!0)),Li=bn(ns,"vec4","DiffuseColor"),tTe=bn(ns,"vec3","EmissiveColor"),b1=bn(ns,"float","Roughness"),dU=bn(ns,"float","Metalness"),Nte=bn(ns,"float","Clearcoat"),fU=bn(ns,"float","ClearcoatRoughness"),q6=bn(ns,"vec3","Sheen"),Bie=bn(ns,"float","SheenRoughness"),Lie=bn(ns,"float","Iridescence"),JNe=bn(ns,"float","IridescenceIOR"),eIe=bn(ns,"float","IridescenceThickness"),Ite=bn(ns,"float","AlphaT"),Ny=bn(ns,"float","Anisotropy"),JB=bn(ns,"vec3","AnisotropyT"),g_=bn(ns,"vec3","AnisotropyB"),$c=bn(ns,"color","SpecularColor"),pU=bn(ns,"float","SpecularF90"),kte=bn(ns,"float","Shininess"),GE=bn(ns,"vec4","Output"),WQ=bn(ns,"float","dashSize"),nTe=bn(ns,"float","gapSize"),eL=bn(ns,"float","IOR"),Dte=bn(ns,"float","Transmission"),tIe=bn(ns,"float","Thickness"),nIe=bn(ns,"float","AttenuationDistance"),rIe=bn(ns,"color","AttenuationColor"),iIe=bn(ns,"float","Dispersion");class sIe extends Wr{static get type(){return"UniformGroupNode"}constructor(e,t=!1,n=1){super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const emt=i=>new sIe(i),Uie=(i,e=0)=>new sIe(i,!0,e),tmt=Uie("frame"),Er=Uie("render"),oIe=emt("object");class _C extends Nie{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=oIe}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const n=this.getSelf();return e=e.bind(n),super.onUpdate(r=>{const s=e(r,n);s!==void 0&&(this.value=s)},t)}generate(e,t){const n=this.getNodeType(e),r=this.getUniformHash(e);let s=e.getNodeFromHash(r);s===void 0&&(e.setHashNode(this,r),s=this);const o=s.getInputType(e),a=e.getUniformFromNode(s,o,e.shaderStage,this.name||e.context.label),c=e.getPropertyName(a);return e.context.label!==void 0&&delete e.context.label,e.format(c,n,t)}}const Cr=(i,e)=>{const t=z1t(e||i),n=i&&i.isNode===!0?i.node&&i.node.value||i.value:i;return tn(new _C(n,t))};class rTe extends da{static get type(){return"ArrayNode"}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const nmt=(...i)=>{let e;if(i.length===1){const t=i[0];e=new rTe(null,t.length,t)}else{const t=i[0],n=i[1];e=new rTe(t,n)}return tn(e)};Rt("toArray",(i,e)=>nmt(Array(e).fill(i)));class rmt extends da{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return Ax.join("").slice(0,n)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:n}=this,r=e.getNodeProperties(this);r.sourceNode=n,r.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:n,sourceNode:r}=e.getNodeProperties(this),s=this.needsSplitAssign(e),o=n.getNodeType(e),a=n.build(e),c=r.build(e,o),u=r.getNodeType(e),f=e.getDataFromNode(this);let m;if(f.initialized===!0)t!=="void"&&(m=a);else if(s){const v=e.getVarFromNode(this,null,o),x=e.getPropertyName(v);e.addLineFlowCode(`${x} = ${c}`,this);const T=n.node,R=T.node.context({assign:!0}).build(e);for(let M=0;M<T.components.length;M++){const O=T.components[M];e.addLineFlowCode(`${R}.${O} = ${x}[ ${M} ]`,this)}t!=="void"&&(m=a)}else m=`${a} = ${c}`,(t==="void"||u==="void")&&(e.addLineFlowCode(m,this),t!=="void"&&(m=a));return f.initialized=!0,e.format(m,o,t)}}const imt=Qt(rmt).setParameterLength(2);Rt("assign",imt);class smt extends da{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],n=this.functionNode,r=n.getInputs(e),s=this.parameters,o=(c,u)=>{const f=u.type,m=f==="pointer";let v;return m?v="&"+c.build(e):v=c.build(e,f),v};if(Array.isArray(s)){if(s.length>r.length)console.error("THREE.TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),s.length=r.length;else if(s.length<r.length)for(console.error("THREE.TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");s.length<r.length;)s.push(It(0));for(let c=0;c<s.length;c++)t.push(o(s[c],r[c]))}else for(const c of r){const u=s[c.name];u!==void 0?t.push(o(u,c)):(console.error(`THREE.TSL: Input '${c.name}' not found in 'Fn()'.`),t.push(o(It(0),c)))}return`${n.build(e,"property")}( ${t.join(", ")} )`}}const omt=(i,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?p_(e):vz(e[0]),tn(new smt(tn(i),e)));Rt("call",omt);const amt={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class Ks extends da{static get type(){return"OperatorNode"}constructor(e,t,n,...r){if(super(),r.length>0){let s=new Ks(e,t,n);for(let o=0;o<r.length-1;o++)s=new Ks(e,s,r[o]);t=s,n=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(amt[this.op],t)}getNodeType(e){const t=this.op,n=this.aNode,r=this.bNode,s=n.getNodeType(e),o=r?r.getNodeType(e):null;if(s==="void"||o==="void")return"void";if(t==="%")return s;if(t==="~"||t==="&"||t==="|"||t==="^"||t===">>"||t==="<<")return e.getIntegerType(s);if(t==="!"||t==="&&"||t==="||"||t==="^^")return"bool";if(t==="=="||t==="!="||t==="<"||t===">"||t==="<="||t===">="){const a=Math.max(e.getTypeLength(s),e.getTypeLength(o));return a>1?`bvec${a}`:"bool"}else{if(e.isMatrix(s)){if(o==="float")return s;if(e.isVector(o))return e.getVectorFromMatrix(s);if(e.isMatrix(o))return s}else if(e.isMatrix(o)){if(s==="float")return o;if(e.isVector(s))return e.getVectorFromMatrix(o)}return e.getTypeLength(o)>e.getTypeLength(s)?o:s}}generate(e,t){const n=this.op,{aNode:r,bNode:s}=this,o=this.getNodeType(e);let a=null,c=null;o!=="void"?(a=r.getNodeType(e),c=s?s.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="||n==="!="?e.isVector(a)?c=a:e.isVector(c)?a=c:a!==c&&(a=c="float"):n===">>"||n==="<<"?(a=o,c=e.changeComponentType(c,"uint")):n==="%"?(a=o,c=e.isInteger(a)&&e.isInteger(c)?c:a):e.isMatrix(a)?c==="float"?c="float":e.isVector(c)?c=e.getVectorFromMatrix(a):e.isMatrix(c)||(a=c=o):e.isMatrix(c)?a==="float"?a="float":e.isVector(a)?a=e.getVectorFromMatrix(c):a=c=o:a=c=o):a=c=o;const u=r.build(e,a),f=s?s.build(e,c):null,m=e.getFunctionOperator(n);if(t!=="void"){const v=e.renderer.coordinateSystem===jl;if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">=")return v?e.isVector(a)?e.format(`${this.getOperatorMethod(e,t)}( ${u}, ${f} )`,o,t):e.format(`( ${u} ${n} ${f} )`,o,t):e.format(`( ${u} ${n} ${f} )`,o,t);if(n==="%")return e.isInteger(c)?e.format(`( ${u} % ${f} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${u}, ${f} )`,o,t);if(n==="!"||n==="~")return e.format(`(${n}${u})`,a,t);if(m)return e.format(`${m}( ${u}, ${f} )`,o,t);if(e.isMatrix(a)&&c==="float")return e.format(`( ${f} ${n} ${u} )`,o,t);if(a==="float"&&e.isMatrix(c))return e.format(`${u} ${n} ${f}`,o,t);{let x=`( ${u} ${n} ${f} )`;return!v&&o==="bool"&&e.isVector(a)&&e.isVector(c)&&(x=`all${x}`),e.format(x,o,t)}}else if(a!=="void")return m?e.format(`${m}( ${u}, ${f} )`,o,t):e.isMatrix(a)&&c==="float"?e.format(`${f} ${n} ${u}`,o,t):e.format(`${u} ${n} ${f}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const L0=Qt(Ks,"+").setParameterLength(2,1/0).setName("add"),A0=Qt(Ks,"-").setParameterLength(2,1/0).setName("sub"),pi=Qt(Ks,"*").setParameterLength(2,1/0).setName("mul"),Zf=Qt(Ks,"/").setParameterLength(2,1/0).setName("div"),_z=Qt(Ks,"%").setParameterLength(2).setName("mod"),aIe=Qt(Ks,"==").setParameterLength(2).setName("equal"),lmt=Qt(Ks,"!=").setParameterLength(2).setName("notEqual"),cmt=Qt(Ks,"<").setParameterLength(2).setName("lessThan"),umt=Qt(Ks,">").setParameterLength(2).setName("greaterThan"),hmt=Qt(Ks,"<=").setParameterLength(2).setName("lessThanEqual"),dmt=Qt(Ks,">=").setParameterLength(2).setName("greaterThanEqual"),fmt=Qt(Ks,"&&").setParameterLength(2,1/0).setName("and"),pmt=Qt(Ks,"||").setParameterLength(2,1/0).setName("or"),mmt=Qt(Ks,"!").setParameterLength(1).setName("not"),gmt=Qt(Ks,"^^").setParameterLength(2).setName("xor"),ymt=Qt(Ks,"&").setParameterLength(2).setName("bitAnd"),vmt=Qt(Ks,"~").setParameterLength(2).setName("bitNot"),_mt=Qt(Ks,"|").setParameterLength(2).setName("bitOr"),xmt=Qt(Ks,"^").setParameterLength(2).setName("bitXor"),bmt=Qt(Ks,"<<").setParameterLength(2).setName("shiftLeft"),Smt=Qt(Ks,">>").setParameterLength(2).setName("shiftRight"),wmt=Kt(([i])=>(i.addAssign(1),i)),Tmt=Kt(([i])=>(i.subAssign(1),i)),Emt=Kt(([i])=>{const e=Ns(i).toConst();return i.addAssign(1),e}),Mmt=Kt(([i])=>{const e=Ns(i).toConst();return i.subAssign(1),e});Rt("add",L0);Rt("sub",A0);Rt("mul",pi);Rt("div",Zf);Rt("mod",_z);Rt("equal",aIe);Rt("notEqual",lmt);Rt("lessThan",cmt);Rt("greaterThan",umt);Rt("lessThanEqual",hmt);Rt("greaterThanEqual",dmt);Rt("and",fmt);Rt("or",pmt);Rt("not",mmt);Rt("xor",gmt);Rt("bitAnd",ymt);Rt("bitNot",vmt);Rt("bitOr",_mt);Rt("bitXor",xmt);Rt("shiftLeft",bmt);Rt("shiftRight",Smt);Rt("incrementBefore",wmt);Rt("decrementBefore",Tmt);Rt("increment",Emt);Rt("decrement",Mmt);const Cmt=(i,e)=>(console.warn('THREE.TSL: "remainder()" is deprecated. Use "mod( int( ... ) )" instead.'),_z(i,e)),Amt=(i,e)=>(console.warn('THREE.TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),_z(Ns(i),Ns(e)));Rt("remainder",Cmt);Rt("modInt",Amt);class it extends da{static get type(){return"MathNode"}constructor(e,t,n=null,r=null){if(super(),(e===it.MAX||e===it.MIN)&&arguments.length>3){let s=new it(e,t,n);for(let o=2;o<arguments.length-1;o++)s=new it(e,s,arguments[o]);t=s,n=arguments[arguments.length-1],r=null}this.method=e,this.aNode=t,this.bNode=n,this.cNode=r,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(n)?0:e.getTypeLength(n),a=e.isMatrix(r)?0:e.getTypeLength(r);return s>o&&s>a?t:o>a?n:a>s?r:t}getNodeType(e){const t=this.method;return t===it.LENGTH||t===it.DISTANCE||t===it.DOT?"float":t===it.CROSS?"vec3":t===it.ALL||t===it.ANY?"bool":t===it.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:n,method:r}=this;let s=null;if(r===it.ONE_MINUS)s=A0(1,t);else if(r===it.RECIPROCAL)s=Zf(1,t);else if(r===it.DIFFERENCE)s=Hu(A0(t,n));else if(r===it.TRANSFORM_DIRECTION){let o=t,a=n;e.isMatrix(o.getNodeType(e))?a=$r(Lt(a),0):o=$r(Lt(o),0);const c=pi(o,a).xyz;s=VM(c)}return s!==null?s:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let r=this.method;const s=this.getNodeType(e),o=this.getInputType(e),a=this.aNode,c=this.bNode,u=this.cNode,f=e.renderer.coordinateSystem;if(r===it.NEGATE)return e.format("( - "+a.build(e,o)+" )",s,t);{const m=[];return r===it.CROSS?m.push(a.build(e,s),c.build(e,s)):f===jl&&r===it.STEP?m.push(a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":o),c.build(e,o)):f===jl&&(r===it.MIN||r===it.MAX)?m.push(a.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):r===it.REFRACT?m.push(a.build(e,o),c.build(e,o),u.build(e,"float")):r===it.MIX?m.push(a.build(e,o),c.build(e,o),u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":o)):(f===V2&&r===it.ATAN&&c!==null&&(r="atan2"),e.shaderStage!=="fragment"&&(r===it.DFDX||r===it.DFDY)&&(console.warn(`THREE.TSL: '${r}' is not supported in the ${e.shaderStage} stage.`),r="/*"+r+"*/"),m.push(a.build(e,o)),c!==null&&m.push(c.build(e,o)),u!==null&&m.push(u.build(e,o))),e.format(`${e.getMethod(r,s)}( ${m.join(", ")} )`,s,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}it.ALL="all";it.ANY="any";it.RADIANS="radians";it.DEGREES="degrees";it.EXP="exp";it.EXP2="exp2";it.LOG="log";it.LOG2="log2";it.SQRT="sqrt";it.INVERSE_SQRT="inversesqrt";it.FLOOR="floor";it.CEIL="ceil";it.NORMALIZE="normalize";it.FRACT="fract";it.SIN="sin";it.COS="cos";it.TAN="tan";it.ASIN="asin";it.ACOS="acos";it.ATAN="atan";it.ABS="abs";it.SIGN="sign";it.LENGTH="length";it.NEGATE="negate";it.ONE_MINUS="oneMinus";it.DFDX="dFdx";it.DFDY="dFdy";it.ROUND="round";it.RECIPROCAL="reciprocal";it.TRUNC="trunc";it.FWIDTH="fwidth";it.TRANSPOSE="transpose";it.BITCAST="bitcast";it.EQUALS="equals";it.MIN="min";it.MAX="max";it.STEP="step";it.REFLECT="reflect";it.DISTANCE="distance";it.DIFFERENCE="difference";it.DOT="dot";it.CROSS="cross";it.POW="pow";it.TRANSFORM_DIRECTION="transformDirection";it.MIX="mix";it.CLAMP="clamp";it.REFRACT="refract";it.SMOOTHSTEP="smoothstep";it.FACEFORWARD="faceforward";const Rmt=It(1e-6),Pmt=It(Math.PI),Nmt=Qt(it,it.ALL).setParameterLength(1),Imt=Qt(it,it.ANY).setParameterLength(1),kmt=Qt(it,it.RADIANS).setParameterLength(1),Dmt=Qt(it,it.DEGREES).setParameterLength(1),lIe=Qt(it,it.EXP).setParameterLength(1),zM=Qt(it,it.EXP2).setParameterLength(1),cIe=Qt(it,it.LOG).setParameterLength(1),U1=Qt(it,it.LOG2).setParameterLength(1),zie=Qt(it,it.SQRT).setParameterLength(1),Fmt=Qt(it,it.INVERSE_SQRT).setParameterLength(1),a4=Qt(it,it.FLOOR).setParameterLength(1),Vie=Qt(it,it.CEIL).setParameterLength(1),VM=Qt(it,it.NORMALIZE).setParameterLength(1),s3=Qt(it,it.FRACT).setParameterLength(1),pd=Qt(it,it.SIN).setParameterLength(1),m2=Qt(it,it.COS).setParameterLength(1),Omt=Qt(it,it.TAN).setParameterLength(1),Bmt=Qt(it,it.ASIN).setParameterLength(1),uIe=Qt(it,it.ACOS).setParameterLength(1),hIe=Qt(it,it.ATAN).setParameterLength(1,2),Hu=Qt(it,it.ABS).setParameterLength(1),mU=Qt(it,it.SIGN).setParameterLength(1),z1=Qt(it,it.LENGTH).setParameterLength(1),Lmt=Qt(it,it.NEGATE).setParameterLength(1),Umt=Qt(it,it.ONE_MINUS).setParameterLength(1),dIe=Qt(it,it.DFDX).setParameterLength(1),fIe=Qt(it,it.DFDY).setParameterLength(1),zmt=Qt(it,it.ROUND).setParameterLength(1),Vmt=Qt(it,it.RECIPROCAL).setParameterLength(1),Gmt=Qt(it,it.TRUNC).setParameterLength(1),$mt=Qt(it,it.FWIDTH).setParameterLength(1),Hmt=Qt(it,it.TRANSPOSE).setParameterLength(1),jmt=(i,e)=>(console.warn('THREE.TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),aIe(i,e)),ox=Qt(it,it.MIN).setParameterLength(2,1/0),Jl=Qt(it,it.MAX).setParameterLength(2,1/0),pIe=Qt(it,it.STEP).setParameterLength(2),Wmt=Qt(it,it.REFLECT).setParameterLength(2),qmt=Qt(it,it.DISTANCE).setParameterLength(2),Xmt=Qt(it,it.DIFFERENCE).setParameterLength(2),Gie=Qt(it,it.DOT).setParameterLength(2),mIe=Qt(it,it.CROSS).setParameterLength(2),xz=Qt(it,it.POW).setParameterLength(2),gIe=Qt(it,it.POW,2).setParameterLength(1),Ymt=Qt(it,it.POW,3).setParameterLength(1),Kmt=Qt(it,it.POW,4).setParameterLength(1),Zmt=Qt(it,it.TRANSFORM_DIRECTION).setParameterLength(2),Qmt=i=>pi(mU(i),xz(Hu(i),1/3)),yIe=i=>Gie(i,i),zs=Qt(it,it.MIX).setParameterLength(3),em=(i,e=0,t=1)=>tn(new it(it.CLAMP,tn(i),tn(e),tn(t))),vIe=i=>em(i),_Ie=Qt(it,it.REFRACT).setParameterLength(3),K2=Qt(it,it.SMOOTHSTEP).setParameterLength(3),Jmt=Qt(it,it.FACEFORWARD).setParameterLength(3),egt=Kt(([i])=>{const n=43758.5453,r=Gie(i.xy,Tn(12.9898,78.233)),s=_z(r,Pmt);return s3(pd(s).mul(n))}),tgt=(i,e,t)=>zs(e,t,i),ngt=(i,e,t)=>K2(e,t,i),rgt=(i,e)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),hIe(i,e));Rt("all",Nmt);Rt("any",Imt);Rt("equals",jmt);Rt("radians",kmt);Rt("degrees",Dmt);Rt("exp",lIe);Rt("exp2",zM);Rt("log",cIe);Rt("log2",U1);Rt("sqrt",zie);Rt("inverseSqrt",Fmt);Rt("floor",a4);Rt("ceil",Vie);Rt("normalize",VM);Rt("fract",s3);Rt("sin",pd);Rt("cos",m2);Rt("tan",Omt);Rt("asin",Bmt);Rt("acos",uIe);Rt("atan",hIe);Rt("abs",Hu);Rt("sign",mU);Rt("length",z1);Rt("lengthSq",yIe);Rt("negate",Lmt);Rt("oneMinus",Umt);Rt("dFdx",dIe);Rt("dFdy",fIe);Rt("round",zmt);Rt("reciprocal",Vmt);Rt("trunc",Gmt);Rt("fwidth",$mt);Rt("atan2",rgt);Rt("min",ox);Rt("max",Jl);Rt("step",pIe);Rt("reflect",Wmt);Rt("distance",qmt);Rt("dot",Gie);Rt("cross",mIe);Rt("pow",xz);Rt("pow2",gIe);Rt("pow3",Ymt);Rt("pow4",Kmt);Rt("transformDirection",Zmt);Rt("mix",tgt);Rt("clamp",em);Rt("refract",_Ie);Rt("smoothstep",ngt);Rt("faceForward",Jmt);Rt("difference",Xmt);Rt("saturate",vIe);Rt("cbrt",Qmt);Rt("transpose",Hmt);Rt("rand",egt);class igt extends Wr{static get type(){return"ConditionalNode"}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(t===void 0)return this.setup(e),this.getNodeType(e);const r=t.getNodeType(e);if(n!==null){const s=n.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(r))return s}return r}setup(e){const t=this.condNode.cache(),n=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,s=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=s,r!==null&&(e.getDataFromNode(r).parentNodeBlock=s);const o=e.getNodeProperties(this);o.condNode=t,o.ifNode=n.context({nodeBlock:n}),o.elseNode=r?r.context({nodeBlock:r}):null}generate(e,t){const n=this.getNodeType(e),r=e.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;const{condNode:s,ifNode:o,elseNode:a}=e.getNodeProperties(this),c=e.currentFunctionNode,u=t!=="void",f=u?vC(n).build(e):"";r.nodeProperty=f;const m=s.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${m} ) {

`).addFlowTab();let v=o.build(e,n);if(v&&(u?v=f+" = "+v+";":(v="return "+v+";",c===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),v="// "+v))),e.removeFlowTab().addFlowCode(e.tab+"	"+v+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let x=a.build(e,n);x&&(u?x=f+" = "+x+";":(x="return "+x+";",c===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),x="// "+x))),e.removeFlowTab().addFlowCode(e.tab+"	"+x+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(f,n,t)}}const ql=Qt(igt).setParameterLength(2,3);Rt("select",ql);const sgt=(...i)=>(console.warn("THREE.TSL: cond() has been renamed to select()."),ql(...i));Rt("cond",sgt);class xIe extends Wr{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}generate(e,t){const n=e.getContext();e.setContext({...e.context,...this.value});const r=this.node.build(e,t);return e.setContext(n),r}}const $ie=Qt(xIe).setParameterLength(1,2),ogt=(i,e)=>$ie(i,{label:e});Rt("context",$ie);Rt("label",ogt);class tL extends Wr{static get type(){return"VarNode"}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n,this.parents=!0}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:n,readOnly:r}=this,{renderer:s}=e,o=s.backend.isWebGPUBackend===!0;let a=!1,c=!1;r&&(a=e.isDeterministic(t),c=o?r:a);const u=e.getVectorType(this.getNodeType(e)),f=t.build(e,u),m=e.getVarFromNode(this,n,u,void 0,c),v=e.getPropertyName(m);let x=v;if(c)if(o)x=a?`const ${v}`:`let ${v}`;else{const T=e.getArrayCount(t);x=`const ${e.getVar(m.type,v,T)}`}return e.addLineFlowCode(`${x} = ${f}`,this),v}}const Hie=Qt(tL),agt=(i,e=null)=>Hie(i,e).toStack(),lgt=(i,e=null)=>Hie(i,e,!0).toStack();Rt("toVar",agt);Rt("toConst",lgt);const cgt=i=>(console.warn('TSL: "temp( node )" is deprecated. Use "Var( node )" or "node.toVar()" instead.'),Hie(i));Rt("temp",cgt);class ugt extends Wr{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(n===void 0){const r=this.name,s=this.getNodeType(e),o=this.interpolationType,a=this.interpolationSampling;t.varying=n=e.getVaryingFromNode(this,r,s,o,a),t.node=this.node}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(lB.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(lB.VERTEX,this.node)}generate(e){const t=e.getNodeProperties(this),n=this.setupVarying(e);if(t.propertyName===void 0){const r=this.getNodeType(e),s=e.getPropertyName(n,lB.VERTEX);e.flowNodeFromShaderStage(lB.VERTEX,this.node,r,s),t.propertyName=s}return e.getPropertyName(n)}}const Rd=Qt(ugt).setParameterLength(1,2),hgt=i=>Rd(i);Rt("toVarying",Rd);Rt("toVertexStage",hgt);Rt("varying",(...i)=>(console.warn("THREE.TSL: .varying() has been renamed to .toVarying()."),Rd(...i)));Rt("vertexStage",(...i)=>(console.warn("THREE.TSL: .vertexStage() has been renamed to .toVertexStage()."),Rd(...i)));const dgt=Kt(([i])=>{const e=i.mul(.9478672986).add(.0521327014).pow(2.4),t=i.mul(.0773993808),n=i.lessThanEqual(.04045);return zs(e,t,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),fgt=Kt(([i])=>{const e=i.pow(.41666).mul(1.055).sub(.055),t=i.mul(12.92),n=i.lessThanEqual(.0031308);return zs(e,t,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),jie="WorkingColorSpace",pgt="OutputColorSpace";class bIe extends da{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===jie?rr.workingColorSpace:t===pgt?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let s=t;return rr.enabled===!1||n===r||!n||!r||(rr.getTransfer(n)===zn&&(s=$r(dgt(s.rgb),s.a)),rr.getPrimaries(n)!==rr.getPrimaries(r)&&(s=$r(B0(rr._getMatrix(new Or,n,r)).mul(s.rgb),s.a)),rr.getTransfer(r)===zn&&(s=$r(fgt(s.rgb),s.a))),s}}const mgt=(i,e)=>tn(new bIe(tn(i),jie,e)),Wie=(i,e)=>tn(new bIe(tn(i),e,jie));Rt("workingToColorSpace",mgt);Rt("colorSpaceToWorking",Wie);let ggt=class extends yC{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}};class SIe extends Wr{static get type(){return"ReferenceBaseNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=ci.OBJECT}setGroup(e){return this.group=e,this}element(e){return tn(new ggt(this,tn(e)))}setNodeType(e){const t=Cr(null,e).getSelf();this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const ygt=(i,e,t)=>tn(new SIe(i,e,t));class vgt extends SIe{static get type(){return"RendererReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(Er)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const _gt=(i,e,t=null)=>tn(new vgt(i,e,t));class xgt extends da{static get type(){return"ToneMappingNode"}constructor(e,t=Sgt,n=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return aU(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,n=this.toneMapping;if(n===Yl)return t;let r=null;const s=e.renderer.library.getToneMappingFunction(n);return s!==null?r=$r(s(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),r=t),r}}const bgt=(i,e,t)=>tn(new xgt(i,tn(e),tn(t))),Sgt=_gt("toneMappingExposure","float");Rt("toneMapping",(i,e,t)=>bgt(e,t,i));class wgt extends Nie{static get type(){return"BufferAttributeNode"}constructor(e,t=null,n=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=r,this.usage=IL,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),n=this.value,r=e.getTypeLength(t),s=this.bufferStride||r,o=this.bufferOffset,a=n.isInterleavedBuffer===!0?n:new oAe(n,s),c=new Kqe(a,r,o);a.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(n);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=r,s=r):s=Rd(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const qie=(i,e=null,t=0,n=0)=>tn(new wgt(i,e,t,n)),Tgt=(i,e=null,t=0,n=0)=>qie(i,e,t,n).setUsage(O6),iTe=(i,e=null,t=0,n=0)=>qie(i,e,t,n).setInstanced(!0),sTe=(i,e=null,t=0,n=0)=>Tgt(i,e,t,n).setInstanced(!0);Rt("toAttribute",i=>qie(i.value));class Egt extends Wr{static get type(){return"ComputeNode"}constructor(e,t,n=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=ci.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let n=t[0];for(let r=1;r<t.length;r++)n*=t[r];this.dispatchCount=Math.ceil(e/n)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const n=e.getNodeProperties(this);n.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:n}=e;if(n==="compute"){const r=this.computeNode.build(e,"void");r!==""&&e.addLineFlowCode(r,this)}else{const s=e.getNodeProperties(this).outputComputeNode;if(s)return s.build(e,t)}}}const Mgt=(i,e,t)=>tn(new Egt(tn(i),e,t));Rt("compute",Mgt);class Cgt extends Wr{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){const n=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const s=this.node.build(e,...t);return e.setCache(n),s}}const nL=(i,e)=>tn(new Cgt(tn(i),e)),Agt=(i,e)=>i.context({namespace:e});Rt("cache",nL);class Rgt extends Wr{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const Pgt=Qt(Rgt).setParameterLength(2);Rt("bypass",Pgt);class wIe extends Wr{static get type(){return"RemapNode"}constructor(e,t,n,r=It(0),s=It(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=r,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:r,outHighNode:s,doClamp:o}=this;let a=e.sub(t).div(n.sub(t));return o===!0&&(a=a.clamp()),a.mul(s.sub(r)).add(r)}}const Ngt=Qt(wIe,null,null,{doClamp:!1}).setParameterLength(3,5),Igt=Qt(wIe).setParameterLength(3,5);Rt("remap",Ngt);Rt("remapClamp",Igt);class rL extends Wr{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const n=this.getNodeType(e),r=this.snippet;if(n==="void")e.addLineFlowCode(r,this);else return e.format(r,n,t)}}const ax=Qt(rL).setParameterLength(1,2),kgt=i=>(i?ql(i,ax("discard")):ax("discard")).toStack();Rt("discard",kgt);class Dgt extends da{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setup({context:e}){let t=this.colorNode||e.color;const n=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||Yl,r=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Xa;return n!==Yl&&(t=t.toneMapping(n)),r!==Xa&&r!==rr.workingColorSpace&&(t=t.workingToColorSpace(r)),t}}const Fgt=(i,e=null,t=null)=>tn(new Dgt(tn(i),e,t));Rt("renderOutput",Fgt);class Ogt extends da{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,n=this.node.build(e),r="--- TSL debug - "+e.shaderStage+" shader ---",s="-".repeat(r.length);let o="";return o+="// #"+r+`#
`,o+=e.flow.code.replace(/^\t/mg,"")+`
`,o+="/* ... */ "+n+` /* ... */
`,o+="// #"+s+`#
`,t!==null?t(e,o):console.log(o),n}}const Bgt=(i,e=null)=>tn(new Ogt(tn(i),e));Rt("debug",Bgt);class TIe extends Wr{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const r=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(s),a=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(a.name,o,n):Rd(this).build(e,n)}else return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Z2=(i,e=null)=>tn(new TIe(i,e)),xC=(i=0)=>Z2("uv"+(i>0?i:""),"vec2");class Lgt extends Wr{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),r=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${r} )`,this.getNodeType(e),t)}}const y_=Qt(Lgt).setParameterLength(1,2);class Ugt extends _C{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=ci.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&n.width!==void 0){const{width:r,height:s}=n;this.value=Math.log2(Math.max(r,s))}}}const zgt=Qt(Ugt).setParameterLength(1),EIe=new Ao;class Rx extends _C{static get type(){return"TextureNode"}constructor(e=EIe,t=null,n=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=ci.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===fs?"uvec4":this.value.type===qa?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return xC(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Cr(this.value.matrix)),this._matrixUniform.mul(Lt(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?ci.OBJECT:ci.NONE,this}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.image instanceof ImageBitmap&&n.flipY===!0||n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0||n.isDepthTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(Ns(y_(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let r=this.uvNode;(r===null||e.context.forceUVContext===!0)&&e.context.getUV&&(r=e.context.getUV(this,e)),r||(r=this.getDefaultUV()),this.updateMatrix===!0&&(r=this.getTransformedUV(r)),r=this.setupUV(e,r);let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=r,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,n,r,s,o,a,c){const u=this.value;let f;return r?f=e.generateTextureLevel(u,t,n,r,o):s?f=e.generateTextureBias(u,t,n,s,o):c?f=e.generateTextureGrad(u,t,n,c,o):a?f=e.generateTextureCompare(u,t,n,a,o):this.sampler===!1?f=e.generateTextureLoad(u,t,n,o):f=e.generateTexture(u,t,n,o),f}generate(e,t){const n=this.value,r=e.getNodeProperties(this),s=super.generate(e,"property");if(/^sampler/.test(t))return s+"_sampler";if(e.isReference(t))return s;{const o=e.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:f,levelNode:m,biasNode:v,compareNode:x,depthNode:T,gradNode:P}=r,R=this.generateUV(e,f),M=m?m.build(e,"float"):null,O=v?v.build(e,"float"):null,C=T?T.build(e,"int"):null,L=x?x.build(e,"float"):null,Y=P?[P[0].build(e,"vec2"),P[1].build(e,"vec2")]:null,J=e.getVarFromNode(this);a=e.getPropertyName(J);const z=this.generateSnippet(e,s,R,M,O,C,L,Y);e.addLineFlowCode(`${a} = ${z}`,this),o.snippet=z,o.propertyName=a}let c=a;const u=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(c=Wie(ax(c,u),n.colorSpace).setup(e).build(e,u)),e.format(c,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=tn(e),t.referenceNode=this.getSelf(),tn(t)}blur(e){const t=this.clone();t.biasNode=tn(e).mul(zgt(t)),t.referenceNode=this.getSelf();const n=t.value;return t.generateMipmaps===!1&&(n&&n.generateMipmaps===!1||n.minFilter===es||n.magFilter===es)&&(console.warn("THREE.TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),tn(t)}level(e){const t=this.clone();return t.levelNode=tn(e),t.referenceNode=this.getSelf(),tn(t)}size(e){return y_(this,e)}bias(e){const t=this.clone();return t.biasNode=tn(e),t.referenceNode=this.getSelf(),tn(t)}compare(e){const t=this.clone();return t.compareNode=tn(e),t.referenceNode=this.getSelf(),tn(t)}grad(e,t){const n=this.clone();return n.gradNode=[tn(e),tn(t)],n.referenceNode=this.getSelf(),tn(n)}depth(e){const t=this.clone();return t.depthNode=tn(e),t.referenceNode=this.getSelf(),tn(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e}}const Vgt=Qt(Rx).setParameterLength(1,4).setName("texture"),Pi=(i=EIe,e=null,t=null,n=null)=>{let r;return i&&i.isTextureNode===!0?(r=tn(i.clone()),r.referenceNode=i.getSelf(),e!==null&&(r.uvNode=tn(e)),t!==null&&(r.levelNode=tn(t)),n!==null&&(r.biasNode=tn(n))):r=Vgt(i,e,t,n),r},id=(...i)=>Pi(...i).setSampler(!1);class MIe extends _C{static get type(){return"BufferNode"}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const CIe=(i,e,t)=>tn(new MIe(i,e,t));class Ggt extends yC{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,n)}}class $gt extends MIe{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?cU(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=ci.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let r=0;r<e.length;r++){const s=r*4;t[s]=e[r]}else if(n==="color")for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.r,t[s+1]=o.g,t[s+2]=o.b||0}else if(n==="mat2")for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+3]=o.elements[3]}else if(n==="mat3")for(let r=0;r<e.length;r++){const s=r*16,o=e[r];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+4]=o.elements[3],t[s+5]=o.elements[4],t[s+6]=o.elements[5],t[s+8]=o.elements[6],t[s+9]=o.elements[7],t[s+10]=o.elements[8],t[s+15]=1}else if(n==="mat4")for(let r=0;r<e.length;r++){const s=r*16,o=e[r];for(let a=0;a<o.elements.length;a++)t[s+a]=o.elements[a]}else for(let r=0;r<e.length;r++){const s=r*4,o=e[r];t[s]=o.x,t[s+1]=o.y,t[s+2]=o.z||0,t[s+3]=o.w||0}}setup(e){const t=this.array.length,n=this.elementType;let r=Float32Array;const s=this.paddedType,o=e.getTypeLength(s);return n.charAt(0)==="i"&&(r=Int32Array),n.charAt(0)==="u"&&(r=Uint32Array),this.value=new r(t*o),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return tn(new Ggt(this,tn(e)))}}const Vf=(i,e)=>tn(new $gt(i,e));class Hgt extends Wr{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const bz=Qt(Hgt).setParameterLength(1),AIe=Cr(0,"uint").label("u_cameraIndex").setGroup(Uie("cameraIndex")).toVarying("v_cameraIndex"),Uy=Cr("float").label("cameraNear").setGroup(Er).onRenderUpdate(({camera:i})=>i.near),zy=Cr("float").label("cameraFar").setGroup(Er).onRenderUpdate(({camera:i})=>i.far),Xie=Kt(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const r of i.cameras)t.push(r.projectionMatrix);e=Vf(t).setGroup(Er).label("cameraProjectionMatrices").element(i.isMultiViewCamera?bz("gl_ViewID_OVR"):AIe).toVar("cameraProjectionMatrix")}else e=Cr("mat4").label("cameraProjectionMatrix").setGroup(Er).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),lm=Kt(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const r of i.cameras)t.push(r.matrixWorldInverse);e=Vf(t).setGroup(Er).label("cameraViewMatrices").element(i.isMultiViewCamera?bz("gl_ViewID_OVR"):AIe).toVar("cameraViewMatrix")}else e=Cr("mat4").label("cameraViewMatrix").setGroup(Er).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),jgt=Cr(new be).label("cameraPosition").setGroup(Er).onRenderUpdate(({camera:i},e)=>e.value.setFromMatrixPosition(i.matrixWorld)),oTe=new nm;class hs extends Wr{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=ci.OBJECT,this.uniformNode=new _C(null)}getNodeType(){const e=this.scope;if(e===hs.WORLD_MATRIX)return"mat4";if(e===hs.POSITION||e===hs.VIEW_POSITION||e===hs.DIRECTION||e===hs.SCALE)return"vec3";if(e===hs.RADIUS)return"float"}update(e){const t=this.object3d,n=this.uniformNode,r=this.scope;if(r===hs.WORLD_MATRIX)n.value=t.matrixWorld;else if(r===hs.POSITION)n.value=n.value||new be,n.value.setFromMatrixPosition(t.matrixWorld);else if(r===hs.SCALE)n.value=n.value||new be,n.value.setFromMatrixScale(t.matrixWorld);else if(r===hs.DIRECTION)n.value=n.value||new be,t.getWorldDirection(n.value);else if(r===hs.VIEW_POSITION){const s=e.camera;n.value=n.value||new be,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(s.matrixWorldInverse)}else if(r===hs.RADIUS){const s=e.object.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),oTe.copy(s.boundingSphere).applyMatrix4(t.matrixWorld),n.value=oTe.radius}}generate(e){const t=this.scope;return t===hs.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===hs.POSITION||t===hs.VIEW_POSITION||t===hs.DIRECTION||t===hs.SCALE?this.uniformNode.nodeType="vec3":t===hs.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}hs.WORLD_MATRIX="worldMatrix";hs.POSITION="position";hs.SCALE="scale";hs.VIEW_POSITION="viewPosition";hs.DIRECTION="direction";hs.RADIUS="radius";const Wgt=Qt(hs,hs.POSITION).setParameterLength(1);class oh extends hs{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}oh.DIRECTION;const M4=bn(oh,oh.WORLD_MATRIX);oh.POSITION;oh.SCALE;oh.VIEW_POSITION;oh.RADIUS;const qgt=Cr(new Or).onObjectUpdate(({object:i},e)=>e.value.getNormalMatrix(i.matrixWorld)),Sz=Kt(i=>i.renderer.overrideNodes.modelViewMatrix||Xgt).once()().toVar("modelViewMatrix"),Xgt=lm.mul(M4),aTe=Kt(i=>(i.context.isHighPrecisionModelViewMatrix=!0,Cr("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),lTe=Kt(i=>{const e=i.context.isHighPrecisionModelViewMatrix;return Cr("mat3").onObjectUpdate(({object:t,camera:n})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),wz=Z2("position","vec3"),Hl=wz.toVarying("positionLocal"),cTe=wz.toVarying("positionPrevious"),GM=Kt(i=>M4.mul(Hl).xyz.toVarying(i.getNamespace("v_positionWorld")),"vec3").once("POSITION")(),RIe=Kt(i=>Hl.transformDirection(M4).toVarying(i.getNamespace("v_positionWorldDirection")).normalize().toVar("positionWorldDirection"),"vec3").once("POSITION")(),aa=Kt(i=>i.context.setupPositionView().toVarying(i.getNamespace("v_positionView")),"vec3").once("POSITION")(),fo=aa.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");class Ygt extends Wr{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:n}=e;return t.coordinateSystem===jl&&n.side===Ui?"false":e.getFrontFacing()}}const Kgt=bn(Ygt),Tz=It(Kgt).mul(2).sub(1),PIe=Z2("normal","vec3"),Qf=Kt(i=>i.geometry.hasAttribute("normal")===!1?(console.warn('THREE.TSL: Vertex attribute "normal" not found on geometry.'),Lt(0,1,0)):PIe,"vec3").once()().toVar("normalLocal"),Zgt=aa.dFdx().cross(aa.dFdy()).normalize().toVar("normalFlat"),Jf=Kt(i=>{let e;return i.material.flatShading===!0?e=Zgt:e=Rd(NIe(Qf),"v_normalView").normalize(),e},"vec3").once()().toVar("normalView"),Yie=Kt(i=>{let e=Jf.transformDirection(lm);return i.material.flatShading!==!0&&(e=Rd(e,"v_normalWorld")),e},"vec3").once()().normalize().toVar("normalWorld"),ia=Kt(i=>{let e=i.context.setupNormal().context({getUV:null});return i.material.flatShading!==!0&&(e=e.mul(Tz)),e},"vec3").once()().toVar("transformedNormalView"),Kie=ia.transformDirection(lm).toVar("transformedNormalWorld"),yE=Kt(i=>{let e=i.context.setupClearcoatNormal().context({getUV:null});return i.material.flatShading!==!0&&(e=e.mul(Tz)),e},"vec3").once()().toVar("transformedClearcoatNormalView"),Qgt=Kt(([i,e=M4])=>{const t=B0(e),n=i.div(Lt(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(n).xyz}),NIe=Kt(([i],e)=>{const t=e.renderer.overrideNodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(i);const n=qgt.mul(i);return lm.transformDirection(n)}),uTe=new Mo,qQ=new Vn,Jgt=Cr(0).onReference(({material:i})=>i).onObjectUpdate(({material:i})=>i.refractionRatio),XQ=Cr(1).onReference(({material:i})=>i).onObjectUpdate(function({material:i,scene:e}){return i.envMap?i.envMapIntensity:e.environmentIntensity}),IIe=Cr(new Vn).onReference(function(i){return i.material}).onObjectUpdate(function({material:i,scene:e}){const t=e.environment!==null&&i.envMap===null?e.environmentRotation:i.envMapRotation;return t?(uTe.copy(t),qQ.makeRotationFromEuler(uTe)):qQ.identity(),qQ}),e2t=fo.negate().reflect(ia),t2t=fo.negate().refract(ia,Jgt),n2t=e2t.transformDirection(lm).toVar("reflectVector"),r2t=t2t.transformDirection(lm).toVar("reflectVector"),i2t=new vx;class s2t extends Rx{static get type(){return"CubeTextureNode"}constructor(e,t=null,n=null,r=null){super(e,t,n,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===Wf?n2t:e.mapping===qf?r2t:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),Lt(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return(e.renderer.coordinateSystem===V2||!n.isRenderTargetTexture)&&(t=Lt(t.x.negate(),t.yz)),IIe.mul(t)}generateUV(e,t){return t.build(e,"vec3")}}const o2t=Qt(s2t).setParameterLength(1,4).setName("cubeTexture"),$M=(i=i2t,e=null,t=null,n=null)=>{let r;return i&&i.isCubeTextureNode===!0?(r=tn(i.clone()),r.referenceNode=i.getSelf(),e!==null&&(r.uvNode=tn(e)),t!==null&&(r.levelNode=tn(t)),n!==null&&(r.biasNode=tn(n))):r=o2t(i,e,t,n),r};class a2t extends yC{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}}class Zie extends Wr{static get type(){return"ReferenceNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=ci.OBJECT}element(e){return tn(new a2t(this,tn(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;this.count!==null?t=CIe(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Vf(null,e):e==="texture"?t=Pi(null):e==="cubeTexture"?t=$M(null):t=Cr(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const vs=(i,e,t)=>tn(new Zie(i,e,t)),hTe=(i,e,t,n)=>tn(new Zie(i,e,n,t));class l2t extends Zie{static get type(){return"MaterialReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const b2=(i,e,t=null)=>tn(new l2t(i,e,t)),kIe=Kt(i=>(i.geometry.hasAttribute("tangent")===!1&&i.geometry.computeTangents(),Z2("tangent","vec4")))(),Qie=kIe.xyz.toVar("tangentLocal"),DIe=Sz.mul($r(Qie,0)).xyz.toVarying("v_tangentView").normalize().toVar("tangentView"),c2t=Kt(([i,e],t)=>{let n=i.mul(kIe.w).xyz;return t.material.flatShading!==!0&&(n=Rd(n,e)),n}).once(),u2t=c2t(Jf.cross(DIe),"v_bitangentView").normalize().toVar("bitangentView"),vE=B0(DIe,u2t,Jf),h2t=(()=>{let i=g_.cross(fo);return i=i.cross(g_).normalize(),i=zs(i,ia,Ny.mul(b1.oneMinus()).oneMinus().pow2().pow2()).normalize(),i})(),d2t=Kt(i=>{const{eye_pos:e,surf_norm:t,mapN:n,uv:r}=i,s=e.dFdx(),o=e.dFdy(),a=r.dFdx(),c=r.dFdy(),u=t,f=o.cross(u),m=u.cross(s),v=f.mul(a.x).add(m.mul(c.x)),x=f.mul(a.y).add(m.mul(c.y)),T=v.dot(v).max(x.dot(x)),P=Tz.mul(T.inverseSqrt());return L0(v.mul(n.x,P),x.mul(n.y,P),u.mul(n.z)).normalize()});class f2t extends da{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=j1}setup(e){const{normalMapType:t,scaleNode:n}=this;let r=this.node.mul(2).sub(1);n!==null&&(r=Lt(r.xy.mul(n),r.z));let s=null;return t===WCe?s=NIe(r):t===j1&&(e.hasGeometryAttribute("tangent")===!0?s=vE.mul(r).normalize():s=d2t({eye_pos:aa,surf_norm:Jf,mapN:r,uv:xC()})),s}}const dTe=Qt(f2t).setParameterLength(1,2),p2t=Kt(({textureNode:i,bumpScale:e})=>{const t=r=>i.cache().context({getUV:s=>r(s.uvNode||xC()),forceUVContext:!0}),n=It(t(r=>r));return Tn(It(t(r=>r.add(r.dFdx()))).sub(n),It(t(r=>r.add(r.dFdy()))).sub(n)).mul(e)}),m2t=Kt(i=>{const{surf_pos:e,surf_norm:t,dHdxy:n}=i,r=e.dFdx().normalize(),s=e.dFdy().normalize(),o=t,a=s.cross(o),c=o.cross(r),u=r.dot(a).mul(Tz),f=u.sign().mul(n.x.mul(a).add(n.y.mul(c)));return u.abs().mul(t).sub(f).normalize()});class g2t extends da{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=p2t({textureNode:this.textureNode,bumpScale:e});return m2t({surf_pos:aa,surf_norm:Jf,dHdxy:t})}}const y2t=Qt(g2t).setParameterLength(1,2),fTe=new Map;class Ct extends Wr{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=fTe.get(e);return n===void 0&&(n=b2(e,t),fTe.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let r=null;if(n===Ct.COLOR){const s=t.color!==void 0?this.getColor(n):Lt();t.map&&t.map.isTexture===!0?r=s.mul(this.getTexture("map")):r=s}else if(n===Ct.OPACITY){const s=this.getFloat(n);t.alphaMap&&t.alphaMap.isTexture===!0?r=s.mul(this.getTexture("alpha")):r=s}else if(n===Ct.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?r=this.getTexture("specular").r:r=It(1);else if(n===Ct.SPECULAR_INTENSITY){const s=this.getFloat(n);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?r=s.mul(this.getTexture(n).a):r=s}else if(n===Ct.SPECULAR_COLOR){const s=this.getColor(n);t.specularColorMap&&t.specularColorMap.isTexture===!0?r=s.mul(this.getTexture(n).rgb):r=s}else if(n===Ct.ROUGHNESS){const s=this.getFloat(n);t.roughnessMap&&t.roughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).g):r=s}else if(n===Ct.METALNESS){const s=this.getFloat(n);t.metalnessMap&&t.metalnessMap.isTexture===!0?r=s.mul(this.getTexture(n).b):r=s}else if(n===Ct.EMISSIVE){const s=this.getFloat("emissiveIntensity"),o=this.getColor(n).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?r=o.mul(this.getTexture(n)):r=o}else if(n===Ct.NORMAL)t.normalMap?(r=dTe(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType):t.bumpMap?r=y2t(this.getTexture("bump").r,this.getFloat("bumpScale")):r=Jf;else if(n===Ct.CLEARCOAT){const s=this.getFloat(n);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?r=s.mul(this.getTexture(n).r):r=s}else if(n===Ct.CLEARCOAT_ROUGHNESS){const s=this.getFloat(n);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).r):r=s}else if(n===Ct.CLEARCOAT_NORMAL)t.clearcoatNormalMap?r=dTe(this.getTexture(n),this.getCache(n+"Scale","vec2")):r=Jf;else if(n===Ct.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?r=s.mul(this.getTexture("sheenColor").rgb):r=s}else if(n===Ct.SHEEN_ROUGHNESS){const s=this.getFloat(n);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).a):r=s,r=r.clamp(.07,1)}else if(n===Ct.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(n);r=Oie(LT.x,LT.y,LT.y.negate(),LT.x).mul(s.rg.mul(2).sub(Tn(1)).normalize().mul(s.b))}else r=LT;else if(n===Ct.IRIDESCENCE_THICKNESS){const s=vs("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=vs("0","float",t.iridescenceThicknessRange);r=s.sub(o).mul(this.getTexture(n).g).add(o)}else r=s}else if(n===Ct.TRANSMISSION){const s=this.getFloat(n);t.transmissionMap?r=s.mul(this.getTexture(n).r):r=s}else if(n===Ct.THICKNESS){const s=this.getFloat(n);t.thicknessMap?r=s.mul(this.getTexture(n).g):r=s}else if(n===Ct.IOR)r=this.getFloat(n);else if(n===Ct.LIGHT_MAP)r=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===Ct.AO)r=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(n===Ct.LINE_DASH_OFFSET)r=t.dashOffset?this.getFloat(n):It(0);else{const s=this.getNodeType(e);r=this.getCache(n,s)}return r}}Ct.ALPHA_TEST="alphaTest";Ct.COLOR="color";Ct.OPACITY="opacity";Ct.SHININESS="shininess";Ct.SPECULAR="specular";Ct.SPECULAR_STRENGTH="specularStrength";Ct.SPECULAR_INTENSITY="specularIntensity";Ct.SPECULAR_COLOR="specularColor";Ct.REFLECTIVITY="reflectivity";Ct.ROUGHNESS="roughness";Ct.METALNESS="metalness";Ct.NORMAL="normal";Ct.CLEARCOAT="clearcoat";Ct.CLEARCOAT_ROUGHNESS="clearcoatRoughness";Ct.CLEARCOAT_NORMAL="clearcoatNormal";Ct.EMISSIVE="emissive";Ct.ROTATION="rotation";Ct.SHEEN="sheen";Ct.SHEEN_ROUGHNESS="sheenRoughness";Ct.ANISOTROPY="anisotropy";Ct.IRIDESCENCE="iridescence";Ct.IRIDESCENCE_IOR="iridescenceIOR";Ct.IRIDESCENCE_THICKNESS="iridescenceThickness";Ct.IOR="ior";Ct.TRANSMISSION="transmission";Ct.THICKNESS="thickness";Ct.ATTENUATION_DISTANCE="attenuationDistance";Ct.ATTENUATION_COLOR="attenuationColor";Ct.LINE_SCALE="scale";Ct.LINE_DASH_SIZE="dashSize";Ct.LINE_GAP_SIZE="gapSize";Ct.LINE_WIDTH="linewidth";Ct.LINE_DASH_OFFSET="dashOffset";Ct.POINT_SIZE="size";Ct.DISPERSION="dispersion";Ct.LIGHT_MAP="light";Ct.AO="ao";const v2t=bn(Ct,Ct.ALPHA_TEST),_2t=bn(Ct,Ct.COLOR),x2t=bn(Ct,Ct.SHININESS),b2t=bn(Ct,Ct.EMISSIVE),FIe=bn(Ct,Ct.OPACITY),S2t=bn(Ct,Ct.SPECULAR),pTe=bn(Ct,Ct.SPECULAR_INTENSITY),w2t=bn(Ct,Ct.SPECULAR_COLOR),iL=bn(Ct,Ct.SPECULAR_STRENGTH),YQ=bn(Ct,Ct.REFLECTIVITY),T2t=bn(Ct,Ct.ROUGHNESS),E2t=bn(Ct,Ct.METALNESS),M2t=bn(Ct,Ct.NORMAL),C2t=bn(Ct,Ct.CLEARCOAT),A2t=bn(Ct,Ct.CLEARCOAT_ROUGHNESS),R2t=bn(Ct,Ct.CLEARCOAT_NORMAL),P2t=bn(Ct,Ct.ROTATION),N2t=bn(Ct,Ct.SHEEN),I2t=bn(Ct,Ct.SHEEN_ROUGHNESS),k2t=bn(Ct,Ct.ANISOTROPY),D2t=bn(Ct,Ct.IRIDESCENCE),F2t=bn(Ct,Ct.IRIDESCENCE_IOR),O2t=bn(Ct,Ct.IRIDESCENCE_THICKNESS),B2t=bn(Ct,Ct.TRANSMISSION),L2t=bn(Ct,Ct.THICKNESS),U2t=bn(Ct,Ct.IOR),z2t=bn(Ct,Ct.ATTENUATION_DISTANCE),V2t=bn(Ct,Ct.ATTENUATION_COLOR),G2t=bn(Ct,Ct.LINE_SCALE),$2t=bn(Ct,Ct.LINE_DASH_SIZE),H2t=bn(Ct,Ct.LINE_GAP_SIZE);Ct.LINE_WIDTH;const j2t=bn(Ct,Ct.LINE_DASH_OFFSET),W2t=bn(Ct,Ct.POINT_SIZE),q2t=bn(Ct,Ct.DISPERSION),OIe=bn(Ct,Ct.LIGHT_MAP),X2t=bn(Ct,Ct.AO),LT=Cr(new mn).onReference(function(i){return i.material}).onRenderUpdate(function({material:i}){this.value.set(i.anisotropy*Math.cos(i.anisotropyRotation),i.anisotropy*Math.sin(i.anisotropyRotation))}),BIe=Kt(i=>i.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class Vs extends Wr{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let r;if(n===Vs.VERTEX)r=e.getVertexIndex();else if(n===Vs.INSTANCE)r=e.getInstanceIndex();else if(n===Vs.DRAW)r=e.getDrawIndex();else if(n===Vs.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(n===Vs.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else if(n===Vs.SUBGROUP)r=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=r:s=Rd(this).build(e,t),s}}Vs.VERTEX="vertex";Vs.INSTANCE="instance";Vs.SUBGROUP="subgroup";Vs.INVOCATION_LOCAL="invocationLocal";Vs.INVOCATION_SUBGROUP="invocationSubgroup";Vs.DRAW="draw";const Y2t=bn(Vs,Vs.VERTEX),Jie=bn(Vs,Vs.INSTANCE);Vs.SUBGROUP;Vs.INVOCATION_SUBGROUP;Vs.INVOCATION_LOCAL;const K2t=bn(Vs,Vs.DRAW);class Z2t extends Wr{static get type(){return"InstanceNode"}constructor(e,t,n=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=ci.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{count:t,instanceMatrix:n,instanceColor:r}=this;let{instanceMatrixNode:s,instanceColorNode:o}=this;if(s===null){if(t<=1e3)s=CIe(n.array,"mat4",Math.max(t,1)).element(Jie);else{const c=new sYe(n.array,16,1);this.buffer=c;const u=n.usage===O6?sTe:iTe,f=[u(c,"vec4",16,0),u(c,"vec4",16,4),u(c,"vec4",16,8),u(c,"vec4",16,12)];s=m_(...f)}this.instanceMatrixNode=s}if(r&&o===null){const c=new eXe(r.array,3),u=r.usage===O6?sTe:iTe;this.bufferColor=c,o=Lt(u(c,"vec3",3,0)),this.instanceColorNode=o}const a=s.mul(Hl).xyz;if(Hl.assign(a),e.hasGeometryAttribute("normal")){const c=Qgt(Qf,s);Qf.assign(c)}this.instanceColorNode!==null&&hU("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==O6&&this.buffer!==null&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==O6&&this.bufferColor!==null&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}class Q2t extends Z2t{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:r}=e;super(t,n,r),this.instancedMesh=e}}const J2t=Qt(Q2t).setParameterLength(1);class e3t extends Wr{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=Jie:this.batchingIdNode=K2t);const n=Kt(([T])=>{const P=Ns(y_(id(this.batchMesh._indirectTexture),0).x),R=Ns(T).mod(P),M=Ns(T).div(P);return id(this.batchMesh._indirectTexture,y1(R,M)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(Ns(this.batchingIdNode)),r=this.batchMesh._matricesTexture,s=Ns(y_(id(r),0).x),o=It(n).mul(4).toInt().toVar(),a=o.mod(s),c=o.div(s),u=m_(id(r,y1(a,c)),id(r,y1(a.add(1),c)),id(r,y1(a.add(2),c)),id(r,y1(a.add(3),c))),f=this.batchMesh._colorsTexture;if(f!==null){const P=Kt(([R])=>{const M=Ns(y_(id(f),0).x),O=R,C=O.mod(M),L=O.div(M);return id(f,y1(C,L)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(n);hU("vec3","vBatchColor").assign(P)}const m=B0(u);Hl.assign(u.mul(Hl));const v=Qf.div(Lt(m[0].dot(m[0]),m[1].dot(m[1]),m[2].dot(m[2]))),x=m.mul(v).xyz;Qf.assign(x),e.hasGeometryAttribute("tangent")&&Qie.mulAssign(m)}}const t3t=Qt(e3t).setParameterLength(1),mTe=new WeakMap;class n3t extends Wr{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=ci.OBJECT,this.skinIndexNode=Z2("skinIndex","uvec4"),this.skinWeightNode=Z2("skinWeight","vec4"),this.bindMatrixNode=vs("bindMatrix","mat4"),this.bindMatrixInverseNode=vs("bindMatrixInverse","mat4"),this.boneMatricesNode=hTe("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=Hl,this.toPositionNode=Hl,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(n.x),c=e.element(n.y),u=e.element(n.z),f=e.element(n.w),m=s.mul(t),v=L0(a.mul(r.x).mul(m),c.mul(r.y).mul(m),u.mul(r.z).mul(m),f.mul(r.w).mul(m));return o.mul(v).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=Qf){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(n.x),c=e.element(n.y),u=e.element(n.z),f=e.element(n.w);let m=L0(r.x.mul(a),r.y.mul(c),r.z.mul(u),r.w.mul(f));return m=o.mul(m).mul(s),m.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=hTe("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,cTe)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||WNe(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&cTe.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const n=this.getSkinnedNormal();Qf.assign(n),e.hasGeometryAttribute("tangent")&&Qie.assign(n)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;mTe.get(t)!==e.frameId&&(mTe.set(t,e.frameId),this.previousBoneMatricesNode!==null&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const r3t=i=>tn(new n3t(i));class i3t extends Wr{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode("i".charCodeAt(0)+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const n={};for(let o=0,a=this.params.length-1;o<a;o++){const c=this.params[o],u=c.isNode!==!0&&c.name||this.getVarName(o),f=c.isNode!==!0&&c.type||"int";n[u]=ax(u,f)}const r=e.addStack();t.returnsNode=this.params[this.params.length-1](n,e),t.stackNode=r;const s=this.params[0];return s.isNode!==!0&&typeof s.update=="function"&&(t.updateNode=Kt(this.params[0].update)(n)),e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),n=this.params,r=t.stackNode;for(let a=0,c=n.length-1;a<c;a++){const u=n[a];let f=!1,m=null,v=null,x=null,T=null,P=null,R=null;u.isNode?u.getNodeType(e)==="bool"?(f=!0,T="bool",v=u.build(e,T)):(T="int",x=this.getVarName(a),m="0",v=u.build(e,T),P="<"):(T=u.type||"int",x=u.name||this.getVarName(a),m=u.start,v=u.end,P=u.condition,R=u.update,typeof m=="number"?m=e.generateConst(T,m):m&&m.isNode&&(m=m.build(e,T)),typeof v=="number"?v=e.generateConst(T,v):v&&v.isNode&&(v=v.build(e,T)),m!==void 0&&v===void 0?(m=m+" - 1",v="0",P=">="):v!==void 0&&m===void 0&&(m="0",P="<"),P===void 0&&(Number(m)>Number(v)?P=">=":P="<"));let M;if(f)M=`while ( ${v} )`;else{const O={start:m,end:v},C=O.start,L=O.end;let Y;const J=()=>P.includes("<")?"+=":"-=";if(R!=null)switch(typeof R){case"function":Y=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":Y=x+" "+J()+" "+e.generateConst(T,R);break;case"string":Y=x+" "+R;break;default:R.isNode?Y=x+" "+J()+" "+R.build(e):(console.error("THREE.TSL: 'Loop( { update: ... } )' is not a function, string or number."),Y="break /* invalid update */")}else T==="int"||T==="uint"?R=P.includes("<")?"++":"--":R=J()+" 1.",Y=x+" "+R;const z=e.getVar(T,x)+" = "+C,ne=x+" "+P+" "+L;M=`for ( ${z}; ${ne}; ${Y} )`}e.addFlowCode((a===0?`
`:"")+e.tab+M+` {

`).addFlowTab()}const s=r.build(e,"void"),o=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let a=0,c=this.params.length-1;a<c;a++)e.addFlowCode((a===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),o}}const vd=(...i)=>tn(new i3t(p_(i,"int"))).toStack(),s3t=()=>ax("break").toStack(),KQ=new WeakMap,zc=new ir,gTe=Kt(({bufferMap:i,influence:e,stride:t,width:n,depth:r,offset:s})=>{const o=Ns(Y2t).mul(t).add(s),a=o.div(n),c=o.sub(a.mul(n));return id(i,y1(c,a)).depth(r).xyz.mul(e)});function o3t(i){const e=i.morphAttributes.position!==void 0,t=i.morphAttributes.normal!==void 0,n=i.morphAttributes.color!==void 0,r=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,s=r!==void 0?r.length:0;let o=KQ.get(i);if(o===void 0||o.count!==s){let O=function(){R.dispose(),KQ.delete(i),i.removeEventListener("dispose",O)};var a=O;o!==void 0&&o.texture.dispose();const c=i.morphAttributes.position||[],u=i.morphAttributes.normal||[],f=i.morphAttributes.color||[];let m=0;e===!0&&(m=1),t===!0&&(m=2),n===!0&&(m=3);let v=i.attributes.position.count*m,x=1;const T=4096;v>T&&(x=Math.ceil(v/T),v=T);const P=new Float32Array(v*x*4*s),R=new cre(P,v,x,s);R.type=Ys,R.needsUpdate=!0;const M=m*4;for(let C=0;C<s;C++){const L=c[C],Y=u[C],J=f[C],z=v*x*4*C;for(let ne=0;ne<L.count;ne++){const K=ne*M;e===!0&&(zc.fromBufferAttribute(L,ne),P[z+K+0]=zc.x,P[z+K+1]=zc.y,P[z+K+2]=zc.z,P[z+K+3]=0),t===!0&&(zc.fromBufferAttribute(Y,ne),P[z+K+4]=zc.x,P[z+K+5]=zc.y,P[z+K+6]=zc.z,P[z+K+7]=0),n===!0&&(zc.fromBufferAttribute(J,ne),P[z+K+8]=zc.x,P[z+K+9]=zc.y,P[z+K+10]=zc.z,P[z+K+11]=J.itemSize===4?zc.w:1)}}o={count:s,texture:R,stride:m,size:new mn(v,x)},KQ.set(i,o),i.addEventListener("dispose",O)}return o}class a3t extends Wr{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Cr(1),this.updateType=ci.OBJECT}setup(e){const{geometry:t}=e,n=t.morphAttributes.position!==void 0,r=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=s!==void 0?s.length:0,{texture:a,stride:c,size:u}=o3t(t);n===!0&&Hl.mulAssign(this.morphBaseInfluence),r===!0&&Qf.mulAssign(this.morphBaseInfluence);const f=Ns(u.width);vd(o,({i:m})=>{const v=It(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?v.assign(id(this.mesh.morphTexture,y1(Ns(m).add(1),Ns(Jie))).r):v.assign(vs("morphTargetInfluences","float").element(m).toVar()),Go(v.notEqual(0),()=>{n===!0&&Hl.addAssign(gTe({bufferMap:a,influence:v,stride:c,width:f,depth:m,offset:Ns(0)})),r===!0&&Qf.addAssign(gTe({bufferMap:a,influence:v,stride:c,width:f,depth:m,offset:Ns(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,n)=>t+n,0)}}const l3t=Qt(a3t).setParameterLength(1);class Px extends Wr{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class c3t extends Px{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class u3t extends xIe{static get type(){return"LightingContextNode"}constructor(e,t=null,n=null,r=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n=Lt().toVar("directDiffuse"),r=Lt().toVar("directSpecular"),s=Lt().toVar("indirectDiffuse"),o=Lt().toVar("indirectSpecular"),a={directDiffuse:n,directSpecular:r,indirectDiffuse:s,indirectSpecular:o};return{radiance:Lt().toVar("radiance"),irradiance:Lt().toVar("irradiance"),iblIrradiance:Lt().toVar("iblIrradiance"),ambientOcclusion:It(1).toVar("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const h3t=Qt(u3t);class d3t extends Px{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let UT,zT;class na extends Wr{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===na.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=ci.NONE;return(this.scope===na.SIZE||this.scope===na.VIEWPORT)&&(e=ci.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===na.VIEWPORT?t!==null?zT.copy(t.viewport):(e.getViewport(zT),zT.multiplyScalar(e.getPixelRatio())):t!==null?(UT.width=t.width,UT.height=t.height):e.getDrawingBufferSize(UT)}setup(){const e=this.scope;let t=null;return e===na.SIZE?t=Cr(UT||(UT=new mn)):e===na.VIEWPORT?t=Cr(zT||(zT=new ir)):t=Tn(Ez.div(Fte)),t}generate(e){if(this.scope===na.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(Fte).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}}na.COORDINATE="coordinate";na.VIEWPORT="viewport";na.SIZE="size";na.UV="uv";const v_=bn(na,na.UV),Fte=bn(na,na.SIZE),Ez=bn(na,na.COORDINATE),$E=bn(na,na.VIEWPORT);$E.zw;$E.xy;const VT=new mn;class LIe extends Rx{static get type(){return"ViewportTextureNode"}constructor(e=v_,t=null,n=null){n===null&&(n=new sXe,n.minFilter=oc),super(n,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=ci.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(VT);const n=this.value;(n.image.width!==VT.width||n.image.height!==VT.height)&&(n.image.width=VT.width,n.image.height=VT.height,n.needsUpdate=!0);const r=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(n),n.generateMipmaps=r}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const UIe=Qt(LIe,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let ZQ=null;class f3t extends LIe{static get type(){return"ViewportDepthTextureNode"}constructor(e=v_,t=null){ZQ===null&&(ZQ=new Jc),super(e,t,ZQ)}}const p3t=Qt(f3t).setParameterLength(0,2);class lc extends Wr{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===lc.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,n=this.valueNode;let r=null;if(t===lc.DEPTH_BASE)n!==null&&(r=GIe().assign(n));else if(t===lc.DEPTH)e.isPerspectiveCamera?r=m3t(aa.z,Uy,zy):r=HE(aa.z,Uy,zy);else if(t===lc.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const s=zIe(n,Uy,zy);r=HE(s,Uy,zy)}else r=n;else r=HE(aa.z,Uy,zy);return r}}lc.DEPTH_BASE="depthBase";lc.DEPTH="depth";lc.LINEAR_DEPTH="linearDepth";const HE=(i,e,t)=>i.add(e).div(e.sub(t)),m3t=(i,e,t)=>e.add(i).mul(t).div(t.sub(e).mul(i)),zIe=(i,e,t)=>e.mul(t).div(t.sub(e).mul(i).sub(t)),VIe=(i,e,t)=>{e=e.max(1e-6).toVar();const n=U1(i.negate().div(e)),r=U1(t.div(e));return n.div(r)},GIe=Qt(lc,lc.DEPTH_BASE),$Ie=bn(lc,lc.DEPTH),g3t=Qt(lc,lc.LINEAR_DEPTH).setParameterLength(0,1);p3t();$Ie.assign=i=>GIe(i);class Ju extends Wr{static get type(){return"ClippingNode"}constructor(e=Ju.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===Ju.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,r):this.scope===Ju.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(n,r)}setupAlphaToCoverage(e,t){return Kt(()=>{const n=It().toVar("distanceToPlane"),r=It().toVar("distanceToGradient"),s=It(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const c=Vf(t);vd(o,({i:u})=>{const f=c.element(u);n.assign(aa.dot(f.xyz).negate().add(f.w)),r.assign(n.fwidth().div(2)),s.mulAssign(K2(r.negate(),r,n))})}const a=e.length;if(a>0){const c=Vf(e),u=It(1).toVar("intersectionClipOpacity");vd(a,({i:f})=>{const m=c.element(f);n.assign(aa.dot(m.xyz).negate().add(m.w)),r.assign(n.fwidth().div(2)),u.mulAssign(K2(r.negate(),r,n).oneMinus())}),s.mulAssign(u.oneMinus())}Li.a.mulAssign(s),Li.a.equal(0).discard()})()}setupDefault(e,t){return Kt(()=>{const n=t.length;if(this.hardwareClipping===!1&&n>0){const s=Vf(t);vd(n,({i:o})=>{const a=s.element(o);aa.dot(a.xyz).greaterThan(a.w).discard()})}const r=e.length;if(r>0){const s=Vf(e),o=Fie(!0).toVar("clipped");vd(r,({i:a})=>{const c=s.element(a);o.assign(aa.dot(c.xyz).greaterThan(c.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),Kt(()=>{const r=Vf(e),s=bz(t.getClipDistance());vd(n,({i:o})=>{const a=r.element(o),c=aa.dot(a.xyz).sub(a.w).negate();s.element(o).assign(c)})})()}}Ju.ALPHA_TO_COVERAGE="alphaToCoverage";Ju.DEFAULT="default";Ju.HARDWARE="hardware";const y3t=()=>tn(new Ju),v3t=()=>tn(new Ju(Ju.ALPHA_TO_COVERAGE)),_3t=()=>tn(new Ju(Ju.HARDWARE)),x3t=.05,yTe=Kt(([i])=>s3(pi(1e4,pd(pi(17,i.x).add(pi(.1,i.y)))).mul(L0(.1,Hu(pd(pi(13,i.y).add(i.x))))))),vTe=Kt(([i])=>yTe(Tn(yTe(i.xy),i.z))),b3t=Kt(([i])=>{const e=Jl(z1(dIe(i.xyz)),z1(fIe(i.xyz))),t=It(1).div(It(x3t).mul(e)).toVar("pixScale"),n=Tn(zM(a4(U1(t))),zM(Vie(U1(t)))),r=Tn(vTe(a4(n.x.mul(i.xyz))),vTe(a4(n.y.mul(i.xyz)))),s=s3(U1(t)),o=L0(pi(s.oneMinus(),r.x),pi(s,r.y)),a=ox(s,s.oneMinus()),c=Lt(o.mul(o).div(pi(2,a).mul(A0(1,a))),o.sub(pi(.5,a)).div(A0(1,a)),A0(1,A0(1,o).mul(A0(1,o)).div(pi(2,a).mul(A0(1,a))))),u=o.lessThan(a.oneMinus()).select(o.lessThan(a).select(c.x,c.y),c.z);return em(u,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class S3t extends TIe{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),n=e.hasGeometryAttribute(t);let r;return n===!0?r=super.generate(e):r=e.generateConst(this.nodeType,new ir(1,1,1,1)),r}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const w3t=(i=0)=>tn(new S3t(i));class ca extends Ka{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{console.warn('THREE.NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}customProgramCacheKey(){return this.type+HNe(this)}build(e){this.setup(e)}setupObserver(e){return new m1t(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();e.addStack();const r=this.setupVertex(e),s=this.vertexNode||r;e.stack.outputNode=s,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let o;const a=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(n!==null?n.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const c=this.setupLighting(e);a!==null&&e.stack.add(a);const u=$r(c,Li.a).max(0);o=this.setupOutput(e,u),GE.assign(o);const f=this.outputNode!==null;if(f&&(o=this.outputNode),n!==null){const m=t.getMRT(),v=this.mrtNode;m!==null?(f&&GE.assign(o),o=m,v!==null&&(o=m.merge(v))):v!==null&&(o=v)}}else{let c=this.fragmentNode;c.isOutputStructNode!==!0&&(c=$r(c)),o=this.setupOutput(e,c)}e.stack.outputNode=o,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let r=null;if(t.length>0||n.length>0){const s=e.renderer.samples;this.alphaToCoverage&&s>1?r=v3t():e.stack.add(y3t())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(_3t()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let r=this.depthNode;if(r===null){const s=t.getMRT();s&&s.has("depth")?r=s.get("depth"):t.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?r=VIe(aa.z,Uy,zy):r=HE(aa.z,Uy,zy))}r!==null&&$Ie.assign(r).toStack()}setupPositionView(){return Sz.mul(Hl).xyz}setupModelViewProjection(){return Xie.mul(aa)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),BIe}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&l3t(t).toStack(),t.isSkinnedMesh===!0&&r3t(t).toStack(),this.displacementMap){const r=b2("displacementMap","texture"),s=b2("displacementScale","float"),o=b2("displacementBias","float");Hl.addAssign(Qf.normalize().mul(r.x.mul(s).add(o)))}return t.isBatchedMesh&&t3t(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&J2t(t).toStack(),this.positionNode!==null&&Hl.assign(Agt(this.positionNode,"POSITION")),Hl}setupDiffuseColor({object:e,geometry:t}){this.maskNode!==null&&Fie(this.maskNode).not().discard();let n=this.colorNode?$r(this.colorNode):_2t;this.vertexColors===!0&&t.hasAttribute("color")&&(n=n.mul(w3t())),e.instanceColor&&(n=hU("vec3","vInstanceColor").mul(n)),e.isBatchedMesh&&e._colorsTexture&&(n=hU("vec3","vBatchColor").mul(n)),Li.assign(n);const r=this.opacityNode?It(this.opacityNode):FIe;Li.a.assign(Li.a.mul(r));let s=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(s=this.alphaTestNode!==null?It(this.alphaTestNode):v2t,Li.a.lessThanEqual(s).discard()),this.alphaHash===!0&&Li.a.lessThan(b3t(Hl)).discard(),this.transparent===!1&&this.blending===fc&&this.alphaToCoverage===!1?Li.a.assign(1):s===null&&Li.a.lessThanEqual(0).discard()}setupVariants(){}setupOutgoingLight(){return this.lights===!0?Lt(0):Li.rgb}setupNormal(){return this.normalNode?Lt(this.normalNode):M2t}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?b2("envMap","cubeTexture"):b2("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new d3t(OIe)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const r=this.setupLightMap(e);if(r&&r.isLightingNode&&t.push(r),this.aoNode!==null||e.material.aoMap){const o=this.aoNode!==null?this.aoNode:X2t;t.push(new c3t(o))}let s=this.lightsNode||e.lightsNode;return t.length>0&&(s=e.renderer.lighting.createNode([...s.getLights(),...t])),s}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:r,emissiveNode:s}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=this.setupOutgoingLight(e);if(a&&a.getScope().hasLights){const u=this.setupLightingModel(e)||null;c=h3t(a,u,n,r)}else n!==null&&(c=Lt(r!==null?zs(c,n,r):n));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(tTe.assign(Lt(s||b2t)),c=c.add(tTe)),c}setupFog(e,t){const n=e.fogNode;return n&&(GE.assign(t),t=$r(n)),t}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),t}setDefaultValues(e){for(const n in e){const r=e[n];this[n]===void 0&&(this[n]=r,r&&r.clone&&(this[n]=r.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&t[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const n=Ka.prototype.toJSON.call(this,e),r=lU(this);n.inputNodes={};for(const{property:o,childNode:a}of r)n.inputNodes[o]=a.toJSON(e).uuid;function s(o){const a=[];for(const c in o){const u=o[c];delete u.metadata,a.push(u)}return a}if(t){const o=s(e.textures),a=s(e.images),c=s(e.nodes);o.length>0&&(n.textures=o),a.length>0&&(n.images=a),c.length>0&&(n.nodes=c)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const T3t=new su;class E3t extends ca{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(T3t),this.setValues(e)}}const M3t=new CXe;class C3t extends ca{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(M3t),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?It(this.offsetNode):j2t,t=this.dashScaleNode?It(this.dashScaleNode):G2t,n=this.dashSizeNode?It(this.dashSizeNode):$2t,r=this.gapSizeNode?It(this.gapSizeNode):H2t;WQ.assign(n),nTe.assign(r);const s=Rd(Z2("lineDistance").mul(t));(e?s.add(e):s).mod(WQ.add(nTe)).greaterThan(WQ).discard()}}const A3t=i=>tn(i).mul(.5).add(.5),R3t=new _re;class P3t extends ca{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(R3t),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?It(this.opacityNode):FIe;Li.assign(Wie($r(A3t(ia),e),Hr))}}class N3t extends da{static get type(){return"EquirectUVNode"}constructor(e=RIe){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan(e.x).mul(1/(Math.PI*2)).add(.5),n=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Tn(t,n)}}const HIe=Qt(N3t).setParameterLength(0,1);class jIe extends sAe{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new Oo(5,5,5),o=HIe(RIe),a=new ca;a.colorNode=Pi(t,o,0),a.side=Ui,a.blending=vl;const c=new dn(s,a),u=new W1;u.add(c),t.minFilter===oc&&(t.minFilter=_s);const f=new iAe(1,10,this),m=e.getMRT();return e.setMRT(null),f.update(e,u),e.setMRT(m),t.minFilter=n,t.currentGenerateMipmaps=r,c.geometry.dispose(),c.material.dispose(),this}}const jE=new WeakMap;class I3t extends da{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=$M(null);const t=new vx;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=ci.RENDER}updateBefore(e){const{renderer:t,material:n}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const s=r.isTextureNode?r.value:n[r.property];if(s&&s.isTexture){const o=s.mapping;if(o===v4||o===M_){if(jE.has(s)){const a=jE.get(s);_Te(a,s.mapping),this._cubeTexture=a}else{const a=s.image;if(k3t(a)){const c=new jIe(a.height);c.fromEquirectangularTexture(t,s),_Te(c.texture,s.mapping),this._cubeTexture=c.texture,jE.set(s,c.texture),s.addEventListener("dispose",WIe)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function k3t(i){return i==null?!1:i.height>0}function WIe(i){const e=i.target;e.removeEventListener("dispose",WIe);const t=jE.get(e);t!==void 0&&(jE.delete(e),t.dispose())}function _Te(i,e){e===v4?i.mapping=Wf:e===M_&&(i.mapping=qf)}const qIe=Qt(I3t).setParameterLength(1);class ese extends Px{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=qIe(this.envNode)}}class D3t extends Px{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=It(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Mz{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class XIe extends Mz{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,n=e.reflectedLight,r=e.irradianceLightMap;n.indirectDiffuse.assign($r(0)),r?n.indirectDiffuse.addAssign(r):n.indirectDiffuse.addAssign($r(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(Li.rgb)}finish(e){const{material:t,context:n}=e,r=n.outgoingLight,s=e.context.environment;if(s)switch(t.combine){case rC:r.rgb.assign(zs(r.rgb,r.rgb.mul(s.rgb),iL.mul(YQ)));break;case $Ce:r.rgb.assign(zs(r.rgb,s.rgb,iL.mul(YQ)));break;case HCe:r.rgb.addAssign(s.rgb.mul(iL.mul(YQ)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const F3t=new Ea;class O3t extends ca{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(F3t),this.setValues(e)}setupNormal(){return Jf}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new ese(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new D3t(OIe)),t}setupOutgoingLight(){return Li.rgb}setupLightingModel(){return new XIe}}const HM=Kt(({f0:i,f90:e,dotVH:t})=>{const n=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return i.mul(n.oneMinus()).add(e.mul(n))}),lx=Kt(i=>i.diffuseColor.mul(1/Math.PI)),B3t=()=>It(.25),L3t=Kt(({dotNH:i})=>kte.mul(It(.5)).add(1).mul(It(1/Math.PI)).mul(i.pow(kte))),U3t=Kt(({lightDirection:i})=>{const e=i.add(fo).normalize(),t=ia.dot(e).clamp(),n=fo.dot(e).clamp(),r=HM({f0:$c,f90:1,dotVH:n}),s=B3t(),o=L3t({dotNH:t});return r.mul(s).mul(o)});class YIe extends XIe{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const s=ia.dot(e).clamp().mul(t);n.directDiffuse.addAssign(s.mul(lx({diffuseColor:Li.rgb}))),this.specular===!0&&n.directSpecular.addAssign(s.mul(U3t({lightDirection:e})).mul(iL))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(lx({diffuseColor:Li}))),r.indirectDiffuse.mulAssign(t)}}const z3t=new vAe;class V3t extends ca{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(z3t),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new ese(t):null}setupLightingModel(){return new YIe(!1)}}const G3t=new Yy;class $3t extends ca{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(G3t),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new ese(t):null}setupLightingModel(){return new YIe}setupVariants(){const e=(this.shininessNode?It(this.shininessNode):x2t).max(1e-4);kte.assign(e);const t=this.specularNode||S2t;$c.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const H3t=Kt(i=>{if(i.geometry.hasAttribute("normal")===!1)return It(0);const e=Jf.dFdx().abs().max(Jf.dFdy().abs());return e.x.max(e.y).max(e.z)}),KIe=Kt(i=>{const{roughness:e}=i,t=H3t();let n=e.max(.0525);return n=n.add(t),n=n.min(1),n}),j3t=Kt(({alpha:i,dotNL:e,dotNV:t})=>{const n=i.pow2(),r=e.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt());return Zf(.5,r.add(s).max(Rmt))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),W3t=Kt(({alphaT:i,alphaB:e,dotTV:t,dotBV:n,dotTL:r,dotBL:s,dotNV:o,dotNL:a})=>{const c=a.mul(Lt(i.mul(t),e.mul(n),o).length()),u=o.mul(Lt(i.mul(r),e.mul(s),a).length());return Zf(.5,c.add(u)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),q3t=Kt(({alpha:i,dotNH:e})=>{const t=i.pow2(),n=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),X3t=It(1/Math.PI),Y3t=Kt(({alphaT:i,alphaB:e,dotNH:t,dotTH:n,dotBH:r})=>{const s=i.mul(e),o=Lt(e.mul(n),i.mul(r),s.mul(t)),a=o.dot(o),c=s.div(a);return X3t.mul(s.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),xTe=Kt(i=>{const{lightDirection:e,f0:t,f90:n,roughness:r,f:s,USE_IRIDESCENCE:o,USE_ANISOTROPY:a}=i,c=i.normalView||ia,u=r.pow2(),f=e.add(fo).normalize(),m=c.dot(e).clamp(),v=c.dot(fo).clamp(),x=c.dot(f).clamp(),T=fo.dot(f).clamp();let P=HM({f0:t,f90:n,dotVH:T}),R,M;if(eTe(o)&&(P=Lie.mix(P,s)),eTe(a)){const O=JB.dot(e),C=JB.dot(fo),L=JB.dot(f),Y=g_.dot(e),J=g_.dot(fo),z=g_.dot(f);R=W3t({alphaT:Ite,alphaB:u,dotTV:C,dotBV:J,dotTL:O,dotBL:Y,dotNV:v,dotNL:m}),M=Y3t({alphaT:Ite,alphaB:u,dotNH:x,dotTH:L,dotBH:z})}else R=j3t({alpha:u,dotNL:m,dotNV:v}),M=q3t({alpha:u,dotNH:x});return P.mul(R).mul(M)}),ZIe=Kt(({roughness:i,dotNV:e})=>{const t=$r(-1,-.0275,-.572,.022),n=$r(1,.0425,1.04,-.04),r=i.mul(t).add(n),s=r.x.mul(r.x).min(e.mul(-9.28).exp2()).mul(r.x).add(r.y);return Tn(-1.04,1.04).mul(s).add(r.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),QIe=Kt(i=>{const{dotNV:e,specularColor:t,specularF90:n,roughness:r}=i,s=ZIe({dotNV:e,roughness:r});return t.mul(s.x).add(n.mul(s.y))}),K3t=Kt(({f:i,f90:e,dotVH:t})=>{const n=t.oneMinus().saturate(),r=n.mul(n),s=n.mul(r,r).clamp(0,.9999);return i.sub(Lt(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Z3t=Kt(({roughness:i,dotNH:e})=>{const t=i.pow2(),n=It(1).div(t),s=e.pow2().oneMinus().max(.0078125);return It(2).add(n).mul(s.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Q3t=Kt(({dotNV:i,dotNL:e})=>It(1).div(It(4).mul(e.add(i).sub(e.mul(i))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),J3t=Kt(({lightDirection:i})=>{const e=i.add(fo).normalize(),t=ia.dot(i).clamp(),n=ia.dot(fo).clamp(),r=ia.dot(e).clamp(),s=Z3t({roughness:Bie,dotNH:r}),o=Q3t({dotNV:n,dotNL:t});return q6.mul(s).mul(o)}),e9t=Kt(({N:i,V:e,roughness:t})=>{const s=.0078125,o=i.dot(e).saturate(),a=Tn(t,o.oneMinus().sqrt());return a.assign(a.mul(.984375).add(s)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),t9t=Kt(({f:i})=>{const e=i.length();return Jl(e.mul(e).add(i.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),cB=Kt(({v1:i,v2:e})=>{const t=i.dot(e),n=t.abs().toVar(),r=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),s=n.add(4.1616724).mul(n).add(3.417594).toVar(),o=r.div(s),a=t.greaterThan(0).select(o,Jl(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return i.cross(e).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),bTe=Kt(({N:i,V:e,P:t,mInv:n,p0:r,p1:s,p2:o,p3:a})=>{const c=s.sub(r).toVar(),u=a.sub(r).toVar(),f=c.cross(u),m=Lt().toVar();return Go(f.dot(t.sub(r)).greaterThanEqual(0),()=>{const v=e.sub(i.mul(e.dot(i))).normalize(),x=i.cross(v).negate(),T=n.mul(B0(v,x,i).transpose()).toVar(),P=T.mul(r.sub(t)).normalize().toVar(),R=T.mul(s.sub(t)).normalize().toVar(),M=T.mul(o.sub(t)).normalize().toVar(),O=T.mul(a.sub(t)).normalize().toVar(),C=Lt(0).toVar();C.addAssign(cB({v1:P,v2:R})),C.addAssign(cB({v1:R,v2:M})),C.addAssign(cB({v1:M,v2:O})),C.addAssign(cB({v1:O,v2:P})),m.assign(Lt(t9t({f:C})))}),m}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Cz=1/6,JIe=i=>pi(Cz,pi(i,pi(i,i.negate().add(3)).sub(3)).add(1)),Ote=i=>pi(Cz,pi(i,pi(i,pi(3,i).sub(6))).add(4)),eke=i=>pi(Cz,pi(i,pi(i,pi(-3,i).add(3)).add(3)).add(1)),Bte=i=>pi(Cz,xz(i,3)),STe=i=>JIe(i).add(Ote(i)),wTe=i=>eke(i).add(Bte(i)),TTe=i=>L0(-1,Ote(i).div(JIe(i).add(Ote(i)))),ETe=i=>L0(1,Bte(i).div(eke(i).add(Bte(i)))),MTe=(i,e,t)=>{const n=i.uvNode,r=pi(n,e.zw).add(.5),s=a4(r),o=s3(r),a=STe(o.x),c=wTe(o.x),u=TTe(o.x),f=ETe(o.x),m=TTe(o.y),v=ETe(o.y),x=Tn(s.x.add(u),s.y.add(m)).sub(.5).mul(e.xy),T=Tn(s.x.add(f),s.y.add(m)).sub(.5).mul(e.xy),P=Tn(s.x.add(u),s.y.add(v)).sub(.5).mul(e.xy),R=Tn(s.x.add(f),s.y.add(v)).sub(.5).mul(e.xy),M=STe(o.y).mul(L0(a.mul(i.sample(x).level(t)),c.mul(i.sample(T).level(t)))),O=wTe(o.y).mul(L0(a.mul(i.sample(P).level(t)),c.mul(i.sample(R).level(t))));return M.add(O)},n9t=Kt(([i,e=It(3)])=>{const t=Tn(i.size(Ns(e))),n=Tn(i.size(Ns(e.add(1)))),r=Zf(1,t),s=Zf(1,n),o=MTe(i,$r(r,t),a4(e)),a=MTe(i,$r(s,n),Vie(e));return s3(e).mix(o,a)}),CTe=Kt(([i,e,t,n,r])=>{const s=Lt(_Ie(e.negate(),VM(i),Zf(1,n))),o=Lt(z1(r[0].xyz),z1(r[1].xyz),z1(r[2].xyz));return VM(s).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),r9t=Kt(([i,e])=>i.mul(em(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),i9t=UIe(),s9t=UIe(),ATe=Kt(([i,e,t],{material:n})=>{const s=(n.side===Ui?i9t:s9t).sample(i),o=U1(Fte.x).mul(r9t(e,t));return n9t(s,o)}),RTe=Kt(([i,e,t])=>(Go(t.notEqual(0),()=>{const n=cIe(e).negate().div(t);return lIe(n.negate().mul(i))}),Lt(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),o9t=Kt(([i,e,t,n,r,s,o,a,c,u,f,m,v,x,T])=>{let P,R;if(T){P=$r().toVar(),R=Lt().toVar();const Y=f.sub(1).mul(T.mul(.025)),J=Lt(f.sub(Y),f,f.add(Y));vd({start:0,end:3},({i:z})=>{const ne=J.element(z),K=CTe(i,e,m,ne,a),$=o.add(K),he=u.mul(c.mul($r($,1))),Ce=Tn(he.xy.div(he.w)).toVar();Ce.addAssign(1),Ce.divAssign(2),Ce.assign(Tn(Ce.x,Ce.y.oneMinus()));const Pe=ATe(Ce,t,ne);P.element(z).assign(Pe.element(z)),P.a.addAssign(Pe.a),R.element(z).assign(n.element(z).mul(RTe(z1(K),v,x).element(z)))}),P.a.divAssign(3)}else{const Y=CTe(i,e,m,f,a),J=o.add(Y),z=u.mul(c.mul($r(J,1))),ne=Tn(z.xy.div(z.w)).toVar();ne.addAssign(1),ne.divAssign(2),ne.assign(Tn(ne.x,ne.y.oneMinus())),P=ATe(ne,t,f),R=n.mul(RTe(z1(Y),v,x))}const M=R.rgb.mul(P.rgb),O=i.dot(e).clamp(),C=Lt(QIe({dotNV:O,specularColor:r,specularF90:s,roughness:t})),L=R.r.add(R.g,R.b).div(3);return $r(C.oneMinus().mul(M),P.a.oneMinus().mul(L).oneMinus())}),a9t=B0(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),l9t=i=>{const e=i.sqrt();return Lt(1).add(e).div(Lt(1).sub(e))},PTe=(i,e)=>i.sub(e).div(i.add(e)).pow2(),c9t=(i,e)=>{const t=i.mul(2*Math.PI*1e-9),n=Lt(54856e-17,44201e-17,52481e-17),r=Lt(1681e3,1795300,2208400),s=Lt(43278e5,93046e5,66121e5),o=It(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=n.mul(s.mul(2*Math.PI).sqrt()).mul(r.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return a=Lt(a.x.add(o),a.y,a.z).div(10685e-11),a9t.mul(a)},u9t=Kt(({outsideIOR:i,eta2:e,cosTheta1:t,thinFilmThickness:n,baseF0:r})=>{const s=zs(i,e,K2(0,.03,n)),a=i.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();Go(a.lessThan(0),()=>Lt(1));const c=a.sqrt(),u=PTe(s,i),f=HM({f0:u,f90:1,dotVH:t}),m=f.oneMinus(),v=s.lessThan(i).select(Math.PI,0),x=It(Math.PI).sub(v),T=l9t(r.clamp(0,.9999)),P=PTe(T,s.toVec3()),R=HM({f0:P,f90:1,dotVH:c}),M=Lt(T.x.lessThan(s).select(Math.PI,0),T.y.lessThan(s).select(Math.PI,0),T.z.lessThan(s).select(Math.PI,0)),O=s.mul(n,c,2),C=Lt(x).add(M),L=f.mul(R).clamp(1e-5,.9999),Y=L.sqrt(),J=m.pow2().mul(R).div(Lt(1).sub(L)),ne=f.add(J).toVar(),K=J.sub(m).toVar();return vd({start:1,end:2,condition:"<=",name:"m"},({m:$})=>{K.mulAssign(Y);const he=c9t(It($).mul(O),It($).mul(C)).mul(2);ne.addAssign(K.mul(he))}),ne.max(Lt(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),h9t=Kt(({normal:i,viewDir:e,roughness:t})=>{const n=i.dot(e).saturate(),r=t.pow2(),s=ql(t.lessThan(.25),It(-339.2).mul(r).add(It(161.4).mul(t)).sub(25.9),It(-8.48).mul(r).add(It(14.3).mul(t)).sub(9.95)),o=ql(t.lessThan(.25),It(44).mul(r).sub(It(23.7).mul(t)).add(3.26),It(1.97).mul(r).sub(It(3.27).mul(t)).add(.72));return ql(t.lessThan(.25),0,It(.1).mul(t).sub(.025)).add(s.mul(n).add(o).exp()).mul(1/Math.PI).saturate()}),QQ=Lt(.04),JQ=It(1);class tke extends Mz{constructor(e=!1,t=!1,n=!1,r=!1,s=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=r,this.transmission=s,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=Lt().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=Lt().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=Lt().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=Lt().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=Lt().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=ia.dot(fo).clamp();this.iridescenceFresnel=u9t({outsideIOR:It(1),eta2:JNe,cosTheta1:t,thinFilmThickness:eIe,baseF0:$c}),this.iridescenceF0=K3t({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=GM,n=jgt.sub(GM).normalize(),r=Kie,s=e.context;s.backdrop=o9t(r,n,b1,Li,$c,pU,t,M4,lm,Xie,eL,tIe,rIe,nIe,this.dispersion?iIe:null),s.backdropAlpha=Dte,Li.a.mulAssign(zs(1,s.backdrop.a,Dte))}super.start(e)}computeMultiscattering(e,t,n){const r=ia.dot(fo).clamp(),s=ZIe({roughness:b1,dotNV:r}),a=(this.iridescenceF0?Lie.mix($c,this.iridescenceF0):$c).mul(s.x).add(n.mul(s.y)),u=s.x.add(s.y).oneMinus(),f=$c.add($c.oneMinus().mul(.047619)),m=a.mul(f).div(u.mul(f).oneMinus());e.addAssign(a),t.addAssign(m.mul(u))}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const s=ia.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(s.mul(J3t({lightDirection:e}))),this.clearcoat===!0){const a=yE.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(xTe({lightDirection:e,f0:QQ,f90:JQ,roughness:fU,normalView:yE})))}n.directDiffuse.addAssign(s.mul(lx({diffuseColor:Li.rgb}))),n.directSpecular.addAssign(s.mul(xTe({lightDirection:e,f0:$c,f90:1,roughness:b1,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:r,reflectedLight:s,ltc_1:o,ltc_2:a}){const c=t.add(n).sub(r),u=t.sub(n).sub(r),f=t.sub(n).add(r),m=t.add(n).add(r),v=ia,x=fo,T=aa.toVar(),P=e9t({N:v,V:x,roughness:b1}),R=o.sample(P).toVar(),M=a.sample(P).toVar(),O=B0(Lt(R.x,0,R.y),Lt(0,1,0),Lt(R.z,0,R.w)).toVar(),C=$c.mul(M.x).add($c.oneMinus().mul(M.y)).toVar();s.directSpecular.addAssign(e.mul(C).mul(bTe({N:v,V:x,P:T,mInv:O,p0:c,p1:u,p2:f,p3:m}))),s.directDiffuse.addAssign(e.mul(Li).mul(bTe({N:v,V:x,P:T,mInv:B0(1,0,0,0,1,0,0,0,1),p0:c,p1:u,p2:f,p3:m})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(t.mul(lx({diffuseColor:Li})))}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:r}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(n.mul(q6,h9t({normal:ia,viewDir:fo,roughness:Bie}))),this.clearcoat===!0){const f=yE.dot(fo).clamp(),m=QIe({dotNV:f,specularColor:QQ,specularF90:JQ,roughness:fU});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(m))}const s=Lt().toVar("singleScattering"),o=Lt().toVar("multiScattering"),a=n.mul(1/Math.PI);this.computeMultiscattering(s,o,pU);const c=s.add(o),u=Li.mul(c.r.max(c.g).max(c.b).oneMinus());r.indirectSpecular.addAssign(t.mul(s)),r.indirectSpecular.addAssign(o.mul(a)),r.indirectDiffuse.addAssign(u.mul(a))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,s=ia.dot(fo).clamp().add(t),o=b1.mul(-16).oneMinus().negate().exp2(),a=t.sub(s.pow(o).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(a)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const n=yE.dot(fo).clamp(),r=HM({dotVH:n,f0:QQ,f90:JQ}),s=t.mul(Nte.mul(r).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Nte));t.assign(s)}if(this.sheen===!0){const n=q6.r.max(q6.g).max(q6.b).mul(.157).oneMinus(),r=t.mul(n).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(r)}}}const NTe=It(1),Lte=It(-2),uB=It(.8),eJ=It(-1),hB=It(.4),tJ=It(2),dB=It(.305),nJ=It(3),ITe=It(.21),d9t=It(4),kTe=It(4),f9t=It(16),p9t=Kt(([i])=>{const e=Lt(Hu(i)).toVar(),t=It(-1).toVar();return Go(e.x.greaterThan(e.z),()=>{Go(e.x.greaterThan(e.y),()=>{t.assign(ql(i.x.greaterThan(0),0,3))}).Else(()=>{t.assign(ql(i.y.greaterThan(0),1,4))})}).Else(()=>{Go(e.z.greaterThan(e.y),()=>{t.assign(ql(i.z.greaterThan(0),2,5))}).Else(()=>{t.assign(ql(i.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),m9t=Kt(([i,e])=>{const t=Tn().toVar();return Go(e.equal(0),()=>{t.assign(Tn(i.z,i.y).div(Hu(i.x)))}).ElseIf(e.equal(1),()=>{t.assign(Tn(i.x.negate(),i.z.negate()).div(Hu(i.y)))}).ElseIf(e.equal(2),()=>{t.assign(Tn(i.x.negate(),i.y).div(Hu(i.z)))}).ElseIf(e.equal(3),()=>{t.assign(Tn(i.z.negate(),i.y).div(Hu(i.x)))}).ElseIf(e.equal(4),()=>{t.assign(Tn(i.x.negate(),i.z).div(Hu(i.y)))}).Else(()=>{t.assign(Tn(i.x,i.y).div(Hu(i.z)))}),pi(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),g9t=Kt(([i])=>{const e=It(0).toVar();return Go(i.greaterThanEqual(uB),()=>{e.assign(NTe.sub(i).mul(eJ.sub(Lte)).div(NTe.sub(uB)).add(Lte))}).ElseIf(i.greaterThanEqual(hB),()=>{e.assign(uB.sub(i).mul(tJ.sub(eJ)).div(uB.sub(hB)).add(eJ))}).ElseIf(i.greaterThanEqual(dB),()=>{e.assign(hB.sub(i).mul(nJ.sub(tJ)).div(hB.sub(dB)).add(tJ))}).ElseIf(i.greaterThanEqual(ITe),()=>{e.assign(dB.sub(i).mul(d9t.sub(nJ)).div(dB.sub(ITe)).add(nJ))}).Else(()=>{e.assign(It(-2).mul(U1(pi(1.16,i))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),y9t=Kt(([i,e])=>{const t=i.toVar();t.assign(pi(2,t).sub(1));const n=Lt(t,1).toVar();return Go(e.equal(0),()=>{n.assign(n.zyx)}).ElseIf(e.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),v9t=Kt(([i,e,t,n,r,s])=>{const o=It(t),a=Lt(e),c=em(g9t(o),Lte,s),u=s3(c),f=a4(c),m=Lt(Ute(i,a,f,n,r,s)).toVar();return Go(u.notEqual(0),()=>{const v=Lt(Ute(i,a,f.add(1),n,r,s)).toVar();m.assign(zs(m,v,u))}),m}),Ute=Kt(([i,e,t,n,r,s])=>{const o=It(t).toVar(),a=Lt(e),c=It(p9t(a)).toVar(),u=It(Jl(kTe.sub(o),0)).toVar();o.assign(Jl(o,kTe));const f=It(zM(o)).toVar(),m=Tn(m9t(a,c).mul(f.sub(2)).add(1)).toVar();return Go(c.greaterThan(2),()=>{m.y.addAssign(f),c.subAssign(3)}),m.x.addAssign(c.mul(f)),m.x.addAssign(u.mul(pi(3,f9t))),m.y.addAssign(pi(4,zM(s).sub(f))),m.x.mulAssign(n),m.y.mulAssign(r),i.sample(m).grad(Tn(),Tn())}),rJ=Kt(({envMap:i,mipInt:e,outputDirection:t,theta:n,axis:r,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const c=m2(n),u=t.mul(c).add(r.cross(t).mul(pd(n))).add(r.mul(r.dot(t).mul(c.oneMinus())));return Ute(i,u,e,s,o,a)}),_9t=Kt(({n:i,latitudinal:e,poleAxis:t,outputDirection:n,weights:r,samples:s,dTheta:o,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:m})=>{const v=Lt(ql(e,t,mIe(t,n))).toVar();Go(v.equal(Lt(0)),()=>{v.assign(Lt(n.z,0,n.x.negate()))}),v.assign(VM(v));const x=Lt().toVar();return x.addAssign(r.element(0).mul(rJ({theta:0,axis:v,outputDirection:n,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:m}))),vd({start:Ns(1),end:i},({i:T})=>{Go(T.greaterThanEqual(s),()=>{s3t()});const P=It(o.mul(It(T))).toVar();x.addAssign(r.element(T).mul(rJ({theta:P.mul(-1),axis:v,outputDirection:n,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:m}))),x.addAssign(r.element(T).mul(rJ({theta:P,axis:v,outputDirection:n,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:m})))}),$r(x,1)}),X6=4,DTe=[.125,.215,.35,.446,.526,.582],Vy=20,iJ=new w4(-1,1,1,-1,0,1),x9t=new po(90,1),FTe=new yn;let sJ=null,oJ=0,aJ=0;const Iy=(1+Math.sqrt(5))/2,f6=1/Iy,OTe=[new be(-Iy,f6,0),new be(Iy,f6,0),new be(-f6,0,Iy),new be(f6,0,Iy),new be(0,Iy,-f6),new be(0,Iy,f6),new be(-1,1,-1),new be(1,1,-1),new be(-1,1,1),new be(1,1,1)],b9t=new be,nke=new WeakMap,S9t=[3,1,5,0,4,2],lJ=y9t(xC(),Z2("faceIndex")).normalize(),tse=Lt(lJ.x,lJ.y,lJ.z);class w9t{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,n=.1,r=100,s={}){const{size:o=256,position:a=b9t,renderTarget:c=null}=s;if(this._setSize(o),this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const f=c||this._allocateTarget();return s.renderTarget=f,this.fromSceneAsync(e,t,n,r,s),f}sJ=this._renderer.getRenderTarget(),oJ=this._renderer.getActiveCubeFace(),aJ=this._renderer.getActiveMipmapLevel();const u=c||this._allocateTarget();return u.depthBuffer=!0,this._init(u),this._sceneToCubeUV(e,n,r,u,a),t>0&&this._blur(u,0,0,t),this._applyPMREM(u),this._cleanup(u),u}async fromSceneAsync(e,t=0,n=.1,r=100,s={}){return this._hasInitialized===!1&&await this._renderer.init(),this.fromScene(e,t,n,r,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=LTe(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=UTe(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===Wf||e.mapping===qf?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(sJ,oJ,aJ),e.scissorTest=!1,fB(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),sJ=this._renderer.getRenderTarget(),oJ=this._renderer.getActiveCubeFace(),aJ=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTarget();return this._init(n),this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return BTe(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=BTe(e.width,e.height);const{_lodMax:t}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=T9t(t)),this._blurMaterial=E9t(t,e.width,e.height)}}async _compileMaterial(e){const t=new dn(this._lodPlanes[0],e);await this._renderer.compile(t,iJ)}_sceneToCubeUV(e,t,n,r,s){const o=x9t;o.near=t,o.far=n;const a=[1,1,1,1,-1,1],c=[1,-1,1,-1,1,-1],u=this._renderer,f=u.autoClear;u.getClearColor(FTe),u.autoClear=!1;let m=this._backgroundBox;if(m===null){const T=new Ea({name:"PMREM.Background",side:Ui,depthWrite:!1,depthTest:!1});m=new dn(new Oo,T)}let v=!1;const x=e.background;x?x.isColor&&(m.material.color.copy(x),e.background=null,v=!0):(m.material.color.copy(FTe),v=!0),u.setRenderTarget(r),u.clear(),v&&u.render(m,o);for(let T=0;T<6;T++){const P=T%3;P===0?(o.up.set(0,a[T],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x+c[T],s.y,s.z)):P===1?(o.up.set(0,0,a[T]),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y+c[T],s.z)):(o.up.set(0,a[T],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y,s.z+c[T]));const R=this._cubeSize;fB(r,P*R,T>2?R:0,R,R),u.render(e,o)}u.autoClear=f,e.background=x}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===Wf||e.mapping===qf;r?this._cubemapMaterial===null&&(this._cubemapMaterial=LTe(e)):this._equirectMaterial===null&&(this._equirectMaterial=UTe(e));const s=r?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=s;const a=this._cubeSize;fB(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(o,iJ)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=OTe[(r-s-1)%OTe.length];this._blur(e,s-1,s,o,a)}t.autoClear=n}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,a){const c=this._renderer,u=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const f=3,m=this._lodMeshes[r];m.material=u;const v=nke.get(u),x=this._sizeLods[n]-1,T=isFinite(s)?Math.PI/(2*x):2*Math.PI/(2*Vy-1),P=s/T,R=isFinite(s)?1+Math.floor(f*P):Vy;R>Vy&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${R} samples when the maximum is set to ${Vy}`);const M=[];let O=0;for(let z=0;z<Vy;++z){const ne=z/P,K=Math.exp(-ne*ne/2);M.push(K),z===0?O+=K:z<R&&(O+=2*K)}for(let z=0;z<M.length;z++)M[z]=M[z]/O;e.texture.frame=(e.texture.frame||0)+1,v.envMap.value=e.texture,v.samples.value=R,v.weights.array=M,v.latitudinal.value=o==="latitudinal"?1:0,a&&(v.poleAxis.value=a);const{_lodMax:C}=this;v.dTheta.value=T,v.mipInt.value=C-n;const L=this._sizeLods[r],Y=3*L*(r>C-X6?r-C+X6:0),J=4*(this._cubeSize-L);fB(t,Y,J,3*L,2*L),c.setRenderTarget(t),c.render(m,iJ)}}function T9t(i){const e=[],t=[],n=[],r=[];let s=i;const o=i-X6+1+DTe.length;for(let a=0;a<o;a++){const c=Math.pow(2,s);t.push(c);let u=1/c;a>i-X6?u=DTe[a-i+X6-1]:a===0&&(u=0),n.push(u);const f=1/(c-2),m=-f,v=1+f,x=[m,m,v,m,v,v,m,m,v,v,m,v],T=6,P=6,R=3,M=2,O=1,C=new Float32Array(R*P*T),L=new Float32Array(M*P*T),Y=new Float32Array(O*P*T);for(let z=0;z<T;z++){const ne=z%3*2/3-1,K=z>2?0:-1,$=[ne,K,0,ne+2/3,K,0,ne+2/3,K+1,0,ne,K,0,ne+2/3,K+1,0,ne,K+1,0],he=S9t[z];C.set($,R*P*he),L.set(x,M*P*he);const Ce=[he,he,he,he,he,he];Y.set(Ce,O*P*he)}const J=new Xi;J.setAttribute("position",new Ra(C,R)),J.setAttribute("uv",new Ra(L,M)),J.setAttribute("faceIndex",new Ra(Y,O)),e.push(J),r.push(new dn(J,null)),s>X6&&s--}return{lodPlanes:e,sizeLods:t,sigmas:n,lodMeshes:r}}function BTe(i,e){const t={magFilter:_s,minFilter:_s,generateMipmaps:!1,type:Aa,format:xs,colorSpace:_l},n=new t3(i,e,t);return n.texture.mapping=_4,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function fB(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function nse(i){const e=new ca;return e.depthTest=!1,e.depthWrite=!1,e.blending=vl,e.name=`PMREM_${i}`,e}function E9t(i,e,t){const n=Vf(new Array(Vy).fill(0)),r=Cr(new be(0,1,0)),s=Cr(0),o=It(Vy),a=Cr(0),c=Cr(1),u=Pi(null),f=Cr(0),m=It(1/e),v=It(1/t),x=It(i),T={n:o,latitudinal:a,weights:n,poleAxis:r,outputDirection:tse,dTheta:s,samples:c,envMap:u,mipInt:f,CUBEUV_TEXEL_WIDTH:m,CUBEUV_TEXEL_HEIGHT:v,CUBEUV_MAX_MIP:x},P=nse("blur");return P.fragmentNode=_9t({...T,latitudinal:a.equal(1)}),nke.set(P,T),P}function LTe(i){const e=nse("cubemap");return e.fragmentNode=$M(i,tse),e}function UTe(i){const e=nse("equirect");return e.fragmentNode=Pi(i,HIe(tse),0),e}const zTe=new WeakMap;function M9t(i){const e=Math.log2(i)-2,t=1/i;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function C9t(i,e,t){const n=A9t(e);let r=n.get(i);if((r!==void 0?r.pmremVersion:-1)!==i.pmremVersion){const o=i.image;if(i.isCubeTexture)if(P9t(o))r=t.fromCubemap(i,r);else return null;else if(N9t(o))r=t.fromEquirectangular(i,r);else return null;r.pmremVersion=i.pmremVersion,n.set(i,r)}return r.texture}function A9t(i){let e=zTe.get(i);return e===void 0&&(e=new WeakMap,zTe.set(i,e)),e}class R9t extends da{static get type(){return"PMREMNode"}constructor(e,t=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const r=new Ao;r.isRenderTargetTexture=!0,this._texture=Pi(r),this._width=Cr(0),this._height=Cr(0),this._maxMip=Cr(0),this.updateBeforeType=ci.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=M9t(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,r=this._value;n!==r.pmremVersion&&(r.isPMREMTexture===!0?t=r:t=C9t(r,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new w9t(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this)),t=IIe.mul(Lt(t.x,t.y.negate(),t.z));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),v9t(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function P9t(i){if(i==null)return!1;let e=0;const t=6;for(let n=0;n<t;n++)i[n]!==void 0&&e++;return e===t}function N9t(i){return i==null?!1:i.height>0}const rke=Qt(R9t).setParameterLength(1,3),VTe=new WeakMap;class I9t extends Px{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const m=n.isTextureNode?n.value:t[n.property];let v=VTe.get(m);v===void 0&&(v=rke(m),VTe.set(m,v)),n=v}const s=t.useAnisotropy===!0||t.anisotropy>0?h2t:ia,o=n.context(GTe(b1,s)).mul(XQ),a=n.context(k9t(Kie)).mul(Math.PI).mul(XQ),c=nL(o),u=nL(a);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(u);const f=e.context.lightingModel.clearcoatRadiance;if(f){const m=n.context(GTe(fU,yE)).mul(XQ),v=nL(m);f.addAssign(v)}}}const GTe=(i,e)=>{let t=null;return{getUV:()=>(t===null&&(t=fo.negate().reflect(e),t=i.mul(i).mix(t,e).normalize(),t=t.transformDirection(lm)),t),getTextureLevel:()=>i}},k9t=i=>({getUV:()=>i,getTextureLevel:()=>It(1)}),D9t=new yAe;class ike extends ca{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(D9t),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new I9t(t):null}setupLightingModel(){return new tke}setupSpecular(){const e=zs(Lt(.04),Li.rgb,dU);$c.assign(e),pU.assign(1)}setupVariants(){const e=this.metalnessNode?It(this.metalnessNode):E2t;dU.assign(e);let t=this.roughnessNode?It(this.roughnessNode):T2t;t=KIe({roughness:t}),b1.assign(t),this.setupSpecular(),Li.assign($r(Li.rgb.mul(e.oneMinus()),Li.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const F9t=new jU;class O9t extends ike{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(F9t),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?It(this.iorNode):U2t;eL.assign(e),$c.assign(zs(ox(gIe(eL.sub(1).div(eL.add(1))).mul(w2t),Lt(1)).mul(pTe),Li.rgb,dU)),pU.assign(zs(pTe,1,dU))}setupLightingModel(){return new tke(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?It(this.clearcoatNode):C2t,n=this.clearcoatRoughnessNode?It(this.clearcoatRoughnessNode):A2t;Nte.assign(t),fU.assign(KIe({roughness:n}))}if(this.useSheen){const t=this.sheenNode?Lt(this.sheenNode):N2t,n=this.sheenRoughnessNode?It(this.sheenRoughnessNode):I2t;q6.assign(t),Bie.assign(n)}if(this.useIridescence){const t=this.iridescenceNode?It(this.iridescenceNode):D2t,n=this.iridescenceIORNode?It(this.iridescenceIORNode):F2t,r=this.iridescenceThicknessNode?It(this.iridescenceThicknessNode):O2t;Lie.assign(t),JNe.assign(n),eIe.assign(r)}if(this.useAnisotropy){const t=(this.anisotropyNode?Tn(this.anisotropyNode):k2t).toVar();Ny.assign(t.length()),Go(Ny.equal(0),()=>{t.assign(Tn(1,0))}).Else(()=>{t.divAssign(Tn(Ny)),Ny.assign(Ny.saturate())}),Ite.assign(Ny.pow2().mix(b1.pow2(),1)),JB.assign(vE[0].mul(t.x).add(vE[1].mul(t.y))),g_.assign(vE[1].mul(t.x).sub(vE[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?It(this.transmissionNode):B2t,n=this.thicknessNode?It(this.thicknessNode):L2t,r=this.attenuationDistanceNode?It(this.attenuationDistanceNode):z2t,s=this.attenuationColorNode?Lt(this.attenuationColorNode):V2t;if(Dte.assign(t),tIe.assign(n),nIe.assign(r),rIe.assign(s),this.useDispersion){const o=this.dispersionNode?It(this.dispersionNode):q2t;iIe.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?Lt(this.clearcoatNormalNode):R2t}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const B9t=Kt(({normal:i,lightDirection:e,builder:t})=>{const n=i.dot(e),r=Tn(n.mul(.5).add(.5),0);if(t.material.gradientMap){const s=b2("gradientMap","texture").context({getUV:()=>r});return Lt(s.r)}else{const s=r.fwidth().mul(.5);return zs(Lt(.7),Lt(1),K2(It(.7).sub(s.x),It(.7).add(s.x),r.x))}});class L9t extends Mz{direct({lightDirection:e,lightColor:t,reflectedLight:n},r){const s=B9t({normal:PIe,lightDirection:e,builder:r}).mul(t);n.directDiffuse.addAssign(s.mul(lx({diffuseColor:Li.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(lx({diffuseColor:Li}))),r.indirectDiffuse.mulAssign(t)}}const U9t=new EXe;class z9t extends ca{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(U9t),this.setValues(e)}setupLightingModel(){return new L9t}}class V9t extends da{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=Lt(fo.z,0,fo.x.negate()).normalize(),t=fo.cross(e);return Tn(e.dot(ia),t.dot(ia)).mul(.495).add(.5)}}const G9t=bn(V9t),$9t=new xre;class H9t extends ca{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues($9t),this.setValues(e)}setupVariants(e){const t=G9t;let n;e.material.matcap?n=b2("matcap","texture").context({getUV:()=>t}):n=Lt(zs(.2,.8,t.y)),Li.rgb.mulAssign(n.rgb)}}class j9t extends da{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),o=t.sin();return Oie(s,o,o.negate(),s).mul(n)}else{const s=t,o=m_($r(1,0,0,0),$r(0,m2(s.x),pd(s.x).negate(),0),$r(0,pd(s.x),m2(s.x),0),$r(0,0,0,1)),a=m_($r(m2(s.y),0,pd(s.y),0),$r(0,1,0,0),$r(pd(s.y).negate(),0,m2(s.y),0),$r(0,0,0,1)),c=m_($r(m2(s.z),pd(s.z).negate(),0,0),$r(pd(s.z),m2(s.z),0,0),$r(0,0,1,0),$r(0,0,0,1));return o.mul(a).mul(c).mul($r(n,1)).xyz}}}const ske=Qt(j9t).setParameterLength(2),W9t=new Zqe;class oke extends ca{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(W9t),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,r=this.sizeAttenuation,{positionNode:s,rotationNode:o,scaleNode:a}=this,c=Sz.mul(Lt(s||0));let u=Tn(M4[0].xyz.length(),M4[1].xyz.length());if(a!==null&&(u=u.mul(Tn(a))),r===!1)if(n.isPerspectiveCamera)u=u.mul(c.z.negate());else{const x=It(2).div(Xie.element(1).element(1));u=u.mul(x.mul(2))}let f=wz.xy;if(t.center&&t.center.isVector2===!0){const x=ygt("center","vec2",t);f=f.sub(x.sub(.5))}f=f.mul(u);const m=It(o||P2t),v=ske(f,m);return $r(c.xy.add(v),c.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const q9t=new pre;class X9t extends oke{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(q9t),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return Sz.mul(Lt(e||Hl)).xyz}setupVertex(e){const t=super.setupVertex(e);if(e.material.isNodeMaterial!==!0)return t;const{rotationNode:n,scaleNode:r,sizeNode:s}=this,o=wz.xy.toVar(),a=$E.z.div($E.w);if(n&&n.isNode){const u=It(n);o.assign(ske(o,u))}let c=s!==null?Tn(s):W2t;return this.sizeAttenuation===!0&&(c=c.mul(c.div(aa.z.negate()))),r&&r.isNode&&(c=c.mul(Tn(r))),o.mulAssign(c.mul(2)),o.assign(o.div($E.z)),o.y.assign(o.y.mul(a)),o.assign(o.mul(t.w)),t.addAssign($r(o,0,0)),t}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}class Y9t extends Mz{constructor(){super(),this.shadowNode=It(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){Li.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Li.rgb)}}const K9t=new TXe;class Z9t extends ca{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(K9t),this.setValues(e)}setupLightingModel(){return new Y9t}}vC("vec3");vC("vec3");vC("vec3");class Q9t{constructor(e,t){this.nodes=e,this.info=t,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this._animationLoop!==null&&this._animationLoop(t,n)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class Md{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let n=this.weakMap;for(let r=0;r<e.length-1;r++){const s=e[r];n.has(s)===!1&&n.set(s,new WeakMap),n=n.get(s)}return n.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return!1;return t.delete(e[e.length-1])}}let J9t=0;function eyt(i){const e=Object.keys(i);let t=Object.getPrototypeOf(i);for(;t;){const n=Object.getOwnPropertyDescriptors(t);for(const r in n)if(n[r]!==void 0){const s=n[r];s&&typeof s.get=="function"&&e.push(r)}t=Object.getPrototypeOf(t)}return e}class tyt{constructor(e,t,n,r,s,o,a,c,u,f){this.id=J9t++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=r,this.material=s,this.scene=o,this.camera=a,this.lightsNode=c,this.context=u,this.geometry=r.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=f,this.clippingContextCacheKey=f!==null?f.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],r=new Set;for(const s of e){const o=s.node&&s.node.attribute?s.node.attribute:t.getAttribute(s.name);if(o===void 0)continue;n.push(o);const a=o.isInterleavedBufferAttribute?o.data:o;r.add(a)}return this.attributes=n,this.vertexBuffers=Array.from(r.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:r,drawRange:s}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),a=this.getIndex(),c=a!==null;let u=1;if(n.isInstancedBufferGeometry===!0?u=n.instanceCount:e.count!==void 0&&(u=Math.max(0,e.count)),u===0)return null;if(o.instanceCount=u,e.isBatchedMesh===!0)return o;let f=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(f=2);let m=s.start*f,v=(s.start+s.count)*f;r!==null&&(m=Math.max(m,r.start*f),v=Math.min(v,(r.start+r.count)*f));const x=n.attributes.position;let T=1/0;c?T=a.count:x!=null&&(T=x.count),m=Math.max(m,0),v=Math.min(v,T);const P=v-m;return P<0||P===1/0?null:(o.vertexCount=P,o.firstVertex=m,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const r=e.attributes[n];t+=n+",",r.data&&(t+=r.data.stride+","),r.offset&&(t+=r.offset+","),r.itemSize&&(t+=r.itemSize+","),r.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const r=e.morphAttributes[n];t+="morph-"+n+",";for(let s=0,o=r.length;s<o;s++){const a=r[s];t+=a.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t}=this;let n=t.customProgramCacheKey();for(const r of eyt(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(r))continue;const s=t[r];let o;if(s!==null){const a=typeof s;a==="number"?o=s!==0?"1":"0":a==="object"?(o="{",s.isTexture&&(o+=s.mapping),o+="}"):o=String(s)}else o=String(s);n+=o+","}return n+=this.clippingContextCacheKey+",",e.geometry&&(n+=this.getGeometryCacheKey()),e.skeleton&&(n+=e.skeleton.bones.length+","),e.isBatchedMesh&&(n+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(n+=e._colorsTexture.uuid+",")),e.count>1&&(n+=e.uuid+","),n+=e.receiveShadow+",",g1t(n)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=aU(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=aU(e,1)),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const gy=[];class nyt{constructor(e,t,n,r,s,o){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=r,this.bindings=s,this.info=o,this.chainMaps={}}get(e,t,n,r,s,o,a,c){const u=this.getChainMap(c);gy[0]=e,gy[1]=t,gy[2]=o,gy[3]=s;let f=u.get(gy);return f===void 0?(f=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,r,s,o,a,c),u.set(gy,f)):(f.updateClipping(a),f.needsGeometryUpdate&&f.setGeometry(e.geometry),(f.version!==t.version||f.needsUpdate)&&(f.initialCacheKey!==f.getCacheKey()?(f.dispose(),f=this.get(e,t,n,r,s,o,a,c)):f.version=t.version)),gy.length=0,f}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Md)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,r,s,o,a,c,u,f,m){const v=this.getChainMap(m),x=new tyt(e,t,n,r,s,o,a,c,u,f);return x.onDispose=()=>{this.pipelines.delete(x),this.bindings.delete(x),this.nodes.delete(x),v.delete(x.getChainArray())},x}}class o3{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const Ku={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},S2=16,ryt=211,iyt=212;class syt extends o3{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(n.version===void 0)t===Ku.VERTEX?this.backend.createAttribute(e):t===Ku.INDEX?this.backend.createIndexAttribute(e):t===Ku.STORAGE?this.backend.createStorageAttribute(e):t===Ku.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const r=this._getBufferAttribute(e);(n.version<r.version||r.usage===O6)&&(this.backend.updateAttribute(e),n.version=r.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function ake(i){return i.index!==null?i.index.version:i.attributes.position.version}function $Te(i){const e=[],t=i.index,n=i.attributes.position;if(t!==null){const s=t.array;for(let o=0,a=s.length;o<a;o+=3){const c=s[o+0],u=s[o+1],f=s[o+2];e.push(c,u,u,f,f,c)}}else{const s=n.array;for(let o=0,a=s.length/3-1;o<a;o+=3){const c=o+0,u=o+1,f=o+2;e.push(c,u,u,f,f,c)}}const r=new(are(e)?hre:$U)(e,1);return r.version=ake(i),r}class oyt extends o3{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,n=this.get(t);n.initialized=!0,this.info.memory.geometries++;const r=()=>{this.info.memory.geometries--;const s=t.index,o=e.getAttributes();s!==null&&this.attributes.delete(s);for(const c of o)this.attributes.delete(c);const a=this.wireframes.get(t);a!==void 0&&this.attributes.delete(a),t.removeEventListener("dispose",r)};t.addEventListener("dispose",r)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,Ku.STORAGE):this.updateAttribute(s,Ku.VERTEX);const n=this.getIndex(e);n!==null&&this.updateAttribute(n,Ku.INDEX);const r=e.geometry.indirect;r!==null&&this.updateAttribute(r,Ku.INDIRECT)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:n}=e;let r=t.index;if(n.wireframe===!0){const s=this.wireframes;let o=s.get(t);o===void 0?(o=$Te(t),s.set(t,o)):o.version!==ake(t)&&(this.attributes.delete(o),o=$Te(t),s.set(t,o)),r=o}return r}}class ayt{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):console.error("THREE.WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class lke{constructor(e){this.cacheKey=e,this.usedTimes=0}}class lyt extends lke{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}}class cyt extends lke{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let uyt=0;class cJ{constructor(e,t,n,r=null,s=null){this.id=uyt++,this.code=e,this.stage=t,this.name=n,this.transforms=r,this.attributes=s,this.usedTimes=0}}class hyt extends o3{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,r=this.get(e);if(this._needsComputeUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let a=this.programs.compute.get(o.computeShader);a===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),a=new cJ(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,a),n.createProgram(a));const c=this._getComputeCacheKey(e,a);let u=this.caches.get(c);u===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),u=this._getComputePipeline(e,a,c,t)),u.usedTimes++,a.usedTimes++,r.version=e.version,r.pipeline=u}return r.pipeline}getForRender(e,t=null){const{backend:n}=this,r=this.get(e);if(this._needsRenderUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),a=e.material?e.material.name:"";let c=this.programs.vertex.get(o.vertexShader);c===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),c=new cJ(o.vertexShader,"vertex",a),this.programs.vertex.set(o.vertexShader,c),n.createProgram(c));let u=this.programs.fragment.get(o.fragmentShader);u===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),u=new cJ(o.fragmentShader,"fragment",a),this.programs.fragment.set(o.fragmentShader,u),n.createProgram(u));const f=this._getRenderCacheKey(e,c,u);let m=this.caches.get(f);m===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),m=this._getRenderPipeline(e,c,u,f,t)):e.pipeline=m,m.usedTimes++,c.usedTimes++,u.usedTimes++,r.pipeline=m}return r.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,r){n=n||this._getComputeCacheKey(e,t);let s=this.caches.get(n);return s===void 0&&(s=new cyt(n,t),this.caches.set(n,s),this.backend.createComputePipeline(s,r)),s}_getRenderPipeline(e,t,n,r,s){r=r||this._getRenderCacheKey(e,t,n);let o=this.caches.get(r);return o===void 0&&(o=new lyt(r,t,n),this.caches.set(r,o),e.pipeline=o,this.backend.createRenderPipeline(e,s)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class dyt extends o3{constructor(e,t,n,r,s,o){super(),this.backend=e,this.textures=n,this.pipelines=s,this.attributes=r,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const n of t){const r=this.get(n);r.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),r.bindGroup=n)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t){const r=this.get(n);r.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),r.bindGroup=n)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isStorageBuffer){const n=t.attribute,r=n.isIndirectStorageBufferAttribute?Ku.INDIRECT:Ku.STORAGE;this.attributes.update(n,r)}}_update(e,t){const{backend:n}=this;let r=!1,s=!0,o=0,a=0;for(const c of e.bindings)if(!(c.isNodeUniformsGroup&&this.nodes.updateGroup(c)===!1)){if(c.isStorageBuffer){const u=c.attribute,f=u.isIndirectStorageBufferAttribute?Ku.INDIRECT:Ku.STORAGE;this.attributes.update(u,f)}if(c.isUniformBuffer)c.update()&&n.updateBinding(c);else if(c.isSampler)c.update();else if(c.isSampledTexture){const u=this.textures.get(c.texture);c.needsBindingsUpdate(u.generation)&&(r=!0);const f=c.update(),m=c.texture;f&&this.textures.updateTexture(m);const v=n.get(m);if(v.externalTexture!==void 0||u.isDefaultTexture?s=!1:(o=o*10+m.id,a+=m.version),n.isWebGPUBackend===!0&&v.texture===void 0&&v.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",c,f,m,c.textureNode.value,r),this.textures.updateTexture(m),r=!0),m.isStorageTexture===!0){const x=this.get(m);c.store===!0?x.needsMipmap=!0:this.textures.needsMipmaps(m)&&x.needsMipmap===!0&&(this.backend.generateMipmaps(m),x.needsMipmap=!1)}}}r===!0&&this.backend.updateBindings(e,t,s?o:0,a)}}function fyt(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?i.z-e.z:i.id-e.id}function HTe(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function jTe(i){return(i.transmission>0||i.transmissionNode)&&i.side===Co&&i.forceSinglePass===!1}class pyt{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,r,s,o,a){let c=this.renderItems[this.renderItemsIndex];return c===void 0?(c={id:e.id,object:e,geometry:t,material:n,groupOrder:r,renderOrder:e.renderOrder,z:s,group:o,clippingContext:a},this.renderItems[this.renderItemsIndex]=c):(c.id=e.id,c.object=e,c.geometry=t,c.material=n,c.groupOrder=r,c.renderOrder=e.renderOrder,c.z=s,c.group=o,c.clippingContext=a),this.renderItemsIndex++,c}push(e,t,n,r,s,o,a){const c=this.getNextRenderItem(e,t,n,r,s,o,a);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0?(jTe(n)&&this.transparentDoublePass.push(c),this.transparent.push(c)):this.opaque.push(c)}unshift(e,t,n,r,s,o,a){const c=this.getNextRenderItem(e,t,n,r,s,o,a);n.transparent===!0||n.transmission>0?(jTe(n)&&this.transparentDoublePass.unshift(c),this.transparent.unshift(c)):this.opaque.unshift(c)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||fyt),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||HTe),this.transparent.length>1&&this.transparent.sort(t||HTe)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const n=this.renderItems[e];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null,n.clippingContext=null}}}const GT=[];class myt{constructor(e){this.lighting=e,this.lists=new Md}get(e,t){const n=this.lists;GT[0]=e,GT[1]=t;let r=n.get(GT);return r===void 0&&(r=new pyt(this.lighting,e,t),n.set(GT,r)),GT.length=0,r}dispose(){this.lists=new Md}}let gyt=0;class yyt{constructor(){this.id=gyt++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new ir,this.scissor=!1,this.scissorValue=new ir,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return cke(this)}}function cke(i){const{textures:e,activeCubeFace:t}=i,n=[t];for(const r of e)n.push(r.id);return Pie(n)}const $T=[],vyt=new W1,_yt=new aC;class xyt{constructor(){this.chainMaps={}}get(e,t,n=null){$T[0]=e,$T[1]=t;let r;if(n===null)r="default";else{const a=n.texture.format;r=`${n.textures.length}:${a}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const s=this._getChainMap(r);let o=s.get($T);return o===void 0&&(o=new yyt,s.set($T,o)),$T.length=0,n!==null&&(o.sampleCount=n.samples===0?1:n.samples),o}getForClear(e=null){return this.get(vyt,_yt,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Md)}dispose(){this.chainMaps={}}}const byt=new be;class Syt extends o3{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e,t=0){const n=this.get(e),r=e.samples===0?1:e.samples,s=n.depthTextureMips||(n.depthTextureMips={}),o=e.textures,a=this.getSize(o[0]),c=a.width>>t,u=a.height>>t;let f=e.depthTexture||s[t];const m=e.depthBuffer===!0||e.stencilBuffer===!0;let v=!1;f===void 0&&m&&(f=new Jc,f.format=e.stencilBuffer?mc:Zc,f.type=e.stencilBuffer?pc:fs,f.image.width=c,f.image.height=u,f.image.depth=a.depth,f.isArrayTexture=e.multiview===!0&&a.depth>1,s[t]=f),(n.width!==a.width||a.height!==n.height)&&(v=!0,f&&(f.needsUpdate=!0,f.image.width=c,f.image.height=u,f.image.depth=f.isArrayTexture?f.image.depth:1)),n.width=a.width,n.height=a.height,n.textures=o,n.depthTexture=f||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==r&&(v=!0,f&&(f.needsUpdate=!0),n.sampleCount=r);const x={sampleCount:r};if(e.isXRRenderTarget!==!0){for(let T=0;T<o.length;T++){const P=o[T];v&&(P.needsUpdate=!0),this.updateTexture(P,x)}f&&this.updateTexture(f,x)}if(n.initialized!==!0){n.initialized=!0;const T=()=>{e.removeEventListener("dispose",T);for(let P=0;P<o.length;P++)this._destroyTexture(o[P]);f&&this._destroyTexture(f),this.delete(e)};e.addEventListener("dispose",T)}}updateTexture(e,t={}){const n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;const r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(r&&n.initialized===!0&&(s.destroySampler(e),s.destroyTexture(e)),e.isFramebufferTexture){const u=this.renderer.getRenderTarget();u?e.type=u.texture.type:e.type=ps}const{width:o,height:a,depth:c}=this.getSize(e);if(t.width=o,t.height=a,t.depth=c,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,a):1,r||e.isStorageTexture===!0)s.createSampler(e),s.createTexture(e,t),n.generation=e.version;else if(n.initialized!==!0&&s.createSampler(e),e.version>0){const f=e.image;if(f===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(f.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const m=[];for(const v of e.images)m.push(v);t.images=m}else t.image=f;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(s.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t),t.needsMipmaps&&e.mipmaps.length===0&&s.generateMipmaps(e)}}else s.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;if(n.initialized!==!0){n.initialized=!0,n.generation=e.version,this.info.memory.textures++;const u=()=>{e.removeEventListener("dispose",u),this._destroyTexture(e)};e.addEventListener("dispose",u)}n.version=e.version}getSize(e,t=byt){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let r;return e.isCompressedTexture?e.mipmaps?r=e.mipmaps.length:r=1:r=Math.floor(Math.log2(Math.max(t,n)))+1,r}needsMipmaps(e){return e.isCompressedTexture===!0||e.generateMipmaps}_destroyTexture(e){this.has(e)===!0&&(this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e),this.info.memory.textures--)}}class rse extends yn{constructor(e,t,n,r=1){super(e,t,n),this.a=r}set(e,t,n,r=1){return this.a=r,super.set(e,t,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class wyt extends ns{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class Tyt extends Wr{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.outputNode?this.outputNode.getMemberType(e,t):"void"}add(e){return this.nodes.push(e),this}If(e,t){const n=new gE(t);return this._currentCond=ql(e,n),this.add(this._currentCond)}ElseIf(e,t){const n=new gE(t),r=ql(e,n);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new gE(e),this}Switch(e){return this._expressionNode=tn(e),this}Case(...e){const t=[];if(e.length>=2)for(let a=0;a<e.length-1;a++)t.push(this._expressionNode.equal(tn(e[a])));else throw new Error("TSL: Invalid parameter length. Case() requires at least two parameters.");const n=e[e.length-1],r=new gE(n);let s=t[0];for(let a=1;a<t.length;a++)s=s.or(t[a]);const o=ql(s,r);return this._currentCond===null?(this._currentCond=o,this.add(this._currentCond)):(this._currentCond.elseNode=o,this._currentCond=o,this)}Default(e){return this.Else(e),this}build(e,...t){const n=ZNe();uU(this);const r=e.buildStage;for(const s of this.nodes)if(r==="setup")s.build(e);else if(r==="analyze")s.build(e,this);else if(r==="generate"){const o=e.getDataFromNode(s,"any").stages,a=o&&o[e.shaderStage];if(s.isVarNode&&a&&a.length===1&&a[0]&&a[0].isStackNode)continue;s.build(e,"void")}return uU(n),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}else(...e){return console.warn("THREE.TSL: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("THREE.TSL: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}}const uJ=Qt(Tyt).setParameterLength(0,1);new Of;new be;new be;new be;new Vn;new be(0,0,-1);new ir;new be;new be;new ir;new mn;const Eyt=new t3;v_.flipX();Eyt.depthTexture=new Jc(1,1);const hJ=new w4(-1,1,1,-1,0,1);class Myt extends Xi{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new br([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new br(t,2))}}const Cyt=new Myt;class ise extends dn{constructor(e=null){super(Cyt,e),this.camera=hJ,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,hJ)}render(e){e.render(this,hJ)}}const HT=new Mo,dJ=new Vn;class cc extends Wr{static get type(){return"SceneNode"}constructor(e=cc.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,n=this.scene!==null?this.scene:e.scene;let r;return t===cc.BACKGROUND_BLURRINESS?r=vs("backgroundBlurriness","float",n):t===cc.BACKGROUND_INTENSITY?r=vs("backgroundIntensity","float",n):t===cc.BACKGROUND_ROTATION?r=Cr("mat4").label("backgroundRotation").setGroup(Er).onRenderUpdate(()=>{const s=n.background;return s!==null&&s.isTexture&&s.mapping!==Wy?(HT.copy(n.backgroundRotation),HT.x*=-1,HT.y*=-1,HT.z*=-1,dJ.makeRotationFromEuler(HT)):dJ.identity(),dJ}):console.error("THREE.SceneNode: Unknown scope:",t),r}}cc.BACKGROUND_BLURRINESS="backgroundBlurriness";cc.BACKGROUND_INTENSITY="backgroundIntensity";cc.BACKGROUND_ROTATION="backgroundRotation";const Ayt=bn(cc,cc.BACKGROUND_BLURRINESS),WTe=bn(cc,cc.BACKGROUND_INTENSITY),Ryt=bn(cc,cc.BACKGROUND_ROTATION),Pyt=Kt(({texture:i,uv:e})=>{const n=Lt().toVar();return Go(e.x.lessThan(1e-4),()=>{n.assign(Lt(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{n.assign(Lt(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{n.assign(Lt(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{n.assign(Lt(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{n.assign(Lt(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{n.assign(Lt(0,0,-1))}).Else(()=>{const s=i.sample(e.add(Lt(-.01,0,0))).r.sub(i.sample(e.add(Lt(.01,0,0))).r),o=i.sample(e.add(Lt(0,-.01,0))).r.sub(i.sample(e.add(Lt(0,.01,0))).r),a=i.sample(e.add(Lt(0,0,-.01))).r.sub(i.sample(e.add(Lt(0,0,.01))).r);n.assign(Lt(s,o,a))}),n.normalize()});class Nyt extends Rx{static get type(){return"Texture3DNode"}constructor(e,t=null,n=null){super(e,t,n),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return Lt(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(Ns(y_(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,"vec3")}normal(e){return Pyt({texture:this,uv:e})}}const Iyt=Qt(Nyt).setParameterLength(1,3),pB=new mn;class kyt extends Rx{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class qTe extends kyt{static get type(){return"PassMultipleTextureNode"}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class Az extends da{static get type(){return"PassNode"}constructor(e,t,n,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const s=new Jc;s.isRenderTargetTexture=!0,s.name="depth";const o=new t3(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Aa,...r});o.texture.name="output",o.depthTexture=s,this.renderTarget=o,this._textures={output:o.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Cr(0),this._cameraFar=Cr(0),this._mrt=null,this._layers=null,this._resolution=1,this.isPassNode=!0,this.updateBeforeType=ci.FRAME,this.global=!0}setResolution(e){return this._resolution=e,this}getResolution(){return this._resolution}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const n=this._textures[e],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=tn(new qTe(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=tn(new qTe(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const n=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=zIe(this.getTextureNode(e),n,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const n=this._cameraNear,r=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=HE(s,n,r)}return t}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,e.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.renderTarget.texture.type=e.getColorBufferType(),this.scope===Az.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let r,s;const o=t.getOutputRenderTarget();o&&o.isXRRenderTarget===!0?(s=1,r=t.xr.getCamera(),t.xr.updateCamera(r),pB.set(o.width,o.height)):(r=this.camera,s=t.getPixelRatio(),t.getSize(pB)),this._pixelRatio=s,this.setSize(pB.width,pB.height);const a=t.getRenderTarget(),c=t.getMRT(),u=r.layers.mask;this._cameraNear.value=r.near,this._cameraFar.value=r.far,this._layers!==null&&(r.layers.mask=this._layers.mask);for(const f in this._previousTextures)this.toggleTexture(f);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(n,r),t.setRenderTarget(a),t.setMRT(c),r.layers.mask=u}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio*this._resolution,r=this._height*this._pixelRatio*this._resolution;this.renderTarget.setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Az.COLOR="color";Az.DEPTH="depth";const Dyt=Kt(([i,e])=>i.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Fyt=Kt(([i,e])=>(i=i.mul(e),i.div(i.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Oyt=Kt(([i,e])=>{i=i.mul(e),i=i.sub(.004).max(0);const t=i.mul(i.mul(6.2).add(.5)),n=i.mul(i.mul(6.2).add(1.7)).add(.06);return t.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Byt=Kt(([i])=>{const e=i.mul(i.add(.0245786)).sub(90537e-9),t=i.mul(i.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),Lyt=Kt(([i,e])=>{const t=B0(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=B0(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return i=i.mul(e).div(.6),i=t.mul(i),i=Byt(i),i=n.mul(i),i.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Uyt=B0(Lt(1.6605,-.1246,-.0182),Lt(-.5876,1.1329,-.1006),Lt(-.0728,-.0083,1.1187)),zyt=B0(Lt(.6274,.0691,.0164),Lt(.3293,.9195,.088),Lt(.0433,.0113,.8956)),Vyt=Kt(([i])=>{const e=Lt(i).toVar(),t=Lt(e.mul(e)).toVar(),n=Lt(t.mul(t)).toVar();return It(15.5).mul(n.mul(t)).sub(pi(40.14,n.mul(e))).add(pi(31.96,n).sub(pi(6.868,t.mul(e))).add(pi(.4298,t).add(pi(.1191,e).sub(.00232))))}),Gyt=Kt(([i,e])=>{const t=Lt(i).toVar(),n=B0(Lt(.856627153315983,.137318972929847,.11189821299995),Lt(.0951212405381588,.761241990602591,.0767994186031903),Lt(.0482516061458583,.101439036467562,.811302368396859)),r=B0(Lt(1.1271005818144368,-.1413297634984383,-.14132976349843826),Lt(-.11060664309660323,1.157823702216272,-.11060664309660294),Lt(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=It(-12.47393),o=It(4.026069);return t.mulAssign(e),t.assign(zyt.mul(t)),t.assign(n.mul(t)),t.assign(Jl(t,1e-10)),t.assign(U1(t)),t.assign(t.sub(s).div(o.sub(s))),t.assign(em(t,0,1)),t.assign(Vyt(t)),t.assign(r.mul(t)),t.assign(xz(Jl(Lt(0),t),Lt(2.2))),t.assign(Uyt.mul(t)),t.assign(em(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),$yt=Kt(([i,e])=>{const t=It(.76),n=It(.15);i=i.mul(e);const r=ox(i.r,ox(i.g,i.b)),s=ql(r.lessThan(.08),r.sub(pi(6.25,r.mul(r))),.04);i.subAssign(s);const o=Jl(i.r,Jl(i.g,i.b));Go(o.lessThan(t),()=>i);const a=A0(1,t),c=A0(1,a.mul(a).div(o.add(a.sub(t))));i.mulAssign(c.div(o));const u=A0(1,Zf(1,n.mul(o.sub(c)).add(1)));return zs(i,Lt(c),u)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class wa extends Wr{static get type(){return"CodeNode"}constructor(e="",t=[],n=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=n}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const r of t)r.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class Hyt extends wa{static get type(){return"FunctionNode"}constructor(e="",t=[],n=""){super(e,t,n)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),r=n.name,s=n.type,o=e.getCodeFromNode(this,s);r!==""&&(o.name=r);const a=e.getPropertyName(o),c=this.getNodeFunction(e).getCode(a);return o.code=c+`
`,t==="property"?a:e.format(`${a}()`,s,t)}}function uke(i){let e;const t=i.context.getViewZ;return t!==void 0&&(e=t(this)),(e||aa.z).negate()}const jyt=Kt(([i,e],t)=>{const n=uke(t);return K2(i,e,n)}),Wyt=Kt(([i],e)=>{const t=uke(e);return i.mul(i,t,t).negate().exp().oneMinus()}),XTe=Kt(([i,e])=>$r(e.toFloat().mix(GE.rgb,i.toVec3()),GE.a));class qyt extends Wr{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}Qt(qyt);class tp extends Wr{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),n=t.parents,r=this.method,s=this.getNodeType(e),o=this.getInputType(e),a=this.pointerNode,c=this.valueNode,u=[];u.push(`&${a.build(e,o)}`),c!==null&&u.push(c.build(e,o));const f=`${e.getMethod(r,s)}( ${u.join(", ")} )`;if(n.length===1&&n[0].isStackNode===!0)e.addLineFlowCode(f,this);else return t.constNode===void 0&&(t.constNode=ax(f,s).toConst()),t.constNode.build(e)}}tp.ATOMIC_LOAD="atomicLoad";tp.ATOMIC_STORE="atomicStore";tp.ATOMIC_ADD="atomicAdd";tp.ATOMIC_SUB="atomicSub";tp.ATOMIC_MAX="atomicMax";tp.ATOMIC_MIN="atomicMin";tp.ATOMIC_AND="atomicAnd";tp.ATOMIC_OR="atomicOr";tp.ATOMIC_XOR="atomicXor";Qt(tp);let mB;function Rz(i){mB=mB||new WeakMap;let e=mB.get(i);return e===void 0&&mB.set(i,e={}),e}function hke(i){const e=Rz(i);return e.shadowMatrix||(e.shadowMatrix=Cr("mat4").setGroup(Er).onRenderUpdate(t=>((i.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&i.shadow.updateMatrices(i),i.shadow.matrix)))}function Xyt(i,e=GM){const t=hke(i).mul(e);return t.xyz.div(t.w)}function dke(i){const e=Rz(i);return e.position||(e.position=Cr(new be).setGroup(Er).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(i.matrixWorld)))}function Yyt(i){const e=Rz(i);return e.targetPosition||(e.targetPosition=Cr(new be).setGroup(Er).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(i.target.matrixWorld)))}function fke(i){const e=Rz(i);return e.viewPosition||(e.viewPosition=Cr(new be).setGroup(Er).onRenderUpdate(({camera:t},n)=>{n.value=n.value||new be,n.value.setFromMatrixPosition(i.matrixWorld),n.value.applyMatrix4(t.matrixWorldInverse)}))}const pke=i=>lm.transformDirection(dke(i).sub(Yyt(i))),Kyt=i=>i.sort((e,t)=>e.id-t.id),Zyt=(i,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===i)return t;return null},fJ=new WeakMap,jT=[];class mke extends Wr{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Lt().toVar(),this.totalSpecularNode=Lt().toVar(),this.outgoingLightNode=Lt().toVar(),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let n=0;n<e.length;n++){const r=e[n];if(jT.push(r.id),jT.push(r.castShadow?1:0),r.isSpotLight===!0){const s=r.map!==null?r.map.id:-1,o=r.colorNode?r.colorNode.getCacheKey():-1;jT.push(s,o)}}const t=Pie(jT);return jT.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const n of this._lightNodes)t.push(n.getSelf().getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const n of t.nodes)n.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,r=Kyt(this._lights),s=e.renderer.library;for(const o of r)if(o.isNode)t.push(tn(o));else{let a=null;if(n!==null&&(a=Zyt(o.id,n)),a===null){const c=s.getLightNodeClass(o.constructor);if(c===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let u=null;fJ.has(o)?u=fJ.get(o):(u=tn(new c(o)),fJ.set(o,u)),t.push(u)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:r,reflectedLight:s}=e.context;r.direct({...n,lightNode:t,reflectedLight:s},e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:r,reflectedLight:s}=e.context;r.directRectArea({...n,lightNode:t,reflectedLight:s},e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const r=e.context,s=r.lightingModel,o=e.getNodeProperties(this);if(s){const{totalDiffuseNode:a,totalSpecularNode:c}=this;r.outgoingLight=n;const u=e.addStack();o.nodes=u.nodes,s.start(e);const{backdrop:f,backdropAlpha:m}=r,{directDiffuse:v,directSpecular:x,indirectDiffuse:T,indirectSpecular:P}=r.reflectedLight;let R=v.add(T);f!==null&&(m!==null?R=Lt(m.mix(R,f)):R=Lt(f),r.material.transparent=!0),a.assign(R),c.assign(x.add(P)),n.assign(a.add(c)),s.finish(e),n=n.bypass(e.removeStack())}else o.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class Qyt extends Wr{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=ci.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){gke.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||GM)}}const gke=vC("vec3","shadowPositionWorld");function Jyt(i,e={}){return e.toneMapping=i.toneMapping,e.toneMappingExposure=i.toneMappingExposure,e.outputColorSpace=i.outputColorSpace,e.renderTarget=i.getRenderTarget(),e.activeCubeFace=i.getActiveCubeFace(),e.activeMipmapLevel=i.getActiveMipmapLevel(),e.renderObjectFunction=i.getRenderObjectFunction(),e.pixelRatio=i.getPixelRatio(),e.mrt=i.getMRT(),e.clearColor=i.getClearColor(e.clearColor||new yn),e.clearAlpha=i.getClearAlpha(),e.autoClear=i.autoClear,e.scissorTest=i.getScissorTest(),e}function e4t(i,e){return e=Jyt(i,e),i.setMRT(null),i.setRenderObjectFunction(null),i.setClearColor(0,1),i.autoClear=!0,e}function t4t(i,e){i.toneMapping=e.toneMapping,i.toneMappingExposure=e.toneMappingExposure,i.outputColorSpace=e.outputColorSpace,i.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),i.setRenderObjectFunction(e.renderObjectFunction),i.setPixelRatio(e.pixelRatio),i.setMRT(e.mrt),i.setClearColor(e.clearColor,e.clearAlpha),i.autoClear=e.autoClear,i.setScissorTest(e.scissorTest)}function n4t(i,e={}){return e.background=i.background,e.backgroundNode=i.backgroundNode,e.overrideMaterial=i.overrideMaterial,e}function r4t(i,e){return e=n4t(i,e),i.background=null,i.backgroundNode=null,i.overrideMaterial=null,e}function i4t(i,e){i.background=e.background,i.backgroundNode=e.backgroundNode,i.overrideMaterial=e.overrideMaterial}function s4t(i,e,t){return t=e4t(i,t),t=r4t(e,t),t}function o4t(i,e,t){t4t(i,t),i4t(e,t)}const YTe=new WeakMap,a4t=Kt(({depthTexture:i,shadowCoord:e,depthLayer:t})=>{let n=Pi(i,e.xy).label("t_basic");return i.isArrayTexture&&(n=n.depth(t)),n.compare(e.z)}),l4t=Kt(({depthTexture:i,shadowCoord:e,shadow:t,depthLayer:n})=>{const r=(R,M)=>{let O=Pi(i,R);return i.isArrayTexture&&(O=O.depth(n)),O.compare(M)},s=vs("mapSize","vec2",t).setGroup(Er),o=vs("radius","float",t).setGroup(Er),a=Tn(1).div(s),c=a.x.negate().mul(o),u=a.y.negate().mul(o),f=a.x.mul(o),m=a.y.mul(o),v=c.div(2),x=u.div(2),T=f.div(2),P=m.div(2);return L0(r(e.xy.add(Tn(c,u)),e.z),r(e.xy.add(Tn(0,u)),e.z),r(e.xy.add(Tn(f,u)),e.z),r(e.xy.add(Tn(v,x)),e.z),r(e.xy.add(Tn(0,x)),e.z),r(e.xy.add(Tn(T,x)),e.z),r(e.xy.add(Tn(c,0)),e.z),r(e.xy.add(Tn(v,0)),e.z),r(e.xy,e.z),r(e.xy.add(Tn(T,0)),e.z),r(e.xy.add(Tn(f,0)),e.z),r(e.xy.add(Tn(v,P)),e.z),r(e.xy.add(Tn(0,P)),e.z),r(e.xy.add(Tn(T,P)),e.z),r(e.xy.add(Tn(c,m)),e.z),r(e.xy.add(Tn(0,m)),e.z),r(e.xy.add(Tn(f,m)),e.z)).mul(1/17)}),c4t=Kt(({depthTexture:i,shadowCoord:e,shadow:t,depthLayer:n})=>{const r=(m,v)=>{let x=Pi(i,m);return i.isArrayTexture&&(x=x.depth(n)),x.compare(v)},s=vs("mapSize","vec2",t).setGroup(Er),o=Tn(1).div(s),a=o.x,c=o.y,u=e.xy,f=s3(u.mul(s).add(.5));return u.subAssign(f.mul(o)),L0(r(u,e.z),r(u.add(Tn(a,0)),e.z),r(u.add(Tn(0,c)),e.z),r(u.add(o),e.z),zs(r(u.add(Tn(a.negate(),0)),e.z),r(u.add(Tn(a.mul(2),0)),e.z),f.x),zs(r(u.add(Tn(a.negate(),c)),e.z),r(u.add(Tn(a.mul(2),c)),e.z),f.x),zs(r(u.add(Tn(0,c.negate())),e.z),r(u.add(Tn(0,c.mul(2))),e.z),f.y),zs(r(u.add(Tn(a,c.negate())),e.z),r(u.add(Tn(a,c.mul(2))),e.z),f.y),zs(zs(r(u.add(Tn(a.negate(),c.negate())),e.z),r(u.add(Tn(a.mul(2),c.negate())),e.z),f.x),zs(r(u.add(Tn(a.negate(),c.mul(2))),e.z),r(u.add(Tn(a.mul(2),c.mul(2))),e.z),f.x),f.y)).mul(1/9)}),u4t=Kt(({depthTexture:i,shadowCoord:e,depthLayer:t})=>{const n=It(1).toVar();let r=Pi(i).sample(e.xy);i.isArrayTexture&&(r=r.depth(t)),r=r.rg;const s=pIe(e.z,r.x);return Go(s.notEqual(It(1)),()=>{const o=e.z.sub(r.x),a=Jl(0,r.y.mul(r.y));let c=a.div(a.add(o.mul(o)));c=em(A0(c,.3).div(.95-.3)),n.assign(em(Jl(s,c)))}),n}),h4t=Kt(([i,e,t])=>{let n=GM.sub(i).length();return n=n.sub(e).div(t.sub(e)),n=n.saturate(),n}),d4t=i=>{const e=i.shadow.camera,t=vs("near","float",e).setGroup(Er),n=vs("far","float",e).setGroup(Er),r=Wgt(i);return h4t(r,t,n)},f4t=i=>{let e=YTe.get(i);if(e===void 0){const t=i.isPointLight?d4t(i):null;e=new ca,e.colorNode=$r(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,YTe.set(i,e)}return e},KTe=new Md,p6=[],p4t=(i,e,t,n)=>{p6[0]=i,p6[1]=e;let r=KTe.get(p6);return(r===void 0||r.shadowType!==t||r.useVelocity!==n)&&(r=(s,o,a,c,u,f,...m)=>{(s.castShadow===!0||s.receiveShadow&&t===jc)&&(n&&(WNe(s).useVelocity=!0),s.onBeforeShadow(i,s,a,e.camera,c,o.overrideMaterial,f),i.renderObject(s,o,a,c,u,f,...m),s.onAfterShadow(i,s,a,e.camera,c,o.overrideMaterial,f))},r.shadowType=t,r.useVelocity=n,KTe.set(p6,r)),p6[0]=null,p6[1]=null,r},m4t=Kt(({samples:i,radius:e,size:t,shadowPass:n,depthLayer:r})=>{const s=It(0).toVar("meanVertical"),o=It(0).toVar("squareMeanVertical"),a=i.lessThanEqual(It(1)).select(It(0),It(2).div(i.sub(1))),c=i.lessThanEqual(It(1)).select(It(0),It(-1));vd({start:Ns(0),end:Ns(i),type:"int",condition:"<"},({i:f})=>{const m=c.add(It(f).mul(a));let v=n.sample(L0(Ez.xy,Tn(0,m).mul(e)).div(t));n.value.isArrayTexture&&(v=v.depth(r)),v=v.x,s.addAssign(v),o.addAssign(v.mul(v))}),s.divAssign(i),o.divAssign(i);const u=zie(o.sub(s.mul(s)));return Tn(s,u)}),g4t=Kt(({samples:i,radius:e,size:t,shadowPass:n,depthLayer:r})=>{const s=It(0).toVar("meanHorizontal"),o=It(0).toVar("squareMeanHorizontal"),a=i.lessThanEqual(It(1)).select(It(0),It(2).div(i.sub(1))),c=i.lessThanEqual(It(1)).select(It(0),It(-1));vd({start:Ns(0),end:Ns(i),type:"int",condition:"<"},({i:f})=>{const m=c.add(It(f).mul(a));let v=n.sample(L0(Ez.xy,Tn(m,0).mul(e)).div(t));n.value.isArrayTexture&&(v=v.depth(r)),s.addAssign(v.x),o.addAssign(L0(v.y.mul(v.y),v.x.mul(v.x)))}),s.divAssign(i),o.divAssign(i);const u=zie(o.sub(s.mul(s)));return Tn(s,u)}),y4t=[a4t,l4t,c4t,u4t];let pJ;const gB=new ise;class yke extends Qyt{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:r,shadow:s,depthLayer:o}){const a=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),c=t({depthTexture:n,shadowCoord:r,shadow:s,depthLayer:o});return a.select(c,It(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:r}=e,s=vs("bias","float",n).setGroup(Er);let o=t,a;if(n.camera.isOrthographicCamera||r.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),a=o.z,r.coordinateSystem===V2&&(a=a.mul(2).sub(1));else{const c=o.w;o=o.xy.div(c);const u=vs("near","float",n.camera).setGroup(Er),f=vs("far","float",n.camera).setGroup(Er);a=VIe(c.negate(),u,f)}return o=Lt(o.x,o.y.oneMinus(),a.add(s)),o}getShadowFilterFn(e){return y4t[e]}setupRenderTarget(e,t){const n=new Jc(e.mapSize.width,e.mapSize.height);n.name="ShadowDepthTexture",n.compareFunction=VU;const r=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return r.texture.name="ShadowMap",r.texture.type=e.mapType,r.depthTexture=n,{shadowMap:r,depthTexture:n}}setupShadow(e){const{renderer:t}=e,{light:n,shadow:r}=this,s=t.shadowMap.type,{depthTexture:o,shadowMap:a}=this.setupRenderTarget(r,e);if(r.camera.updateProjectionMatrix(),s===jc&&r.isPointLightShadow!==!0){o.compareFunction=null,a.depth>1?(a._vsmShadowMapVertical||(a._vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:E1,type:Aa,depth:a.depth,depthBuffer:!1}),a._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=a._vsmShadowMapVertical,a._vsmShadowMapHorizontal||(a._vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:E1,type:Aa,depth:a.depth,depthBuffer:!1}),a._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=a._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:E1,type:Aa,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:E1,type:Aa,depthBuffer:!1}));let M=Pi(o);o.isArrayTexture&&(M=M.depth(this.depthLayer));let O=Pi(this.vsmShadowMapVertical.texture);o.isArrayTexture&&(O=O.depth(this.depthLayer));const C=vs("blurSamples","float",r).setGroup(Er),L=vs("radius","float",r).setGroup(Er),Y=vs("mapSize","vec2",r).setGroup(Er);let J=this.vsmMaterialVertical||(this.vsmMaterialVertical=new ca);J.fragmentNode=m4t({samples:C,radius:L,size:Y,shadowPass:M,depthLayer:this.depthLayer}).context(e.getSharedContext()),J.name="VSMVertical",J=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new ca),J.fragmentNode=g4t({samples:C,radius:L,size:Y,shadowPass:O,depthLayer:this.depthLayer}).context(e.getSharedContext()),J.name="VSMHorizontal"}const c=vs("intensity","float",r).setGroup(Er),u=vs("normalBias","float",r).setGroup(Er),f=hke(n).mul(gke.add(Kie.mul(u))),m=this.setupShadowCoord(e,f),v=r.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(v===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const x=s===jc&&r.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:o,T=this.setupShadowFilter(e,{filterFn:v,shadowTexture:a.texture,depthTexture:x,shadowCoord:m,shadow:r,depthLayer:this.depthLayer});let P=Pi(a.texture,m);o.isArrayTexture&&(P=P.depth(this.depthLayer));const R=zs(1,T.rgb.mix(P,1),c.mul(P.a)).toVar();return this.shadowMap=a,this.shadow.map=a,R}setup(e){if(e.renderer.shadowMap.enabled!==!1)return Kt(()=>{let t=this._node;return this.setupShadowPosition(e),t===null&&(this._node=t=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(t=e.material.receivedShadowNode(t)),t})()}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:s,scene:o}=e;t.updateMatrices(r),n.setSize(t.mapSize.width,t.mapSize.height,n.depth),s.render(o,t.camera)}updateShadow(e){const{shadowMap:t,light:n,shadow:r}=this,{renderer:s,scene:o,camera:a}=e,c=s.shadowMap.type,u=t.depthTexture.version;this._depthVersionCached=u;const f=r.camera.layers.mask;r.camera.layers.mask&4294967294||(r.camera.layers.mask=a.layers.mask);const m=s.getRenderObjectFunction(),v=s.getMRT(),x=v?v.has("velocity"):!1;pJ=s4t(s,o,pJ),o.overrideMaterial=f4t(n),s.setRenderObjectFunction(p4t(s,r,c,x)),s.setClearColor(0,0),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(m),c===jc&&r.isPointLightShadow!==!0&&this.vsmPass(s),r.camera.layers.mask=f,o4t(s,o,pJ)}vsmPass(e){const{shadow:t}=this,n=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,n),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,n),e.setRenderTarget(this.vsmShadowMapVertical),gB.material=this.vsmMaterialVertical,gB.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),gB.material=this.vsmMaterialHorizontal,gB.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const v4t=(i,e)=>tn(new yke(i,e)),_4t=new yn,If=Kt(([i,e])=>{const t=i.toVar(),n=Hu(t),r=Zf(1,Jl(n.x,Jl(n.y,n.z)));n.mulAssign(r),t.mulAssign(r.mul(e.mul(2).oneMinus()));const s=Tn(t.xy).toVar(),a=e.mul(1.5).oneMinus();return Go(n.z.greaterThanEqual(a),()=>{Go(t.z.greaterThan(0),()=>{s.x.assign(A0(4,t.x))})}).ElseIf(n.x.greaterThanEqual(a),()=>{const c=mU(t.x);s.x.assign(t.z.mul(c).add(c.mul(2)))}).ElseIf(n.y.greaterThanEqual(a),()=>{const c=mU(t.y);s.x.assign(t.x.add(c.mul(2)).add(2)),s.y.assign(t.z.mul(c).sub(2))}),Tn(.125,.25).mul(s).add(Tn(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),x4t=Kt(({depthTexture:i,bd3D:e,dp:t,texelSize:n})=>Pi(i,If(e,n.y)).compare(t)),b4t=Kt(({depthTexture:i,bd3D:e,dp:t,texelSize:n,shadow:r})=>{const s=vs("radius","float",r).setGroup(Er),o=Tn(-1,1).mul(s).mul(n.y);return Pi(i,If(e.add(o.xyy),n.y)).compare(t).add(Pi(i,If(e.add(o.yyy),n.y)).compare(t)).add(Pi(i,If(e.add(o.xyx),n.y)).compare(t)).add(Pi(i,If(e.add(o.yyx),n.y)).compare(t)).add(Pi(i,If(e,n.y)).compare(t)).add(Pi(i,If(e.add(o.xxy),n.y)).compare(t)).add(Pi(i,If(e.add(o.yxy),n.y)).compare(t)).add(Pi(i,If(e.add(o.xxx),n.y)).compare(t)).add(Pi(i,If(e.add(o.yxx),n.y)).compare(t)).mul(1/9)}),S4t=Kt(({filterFn:i,depthTexture:e,shadowCoord:t,shadow:n})=>{const r=t.xyz.toVar(),s=r.length(),o=Cr("float").setGroup(Er).onRenderUpdate(()=>n.camera.near),a=Cr("float").setGroup(Er).onRenderUpdate(()=>n.camera.far),c=vs("bias","float",n).setGroup(Er),u=Cr(n.mapSize).setGroup(Er),f=It(1).toVar();return Go(s.sub(a).lessThanEqual(0).and(s.sub(o).greaterThanEqual(0)),()=>{const m=s.sub(o).div(a.sub(o)).toVar();m.addAssign(c);const v=r.normalize(),x=Tn(1).div(u.mul(Tn(4,2)));f.assign(i({depthTexture:e,bd3D:v,dp:m,texelSize:x,shadow:n}))}),f}),ZTe=new ir,m6=new mn,WT=new mn;class w4t extends yke{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===zWe?x4t:b4t}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:n,depthTexture:r,shadowCoord:s,shadow:o}){return S4t({filterFn:t,shadowTexture:n,depthTexture:r,shadowCoord:s,shadow:o})}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:s,scene:o}=e,a=t.getFrameExtents();WT.copy(t.mapSize),WT.multiply(a),n.setSize(WT.width,WT.height),m6.copy(t.mapSize);const c=s.autoClear,u=s.getClearColor(_4t),f=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha),s.clear();const m=t.getViewportCount();for(let v=0;v<m;v++){const x=t.getViewport(v),T=m6.x*x.x,P=WT.y-m6.y-m6.y*x.y;ZTe.set(T,P,m6.x*x.z,m6.y*x.w),n.viewport.copy(ZTe),t.updateMatrices(r,v),s.render(o,t.camera)}s.autoClear=c,s.setClearColor(u,f)}}const T4t=(i,e)=>tn(new w4t(i,e));class F4 extends Px{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new yn,this.colorNode=e&&e.colorNode||Cr(this.color).setGroup(Er),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=ci.FRAME}getHash(){return this.light.uuid}getLightVector(e){return fke(this.light).sub(e.context.positionView||aa)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return v4t(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const r=this.light.shadow.shadowNode;let s;r!==void 0?s=tn(r):s=this.setupShadowNode(),this.shadowNode=s,this.shadowColorNode=n=this.colorNode.mul(s),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const vke=Kt(({lightDistance:i,cutoffDistance:e,decayExponent:t})=>{const n=i.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(n.mul(i.div(e).pow4().oneMinus().clamp().pow2()),n)}),E4t=({color:i,lightVector:e,cutoffDistance:t,decayExponent:n})=>{const r=e.normalize(),s=e.length(),o=vke({lightDistance:s,cutoffDistance:t,decayExponent:n}),a=i.mul(o);return{lightDirection:r,lightColor:a}};class M4t extends F4{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Cr(0).setGroup(Er),this.decayExponentNode=Cr(2).setGroup(Er)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return T4t(this.light)}setupDirect(e){return E4t({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}Kt(([i=xC()],{renderer:e,material:t})=>{const n=yIe(i.mul(2).sub(1));let r;if(t.alphaToCoverage&&e.samples>1){const s=It(n.fwidth()).toVar();r=K2(s.oneMinus(),s.add(1),n).oneMinus()}else r=ql(n.greaterThan(1),0,1);return r});const C4t=Kt(([i,e])=>{const t=i.x,n=i.y,r=i.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(n)),s=s.add(e.element(2).mul(2*.511664).mul(r)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(n)),s=s.add(e.element(5).mul(2*.429043).mul(n).mul(r)),s=s.add(e.element(6).mul(r.mul(r).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(r)),s=s.add(e.element(8).mul(.429043).mul(pi(t,t).sub(pi(n,n)))),s}),td=new rse;class A4t extends o3{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const r=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(s===null)r._clearColor.getRGB(td),td.a=r._clearColor.a;else if(s.isColor===!0)s.getRGB(td),td.a=1,o=!0;else if(s.isNode===!0){const u=this.get(e),f=s;td.copy(r._clearColor);let m=u.backgroundMesh;if(m===void 0){let R=function(){s.removeEventListener("dispose",R),m.material.dispose(),m.geometry.dispose()};var c=R;const x=$ie($r(f).mul(WTe),{getUV:()=>Ryt.mul(Yie),getTextureLevel:()=>Ayt});let T=BIe;T=T.setZ(T.w);const P=new ca;P.name="Background.material",P.side=Ui,P.depthTest=!1,P.depthWrite=!1,P.allowOverride=!1,P.fog=!1,P.lights=!1,P.vertexNode=T,P.colorNode=x,u.backgroundMeshNode=x,u.backgroundMesh=m=new dn(new G2(1,32,32),P),m.frustumCulled=!1,m.name="Background.mesh",m.onBeforeRender=function(M,O,C){this.matrixWorld.copyPosition(C.matrixWorld)},s.addEventListener("dispose",R)}const v=f.getCacheKey();u.backgroundCacheKey!==v&&(u.backgroundMeshNode.node=$r(f).mul(WTe),u.backgroundMeshNode.needsUpdate=!0,m.material.needsUpdate=!0,u.backgroundCacheKey=v),t.unshift(m,m.geometry,m.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",s);const a=r.xr.getEnvironmentBlendMode();if(a==="additive"?td.set(0,0,0,1):a==="alpha-blend"&&td.set(0,0,0,0),r.autoClear===!0||o===!0){const u=n.clearColorValue;u.r=td.r,u.g=td.g,u.b=td.b,u.a=td.a,(r.backend.isWebGLBackend===!0||r.alpha===!0)&&(u.r*=u.a,u.g*=u.a,u.b*=u.a),n.depthClearValue=r._clearDepth,n.stencilClearValue=r._clearStencil,n.clearColor=r.autoClearColor===!0,n.clearDepth=r.autoClearDepth===!0,n.clearStencil=r.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let R4t=0;class zte{constructor(e="",t=[],n=0,r=[]){this.name=e,this.bindings=t,this.index=n,this.bindingsReference=r,this.id=R4t++}}class P4t{constructor(e,t,n,r,s,o,a,c,u,f=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=f,this.nodeAttributes=r,this.bindings=s,this.updateNodes=o,this.updateBeforeNodes=a,this.updateAfterNodes=c,this.observer=u,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const r=new zte(t.name,[],t.index,t);e.push(r);for(const s of t.bindings)r.bindings.push(s.clone())}else e.push(t);return e}}class QTe{constructor(e,t,n=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}}class N4t{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class _ke{constructor(e,t,n=!1,r=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=r}}class I4t extends _ke{constructor(e,t,n=null,r=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=n,this.interpolationSampling=r}}class k4t{constructor(e,t,n=""){this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let D4t=0;class mJ{constructor(e=null){this.id=D4t++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class F4t{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class a3{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class O4t extends a3{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class B4t extends a3{constructor(e,t=new mn){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class L4t extends a3{constructor(e,t=new be){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class U4t extends a3{constructor(e,t=new ir){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class z4t extends a3{constructor(e,t=new yn){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class V4t extends a3{constructor(e,t=new NAe){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class G4t extends a3{constructor(e,t=new Or){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class $4t extends a3{constructor(e,t=new Vn){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class H4t extends O4t{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class j4t extends B4t{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class W4t extends L4t{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class q4t extends U4t{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class X4t extends z4t{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Y4t extends V4t{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class K4t extends G4t{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Z4t extends $4t{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const JTe=new WeakMap,Q4t=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),yB=i=>/e/g.test(i)?String(i).replace(/\+/g,""):(i=Number(i),i+(i%1?"":".0"));class xke{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=uJ(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new mJ,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null}getBindGroupsCache(){let e=JTe.get(this.renderer);return e===void 0&&(e=new Md,JTe.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new t3(e,t,n)}createCubeRenderTarget(e,t){return new jIe(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=this.getBindGroupsCache(),r=[];let s=!0;for(const a of t)r.push(a),s=s&&a.groupNode.shared!==!0;let o;return s?(o=n.get(r),o===void 0&&(o=new zte(e,r,this.bindingsIndexes[e].group,r),n.set(r,o))):o=new zte(e,r,this.bindingsIndexes[e].group,r),o}getBindGroupArray(e,t){const n=this.bindings[t];let r=n[e];return r===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(e===null){const t={},n=this.bindings;for(const r of Xwe)for(const s in n[r]){const o=n[r][s];(t[s]||(t[s]=[])).push(...o)}e=[];for(const r in t){const s=t[r],o=this._getBindGroup(r,s);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,n)=>t.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==ci.NONE&&this.updateNodes.push(e.getSelf());for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==ci.NONE&&this.updateBeforeNodes.push(e.getSelf()),n!==ci.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===_s||e.magFilter===r_||e.magFilter===T1||e.magFilter===oc||e.minFilter===_s||e.minFilter===r_||e.minFilter===T1||e.minFilter===oc}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new mJ(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,n=null){let r=this.generateArrayDeclaration(e,t)+"( ";for(let s=0;s<t;s++){const o=n?n[s]:null;o!==null?r+=o.build(this,e):r+=this.generateConst(e),s<t-1&&(r+=", ")}return r+=" )",r}generateStruct(e,t,n=null){const r=[];for(const s of t){const{name:o,type:a}=s;n&&n[o]&&n[o].isNode?r.push(n[o].build(this,a)):r.push(this.generateConst(a))}return e+"( "+r.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new yn:e==="vec2"?t=new mn:e==="vec3"?t=new be:e==="vec4"&&(t=new ir)),e==="float")return yB(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${yB(t.r)}, ${yB(t.g)}, ${yB(t.b)} )`;const n=this.getTypeLength(e),r=this.getComponentType(e),s=o=>this.generateConst(r,o);if(n===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(n===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(n===4&&e!=="mat2")return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const n=this.attributes;for(const s of n)if(s.name===e)return s;const r=new QTe(e,t);return this.registerDeclaration(r),n.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===qa)return"int";if(t===fs)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let n=v1t(e);const r=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(n=n.replace("vec","mat")),r+n}getTypeFromArray(e){return Q4t.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,r=e.itemSize,s=e.normalized;let o;return!(e instanceof eAe)&&s!==!0&&(o=this.getTypeFromArray(n)),this.getTypeFromLength(r,o)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return n!==null?Number(n[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=uJ(this.stack),this.stacks.push(ZNe()||this.stack),uU(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,uU(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let r=n.getData(e);return r===void 0&&(r={},n.setData(e,r)),r[t]===void 0&&(r[t]={}),r[t]}getNodeProperties(e,t="any"){const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e);let r=n.bufferAttribute;if(r===void 0){const s=this.uniforms.index++;r=new QTe("nodeAttribute"+s,t,e),this.bufferAttributes.push(r),n.bufferAttribute=r}return r}getStructTypeFromNode(e,t,n=null,r=this.shaderStage){const s=this.getDataFromNode(e,r,this.globalCache);let o=s.structType;if(o===void 0){const a=this.structs.index++;n===null&&(n="StructType"+a),o=new F4t(n,t),this.structs[r].push(o),s.structType=o}return o}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t,n=this.shaderStage,r=null){const s=this.getDataFromNode(e,n,this.globalCache);let o=s.uniform;if(o===void 0){const a=this.uniforms.index++;o=new N4t(r||"nodeUniform"+a,t,e),this.uniforms[n].push(o),this.registerDeclaration(o),s.uniform=o}return o}getArrayCount(e){let t=null;return e.isArrayNode?t=e.count:e.isVarNode&&e.node.isArrayNode&&(t=e.node.count),t}getVarFromNode(e,t=null,n=e.getNodeType(this),r=this.shaderStage,s=!1){const o=this.getDataFromNode(e,r);let a=o.variable;if(a===void 0){const c=s?"_const":"_var",u=this.vars[r]||(this.vars[r]=[]),f=this.vars[c]||(this.vars[c]=0);t===null&&(t=(s?"nodeConst":"nodeVar")+f,this.vars[c]++);const m=this.getArrayCount(e);a=new _ke(t,n,s,m),s||u.push(a),this.registerDeclaration(a),o.variable=a}return a}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,n=e.getNodeType(this),r=null,s=null){const o=this.getDataFromNode(e,"any");let a=o.varying;if(a===void 0){const c=this.varyings,u=c.length;t===null&&(t="nodeVarying"+u),a=new I4t(t,n,r,s),c.push(a),this.registerDeclaration(a),o.varying=a}return a}get namespace(){return this.context.namespace}getOutputNamespace(){return this.getNamespace("outputNode")}getNamespace(e=""){const t=this.namespace;let n;return t?n=e?t+"_"+e:t:n=e,n}registerDeclaration(e){const t=this.shaderStage,n=this.declarations[t]||(this.declarations[t]={}),r=this.getPropertyName(e);let s=1,o=r;for(;n[o]!==void 0;)o=r+"_"+s++;s>1&&(e.name=o,console.warn(`THREE.TSL: Declaration name '${r}' of '${e.type}' already in use. Renamed to '${o}'.`)),n[o]=e}getCodeFromNode(e,t,n=this.shaderStage){const r=this.getDataFromNode(e);let s=r.code;if(s===void 0){const o=this.codes[n]||(this.codes[n]=[]),a=o.length;s=new k4t("nodeCode"+a,t),o.push(s),r.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:r}=this.getDataFromNode(e);let s=!0,o=t;for(;o;){if(r.get(o)===!0){s=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(s)for(const a of n)this.addLineFlowCode(a)}addLineFlowCodeBlock(e,t,n){const r=this.getDataFromNode(e),s=r.flowCodes||(r.flowCodes=[]),o=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);s.push(t),o.set(n,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new Hyt,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let o=0;const a=Object.values(this);return{next:()=>({value:a[o],done:o++>=a.length})}}};for(const o of t.inputs)n[o.name]=new wyt(o.type,o.name);e.layout=null;const r=e.call(n),s=this.flowStagesNode(r,t.type);return e.layout=t,s}flowStagesNode(e,t=null){const n=this.flow,r=this.vars,s=this.declarations,o=this.cache,a=this.buildStage,c=this.stack,u={code:""};this.flow=u,this.vars={},this.declarations={},this.cache=new mJ,this.stack=uJ();for(const f of qwe)this.setBuildStage(f),u.result=e.build(this,t);return u.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=r,this.declarations=s,this.cache=o,this.stack=c,this.setBuildStage(a),u}getFunctionOperator(){return null}buildFunctionCode(){console.warn("Abstract function.")}flowChildNode(e,t=null){const n=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,t),this.flow=n,r}flowNodeFromShaderStage(e,t,n=null,r=null){const s=this.tab,o=this.cache,a=this.shaderStage,c=this.context;this.setShaderStage(e);const u={...this.context};delete u.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=u;let f=null;if(this.buildStage==="generate"){const m=this.flowChildNode(t,n);r!==null&&(m.code+=`${this.tab+r} = ${m.result};
`),this.flowCode[e]=this.flowCode[e]+m.code,f=m}else f=t.build(this);return this.setShaderStage(a),this.cache=o,this.tab=s,this.context=c,f}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t,n=null){return`${n!==null?this.generateArrayDeclaration(e,n):this.getType(e)} ${t}`}getVars(e){let t="";const n=this.vars[e];if(n!==void 0)for(const r of n)t+=`${this.getVar(r.type,r.name)}; `;return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let n="";if(t!==void 0)for(const r of t)n+=r.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:t,renderer:n}=this;if(t!==null){let r=n.library.fromMaterial(t);r===null&&(console.error(`NodeMaterial: Material "${t.type}" is not compatible.`),r=new ca),r.build(this)}else this.addFlow("compute",e);for(const r of qwe){this.setBuildStage(r),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of Xwe){this.setShaderStage(s);const o=this.flowNodes[s];for(const a of o)r==="generate"?this.flowNode(a):a.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new H4t(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new j4t(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new W4t(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new q4t(e);if(t==="color")return new X4t(e);if(t==="mat2")return new Y4t(e);if(t==="mat3")return new K4t(e);if(t==="mat4")return new Z4t(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,n){if(t=this.getVectorType(t),n=this.getVectorType(n),t===n||n===null||this.isReference(n))return e;const r=this.getTypeLength(t),s=this.getTypeLength(n);return r===16&&s===9?`${this.getType(n)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:r===9&&s===4?`${this.getType(n)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:r>4||s>4||s===0?e:r===s?`${this.getType(n)}( ${e} )`:r>s?(e=n==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,s)}`,this.format(e,this.getTypeFromLength(s,this.getComponentType(t)),n)):s===4&&r>1?`${this.getType(n)}( ${this.format(e,t,"vec3")}, 1.0 )`:r===2?`${this.getType(n)}( ${this.format(e,t,"vec2")}, 0.0 )`:(r===1&&s>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${fx} - Node System
`}*[Symbol.iterator](){}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}}class eEe{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return n===void 0&&(n={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===ci.FRAME){const{frameMap:r}=this._getMaps(this.updateBeforeMap,n);r.get(n)!==this.frameId&&e.updateBefore(this)!==!1&&r.set(n,this.frameId)}else if(t===ci.RENDER){const{renderMap:r}=this._getMaps(this.updateBeforeMap,n);r.get(n)!==this.renderId&&e.updateBefore(this)!==!1&&r.set(n,this.renderId)}else t===ci.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===ci.FRAME){const{frameMap:r}=this._getMaps(this.updateAfterMap,n);r.get(n)!==this.frameId&&e.updateAfter(this)!==!1&&r.set(n,this.frameId)}else if(t===ci.RENDER){const{renderMap:r}=this._getMaps(this.updateAfterMap,n);r.get(n)!==this.renderId&&e.updateAfter(this)!==!1&&r.set(n,this.renderId)}else t===ci.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===ci.FRAME){const{frameMap:r}=this._getMaps(this.updateMap,n);r.get(n)!==this.frameId&&e.update(this)!==!1&&r.set(n,this.frameId)}else if(t===ci.RENDER){const{renderMap:r}=this._getMaps(this.updateMap,n);r.get(n)!==this.renderId&&e.update(this)!==!1&&r.set(n,this.renderId)}else t===ci.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class sse{constructor(e,t,n=null,r="",s=!1){this.type=e,this.name=t,this.count=n,this.qualifier=r,this.isConst=s}}sse.isNodeFunctionInput=!0;class J4t extends F4{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:pke(this.light),lightColor:e}}}const gJ=new Vn,vB=new Vn;let qT=null;class e5t extends F4{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Cr(new be).setGroup(Er),this.halfWidth=Cr(new be).setGroup(Er),this.updateType=ci.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;vB.identity(),gJ.copy(t.matrixWorld),gJ.premultiply(n),vB.extractRotation(gJ),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(vB),this.halfHeight.value.applyMatrix4(vB)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=Pi(qT.LTC_FLOAT_1),n=Pi(qT.LTC_FLOAT_2)):(t=Pi(qT.LTC_HALF_1),n=Pi(qT.LTC_HALF_2));const{colorNode:r,light:s}=this,o=fke(s);return{lightColor:r,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){qT=e}}class ose extends F4{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Cr(0).setGroup(Er),this.penumbraCosNode=Cr(0).setGroup(Er),this.cutoffDistanceNode=Cr(0).setGroup(Er),this.decayExponentNode=Cr(0).setGroup(Er),this.colorNode=Cr(this.color).setGroup(Er)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:n,penumbraCosNode:r}=this;return K2(n,r,t)}getLightCoord(e){const t=e.getNodeProperties(this);let n=t.projectionUV;return n===void 0&&(n=Xyt(this.light,e.context.positionWorld),t.projectionUV=n),n}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:r,light:s}=this,o=this.getLightVector(e),a=o.normalize(),c=a.dot(pke(s)),u=this.getSpotAttenuation(e,c),f=o.length(),m=vke({lightDistance:f,cutoffDistance:n,decayExponent:r});let v=t.mul(u).mul(m),x,T;return s.colorNode?(T=this.getLightCoord(e),x=s.colorNode(T)):s.map&&(T=this.getLightCoord(e),x=Pi(s.map,T.xy).onRenderUpdate(()=>s.map)),x&&(v=T.mul(2).sub(1).abs().lessThan(1).all().select(v.mul(x),v)),{lightColor:v,lightDirection:a}}}class t5t extends ose{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const n=this.light.iesMap;let r=null;if(n&&n.isTexture===!0){const s=t.acos().mul(1/Math.PI);r=Pi(n,Tn(s,0),0).r}else r=super.getSpotAttenuation(t);return r}}const n5t=Kt(([i,e])=>{const t=i.abs().sub(e);return z1(Jl(t,0)).add(ox(Jl(t.x,t.y),0))});class r5t extends ose{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let n=1;t.map!==null&&(n=t.map.width/t.map.height),t.shadow.aspect=n}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=this.penumbraCosNode,n=this.getLightCoord(e),r=n.xyz.div(n.w),s=n5t(r.xy.sub(Tn(.5)),Tn(.5)),o=Zf(-1,A0(1,uIe(t)).sub(1));return vIe(s.mul(-2).mul(o))}}class i5t extends F4{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class s5t extends F4{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=dke(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Cr(new yn).setGroup(Er)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:r}=this,o=Yie.dot(r).mul(.5).add(.5),a=zs(n,t,o);e.context.irradiance.addAssign(a)}}class o5t extends F4{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let n=0;n<9;n++)t.push(new be);this.lightProbe=Vf(t)}update(e){const{light:t}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(t.sh.coefficients[n]).multiplyScalar(t.intensity)}setup(e){const t=C4t(Yie,this.lightProbe);e.context.irradiance.addAssign(t)}}class bke{parseFunction(){console.warn("Abstract function.")}}class ase{constructor(e,t,n="",r=""){this.type=e,this.inputs=t,this.name=n,this.precision=r}getCode(){console.warn("Abstract function.")}}ase.isNodeFunction=!0;const a5t=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,l5t=/[a-z_0-9]+/ig,tEe="#pragma main",c5t=i=>{i=i.trim();const e=i.indexOf(tEe),t=e!==-1?i.slice(e+tEe.length):i,n=t.match(a5t);if(n!==null&&n.length===5){const r=n[4],s=[];let o=null;for(;(o=l5t.exec(r))!==null;)s.push(o);const a=[];let c=0;for(;c<s.length;){const T=s[c][0]==="const";T===!0&&c++;let P=s[c][0];P==="in"||P==="out"||P==="inout"?c++:P="";const R=s[c++][0];let M=Number.parseInt(s[c][0]);Number.isNaN(M)===!1?c++:M=null;const O=s[c++][0];a.push(new sse(R,O,M,P,T))}const u=t.substring(n[0].length),f=n[3]!==void 0?n[3]:"",m=n[2],v=n[1]!==void 0?n[1]:"",x=e!==-1?i.slice(0,e):"";return{type:m,inputs:a,name:f,precision:v,inputsCode:r,blockCode:u,headerCode:x}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class u5t extends ase{constructor(e){const{type:t,inputs:n,name:r,precision:s,inputsCode:o,blockCode:a,headerCode:c}=c5t(e);super(t,n,r,s),this.inputsCode=o,this.blockCode=a,this.headerCode=c}getCode(e=this.name){let t;const n=this.blockCode;if(n!==""){const{type:r,inputsCode:s,headerCode:o,precision:a}=this;let c=`${r} ${e} ( ${s.trim()} )`;a!==""&&(c=`${a} ${c}`),t=o+c+n}else t="";return t}}class h5t extends bke{parseFunction(e){return new u5t(e)}}const nEe=new WeakMap,Pf=[],yy=[];class d5t extends o3{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new eEe,this.nodeBuilderCache=new Map,this.callHashCache=new Md,this.groupsData=new Md,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===oIe.name)return!0;if(n===Er.name){const s=this.get(e),o=this.nodeFrame.renderId;return s.renderId!==o?(s.renderId=o,!0):!1}if(n===tmt.name){const s=this.get(e),o=this.nodeFrame.frameId;return s.frameId!==o?(s.frameId=o,!0):!1}Pf[0]=t,Pf[1]=e;let r=this.groupsData.get(Pf);return r===void 0&&this.groupsData.set(Pf,r={}),Pf.length=0,r.version!==t.version?(r.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:r}=this,s=this.getForRenderCacheKey(e);if(n=r.get(s),n===void 0){const o=this.backend.createNodeBuilder(e.object,this.renderer);o.scene=e.scene,o.material=e.material,o.camera=e.camera,o.context.material=e.material,o.lightsNode=e.lightsNode,o.environmentNode=this.getEnvironmentNode(e.scene),o.fogNode=this.getFogNode(e.scene),o.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&o.enableMultiview(),o.build(),n=this._createNodeBuilderState(o),r.set(s,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const r=this.backend.createNodeBuilder(e,this.renderer);r.build(),n=this._createNodeBuilderState(r),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new P4t(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){Pf[0]=e,Pf[1]=t;const n=this.renderer.info.calls,r=this.callHashCache.get(Pf)||{};if(r.callId!==n){const s=this.getEnvironmentNode(e),o=this.getFogNode(e);t&&yy.push(t.getCacheKey(!0)),s&&yy.push(s.getCacheKey()),o&&yy.push(o.getCacheKey()),yy.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),yy.push(this.renderer.shadowMap.enabled?1:0),r.callId=n,r.cacheKey=Pie(yy),this.callHashCache.set(Pf,r),yy.length=0}return Pf.length=0,r.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const r=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==n||r){const s=this.getCacheNode("background",n,()=>{if(n.isCubeTexture===!0||n.mapping===v4||n.mapping===M_||n.mapping===_4){if(e.backgroundBlurriness>0||n.mapping===_4)return rke(n);{let o;return n.isCubeTexture===!0?o=$M(n):o=Pi(n),qIe(o)}}else{if(n.isTexture===!0)return Pi(n,v_.flipY()).setUpdateMatrix(!0);n.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",n)}},r);t.backgroundNode=s,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n,r=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=s.get(t);return(o===void 0||r)&&(o=n(),s.set(t,o)),o}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const r=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const s=vs("color","color",n).setGroup(Er),o=vs("density","float",n).setGroup(Er);return XTe(s,Wyt(o))}else if(n.isFog){const s=vs("color","color",n).setGroup(Er),o=vs("near","float",n).setGroup(Er),a=vs("far","float",n).setGroup(Er);return XTe(s,jyt(o,a))}else console.error("THREE.Renderer: Unsupported fog configuration.",n)});t.fogNode=r,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const r=this.getCacheNode("environment",n,()=>{if(n.isCubeTexture===!0)return $M(n);if(n.isTexture===!0)return Pi(n);console.error("Nodes: Unsupported environment configuration.",n)});t.environmentNode=r,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,n=null,r=null,s=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=n,o.camera=r,o.material=s,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return nEe.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),r=e.isArrayTexture?Iyt(e,Lt(v_,bz("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):Pi(e,v_).renderOutput(t.toneMapping,t.currentColorSpace);return nEe.set(e,n),r}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const r of n.updateNodes)t.updateNode(r)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const r of n.updateNodes)t.updateNode(r)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new eEe,this.nodeBuilderCache=new Map,this.cacheLib={}}}const yJ=new Of;class gU{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new Or,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const r=e.length;for(let s=0;s<r;s++){yJ.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=t[n+s],a=yJ.normal;o.x=-a.x,o.y=-a.y,o.z=-a.z,o.w=yJ.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const r=t.clippingPlanes,s=r.length;let o,a;if(this.clipIntersection?(o=this.intersectionPlanes,a=e.intersectionPlanes.length):(o=this.unionPlanes,a=e.unionPlanes.length),o.length!==a+s){o.length=a+s;for(let c=0;c<s;c++)o[a+c]=new ir;n=!0}this.projectPlanes(r,o,a),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new gU(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class f5t{constructor(e,t){this.bundleGroup=e,this.camera=t}}const XT=[];class p5t{constructor(){this.bundles=new Md}get(e,t){const n=this.bundles;XT[0]=e,XT[1]=t;let r=n.get(XT);return r===void 0&&(r=new f5t(e,t),n.set(XT,r)),XT.length=0,r}dispose(){this.bundles=new Md}}class Ske{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(n!==null){t=new n;for(const r in e)t[r]=e[r]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t)){console.warn(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);n.set(t,e)}addClass(e,t,n){if(n.has(t)){console.warn(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);n.set(t,e)}}const m5t=new mke,YT=[];class g5t extends Md{constructor(){super()}createNode(e=[]){return new mke().setLights(e)}getNode(e,t){if(e.isQuadMesh)return m5t;YT[0]=e,YT[1]=t;let n=this.get(YT);return n===void 0&&(n=this.createNode(),this.set(YT,n)),YT.length=0,n}}class _E extends t3{constructor(e=1,t=1,n={}){super(e,t,n),this.isXRRenderTarget=!0,this.hasExternalTextures=!1,this.autoAllocateDepthBuffer=!0}copy(e){return super.copy(e),this.hasExternalTextures=e.hasExternalTextures,this.autoAllocateDepthBuffer=e.autoAllocateDepthBuffer,this}}const rEe=new be,iEe=new be;class y5t extends e0{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new po,this._cameraL.viewport=new ir,this._cameraR=new po,this._cameraR.viewport=new ir,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new AAe,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._supportsLayers=!1,this._frameBufferTargets=null,this._createXRLayer=w5t.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new mn,this._onSessionEvent=x5t.bind(this),this._onSessionEnd=b5t.bind(this),this._onInputSourcesChange=S5t.bind(this),this._onAnimationFrame=T5t.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._useLayers=typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,n,r,s,o,a,c={}){const u=new _x(e,t),f=new _E(s,o,{format:xs,type:ps,depthTexture:new Jc(s,o,c.stencil?pc:fs,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?mc:Zc),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});f.autoAllocateDepthBuffer=!0;const m=new Ea({color:16777215,side:Xl});m.map=f.texture,m.map.offset.y=1,m.map.repeat.y=-1;const v=new dn(u,m);v.position.copy(n),v.quaternion.copy(r);const x={type:"quad",width:e,height:t,translation:n,quaternion:r,pixelwidth:s,pixelheight:o,plane:v,material:m,rendercall:a,renderTarget:f};if(this._layers.push(x),this._session!==null){x.plane.material=new Ea({color:16777215,side:Xl}),x.plane.material.blending=Jy,x.plane.material.blendEquation=gl,x.plane.material.blendSrc=ud,x.plane.material.blendDst=ud,x.xrlayer=this._createXRLayer(x);const T=this._session.renderState.layers;T.unshift(x.xrlayer),this._session.updateRenderState({layers:T})}else f.isXRRenderTarget=!1;return v}createCylinderLayer(e,t,n,r,s,o,a,c,u={}){const f=new x0(e,e,e*t/n,64,64,!0,Math.PI-t/2,t),m=new _E(o,a,{format:xs,type:ps,depthTexture:new Jc(o,a,u.stencil?pc:fs,void 0,void 0,void 0,void 0,void 0,void 0,u.stencil?mc:Zc),stencilBuffer:u.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});m.autoAllocateDepthBuffer=!0;const v=new Ea({color:16777215,side:Ui});v.map=m.texture,v.map.offset.y=1,v.map.repeat.y=-1;const x=new dn(f,v);x.position.copy(r),x.quaternion.copy(s);const T={type:"cylinder",radius:e,centralAngle:t,aspectratio:n,translation:r,quaternion:s,pixelwidth:o,pixelheight:a,plane:x,material:v,rendercall:c,renderTarget:m};if(this._layers.push(T),this._session!==null){T.plane.material=new Ea({color:16777215,side:Ui}),T.plane.material.blending=Jy,T.plane.material.blendEquation=gl,T.plane.material.blendSrc=ud,T.plane.material.blendDst=ud,T.xrlayer=this._createXRLayer(T);const P=this._session.renderState.layers;P.unshift(T.xrlayer),this._session.updateRenderState({layers:P})}else m.isXRRenderTarget=!1;return x}renderLayers(){const e=new be,t=new qi,n=this._renderer,r=this.isPresenting,s=n.getOutputRenderTarget(),o=n._frameBufferTarget;this.isPresenting=!1;const a=new mn;n.getSize(a);const c=n._quad;for(const u of this._layers)if(u.renderTarget.isXRRenderTarget=this._session!==null,u.renderTarget.hasExternalTextures=u.renderTarget.isXRRenderTarget,u.renderTarget.isXRRenderTarget&&this._supportsLayers){u.xrlayer.transform=new XRRigidTransform(u.plane.getWorldPosition(e),u.plane.getWorldQuaternion(t));const f=this._glBinding.getSubImage(u.xrlayer,this._xrFrame);n.backend.setXRRenderTargetTextures(u.renderTarget,f.colorTexture,void 0),n._setXRLayerSize(u.renderTarget.width,u.renderTarget.height),n.setOutputRenderTarget(u.renderTarget),n.setRenderTarget(null),n._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:m,quad:v}=this._frameBufferTargets.get(u.renderTarget)||{frameBufferTarget:null,quad:null};m?(n._frameBufferTarget=m,n._quad=v):(n._quad=new ise(new ca),this._frameBufferTargets.set(u.renderTarget,{frameBufferTarget:n._getFrameBufferTarget(),quad:n._quad})),u.rendercall(),n._frameBufferTarget=null}else n.setRenderTarget(u.renderTarget),u.rendercall();n.setRenderTarget(null),n.setOutputRenderTarget(s),n._frameBufferTarget=o,n._setXRLayerSize(a.x,a.y),n._quad=c,this.isPresenting=r}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend;this._gl=t.getContext();const r=this._gl,s=r.getContextAttributes();if(this._session=e,e!==null){if(n.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._useLayers===!0){let o=null,a=null,c=null;t.depth&&(c=t.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,o=t.stencil?mc:Zc,a=t.stencil?pc:fs);const u={colorFormat:r.RGBA8,depthFormat:c,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(u.textureType="texture-array",this._useMultiview=!0);const f=new XRWebGLBinding(e,r),m=f.createProjectionLayer(u),v=[m];this._glBinding=f,this._glProjLayer=m,t.setPixelRatio(1),t._setXRLayerSize(m.textureWidth,m.textureHeight);const x=this._useMultiview?2:1,T=new Jc(m.textureWidth,m.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,o,x);if(this._xrRenderTarget=new _E(m.textureWidth,m.textureHeight,{format:xs,type:ps,colorSpace:t.outputColorSpace,depthTexture:T,stencilBuffer:t.stencil,samples:s.antialias?4:0,resolveDepthBuffer:m.ignoreDepthValues===!1,resolveStencilBuffer:m.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget.hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._supportsLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._supportsLayers)for(const P of this._layers)P.plane.material=new Ea({color:16777215,side:P.type==="cylinder"?Ui:Xl}),P.plane.material.blending=Jy,P.plane.material.blendEquation=gl,P.plane.material.blendSrc=ud,P.plane.material.blendDst=ud,P.xrlayer=this._createXRLayer(P),v.unshift(P.xrlayer);e.updateRenderState({layers:v})}else{const o={antialias:t.samples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},a=new XRWebGLLayer(e,r,o);this._glBaseLayer=a,e.updateRenderState({baseLayer:a}),t.setPixelRatio(1),t._setXRLayerSize(a.framebufferWidth,a.framebufferHeight),this._xrRenderTarget=new _E(a.framebufferWidth,a.framebufferHeight,{format:xs,type:ps,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:a.ignoreDepthValues===!1,resolveStencilBuffer:a.ignoreDepthValues===!1}),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const n=e.near,r=e.far,s=this._cameraXR,o=this._cameraL,a=this._cameraR;s.near=a.near=o.near=n,s.far=a.far=o.far=r,s.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==s.near||this._currentDepthFar!==s.far)&&(t.updateRenderState({depthNear:s.near,depthFar:s.far}),this._currentDepthNear=s.near,this._currentDepthFar=s.far),o.layers.mask=e.layers.mask|2,a.layers.mask=e.layers.mask|4,s.layers.mask=o.layers.mask|a.layers.mask;const c=e.parent,u=s.cameras;sEe(s,c);for(let f=0;f<u.length;f++)sEe(u[f],c);u.length===2?v5t(s,o,a):s.projectionMatrix.copy(o.projectionMatrix),_5t(e,s,c)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new LB,this._controllers[e]=t),t}}function v5t(i,e,t){rEe.setFromMatrixPosition(e.matrixWorld),iEe.setFromMatrixPosition(t.matrixWorld);const n=rEe.distanceTo(iEe),r=e.projectionMatrix.elements,s=t.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),c=(r[9]+1)/r[5],u=(r[9]-1)/r[5],f=(r[8]-1)/r[0],m=(s[8]+1)/s[0],v=o*f,x=o*m,T=n/(-f+m),P=T*-f;if(e.matrixWorld.decompose(i.position,i.quaternion,i.scale),i.translateX(P),i.translateZ(T),i.matrixWorld.compose(i.position,i.quaternion,i.scale),i.matrixWorldInverse.copy(i.matrixWorld).invert(),r[10]===-1)i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const R=o+T,M=a+T,O=v-P,C=x+(n-P),L=c*a/M*R,Y=u*a/M*R;i.projectionMatrix.makePerspective(O,C,L,Y,R,M),i.projectionMatrixInverse.copy(i.projectionMatrix).invert()}}function sEe(i,e){e===null?i.matrixWorld.copy(i.matrix):i.matrixWorld.multiplyMatrices(e.matrixWorld,i.matrix),i.matrixWorldInverse.copy(i.matrixWorld).invert()}function _5t(i,e,t){t===null?i.matrix.copy(e.matrixWorld):(i.matrix.copy(t.matrixWorld),i.matrix.invert(),i.matrix.multiply(e.matrixWorld)),i.matrix.decompose(i.position,i.quaternion,i.scale),i.updateMatrixWorld(!0),i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse),i.isPerspectiveCamera&&(i.fov=b4*2*Math.atan(1/i.projectionMatrix.elements[5]),i.zoom=1)}function x5t(i){const e=this._controllerInputSources.indexOf(i.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const n=this.getReferenceSpace();t.update(i.inputSource,i.frame,n),t.dispatchEvent({type:i.type,data:i.inputSource})}}function b5t(){const i=this._session,e=this._renderer;i.removeEventListener("select",this._onSessionEvent),i.removeEventListener("selectstart",this._onSessionEvent),i.removeEventListener("selectend",this._onSessionEvent),i.removeEventListener("squeeze",this._onSessionEvent),i.removeEventListener("squeezestart",this._onSessionEvent),i.removeEventListener("squeezeend",this._onSessionEvent),i.removeEventListener("end",this._onSessionEnd),i.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const n=this._controllerInputSources[t];n!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(n))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._supportsLayers===!0)for(const t of this._layers)t.renderTarget=new _E(t.pixelwidth,t.pixelheight,{format:xs,type:ps,depthTexture:new Jc(t.pixelwidth,t.pixelheight,t.stencilBuffer?pc:fs,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?mc:Zc),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function S5t(i){const e=this._controllers,t=this._controllerInputSources;for(let n=0;n<i.removed.length;n++){const r=i.removed[n],s=t.indexOf(r);s>=0&&(t[s]=null,e[s].disconnect(r))}for(let n=0;n<i.added.length;n++){const r=i.added[n];let s=t.indexOf(r);if(s===-1){for(let a=0;a<e.length;a++)if(a>=t.length){t.push(r),s=a;break}else if(t[a]===null){t[a]=r,s=a;break}if(s===-1)break}const o=e[s];o&&o.connect(r)}}function w5t(i){return i.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(i.translation,i.quaternion),width:i.width/2,height:i.height/2,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(i.translation,i.quaternion),radius:i.radius,centralAngle:i.centralAngle,aspectRatio:i.aspectRatio,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight,clearOnAccess:!1})}function T5t(i,e){if(e===void 0)return;const t=this._cameraXR,n=this._renderer,r=n.backend,s=this._glBaseLayer,o=this.getReferenceSpace(),a=e.getViewerPose(o);if(this._xrFrame=e,a!==null){const c=a.views;this._glBaseLayer!==null&&r.setXRTarget(s.framebuffer);let u=!1;c.length!==t.cameras.length&&(t.cameras.length=0,u=!0);for(let f=0;f<c.length;f++){const m=c[f];let v;if(this._useLayers===!0){const T=this._glBinding.getViewSubImage(this._glProjLayer,m);v=T.viewport,f===0&&r.setXRRenderTargetTextures(this._xrRenderTarget,T.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:T.depthStencilTexture)}else v=s.getViewport(m);let x=this._cameras[f];x===void 0&&(x=new po,x.layers.enable(f),x.viewport=new ir,this._cameras[f]=x),x.matrix.fromArray(m.transform.matrix),x.matrix.decompose(x.position,x.quaternion,x.scale),x.projectionMatrix.fromArray(m.projectionMatrix),x.projectionMatrixInverse.copy(x.projectionMatrix).invert(),x.viewport.set(v.x,v.y,v.width,v.height),f===0&&(t.matrix.copy(x.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),u===!0&&t.cameras.push(x)}n.setOutputRenderTarget(this._xrRenderTarget)}for(let c=0;c<this._controllers.length;c++){const u=this._controllerInputSources[c],f=this._controllers[c];u!==null&&f!==void 0&&f.update(u,e,o)}this._currentAnimationLoop&&this._currentAnimationLoop(i,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}const oEe=new W1,_B=new mn,vJ=new ir,_J=new lC,xJ=new rXe,xB=new Vn,o2=new ir;class E5t{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:r=!0,depth:s=!0,stencil:o=!1,antialias:a=!1,samples:c=0,getFallback:u=null,colorBufferType:f=Aa,multiview:m=!1}=t;this.domElement=e.getDomElement(),this.backend=e,this.samples=c||a===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=n,this.outputColorSpace=Hr,this.toneMapping=Yl,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=o,this.info=new ayt,this.overrideNodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new Ske,this.lighting=new g5t,this._getFallback=u,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new ir(0,0,this._width,this._height),this._scissor=new ir(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new ise(new ca),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const v=this.alpha===!0?0:1;this._clearColor=new rse(0,0,0,v),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=f,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:Bne},this.xr=new y5t(this,m),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(x,T,P)=>{await this.compileAsync(x,T);const R=this._renderLists.get(x,T),M=this._renderContexts.get(x,T,this._renderTarget),O=x.overrideMaterial||P.material,C=this._objects.get(P,O,x,T,R.lightsNode,M,M.clippingContext),{fragmentShader:L,vertexShader:Y}=C.getNodeBuilderState();return{fragmentShader:L,vertexShader:Y}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(r){if(this._getFallback!==null)try{this.backend=n=this._getFallback(r),await n.init(this)}catch(s){t(s);return}else{t(r);return}}this._nodes=new d5t(this,n),this._animation=new Q9t(this._nodes,this.info),this._attributes=new syt(n),this._background=new A4t(this,this._nodes),this._geometries=new oyt(this._attributes,this.info),this._textures=new Syt(this,n,this.info),this._pipelines=new hyt(n,this._nodes),this._bindings=new dyt(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new nyt(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new myt(this.lighting),this._bundles=new p5t,this._renderContexts=new xyt,this._animation.start(),this._initialized=!0,e(this)}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const r=this._nodes.nodeFrame,s=r.renderId,o=this._currentRenderContext,a=this._currentRenderObjectFunction,c=this._compilationPromises,u=e.isScene===!0?e:oEe;n===null&&(n=e);const f=this._renderTarget,m=this._renderContexts.get(n,t,f),v=this._activeMipmapLevel,x=[];this._currentRenderContext=m,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=x,r.renderId++,r.update(),m.depth=this.depth,m.stencil=this.stencil,m.clippingContext||(m.clippingContext=new gU),m.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,f);const T=this._renderLists.get(e,t);if(T.begin(),this._projectObject(e,t,0,T,m.clippingContext),n!==e&&n.traverseVisible(function(C){C.isLight&&C.layers.test(t.layers)&&T.pushLight(C)}),T.finish(),f!==null){this._textures.updateRenderTarget(f,v);const C=this._textures.get(f);m.textures=C.textures,m.depthTexture=C.depthTexture}else m.textures=null,m.depthTexture=null;this._background.update(u,T,m);const P=T.opaque,R=T.transparent,M=T.transparentDoublePass,O=T.lightsNode;this.opaque===!0&&P.length>0&&this._renderObjects(P,t,u,O),this.transparent===!0&&R.length>0&&this._renderTransparents(R,M,t,u,O),r.renderId=s,this._currentRenderContext=o,this._currentRenderObjectFunction=a,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(x)}async renderAsync(e,t){this._initialized===!1&&await this.init(),this._renderScene(e,t)}async waitForGPU(){await this.backend.waitForGPU()}set highPrecision(e){e===!0?(this.overrideNodes.modelViewMatrix=aTe,this.overrideNodes.modelNormalViewMatrix=lTe):this.highPrecision&&(this.overrideNodes.modelViewMatrix=null,this.overrideNodes.modelNormalViewMatrix=null)}get highPrecision(){return this.overrideNodes.modelViewMatrix===aTe&&this.overrideNodes.modelNormalViewMatrix===lTe}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),console.error(t),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:r,camera:s,renderList:o}=e,a=this._currentRenderContext,c=this._bundles.get(r,s),u=this.backend.get(c);u.renderContexts===void 0&&(u.renderContexts=new Set);const f=r.version!==u.version,m=u.renderContexts.has(a)===!1||f;if(u.renderContexts.add(a),m){this.backend.beginBundle(a),(u.renderObjects===void 0||f)&&(u.renderObjects=[]),this._currentRenderBundle=c;const{transparentDoublePass:v,transparent:x,opaque:T}=o;this.opaque===!0&&T.length>0&&this._renderObjects(T,s,t,n),this.transparent===!0&&x.length>0&&this._renderTransparents(x,v,s,t,n),this._currentRenderBundle=null,this.backend.finishBundle(a,c),u.version=r.version}else{const{renderObjects:v}=u;for(let x=0,T=v.length;x<T;x++){const P=v[x];this._nodes.needsRefresh(P)&&(this._nodes.updateBefore(P),this._nodes.updateForRender(P),this._bindings.updateForRender(P),this._nodes.updateAfter(P))}}this.backend.addBundle(a,c)}render(e,t){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,t);this._renderScene(e,t)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this;if(e!==Yl===!1&&t!==_l===!1)return null;const{width:s,height:o}=this.getDrawingBufferSize(_B),{depth:a,stencil:c}=this;let u=this._frameBufferTarget;u===null&&(u=new t3(s,o,{depthBuffer:a,stencilBuffer:c,type:this._colorBufferType,format:xs,colorSpace:_l,generateMipmaps:!1,minFilter:_s,magFilter:_s,samples:this.samples}),u.isPostProcessingRenderTarget=!0,this._frameBufferTarget=u);const f=this.getOutputRenderTarget();return u.depthBuffer=a,u.stencilBuffer=c,f!==null?u.setSize(f.width,f.height,f.depth):u.setSize(s,o,1),u.viewport.copy(this._viewport),u.scissor.copy(this._scissor),u.viewport.multiplyScalar(this._pixelRatio),u.scissor.multiplyScalar(this._pixelRatio),u.scissorTest=this._scissorTest,u.multiview=f!==null?f.multiview:!1,u.resolveDepthBuffer=f!==null?f.resolveDepthBuffer:!0,u.autoAllocateDepthBuffer=f!==null?f.autoAllocateDepthBuffer:!1,u}_renderScene(e,t,n=!0){if(this._isDeviceLost===!0)return;const r=n?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,o=s.renderId,a=this._currentRenderContext,c=this._currentRenderObjectFunction,u=e.isScene===!0?e:oEe,f=this._renderTarget||this._outputRenderTarget,m=this._activeCubeFace,v=this._activeMipmapLevel;let x;r!==null?(x=r,this.setRenderTarget(x)):x=f;const T=this._renderContexts.get(e,t,x);this._currentRenderContext=T,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls;const P=this.coordinateSystem,R=this.xr;if(t.coordinateSystem!==P&&R.isPresenting===!1&&(t.coordinateSystem=P,t.updateProjectionMatrix(),t.isArrayCamera))for(const Pe of t.cameras)Pe.coordinateSystem=P,Pe.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),R.enabled===!0&&R.isPresenting===!0&&(R.cameraAutoUpdate===!0&&R.updateCamera(t),t=R.getCamera());let M=this._viewport,O=this._scissor,C=this._pixelRatio;x!==null&&(M=x.viewport,O=x.scissor,C=1),this.getDrawingBufferSize(_B),vJ.set(0,0,_B.width,_B.height);const L=M.minDepth===void 0?0:M.minDepth,Y=M.maxDepth===void 0?1:M.maxDepth;T.viewportValue.copy(M).multiplyScalar(C).floor(),T.viewportValue.width>>=v,T.viewportValue.height>>=v,T.viewportValue.minDepth=L,T.viewportValue.maxDepth=Y,T.viewport=T.viewportValue.equals(vJ)===!1,T.scissorValue.copy(O).multiplyScalar(C).floor(),T.scissor=this._scissorTest&&T.scissorValue.equals(vJ)===!1,T.scissorValue.width>>=v,T.scissorValue.height>>=v,T.clippingContext||(T.clippingContext=new gU),T.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,x);const J=t.isArrayCamera?xJ:_J;t.isArrayCamera||(xB.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),J.setFromProjectionMatrix(xB,P));const z=this._renderLists.get(e,t);if(z.begin(),this._projectObject(e,t,0,z,T.clippingContext),z.finish(),this.sortObjects===!0&&z.sort(this._opaqueSort,this._transparentSort),x!==null){this._textures.updateRenderTarget(x,v);const Pe=this._textures.get(x);T.textures=Pe.textures,T.depthTexture=Pe.depthTexture,T.width=Pe.width,T.height=Pe.height,T.renderTarget=x,T.depth=x.depthBuffer,T.stencil=x.stencilBuffer}else T.textures=null,T.depthTexture=null,T.width=this.domElement.width,T.height=this.domElement.height,T.depth=this.depth,T.stencil=this.stencil;T.width>>=v,T.height>>=v,T.activeCubeFace=m,T.activeMipmapLevel=v,T.occlusionQueryCount=z.occlusionQueryCount,this._background.update(u,z,T),T.camera=t,this.backend.beginRender(T);const{bundles:ne,lightsNode:K,transparentDoublePass:$,transparent:he,opaque:Ce}=z;return ne.length>0&&this._renderBundles(ne,u,K),this.opaque===!0&&Ce.length>0&&this._renderObjects(Ce,t,u,K),this.transparent===!0&&he.length>0&&this._renderTransparents(he,$,t,u,K),this.backend.finishRender(T),s.renderId=o,this._currentRenderContext=a,this._currentRenderObjectFunction=c,r!==null&&(this.setRenderTarget(f,m,v),this._renderOutput(x)),u.onAfterRender(this,e,t,x),T}_setXRLayerSize(e,t){this._width=e,this._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,r=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=r}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),n===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,r){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,n,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,r,s=0,o=1){const a=this._viewport;e.isVector4?a.copy(e):a.set(e,t,n,r),a.minDepth=s,a.maxDepth=o}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,n=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,t,n);const r=this._renderTarget||this._getFrameBufferTarget();let s=null;if(r!==null){this._textures.updateRenderTarget(r);const o=this._textures.get(r);s=this._renderContexts.getForClear(r),s.textures=o.textures,s.depthTexture=o.depthTexture,s.width=o.width,s.height=o.height,s.renderTarget=r,s.depth=r.depthBuffer,s.stencil=r.stencilBuffer,s.clearColorValue=this.backend.getClearColor(),s.activeCubeFace=this.getActiveCubeFace(),s.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,n,s),r!==null&&this._renderTarget===null&&this._renderOutput(r)}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,n=!0){this._initialized===!1&&await this.init(),this.clear(e,t,n)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Yl}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:_l}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()}),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,n=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const t=this._nodes.nodeFrame,n=t.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,t.renderId=this.info.calls;const r=this.backend,s=this._pipelines,o=this._bindings,a=this._nodes,c=Array.isArray(e)?e:[e];if(c[0]===void 0||c[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");r.beginCompute(e);for(const u of c){if(s.has(u)===!1){const v=()=>{u.removeEventListener("dispose",v),s.delete(u),o.delete(u),a.delete(u)};u.addEventListener("dispose",v);const x=u.onInitFunction;x!==null&&x.call(u,{renderer:this})}a.updateForCompute(u),o.updateForCompute(u);const f=o.getForCompute(u),m=s.getForCompute(u,f);r.compute(e,u,f,m)}r.finishCompute(e),t.renderId=n}async computeAsync(e){this._initialized===!1&&await this.init(),this.compute(e)}async hasFeatureAsync(e){return this._initialized===!1&&await this.init(),this.backend.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){this._initialized===!1&&await this.init(),this._textures.updateTexture(e)}initTexture(e){this._initialized===!1&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=o2.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=o2.copy(t).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=o2.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,r;n!==null?r=n.renderTarget:(r=this._renderTarget||this._getFrameBufferTarget(),r!==null&&(this._textures.updateRenderTarget(r),n=this._textures.get(r))),this._textures.updateTexture(e,{renderTarget:r}),this.backend.copyFramebufferToTexture(e,n,t)}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,r,s,o)}async readRenderTargetPixelsAsync(e,t,n,r,s,o=0,a=0){return this.backend.copyTextureToBuffer(e.textures[o],t,n,r,s,a)}_projectObject(e,t,n,r,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){const c=t.isArrayCamera?xJ:_J;if(!e.frustumCulled||c.intersectsSprite(e,t)){this.sortObjects===!0&&o2.setFromMatrixPosition(e.matrixWorld).applyMatrix4(xB);const{geometry:u,material:f}=e;f.visible&&r.push(e,u,f,n,o2.z,null,s)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const c=t.isArrayCamera?xJ:_J;if(!e.frustumCulled||c.intersectsObject(e,t)){const{geometry:u,material:f}=e;if(this.sortObjects===!0&&(u.boundingSphere===null&&u.computeBoundingSphere(),o2.copy(u.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(xB)),Array.isArray(f)){const m=u.groups;for(let v=0,x=m.length;v<x;v++){const T=m[v],P=f[T.materialIndex];P&&P.visible&&r.push(e,u,P,n,o2.z,T,s)}}else f.visible&&r.push(e,u,f,n,o2.z,null,s)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const c=r;r=this._renderLists.get(e,t),r.begin(),c.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}const a=e.children;for(let c=0,u=a.length;c<u;c++)this._projectObject(a[c],t,n,r,s)}_renderBundles(e,t,n){for(const r of e)this._renderBundle(r,t,n)}_renderTransparents(e,t,n,r,s){if(t.length>0){for(const{material:o}of t)o.side=Ui;this._renderObjects(t,n,r,s,"backSide");for(const{material:o}of t)o.side=Xl;this._renderObjects(e,n,r,s);for(const{material:o}of t)o.side=Co}else this._renderObjects(e,n,r,s)}_renderObjects(e,t,n,r,s=null){for(let o=0,a=e.length;o<a;o++){const{object:c,geometry:u,material:f,group:m,clippingContext:v}=e[o];this._currentRenderObjectFunction(c,n,t,u,f,m,r,v,s)}}renderObject(e,t,n,r,s,o,a,c=null,u=null){let f,m,v;if(e.onBeforeRender(this,t,n,r,s,o),s.allowOverride===!0&&t.overrideMaterial!==null){const x=t.overrideMaterial;s.positionNode&&s.positionNode.isNode&&(f=x.positionNode,x.positionNode=s.positionNode),x.alphaTest=s.alphaTest,x.alphaMap=s.alphaMap,x.transparent=s.transparent||s.transmission>0,x.isShadowPassMaterial&&(x.side=s.shadowSide===null?s.side:s.shadowSide,s.depthNode&&s.depthNode.isNode&&(v=x.depthNode,x.depthNode=s.depthNode),s.castShadowNode&&s.castShadowNode.isNode&&(m=x.colorNode,x.colorNode=s.castShadowNode),s.castShadowPositionNode&&s.castShadowPositionNode.isNode&&(f=x.positionNode,x.positionNode=s.castShadowPositionNode)),s=x}s.transparent===!0&&s.side===Co&&s.forceSinglePass===!1?(s.side=Ui,this._handleObjectFunction(e,s,t,n,a,o,c,"backSide"),s.side=Xl,this._handleObjectFunction(e,s,t,n,a,o,c,u),s.side=Co):this._handleObjectFunction(e,s,t,n,a,o,c,u),f!==void 0&&(t.overrideMaterial.positionNode=f),v!==void 0&&(t.overrideMaterial.depthNode=v),m!==void 0&&(t.overrideMaterial.colorNode=m),e.onAfterRender(this,t,n,r,s,o)}_renderObjectDirect(e,t,n,r,s,o,a,c){const u=this._objects.get(e,t,n,r,s,this._currentRenderContext,a,c);u.drawRange=e.geometry.drawRange,u.group=o;const f=this._nodes.needsRefresh(u);f&&(this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u)),this._pipelines.updateForRender(u),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(u),u.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(u,this.info),f&&this._nodes.updateAfter(u)}_createObjectPipeline(e,t,n,r,s,o,a,c){const u=this._objects.get(e,t,n,r,s,this._currentRenderContext,a,c);u.drawRange=e.geometry.drawRange,u.group=o,this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u),this._pipelines.getForRender(u,this._compilationPromises),this._nodes.updateAfter(u)}get compile(){return this.compileAsync}}class lse{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function M5t(i){return i+(S2-i%S2)%S2}let wke=class extends lse{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return M5t(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}};class Tke extends wke{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let C5t=0;class Eke extends Tke{constructor(e,t){super("UniformBuffer_"+C5t++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class A5t extends Tke{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let n=0,r=this.uniforms.length;n<r;n++){const s=this.uniforms[n],o=s.boundary,a=s.itemSize*e,c=t%S2,u=c%o,f=c+u;t+=u,f!==0&&S2-f<a&&(t+=S2-f),s.offset=t/e,t+=a}return Math.ceil(t/S2)*S2}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s]!==r){const a=this._getBufferForType(o);a[s]=n[s]=r,t=!0}return t}updateVector2(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y){const a=this._getBufferForType(o);a[s+0]=n[s+0]=r.x,a[s+1]=n[s+1]=r.y,t=!0}return t}updateVector3(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y||n[s+2]!==r.z){const a=this._getBufferForType(o);a[s+0]=n[s+0]=r.x,a[s+1]=n[s+1]=r.y,a[s+2]=n[s+2]=r.z,t=!0}return t}updateVector4(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,o=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y||n[s+2]!==r.z||n[s+4]!==r.w){const a=this._getBufferForType(o);a[s+0]=n[s+0]=r.x,a[s+1]=n[s+1]=r.y,a[s+2]=n[s+2]=r.z,a[s+3]=n[s+3]=r.w,t=!0}return t}updateColor(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset;if(n[s+0]!==r.r||n[s+1]!==r.g||n[s+2]!==r.b){const o=this.buffer;o[s+0]=n[s+0]=r.r,o[s+1]=n[s+1]=r.g,o[s+2]=n[s+2]=r.b,t=!0}return t}updateMatrix3(e){let t=!1;const n=this.values,r=e.getValue().elements,s=e.offset;if(n[s+0]!==r[0]||n[s+1]!==r[1]||n[s+2]!==r[2]||n[s+4]!==r[3]||n[s+5]!==r[4]||n[s+6]!==r[5]||n[s+8]!==r[6]||n[s+9]!==r[7]||n[s+10]!==r[8]){const o=this.buffer;o[s+0]=n[s+0]=r[0],o[s+1]=n[s+1]=r[1],o[s+2]=n[s+2]=r[2],o[s+4]=n[s+4]=r[3],o[s+5]=n[s+5]=r[4],o[s+6]=n[s+6]=r[5],o[s+8]=n[s+8]=r[6],o[s+9]=n[s+9]=r[7],o[s+10]=n[s+10]=r[8],t=!0}return t}updateMatrix4(e){let t=!1;const n=this.values,r=e.getValue().elements,s=e.offset;return P5t(n,r,s)===!1&&(this.buffer.set(r,s),R5t(n,r,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function R5t(i,e,t){for(let n=0,r=e.length;n<r;n++)i[t+n]=e[n]}function P5t(i,e,t){for(let n=0,r=e.length;n<r;n++)if(i[t+n]!==e[n])return!1;return!0}let N5t=0;class Mke extends A5t{constructor(e,t){super(e),this.id=N5t++,this.groupNode=t,this.isNodeUniformsGroup=!0}}let I5t=0;class k5t extends lse{constructor(e,t){super(e),this.id=I5t++,this.texture=t,this.version=t?t.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:t}=this;return e!==this.generation?(this.generation=e,!0):t.isVideoTexture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}}class Pz extends k5t{constructor(e,t,n,r=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=r}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class Cke extends Pz{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledCubeTexture=!0}}class Ake extends Pz{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledTexture3D=!0}}const D5t={textureDimensions:"textureSize",equals:"equal"},F5t={low:"lowp",medium:"mediump",high:"highp"},aEe={swizzleAssign:!0,storageBuffer:!1},lEe={perspective:"smooth",linear:"noperspective"},cEe={centroid:"centroid","flat first":"flat","flat either":"flat"},uEe=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class O5t extends xke{constructor(e,t){super(e,t,new h5t),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Xa}getMethod(e){return D5t[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${r.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const n=t.array,r=t.count*t.itemSize,{itemSize:s}=t,o=t.array.constructor.name.toLowerCase().includes("int");let a=o?px:sC;s===2?a=o?mx:E1:s===3?a=o?$We:iC:s===4&&(a=o?gx:xs);const c={Float32Array:Ys,Uint8Array:ps,Uint16Array:_d,Uint32Array:fs,Int8Array:e4,Int16Array:t4,Int32Array:qa,Uint8ClampedArray:ps},u=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(r/s))));let f=Math.ceil(r/s/u);u*f*s<r&&f++;const m=u*f*s,v=new n.constructor(m);v.set(n,0),t.array=v;const x=new B6(t.array,u,f,a,c[t.array.constructor.name]||Ys);x.needsUpdate=!0,x.isPBOTexture=!0;const T=new Rx(x,null,null);T.setPrecision("high"),t.pboNode=T,t.pbo=T.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,r=t.value;if(this.renderer.backend.has(r)){const f=this.renderer.backend.get(r);f.pbo=r.pbo}const s=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.label),o=this.getPropertyName(s);this.increaseUsage(n);const a=n.build(this,"uint"),c=this.getDataFromNode(e);let u=c.propertyName;if(u===void 0){const f=this.getVarFromNode(e);u=this.getPropertyName(f);const m=this.getDataFromNode(t);let v=m.propertySizeName;v===void 0&&(v=u+"Size",this.getVarFromNode(t,v,"uint"),this.addLineFlowCode(`${v} = uint( textureSize( ${o}, 0 ).x )`,e),m.propertySizeName=v);const{itemSize:x}=r,T="."+Ax.join("").slice(0,x),P=`ivec2(${a} % ${v}, ${a} / ${v})`,R=this.generateTextureLoad(null,o,P,null,"0");let M="vec4";r.pbo.type===fs?M="uvec4":r.pbo.type===qa&&(M="ivec4"),this.addLineFlowCode(`${u} = ${M}(${R})${T}`,e),c.propertyName=u}return u}generateTextureLoad(e,t,n,r,s="0"){return r?`texelFetch( ${t}, ivec3( ${n}, ${r} ), ${s} )`:`texelFetch( ${t}, ${n}, ${s} )`}generateTexture(e,t,n,r){return e.isDepthTexture?(r&&(n=`vec4( ${n}, ${r} )`),`texture( ${t}, ${n} ).x`):(r&&(n=`vec3( ${n}, ${r} )`),`texture( ${t}, ${n} )`)}generateTextureLevel(e,t,n,r){return`textureLod( ${t}, ${n}, ${r} )`}generateTextureBias(e,t,n,r){return`texture( ${t}, ${n}, ${r} )`}generateTextureGrad(e,t,n,r){return`textureGrad( ${t}, ${n}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,n,r,s,o=this.shaderStage){if(o==="fragment")return s?`texture( ${t}, vec4( ${n}, ${s}, ${r} ) )`:`texture( ${t}, vec3( ${n}, ${r} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const r of n)t.push(`${this.getVar(r.type,r.name,r.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],n=[],r={};for(const o of t){let a=null,c=!1;if(o.type==="texture"||o.type==="texture3D"){const f=o.node.value;let m="";(f.isDataTexture===!0||f.isData3DTexture===!0)&&(f.type===fs?m="u":f.type===qa&&(m="i")),o.type==="texture3D"&&f.isArrayTexture===!1?a=`${m}sampler3D ${o.name};`:f.compareFunction?f.isArrayTexture===!0?a=`sampler2DArrayShadow ${o.name};`:a=`sampler2DShadow ${o.name};`:f.isArrayTexture===!0||f.isDataArrayTexture===!0||f.isCompressedArrayTexture===!0?a=`${m}sampler2DArray ${o.name};`:a=`${m}sampler2D ${o.name};`}else if(o.type==="cubeTexture")a=`samplerCube ${o.name};`;else if(o.type==="buffer"){const f=o.node,m=this.getType(f.bufferType),v=f.bufferCount,x=v>0?v:"";a=`${f.name} {
	${m} ${o.name}[${x}];
};
`}else a=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,c=!0;const u=o.node.precision;if(u!==null&&(a=F5t[u]+" "+a),c){a="	"+a;const f=o.groupNode.name;(r[f]||(r[f]=[])).push(a)}else a="uniform "+a,n.push(a)}let s="";for(const o in r){const a=r[o];s+=this._getGLSLUniformStruct(e+"_"+o,a.join(`
`))+`
`}return s+=n.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==qa){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const r=n.array;r instanceof Uint32Array||r instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const n=this.getAttributesArray();let r=0;for(const s of n)t+=`layout( location = ${r++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push(`	${n.type} ${n.name};`);return t.join(`
`)}getStructs(e){const t=[],n=this.structs[e],r=[];for(const s of n)if(s.output)for(const o of s.members)r.push(`layout( location = ${o.index} ) out ${o.type} ${o.name};`);else{let o="struct "+s.name+` {
`;o+=this.getStructMembers(s),o+=`
};
`,t.push(o)}return r.length===0&&r.push("layout( location = 0 ) out vec4 fragColor;"),`
`+r.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const n=this.varyings;if(e==="vertex"||e==="compute")for(const r of n){e==="compute"&&(r.needsInterpolation=!0);const s=this.getType(r.type);if(r.needsInterpolation)if(r.interpolationType){const o=lEe[r.interpolationType]||r.interpolationType,a=cEe[r.interpolationSampling]||"";t+=`${o} ${a} out ${s} ${r.name};
`}else{const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}out ${s} ${r.name};
`}else t+=`${s} ${r.name};
`}else if(e==="fragment"){for(const r of n)if(r.needsInterpolation){const s=this.getType(r.type);if(r.interpolationType){const o=lEe[r.interpolationType]||r.interpolationType,a=cEe[r.interpolationSampling]||"";t+=`${o} ${a} in ${s} ${r.name};
`}else{const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}in ${s} ${r.name};
`}}}for(const r of this.builtins[e])t+=`${r};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((n,r)=>n*r,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,n=this.shaderStage){const r=this.extensions[n]||(this.extensions[n]=new Map);r.has(e)===!1&&r.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const r=this.renderer.backend.extensions;this.object.isBatchedMesh&&r.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(n!==void 0)for(const{name:r,behavior:s}of n.values())t.push(`#extension ${r} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=aEe[e];if(t===void 0){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance";break}if(n!==void 0){const r=this.renderer.backend.extensions;r.has(n)&&(r.get(n),t=!0)}aEe[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const r=e[n],s=this.getPropertyName(r.attributeNode);s&&(t+=`${r.varyingName} = ${s};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${uEe}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${uEe}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

// structs
${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n=`// code

`;n+=this.flowCode[t];const r=this.flowNodes[t],s=r[r.length-1];for(const a of r){const c=this.getFlowData(a),u=a.name;u&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${u}
	`),n+=`${c.code}
	`,a===s&&t!=="compute"&&(n+=`// result
	`,t==="vertex"?(n+="gl_Position = ",n+=`${c.result};`):t==="fragment"&&(a.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${c.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n,r=null){const s=super.getUniformFromNode(e,t,n,r),o=this.getDataFromNode(e,n,this.globalCache);let a=o.uniformGPU;if(a===void 0){const c=e.groupNode,u=c.name,f=this.getBindGroupArray(u,n);if(t==="texture")a=new Pz(s.name,s.node,c),f.push(a);else if(t==="cubeTexture")a=new Cke(s.name,s.node,c),f.push(a);else if(t==="texture3D")a=new Ake(s.name,s.node,c),f.push(a);else if(t==="buffer"){e.name=`NodeBuffer_${e.id}`,s.name=`buffer${e.id}`;const m=new Eke(e,c);m.name=e.name,f.push(m),a=m}else{const m=this.uniformGroups[n]||(this.uniformGroups[n]={});let v=m[u];v===void 0&&(v=new Mke(n+"_"+u,c),m[u]=v,f.push(v)),a=this.getNodeUniform(s,t),v.addUniform(a)}o.uniformGPU=a}return s}}let bJ=null,g6=null;class Rke{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={render:null,compute:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){Qc("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t){Qc(`WebGPURenderer: No timestamp query pool for type '${e}' found.`);return}const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async waitForGPU(){}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return bJ=bJ||new mn,this.renderer.getDrawingBufferSize(bJ)}setScissorTest(){}getClearColor(){const e=this.renderer;return g6=g6||new rse,e.getClearColor(g6),g6.getRGB(g6),g6}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:KCe(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${fx} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let B5t=0;class L5t{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class U5t{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:r}=n,s=e.array,o=e.usage||r.STATIC_DRAW,a=e.isInterleavedBufferAttribute?e.data:e,c=n.get(a);let u=c.bufferGPU;u===void 0&&(u=this._createBuffer(r,t,s,o),c.bufferGPU=u,c.bufferType=t,c.version=a.version);let f;if(s instanceof Float32Array)f=r.FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?f=r.HALF_FLOAT:f=r.UNSIGNED_SHORT;else if(s instanceof Int16Array)f=r.SHORT;else if(s instanceof Uint32Array)f=r.UNSIGNED_INT;else if(s instanceof Int32Array)f=r.INT;else if(s instanceof Int8Array)f=r.BYTE;else if(s instanceof Uint8Array)f=r.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)f=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let m={bufferGPU:u,bufferType:t,type:f,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:f===r.INT||f===r.UNSIGNED_INT||e.gpuType===qa,id:B5t++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const v=this._createBuffer(r,t,s,o);m=new L5t(m,v)}n.set(e,m)}updateAttribute(e){const t=this.backend,{gl:n}=t,r=e.array,s=e.isInterleavedBufferAttribute?e.data:e,o=t.get(s),a=o.bufferType,c=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(a,o.bufferGPU),c.length===0)n.bufferSubData(a,0,r);else{for(let u=0,f=c.length;u<f;u++){const m=c[u];n.bufferSubData(a,m.start*r.BYTES_PER_ELEMENT,r,m.start,m.count)}s.clearUpdateRanges()}n.bindBuffer(a,null),o.version=s.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const r=t.get(e);n.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(r),o=e.array,a=o.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,s);const c=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.bufferData(n.COPY_WRITE_BUFFER,a,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,a),await t.utils._clientWaitAsync();const u=new e.array.constructor(o.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,u),n.deleteBuffer(c),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),u.buffer}_createBuffer(e,t,n,r){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,n,r),e.bindBuffer(t,null),s}}let SJ,KT;class z5t{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;SJ={[gl]:e.FUNC_ADD,[FU]:e.FUNC_SUBTRACT,[OU]:e.FUNC_REVERSE_SUBTRACT},KT={[ud]:e.ZERO,[KM]:e.ONE,[ZM]:e.SRC_COLOR,[g4]:e.SRC_ALPHA,[BU]:e.SRC_ALPHA_SATURATE,[tC]:e.DST_COLOR,[JM]:e.DST_ALPHA,[QM]:e.ONE_MINUS_SRC_COLOR,[y4]:e.ONE_MINUS_SRC_ALPHA,[nC]:e.ONE_MINUS_DST_COLOR,[eC]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=new ir().fromArray(t),this.currentViewport=new ir().fromArray(n),this._tempVec4=new ir}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==VCe?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===Mee?t.cullFace(t.BACK):e===GCe?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,n,r,s,o,a,c){const{gl:u}=this;if(e===vl){this.currentBlendingEnabled===!0&&(this.disable(u.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(u.BLEND),this.currentBlendingEnabled=!0),e!==Jy){if(e!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==gl||this.currentBlendEquationAlpha!==gl)&&(u.blendEquation(u.FUNC_ADD),this.currentBlendEquation=gl,this.currentBlendEquationAlpha=gl),c)switch(e){case fc:u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case f4:u.blendFunc(u.ONE,u.ONE);break;case p4:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case m4:u.blendFuncSeparate(u.ZERO,u.SRC_COLOR,u.ZERO,u.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case fc:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case f4:u.blendFunc(u.SRC_ALPHA,u.ONE);break;case p4:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case m4:u.blendFunc(u.ZERO,u.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=c}return}s=s||t,o=o||n,a=a||r,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(u.blendEquationSeparate(SJ[t],SJ[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(n!==this.currentBlendSrc||r!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||a!==this.currentBlendDstAlpha)&&(u.blendFuncSeparate(KT[n],KT[r],KT[o],KT[a]),this.currentBlendSrc=n,this.currentBlendDst=r,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=a),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case cM:t.depthFunc(t.NEVER);break;case uM:t.depthFunc(t.ALWAYS);break;case hM:t.depthFunc(t.LESS);break;case z2:t.depthFunc(t.LEQUAL);break;case dM:t.depthFunc(t.EQUAL);break;case fM:t.depthFunc(t.GEQUAL);break;case pM:t.depthFunc(t.GREATER);break;case mM:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,r){const s=this._tempVec4.set(e,t,n,r);if(this.currentScissor.equals(s)===!1){const{gl:o}=this;o.scissor(s.x,s.y,s.z,s.w),this.currentScissor.copy(s)}}viewport(e,t,n,r){const s=this._tempVec4.set(e,t,n,r);if(this.currentViewport.equals(s)===!1){const{gl:o}=this;o.viewport(s.x,s.y,s.z,s.w),this.currentViewport.copy(s)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:r}=this;e.side===Co?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let s=e.side===Ui;t&&(s=!s),this.setFlipSided(s),e.blending===fc&&e.transparent===!1?this.setBlending(vl):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n)for(let c=0;c<8;c++)c<n?this.enable(12288+c):this.disable(12288+c)}setPolygonOffset(e,t,n){const{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==n)&&(r.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const n=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(n.bindVertexArray(e),t!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:r}=this;return r[e]!==t?(n.bindFramebuffer(e,t),r[e]=t,e===n.DRAW_FRAMEBUFFER&&(r[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(r[n.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:n}=this;let r=[],s=!1;if(e.textures!==null){r=this.currentDrawbuffers.get(t),r===void 0&&(r=[],this.currentDrawbuffers.set(t,r));const o=e.textures;if(r.length!==o.length||r[0]!==n.COLOR_ATTACHMENT0){for(let a=0,c=o.length;a<c;a++)r[a]=n.COLOR_ATTACHMENT0+a;r.length=o.length,s=!0}}else r[0]!==n.BACK&&(r[0]=n.BACK,s=!0);s&&n.drawBuffers(r)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:r}=this;e===void 0&&(e=t.TEXTURE0+r-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:r,currentTextureSlot:s,currentBoundTextures:o,maxTextures:a}=this;n===void 0&&(s===null?n=r.TEXTURE0+a-1:n=s);let c=o[n];c===void 0&&(c={type:void 0,texture:void 0},o[n]=c),(c.type!==e||c.texture!==t)&&(s!==n&&(r.activeTexture(n),this.currentTextureSlot=n),r.bindTexture(e,t),c.type=e,c.texture=t)}bindBufferBase(e,t,n){const{gl:r}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==n?(r.bindBufferBase(e,t,n),this.currentBoundBufferBases[s]=n,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,r=n[t];r!==void 0&&r.type!==void 0&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class V5t{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Xa){const{gl:n,extensions:r}=this;let s;const o=rr.getTransfer(t);if(e===ps)return n.UNSIGNED_BYTE;if(e===LU)return n.UNSIGNED_SHORT_4_4_4_4;if(e===UU)return n.UNSIGNED_SHORT_5_5_5_1;if(e===zU)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===e4)return n.BYTE;if(e===t4)return n.SHORT;if(e===_d)return n.UNSIGNED_SHORT;if(e===qa)return n.INT;if(e===fs)return n.UNSIGNED_INT;if(e===Ys)return n.FLOAT;if(e===Aa)return n.HALF_FLOAT;if(e===Zne)return n.ALPHA;if(e===iC)return n.RGB;if(e===xs)return n.RGBA;if(e===Zc)return n.DEPTH_COMPONENT;if(e===mc)return n.DEPTH_STENCIL;if(e===sC)return n.RED;if(e===px)return n.RED_INTEGER;if(e===E1)return n.RG;if(e===mx)return n.RG_INTEGER;if(e===gx)return n.RGBA_INTEGER;if(e===n4||e===D2||e===F2||e===O2)if(o===zn)if(s=r.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===n4)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===D2)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===F2)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===O2)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=r.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===n4)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===D2)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===F2)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===O2)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===gM||e===yM||e===vM||e===_M)if(s=r.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===gM)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===yM)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===vM)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===_M)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===xM||e===C_||e===A_)if(s=r.get("WEBGL_compressed_texture_etc"),s!==null){if(e===xM||e===C_)return o===zn?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===A_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===R_||e===P_||e===N_||e===I_||e===k_||e===D_||e===F_||e===O_||e===B_||e===L_||e===U_||e===z_||e===V_||e===G_)if(s=r.get("WEBGL_compressed_texture_astc"),s!==null){if(e===R_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===P_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===N_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===I_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===k_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===D_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===F_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===O_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===B_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===L_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===U_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===z_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===V_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===G_)return o===zn?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===r4)if(s=r.get("EXT_texture_compression_bptc"),s!==null){if(e===r4)return o===zn?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===Qne||e===bM||e===SM||e===wM)if(s=r.get("EXT_texture_compression_rgtc"),s!==null){if(e===r4)return s.COMPRESSED_RED_RGTC1_EXT;if(e===bM)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===SM)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===wM)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===pc?n.UNSIGNED_INT_24_8:n[e]!==void 0?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,r)=>{function s(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(t),r();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),n()}s()})}}let hEe=!1,bB,wJ,dEe;class G5t{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},hEe===!1&&(this._init(),hEe=!0)}_init(){const e=this.gl;bB={[tu]:e.REPEAT,[ta]:e.CLAMP_TO_EDGE,[x4]:e.MIRRORED_REPEAT},wJ={[es]:e.NEAREST,[Kne]:e.NEAREST_MIPMAP_NEAREST,[T1]:e.NEAREST_MIPMAP_LINEAR,[_s]:e.LINEAR,[r_]:e.LINEAR_MIPMAP_NEAREST,[oc]:e.LINEAR_MIPMAP_LINEAR},dEe={[ere]:e.NEVER,[sre]:e.ALWAYS,[VU]:e.LESS,[GU]:e.LEQUAL,[tre]:e.EQUAL,[ire]:e.GEQUAL,[nre]:e.GREATER,[rre]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return e.isCubeTexture===!0?n=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?n=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?n=t.TEXTURE_3D:n=t.TEXTURE_2D,n}getInternalFormat(e,t,n,r,s=!1){const{gl:o,extensions:a}=this;if(e!==null){if(o[e]!==void 0)return o[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let c=t;if(t===o.RED&&(n===o.FLOAT&&(c=o.R32F),n===o.HALF_FLOAT&&(c=o.R16F),n===o.UNSIGNED_BYTE&&(c=o.R8),n===o.UNSIGNED_SHORT&&(c=o.R16),n===o.UNSIGNED_INT&&(c=o.R32UI),n===o.BYTE&&(c=o.R8I),n===o.SHORT&&(c=o.R16I),n===o.INT&&(c=o.R32I)),t===o.RED_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.R8UI),n===o.UNSIGNED_SHORT&&(c=o.R16UI),n===o.UNSIGNED_INT&&(c=o.R32UI),n===o.BYTE&&(c=o.R8I),n===o.SHORT&&(c=o.R16I),n===o.INT&&(c=o.R32I)),t===o.RG&&(n===o.FLOAT&&(c=o.RG32F),n===o.HALF_FLOAT&&(c=o.RG16F),n===o.UNSIGNED_BYTE&&(c=o.RG8),n===o.UNSIGNED_SHORT&&(c=o.RG16),n===o.UNSIGNED_INT&&(c=o.RG32UI),n===o.BYTE&&(c=o.RG8I),n===o.SHORT&&(c=o.RG16I),n===o.INT&&(c=o.RG32I)),t===o.RG_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RG8UI),n===o.UNSIGNED_SHORT&&(c=o.RG16UI),n===o.UNSIGNED_INT&&(c=o.RG32UI),n===o.BYTE&&(c=o.RG8I),n===o.SHORT&&(c=o.RG16I),n===o.INT&&(c=o.RG32I)),t===o.RGB){const u=s?$_:rr.getTransfer(r);n===o.FLOAT&&(c=o.RGB32F),n===o.HALF_FLOAT&&(c=o.RGB16F),n===o.UNSIGNED_BYTE&&(c=o.RGB8),n===o.UNSIGNED_SHORT&&(c=o.RGB16),n===o.UNSIGNED_INT&&(c=o.RGB32UI),n===o.BYTE&&(c=o.RGB8I),n===o.SHORT&&(c=o.RGB16I),n===o.INT&&(c=o.RGB32I),n===o.UNSIGNED_BYTE&&(c=u===zn?o.SRGB8:o.RGB8),n===o.UNSIGNED_SHORT_5_6_5&&(c=o.RGB565),n===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1),n===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGB4),n===o.UNSIGNED_INT_5_9_9_9_REV&&(c=o.RGB9_E5)}if(t===o.RGB_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RGB8UI),n===o.UNSIGNED_SHORT&&(c=o.RGB16UI),n===o.UNSIGNED_INT&&(c=o.RGB32UI),n===o.BYTE&&(c=o.RGB8I),n===o.SHORT&&(c=o.RGB16I),n===o.INT&&(c=o.RGB32I)),t===o.RGBA){const u=s?$_:rr.getTransfer(r);n===o.FLOAT&&(c=o.RGBA32F),n===o.HALF_FLOAT&&(c=o.RGBA16F),n===o.UNSIGNED_BYTE&&(c=o.RGBA8),n===o.UNSIGNED_SHORT&&(c=o.RGBA16),n===o.UNSIGNED_INT&&(c=o.RGBA32UI),n===o.BYTE&&(c=o.RGBA8I),n===o.SHORT&&(c=o.RGBA16I),n===o.INT&&(c=o.RGBA32I),n===o.UNSIGNED_BYTE&&(c=u===zn?o.SRGB8_ALPHA8:o.RGBA8),n===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGBA4),n===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1)}return t===o.RGBA_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RGBA8UI),n===o.UNSIGNED_SHORT&&(c=o.RGBA16UI),n===o.UNSIGNED_INT&&(c=o.RGBA32UI),n===o.BYTE&&(c=o.RGBA8I),n===o.SHORT&&(c=o.RGBA16I),n===o.INT&&(c=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(n===o.UNSIGNED_SHORT&&(c=o.DEPTH_COMPONENT16),n===o.UNSIGNED_INT&&(c=o.DEPTH_COMPONENT24),n===o.FLOAT&&(c=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&n===o.UNSIGNED_INT_24_8&&(c=o.DEPTH24_STENCIL8),(c===o.R16F||c===o.R32F||c===o.RG16F||c===o.RG32F||c===o.RGBA16F||c===o.RGBA32F)&&a.get("EXT_color_buffer_float"),c}setTextureParameters(e,t){const{gl:n,extensions:r,backend:s}=this,o=rr.getPrimaries(rr.workingColorSpace),a=t.colorSpace===Xa?null:rr.getPrimaries(t.colorSpace),c=t.colorSpace===Xa||o===a?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,c),n.texParameteri(e,n.TEXTURE_WRAP_S,bB[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,bB[t.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||n.texParameteri(e,n.TEXTURE_WRAP_R,bB[t.wrapR])),n.texParameteri(e,n.TEXTURE_MAG_FILTER,wJ[t.magFilter]);const u=t.mipmaps!==void 0&&t.mipmaps.length>0,f=t.minFilter===_s&&u?oc:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,wJ[f]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,dEe[t.compareFunction])),r.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===es||t.minFilter!==T1&&t.minFilter!==oc||t.type===Ys&&r.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const m=r.get("EXT_texture_filter_anisotropic");n.texParameterf(e,m.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:r}=this,s=this.getGLTextureType(e);let o=r[s];o===void 0&&(o=t.createTexture(),n.state.bindTexture(s,o),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),r[s]=o),n.set(e,{textureGPU:o,glTextureType:s,isDefault:!0})}createTexture(e,t){const{gl:n,backend:r}=this,{levels:s,width:o,height:a,depth:c}=t,u=r.utils.convert(e.format,e.colorSpace),f=r.utils.convert(e.type),m=this.getInternalFormat(e.internalFormat,u,f,e.colorSpace,e.isVideoTexture),v=n.createTexture(),x=this.getGLTextureType(e);r.state.bindTexture(x,v),this.setTextureParameters(x,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,s,m,o,a,c):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,s,m,o,a,c):e.isVideoTexture||n.texStorage2D(x,s,m,o,a),r.set(e,{textureGPU:v,glTextureType:x,glFormat:u,glType:f,glInternalFormat:m})}copyBufferToTexture(e,t){const{gl:n,backend:r}=this,{textureGPU:s,glTextureType:o,glFormat:a,glType:c}=r.get(t),{width:u,height:f}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(o,s),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(o,0,0,0,u,f,a,c,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:r,height:s}=t,{textureGPU:o,glTextureType:a,glFormat:c,glType:u,glInternalFormat:f}=this.backend.get(e);if(!(e.isRenderTargetTexture||o===void 0))if(this.backend.state.bindTexture(a,o),this.setTextureParameters(a,e),e.isCompressedTexture){const m=e.mipmaps,v=t.image;for(let x=0;x<m.length;x++){const T=m[x];e.isCompressedArrayTexture?e.format!==n.RGBA?c!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,x,0,0,0,T.width,T.height,v.depth,c,T.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,x,0,0,0,T.width,T.height,v.depth,c,u,T.data):c!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,x,0,0,T.width,T.height,c,T.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const m=t.images;for(let v=0;v<6;v++){const x=fEe(m[v]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,0,0,r,s,c,u,x)}}else if(e.isDataArrayTexture||e.isArrayTexture){const m=t.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,c,u,m.data)}else if(e.isData3DTexture){const m=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,c,u,m.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(a,0,f,c,u,t.image);else{const m=fEe(t.image);n.texSubImage2D(a,0,0,0,r,s,c,u,m)}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:r,glTextureType:s}=n.get(e);n.state.bindTexture(s,r),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const r=n.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const s in r.framebuffers)t.deleteFramebuffer(r.framebuffers[s]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let s=0;s<r.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(r.msaaRenderbuffers[s]);delete r.msaaRenderbuffers}}}destroyTexture(e){const{gl:t,backend:n}=this,{textureGPU:r,renderTarget:s}=n.get(e);this.deallocateRenderBuffers(s),t.deleteTexture(r),n.delete(e)}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){const{gl:a,backend:c}=this,{state:u}=this.backend,{textureGPU:f,glTextureType:m,glType:v,glFormat:x}=c.get(t);u.bindTexture(m,f);let T,P,R,M,O,C,L,Y,J;const z=e.isCompressedTexture?e.mipmaps[o]:e.image;if(n!==null)T=n.max.x-n.min.x,P=n.max.y-n.min.y,R=n.isBox3?n.max.z-n.min.z:1,M=n.min.x,O=n.min.y,C=n.isBox3?n.min.z:0;else{const je=Math.pow(2,-s);T=Math.floor(z.width*je),P=Math.floor(z.height*je),e.isDataArrayTexture||e.isArrayTexture?R=z.depth:e.isData3DTexture?R=Math.floor(z.depth*je):R=1,M=0,O=0,C=0}r!==null?(L=r.x,Y=r.y,J=r.z):(L=0,Y=0,J=0),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,t.unpackAlignment);const ne=a.getParameter(a.UNPACK_ROW_LENGTH),K=a.getParameter(a.UNPACK_IMAGE_HEIGHT),$=a.getParameter(a.UNPACK_SKIP_PIXELS),he=a.getParameter(a.UNPACK_SKIP_ROWS),Ce=a.getParameter(a.UNPACK_SKIP_IMAGES);a.pixelStorei(a.UNPACK_ROW_LENGTH,z.width),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,z.height),a.pixelStorei(a.UNPACK_SKIP_PIXELS,M),a.pixelStorei(a.UNPACK_SKIP_ROWS,O),a.pixelStorei(a.UNPACK_SKIP_IMAGES,C);const Pe=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isRenderTargetTexture||e.isDepthTexture){const je=c.get(e),ge=c.get(t),Xe=c.get(je.renderTarget),Fe=c.get(ge.renderTarget),Ne=Xe.framebuffers[je.cacheKey],tt=Fe.framebuffers[ge.cacheKey];u.bindFramebuffer(a.READ_FRAMEBUFFER,Ne),u.bindFramebuffer(a.DRAW_FRAMEBUFFER,tt);let mt=a.COLOR_BUFFER_BIT;e.isDepthTexture&&(mt=a.DEPTH_BUFFER_BIT),a.blitFramebuffer(M,O,T,P,L,Y,T,P,mt,a.NEAREST),u.bindFramebuffer(a.READ_FRAMEBUFFER,null),u.bindFramebuffer(a.DRAW_FRAMEBUFFER,null)}else Pe?e.isDataTexture||e.isData3DTexture?a.texSubImage3D(m,o,L,Y,J,T,P,R,x,v,z.data):t.isCompressedArrayTexture?a.compressedTexSubImage3D(m,o,L,Y,J,T,P,R,x,z.data):a.texSubImage3D(m,o,L,Y,J,T,P,R,x,v,z):e.isDataTexture?a.texSubImage2D(m,o,L,Y,T,P,x,v,z.data):e.isCompressedTexture?a.compressedTexSubImage2D(m,o,L,Y,z.width,z.height,x,z.data):a.texSubImage2D(m,o,L,Y,T,P,x,v,z);a.pixelStorei(a.UNPACK_ROW_LENGTH,ne),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,K),a.pixelStorei(a.UNPACK_SKIP_PIXELS,$),a.pixelStorei(a.UNPACK_SKIP_ROWS,he),a.pixelStorei(a.UNPACK_SKIP_IMAGES,Ce),o===0&&t.generateMipmaps&&a.generateMipmap(m),u.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:r}=this,{state:s}=this.backend,{textureGPU:o}=this.backend.get(e),{x:a,y:c,z:u,w:f}=n,m=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,v=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(m){const x=a!==0||c!==0;let T,P;if(e.isDepthTexture===!0?(T=r.DEPTH_BUFFER_BIT,P=r.DEPTH_ATTACHMENT,t.stencil&&(T|=r.STENCIL_BUFFER_BIT)):(T=r.COLOR_BUFFER_BIT,P=r.COLOR_ATTACHMENT0),x){const R=this.backend.get(t.renderTarget),M=R.framebuffers[t.getCacheKey()],O=R.msaaFrameBuffer;s.bindFramebuffer(r.DRAW_FRAMEBUFFER,M),s.bindFramebuffer(r.READ_FRAMEBUFFER,O);const C=v-c-f;r.blitFramebuffer(a,C,a+u,C+f,a,C,a+u,C+f,T,r.NEAREST),s.bindFramebuffer(r.READ_FRAMEBUFFER,M),s.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,a,C,u,f),s.unbindTexture()}else{const R=r.createFramebuffer();s.bindFramebuffer(r.DRAW_FRAMEBUFFER,R),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,P,r.TEXTURE_2D,o,0),r.blitFramebuffer(0,0,u,f,0,0,u,f,T,r.NEAREST),r.deleteFramebuffer(R)}}else s.bindTexture(r.TEXTURE_2D,o),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,a,v-f-c,u,f),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n,r=!1){const{gl:s}=this,o=t.renderTarget,{depthTexture:a,depthBuffer:c,stencilBuffer:u,width:f,height:m}=o;if(s.bindRenderbuffer(s.RENDERBUFFER,e),c&&!u){let v=s.DEPTH_COMPONENT24;r===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(s.RENDERBUFFER,o.samples,v,f,m):n>0?(a&&a.isDepthTexture&&a.type===s.FLOAT&&(v=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,n,v,f,m)):s.renderbufferStorage(s.RENDERBUFFER,v,f,m),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e)}else c&&u&&(n>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.DEPTH24_STENCIL8,f,m):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,f,m),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e))}async copyTextureToBuffer(e,t,n,r,s,o){const{backend:a,gl:c}=this,{textureGPU:u,glFormat:f,glType:m}=this.backend.get(e),v=c.createFramebuffer();c.bindFramebuffer(c.READ_FRAMEBUFFER,v);const x=e.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+o:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,x,u,0);const T=this._getTypedArrayType(m),P=this._getBytesPerTexel(m,f),M=r*s*P,O=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,O),c.bufferData(c.PIXEL_PACK_BUFFER,M,c.STREAM_READ),c.readPixels(t,n,r,s,f,m,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await a.utils._clientWaitAsync();const C=new T(M/T.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,O),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,C),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.deleteFramebuffer(v),C}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:n}=this;let r=0;if(e===n.UNSIGNED_BYTE&&(r=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(r=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(r=4),t===n.RGBA)return r*4;if(t===n.RGB)return r*3;if(t===n.ALPHA)return r}}function fEe(i){return i.isDataTexture?i.image.data:typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?i:i.data}class $5t{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class H5t{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const pEe={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class j5t{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:r,object:s,type:o,info:a,index:c}=this;c!==0?n.drawElements(r,t,o,e):n.drawArrays(r,e,t),a.update(s,t,1)}renderInstances(e,t,n){const{gl:r,mode:s,type:o,index:a,object:c,info:u}=this;n!==0&&(a!==0?r.drawElementsInstanced(s,t,o,e,n):r.drawArraysInstanced(s,e,t,n),u.update(c,t,n))}renderMultiDraw(e,t,n){const{extensions:r,mode:s,object:o,info:a}=this;if(n===0)return;const c=r.get("WEBGL_multi_draw");if(c===null)for(let u=0;u<n;u++)this.render(e[u],t[u]);else{this.index!==0?c.multiDrawElementsWEBGL(s,t,0,this.type,e,0,n):c.multiDrawArraysWEBGL(s,e,0,t,0,n);let u=0;for(let f=0;f<n;f++)u+=t[f];a.update(o,u,1)}}renderMultiDrawInstances(e,t,n,r){const{extensions:s,mode:o,object:a,info:c}=this;if(n===0)return;const u=s.get("WEBGL_multi_draw");if(u===null)for(let f=0;f<n;f++)this.renderInstances(e[f],t[f],r[f]);else{this.index!==0?u.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,r,0,n):u.multiDrawArraysInstancedWEBGL(o,e,0,t,0,r,0,n);let f=0;for(let m=0;m<n;m++)f+=t[m]*r[m];c.update(a,f,1)}}}class Pke{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.pendingResolve=!1}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class W5t extends Pke{constructor(e,t,n=2048){if(super(n),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){console.warn("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let r=0;r<this.maxQueries;r++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return Qc(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e.id,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(t==null||this.activeQuery!==null)return;const n=this.queries[t];if(n)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(r){console.error("Error in beginQuery:",r),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(n){console.error("Error in endQuery:",n),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=[];for(const[r,s]of this.queryStates)if(s==="ended"){const o=this.queries[r];e.push(this.resolveQuery(o))}if(e.length===0)return this.lastValue;const n=(await Promise.all(e)).reduce((r,s)=>r+s,0);return this.lastValue=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,n}catch(e){return console.error("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let n,r=!1;const s=()=>{n&&(clearTimeout(n),n=null)},o=c=>{r||(r=!0,s(),t(c))},a=()=>{if(this.isDisposed){o(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){o(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){n=setTimeout(a,1);return}const f=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(f)/1e6)}catch(c){console.error("Error checking query:",c),t(this.lastValue)}};a()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}const mEe=new mn;class gEe extends Rke{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.samples>0,alpha:!0,depth:e.depth,stencil:e.stencil},r=t.context!==void 0?t.context:e.domElement.getContext("webgl2",n);function s(o){o.preventDefault();const a={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(a)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=r,this.extensions=new $5t(this),this.capabilities=new H5t(this),this.attributeUtils=new U5t(this),this.textureUtils=new G5t(this),this.bufferRenderer=new j5t(this),this.state=new z5t(this),this.utils=new V5t(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return jl}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,n=null){const r=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:r.RGBA8}),n!==null){const s=e.stencilBuffer?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:s}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e.autoAllocateDepthBuffer===!0&&e.multiview===!1&&console.warn("THREE.WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e.autoAllocateDepthBuffer=!1}}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new W5t(this.gl,t,2048));const n=this.timestampQueryPool[t];n.allocateQueriesForContext(e)!==null&&n.beginQuery(e)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t].endQuery(e)}getContext(){return this.gl}beginRender(e){const{state:t}=this,n=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:s,height:o}=this.getDrawingBufferSize(mEe);t.viewport(0,0,s,o)}if(e.scissor){const{x:s,y:o,width:a,height:c}=e.scissorValue;t.scissor(s,e.height-c-o,a,c)}this.initTimestampQuery(e),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const r=e.occlusionQueryCount;r>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(r),n.occlusionQueryObjects=new Array(r),n.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,r=this.get(e),s=r.previousContext;n.resetVertexState();const o=e.occlusionQueryCount;o>0&&(o>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const a=e.textures;if(a!==null)for(let c=0;c<a.length;c++){const u=a[c];u.generateMipmaps&&this.generateMipmaps(u)}if(this._currentContext=s,e.textures!==null&&e.renderTarget){const c=this.get(e.renderTarget),{resolveDepthBuffer:u,samples:f}=e.renderTarget;if(f>0&&this._useMultisampledExtension(e.renderTarget)===!1){const m=c.framebuffers[e.getCacheKey()],v=t.COLOR_BUFFER_BIT,x=c.msaaFrameBuffer,T=e.textures;n.bindFramebuffer(t.READ_FRAMEBUFFER,x),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,m);for(let P=0;P<T.length;P++)if(e.scissor){const{x:R,y:M,width:O,height:C}=e.scissorValue,L=e.height-C-M;t.blitFramebuffer(R,L,R+O,L+C,R,L,R+O,L+C,v,t.NEAREST),this._supportsInvalidateFramebuffer===!0&&t.invalidateSubFramebuffer(t.READ_FRAMEBUFFER,c.invalidationArray,R,L,O,C)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,v,t.NEAREST),this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,c.invalidationArray)}else if(u===!1&&c.framebuffers){const m=c.framebuffers[e.getCacheKey()];n.bindFramebuffer(t.DRAW_FRAMEBUFFER,m),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,c.depthInvalidationArray)}}if(s!==null)if(this._setFramebuffer(s),s.viewport)this.updateViewport(s);else{const{width:c,height:u}=this.getDrawingBufferSize(mEe);n.viewport(0,0,c,u)}this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const s=new WeakSet,{gl:o}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const a=()=>{let c=0;for(let u=0;u<n.length;u++){const f=n[u];f!==null&&o.getQueryParameter(f,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(f,o.QUERY_RESULT)===0&&s.add(r[u]),n[u]=null,o.deleteQuery(f),c++)}c<n.length?requestAnimationFrame(a):t.occluded=s};a()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:r,width:s,height:o}=e.viewportValue;t.viewport(n,e.height-o-r,s,o)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n,r=null,s=!0){const{gl:o,renderer:a}=this;r===null&&(r={textures:null,clearColorValue:this.getClearColor()});let c=0;if(e&&(c|=o.COLOR_BUFFER_BIT),t&&(c|=o.DEPTH_BUFFER_BIT),n&&(c|=o.STENCIL_BUFFER_BIT),c!==0){let u;r.clearColorValue?u=r.clearColorValue:u=this.getClearColor();const f=a.getClearDepth(),m=a.getClearStencil();if(t&&this.state.setDepthMask(!0),r.textures===null)o.clearColor(u.r,u.g,u.b,u.a),o.clear(c);else{if(s&&this._setFramebuffer(r),e)for(let v=0;v<r.textures.length;v++)v===0?o.clearBufferfv(o.COLOR,v,[u.r,u.g,u.b,u.a]):o.clearBufferfv(o.COLOR,v,[0,0,0,1]);t&&n?o.clearBufferfi(o.DEPTH_STENCIL,0,f,m):t?o.clearBufferfv(o.DEPTH,0,[f]):n&&o.clearBufferiv(o.STENCIL,0,[m])}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,t,n,r){const{state:s,gl:o}=this;this.discard===!1&&(o.enable(o.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:a,transformBuffers:c,attributes:u}=this.get(r),f=this._getVaoKey(u),m=this.vaoCache[f];m===void 0?this._createVao(u):s.setVertexState(m),s.useProgram(a),this._bindUniforms(n);const v=this._getTransformFeedback(c);o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,v),o.beginTransformFeedback(o.POINTS),u[0].isStorageInstancedBufferAttribute?o.drawArraysInstanced(o.POINTS,0,1,t.count):o.drawArrays(o.POINTS,0,t.count),o.endTransformFeedback(),o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null);for(let x=0;x<c.length;x++){const T=c[x];T.pbo&&this.textureUtils.copyBufferToTexture(T.transformBuffer,T.pbo),T.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:n,material:r,context:s,hardwareClippingPlanes:o}=e,{programGPU:a}=this.get(n),{gl:c,state:u}=this,f=this.get(s),m=e.getDrawParameters();if(m===null)return;this._bindUniforms(e.getBindings());const v=t.isMesh&&t.matrixWorld.determinant()<0;u.setMaterial(r,v,o),u.useProgram(a);const x=this.get(e);let T=x.staticVao;if(T===void 0||x.geometryId!==e.geometry.id){const z=this._getVaoKey(e.getAttributes());if(T=this.vaoCache[z],T===void 0){let ne;({vaoGPU:T,staticVao:ne}=this._createVao(e.getAttributes())),ne&&(x.staticVao=T,x.geometryId=e.geometry.id)}}const P=e.getIndex(),R=P!==null?this.get(P).bufferGPU:null;u.setVertexState(T,R);const M=f.lastOcclusionObject;if(M!==t&&M!==void 0){if(M!==null&&M.occlusionTest===!0&&(c.endQuery(c.ANY_SAMPLES_PASSED),f.occlusionQueryIndex++),t.occlusionTest===!0){const z=c.createQuery();c.beginQuery(c.ANY_SAMPLES_PASSED,z),f.occlusionQueries[f.occlusionQueryIndex]=z,f.occlusionQueryObjects[f.occlusionQueryIndex]=t}f.lastOcclusionObject=t}const O=this.bufferRenderer;t.isPoints?O.mode=c.POINTS:t.isLineSegments?O.mode=c.LINES:t.isLine?O.mode=c.LINE_STRIP:t.isLineLoop?O.mode=c.LINE_LOOP:r.wireframe===!0?(u.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),O.mode=c.LINES):O.mode=c.TRIANGLES;const{vertexCount:C,instanceCount:L}=m;let{firstVertex:Y}=m;if(O.object=t,P!==null){Y*=P.array.BYTES_PER_ELEMENT;const z=this.get(P);O.index=P.count,O.type=z.type}else O.index=0;const J=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(Qc("THREE.WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),O.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?O.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):Qc("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):L>1?O.renderInstances(Y,C,L):O.render(Y,C)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const z=this.get(e.camera),ne=e.camera.cameras,K=e.getBindingGroup("cameraIndex").bindings[0];if(z.indexesGPU===void 0||z.indexesGPU.length!==ne.length){const ge=new Uint32Array([0,0,0,0]),Xe=[];for(let Fe=0,Ne=ne.length;Fe<Ne;Fe++){const tt=c.createBuffer();ge[0]=Fe,c.bindBuffer(c.UNIFORM_BUFFER,tt),c.bufferData(c.UNIFORM_BUFFER,ge,c.STATIC_DRAW),Xe.push(tt)}z.indexesGPU=Xe}const $=this.get(K),he=this.renderer.getPixelRatio(),Ce=this._currentContext.renderTarget,Pe=this._isRenderCameraDepthArray(this._currentContext),je=this._currentContext.activeCubeFace;if(Pe){const ge=this.get(Ce.depthTexture);if(ge.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){ge.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:Xe}=Ce;for(let Fe=0,Ne=ne.length;Fe<Ne;Fe++)this.renderer._activeCubeFace=Fe,this._currentContext.activeCubeFace=Fe,this._setFramebuffer(this._currentContext),this.clear(!1,!0,Xe,this._currentContext,!1);this.renderer._activeCubeFace=je,this._currentContext.activeCubeFace=je}}for(let ge=0,Xe=ne.length;ge<Xe;ge++){const Fe=ne[ge];if(t.layers.test(Fe.layers)){Pe&&(this.renderer._activeCubeFace=ge,this._currentContext.activeCubeFace=ge,this._setFramebuffer(this._currentContext));const Ne=Fe.viewport;if(Ne!==void 0){const tt=Ne.x*he,mt=Ne.y*he,Ht=Ne.width*he,pn=Ne.height*he;u.viewport(Math.floor(tt),Math.floor(e.context.height-pn-mt),Math.floor(Ht),Math.floor(pn))}u.bindBufferBase(c.UNIFORM_BUFFER,$.index,z.indexesGPU[ge]),J()}this._currentContext.activeCubeFace=je,this.renderer._activeCubeFace=je}}else J()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,r,s,o){return this.textureUtils.copyTextureToBuffer(e,t,n,r,s,o)}createSampler(){}destroySampler(){}createNodeBuilder(e,t){return new O5t(e,t)}createProgram(e){const t=this.gl,{stage:n,code:r}=e,s=n==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,r),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,r=e.pipeline,{fragmentProgram:s,vertexProgram:o}=r,a=n.createProgram(),c=this.get(s).shaderGPU,u=this.get(o).shaderGPU;if(n.attachShader(a,c),n.attachShader(a,u),n.linkProgram(a),this.set(r,{programGPU:a,fragmentShader:c,vertexShader:u}),t!==null&&this.parallel){const f=new Promise(m=>{const v=this.parallel,x=()=>{n.getProgramParameter(a,v.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),m()):requestAnimationFrame(x)};x()});t.push(f);return}this._completeCompile(e,r)}_handleSource(e,t){const n=e.split(`
`),r=[],s=Math.max(t-6,0),o=Math.min(t+6,n.length);for(let a=s;a<o;a++){const c=a+1;r.push(`${c===t?">":" "} ${c}: ${n[a]}`)}return r.join(`
`)}_getShaderErrors(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),s=e.getShaderInfoLog(t).trim();if(r&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const a=parseInt(o[1]);return n.toUpperCase()+`

`+s+`

`+this._handleSource(e.getShaderSource(t),a)}else return s}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const r=this.gl,s=r.getProgramInfoLog(e).trim();if(r.getProgramParameter(e,r.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(r,e,n,t);else{const o=this._getShaderErrors(r,n,"vertex"),a=this._getShaderErrors(r,t,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(e,r.VALIDATE_STATUS)+`

Program Info Log: `+s+`
`+o+`
`+a)}else s!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",s)}}_completeCompile(e,t){const{state:n,gl:r}=this,s=this.get(t),{programGPU:o,fragmentShader:a,vertexShader:c}=s;r.getProgramParameter(o,r.LINK_STATUS)===!1&&this._logProgramError(o,a,c),n.useProgram(o);const u=e.getBindings();this._setupBindings(u,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:n,gl:r}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:o}=e,a=r.createProgram(),c=this.get(s).shaderGPU,u=this.get(o).shaderGPU,f=o.transforms,m=[],v=[];for(let R=0;R<f.length;R++){const M=f[R];m.push(M.varyingName),v.push(M.attributeNode)}r.attachShader(a,c),r.attachShader(a,u),r.transformFeedbackVaryings(a,m,r.SEPARATE_ATTRIBS),r.linkProgram(a),r.getProgramParameter(a,r.LINK_STATUS)===!1&&this._logProgramError(a,c,u),n.useProgram(a),this._setupBindings(t,a);const x=o.attributes,T=[],P=[];for(let R=0;R<x.length;R++){const M=x[R].node.attribute;T.push(M),this.has(M)||this.attributeUtils.createAttribute(M,r.ARRAY_BUFFER)}for(let R=0;R<v.length;R++){const M=v[R].attribute;this.has(M)||this.attributeUtils.createAttribute(M,r.ARRAY_BUFFER);const O=this.get(M);P.push(O)}this.set(e,{programGPU:a,transformBuffers:P,attributes:T})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let n=0,r=0;for(const s of t){this.set(s,{textures:r,uniformBuffers:n});for(const o of s.bindings)o.isUniformBuffer&&n++,o.isSampledTexture&&r++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let r=n.uniformBuffers,s=n.textures;for(const o of e.bindings)if(o.isUniformsGroup||o.isUniformBuffer){const a=o.buffer,c=t.createBuffer();t.bindBuffer(t.UNIFORM_BUFFER,c),t.bufferData(t.UNIFORM_BUFFER,a,t.DYNAMIC_DRAW),this.set(o,{index:r++,bufferGPU:c})}else if(o.isSampledTexture){const{textureGPU:a,glTextureType:c}=this.get(o.texture);this.set(o,{index:s++,textureGPU:a,glTextureType:c})}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const r=this.get(e).bufferGPU,s=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(pEe).filter(r=>pEe[r]===e),n=this.extensions;for(let r=0;r<t.length;r++)if(n.has(t[r]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){this.textureUtils.copyTextureToTexture(e,t,n,r,s,o)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){const{gl:t,state:n}=this;let r=null;if(e.textures!==null){const s=e.renderTarget,o=this.get(s),{samples:a,depthBuffer:c,stencilBuffer:u}=s,f=s.isWebGLCubeRenderTarget===!0,m=s.isRenderTarget3D===!0,v=s.depth>1,x=s.isXRRenderTarget===!0,T=x===!0&&s.hasExternalTextures===!0;let P=o.msaaFrameBuffer,R=o.depthRenderbuffer;const M=this.extensions.get("WEBGL_multisampled_render_to_texture"),O=this.extensions.get("OVR_multiview2"),C=this._useMultisampledExtension(s),L=cke(e);let Y;if(f?(o.cubeFramebuffers||(o.cubeFramebuffers={}),Y=o.cubeFramebuffers[L]):x&&T===!1?Y=this._xrFramebuffer:(o.framebuffers||(o.framebuffers={}),Y=o.framebuffers[L]),Y===void 0){Y=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,Y);const J=e.textures,z=[];if(f){o.cubeFramebuffers[L]=Y;const{textureGPU:K}=this.get(J[0]),$=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+$,K,0)}else{o.framebuffers[L]=Y;for(let K=0;K<J.length;K++){const $=J[K],he=this.get($);he.renderTarget=e.renderTarget,he.cacheKey=L;const Ce=t.COLOR_ATTACHMENT0+K;if(s.multiview)O.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,Ce,he.textureGPU,0,a,0,2);else if(m||v){const Pe=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,Ce,he.textureGPU,0,Pe)}else C?M.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,Ce,t.TEXTURE_2D,he.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,Ce,t.TEXTURE_2D,he.textureGPU,0)}n.drawBuffers(e,Y)}const ne=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s.autoAllocateDepthBuffer===!0){const K=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(K,e,0,C),o.xrDepthRenderbuffer=K,z.push(u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,K),t.framebufferRenderbuffer(t.FRAMEBUFFER,ne,t.RENDERBUFFER,K)}else if(e.depthTexture!==null){z.push(u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const K=this.get(e.depthTexture);if(K.renderTarget=e.renderTarget,K.cacheKey=L,s.multiview)O.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,ne,K.textureGPU,0,a,0,2);else if(T&&C)M.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,ne,t.TEXTURE_2D,K.textureGPU,0,a);else if(e.depthTexture.isArrayTexture){const $=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,ne,K.textureGPU,0,$)}else t.framebufferTexture2D(t.FRAMEBUFFER,ne,t.TEXTURE_2D,K.textureGPU,0)}o.depthInvalidationArray=z}else{if(this._isRenderCameraDepthArray(e)){n.bindFramebuffer(t.FRAMEBUFFER,Y);const z=this.renderer._activeCubeFace,ne=this.get(e.depthTexture),K=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,K,ne.textureGPU,0,z)}if(x||C||s.multiview){n.bindFramebuffer(t.FRAMEBUFFER,Y);const z=this.get(e.textures[0]);s.multiview?O.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,z.textureGPU,0,a,0,2):C?M.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,z.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,z.textureGPU,0);const ne=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s.autoAllocateDepthBuffer===!0){const K=o.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,K),t.framebufferRenderbuffer(t.FRAMEBUFFER,ne,t.RENDERBUFFER,K)}else{const K=this.get(e.depthTexture);s.multiview?O.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,ne,K.textureGPU,0,a,0,2):C?M.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,ne,t.TEXTURE_2D,K.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,ne,t.TEXTURE_2D,K.textureGPU,0)}}}if(a>0&&C===!1&&!s.multiview){if(P===void 0){const J=[];P=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,P);const z=[],ne=e.textures;for(let K=0;K<ne.length;K++){if(z[K]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,z[K]),J.push(t.COLOR_ATTACHMENT0+K),c){const Ce=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;J.push(Ce)}const $=e.textures[K],he=this.get($);t.renderbufferStorageMultisample(t.RENDERBUFFER,a,he.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+K,t.RENDERBUFFER,z[K])}if(o.msaaFrameBuffer=P,o.msaaRenderbuffers=z,R===void 0){R=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(R,e,a),o.depthRenderbuffer=R;const K=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;J.push(K)}o.invalidationArray=J}r=o.msaaFrameBuffer}else r=Y}n.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){const r=this.get(e[n]);t+=":"+r.id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();let r="",s=!0;t.bindVertexArray(n);for(let o=0;o<e.length;o++){const a=e[o],c=this.get(a);r+=":"+c.id,t.bindBuffer(t.ARRAY_BUFFER,c.bufferGPU),t.enableVertexAttribArray(o),(a.isStorageBufferAttribute||a.isStorageInstancedBufferAttribute)&&(s=!1);let u,f;a.isInterleavedBufferAttribute===!0?(u=a.data.stride*c.bytesPerElement,f=a.offset*c.bytesPerElement):(u=0,f=0),c.isInteger?t.vertexAttribIPointer(o,a.itemSize,c.type,u,f):t.vertexAttribPointer(o,a.itemSize,c.type,a.normalized,u,f),a.isInstancedBufferAttribute&&!a.isInterleavedBufferAttribute?t.vertexAttribDivisor(o,a.meshPerAttribute):a.isInterleavedBufferAttribute&&a.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(o,a.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),this.vaoCache[r]=n,{vaoGPU:n,staticVao:s}}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let n=this.transformFeedbackCache[t];if(n!==void 0)return n;const{gl:r}=this;n=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n);for(let s=0;s<e.length;s++){const o=e[s];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,s,o.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const r of e)for(const s of r.bindings){const a=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const c=n.getUniformBlockIndex(t,s.name);n.uniformBlockBinding(t,c,a)}else if(s.isSampledTexture){const c=n.getUniformLocation(t,s.name);n.uniform1i(c,a)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const r of e)for(const s of r.bindings){const o=this.get(s),a=o.index;s.isUniformsGroup||s.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,a,o.bufferGPU):s.isSampledTexture&&n.bindTexture(o.glTextureType,o.textureGPU,t.TEXTURE0+a)}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e.autoAllocateDepthBuffer!==!1}dispose(){const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const Y6={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},fl={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},T0={Store:"store"},Wi={Load:"load",Clear:"clear"},TJ={CCW:"ccw"},EJ={None:"none",Front:"front",Back:"back"},cx={Uint16:"uint16",Uint32:"uint32"},Ve={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},MJ={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Gy={Linear:"linear",Nearest:"nearest"},zr={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},vy={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},yEe={None:0,All:15},a2={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},CJ={Storage:"storage",ReadOnlyStorage:"read-only-storage"},AJ={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},vEe={NonFiltering:"non-filtering",Comparison:"comparison"},_y={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},_Ee={TwoD:"2d",ThreeD:"3d"},Wa={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},q5t={All:"all"},SB={Vertex:"vertex",Instance:"instance"},Vte={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class X5t extends lse{constructor(e,t){super(e),this.texture=t,this.version=t?t.version:0,this.isSampler=!0}}class Y5t extends X5t{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){this.texture=this.textureNode.value}}class K5t extends wke{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let Z5t=0;class Q5t extends K5t{constructor(e,t){super("StorageBuffer_"+Z5t++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:A1.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class J5t extends o3{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,n=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Gy.Linear}),this.flipYSampler=e.createSampler({minFilter:Gy.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:n}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:r})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Y6.TriangleStrip,stripIndexFormat:cx.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Y6.TriangleStrip,stripIndexFormat:cx.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,n=0){const r=t.format,{width:s,height:o}=t.size,a=this.getTransferPipeline(r),c=this.getFlipYPipeline(r),u=this.device.createTexture({size:{width:s,height:o,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),f=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Wa.TwoD,baseArrayLayer:n}),m=u.createView({baseMipLevel:0,mipLevelCount:1,dimension:Wa.TwoD,baseArrayLayer:0}),v=this.device.createCommandEncoder({}),x=(T,P,R)=>{const M=T.getBindGroupLayout(0),O=this.device.createBindGroup({layout:M,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:P}]}),C=v.beginRenderPass({colorAttachments:[{view:R,loadOp:Wi.Clear,storeOp:T0.Store,clearValue:[0,0,0,0]}]});C.setPipeline(T),C.setBindGroup(0,O),C.draw(4,1,0,0),C.end()};x(a,f,m),x(c,m,f),this.device.queue.submit([v.finish()]),u.destroy()}generateMipmaps(e,t,n=0){const r=this.get(e);r.useCount===void 0&&(r.useCount=0,r.layers=[]);const s=r.layers[n]||this._mipmapCreateBundles(e,t,n),o=this.device.createCommandEncoder({});this._mipmapRunBundles(o,s),this.device.queue.submit([o.finish()]),r.useCount!==0&&(r.layers[n]=s),r.useCount++}_mipmapCreateBundles(e,t,n){const r=this.getTransferPipeline(t.format),s=r.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Wa.TwoD,baseArrayLayer:n});const a=[];for(let c=1;c<t.mipLevelCount;c++){const u=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),f=e.createView({baseMipLevel:c,mipLevelCount:1,dimension:Wa.TwoD,baseArrayLayer:n}),m={colorAttachments:[{view:f,loadOp:Wi.Clear,storeOp:T0.Store,clearValue:[0,0,0,0]}]},v=this.device.createRenderBundleEncoder({colorFormats:[t.format]});v.setPipeline(r),v.setBindGroup(0,u),v.draw(4,1,0,0),a.push({renderBundles:[v.finish()],passDescriptor:m}),o=f}return a}_mipmapRunBundles(e,t){const n=t.length;for(let r=0;r<n;r++){const s=t[r],o=e.beginRenderPass(s.passDescriptor);o.executeBundles(s.renderBundles),o.end()}}}const evt={[ere]:"never",[VU]:"less",[tre]:"equal",[GU]:"less-equal",[nre]:"greater",[ire]:"greater-equal",[sre]:"always",[rre]:"not-equal"},tvt=[0,1,3,2,4,5];class nvt{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new Jc,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,n=t.device,r=t.get(e),s={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};s.magFilter===Gy.Linear&&s.minFilter===Gy.Linear&&s.mipmapFilter===Gy.Linear&&(s.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(s.compare=evt[e.compareFunction]),r.sampler=n.createSampler(s)}createDefaultTexture(e){let t;const n=Gte(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(n):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():t=this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e,t={}){const n=this.backend,r=n.get(e);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:o,depth:a,levels:c}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const u=this._getDimension(e),f=e.internalFormat||t.format||Gte(e,n.device);r.format=f;const{samples:m,primarySamples:v,isMSAA:x}=n.utils.getTextureSampleData(e);let T=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(T|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&(T|=GPUTextureUsage.RENDER_ATTACHMENT);const P={label:e.name,size:{width:s,height:o,depthOrArrayLayers:a},mipLevelCount:c,sampleCount:v,dimension:u,format:f,usage:T};if(e.isVideoTexture){const R=e.source.data,M=new VideoFrame(R);P.size.width=M.displayWidth,P.size.height=M.displayHeight,M.close(),r.externalTexture=R}else{if(f===void 0){console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}e.isCubeTexture&&(P.textureBindingViewDimension=Wa.Cube),r.texture=n.device.createTexture(P)}if(x){const R=Object.assign({},P);R.label=R.label+"-msaa",R.sampleCount=m,r.msaaTexture=n.device.createTexture(R)}r.initialized=!0,r.textureDescriptorGPU=P}destroyTexture(e){const t=this.backend,n=t.get(e);n.texture!==void 0&&n.texture.destroy(),n.msaaTexture!==void 0&&n.msaaTexture.destroy(),t.delete(e)}destroySampler(e){const n=this.backend.get(e);delete n.sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let n=0;n<6;n++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,n);else{const n=e.image.depth||1;for(let r=0;r<n;r++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,r)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:n}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:n,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,t=!1){const n=this.backend,{width:r,height:s}=n.getDrawingBufferSize(),o=this.depthTexture,a=n.get(o).texture;let c,u;if(t?(c=mc,u=pc):e&&(c=Zc,u=fs),a!==void 0){if(o.image.width===r&&o.image.height===s&&o.format===c&&o.type===u)return a;this.destroyTexture(o)}return o.name="depthBuffer",o.format=c,o.type=u,o.image.width=r,o.image.height=s,this.createTexture(o,{width:r,height:s}),n.get(o).texture}updateTexture(e,t){const n=this.backend.get(e),{textureDescriptorGPU:r}=n;if(!(e.isRenderTargetTexture||r===void 0)){if(e.isDataTexture)this._copyBufferToTexture(t.image,n.texture,r,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let s=0;s<t.image.depth;s++)this._copyBufferToTexture(t.image,n.texture,r,s,e.flipY,s);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,r);else if(e.isCubeTexture)this._copyCubeMapToTexture(t.images,n.texture,r,e.flipY,e.premultiplyAlpha);else if(e.isVideoTexture){const s=e.source.data;n.externalTexture=s}else this._copyImageToTexture(t.image,n.texture,r,0,e.flipY,e.premultiplyAlpha);n.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,t,n,r,s,o){const a=this.backend.device,c=this.backend.get(e),u=c.texture,f=c.textureDescriptorGPU.format,m=this._getBytesPerTexel(f);let v=r*m;v=Math.ceil(v/256)*256;const x=a.createBuffer({size:r*s*m,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),T=a.createCommandEncoder();T.copyTextureToBuffer({texture:u,origin:{x:t,y:n,z:o}},{buffer:x,bytesPerRow:v},{width:r,height:s});const P=this._getTypedArrayType(f);a.queue.submit([T.finish()]),await x.mapAsync(GPUMapMode.READ);const R=x.getMappedRange();return new P(R)}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new Ao;n.minFilter=es,n.magFilter=es,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new vx;n.minFilter=es,n.magFilter=es,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(e===null){const t={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),t)}return e}_copyCubeMapToTexture(e,t,n,r,s){for(let o=0;o<6;o++){const a=e[o],c=r===!0?tvt[o]:o;a.isDataTexture?this._copyBufferToTexture(a.image,t,n,c,r):this._copyImageToTexture(a,t,n,c,r,s)}}_copyImageToTexture(e,t,n,r,s,o){this.backend.device.queue.copyExternalImageToTexture({source:e,flipY:s},{texture:t,mipLevel:0,origin:{x:0,y:0,z:r},premultipliedAlpha:o},{width:e.width,height:e.height,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new J5t(this.backend.device)),e}_generateMipmaps(e,t,n=0){this._getPassUtils().generateMipmaps(e,t,n)}_flipY(e,t,n=0){this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,r,s,o=0){const a=this.backend.device,c=e.data,u=this._getBytesPerTexel(n.format),f=e.width*u;a.queue.writeTexture({texture:t,mipLevel:0,origin:{x:0,y:0,z:r}},c,{offset:e.width*e.height*u*o,bytesPerRow:f},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,n,r)}_copyCompressedBufferToTexture(e,t,n){const r=this.backend.device,s=this._getBlockData(n.format),o=n.size.depthOrArrayLayers>1;for(let a=0;a<e.length;a++){const c=e[a],u=c.width,f=c.height,m=o?n.size.depthOrArrayLayers:1,v=Math.ceil(u/s.width)*s.byteLength,x=v*Math.ceil(f/s.height);for(let T=0;T<m;T++)r.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:T}},c.data,{offset:T*x,bytesPerRow:v,rowsPerImage:Math.ceil(f/s.height)},{width:Math.ceil(u/s.width)*s.width,height:Math.ceil(f/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===Ve.BC1RGBAUnorm||e===Ve.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===Ve.BC2RGBAUnorm||e===Ve.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===Ve.BC3RGBAUnorm||e===Ve.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===Ve.BC4RUnorm||e===Ve.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===Ve.BC5RGUnorm||e===Ve.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===Ve.BC6HRGBUFloat||e===Ve.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===Ve.BC7RGBAUnorm||e===Ve.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===Ve.ETC2RGB8Unorm||e===Ve.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===Ve.ETC2RGB8A1Unorm||e===Ve.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===Ve.ETC2RGBA8Unorm||e===Ve.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===Ve.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===Ve.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===Ve.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===Ve.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===Ve.ASTC4x4Unorm||e===Ve.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===Ve.ASTC5x4Unorm||e===Ve.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===Ve.ASTC5x5Unorm||e===Ve.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===Ve.ASTC6x5Unorm||e===Ve.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===Ve.ASTC6x6Unorm||e===Ve.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===Ve.ASTC8x5Unorm||e===Ve.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===Ve.ASTC8x6Unorm||e===Ve.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===Ve.ASTC8x8Unorm||e===Ve.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===Ve.ASTC10x5Unorm||e===Ve.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===Ve.ASTC10x6Unorm||e===Ve.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===Ve.ASTC10x8Unorm||e===Ve.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===Ve.ASTC10x10Unorm||e===Ve.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===Ve.ASTC12x10Unorm||e===Ve.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===Ve.ASTC12x12Unorm||e===Ve.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=MJ.ClampToEdge;return e===tu?t=MJ.Repeat:e===x4&&(t=MJ.MirrorRepeat),t}_convertFilterMode(e){let t=Gy.Linear;return(e===es||e===Kne||e===T1)&&(t=Gy.Nearest),t}_getBytesPerTexel(e){if(e===Ve.R8Unorm||e===Ve.R8Snorm||e===Ve.R8Uint||e===Ve.R8Sint)return 1;if(e===Ve.R16Uint||e===Ve.R16Sint||e===Ve.R16Float||e===Ve.RG8Unorm||e===Ve.RG8Snorm||e===Ve.RG8Uint||e===Ve.RG8Sint)return 2;if(e===Ve.R32Uint||e===Ve.R32Sint||e===Ve.R32Float||e===Ve.RG16Uint||e===Ve.RG16Sint||e===Ve.RG16Float||e===Ve.RGBA8Unorm||e===Ve.RGBA8UnormSRGB||e===Ve.RGBA8Snorm||e===Ve.RGBA8Uint||e===Ve.RGBA8Sint||e===Ve.BGRA8Unorm||e===Ve.BGRA8UnormSRGB||e===Ve.RGB9E5UFloat||e===Ve.RGB10A2Unorm||e===Ve.RG11B10UFloat||e===Ve.Depth32Float||e===Ve.Depth24Plus||e===Ve.Depth24PlusStencil8||e===Ve.Depth32FloatStencil8)return 4;if(e===Ve.RG32Uint||e===Ve.RG32Sint||e===Ve.RG32Float||e===Ve.RGBA16Uint||e===Ve.RGBA16Sint||e===Ve.RGBA16Float)return 8;if(e===Ve.RGBA32Uint||e===Ve.RGBA32Sint||e===Ve.RGBA32Float)return 16}_getTypedArrayType(e){if(e===Ve.R8Uint)return Uint8Array;if(e===Ve.R8Sint)return Int8Array;if(e===Ve.R8Unorm)return Uint8Array;if(e===Ve.R8Snorm)return Int8Array;if(e===Ve.RG8Uint)return Uint8Array;if(e===Ve.RG8Sint)return Int8Array;if(e===Ve.RG8Unorm)return Uint8Array;if(e===Ve.RG8Snorm)return Int8Array;if(e===Ve.RGBA8Uint)return Uint8Array;if(e===Ve.RGBA8Sint)return Int8Array;if(e===Ve.RGBA8Unorm)return Uint8Array;if(e===Ve.RGBA8Snorm)return Int8Array;if(e===Ve.R16Uint)return Uint16Array;if(e===Ve.R16Sint)return Int16Array;if(e===Ve.RG16Uint)return Uint16Array;if(e===Ve.RG16Sint)return Int16Array;if(e===Ve.RGBA16Uint)return Uint16Array;if(e===Ve.RGBA16Sint)return Int16Array;if(e===Ve.R16Float||e===Ve.RG16Float||e===Ve.RGBA16Float)return Uint16Array;if(e===Ve.R32Uint)return Uint32Array;if(e===Ve.R32Sint)return Int32Array;if(e===Ve.R32Float)return Float32Array;if(e===Ve.RG32Uint)return Uint32Array;if(e===Ve.RG32Sint)return Int32Array;if(e===Ve.RG32Float)return Float32Array;if(e===Ve.RGBA32Uint)return Uint32Array;if(e===Ve.RGBA32Sint)return Int32Array;if(e===Ve.RGBA32Float)return Float32Array;if(e===Ve.BGRA8Unorm||e===Ve.BGRA8UnormSRGB)return Uint8Array;if(e===Ve.RGB10A2Unorm||e===Ve.RGB9E5UFloat||e===Ve.RG11B10UFloat)return Uint32Array;if(e===Ve.Depth32Float)return Float32Array;if(e===Ve.Depth24Plus||e===Ve.Depth24PlusStencil8)return Uint32Array;if(e===Ve.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.isData3DTexture?t=_Ee.ThreeD:t=_Ee.TwoD,t}}function Gte(i,e=null){const t=i.format,n=i.type,r=i.colorSpace,s=rr.getTransfer(r);let o;if(i.isCompressedTexture===!0||i.isCompressedArrayTexture===!0)switch(t){case D2:o=s===zn?Ve.BC1RGBAUnormSRGB:Ve.BC1RGBAUnorm;break;case F2:o=s===zn?Ve.BC2RGBAUnormSRGB:Ve.BC2RGBAUnorm;break;case O2:o=s===zn?Ve.BC3RGBAUnormSRGB:Ve.BC3RGBAUnorm;break;case C_:o=s===zn?Ve.ETC2RGB8UnormSRGB:Ve.ETC2RGB8Unorm;break;case A_:o=s===zn?Ve.ETC2RGBA8UnormSRGB:Ve.ETC2RGBA8Unorm;break;case R_:o=s===zn?Ve.ASTC4x4UnormSRGB:Ve.ASTC4x4Unorm;break;case P_:o=s===zn?Ve.ASTC5x4UnormSRGB:Ve.ASTC5x4Unorm;break;case N_:o=s===zn?Ve.ASTC5x5UnormSRGB:Ve.ASTC5x5Unorm;break;case I_:o=s===zn?Ve.ASTC6x5UnormSRGB:Ve.ASTC6x5Unorm;break;case k_:o=s===zn?Ve.ASTC6x6UnormSRGB:Ve.ASTC6x6Unorm;break;case D_:o=s===zn?Ve.ASTC8x5UnormSRGB:Ve.ASTC8x5Unorm;break;case F_:o=s===zn?Ve.ASTC8x6UnormSRGB:Ve.ASTC8x6Unorm;break;case O_:o=s===zn?Ve.ASTC8x8UnormSRGB:Ve.ASTC8x8Unorm;break;case B_:o=s===zn?Ve.ASTC10x5UnormSRGB:Ve.ASTC10x5Unorm;break;case L_:o=s===zn?Ve.ASTC10x6UnormSRGB:Ve.ASTC10x6Unorm;break;case U_:o=s===zn?Ve.ASTC10x8UnormSRGB:Ve.ASTC10x8Unorm;break;case z_:o=s===zn?Ve.ASTC10x10UnormSRGB:Ve.ASTC10x10Unorm;break;case V_:o=s===zn?Ve.ASTC12x10UnormSRGB:Ve.ASTC12x10Unorm;break;case G_:o=s===zn?Ve.ASTC12x12UnormSRGB:Ve.ASTC12x12Unorm;break;case xs:o=s===zn?Ve.RGBA8UnormSRGB:Ve.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case xs:switch(n){case e4:o=Ve.RGBA8Snorm;break;case t4:o=Ve.RGBA16Sint;break;case _d:o=Ve.RGBA16Uint;break;case fs:o=Ve.RGBA32Uint;break;case qa:o=Ve.RGBA32Sint;break;case ps:o=s===zn?Ve.RGBA8UnormSRGB:Ve.RGBA8Unorm;break;case Aa:o=Ve.RGBA16Float;break;case Ys:o=Ve.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case iC:switch(n){case zU:o=Ve.RGB9E5UFloat;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case sC:switch(n){case e4:o=Ve.R8Snorm;break;case t4:o=Ve.R16Sint;break;case _d:o=Ve.R16Uint;break;case fs:o=Ve.R32Uint;break;case qa:o=Ve.R32Sint;break;case ps:o=Ve.R8Unorm;break;case Aa:o=Ve.R16Float;break;case Ys:o=Ve.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case E1:switch(n){case e4:o=Ve.RG8Snorm;break;case t4:o=Ve.RG16Sint;break;case _d:o=Ve.RG16Uint;break;case fs:o=Ve.RG32Uint;break;case qa:o=Ve.RG32Sint;break;case ps:o=Ve.RG8Unorm;break;case Aa:o=Ve.RG16Float;break;case Ys:o=Ve.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case Zc:switch(n){case _d:o=Ve.Depth16Unorm;break;case fs:o=Ve.Depth24Plus;break;case Ys:o=Ve.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case mc:switch(n){case pc:o=Ve.Depth24PlusStencil8;break;case Ys:e&&e.features.has(Vte.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=Ve.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case px:switch(n){case qa:o=Ve.R32Sint;break;case fs:o=Ve.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case mx:switch(n){case qa:o=Ve.RG32Sint;break;case fs:o=Ve.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case gx:switch(n){case qa:o=Ve.RGBA32Sint;break;case fs:o=Ve.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}return o}const rvt=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,ivt=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,xEe={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},svt=i=>{i=i.trim();const e=i.match(rvt);if(e!==null&&e.length===4){const t=e[2],n=[];let r=null;for(;(r=ivt.exec(t))!==null;)n.push({name:r[1],type:r[2]});const s=[];for(let f=0;f<n.length;f++){const{name:m,type:v}=n[f];let x=v;x.startsWith("ptr")?x="pointer":(x.startsWith("texture")&&(x=v.split("<")[0]),x=xEe[x]),s.push(new sse(x,m))}const o=i.substring(e[0].length),a=e[3]||"void",c=e[1]!==void 0?e[1]:"";return{type:xEe[a]||a,inputs:s,name:c,inputsCode:t,blockCode:o,outputType:a}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class ovt extends ase{constructor(e){const{type:t,inputs:n,name:r,inputsCode:s,blockCode:o,outputType:a}=svt(e);super(t,n,r),this.inputsCode=s,this.blockCode=o,this.outputType=a}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class avt extends bke{parseFunction(e){return new ovt(e)}}const y6=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},lvt={[A1.READ_ONLY]:"read",[A1.WRITE_ONLY]:"write",[A1.READ_WRITE]:"read_write"},bEe={[tu]:"repeat",[ta]:"clamp",[x4]:"mirror"},wB={vertex:y6?y6.VERTEX:1,fragment:y6?y6.FRAGMENT:2,compute:y6?y6.COMPUTE:4},SEe={instance:!0,swizzleAssign:!1,storageBuffer:!0},cvt={"^^":"tsl_xor"},uvt={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},wEe={},zu={tsl_xor:new wa("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new wa("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new wa("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new wa("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new wa("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new wa("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new wa("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new wa("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new wa("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new wa("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new wa("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new wa("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new wa(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},xE={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};typeof navigator<"u"&&/Windows/g.test(navigator.userAgent)&&(zu.pow_float=new wa("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),zu.pow_vec2=new wa("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[zu.pow_float]),zu.pow_vec3=new wa("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[zu.pow_float]),zu.pow_vec4=new wa("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[zu.pow_float]),xE.pow_float="tsl_pow_float",xE.pow_vec2="tsl_pow_vec2",xE.pow_vec3="tsl_pow_vec3",xE.pow_vec4="tsl_pow_vec4");let Nke="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(Nke+=`diagnostic( off, derivative_uniformity );
`);class hvt extends xke{constructor(e,t){super(e,t,new avt),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Xa}_generateTextureSample(e,t,n,r,s=this.shaderStage){return s==="fragment"?r?`textureSample( ${t}, ${t}_sampler, ${n}, ${r} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this._generateTextureSampleLevel(e,t,n,"0",r)}_generateVideoSample(e,t,n=this.shaderStage){if(n==="fragment")return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${t}.x, 1.0 - ${t}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${n} shader.`)}_generateTextureSampleLevel(e,t,n,r,s){return this.isUnfilterable(e)===!1?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,r):this.generateTextureLod(e,t,n,s,r)}generateWrapFunction(e){const t=`tsl_coord_${bEe[e.wrapS]}S_${bEe[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let n=wEe[t];if(n===void 0){const r=[],s=e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const a=(c,u)=>{c===tu?(r.push(zu.repeatWrapping_float),o+=`		tsl_repeatWrapping_float( coord.${u} )`):c===ta?(r.push(zu.clampWrapping_float),o+=`		tsl_clampWrapping_float( coord.${u} )`):c===x4?(r.push(zu.mirrorWrapping_float),o+=`		tsl_mirrorWrapping_float( coord.${u} )`):(o+=`		coord.${u}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${c}" for vertex shader.`))};a(e.wrapS,"x"),o+=`,
`,a(e.wrapT,"y"),e.isData3DTexture&&(o+=`,
`,a(e.wrapR,"z")),o+=`
	);

}
`,wEe[t]=n=new wa(o,r)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){const r=this.getDataFromNode(e,this.shaderStage,this.globalCache);r.dimensionsSnippet===void 0&&(r.dimensionsSnippet={});let s=r.dimensionsSnippet[n];if(r.dimensionsSnippet[n]===void 0){let o,a;const{primarySamples:c}=this.renderer.backend.utils.getTextureSampleData(e),u=c>1;e.isData3DTexture?a="vec3<u32>":a="vec2<u32>",u||e.isVideoTexture||e.isStorageTexture?o=t:o=`${t}${n?`, u32( ${n} )`:""}`,s=new tL(new rL(`textureDimensions( ${o} )`,a)),r.dimensionsSnippet[n]=s,(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)&&(r.arrayLayerCount=new tL(new rL(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(r.cubeFaceCount=new tL(new rL("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,n,r="0u"){this._include("biquadraticTexture");const s=this.generateWrapFunction(e),o=this.generateTextureDimension(e,t,r);return`tsl_biquadraticTexture( ${t}, ${s}( ${n} ), ${o}, u32( ${r} ) )`}generateTextureLod(e,t,n,r,s="0u"){const o=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,s),c=e.isData3DTexture?"vec3":"vec2",u=`${c}<u32>( ${o}( ${n} ) * ${c}<f32>( ${a} ) )`;return this.generateTextureLoad(e,t,u,r,s)}generateTextureLoad(e,t,n,r,s="0u"){let o;return e.isVideoTexture===!0?o=`textureLoad( ${t}, ${n} )`:r?o=`textureLoad( ${t}, ${n}, ${r}, u32( ${s} ) )`:(o=`textureLoad( ${t}, ${n}, u32( ${s} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(o+=".x")),o}generateTextureStore(e,t,n,r,s){let o;return r?o=`textureStore( ${t}, ${n}, ${r}, ${s} )`:o=`textureStore( ${t}, ${n}, ${s} )`,o}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===Ys||this.isSampleCompare(e)===!1&&e.minFilter===es&&e.magFilter===es||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,r,s=this.shaderStage){let o=null;return e.isVideoTexture===!0?o=this._generateVideoSample(t,n,s):this.isUnfilterable(e)?o=this.generateTextureLod(e,t,n,r,"0",s):o=this._generateTextureSample(e,t,n,r,s),o}generateTextureGrad(e,t,n,r,s,o=this.shaderStage){if(o==="fragment")return`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${r[0]}, ${r[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(e,t,n,r,s,o=this.shaderStage){if(o==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${s}, ${r} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(e,t,n,r,s,o=this.shaderStage){let a=null;return e.isVideoTexture===!0?a=this._generateVideoSample(t,n,o):a=this._generateTextureSampleLevel(e,t,n,r,s),a}generateTextureBias(e,t,n,r,s,o=this.shaderStage){if(o==="fragment")return`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${r} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${o} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const n=e.name,r=e.type;return r==="texture"||r==="cubeTexture"||r==="storageTexture"||r==="texture3D"?n:r==="buffer"||r==="storageBuffer"||r==="indirectStorageBuffer"?this.isCustomStruct(e)?n:n+".value":e.groupNode.name+"."+n}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=cvt[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?A1.READ_ONLY:e.access}getStorageAccess(e,t){return lvt[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n,r=null){const s=super.getUniformFromNode(e,t,n,r),o=this.getDataFromNode(e,n,this.globalCache);if(o.uniformGPU===void 0){let a;const c=e.groupNode,u=c.name,f=this.getBindGroupArray(u,n);if(t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"){let m=null;const v=this.getNodeAccess(e,n);if(t==="texture"||t==="storageTexture"?m=new Pz(s.name,s.node,c,v):t==="cubeTexture"?m=new Cke(s.name,s.node,c,v):t==="texture3D"&&(m=new Ake(s.name,s.node,c,v)),m.store=e.isStorageTextureNode===!0,m.setVisibility(wB[n]),this.isUnfilterable(e.value)===!1&&m.store===!1){const x=new Y5t(`${s.name}_sampler`,s.node,c);x.setVisibility(wB[n]),f.push(x,m),a=[x,m]}else f.push(m),a=[m]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const m=t==="buffer"?Eke:Q5t,v=new m(e,c);v.setVisibility(wB[n]),f.push(v),a=v,s.name=r||"NodeBuffer_"+s.id}else{const m=this.uniformGroups[n]||(this.uniformGroups[n]={});let v=m[u];v===void 0&&(v=new Mke(u,c),v.setVisibility(wB[n]),m[u]=v,f.push(v)),a=this.getNodeUniform(s,t),v.addUniform(a)}o.uniformGPU=a}return s}getBuiltin(e,t,n,r=this.shaderStage){const s=this.builtins[r]||(this.builtins[r]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const o of t.inputs)r.push(o.name+" : "+this.getType(o.type));let s=`fn ${t.name}( ${r.join(", ")} ) -> ${this.getType(t.type)} {
${n.vars}
${n.code}
`;return n.result&&(s+=`	return ${n.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(n!==void 0)for(const r of n)t.push(`enable ${r};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(n!==void 0)for(const{name:r,property:s,type:o}of n.values())t.push(`@builtin( ${r} ) ${s} : ${o}`);return t.join(`,
	`)}getScopedArray(e,t,n,r){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:r}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:n,scope:r,bufferType:s,bufferCount:o}of this.scopedArrays.values()){const a=this.getType(s);t.push(`var<${r}> ${n}: array< ${a}, ${o} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const n=this.getBuiltins("attribute");n&&t.push(n);const r=this.getAttributesArray();for(let s=0,o=r.length;s<o;s++){const a=r[s],c=a.name,u=this.getType(a.type);t.push(`@location( ${s} ) ${c} : ${u}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const n of e.members){const r=e.output?"@location( "+n.index+" ) ":"";let s=this.getType(n.type);n.atomic&&(s="atomic< "+s+" >"),t.push(`	${r+n.name} : ${s}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const r=[];for(const s of n){let o=`struct ${s.name} {
`;o+=this.getStructMembers(s),o+=`
};`,r.push(o)}t=`
`+r.join(`

`)+`
`}return t}getVar(e,t,n=null){let r=`var ${t} : `;return n!==null?r+=this.generateArrayDeclaration(e,n):r+=this.getType(e),r}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const r of n)t.push(`	${this.getVar(r.type,r.name,r.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,o=this.vars[e];for(let a=0;a<s.length;a++){const c=s[a];if(c.needsInterpolation){let u=`@location( ${a} )`;if(c.interpolationType){const f=c.interpolationSampling!==null?`, ${c.interpolationSampling} )`:" )";u+=` @interpolate( ${c.interpolationType}${f}`}else/^(int|uint|ivec|uvec)/.test(c.type)&&(u+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${u} ${c.name} : ${this.getType(c.type)}`)}else e==="vertex"&&o.includes(c)===!1&&o.push(c)}}const n=this.getBuiltins(e);n&&t.push(n);const r=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+r):r}isCustomStruct(e){const t=e.value,n=e.node,r=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&n.structTypeNode!==null,s=n.value&&n.value.array&&typeof n.value.itemSize=="number"&&n.value.array.length>n.value.itemSize;return r&&!s}getUniforms(e){const t=this.uniforms[e],n=[],r=[],s=[],o={};for(const c of t){const u=c.groupNode.name,f=this.bindingsIndexes[u];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="storageTexture"||c.type==="texture3D"){const m=c.node.value;this.isUnfilterable(m)===!1&&c.node.isStorageTextureNode!==!0&&(this.isSampleCompare(m)?n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${c.name}_sampler : sampler_comparison;`):n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${c.name}_sampler : sampler;`));let v,x="";const{primarySamples:T}=this.renderer.backend.utils.getTextureSampleData(m);if(T>1&&(x="_multisampled"),m.isCubeTexture===!0)v="texture_cube<f32>";else if(m.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&m.compareFunction===null?v=`texture${x}_2d<f32>`:v=`texture_depth${x}_2d${m.isArrayTexture===!0?"_array":""}`;else if(m.isArrayTexture===!0||m.isDataArrayTexture===!0||m.isCompressedArrayTexture===!0)v="texture_2d_array<f32>";else if(m.isVideoTexture===!0)v="texture_external";else if(m.isData3DTexture===!0)v="texture_3d<f32>";else if(c.node.isStorageTextureNode===!0){const P=Gte(m),R=this.getStorageAccess(c.node,e);v=`texture_storage_2d<${P}, ${R}>`}else{const P=this.getComponentTypeFromTexture(m).charAt(0);v=`texture${x}_2d<${P}32>`}n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${c.name} : ${v};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const m=c.node,v=this.getType(m.getNodeType(this)),x=m.bufferCount,T=x>0&&c.type==="buffer"?", "+x:"",P=m.isStorageBufferNode?`storage, ${this.getStorageAccess(m,e)}`:"uniform";if(this.isCustomStruct(c))r.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var<${P}> ${c.name} : ${v};`);else{const M=`	value : array< ${m.isAtomic?`atomic<${v}>`:`${v}`}${T} >`;r.push(this._getWGSLStructBinding(c.name,M,P,f.binding++,f.group))}}else{const m=this.getType(this.getVectorType(c.type)),v=c.groupNode.name;(o[v]||(o[v]={index:f.binding++,id:f.group,snippets:[]})).snippets.push(`	${c.name} : ${m}`)}}for(const c in o){const u=o[c];s.push(this._getWGSLStructBinding(c,u.snippets.join(`,
`),"uniform",u.index,u.id))}let a=n.join(`
`);return a+=r.join(`
`),a+=s.join(`
`),a}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let r=`// code

`;r+=this.flowCode[t];const s=this.flowNodes[t],o=s[s.length-1],a=o.outputNode,c=a!==void 0&&a.isOutputStructNode===!0;for(const u of s){const f=this.getFlowData(u),m=u.name;if(m&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${m}
`),r+=`${f.code}
	`,u===o&&t!=="compute"){if(r+=`// result

	`,t==="vertex")r+=`varyings.Vertex = ${f.result};`;else if(t==="fragment")if(c)n.returnType=a.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",r+=`return ${f.result};`;else{let v="	@location(0) color: vec4<f32>";const x=this.getBuiltins("output");x&&(v+=`,
	`+x),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",v),n.structs+=`
var<private> output : OutputStruct;`,r+=`output.color = ${f.result};

	return output;`}}}n.flow=r}this.shaderStage=null,this.material!==null?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,t=null){let n;return t!==null&&(n=this._getWGSLMethod(e+"_"+t)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getType(e){return uvt[e]||e}isAvailable(e){let t=SEe[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),SEe[e]=t),t}_getWGSLMethod(e){return zu[e]!==void 0&&this._include(e),xE[e]}_include(e){const t=zu[e];return t.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${Nke}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${t} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x + globalId.y * numWorkgroups.x * u32(${t}) + globalId.z * numWorkgroups.x * numWorkgroups.y * u32(${t});

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,n,r=0,s=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}
@binding( ${r} ) @group( ${s} )
var<${n}> ${e} : ${o};`}}class dvt{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=Ve.Depth24PlusStencil8:e.depth&&(t=Ve.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,o=s.getRenderTarget();t=o?o.samples:s.samples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return Y6.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return Y6.LineList;if(e.isLine)return Y6.LineStrip;if(e.isMesh)return Y6.TriangleList}getSampleCount(e){let t=1;return e>1&&(t=Math.pow(2,Math.floor(Math.log2(e))),t===2&&(t=4)),t}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===ps)return Ve.BGRA8Unorm;if(e===Aa)return Ve.RGBA16Float;throw new Error("Unsupported outputType")}}const fvt=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),pvt=new Map([[eAe,["float16"]]]),mvt=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class gvt{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),r=this.backend,s=r.get(n);let o=s.buffer;if(o===void 0){const a=r.device;let c=n.array;if(e.normalized===!1){if(c.constructor===Int16Array||c.constructor===Int8Array)c=new Int32Array(c);else if((c.constructor===Uint16Array||c.constructor===Uint8Array)&&(c=new Uint32Array(c),t&GPUBufferUsage.INDEX))for(let m=0;m<c.length;m++)c[m]===65535&&(c[m]=4294967295)}if(n.array=c,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){c=new c.constructor(n.count*4);for(let m=0;m<n.count;m++)c.set(n.array.subarray(m*3,m*3+3),m*4);n.itemSize=4,n.array=c,s._force3to4BytesAlignment=!0}const u=c.byteLength,f=u+(4-u%4)%4;o=a.createBuffer({label:n.name,size:f,usage:t,mappedAtCreation:!0}),new c.constructor(o.getMappedRange()).set(c),o.unmap(),s.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,r=n.device,s=n.get(t),o=n.get(t).buffer;let a=t.array;if(s._force3to4BytesAlignment===!0){a=new a.constructor(t.count*4);for(let f=0;f<t.count;f++)a.set(t.array.subarray(f*3,f*3+3),f*4);t.array=a}const c=this._isTypedArray(a),u=t.updateRanges;if(u.length===0)r.queue.writeBuffer(o,0,a,0);else{const f=c?1:a.BYTES_PER_ELEMENT;for(let m=0,v=u.length;m<v;m++){const x=u[m];let T,P;if(s._force3to4BytesAlignment===!0){const M=Math.floor(x.start/3),O=Math.ceil(x.count/3);T=M*4*f,P=O*4*f}else T=x.start*f,P=x.count*f;const R=T*(c?a.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(o,R,a,T,P)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let r=0;r<t.length;r++){const s=t[r],o=s.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(s);let c=n.get(a);if(c===void 0){let m,v;s.isInterleavedBufferAttribute===!0?(m=s.data.stride*o,v=s.data.isInstancedInterleavedBuffer?SB.Instance:SB.Vertex):(m=s.itemSize*o,v=s.isInstancedBufferAttribute?SB.Instance:SB.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(m=4),c={arrayStride:m,attributes:[],stepMode:v},n.set(a,c)}const u=this._getVertexFormat(s),f=s.isInterleavedBufferAttribute===!0?s.offset*o:0;c.attributes.push({shaderLocation:r,offset:f,format:u})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,s=t.get(this._getBufferAttribute(e)).buffer,o=s.size,a=n.createBuffer({label:`${e.name}_readback`,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),c=n.createCommandEncoder({label:`readback_encoder_${e.name}`});c.copyBufferToBuffer(s,0,a,0,o);const u=c.finish();n.queue.submit([u]),await a.mapAsync(GPUMapMode.READ);const f=a.getMappedRange(),m=new e.array.constructor(f.slice(0));return a.unmap(),m.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,r=e.array.constructor,s=e.constructor;let o;if(t===1)o=mvt.get(r);else{const c=(pvt.get(s)||fvt.get(r))[n?1:0];if(c){const u=r.BYTES_PER_ELEMENT*t,m=Math.floor((u+3)/4)*4/r.BYTES_PER_ELEMENT;if(m%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${c}x${m}`}}return o||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),o}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class yvt{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,n=t.device,r=[];let s=0;for(const o of e.bindings){const a={binding:s++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const c={};o.isStorageBuffer&&(o.visibility&4&&(o.access===A1.READ_WRITE||o.access===A1.WRITE_ONLY)?c.type=CJ.Storage:c.type=CJ.ReadOnlyStorage),a.buffer=c}else if(o.isSampler){const c={};o.texture.isDepthTexture&&(o.texture.compareFunction!==null?c.type=vEe.Comparison:t.compatibilityMode&&(c.type=vEe.NonFiltering)),a.sampler=c}else if(o.isSampledTexture&&o.texture.isVideoTexture)a.externalTexture={};else if(o.isSampledTexture&&o.store){const c={};c.format=this.backend.get(o.texture).texture.format;const u=o.access;u===A1.READ_WRITE?c.access=AJ.ReadWrite:u===A1.WRITE_ONLY?c.access=AJ.WriteOnly:c.access=AJ.ReadOnly,a.storageTexture=c}else if(o.isSampledTexture){const c={},{primarySamples:u}=t.utils.getTextureSampleData(o.texture);if(u>1&&(c.multisampled=!0,o.texture.isDepthTexture||(c.sampleType=_y.UnfilterableFloat)),o.texture.isDepthTexture)t.compatibilityMode&&o.texture.compareFunction===null?c.sampleType=_y.UnfilterableFloat:c.sampleType=_y.Depth;else if(o.texture.isDataTexture||o.texture.isDataArrayTexture||o.texture.isData3DTexture){const f=o.texture.type;f===qa?c.sampleType=_y.SInt:f===fs?c.sampleType=_y.UInt:f===Ys&&(this.backend.hasFeature("float32-filterable")?c.sampleType=_y.Float:c.sampleType=_y.UnfilterableFloat)}o.isSampledCubeTexture?c.viewDimension=Wa.Cube:o.texture.isArrayTexture||o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?c.viewDimension=Wa.TwoDArray:o.isSampledTexture3D&&(c.viewDimension=Wa.ThreeD),a.texture=c}else console.error(`WebGPUBindingUtils: Unsupported binding "${o}".`);r.push(a)}return n.createBindGroupLayout({entries:r})}createBindings(e,t,n,r=0){const{backend:s,bindGroupLayoutCache:o}=this,a=s.get(e);let c=o.get(e.bindingsReference);c===void 0&&(c=this.createBindingsLayout(e),o.set(e.bindingsReference,c));let u;n>0&&(a.groups===void 0&&(a.groups=[],a.versions=[]),a.versions[n]===r&&(u=a.groups[n])),u===void 0&&(u=this.createBindGroup(e,c),n>0&&(a.groups[n]=u,a.versions[n]=r)),a.group=u,a.layout=c}updateBinding(e){const t=this.backend,n=t.device,r=e.buffer,s=t.get(e).buffer;n.queue.writeBuffer(s,0,r,0)}createBindGroupIndex(e,t){const r=this.backend.device,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,o=e[0],a=r.createBuffer({label:"bindingCameraIndex_"+o,size:16,usage:s});r.queue.writeBuffer(a,0,e,0);const c=[{binding:0,resource:{buffer:a}}];return r.createBindGroup({label:"bindGroupCameraIndex_"+o,layout:t,entries:c})}createBindGroup(e,t){const n=this.backend,r=n.device;let s=0;const o=[];for(const a of e.bindings){if(a.isUniformBuffer){const c=n.get(a);if(c.buffer===void 0){const u=a.byteLength,f=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,m=r.createBuffer({label:"bindingBuffer_"+a.name,size:u,usage:f});c.buffer=m}o.push({binding:s,resource:{buffer:c.buffer}})}else if(a.isStorageBuffer){const c=n.get(a);if(c.buffer===void 0){const u=a.attribute;c.buffer=n.get(u).buffer}o.push({binding:s,resource:{buffer:c.buffer}})}else if(a.isSampler){const c=n.get(a.texture);o.push({binding:s,resource:c.sampler})}else if(a.isSampledTexture){const c=n.get(a.texture);let u;if(c.externalTexture!==void 0)u=r.importExternalTexture({source:c.externalTexture});else{const f=a.store?1:c.texture.mipLevelCount,m=`view-${c.texture.width}-${c.texture.height}-${f}`;if(u=c[m],u===void 0){const v=q5t.All;let x;a.isSampledCubeTexture?x=Wa.Cube:a.isSampledTexture3D?x=Wa.ThreeD:a.texture.isArrayTexture||a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?x=Wa.TwoDArray:x=Wa.TwoD,u=c[m]=c.texture.createView({aspect:v,dimension:x,mipLevelCount:f})}}o.push({binding:s,resource:u})}s++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}}class vvt{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:r,geometry:s,pipeline:o}=e,{vertexProgram:a,fragmentProgram:c}=o,u=this.backend,f=u.device,m=u.utils,v=u.get(o),x=[];for(const Pe of e.getBindings()){const je=u.get(Pe);x.push(je.layout)}const T=u.attributeUtils.createShaderVertexBuffers(e);let P;r.blending!==vl&&(r.blending!==fc||r.transparent!==!1)&&(P=this._getBlending(r));let R={};r.stencilWrite===!0&&(R={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const M=this._getColorWriteMask(r),O=[];if(e.context.textures!==null){const Pe=e.context.textures;for(let je=0;je<Pe.length;je++){const ge=m.getTextureFormatGPU(Pe[je]);O.push({format:ge,blend:P,writeMask:M})}}else{const Pe=m.getCurrentColorFormat(e.context);O.push({format:Pe,blend:P,writeMask:M})}const C=u.get(a).module,L=u.get(c).module,Y=this._getPrimitiveState(n,s,r),J=this._getDepthCompare(r),z=m.getCurrentDepthStencilFormat(e.context),ne=this._getSampleCount(e.context),K={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},C,{buffers:T}),fragment:Object.assign({},L,{targets:O}),primitive:Y,multisample:{count:ne,alphaToCoverageEnabled:r.alphaToCoverage&&ne>1},layout:f.createPipelineLayout({bindGroupLayouts:x})},$={},he=e.context.depth,Ce=e.context.stencil;if((he===!0||Ce===!0)&&(he===!0&&($.format=z,$.depthWriteEnabled=r.depthWrite,$.depthCompare=J),Ce===!0&&($.stencilFront=R,$.stencilBack={},$.stencilReadMask=r.stencilFuncMask,$.stencilWriteMask=r.stencilWriteMask),r.polygonOffset===!0&&($.depthBias=r.polygonOffsetUnits,$.depthBiasSlopeScale=r.polygonOffsetFactor,$.depthBiasClamp=0),K.depthStencil=$),t===null)v.pipeline=f.createRenderPipeline(K);else{const Pe=new Promise(je=>{f.createRenderPipelineAsync(K).then(ge=>{v.pipeline=ge,je()})});t.push(Pe)}}createBundleEncoder(e,t="renderBundleEncoder"){const n=this.backend,{utils:r,device:s}=n,o=r.getCurrentDepthStencilFormat(e),a=r.getCurrentColorFormat(e),c=this._getSampleCount(e),u={label:t,colorFormats:[a],depthStencilFormat:o,sampleCount:c};return s.createRenderBundleEncoder(u)}createComputePipeline(e,t){const n=this.backend,r=n.device,s=n.get(e.computeProgram).module,o=n.get(e),a=[];for(const c of t){const u=n.get(c);a.push(u.layout)}o.pipeline=r.createComputePipeline({compute:s,layout:r.createPipelineLayout({bindGroupLayouts:a})})}_getBlending(e){let t,n;const r=e.blending,s=e.blendSrc,o=e.blendDst,a=e.blendEquation;if(r===Jy){const c=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,u=e.blendDstAlpha!==null?e.blendDstAlpha:o,f=e.blendEquationAlpha!==null?e.blendEquationAlpha:a;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(a)},n={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(u),operation:this._getBlendOperation(f)}}else{const c=e.premultipliedAlpha,u=(f,m,v,x)=>{t={srcFactor:f,dstFactor:m,operation:vy.Add},n={srcFactor:v,dstFactor:x,operation:vy.Add}};if(c)switch(r){case fc:u(zr.One,zr.OneMinusSrcAlpha,zr.One,zr.OneMinusSrcAlpha);break;case f4:u(zr.One,zr.One,zr.One,zr.One);break;case p4:u(zr.Zero,zr.OneMinusSrc,zr.Zero,zr.One);break;case m4:u(zr.Zero,zr.Src,zr.Zero,zr.SrcAlpha);break}else switch(r){case fc:u(zr.SrcAlpha,zr.OneMinusSrcAlpha,zr.One,zr.OneMinusSrcAlpha);break;case f4:u(zr.SrcAlpha,zr.One,zr.SrcAlpha,zr.One);break;case p4:u(zr.Zero,zr.OneMinusSrc,zr.Zero,zr.One);break;case m4:u(zr.Zero,zr.Src,zr.Zero,zr.Src);break}}if(t!==void 0&&n!==void 0)return{color:t,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(e){let t;switch(e){case ud:t=zr.Zero;break;case KM:t=zr.One;break;case ZM:t=zr.Src;break;case QM:t=zr.OneMinusSrc;break;case g4:t=zr.SrcAlpha;break;case y4:t=zr.OneMinusSrcAlpha;break;case tC:t=zr.Dst;break;case nC:t=zr.OneMinusDst;break;case JM:t=zr.DstAlpha;break;case eC:t=zr.OneMinusDstAlpha;break;case BU:t=zr.SrcAlphaSaturated;break;case ryt:t=zr.Constant;break;case iyt:t=zr.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const n=e.stencilFunc;switch(n){case nqe:t=fl.Never;break;case Pee:t=fl.Always;break;case rqe:t=fl.Less;break;case sqe:t=fl.LessEqual;break;case iqe:t=fl.Equal;break;case lqe:t=fl.GreaterEqual;break;case oqe:t=fl.Greater;break;case aqe:t=fl.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return t}_getStencilOperation(e){let t;switch(e){case Sy:t=a2.Keep;break;case YWe:t=a2.Zero;break;case KWe:t=a2.Replace;break;case tqe:t=a2.Invert;break;case ZWe:t=a2.IncrementClamp;break;case QWe:t=a2.DecrementClamp;break;case JWe:t=a2.IncrementWrap;break;case eqe:t=a2.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case gl:t=vy.Add;break;case FU:t=vy.Subtract;break;case OU:t=vy.ReverseSubtract;break;case Lne:t=vy.Min;break;case Une:t=vy.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,n){const r={},s=this.backend.utils;switch(r.topology=s.getPrimitiveTopology(e,n),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?cx.Uint16:cx.Uint32),n.side){case Xl:r.frontFace=TJ.CCW,r.cullMode=EJ.Back;break;case Ui:r.frontFace=TJ.CCW,r.cullMode=EJ.Front;break;case Co:r.frontFace=TJ.CCW,r.cullMode=EJ.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side);break}return r}_getColorWriteMask(e){return e.colorWrite===!0?yEe.All:yEe.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=fl.Always;else{const n=e.depthFunc;switch(n){case cM:t=fl.Never;break;case uM:t=fl.Always;break;case hM:t=fl.Less;break;case z2:t=fl.LessEqual;break;case dM:t=fl.Equal;break;case fM:t=fl.GreaterEqual;break;case pM:t=fl.Greater;break;case mM:t=fl.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return t}}class _vt extends Pke{constructor(e,t,n=2048){super(n),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const r=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return Qc(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e.id,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const r=this.device.createCommandEncoder();r.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),r.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const s=r.finish();if(this.device.queue.submit([s]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const o=new BigUint64Array(this.resultBuffer.getMappedRange(0,n));let a=0;for(const[,c]of e){const u=o[c],f=o[c+1],m=Number(f-u)/1e6;a+=m}return this.resultBuffer.unmap(),this.lastValue=a,a}catch(e){return console.error("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){console.error("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){console.error("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class xvt extends Rke{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new dvt(this),this.attributeUtils=new gvt(this),this.bindingUtils=new yvt(this),this.pipelineUtils=new vvt(this),this.textureUtils=new nvt(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let n;if(t.device===void 0){const o={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},a=typeof navigator<"u"?await navigator.gpu.requestAdapter(o):null;if(a===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const c=Object.values(Vte),u=[];for(const m of c)a.features.has(m)&&u.push(m);const f={requiredFeatures:u,requiredLimits:t.requiredLimits};n=await a.requestDevice(f)}else n=t.device;n.lost.then(o=>{const a={api:"WebGPU",message:o.message||"Unknown reason",reason:o.reason||null,originalEvent:o};e.onDeviceLost(a)});const r=t.context!==void 0?t.context:e.domElement.getContext("webgpu");this.device=n,this.context=r;const s=t.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(Vte.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s}),this.updateSize()}get coordinateSystem(){return V2}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(e===null){const n=this.renderer;e={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(n.depth,n.stencil).createView()});const r=e.colorAttachments[0];this.renderer.samples>0?r.view=this.colorBuffer.createView():r.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const t=e.colorAttachments[0];return this.renderer.samples>0?t.resolveTarget=this.context.getCurrentTexture().createView():t.view=this.context.getCurrentTexture().createView(),e}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const n=e.renderTarget,r=this.get(n);let s=r.descriptors;if(s===void 0||r.width!==n.width||r.height!==n.height||r.dimensions!==n.dimensions||r.activeMipmapLevel!==e.activeMipmapLevel||r.activeCubeFace!==e.activeCubeFace||r.samples!==n.samples){s={},r.descriptors=s;const u=()=>{n.removeEventListener("dispose",u),this.delete(n)};n.hasEventListener("dispose",u)===!1&&n.addEventListener("dispose",u)}const o=e.getCacheKey();let a=s[o];if(a===void 0){const u=e.textures,f=[];let m;const v=this._isRenderCameraDepthArray(e);for(let x=0;x<u.length;x++){const T=this.get(u[x]),P={label:`colorAttachment_${x}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:Wa.TwoD};if(n.isRenderTarget3D)m=e.activeCubeFace,P.baseArrayLayer=0,P.dimension=Wa.ThreeD,P.depthOrArrayLayers=u[x].image.depth;else if(n.isRenderTarget&&u[x].image.depth>1)if(v===!0){const R=e.camera.cameras;for(let M=0;M<R.length;M++){const O={...P,baseArrayLayer:M,arrayLayerCount:1,dimension:Wa.TwoD},C=T.texture.createView(O);f.push({view:C,resolveTarget:void 0,depthSlice:void 0})}}else P.dimension=Wa.TwoDArray,P.depthOrArrayLayers=u[x].image.depth;if(v!==!0){const R=T.texture.createView(P);let M,O;T.msaaTexture!==void 0?(M=T.msaaTexture.createView(),O=R):(M=R,O=void 0),f.push({view:M,resolveTarget:O,depthSlice:m})}}if(a={textureViews:f},e.depth){const x=this.get(e.depthTexture),T={};e.depthTexture.isArrayTexture&&(T.dimension=Wa.TwoD,T.arrayLayerCount=1,T.baseArrayLayer=e.activeCubeFace),a.depthStencilView=x.texture.createView(T)}s[o]=a,r.width=n.width,r.height=n.height,r.samples=n.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace,r.dimensions=n.dimensions}const c={colorAttachments:[]};for(let u=0;u<a.textureViews.length;u++){const f=a.textureViews[u];let m={r:0,g:0,b:0,a:1};u===0&&t.clearValue&&(m=t.clearValue),c.colorAttachments.push({view:f.view,depthSlice:f.depthSlice,resolveTarget:f.resolveTarget,loadOp:t.loadOp||Wi.Load,storeOp:t.storeOp||T0.Store,clearValue:m})}return a.depthStencilView&&(c.depthStencilAttachment={view:a.depthStencilView}),c}beginRender(e){const t=this.get(e),n=this.device,r=e.occlusionQueryCount;let s;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=n.createQuerySet({type:"occlusion",count:r,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(r),t.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e,{loadOp:Wi.Load}),this.initTimestampQuery(e,o),o.occlusionQuerySet=s;const a=o.depthStencilAttachment;if(e.textures!==null){const u=o.colorAttachments;for(let f=0;f<u.length;f++){const m=u[f];e.clearColor?(m.clearValue=f===0?e.clearColorValue:{r:0,g:0,b:0,a:1},m.loadOp=Wi.Clear):m.loadOp=Wi.Load,m.storeOp=T0.Store}}else{const u=o.colorAttachments[0];e.clearColor?(u.clearValue=e.clearColorValue,u.loadOp=Wi.Clear):u.loadOp=Wi.Load,u.storeOp=T0.Store}e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=Wi.Clear):a.depthLoadOp=Wi.Load,a.depthStoreOp=T0.Store),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=Wi.Clear):a.stencilLoadOp=Wi.Load,a.stencilStoreOp=T0.Store);const c=n.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const u=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==u.length?this._createDepthLayerDescriptors(e,t,o,u):this._updateDepthLayerDescriptors(e,t,u),t.bundleEncoders=[],t.bundleSets=[];for(let f=0;f<u.length;f++){const m=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+f),v={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(m),t.bundleSets.push(v)}t.currentPass=null}else{const u=c.beginRenderPass(o);if(t.currentPass=u,e.viewport&&this.updateViewport(e),e.scissor){const{x:f,y:m,width:v,height:x}=e.scissorValue;u.setScissorRect(f,m,v,x)}}t.descriptor=o,t.encoder=c,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,n,r){const s=n.depthStencilAttachment;t.layerDescriptors=[];const o=this.get(e.depthTexture);o.viewCache||(o.viewCache=[]);for(let a=0;a<r.length;a++){const c={...n,colorAttachments:[{...n.colorAttachments[0],view:n.colorAttachments[a].view}]};if(n.depthStencilAttachment){const u=a;o.viewCache[u]||(o.viewCache[u]=o.texture.createView({dimension:Wa.TwoD,baseArrayLayer:a,arrayLayerCount:1})),c.depthStencilAttachment={view:o.viewCache[u],depthLoadOp:s.depthLoadOp||Wi.Clear,depthStoreOp:s.depthStoreOp||T0.Store,depthClearValue:s.depthClearValue||1},e.stencil&&(c.depthStencilAttachment.stencilLoadOp=s.stencilLoadOp,c.depthStencilAttachment.stencilStoreOp=s.stencilStoreOp,c.depthStencilAttachment.stencilClearValue=s.stencilClearValue)}else c.depthStencilAttachment={...s};t.layerDescriptors.push(c)}}_updateDepthLayerDescriptors(e,t,n){for(let r=0;r<n.length;r++){const s=t.layerDescriptors[r];if(s.depthStencilAttachment){const o=s.depthStencilAttachment;e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=Wi.Clear):o.depthLoadOp=Wi.Load),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=Wi.Clear):o.stencilLoadOp=Wi.Load)}}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const r=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const s=[];for(let o=0;o<t.bundleEncoders.length;o++){const a=t.bundleEncoders[o];s.push(a.finish())}for(let o=0;o<t.layerDescriptors.length;o++)if(o<s.length){const a=t.layerDescriptors[o],c=r.beginRenderPass(a);if(e.viewport){const{x:u,y:f,width:m,height:v,minDepth:x,maxDepth:T}=e.viewportValue;c.setViewport(u,f,m,v,x,T)}if(e.scissor){const{x:u,y:f,width:m,height:v}=e.scissorValue;c.setScissorRect(u,f,m,v)}c.executeBundles([s[o]]),c.end()}}else t.currentPass&&t.currentPass.end();if(n>0){const s=n*8;let o=this.occludedResolveCache.get(s);o===void 0&&(o=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,o));const a=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,o,0),t.encoder.copyBufferToBuffer(o,0,a,0,s),t.occlusionQueryBuffer=a,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const s=e.textures;for(let o=0;o<s.length;o++){const a=s[o];a.generateMipmaps===!0&&this.textureUtils.generateMipmaps(a)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const o=n.getMappedRange(),a=new BigUint64Array(o);for(let c=0;c<r.length;c++)a[c]===BigInt(0)&&s.add(r[c]);n.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:r,width:s,height:o,minDepth:a,maxDepth:c}=e.viewportValue;t.setViewport(n,r,s,o,a,c)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n,r=null){const s=this.device,o=this.renderer;let a=[],c,u,f,m;if(e){const T=this.getClearColor();u={r:T.r,g:T.g,b:T.b,a:T.a}}if(r===null){f=o.depth,m=o.stencil;const T=this._getDefaultRenderPassDescriptor();if(e){a=T.colorAttachments;const P=a[0];P.clearValue=u,P.loadOp=Wi.Clear,P.storeOp=T0.Store}(f||m)&&(c=T.depthStencilAttachment)}else{f=r.depth,m=r.stencil;const T={loadOp:e?Wi.Clear:Wi.Load,clearValue:e?u:void 0};f&&(T.depthLoadOp=t?Wi.Clear:Wi.Load,T.depthClearValue=t?o.getClearDepth():void 0,T.depthStoreOp=T0.Store),m&&(T.stencilLoadOp=n?Wi.Clear:Wi.Load,T.stencilClearValue=n?o.getClearStencil():void 0,T.stencilStoreOp=T0.Store);const P=this._getRenderPassDescriptor(r,T);a=P.colorAttachments,c=P.depthStencilAttachment}f&&c&&c.depthLoadOp===void 0&&(t?(c.depthLoadOp=Wi.Clear,c.depthClearValue=o.getClearDepth(),c.depthStoreOp=T0.Store):(c.depthLoadOp=Wi.Load,c.depthStoreOp=T0.Store)),m&&c&&c.stencilLoadOp===void 0&&(n?(c.stencilLoadOp=Wi.Clear,c.stencilClearValue=o.getClearStencil(),c.stencilStoreOp=T0.Store):(c.stencilLoadOp=Wi.Load,c.stencilStoreOp=T0.Store));const v=s.createCommandEncoder({label:"clear"});v.beginRenderPass({colorAttachments:a,depthStencilAttachment:c}).end(),s.queue.submit([v.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(e,n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,r){const{passEncoderGPU:s}=this.get(e),o=this.get(r).pipeline;this.pipelineUtils.setPipeline(s,o);for(let f=0,m=n.length;f<m;f++){const v=n[f],x=this.get(v);s.setBindGroup(f,x.group)}const a=this.device.limits.maxComputeWorkgroupsPerDimension,c=this.get(t);c.dispatchSize===void 0&&(c.dispatchSize={x:0,y:1,z:1});const{dispatchSize:u}=c;t.dispatchCount>a?(u.x=Math.min(t.dispatchCount,a),u.y=Math.ceil(t.dispatchCount/a)):u.x=t.dispatchCount,s.dispatchWorkgroups(u.x,u.y,u.z)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,t){const{object:n,material:r,context:s,pipeline:o}=e,a=e.getBindings(),c=this.get(s),u=this.get(o).pipeline,f=e.getIndex(),m=f!==null,v=e.getDrawParameters();if(v===null)return;const x=(P,R)=>{this.pipelineUtils.setPipeline(P,u),R.pipeline=u;const M=R.bindingGroups;for(let C=0,L=a.length;C<L;C++){const Y=a[C],J=this.get(Y);M[Y.index]!==Y.id&&(P.setBindGroup(Y.index,J.group),M[Y.index]=Y.id)}if(m===!0&&R.index!==f){const C=this.get(f).buffer,L=f.array instanceof Uint16Array?cx.Uint16:cx.Uint32;P.setIndexBuffer(C,L),R.index=f}const O=e.getVertexBuffers();for(let C=0,L=O.length;C<L;C++){const Y=O[C];if(R.attributes[C]!==Y){const J=this.get(Y).buffer;P.setVertexBuffer(C,J),R.attributes[C]=Y}}s.stencil===!0&&r.stencilWrite===!0&&c.currentStencilRef!==r.stencilRef&&(P.setStencilReference(r.stencilRef),c.currentStencilRef=r.stencilRef)},T=(P,R)=>{if(x(P,R),n.isBatchedMesh===!0){const M=n._multiDrawStarts,O=n._multiDrawCounts,C=n._multiDrawCount,L=n._multiDrawInstances;L!==null&&Qc("THREE.WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let Y=0;Y<C;Y++){const J=L?L[Y]:1,z=J>1?0:Y;m===!0?P.drawIndexed(O[Y],J,M[Y]/f.array.BYTES_PER_ELEMENT,0,z):P.draw(O[Y],J,M[Y],z),t.update(n,O[Y],J)}}else if(m===!0){const{vertexCount:M,instanceCount:O,firstVertex:C}=v,L=e.getIndirect();if(L!==null){const Y=this.get(L).buffer;P.drawIndexedIndirect(Y,0)}else P.drawIndexed(M,O,C,0,0);t.update(n,M,O)}else{const{vertexCount:M,instanceCount:O,firstVertex:C}=v,L=e.getIndirect();if(L!==null){const Y=this.get(L).buffer;P.drawIndirect(Y,0)}else P.draw(M,O,C,0);t.update(n,M,O)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const P=this.get(e.camera),R=e.camera.cameras,M=e.getBindingGroup("cameraIndex");if(P.indexesGPU===void 0||P.indexesGPU.length!==R.length){const C=this.get(M),L=[],Y=new Uint32Array([0,0,0,0]);for(let J=0,z=R.length;J<z;J++){Y[0]=J;const ne=this.bindingUtils.createBindGroupIndex(Y,C.layout);L.push(ne)}P.indexesGPU=L}const O=this.renderer.getPixelRatio();for(let C=0,L=R.length;C<L;C++){const Y=R[C];if(n.layers.test(Y.layers)){const J=Y.viewport;let z=c.currentPass,ne=c.currentSets;if(c.bundleEncoders){const K=c.bundleEncoders[C],$=c.bundleSets[C];z=K,ne=$}J&&z.setViewport(Math.floor(J.x*O),Math.floor(J.y*O),Math.floor(J.width*O),Math.floor(J.height*O),s.viewportValue.minDepth,s.viewportValue.maxDepth),M&&P.indexesGPU&&(z.setBindGroup(M.index,P.indexesGPU[C]),ne.bindingGroups[M.index]=M.id),T(z,ne)}}}else if(c.currentPass){if(c.occlusionQuerySet!==void 0){const P=c.lastOcclusionObject;P!==n&&(P!==null&&P.occlusionTest===!0&&(c.currentPass.endOcclusionQuery(),c.occlusionQueryIndex++),n.occlusionTest===!0&&(c.currentPass.beginOcclusionQuery(c.occlusionQueryIndex),c.occlusionQueryObjects[c.occlusionQueryIndex]=n),c.lastOcclusionObject=n)}T(c.currentPass,c.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:n,material:r}=e,s=this.utils,o=s.getSampleCountRenderContext(e.context),a=s.getCurrentColorSpace(e.context),c=s.getCurrentColorFormat(e.context),u=s.getCurrentDepthStencilFormat(e.context),f=s.getPrimitiveTopology(n,r);let m=!1;return(t.material!==r||t.materialVersion!==r.version||t.transparent!==r.transparent||t.blending!==r.blending||t.premultipliedAlpha!==r.premultipliedAlpha||t.blendSrc!==r.blendSrc||t.blendDst!==r.blendDst||t.blendEquation!==r.blendEquation||t.blendSrcAlpha!==r.blendSrcAlpha||t.blendDstAlpha!==r.blendDstAlpha||t.blendEquationAlpha!==r.blendEquationAlpha||t.colorWrite!==r.colorWrite||t.depthWrite!==r.depthWrite||t.depthTest!==r.depthTest||t.depthFunc!==r.depthFunc||t.stencilWrite!==r.stencilWrite||t.stencilFunc!==r.stencilFunc||t.stencilFail!==r.stencilFail||t.stencilZFail!==r.stencilZFail||t.stencilZPass!==r.stencilZPass||t.stencilFuncMask!==r.stencilFuncMask||t.stencilWriteMask!==r.stencilWriteMask||t.side!==r.side||t.alphaToCoverage!==r.alphaToCoverage||t.sampleCount!==o||t.colorSpace!==a||t.colorFormat!==c||t.depthStencilFormat!==u||t.primitiveTopology!==f||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=o,t.colorSpace=a,t.colorFormat=c,t.depthStencilFormat=u,t.primitiveTopology=f,t.clippingContextCacheKey=e.clippingContextCacheKey,m=!0),m}getRenderCacheKey(e){const{object:t,material:n}=e,r=this.utils,s=e.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,r.getSampleCountRenderContext(s),r.getCurrentColorSpace(s),r.getCurrentColorFormat(s),r.getCurrentDepthStencilFormat(s),r.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,r,s,o){return this.textureUtils.copyTextureToBuffer(e,t,n,r,s,o)}initTimestampQuery(e,t){if(!this.trackTimestamp)return;const n=e.isComputeNode?"compute":"render";this.timestampQueryPool[n]||(this.timestampQueryPool[n]=new _vt(this.device,n,2048));const r=this.timestampQueryPool[n],s=r.allocateQueriesForContext(e);t.timestampWrites={querySet:r.querySet,beginningOfPassWriteIndex:s,endOfPassWriteIndex:s+1}}createNodeBuilder(e,t){return new hvt(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),s=n.currentPass.finish();this.get(t).bundleGPU=s,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,t,n=null,r=null,s=0,o=0){let a=0,c=0,u=0,f=0,m=0,v=0,x=e.image.width,T=e.image.height,P=1;n!==null&&(n.isBox3===!0?(f=n.min.x,m=n.min.y,v=n.min.z,x=n.max.x-n.min.x,T=n.max.y-n.min.y,P=n.max.z-n.min.z):(f=n.min.x,m=n.min.y,x=n.max.x-n.min.x,T=n.max.y-n.min.y,P=1)),r!==null&&(a=r.x,c=r.y,u=r.z||0);const R=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),M=this.get(e).texture,O=this.get(t).texture;R.copyTextureToTexture({texture:M,mipLevel:s,origin:{x:f,y:m,z:v}},{texture:O,mipLevel:o,origin:{x:a,y:c,z:u}},[x,T,P]),this.device.queue.submit([R.finish()]),o===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,n){const r=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const o=this.get(e).texture;if(s.format!==o.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,o.format);return}let a;if(r.currentPass?(r.currentPass.end(),a=r.encoder):a=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),a.copyTextureToTexture({texture:s,origin:[n.x,n.y,0]},{texture:o},[n.z,n.w]),r.currentPass){const{descriptor:c}=r;for(let u=0;u<c.colorAttachments.length;u++)c.colorAttachments[u].loadOp=Wi.Load;if(t.depth&&(c.depthStencilAttachment.depthLoadOp=Wi.Load),t.stencil&&(c.depthStencilAttachment.stencilLoadOp=Wi.Load),r.currentPass=a.beginRenderPass(c),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor){const{x:u,y:f,width:m,height:v}=t.scissorValue;r.currentPass.setScissorRect(u,f,m,v)}}else this.device.queue.submit([a.finish()]);e.generateMipmaps&&this.textureUtils.generateMipmaps(e)}}class bvt extends Sx{constructor(e,t,n,r,s,o){super(e,t,n,r,s,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class Svt extends Sx{constructor(e,t,n,r,s,o){super(e,t,n,r,s,o),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class wvt extends Ske{constructor(){super(),this.addMaterial($3t,"MeshPhongMaterial"),this.addMaterial(ike,"MeshStandardMaterial"),this.addMaterial(O9t,"MeshPhysicalMaterial"),this.addMaterial(z9t,"MeshToonMaterial"),this.addMaterial(O3t,"MeshBasicMaterial"),this.addMaterial(V3t,"MeshLambertMaterial"),this.addMaterial(P3t,"MeshNormalMaterial"),this.addMaterial(H9t,"MeshMatcapMaterial"),this.addMaterial(E3t,"LineBasicMaterial"),this.addMaterial(C3t,"LineDashedMaterial"),this.addMaterial(X9t,"PointsMaterial"),this.addMaterial(oke,"SpriteMaterial"),this.addMaterial(Z9t,"ShadowMaterial"),this.addLight(M4t,Lee),this.addLight(J4t,qU),this.addLight(e5t,CAe),this.addLight(ose,Sx),this.addLight(i5t,MAe),this.addLight(s5t,EAe),this.addLight(o5t,HXe),this.addLight(t5t,bvt),this.addLight(r5t,Svt),this.addToneMapping(Dyt,Hne),this.addToneMapping(Fyt,jne),this.addToneMapping(Oyt,Wne),this.addToneMapping(Lyt,qne),this.addToneMapping(Gyt,Xne),this.addToneMapping($yt,Yne)}}class Tvt extends E5t{constructor(e={}){let t;e.forceWebGL?t=gEe:(t=xvt,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new gEe(e)));const n=new t(e);super(n,e),this.library=new wvt,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}class Ike{constructor(e,t,n){this.id=0,this.name=e,this.fg=t,this.bg=n,this.gradient=null,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.width="90px",this.canvas.style.height="48px",this.canvas.style.position="absolute",this.canvas.style.cssText="width:90px;height:48px;background-color: transparent !important;",this.context=this.canvas.getContext("2d"),this.initializeCanvas()}createGradient(){if(!this.context)throw new Error("No context");const e=this.context.createLinearGradient(0,this.GRAPH_Y,0,this.GRAPH_Y+this.GRAPH_HEIGHT);let t;const n=this.fg;switch(this.fg.toLowerCase()){case"#0ff":t="#006666";break;case"#0f0":t="#006600";break;case"#ff0":t="#666600";break;case"#e1e1e1":t="#666666";break;default:t=this.bg;break}return e.addColorStop(0,t),e.addColorStop(1,n),e}initializeCanvas(){this.context&&(this.context.imageSmoothingEnabled=!1,this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.gradient=this.createGradient(),this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(e,t,n=0){if(!this.context||!this.gradient)return;const r=Math.min(1/0,e),s=Math.max(t,e);this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(`${e.toFixed(n)} ${this.name} (${r.toFixed(n)}-${parseFloat(s.toFixed(n))})`,this.TEXT_X,this.TEXT_Y)}updateGraph(e,t){if(!this.context||!this.gradient)return;e===0&&t===0&&(t=1),t=Math.max(t,e,.1),e=Math.max(e,0);const n=Math.round(this.GRAPH_X),r=Math.round(this.GRAPH_Y),s=Math.round(this.GRAPH_WIDTH),o=Math.round(this.GRAPH_HEIGHT),a=Math.round(this.PR);this.context.drawImage(this.canvas,n+a,r,s-a,o,n,r,s-a,o),this.context.fillStyle=this.bg,this.context.fillRect(n+s-a,r,a,o);const c=Math.min(o,Math.round(e/t*o));c>0&&(this.context.globalAlpha=.9,this.context.fillStyle=this.gradient,this.context.fillRect(n+s-a,r+(o-c),a,c)),this.context.globalAlpha=1}}class Evt extends Ike{constructor(e,t,n){super(e,t,n),this.vsyncValue=0,this.SMALL_HEIGHT=9*this.PR,this.HEIGHT=this.SMALL_HEIGHT,this.WIDTH=35*this.PR,this.TEXT_Y=0*this.PR,this.canvas.height=this.HEIGHT,this.canvas.width=this.WIDTH,this.canvas.style.height="9px",this.canvas.style.width="35px",this.canvas.style.cssText=`
            width: 35px;
            height: 9px;
            position: absolute;
            top: 0;
            left: 0;
            background-color: transparent !important;
            pointer-events: none;
        `,this.initializeCanvas()}initializeCanvas(){this.context&&(this.context.imageSmoothingEnabled=!1,this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.globalAlpha=1)}update(e,t,n=0){this.context&&(this.vsyncValue=e,this.context.clearRect(0,0,this.WIDTH,this.HEIGHT),this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillText(`${e.toFixed(0)}Hz`,this.TEXT_X,this.TEXT_Y))}updateGraph(e,t){}setOffset(e,t){this.canvas.style.transform=`translate(${e}px, ${t}px)`}}const kke=class x6{constructor({trackGPU:e=!1,trackCPT:t=!1,trackHz:n=!1,logsPerSecond:r=4,graphsPerSecond:s=30,samplesLog:o=40,samplesGraph:a=10,precision:c=2,minimal:u=!1,horizontal:f=!0,mode:m=0}={}){this.gl=null,this.ext=null,this.activeQuery=null,this.gpuQueries=[],this.threeRendererPatched=!1,this.frameTimes=[],this.renderCount=0,this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.gpuPanel=null,this.gpuPanelCompute=null,this.vsyncPanel=null,this.averageFps={logs:[],graph:[]},this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.updateCounter=0,this.lastMin={},this.lastMax={},this.lastValue={},this.VSYNC_RATES=[{refreshRate:60,frameTime:16.67},{refreshRate:75,frameTime:13.33},{refreshRate:90,frameTime:11.11},{refreshRate:120,frameTime:8.33},{refreshRate:144,frameTime:6.94},{refreshRate:165,frameTime:6.06},{refreshRate:240,frameTime:4.17}],this.detectedVSync=null,this.frameTimeHistory=[],this.HISTORY_SIZE=120,this.VSYNC_THRESHOLD=.05,this.lastFrameTime=0,this.handleClick=x=>{x.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},this.handleResize=()=>{this.resizePanel(this.fpsPanel),this.resizePanel(this.msPanel),this.gpuPanel&&this.resizePanel(this.gpuPanel),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute)},this.mode=m,this.horizontal=f,this.minimal=u,this.trackGPU=e,this.trackCPT=t,this.trackHz=n,this.samplesLog=o,this.samplesGraph=a,this.precision=c,this.logsPerSecond=r,this.graphsPerSecond=s;const v=performance.now();this.prevGraphTime=v,this.dom=document.createElement("div"),this.initializeDOM(),this.beginTime=performance.now(),this.prevTextTime=this.beginTime,this.prevCpuTime=this.beginTime,this._panelId=0,this.fpsPanel=this.addPanel(new x6.Panel("FPS","#0ff","#002")),this.msPanel=this.addPanel(new x6.Panel("CPU","#0f0","#020")),this.trackHz===!0&&(this.vsyncPanel=new Evt("","#f0f","#202"),this.dom.appendChild(this.vsyncPanel.canvas),this.vsyncPanel.setOffset(56,35)),this.setupEventListeners()}initializeDOM(){this.dom.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      opacity: 0.9;
      z-index: 10000;
      ${this.minimal?"cursor: pointer;":""}
    `}setupEventListeners(){this.minimal?(this.dom.addEventListener("click",this.handleClick),this.showPanel(this.mode)):window.addEventListener("resize",this.handleResize)}async init(e){if(!e){console.error('Stats: The "canvas" parameter is undefined.');return}if(!this.handleThreeRenderer(e)&&!await this.handleWebGPURenderer(e))if(this.initializeWebGL(e)){this.trackGPU&&this.initializeGPUTracking();return}else console.error("Stats-gl: Failed to initialize WebGL context")}handleThreeRenderer(e){return e.isWebGLRenderer&&!this.threeRendererPatched?(this.patchThreeRenderer(e),this.gl=e.getContext(),this.trackGPU&&this.initializeGPUTracking(),!0):!1}async handleWebGPURenderer(e){return e.isWebGPURenderer?((this.trackGPU||this.trackCPT)&&(e.backend.trackTimestamp=!0,await e.hasFeatureAsync("timestamp-query")&&this.initializeWebGPUPanels()),this.info=e.info,this.patchThreeWebGPU(e),!0):!1}initializeWebGPUPanels(){this.trackGPU&&(this.gpuPanel=this.addPanel(new x6.Panel("GPU","#ff0","#220"))),this.trackCPT&&(this.gpuPanelCompute=this.addPanel(new x6.Panel("CPT","#e1e1e1","#212121")))}initializeWebGL(e){if(e instanceof WebGL2RenderingContext)this.gl=e;else if(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas){if(this.gl=e.getContext("webgl2"),!this.gl)return console.error("Stats: Unable to obtain WebGL2 context."),!1}else return console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas."),!1;return!0}initializeGPUTracking(){this.gl&&(this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new x6.Panel("GPU","#ff0","#220"))))}begin(){this.beginProfiling("cpu-started"),!(!this.gl||!this.ext)&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null),this.endProfiling("cpu-started","cpu-finished","cpu-duration")}update(){this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.info?this.processWebGPUTimestamps():this.processGpuQueries(),this.updateAverages(),this.resetCounters()}processWebGPUTimestamps(){this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp}resetCounters(){this.renderCount=0,this.totalCpuDuration=0,this.beginTime=this.endInternal()}resizePanel(e){e.canvas.style.position="absolute",this.minimal?e.canvas.style.display="none":(e.canvas.style.display="block",this.horizontal?(e.canvas.style.top="0px",e.canvas.style.left=e.id*e.WIDTH/e.PR+"px"):(e.canvas.style.left="0px",e.canvas.style.top=e.id*e.HEIGHT/e.PR+"px"))}addPanel(e){return e.canvas&&(this.dom.appendChild(e.canvas),e.id=this._panelId,this.resizePanel(e),this._panelId++),e}showPanel(e){for(let t=0;t<this.dom.children.length;t++){const n=this.dom.children[t];n.style.display=t===e?"block":"none"}this.mode=e}processGpuQueries(){!this.gl||!this.ext||(this.totalGpuDuration=0,this.gpuQueries.forEach((e,t)=>{if(this.gl){const n=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE),r=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(n&&!r){const o=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT)*1e-6;this.totalGpuDuration+=o,this.gl.deleteQuery(e.query),this.gpuQueries.splice(t,1)}}}))}detectVSync(e){if(this.lastFrameTime===0){this.lastFrameTime=e;return}const t=e-this.lastFrameTime;if(this.lastFrameTime=e,this.frameTimeHistory.push(t),this.frameTimeHistory.length>this.HISTORY_SIZE&&this.frameTimeHistory.shift(),this.frameTimeHistory.length<60)return;const n=this.frameTimeHistory.reduce((c,u)=>c+u)/this.frameTimeHistory.length,r=this.frameTimeHistory.reduce((c,u)=>c+Math.pow(u-n,2),0)/this.frameTimeHistory.length;if(Math.sqrt(r)>2){this.detectedVSync=null;return}let o=null,a=1/0;for(const c of this.VSYNC_RATES){const u=Math.abs(n-c.frameTime);u<a&&(a=u,o=c)}o&&a/o.frameTime<=this.VSYNC_THRESHOLD?this.detectedVSync=o:this.detectedVSync=null}endInternal(){var e;const t=performance.now();for(this.frameTimes.push(t);this.frameTimes.length>0&&this.frameTimes[0]<=t-1e3;)this.frameTimes.shift();const n=Math.round(this.frameTimes.length);this.addToAverage(n,this.averageFps);const r=t>=this.prevTextTime+1e3/this.logsPerSecond,s=t>=this.prevGraphTime+1e3/this.graphsPerSecond;if(this.updatePanelComponents(this.fpsPanel,this.averageFps,0,r,s),this.updatePanelComponents(this.msPanel,this.averageCpu,this.precision,r,s),this.gpuPanel&&this.updatePanelComponents(this.gpuPanel,this.averageGpu,this.precision,r,s),this.trackCPT&&this.gpuPanelCompute&&this.updatePanelComponents(this.gpuPanelCompute,this.averageGpuCompute,this.precision,r,s),r&&(this.prevTextTime=t),s&&(this.prevGraphTime=t),this.vsyncPanel!==null){this.detectVSync(t);const o=((e=this.detectedVSync)==null?void 0:e.refreshRate)||0;r&&o>0&&this.vsyncPanel.update(o,o)}return t}updatePanelComponents(e,t,n,r,s){if(!e||t.logs.length===0)return;e.name in this.lastMin||(this.lastMin[e.name]=1/0,this.lastMax[e.name]=0,this.lastValue[e.name]=0);const o=t.logs[t.logs.length-1];this.lastMax[e.name]=Math.max(...t.logs),this.lastMin[e.name]=Math.min(this.lastMin[e.name],o),this.lastValue[e.name]=this.lastValue[e.name]*.7+o*.3;const a=Math.max(Math.max(...t.logs),...t.graph.slice(-this.samplesGraph));this.updateCounter++,r&&e.update(this.lastValue[e.name],this.lastMax[e.name],n),s&&e.updateGraph(o,a)}beginProfiling(e){if(window.performance)try{window.performance.clearMarks(e),window.performance.mark(e)}catch(t){console.debug("Stats: Performance marking failed:",t)}}endProfiling(e,t,n){if(!(!window.performance||!t||!e))try{window.performance.getEntriesByName(e,"mark").length===0&&this.beginProfiling(e),window.performance.clearMarks(t),window.performance.mark(t),window.performance.clearMeasures(n);const s=performance.measure(n,e,t);this.totalCpuDuration+=s.duration,window.performance.clearMarks(e),window.performance.clearMarks(t),window.performance.clearMeasures(n)}catch(r){console.debug("Stats: Performance measurement failed:",r)}}updatePanel(e,t,n=2){if(!e||t.logs.length===0)return;const r=performance.now();e.name in this.lastMin||(this.lastMin[e.name]=1/0,this.lastMax[e.name]=0,this.lastValue[e.name]=0);const s=t.logs[t.logs.length-1],o=Math.max(...t.logs.slice(-30));this.lastMin[e.name]=Math.min(this.lastMin[e.name],s),this.lastMax[e.name]=Math.max(this.lastMax[e.name],s),this.lastValue[e.name]=this.lastValue[e.name]*.7+s*.3;const a=Math.max(o,...t.graph.slice(-this.samplesGraph));this.updateCounter++,this.updateCounter%(this.logsPerSecond*2)===0&&(this.lastMax[e.name]=o,this.lastMin[e.name]=s),e.update&&(r>=this.prevCpuTime+1e3/this.logsPerSecond&&e.update(this.lastValue[e.name],s,this.lastMax[e.name],a,n),r>=this.prevGraphTime+1e3/this.graphsPerSecond&&(e.updateGraph(s,a),this.prevGraphTime=r))}updateAverages(){this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu),this.info&&this.totalGpuDurationCompute!==void 0&&this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)}addToAverage(e,t){t.logs.push(e),t.logs.length>this.samplesLog&&(t.logs=t.logs.slice(-this.samplesLog)),t.graph.push(e),t.graph.length>this.samplesGraph&&(t.graph=t.graph.slice(-this.samplesGraph))}get domElement(){return this.dom}patchThreeWebGPU(e){const t=e.info.reset,n=this;e.info.reset=function(){n.beginProfiling("cpu-started"),t.call(this)}}patchThreeRenderer(e){const t=e.render,n=this;e.render=function(r,s){n.begin(),t.call(this,r,s),n.end()},this.threeRendererPatched=!0}};kke.Panel=Ike;let Mvt=kke;function Cvt(i){return _n.useEffect(()=>{function e(a){let c=null;return i.three.scenes.forEach(u=>{a.search(u.uuid)>-1&&(c=u)}),c}const t=a=>{const c=a.value,u=e(c),f=u==null?void 0:u.getObjectByProperty("uuid",c);f!==void 0&&i.three.setObject(f)},n=(a,c,u)=>{const f=e(a),m=f==null?void 0:f.getObjectByProperty("uuid",a);m!==void 0&&Lo(m,c,u)},r=a=>{const c=a.value,{key:u,value:f,uuid:m}=c;n(m,u,f)},s=a=>{const c=a.value,u=e(c.uuid),f=u==null?void 0:u.getObjectByProperty("uuid",c.uuid);if(f!==void 0){const m=v=>{const x=c.key.split(".");switch(x.length){case 1:f[x[0]]=v;break;case 2:f[x[0]][x[1]]=v;break;case 3:f[x[0]][x[1]][x[2]]=v;break;case 4:f[x[0]][x[1]][x[2]][x[3]]=v;break;case 5:f[x[0]][x[1]][x[2]][x[3]][x[4]]=v;break}f.material.needsUpdate=!0};c.value.src.length>0?Mre(c.value.src).then(v=>{v.offset.set(c.value.offset[0],c.value.offset[1]),v.repeat.set(c.value.repeat[0],c.value.repeat[1]),m(v)}):m(null)}},o=a=>{const{key:c,uuid:u,value:f,subitem:m}=a.value,v=e(u),x=v==null?void 0:v.getObjectByProperty("uuid",u);if(x!==void 0)try{m!==void 0?set(x,m)[c](f):x[c](f)}catch(T){console.log("Error requesting method:"),console.log(T),console.log(c),console.log(f)}};return i.app.addEventListener(ar.GET_OBJECT,t),i.app.addEventListener(ar.UPDATE_OBJECT,r),i.app.addEventListener(ar.CREATE_TEXTURE,s),i.app.addEventListener(ar.REQUEST_METHOD,o),()=>{i.app.removeEventListener(ar.GET_OBJECT,t),i.app.removeEventListener(ar.UPDATE_OBJECT,r),i.app.removeEventListener(ar.CREATE_TEXTURE,s),i.app.removeEventListener(ar.REQUEST_METHOD,o)}},[]),null}function RJ(i,e,t,n){return new(t||(t=Promise))(function(r,s){function o(u){try{c(n.next(u))}catch(f){s(f)}}function a(u){try{c(n.throw(u))}catch(f){s(f)}}function c(u){var f;u.done?r(u.value):(f=u.value,f instanceof t?f:new t(function(m){m(f)})).then(o,a)}c((n=n.apply(i,e||[])).next())})}const Avt=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function TEe(i){return i=i.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const Dke=typeof window>"u",Df=(()=>{if(Dke)return;const{userAgent:i,platform:e,maxTouchPoints:t}=window.navigator,n=/(iphone|ipod|ipad)/i.test(i),r=e==="iPad"||e==="MacIntel"&&t>0&&!window.MSStream;return{isIpad:r,isMobile:/android/i.test(i)||n||r,isSafari12:/Version\/12.+Safari/.test(i),isFirefox:/Firefox/.test(i)}})();function Rvt(i,e,t){if(!t)return[e];const n=function(u){const f=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,m=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,v=u.createShader(35633),x=u.createShader(35632),T=u.createProgram();if(!(x&&v&&T))return;u.shaderSource(v,f),u.shaderSource(x,m),u.compileShader(v),u.compileShader(x),u.attachShader(T,v),u.attachShader(T,x),u.linkProgram(T),u.detachShader(T,v),u.detachShader(T,x),u.deleteShader(v),u.deleteShader(x),u.useProgram(T);const P=u.createBuffer();u.bindBuffer(34962,P),u.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const R=u.getAttribLocation(T,"aPosition");u.vertexAttribPointer(R,3,5126,!1,0,0),u.enableVertexAttribArray(R),u.clearColor(1,1,1,1),u.clear(16384),u.viewport(0,0,1,1),u.drawArrays(4,0,3);const M=new Uint8Array(4);return u.readPixels(0,0,1,1,6408,5121,M),u.deleteProgram(T),u.deleteBuffer(P),M.join("")}(i),r="801621810",s="8016218135",o="80162181161",a=Df!=null&&Df.isIpad?[["a7",o,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",r,15],["a12x",r,15],["a12z",r,15],["a14",r,15],["a15",r,15],["m1",r,15],["m2",r,15]]:[["a7",o,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",r,15],["a12",r,15],["a13",r,15],["a14",r,15],["a15",r,15],["a16",r,15],["a17",r,15]];let c;return n==="80162181255"?c=a.filter(([,,u])=>u>=14):(c=a.filter(([,u])=>u===n),c.length||(c=a)),c.map(([u])=>`apple ${u} gpu`)}class EEe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}const PJ=[],MEe=[];function Pvt(i,e){if(i===e)return 0;const t=i;i.length>e.length&&(i=e,e=t);let n=i.length,r=e.length;for(;n>0&&i.charCodeAt(~-n)===e.charCodeAt(~-r);)n--,r--;let s,o=0;for(;o<n&&i.charCodeAt(o)===e.charCodeAt(o);)o++;if(n-=o,r-=o,n===0)return r;let a,c,u=0,f=0,m=0;for(;f<n;)MEe[f]=i.charCodeAt(o+f),PJ[f]=++f;for(;m<r;)for(s=e.charCodeAt(o+m),a=m++,u=m,f=0;f<n;f++)c=s===MEe[f]?a:a+1,a=PJ[f],u=PJ[f]=a>u?c>u?u+1:c:c>a?a+1:c;return u}function Nvt(i){return i!=null}const Ivt=({mobileTiers:i=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:t={},glContext:n,failIfMajorPerformanceCaveat:r=!1,benchmarksURL:s="https://unpkg.com/detect-gpu@5.0.70/dist/benchmarks"}={})=>RJ(void 0,void 0,void 0,function*(){const o={};if(Dke)return{tier:0,type:"SSR"};const{isIpad:a=!!(Df!=null&&Df.isIpad),isMobile:c=!!(Df!=null&&Df.isMobile),screenSize:u=window.screen,loadBenchmarks:f=Y=>RJ(void 0,void 0,void 0,function*(){const J=yield fetch(`${s}/${Y}`).then(z=>z.json());if(parseInt(J.shift().split(".")[0],10)<4)throw new EEe("Detect GPU benchmark data is out of date. Please update to version 4x");return J})}=t;let{renderer:m}=t;const v=(Y,J,z,ne,K)=>({device:K,fps:ne,gpu:z,isMobile:c,tier:Y,type:J});let x,T="";if(m)m=TEe(m),x=[m];else{const Y=n||function(z,ne=!1){const K={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:ne,powerPreference:"high-performance",stencil:!1};z&&delete K.powerPreference;const $=window.document.createElement("canvas"),he=$.getContext("webgl",K)||$.getContext("experimental-webgl",K);return he??void 0}(Df==null?void 0:Df.isSafari12,r);if(!Y)return v(0,"WEBGL_UNSUPPORTED");const J=Df!=null&&Df.isFirefox?null:Y.getExtension("WEBGL_debug_renderer_info");if(m=J?Y.getParameter(J.UNMASKED_RENDERER_WEBGL):Y.getParameter(Y.RENDERER),!m)return v(1,"FALLBACK");T=m,m=TEe(m),x=function(z,ne,K){return ne==="apple gpu"?Rvt(z,ne,K):[ne]}(Y,m,c)}const P=(yield Promise.all(x.map(function(Y){var J;return RJ(this,void 0,void 0,function*(){const z=(In=>{const vt=c?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const Ut of vt)if(In.includes(Ut))return Ut})(Y);if(!z)return;const ne=`${c?"m":"d"}-${z}${a?"-ipad":""}.json`,K=o[ne]=(J=o[ne])!==null&&J!==void 0?J:f(ne);let $;try{$=yield K}catch(In){if(In instanceof EEe)throw In;return}const he=function(In){var vt;const Ut=(In=In.replace(/\([^)]+\)/,"")).match(/\d+/)||In.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(vt=Ut==null?void 0:Ut.join("").replace(/\W|amd/g,""))!==null&&vt!==void 0?vt:""}(Y);let Ce=$.filter(([,In])=>In===he);Ce.length||(Ce=$.filter(([In])=>In.includes(Y)));const Pe=Ce.length;if(Pe===0)return;const je=Y.split(/[.,()\[\]/\s]/g).sort().filter((In,vt,Ut)=>vt===0||In!==Ut[vt-1]).join(" ");let ge,[Xe,,,,Fe]=Pe>1?Ce.map(In=>[In,Pvt(je,In[2])]).sort(([,In],[,vt])=>In-vt)[0][0]:Ce[0],Ne=Number.MAX_VALUE;const{devicePixelRatio:tt}=window,mt=u.width*tt*u.height*tt;for(const In of Fe){const[vt,Ut]=In,Sn=vt*Ut,ln=Math.abs(mt-Sn);ln<Ne&&(Ne=ln,ge=In)}if(!ge)return;const[,,Ht,pn]=ge;return[Ne,Ht,Xe,pn]})}))).filter(Nvt).sort(([Y=Number.MAX_VALUE,J],[z=Number.MAX_VALUE,ne])=>Y===z?J-ne:Y-z);if(!P.length){const Y=Avt.find(J=>m.includes(J));return Y?v(0,"BLOCKLISTED",Y):v(1,"FALLBACK",`${m} (${T})`)}const[,R,M,O]=P[0];if(R===-1)return v(0,"BLOCKLISTED",M,R,O);const C=c?i:e;let L=0;for(let Y=0;Y<C.length;Y++)R>=C[Y]&&(L=Y);return v(L,"BENCHMARK",M,R,O)});function kvt(i){let e=0;const t=performance.now();function n(){e++;const r=performance.now();if(r-t>=100){const s=e/((r-t)/1e3),o=Math.round(s/30)*30;i(o)}else requestAnimationFrame(n)}requestAnimationFrame(n)}function Dvt(i,e,t){return new Promise(n=>{Ivt().then(r=>{let s=!1;const o=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);if(s="transferControlToOffscreen"in i,o){const c=navigator.userAgent.match(/version\/(\d+)/i);s=(c?parseInt(c[1]):0)>=17}const a={dpr:devicePixelRatio,fps:30,width:innerWidth,height:innerHeight,mobile:r.isMobile!==void 0?r.isMobile:!1,supportOffScreenCanvas:s,quality:2,dev:e,editor:t};r.tier===3?a.quality=0:r.tier===2&&(a.quality=1),kvt(c=>{a.fps=c,n(a)}),n(a)})})}let f1,oo,ZT="";function Fvt(i){const e=_n.useRef(null),t=_n.useRef(null),n=i.app.components.get("theatre"),r=i.app.components.get("three");_n.useEffect(()=>{const c=e.current;c.style.visibility=i.app.editor?"hidden":"inherit",n.sheet("App");const u=n==null?void 0:n.sheetObject("App","Box",{x:Rte.types.number(100,{range:[0,window.innerWidth]}),y:Rte.types.number(100,{range:[0,window.innerHeight]})},f=>{c.style.left=`${f.x}px`,c.style.top=`${f.y}px`});return()=>{u!==void 0&&(n==null||n.unsubscribe(u)),i.app.dispose()}},[]),_n.useEffect(()=>{const c=t.current;c!==null&&Dvt(c,zAe,Gee).then(u=>console.log("Settings",u))},[]),i.app.isApp&&_n.useEffect(()=>{const c=t.current;return console.log("WebGPU:",!0),f1=new Tvt({canvas:c,stencil:!1}),f1.shadowMap.enabled=!0,f1.setPixelRatio(devicePixelRatio),f1.setClearColor(0),r.setRenderer(f1,c),()=>{f1.dispose()}},[]),i.app.isApp&&_n.useEffect(()=>{const c=new Mvt;c.init(f1),document.body.appendChild(c.dom);let u=-1;const f=()=>{const v=window.innerWidth,x=window.innerHeight;oo==null||oo.resize(v,x),f1.setSize(v,x)},m=()=>{oo==null||oo.update(),c.begin(),oo==null||oo.draw(),c.end(),c.update(),u=requestAnimationFrame(m)};return window.addEventListener("resize",f),f(),m(),()=>{oo!==void 0&&(r.removeCamera(oo.camera),r.removeScene(oo),Td(oo)),window.removeEventListener("resize",f),cancelAnimationFrame(u),u=-1}},[]);const s=()=>{oo!==void 0&&(oo.camera!==void 0&&r.removeCamera(oo.camera),r.removeScene(oo),Td(oo)),ZT==="scene1"?oo=new GNe:oo=new $Ne,oo.setup(i.app,f1),oo.init(),oo.resize(window.innerWidth,window.innerHeight)},o=()=>{ZT!=="scene1"&&(ZT="scene1",s())},a=()=>{ZT!=="scene2"&&(ZT="scene2",s())};return _n.useEffect(()=>{const c=e.current;c.style.visibility=i.app.editor?"hidden":"inherit";const u=m=>{console.log("Custom:",m.value)},f=m=>{const v=m.value.value;v==="scene1"?o():v==="scene2"&&a()};return i.app.addEventListener(ar.CUSTOM,u),i.app.addEventListener(ar.SELECT_DROPDOWN,f),()=>{i.app.removeEventListener(ar.CUSTOM,u),i.app.removeEventListener(ar.SELECT_DROPDOWN,f)}},[]),We.jsxs(We.Fragment,{children:[i.app.isApp&&We.jsx("canvas",{ref:t}),We.jsx("div",{id:"box",ref:e,children:We.jsx("button",{onClick:()=>{i.app.send({target:"editor",event:"custom",data:"hello editor!"}),n.playSheet("App")},children:"Click"})}),i.app.isApp&&We.jsxs("div",{style:{position:"absolute",bottom:"20px",left:"20px"},children:[We.jsx("button",{onClick:o,children:"Scene 1"}),We.jsx("button",{onClick:a,children:"Scene 2"})]}),We.jsx(Cvt,{app:i.app,three:r})]})}function Ovt(i){const[e,t]=_n.useState(!1);return _n.useEffect(()=>{const n=()=>{T4.removeEventListener(H2.LOAD_COMPLETE,n),t(!0)};T4.addEventListener(H2.LOAD_COMPLETE,n),c1t(i.app)},[t]),We.jsxs(We.Fragment,{children:[!e&&We.jsx("p",{children:"Loading..."}),e&&We.jsx(Fvt,{app:i.app})]})}function Bvt(){const i=_n.useMemo(()=>{const e=new KJe("ws://localhost:8080",zAe,Gee);return e.addComponent("theatre",new tet(e)),e.addComponent("three",new aet(e)),e},[]);return We.jsxs(We.Fragment,{children:[We.jsx(uet,{app:i}),Gee&&We.jsx(f1t,{app:i}),We.jsx(Ovt,{app:i})]})}zCe.initialize();NJ.createRoot(document.getElementById("root")).render(We.jsx(We.Fragment,{children:We.jsx(We.Fragment,{children:We.jsx(Bvt,{})})}));
